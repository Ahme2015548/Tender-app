import{u as J,a as K,r as o,b as Q,c as X,d as Y,j as t,e as Z,I as y,P as ee,C as te,T as x,s as se,S as ae}from"./index-1759246972099-Cj1vZ7mq.js";const ie=({refreshTrigger:$,searchTerm:C})=>{const A=J(),{hasPerm:ne}=K();console.log("TenderArchiveList is rendering");const[m,f]=o.useState([]),[T,S]=o.useState(!0),[h,D]=o.useState(null),[P,re]=o.useState(""),i=C!==void 0?C:P,[g,E]=o.useState([]),[b,l]=o.useState(!1),{logActivity:p,getCurrentUser:j}=Q(),{alertConfig:c,closeAlert:O,showSuccess:v,showError:u,showConfirm:w}=X(),{formatDate:F}=Z(),{currentPage:L,totalPages:R,paginatedItems:W,handlePageChange:M,resetPage:I,totalItems:U,itemsPerPage:k}=Y(g,30);console.log("TenderArchiveList state:",{tendersCount:m.length,loading:T,error:h});const d=async()=>{try{S(!0),D(null),console.log("Loading archived tenders...");const e=await x.getArchivedTenders();console.log("Archived tenders loaded:",e.length),e.length>0&&(console.log("=== FIRST ARCHIVED TENDER COMPLETE DATA ==="),console.log("Full tender object:",e[0]),console.log("All fields:",Object.keys(e[0])),console.log("Date fields specifically:"),Object.keys(e[0]).forEach(s=>{const n=e[0][s];n&&(s.toLowerCase().includes("date")||s.toLowerCase().includes("deadline")||s.toLowerCase().includes("Ø§Ù†ØªÙ‡Ø§Ø¡")||s.toLowerCase().includes("Ù…ÙˆØ¹Ø¯"))&&(console.log(`  ${s}:`,n,typeof n),n&&typeof n=="object"&&n.seconds&&console.log("    Firestore timestamp - converts to:",new Date(n.seconds*1e3)))})),console.log("ðŸ” DEBUGGING: Before sorting, first 3 archived tenders:",e.slice(0,3).map(s=>({title:s.title,id:s.id,createdAt:s.createdAt,createdAtType:typeof s.createdAt,createdAtValue:s.createdAt instanceof Date?s.createdAt.toISOString():s.createdAt})));const a=se(e);console.log("ðŸ” DEBUGGING: After sorting, first 3 archived tenders:",a.slice(0,3).map(s=>({title:s.title,id:s.id,createdAt:s.createdAt,createdAtType:typeof s.createdAt,createdAtValue:s.createdAt instanceof Date?s.createdAt.toISOString():s.createdAt}))),console.log("âœ… Applied global sorting - newest archived tenders first:",a.length),f(a)}catch(e){console.error("Error loading archived tenders:",e),D(e.message||"ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ§Øª Ø§Ù„Ù…Ø¤Ø±Ø´ÙØ©")}finally{S(!1)}};o.useEffect(()=>{d()},[$]),o.useEffect(()=>{const e=setInterval(()=>{f(a=>[...a])},6e4);return()=>clearInterval(e)},[]),o.useEffect(()=>{if(i.trim()){const e=m.filter(a=>{var s,n,r,N;return((s=a.title)==null?void 0:s.toLowerCase().includes(i.toLowerCase()))||((n=a.referenceNumber)==null?void 0:n.toLowerCase().includes(i.toLowerCase()))||((r=a.entity)==null?void 0:r.toLowerCase().includes(i.toLowerCase()))||((N=a.description)==null?void 0:N.toLowerCase().includes(i.toLowerCase()))});E(e)}else E(m);I()},[i,m,I]);const V=e=>{w(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ© Ù…Ù† Ø§Ù„Ø£Ø±Ø´ÙŠÙØŸ

${e.title}`,()=>G(e),"ØªØ£ÙƒÙŠØ¯ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ©")},G=async e=>{try{l(!0),console.log("ðŸ”„ Starting tender restore:",e);const a={status:"active",trackingStatus:"active",trackingStage:"Ø¥Ø¹Ø¯Ø§Ø¯",trackingStartedAt:new Date().toISOString(),trackingEndedAt:null,archivedAt:null,autoArchived:!1,archiveStatus:null,absolutePersistence:!0,restoredAt:new Date().toISOString(),restoredFrom:"archive",lastStatusChange:"restored_from_archive_to_tracking",statusChangeTimestamp:new Date().toISOString(),updatedAt:new Date().toISOString()};console.log("ðŸ“ Restore data:",a);const s=await x.updateTender(e.id,a);console.log("âœ… TenderService.updateTender result:",s);const n=j();p("task",`${n.name} Ø§Ø³ØªØ¹Ø§Ø¯ Ù…Ù†Ø§Ù‚ØµØ© Ù…Ù† Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø¥Ù„Ù‰ Ø§Ù„ØªØªØ¨Ø¹`,`ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù†Ø§Ù‚ØµØ© Ù„Ù„ØªØªØ¨Ø¹: ${e.title}`),console.log("âœ… Activity logged successfully"),console.log("ðŸ”„ Reloading tenders list..."),await d(),console.log("âœ… Tenders list reloaded"),v(`ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ© Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„ØªØªØ¨Ø¹: ${e.title}`,"ØªÙ…Øª Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­")}catch(a){console.error("âŒ Error restoring tender:",a),console.error("âŒ Error details:",{message:a.message,stack:a.stack,tender:e}),u(`ÙØ´Ù„ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ©: ${a.message}`,"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©")}finally{l(!1),console.log("ðŸ Restore process completed (finally block)")}},_=e=>{w(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù†Ù‚Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ÙØ§Ø¦Ø²Ø©ØŸ

${e.title}`,()=>z(e),"ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù†Ù‚Ù„ Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ÙØ§Ø¦Ø²Ø©")},z=async e=>{try{l(!0),console.log("ðŸ† [ARCHIVE-TO-WON] Force moving to won projects:",e.id),await x.moveToWonProjectsAbsolute(e.id);const a=j();p("task",`${a.name} Ù†Ù‚Ù„ Ù…Ù†Ø§Ù‚ØµØ© Ù…Ù† Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ÙØ§Ø¦Ø²Ø©`,`ØªÙ… Ù†Ù‚Ù„ Ù…Ù†Ø§Ù‚ØµØ©: ${e.title}`),window.dispatchEvent(new CustomEvent("tenderMovedToWon",{detail:{tenderId:e.id}})),console.log("ðŸ“¡ Real-time event dispatched: tenderMovedToWon"),console.log("â³ Waiting for Firestore sync..."),await new Promise(s=>setTimeout(s,1500)),f(s=>s.filter(n=>n.id!==e.id)),await d(),v(`ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ÙØ§Ø¦Ø²Ø©: ${e.title}`,"Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ© Ù…ØªØ§Ø­Ø© Ø§Ù„Ø¢Ù† ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹"),console.log("ðŸ† [ARCHIVE-TO-WON] Force move to won completed successfully")}catch(a){console.error("âŒ [ARCHIVE-TO-WON] Error in force move to won:",a),u(`ÙØ´Ù„ ÙÙŠ Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ© Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ÙØ§Ø¦Ø²Ø©: ${a.message}`,"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ù‚Ù„")}finally{l(!1)}},B=e=>{w(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ©ØŸ Ù„Ù† ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡Ø§ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.

${e.title}`,()=>H(e),"ØªØ­Ø°ÙŠØ±: Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ")},H=async e=>{try{l(!0),await ae.moveToTrash(e,"tenders"),await x.deleteTender(e.id);const a=j();p("task",`${a.name} Ø­Ø°Ù Ù…Ù†Ø§Ù‚ØµØ© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹`,`ØªÙ… Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù…Ù†Ø§Ù‚ØµØ©: ${e.title}`),d(),v(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹: ${e.title}`,"ØªÙ… Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ")}catch(a){console.error("Error permanently deleting tender:",a),u(`ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹: ${a.message}`,"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ")}finally{l(!1)}},q=e=>e.autoArchived?t.jsx("span",{className:"badge bg-secondary text-white",children:"Ù…Ø¤Ø±Ø´Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹"}):t.jsx("span",{className:"badge bg-secondary text-white",children:"Ù…Ø¤Ø±Ø´Ù"});return T?(console.log("TenderArchiveList: Showing loading state"),t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"spinner-border text-primary",role:"status",children:t.jsx("span",{className:"visually-hidden",children:"Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„..."})}),t.jsx("p",{className:"mt-3 text-muted",children:"Ø¬Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ§Øª..."})]})})):h?(console.log("TenderArchiveList: Showing error state:",h),t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:"Ø­Ø¯Ø« Ø®Ø·Ø£"}),t.jsx("p",{className:"text-muted",children:h}),t.jsx("div",{className:"d-flex gap-2 justify-content-center",children:t.jsxs("button",{className:"btn btn-primary",onClick:d,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"]})})]})})):(console.log("TenderArchiveList: Showing main content with",g.length,"archived tenders"),t.jsxs("div",{"data-list":"tenders-archive",children:[g.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-archive fs-1"})}),t.jsx("h5",{className:"text-muted",children:"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†Ø§Ù‚ØµØ§Øª Ù…Ø¤Ø±Ø´ÙØ©"}),t.jsx("p",{className:"text-muted",children:i?"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ":"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø§Ù‚ØµØ§Øª Ù…Ø¤Ø±Ø´ÙØ© Ø­Ø§Ù„ÙŠØ§Ù‹"})]}):t.jsx(t.Fragment,{children:t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),t.jsx("th",{className:"text-center",children:"Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ©"}),t.jsx("th",{className:"text-center",children:"Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©"}),t.jsx("th",{className:"text-center",children:"Ø³Ø¹Ø± ÙƒØ±Ø§Ø³Ø© Ø§Ù„Ø´Ø±ÙˆØ·"}),t.jsx("th",{className:"text-center",children:"Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ©"}),t.jsx("th",{className:"text-center",children:"Ù…ÙˆØ¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…"}),t.jsx("th",{className:"text-center",children:"Ø§Ù„Ø­Ø§Ù„Ø©"}),t.jsx("th",{className:"text-center",style:{width:"120px",paddingLeft:"40px"},children:"Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª"})]})}),t.jsx("tbody",{children:W.map((e,a)=>t.jsxs("tr",{style:{height:"52px"},children:[t.jsx("td",{className:"text-center align-middle",children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(L-1)*k+a+1})}),t.jsx("td",{className:"text-center align-middle",children:t.jsx("button",{className:"btn btn-link p-0 fw-bold text-danger",onClick:()=>{e.id&&A(`/tenders/edit/${e.id}`)},style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer",fontSize:"inherit",color:"#ff6b6b !important"},title:"Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ©",children:e.entity})}),t.jsx("td",{className:"text-center align-middle",children:t.jsxs("span",{className:"badge bg-success text-white",children:[(e.estimatedValue||0).toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," Ø±.Ø³"]})}),t.jsx("td",{className:"text-center align-middle",children:e.documentPrice&&e.documentPrice>0?t.jsxs("span",{className:"badge bg-info text-white",style:{fontSize:"11px",padding:"4px 8px"},children:[e.documentPrice," Ø±.Ø³"]}):t.jsx("span",{className:"badge bg-secondary",style:{fontSize:"11px",padding:"4px 8px"},children:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"})}),t.jsx("td",{className:"text-center align-middle",children:t.jsx("button",{className:"btn btn-link p-0 fw-bold text-muted tender-title-btn",onClick:()=>{e.id?A(`/tenders/edit/${e.id}`):u("Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ© Ù…ÙÙ‚ÙˆØ¯ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªÙ†Ù‚Ù„","Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ†Ù‚Ù„")},style:{textDecoration:"none",cursor:"pointer",color:"#6c757d !important",fontWeight:"bold",border:"none",background:"none",padding:"0"},title:`Ø§Ù†Ù‚Ø± Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ© | Firebase ID: ${e.id||"Missing"}`,children:e.title})}),t.jsx("td",{className:"text-center align-middle",children:(()=>{const s=["submissionDeadline","deadline","submissionDate","endDate","dueDate","closingDate","applicationDeadline","tenderDeadline","date","ØªØ§Ø±ÙŠØ®_Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡","Ù…ÙˆØ¹Ø¯_Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡"];let n=null;for(const r of s)e[r]&&(n||(n=e[r]));if(Object.keys(e).forEach(r=>{(r.toLowerCase().includes("date")||r.toLowerCase().includes("deadline"))&&!n&&e[r]&&(n=e[r])}),n){let r=n;return n&&typeof n=="object"&&n.seconds?r=new Date(n.seconds*1e3):n&&typeof n=="object"&&n.toDate&&(r=n.toDate()),F(r)||"ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ­ÙŠØ­"}else return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"})()}),t.jsx("td",{className:"text-center align-middle",children:q(e)}),t.jsx("td",{className:"text-center",style:{paddingLeft:"40px"},children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(y,{can:"tenders:update",mode:"disable",children:t.jsx("button",{className:"btn btn-success",onClick:()=>V(e),disabled:b,title:"Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù† Ø§Ù„Ø£Ø±Ø´ÙŠÙ",style:{transition:"transform 0.2s ease"},onMouseEnter:s=>s.currentTarget.style.transform="scale(1.1)",onMouseLeave:s=>s.currentTarget.style.transform="scale(1)",children:t.jsx("i",{className:"bi bi-arrow-counterclockwise"})})}),t.jsx(y,{can:"tenders:update",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-primary",onClick:()=>_(e),disabled:b,title:"Ù†Ù‚Ù„ Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ÙØ§Ø¦Ø²Ø©",children:t.jsx("i",{className:"bi bi-trophy"})})}),t.jsx(y,{can:"tenders:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>B(e),disabled:b,title:"Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ",children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},e.internalId||e.id||`tender-${a}`))})]})})}),g.length>0&&t.jsx(ee,{currentPage:L,totalPages:R,onPageChange:M,totalItems:U,itemsPerPage:k}),t.jsx(te,{show:c.show,onClose:O,title:c.title,message:c.message,type:c.type,onConfirm:c.onConfirm,showConfirm:c.showConfirm})]}))};export{ie as default};
