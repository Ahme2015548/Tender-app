import{u as H,a as J,r as o,b as K,c as Q,d as X,j as e,e as Y,I as P,P as Z,C as ee,T as N,s as te,S as se}from"./index-1759246972099-Cj1vZ7mq.js";const ae=({refreshTrigger:b,searchTerm:m})=>{const d=H(),{hasPerm:ne}=J();console.log("TendersListFixed is rendering");const[x,y]=o.useState([]),[w,D]=o.useState(!0),[g,C]=o.useState(null),[$,ie]=o.useState(""),r=m!==void 0?m:$,[p,T]=o.useState([]),[le,v]=o.useState(!1),{logActivity:I,getCurrentUser:k}=K(),{alertConfig:c,closeAlert:z,showSuccess:S,showError:h,showConfirm:O}=Q(),{formatDate:G}=Y(),{currentPage:L,totalPages:V,paginatedItems:U,handlePageChange:B,resetPage:A,totalItems:R,itemsPerPage:E}=X(p,30);console.log("TendersListFixed state:",{tendersCount:x.length,loading:w,error:g});const u=async()=>{try{D(!0),C(null),console.log("Loading tenders...");const t=await N.getActiveTenders();console.log("Tenders loaded:",t.length),t.length>0&&(console.log("=== FIRST TENDER COMPLETE DATA ==="),console.log("Full tender object:",t[0]),console.log("All fields:",Object.keys(t[0])),console.log("Date fields specifically:"),Object.keys(t[0]).forEach(s=>{const a=t[0][s];a&&(s.toLowerCase().includes("date")||s.toLowerCase().includes("deadline")||s.toLowerCase().includes("Ø§Ù†ØªÙ‡Ø§Ø¡")||s.toLowerCase().includes("Ù…ÙˆØ¹Ø¯"))&&(console.log(`  ${s}:`,a,typeof a),a&&typeof a=="object"&&a.seconds&&console.log("    Firestore timestamp - converts to:",new Date(a.seconds*1e3)))})),console.log("ðŸ” DEBUGGING: Before sorting, first 3 tenders:",t.slice(0,3).map(s=>({title:s.title,id:s.id,createdAt:s.createdAt,createdAtType:typeof s.createdAt,createdAtValue:s.createdAt instanceof Date?s.createdAt.toISOString():s.createdAt})));const n=te(t);console.log("ðŸ” DEBUGGING: After sorting, first 3 tenders:",n.slice(0,3).map(s=>({title:s.title,id:s.id,createdAt:s.createdAt,createdAtType:typeof s.createdAt,createdAtValue:s.createdAt instanceof Date?s.createdAt.toISOString():s.createdAt}))),console.log("âœ… Applied global sorting - newest tenders first:",n.length),y(n)}catch(t){console.error("Error loading tenders:",t),C(t.message||"ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ§Øª")}finally{D(!1)}};o.useEffect(()=>{u()},[b]),o.useEffect(()=>{const t=setInterval(()=>{y(n=>[...n])},6e4);return()=>clearInterval(t)},[]),o.useEffect(()=>{if(r.trim()){const t=x.filter(n=>{var s,a,i,l;return((s=n.title)==null?void 0:s.toLowerCase().includes(r.toLowerCase()))||((a=n.referenceNumber)==null?void 0:a.toLowerCase().includes(r.toLowerCase()))||((i=n.entity)==null?void 0:i.toLowerCase().includes(r.toLowerCase()))||((l=n.description)==null?void 0:l.toLowerCase().includes(r.toLowerCase()))});T(t)}else T(x);A()},[r,x,A]);const M=t=>{O(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ©ØŸ

${t.title}`,()=>_(t),"ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ©")},_=async t=>{try{v(!0),await se.moveToTrash(t,"tenders"),await N.deleteTender(t.id);const n=k();I("task",`${n.name} Ø­Ø°Ù Ù…Ù†Ø§Ù‚ØµØ©`,`ØªÙ… Ø­Ø°Ù Ù…Ù†Ø§Ù‚ØµØ©: ${t.entity}`),u(),S(`ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ© Ù„Ù„Ù…Ù‡Ù…Ù„Ø§Øª: ${t.title}`,"ØªÙ… Ø§Ù„Ù†Ù‚Ù„ Ù„Ù„Ù…Ù‡Ù…Ù„Ø§Øª")}catch(n){console.error("Error deleting tender:",n),h(`ÙØ´Ù„ ÙÙŠ Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ© Ù„Ù„Ù…Ù‡Ù…Ù„Ø§Øª: ${n.message}`,"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ù‚Ù„")}finally{v(!1)}},W=t=>{const n=new Date,s=t.submissionDeadline||t.deadline||t.submissionDate||t.endDate;if(t.status==="opened"||t.envelopesOpened===!0)return e.jsxs("div",{className:"d-flex flex-column gap-1 align-items-center",children:[e.jsx("span",{className:"badge bg-info text-white",style:{fontSize:"11px",padding:"4px 8px"},children:"ØªÙ… ÙØªØ­ Ø§Ù„Ù…Ø¸Ø§Ø±ÙŠÙ"}),e.jsxs("button",{className:"btn btn-sm btn-outline-primary",style:{fontSize:"10px",padding:"2px 8px",cursor:"pointer",border:"1px solid #007bff"},onClick:j=>{j.stopPropagation(),d(`/tender-result?tenderId=${t.id}`)},children:[e.jsx("i",{className:"bi bi-trophy me-1"}),"Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬"]})]});if(!s)return e.jsx("span",{className:"badge bg-secondary",children:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"});let a=s;if(s&&typeof s=="object"&&s.seconds?a=new Date(s.seconds*1e3):s&&typeof s=="object"&&s.toDate?a=s.toDate():a=new Date(s),isNaN(a.getTime()))return e.jsx("span",{className:"badge bg-secondary",children:"ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ­ÙŠØ­"});const i=a.getTime()-n.getTime(),l=Math.ceil(i/(1e3*3600*24));if(l<0)return e.jsxs("div",{className:"d-flex flex-column gap-1 align-items-center",children:[e.jsx("span",{className:"badge bg-danger text-white",style:{fontSize:"11px",padding:"4px 8px"},children:"Ù…ØºÙ„Ù‚Ø© Ù„Ù„ØªÙ‚Ø¯ÙŠÙ…"}),e.jsxs("button",{className:"btn btn-sm btn-outline-info",style:{fontSize:"10px",padding:"2px 8px",cursor:"pointer",border:"1px solid #17a2b8"},onClick:async j=>{j.stopPropagation();try{await N.updateTender(t.id,{status:"opened",envelopesOpened:!0}),await u(),S('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ© Ø¥Ù„Ù‰ "ØªÙ… ÙØªØ­ Ø§Ù„Ù…Ø¸Ø§Ø±ÙŠÙ"')}catch(q){console.error("Error updating tender status:",q),h("ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ©")}},children:[e.jsx("i",{className:"bi bi-envelope-open me-1"}),"ÙØªØ­ Ø§Ù„Ù…Ø¸Ø§Ø±ÙŠÙ"]})]});let f="",F="text-white";return l>=6?f="bg-success":l>=3?(f="bg-warning",F="text-dark"):f="bg-danger",e.jsx("span",{className:`badge ${f} ${F}`,style:{fontSize:"12px",padding:"4px 8px"},children:l===1?"Ù…ØªØ¨Ù‚ÙŠ ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯":l===2?"Ù…ØªØ¨Ù‚ÙŠ ÙŠÙˆÙ…Ø§Ù†":`Ù…ØªØ¨Ù‚ÙŠ ${l} ÙŠÙˆÙ…`})};return w?(console.log("TendersListFixed: Showing loading state"),e.jsx("div",{className:"card shadow-sm",children:e.jsxs("div",{className:"card-body text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„..."})}),e.jsx("p",{className:"mt-3 text-muted",children:"Ø¬Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ§Øª..."})]})})):g?(console.log("TendersListFixed: Showing error state:",g),e.jsx("div",{className:"card shadow-sm",children:e.jsxs("div",{className:"card-body text-center py-5",children:[e.jsx("div",{className:"text-danger mb-3",children:e.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),e.jsx("h5",{className:"text-danger",children:"Ø­Ø¯Ø« Ø®Ø·Ø£"}),e.jsx("p",{className:"text-muted",children:g}),e.jsx("div",{className:"d-flex gap-2 justify-content-center",children:e.jsxs("button",{className:"btn btn-primary",onClick:u,children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"]})})]})})):(console.log("TendersListFixed: Showing main content with",p.length,"tenders"),e.jsxs("div",{"data-list":"tenders",children:[p.length===0?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"text-muted mb-3",children:e.jsx("i",{className:"bi bi-clipboard-check fs-1"})}),e.jsx("h5",{className:"text-muted",children:"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†Ø§Ù‚ØµØ§Øª"}),e.jsx("p",{className:"text-muted",children:r?"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø­Ø¯Ø¯":"Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ù†Ø§Ù‚ØµØ§Øª Ø¨Ø¹Ø¯"}),!r&&e.jsxs("button",{className:"btn btn-primary",onClick:()=>d("/tenders/add"),children:[e.jsx("i",{className:"bi bi-plus-lg me-1"}),"Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ù…Ù†Ø§Ù‚ØµØ©"]})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),e.jsx("th",{className:"text-center",children:"Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ©"}),e.jsx("th",{className:"text-center",children:"Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©"}),e.jsx("th",{className:"text-center",children:"Ø³Ø¹Ø± ÙƒØ±Ø§Ø³Ø© Ø§Ù„Ø´Ø±ÙˆØ·"}),e.jsx("th",{className:"text-center",children:"Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ©"}),e.jsx("th",{className:"text-center",children:"Ù…ÙˆØ¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…"}),e.jsx("th",{className:"text-center",children:"Ø§Ù„Ø­Ø§Ù„Ø©"}),e.jsx("th",{className:"text-center",style:{width:"120px",paddingLeft:"40px"},children:"Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª"})]})}),e.jsx("tbody",{children:U.map((t,n)=>e.jsxs("tr",{style:{height:"52px"},children:[e.jsx("td",{className:"text-center align-middle",children:e.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(L-1)*E+n+1})}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",onClick:()=>{t.id&&d(`/tenders/edit/${t.id}`)},style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer",fontSize:"inherit"},title:"Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ©",children:t.entity})}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("span",{className:"badge bg-success text-white",children:(()=>{t.entity&&t.entity.includes("Ø£Ù…Ø§Ù†Ø© Ø­Ø§ÙŠÙ„")&&(console.log("ðŸ” Ø£Ù…Ø§Ù†Ø© Ø­Ø§ÙŠÙ„ DEBUG:"),console.log("Raw estimatedValue:",t.estimatedValue),console.log("Type:",typeof t.estimatedValue),console.log("All tender fields:",Object.keys(t)),console.log("Full tender data:",t));let s=t.estimatedValue;return typeof s=="string"&&(s=parseFloat(s)),(isNaN(s)||s==null)&&(s=0),`${s.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})} Ø±.Ø³`})()})}),e.jsx("td",{className:"text-center align-middle",children:t.documentPrice&&t.documentPrice>0?e.jsxs("span",{className:"badge bg-info text-white",style:{fontSize:"11px",padding:"4px 8px"},children:[t.documentPrice," Ø±.Ø³"]}):e.jsx("span",{className:"badge bg-secondary",style:{fontSize:"11px",padding:"4px 8px"},children:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"})}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary tender-title-btn",onClick:()=>{t.id?d(`/tenders/edit/${t.id}`):h("Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ© Ù…ÙÙ‚ÙˆØ¯ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªÙ†Ù‚Ù„","Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ†Ù‚Ù„")},style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0"},title:`Ø§Ù†Ù‚Ø± Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ© | Firebase ID: ${t.id||"Missing"}`,children:t.title})}),e.jsx("td",{className:"text-center align-middle",children:(()=>{const s=["submissionDeadline","deadline","submissionDate","endDate","dueDate","closingDate","applicationDeadline","tenderDeadline","date","ØªØ§Ø±ÙŠØ®_Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡","Ù…ÙˆØ¹Ø¯_Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡"];let a=null;for(const i of s)t[i]&&(a||(a=t[i]));if(Object.keys(t).forEach(i=>{(i.toLowerCase().includes("date")||i.toLowerCase().includes("deadline"))&&!a&&t[i]&&(a=t[i])}),a){let i=a;return a&&typeof a=="object"&&a.seconds?i=new Date(a.seconds*1e3):a&&typeof a=="object"&&a.toDate&&(i=a.toDate()),G(i)||"ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ­ÙŠØ­"}else return"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"})()}),e.jsx("td",{className:"text-center align-middle",children:W(t)}),e.jsx("td",{className:"text-center",style:{paddingLeft:"40px"},children:e.jsxs("div",{className:"btn-group btn-group-sm",children:[e.jsx(P,{can:"tenders:update",mode:"disable",children:e.jsx("button",{className:"btn btn-outline-primary",onClick:()=>{if(!t||!t.id){h("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø© Ø£Ùˆ Ù…ÙÙ‚ÙˆØ¯Ø©","Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");return}d(`/tenders/edit/${t.id}`)},title:"ØªØ¹Ø¯ÙŠÙ„",children:e.jsx("i",{className:"bi bi-pencil"})})}),e.jsx(P,{can:"tenders:delete",mode:"disable",children:e.jsx("button",{className:"btn btn-outline-danger",onClick:()=>M(t),title:"Ø­Ø°Ù",children:e.jsx("i",{className:"bi bi-trash"})})})]})})]},t.internalId||t.id||`tender-${n}`))})]})}),p.length>0&&e.jsx(Z,{currentPage:L,totalPages:V,onPageChange:B,totalItems:R,itemsPerPage:E}),e.jsx(ee,{show:c.show,onClose:z,title:c.title,message:c.message,type:c.type,onConfirm:c.onConfirm,showConfirm:c.showConfirm})]}))},re=({refreshTrigger:b,searchTerm:m})=>(console.log("TendersList wrapper is rendering - delegating to TendersListFixed"),e.jsx(ae,{refreshTrigger:b,searchTerm:m}));export{re as default};
