(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(a){if(a.ep)return;a.ep=!0;const l=t(a);fetch(a.href,l)}})();function GE(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var sb={exports:{}},Sm={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yj;function yA(){if(yj)return Sm;yj=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,a,l){var c=null;if(l!==void 0&&(c=""+l),a.key!==void 0&&(c=""+a.key),"key"in a){l={};for(var u in a)u!=="key"&&(l[u]=a[u])}else l=a;return a=l.ref,{$$typeof:r,type:s,key:c,ref:a!==void 0?a:null,props:l}}return Sm.Fragment=e,Sm.jsx=t,Sm.jsxs=t,Sm}var bj;function bA(){return bj||(bj=1,sb.exports=yA()),sb.exports}var n=bA(),rb={exports:{}},Yt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wj;function wA(){if(wj)return Yt;wj=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),b=Symbol.for("react.lazy"),w=Symbol.iterator;function N(_){return _===null||typeof _!="object"?null:(_=w&&_[w]||_["@@iterator"],typeof _=="function"?_:null)}var R={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},O=Object.assign,G={};function U(_,E,D){this.props=_,this.context=E,this.refs=G,this.updater=D||R}U.prototype.isReactComponent={},U.prototype.setState=function(_,E){if(typeof _!="object"&&typeof _!="function"&&_!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,_,E,"setState")},U.prototype.forceUpdate=function(_){this.updater.enqueueForceUpdate(this,_,"forceUpdate")};function T(){}T.prototype=U.prototype;function ee(_,E,D){this.props=_,this.context=E,this.refs=G,this.updater=D||R}var Z=ee.prototype=new T;Z.constructor=ee,O(Z,U.prototype),Z.isPureReactComponent=!0;var ie=Array.isArray,X={H:null,A:null,T:null,S:null,V:null},pe=Object.prototype.hasOwnProperty;function H(_,E,D,F,te,$){return D=$.ref,{$$typeof:r,type:_,key:E,ref:D!==void 0?D:null,props:$}}function B(_,E){return H(_.type,E,void 0,void 0,void 0,_.props)}function k(_){return typeof _=="object"&&_!==null&&_.$$typeof===r}function W(_){var E={"=":"=0",":":"=2"};return"$"+_.replace(/[=:]/g,function(D){return E[D]})}var J=/\/+/g;function z(_,E){return typeof _=="object"&&_!==null&&_.key!=null?W(""+_.key):E.toString(36)}function L(){}function de(_){switch(_.status){case"fulfilled":return _.value;case"rejected":throw _.reason;default:switch(typeof _.status=="string"?_.then(L,L):(_.status="pending",_.then(function(E){_.status==="pending"&&(_.status="fulfilled",_.value=E)},function(E){_.status==="pending"&&(_.status="rejected",_.reason=E)})),_.status){case"fulfilled":return _.value;case"rejected":throw _.reason}}throw _}function Pe(_,E,D,F,te){var $=typeof _;($==="undefined"||$==="boolean")&&(_=null);var Q=!1;if(_===null)Q=!0;else switch($){case"bigint":case"string":case"number":Q=!0;break;case"object":switch(_.$$typeof){case r:case e:Q=!0;break;case b:return Q=_._init,Pe(Q(_._payload),E,D,F,te)}}if(Q)return te=te(_),Q=F===""?"."+z(_,0):F,ie(te)?(D="",Q!=null&&(D=Q.replace(J,"$&/")+"/"),Pe(te,E,D,"",function(le){return le})):te!=null&&(k(te)&&(te=B(te,D+(te.key==null||_&&_.key===te.key?"":(""+te.key).replace(J,"$&/")+"/")+Q)),E.push(te)),1;Q=0;var me=F===""?".":F+":";if(ie(_))for(var I=0;I<_.length;I++)F=_[I],$=me+z(F,I),Q+=Pe(F,E,D,$,te);else if(I=N(_),typeof I=="function")for(_=I.call(_),I=0;!(F=_.next()).done;)F=F.value,$=me+z(F,I++),Q+=Pe(F,E,D,$,te);else if($==="object"){if(typeof _.then=="function")return Pe(de(_),E,D,F,te);throw E=String(_),Error("Objects are not valid as a React child (found: "+(E==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":E)+"). If you meant to render a collection of children, use an array instead.")}return Q}function V(_,E,D){if(_==null)return _;var F=[],te=0;return Pe(_,F,"","",function($){return E.call(D,$,te++)}),F}function se(_){if(_._status===-1){var E=_._result;E=E(),E.then(function(D){(_._status===0||_._status===-1)&&(_._status=1,_._result=D)},function(D){(_._status===0||_._status===-1)&&(_._status=2,_._result=D)}),_._status===-1&&(_._status=0,_._result=E)}if(_._status===1)return _._result.default;throw _._result}var fe=typeof reportError=="function"?reportError:function(_){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var E=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof _=="object"&&_!==null&&typeof _.message=="string"?String(_.message):String(_),error:_});if(!window.dispatchEvent(E))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",_);return}console.error(_)};function re(){}return Yt.Children={map:V,forEach:function(_,E,D){V(_,function(){E.apply(this,arguments)},D)},count:function(_){var E=0;return V(_,function(){E++}),E},toArray:function(_){return V(_,function(E){return E})||[]},only:function(_){if(!k(_))throw Error("React.Children.only expected to receive a single React element child.");return _}},Yt.Component=U,Yt.Fragment=t,Yt.Profiler=a,Yt.PureComponent=ee,Yt.StrictMode=s,Yt.Suspense=m,Yt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=X,Yt.__COMPILER_RUNTIME={__proto__:null,c:function(_){return X.H.useMemoCache(_)}},Yt.cache=function(_){return function(){return _.apply(null,arguments)}},Yt.cloneElement=function(_,E,D){if(_==null)throw Error("The argument must be a React element, but you passed "+_+".");var F=O({},_.props),te=_.key,$=void 0;if(E!=null)for(Q in E.ref!==void 0&&($=void 0),E.key!==void 0&&(te=""+E.key),E)!pe.call(E,Q)||Q==="key"||Q==="__self"||Q==="__source"||Q==="ref"&&E.ref===void 0||(F[Q]=E[Q]);var Q=arguments.length-2;if(Q===1)F.children=D;else if(1<Q){for(var me=Array(Q),I=0;I<Q;I++)me[I]=arguments[I+2];F.children=me}return H(_.type,te,void 0,void 0,$,F)},Yt.createContext=function(_){return _={$$typeof:c,_currentValue:_,_currentValue2:_,_threadCount:0,Provider:null,Consumer:null},_.Provider=_,_.Consumer={$$typeof:l,_context:_},_},Yt.createElement=function(_,E,D){var F,te={},$=null;if(E!=null)for(F in E.key!==void 0&&($=""+E.key),E)pe.call(E,F)&&F!=="key"&&F!=="__self"&&F!=="__source"&&(te[F]=E[F]);var Q=arguments.length-2;if(Q===1)te.children=D;else if(1<Q){for(var me=Array(Q),I=0;I<Q;I++)me[I]=arguments[I+2];te.children=me}if(_&&_.defaultProps)for(F in Q=_.defaultProps,Q)te[F]===void 0&&(te[F]=Q[F]);return H(_,$,void 0,void 0,null,te)},Yt.createRef=function(){return{current:null}},Yt.forwardRef=function(_){return{$$typeof:u,render:_}},Yt.isValidElement=k,Yt.lazy=function(_){return{$$typeof:b,_payload:{_status:-1,_result:_},_init:se}},Yt.memo=function(_,E){return{$$typeof:p,type:_,compare:E===void 0?null:E}},Yt.startTransition=function(_){var E=X.T,D={};X.T=D;try{var F=_(),te=X.S;te!==null&&te(D,F),typeof F=="object"&&F!==null&&typeof F.then=="function"&&F.then(re,fe)}catch($){fe($)}finally{X.T=E}},Yt.unstable_useCacheRefresh=function(){return X.H.useCacheRefresh()},Yt.use=function(_){return X.H.use(_)},Yt.useActionState=function(_,E,D){return X.H.useActionState(_,E,D)},Yt.useCallback=function(_,E){return X.H.useCallback(_,E)},Yt.useContext=function(_){return X.H.useContext(_)},Yt.useDebugValue=function(){},Yt.useDeferredValue=function(_,E){return X.H.useDeferredValue(_,E)},Yt.useEffect=function(_,E,D){var F=X.H;if(typeof D=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return F.useEffect(_,E)},Yt.useId=function(){return X.H.useId()},Yt.useImperativeHandle=function(_,E,D){return X.H.useImperativeHandle(_,E,D)},Yt.useInsertionEffect=function(_,E){return X.H.useInsertionEffect(_,E)},Yt.useLayoutEffect=function(_,E){return X.H.useLayoutEffect(_,E)},Yt.useMemo=function(_,E){return X.H.useMemo(_,E)},Yt.useOptimistic=function(_,E){return X.H.useOptimistic(_,E)},Yt.useReducer=function(_,E,D){return X.H.useReducer(_,E,D)},Yt.useRef=function(_){return X.H.useRef(_)},Yt.useState=function(_){return X.H.useState(_)},Yt.useSyncExternalStore=function(_,E,D){return X.H.useSyncExternalStore(_,E,D)},Yt.useTransition=function(){return X.H.useTransition()},Yt.version="19.1.0",Yt}var vj;function _0(){return vj||(vj=1,rb.exports=wA()),rb.exports}var j=_0();const QE=GE(j);var ib={exports:{}},Im={},ab={exports:{}},ob={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nj;function vA(){return Nj||(Nj=1,function(r){function e(V,se){var fe=V.length;V.push(se);e:for(;0<fe;){var re=fe-1>>>1,_=V[re];if(0<a(_,se))V[re]=se,V[fe]=_,fe=re;else break e}}function t(V){return V.length===0?null:V[0]}function s(V){if(V.length===0)return null;var se=V[0],fe=V.pop();if(fe!==se){V[0]=fe;e:for(var re=0,_=V.length,E=_>>>1;re<E;){var D=2*(re+1)-1,F=V[D],te=D+1,$=V[te];if(0>a(F,fe))te<_&&0>a($,F)?(V[re]=$,V[te]=fe,re=te):(V[re]=F,V[D]=fe,re=D);else if(te<_&&0>a($,fe))V[re]=$,V[te]=fe,re=te;else break e}}return se}function a(V,se){var fe=V.sortIndex-se.sortIndex;return fe!==0?fe:V.id-se.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;r.unstable_now=function(){return l.now()}}else{var c=Date,u=c.now();r.unstable_now=function(){return c.now()-u}}var m=[],p=[],b=1,w=null,N=3,R=!1,O=!1,G=!1,U=!1,T=typeof setTimeout=="function"?setTimeout:null,ee=typeof clearTimeout=="function"?clearTimeout:null,Z=typeof setImmediate<"u"?setImmediate:null;function ie(V){for(var se=t(p);se!==null;){if(se.callback===null)s(p);else if(se.startTime<=V)s(p),se.sortIndex=se.expirationTime,e(m,se);else break;se=t(p)}}function X(V){if(G=!1,ie(V),!O)if(t(m)!==null)O=!0,pe||(pe=!0,z());else{var se=t(p);se!==null&&Pe(X,se.startTime-V)}}var pe=!1,H=-1,B=5,k=-1;function W(){return U?!0:!(r.unstable_now()-k<B)}function J(){if(U=!1,pe){var V=r.unstable_now();k=V;var se=!0;try{e:{O=!1,G&&(G=!1,ee(H),H=-1),R=!0;var fe=N;try{t:{for(ie(V),w=t(m);w!==null&&!(w.expirationTime>V&&W());){var re=w.callback;if(typeof re=="function"){w.callback=null,N=w.priorityLevel;var _=re(w.expirationTime<=V);if(V=r.unstable_now(),typeof _=="function"){w.callback=_,ie(V),se=!0;break t}w===t(m)&&s(m),ie(V)}else s(m);w=t(m)}if(w!==null)se=!0;else{var E=t(p);E!==null&&Pe(X,E.startTime-V),se=!1}}break e}finally{w=null,N=fe,R=!1}se=void 0}}finally{se?z():pe=!1}}}var z;if(typeof Z=="function")z=function(){Z(J)};else if(typeof MessageChannel<"u"){var L=new MessageChannel,de=L.port2;L.port1.onmessage=J,z=function(){de.postMessage(null)}}else z=function(){T(J,0)};function Pe(V,se){H=T(function(){V(r.unstable_now())},se)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(V){V.callback=null},r.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<V?Math.floor(1e3/V):5},r.unstable_getCurrentPriorityLevel=function(){return N},r.unstable_next=function(V){switch(N){case 1:case 2:case 3:var se=3;break;default:se=N}var fe=N;N=se;try{return V()}finally{N=fe}},r.unstable_requestPaint=function(){U=!0},r.unstable_runWithPriority=function(V,se){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var fe=N;N=V;try{return se()}finally{N=fe}},r.unstable_scheduleCallback=function(V,se,fe){var re=r.unstable_now();switch(typeof fe=="object"&&fe!==null?(fe=fe.delay,fe=typeof fe=="number"&&0<fe?re+fe:re):fe=re,V){case 1:var _=-1;break;case 2:_=250;break;case 5:_=1073741823;break;case 4:_=1e4;break;default:_=5e3}return _=fe+_,V={id:b++,callback:se,priorityLevel:V,startTime:fe,expirationTime:_,sortIndex:-1},fe>re?(V.sortIndex=fe,e(p,V),t(m)===null&&V===t(p)&&(G?(ee(H),H=-1):G=!0,Pe(X,fe-re))):(V.sortIndex=_,e(m,V),O||R||(O=!0,pe||(pe=!0,z()))),V},r.unstable_shouldYield=W,r.unstable_wrapCallback=function(V){var se=N;return function(){var fe=N;N=se;try{return V.apply(this,arguments)}finally{N=fe}}}}(ob)),ob}var jj;function NA(){return jj||(jj=1,ab.exports=vA()),ab.exports}var lb={exports:{}},Dr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _j;function jA(){if(_j)return Dr;_j=1;var r=_0();function e(m){var p="https://react.dev/errors/"+m;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var b=2;b<arguments.length;b++)p+="&args[]="+encodeURIComponent(arguments[b])}return"Minified React error #"+m+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},a=Symbol.for("react.portal");function l(m,p,b){var w=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:w==null?null:""+w,children:m,containerInfo:p,implementation:b}}var c=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(m,p){if(m==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return Dr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Dr.createPortal=function(m,p){var b=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(e(299));return l(m,p,null,b)},Dr.flushSync=function(m){var p=c.T,b=s.p;try{if(c.T=null,s.p=2,m)return m()}finally{c.T=p,s.p=b,s.d.f()}},Dr.preconnect=function(m,p){typeof m=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,s.d.C(m,p))},Dr.prefetchDNS=function(m){typeof m=="string"&&s.d.D(m)},Dr.preinit=function(m,p){if(typeof m=="string"&&p&&typeof p.as=="string"){var b=p.as,w=u(b,p.crossOrigin),N=typeof p.integrity=="string"?p.integrity:void 0,R=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;b==="style"?s.d.S(m,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:w,integrity:N,fetchPriority:R}):b==="script"&&s.d.X(m,{crossOrigin:w,integrity:N,fetchPriority:R,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},Dr.preinitModule=function(m,p){if(typeof m=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var b=u(p.as,p.crossOrigin);s.d.M(m,{crossOrigin:b,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&s.d.M(m)},Dr.preload=function(m,p){if(typeof m=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var b=p.as,w=u(b,p.crossOrigin);s.d.L(m,b,{crossOrigin:w,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},Dr.preloadModule=function(m,p){if(typeof m=="string")if(p){var b=u(p.as,p.crossOrigin);s.d.m(m,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:b,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else s.d.m(m)},Dr.requestFormReset=function(m){s.d.r(m)},Dr.unstable_batchedUpdates=function(m,p){return m(p)},Dr.useFormState=function(m,p,b){return c.H.useFormState(m,p,b)},Dr.useFormStatus=function(){return c.H.useHostTransitionStatus()},Dr.version="19.1.0",Dr}var Ej;function _A(){if(Ej)return lb.exports;Ej=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),lb.exports=jA(),lb.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sj;function EA(){if(Sj)return Im;Sj=1;var r=NA(),e=_0(),t=_A();function s(i){var o="https://react.dev/errors/"+i;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)o+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+i+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function l(i){var o=i,d=i;if(i.alternate)for(;o.return;)o=o.return;else{i=o;do o=i,(o.flags&4098)!==0&&(d=o.return),i=o.return;while(i)}return o.tag===3?d:null}function c(i){if(i.tag===13){var o=i.memoizedState;if(o===null&&(i=i.alternate,i!==null&&(o=i.memoizedState)),o!==null)return o.dehydrated}return null}function u(i){if(l(i)!==i)throw Error(s(188))}function m(i){var o=i.alternate;if(!o){if(o=l(i),o===null)throw Error(s(188));return o!==i?null:i}for(var d=i,h=o;;){var g=d.return;if(g===null)break;var y=g.alternate;if(y===null){if(h=g.return,h!==null){d=h;continue}break}if(g.child===y.child){for(y=g.child;y;){if(y===d)return u(g),i;if(y===h)return u(g),o;y=y.sibling}throw Error(s(188))}if(d.return!==h.return)d=g,h=y;else{for(var P=!1,q=g.child;q;){if(q===d){P=!0,d=g,h=y;break}if(q===h){P=!0,h=g,d=y;break}q=q.sibling}if(!P){for(q=y.child;q;){if(q===d){P=!0,d=y,h=g;break}if(q===h){P=!0,h=y,d=g;break}q=q.sibling}if(!P)throw Error(s(189))}}if(d.alternate!==h)throw Error(s(190))}if(d.tag!==3)throw Error(s(188));return d.stateNode.current===d?i:o}function p(i){var o=i.tag;if(o===5||o===26||o===27||o===6)return i;for(i=i.child;i!==null;){if(o=p(i),o!==null)return o;i=i.sibling}return null}var b=Object.assign,w=Symbol.for("react.element"),N=Symbol.for("react.transitional.element"),R=Symbol.for("react.portal"),O=Symbol.for("react.fragment"),G=Symbol.for("react.strict_mode"),U=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),ee=Symbol.for("react.consumer"),Z=Symbol.for("react.context"),ie=Symbol.for("react.forward_ref"),X=Symbol.for("react.suspense"),pe=Symbol.for("react.suspense_list"),H=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),k=Symbol.for("react.activity"),W=Symbol.for("react.memo_cache_sentinel"),J=Symbol.iterator;function z(i){return i===null||typeof i!="object"?null:(i=J&&i[J]||i["@@iterator"],typeof i=="function"?i:null)}var L=Symbol.for("react.client.reference");function de(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===L?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case O:return"Fragment";case U:return"Profiler";case G:return"StrictMode";case X:return"Suspense";case pe:return"SuspenseList";case k:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case R:return"Portal";case Z:return(i.displayName||"Context")+".Provider";case ee:return(i._context.displayName||"Context")+".Consumer";case ie:var o=i.render;return i=i.displayName,i||(i=o.displayName||o.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case H:return o=i.displayName||null,o!==null?o:de(i.type)||"Memo";case B:o=i._payload,i=i._init;try{return de(i(o))}catch{}}return null}var Pe=Array.isArray,V=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,fe={pending:!1,data:null,method:null,action:null},re=[],_=-1;function E(i){return{current:i}}function D(i){0>_||(i.current=re[_],re[_]=null,_--)}function F(i,o){_++,re[_]=i.current,i.current=o}var te=E(null),$=E(null),Q=E(null),me=E(null);function I(i,o){switch(F(Q,o),F($,i),F(te,null),o.nodeType){case 9:case 11:i=(i=o.documentElement)&&(i=i.namespaceURI)?GN(i):0;break;default:if(i=o.tagName,o=o.namespaceURI)o=GN(o),i=QN(o,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}D(te),F(te,i)}function le(){D(te),D($),D(Q)}function We(i){i.memoizedState!==null&&F(me,i);var o=te.current,d=QN(o,i.type);o!==d&&(F($,i),F(te,d))}function nt(i){$.current===i&&(D(te),D($)),me.current===i&&(D(me),vm._currentValue=fe)}var mt=Object.prototype.hasOwnProperty,It=r.unstable_scheduleCallback,rn=r.unstable_cancelCallback,oe=r.unstable_shouldYield,Ue=r.unstable_requestPaint,Je=r.unstable_now,lt=r.unstable_getCurrentPriorityLevel,Dt=r.unstable_ImmediatePriority,Ht=r.unstable_UserBlockingPriority,Ze=r.unstable_NormalPriority,Vt=r.unstable_LowPriority,Xt=r.unstable_IdlePriority,ts=r.log,ns=r.unstable_setDisableYieldValue,mn=null,Kt=null;function En(i){if(typeof ts=="function"&&ns(i),Kt&&typeof Kt.setStrictMode=="function")try{Kt.setStrictMode(mn,i)}catch{}}var C=Math.clz32?Math.clz32:ce,ne=Math.log,ue=Math.LN2;function ce(i){return i>>>=0,i===0?32:31-(ne(i)/ue|0)|0}var ye=256,Le=4194304;function Nt(i){var o=i&42;if(o!==0)return o;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function yt(i,o,d){var h=i.pendingLanes;if(h===0)return 0;var g=0,y=i.suspendedLanes,P=i.pingedLanes;i=i.warmLanes;var q=h&134217727;return q!==0?(h=q&~y,h!==0?g=Nt(h):(P&=q,P!==0?g=Nt(P):d||(d=q&~i,d!==0&&(g=Nt(d))))):(q=h&~y,q!==0?g=Nt(q):P!==0?g=Nt(P):d||(d=h&~i,d!==0&&(g=Nt(d)))),g===0?0:o!==0&&o!==g&&(o&y)===0&&(y=g&-g,d=o&-o,y>=d||y===32&&(d&4194048)!==0)?o:g}function $s(i,o){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&o)===0}function _e(i,o){switch(i){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Xe(){var i=ye;return ye<<=1,(ye&4194048)===0&&(ye=256),i}function Be(){var i=Le;return Le<<=1,(Le&62914560)===0&&(Le=4194304),i}function he(i){for(var o=[],d=0;31>d;d++)o.push(i);return o}function be(i,o){i.pendingLanes|=o,o!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function De(i,o,d,h,g,y){var P=i.pendingLanes;i.pendingLanes=d,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=d,i.entangledLanes&=d,i.errorRecoveryDisabledLanes&=d,i.shellSuspendCounter=0;var q=i.entanglements,ae=i.expirationTimes,Te=i.hiddenUpdates;for(d=P&~d;0<d;){var qe=31-C(d),Qe=1<<qe;q[qe]=0,ae[qe]=-1;var Ae=Te[qe];if(Ae!==null)for(Te[qe]=null,qe=0;qe<Ae.length;qe++){var Re=Ae[qe];Re!==null&&(Re.lane&=-536870913)}d&=~Qe}h!==0&&ve(i,h,0),y!==0&&g===0&&i.tag!==0&&(i.suspendedLanes|=y&~(P&~o))}function ve(i,o,d){i.pendingLanes|=o,i.suspendedLanes&=~o;var h=31-C(o);i.entangledLanes|=o,i.entanglements[h]=i.entanglements[h]|1073741824|d&4194090}function ze(i,o){var d=i.entangledLanes|=o;for(i=i.entanglements;d;){var h=31-C(d),g=1<<h;g&o|i[h]&o&&(i[h]|=o),d&=~g}}function $e(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function Ke(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function we(){var i=se.p;return i!==0?i:(i=window.event,i===void 0?32:hj(i.type))}function et(i,o){var d=se.p;try{return se.p=i,o()}finally{se.p=d}}var ke=Math.random().toString(36).slice(2),Ve="__reactFiber$"+ke,Tt="__reactProps$"+ke,ft="__reactContainer$"+ke,pt="__reactEvents$"+ke,ls="__reactListeners$"+ke,Ns="__reactHandles$"+ke,Hr="__reactResources$"+ke,Ai="__reactMarker$"+ke;function Na(i){delete i[Ve],delete i[Tt],delete i[pt],delete i[ls],delete i[Ns]}function li(i){var o=i[Ve];if(o)return o;for(var d=i.parentNode;d;){if(o=d[ft]||d[Ve]){if(d=o.alternate,o.child!==null||d!==null&&d.child!==null)for(i=XN(i);i!==null;){if(d=i[Ve])return d;i=XN(i)}return o}i=d,d=i.parentNode}return null}function Di(i){if(i=i[Ve]||i[ft]){var o=i.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return i}return null}function Ri(i){var o=i.tag;if(o===5||o===26||o===27||o===6)return i.stateNode;throw Error(s(33))}function gs(i){var o=i[Hr];return o||(o=i[Hr]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function en(i){i[Ai]=!0}var Bs=new Set,ks={};function $n(i,o){Gr(i,o),Gr(i+"Capture",o)}function Gr(i,o){for(ks[i]=o,i=0;i<o.length;i++)Bs.add(o[i])}var ta=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Pi={},Qr={};function Ec(i){return mt.call(Qr,i)?!0:mt.call(Pi,i)?!1:ta.test(i)?Qr[i]=!0:(Pi[i]=!0,!1)}function ki(i,o,d){if(Ec(o))if(d===null)i.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":i.removeAttribute(o);return;case"boolean":var h=o.toLowerCase().slice(0,5);if(h!=="data-"&&h!=="aria-"){i.removeAttribute(o);return}}i.setAttribute(o,""+d)}}function ur(i,o,d){if(d===null)i.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(o);return}i.setAttribute(o,""+d)}}function Os(i,o,d,h){if(h===null)i.removeAttribute(d);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(d);return}i.setAttributeNS(o,d,""+h)}}var na,hl;function Oi(i){if(na===void 0)try{throw Error()}catch(d){var o=d.stack.trim().match(/\n( *(at )?)/);na=o&&o[1]||"",hl=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+na+i+hl}var lo=!1;function co(i,o){if(!i||lo)return"";lo=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var h={DetermineComponentFrameRoot:function(){try{if(o){var Qe=function(){throw Error()};if(Object.defineProperty(Qe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Qe,[])}catch(Re){var Ae=Re}Reflect.construct(i,[],Qe)}else{try{Qe.call()}catch(Re){Ae=Re}i.call(Qe.prototype)}}else{try{throw Error()}catch(Re){Ae=Re}(Qe=i())&&typeof Qe.catch=="function"&&Qe.catch(function(){})}}catch(Re){if(Re&&Ae&&typeof Re.stack=="string")return[Re.stack,Ae.stack]}return[null,null]}};h.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(h.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(h.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=h.DetermineComponentFrameRoot(),P=y[0],q=y[1];if(P&&q){var ae=P.split(`
`),Te=q.split(`
`);for(g=h=0;h<ae.length&&!ae[h].includes("DetermineComponentFrameRoot");)h++;for(;g<Te.length&&!Te[g].includes("DetermineComponentFrameRoot");)g++;if(h===ae.length||g===Te.length)for(h=ae.length-1,g=Te.length-1;1<=h&&0<=g&&ae[h]!==Te[g];)g--;for(;1<=h&&0<=g;h--,g--)if(ae[h]!==Te[g]){if(h!==1||g!==1)do if(h--,g--,0>g||ae[h]!==Te[g]){var qe=`
`+ae[h].replace(" at new "," at ");return i.displayName&&qe.includes("<anonymous>")&&(qe=qe.replace("<anonymous>",i.displayName)),qe}while(1<=h&&0<=g);break}}}finally{lo=!1,Error.prepareStackTrace=d}return(d=i?i.displayName||i.name:"")?Oi(d):""}function ml(i){switch(i.tag){case 26:case 27:case 5:return Oi(i.type);case 16:return Oi("Lazy");case 13:return Oi("Suspense");case 19:return Oi("SuspenseList");case 0:case 15:return co(i.type,!1);case 11:return co(i.type.render,!1);case 1:return co(i.type,!0);case 31:return Oi("Activity");default:return""}}function uo(i){try{var o="";do o+=ml(i),i=i.return;while(i);return o}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}function nr(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function fl(i){var o=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Dd(i){var o=fl(i)?"checked":"value",d=Object.getOwnPropertyDescriptor(i.constructor.prototype,o),h=""+i[o];if(!i.hasOwnProperty(o)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var g=d.get,y=d.set;return Object.defineProperty(i,o,{configurable:!0,get:function(){return g.call(this)},set:function(P){h=""+P,y.call(this,P)}}),Object.defineProperty(i,o,{enumerable:d.enumerable}),{getValue:function(){return h},setValue:function(P){h=""+P},stopTracking:function(){i._valueTracker=null,delete i[o]}}}}function ho(i){i._valueTracker||(i._valueTracker=Dd(i))}function pl(i){if(!i)return!1;var o=i._valueTracker;if(!o)return!0;var d=o.getValue(),h="";return i&&(h=fl(i)?i.checked?"true":"false":i.value),i=h,i!==d?(o.setValue(i),!0):!1}function sr(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var hr=/[\n"\\]/g;function Ln(i){return i.replace(hr,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Gn(i,o,d,h,g,y,P,q){i.name="",P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"?i.type=P:i.removeAttribute("type"),o!=null?P==="number"?(o===0&&i.value===""||i.value!=o)&&(i.value=""+nr(o)):i.value!==""+nr(o)&&(i.value=""+nr(o)):P!=="submit"&&P!=="reset"||i.removeAttribute("value"),o!=null?Mi(i,P,nr(o)):d!=null?Mi(i,P,nr(d)):h!=null&&i.removeAttribute("value"),g==null&&y!=null&&(i.defaultChecked=!!y),g!=null&&(i.checked=g&&typeof g!="function"&&typeof g!="symbol"),q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"?i.name=""+nr(q):i.removeAttribute("name")}function sa(i,o,d,h,g,y,P,q){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(i.type=y),o!=null||d!=null){if(!(y!=="submit"&&y!=="reset"||o!=null))return;d=d!=null?""+nr(d):"",o=o!=null?""+nr(o):d,q||o===i.value||(i.value=o),i.defaultValue=o}h=h??g,h=typeof h!="function"&&typeof h!="symbol"&&!!h,i.checked=q?i.checked:!!h,i.defaultChecked=!!h,P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"&&(i.name=P)}function Mi(i,o,d){o==="number"&&sr(i.ownerDocument)===i||i.defaultValue===""+d||(i.defaultValue=""+d)}function Ms(i,o,d,h){if(i=i.options,o){o={};for(var g=0;g<d.length;g++)o["$"+d[g]]=!0;for(d=0;d<i.length;d++)g=o.hasOwnProperty("$"+i[d].value),i[d].selected!==g&&(i[d].selected=g),g&&h&&(i[d].defaultSelected=!0)}else{for(d=""+nr(d),o=null,g=0;g<i.length;g++){if(i[g].value===d){i[g].selected=!0,h&&(i[g].defaultSelected=!0);return}o!==null||i[g].disabled||(o=i[g])}o!==null&&(o.selected=!0)}}function an(i,o,d){if(o!=null&&(o=""+nr(o),o!==i.value&&(i.value=o),d==null)){i.defaultValue!==o&&(i.defaultValue=o);return}i.defaultValue=d!=null?""+nr(d):""}function Li(i,o,d,h){if(o==null){if(h!=null){if(d!=null)throw Error(s(92));if(Pe(h)){if(1<h.length)throw Error(s(93));h=h[0]}d=h}d==null&&(d=""),o=d}d=nr(o),i.defaultValue=d,h=i.textContent,h===d&&h!==""&&h!==null&&(i.value=h)}function qs(i,o){if(o){var d=i.firstChild;if(d&&d===i.lastChild&&d.nodeType===3){d.nodeValue=o;return}}i.textContent=o}var ra=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Sc(i,o,d){var h=o.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?h?i.setProperty(o,""):o==="float"?i.cssFloat="":i[o]="":h?i.setProperty(o,d):typeof d!="number"||d===0||ra.has(o)?o==="float"?i.cssFloat=d:i[o]=(""+d).trim():i[o]=d+"px"}function Fi(i,o,d){if(o!=null&&typeof o!="object")throw Error(s(62));if(i=i.style,d!=null){for(var h in d)!d.hasOwnProperty(h)||o!=null&&o.hasOwnProperty(h)||(h.indexOf("--")===0?i.setProperty(h,""):h==="float"?i.cssFloat="":i[h]="");for(var g in o)h=o[g],o.hasOwnProperty(g)&&d[g]!==h&&Sc(i,g,h)}else for(var y in o)o.hasOwnProperty(y)&&Sc(i,y,o[y])}function mo(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Rd=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ci=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function gl(i){return ci.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}var rr=null;function mr(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Ui=null,Lr=null;function fo(i){var o=Di(i);if(o&&(i=o.stateNode)){var d=i[Tt]||null;e:switch(i=o.stateNode,o.type){case"input":if(Gn(i,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),o=d.name,d.type==="radio"&&o!=null){for(d=i;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+Ln(""+o)+'"][type="radio"]'),o=0;o<d.length;o++){var h=d[o];if(h!==i&&h.form===i.form){var g=h[Tt]||null;if(!g)throw Error(s(90));Gn(h,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(o=0;o<d.length;o++)h=d[o],h.form===i.form&&pl(h)}break e;case"textarea":an(i,d.value,d.defaultValue);break e;case"select":o=d.value,o!=null&&Ms(i,!!d.multiple,o,!1)}}}var Er=!1;function Ic(i,o,d){if(Er)return i(o,d);Er=!0;try{var h=i(o);return h}finally{if(Er=!1,(Ui!==null||Lr!==null)&&(Pp(),Ui&&(o=Ui,i=Lr,Lr=Ui=null,fo(o),i)))for(o=0;o<i.length;o++)fo(i[o])}}function ja(i,o){var d=i.stateNode;if(d===null)return null;var h=d[Tt]||null;if(h===null)return null;d=h[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(i=i.type,h=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!h;break e;default:i=!1}if(i)return null;if(d&&typeof d!="function")throw Error(s(231,o,typeof d));return d}var Wr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Hs=!1;if(Wr)try{var po={};Object.defineProperty(po,"passive",{get:function(){Hs=!0}}),window.addEventListener("test",po,po),window.removeEventListener("test",po,po)}catch{Hs=!1}var di=null,Vi=null,Kr=null;function go(){if(Kr)return Kr;var i,o=Vi,d=o.length,h,g="value"in di?di.value:di.textContent,y=g.length;for(i=0;i<d&&o[i]===g[i];i++);var P=d-i;for(h=1;h<=P&&o[d-h]===g[y-h];h++);return Kr=g.slice(i,1<h?1-h:void 0)}function zi(i){var o=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&o===13&&(i=13)):i=o,i===10&&(i=13),32<=i||i===13?i:0}function Fr(){return!0}function Tc(){return!1}function js(i){function o(d,h,g,y,P){this._reactName=d,this._targetInst=g,this.type=h,this.nativeEvent=y,this.target=P,this.currentTarget=null;for(var q in i)i.hasOwnProperty(q)&&(d=i[q],this[q]=d?d(y):y[q]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Fr:Tc,this.isPropagationStopped=Tc,this}return b(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Fr)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Fr)},persist:function(){},isPersistent:Fr}),o}var pn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_a=js(pn),ia=b({},pn,{view:0,detail:0}),Cc=js(ia),$i,Ea,ui,Sa=b({},ia,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:vo,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==ui&&(ui&&i.type==="mousemove"?($i=i.screenX-ui.screenX,Ea=i.screenY-ui.screenY):Ea=$i=0,ui=i),$i)},movementY:function(i){return"movementY"in i?i.movementY:Ea}}),Gs=js(Sa),Pd=b({},Sa,{dataTransfer:0}),kd=js(Pd),Ia=b({},ia,{relatedTarget:0}),xo=js(Ia),xl=b({},pn,{animationName:0,elapsedTime:0,pseudoElement:0}),yo=js(xl),yl=b({},pn,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),bo=js(yl),bh=b({},pn,{data:0}),Ac=js(bh),Ta={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Dc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wo={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Rc(i){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(i):(i=wo[i])?!!o[i]:!1}function vo(){return Rc}var bl=b({},ia,{key:function(i){if(i.key){var o=Ta[i.key]||i.key;if(o!=="Unidentified")return o}return i.type==="keypress"?(i=zi(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Dc[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:vo,charCode:function(i){return i.type==="keypress"?zi(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?zi(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),No=js(bl),Pc=b({},Sa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hi=js(Pc),mi=b({},ia,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:vo}),Od=js(mi),kc=b({},pn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Md=js(kc),Ld=b({},Sa,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),wl=js(Ld),fr=b({},pn,{newState:0,oldState:0}),Oc=js(fr),Mc=[9,13,27,32],Bi=Wr&&"CompositionEvent"in window,f=null;Wr&&"documentMode"in document&&(f=document.documentMode);var v=Wr&&"TextEvent"in window&&!f,A=Wr&&(!Bi||f&&8<f&&11>=f),Y=" ",Ee=!1;function Oe(i,o){switch(i){case"keyup":return Mc.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function rt(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var on=!1;function _s(i,o){switch(i){case"compositionend":return rt(o);case"keypress":return o.which!==32?null:(Ee=!0,Y);case"textInput":return i=o.data,i===Y&&Ee?null:i;default:return null}}function ln(i,o){if(on)return i==="compositionend"||!Bi&&Oe(i,o)?(i=go(),Kr=Vi=di=null,on=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return A&&o.locale!=="ko"?null:o.data;default:return null}}var Ls={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Es(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o==="input"?!!Ls[i.type]:o==="textarea"}function Ss(i,o,d,h){Ui?Lr?Lr.push(h):Lr=[h]:Ui=h,o=Up(o,"onChange"),0<o.length&&(d=new _a("onChange","change",null,d,h),i.push({event:d,listeners:o}))}var Fs=null,fi=null;function vl(i){zN(i,0)}function Fd(i){var o=Ri(i);if(pl(o))return i}function Gf(i,o){if(i==="change")return o}var wh=!1;if(Wr){var Nl;if(Wr){var vh="oninput"in document;if(!vh){var Qf=document.createElement("div");Qf.setAttribute("oninput","return;"),vh=typeof Qf.oninput=="function"}Nl=vh}else Nl=!1;wh=Nl&&(!document.documentMode||9<document.documentMode)}function Nh(){Fs&&(Fs.detachEvent("onpropertychange",Wf),fi=Fs=null)}function Wf(i){if(i.propertyName==="value"&&Fd(fi)){var o=[];Ss(o,fi,i,mr(i)),Ic(vl,o)}}function Gx(i,o,d){i==="focusin"?(Nh(),Fs=o,fi=d,Fs.attachEvent("onpropertychange",Wf)):i==="focusout"&&Nh()}function Kf(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Fd(fi)}function Yf(i,o){if(i==="click")return Fd(o)}function Xf(i,o){if(i==="input"||i==="change")return Fd(o)}function Ud(i,o){return i===o&&(i!==0||1/i===1/o)||i!==i&&o!==o}var Sr=typeof Object.is=="function"?Object.is:Ud;function jo(i,o){if(Sr(i,o))return!0;if(typeof i!="object"||i===null||typeof o!="object"||o===null)return!1;var d=Object.keys(i),h=Object.keys(o);if(d.length!==h.length)return!1;for(h=0;h<d.length;h++){var g=d[h];if(!mt.call(o,g)||!Sr(i[g],o[g]))return!1}return!0}function Ur(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Jf(i,o){var d=Ur(i);i=0;for(var h;d;){if(d.nodeType===3){if(h=i+d.textContent.length,i<=o&&h>=o)return{node:d,offset:o-i};i=h}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Ur(d)}}function Zf(i,o){return i&&o?i===o?!0:i&&i.nodeType===3?!1:o&&o.nodeType===3?Zf(i,o.parentNode):"contains"in i?i.contains(o):i.compareDocumentPosition?!!(i.compareDocumentPosition(o)&16):!1:!1}function jh(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var o=sr(i.document);o instanceof i.HTMLIFrameElement;){try{var d=typeof o.contentWindow.location.href=="string"}catch{d=!1}if(d)i=o.contentWindow;else break;o=sr(i.document)}return o}function Vd(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o&&(o==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||o==="textarea"||i.contentEditable==="true")}var Qx=Wr&&"documentMode"in document&&11>=document.documentMode,jl=null,_h=null,Lc=null,Eh=!1;function ep(i,o,d){var h=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Eh||jl==null||jl!==sr(h)||(h=jl,"selectionStart"in h&&Vd(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Lc&&jo(Lc,h)||(Lc=h,h=Up(_h,"onSelect"),0<h.length&&(o=new _a("onSelect","select",null,o,d),i.push({event:o,listeners:h}),o.target=jl)))}function Ca(i,o){var d={};return d[i.toLowerCase()]=o.toLowerCase(),d["Webkit"+i]="webkit"+o,d["Moz"+i]="moz"+o,d}var _o={animationend:Ca("Animation","AnimationEnd"),animationiteration:Ca("Animation","AnimationIteration"),animationstart:Ca("Animation","AnimationStart"),transitionrun:Ca("Transition","TransitionRun"),transitionstart:Ca("Transition","TransitionStart"),transitioncancel:Ca("Transition","TransitionCancel"),transitionend:Ca("Transition","TransitionEnd")},Fc={},tp={};Wr&&(tp=document.createElement("div").style,"AnimationEvent"in window||(delete _o.animationend.animation,delete _o.animationiteration.animation,delete _o.animationstart.animation),"TransitionEvent"in window||delete _o.transitionend.transition);function Eo(i){if(Fc[i])return Fc[i];if(!_o[i])return i;var o=_o[i],d;for(d in o)if(o.hasOwnProperty(d)&&d in tp)return Fc[i]=o[d];return i}var Aa=Eo("animationend"),qi=Eo("animationiteration"),Sh=Eo("animationstart"),Wx=Eo("transitionrun"),np=Eo("transitionstart"),sp=Eo("transitioncancel"),Ih=Eo("transitionend"),Th=new Map,Ch="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ch.push("scrollEnd");function pi(i,o){Th.set(i,o),$n(o,[i])}var rp=new WeakMap;function Vr(i,o){if(typeof i=="object"&&i!==null){var d=rp.get(i);return d!==void 0?d:(o={value:i,source:o,stack:uo(o)},rp.set(i,o),o)}return{value:i,source:o,stack:uo(o)}}var zr=[],_l=0,Ah=0;function zd(){for(var i=_l,o=Ah=_l=0;o<i;){var d=zr[o];zr[o++]=null;var h=zr[o];zr[o++]=null;var g=zr[o];zr[o++]=null;var y=zr[o];if(zr[o++]=null,h!==null&&g!==null){var P=h.pending;P===null?g.next=g:(g.next=P.next,P.next=g),h.pending=g}y!==0&&Rh(d,g,y)}}function $d(i,o,d,h){zr[_l++]=i,zr[_l++]=o,zr[_l++]=d,zr[_l++]=h,Ah|=h,i.lanes|=h,i=i.alternate,i!==null&&(i.lanes|=h)}function Dh(i,o,d,h){return $d(i,o,d,h),Bd(i)}function Ir(i,o){return $d(i,null,null,o),Bd(i)}function Rh(i,o,d){i.lanes|=d;var h=i.alternate;h!==null&&(h.lanes|=d);for(var g=!1,y=i.return;y!==null;)y.childLanes|=d,h=y.alternate,h!==null&&(h.childLanes|=d),y.tag===22&&(i=y.stateNode,i===null||i._visibility&1||(g=!0)),i=y,y=y.return;return i.tag===3?(y=i.stateNode,g&&o!==null&&(g=31-C(d),i=y.hiddenUpdates,h=i[g],h===null?i[g]=[o]:h.push(o),o.lane=d|536870912),y):null}function Bd(i){if(50<mm)throw mm=0,Iy=null,Error(s(185));for(var o=i.return;o!==null;)i=o,o=i.return;return i.tag===3?i.stateNode:null}var El={};function Kx(i,o,d,h){this.tag=i,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function $r(i,o,d,h){return new Kx(i,o,d,h)}function Ph(i){return i=i.prototype,!(!i||!i.isReactComponent)}function aa(i,o){var d=i.alternate;return d===null?(d=$r(i.tag,o,i.key,i.mode),d.elementType=i.elementType,d.type=i.type,d.stateNode=i.stateNode,d.alternate=i,i.alternate=d):(d.pendingProps=o,d.type=i.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=i.flags&65011712,d.childLanes=i.childLanes,d.lanes=i.lanes,d.child=i.child,d.memoizedProps=i.memoizedProps,d.memoizedState=i.memoizedState,d.updateQueue=i.updateQueue,o=i.dependencies,d.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},d.sibling=i.sibling,d.index=i.index,d.ref=i.ref,d.refCleanup=i.refCleanup,d}function ip(i,o){i.flags&=65011714;var d=i.alternate;return d===null?(i.childLanes=0,i.lanes=o,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=d.childLanes,i.lanes=d.lanes,i.child=d.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=d.memoizedProps,i.memoizedState=d.memoizedState,i.updateQueue=d.updateQueue,i.type=d.type,o=d.dependencies,i.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),i}function qd(i,o,d,h,g,y){var P=0;if(h=i,typeof i=="function")Ph(i)&&(P=1);else if(typeof i=="string")P=iA(i,d,te.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case k:return i=$r(31,d,o,g),i.elementType=k,i.lanes=y,i;case O:return oa(d.children,g,y,o);case G:P=8,g|=24;break;case U:return i=$r(12,d,o,g|2),i.elementType=U,i.lanes=y,i;case X:return i=$r(13,d,o,g),i.elementType=X,i.lanes=y,i;case pe:return i=$r(19,d,o,g),i.elementType=pe,i.lanes=y,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case T:case Z:P=10;break e;case ee:P=9;break e;case ie:P=11;break e;case H:P=14;break e;case B:P=16,h=null;break e}P=29,d=Error(s(130,i===null?"null":typeof i,"")),h=null}return o=$r(P,d,o,g),o.elementType=i,o.type=h,o.lanes=y,o}function oa(i,o,d,h){return i=$r(7,i,h,o),i.lanes=d,i}function Sl(i,o,d){return i=$r(6,i,null,o),i.lanes=d,i}function kh(i,o,d){return o=$r(4,i.children!==null?i.children:[],i.key,o),o.lanes=d,o.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},o}var So=[],Io=0,Da=null,Il=0,Tr=[],Yr=0,To=null,la=1,pr="";function Co(i,o){So[Io++]=Il,So[Io++]=Da,Da=i,Il=o}function ap(i,o,d){Tr[Yr++]=la,Tr[Yr++]=pr,Tr[Yr++]=To,To=i;var h=la;i=pr;var g=32-C(h)-1;h&=~(1<<g),d+=1;var y=32-C(o)+g;if(30<y){var P=g-g%5;y=(h&(1<<P)-1).toString(32),h>>=P,g-=P,la=1<<32-C(o)+g|d<<g|h,pr=y+i}else la=1<<y|d<<g|h,pr=i}function Oh(i){i.return!==null&&(Co(i,1),ap(i,1,0))}function Mh(i){for(;i===Da;)Da=So[--Io],So[Io]=null,Il=So[--Io],So[Io]=null;for(;i===To;)To=Tr[--Yr],Tr[Yr]=null,pr=Tr[--Yr],Tr[Yr]=null,la=Tr[--Yr],Tr[Yr]=null}var Us=null,Qn=null,bn=!1,Ra=null,Hi=!1,Pa=Error(s(519));function ca(i){var o=Error(s(418,""));throw gi(Vr(o,i)),Pa}function Lh(i){var o=i.stateNode,d=i.type,h=i.memoizedProps;switch(o[Ve]=i,o[Tt]=h,d){case"dialog":nn("cancel",o),nn("close",o);break;case"iframe":case"object":case"embed":nn("load",o);break;case"video":case"audio":for(d=0;d<pm.length;d++)nn(pm[d],o);break;case"source":nn("error",o);break;case"img":case"image":case"link":nn("error",o),nn("load",o);break;case"details":nn("toggle",o);break;case"input":nn("invalid",o),sa(o,h.value,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name,!0),ho(o);break;case"select":nn("invalid",o);break;case"textarea":nn("invalid",o),Li(o,h.value,h.defaultValue,h.children),ho(o)}d=h.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||o.textContent===""+d||h.suppressHydrationWarning===!0||HN(o.textContent,d)?(h.popover!=null&&(nn("beforetoggle",o),nn("toggle",o)),h.onScroll!=null&&nn("scroll",o),h.onScrollEnd!=null&&nn("scrollend",o),h.onClick!=null&&(o.onclick=Vp),o=!0):o=!1,o||ca(i)}function op(i){for(Us=i.return;Us;)switch(Us.tag){case 5:case 13:Hi=!1;return;case 27:case 3:Hi=!0;return;default:Us=Us.return}}function Uc(i){if(i!==Us)return!1;if(!bn)return op(i),bn=!0,!1;var o=i.tag,d;if((d=o!==3&&o!==27)&&((d=o===5)&&(d=i.type,d=!(d!=="form"&&d!=="button")||By(i.type,i.memoizedProps)),d=!d),d&&Qn&&ca(i),op(i),o===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(s(317));e:{for(i=i.nextSibling,o=0;i;){if(i.nodeType===8)if(d=i.data,d==="/$"){if(o===0){Qn=ma(i.nextSibling);break e}o--}else d!=="$"&&d!=="$!"&&d!=="$?"||o++;i=i.nextSibling}Qn=null}}else o===27?(o=Qn,$l(i.type)?(i=Qy,Qy=null,Qn=i):Qn=o):Qn=Us?ma(i.stateNode.nextSibling):null;return!0}function Vc(){Qn=Us=null,bn=!1}function Tl(){var i=Ra;return i!==null&&(ni===null?ni=i:ni.push.apply(ni,i),Ra=null),i}function gi(i){Ra===null?Ra=[i]:Ra.push(i)}var Fh=E(null),Ao=null,da=null;function ka(i,o,d){F(Fh,o._currentValue),o._currentValue=d}function ua(i){i._currentValue=Fh.current,D(Fh)}function Uh(i,o,d){for(;i!==null;){var h=i.alternate;if((i.childLanes&o)!==o?(i.childLanes|=o,h!==null&&(h.childLanes|=o)):h!==null&&(h.childLanes&o)!==o&&(h.childLanes|=o),i===d)break;i=i.return}}function Vh(i,o,d,h){var g=i.child;for(g!==null&&(g.return=i);g!==null;){var y=g.dependencies;if(y!==null){var P=g.child;y=y.firstContext;e:for(;y!==null;){var q=y;y=g;for(var ae=0;ae<o.length;ae++)if(q.context===o[ae]){y.lanes|=d,q=y.alternate,q!==null&&(q.lanes|=d),Uh(y.return,d,i),h||(P=null);break e}y=q.next}}else if(g.tag===18){if(P=g.return,P===null)throw Error(s(341));P.lanes|=d,y=P.alternate,y!==null&&(y.lanes|=d),Uh(P,d,i),P=null}else P=g.child;if(P!==null)P.return=g;else for(P=g;P!==null;){if(P===i){P=null;break}if(g=P.sibling,g!==null){g.return=P.return,P=g;break}P=P.return}g=P}}function zc(i,o,d,h){i=null;for(var g=o,y=!1;g!==null;){if(!y){if((g.flags&524288)!==0)y=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var P=g.alternate;if(P===null)throw Error(s(387));if(P=P.memoizedProps,P!==null){var q=g.type;Sr(g.pendingProps.value,P.value)||(i!==null?i.push(q):i=[q])}}else if(g===me.current){if(P=g.alternate,P===null)throw Error(s(387));P.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(i!==null?i.push(vm):i=[vm])}g=g.return}i!==null&&Vh(o,i,d,h),o.flags|=262144}function $c(i){for(i=i.firstContext;i!==null;){if(!Sr(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function Do(i){Ao=i,da=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function Qs(i){return zh(Ao,i)}function Cl(i,o){return Ao===null&&Do(i),zh(i,o)}function zh(i,o){var d=o._currentValue;if(o={context:o,memoizedValue:d,next:null},da===null){if(i===null)throw Error(s(308));da=o,i.dependencies={lanes:0,firstContext:o},i.flags|=524288}else da=da.next=o;return d}var Ro=typeof AbortController<"u"?AbortController:function(){var i=[],o=this.signal={aborted:!1,addEventListener:function(d,h){i.push(h)}};this.abort=function(){o.aborted=!0,i.forEach(function(d){return d()})}},lp=r.unstable_scheduleCallback,$h=r.unstable_NormalPriority,xs={$$typeof:Z,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Bc(){return{controller:new Ro,data:new Map,refCount:0}}function Al(i){i.refCount--,i.refCount===0&&lp($h,function(){i.controller.abort()})}var Po=null,Bh=0,Xr=0,Br=null;function Yx(i,o){if(Po===null){var d=Po=[];Bh=0,Xr=ky(),Br={status:"pending",value:void 0,then:function(h){d.push(h)}}}return Bh++,o.then(cp,cp),o}function cp(){if(--Bh===0&&Po!==null){Br!==null&&(Br.status="fulfilled");var i=Po;Po=null,Xr=0,Br=null;for(var o=0;o<i.length;o++)(0,i[o])()}}function Xx(i,o){var d=[],h={status:"pending",value:null,reason:null,then:function(g){d.push(g)}};return i.then(function(){h.status="fulfilled",h.value=o;for(var g=0;g<d.length;g++)(0,d[g])(o)},function(g){for(h.status="rejected",h.reason=g,g=0;g<d.length;g++)(0,d[g])(void 0)}),h}var dp=V.S;V.S=function(i,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&Yx(i,o),dp!==null&&dp(i,o)};var ko=E(null);function qh(){var i=ko.current;return i!==null?i:Wn.pooledCache}function Hd(i,o){o===null?F(ko,ko.current):F(ko,o.pool)}function up(){var i=qh();return i===null?null:{parent:xs._currentValue,pool:i}}var Dl=Error(s(460)),qc=Error(s(474)),Oo=Error(s(542)),Hh={then:function(){}};function hp(i){return i=i.status,i==="fulfilled"||i==="rejected"}function Oa(){}function M(i,o,d){switch(d=i[d],d===void 0?i.push(o):d!==o&&(o.then(Oa,Oa),o=d),o.status){case"fulfilled":return o.value;case"rejected":throw i=o.reason,K(i),i;default:if(typeof o.status=="string")o.then(Oa,Oa);else{if(i=Wn,i!==null&&100<i.shellSuspendCounter)throw Error(s(482));i=o,i.status="pending",i.then(function(h){if(o.status==="pending"){var g=o;g.status="fulfilled",g.value=h}},function(h){if(o.status==="pending"){var g=o;g.status="rejected",g.reason=h}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw i=o.reason,K(i),i}throw x=o,Dl}}var x=null;function S(){if(x===null)throw Error(s(459));var i=x;return x=null,i}function K(i){if(i===Dl||i===Oo)throw Error(s(483))}var xe=!1;function Ne(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Me(i,o){i=i.updateQueue,o.updateQueue===i&&(o.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function He(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function st(i,o,d){var h=i.updateQueue;if(h===null)return null;if(h=h.shared,(Rn&2)!==0){var g=h.pending;return g===null?o.next=o:(o.next=g.next,g.next=o),h.pending=o,o=Bd(i),Rh(i,null,d),o}return $d(i,h,o,d),Bd(i)}function ut(i,o,d){if(o=o.updateQueue,o!==null&&(o=o.shared,(d&4194048)!==0)){var h=o.lanes;h&=i.pendingLanes,d|=h,o.lanes=d,ze(i,d)}}function xt(i,o){var d=i.updateQueue,h=i.alternate;if(h!==null&&(h=h.updateQueue,d===h)){var g=null,y=null;if(d=d.firstBaseUpdate,d!==null){do{var P={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};y===null?g=y=P:y=y.next=P,d=d.next}while(d!==null);y===null?g=y=o:y=y.next=o}else g=y=o;d={baseState:h.baseState,firstBaseUpdate:g,lastBaseUpdate:y,shared:h.shared,callbacks:h.callbacks},i.updateQueue=d;return}i=d.lastBaseUpdate,i===null?d.firstBaseUpdate=o:i.next=o,d.lastBaseUpdate=o}var ot=!1;function $t(){if(ot){var i=Br;if(i!==null)throw i}}function Ct(i,o,d,h){ot=!1;var g=i.updateQueue;xe=!1;var y=g.firstBaseUpdate,P=g.lastBaseUpdate,q=g.shared.pending;if(q!==null){g.shared.pending=null;var ae=q,Te=ae.next;ae.next=null,P===null?y=Te:P.next=Te,P=ae;var qe=i.alternate;qe!==null&&(qe=qe.updateQueue,q=qe.lastBaseUpdate,q!==P&&(q===null?qe.firstBaseUpdate=Te:q.next=Te,qe.lastBaseUpdate=ae))}if(y!==null){var Qe=g.baseState;P=0,qe=Te=ae=null,q=y;do{var Ae=q.lane&-536870913,Re=Ae!==q.lane;if(Re?(xn&Ae)===Ae:(h&Ae)===Ae){Ae!==0&&Ae===Xr&&(ot=!0),qe!==null&&(qe=qe.next={lane:0,tag:q.tag,payload:q.payload,callback:null,next:null});e:{var zt=i,Pt=q;Ae=o;var Vn=d;switch(Pt.tag){case 1:if(zt=Pt.payload,typeof zt=="function"){Qe=zt.call(Vn,Qe,Ae);break e}Qe=zt;break e;case 3:zt.flags=zt.flags&-65537|128;case 0:if(zt=Pt.payload,Ae=typeof zt=="function"?zt.call(Vn,Qe,Ae):zt,Ae==null)break e;Qe=b({},Qe,Ae);break e;case 2:xe=!0}}Ae=q.callback,Ae!==null&&(i.flags|=64,Re&&(i.flags|=8192),Re=g.callbacks,Re===null?g.callbacks=[Ae]:Re.push(Ae))}else Re={lane:Ae,tag:q.tag,payload:q.payload,callback:q.callback,next:null},qe===null?(Te=qe=Re,ae=Qe):qe=qe.next=Re,P|=Ae;if(q=q.next,q===null){if(q=g.shared.pending,q===null)break;Re=q,q=Re.next,Re.next=null,g.lastBaseUpdate=Re,g.shared.pending=null}}while(!0);qe===null&&(ae=Qe),g.baseState=ae,g.firstBaseUpdate=Te,g.lastBaseUpdate=qe,y===null&&(g.shared.lanes=0),Fl|=P,i.lanes=P,i.memoizedState=Qe}}function Bt(i,o){if(typeof i!="function")throw Error(s(191,i));i.call(o)}function Mt(i,o){var d=i.callbacks;if(d!==null)for(i.callbacks=null,i=0;i<d.length;i++)Bt(d[i],o)}var Rt=E(null),wn=E(0);function An(i,o){i=$o,F(wn,i),F(Rt,o),$o=i|o.baseLanes}function Wt(){F(wn,$o),F(Rt,Rt.current)}function fn(){$o=wn.current,D(Rt),D(wn)}var Lt=0,ct=null,Et=null,Ft=null,gn=!1,Fn=!1,Is=!1,Cr=0,Ts=0,Ws=null,Jr=0;function Qt(){throw Error(s(321))}function Zr(i,o){if(o===null)return!1;for(var d=0;d<o.length&&d<i.length;d++)if(!Sr(i[d],o[d]))return!1;return!0}function ei(i,o,d,h,g,y){return Lt=y,ct=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,V.H=i===null||i.memoizedState===null?Ev:Sv,Is=!1,y=d(h,g),Is=!1,Fn&&(y=Cs(o,d,h,g)),Mo(i),y}function Mo(i){V.H=wp;var o=Et!==null&&Et.next!==null;if(Lt=0,Ft=Et=ct=null,gn=!1,Ts=0,Ws=null,o)throw Error(s(300));i===null||ir||(i=i.dependencies,i!==null&&$c(i)&&(ir=!0))}function Cs(i,o,d,h){ct=i;var g=0;do{if(Fn&&(Ws=null),Ts=0,Fn=!1,25<=g)throw Error(s(301));if(g+=1,Ft=Et=null,i.updateQueue!=null){var y=i.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}V.H=gC,y=o(d,h)}while(Fn);return y}function Dn(){var i=V.H,o=i.useState()[0];return o=typeof o.then=="function"?Ma(o):o,i=i.useState()[0],(Et!==null?Et.memoizedState:null)!==i&&(ct.flags|=1024),o}function Ks(){var i=Cr!==0;return Cr=0,i}function Ar(i,o,d){o.updateQueue=i.updateQueue,o.flags&=-2053,i.lanes&=~d}function Gi(i){if(gn){for(i=i.memoizedState;i!==null;){var o=i.queue;o!==null&&(o.pending=null),i=i.next}gn=!1}Lt=0,Ft=Et=ct=null,Fn=!1,Ts=Cr=0,Ws=null}function Ys(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ft===null?ct.memoizedState=Ft=i:Ft=Ft.next=i,Ft}function cs(){if(Et===null){var i=ct.alternate;i=i!==null?i.memoizedState:null}else i=Et.next;var o=Ft===null?ct.memoizedState:Ft.next;if(o!==null)Ft=o,Et=i;else{if(i===null)throw ct.alternate===null?Error(s(467)):Error(s(310));Et=i,i={memoizedState:Et.memoizedState,baseState:Et.baseState,baseQueue:Et.baseQueue,queue:Et.queue,next:null},Ft===null?ct.memoizedState=Ft=i:Ft=Ft.next=i}return Ft}function Gd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ma(i){var o=Ts;return Ts+=1,Ws===null&&(Ws=[]),i=M(Ws,i,o),o=ct,(Ft===null?o.memoizedState:Ft.next)===null&&(o=o.alternate,V.H=o===null||o.memoizedState===null?Ev:Sv),i}function Qd(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Ma(i);if(i.$$typeof===Z)return Qs(i)}throw Error(s(438,String(i)))}function Gh(i){var o=null,d=ct.updateQueue;if(d!==null&&(o=d.memoCache),o==null){var h=ct.alternate;h!==null&&(h=h.updateQueue,h!==null&&(h=h.memoCache,h!=null&&(o={data:h.data.map(function(g){return g.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),d===null&&(d=Gd(),ct.updateQueue=d),d.memoCache=o,d=o.data[o.index],d===void 0)for(d=o.data[o.index]=Array(i),h=0;h<i;h++)d[h]=W;return o.index++,d}function xi(i,o){return typeof o=="function"?o(i):o}function Wd(i){var o=cs();return Kd(o,Et,i)}function Kd(i,o,d){var h=i.queue;if(h===null)throw Error(s(311));h.lastRenderedReducer=d;var g=i.baseQueue,y=h.pending;if(y!==null){if(g!==null){var P=g.next;g.next=y.next,y.next=P}o.baseQueue=g=y,h.pending=null}if(y=i.baseState,g===null)i.memoizedState=y;else{o=g.next;var q=P=null,ae=null,Te=o,qe=!1;do{var Qe=Te.lane&-536870913;if(Qe!==Te.lane?(xn&Qe)===Qe:(Lt&Qe)===Qe){var Ae=Te.revertLane;if(Ae===0)ae!==null&&(ae=ae.next={lane:0,revertLane:0,action:Te.action,hasEagerState:Te.hasEagerState,eagerState:Te.eagerState,next:null}),Qe===Xr&&(qe=!0);else if((Lt&Ae)===Ae){Te=Te.next,Ae===Xr&&(qe=!0);continue}else Qe={lane:0,revertLane:Te.revertLane,action:Te.action,hasEagerState:Te.hasEagerState,eagerState:Te.eagerState,next:null},ae===null?(q=ae=Qe,P=y):ae=ae.next=Qe,ct.lanes|=Ae,Fl|=Ae;Qe=Te.action,Is&&d(y,Qe),y=Te.hasEagerState?Te.eagerState:d(y,Qe)}else Ae={lane:Qe,revertLane:Te.revertLane,action:Te.action,hasEagerState:Te.hasEagerState,eagerState:Te.eagerState,next:null},ae===null?(q=ae=Ae,P=y):ae=ae.next=Ae,ct.lanes|=Qe,Fl|=Qe;Te=Te.next}while(Te!==null&&Te!==o);if(ae===null?P=y:ae.next=q,!Sr(y,i.memoizedState)&&(ir=!0,qe&&(d=Br,d!==null)))throw d;i.memoizedState=y,i.baseState=P,i.baseQueue=ae,h.lastRenderedState=y}return g===null&&(h.lanes=0),[i.memoizedState,h.dispatch]}function Qh(i){var o=cs(),d=o.queue;if(d===null)throw Error(s(311));d.lastRenderedReducer=i;var h=d.dispatch,g=d.pending,y=o.memoizedState;if(g!==null){d.pending=null;var P=g=g.next;do y=i(y,P.action),P=P.next;while(P!==g);Sr(y,o.memoizedState)||(ir=!0),o.memoizedState=y,o.baseQueue===null&&(o.baseState=y),d.lastRenderedState=y}return[y,h]}function Wh(i,o,d){var h=ct,g=cs(),y=bn;if(y){if(d===void 0)throw Error(s(407));d=d()}else d=o();var P=!Sr((Et||g).memoizedState,d);P&&(g.memoizedState=d,ir=!0),g=g.queue;var q=fp.bind(null,h,g,i);if(nm(2048,8,q,[i]),g.getSnapshot!==o||P||Ft!==null&&Ft.memoizedState.tag&1){if(h.flags|=2048,Zd(9,xp(),mp.bind(null,h,g,d,o),null),Wn===null)throw Error(s(349));y||(Lt&124)!==0||Kh(h,o,d)}return d}function Kh(i,o,d){i.flags|=16384,i={getSnapshot:o,value:d},o=ct.updateQueue,o===null?(o=Gd(),ct.updateQueue=o,o.stores=[i]):(d=o.stores,d===null?o.stores=[i]:d.push(i))}function mp(i,o,d,h){o.value=d,o.getSnapshot=h,La(o)&&Hc(i)}function fp(i,o,d){return d(function(){La(o)&&Hc(i)})}function La(i){var o=i.getSnapshot;i=i.value;try{var d=o();return!Sr(i,d)}catch{return!0}}function Hc(i){var o=Ir(i,2);o!==null&&Ni(o,i,2)}function Yd(i){var o=Ys();if(typeof i=="function"){var d=i;if(i=d(),Is){En(!0);try{d()}finally{En(!1)}}}return o.memoizedState=o.baseState=i,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:xi,lastRenderedState:i},o}function Yh(i,o,d,h){return i.baseState=d,Kd(i,Et,typeof h=="function"?h:xi)}function Xh(i,o,d,h,g){if(bp(i))throw Error(s(485));if(i=o.action,i!==null){var y={payload:g,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(P){y.listeners.push(P)}};V.T!==null?d(!0):y.isTransition=!1,h(y),d=o.pending,d===null?(y.next=o.pending=y,Jh(o,y)):(y.next=d.next,o.pending=d.next=y)}}function Jh(i,o){var d=o.action,h=o.payload,g=i.state;if(o.isTransition){var y=V.T,P={};V.T=P;try{var q=d(g,h),ae=V.S;ae!==null&&ae(P,q),Zh(i,o,q)}catch(Te){Xd(i,o,Te)}finally{V.T=y}}else try{y=d(g,h),Zh(i,o,y)}catch(Te){Xd(i,o,Te)}}function Zh(i,o,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(h){em(i,o,h)},function(h){return Xd(i,o,h)}):em(i,o,d)}function em(i,o,d){o.status="fulfilled",o.value=d,pp(o),i.state=d,o=i.pending,o!==null&&(d=o.next,d===o?i.pending=null:(d=d.next,o.next=d,Jh(i,d)))}function Xd(i,o,d){var h=i.pending;if(i.pending=null,h!==null){h=h.next;do o.status="rejected",o.reason=d,pp(o),o=o.next;while(o!==h)}i.action=null}function pp(i){i=i.listeners;for(var o=0;o<i.length;o++)(0,i[o])()}function gp(i,o){return o}function Jd(i,o){if(bn){var d=Wn.formState;if(d!==null){e:{var h=ct;if(bn){if(Qn){t:{for(var g=Qn,y=Hi;g.nodeType!==8;){if(!y){g=null;break t}if(g=ma(g.nextSibling),g===null){g=null;break t}}y=g.data,g=y==="F!"||y==="F"?g:null}if(g){Qn=ma(g.nextSibling),h=g.data==="F!";break e}}ca(h)}h=!1}h&&(o=d[0])}}return d=Ys(),d.memoizedState=d.baseState=o,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:gp,lastRenderedState:o},d.queue=h,d=Nv.bind(null,ct,h),h.dispatch=d,h=Yd(!1),y=ny.bind(null,ct,!1,h.queue),h=Ys(),g={state:o,dispatch:null,action:i,pending:null},h.queue=g,d=Xh.bind(null,ct,g,y,d),g.dispatch=d,h.memoizedState=i,[o,d,!1]}function tm(i){var o=cs();return iv(o,Et,i)}function iv(i,o,d){if(o=Kd(i,o,gp)[0],i=Wd(xi)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var h=Ma(o)}catch(P){throw P===Dl?Oo:P}else h=o;o=cs();var g=o.queue,y=g.dispatch;return d!==o.memoizedState&&(ct.flags|=2048,Zd(9,xp(),hC.bind(null,g,d),null)),[h,y,i]}function hC(i,o){i.action=o}function av(i){var o=cs(),d=Et;if(d!==null)return iv(o,d,i);cs(),o=o.memoizedState,d=cs();var h=d.queue.dispatch;return d.memoizedState=i,[o,h,!1]}function Zd(i,o,d,h){return i={tag:i,create:d,deps:h,inst:o,next:null},o=ct.updateQueue,o===null&&(o=Gd(),ct.updateQueue=o),d=o.lastEffect,d===null?o.lastEffect=i.next=i:(h=d.next,d.next=i,i.next=h,o.lastEffect=i),i}function xp(){return{destroy:void 0,resource:void 0}}function ov(){return cs().memoizedState}function yp(i,o,d,h){var g=Ys();h=h===void 0?null:h,ct.flags|=i,g.memoizedState=Zd(1|o,xp(),d,h)}function nm(i,o,d,h){var g=cs();h=h===void 0?null:h;var y=g.memoizedState.inst;Et!==null&&h!==null&&Zr(h,Et.memoizedState.deps)?g.memoizedState=Zd(o,y,d,h):(ct.flags|=i,g.memoizedState=Zd(1|o,y,d,h))}function lv(i,o){yp(8390656,8,i,o)}function cv(i,o){nm(2048,8,i,o)}function dv(i,o){return nm(4,2,i,o)}function uv(i,o){return nm(4,4,i,o)}function hv(i,o){if(typeof o=="function"){i=i();var d=o(i);return function(){typeof d=="function"?d():o(null)}}if(o!=null)return i=i(),o.current=i,function(){o.current=null}}function mv(i,o,d){d=d!=null?d.concat([i]):null,nm(4,4,hv.bind(null,o,i),d)}function Jx(){}function fv(i,o){var d=cs();o=o===void 0?null:o;var h=d.memoizedState;return o!==null&&Zr(o,h[1])?h[0]:(d.memoizedState=[i,o],i)}function pv(i,o){var d=cs();o=o===void 0?null:o;var h=d.memoizedState;if(o!==null&&Zr(o,h[1]))return h[0];if(h=i(),Is){En(!0);try{i()}finally{En(!1)}}return d.memoizedState=[h,o],h}function Zx(i,o,d){return d===void 0||(Lt&1073741824)!==0?i.memoizedState=o:(i.memoizedState=d,i=yN(),ct.lanes|=i,Fl|=i,d)}function gv(i,o,d,h){return Sr(d,o)?d:Rt.current!==null?(i=Zx(i,d,h),Sr(i,o)||(ir=!0),i):(Lt&42)===0?(ir=!0,i.memoizedState=d):(i=yN(),ct.lanes|=i,Fl|=i,o)}function xv(i,o,d,h,g){var y=se.p;se.p=y!==0&&8>y?y:8;var P=V.T,q={};V.T=q,ny(i,!1,o,d);try{var ae=g(),Te=V.S;if(Te!==null&&Te(q,ae),ae!==null&&typeof ae=="object"&&typeof ae.then=="function"){var qe=Xx(ae,h);sm(i,o,qe,vi(i))}else sm(i,o,h,vi(i))}catch(Qe){sm(i,o,{then:function(){},status:"rejected",reason:Qe},vi())}finally{se.p=y,V.T=P}}function mC(){}function ey(i,o,d,h){if(i.tag!==5)throw Error(s(476));var g=yv(i).queue;xv(i,g,o,fe,d===null?mC:function(){return bv(i),d(h)})}function yv(i){var o=i.memoizedState;if(o!==null)return o;o={memoizedState:fe,baseState:fe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xi,lastRenderedState:fe},next:null};var d={};return o.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xi,lastRenderedState:d},next:null},i.memoizedState=o,i=i.alternate,i!==null&&(i.memoizedState=o),o}function bv(i){var o=yv(i).next.queue;sm(i,o,{},vi())}function ty(){return Qs(vm)}function wv(){return cs().memoizedState}function vv(){return cs().memoizedState}function fC(i){for(var o=i.return;o!==null;){switch(o.tag){case 24:case 3:var d=vi();i=He(d);var h=st(o,i,d);h!==null&&(Ni(h,o,d),ut(h,o,d)),o={cache:Bc()},i.payload=o;return}o=o.return}}function pC(i,o,d){var h=vi();d={lane:h,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null},bp(i)?jv(o,d):(d=Dh(i,o,d,h),d!==null&&(Ni(d,i,h),_v(d,o,h)))}function Nv(i,o,d){var h=vi();sm(i,o,d,h)}function sm(i,o,d,h){var g={lane:h,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null};if(bp(i))jv(o,g);else{var y=i.alternate;if(i.lanes===0&&(y===null||y.lanes===0)&&(y=o.lastRenderedReducer,y!==null))try{var P=o.lastRenderedState,q=y(P,d);if(g.hasEagerState=!0,g.eagerState=q,Sr(q,P))return $d(i,o,g,0),Wn===null&&zd(),!1}catch{}finally{}if(d=Dh(i,o,g,h),d!==null)return Ni(d,i,h),_v(d,o,h),!0}return!1}function ny(i,o,d,h){if(h={lane:2,revertLane:ky(),action:h,hasEagerState:!1,eagerState:null,next:null},bp(i)){if(o)throw Error(s(479))}else o=Dh(i,d,h,2),o!==null&&Ni(o,i,2)}function bp(i){var o=i.alternate;return i===ct||o!==null&&o===ct}function jv(i,o){Fn=gn=!0;var d=i.pending;d===null?o.next=o:(o.next=d.next,d.next=o),i.pending=o}function _v(i,o,d){if((d&4194048)!==0){var h=o.lanes;h&=i.pendingLanes,d|=h,o.lanes=d,ze(i,d)}}var wp={readContext:Qs,use:Qd,useCallback:Qt,useContext:Qt,useEffect:Qt,useImperativeHandle:Qt,useLayoutEffect:Qt,useInsertionEffect:Qt,useMemo:Qt,useReducer:Qt,useRef:Qt,useState:Qt,useDebugValue:Qt,useDeferredValue:Qt,useTransition:Qt,useSyncExternalStore:Qt,useId:Qt,useHostTransitionStatus:Qt,useFormState:Qt,useActionState:Qt,useOptimistic:Qt,useMemoCache:Qt,useCacheRefresh:Qt},Ev={readContext:Qs,use:Qd,useCallback:function(i,o){return Ys().memoizedState=[i,o===void 0?null:o],i},useContext:Qs,useEffect:lv,useImperativeHandle:function(i,o,d){d=d!=null?d.concat([i]):null,yp(4194308,4,hv.bind(null,o,i),d)},useLayoutEffect:function(i,o){return yp(4194308,4,i,o)},useInsertionEffect:function(i,o){yp(4,2,i,o)},useMemo:function(i,o){var d=Ys();o=o===void 0?null:o;var h=i();if(Is){En(!0);try{i()}finally{En(!1)}}return d.memoizedState=[h,o],h},useReducer:function(i,o,d){var h=Ys();if(d!==void 0){var g=d(o);if(Is){En(!0);try{d(o)}finally{En(!1)}}}else g=o;return h.memoizedState=h.baseState=g,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:g},h.queue=i,i=i.dispatch=pC.bind(null,ct,i),[h.memoizedState,i]},useRef:function(i){var o=Ys();return i={current:i},o.memoizedState=i},useState:function(i){i=Yd(i);var o=i.queue,d=Nv.bind(null,ct,o);return o.dispatch=d,[i.memoizedState,d]},useDebugValue:Jx,useDeferredValue:function(i,o){var d=Ys();return Zx(d,i,o)},useTransition:function(){var i=Yd(!1);return i=xv.bind(null,ct,i.queue,!0,!1),Ys().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,o,d){var h=ct,g=Ys();if(bn){if(d===void 0)throw Error(s(407));d=d()}else{if(d=o(),Wn===null)throw Error(s(349));(xn&124)!==0||Kh(h,o,d)}g.memoizedState=d;var y={value:d,getSnapshot:o};return g.queue=y,lv(fp.bind(null,h,y,i),[i]),h.flags|=2048,Zd(9,xp(),mp.bind(null,h,y,d,o),null),d},useId:function(){var i=Ys(),o=Wn.identifierPrefix;if(bn){var d=pr,h=la;d=(h&~(1<<32-C(h)-1)).toString(32)+d,o="«"+o+"R"+d,d=Cr++,0<d&&(o+="H"+d.toString(32)),o+="»"}else d=Jr++,o="«"+o+"r"+d.toString(32)+"»";return i.memoizedState=o},useHostTransitionStatus:ty,useFormState:Jd,useActionState:Jd,useOptimistic:function(i){var o=Ys();o.memoizedState=o.baseState=i;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=d,o=ny.bind(null,ct,!0,d),d.dispatch=o,[i,o]},useMemoCache:Gh,useCacheRefresh:function(){return Ys().memoizedState=fC.bind(null,ct)}},Sv={readContext:Qs,use:Qd,useCallback:fv,useContext:Qs,useEffect:cv,useImperativeHandle:mv,useInsertionEffect:dv,useLayoutEffect:uv,useMemo:pv,useReducer:Wd,useRef:ov,useState:function(){return Wd(xi)},useDebugValue:Jx,useDeferredValue:function(i,o){var d=cs();return gv(d,Et.memoizedState,i,o)},useTransition:function(){var i=Wd(xi)[0],o=cs().memoizedState;return[typeof i=="boolean"?i:Ma(i),o]},useSyncExternalStore:Wh,useId:wv,useHostTransitionStatus:ty,useFormState:tm,useActionState:tm,useOptimistic:function(i,o){var d=cs();return Yh(d,Et,i,o)},useMemoCache:Gh,useCacheRefresh:vv},gC={readContext:Qs,use:Qd,useCallback:fv,useContext:Qs,useEffect:cv,useImperativeHandle:mv,useInsertionEffect:dv,useLayoutEffect:uv,useMemo:pv,useReducer:Qh,useRef:ov,useState:function(){return Qh(xi)},useDebugValue:Jx,useDeferredValue:function(i,o){var d=cs();return Et===null?Zx(d,i,o):gv(d,Et.memoizedState,i,o)},useTransition:function(){var i=Qh(xi)[0],o=cs().memoizedState;return[typeof i=="boolean"?i:Ma(i),o]},useSyncExternalStore:Wh,useId:wv,useHostTransitionStatus:ty,useFormState:av,useActionState:av,useOptimistic:function(i,o){var d=cs();return Et!==null?Yh(d,Et,i,o):(d.baseState=i,[i,d.queue.dispatch])},useMemoCache:Gh,useCacheRefresh:vv},eu=null,rm=0;function vp(i){var o=rm;return rm+=1,eu===null&&(eu=[]),M(eu,i,o)}function im(i,o){o=o.props.ref,i.ref=o!==void 0?o:null}function Np(i,o){throw o.$$typeof===w?Error(s(525)):(i=Object.prototype.toString.call(o),Error(s(31,i==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":i)))}function Iv(i){var o=i._init;return o(i._payload)}function Tv(i){function o(je,ge){if(i){var Ie=je.deletions;Ie===null?(je.deletions=[ge],je.flags|=16):Ie.push(ge)}}function d(je,ge){if(!i)return null;for(;ge!==null;)o(je,ge),ge=ge.sibling;return null}function h(je){for(var ge=new Map;je!==null;)je.key!==null?ge.set(je.key,je):ge.set(je.index,je),je=je.sibling;return ge}function g(je,ge){return je=aa(je,ge),je.index=0,je.sibling=null,je}function y(je,ge,Ie){return je.index=Ie,i?(Ie=je.alternate,Ie!==null?(Ie=Ie.index,Ie<ge?(je.flags|=67108866,ge):Ie):(je.flags|=67108866,ge)):(je.flags|=1048576,ge)}function P(je){return i&&je.alternate===null&&(je.flags|=67108866),je}function q(je,ge,Ie,Ge){return ge===null||ge.tag!==6?(ge=Sl(Ie,je.mode,Ge),ge.return=je,ge):(ge=g(ge,Ie),ge.return=je,ge)}function ae(je,ge,Ie,Ge){var bt=Ie.type;return bt===O?qe(je,ge,Ie.props.children,Ge,Ie.key):ge!==null&&(ge.elementType===bt||typeof bt=="object"&&bt!==null&&bt.$$typeof===B&&Iv(bt)===ge.type)?(ge=g(ge,Ie.props),im(ge,Ie),ge.return=je,ge):(ge=qd(Ie.type,Ie.key,Ie.props,null,je.mode,Ge),im(ge,Ie),ge.return=je,ge)}function Te(je,ge,Ie,Ge){return ge===null||ge.tag!==4||ge.stateNode.containerInfo!==Ie.containerInfo||ge.stateNode.implementation!==Ie.implementation?(ge=kh(Ie,je.mode,Ge),ge.return=je,ge):(ge=g(ge,Ie.children||[]),ge.return=je,ge)}function qe(je,ge,Ie,Ge,bt){return ge===null||ge.tag!==7?(ge=oa(Ie,je.mode,Ge,bt),ge.return=je,ge):(ge=g(ge,Ie),ge.return=je,ge)}function Qe(je,ge,Ie){if(typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint")return ge=Sl(""+ge,je.mode,Ie),ge.return=je,ge;if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case N:return Ie=qd(ge.type,ge.key,ge.props,null,je.mode,Ie),im(Ie,ge),Ie.return=je,Ie;case R:return ge=kh(ge,je.mode,Ie),ge.return=je,ge;case B:var Ge=ge._init;return ge=Ge(ge._payload),Qe(je,ge,Ie)}if(Pe(ge)||z(ge))return ge=oa(ge,je.mode,Ie,null),ge.return=je,ge;if(typeof ge.then=="function")return Qe(je,vp(ge),Ie);if(ge.$$typeof===Z)return Qe(je,Cl(je,ge),Ie);Np(je,ge)}return null}function Ae(je,ge,Ie,Ge){var bt=ge!==null?ge.key:null;if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint")return bt!==null?null:q(je,ge,""+Ie,Ge);if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case N:return Ie.key===bt?ae(je,ge,Ie,Ge):null;case R:return Ie.key===bt?Te(je,ge,Ie,Ge):null;case B:return bt=Ie._init,Ie=bt(Ie._payload),Ae(je,ge,Ie,Ge)}if(Pe(Ie)||z(Ie))return bt!==null?null:qe(je,ge,Ie,Ge,null);if(typeof Ie.then=="function")return Ae(je,ge,vp(Ie),Ge);if(Ie.$$typeof===Z)return Ae(je,ge,Cl(je,Ie),Ge);Np(je,Ie)}return null}function Re(je,ge,Ie,Ge,bt){if(typeof Ge=="string"&&Ge!==""||typeof Ge=="number"||typeof Ge=="bigint")return je=je.get(Ie)||null,q(ge,je,""+Ge,bt);if(typeof Ge=="object"&&Ge!==null){switch(Ge.$$typeof){case N:return je=je.get(Ge.key===null?Ie:Ge.key)||null,ae(ge,je,Ge,bt);case R:return je=je.get(Ge.key===null?Ie:Ge.key)||null,Te(ge,je,Ge,bt);case B:var Zt=Ge._init;return Ge=Zt(Ge._payload),Re(je,ge,Ie,Ge,bt)}if(Pe(Ge)||z(Ge))return je=je.get(Ie)||null,qe(ge,je,Ge,bt,null);if(typeof Ge.then=="function")return Re(je,ge,Ie,vp(Ge),bt);if(Ge.$$typeof===Z)return Re(je,ge,Ie,Cl(ge,Ge),bt);Np(ge,Ge)}return null}function zt(je,ge,Ie,Ge){for(var bt=null,Zt=null,St=ge,Ot=ge=0,or=null;St!==null&&Ot<Ie.length;Ot++){St.index>Ot?(or=St,St=null):or=St.sibling;var jn=Ae(je,St,Ie[Ot],Ge);if(jn===null){St===null&&(St=or);break}i&&St&&jn.alternate===null&&o(je,St),ge=y(jn,ge,Ot),Zt===null?bt=jn:Zt.sibling=jn,Zt=jn,St=or}if(Ot===Ie.length)return d(je,St),bn&&Co(je,Ot),bt;if(St===null){for(;Ot<Ie.length;Ot++)St=Qe(je,Ie[Ot],Ge),St!==null&&(ge=y(St,ge,Ot),Zt===null?bt=St:Zt.sibling=St,Zt=St);return bn&&Co(je,Ot),bt}for(St=h(St);Ot<Ie.length;Ot++)or=Re(St,je,Ot,Ie[Ot],Ge),or!==null&&(i&&or.alternate!==null&&St.delete(or.key===null?Ot:or.key),ge=y(or,ge,Ot),Zt===null?bt=or:Zt.sibling=or,Zt=or);return i&&St.forEach(function(Ql){return o(je,Ql)}),bn&&Co(je,Ot),bt}function Pt(je,ge,Ie,Ge){if(Ie==null)throw Error(s(151));for(var bt=null,Zt=null,St=ge,Ot=ge=0,or=null,jn=Ie.next();St!==null&&!jn.done;Ot++,jn=Ie.next()){St.index>Ot?(or=St,St=null):or=St.sibling;var Ql=Ae(je,St,jn.value,Ge);if(Ql===null){St===null&&(St=or);break}i&&St&&Ql.alternate===null&&o(je,St),ge=y(Ql,ge,Ot),Zt===null?bt=Ql:Zt.sibling=Ql,Zt=Ql,St=or}if(jn.done)return d(je,St),bn&&Co(je,Ot),bt;if(St===null){for(;!jn.done;Ot++,jn=Ie.next())jn=Qe(je,jn.value,Ge),jn!==null&&(ge=y(jn,ge,Ot),Zt===null?bt=jn:Zt.sibling=jn,Zt=jn);return bn&&Co(je,Ot),bt}for(St=h(St);!jn.done;Ot++,jn=Ie.next())jn=Re(St,je,Ot,jn.value,Ge),jn!==null&&(i&&jn.alternate!==null&&St.delete(jn.key===null?Ot:jn.key),ge=y(jn,ge,Ot),Zt===null?bt=jn:Zt.sibling=jn,Zt=jn);return i&&St.forEach(function(xA){return o(je,xA)}),bn&&Co(je,Ot),bt}function Vn(je,ge,Ie,Ge){if(typeof Ie=="object"&&Ie!==null&&Ie.type===O&&Ie.key===null&&(Ie=Ie.props.children),typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case N:e:{for(var bt=Ie.key;ge!==null;){if(ge.key===bt){if(bt=Ie.type,bt===O){if(ge.tag===7){d(je,ge.sibling),Ge=g(ge,Ie.props.children),Ge.return=je,je=Ge;break e}}else if(ge.elementType===bt||typeof bt=="object"&&bt!==null&&bt.$$typeof===B&&Iv(bt)===ge.type){d(je,ge.sibling),Ge=g(ge,Ie.props),im(Ge,Ie),Ge.return=je,je=Ge;break e}d(je,ge);break}else o(je,ge);ge=ge.sibling}Ie.type===O?(Ge=oa(Ie.props.children,je.mode,Ge,Ie.key),Ge.return=je,je=Ge):(Ge=qd(Ie.type,Ie.key,Ie.props,null,je.mode,Ge),im(Ge,Ie),Ge.return=je,je=Ge)}return P(je);case R:e:{for(bt=Ie.key;ge!==null;){if(ge.key===bt)if(ge.tag===4&&ge.stateNode.containerInfo===Ie.containerInfo&&ge.stateNode.implementation===Ie.implementation){d(je,ge.sibling),Ge=g(ge,Ie.children||[]),Ge.return=je,je=Ge;break e}else{d(je,ge);break}else o(je,ge);ge=ge.sibling}Ge=kh(Ie,je.mode,Ge),Ge.return=je,je=Ge}return P(je);case B:return bt=Ie._init,Ie=bt(Ie._payload),Vn(je,ge,Ie,Ge)}if(Pe(Ie))return zt(je,ge,Ie,Ge);if(z(Ie)){if(bt=z(Ie),typeof bt!="function")throw Error(s(150));return Ie=bt.call(Ie),Pt(je,ge,Ie,Ge)}if(typeof Ie.then=="function")return Vn(je,ge,vp(Ie),Ge);if(Ie.$$typeof===Z)return Vn(je,ge,Cl(je,Ie),Ge);Np(je,Ie)}return typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint"?(Ie=""+Ie,ge!==null&&ge.tag===6?(d(je,ge.sibling),Ge=g(ge,Ie),Ge.return=je,je=Ge):(d(je,ge),Ge=Sl(Ie,je.mode,Ge),Ge.return=je,je=Ge),P(je)):d(je,ge)}return function(je,ge,Ie,Ge){try{rm=0;var bt=Vn(je,ge,Ie,Ge);return eu=null,bt}catch(St){if(St===Dl||St===Oo)throw St;var Zt=$r(29,St,null,je.mode);return Zt.lanes=Ge,Zt.return=je,Zt}finally{}}}var tu=Tv(!0),Cv=Tv(!1),Qi=E(null),Fa=null;function Rl(i){var o=i.alternate;F(Xs,Xs.current&1),F(Qi,i),Fa===null&&(o===null||Rt.current!==null||o.memoizedState!==null)&&(Fa=i)}function Av(i){if(i.tag===22){if(F(Xs,Xs.current),F(Qi,i),Fa===null){var o=i.alternate;o!==null&&o.memoizedState!==null&&(Fa=i)}}else Pl()}function Pl(){F(Xs,Xs.current),F(Qi,Qi.current)}function Lo(i){D(Qi),Fa===i&&(Fa=null),D(Xs)}var Xs=E(0);function jp(i){for(var o=i;o!==null;){if(o.tag===13){var d=o.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||Gy(d)))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}function sy(i,o,d,h){o=i.memoizedState,d=d(h,o),d=d==null?o:b({},o,d),i.memoizedState=d,i.lanes===0&&(i.updateQueue.baseState=d)}var ry={enqueueSetState:function(i,o,d){i=i._reactInternals;var h=vi(),g=He(h);g.payload=o,d!=null&&(g.callback=d),o=st(i,g,h),o!==null&&(Ni(o,i,h),ut(o,i,h))},enqueueReplaceState:function(i,o,d){i=i._reactInternals;var h=vi(),g=He(h);g.tag=1,g.payload=o,d!=null&&(g.callback=d),o=st(i,g,h),o!==null&&(Ni(o,i,h),ut(o,i,h))},enqueueForceUpdate:function(i,o){i=i._reactInternals;var d=vi(),h=He(d);h.tag=2,o!=null&&(h.callback=o),o=st(i,h,d),o!==null&&(Ni(o,i,d),ut(o,i,d))}};function Dv(i,o,d,h,g,y,P){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(h,y,P):o.prototype&&o.prototype.isPureReactComponent?!jo(d,h)||!jo(g,y):!0}function Rv(i,o,d,h){i=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(d,h),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(d,h),o.state!==i&&ry.enqueueReplaceState(o,o.state,null)}function Gc(i,o){var d=o;if("ref"in o){d={};for(var h in o)h!=="ref"&&(d[h]=o[h])}if(i=i.defaultProps){d===o&&(d=b({},d));for(var g in i)d[g]===void 0&&(d[g]=i[g])}return d}var _p=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)};function Pv(i){_p(i)}function kv(i){console.error(i)}function Ov(i){_p(i)}function Ep(i,o){try{var d=i.onUncaughtError;d(o.value,{componentStack:o.stack})}catch(h){setTimeout(function(){throw h})}}function Mv(i,o,d){try{var h=i.onCaughtError;h(d.value,{componentStack:d.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function iy(i,o,d){return d=He(d),d.tag=3,d.payload={element:null},d.callback=function(){Ep(i,o)},d}function Lv(i){return i=He(i),i.tag=3,i}function Fv(i,o,d,h){var g=d.type.getDerivedStateFromError;if(typeof g=="function"){var y=h.value;i.payload=function(){return g(y)},i.callback=function(){Mv(o,d,h)}}var P=d.stateNode;P!==null&&typeof P.componentDidCatch=="function"&&(i.callback=function(){Mv(o,d,h),typeof g!="function"&&(Ul===null?Ul=new Set([this]):Ul.add(this));var q=h.stack;this.componentDidCatch(h.value,{componentStack:q!==null?q:""})})}function xC(i,o,d,h,g){if(d.flags|=32768,h!==null&&typeof h=="object"&&typeof h.then=="function"){if(o=d.alternate,o!==null&&zc(o,d,g,!0),d=Qi.current,d!==null){switch(d.tag){case 13:return Fa===null?Cy():d.alternate===null&&ys===0&&(ys=3),d.flags&=-257,d.flags|=65536,d.lanes=g,h===Hh?d.flags|=16384:(o=d.updateQueue,o===null?d.updateQueue=new Set([h]):o.add(h),Dy(i,h,g)),!1;case 22:return d.flags|=65536,h===Hh?d.flags|=16384:(o=d.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([h])},d.updateQueue=o):(d=o.retryQueue,d===null?o.retryQueue=new Set([h]):d.add(h)),Dy(i,h,g)),!1}throw Error(s(435,d.tag))}return Dy(i,h,g),Cy(),!1}if(bn)return o=Qi.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=g,h!==Pa&&(i=Error(s(422),{cause:h}),gi(Vr(i,d)))):(h!==Pa&&(o=Error(s(423),{cause:h}),gi(Vr(o,d))),i=i.current.alternate,i.flags|=65536,g&=-g,i.lanes|=g,h=Vr(h,d),g=iy(i.stateNode,h,g),xt(i,g),ys!==4&&(ys=2)),!1;var y=Error(s(520),{cause:h});if(y=Vr(y,d),hm===null?hm=[y]:hm.push(y),ys!==4&&(ys=2),o===null)return!0;h=Vr(h,d),d=o;do{switch(d.tag){case 3:return d.flags|=65536,i=g&-g,d.lanes|=i,i=iy(d.stateNode,h,i),xt(d,i),!1;case 1:if(o=d.type,y=d.stateNode,(d.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Ul===null||!Ul.has(y))))return d.flags|=65536,g&=-g,d.lanes|=g,g=Lv(g),Fv(g,i,d,h),xt(d,g),!1}d=d.return}while(d!==null);return!1}var Uv=Error(s(461)),ir=!1;function gr(i,o,d,h){o.child=i===null?Cv(o,null,d,h):tu(o,i.child,d,h)}function Vv(i,o,d,h,g){d=d.render;var y=o.ref;if("ref"in h){var P={};for(var q in h)q!=="ref"&&(P[q]=h[q])}else P=h;return Do(o),h=ei(i,o,d,P,y,g),q=Ks(),i!==null&&!ir?(Ar(i,o,g),Fo(i,o,g)):(bn&&q&&Oh(o),o.flags|=1,gr(i,o,h,g),o.child)}function zv(i,o,d,h,g){if(i===null){var y=d.type;return typeof y=="function"&&!Ph(y)&&y.defaultProps===void 0&&d.compare===null?(o.tag=15,o.type=y,$v(i,o,y,h,g)):(i=qd(d.type,null,h,o,o.mode,g),i.ref=o.ref,i.return=o,o.child=i)}if(y=i.child,!my(i,g)){var P=y.memoizedProps;if(d=d.compare,d=d!==null?d:jo,d(P,h)&&i.ref===o.ref)return Fo(i,o,g)}return o.flags|=1,i=aa(y,h),i.ref=o.ref,i.return=o,o.child=i}function $v(i,o,d,h,g){if(i!==null){var y=i.memoizedProps;if(jo(y,h)&&i.ref===o.ref)if(ir=!1,o.pendingProps=h=y,my(i,g))(i.flags&131072)!==0&&(ir=!0);else return o.lanes=i.lanes,Fo(i,o,g)}return ay(i,o,d,h,g)}function Bv(i,o,d){var h=o.pendingProps,g=h.children,y=i!==null?i.memoizedState:null;if(h.mode==="hidden"){if((o.flags&128)!==0){if(h=y!==null?y.baseLanes|d:d,i!==null){for(g=o.child=i.child,y=0;g!==null;)y=y|g.lanes|g.childLanes,g=g.sibling;o.childLanes=y&~h}else o.childLanes=0,o.child=null;return qv(i,o,h,d)}if((d&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},i!==null&&Hd(o,y!==null?y.cachePool:null),y!==null?An(o,y):Wt(),Av(o);else return o.lanes=o.childLanes=536870912,qv(i,o,y!==null?y.baseLanes|d:d,d)}else y!==null?(Hd(o,y.cachePool),An(o,y),Pl(),o.memoizedState=null):(i!==null&&Hd(o,null),Wt(),Pl());return gr(i,o,g,d),o.child}function qv(i,o,d,h){var g=qh();return g=g===null?null:{parent:xs._currentValue,pool:g},o.memoizedState={baseLanes:d,cachePool:g},i!==null&&Hd(o,null),Wt(),Av(o),i!==null&&zc(i,o,h,!0),null}function Sp(i,o){var d=o.ref;if(d===null)i!==null&&i.ref!==null&&(o.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(s(284));(i===null||i.ref!==d)&&(o.flags|=4194816)}}function ay(i,o,d,h,g){return Do(o),d=ei(i,o,d,h,void 0,g),h=Ks(),i!==null&&!ir?(Ar(i,o,g),Fo(i,o,g)):(bn&&h&&Oh(o),o.flags|=1,gr(i,o,d,g),o.child)}function Hv(i,o,d,h,g,y){return Do(o),o.updateQueue=null,d=Cs(o,h,d,g),Mo(i),h=Ks(),i!==null&&!ir?(Ar(i,o,y),Fo(i,o,y)):(bn&&h&&Oh(o),o.flags|=1,gr(i,o,d,y),o.child)}function Gv(i,o,d,h,g){if(Do(o),o.stateNode===null){var y=El,P=d.contextType;typeof P=="object"&&P!==null&&(y=Qs(P)),y=new d(h,y),o.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=ry,o.stateNode=y,y._reactInternals=o,y=o.stateNode,y.props=h,y.state=o.memoizedState,y.refs={},Ne(o),P=d.contextType,y.context=typeof P=="object"&&P!==null?Qs(P):El,y.state=o.memoizedState,P=d.getDerivedStateFromProps,typeof P=="function"&&(sy(o,d,P,h),y.state=o.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(P=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),P!==y.state&&ry.enqueueReplaceState(y,y.state,null),Ct(o,h,y,g),$t(),y.state=o.memoizedState),typeof y.componentDidMount=="function"&&(o.flags|=4194308),h=!0}else if(i===null){y=o.stateNode;var q=o.memoizedProps,ae=Gc(d,q);y.props=ae;var Te=y.context,qe=d.contextType;P=El,typeof qe=="object"&&qe!==null&&(P=Qs(qe));var Qe=d.getDerivedStateFromProps;qe=typeof Qe=="function"||typeof y.getSnapshotBeforeUpdate=="function",q=o.pendingProps!==q,qe||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(q||Te!==P)&&Rv(o,y,h,P),xe=!1;var Ae=o.memoizedState;y.state=Ae,Ct(o,h,y,g),$t(),Te=o.memoizedState,q||Ae!==Te||xe?(typeof Qe=="function"&&(sy(o,d,Qe,h),Te=o.memoizedState),(ae=xe||Dv(o,d,ae,h,Ae,Te,P))?(qe||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(o.flags|=4194308)):(typeof y.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=h,o.memoizedState=Te),y.props=h,y.state=Te,y.context=P,h=ae):(typeof y.componentDidMount=="function"&&(o.flags|=4194308),h=!1)}else{y=o.stateNode,Me(i,o),P=o.memoizedProps,qe=Gc(d,P),y.props=qe,Qe=o.pendingProps,Ae=y.context,Te=d.contextType,ae=El,typeof Te=="object"&&Te!==null&&(ae=Qs(Te)),q=d.getDerivedStateFromProps,(Te=typeof q=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(P!==Qe||Ae!==ae)&&Rv(o,y,h,ae),xe=!1,Ae=o.memoizedState,y.state=Ae,Ct(o,h,y,g),$t();var Re=o.memoizedState;P!==Qe||Ae!==Re||xe||i!==null&&i.dependencies!==null&&$c(i.dependencies)?(typeof q=="function"&&(sy(o,d,q,h),Re=o.memoizedState),(qe=xe||Dv(o,d,qe,h,Ae,Re,ae)||i!==null&&i.dependencies!==null&&$c(i.dependencies))?(Te||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(h,Re,ae),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(h,Re,ae)),typeof y.componentDidUpdate=="function"&&(o.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof y.componentDidUpdate!="function"||P===i.memoizedProps&&Ae===i.memoizedState||(o.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||P===i.memoizedProps&&Ae===i.memoizedState||(o.flags|=1024),o.memoizedProps=h,o.memoizedState=Re),y.props=h,y.state=Re,y.context=ae,h=qe):(typeof y.componentDidUpdate!="function"||P===i.memoizedProps&&Ae===i.memoizedState||(o.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||P===i.memoizedProps&&Ae===i.memoizedState||(o.flags|=1024),h=!1)}return y=h,Sp(i,o),h=(o.flags&128)!==0,y||h?(y=o.stateNode,d=h&&typeof d.getDerivedStateFromError!="function"?null:y.render(),o.flags|=1,i!==null&&h?(o.child=tu(o,i.child,null,g),o.child=tu(o,null,d,g)):gr(i,o,d,g),o.memoizedState=y.state,i=o.child):i=Fo(i,o,g),i}function Qv(i,o,d,h){return Vc(),o.flags|=256,gr(i,o,d,h),o.child}var oy={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ly(i){return{baseLanes:i,cachePool:up()}}function cy(i,o,d){return i=i!==null?i.childLanes&~d:0,o&&(i|=Wi),i}function Wv(i,o,d){var h=o.pendingProps,g=!1,y=(o.flags&128)!==0,P;if((P=y)||(P=i!==null&&i.memoizedState===null?!1:(Xs.current&2)!==0),P&&(g=!0,o.flags&=-129),P=(o.flags&32)!==0,o.flags&=-33,i===null){if(bn){if(g?Rl(o):Pl(),bn){var q=Qn,ae;if(ae=q){e:{for(ae=q,q=Hi;ae.nodeType!==8;){if(!q){q=null;break e}if(ae=ma(ae.nextSibling),ae===null){q=null;break e}}q=ae}q!==null?(o.memoizedState={dehydrated:q,treeContext:To!==null?{id:la,overflow:pr}:null,retryLane:536870912,hydrationErrors:null},ae=$r(18,null,null,0),ae.stateNode=q,ae.return=o,o.child=ae,Us=o,Qn=null,ae=!0):ae=!1}ae||ca(o)}if(q=o.memoizedState,q!==null&&(q=q.dehydrated,q!==null))return Gy(q)?o.lanes=32:o.lanes=536870912,null;Lo(o)}return q=h.children,h=h.fallback,g?(Pl(),g=o.mode,q=Ip({mode:"hidden",children:q},g),h=oa(h,g,d,null),q.return=o,h.return=o,q.sibling=h,o.child=q,g=o.child,g.memoizedState=ly(d),g.childLanes=cy(i,P,d),o.memoizedState=oy,h):(Rl(o),dy(o,q))}if(ae=i.memoizedState,ae!==null&&(q=ae.dehydrated,q!==null)){if(y)o.flags&256?(Rl(o),o.flags&=-257,o=uy(i,o,d)):o.memoizedState!==null?(Pl(),o.child=i.child,o.flags|=128,o=null):(Pl(),g=h.fallback,q=o.mode,h=Ip({mode:"visible",children:h.children},q),g=oa(g,q,d,null),g.flags|=2,h.return=o,g.return=o,h.sibling=g,o.child=h,tu(o,i.child,null,d),h=o.child,h.memoizedState=ly(d),h.childLanes=cy(i,P,d),o.memoizedState=oy,o=g);else if(Rl(o),Gy(q)){if(P=q.nextSibling&&q.nextSibling.dataset,P)var Te=P.dgst;P=Te,h=Error(s(419)),h.stack="",h.digest=P,gi({value:h,source:null,stack:null}),o=uy(i,o,d)}else if(ir||zc(i,o,d,!1),P=(d&i.childLanes)!==0,ir||P){if(P=Wn,P!==null&&(h=d&-d,h=(h&42)!==0?1:$e(h),h=(h&(P.suspendedLanes|d))!==0?0:h,h!==0&&h!==ae.retryLane))throw ae.retryLane=h,Ir(i,h),Ni(P,i,h),Uv;q.data==="$?"||Cy(),o=uy(i,o,d)}else q.data==="$?"?(o.flags|=192,o.child=i.child,o=null):(i=ae.treeContext,Qn=ma(q.nextSibling),Us=o,bn=!0,Ra=null,Hi=!1,i!==null&&(Tr[Yr++]=la,Tr[Yr++]=pr,Tr[Yr++]=To,la=i.id,pr=i.overflow,To=o),o=dy(o,h.children),o.flags|=4096);return o}return g?(Pl(),g=h.fallback,q=o.mode,ae=i.child,Te=ae.sibling,h=aa(ae,{mode:"hidden",children:h.children}),h.subtreeFlags=ae.subtreeFlags&65011712,Te!==null?g=aa(Te,g):(g=oa(g,q,d,null),g.flags|=2),g.return=o,h.return=o,h.sibling=g,o.child=h,h=g,g=o.child,q=i.child.memoizedState,q===null?q=ly(d):(ae=q.cachePool,ae!==null?(Te=xs._currentValue,ae=ae.parent!==Te?{parent:Te,pool:Te}:ae):ae=up(),q={baseLanes:q.baseLanes|d,cachePool:ae}),g.memoizedState=q,g.childLanes=cy(i,P,d),o.memoizedState=oy,h):(Rl(o),d=i.child,i=d.sibling,d=aa(d,{mode:"visible",children:h.children}),d.return=o,d.sibling=null,i!==null&&(P=o.deletions,P===null?(o.deletions=[i],o.flags|=16):P.push(i)),o.child=d,o.memoizedState=null,d)}function dy(i,o){return o=Ip({mode:"visible",children:o},i.mode),o.return=i,i.child=o}function Ip(i,o){return i=$r(22,i,null,o),i.lanes=0,i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},i}function uy(i,o,d){return tu(o,i.child,null,d),i=dy(o,o.pendingProps.children),i.flags|=2,o.memoizedState=null,i}function Kv(i,o,d){i.lanes|=o;var h=i.alternate;h!==null&&(h.lanes|=o),Uh(i.return,o,d)}function hy(i,o,d,h,g){var y=i.memoizedState;y===null?i.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:h,tail:d,tailMode:g}:(y.isBackwards=o,y.rendering=null,y.renderingStartTime=0,y.last=h,y.tail=d,y.tailMode=g)}function Yv(i,o,d){var h=o.pendingProps,g=h.revealOrder,y=h.tail;if(gr(i,o,h.children,d),h=Xs.current,(h&2)!==0)h=h&1|2,o.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=o.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Kv(i,d,o);else if(i.tag===19)Kv(i,d,o);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===o)break e;for(;i.sibling===null;){if(i.return===null||i.return===o)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}h&=1}switch(F(Xs,h),g){case"forwards":for(d=o.child,g=null;d!==null;)i=d.alternate,i!==null&&jp(i)===null&&(g=d),d=d.sibling;d=g,d===null?(g=o.child,o.child=null):(g=d.sibling,d.sibling=null),hy(o,!1,g,d,y);break;case"backwards":for(d=null,g=o.child,o.child=null;g!==null;){if(i=g.alternate,i!==null&&jp(i)===null){o.child=g;break}i=g.sibling,g.sibling=d,d=g,g=i}hy(o,!0,d,null,y);break;case"together":hy(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Fo(i,o,d){if(i!==null&&(o.dependencies=i.dependencies),Fl|=o.lanes,(d&o.childLanes)===0)if(i!==null){if(zc(i,o,d,!1),(d&o.childLanes)===0)return null}else return null;if(i!==null&&o.child!==i.child)throw Error(s(153));if(o.child!==null){for(i=o.child,d=aa(i,i.pendingProps),o.child=d,d.return=o;i.sibling!==null;)i=i.sibling,d=d.sibling=aa(i,i.pendingProps),d.return=o;d.sibling=null}return o.child}function my(i,o){return(i.lanes&o)!==0?!0:(i=i.dependencies,!!(i!==null&&$c(i)))}function yC(i,o,d){switch(o.tag){case 3:I(o,o.stateNode.containerInfo),ka(o,xs,i.memoizedState.cache),Vc();break;case 27:case 5:We(o);break;case 4:I(o,o.stateNode.containerInfo);break;case 10:ka(o,o.type,o.memoizedProps.value);break;case 13:var h=o.memoizedState;if(h!==null)return h.dehydrated!==null?(Rl(o),o.flags|=128,null):(d&o.child.childLanes)!==0?Wv(i,o,d):(Rl(o),i=Fo(i,o,d),i!==null?i.sibling:null);Rl(o);break;case 19:var g=(i.flags&128)!==0;if(h=(d&o.childLanes)!==0,h||(zc(i,o,d,!1),h=(d&o.childLanes)!==0),g){if(h)return Yv(i,o,d);o.flags|=128}if(g=o.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),F(Xs,Xs.current),h)break;return null;case 22:case 23:return o.lanes=0,Bv(i,o,d);case 24:ka(o,xs,i.memoizedState.cache)}return Fo(i,o,d)}function Xv(i,o,d){if(i!==null)if(i.memoizedProps!==o.pendingProps)ir=!0;else{if(!my(i,d)&&(o.flags&128)===0)return ir=!1,yC(i,o,d);ir=(i.flags&131072)!==0}else ir=!1,bn&&(o.flags&1048576)!==0&&ap(o,Il,o.index);switch(o.lanes=0,o.tag){case 16:e:{i=o.pendingProps;var h=o.elementType,g=h._init;if(h=g(h._payload),o.type=h,typeof h=="function")Ph(h)?(i=Gc(h,i),o.tag=1,o=Gv(null,o,h,i,d)):(o.tag=0,o=ay(null,o,h,i,d));else{if(h!=null){if(g=h.$$typeof,g===ie){o.tag=11,o=Vv(null,o,h,i,d);break e}else if(g===H){o.tag=14,o=zv(null,o,h,i,d);break e}}throw o=de(h)||h,Error(s(306,o,""))}}return o;case 0:return ay(i,o,o.type,o.pendingProps,d);case 1:return h=o.type,g=Gc(h,o.pendingProps),Gv(i,o,h,g,d);case 3:e:{if(I(o,o.stateNode.containerInfo),i===null)throw Error(s(387));h=o.pendingProps;var y=o.memoizedState;g=y.element,Me(i,o),Ct(o,h,null,d);var P=o.memoizedState;if(h=P.cache,ka(o,xs,h),h!==y.cache&&Vh(o,[xs],d,!0),$t(),h=P.element,y.isDehydrated)if(y={element:h,isDehydrated:!1,cache:P.cache},o.updateQueue.baseState=y,o.memoizedState=y,o.flags&256){o=Qv(i,o,h,d);break e}else if(h!==g){g=Vr(Error(s(424)),o),gi(g),o=Qv(i,o,h,d);break e}else{switch(i=o.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(Qn=ma(i.firstChild),Us=o,bn=!0,Ra=null,Hi=!0,d=Cv(o,null,h,d),o.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling}else{if(Vc(),h===g){o=Fo(i,o,d);break e}gr(i,o,h,d)}o=o.child}return o;case 26:return Sp(i,o),i===null?(d=tj(o.type,null,o.pendingProps,null))?o.memoizedState=d:bn||(d=o.type,i=o.pendingProps,h=zp(Q.current).createElement(d),h[Ve]=o,h[Tt]=i,yr(h,d,i),en(h),o.stateNode=h):o.memoizedState=tj(o.type,i.memoizedProps,o.pendingProps,i.memoizedState),null;case 27:return We(o),i===null&&bn&&(h=o.stateNode=JN(o.type,o.pendingProps,Q.current),Us=o,Hi=!0,g=Qn,$l(o.type)?(Qy=g,Qn=ma(h.firstChild)):Qn=g),gr(i,o,o.pendingProps.children,d),Sp(i,o),i===null&&(o.flags|=4194304),o.child;case 5:return i===null&&bn&&((g=h=Qn)&&(h=GC(h,o.type,o.pendingProps,Hi),h!==null?(o.stateNode=h,Us=o,Qn=ma(h.firstChild),Hi=!1,g=!0):g=!1),g||ca(o)),We(o),g=o.type,y=o.pendingProps,P=i!==null?i.memoizedProps:null,h=y.children,By(g,y)?h=null:P!==null&&By(g,P)&&(o.flags|=32),o.memoizedState!==null&&(g=ei(i,o,Dn,null,null,d),vm._currentValue=g),Sp(i,o),gr(i,o,h,d),o.child;case 6:return i===null&&bn&&((i=d=Qn)&&(d=QC(d,o.pendingProps,Hi),d!==null?(o.stateNode=d,Us=o,Qn=null,i=!0):i=!1),i||ca(o)),null;case 13:return Wv(i,o,d);case 4:return I(o,o.stateNode.containerInfo),h=o.pendingProps,i===null?o.child=tu(o,null,h,d):gr(i,o,h,d),o.child;case 11:return Vv(i,o,o.type,o.pendingProps,d);case 7:return gr(i,o,o.pendingProps,d),o.child;case 8:return gr(i,o,o.pendingProps.children,d),o.child;case 12:return gr(i,o,o.pendingProps.children,d),o.child;case 10:return h=o.pendingProps,ka(o,o.type,h.value),gr(i,o,h.children,d),o.child;case 9:return g=o.type._context,h=o.pendingProps.children,Do(o),g=Qs(g),h=h(g),o.flags|=1,gr(i,o,h,d),o.child;case 14:return zv(i,o,o.type,o.pendingProps,d);case 15:return $v(i,o,o.type,o.pendingProps,d);case 19:return Yv(i,o,d);case 31:return h=o.pendingProps,d=o.mode,h={mode:h.mode,children:h.children},i===null?(d=Ip(h,d),d.ref=o.ref,o.child=d,d.return=o,o=d):(d=aa(i.child,h),d.ref=o.ref,o.child=d,d.return=o,o=d),o;case 22:return Bv(i,o,d);case 24:return Do(o),h=Qs(xs),i===null?(g=qh(),g===null&&(g=Wn,y=Bc(),g.pooledCache=y,y.refCount++,y!==null&&(g.pooledCacheLanes|=d),g=y),o.memoizedState={parent:h,cache:g},Ne(o),ka(o,xs,g)):((i.lanes&d)!==0&&(Me(i,o),Ct(o,null,null,d),$t()),g=i.memoizedState,y=o.memoizedState,g.parent!==h?(g={parent:h,cache:h},o.memoizedState=g,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=g),ka(o,xs,h)):(h=y.cache,ka(o,xs,h),h!==g.cache&&Vh(o,[xs],d,!0))),gr(i,o,o.pendingProps.children,d),o.child;case 29:throw o.pendingProps}throw Error(s(156,o.tag))}function Uo(i){i.flags|=4}function Jv(i,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!aj(o)){if(o=Qi.current,o!==null&&((xn&4194048)===xn?Fa!==null:(xn&62914560)!==xn&&(xn&536870912)===0||o!==Fa))throw x=Hh,qc;i.flags|=8192}}function Tp(i,o){o!==null&&(i.flags|=4),i.flags&16384&&(o=i.tag!==22?Be():536870912,i.lanes|=o,iu|=o)}function am(i,o){if(!bn)switch(i.tailMode){case"hidden":o=i.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?i.tail=null:d.sibling=null;break;case"collapsed":d=i.tail;for(var h=null;d!==null;)d.alternate!==null&&(h=d),d=d.sibling;h===null?o||i.tail===null?i.tail=null:i.tail.sibling=null:h.sibling=null}}function ds(i){var o=i.alternate!==null&&i.alternate.child===i.child,d=0,h=0;if(o)for(var g=i.child;g!==null;)d|=g.lanes|g.childLanes,h|=g.subtreeFlags&65011712,h|=g.flags&65011712,g.return=i,g=g.sibling;else for(g=i.child;g!==null;)d|=g.lanes|g.childLanes,h|=g.subtreeFlags,h|=g.flags,g.return=i,g=g.sibling;return i.subtreeFlags|=h,i.childLanes=d,o}function bC(i,o,d){var h=o.pendingProps;switch(Mh(o),o.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ds(o),null;case 1:return ds(o),null;case 3:return d=o.stateNode,h=null,i!==null&&(h=i.memoizedState.cache),o.memoizedState.cache!==h&&(o.flags|=2048),ua(xs),le(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(i===null||i.child===null)&&(Uc(o)?Uo(o):i===null||i.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,Tl())),ds(o),null;case 26:return d=o.memoizedState,i===null?(Uo(o),d!==null?(ds(o),Jv(o,d)):(ds(o),o.flags&=-16777217)):d?d!==i.memoizedState?(Uo(o),ds(o),Jv(o,d)):(ds(o),o.flags&=-16777217):(i.memoizedProps!==h&&Uo(o),ds(o),o.flags&=-16777217),null;case 27:nt(o),d=Q.current;var g=o.type;if(i!==null&&o.stateNode!=null)i.memoizedProps!==h&&Uo(o);else{if(!h){if(o.stateNode===null)throw Error(s(166));return ds(o),null}i=te.current,Uc(o)?Lh(o):(i=JN(g,h,d),o.stateNode=i,Uo(o))}return ds(o),null;case 5:if(nt(o),d=o.type,i!==null&&o.stateNode!=null)i.memoizedProps!==h&&Uo(o);else{if(!h){if(o.stateNode===null)throw Error(s(166));return ds(o),null}if(i=te.current,Uc(o))Lh(o);else{switch(g=zp(Q.current),i){case 1:i=g.createElementNS("http://www.w3.org/2000/svg",d);break;case 2:i=g.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;default:switch(d){case"svg":i=g.createElementNS("http://www.w3.org/2000/svg",d);break;case"math":i=g.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;case"script":i=g.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild);break;case"select":i=typeof h.is=="string"?g.createElement("select",{is:h.is}):g.createElement("select"),h.multiple?i.multiple=!0:h.size&&(i.size=h.size);break;default:i=typeof h.is=="string"?g.createElement(d,{is:h.is}):g.createElement(d)}}i[Ve]=o,i[Tt]=h;e:for(g=o.child;g!==null;){if(g.tag===5||g.tag===6)i.appendChild(g.stateNode);else if(g.tag!==4&&g.tag!==27&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===o)break e;for(;g.sibling===null;){if(g.return===null||g.return===o)break e;g=g.return}g.sibling.return=g.return,g=g.sibling}o.stateNode=i;e:switch(yr(i,d,h),d){case"button":case"input":case"select":case"textarea":i=!!h.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&Uo(o)}}return ds(o),o.flags&=-16777217,null;case 6:if(i&&o.stateNode!=null)i.memoizedProps!==h&&Uo(o);else{if(typeof h!="string"&&o.stateNode===null)throw Error(s(166));if(i=Q.current,Uc(o)){if(i=o.stateNode,d=o.memoizedProps,h=null,g=Us,g!==null)switch(g.tag){case 27:case 5:h=g.memoizedProps}i[Ve]=o,i=!!(i.nodeValue===d||h!==null&&h.suppressHydrationWarning===!0||HN(i.nodeValue,d)),i||ca(o)}else i=zp(i).createTextNode(h),i[Ve]=o,o.stateNode=i}return ds(o),null;case 13:if(h=o.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(g=Uc(o),h!==null&&h.dehydrated!==null){if(i===null){if(!g)throw Error(s(318));if(g=o.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(s(317));g[Ve]=o}else Vc(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;ds(o),g=!1}else g=Tl(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=g),g=!0;if(!g)return o.flags&256?(Lo(o),o):(Lo(o),null)}if(Lo(o),(o.flags&128)!==0)return o.lanes=d,o;if(d=h!==null,i=i!==null&&i.memoizedState!==null,d){h=o.child,g=null,h.alternate!==null&&h.alternate.memoizedState!==null&&h.alternate.memoizedState.cachePool!==null&&(g=h.alternate.memoizedState.cachePool.pool);var y=null;h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(y=h.memoizedState.cachePool.pool),y!==g&&(h.flags|=2048)}return d!==i&&d&&(o.child.flags|=8192),Tp(o,o.updateQueue),ds(o),null;case 4:return le(),i===null&&Fy(o.stateNode.containerInfo),ds(o),null;case 10:return ua(o.type),ds(o),null;case 19:if(D(Xs),g=o.memoizedState,g===null)return ds(o),null;if(h=(o.flags&128)!==0,y=g.rendering,y===null)if(h)am(g,!1);else{if(ys!==0||i!==null&&(i.flags&128)!==0)for(i=o.child;i!==null;){if(y=jp(i),y!==null){for(o.flags|=128,am(g,!1),i=y.updateQueue,o.updateQueue=i,Tp(o,i),o.subtreeFlags=0,i=d,d=o.child;d!==null;)ip(d,i),d=d.sibling;return F(Xs,Xs.current&1|2),o.child}i=i.sibling}g.tail!==null&&Je()>Dp&&(o.flags|=128,h=!0,am(g,!1),o.lanes=4194304)}else{if(!h)if(i=jp(y),i!==null){if(o.flags|=128,h=!0,i=i.updateQueue,o.updateQueue=i,Tp(o,i),am(g,!0),g.tail===null&&g.tailMode==="hidden"&&!y.alternate&&!bn)return ds(o),null}else 2*Je()-g.renderingStartTime>Dp&&d!==536870912&&(o.flags|=128,h=!0,am(g,!1),o.lanes=4194304);g.isBackwards?(y.sibling=o.child,o.child=y):(i=g.last,i!==null?i.sibling=y:o.child=y,g.last=y)}return g.tail!==null?(o=g.tail,g.rendering=o,g.tail=o.sibling,g.renderingStartTime=Je(),o.sibling=null,i=Xs.current,F(Xs,h?i&1|2:i&1),o):(ds(o),null);case 22:case 23:return Lo(o),fn(),h=o.memoizedState!==null,i!==null?i.memoizedState!==null!==h&&(o.flags|=8192):h&&(o.flags|=8192),h?(d&536870912)!==0&&(o.flags&128)===0&&(ds(o),o.subtreeFlags&6&&(o.flags|=8192)):ds(o),d=o.updateQueue,d!==null&&Tp(o,d.retryQueue),d=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(d=i.memoizedState.cachePool.pool),h=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(h=o.memoizedState.cachePool.pool),h!==d&&(o.flags|=2048),i!==null&&D(ko),null;case 24:return d=null,i!==null&&(d=i.memoizedState.cache),o.memoizedState.cache!==d&&(o.flags|=2048),ua(xs),ds(o),null;case 25:return null;case 30:return null}throw Error(s(156,o.tag))}function wC(i,o){switch(Mh(o),o.tag){case 1:return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 3:return ua(xs),le(),i=o.flags,(i&65536)!==0&&(i&128)===0?(o.flags=i&-65537|128,o):null;case 26:case 27:case 5:return nt(o),null;case 13:if(Lo(o),i=o.memoizedState,i!==null&&i.dehydrated!==null){if(o.alternate===null)throw Error(s(340));Vc()}return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 19:return D(Xs),null;case 4:return le(),null;case 10:return ua(o.type),null;case 22:case 23:return Lo(o),fn(),i!==null&&D(ko),i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 24:return ua(xs),null;case 25:return null;default:return null}}function Zv(i,o){switch(Mh(o),o.tag){case 3:ua(xs),le();break;case 26:case 27:case 5:nt(o);break;case 4:le();break;case 13:Lo(o);break;case 19:D(Xs);break;case 10:ua(o.type);break;case 22:case 23:Lo(o),fn(),i!==null&&D(ko);break;case 24:ua(xs)}}function om(i,o){try{var d=o.updateQueue,h=d!==null?d.lastEffect:null;if(h!==null){var g=h.next;d=g;do{if((d.tag&i)===i){h=void 0;var y=d.create,P=d.inst;h=y(),P.destroy=h}d=d.next}while(d!==g)}}catch(q){Bn(o,o.return,q)}}function kl(i,o,d){try{var h=o.updateQueue,g=h!==null?h.lastEffect:null;if(g!==null){var y=g.next;h=y;do{if((h.tag&i)===i){var P=h.inst,q=P.destroy;if(q!==void 0){P.destroy=void 0,g=o;var ae=d,Te=q;try{Te()}catch(qe){Bn(g,ae,qe)}}}h=h.next}while(h!==y)}}catch(qe){Bn(o,o.return,qe)}}function eN(i){var o=i.updateQueue;if(o!==null){var d=i.stateNode;try{Mt(o,d)}catch(h){Bn(i,i.return,h)}}}function tN(i,o,d){d.props=Gc(i.type,i.memoizedProps),d.state=i.memoizedState;try{d.componentWillUnmount()}catch(h){Bn(i,o,h)}}function lm(i,o){try{var d=i.ref;if(d!==null){switch(i.tag){case 26:case 27:case 5:var h=i.stateNode;break;case 30:h=i.stateNode;break;default:h=i.stateNode}typeof d=="function"?i.refCleanup=d(h):d.current=h}}catch(g){Bn(i,o,g)}}function Ua(i,o){var d=i.ref,h=i.refCleanup;if(d!==null)if(typeof h=="function")try{h()}catch(g){Bn(i,o,g)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(g){Bn(i,o,g)}else d.current=null}function nN(i){var o=i.type,d=i.memoizedProps,h=i.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":d.autoFocus&&h.focus();break e;case"img":d.src?h.src=d.src:d.srcSet&&(h.srcset=d.srcSet)}}catch(g){Bn(i,i.return,g)}}function fy(i,o,d){try{var h=i.stateNode;zC(h,i.type,d,o),h[Tt]=o}catch(g){Bn(i,i.return,g)}}function sN(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&$l(i.type)||i.tag===4}function py(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||sN(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&$l(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function gy(i,o,d){var h=i.tag;if(h===5||h===6)i=i.stateNode,o?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(i,o):(o=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,o.appendChild(i),d=d._reactRootContainer,d!=null||o.onclick!==null||(o.onclick=Vp));else if(h!==4&&(h===27&&$l(i.type)&&(d=i.stateNode,o=null),i=i.child,i!==null))for(gy(i,o,d),i=i.sibling;i!==null;)gy(i,o,d),i=i.sibling}function Cp(i,o,d){var h=i.tag;if(h===5||h===6)i=i.stateNode,o?d.insertBefore(i,o):d.appendChild(i);else if(h!==4&&(h===27&&$l(i.type)&&(d=i.stateNode),i=i.child,i!==null))for(Cp(i,o,d),i=i.sibling;i!==null;)Cp(i,o,d),i=i.sibling}function rN(i){var o=i.stateNode,d=i.memoizedProps;try{for(var h=i.type,g=o.attributes;g.length;)o.removeAttributeNode(g[0]);yr(o,h,d),o[Ve]=i,o[Tt]=d}catch(y){Bn(i,i.return,y)}}var Vo=!1,As=!1,xy=!1,iN=typeof WeakSet=="function"?WeakSet:Set,ar=null;function vC(i,o){if(i=i.containerInfo,zy=Qp,i=jh(i),Vd(i)){if("selectionStart"in i)var d={start:i.selectionStart,end:i.selectionEnd};else e:{d=(d=i.ownerDocument)&&d.defaultView||window;var h=d.getSelection&&d.getSelection();if(h&&h.rangeCount!==0){d=h.anchorNode;var g=h.anchorOffset,y=h.focusNode;h=h.focusOffset;try{d.nodeType,y.nodeType}catch{d=null;break e}var P=0,q=-1,ae=-1,Te=0,qe=0,Qe=i,Ae=null;t:for(;;){for(var Re;Qe!==d||g!==0&&Qe.nodeType!==3||(q=P+g),Qe!==y||h!==0&&Qe.nodeType!==3||(ae=P+h),Qe.nodeType===3&&(P+=Qe.nodeValue.length),(Re=Qe.firstChild)!==null;)Ae=Qe,Qe=Re;for(;;){if(Qe===i)break t;if(Ae===d&&++Te===g&&(q=P),Ae===y&&++qe===h&&(ae=P),(Re=Qe.nextSibling)!==null)break;Qe=Ae,Ae=Qe.parentNode}Qe=Re}d=q===-1||ae===-1?null:{start:q,end:ae}}else d=null}d=d||{start:0,end:0}}else d=null;for($y={focusedElem:i,selectionRange:d},Qp=!1,ar=o;ar!==null;)if(o=ar,i=o.child,(o.subtreeFlags&1024)!==0&&i!==null)i.return=o,ar=i;else for(;ar!==null;){switch(o=ar,y=o.alternate,i=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((i&1024)!==0&&y!==null){i=void 0,d=o,g=y.memoizedProps,y=y.memoizedState,h=d.stateNode;try{var zt=Gc(d.type,g,d.elementType===d.type);i=h.getSnapshotBeforeUpdate(zt,y),h.__reactInternalSnapshotBeforeUpdate=i}catch(Pt){Bn(d,d.return,Pt)}}break;case 3:if((i&1024)!==0){if(i=o.stateNode.containerInfo,d=i.nodeType,d===9)Hy(i);else if(d===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":Hy(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(s(163))}if(i=o.sibling,i!==null){i.return=o.return,ar=i;break}ar=o.return}}function aN(i,o,d){var h=d.flags;switch(d.tag){case 0:case 11:case 15:Ol(i,d),h&4&&om(5,d);break;case 1:if(Ol(i,d),h&4)if(i=d.stateNode,o===null)try{i.componentDidMount()}catch(P){Bn(d,d.return,P)}else{var g=Gc(d.type,o.memoizedProps);o=o.memoizedState;try{i.componentDidUpdate(g,o,i.__reactInternalSnapshotBeforeUpdate)}catch(P){Bn(d,d.return,P)}}h&64&&eN(d),h&512&&lm(d,d.return);break;case 3:if(Ol(i,d),h&64&&(i=d.updateQueue,i!==null)){if(o=null,d.child!==null)switch(d.child.tag){case 27:case 5:o=d.child.stateNode;break;case 1:o=d.child.stateNode}try{Mt(i,o)}catch(P){Bn(d,d.return,P)}}break;case 27:o===null&&h&4&&rN(d);case 26:case 5:Ol(i,d),o===null&&h&4&&nN(d),h&512&&lm(d,d.return);break;case 12:Ol(i,d);break;case 13:Ol(i,d),h&4&&cN(i,d),h&64&&(i=d.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(d=AC.bind(null,d),WC(i,d))));break;case 22:if(h=d.memoizedState!==null||Vo,!h){o=o!==null&&o.memoizedState!==null||As,g=Vo;var y=As;Vo=h,(As=o)&&!y?Ml(i,d,(d.subtreeFlags&8772)!==0):Ol(i,d),Vo=g,As=y}break;case 30:break;default:Ol(i,d)}}function oN(i){var o=i.alternate;o!==null&&(i.alternate=null,oN(o)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(o=i.stateNode,o!==null&&Na(o)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var ss=null,ti=!1;function zo(i,o,d){for(d=d.child;d!==null;)lN(i,o,d),d=d.sibling}function lN(i,o,d){if(Kt&&typeof Kt.onCommitFiberUnmount=="function")try{Kt.onCommitFiberUnmount(mn,d)}catch{}switch(d.tag){case 26:As||Ua(d,o),zo(i,o,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:As||Ua(d,o);var h=ss,g=ti;$l(d.type)&&(ss=d.stateNode,ti=!1),zo(i,o,d),xm(d.stateNode),ss=h,ti=g;break;case 5:As||Ua(d,o);case 6:if(h=ss,g=ti,ss=null,zo(i,o,d),ss=h,ti=g,ss!==null)if(ti)try{(ss.nodeType===9?ss.body:ss.nodeName==="HTML"?ss.ownerDocument.body:ss).removeChild(d.stateNode)}catch(y){Bn(d,o,y)}else try{ss.removeChild(d.stateNode)}catch(y){Bn(d,o,y)}break;case 18:ss!==null&&(ti?(i=ss,YN(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,d.stateNode),Em(i)):YN(ss,d.stateNode));break;case 4:h=ss,g=ti,ss=d.stateNode.containerInfo,ti=!0,zo(i,o,d),ss=h,ti=g;break;case 0:case 11:case 14:case 15:As||kl(2,d,o),As||kl(4,d,o),zo(i,o,d);break;case 1:As||(Ua(d,o),h=d.stateNode,typeof h.componentWillUnmount=="function"&&tN(d,o,h)),zo(i,o,d);break;case 21:zo(i,o,d);break;case 22:As=(h=As)||d.memoizedState!==null,zo(i,o,d),As=h;break;default:zo(i,o,d)}}function cN(i,o){if(o.memoizedState===null&&(i=o.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{Em(i)}catch(d){Bn(o,o.return,d)}}function NC(i){switch(i.tag){case 13:case 19:var o=i.stateNode;return o===null&&(o=i.stateNode=new iN),o;case 22:return i=i.stateNode,o=i._retryCache,o===null&&(o=i._retryCache=new iN),o;default:throw Error(s(435,i.tag))}}function yy(i,o){var d=NC(i);o.forEach(function(h){var g=DC.bind(null,i,h);d.has(h)||(d.add(h),h.then(g,g))})}function yi(i,o){var d=o.deletions;if(d!==null)for(var h=0;h<d.length;h++){var g=d[h],y=i,P=o,q=P;e:for(;q!==null;){switch(q.tag){case 27:if($l(q.type)){ss=q.stateNode,ti=!1;break e}break;case 5:ss=q.stateNode,ti=!1;break e;case 3:case 4:ss=q.stateNode.containerInfo,ti=!0;break e}q=q.return}if(ss===null)throw Error(s(160));lN(y,P,g),ss=null,ti=!1,y=g.alternate,y!==null&&(y.return=null),g.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)dN(o,i),o=o.sibling}var ha=null;function dN(i,o){var d=i.alternate,h=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:yi(o,i),bi(i),h&4&&(kl(3,i,i.return),om(3,i),kl(5,i,i.return));break;case 1:yi(o,i),bi(i),h&512&&(As||d===null||Ua(d,d.return)),h&64&&Vo&&(i=i.updateQueue,i!==null&&(h=i.callbacks,h!==null&&(d=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=d===null?h:d.concat(h))));break;case 26:var g=ha;if(yi(o,i),bi(i),h&512&&(As||d===null||Ua(d,d.return)),h&4){var y=d!==null?d.memoizedState:null;if(h=i.memoizedState,d===null)if(h===null)if(i.stateNode===null){e:{h=i.type,d=i.memoizedProps,g=g.ownerDocument||g;t:switch(h){case"title":y=g.getElementsByTagName("title")[0],(!y||y[Ai]||y[Ve]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=g.createElement(h),g.head.insertBefore(y,g.querySelector("head > title"))),yr(y,h,d),y[Ve]=i,en(y),h=y;break e;case"link":var P=rj("link","href",g).get(h+(d.href||""));if(P){for(var q=0;q<P.length;q++)if(y=P[q],y.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&y.getAttribute("rel")===(d.rel==null?null:d.rel)&&y.getAttribute("title")===(d.title==null?null:d.title)&&y.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){P.splice(q,1);break t}}y=g.createElement(h),yr(y,h,d),g.head.appendChild(y);break;case"meta":if(P=rj("meta","content",g).get(h+(d.content||""))){for(q=0;q<P.length;q++)if(y=P[q],y.getAttribute("content")===(d.content==null?null:""+d.content)&&y.getAttribute("name")===(d.name==null?null:d.name)&&y.getAttribute("property")===(d.property==null?null:d.property)&&y.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&y.getAttribute("charset")===(d.charSet==null?null:d.charSet)){P.splice(q,1);break t}}y=g.createElement(h),yr(y,h,d),g.head.appendChild(y);break;default:throw Error(s(468,h))}y[Ve]=i,en(y),h=y}i.stateNode=h}else ij(g,i.type,i.stateNode);else i.stateNode=sj(g,h,i.memoizedProps);else y!==h?(y===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):y.count--,h===null?ij(g,i.type,i.stateNode):sj(g,h,i.memoizedProps)):h===null&&i.stateNode!==null&&fy(i,i.memoizedProps,d.memoizedProps)}break;case 27:yi(o,i),bi(i),h&512&&(As||d===null||Ua(d,d.return)),d!==null&&h&4&&fy(i,i.memoizedProps,d.memoizedProps);break;case 5:if(yi(o,i),bi(i),h&512&&(As||d===null||Ua(d,d.return)),i.flags&32){g=i.stateNode;try{qs(g,"")}catch(Re){Bn(i,i.return,Re)}}h&4&&i.stateNode!=null&&(g=i.memoizedProps,fy(i,g,d!==null?d.memoizedProps:g)),h&1024&&(xy=!0);break;case 6:if(yi(o,i),bi(i),h&4){if(i.stateNode===null)throw Error(s(162));h=i.memoizedProps,d=i.stateNode;try{d.nodeValue=h}catch(Re){Bn(i,i.return,Re)}}break;case 3:if(qp=null,g=ha,ha=$p(o.containerInfo),yi(o,i),ha=g,bi(i),h&4&&d!==null&&d.memoizedState.isDehydrated)try{Em(o.containerInfo)}catch(Re){Bn(i,i.return,Re)}xy&&(xy=!1,uN(i));break;case 4:h=ha,ha=$p(i.stateNode.containerInfo),yi(o,i),bi(i),ha=h;break;case 12:yi(o,i),bi(i);break;case 13:yi(o,i),bi(i),i.child.flags&8192&&i.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(_y=Je()),h&4&&(h=i.updateQueue,h!==null&&(i.updateQueue=null,yy(i,h)));break;case 22:g=i.memoizedState!==null;var ae=d!==null&&d.memoizedState!==null,Te=Vo,qe=As;if(Vo=Te||g,As=qe||ae,yi(o,i),As=qe,Vo=Te,bi(i),h&8192)e:for(o=i.stateNode,o._visibility=g?o._visibility&-2:o._visibility|1,g&&(d===null||ae||Vo||As||Qc(i)),d=null,o=i;;){if(o.tag===5||o.tag===26){if(d===null){ae=d=o;try{if(y=ae.stateNode,g)P=y.style,typeof P.setProperty=="function"?P.setProperty("display","none","important"):P.display="none";else{q=ae.stateNode;var Qe=ae.memoizedProps.style,Ae=Qe!=null&&Qe.hasOwnProperty("display")?Qe.display:null;q.style.display=Ae==null||typeof Ae=="boolean"?"":(""+Ae).trim()}}catch(Re){Bn(ae,ae.return,Re)}}}else if(o.tag===6){if(d===null){ae=o;try{ae.stateNode.nodeValue=g?"":ae.memoizedProps}catch(Re){Bn(ae,ae.return,Re)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===i)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break e;for(;o.sibling===null;){if(o.return===null||o.return===i)break e;d===o&&(d=null),o=o.return}d===o&&(d=null),o.sibling.return=o.return,o=o.sibling}h&4&&(h=i.updateQueue,h!==null&&(d=h.retryQueue,d!==null&&(h.retryQueue=null,yy(i,d))));break;case 19:yi(o,i),bi(i),h&4&&(h=i.updateQueue,h!==null&&(i.updateQueue=null,yy(i,h)));break;case 30:break;case 21:break;default:yi(o,i),bi(i)}}function bi(i){var o=i.flags;if(o&2){try{for(var d,h=i.return;h!==null;){if(sN(h)){d=h;break}h=h.return}if(d==null)throw Error(s(160));switch(d.tag){case 27:var g=d.stateNode,y=py(i);Cp(i,y,g);break;case 5:var P=d.stateNode;d.flags&32&&(qs(P,""),d.flags&=-33);var q=py(i);Cp(i,q,P);break;case 3:case 4:var ae=d.stateNode.containerInfo,Te=py(i);gy(i,Te,ae);break;default:throw Error(s(161))}}catch(qe){Bn(i,i.return,qe)}i.flags&=-3}o&4096&&(i.flags&=-4097)}function uN(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var o=i;uN(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),i=i.sibling}}function Ol(i,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)aN(i,o.alternate,o),o=o.sibling}function Qc(i){for(i=i.child;i!==null;){var o=i;switch(o.tag){case 0:case 11:case 14:case 15:kl(4,o,o.return),Qc(o);break;case 1:Ua(o,o.return);var d=o.stateNode;typeof d.componentWillUnmount=="function"&&tN(o,o.return,d),Qc(o);break;case 27:xm(o.stateNode);case 26:case 5:Ua(o,o.return),Qc(o);break;case 22:o.memoizedState===null&&Qc(o);break;case 30:Qc(o);break;default:Qc(o)}i=i.sibling}}function Ml(i,o,d){for(d=d&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var h=o.alternate,g=i,y=o,P=y.flags;switch(y.tag){case 0:case 11:case 15:Ml(g,y,d),om(4,y);break;case 1:if(Ml(g,y,d),h=y,g=h.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(Te){Bn(h,h.return,Te)}if(h=y,g=h.updateQueue,g!==null){var q=h.stateNode;try{var ae=g.shared.hiddenCallbacks;if(ae!==null)for(g.shared.hiddenCallbacks=null,g=0;g<ae.length;g++)Bt(ae[g],q)}catch(Te){Bn(h,h.return,Te)}}d&&P&64&&eN(y),lm(y,y.return);break;case 27:rN(y);case 26:case 5:Ml(g,y,d),d&&h===null&&P&4&&nN(y),lm(y,y.return);break;case 12:Ml(g,y,d);break;case 13:Ml(g,y,d),d&&P&4&&cN(g,y);break;case 22:y.memoizedState===null&&Ml(g,y,d),lm(y,y.return);break;case 30:break;default:Ml(g,y,d)}o=o.sibling}}function by(i,o){var d=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(d=i.memoizedState.cachePool.pool),i=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(i=o.memoizedState.cachePool.pool),i!==d&&(i!=null&&i.refCount++,d!=null&&Al(d))}function wy(i,o){i=null,o.alternate!==null&&(i=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==i&&(o.refCount++,i!=null&&Al(i))}function Va(i,o,d,h){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)hN(i,o,d,h),o=o.sibling}function hN(i,o,d,h){var g=o.flags;switch(o.tag){case 0:case 11:case 15:Va(i,o,d,h),g&2048&&om(9,o);break;case 1:Va(i,o,d,h);break;case 3:Va(i,o,d,h),g&2048&&(i=null,o.alternate!==null&&(i=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==i&&(o.refCount++,i!=null&&Al(i)));break;case 12:if(g&2048){Va(i,o,d,h),i=o.stateNode;try{var y=o.memoizedProps,P=y.id,q=y.onPostCommit;typeof q=="function"&&q(P,o.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(ae){Bn(o,o.return,ae)}}else Va(i,o,d,h);break;case 13:Va(i,o,d,h);break;case 23:break;case 22:y=o.stateNode,P=o.alternate,o.memoizedState!==null?y._visibility&2?Va(i,o,d,h):cm(i,o):y._visibility&2?Va(i,o,d,h):(y._visibility|=2,nu(i,o,d,h,(o.subtreeFlags&10256)!==0)),g&2048&&by(P,o);break;case 24:Va(i,o,d,h),g&2048&&wy(o.alternate,o);break;default:Va(i,o,d,h)}}function nu(i,o,d,h,g){for(g=g&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var y=i,P=o,q=d,ae=h,Te=P.flags;switch(P.tag){case 0:case 11:case 15:nu(y,P,q,ae,g),om(8,P);break;case 23:break;case 22:var qe=P.stateNode;P.memoizedState!==null?qe._visibility&2?nu(y,P,q,ae,g):cm(y,P):(qe._visibility|=2,nu(y,P,q,ae,g)),g&&Te&2048&&by(P.alternate,P);break;case 24:nu(y,P,q,ae,g),g&&Te&2048&&wy(P.alternate,P);break;default:nu(y,P,q,ae,g)}o=o.sibling}}function cm(i,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var d=i,h=o,g=h.flags;switch(h.tag){case 22:cm(d,h),g&2048&&by(h.alternate,h);break;case 24:cm(d,h),g&2048&&wy(h.alternate,h);break;default:cm(d,h)}o=o.sibling}}var dm=8192;function su(i){if(i.subtreeFlags&dm)for(i=i.child;i!==null;)mN(i),i=i.sibling}function mN(i){switch(i.tag){case 26:su(i),i.flags&dm&&i.memoizedState!==null&&oA(ha,i.memoizedState,i.memoizedProps);break;case 5:su(i);break;case 3:case 4:var o=ha;ha=$p(i.stateNode.containerInfo),su(i),ha=o;break;case 22:i.memoizedState===null&&(o=i.alternate,o!==null&&o.memoizedState!==null?(o=dm,dm=16777216,su(i),dm=o):su(i));break;default:su(i)}}function fN(i){var o=i.alternate;if(o!==null&&(i=o.child,i!==null)){o.child=null;do o=i.sibling,i.sibling=null,i=o;while(i!==null)}}function um(i){var o=i.deletions;if((i.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var h=o[d];ar=h,gN(h,i)}fN(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)pN(i),i=i.sibling}function pN(i){switch(i.tag){case 0:case 11:case 15:um(i),i.flags&2048&&kl(9,i,i.return);break;case 3:um(i);break;case 12:um(i);break;case 22:var o=i.stateNode;i.memoizedState!==null&&o._visibility&2&&(i.return===null||i.return.tag!==13)?(o._visibility&=-3,Ap(i)):um(i);break;default:um(i)}}function Ap(i){var o=i.deletions;if((i.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var h=o[d];ar=h,gN(h,i)}fN(i)}for(i=i.child;i!==null;){switch(o=i,o.tag){case 0:case 11:case 15:kl(8,o,o.return),Ap(o);break;case 22:d=o.stateNode,d._visibility&2&&(d._visibility&=-3,Ap(o));break;default:Ap(o)}i=i.sibling}}function gN(i,o){for(;ar!==null;){var d=ar;switch(d.tag){case 0:case 11:case 15:kl(8,d,o);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var h=d.memoizedState.cachePool.pool;h!=null&&h.refCount++}break;case 24:Al(d.memoizedState.cache)}if(h=d.child,h!==null)h.return=d,ar=h;else e:for(d=i;ar!==null;){h=ar;var g=h.sibling,y=h.return;if(oN(h),h===d){ar=null;break e}if(g!==null){g.return=y,ar=g;break e}ar=y}}}var jC={getCacheForType:function(i){var o=Qs(xs),d=o.data.get(i);return d===void 0&&(d=i(),o.data.set(i,d)),d}},_C=typeof WeakMap=="function"?WeakMap:Map,Rn=0,Wn=null,tn=null,xn=0,Pn=0,wi=null,Ll=!1,ru=!1,vy=!1,$o=0,ys=0,Fl=0,Wc=0,Ny=0,Wi=0,iu=0,hm=null,ni=null,jy=!1,_y=0,Dp=1/0,Rp=null,Ul=null,xr=0,Vl=null,au=null,ou=0,Ey=0,Sy=null,xN=null,mm=0,Iy=null;function vi(){if((Rn&2)!==0&&xn!==0)return xn&-xn;if(V.T!==null){var i=Xr;return i!==0?i:ky()}return we()}function yN(){Wi===0&&(Wi=(xn&536870912)===0||bn?Xe():536870912);var i=Qi.current;return i!==null&&(i.flags|=32),Wi}function Ni(i,o,d){(i===Wn&&(Pn===2||Pn===9)||i.cancelPendingCommit!==null)&&(lu(i,0),zl(i,xn,Wi,!1)),be(i,d),((Rn&2)===0||i!==Wn)&&(i===Wn&&((Rn&2)===0&&(Wc|=d),ys===4&&zl(i,xn,Wi,!1)),za(i))}function bN(i,o,d){if((Rn&6)!==0)throw Error(s(327));var h=!d&&(o&124)===0&&(o&i.expiredLanes)===0||$s(i,o),g=h?IC(i,o):Ay(i,o,!0),y=h;do{if(g===0){ru&&!h&&zl(i,o,0,!1);break}else{if(d=i.current.alternate,y&&!EC(d)){g=Ay(i,o,!1),y=!1;continue}if(g===2){if(y=o,i.errorRecoveryDisabledLanes&y)var P=0;else P=i.pendingLanes&-536870913,P=P!==0?P:P&536870912?536870912:0;if(P!==0){o=P;e:{var q=i;g=hm;var ae=q.current.memoizedState.isDehydrated;if(ae&&(lu(q,P).flags|=256),P=Ay(q,P,!1),P!==2){if(vy&&!ae){q.errorRecoveryDisabledLanes|=y,Wc|=y,g=4;break e}y=ni,ni=g,y!==null&&(ni===null?ni=y:ni.push.apply(ni,y))}g=P}if(y=!1,g!==2)continue}}if(g===1){lu(i,0),zl(i,o,0,!0);break}e:{switch(h=i,y=g,y){case 0:case 1:throw Error(s(345));case 4:if((o&4194048)!==o)break;case 6:zl(h,o,Wi,!Ll);break e;case 2:ni=null;break;case 3:case 5:break;default:throw Error(s(329))}if((o&62914560)===o&&(g=_y+300-Je(),10<g)){if(zl(h,o,Wi,!Ll),yt(h,0,!0)!==0)break e;h.timeoutHandle=WN(wN.bind(null,h,d,ni,Rp,jy,o,Wi,Wc,iu,Ll,y,2,-0,0),g);break e}wN(h,d,ni,Rp,jy,o,Wi,Wc,iu,Ll,y,0,-0,0)}}break}while(!0);za(i)}function wN(i,o,d,h,g,y,P,q,ae,Te,qe,Qe,Ae,Re){if(i.timeoutHandle=-1,Qe=o.subtreeFlags,(Qe&8192||(Qe&16785408)===16785408)&&(wm={stylesheets:null,count:0,unsuspend:aA},mN(o),Qe=lA(),Qe!==null)){i.cancelPendingCommit=Qe(IN.bind(null,i,o,y,d,h,g,P,q,ae,qe,1,Ae,Re)),zl(i,y,P,!Te);return}IN(i,o,y,d,h,g,P,q,ae)}function EC(i){for(var o=i;;){var d=o.tag;if((d===0||d===11||d===15)&&o.flags&16384&&(d=o.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var h=0;h<d.length;h++){var g=d[h],y=g.getSnapshot;g=g.value;try{if(!Sr(y(),g))return!1}catch{return!1}}if(d=o.child,o.subtreeFlags&16384&&d!==null)d.return=o,o=d;else{if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function zl(i,o,d,h){o&=~Ny,o&=~Wc,i.suspendedLanes|=o,i.pingedLanes&=~o,h&&(i.warmLanes|=o),h=i.expirationTimes;for(var g=o;0<g;){var y=31-C(g),P=1<<y;h[y]=-1,g&=~P}d!==0&&ve(i,d,o)}function Pp(){return(Rn&6)===0?(fm(0),!1):!0}function Ty(){if(tn!==null){if(Pn===0)var i=tn.return;else i=tn,da=Ao=null,Gi(i),eu=null,rm=0,i=tn;for(;i!==null;)Zv(i.alternate,i),i=i.return;tn=null}}function lu(i,o){var d=i.timeoutHandle;d!==-1&&(i.timeoutHandle=-1,BC(d)),d=i.cancelPendingCommit,d!==null&&(i.cancelPendingCommit=null,d()),Ty(),Wn=i,tn=d=aa(i.current,null),xn=o,Pn=0,wi=null,Ll=!1,ru=$s(i,o),vy=!1,iu=Wi=Ny=Wc=Fl=ys=0,ni=hm=null,jy=!1,(o&8)!==0&&(o|=o&32);var h=i.entangledLanes;if(h!==0)for(i=i.entanglements,h&=o;0<h;){var g=31-C(h),y=1<<g;o|=i[g],h&=~y}return $o=o,zd(),d}function vN(i,o){ct=null,V.H=wp,o===Dl||o===Oo?(o=S(),Pn=3):o===qc?(o=S(),Pn=4):Pn=o===Uv?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,wi=o,tn===null&&(ys=1,Ep(i,Vr(o,i.current)))}function NN(){var i=V.H;return V.H=wp,i===null?wp:i}function jN(){var i=V.A;return V.A=jC,i}function Cy(){ys=4,Ll||(xn&4194048)!==xn&&Qi.current!==null||(ru=!0),(Fl&134217727)===0&&(Wc&134217727)===0||Wn===null||zl(Wn,xn,Wi,!1)}function Ay(i,o,d){var h=Rn;Rn|=2;var g=NN(),y=jN();(Wn!==i||xn!==o)&&(Rp=null,lu(i,o)),o=!1;var P=ys;e:do try{if(Pn!==0&&tn!==null){var q=tn,ae=wi;switch(Pn){case 8:Ty(),P=6;break e;case 3:case 2:case 9:case 6:Qi.current===null&&(o=!0);var Te=Pn;if(Pn=0,wi=null,cu(i,q,ae,Te),d&&ru){P=0;break e}break;default:Te=Pn,Pn=0,wi=null,cu(i,q,ae,Te)}}SC(),P=ys;break}catch(qe){vN(i,qe)}while(!0);return o&&i.shellSuspendCounter++,da=Ao=null,Rn=h,V.H=g,V.A=y,tn===null&&(Wn=null,xn=0,zd()),P}function SC(){for(;tn!==null;)_N(tn)}function IC(i,o){var d=Rn;Rn|=2;var h=NN(),g=jN();Wn!==i||xn!==o?(Rp=null,Dp=Je()+500,lu(i,o)):ru=$s(i,o);e:do try{if(Pn!==0&&tn!==null){o=tn;var y=wi;t:switch(Pn){case 1:Pn=0,wi=null,cu(i,o,y,1);break;case 2:case 9:if(hp(y)){Pn=0,wi=null,EN(o);break}o=function(){Pn!==2&&Pn!==9||Wn!==i||(Pn=7),za(i)},y.then(o,o);break e;case 3:Pn=7;break e;case 4:Pn=5;break e;case 7:hp(y)?(Pn=0,wi=null,EN(o)):(Pn=0,wi=null,cu(i,o,y,7));break;case 5:var P=null;switch(tn.tag){case 26:P=tn.memoizedState;case 5:case 27:var q=tn;if(!P||aj(P)){Pn=0,wi=null;var ae=q.sibling;if(ae!==null)tn=ae;else{var Te=q.return;Te!==null?(tn=Te,kp(Te)):tn=null}break t}}Pn=0,wi=null,cu(i,o,y,5);break;case 6:Pn=0,wi=null,cu(i,o,y,6);break;case 8:Ty(),ys=6;break e;default:throw Error(s(462))}}TC();break}catch(qe){vN(i,qe)}while(!0);return da=Ao=null,V.H=h,V.A=g,Rn=d,tn!==null?0:(Wn=null,xn=0,zd(),ys)}function TC(){for(;tn!==null&&!oe();)_N(tn)}function _N(i){var o=Xv(i.alternate,i,$o);i.memoizedProps=i.pendingProps,o===null?kp(i):tn=o}function EN(i){var o=i,d=o.alternate;switch(o.tag){case 15:case 0:o=Hv(d,o,o.pendingProps,o.type,void 0,xn);break;case 11:o=Hv(d,o,o.pendingProps,o.type.render,o.ref,xn);break;case 5:Gi(o);default:Zv(d,o),o=tn=ip(o,$o),o=Xv(d,o,$o)}i.memoizedProps=i.pendingProps,o===null?kp(i):tn=o}function cu(i,o,d,h){da=Ao=null,Gi(o),eu=null,rm=0;var g=o.return;try{if(xC(i,g,o,d,xn)){ys=1,Ep(i,Vr(d,i.current)),tn=null;return}}catch(y){if(g!==null)throw tn=g,y;ys=1,Ep(i,Vr(d,i.current)),tn=null;return}o.flags&32768?(bn||h===1?i=!0:ru||(xn&536870912)!==0?i=!1:(Ll=i=!0,(h===2||h===9||h===3||h===6)&&(h=Qi.current,h!==null&&h.tag===13&&(h.flags|=16384))),SN(o,i)):kp(o)}function kp(i){var o=i;do{if((o.flags&32768)!==0){SN(o,Ll);return}i=o.return;var d=bC(o.alternate,o,$o);if(d!==null){tn=d;return}if(o=o.sibling,o!==null){tn=o;return}tn=o=i}while(o!==null);ys===0&&(ys=5)}function SN(i,o){do{var d=wC(i.alternate,i);if(d!==null){d.flags&=32767,tn=d;return}if(d=i.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!o&&(i=i.sibling,i!==null)){tn=i;return}tn=i=d}while(i!==null);ys=6,tn=null}function IN(i,o,d,h,g,y,P,q,ae){i.cancelPendingCommit=null;do Op();while(xr!==0);if((Rn&6)!==0)throw Error(s(327));if(o!==null){if(o===i.current)throw Error(s(177));if(y=o.lanes|o.childLanes,y|=Ah,De(i,d,y,P,q,ae),i===Wn&&(tn=Wn=null,xn=0),au=o,Vl=i,ou=d,Ey=y,Sy=g,xN=h,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,RC(Ze,function(){return RN(),null})):(i.callbackNode=null,i.callbackPriority=0),h=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||h){h=V.T,V.T=null,g=se.p,se.p=2,P=Rn,Rn|=4;try{vC(i,o,d)}finally{Rn=P,se.p=g,V.T=h}}xr=1,TN(),CN(),AN()}}function TN(){if(xr===1){xr=0;var i=Vl,o=au,d=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||d){d=V.T,V.T=null;var h=se.p;se.p=2;var g=Rn;Rn|=4;try{dN(o,i);var y=$y,P=jh(i.containerInfo),q=y.focusedElem,ae=y.selectionRange;if(P!==q&&q&&q.ownerDocument&&Zf(q.ownerDocument.documentElement,q)){if(ae!==null&&Vd(q)){var Te=ae.start,qe=ae.end;if(qe===void 0&&(qe=Te),"selectionStart"in q)q.selectionStart=Te,q.selectionEnd=Math.min(qe,q.value.length);else{var Qe=q.ownerDocument||document,Ae=Qe&&Qe.defaultView||window;if(Ae.getSelection){var Re=Ae.getSelection(),zt=q.textContent.length,Pt=Math.min(ae.start,zt),Vn=ae.end===void 0?Pt:Math.min(ae.end,zt);!Re.extend&&Pt>Vn&&(P=Vn,Vn=Pt,Pt=P);var je=Jf(q,Pt),ge=Jf(q,Vn);if(je&&ge&&(Re.rangeCount!==1||Re.anchorNode!==je.node||Re.anchorOffset!==je.offset||Re.focusNode!==ge.node||Re.focusOffset!==ge.offset)){var Ie=Qe.createRange();Ie.setStart(je.node,je.offset),Re.removeAllRanges(),Pt>Vn?(Re.addRange(Ie),Re.extend(ge.node,ge.offset)):(Ie.setEnd(ge.node,ge.offset),Re.addRange(Ie))}}}}for(Qe=[],Re=q;Re=Re.parentNode;)Re.nodeType===1&&Qe.push({element:Re,left:Re.scrollLeft,top:Re.scrollTop});for(typeof q.focus=="function"&&q.focus(),q=0;q<Qe.length;q++){var Ge=Qe[q];Ge.element.scrollLeft=Ge.left,Ge.element.scrollTop=Ge.top}}Qp=!!zy,$y=zy=null}finally{Rn=g,se.p=h,V.T=d}}i.current=o,xr=2}}function CN(){if(xr===2){xr=0;var i=Vl,o=au,d=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||d){d=V.T,V.T=null;var h=se.p;se.p=2;var g=Rn;Rn|=4;try{aN(i,o.alternate,o)}finally{Rn=g,se.p=h,V.T=d}}xr=3}}function AN(){if(xr===4||xr===3){xr=0,Ue();var i=Vl,o=au,d=ou,h=xN;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?xr=5:(xr=0,au=Vl=null,DN(i,i.pendingLanes));var g=i.pendingLanes;if(g===0&&(Ul=null),Ke(d),o=o.stateNode,Kt&&typeof Kt.onCommitFiberRoot=="function")try{Kt.onCommitFiberRoot(mn,o,void 0,(o.current.flags&128)===128)}catch{}if(h!==null){o=V.T,g=se.p,se.p=2,V.T=null;try{for(var y=i.onRecoverableError,P=0;P<h.length;P++){var q=h[P];y(q.value,{componentStack:q.stack})}}finally{V.T=o,se.p=g}}(ou&3)!==0&&Op(),za(i),g=i.pendingLanes,(d&4194090)!==0&&(g&42)!==0?i===Iy?mm++:(mm=0,Iy=i):mm=0,fm(0)}}function DN(i,o){(i.pooledCacheLanes&=o)===0&&(o=i.pooledCache,o!=null&&(i.pooledCache=null,Al(o)))}function Op(i){return TN(),CN(),AN(),RN()}function RN(){if(xr!==5)return!1;var i=Vl,o=Ey;Ey=0;var d=Ke(ou),h=V.T,g=se.p;try{se.p=32>d?32:d,V.T=null,d=Sy,Sy=null;var y=Vl,P=ou;if(xr=0,au=Vl=null,ou=0,(Rn&6)!==0)throw Error(s(331));var q=Rn;if(Rn|=4,pN(y.current),hN(y,y.current,P,d),Rn=q,fm(0,!1),Kt&&typeof Kt.onPostCommitFiberRoot=="function")try{Kt.onPostCommitFiberRoot(mn,y)}catch{}return!0}finally{se.p=g,V.T=h,DN(i,o)}}function PN(i,o,d){o=Vr(d,o),o=iy(i.stateNode,o,2),i=st(i,o,2),i!==null&&(be(i,2),za(i))}function Bn(i,o,d){if(i.tag===3)PN(i,i,d);else for(;o!==null;){if(o.tag===3){PN(o,i,d);break}else if(o.tag===1){var h=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Ul===null||!Ul.has(h))){i=Vr(d,i),d=Lv(2),h=st(o,d,2),h!==null&&(Fv(d,h,o,i),be(h,2),za(h));break}}o=o.return}}function Dy(i,o,d){var h=i.pingCache;if(h===null){h=i.pingCache=new _C;var g=new Set;h.set(o,g)}else g=h.get(o),g===void 0&&(g=new Set,h.set(o,g));g.has(d)||(vy=!0,g.add(d),i=CC.bind(null,i,o,d),o.then(i,i))}function CC(i,o,d){var h=i.pingCache;h!==null&&h.delete(o),i.pingedLanes|=i.suspendedLanes&d,i.warmLanes&=~d,Wn===i&&(xn&d)===d&&(ys===4||ys===3&&(xn&62914560)===xn&&300>Je()-_y?(Rn&2)===0&&lu(i,0):Ny|=d,iu===xn&&(iu=0)),za(i)}function kN(i,o){o===0&&(o=Be()),i=Ir(i,o),i!==null&&(be(i,o),za(i))}function AC(i){var o=i.memoizedState,d=0;o!==null&&(d=o.retryLane),kN(i,d)}function DC(i,o){var d=0;switch(i.tag){case 13:var h=i.stateNode,g=i.memoizedState;g!==null&&(d=g.retryLane);break;case 19:h=i.stateNode;break;case 22:h=i.stateNode._retryCache;break;default:throw Error(s(314))}h!==null&&h.delete(o),kN(i,d)}function RC(i,o){return It(i,o)}var Mp=null,du=null,Ry=!1,Lp=!1,Py=!1,Kc=0;function za(i){i!==du&&i.next===null&&(du===null?Mp=du=i:du=du.next=i),Lp=!0,Ry||(Ry=!0,kC())}function fm(i,o){if(!Py&&Lp){Py=!0;do for(var d=!1,h=Mp;h!==null;){if(i!==0){var g=h.pendingLanes;if(g===0)var y=0;else{var P=h.suspendedLanes,q=h.pingedLanes;y=(1<<31-C(42|i)+1)-1,y&=g&~(P&~q),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(d=!0,FN(h,y))}else y=xn,y=yt(h,h===Wn?y:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),(y&3)===0||$s(h,y)||(d=!0,FN(h,y));h=h.next}while(d);Py=!1}}function PC(){ON()}function ON(){Lp=Ry=!1;var i=0;Kc!==0&&($C()&&(i=Kc),Kc=0);for(var o=Je(),d=null,h=Mp;h!==null;){var g=h.next,y=MN(h,o);y===0?(h.next=null,d===null?Mp=g:d.next=g,g===null&&(du=d)):(d=h,(i!==0||(y&3)!==0)&&(Lp=!0)),h=g}fm(i)}function MN(i,o){for(var d=i.suspendedLanes,h=i.pingedLanes,g=i.expirationTimes,y=i.pendingLanes&-62914561;0<y;){var P=31-C(y),q=1<<P,ae=g[P];ae===-1?((q&d)===0||(q&h)!==0)&&(g[P]=_e(q,o)):ae<=o&&(i.expiredLanes|=q),y&=~q}if(o=Wn,d=xn,d=yt(i,i===o?d:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),h=i.callbackNode,d===0||i===o&&(Pn===2||Pn===9)||i.cancelPendingCommit!==null)return h!==null&&h!==null&&rn(h),i.callbackNode=null,i.callbackPriority=0;if((d&3)===0||$s(i,d)){if(o=d&-d,o===i.callbackPriority)return o;switch(h!==null&&rn(h),Ke(d)){case 2:case 8:d=Ht;break;case 32:d=Ze;break;case 268435456:d=Xt;break;default:d=Ze}return h=LN.bind(null,i),d=It(d,h),i.callbackPriority=o,i.callbackNode=d,o}return h!==null&&h!==null&&rn(h),i.callbackPriority=2,i.callbackNode=null,2}function LN(i,o){if(xr!==0&&xr!==5)return i.callbackNode=null,i.callbackPriority=0,null;var d=i.callbackNode;if(Op()&&i.callbackNode!==d)return null;var h=xn;return h=yt(i,i===Wn?h:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),h===0?null:(bN(i,h,o),MN(i,Je()),i.callbackNode!=null&&i.callbackNode===d?LN.bind(null,i):null)}function FN(i,o){if(Op())return null;bN(i,o,!0)}function kC(){qC(function(){(Rn&6)!==0?It(Dt,PC):ON()})}function ky(){return Kc===0&&(Kc=Xe()),Kc}function UN(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:gl(""+i)}function VN(i,o){var d=o.ownerDocument.createElement("input");return d.name=o.name,d.value=o.value,i.id&&d.setAttribute("form",i.id),o.parentNode.insertBefore(d,o),i=new FormData(i),d.parentNode.removeChild(d),i}function OC(i,o,d,h,g){if(o==="submit"&&d&&d.stateNode===g){var y=UN((g[Tt]||null).action),P=h.submitter;P&&(o=(o=P[Tt]||null)?UN(o.formAction):P.getAttribute("formAction"),o!==null&&(y=o,P=null));var q=new _a("action","action",null,h,g);i.push({event:q,listeners:[{instance:null,listener:function(){if(h.defaultPrevented){if(Kc!==0){var ae=P?VN(g,P):new FormData(g);ey(d,{pending:!0,data:ae,method:g.method,action:y},null,ae)}}else typeof y=="function"&&(q.preventDefault(),ae=P?VN(g,P):new FormData(g),ey(d,{pending:!0,data:ae,method:g.method,action:y},y,ae))},currentTarget:g}]})}}for(var Oy=0;Oy<Ch.length;Oy++){var My=Ch[Oy],MC=My.toLowerCase(),LC=My[0].toUpperCase()+My.slice(1);pi(MC,"on"+LC)}pi(Aa,"onAnimationEnd"),pi(qi,"onAnimationIteration"),pi(Sh,"onAnimationStart"),pi("dblclick","onDoubleClick"),pi("focusin","onFocus"),pi("focusout","onBlur"),pi(Wx,"onTransitionRun"),pi(np,"onTransitionStart"),pi(sp,"onTransitionCancel"),pi(Ih,"onTransitionEnd"),Gr("onMouseEnter",["mouseout","mouseover"]),Gr("onMouseLeave",["mouseout","mouseover"]),Gr("onPointerEnter",["pointerout","pointerover"]),Gr("onPointerLeave",["pointerout","pointerover"]),$n("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),$n("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),$n("onBeforeInput",["compositionend","keypress","textInput","paste"]),$n("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),$n("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),$n("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var pm="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),FC=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(pm));function zN(i,o){o=(o&4)!==0;for(var d=0;d<i.length;d++){var h=i[d],g=h.event;h=h.listeners;e:{var y=void 0;if(o)for(var P=h.length-1;0<=P;P--){var q=h[P],ae=q.instance,Te=q.currentTarget;if(q=q.listener,ae!==y&&g.isPropagationStopped())break e;y=q,g.currentTarget=Te;try{y(g)}catch(qe){_p(qe)}g.currentTarget=null,y=ae}else for(P=0;P<h.length;P++){if(q=h[P],ae=q.instance,Te=q.currentTarget,q=q.listener,ae!==y&&g.isPropagationStopped())break e;y=q,g.currentTarget=Te;try{y(g)}catch(qe){_p(qe)}g.currentTarget=null,y=ae}}}}function nn(i,o){var d=o[pt];d===void 0&&(d=o[pt]=new Set);var h=i+"__bubble";d.has(h)||($N(o,i,2,!1),d.add(h))}function Ly(i,o,d){var h=0;o&&(h|=4),$N(d,i,h,o)}var Fp="_reactListening"+Math.random().toString(36).slice(2);function Fy(i){if(!i[Fp]){i[Fp]=!0,Bs.forEach(function(d){d!=="selectionchange"&&(FC.has(d)||Ly(d,!1,i),Ly(d,!0,i))});var o=i.nodeType===9?i:i.ownerDocument;o===null||o[Fp]||(o[Fp]=!0,Ly("selectionchange",!1,o))}}function $N(i,o,d,h){switch(hj(o)){case 2:var g=uA;break;case 8:g=hA;break;default:g=Jy}d=g.bind(null,o,d,i),g=void 0,!Hs||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(g=!0),h?g!==void 0?i.addEventListener(o,d,{capture:!0,passive:g}):i.addEventListener(o,d,!0):g!==void 0?i.addEventListener(o,d,{passive:g}):i.addEventListener(o,d,!1)}function Uy(i,o,d,h,g){var y=h;if((o&1)===0&&(o&2)===0&&h!==null)e:for(;;){if(h===null)return;var P=h.tag;if(P===3||P===4){var q=h.stateNode.containerInfo;if(q===g)break;if(P===4)for(P=h.return;P!==null;){var ae=P.tag;if((ae===3||ae===4)&&P.stateNode.containerInfo===g)return;P=P.return}for(;q!==null;){if(P=li(q),P===null)return;if(ae=P.tag,ae===5||ae===6||ae===26||ae===27){h=y=P;continue e}q=q.parentNode}}h=h.return}Ic(function(){var Te=y,qe=mr(d),Qe=[];e:{var Ae=Th.get(i);if(Ae!==void 0){var Re=_a,zt=i;switch(i){case"keypress":if(zi(d)===0)break e;case"keydown":case"keyup":Re=No;break;case"focusin":zt="focus",Re=xo;break;case"focusout":zt="blur",Re=xo;break;case"beforeblur":case"afterblur":Re=xo;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Re=Gs;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Re=kd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Re=Od;break;case Aa:case qi:case Sh:Re=yo;break;case Ih:Re=Md;break;case"scroll":case"scrollend":Re=Cc;break;case"wheel":Re=wl;break;case"copy":case"cut":case"paste":Re=bo;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Re=hi;break;case"toggle":case"beforetoggle":Re=Oc}var Pt=(o&4)!==0,Vn=!Pt&&(i==="scroll"||i==="scrollend"),je=Pt?Ae!==null?Ae+"Capture":null:Ae;Pt=[];for(var ge=Te,Ie;ge!==null;){var Ge=ge;if(Ie=Ge.stateNode,Ge=Ge.tag,Ge!==5&&Ge!==26&&Ge!==27||Ie===null||je===null||(Ge=ja(ge,je),Ge!=null&&Pt.push(gm(ge,Ge,Ie))),Vn)break;ge=ge.return}0<Pt.length&&(Ae=new Re(Ae,zt,null,d,qe),Qe.push({event:Ae,listeners:Pt}))}}if((o&7)===0){e:{if(Ae=i==="mouseover"||i==="pointerover",Re=i==="mouseout"||i==="pointerout",Ae&&d!==rr&&(zt=d.relatedTarget||d.fromElement)&&(li(zt)||zt[ft]))break e;if((Re||Ae)&&(Ae=qe.window===qe?qe:(Ae=qe.ownerDocument)?Ae.defaultView||Ae.parentWindow:window,Re?(zt=d.relatedTarget||d.toElement,Re=Te,zt=zt?li(zt):null,zt!==null&&(Vn=l(zt),Pt=zt.tag,zt!==Vn||Pt!==5&&Pt!==27&&Pt!==6)&&(zt=null)):(Re=null,zt=Te),Re!==zt)){if(Pt=Gs,Ge="onMouseLeave",je="onMouseEnter",ge="mouse",(i==="pointerout"||i==="pointerover")&&(Pt=hi,Ge="onPointerLeave",je="onPointerEnter",ge="pointer"),Vn=Re==null?Ae:Ri(Re),Ie=zt==null?Ae:Ri(zt),Ae=new Pt(Ge,ge+"leave",Re,d,qe),Ae.target=Vn,Ae.relatedTarget=Ie,Ge=null,li(qe)===Te&&(Pt=new Pt(je,ge+"enter",zt,d,qe),Pt.target=Ie,Pt.relatedTarget=Vn,Ge=Pt),Vn=Ge,Re&&zt)t:{for(Pt=Re,je=zt,ge=0,Ie=Pt;Ie;Ie=uu(Ie))ge++;for(Ie=0,Ge=je;Ge;Ge=uu(Ge))Ie++;for(;0<ge-Ie;)Pt=uu(Pt),ge--;for(;0<Ie-ge;)je=uu(je),Ie--;for(;ge--;){if(Pt===je||je!==null&&Pt===je.alternate)break t;Pt=uu(Pt),je=uu(je)}Pt=null}else Pt=null;Re!==null&&BN(Qe,Ae,Re,Pt,!1),zt!==null&&Vn!==null&&BN(Qe,Vn,zt,Pt,!0)}}e:{if(Ae=Te?Ri(Te):window,Re=Ae.nodeName&&Ae.nodeName.toLowerCase(),Re==="select"||Re==="input"&&Ae.type==="file")var bt=Gf;else if(Es(Ae))if(wh)bt=Xf;else{bt=Kf;var Zt=Gx}else Re=Ae.nodeName,!Re||Re.toLowerCase()!=="input"||Ae.type!=="checkbox"&&Ae.type!=="radio"?Te&&mo(Te.elementType)&&(bt=Gf):bt=Yf;if(bt&&(bt=bt(i,Te))){Ss(Qe,bt,d,qe);break e}Zt&&Zt(i,Ae,Te),i==="focusout"&&Te&&Ae.type==="number"&&Te.memoizedProps.value!=null&&Mi(Ae,"number",Ae.value)}switch(Zt=Te?Ri(Te):window,i){case"focusin":(Es(Zt)||Zt.contentEditable==="true")&&(jl=Zt,_h=Te,Lc=null);break;case"focusout":Lc=_h=jl=null;break;case"mousedown":Eh=!0;break;case"contextmenu":case"mouseup":case"dragend":Eh=!1,ep(Qe,d,qe);break;case"selectionchange":if(Qx)break;case"keydown":case"keyup":ep(Qe,d,qe)}var St;if(Bi)e:{switch(i){case"compositionstart":var Ot="onCompositionStart";break e;case"compositionend":Ot="onCompositionEnd";break e;case"compositionupdate":Ot="onCompositionUpdate";break e}Ot=void 0}else on?Oe(i,d)&&(Ot="onCompositionEnd"):i==="keydown"&&d.keyCode===229&&(Ot="onCompositionStart");Ot&&(A&&d.locale!=="ko"&&(on||Ot!=="onCompositionStart"?Ot==="onCompositionEnd"&&on&&(St=go()):(di=qe,Vi="value"in di?di.value:di.textContent,on=!0)),Zt=Up(Te,Ot),0<Zt.length&&(Ot=new Ac(Ot,i,null,d,qe),Qe.push({event:Ot,listeners:Zt}),St?Ot.data=St:(St=rt(d),St!==null&&(Ot.data=St)))),(St=v?_s(i,d):ln(i,d))&&(Ot=Up(Te,"onBeforeInput"),0<Ot.length&&(Zt=new Ac("onBeforeInput","beforeinput",null,d,qe),Qe.push({event:Zt,listeners:Ot}),Zt.data=St)),OC(Qe,i,Te,d,qe)}zN(Qe,o)})}function gm(i,o,d){return{instance:i,listener:o,currentTarget:d}}function Up(i,o){for(var d=o+"Capture",h=[];i!==null;){var g=i,y=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||y===null||(g=ja(i,d),g!=null&&h.unshift(gm(i,g,y)),g=ja(i,o),g!=null&&h.push(gm(i,g,y))),i.tag===3)return h;i=i.return}return[]}function uu(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function BN(i,o,d,h,g){for(var y=o._reactName,P=[];d!==null&&d!==h;){var q=d,ae=q.alternate,Te=q.stateNode;if(q=q.tag,ae!==null&&ae===h)break;q!==5&&q!==26&&q!==27||Te===null||(ae=Te,g?(Te=ja(d,y),Te!=null&&P.unshift(gm(d,Te,ae))):g||(Te=ja(d,y),Te!=null&&P.push(gm(d,Te,ae)))),d=d.return}P.length!==0&&i.push({event:o,listeners:P})}var UC=/\r\n?/g,VC=/\u0000|\uFFFD/g;function qN(i){return(typeof i=="string"?i:""+i).replace(UC,`
`).replace(VC,"")}function HN(i,o){return o=qN(o),qN(i)===o}function Vp(){}function Un(i,o,d,h,g,y){switch(d){case"children":typeof h=="string"?o==="body"||o==="textarea"&&h===""||qs(i,h):(typeof h=="number"||typeof h=="bigint")&&o!=="body"&&qs(i,""+h);break;case"className":ur(i,"class",h);break;case"tabIndex":ur(i,"tabindex",h);break;case"dir":case"role":case"viewBox":case"width":case"height":ur(i,d,h);break;case"style":Fi(i,h,y);break;case"data":if(o!=="object"){ur(i,"data",h);break}case"src":case"href":if(h===""&&(o!=="a"||d!=="href")){i.removeAttribute(d);break}if(h==null||typeof h=="function"||typeof h=="symbol"||typeof h=="boolean"){i.removeAttribute(d);break}h=gl(""+h),i.setAttribute(d,h);break;case"action":case"formAction":if(typeof h=="function"){i.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(d==="formAction"?(o!=="input"&&Un(i,o,"name",g.name,g,null),Un(i,o,"formEncType",g.formEncType,g,null),Un(i,o,"formMethod",g.formMethod,g,null),Un(i,o,"formTarget",g.formTarget,g,null)):(Un(i,o,"encType",g.encType,g,null),Un(i,o,"method",g.method,g,null),Un(i,o,"target",g.target,g,null)));if(h==null||typeof h=="symbol"||typeof h=="boolean"){i.removeAttribute(d);break}h=gl(""+h),i.setAttribute(d,h);break;case"onClick":h!=null&&(i.onclick=Vp);break;case"onScroll":h!=null&&nn("scroll",i);break;case"onScrollEnd":h!=null&&nn("scrollend",i);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(s(61));if(d=h.__html,d!=null){if(g.children!=null)throw Error(s(60));i.innerHTML=d}}break;case"multiple":i.multiple=h&&typeof h!="function"&&typeof h!="symbol";break;case"muted":i.muted=h&&typeof h!="function"&&typeof h!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(h==null||typeof h=="function"||typeof h=="boolean"||typeof h=="symbol"){i.removeAttribute("xlink:href");break}d=gl(""+h),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":h!=null&&typeof h!="function"&&typeof h!="symbol"?i.setAttribute(d,""+h):i.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":h&&typeof h!="function"&&typeof h!="symbol"?i.setAttribute(d,""):i.removeAttribute(d);break;case"capture":case"download":h===!0?i.setAttribute(d,""):h!==!1&&h!=null&&typeof h!="function"&&typeof h!="symbol"?i.setAttribute(d,h):i.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":h!=null&&typeof h!="function"&&typeof h!="symbol"&&!isNaN(h)&&1<=h?i.setAttribute(d,h):i.removeAttribute(d);break;case"rowSpan":case"start":h==null||typeof h=="function"||typeof h=="symbol"||isNaN(h)?i.removeAttribute(d):i.setAttribute(d,h);break;case"popover":nn("beforetoggle",i),nn("toggle",i),ki(i,"popover",h);break;case"xlinkActuate":Os(i,"http://www.w3.org/1999/xlink","xlink:actuate",h);break;case"xlinkArcrole":Os(i,"http://www.w3.org/1999/xlink","xlink:arcrole",h);break;case"xlinkRole":Os(i,"http://www.w3.org/1999/xlink","xlink:role",h);break;case"xlinkShow":Os(i,"http://www.w3.org/1999/xlink","xlink:show",h);break;case"xlinkTitle":Os(i,"http://www.w3.org/1999/xlink","xlink:title",h);break;case"xlinkType":Os(i,"http://www.w3.org/1999/xlink","xlink:type",h);break;case"xmlBase":Os(i,"http://www.w3.org/XML/1998/namespace","xml:base",h);break;case"xmlLang":Os(i,"http://www.w3.org/XML/1998/namespace","xml:lang",h);break;case"xmlSpace":Os(i,"http://www.w3.org/XML/1998/namespace","xml:space",h);break;case"is":ki(i,"is",h);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=Rd.get(d)||d,ki(i,d,h))}}function Vy(i,o,d,h,g,y){switch(d){case"style":Fi(i,h,y);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(s(61));if(d=h.__html,d!=null){if(g.children!=null)throw Error(s(60));i.innerHTML=d}}break;case"children":typeof h=="string"?qs(i,h):(typeof h=="number"||typeof h=="bigint")&&qs(i,""+h);break;case"onScroll":h!=null&&nn("scroll",i);break;case"onScrollEnd":h!=null&&nn("scrollend",i);break;case"onClick":h!=null&&(i.onclick=Vp);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ks.hasOwnProperty(d))e:{if(d[0]==="o"&&d[1]==="n"&&(g=d.endsWith("Capture"),o=d.slice(2,g?d.length-7:void 0),y=i[Tt]||null,y=y!=null?y[d]:null,typeof y=="function"&&i.removeEventListener(o,y,g),typeof h=="function")){typeof y!="function"&&y!==null&&(d in i?i[d]=null:i.hasAttribute(d)&&i.removeAttribute(d)),i.addEventListener(o,h,g);break e}d in i?i[d]=h:h===!0?i.setAttribute(d,""):ki(i,d,h)}}}function yr(i,o,d){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":nn("error",i),nn("load",i);var h=!1,g=!1,y;for(y in d)if(d.hasOwnProperty(y)){var P=d[y];if(P!=null)switch(y){case"src":h=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:Un(i,o,y,P,d,null)}}g&&Un(i,o,"srcSet",d.srcSet,d,null),h&&Un(i,o,"src",d.src,d,null);return;case"input":nn("invalid",i);var q=y=P=g=null,ae=null,Te=null;for(h in d)if(d.hasOwnProperty(h)){var qe=d[h];if(qe!=null)switch(h){case"name":g=qe;break;case"type":P=qe;break;case"checked":ae=qe;break;case"defaultChecked":Te=qe;break;case"value":y=qe;break;case"defaultValue":q=qe;break;case"children":case"dangerouslySetInnerHTML":if(qe!=null)throw Error(s(137,o));break;default:Un(i,o,h,qe,d,null)}}sa(i,y,q,ae,Te,P,g,!1),ho(i);return;case"select":nn("invalid",i),h=P=y=null;for(g in d)if(d.hasOwnProperty(g)&&(q=d[g],q!=null))switch(g){case"value":y=q;break;case"defaultValue":P=q;break;case"multiple":h=q;default:Un(i,o,g,q,d,null)}o=y,d=P,i.multiple=!!h,o!=null?Ms(i,!!h,o,!1):d!=null&&Ms(i,!!h,d,!0);return;case"textarea":nn("invalid",i),y=g=h=null;for(P in d)if(d.hasOwnProperty(P)&&(q=d[P],q!=null))switch(P){case"value":h=q;break;case"defaultValue":g=q;break;case"children":y=q;break;case"dangerouslySetInnerHTML":if(q!=null)throw Error(s(91));break;default:Un(i,o,P,q,d,null)}Li(i,h,g,y),ho(i);return;case"option":for(ae in d)if(d.hasOwnProperty(ae)&&(h=d[ae],h!=null))switch(ae){case"selected":i.selected=h&&typeof h!="function"&&typeof h!="symbol";break;default:Un(i,o,ae,h,d,null)}return;case"dialog":nn("beforetoggle",i),nn("toggle",i),nn("cancel",i),nn("close",i);break;case"iframe":case"object":nn("load",i);break;case"video":case"audio":for(h=0;h<pm.length;h++)nn(pm[h],i);break;case"image":nn("error",i),nn("load",i);break;case"details":nn("toggle",i);break;case"embed":case"source":case"link":nn("error",i),nn("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Te in d)if(d.hasOwnProperty(Te)&&(h=d[Te],h!=null))switch(Te){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:Un(i,o,Te,h,d,null)}return;default:if(mo(o)){for(qe in d)d.hasOwnProperty(qe)&&(h=d[qe],h!==void 0&&Vy(i,o,qe,h,d,void 0));return}}for(q in d)d.hasOwnProperty(q)&&(h=d[q],h!=null&&Un(i,o,q,h,d,null))}function zC(i,o,d,h){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,y=null,P=null,q=null,ae=null,Te=null,qe=null;for(Re in d){var Qe=d[Re];if(d.hasOwnProperty(Re)&&Qe!=null)switch(Re){case"checked":break;case"value":break;case"defaultValue":ae=Qe;default:h.hasOwnProperty(Re)||Un(i,o,Re,null,h,Qe)}}for(var Ae in h){var Re=h[Ae];if(Qe=d[Ae],h.hasOwnProperty(Ae)&&(Re!=null||Qe!=null))switch(Ae){case"type":y=Re;break;case"name":g=Re;break;case"checked":Te=Re;break;case"defaultChecked":qe=Re;break;case"value":P=Re;break;case"defaultValue":q=Re;break;case"children":case"dangerouslySetInnerHTML":if(Re!=null)throw Error(s(137,o));break;default:Re!==Qe&&Un(i,o,Ae,Re,h,Qe)}}Gn(i,P,q,ae,Te,qe,y,g);return;case"select":Re=P=q=Ae=null;for(y in d)if(ae=d[y],d.hasOwnProperty(y)&&ae!=null)switch(y){case"value":break;case"multiple":Re=ae;default:h.hasOwnProperty(y)||Un(i,o,y,null,h,ae)}for(g in h)if(y=h[g],ae=d[g],h.hasOwnProperty(g)&&(y!=null||ae!=null))switch(g){case"value":Ae=y;break;case"defaultValue":q=y;break;case"multiple":P=y;default:y!==ae&&Un(i,o,g,y,h,ae)}o=q,d=P,h=Re,Ae!=null?Ms(i,!!d,Ae,!1):!!h!=!!d&&(o!=null?Ms(i,!!d,o,!0):Ms(i,!!d,d?[]:"",!1));return;case"textarea":Re=Ae=null;for(q in d)if(g=d[q],d.hasOwnProperty(q)&&g!=null&&!h.hasOwnProperty(q))switch(q){case"value":break;case"children":break;default:Un(i,o,q,null,h,g)}for(P in h)if(g=h[P],y=d[P],h.hasOwnProperty(P)&&(g!=null||y!=null))switch(P){case"value":Ae=g;break;case"defaultValue":Re=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(s(91));break;default:g!==y&&Un(i,o,P,g,h,y)}an(i,Ae,Re);return;case"option":for(var zt in d)if(Ae=d[zt],d.hasOwnProperty(zt)&&Ae!=null&&!h.hasOwnProperty(zt))switch(zt){case"selected":i.selected=!1;break;default:Un(i,o,zt,null,h,Ae)}for(ae in h)if(Ae=h[ae],Re=d[ae],h.hasOwnProperty(ae)&&Ae!==Re&&(Ae!=null||Re!=null))switch(ae){case"selected":i.selected=Ae&&typeof Ae!="function"&&typeof Ae!="symbol";break;default:Un(i,o,ae,Ae,h,Re)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Pt in d)Ae=d[Pt],d.hasOwnProperty(Pt)&&Ae!=null&&!h.hasOwnProperty(Pt)&&Un(i,o,Pt,null,h,Ae);for(Te in h)if(Ae=h[Te],Re=d[Te],h.hasOwnProperty(Te)&&Ae!==Re&&(Ae!=null||Re!=null))switch(Te){case"children":case"dangerouslySetInnerHTML":if(Ae!=null)throw Error(s(137,o));break;default:Un(i,o,Te,Ae,h,Re)}return;default:if(mo(o)){for(var Vn in d)Ae=d[Vn],d.hasOwnProperty(Vn)&&Ae!==void 0&&!h.hasOwnProperty(Vn)&&Vy(i,o,Vn,void 0,h,Ae);for(qe in h)Ae=h[qe],Re=d[qe],!h.hasOwnProperty(qe)||Ae===Re||Ae===void 0&&Re===void 0||Vy(i,o,qe,Ae,h,Re);return}}for(var je in d)Ae=d[je],d.hasOwnProperty(je)&&Ae!=null&&!h.hasOwnProperty(je)&&Un(i,o,je,null,h,Ae);for(Qe in h)Ae=h[Qe],Re=d[Qe],!h.hasOwnProperty(Qe)||Ae===Re||Ae==null&&Re==null||Un(i,o,Qe,Ae,h,Re)}var zy=null,$y=null;function zp(i){return i.nodeType===9?i:i.ownerDocument}function GN(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function QN(i,o){if(i===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&o==="foreignObject"?0:i}function By(i,o){return i==="textarea"||i==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var qy=null;function $C(){var i=window.event;return i&&i.type==="popstate"?i===qy?!1:(qy=i,!0):(qy=null,!1)}var WN=typeof setTimeout=="function"?setTimeout:void 0,BC=typeof clearTimeout=="function"?clearTimeout:void 0,KN=typeof Promise=="function"?Promise:void 0,qC=typeof queueMicrotask=="function"?queueMicrotask:typeof KN<"u"?function(i){return KN.resolve(null).then(i).catch(HC)}:WN;function HC(i){setTimeout(function(){throw i})}function $l(i){return i==="head"}function YN(i,o){var d=o,h=0,g=0;do{var y=d.nextSibling;if(i.removeChild(d),y&&y.nodeType===8)if(d=y.data,d==="/$"){if(0<h&&8>h){d=h;var P=i.ownerDocument;if(d&1&&xm(P.documentElement),d&2&&xm(P.body),d&4)for(d=P.head,xm(d),P=d.firstChild;P;){var q=P.nextSibling,ae=P.nodeName;P[Ai]||ae==="SCRIPT"||ae==="STYLE"||ae==="LINK"&&P.rel.toLowerCase()==="stylesheet"||d.removeChild(P),P=q}}if(g===0){i.removeChild(y),Em(o);return}g--}else d==="$"||d==="$?"||d==="$!"?g++:h=d.charCodeAt(0)-48;else h=0;d=y}while(d);Em(o)}function Hy(i){var o=i.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var d=o;switch(o=o.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":Hy(d),Na(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}i.removeChild(d)}}function GC(i,o,d,h){for(;i.nodeType===1;){var g=d;if(i.nodeName.toLowerCase()!==o.toLowerCase()){if(!h&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(h){if(!i[Ai])switch(o){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(y=i.getAttribute("rel"),y==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(y!==g.rel||i.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||i.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||i.getAttribute("title")!==(g.title==null?null:g.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(y=i.getAttribute("src"),(y!==(g.src==null?null:g.src)||i.getAttribute("type")!==(g.type==null?null:g.type)||i.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&y&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(o==="input"&&i.type==="hidden"){var y=g.name==null?null:""+g.name;if(g.type==="hidden"&&i.getAttribute("name")===y)return i}else return i;if(i=ma(i.nextSibling),i===null)break}return null}function QC(i,o,d){if(o==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!d||(i=ma(i.nextSibling),i===null))return null;return i}function Gy(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState==="complete"}function WC(i,o){var d=i.ownerDocument;if(i.data!=="$?"||d.readyState==="complete")o();else{var h=function(){o(),d.removeEventListener("DOMContentLoaded",h)};d.addEventListener("DOMContentLoaded",h),i._reactRetry=h}}function ma(i){for(;i!=null;i=i.nextSibling){var o=i.nodeType;if(o===1||o===3)break;if(o===8){if(o=i.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return i}var Qy=null;function XN(i){i=i.previousSibling;for(var o=0;i;){if(i.nodeType===8){var d=i.data;if(d==="$"||d==="$!"||d==="$?"){if(o===0)return i;o--}else d==="/$"&&o++}i=i.previousSibling}return null}function JN(i,o,d){switch(o=zp(d),i){case"html":if(i=o.documentElement,!i)throw Error(s(452));return i;case"head":if(i=o.head,!i)throw Error(s(453));return i;case"body":if(i=o.body,!i)throw Error(s(454));return i;default:throw Error(s(451))}}function xm(i){for(var o=i.attributes;o.length;)i.removeAttributeNode(o[0]);Na(i)}var Ki=new Map,ZN=new Set;function $p(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var Bo=se.d;se.d={f:KC,r:YC,D:XC,C:JC,L:ZC,m:eA,X:nA,S:tA,M:sA};function KC(){var i=Bo.f(),o=Pp();return i||o}function YC(i){var o=Di(i);o!==null&&o.tag===5&&o.type==="form"?bv(o):Bo.r(i)}var hu=typeof document>"u"?null:document;function ej(i,o,d){var h=hu;if(h&&typeof o=="string"&&o){var g=Ln(o);g='link[rel="'+i+'"][href="'+g+'"]',typeof d=="string"&&(g+='[crossorigin="'+d+'"]'),ZN.has(g)||(ZN.add(g),i={rel:i,crossOrigin:d,href:o},h.querySelector(g)===null&&(o=h.createElement("link"),yr(o,"link",i),en(o),h.head.appendChild(o)))}}function XC(i){Bo.D(i),ej("dns-prefetch",i,null)}function JC(i,o){Bo.C(i,o),ej("preconnect",i,o)}function ZC(i,o,d){Bo.L(i,o,d);var h=hu;if(h&&i&&o){var g='link[rel="preload"][as="'+Ln(o)+'"]';o==="image"&&d&&d.imageSrcSet?(g+='[imagesrcset="'+Ln(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(g+='[imagesizes="'+Ln(d.imageSizes)+'"]')):g+='[href="'+Ln(i)+'"]';var y=g;switch(o){case"style":y=mu(i);break;case"script":y=fu(i)}Ki.has(y)||(i=b({rel:"preload",href:o==="image"&&d&&d.imageSrcSet?void 0:i,as:o},d),Ki.set(y,i),h.querySelector(g)!==null||o==="style"&&h.querySelector(ym(y))||o==="script"&&h.querySelector(bm(y))||(o=h.createElement("link"),yr(o,"link",i),en(o),h.head.appendChild(o)))}}function eA(i,o){Bo.m(i,o);var d=hu;if(d&&i){var h=o&&typeof o.as=="string"?o.as:"script",g='link[rel="modulepreload"][as="'+Ln(h)+'"][href="'+Ln(i)+'"]',y=g;switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=fu(i)}if(!Ki.has(y)&&(i=b({rel:"modulepreload",href:i},o),Ki.set(y,i),d.querySelector(g)===null)){switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(bm(y)))return}h=d.createElement("link"),yr(h,"link",i),en(h),d.head.appendChild(h)}}}function tA(i,o,d){Bo.S(i,o,d);var h=hu;if(h&&i){var g=gs(h).hoistableStyles,y=mu(i);o=o||"default";var P=g.get(y);if(!P){var q={loading:0,preload:null};if(P=h.querySelector(ym(y)))q.loading=5;else{i=b({rel:"stylesheet",href:i,"data-precedence":o},d),(d=Ki.get(y))&&Wy(i,d);var ae=P=h.createElement("link");en(ae),yr(ae,"link",i),ae._p=new Promise(function(Te,qe){ae.onload=Te,ae.onerror=qe}),ae.addEventListener("load",function(){q.loading|=1}),ae.addEventListener("error",function(){q.loading|=2}),q.loading|=4,Bp(P,o,h)}P={type:"stylesheet",instance:P,count:1,state:q},g.set(y,P)}}}function nA(i,o){Bo.X(i,o);var d=hu;if(d&&i){var h=gs(d).hoistableScripts,g=fu(i),y=h.get(g);y||(y=d.querySelector(bm(g)),y||(i=b({src:i,async:!0},o),(o=Ki.get(g))&&Ky(i,o),y=d.createElement("script"),en(y),yr(y,"link",i),d.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},h.set(g,y))}}function sA(i,o){Bo.M(i,o);var d=hu;if(d&&i){var h=gs(d).hoistableScripts,g=fu(i),y=h.get(g);y||(y=d.querySelector(bm(g)),y||(i=b({src:i,async:!0,type:"module"},o),(o=Ki.get(g))&&Ky(i,o),y=d.createElement("script"),en(y),yr(y,"link",i),d.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},h.set(g,y))}}function tj(i,o,d,h){var g=(g=Q.current)?$p(g):null;if(!g)throw Error(s(446));switch(i){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(o=mu(d.href),d=gs(g).hoistableStyles,h=d.get(o),h||(h={type:"style",instance:null,count:0,state:null},d.set(o,h)),h):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){i=mu(d.href);var y=gs(g).hoistableStyles,P=y.get(i);if(P||(g=g.ownerDocument||g,P={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(i,P),(y=g.querySelector(ym(i)))&&!y._p&&(P.instance=y,P.state.loading=5),Ki.has(i)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},Ki.set(i,d),y||rA(g,i,d,P.state))),o&&h===null)throw Error(s(528,""));return P}if(o&&h!==null)throw Error(s(529,""));return null;case"script":return o=d.async,d=d.src,typeof d=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=fu(d),d=gs(g).hoistableScripts,h=d.get(o),h||(h={type:"script",instance:null,count:0,state:null},d.set(o,h)),h):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,i))}}function mu(i){return'href="'+Ln(i)+'"'}function ym(i){return'link[rel="stylesheet"]['+i+"]"}function nj(i){return b({},i,{"data-precedence":i.precedence,precedence:null})}function rA(i,o,d,h){i.querySelector('link[rel="preload"][as="style"]['+o+"]")?h.loading=1:(o=i.createElement("link"),h.preload=o,o.addEventListener("load",function(){return h.loading|=1}),o.addEventListener("error",function(){return h.loading|=2}),yr(o,"link",d),en(o),i.head.appendChild(o))}function fu(i){return'[src="'+Ln(i)+'"]'}function bm(i){return"script[async]"+i}function sj(i,o,d){if(o.count++,o.instance===null)switch(o.type){case"style":var h=i.querySelector('style[data-href~="'+Ln(d.href)+'"]');if(h)return o.instance=h,en(h),h;var g=b({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return h=(i.ownerDocument||i).createElement("style"),en(h),yr(h,"style",g),Bp(h,d.precedence,i),o.instance=h;case"stylesheet":g=mu(d.href);var y=i.querySelector(ym(g));if(y)return o.state.loading|=4,o.instance=y,en(y),y;h=nj(d),(g=Ki.get(g))&&Wy(h,g),y=(i.ownerDocument||i).createElement("link"),en(y);var P=y;return P._p=new Promise(function(q,ae){P.onload=q,P.onerror=ae}),yr(y,"link",h),o.state.loading|=4,Bp(y,d.precedence,i),o.instance=y;case"script":return y=fu(d.src),(g=i.querySelector(bm(y)))?(o.instance=g,en(g),g):(h=d,(g=Ki.get(y))&&(h=b({},d),Ky(h,g)),i=i.ownerDocument||i,g=i.createElement("script"),en(g),yr(g,"link",h),i.head.appendChild(g),o.instance=g);case"void":return null;default:throw Error(s(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(h=o.instance,o.state.loading|=4,Bp(h,d.precedence,i));return o.instance}function Bp(i,o,d){for(var h=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=h.length?h[h.length-1]:null,y=g,P=0;P<h.length;P++){var q=h[P];if(q.dataset.precedence===o)y=q;else if(y!==g)break}y?y.parentNode.insertBefore(i,y.nextSibling):(o=d.nodeType===9?d.head:d,o.insertBefore(i,o.firstChild))}function Wy(i,o){i.crossOrigin==null&&(i.crossOrigin=o.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=o.referrerPolicy),i.title==null&&(i.title=o.title)}function Ky(i,o){i.crossOrigin==null&&(i.crossOrigin=o.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=o.referrerPolicy),i.integrity==null&&(i.integrity=o.integrity)}var qp=null;function rj(i,o,d){if(qp===null){var h=new Map,g=qp=new Map;g.set(d,h)}else g=qp,h=g.get(d),h||(h=new Map,g.set(d,h));if(h.has(i))return h;for(h.set(i,null),d=d.getElementsByTagName(i),g=0;g<d.length;g++){var y=d[g];if(!(y[Ai]||y[Ve]||i==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var P=y.getAttribute(o)||"";P=i+P;var q=h.get(P);q?q.push(y):h.set(P,[y])}}return h}function ij(i,o,d){i=i.ownerDocument||i,i.head.insertBefore(d,o==="title"?i.querySelector("head > title"):null)}function iA(i,o,d){if(d===1||o.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return i=o.disabled,typeof o.precedence=="string"&&i==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function aj(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}var wm=null;function aA(){}function oA(i,o,d){if(wm===null)throw Error(s(475));var h=wm;if(o.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var g=mu(d.href),y=i.querySelector(ym(g));if(y){i=y._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(h.count++,h=Hp.bind(h),i.then(h,h)),o.state.loading|=4,o.instance=y,en(y);return}y=i.ownerDocument||i,d=nj(d),(g=Ki.get(g))&&Wy(d,g),y=y.createElement("link"),en(y);var P=y;P._p=new Promise(function(q,ae){P.onload=q,P.onerror=ae}),yr(y,"link",d),o.instance=y}h.stylesheets===null&&(h.stylesheets=new Map),h.stylesheets.set(o,i),(i=o.state.preload)&&(o.state.loading&3)===0&&(h.count++,o=Hp.bind(h),i.addEventListener("load",o),i.addEventListener("error",o))}}function lA(){if(wm===null)throw Error(s(475));var i=wm;return i.stylesheets&&i.count===0&&Yy(i,i.stylesheets),0<i.count?function(o){var d=setTimeout(function(){if(i.stylesheets&&Yy(i,i.stylesheets),i.unsuspend){var h=i.unsuspend;i.unsuspend=null,h()}},6e4);return i.unsuspend=o,function(){i.unsuspend=null,clearTimeout(d)}}:null}function Hp(){if(this.count--,this.count===0){if(this.stylesheets)Yy(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var Gp=null;function Yy(i,o){i.stylesheets=null,i.unsuspend!==null&&(i.count++,Gp=new Map,o.forEach(cA,i),Gp=null,Hp.call(i))}function cA(i,o){if(!(o.state.loading&4)){var d=Gp.get(i);if(d)var h=d.get(null);else{d=new Map,Gp.set(i,d);for(var g=i.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<g.length;y++){var P=g[y];(P.nodeName==="LINK"||P.getAttribute("media")!=="not all")&&(d.set(P.dataset.precedence,P),h=P)}h&&d.set(null,h)}g=o.instance,P=g.getAttribute("data-precedence"),y=d.get(P)||h,y===h&&d.set(null,g),d.set(P,g),this.count++,h=Hp.bind(this),g.addEventListener("load",h),g.addEventListener("error",h),y?y.parentNode.insertBefore(g,y.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(g,i.firstChild)),o.state.loading|=4}}var vm={$$typeof:Z,Provider:null,Consumer:null,_currentValue:fe,_currentValue2:fe,_threadCount:0};function dA(i,o,d,h,g,y,P,q){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=he(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=he(0),this.hiddenUpdates=he(null),this.identifierPrefix=h,this.onUncaughtError=g,this.onCaughtError=y,this.onRecoverableError=P,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=q,this.incompleteTransitions=new Map}function oj(i,o,d,h,g,y,P,q,ae,Te,qe,Qe){return i=new dA(i,o,d,P,q,ae,Te,Qe),o=1,y===!0&&(o|=24),y=$r(3,null,null,o),i.current=y,y.stateNode=i,o=Bc(),o.refCount++,i.pooledCache=o,o.refCount++,y.memoizedState={element:h,isDehydrated:d,cache:o},Ne(y),i}function lj(i){return i?(i=El,i):El}function cj(i,o,d,h,g,y){g=lj(g),h.context===null?h.context=g:h.pendingContext=g,h=He(o),h.payload={element:d},y=y===void 0?null:y,y!==null&&(h.callback=y),d=st(i,h,o),d!==null&&(Ni(d,i,o),ut(d,i,o))}function dj(i,o){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var d=i.retryLane;i.retryLane=d!==0&&d<o?d:o}}function Xy(i,o){dj(i,o),(i=i.alternate)&&dj(i,o)}function uj(i){if(i.tag===13){var o=Ir(i,67108864);o!==null&&Ni(o,i,67108864),Xy(i,67108864)}}var Qp=!0;function uA(i,o,d,h){var g=V.T;V.T=null;var y=se.p;try{se.p=2,Jy(i,o,d,h)}finally{se.p=y,V.T=g}}function hA(i,o,d,h){var g=V.T;V.T=null;var y=se.p;try{se.p=8,Jy(i,o,d,h)}finally{se.p=y,V.T=g}}function Jy(i,o,d,h){if(Qp){var g=Zy(h);if(g===null)Uy(i,o,h,Wp,d),mj(i,h);else if(fA(g,i,o,d,h))h.stopPropagation();else if(mj(i,h),o&4&&-1<mA.indexOf(i)){for(;g!==null;){var y=Di(g);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var P=Nt(y.pendingLanes);if(P!==0){var q=y;for(q.pendingLanes|=2,q.entangledLanes|=2;P;){var ae=1<<31-C(P);q.entanglements[1]|=ae,P&=~ae}za(y),(Rn&6)===0&&(Dp=Je()+500,fm(0))}}break;case 13:q=Ir(y,2),q!==null&&Ni(q,y,2),Pp(),Xy(y,2)}if(y=Zy(h),y===null&&Uy(i,o,h,Wp,d),y===g)break;g=y}g!==null&&h.stopPropagation()}else Uy(i,o,h,null,d)}}function Zy(i){return i=mr(i),eb(i)}var Wp=null;function eb(i){if(Wp=null,i=li(i),i!==null){var o=l(i);if(o===null)i=null;else{var d=o.tag;if(d===13){if(i=c(o),i!==null)return i;i=null}else if(d===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null)}}return Wp=i,null}function hj(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(lt()){case Dt:return 2;case Ht:return 8;case Ze:case Vt:return 32;case Xt:return 268435456;default:return 32}default:return 32}}var tb=!1,Bl=null,ql=null,Hl=null,Nm=new Map,jm=new Map,Gl=[],mA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function mj(i,o){switch(i){case"focusin":case"focusout":Bl=null;break;case"dragenter":case"dragleave":ql=null;break;case"mouseover":case"mouseout":Hl=null;break;case"pointerover":case"pointerout":Nm.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":jm.delete(o.pointerId)}}function _m(i,o,d,h,g,y){return i===null||i.nativeEvent!==y?(i={blockedOn:o,domEventName:d,eventSystemFlags:h,nativeEvent:y,targetContainers:[g]},o!==null&&(o=Di(o),o!==null&&uj(o)),i):(i.eventSystemFlags|=h,o=i.targetContainers,g!==null&&o.indexOf(g)===-1&&o.push(g),i)}function fA(i,o,d,h,g){switch(o){case"focusin":return Bl=_m(Bl,i,o,d,h,g),!0;case"dragenter":return ql=_m(ql,i,o,d,h,g),!0;case"mouseover":return Hl=_m(Hl,i,o,d,h,g),!0;case"pointerover":var y=g.pointerId;return Nm.set(y,_m(Nm.get(y)||null,i,o,d,h,g)),!0;case"gotpointercapture":return y=g.pointerId,jm.set(y,_m(jm.get(y)||null,i,o,d,h,g)),!0}return!1}function fj(i){var o=li(i.target);if(o!==null){var d=l(o);if(d!==null){if(o=d.tag,o===13){if(o=c(d),o!==null){i.blockedOn=o,et(i.priority,function(){if(d.tag===13){var h=vi();h=$e(h);var g=Ir(d,h);g!==null&&Ni(g,d,h),Xy(d,h)}});return}}else if(o===3&&d.stateNode.current.memoizedState.isDehydrated){i.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Kp(i){if(i.blockedOn!==null)return!1;for(var o=i.targetContainers;0<o.length;){var d=Zy(i.nativeEvent);if(d===null){d=i.nativeEvent;var h=new d.constructor(d.type,d);rr=h,d.target.dispatchEvent(h),rr=null}else return o=Di(d),o!==null&&uj(o),i.blockedOn=d,!1;o.shift()}return!0}function pj(i,o,d){Kp(i)&&d.delete(o)}function pA(){tb=!1,Bl!==null&&Kp(Bl)&&(Bl=null),ql!==null&&Kp(ql)&&(ql=null),Hl!==null&&Kp(Hl)&&(Hl=null),Nm.forEach(pj),jm.forEach(pj)}function Yp(i,o){i.blockedOn===o&&(i.blockedOn=null,tb||(tb=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,pA)))}var Xp=null;function gj(i){Xp!==i&&(Xp=i,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){Xp===i&&(Xp=null);for(var o=0;o<i.length;o+=3){var d=i[o],h=i[o+1],g=i[o+2];if(typeof h!="function"){if(eb(h||d)===null)continue;break}var y=Di(d);y!==null&&(i.splice(o,3),o-=3,ey(y,{pending:!0,data:g,method:d.method,action:h},h,g))}}))}function Em(i){function o(ae){return Yp(ae,i)}Bl!==null&&Yp(Bl,i),ql!==null&&Yp(ql,i),Hl!==null&&Yp(Hl,i),Nm.forEach(o),jm.forEach(o);for(var d=0;d<Gl.length;d++){var h=Gl[d];h.blockedOn===i&&(h.blockedOn=null)}for(;0<Gl.length&&(d=Gl[0],d.blockedOn===null);)fj(d),d.blockedOn===null&&Gl.shift();if(d=(i.ownerDocument||i).$$reactFormReplay,d!=null)for(h=0;h<d.length;h+=3){var g=d[h],y=d[h+1],P=g[Tt]||null;if(typeof y=="function")P||gj(d);else if(P){var q=null;if(y&&y.hasAttribute("formAction")){if(g=y,P=y[Tt]||null)q=P.formAction;else if(eb(g)!==null)continue}else q=P.action;typeof q=="function"?d[h+1]=q:(d.splice(h,3),h-=3),gj(d)}}}function nb(i){this._internalRoot=i}Jp.prototype.render=nb.prototype.render=function(i){var o=this._internalRoot;if(o===null)throw Error(s(409));var d=o.current,h=vi();cj(d,h,i,o,null,null)},Jp.prototype.unmount=nb.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var o=i.containerInfo;cj(i.current,2,null,i,null,null),Pp(),o[ft]=null}};function Jp(i){this._internalRoot=i}Jp.prototype.unstable_scheduleHydration=function(i){if(i){var o=we();i={blockedOn:null,target:i,priority:o};for(var d=0;d<Gl.length&&o!==0&&o<Gl[d].priority;d++);Gl.splice(d,0,i),d===0&&fj(i)}};var xj=e.version;if(xj!=="19.1.0")throw Error(s(527,xj,"19.1.0"));se.findDOMNode=function(i){var o=i._reactInternals;if(o===void 0)throw typeof i.render=="function"?Error(s(188)):(i=Object.keys(i).join(","),Error(s(268,i)));return i=m(o),i=i!==null?p(i):null,i=i===null?null:i.stateNode,i};var gA={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:V,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zp.isDisabled&&Zp.supportsFiber)try{mn=Zp.inject(gA),Kt=Zp}catch{}}return Im.createRoot=function(i,o){if(!a(i))throw Error(s(299));var d=!1,h="",g=Pv,y=kv,P=Ov,q=null;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(h=o.identifierPrefix),o.onUncaughtError!==void 0&&(g=o.onUncaughtError),o.onCaughtError!==void 0&&(y=o.onCaughtError),o.onRecoverableError!==void 0&&(P=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(q=o.unstable_transitionCallbacks)),o=oj(i,1,!1,null,null,d,h,g,y,P,q,null),i[ft]=o.current,Fy(i),new nb(o)},Im.hydrateRoot=function(i,o,d){if(!a(i))throw Error(s(299));var h=!1,g="",y=Pv,P=kv,q=Ov,ae=null,Te=null;return d!=null&&(d.unstable_strictMode===!0&&(h=!0),d.identifierPrefix!==void 0&&(g=d.identifierPrefix),d.onUncaughtError!==void 0&&(y=d.onUncaughtError),d.onCaughtError!==void 0&&(P=d.onCaughtError),d.onRecoverableError!==void 0&&(q=d.onRecoverableError),d.unstable_transitionCallbacks!==void 0&&(ae=d.unstable_transitionCallbacks),d.formState!==void 0&&(Te=d.formState)),o=oj(i,1,!0,o,d??null,h,g,y,P,q,ae,Te),o.context=lj(null),d=o.current,h=vi(),h=$e(h),g=He(h),g.callback=null,st(d,g,h),d=h,o.current.lanes=d,be(o,d),za(o),i[ft]=o.current,Fy(i),new Jp(o)},Im.version="19.1.0",Im}var Ij;function SA(){if(Ij)return ib.exports;Ij=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),ib.exports=EA(),ib.exports}var IA=SA();const TA=GE(IA);/**
 * react-router v7.7.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Tj="popstate";function CA(r={}){function e(s,a){let{pathname:l,search:c,hash:u}=s.location;return Ob("",{pathname:l,search:c,hash:u},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function t(s,a){return typeof a=="string"?a:sf(a)}return DA(e,t,null,r)}function fs(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function no(r,e){if(!r){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function AA(){return Math.random().toString(36).substring(2,10)}function Cj(r,e){return{usr:r.state,key:r.key,idx:e}}function Ob(r,e,t=null,s){return{pathname:typeof r=="string"?r:r.pathname,search:"",hash:"",...typeof e=="string"?ih(e):e,state:t,key:e&&e.key||s||AA()}}function sf({pathname:r="/",search:e="",hash:t=""}){return e&&e!=="?"&&(r+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(r+=t.charAt(0)==="#"?t:"#"+t),r}function ih(r){let e={};if(r){let t=r.indexOf("#");t>=0&&(e.hash=r.substring(t),r=r.substring(0,t));let s=r.indexOf("?");s>=0&&(e.search=r.substring(s),r=r.substring(0,s)),r&&(e.pathname=r)}return e}function DA(r,e,t,s={}){let{window:a=document.defaultView,v5Compat:l=!1}=s,c=a.history,u="POP",m=null,p=b();p==null&&(p=0,c.replaceState({...c.state,idx:p},""));function b(){return(c.state||{idx:null}).idx}function w(){u="POP";let U=b(),T=U==null?null:U-p;p=U,m&&m({action:u,location:G.location,delta:T})}function N(U,T){u="PUSH";let ee=Ob(G.location,U,T);p=b()+1;let Z=Cj(ee,p),ie=G.createHref(ee);try{c.pushState(Z,"",ie)}catch(X){if(X instanceof DOMException&&X.name==="DataCloneError")throw X;a.location.assign(ie)}l&&m&&m({action:u,location:G.location,delta:1})}function R(U,T){u="REPLACE";let ee=Ob(G.location,U,T);p=b();let Z=Cj(ee,p),ie=G.createHref(ee);c.replaceState(Z,"",ie),l&&m&&m({action:u,location:G.location,delta:0})}function O(U){return RA(U)}let G={get action(){return u},get location(){return r(a,c)},listen(U){if(m)throw new Error("A history only accepts one active listener");return a.addEventListener(Tj,w),m=U,()=>{a.removeEventListener(Tj,w),m=null}},createHref(U){return e(a,U)},createURL:O,encodeLocation(U){let T=O(U);return{pathname:T.pathname,search:T.search,hash:T.hash}},push:N,replace:R,go(U){return c.go(U)}};return G}function RA(r,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),fs(t,"No window.location.(origin|href) available to create URL");let s=typeof r=="string"?r:sf(r);return s=s.replace(/ $/,"%20"),!e&&s.startsWith("//")&&(s=t+s),new URL(s,t)}function WE(r,e,t="/"){return PA(r,e,t,!1)}function PA(r,e,t,s){let a=typeof e=="string"?ih(e):e,l=el(a.pathname||"/",t);if(l==null)return null;let c=KE(r);kA(c);let u=null;for(let m=0;u==null&&m<c.length;++m){let p=HA(l);u=BA(c[m],p,s)}return u}function KE(r,e=[],t=[],s=""){let a=(l,c,u)=>{let m={relativePath:u===void 0?l.path||"":u,caseSensitive:l.caseSensitive===!0,childrenIndex:c,route:l};m.relativePath.startsWith("/")&&(fs(m.relativePath.startsWith(s),`Absolute route path "${m.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),m.relativePath=m.relativePath.slice(s.length));let p=Xo([s,m.relativePath]),b=t.concat(m);l.children&&l.children.length>0&&(fs(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${p}".`),KE(l.children,e,b,p)),!(l.path==null&&!l.index)&&e.push({path:p,score:zA(p,l.index),routesMeta:b})};return r.forEach((l,c)=>{if(l.path===""||!l.path?.includes("?"))a(l,c);else for(let u of YE(l.path))a(l,c,u)}),e}function YE(r){let e=r.split("/");if(e.length===0)return[];let[t,...s]=e,a=t.endsWith("?"),l=t.replace(/\?$/,"");if(s.length===0)return a?[l,""]:[l];let c=YE(s.join("/")),u=[];return u.push(...c.map(m=>m===""?l:[l,m].join("/"))),a&&u.push(...c),u.map(m=>r.startsWith("/")&&m===""?"/":m)}function kA(r){r.sort((e,t)=>e.score!==t.score?t.score-e.score:$A(e.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}var OA=/^:[\w-]+$/,MA=3,LA=2,FA=1,UA=10,VA=-2,Aj=r=>r==="*";function zA(r,e){let t=r.split("/"),s=t.length;return t.some(Aj)&&(s+=VA),e&&(s+=LA),t.filter(a=>!Aj(a)).reduce((a,l)=>a+(OA.test(l)?MA:l===""?FA:UA),s)}function $A(r,e){return r.length===e.length&&r.slice(0,-1).every((s,a)=>s===e[a])?r[r.length-1]-e[e.length-1]:0}function BA(r,e,t=!1){let{routesMeta:s}=r,a={},l="/",c=[];for(let u=0;u<s.length;++u){let m=s[u],p=u===s.length-1,b=l==="/"?e:e.slice(l.length)||"/",w=Rg({path:m.relativePath,caseSensitive:m.caseSensitive,end:p},b),N=m.route;if(!w&&p&&t&&!s[s.length-1].route.index&&(w=Rg({path:m.relativePath,caseSensitive:m.caseSensitive,end:!1},b)),!w)return null;Object.assign(a,w.params),c.push({params:a,pathname:Xo([l,w.pathname]),pathnameBase:KA(Xo([l,w.pathnameBase])),route:N}),w.pathnameBase!=="/"&&(l=Xo([l,w.pathnameBase]))}return c}function Rg(r,e){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[t,s]=qA(r.path,r.caseSensitive,r.end),a=e.match(t);if(!a)return null;let l=a[0],c=l.replace(/(.)\/+$/,"$1"),u=a.slice(1);return{params:s.reduce((p,{paramName:b,isOptional:w},N)=>{if(b==="*"){let O=u[N]||"";c=l.slice(0,l.length-O.length).replace(/(.)\/+$/,"$1")}const R=u[N];return w&&!R?p[b]=void 0:p[b]=(R||"").replace(/%2F/g,"/"),p},{}),pathname:l,pathnameBase:c,pattern:r}}function qA(r,e=!1,t=!0){no(r==="*"||!r.endsWith("*")||r.endsWith("/*"),`Route path "${r}" will be treated as if it were "${r.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${r.replace(/\*$/,"/*")}".`);let s=[],a="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,u,m)=>(s.push({paramName:u,isOptional:m!=null}),m?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(s.push({paramName:"*"}),a+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?a+="\\/*$":r!==""&&r!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,e?void 0:"i"),s]}function HA(r){try{return r.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return no(!1,`The URL path "${r}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),r}}function el(r,e){if(e==="/")return r;if(!r.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=r.charAt(t);return s&&s!=="/"?null:r.slice(t)||"/"}function GA(r,e="/"){let{pathname:t,search:s="",hash:a=""}=typeof r=="string"?ih(r):r;return{pathname:t?t.startsWith("/")?t:QA(t,e):e,search:YA(s),hash:XA(a)}}function QA(r,e){let t=e.replace(/\/+$/,"").split("/");return r.split("/").forEach(a=>{a===".."?t.length>1&&t.pop():a!=="."&&t.push(a)}),t.length>1?t.join("/"):"/"}function cb(r,e,t,s){return`Cannot include a '${r}' character in a manually specified \`to.${e}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function WA(r){return r.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function XE(r){let e=WA(r);return e.map((t,s)=>s===e.length-1?t.pathname:t.pathnameBase)}function JE(r,e,t,s=!1){let a;typeof r=="string"?a=ih(r):(a={...r},fs(!a.pathname||!a.pathname.includes("?"),cb("?","pathname","search",a)),fs(!a.pathname||!a.pathname.includes("#"),cb("#","pathname","hash",a)),fs(!a.search||!a.search.includes("#"),cb("#","search","hash",a)));let l=r===""||a.pathname==="",c=l?"/":a.pathname,u;if(c==null)u=t;else{let w=e.length-1;if(!s&&c.startsWith("..")){let N=c.split("/");for(;N[0]==="..";)N.shift(),w-=1;a.pathname=N.join("/")}u=w>=0?e[w]:"/"}let m=GA(a,u),p=c&&c!=="/"&&c.endsWith("/"),b=(l||c===".")&&t.endsWith("/");return!m.pathname.endsWith("/")&&(p||b)&&(m.pathname+="/"),m}var Xo=r=>r.join("/").replace(/\/\/+/g,"/"),KA=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),YA=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,XA=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function JA(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}var ZE=["POST","PUT","PATCH","DELETE"];new Set(ZE);var ZA=["GET",...ZE];new Set(ZA);var ah=j.createContext(null);ah.displayName="DataRouter";var cx=j.createContext(null);cx.displayName="DataRouterState";j.createContext(!1);var eS=j.createContext({isTransitioning:!1});eS.displayName="ViewTransition";var e2=j.createContext(new Map);e2.displayName="Fetchers";var t2=j.createContext(null);t2.displayName="Await";var ro=j.createContext(null);ro.displayName="Navigation";var jf=j.createContext(null);jf.displayName="Location";var io=j.createContext({outlet:null,matches:[],isDataRoute:!1});io.displayName="Route";var E0=j.createContext(null);E0.displayName="RouteError";function n2(r,{relative:e}={}){fs(_f(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:s}=j.useContext(ro),{hash:a,pathname:l,search:c}=Ef(r,{relative:e}),u=l;return t!=="/"&&(u=l==="/"?t:Xo([t,l])),s.createHref({pathname:u,search:c,hash:a})}function _f(){return j.useContext(jf)!=null}function al(){return fs(_f(),"useLocation() may be used only in the context of a <Router> component."),j.useContext(jf).location}var tS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function nS(r){j.useContext(ro).static||j.useLayoutEffect(r)}function os(){let{isDataRoute:r}=j.useContext(io);return r?p2():s2()}function s2(){fs(_f(),"useNavigate() may be used only in the context of a <Router> component.");let r=j.useContext(ah),{basename:e,navigator:t}=j.useContext(ro),{matches:s}=j.useContext(io),{pathname:a}=al(),l=JSON.stringify(XE(s)),c=j.useRef(!1);return nS(()=>{c.current=!0}),j.useCallback((m,p={})=>{if(no(c.current,tS),!c.current)return;if(typeof m=="number"){t.go(m);return}let b=JE(m,JSON.parse(l),a,p.relative==="path");r==null&&e!=="/"&&(b.pathname=b.pathname==="/"?e:Xo([e,b.pathname])),(p.replace?t.replace:t.push)(b,p.state,p)},[e,t,l,a,r])}j.createContext(null);function ea(){let{matches:r}=j.useContext(io),e=r[r.length-1];return e?e.params:{}}function Ef(r,{relative:e}={}){let{matches:t}=j.useContext(io),{pathname:s}=al(),a=JSON.stringify(XE(t));return j.useMemo(()=>JE(r,JSON.parse(a),s,e==="path"),[r,a,s,e])}function r2(r,e){return sS(r,e)}function sS(r,e,t,s){fs(_f(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:a}=j.useContext(ro),{matches:l}=j.useContext(io),c=l[l.length-1],u=c?c.params:{},m=c?c.pathname:"/",p=c?c.pathnameBase:"/",b=c&&c.route;{let T=b&&b.path||"";rS(m,!b||T.endsWith("*")||T.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${T}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${T}"> to <Route path="${T==="/"?"*":`${T}/*`}">.`)}let w=al(),N;if(e){let T=typeof e=="string"?ih(e):e;fs(p==="/"||T.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${T.pathname}" was given in the \`location\` prop.`),N=T}else N=w;let R=N.pathname||"/",O=R;if(p!=="/"){let T=p.replace(/^\//,"").split("/");O="/"+R.replace(/^\//,"").split("/").slice(T.length).join("/")}let G=WE(r,{pathname:O});no(b||G!=null,`No routes matched location "${N.pathname}${N.search}${N.hash}" `),no(G==null||G[G.length-1].route.element!==void 0||G[G.length-1].route.Component!==void 0||G[G.length-1].route.lazy!==void 0,`Matched leaf route at location "${N.pathname}${N.search}${N.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let U=c2(G&&G.map(T=>Object.assign({},T,{params:Object.assign({},u,T.params),pathname:Xo([p,a.encodeLocation?a.encodeLocation(T.pathname).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?p:Xo([p,a.encodeLocation?a.encodeLocation(T.pathnameBase).pathname:T.pathnameBase])})),l,t,s);return e&&U?j.createElement(jf.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...N},navigationType:"POP"}},U):U}function i2(){let r=f2(),e=JA(r)?`${r.status} ${r.statusText}`:r instanceof Error?r.message:JSON.stringify(r),t=r instanceof Error?r.stack:null,s="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:s},l={padding:"2px 4px",backgroundColor:s},c=null;return console.error("Error handled by React Router default ErrorBoundary:",r),c=j.createElement(j.Fragment,null,j.createElement("p",null,"💿 Hey developer 👋"),j.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",j.createElement("code",{style:l},"ErrorBoundary")," or"," ",j.createElement("code",{style:l},"errorElement")," prop on your route.")),j.createElement(j.Fragment,null,j.createElement("h2",null,"Unexpected Application Error!"),j.createElement("h3",{style:{fontStyle:"italic"}},e),t?j.createElement("pre",{style:a},t):null,c)}var a2=j.createElement(i2,null),o2=class extends j.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,e){return e.location!==r.location||e.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:e.error,location:e.location,revalidation:r.revalidation||e.revalidation}}componentDidCatch(r,e){console.error("React Router caught the following error during render",r,e)}render(){return this.state.error!==void 0?j.createElement(io.Provider,{value:this.props.routeContext},j.createElement(E0.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function l2({routeContext:r,match:e,children:t}){let s=j.useContext(ah);return s&&s.static&&s.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=e.route.id),j.createElement(io.Provider,{value:r},t)}function c2(r,e=[],t=null,s=null){if(r==null){if(!t)return null;if(t.errors)r=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)r=t.matches;else return null}let a=r,l=t?.errors;if(l!=null){let m=a.findIndex(p=>p.route.id&&l?.[p.route.id]!==void 0);fs(m>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),a=a.slice(0,Math.min(a.length,m+1))}let c=!1,u=-1;if(t)for(let m=0;m<a.length;m++){let p=a[m];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(u=m),p.route.id){let{loaderData:b,errors:w}=t,N=p.route.loader&&!b.hasOwnProperty(p.route.id)&&(!w||w[p.route.id]===void 0);if(p.route.lazy||N){c=!0,u>=0?a=a.slice(0,u+1):a=[a[0]];break}}}return a.reduceRight((m,p,b)=>{let w,N=!1,R=null,O=null;t&&(w=l&&p.route.id?l[p.route.id]:void 0,R=p.route.errorElement||a2,c&&(u<0&&b===0?(rS("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),N=!0,O=null):u===b&&(N=!0,O=p.route.hydrateFallbackElement||null)));let G=e.concat(a.slice(0,b+1)),U=()=>{let T;return w?T=R:N?T=O:p.route.Component?T=j.createElement(p.route.Component,null):p.route.element?T=p.route.element:T=m,j.createElement(l2,{match:p,routeContext:{outlet:m,matches:G,isDataRoute:t!=null},children:T})};return t&&(p.route.ErrorBoundary||p.route.errorElement||b===0)?j.createElement(o2,{location:t.location,revalidation:t.revalidation,component:R,error:w,children:U(),routeContext:{outlet:null,matches:G,isDataRoute:!0}}):U()},null)}function S0(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function d2(r){let e=j.useContext(ah);return fs(e,S0(r)),e}function u2(r){let e=j.useContext(cx);return fs(e,S0(r)),e}function h2(r){let e=j.useContext(io);return fs(e,S0(r)),e}function I0(r){let e=h2(r),t=e.matches[e.matches.length-1];return fs(t.route.id,`${r} can only be used on routes that contain a unique "id"`),t.route.id}function m2(){return I0("useRouteId")}function f2(){let r=j.useContext(E0),e=u2("useRouteError"),t=I0("useRouteError");return r!==void 0?r:e.errors?.[t]}function p2(){let{router:r}=d2("useNavigate"),e=I0("useNavigate"),t=j.useRef(!1);return nS(()=>{t.current=!0}),j.useCallback(async(a,l={})=>{no(t.current,tS),t.current&&(typeof a=="number"?r.navigate(a):await r.navigate(a,{fromRouteId:e,...l}))},[r,e])}var Dj={};function rS(r,e,t){!e&&!Dj[r]&&(Dj[r]=!0,no(!1,t))}j.memo(g2);function g2({routes:r,future:e,state:t}){return sS(r,void 0,t,e)}function vn(r){fs(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function x2({basename:r="/",children:e=null,location:t,navigationType:s="POP",navigator:a,static:l=!1}){fs(!_f(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let c=r.replace(/^\/*/,"/"),u=j.useMemo(()=>({basename:c,navigator:a,static:l,future:{}}),[c,a,l]);typeof t=="string"&&(t=ih(t));let{pathname:m="/",search:p="",hash:b="",state:w=null,key:N="default"}=t,R=j.useMemo(()=>{let O=el(m,c);return O==null?null:{location:{pathname:O,search:p,hash:b,state:w,key:N},navigationType:s}},[c,m,p,b,w,N,s]);return no(R!=null,`<Router basename="${c}"> is not able to match the URL "${m}${p}${b}" because it does not start with the basename, so the <Router> won't render anything.`),R==null?null:j.createElement(ro.Provider,{value:u},j.createElement(jf.Provider,{children:e,value:R}))}function y2({children:r,location:e}){return r2(Mb(r),e)}function Mb(r,e=[]){let t=[];return j.Children.forEach(r,(s,a)=>{if(!j.isValidElement(s))return;let l=[...e,a];if(s.type===j.Fragment){t.push.apply(t,Mb(s.props.children,l));return}fs(s.type===vn,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),fs(!s.props.index||!s.props.children,"An index route cannot have child routes.");let c={id:s.props.id||l.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(c.children=Mb(s.props.children,l)),t.push(c)}),t}var hg="get",mg="application/x-www-form-urlencoded";function dx(r){return r!=null&&typeof r.tagName=="string"}function b2(r){return dx(r)&&r.tagName.toLowerCase()==="button"}function w2(r){return dx(r)&&r.tagName.toLowerCase()==="form"}function v2(r){return dx(r)&&r.tagName.toLowerCase()==="input"}function N2(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function j2(r,e){return r.button===0&&(!e||e==="_self")&&!N2(r)}var eg=null;function _2(){if(eg===null)try{new FormData(document.createElement("form"),0),eg=!1}catch{eg=!0}return eg}var E2=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function db(r){return r!=null&&!E2.has(r)?(no(!1,`"${r}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${mg}"`),null):r}function S2(r,e){let t,s,a,l,c;if(w2(r)){let u=r.getAttribute("action");s=u?el(u,e):null,t=r.getAttribute("method")||hg,a=db(r.getAttribute("enctype"))||mg,l=new FormData(r)}else if(b2(r)||v2(r)&&(r.type==="submit"||r.type==="image")){let u=r.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let m=r.getAttribute("formaction")||u.getAttribute("action");if(s=m?el(m,e):null,t=r.getAttribute("formmethod")||u.getAttribute("method")||hg,a=db(r.getAttribute("formenctype"))||db(u.getAttribute("enctype"))||mg,l=new FormData(u,r),!_2()){let{name:p,type:b,value:w}=r;if(b==="image"){let N=p?`${p}.`:"";l.append(`${N}x`,"0"),l.append(`${N}y`,"0")}else p&&l.append(p,w)}}else{if(dx(r))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=hg,s=null,a=mg,c=r}return l&&a==="text/plain"&&(c=l,l=void 0),{action:s,method:t.toLowerCase(),encType:a,formData:l,body:c}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function T0(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function I2(r,e,t){let s=typeof r=="string"?new URL(r,typeof window>"u"?"server://singlefetch/":window.location.origin):r;return s.pathname==="/"?s.pathname=`_root.${t}`:e&&el(s.pathname,e)==="/"?s.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:s.pathname=`${s.pathname.replace(/\/$/,"")}.${t}`,s}async function T2(r,e){if(r.id in e)return e[r.id];try{let t=await import(r.module);return e[r.id]=t,t}catch(t){return console.error(`Error loading route module \`${r.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function C2(r){return r==null?!1:r.href==null?r.rel==="preload"&&typeof r.imageSrcSet=="string"&&typeof r.imageSizes=="string":typeof r.rel=="string"&&typeof r.href=="string"}async function A2(r,e,t){let s=await Promise.all(r.map(async a=>{let l=e.routes[a.route.id];if(l){let c=await T2(l,t);return c.links?c.links():[]}return[]}));return k2(s.flat(1).filter(C2).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function Rj(r,e,t,s,a,l){let c=(m,p)=>t[p]?m.route.id!==t[p].route.id:!0,u=(m,p)=>t[p].pathname!==m.pathname||t[p].route.path?.endsWith("*")&&t[p].params["*"]!==m.params["*"];return l==="assets"?e.filter((m,p)=>c(m,p)||u(m,p)):l==="data"?e.filter((m,p)=>{let b=s.routes[m.route.id];if(!b||!b.hasLoader)return!1;if(c(m,p)||u(m,p))return!0;if(m.route.shouldRevalidate){let w=m.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(r,window.origin),nextParams:m.params,defaultShouldRevalidate:!0});if(typeof w=="boolean")return w}return!0}):[]}function D2(r,e,{includeHydrateFallback:t}={}){return R2(r.map(s=>{let a=e.routes[s.route.id];if(!a)return[];let l=[a.module];return a.clientActionModule&&(l=l.concat(a.clientActionModule)),a.clientLoaderModule&&(l=l.concat(a.clientLoaderModule)),t&&a.hydrateFallbackModule&&(l=l.concat(a.hydrateFallbackModule)),a.imports&&(l=l.concat(a.imports)),l}).flat(1))}function R2(r){return[...new Set(r)]}function P2(r){let e={},t=Object.keys(r).sort();for(let s of t)e[s]=r[s];return e}function k2(r,e){let t=new Set;return new Set(e),r.reduce((s,a)=>{let l=JSON.stringify(P2(a));return t.has(l)||(t.add(l),s.push({key:l,link:a})),s},[])}function iS(){let r=j.useContext(ah);return T0(r,"You must render this element inside a <DataRouterContext.Provider> element"),r}function O2(){let r=j.useContext(cx);return T0(r,"You must render this element inside a <DataRouterStateContext.Provider> element"),r}var C0=j.createContext(void 0);C0.displayName="FrameworkContext";function aS(){let r=j.useContext(C0);return T0(r,"You must render this element inside a <HydratedRouter> element"),r}function M2(r,e){let t=j.useContext(C0),[s,a]=j.useState(!1),[l,c]=j.useState(!1),{onFocus:u,onBlur:m,onMouseEnter:p,onMouseLeave:b,onTouchStart:w}=e,N=j.useRef(null);j.useEffect(()=>{if(r==="render"&&c(!0),r==="viewport"){let G=T=>{T.forEach(ee=>{c(ee.isIntersecting)})},U=new IntersectionObserver(G,{threshold:.5});return N.current&&U.observe(N.current),()=>{U.disconnect()}}},[r]),j.useEffect(()=>{if(s){let G=setTimeout(()=>{c(!0)},100);return()=>{clearTimeout(G)}}},[s]);let R=()=>{a(!0)},O=()=>{a(!1),c(!1)};return t?r!=="intent"?[l,N,{}]:[l,N,{onFocus:Tm(u,R),onBlur:Tm(m,O),onMouseEnter:Tm(p,R),onMouseLeave:Tm(b,O),onTouchStart:Tm(w,R)}]:[!1,N,{}]}function Tm(r,e){return t=>{r&&r(t),t.defaultPrevented||e(t)}}function L2({page:r,...e}){let{router:t}=iS(),s=j.useMemo(()=>WE(t.routes,r,t.basename),[t.routes,r,t.basename]);return s?j.createElement(U2,{page:r,matches:s,...e}):null}function F2(r){let{manifest:e,routeModules:t}=aS(),[s,a]=j.useState([]);return j.useEffect(()=>{let l=!1;return A2(r,e,t).then(c=>{l||a(c)}),()=>{l=!0}},[r,e,t]),s}function U2({page:r,matches:e,...t}){let s=al(),{manifest:a,routeModules:l}=aS(),{basename:c}=iS(),{loaderData:u,matches:m}=O2(),p=j.useMemo(()=>Rj(r,e,m,a,s,"data"),[r,e,m,a,s]),b=j.useMemo(()=>Rj(r,e,m,a,s,"assets"),[r,e,m,a,s]),w=j.useMemo(()=>{if(r===s.pathname+s.search+s.hash)return[];let O=new Set,G=!1;if(e.forEach(T=>{let ee=a.routes[T.route.id];!ee||!ee.hasLoader||(!p.some(Z=>Z.route.id===T.route.id)&&T.route.id in u&&l[T.route.id]?.shouldRevalidate||ee.hasClientLoader?G=!0:O.add(T.route.id))}),O.size===0)return[];let U=I2(r,c,"data");return G&&O.size>0&&U.searchParams.set("_routes",e.filter(T=>O.has(T.route.id)).map(T=>T.route.id).join(",")),[U.pathname+U.search]},[c,u,s,a,p,e,r,l]),N=j.useMemo(()=>D2(b,a),[b,a]),R=F2(b);return j.createElement(j.Fragment,null,w.map(O=>j.createElement("link",{key:O,rel:"prefetch",as:"fetch",href:O,...t})),N.map(O=>j.createElement("link",{key:O,rel:"modulepreload",href:O,...t})),R.map(({key:O,link:G})=>j.createElement("link",{key:O,...G})))}function V2(...r){return e=>{r.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var oS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{oS&&(window.__reactRouterVersion="7.7.0")}catch{}function z2({basename:r,children:e,window:t}){let s=j.useRef();s.current==null&&(s.current=CA({window:t,v5Compat:!0}));let a=s.current,[l,c]=j.useState({action:a.action,location:a.location}),u=j.useCallback(m=>{j.startTransition(()=>c(m))},[c]);return j.useLayoutEffect(()=>a.listen(u),[a,u]),j.createElement(x2,{basename:r,children:e,location:l.location,navigationType:l.action,navigator:a})}var lS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ho=j.forwardRef(function({onClick:e,discover:t="render",prefetch:s="none",relative:a,reloadDocument:l,replace:c,state:u,target:m,to:p,preventScrollReset:b,viewTransition:w,...N},R){let{basename:O}=j.useContext(ro),G=typeof p=="string"&&lS.test(p),U,T=!1;if(typeof p=="string"&&G&&(U=p,oS))try{let k=new URL(window.location.href),W=p.startsWith("//")?new URL(k.protocol+p):new URL(p),J=el(W.pathname,O);W.origin===k.origin&&J!=null?p=J+W.search+W.hash:T=!0}catch{no(!1,`<Link to="${p}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let ee=n2(p,{relative:a}),[Z,ie,X]=M2(s,N),pe=H2(p,{replace:c,state:u,target:m,preventScrollReset:b,relative:a,viewTransition:w});function H(k){e&&e(k),k.defaultPrevented||pe(k)}let B=j.createElement("a",{...N,...X,href:U||ee,onClick:T||l?e:H,ref:V2(R,ie),target:m,"data-discover":!G&&t==="render"?"true":void 0});return Z&&!G?j.createElement(j.Fragment,null,B,j.createElement(L2,{page:ee})):B});Ho.displayName="Link";var $2=j.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:s="",end:a=!1,style:l,to:c,viewTransition:u,children:m,...p},b){let w=Ef(c,{relative:p.relative}),N=al(),R=j.useContext(cx),{navigator:O,basename:G}=j.useContext(ro),U=R!=null&&Y2(w)&&u===!0,T=O.encodeLocation?O.encodeLocation(w).pathname:w.pathname,ee=N.pathname,Z=R&&R.navigation&&R.navigation.location?R.navigation.location.pathname:null;t||(ee=ee.toLowerCase(),Z=Z?Z.toLowerCase():null,T=T.toLowerCase()),Z&&G&&(Z=el(Z,G)||Z);const ie=T!=="/"&&T.endsWith("/")?T.length-1:T.length;let X=ee===T||!a&&ee.startsWith(T)&&ee.charAt(ie)==="/",pe=Z!=null&&(Z===T||!a&&Z.startsWith(T)&&Z.charAt(T.length)==="/"),H={isActive:X,isPending:pe,isTransitioning:U},B=X?e:void 0,k;typeof s=="function"?k=s(H):k=[s,X?"active":null,pe?"pending":null,U?"transitioning":null].filter(Boolean).join(" ");let W=typeof l=="function"?l(H):l;return j.createElement(Ho,{...p,"aria-current":B,className:k,ref:b,style:W,to:c,viewTransition:u},typeof m=="function"?m(H):m)});$2.displayName="NavLink";var B2=j.forwardRef(({discover:r="render",fetcherKey:e,navigate:t,reloadDocument:s,replace:a,state:l,method:c=hg,action:u,onSubmit:m,relative:p,preventScrollReset:b,viewTransition:w,...N},R)=>{let O=W2(),G=K2(u,{relative:p}),U=c.toLowerCase()==="get"?"get":"post",T=typeof u=="string"&&lS.test(u),ee=Z=>{if(m&&m(Z),Z.defaultPrevented)return;Z.preventDefault();let ie=Z.nativeEvent.submitter,X=ie?.getAttribute("formmethod")||c;O(ie||Z.currentTarget,{fetcherKey:e,method:X,navigate:t,replace:a,state:l,relative:p,preventScrollReset:b,viewTransition:w})};return j.createElement("form",{ref:R,method:U,action:G,onSubmit:s?m:ee,...N,"data-discover":!T&&r==="render"?"true":void 0})});B2.displayName="Form";function q2(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function cS(r){let e=j.useContext(ah);return fs(e,q2(r)),e}function H2(r,{target:e,replace:t,state:s,preventScrollReset:a,relative:l,viewTransition:c}={}){let u=os(),m=al(),p=Ef(r,{relative:l});return j.useCallback(b=>{if(j2(b,e)){b.preventDefault();let w=t!==void 0?t:sf(m)===sf(p);u(r,{replace:w,state:s,preventScrollReset:a,relative:l,viewTransition:c})}},[m,u,p,t,s,e,r,a,l,c])}var G2=0,Q2=()=>`__${String(++G2)}__`;function W2(){let{router:r}=cS("useSubmit"),{basename:e}=j.useContext(ro),t=m2();return j.useCallback(async(s,a={})=>{let{action:l,method:c,encType:u,formData:m,body:p}=S2(s,e);if(a.navigate===!1){let b=a.fetcherKey||Q2();await r.fetch(b,t,a.action||l,{preventScrollReset:a.preventScrollReset,formData:m,body:p,formMethod:a.method||c,formEncType:a.encType||u,flushSync:a.flushSync})}else await r.navigate(a.action||l,{preventScrollReset:a.preventScrollReset,formData:m,body:p,formMethod:a.method||c,formEncType:a.encType||u,replace:a.replace,state:a.state,fromRouteId:t,flushSync:a.flushSync,viewTransition:a.viewTransition})},[r,e,t])}function K2(r,{relative:e}={}){let{basename:t}=j.useContext(ro),s=j.useContext(io);fs(s,"useFormAction must be used inside a RouteContext");let[a]=s.matches.slice(-1),l={...Ef(r||".",{relative:e})},c=al();if(r==null){l.search=c.search;let u=new URLSearchParams(l.search),m=u.getAll("index");if(m.some(b=>b==="")){u.delete("index"),m.filter(w=>w).forEach(w=>u.append("index",w));let b=u.toString();l.search=b?`?${b}`:""}}return(!r||r===".")&&a.route.index&&(l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(l.pathname=l.pathname==="/"?t:Xo([t,l.pathname])),sf(l)}function Y2(r,e={}){let t=j.useContext(eS);fs(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=cS("useViewTransitionState"),a=Ef(r,{relative:e.relative});if(!t.isTransitioning)return!1;let l=el(t.currentLocation.pathname,s)||t.currentLocation.pathname,c=el(t.nextLocation.pathname,s)||t.nextLocation.pathname;return Rg(a.pathname,c)!=null||Rg(a.pathname,l)!=null}const X2=()=>{};var Pj={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dS=function(r){const e=[];let t=0;for(let s=0;s<r.length;s++){let a=r.charCodeAt(s);a<128?e[t++]=a:a<2048?(e[t++]=a>>6|192,e[t++]=a&63|128):(a&64512)===55296&&s+1<r.length&&(r.charCodeAt(s+1)&64512)===56320?(a=65536+((a&1023)<<10)+(r.charCodeAt(++s)&1023),e[t++]=a>>18|240,e[t++]=a>>12&63|128,e[t++]=a>>6&63|128,e[t++]=a&63|128):(e[t++]=a>>12|224,e[t++]=a>>6&63|128,e[t++]=a&63|128)}return e},J2=function(r){const e=[];let t=0,s=0;for(;t<r.length;){const a=r[t++];if(a<128)e[s++]=String.fromCharCode(a);else if(a>191&&a<224){const l=r[t++];e[s++]=String.fromCharCode((a&31)<<6|l&63)}else if(a>239&&a<365){const l=r[t++],c=r[t++],u=r[t++],m=((a&7)<<18|(l&63)<<12|(c&63)<<6|u&63)-65536;e[s++]=String.fromCharCode(55296+(m>>10)),e[s++]=String.fromCharCode(56320+(m&1023))}else{const l=r[t++],c=r[t++];e[s++]=String.fromCharCode((a&15)<<12|(l&63)<<6|c&63)}}return e.join("")},uS={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let a=0;a<r.length;a+=3){const l=r[a],c=a+1<r.length,u=c?r[a+1]:0,m=a+2<r.length,p=m?r[a+2]:0,b=l>>2,w=(l&3)<<4|u>>4;let N=(u&15)<<2|p>>6,R=p&63;m||(R=64,c||(N=64)),s.push(t[b],t[w],t[N],t[R])}return s.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(dS(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):J2(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let a=0;a<r.length;){const l=t[r.charAt(a++)],u=a<r.length?t[r.charAt(a)]:0;++a;const p=a<r.length?t[r.charAt(a)]:64;++a;const w=a<r.length?t[r.charAt(a)]:64;if(++a,l==null||u==null||p==null||w==null)throw new Z2;const N=l<<2|u>>4;if(s.push(N),p!==64){const R=u<<4&240|p>>2;if(s.push(R),w!==64){const O=p<<6&192|w;s.push(O)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class Z2 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const eD=function(r){const e=dS(r);return uS.encodeByteArray(e,!0)},Pg=function(r){return eD(r).replace(/\./g,"")},hS=function(r){try{return uS.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mS(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tD=()=>mS().__FIREBASE_DEFAULTS__,nD=()=>{if(typeof process>"u"||typeof Pj>"u")return;const r=Pj.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},sD=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=r&&hS(r[1]);return e&&JSON.parse(e)},ux=()=>{try{return X2()||tD()||nD()||sD()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},fS=r=>ux()?.emulatorHosts?.[r],pS=r=>{const e=fS(r);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},gS=()=>ux()?.config,xS=r=>ux()?.[`_${r}`];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rD{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ol(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}async function hx(r){return(await fetch(r,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yS(r,e){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",a=r.iat||0,l=r.sub||r.user_id;if(!l)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const c={iss:`https://securetoken.google.com/${s}`,aud:s,iat:a,exp:a+3600,auth_time:a,sub:l,user_id:l,firebase:{sign_in_provider:"custom",identities:{}},...r};return[Pg(JSON.stringify(t)),Pg(JSON.stringify(c)),""].join(".")}const zm={};function iD(){const r={prod:[],emulator:[]};for(const e of Object.keys(zm))zm[e]?r.emulator.push(e):r.prod.push(e);return r}function aD(r){let e=document.getElementById(r),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",r),t=!0),{created:t,element:e}}let kj=!1;function A0(r,e){if(typeof window>"u"||typeof document>"u"||!ol(window.location.host)||zm[r]===e||zm[r]||kj)return;zm[r]=e;function t(N){return`__firebase__banner__${N}`}const s="__firebase__banner",l=iD().prod.length>0;function c(){const N=document.getElementById(s);N&&N.remove()}function u(N){N.style.display="flex",N.style.background="#7faaf0",N.style.position="fixed",N.style.bottom="5px",N.style.left="5px",N.style.padding=".5em",N.style.borderRadius="5px",N.style.alignItems="center"}function m(N,R){N.setAttribute("width","24"),N.setAttribute("id",R),N.setAttribute("height","24"),N.setAttribute("viewBox","0 0 24 24"),N.setAttribute("fill","none"),N.style.marginLeft="-6px"}function p(){const N=document.createElement("span");return N.style.cursor="pointer",N.style.marginLeft="16px",N.style.fontSize="24px",N.innerHTML=" &times;",N.onclick=()=>{kj=!0,c()},N}function b(N,R){N.setAttribute("id",R),N.innerText="Learn more",N.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",N.setAttribute("target","__blank"),N.style.paddingLeft="5px",N.style.textDecoration="underline"}function w(){const N=aD(s),R=t("text"),O=document.getElementById(R)||document.createElement("span"),G=t("learnmore"),U=document.getElementById(G)||document.createElement("a"),T=t("preprendIcon"),ee=document.getElementById(T)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(N.created){const Z=N.element;u(Z),b(U,G);const ie=p();m(ee,T),Z.append(ee,O,U,ie),document.body.appendChild(Z)}l?(O.innerText="Preview backend disconnected.",ee.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(ee.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,O.innerText="Preview backend running in this workspace."),O.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",w):w()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Js(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function oD(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Js())}function bS(){const r=ux()?.forceEnvironment;if(r==="node")return!0;if(r==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function lD(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function cD(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function dD(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function uD(){const r=Js();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function wS(){return!bS()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function vS(){return!bS()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function NS(){try{return typeof indexedDB=="object"}catch{return!1}}function hD(){return new Promise((r,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(s);a.onsuccess=()=>{a.result.close(),t||self.indexedDB.deleteDatabase(s),r(!0)},a.onupgradeneeded=()=>{t=!1},a.onerror=()=>{e(a.error?.message||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mD="FirebaseError";class ao extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=mD,Object.setPrototypeOf(this,ao.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Sf.prototype.create)}}class Sf{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},a=`${this.service}/${e}`,l=this.errors[e],c=l?fD(l,s):"Error",u=`${this.serviceName}: ${c} (${a}).`;return new ao(a,u,s)}}function fD(r,e){return r.replace(pD,(t,s)=>{const a=e[s];return a!=null?String(a):`<${s}?>`})}const pD=/\{\$([^}]+)}/g;function gD(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function mc(r,e){if(r===e)return!0;const t=Object.keys(r),s=Object.keys(e);for(const a of t){if(!s.includes(a))return!1;const l=r[a],c=e[a];if(Oj(l)&&Oj(c)){if(!mc(l,c))return!1}else if(l!==c)return!1}for(const a of s)if(!t.includes(a))return!1;return!0}function Oj(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function If(r){const e=[];for(const[t,s]of Object.entries(r))Array.isArray(s)?s.forEach(a=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function Om(r){const e={};return r.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[a,l]=s.split("=");e[decodeURIComponent(a)]=decodeURIComponent(l)}}),e}function Mm(r){const e=r.indexOf("?");if(!e)return"";const t=r.indexOf("#",e);return r.substring(e,t>0?t:void 0)}function xD(r,e){const t=new yD(r,e);return t.subscribe.bind(t)}class yD{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let a;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");bD(e,["next","error","complete"])?a=e:a={next:e,error:t,complete:s},a.next===void 0&&(a.next=ub),a.error===void 0&&(a.error=ub),a.complete===void 0&&(a.complete=ub);const l=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),l}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function bD(r,e){if(typeof r!="object"||r===null)return!1;for(const t of e)if(t in r&&typeof r[t]=="function")return!0;return!1}function ub(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zn(r){return r&&r._delegate?r._delegate:r}class fc{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rd="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wD{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new rD;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:t});a&&s.resolve(a)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),s=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(a){if(s)return null;throw a}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(ND(e))try{this.getOrInitializeService({instanceIdentifier:rd})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(t);try{const l=this.getOrInitializeService({instanceIdentifier:a});s.resolve(l)}catch{}}}}clearInstance(e=rd){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=rd){return this.instances.has(e)}getOptions(e=rd){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[l,c]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(l);s===u&&c.resolve(a)}return a}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),a=this.onInitCallbacks.get(s)??new Set;a.add(e),this.onInitCallbacks.set(s,a);const l=this.instances.get(s);return l&&e(l,s),()=>{a.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const a of s)try{a(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:vD(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=rd){return this.component?this.component.multipleInstances?e:rd:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function vD(r){return r===rd?void 0:r}function ND(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jD{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new wD(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cn;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(cn||(cn={}));const _D={debug:cn.DEBUG,verbose:cn.VERBOSE,info:cn.INFO,warn:cn.WARN,error:cn.ERROR,silent:cn.SILENT},ED=cn.INFO,SD={[cn.DEBUG]:"log",[cn.VERBOSE]:"log",[cn.INFO]:"info",[cn.WARN]:"warn",[cn.ERROR]:"error"},ID=(r,e,...t)=>{if(e<r.logLevel)return;const s=new Date().toISOString(),a=SD[e];if(a)console[a](`[${s}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class D0{constructor(e){this.name=e,this._logLevel=ED,this._logHandler=ID,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in cn))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?_D[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,cn.DEBUG,...e),this._logHandler(this,cn.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,cn.VERBOSE,...e),this._logHandler(this,cn.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,cn.INFO,...e),this._logHandler(this,cn.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,cn.WARN,...e),this._logHandler(this,cn.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,cn.ERROR,...e),this._logHandler(this,cn.ERROR,...e)}}const TD=(r,e)=>e.some(t=>r instanceof t);let Mj,Lj;function CD(){return Mj||(Mj=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function AD(){return Lj||(Lj=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const jS=new WeakMap,Lb=new WeakMap,_S=new WeakMap,hb=new WeakMap,R0=new WeakMap;function DD(r){const e=new Promise((t,s)=>{const a=()=>{r.removeEventListener("success",l),r.removeEventListener("error",c)},l=()=>{t(oc(r.result)),a()},c=()=>{s(r.error),a()};r.addEventListener("success",l),r.addEventListener("error",c)});return e.then(t=>{t instanceof IDBCursor&&jS.set(t,r)}).catch(()=>{}),R0.set(e,r),e}function RD(r){if(Lb.has(r))return;const e=new Promise((t,s)=>{const a=()=>{r.removeEventListener("complete",l),r.removeEventListener("error",c),r.removeEventListener("abort",c)},l=()=>{t(),a()},c=()=>{s(r.error||new DOMException("AbortError","AbortError")),a()};r.addEventListener("complete",l),r.addEventListener("error",c),r.addEventListener("abort",c)});Lb.set(r,e)}let Fb={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return Lb.get(r);if(e==="objectStoreNames")return r.objectStoreNames||_S.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return oc(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function PD(r){Fb=r(Fb)}function kD(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=r.call(mb(this),e,...t);return _S.set(s,e.sort?e.sort():[e]),oc(s)}:AD().includes(r)?function(...e){return r.apply(mb(this),e),oc(jS.get(this))}:function(...e){return oc(r.apply(mb(this),e))}}function OD(r){return typeof r=="function"?kD(r):(r instanceof IDBTransaction&&RD(r),TD(r,CD())?new Proxy(r,Fb):r)}function oc(r){if(r instanceof IDBRequest)return DD(r);if(hb.has(r))return hb.get(r);const e=OD(r);return e!==r&&(hb.set(r,e),R0.set(e,r)),e}const mb=r=>R0.get(r);function MD(r,e,{blocked:t,upgrade:s,blocking:a,terminated:l}={}){const c=indexedDB.open(r,e),u=oc(c);return s&&c.addEventListener("upgradeneeded",m=>{s(oc(c.result),m.oldVersion,m.newVersion,oc(c.transaction),m)}),t&&c.addEventListener("blocked",m=>t(m.oldVersion,m.newVersion,m)),u.then(m=>{l&&m.addEventListener("close",()=>l()),a&&m.addEventListener("versionchange",p=>a(p.oldVersion,p.newVersion,p))}).catch(()=>{}),u}const LD=["get","getKey","getAll","getAllKeys","count"],FD=["put","add","delete","clear"],fb=new Map;function Fj(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(fb.get(e))return fb.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,a=FD.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(a||LD.includes(t)))return;const l=async function(c,...u){const m=this.transaction(c,a?"readwrite":"readonly");let p=m.store;return s&&(p=p.index(u.shift())),(await Promise.all([p[t](...u),a&&m.done]))[0]};return fb.set(e,l),l}PD(r=>({...r,get:(e,t,s)=>Fj(e,t)||r.get(e,t,s),has:(e,t)=>!!Fj(e,t)||r.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UD{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(VD(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function VD(r){return r.getComponent()?.type==="VERSION"}const Ub="@firebase/app",Uj="0.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tl=new D0("@firebase/app"),zD="@firebase/app-compat",$D="@firebase/analytics-compat",BD="@firebase/analytics",qD="@firebase/app-check-compat",HD="@firebase/app-check",GD="@firebase/auth",QD="@firebase/auth-compat",WD="@firebase/database",KD="@firebase/data-connect",YD="@firebase/database-compat",XD="@firebase/functions",JD="@firebase/functions-compat",ZD="@firebase/installations",eR="@firebase/installations-compat",tR="@firebase/messaging",nR="@firebase/messaging-compat",sR="@firebase/performance",rR="@firebase/performance-compat",iR="@firebase/remote-config",aR="@firebase/remote-config-compat",oR="@firebase/storage",lR="@firebase/storage-compat",cR="@firebase/firestore",dR="@firebase/ai",uR="@firebase/firestore-compat",hR="firebase",mR="12.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vb="[DEFAULT]",fR={[Ub]:"fire-core",[zD]:"fire-core-compat",[BD]:"fire-analytics",[$D]:"fire-analytics-compat",[HD]:"fire-app-check",[qD]:"fire-app-check-compat",[GD]:"fire-auth",[QD]:"fire-auth-compat",[WD]:"fire-rtdb",[KD]:"fire-data-connect",[YD]:"fire-rtdb-compat",[XD]:"fire-fn",[JD]:"fire-fn-compat",[ZD]:"fire-iid",[eR]:"fire-iid-compat",[tR]:"fire-fcm",[nR]:"fire-fcm-compat",[sR]:"fire-perf",[rR]:"fire-perf-compat",[iR]:"fire-rc",[aR]:"fire-rc-compat",[oR]:"fire-gcs",[lR]:"fire-gcs-compat",[cR]:"fire-fst",[uR]:"fire-fst-compat",[dR]:"fire-vertex","fire-js":"fire-js",[hR]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kg=new Map,pR=new Map,zb=new Map;function Vj(r,e){try{r.container.addComponent(e)}catch(t){tl.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function bd(r){const e=r.name;if(zb.has(e))return tl.debug(`There were multiple attempts to register component ${e}.`),!1;zb.set(e,r);for(const t of kg.values())Vj(t,r);for(const t of pR.values())Vj(t,r);return!0}function Tf(r,e){const t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function si(r){return r==null?!1:r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gR={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},lc=new Sf("app","Firebase",gR);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xR{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new fc("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw lc.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cd=mR;function P0(r,e={}){let t=r;typeof e!="object"&&(e={name:e});const s={name:Vb,automaticDataCollectionEnabled:!0,...e},a=s.name;if(typeof a!="string"||!a)throw lc.create("bad-app-name",{appName:String(a)});if(t||(t=gS()),!t)throw lc.create("no-options");const l=kg.get(a);if(l){if(mc(t,l.options)&&mc(s,l.config))return l;throw lc.create("duplicate-app",{appName:a})}const c=new jD(a);for(const m of zb.values())c.addComponent(m);const u=new xR(t,s,c);return kg.set(a,u),u}function k0(r=Vb){const e=kg.get(r);if(!e&&r===Vb&&gS())return P0();if(!e)throw lc.create("no-app",{appName:r});return e}function Ka(r,e,t){let s=fR[r]??r;t&&(s+=`-${t}`);const a=s.match(/\s|\//),l=e.match(/\s|\//);if(a||l){const c=[`Unable to register library "${s}" with version "${e}":`];a&&c.push(`library name "${s}" contains illegal characters (whitespace or "/")`),a&&l&&c.push("and"),l&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),tl.warn(c.join(" "));return}bd(new fc(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yR="firebase-heartbeat-database",bR=1,rf="firebase-heartbeat-store";let pb=null;function ES(){return pb||(pb=MD(yR,bR,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(rf)}catch(t){console.warn(t)}}}}).catch(r=>{throw lc.create("idb-open",{originalErrorMessage:r.message})})),pb}async function wR(r){try{const t=(await ES()).transaction(rf),s=await t.objectStore(rf).get(SS(r));return await t.done,s}catch(e){if(e instanceof ao)tl.warn(e.message);else{const t=lc.create("idb-get",{originalErrorMessage:e?.message});tl.warn(t.message)}}}async function zj(r,e){try{const s=(await ES()).transaction(rf,"readwrite");await s.objectStore(rf).put(e,SS(r)),await s.done}catch(t){if(t instanceof ao)tl.warn(t.message);else{const s=lc.create("idb-set",{originalErrorMessage:t?.message});tl.warn(s.message)}}}function SS(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vR=1024,NR=30;class jR{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ER(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=$j();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:t}),this._heartbeatsCache.heartbeats.length>NR){const a=SR(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){tl.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=$j(),{heartbeatsToSend:t,unsentEntries:s}=_R(this._heartbeatsCache.heartbeats),a=Pg(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(e){return tl.warn(e),""}}}function $j(){return new Date().toISOString().substring(0,10)}function _R(r,e=vR){const t=[];let s=r.slice();for(const a of r){const l=t.find(c=>c.agent===a.agent);if(l){if(l.dates.push(a.date),Bj(t)>e){l.dates.pop();break}}else if(t.push({agent:a.agent,dates:[a.date]}),Bj(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class ER{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return NS()?hD().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await wR(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return zj(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return zj(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Bj(r){return Pg(JSON.stringify({version:2,heartbeats:r})).length}function SR(r){if(r.length===0)return-1;let e=0,t=r[0].date;for(let s=1;s<r.length;s++)r[s].date<t&&(t=r[s].date,e=s);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IR(r){bd(new fc("platform-logger",e=>new UD(e),"PRIVATE")),bd(new fc("heartbeat",e=>new jR(e),"PRIVATE")),Ka(Ub,Uj,r),Ka(Ub,Uj,"esm2020"),Ka("fire-js","")}IR("");var qj=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var cc,IS;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(H,B){function k(){}k.prototype=B.prototype,H.D=B.prototype,H.prototype=new k,H.prototype.constructor=H,H.C=function(W,J,z){for(var L=Array(arguments.length-2),de=2;de<arguments.length;de++)L[de-2]=arguments[de];return B.prototype[J].apply(W,L)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(s,t),s.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(H,B,k){k||(k=0);var W=Array(16);if(typeof B=="string")for(var J=0;16>J;++J)W[J]=B.charCodeAt(k++)|B.charCodeAt(k++)<<8|B.charCodeAt(k++)<<16|B.charCodeAt(k++)<<24;else for(J=0;16>J;++J)W[J]=B[k++]|B[k++]<<8|B[k++]<<16|B[k++]<<24;B=H.g[0],k=H.g[1],J=H.g[2];var z=H.g[3],L=B+(z^k&(J^z))+W[0]+3614090360&4294967295;B=k+(L<<7&4294967295|L>>>25),L=z+(J^B&(k^J))+W[1]+3905402710&4294967295,z=B+(L<<12&4294967295|L>>>20),L=J+(k^z&(B^k))+W[2]+606105819&4294967295,J=z+(L<<17&4294967295|L>>>15),L=k+(B^J&(z^B))+W[3]+3250441966&4294967295,k=J+(L<<22&4294967295|L>>>10),L=B+(z^k&(J^z))+W[4]+4118548399&4294967295,B=k+(L<<7&4294967295|L>>>25),L=z+(J^B&(k^J))+W[5]+1200080426&4294967295,z=B+(L<<12&4294967295|L>>>20),L=J+(k^z&(B^k))+W[6]+2821735955&4294967295,J=z+(L<<17&4294967295|L>>>15),L=k+(B^J&(z^B))+W[7]+4249261313&4294967295,k=J+(L<<22&4294967295|L>>>10),L=B+(z^k&(J^z))+W[8]+1770035416&4294967295,B=k+(L<<7&4294967295|L>>>25),L=z+(J^B&(k^J))+W[9]+2336552879&4294967295,z=B+(L<<12&4294967295|L>>>20),L=J+(k^z&(B^k))+W[10]+4294925233&4294967295,J=z+(L<<17&4294967295|L>>>15),L=k+(B^J&(z^B))+W[11]+2304563134&4294967295,k=J+(L<<22&4294967295|L>>>10),L=B+(z^k&(J^z))+W[12]+1804603682&4294967295,B=k+(L<<7&4294967295|L>>>25),L=z+(J^B&(k^J))+W[13]+4254626195&4294967295,z=B+(L<<12&4294967295|L>>>20),L=J+(k^z&(B^k))+W[14]+2792965006&4294967295,J=z+(L<<17&4294967295|L>>>15),L=k+(B^J&(z^B))+W[15]+1236535329&4294967295,k=J+(L<<22&4294967295|L>>>10),L=B+(J^z&(k^J))+W[1]+4129170786&4294967295,B=k+(L<<5&4294967295|L>>>27),L=z+(k^J&(B^k))+W[6]+3225465664&4294967295,z=B+(L<<9&4294967295|L>>>23),L=J+(B^k&(z^B))+W[11]+643717713&4294967295,J=z+(L<<14&4294967295|L>>>18),L=k+(z^B&(J^z))+W[0]+3921069994&4294967295,k=J+(L<<20&4294967295|L>>>12),L=B+(J^z&(k^J))+W[5]+3593408605&4294967295,B=k+(L<<5&4294967295|L>>>27),L=z+(k^J&(B^k))+W[10]+38016083&4294967295,z=B+(L<<9&4294967295|L>>>23),L=J+(B^k&(z^B))+W[15]+3634488961&4294967295,J=z+(L<<14&4294967295|L>>>18),L=k+(z^B&(J^z))+W[4]+3889429448&4294967295,k=J+(L<<20&4294967295|L>>>12),L=B+(J^z&(k^J))+W[9]+568446438&4294967295,B=k+(L<<5&4294967295|L>>>27),L=z+(k^J&(B^k))+W[14]+3275163606&4294967295,z=B+(L<<9&4294967295|L>>>23),L=J+(B^k&(z^B))+W[3]+4107603335&4294967295,J=z+(L<<14&4294967295|L>>>18),L=k+(z^B&(J^z))+W[8]+1163531501&4294967295,k=J+(L<<20&4294967295|L>>>12),L=B+(J^z&(k^J))+W[13]+2850285829&4294967295,B=k+(L<<5&4294967295|L>>>27),L=z+(k^J&(B^k))+W[2]+4243563512&4294967295,z=B+(L<<9&4294967295|L>>>23),L=J+(B^k&(z^B))+W[7]+1735328473&4294967295,J=z+(L<<14&4294967295|L>>>18),L=k+(z^B&(J^z))+W[12]+2368359562&4294967295,k=J+(L<<20&4294967295|L>>>12),L=B+(k^J^z)+W[5]+4294588738&4294967295,B=k+(L<<4&4294967295|L>>>28),L=z+(B^k^J)+W[8]+2272392833&4294967295,z=B+(L<<11&4294967295|L>>>21),L=J+(z^B^k)+W[11]+1839030562&4294967295,J=z+(L<<16&4294967295|L>>>16),L=k+(J^z^B)+W[14]+4259657740&4294967295,k=J+(L<<23&4294967295|L>>>9),L=B+(k^J^z)+W[1]+2763975236&4294967295,B=k+(L<<4&4294967295|L>>>28),L=z+(B^k^J)+W[4]+1272893353&4294967295,z=B+(L<<11&4294967295|L>>>21),L=J+(z^B^k)+W[7]+4139469664&4294967295,J=z+(L<<16&4294967295|L>>>16),L=k+(J^z^B)+W[10]+3200236656&4294967295,k=J+(L<<23&4294967295|L>>>9),L=B+(k^J^z)+W[13]+681279174&4294967295,B=k+(L<<4&4294967295|L>>>28),L=z+(B^k^J)+W[0]+3936430074&4294967295,z=B+(L<<11&4294967295|L>>>21),L=J+(z^B^k)+W[3]+3572445317&4294967295,J=z+(L<<16&4294967295|L>>>16),L=k+(J^z^B)+W[6]+76029189&4294967295,k=J+(L<<23&4294967295|L>>>9),L=B+(k^J^z)+W[9]+3654602809&4294967295,B=k+(L<<4&4294967295|L>>>28),L=z+(B^k^J)+W[12]+3873151461&4294967295,z=B+(L<<11&4294967295|L>>>21),L=J+(z^B^k)+W[15]+530742520&4294967295,J=z+(L<<16&4294967295|L>>>16),L=k+(J^z^B)+W[2]+3299628645&4294967295,k=J+(L<<23&4294967295|L>>>9),L=B+(J^(k|~z))+W[0]+4096336452&4294967295,B=k+(L<<6&4294967295|L>>>26),L=z+(k^(B|~J))+W[7]+1126891415&4294967295,z=B+(L<<10&4294967295|L>>>22),L=J+(B^(z|~k))+W[14]+2878612391&4294967295,J=z+(L<<15&4294967295|L>>>17),L=k+(z^(J|~B))+W[5]+4237533241&4294967295,k=J+(L<<21&4294967295|L>>>11),L=B+(J^(k|~z))+W[12]+1700485571&4294967295,B=k+(L<<6&4294967295|L>>>26),L=z+(k^(B|~J))+W[3]+2399980690&4294967295,z=B+(L<<10&4294967295|L>>>22),L=J+(B^(z|~k))+W[10]+4293915773&4294967295,J=z+(L<<15&4294967295|L>>>17),L=k+(z^(J|~B))+W[1]+2240044497&4294967295,k=J+(L<<21&4294967295|L>>>11),L=B+(J^(k|~z))+W[8]+1873313359&4294967295,B=k+(L<<6&4294967295|L>>>26),L=z+(k^(B|~J))+W[15]+4264355552&4294967295,z=B+(L<<10&4294967295|L>>>22),L=J+(B^(z|~k))+W[6]+2734768916&4294967295,J=z+(L<<15&4294967295|L>>>17),L=k+(z^(J|~B))+W[13]+1309151649&4294967295,k=J+(L<<21&4294967295|L>>>11),L=B+(J^(k|~z))+W[4]+4149444226&4294967295,B=k+(L<<6&4294967295|L>>>26),L=z+(k^(B|~J))+W[11]+3174756917&4294967295,z=B+(L<<10&4294967295|L>>>22),L=J+(B^(z|~k))+W[2]+718787259&4294967295,J=z+(L<<15&4294967295|L>>>17),L=k+(z^(J|~B))+W[9]+3951481745&4294967295,H.g[0]=H.g[0]+B&4294967295,H.g[1]=H.g[1]+(J+(L<<21&4294967295|L>>>11))&4294967295,H.g[2]=H.g[2]+J&4294967295,H.g[3]=H.g[3]+z&4294967295}s.prototype.u=function(H,B){B===void 0&&(B=H.length);for(var k=B-this.blockSize,W=this.B,J=this.h,z=0;z<B;){if(J==0)for(;z<=k;)a(this,H,z),z+=this.blockSize;if(typeof H=="string"){for(;z<B;)if(W[J++]=H.charCodeAt(z++),J==this.blockSize){a(this,W),J=0;break}}else for(;z<B;)if(W[J++]=H[z++],J==this.blockSize){a(this,W),J=0;break}}this.h=J,this.o+=B},s.prototype.v=function(){var H=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);H[0]=128;for(var B=1;B<H.length-8;++B)H[B]=0;var k=8*this.o;for(B=H.length-8;B<H.length;++B)H[B]=k&255,k/=256;for(this.u(H),H=Array(16),B=k=0;4>B;++B)for(var W=0;32>W;W+=8)H[k++]=this.g[B]>>>W&255;return H};function l(H,B){var k=u;return Object.prototype.hasOwnProperty.call(k,H)?k[H]:k[H]=B(H)}function c(H,B){this.h=B;for(var k=[],W=!0,J=H.length-1;0<=J;J--){var z=H[J]|0;W&&z==B||(k[J]=z,W=!1)}this.g=k}var u={};function m(H){return-128<=H&&128>H?l(H,function(B){return new c([B|0],0>B?-1:0)}):new c([H|0],0>H?-1:0)}function p(H){if(isNaN(H)||!isFinite(H))return w;if(0>H)return U(p(-H));for(var B=[],k=1,W=0;H>=k;W++)B[W]=H/k|0,k*=4294967296;return new c(B,0)}function b(H,B){if(H.length==0)throw Error("number format error: empty string");if(B=B||10,2>B||36<B)throw Error("radix out of range: "+B);if(H.charAt(0)=="-")return U(b(H.substring(1),B));if(0<=H.indexOf("-"))throw Error('number format error: interior "-" character');for(var k=p(Math.pow(B,8)),W=w,J=0;J<H.length;J+=8){var z=Math.min(8,H.length-J),L=parseInt(H.substring(J,J+z),B);8>z?(z=p(Math.pow(B,z)),W=W.j(z).add(p(L))):(W=W.j(k),W=W.add(p(L)))}return W}var w=m(0),N=m(1),R=m(16777216);r=c.prototype,r.m=function(){if(G(this))return-U(this).m();for(var H=0,B=1,k=0;k<this.g.length;k++){var W=this.i(k);H+=(0<=W?W:4294967296+W)*B,B*=4294967296}return H},r.toString=function(H){if(H=H||10,2>H||36<H)throw Error("radix out of range: "+H);if(O(this))return"0";if(G(this))return"-"+U(this).toString(H);for(var B=p(Math.pow(H,6)),k=this,W="";;){var J=ie(k,B).g;k=T(k,J.j(B));var z=((0<k.g.length?k.g[0]:k.h)>>>0).toString(H);if(k=J,O(k))return z+W;for(;6>z.length;)z="0"+z;W=z+W}},r.i=function(H){return 0>H?0:H<this.g.length?this.g[H]:this.h};function O(H){if(H.h!=0)return!1;for(var B=0;B<H.g.length;B++)if(H.g[B]!=0)return!1;return!0}function G(H){return H.h==-1}r.l=function(H){return H=T(this,H),G(H)?-1:O(H)?0:1};function U(H){for(var B=H.g.length,k=[],W=0;W<B;W++)k[W]=~H.g[W];return new c(k,~H.h).add(N)}r.abs=function(){return G(this)?U(this):this},r.add=function(H){for(var B=Math.max(this.g.length,H.g.length),k=[],W=0,J=0;J<=B;J++){var z=W+(this.i(J)&65535)+(H.i(J)&65535),L=(z>>>16)+(this.i(J)>>>16)+(H.i(J)>>>16);W=L>>>16,z&=65535,L&=65535,k[J]=L<<16|z}return new c(k,k[k.length-1]&-2147483648?-1:0)};function T(H,B){return H.add(U(B))}r.j=function(H){if(O(this)||O(H))return w;if(G(this))return G(H)?U(this).j(U(H)):U(U(this).j(H));if(G(H))return U(this.j(U(H)));if(0>this.l(R)&&0>H.l(R))return p(this.m()*H.m());for(var B=this.g.length+H.g.length,k=[],W=0;W<2*B;W++)k[W]=0;for(W=0;W<this.g.length;W++)for(var J=0;J<H.g.length;J++){var z=this.i(W)>>>16,L=this.i(W)&65535,de=H.i(J)>>>16,Pe=H.i(J)&65535;k[2*W+2*J]+=L*Pe,ee(k,2*W+2*J),k[2*W+2*J+1]+=z*Pe,ee(k,2*W+2*J+1),k[2*W+2*J+1]+=L*de,ee(k,2*W+2*J+1),k[2*W+2*J+2]+=z*de,ee(k,2*W+2*J+2)}for(W=0;W<B;W++)k[W]=k[2*W+1]<<16|k[2*W];for(W=B;W<2*B;W++)k[W]=0;return new c(k,0)};function ee(H,B){for(;(H[B]&65535)!=H[B];)H[B+1]+=H[B]>>>16,H[B]&=65535,B++}function Z(H,B){this.g=H,this.h=B}function ie(H,B){if(O(B))throw Error("division by zero");if(O(H))return new Z(w,w);if(G(H))return B=ie(U(H),B),new Z(U(B.g),U(B.h));if(G(B))return B=ie(H,U(B)),new Z(U(B.g),B.h);if(30<H.g.length){if(G(H)||G(B))throw Error("slowDivide_ only works with positive integers.");for(var k=N,W=B;0>=W.l(H);)k=X(k),W=X(W);var J=pe(k,1),z=pe(W,1);for(W=pe(W,2),k=pe(k,2);!O(W);){var L=z.add(W);0>=L.l(H)&&(J=J.add(k),z=L),W=pe(W,1),k=pe(k,1)}return B=T(H,J.j(B)),new Z(J,B)}for(J=w;0<=H.l(B);){for(k=Math.max(1,Math.floor(H.m()/B.m())),W=Math.ceil(Math.log(k)/Math.LN2),W=48>=W?1:Math.pow(2,W-48),z=p(k),L=z.j(B);G(L)||0<L.l(H);)k-=W,z=p(k),L=z.j(B);O(z)&&(z=N),J=J.add(z),H=T(H,L)}return new Z(J,H)}r.A=function(H){return ie(this,H).h},r.and=function(H){for(var B=Math.max(this.g.length,H.g.length),k=[],W=0;W<B;W++)k[W]=this.i(W)&H.i(W);return new c(k,this.h&H.h)},r.or=function(H){for(var B=Math.max(this.g.length,H.g.length),k=[],W=0;W<B;W++)k[W]=this.i(W)|H.i(W);return new c(k,this.h|H.h)},r.xor=function(H){for(var B=Math.max(this.g.length,H.g.length),k=[],W=0;W<B;W++)k[W]=this.i(W)^H.i(W);return new c(k,this.h^H.h)};function X(H){for(var B=H.g.length+1,k=[],W=0;W<B;W++)k[W]=H.i(W)<<1|H.i(W-1)>>>31;return new c(k,H.h)}function pe(H,B){var k=B>>5;B%=32;for(var W=H.g.length-k,J=[],z=0;z<W;z++)J[z]=0<B?H.i(z+k)>>>B|H.i(z+k+1)<<32-B:H.i(z+k);return new c(J,H.h)}s.prototype.digest=s.prototype.v,s.prototype.reset=s.prototype.s,s.prototype.update=s.prototype.u,IS=s,c.prototype.add=c.prototype.add,c.prototype.multiply=c.prototype.j,c.prototype.modulo=c.prototype.A,c.prototype.compare=c.prototype.l,c.prototype.toNumber=c.prototype.m,c.prototype.toString=c.prototype.toString,c.prototype.getBits=c.prototype.i,c.fromNumber=p,c.fromString=b,cc=c}).apply(typeof qj<"u"?qj:typeof self<"u"?self:typeof window<"u"?window:{});var tg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var TS,Lm,CS,fg,$b,AS,DS,RS;(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(f,v,A){return f==Array.prototype||f==Object.prototype||(f[v]=A.value),f};function t(f){f=[typeof globalThis=="object"&&globalThis,f,typeof window=="object"&&window,typeof self=="object"&&self,typeof tg=="object"&&tg];for(var v=0;v<f.length;++v){var A=f[v];if(A&&A.Math==Math)return A}throw Error("Cannot find global object")}var s=t(this);function a(f,v){if(v)e:{var A=s;f=f.split(".");for(var Y=0;Y<f.length-1;Y++){var Ee=f[Y];if(!(Ee in A))break e;A=A[Ee]}f=f[f.length-1],Y=A[f],v=v(Y),v!=Y&&v!=null&&e(A,f,{configurable:!0,writable:!0,value:v})}}function l(f,v){f instanceof String&&(f+="");var A=0,Y=!1,Ee={next:function(){if(!Y&&A<f.length){var Oe=A++;return{value:v(Oe,f[Oe]),done:!1}}return Y=!0,{done:!0,value:void 0}}};return Ee[Symbol.iterator]=function(){return Ee},Ee}a("Array.prototype.values",function(f){return f||function(){return l(this,function(v,A){return A})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var c=c||{},u=this||self;function m(f){var v=typeof f;return v=v!="object"?v:f?Array.isArray(f)?"array":v:"null",v=="array"||v=="object"&&typeof f.length=="number"}function p(f){var v=typeof f;return v=="object"&&f!=null||v=="function"}function b(f,v,A){return f.call.apply(f.bind,arguments)}function w(f,v,A){if(!f)throw Error();if(2<arguments.length){var Y=Array.prototype.slice.call(arguments,2);return function(){var Ee=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Ee,Y),f.apply(v,Ee)}}return function(){return f.apply(v,arguments)}}function N(f,v,A){return N=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?b:w,N.apply(null,arguments)}function R(f,v){var A=Array.prototype.slice.call(arguments,1);return function(){var Y=A.slice();return Y.push.apply(Y,arguments),f.apply(this,Y)}}function O(f,v){function A(){}A.prototype=v.prototype,f.aa=v.prototype,f.prototype=new A,f.prototype.constructor=f,f.Qb=function(Y,Ee,Oe){for(var rt=Array(arguments.length-2),on=2;on<arguments.length;on++)rt[on-2]=arguments[on];return v.prototype[Ee].apply(Y,rt)}}function G(f){const v=f.length;if(0<v){const A=Array(v);for(let Y=0;Y<v;Y++)A[Y]=f[Y];return A}return[]}function U(f,v){for(let A=1;A<arguments.length;A++){const Y=arguments[A];if(m(Y)){const Ee=f.length||0,Oe=Y.length||0;f.length=Ee+Oe;for(let rt=0;rt<Oe;rt++)f[Ee+rt]=Y[rt]}else f.push(Y)}}class T{constructor(v,A){this.i=v,this.j=A,this.h=0,this.g=null}get(){let v;return 0<this.h?(this.h--,v=this.g,this.g=v.next,v.next=null):v=this.i(),v}}function ee(f){return/^[\s\xa0]*$/.test(f)}function Z(){var f=u.navigator;return f&&(f=f.userAgent)?f:""}function ie(f){return ie[" "](f),f}ie[" "]=function(){};var X=Z().indexOf("Gecko")!=-1&&!(Z().toLowerCase().indexOf("webkit")!=-1&&Z().indexOf("Edge")==-1)&&!(Z().indexOf("Trident")!=-1||Z().indexOf("MSIE")!=-1)&&Z().indexOf("Edge")==-1;function pe(f,v,A){for(const Y in f)v.call(A,f[Y],Y,f)}function H(f,v){for(const A in f)v.call(void 0,f[A],A,f)}function B(f){const v={};for(const A in f)v[A]=f[A];return v}const k="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function W(f,v){let A,Y;for(let Ee=1;Ee<arguments.length;Ee++){Y=arguments[Ee];for(A in Y)f[A]=Y[A];for(let Oe=0;Oe<k.length;Oe++)A=k[Oe],Object.prototype.hasOwnProperty.call(Y,A)&&(f[A]=Y[A])}}function J(f){var v=1;f=f.split(":");const A=[];for(;0<v&&f.length;)A.push(f.shift()),v--;return f.length&&A.push(f.join(":")),A}function z(f){u.setTimeout(()=>{throw f},0)}function L(){var f=re;let v=null;return f.g&&(v=f.g,f.g=f.g.next,f.g||(f.h=null),v.next=null),v}class de{constructor(){this.h=this.g=null}add(v,A){const Y=Pe.get();Y.set(v,A),this.h?this.h.next=Y:this.g=Y,this.h=Y}}var Pe=new T(()=>new V,f=>f.reset());class V{constructor(){this.next=this.g=this.h=null}set(v,A){this.h=v,this.g=A,this.next=null}reset(){this.next=this.g=this.h=null}}let se,fe=!1,re=new de,_=()=>{const f=u.Promise.resolve(void 0);se=()=>{f.then(E)}};var E=()=>{for(var f;f=L();){try{f.h.call(f.g)}catch(A){z(A)}var v=Pe;v.j(f),100>v.h&&(v.h++,f.next=v.g,v.g=f)}fe=!1};function D(){this.s=this.s,this.C=this.C}D.prototype.s=!1,D.prototype.ma=function(){this.s||(this.s=!0,this.N())},D.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function F(f,v){this.type=f,this.g=this.target=v,this.defaultPrevented=!1}F.prototype.h=function(){this.defaultPrevented=!0};var te=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var f=!1,v=Object.defineProperty({},"passive",{get:function(){f=!0}});try{const A=()=>{};u.addEventListener("test",A,v),u.removeEventListener("test",A,v)}catch{}return f}();function $(f,v){if(F.call(this,f?f.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,f){var A=this.type=f.type,Y=f.changedTouches&&f.changedTouches.length?f.changedTouches[0]:null;if(this.target=f.target||f.srcElement,this.g=v,v=f.relatedTarget){if(X){e:{try{ie(v.nodeName);var Ee=!0;break e}catch{}Ee=!1}Ee||(v=null)}}else A=="mouseover"?v=f.fromElement:A=="mouseout"&&(v=f.toElement);this.relatedTarget=v,Y?(this.clientX=Y.clientX!==void 0?Y.clientX:Y.pageX,this.clientY=Y.clientY!==void 0?Y.clientY:Y.pageY,this.screenX=Y.screenX||0,this.screenY=Y.screenY||0):(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0),this.button=f.button,this.key=f.key||"",this.ctrlKey=f.ctrlKey,this.altKey=f.altKey,this.shiftKey=f.shiftKey,this.metaKey=f.metaKey,this.pointerId=f.pointerId||0,this.pointerType=typeof f.pointerType=="string"?f.pointerType:Q[f.pointerType]||"",this.state=f.state,this.i=f,f.defaultPrevented&&$.aa.h.call(this)}}O($,F);var Q={2:"touch",3:"pen",4:"mouse"};$.prototype.h=function(){$.aa.h.call(this);var f=this.i;f.preventDefault?f.preventDefault():f.returnValue=!1};var me="closure_listenable_"+(1e6*Math.random()|0),I=0;function le(f,v,A,Y,Ee){this.listener=f,this.proxy=null,this.src=v,this.type=A,this.capture=!!Y,this.ha=Ee,this.key=++I,this.da=this.fa=!1}function We(f){f.da=!0,f.listener=null,f.proxy=null,f.src=null,f.ha=null}function nt(f){this.src=f,this.g={},this.h=0}nt.prototype.add=function(f,v,A,Y,Ee){var Oe=f.toString();f=this.g[Oe],f||(f=this.g[Oe]=[],this.h++);var rt=It(f,v,Y,Ee);return-1<rt?(v=f[rt],A||(v.fa=!1)):(v=new le(v,this.src,Oe,!!Y,Ee),v.fa=A,f.push(v)),v};function mt(f,v){var A=v.type;if(A in f.g){var Y=f.g[A],Ee=Array.prototype.indexOf.call(Y,v,void 0),Oe;(Oe=0<=Ee)&&Array.prototype.splice.call(Y,Ee,1),Oe&&(We(v),f.g[A].length==0&&(delete f.g[A],f.h--))}}function It(f,v,A,Y){for(var Ee=0;Ee<f.length;++Ee){var Oe=f[Ee];if(!Oe.da&&Oe.listener==v&&Oe.capture==!!A&&Oe.ha==Y)return Ee}return-1}var rn="closure_lm_"+(1e6*Math.random()|0),oe={};function Ue(f,v,A,Y,Ee){if(Array.isArray(v)){for(var Oe=0;Oe<v.length;Oe++)Ue(f,v[Oe],A,Y,Ee);return null}return A=ns(A),f&&f[me]?f.K(v,A,p(Y)?!!Y.capture:!1,Ee):Je(f,v,A,!1,Y,Ee)}function Je(f,v,A,Y,Ee,Oe){if(!v)throw Error("Invalid event type");var rt=p(Ee)?!!Ee.capture:!!Ee,on=Xt(f);if(on||(f[rn]=on=new nt(f)),A=on.add(v,A,Y,rt,Oe),A.proxy)return A;if(Y=lt(),A.proxy=Y,Y.src=f,Y.listener=A,f.addEventListener)te||(Ee=rt),Ee===void 0&&(Ee=!1),f.addEventListener(v.toString(),Y,Ee);else if(f.attachEvent)f.attachEvent(Ze(v.toString()),Y);else if(f.addListener&&f.removeListener)f.addListener(Y);else throw Error("addEventListener and attachEvent are unavailable.");return A}function lt(){function f(A){return v.call(f.src,f.listener,A)}const v=Vt;return f}function Dt(f,v,A,Y,Ee){if(Array.isArray(v))for(var Oe=0;Oe<v.length;Oe++)Dt(f,v[Oe],A,Y,Ee);else Y=p(Y)?!!Y.capture:!!Y,A=ns(A),f&&f[me]?(f=f.i,v=String(v).toString(),v in f.g&&(Oe=f.g[v],A=It(Oe,A,Y,Ee),-1<A&&(We(Oe[A]),Array.prototype.splice.call(Oe,A,1),Oe.length==0&&(delete f.g[v],f.h--)))):f&&(f=Xt(f))&&(v=f.g[v.toString()],f=-1,v&&(f=It(v,A,Y,Ee)),(A=-1<f?v[f]:null)&&Ht(A))}function Ht(f){if(typeof f!="number"&&f&&!f.da){var v=f.src;if(v&&v[me])mt(v.i,f);else{var A=f.type,Y=f.proxy;v.removeEventListener?v.removeEventListener(A,Y,f.capture):v.detachEvent?v.detachEvent(Ze(A),Y):v.addListener&&v.removeListener&&v.removeListener(Y),(A=Xt(v))?(mt(A,f),A.h==0&&(A.src=null,v[rn]=null)):We(f)}}}function Ze(f){return f in oe?oe[f]:oe[f]="on"+f}function Vt(f,v){if(f.da)f=!0;else{v=new $(v,this);var A=f.listener,Y=f.ha||f.src;f.fa&&Ht(f),f=A.call(Y,v)}return f}function Xt(f){return f=f[rn],f instanceof nt?f:null}var ts="__closure_events_fn_"+(1e9*Math.random()>>>0);function ns(f){return typeof f=="function"?f:(f[ts]||(f[ts]=function(v){return f.handleEvent(v)}),f[ts])}function mn(){D.call(this),this.i=new nt(this),this.M=this,this.F=null}O(mn,D),mn.prototype[me]=!0,mn.prototype.removeEventListener=function(f,v,A,Y){Dt(this,f,v,A,Y)};function Kt(f,v){var A,Y=f.F;if(Y)for(A=[];Y;Y=Y.F)A.push(Y);if(f=f.M,Y=v.type||v,typeof v=="string")v=new F(v,f);else if(v instanceof F)v.target=v.target||f;else{var Ee=v;v=new F(Y,f),W(v,Ee)}if(Ee=!0,A)for(var Oe=A.length-1;0<=Oe;Oe--){var rt=v.g=A[Oe];Ee=En(rt,Y,!0,v)&&Ee}if(rt=v.g=f,Ee=En(rt,Y,!0,v)&&Ee,Ee=En(rt,Y,!1,v)&&Ee,A)for(Oe=0;Oe<A.length;Oe++)rt=v.g=A[Oe],Ee=En(rt,Y,!1,v)&&Ee}mn.prototype.N=function(){if(mn.aa.N.call(this),this.i){var f=this.i,v;for(v in f.g){for(var A=f.g[v],Y=0;Y<A.length;Y++)We(A[Y]);delete f.g[v],f.h--}}this.F=null},mn.prototype.K=function(f,v,A,Y){return this.i.add(String(f),v,!1,A,Y)},mn.prototype.L=function(f,v,A,Y){return this.i.add(String(f),v,!0,A,Y)};function En(f,v,A,Y){if(v=f.i.g[String(v)],!v)return!0;v=v.concat();for(var Ee=!0,Oe=0;Oe<v.length;++Oe){var rt=v[Oe];if(rt&&!rt.da&&rt.capture==A){var on=rt.listener,_s=rt.ha||rt.src;rt.fa&&mt(f.i,rt),Ee=on.call(_s,Y)!==!1&&Ee}}return Ee&&!Y.defaultPrevented}function C(f,v,A){if(typeof f=="function")A&&(f=N(f,A));else if(f&&typeof f.handleEvent=="function")f=N(f.handleEvent,f);else throw Error("Invalid listener argument");return 2147483647<Number(v)?-1:u.setTimeout(f,v||0)}function ne(f){f.g=C(()=>{f.g=null,f.i&&(f.i=!1,ne(f))},f.l);const v=f.h;f.h=null,f.m.apply(null,v)}class ue extends D{constructor(v,A){super(),this.m=v,this.l=A,this.h=null,this.i=!1,this.g=null}j(v){this.h=arguments,this.g?this.i=!0:ne(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ce(f){D.call(this),this.h=f,this.g={}}O(ce,D);var ye=[];function Le(f){pe(f.g,function(v,A){this.g.hasOwnProperty(A)&&Ht(v)},f),f.g={}}ce.prototype.N=function(){ce.aa.N.call(this),Le(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Nt=u.JSON.stringify,yt=u.JSON.parse,$s=class{stringify(f){return u.JSON.stringify(f,void 0)}parse(f){return u.JSON.parse(f,void 0)}};function _e(){}_e.prototype.h=null;function Xe(f){return f.h||(f.h=f.i())}function Be(){}var he={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function be(){F.call(this,"d")}O(be,F);function De(){F.call(this,"c")}O(De,F);var ve={},ze=null;function $e(){return ze=ze||new mn}ve.La="serverreachability";function Ke(f){F.call(this,ve.La,f)}O(Ke,F);function we(f){const v=$e();Kt(v,new Ke(v))}ve.STAT_EVENT="statevent";function et(f,v){F.call(this,ve.STAT_EVENT,f),this.stat=v}O(et,F);function ke(f){const v=$e();Kt(v,new et(v,f))}ve.Ma="timingevent";function Ve(f,v){F.call(this,ve.Ma,f),this.size=v}O(Ve,F);function Tt(f,v){if(typeof f!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){f()},v)}function ft(){this.g=!0}ft.prototype.xa=function(){this.g=!1};function pt(f,v,A,Y,Ee,Oe){f.info(function(){if(f.g)if(Oe)for(var rt="",on=Oe.split("&"),_s=0;_s<on.length;_s++){var ln=on[_s].split("=");if(1<ln.length){var Ls=ln[0];ln=ln[1];var Es=Ls.split("_");rt=2<=Es.length&&Es[1]=="type"?rt+(Ls+"="+ln+"&"):rt+(Ls+"=redacted&")}}else rt=null;else rt=Oe;return"XMLHTTP REQ ("+Y+") [attempt "+Ee+"]: "+v+`
`+A+`
`+rt})}function ls(f,v,A,Y,Ee,Oe,rt){f.info(function(){return"XMLHTTP RESP ("+Y+") [ attempt "+Ee+"]: "+v+`
`+A+`
`+Oe+" "+rt})}function Ns(f,v,A,Y){f.info(function(){return"XMLHTTP TEXT ("+v+"): "+Ai(f,A)+(Y?" "+Y:"")})}function Hr(f,v){f.info(function(){return"TIMEOUT: "+v})}ft.prototype.info=function(){};function Ai(f,v){if(!f.g)return v;if(!v)return null;try{var A=JSON.parse(v);if(A){for(f=0;f<A.length;f++)if(Array.isArray(A[f])){var Y=A[f];if(!(2>Y.length)){var Ee=Y[1];if(Array.isArray(Ee)&&!(1>Ee.length)){var Oe=Ee[0];if(Oe!="noop"&&Oe!="stop"&&Oe!="close")for(var rt=1;rt<Ee.length;rt++)Ee[rt]=""}}}}return Nt(A)}catch{return v}}var Na={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},li={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Di;function Ri(){}O(Ri,_e),Ri.prototype.g=function(){return new XMLHttpRequest},Ri.prototype.i=function(){return{}},Di=new Ri;function gs(f,v,A,Y){this.j=f,this.i=v,this.l=A,this.R=Y||1,this.U=new ce(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new en}function en(){this.i=null,this.g="",this.h=!1}var Bs={},ks={};function $n(f,v,A){f.L=1,f.v=Li(Gn(v)),f.m=A,f.P=!0,Gr(f,null)}function Gr(f,v){f.F=Date.now(),Qr(f),f.A=Gn(f.v);var A=f.A,Y=f.R;Array.isArray(Y)||(Y=[String(Y)]),fo(A.i,"t",Y),f.C=0,A=f.j.J,f.h=new en,f.g=Md(f.j,A?v:null,!f.m),0<f.O&&(f.M=new ue(N(f.Y,f,f.g),f.O)),v=f.U,A=f.g,Y=f.ca;var Ee="readystatechange";Array.isArray(Ee)||(Ee&&(ye[0]=Ee.toString()),Ee=ye);for(var Oe=0;Oe<Ee.length;Oe++){var rt=Ue(A,Ee[Oe],Y||v.handleEvent,!1,v.h||v);if(!rt)break;v.g[rt.key]=rt}v=f.H?B(f.H):{},f.m?(f.u||(f.u="POST"),v["Content-Type"]="application/x-www-form-urlencoded",f.g.ea(f.A,f.u,f.m,v)):(f.u="GET",f.g.ea(f.A,f.u,null,v)),we(),pt(f.i,f.u,f.A,f.l,f.R,f.m)}gs.prototype.ca=function(f){f=f.target;const v=this.M;v&&Gs(f)==3?v.j():this.Y(f)},gs.prototype.Y=function(f){try{if(f==this.g)e:{const Es=Gs(this.g);var v=this.g.Ba();const Ss=this.g.Z();if(!(3>Es)&&(Es!=3||this.g&&(this.h.h||this.g.oa()||Pd(this.g)))){this.J||Es!=4||v==7||(v==8||0>=Ss?we(3):we(2)),ki(this);var A=this.g.Z();this.X=A;t:if(ta(this)){var Y=Pd(this.g);f="";var Ee=Y.length,Oe=Gs(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Os(this),ur(this);var rt="";break t}this.h.i=new u.TextDecoder}for(v=0;v<Ee;v++)this.h.h=!0,f+=this.h.i.decode(Y[v],{stream:!(Oe&&v==Ee-1)});Y.length=0,this.h.g+=f,this.C=0,rt=this.h.g}else rt=this.g.oa();if(this.o=A==200,ls(this.i,this.u,this.A,this.l,this.R,Es,A),this.o){if(this.T&&!this.K){t:{if(this.g){var on,_s=this.g;if((on=_s.g?_s.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ee(on)){var ln=on;break t}}ln=null}if(A=ln)Ns(this.i,this.l,A,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,na(this,A);else{this.o=!1,this.s=3,ke(12),Os(this),ur(this);break e}}if(this.P){A=!0;let Fs;for(;!this.J&&this.C<rt.length;)if(Fs=Pi(this,rt),Fs==ks){Es==4&&(this.s=4,ke(14),A=!1),Ns(this.i,this.l,null,"[Incomplete Response]");break}else if(Fs==Bs){this.s=4,ke(15),Ns(this.i,this.l,rt,"[Invalid Chunk]"),A=!1;break}else Ns(this.i,this.l,Fs,null),na(this,Fs);if(ta(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Es!=4||rt.length!=0||this.h.h||(this.s=1,ke(16),A=!1),this.o=this.o&&A,!A)Ns(this.i,this.l,rt,"[Invalid Chunked Response]"),Os(this),ur(this);else if(0<rt.length&&!this.W){this.W=!0;var Ls=this.j;Ls.g==this&&Ls.ba&&!Ls.M&&(Ls.j.info("Great, no buffering proxy detected. Bytes received: "+rt.length),vo(Ls),Ls.M=!0,ke(11))}}else Ns(this.i,this.l,rt,null),na(this,rt);Es==4&&Os(this),this.o&&!this.J&&(Es==4?Pc(this.j,this):(this.o=!1,Qr(this)))}else kd(this.g),A==400&&0<rt.indexOf("Unknown SID")?(this.s=3,ke(12)):(this.s=0,ke(13)),Os(this),ur(this)}}}catch{}finally{}};function ta(f){return f.g?f.u=="GET"&&f.L!=2&&f.j.Ca:!1}function Pi(f,v){var A=f.C,Y=v.indexOf(`
`,A);return Y==-1?ks:(A=Number(v.substring(A,Y)),isNaN(A)?Bs:(Y+=1,Y+A>v.length?ks:(v=v.slice(Y,Y+A),f.C=Y+A,v)))}gs.prototype.cancel=function(){this.J=!0,Os(this)};function Qr(f){f.S=Date.now()+f.I,Ec(f,f.I)}function Ec(f,v){if(f.B!=null)throw Error("WatchDog timer not null");f.B=Tt(N(f.ba,f),v)}function ki(f){f.B&&(u.clearTimeout(f.B),f.B=null)}gs.prototype.ba=function(){this.B=null;const f=Date.now();0<=f-this.S?(Hr(this.i,this.A),this.L!=2&&(we(),ke(17)),Os(this),this.s=2,ur(this)):Ec(this,this.S-f)};function ur(f){f.j.G==0||f.J||Pc(f.j,f)}function Os(f){ki(f);var v=f.M;v&&typeof v.ma=="function"&&v.ma(),f.M=null,Le(f.U),f.g&&(v=f.g,f.g=null,v.abort(),v.ma())}function na(f,v){try{var A=f.j;if(A.G!=0&&(A.g==f||ml(A.h,f))){if(!f.K&&ml(A.h,f)&&A.G==3){try{var Y=A.Da.g.parse(v)}catch{Y=null}if(Array.isArray(Y)&&Y.length==3){var Ee=Y;if(Ee[0]==0){e:if(!A.u){if(A.g)if(A.g.F+3e3<f.F)No(A),yo(A);else break e;Rc(A),ke(18)}}else A.za=Ee[1],0<A.za-A.T&&37500>Ee[2]&&A.F&&A.v==0&&!A.C&&(A.C=Tt(N(A.Za,A),6e3));if(1>=co(A.h)&&A.ca){try{A.ca()}catch{}A.ca=void 0}}else mi(A,11)}else if((f.K||A.g==f)&&No(A),!ee(v))for(Ee=A.Da.g.parse(v),v=0;v<Ee.length;v++){let ln=Ee[v];if(A.T=ln[0],ln=ln[1],A.G==2)if(ln[0]=="c"){A.K=ln[1],A.ia=ln[2];const Ls=ln[3];Ls!=null&&(A.la=Ls,A.j.info("VER="+A.la));const Es=ln[4];Es!=null&&(A.Aa=Es,A.j.info("SVER="+A.Aa));const Ss=ln[5];Ss!=null&&typeof Ss=="number"&&0<Ss&&(Y=1.5*Ss,A.L=Y,A.j.info("backChannelRequestTimeoutMs_="+Y)),Y=A;const Fs=f.g;if(Fs){const fi=Fs.g?Fs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(fi){var Oe=Y.h;Oe.g||fi.indexOf("spdy")==-1&&fi.indexOf("quic")==-1&&fi.indexOf("h2")==-1||(Oe.j=Oe.l,Oe.g=new Set,Oe.h&&(uo(Oe,Oe.h),Oe.h=null))}if(Y.D){const vl=Fs.g?Fs.g.getResponseHeader("X-HTTP-Session-Id"):null;vl&&(Y.ya=vl,an(Y.I,Y.D,vl))}}A.G=3,A.l&&A.l.ua(),A.ba&&(A.R=Date.now()-f.F,A.j.info("Handshake RTT: "+A.R+"ms")),Y=A;var rt=f;if(Y.qa=kc(Y,Y.J?Y.ia:null,Y.W),rt.K){nr(Y.h,rt);var on=rt,_s=Y.L;_s&&(on.I=_s),on.B&&(ki(on),Qr(on)),Y.g=rt}else wo(Y);0<A.i.length&&bo(A)}else ln[0]!="stop"&&ln[0]!="close"||mi(A,7);else A.G==3&&(ln[0]=="stop"||ln[0]=="close"?ln[0]=="stop"?mi(A,7):xl(A):ln[0]!="noop"&&A.l&&A.l.ta(ln),A.v=0)}}we(4)}catch{}}var hl=class{constructor(f,v){this.g=f,this.map=v}};function Oi(f){this.l=f||10,u.PerformanceNavigationTiming?(f=u.performance.getEntriesByType("navigation"),f=0<f.length&&(f[0].nextHopProtocol=="hq"||f[0].nextHopProtocol=="h2")):f=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=f?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function lo(f){return f.h?!0:f.g?f.g.size>=f.j:!1}function co(f){return f.h?1:f.g?f.g.size:0}function ml(f,v){return f.h?f.h==v:f.g?f.g.has(v):!1}function uo(f,v){f.g?f.g.add(v):f.h=v}function nr(f,v){f.h&&f.h==v?f.h=null:f.g&&f.g.has(v)&&f.g.delete(v)}Oi.prototype.cancel=function(){if(this.i=fl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const f of this.g.values())f.cancel();this.g.clear()}};function fl(f){if(f.h!=null)return f.i.concat(f.h.D);if(f.g!=null&&f.g.size!==0){let v=f.i;for(const A of f.g.values())v=v.concat(A.D);return v}return G(f.i)}function Dd(f){if(f.V&&typeof f.V=="function")return f.V();if(typeof Map<"u"&&f instanceof Map||typeof Set<"u"&&f instanceof Set)return Array.from(f.values());if(typeof f=="string")return f.split("");if(m(f)){for(var v=[],A=f.length,Y=0;Y<A;Y++)v.push(f[Y]);return v}v=[],A=0;for(Y in f)v[A++]=f[Y];return v}function ho(f){if(f.na&&typeof f.na=="function")return f.na();if(!f.V||typeof f.V!="function"){if(typeof Map<"u"&&f instanceof Map)return Array.from(f.keys());if(!(typeof Set<"u"&&f instanceof Set)){if(m(f)||typeof f=="string"){var v=[];f=f.length;for(var A=0;A<f;A++)v.push(A);return v}v=[],A=0;for(const Y in f)v[A++]=Y;return v}}}function pl(f,v){if(f.forEach&&typeof f.forEach=="function")f.forEach(v,void 0);else if(m(f)||typeof f=="string")Array.prototype.forEach.call(f,v,void 0);else for(var A=ho(f),Y=Dd(f),Ee=Y.length,Oe=0;Oe<Ee;Oe++)v.call(void 0,Y[Oe],A&&A[Oe],f)}var sr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function hr(f,v){if(f){f=f.split("&");for(var A=0;A<f.length;A++){var Y=f[A].indexOf("="),Ee=null;if(0<=Y){var Oe=f[A].substring(0,Y);Ee=f[A].substring(Y+1)}else Oe=f[A];v(Oe,Ee?decodeURIComponent(Ee.replace(/\+/g," ")):"")}}}function Ln(f){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,f instanceof Ln){this.h=f.h,sa(this,f.j),this.o=f.o,this.g=f.g,Mi(this,f.s),this.l=f.l;var v=f.i,A=new rr;A.i=v.i,v.g&&(A.g=new Map(v.g),A.h=v.h),Ms(this,A),this.m=f.m}else f&&(v=String(f).match(sr))?(this.h=!1,sa(this,v[1]||"",!0),this.o=qs(v[2]||""),this.g=qs(v[3]||"",!0),Mi(this,v[4]),this.l=qs(v[5]||"",!0),Ms(this,v[6]||"",!0),this.m=qs(v[7]||"")):(this.h=!1,this.i=new rr(null,this.h))}Ln.prototype.toString=function(){var f=[],v=this.j;v&&f.push(ra(v,Fi,!0),":");var A=this.g;return(A||v=="file")&&(f.push("//"),(v=this.o)&&f.push(ra(v,Fi,!0),"@"),f.push(encodeURIComponent(String(A)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),A=this.s,A!=null&&f.push(":",String(A))),(A=this.l)&&(this.g&&A.charAt(0)!="/"&&f.push("/"),f.push(ra(A,A.charAt(0)=="/"?Rd:mo,!0))),(A=this.i.toString())&&f.push("?",A),(A=this.m)&&f.push("#",ra(A,gl)),f.join("")};function Gn(f){return new Ln(f)}function sa(f,v,A){f.j=A?qs(v,!0):v,f.j&&(f.j=f.j.replace(/:$/,""))}function Mi(f,v){if(v){if(v=Number(v),isNaN(v)||0>v)throw Error("Bad port number "+v);f.s=v}else f.s=null}function Ms(f,v,A){v instanceof rr?(f.i=v,Ic(f.i,f.h)):(A||(v=ra(v,ci)),f.i=new rr(v,f.h))}function an(f,v,A){f.i.set(v,A)}function Li(f){return an(f,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),f}function qs(f,v){return f?v?decodeURI(f.replace(/%25/g,"%2525")):decodeURIComponent(f):""}function ra(f,v,A){return typeof f=="string"?(f=encodeURI(f).replace(v,Sc),A&&(f=f.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f):null}function Sc(f){return f=f.charCodeAt(0),"%"+(f>>4&15).toString(16)+(f&15).toString(16)}var Fi=/[#\/\?@]/g,mo=/[#\?:]/g,Rd=/[#\?]/g,ci=/[#\?@]/g,gl=/#/g;function rr(f,v){this.h=this.g=null,this.i=f||null,this.j=!!v}function mr(f){f.g||(f.g=new Map,f.h=0,f.i&&hr(f.i,function(v,A){f.add(decodeURIComponent(v.replace(/\+/g," ")),A)}))}r=rr.prototype,r.add=function(f,v){mr(this),this.i=null,f=Er(this,f);var A=this.g.get(f);return A||this.g.set(f,A=[]),A.push(v),this.h+=1,this};function Ui(f,v){mr(f),v=Er(f,v),f.g.has(v)&&(f.i=null,f.h-=f.g.get(v).length,f.g.delete(v))}function Lr(f,v){return mr(f),v=Er(f,v),f.g.has(v)}r.forEach=function(f,v){mr(this),this.g.forEach(function(A,Y){A.forEach(function(Ee){f.call(v,Ee,Y,this)},this)},this)},r.na=function(){mr(this);const f=Array.from(this.g.values()),v=Array.from(this.g.keys()),A=[];for(let Y=0;Y<v.length;Y++){const Ee=f[Y];for(let Oe=0;Oe<Ee.length;Oe++)A.push(v[Y])}return A},r.V=function(f){mr(this);let v=[];if(typeof f=="string")Lr(this,f)&&(v=v.concat(this.g.get(Er(this,f))));else{f=Array.from(this.g.values());for(let A=0;A<f.length;A++)v=v.concat(f[A])}return v},r.set=function(f,v){return mr(this),this.i=null,f=Er(this,f),Lr(this,f)&&(this.h-=this.g.get(f).length),this.g.set(f,[v]),this.h+=1,this},r.get=function(f,v){return f?(f=this.V(f),0<f.length?String(f[0]):v):v};function fo(f,v,A){Ui(f,v),0<A.length&&(f.i=null,f.g.set(Er(f,v),G(A)),f.h+=A.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const f=[],v=Array.from(this.g.keys());for(var A=0;A<v.length;A++){var Y=v[A];const Oe=encodeURIComponent(String(Y)),rt=this.V(Y);for(Y=0;Y<rt.length;Y++){var Ee=Oe;rt[Y]!==""&&(Ee+="="+encodeURIComponent(String(rt[Y]))),f.push(Ee)}}return this.i=f.join("&")};function Er(f,v){return v=String(v),f.j&&(v=v.toLowerCase()),v}function Ic(f,v){v&&!f.j&&(mr(f),f.i=null,f.g.forEach(function(A,Y){var Ee=Y.toLowerCase();Y!=Ee&&(Ui(this,Y),fo(this,Ee,A))},f)),f.j=v}function ja(f,v){const A=new ft;if(u.Image){const Y=new Image;Y.onload=R(Hs,A,"TestLoadImage: loaded",!0,v,Y),Y.onerror=R(Hs,A,"TestLoadImage: error",!1,v,Y),Y.onabort=R(Hs,A,"TestLoadImage: abort",!1,v,Y),Y.ontimeout=R(Hs,A,"TestLoadImage: timeout",!1,v,Y),u.setTimeout(function(){Y.ontimeout&&Y.ontimeout()},1e4),Y.src=f}else v(!1)}function Wr(f,v){const A=new ft,Y=new AbortController,Ee=setTimeout(()=>{Y.abort(),Hs(A,"TestPingServer: timeout",!1,v)},1e4);fetch(f,{signal:Y.signal}).then(Oe=>{clearTimeout(Ee),Oe.ok?Hs(A,"TestPingServer: ok",!0,v):Hs(A,"TestPingServer: server error",!1,v)}).catch(()=>{clearTimeout(Ee),Hs(A,"TestPingServer: error",!1,v)})}function Hs(f,v,A,Y,Ee){try{Ee&&(Ee.onload=null,Ee.onerror=null,Ee.onabort=null,Ee.ontimeout=null),Y(A)}catch{}}function po(){this.g=new $s}function di(f,v,A){const Y=A||"";try{pl(f,function(Ee,Oe){let rt=Ee;p(Ee)&&(rt=Nt(Ee)),v.push(Y+Oe+"="+encodeURIComponent(rt))})}catch(Ee){throw v.push(Y+"type="+encodeURIComponent("_badmap")),Ee}}function Vi(f){this.l=f.Ub||null,this.j=f.eb||!1}O(Vi,_e),Vi.prototype.g=function(){return new Kr(this.l,this.j)},Vi.prototype.i=function(f){return function(){return f}}({});function Kr(f,v){mn.call(this),this.D=f,this.o=v,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}O(Kr,mn),r=Kr.prototype,r.open=function(f,v){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=f,this.A=v,this.readyState=1,Fr(this)},r.send=function(f){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const v={headers:this.u,method:this.B,credentials:this.m,cache:void 0};f&&(v.body=f),(this.D||u).fetch(new Request(this.A,v)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,zi(this)),this.readyState=0},r.Sa=function(f){if(this.g&&(this.l=f,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=f.headers,this.readyState=2,Fr(this)),this.g&&(this.readyState=3,Fr(this),this.g)))if(this.responseType==="arraybuffer")f.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in f){if(this.j=f.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;go(this)}else f.text().then(this.Ra.bind(this),this.ga.bind(this))};function go(f){f.j.read().then(f.Pa.bind(f)).catch(f.ga.bind(f))}r.Pa=function(f){if(this.g){if(this.o&&f.value)this.response.push(f.value);else if(!this.o){var v=f.value?f.value:new Uint8Array(0);(v=this.v.decode(v,{stream:!f.done}))&&(this.response=this.responseText+=v)}f.done?zi(this):Fr(this),this.readyState==3&&go(this)}},r.Ra=function(f){this.g&&(this.response=this.responseText=f,zi(this))},r.Qa=function(f){this.g&&(this.response=f,zi(this))},r.ga=function(){this.g&&zi(this)};function zi(f){f.readyState=4,f.l=null,f.j=null,f.v=null,Fr(f)}r.setRequestHeader=function(f,v){this.u.append(f,v)},r.getResponseHeader=function(f){return this.h&&this.h.get(f.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const f=[],v=this.h.entries();for(var A=v.next();!A.done;)A=A.value,f.push(A[0]+": "+A[1]),A=v.next();return f.join(`\r
`)};function Fr(f){f.onreadystatechange&&f.onreadystatechange.call(f)}Object.defineProperty(Kr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(f){this.m=f?"include":"same-origin"}});function Tc(f){let v="";return pe(f,function(A,Y){v+=Y,v+=":",v+=A,v+=`\r
`}),v}function js(f,v,A){e:{for(Y in A){var Y=!1;break e}Y=!0}Y||(A=Tc(A),typeof f=="string"?A!=null&&encodeURIComponent(String(A)):an(f,v,A))}function pn(f){mn.call(this),this.headers=new Map,this.o=f||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}O(pn,mn);var _a=/^https?$/i,ia=["POST","PUT"];r=pn.prototype,r.Ha=function(f){this.J=f},r.ea=function(f,v,A,Y){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+f);v=v?v.toUpperCase():"GET",this.D=f,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Di.g(),this.v=this.o?Xe(this.o):Xe(Di),this.g.onreadystatechange=N(this.Ea,this);try{this.B=!0,this.g.open(v,String(f),!0),this.B=!1}catch(Oe){Cc(this,Oe);return}if(f=A||"",A=new Map(this.headers),Y)if(Object.getPrototypeOf(Y)===Object.prototype)for(var Ee in Y)A.set(Ee,Y[Ee]);else if(typeof Y.keys=="function"&&typeof Y.get=="function")for(const Oe of Y.keys())A.set(Oe,Y.get(Oe));else throw Error("Unknown input type for opt_headers: "+String(Y));Y=Array.from(A.keys()).find(Oe=>Oe.toLowerCase()=="content-type"),Ee=u.FormData&&f instanceof u.FormData,!(0<=Array.prototype.indexOf.call(ia,v,void 0))||Y||Ee||A.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Oe,rt]of A)this.g.setRequestHeader(Oe,rt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Sa(this),this.u=!0,this.g.send(f),this.u=!1}catch(Oe){Cc(this,Oe)}};function Cc(f,v){f.h=!1,f.g&&(f.j=!0,f.g.abort(),f.j=!1),f.l=v,f.m=5,$i(f),ui(f)}function $i(f){f.A||(f.A=!0,Kt(f,"complete"),Kt(f,"error"))}r.abort=function(f){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=f||7,Kt(this,"complete"),Kt(this,"abort"),ui(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ui(this,!0)),pn.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Ea(this):this.bb())},r.bb=function(){Ea(this)};function Ea(f){if(f.h&&typeof c<"u"&&(!f.v[1]||Gs(f)!=4||f.Z()!=2)){if(f.u&&Gs(f)==4)C(f.Ea,0,f);else if(Kt(f,"readystatechange"),Gs(f)==4){f.h=!1;try{const rt=f.Z();e:switch(rt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var v=!0;break e;default:v=!1}var A;if(!(A=v)){var Y;if(Y=rt===0){var Ee=String(f.D).match(sr)[1]||null;!Ee&&u.self&&u.self.location&&(Ee=u.self.location.protocol.slice(0,-1)),Y=!_a.test(Ee?Ee.toLowerCase():"")}A=Y}if(A)Kt(f,"complete"),Kt(f,"success");else{f.m=6;try{var Oe=2<Gs(f)?f.g.statusText:""}catch{Oe=""}f.l=Oe+" ["+f.Z()+"]",$i(f)}}finally{ui(f)}}}}function ui(f,v){if(f.g){Sa(f);const A=f.g,Y=f.v[0]?()=>{}:null;f.g=null,f.v=null,v||Kt(f,"ready");try{A.onreadystatechange=Y}catch{}}}function Sa(f){f.I&&(u.clearTimeout(f.I),f.I=null)}r.isActive=function(){return!!this.g};function Gs(f){return f.g?f.g.readyState:0}r.Z=function(){try{return 2<Gs(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(f){if(this.g){var v=this.g.responseText;return f&&v.indexOf(f)==0&&(v=v.substring(f.length)),yt(v)}};function Pd(f){try{if(!f.g)return null;if("response"in f.g)return f.g.response;switch(f.H){case"":case"text":return f.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in f.g)return f.g.mozResponseArrayBuffer}return null}catch{return null}}function kd(f){const v={};f=(f.g&&2<=Gs(f)&&f.g.getAllResponseHeaders()||"").split(`\r
`);for(let Y=0;Y<f.length;Y++){if(ee(f[Y]))continue;var A=J(f[Y]);const Ee=A[0];if(A=A[1],typeof A!="string")continue;A=A.trim();const Oe=v[Ee]||[];v[Ee]=Oe,Oe.push(A)}H(v,function(Y){return Y.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ia(f,v,A){return A&&A.internalChannelParams&&A.internalChannelParams[f]||v}function xo(f){this.Aa=0,this.i=[],this.j=new ft,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ia("failFast",!1,f),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ia("baseRetryDelayMs",5e3,f),this.cb=Ia("retryDelaySeedMs",1e4,f),this.Wa=Ia("forwardChannelMaxRetries",2,f),this.wa=Ia("forwardChannelRequestTimeoutMs",2e4,f),this.pa=f&&f.xmlHttpFactory||void 0,this.Xa=f&&f.Tb||void 0,this.Ca=f&&f.useFetchStreams||!1,this.L=void 0,this.J=f&&f.supportsCrossDomainXhr||!1,this.K="",this.h=new Oi(f&&f.concurrentRequestLimit),this.Da=new po,this.P=f&&f.fastHandshake||!1,this.O=f&&f.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=f&&f.Rb||!1,f&&f.xa&&this.j.xa(),f&&f.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&f&&f.detectBufferingProxy||!1,this.ja=void 0,f&&f.longPollingTimeout&&0<f.longPollingTimeout&&(this.ja=f.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=xo.prototype,r.la=8,r.G=1,r.connect=function(f,v,A,Y){ke(0),this.W=f,this.H=v||{},A&&Y!==void 0&&(this.H.OSID=A,this.H.OAID=Y),this.F=this.X,this.I=kc(this,null,this.W),bo(this)};function xl(f){if(yl(f),f.G==3){var v=f.U++,A=Gn(f.I);if(an(A,"SID",f.K),an(A,"RID",v),an(A,"TYPE","terminate"),Ta(f,A),v=new gs(f,f.j,v),v.L=2,v.v=Li(Gn(A)),A=!1,u.navigator&&u.navigator.sendBeacon)try{A=u.navigator.sendBeacon(v.v.toString(),"")}catch{}!A&&u.Image&&(new Image().src=v.v,A=!0),A||(v.g=Md(v.j,null),v.g.ea(v.v)),v.F=Date.now(),Qr(v)}Od(f)}function yo(f){f.g&&(vo(f),f.g.cancel(),f.g=null)}function yl(f){yo(f),f.u&&(u.clearTimeout(f.u),f.u=null),No(f),f.h.cancel(),f.s&&(typeof f.s=="number"&&u.clearTimeout(f.s),f.s=null)}function bo(f){if(!lo(f.h)&&!f.s){f.s=!0;var v=f.Ga;se||_(),fe||(se(),fe=!0),re.add(v,f),f.B=0}}function bh(f,v){return co(f.h)>=f.h.j-(f.s?1:0)?!1:f.s?(f.i=v.D.concat(f.i),!0):f.G==1||f.G==2||f.B>=(f.Va?0:f.Wa)?!1:(f.s=Tt(N(f.Ga,f,v),hi(f,f.B)),f.B++,!0)}r.Ga=function(f){if(this.s)if(this.s=null,this.G==1){if(!f){this.U=Math.floor(1e5*Math.random()),f=this.U++;const Ee=new gs(this,this.j,f);let Oe=this.o;if(this.S&&(Oe?(Oe=B(Oe),W(Oe,this.S)):Oe=this.S),this.m!==null||this.O||(Ee.H=Oe,Oe=null),this.P)e:{for(var v=0,A=0;A<this.i.length;A++){t:{var Y=this.i[A];if("__data__"in Y.map&&(Y=Y.map.__data__,typeof Y=="string")){Y=Y.length;break t}Y=void 0}if(Y===void 0)break;if(v+=Y,4096<v){v=A;break e}if(v===4096||A===this.i.length-1){v=A+1;break e}}v=1e3}else v=1e3;v=Dc(this,Ee,v),A=Gn(this.I),an(A,"RID",f),an(A,"CVER",22),this.D&&an(A,"X-HTTP-Session-Id",this.D),Ta(this,A),Oe&&(this.O?v="headers="+encodeURIComponent(String(Tc(Oe)))+"&"+v:this.m&&js(A,this.m,Oe)),uo(this.h,Ee),this.Ua&&an(A,"TYPE","init"),this.P?(an(A,"$req",v),an(A,"SID","null"),Ee.T=!0,$n(Ee,A,null)):$n(Ee,A,v),this.G=2}}else this.G==3&&(f?Ac(this,f):this.i.length==0||lo(this.h)||Ac(this))};function Ac(f,v){var A;v?A=v.l:A=f.U++;const Y=Gn(f.I);an(Y,"SID",f.K),an(Y,"RID",A),an(Y,"AID",f.T),Ta(f,Y),f.m&&f.o&&js(Y,f.m,f.o),A=new gs(f,f.j,A,f.B+1),f.m===null&&(A.H=f.o),v&&(f.i=v.D.concat(f.i)),v=Dc(f,A,1e3),A.I=Math.round(.5*f.wa)+Math.round(.5*f.wa*Math.random()),uo(f.h,A),$n(A,Y,v)}function Ta(f,v){f.H&&pe(f.H,function(A,Y){an(v,Y,A)}),f.l&&pl({},function(A,Y){an(v,Y,A)})}function Dc(f,v,A){A=Math.min(f.i.length,A);var Y=f.l?N(f.l.Na,f.l,f):null;e:{var Ee=f.i;let Oe=-1;for(;;){const rt=["count="+A];Oe==-1?0<A?(Oe=Ee[0].g,rt.push("ofs="+Oe)):Oe=0:rt.push("ofs="+Oe);let on=!0;for(let _s=0;_s<A;_s++){let ln=Ee[_s].g;const Ls=Ee[_s].map;if(ln-=Oe,0>ln)Oe=Math.max(0,Ee[_s].g-100),on=!1;else try{di(Ls,rt,"req"+ln+"_")}catch{Y&&Y(Ls)}}if(on){Y=rt.join("&");break e}}}return f=f.i.splice(0,A),v.D=f,Y}function wo(f){if(!f.g&&!f.u){f.Y=1;var v=f.Fa;se||_(),fe||(se(),fe=!0),re.add(v,f),f.v=0}}function Rc(f){return f.g||f.u||3<=f.v?!1:(f.Y++,f.u=Tt(N(f.Fa,f),hi(f,f.v)),f.v++,!0)}r.Fa=function(){if(this.u=null,bl(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var f=2*this.R;this.j.info("BP detection timer enabled: "+f),this.A=Tt(N(this.ab,this),f)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ke(10),yo(this),bl(this))};function vo(f){f.A!=null&&(u.clearTimeout(f.A),f.A=null)}function bl(f){f.g=new gs(f,f.j,"rpc",f.Y),f.m===null&&(f.g.H=f.o),f.g.O=0;var v=Gn(f.qa);an(v,"RID","rpc"),an(v,"SID",f.K),an(v,"AID",f.T),an(v,"CI",f.F?"0":"1"),!f.F&&f.ja&&an(v,"TO",f.ja),an(v,"TYPE","xmlhttp"),Ta(f,v),f.m&&f.o&&js(v,f.m,f.o),f.L&&(f.g.I=f.L);var A=f.g;f=f.ia,A.L=1,A.v=Li(Gn(v)),A.m=null,A.P=!0,Gr(A,f)}r.Za=function(){this.C!=null&&(this.C=null,yo(this),Rc(this),ke(19))};function No(f){f.C!=null&&(u.clearTimeout(f.C),f.C=null)}function Pc(f,v){var A=null;if(f.g==v){No(f),vo(f),f.g=null;var Y=2}else if(ml(f.h,v))A=v.D,nr(f.h,v),Y=1;else return;if(f.G!=0){if(v.o)if(Y==1){A=v.m?v.m.length:0,v=Date.now()-v.F;var Ee=f.B;Y=$e(),Kt(Y,new Ve(Y,A)),bo(f)}else wo(f);else if(Ee=v.s,Ee==3||Ee==0&&0<v.X||!(Y==1&&bh(f,v)||Y==2&&Rc(f)))switch(A&&0<A.length&&(v=f.h,v.i=v.i.concat(A)),Ee){case 1:mi(f,5);break;case 4:mi(f,10);break;case 3:mi(f,6);break;default:mi(f,2)}}}function hi(f,v){let A=f.Ta+Math.floor(Math.random()*f.cb);return f.isActive()||(A*=2),A*v}function mi(f,v){if(f.j.info("Error code "+v),v==2){var A=N(f.fb,f),Y=f.Xa;const Ee=!Y;Y=new Ln(Y||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||sa(Y,"https"),Li(Y),Ee?ja(Y.toString(),A):Wr(Y.toString(),A)}else ke(2);f.G=0,f.l&&f.l.sa(v),Od(f),yl(f)}r.fb=function(f){f?(this.j.info("Successfully pinged google.com"),ke(2)):(this.j.info("Failed to ping google.com"),ke(1))};function Od(f){if(f.G=0,f.ka=[],f.l){const v=fl(f.h);(v.length!=0||f.i.length!=0)&&(U(f.ka,v),U(f.ka,f.i),f.h.i.length=0,G(f.i),f.i.length=0),f.l.ra()}}function kc(f,v,A){var Y=A instanceof Ln?Gn(A):new Ln(A);if(Y.g!="")v&&(Y.g=v+"."+Y.g),Mi(Y,Y.s);else{var Ee=u.location;Y=Ee.protocol,v=v?v+"."+Ee.hostname:Ee.hostname,Ee=+Ee.port;var Oe=new Ln(null);Y&&sa(Oe,Y),v&&(Oe.g=v),Ee&&Mi(Oe,Ee),A&&(Oe.l=A),Y=Oe}return A=f.D,v=f.ya,A&&v&&an(Y,A,v),an(Y,"VER",f.la),Ta(f,Y),Y}function Md(f,v,A){if(v&&!f.J)throw Error("Can't create secondary domain capable XhrIo object.");return v=f.Ca&&!f.pa?new pn(new Vi({eb:A})):new pn(f.pa),v.Ha(f.J),v}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ld(){}r=Ld.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function wl(){}wl.prototype.g=function(f,v){return new fr(f,v)};function fr(f,v){mn.call(this),this.g=new xo(v),this.l=f,this.h=v&&v.messageUrlParams||null,f=v&&v.messageHeaders||null,v&&v.clientProtocolHeaderRequired&&(f?f["X-Client-Protocol"]="webchannel":f={"X-Client-Protocol":"webchannel"}),this.g.o=f,f=v&&v.initMessageHeaders||null,v&&v.messageContentType&&(f?f["X-WebChannel-Content-Type"]=v.messageContentType:f={"X-WebChannel-Content-Type":v.messageContentType}),v&&v.va&&(f?f["X-WebChannel-Client-Profile"]=v.va:f={"X-WebChannel-Client-Profile":v.va}),this.g.S=f,(f=v&&v.Sb)&&!ee(f)&&(this.g.m=f),this.v=v&&v.supportsCrossDomainXhr||!1,this.u=v&&v.sendRawJson||!1,(v=v&&v.httpSessionIdParam)&&!ee(v)&&(this.g.D=v,f=this.h,f!==null&&v in f&&(f=this.h,v in f&&delete f[v])),this.j=new Bi(this)}O(fr,mn),fr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},fr.prototype.close=function(){xl(this.g)},fr.prototype.o=function(f){var v=this.g;if(typeof f=="string"){var A={};A.__data__=f,f=A}else this.u&&(A={},A.__data__=Nt(f),f=A);v.i.push(new hl(v.Ya++,f)),v.G==3&&bo(v)},fr.prototype.N=function(){this.g.l=null,delete this.j,xl(this.g),delete this.g,fr.aa.N.call(this)};function Oc(f){be.call(this),f.__headers__&&(this.headers=f.__headers__,this.statusCode=f.__status__,delete f.__headers__,delete f.__status__);var v=f.__sm__;if(v){e:{for(const A in v){f=A;break e}f=void 0}(this.i=f)&&(f=this.i,v=v!==null&&f in v?v[f]:void 0),this.data=v}else this.data=f}O(Oc,be);function Mc(){De.call(this),this.status=1}O(Mc,De);function Bi(f){this.g=f}O(Bi,Ld),Bi.prototype.ua=function(){Kt(this.g,"a")},Bi.prototype.ta=function(f){Kt(this.g,new Oc(f))},Bi.prototype.sa=function(f){Kt(this.g,new Mc)},Bi.prototype.ra=function(){Kt(this.g,"b")},wl.prototype.createWebChannel=wl.prototype.g,fr.prototype.send=fr.prototype.o,fr.prototype.open=fr.prototype.m,fr.prototype.close=fr.prototype.close,RS=function(){return new wl},DS=function(){return $e()},AS=ve,$b={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Na.NO_ERROR=0,Na.TIMEOUT=8,Na.HTTP_ERROR=6,fg=Na,li.COMPLETE="complete",CS=li,Be.EventType=he,he.OPEN="a",he.CLOSE="b",he.ERROR="c",he.MESSAGE="d",mn.prototype.listen=mn.prototype.K,Lm=Be,pn.prototype.listenOnce=pn.prototype.L,pn.prototype.getLastError=pn.prototype.Ka,pn.prototype.getLastErrorCode=pn.prototype.Ba,pn.prototype.getStatus=pn.prototype.Z,pn.prototype.getResponseJson=pn.prototype.Oa,pn.prototype.getResponseText=pn.prototype.oa,pn.prototype.send=pn.prototype.ea,pn.prototype.setWithCredentials=pn.prototype.Ha,TS=pn}).apply(typeof tg<"u"?tg:typeof self<"u"?self:typeof window<"u"?window:{});const Hj="@firebase/firestore",Gj="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cr{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}cr.UNAUTHENTICATED=new cr(null),cr.GOOGLE_CREDENTIALS=new cr("google-credentials-uid"),cr.FIRST_PARTY=new cr("first-party-uid"),cr.MOCK_USER=new cr("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oh="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wd=new D0("@firebase/firestore");function vu(){return wd.logLevel}function Ye(r,...e){if(wd.logLevel<=cn.DEBUG){const t=e.map(O0);wd.debug(`Firestore (${oh}): ${r}`,...t)}}function Rs(r,...e){if(wd.logLevel<=cn.ERROR){const t=e.map(O0);wd.error(`Firestore (${oh}): ${r}`,...t)}}function Lu(r,...e){if(wd.logLevel<=cn.WARN){const t=e.map(O0);wd.warn(`Firestore (${oh}): ${r}`,...t)}}function O0(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gt(r,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,PS(r,s,t)}function PS(r,e,t){let s=`FIRESTORE (${oh}) INTERNAL ASSERTION FAILED: ${e} (ID: ${r.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw Rs(s),new Error(s)}function vt(r,e,t,s){let a="Unexpected state";typeof t=="string"?a=t:s=t,r||PS(e,a,s)}function wt(r,e){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fe={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class tt extends ao{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kS{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class TR{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(cr.UNAUTHENTICATED))}shutdown(){}}class CR{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class AR{constructor(e){this.t=e,this.currentUser=cr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){vt(this.o===void 0,42304);let s=this.i;const a=m=>this.i!==s?(s=this.i,t(m)):Promise.resolve();let l=new xa;this.o=()=>{this.i++,this.currentUser=this.u(),l.resolve(),l=new xa,e.enqueueRetryable(()=>a(this.currentUser))};const c=()=>{const m=l;e.enqueueRetryable(async()=>{await m.promise,await a(this.currentUser)})},u=m=>{Ye("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.o&&(this.auth.addAuthTokenListener(this.o),c())};this.t.onInit(m=>u(m)),setTimeout(()=>{if(!this.auth){const m=this.t.getImmediate({optional:!0});m?u(m):(Ye("FirebaseAuthCredentialsProvider","Auth not yet detected"),l.resolve(),l=new xa)}},0),c()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(s=>this.i!==e?(Ye("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(vt(typeof s.accessToken=="string",31837,{l:s}),new kS(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return vt(e===null||typeof e=="string",2055,{h:e}),new cr(e)}}class DR{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=cr.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class RR{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new DR(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(cr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Qj{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class PR{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,si(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){vt(this.o===void 0,3512);const s=l=>{l.error!=null&&Ye("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${l.error.message}`);const c=l.token!==this.m;return this.m=l.token,Ye("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?t(l.token):Promise.resolve()};this.o=l=>{e.enqueueRetryable(()=>s(l))};const a=l=>{Ye("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=l,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(l=>a(l)),setTimeout(()=>{if(!this.appCheck){const l=this.V.getImmediate({optional:!0});l?a(l):Ye("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Qj(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(vt(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Qj(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kR(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<r;s++)t[s]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const a=kR(40);for(let l=0;l<a.length;++l)s.length<20&&a[l]<t&&(s+=e.charAt(a[l]%62))}return s}}function qt(r,e){return r<e?-1:r>e?1:0}function Bb(r,e){const t=Math.min(r.length,e.length);for(let s=0;s<t;s++){const a=r.charAt(s),l=e.charAt(s);if(a!==l)return gb(a)===gb(l)?qt(a,l):gb(a)?1:-1}return qt(r.length,e.length)}const OR=55296,MR=57343;function gb(r){const e=r.charCodeAt(0);return e>=OR&&e<=MR}function Fu(r,e,t){return r.length===e.length&&r.every((s,a)=>t(s,e[a]))}function OS(r){return r+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wj="__name__";class qa{constructor(e,t,s){t===void 0?t=0:t>e.length&&gt(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&gt(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return qa.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof qa?e.forEach(s=>{t.push(s)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let a=0;a<s;a++){const l=qa.compareSegments(e.get(a),t.get(a));if(l!==0)return l}return qt(e.length,t.length)}static compareSegments(e,t){const s=qa.isNumericId(e),a=qa.isNumericId(t);return s&&!a?-1:!s&&a?1:s&&a?qa.extractNumericId(e).compare(qa.extractNumericId(t)):Bb(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return cc.fromString(e.substring(4,e.length-2))}}class Nn extends qa{construct(e,t,s){return new Nn(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new tt(Fe.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter(a=>a.length>0))}return new Nn(t)}static emptyPath(){return new Nn([])}}const LR=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class us extends qa{construct(e,t,s){return new us(e,t,s)}static isValidIdentifier(e){return LR.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),us.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Wj}static keyField(){return new us([Wj])}static fromServerFormat(e){const t=[];let s="",a=0;const l=()=>{if(s.length===0)throw new tt(Fe.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let c=!1;for(;a<e.length;){const u=e[a];if(u==="\\"){if(a+1===e.length)throw new tt(Fe.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const m=e[a+1];if(m!=="\\"&&m!=="."&&m!=="`")throw new tt(Fe.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=m,a+=2}else u==="`"?(c=!c,a++):u!=="."||c?(s+=u,a++):(l(),a++)}if(l(),c)throw new tt(Fe.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new us(t)}static emptyPath(){return new us([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class at{constructor(e){this.path=e}static fromPath(e){return new at(Nn.fromString(e))}static fromName(e){return new at(Nn.fromString(e).popFirst(5))}static empty(){return new at(Nn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Nn.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Nn.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new at(new Nn(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MS(r,e,t){if(!t)throw new tt(Fe.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function FR(r,e,t,s){if(e===!0&&s===!0)throw new tt(Fe.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function Kj(r){if(!at.isDocumentKey(r))throw new tt(Fe.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Yj(r){if(at.isDocumentKey(r))throw new tt(Fe.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function LS(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function mx(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const e=function(s){return s.constructor?s.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":gt(12329,{type:typeof r})}function kr(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new tt(Fe.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=mx(r);throw new tt(Fe.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function UR(r,e){if(e<=0)throw new tt(Fe.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zs(r,e){const t={typeString:r};return e&&(t.value=e),t}function Cf(r,e){if(!LS(r))throw new tt(Fe.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const a=e[s].typeString,l="value"in e[s]?{value:e[s].value}:void 0;if(!(s in r)){t=`JSON missing required field: '${s}'`;break}const c=r[s];if(a&&typeof c!==a){t=`JSON field '${s}' must be a ${a}.`;break}if(l!==void 0&&c!==l.value){t=`Expected '${s}' field to equal '${l.value}'`;break}}if(t)throw new tt(Fe.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xj=-62135596800,Jj=1e6;class In{static now(){return In.fromMillis(Date.now())}static fromDate(e){return In.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*Jj);return new In(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new tt(Fe.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new tt(Fe.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Xj)throw new tt(Fe.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new tt(Fe.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Jj}_compareTo(e){return this.seconds===e.seconds?qt(this.nanoseconds,e.nanoseconds):qt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:In._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Cf(e,In._jsonSchema))return new In(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Xj;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}In._jsonSchemaVersion="firestore/timestamp/1.0",In._jsonSchema={type:zs("string",In._jsonSchemaVersion),seconds:zs("number"),nanoseconds:zs("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{static fromTimestamp(e){return new jt(e)}static min(){return new jt(new In(0,0))}static max(){return new jt(new In(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uu=-1;class Og{constructor(e,t,s,a){this.indexId=e,this.collectionGroup=t,this.fields=s,this.indexState=a}}function qb(r){return r.fields.find(e=>e.kind===2)}function id(r){return r.fields.filter(e=>e.kind!==2)}Og.UNKNOWN_ID=-1;class pg{constructor(e,t){this.fieldPath=e,this.kind=t}}class af{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new af(0,Ci.min())}}function FS(r,e){const t=r.toTimestamp().seconds,s=r.toTimestamp().nanoseconds+1,a=jt.fromTimestamp(s===1e9?new In(t+1,0):new In(t,s));return new Ci(a,at.empty(),e)}function US(r){return new Ci(r.readTime,r.key,Uu)}class Ci{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new Ci(jt.min(),at.empty(),Uu)}static max(){return new Ci(jt.max(),at.empty(),Uu)}}function L0(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=at.comparator(r.documentKey,e.documentKey),t!==0?t:qt(r.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VS="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class zS{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bc(r){if(r.code!==Fe.FAILED_PRECONDITION||r.message!==VS)throw r;Ye("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Se{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&gt(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Se((s,a)=>{this.nextCallback=l=>{this.wrapSuccess(e,l).next(s,a)},this.catchCallback=l=>{this.wrapFailure(t,l).next(s,a)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Se?t:Se.resolve(t)}catch(t){return Se.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Se.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Se.reject(t)}static resolve(e){return new Se((t,s)=>{t(e)})}static reject(e){return new Se((t,s)=>{s(e)})}static waitFor(e){return new Se((t,s)=>{let a=0,l=0,c=!1;e.forEach(u=>{++a,u.next(()=>{++l,c&&l===a&&t()},m=>s(m))}),c=!0,l===a&&t()})}static or(e){let t=Se.resolve(!1);for(const s of e)t=t.next(a=>a?Se.resolve(a):s());return t}static forEach(e,t){const s=[];return e.forEach((a,l)=>{s.push(t.call(this,a,l))}),this.waitFor(s)}static mapArray(e,t){return new Se((s,a)=>{const l=e.length,c=new Array(l);let u=0;for(let m=0;m<l;m++){const p=m;t(e[p]).next(b=>{c[p]=b,++u,u===l&&s(c)},b=>a(b))}})}static doWhile(e,t){return new Se((s,a)=>{const l=()=>{e()===!0?t().next(()=>{l()},a):s()};l()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _i="SimpleDb";class fx{static open(e,t,s,a){try{return new fx(t,e.transaction(a,s))}catch(l){throw new $m(t,l)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new xa,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new $m(e,t.error)):this.S.resolve()},this.transaction.onerror=s=>{const a=F0(s.target.error);this.S.reject(new $m(e,a))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(Ye(_i,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new zR(t)}}class dc{static delete(e){return Ye(_i,"Removing database:",e),ld(mS().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!NS())return!1;if(dc.F())return!0;const e=Js(),t=dc.M(e),s=0<t&&t<10,a=$S(e),l=0<a&&a<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||s||l)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),s=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(s)}constructor(e,t,s){this.name=e,this.version=t,this.N=s,this.B=null,dc.M(Js())===12.2&&Rs("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(Ye(_i,"Opening database:",this.name),this.db=await new Promise((t,s)=>{const a=indexedDB.open(this.name,this.version);a.onsuccess=l=>{const c=l.target.result;t(c)},a.onblocked=()=>{s(new $m(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},a.onerror=l=>{const c=l.target.error;c.name==="VersionError"?s(new tt(Fe.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):c.name==="InvalidStateError"?s(new tt(Fe.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+c)):s(new $m(e,c))},a.onupgradeneeded=l=>{Ye(_i,'Database "'+this.name+'" requires upgrade from version:',l.oldVersion);const c=l.target.result;this.N.k(c,a.transaction,l.oldVersion,this.version).next(()=>{Ye(_i,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,s,a){const l=t==="readonly";let c=0;for(;;){++c;try{this.db=await this.L(e);const u=fx.open(this.db,e,l?"readonly":"readwrite",s),m=a(u).next(p=>(u.C(),p)).catch(p=>(u.abort(p),Se.reject(p))).toPromise();return m.catch(()=>{}),await u.D,m}catch(u){const m=u,p=m.name!=="FirebaseError"&&c<3;if(Ye(_i,"Transaction failed with error:",m.message,"Retrying:",p),this.close(),!p)return Promise.reject(m)}}}close(){this.db&&this.db.close(),this.db=void 0}}function $S(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class VR{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return ld(this.U.delete())}}class $m extends tt{constructor(e,t){super(Fe.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function wc(r){return r.name==="IndexedDbTransactionError"}class zR{constructor(e){this.store=e}put(e,t){let s;return t!==void 0?(Ye(_i,"PUT",this.store.name,e,t),s=this.store.put(t,e)):(Ye(_i,"PUT",this.store.name,"<auto-key>",e),s=this.store.put(e)),ld(s)}add(e){return Ye(_i,"ADD",this.store.name,e,e),ld(this.store.add(e))}get(e){return ld(this.store.get(e)).next(t=>(t===void 0&&(t=null),Ye(_i,"GET",this.store.name,e,t),t))}delete(e){return Ye(_i,"DELETE",this.store.name,e),ld(this.store.delete(e))}count(){return Ye(_i,"COUNT",this.store.name),ld(this.store.count())}J(e,t){const s=this.options(e,t),a=s.index?this.store.index(s.index):this.store;if(typeof a.getAll=="function"){const l=a.getAll(s.range);return new Se((c,u)=>{l.onerror=m=>{u(m.target.error)},l.onsuccess=m=>{c(m.target.result)}})}{const l=this.cursor(s),c=[];return this.H(l,(u,m)=>{c.push(m)}).next(()=>c)}}Y(e,t){const s=this.store.getAll(e,t===null?void 0:t);return new Se((a,l)=>{s.onerror=c=>{l(c.target.error)},s.onsuccess=c=>{a(c.target.result)}})}Z(e,t){Ye(_i,"DELETE ALL",this.store.name);const s=this.options(e,t);s.X=!1;const a=this.cursor(s);return this.H(a,(l,c,u)=>u.delete())}ee(e,t){let s;t?s=e:(s={},t=e);const a=this.cursor(s);return this.H(a,t)}te(e){const t=this.cursor({});return new Se((s,a)=>{t.onerror=l=>{const c=F0(l.target.error);a(c)},t.onsuccess=l=>{const c=l.target.result;c?e(c.primaryKey,c.value).next(u=>{u?c.continue():s()}):s()}})}H(e,t){const s=[];return new Se((a,l)=>{e.onerror=c=>{l(c.target.error)},e.onsuccess=c=>{const u=c.target.result;if(!u)return void a();const m=new VR(u),p=t(u.primaryKey,u.value,m);if(p instanceof Se){const b=p.catch(w=>(m.done(),Se.reject(w)));s.push(b)}m.isDone?a():m.G===null?u.continue():u.continue(m.G)}}).next(()=>Se.waitFor(s))}options(e,t){let s;return e!==void 0&&(typeof e=="string"?s=e:t=e),{index:s,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const s=this.store.index(e.index);return e.X?s.openKeyCursor(e.range,t):s.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ld(r){return new Se((e,t)=>{r.onsuccess=s=>{const a=s.target.result;e(a)},r.onerror=s=>{const a=F0(s.target.error);t(a)}})}let Zj=!1;function F0(r){const e=dc.M(Js());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){const s=new tt("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Zj||(Zj=!0,setTimeout(()=>{throw s},0)),s}}return r}const Bm="IndexBackfiller";class $R{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){Ye(Bm,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const t=await this.ne.ie();Ye(Bm,`Documents written: ${t}`)}catch(t){wc(t)?Ye(Bm,"Ignoring IndexedDB error during index backfill: ",t):await bc(t)}await this.re(6e4)})}}class BR{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){const s=new Set;let a=t,l=!0;return Se.doWhile(()=>l===!0&&a>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(c=>{if(c!==null&&!s.has(c))return Ye(Bm,`Processing collection: ${c}`),this.oe(e,c,a).next(u=>{a-=u,s.add(c)});l=!1})).next(()=>t-a)}oe(e,t,s){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(a=>this.localStore.localDocuments.getNextDocuments(e,t,a,s).next(l=>{const c=l.changes;return this.localStore.indexManager.updateIndexEntries(e,c).next(()=>this._e(a,l)).next(u=>(Ye(Bm,`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u))).next(()=>c.size)}))}_e(e,t){let s=e;return t.changes.forEach((a,l)=>{const c=US(l);L0(c,s)>0&&(s=c)}),new Ci(s.readTime,s.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ii{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}ii.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pd=-1;function Af(r){return r==null}function of(r){return r===0&&1/r==-1/0}function BS(r){return typeof r=="number"&&Number.isInteger(r)&&!of(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mg="";function Or(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=e_(e)),e=qR(r.get(t),e);return e_(e)}function qR(r,e){let t=e;const s=r.length;for(let a=0;a<s;a++){const l=r.charAt(a);switch(l){case"\0":t+="";break;case Mg:t+="";break;default:t+=l}}return t}function e_(r){return r+Mg+""}function Ga(r){const e=r.length;if(vt(e>=2,64408,{path:r}),e===2)return vt(r.charAt(0)===Mg&&r.charAt(1)==="",56145,{path:r}),Nn.emptyPath();const t=e-2,s=[];let a="";for(let l=0;l<e;){const c=r.indexOf(Mg,l);switch((c<0||c>t)&&gt(50515,{path:r}),r.charAt(c+1)){case"":const u=r.substring(l,c);let m;a.length===0?m=u:(a+=u,m=a,a=""),s.push(m);break;case"":a+=r.substring(l,c),a+="\0";break;case"":a+=r.substring(l,c+1);break;default:gt(61167,{path:r})}l=c+2}return new Nn(s)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ad="remoteDocuments",Df="owner",pu="owner",lf="mutationQueues",HR="userId",pa="mutations",t_="batchId",md="userMutationsIndex",n_=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gg(r,e){return[r,Or(e)]}function qS(r,e,t){return[r,Or(e),t]}const GR={},Vu="documentMutations",Lg="remoteDocumentsV14",QR=["prefixPath","collectionGroup","readTime","documentId"],xg="documentKeyIndex",WR=["prefixPath","collectionGroup","documentId"],HS="collectionGroupIndex",KR=["collectionGroup","readTime","prefixPath","documentId"],cf="remoteDocumentGlobal",Hb="remoteDocumentGlobalKey",zu="targets",GS="queryTargetsIndex",YR=["canonicalId","targetId"],$u="targetDocuments",XR=["targetId","path"],U0="documentTargetsIndex",JR=["path","targetId"],Fg="targetGlobalKey",gd="targetGlobal",df="collectionParents",ZR=["collectionId","parent"],Bu="clientMetadata",eP="clientId",px="bundles",tP="bundleId",gx="namedQueries",nP="name",V0="indexConfiguration",sP="indexId",Gb="collectionGroupIndex",rP="collectionGroup",qm="indexState",iP=["indexId","uid"],QS="sequenceNumberIndex",aP=["uid","sequenceNumber"],Hm="indexEntries",oP=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],WS="documentKeyIndex",lP=["indexId","uid","orderedDocumentKey"],xx="documentOverlays",cP=["userId","collectionPath","documentId"],Qb="collectionPathOverlayIndex",dP=["userId","collectionPath","largestBatchId"],KS="collectionGroupOverlayIndex",uP=["userId","collectionGroup","largestBatchId"],z0="globals",hP="name",YS=[lf,pa,Vu,ad,zu,Df,gd,$u,Bu,cf,df,px,gx],mP=[...YS,xx],XS=[lf,pa,Vu,Lg,zu,Df,gd,$u,Bu,cf,df,px,gx,xx],JS=XS,$0=[...JS,V0,qm,Hm],fP=$0,ZS=[...$0,z0],pP=ZS;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wb extends zS{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function tr(r,e){const t=wt(r);return dc.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s_(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function vc(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function eI(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn{constructor(e,t){this.comparator=e,this.root=t||br.EMPTY}insert(e,t){return new Kn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,br.BLACK,null,null))}remove(e){return new Kn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,br.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const a=this.comparator(e,s.key);if(a===0)return t+s.left.size;a<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,s)=>(e(t,s),!1))}toString(){const e=[];return this.inorderTraversal((t,s)=>(e.push(`${t}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ng(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ng(this.root,e,this.comparator,!1)}getReverseIterator(){return new ng(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ng(this.root,e,this.comparator,!0)}}class ng{constructor(e,t,s,a){this.isReverse=a,this.nodeStack=[];let l=1;for(;!e.isEmpty();)if(l=t?s(e.key,t):1,t&&a&&(l*=-1),l<0)e=this.isReverse?e.left:e.right;else{if(l===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class br{constructor(e,t,s,a,l){this.key=e,this.value=t,this.color=s??br.RED,this.left=a??br.EMPTY,this.right=l??br.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,a,l){return new br(e??this.key,t??this.value,s??this.color,a??this.left,l??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let a=this;const l=s(e,a.key);return a=l<0?a.copy(null,null,null,a.left.insert(e,t,s),null):l===0?a.copy(null,t,null,null,null):a.copy(null,null,null,null,a.right.insert(e,t,s)),a.fixUp()}removeMin(){if(this.left.isEmpty())return br.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,a=this;if(t(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,t),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),t(e,a.key)===0){if(a.right.isEmpty())return br.EMPTY;s=a.right.min(),a=a.copy(s.key,s.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,t))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,br.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,br.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw gt(43730,{key:this.key,value:this.value});if(this.right.isRed())throw gt(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw gt(27949);return e+(this.isRed()?0:1)}}br.EMPTY=null,br.RED=!0,br.BLACK=!1;br.EMPTY=new class{constructor(){this.size=0}get key(){throw gt(57766)}get value(){throw gt(16141)}get color(){throw gt(16727)}get left(){throw gt(29726)}get right(){throw gt(36894)}copy(e,t,s,a,l){return this}insert(e,t,s){return new br(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class On{constructor(e){this.comparator=e,this.data=new Kn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,s)=>(e(t),!1))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const a=s.getNext();if(this.comparator(a.key,e[1])>=0)return;t(a.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new r_(this.data.getIterator())}getIteratorFrom(e){return new r_(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(s=>{t=t.add(s)}),t}isEqual(e){if(!(e instanceof On)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const a=t.getNext().key,l=s.getNext().key;if(this.comparator(a,l)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new On(this.comparator);return t.data=e,t}}class r_{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function gu(r){return r.hasNext()?r.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai{constructor(e){this.fields=e,e.sort(us.comparator)}static empty(){return new ai([])}unionWith(e){let t=new On(us.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new ai(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Fu(this.fields,e.fields,(t,s)=>t.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tI extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ps{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(a){try{return atob(a)}catch(l){throw typeof DOMException<"u"&&l instanceof DOMException?new tI("Invalid base64 string: "+l):l}}(e);return new Ps(t)}static fromUint8Array(e){const t=function(a){let l="";for(let c=0;c<a.length;++c)l+=String.fromCharCode(a[c]);return l}(e);return new Ps(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const s=new Uint8Array(t.length);for(let a=0;a<t.length;a++)s[a]=t.charCodeAt(a);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return qt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ps.EMPTY_BYTE_STRING=new Ps("");const gP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nl(r){if(vt(!!r,39018),typeof r=="string"){let e=0;const t=gP.exec(r);if(vt(!!t,46558,{timestamp:r}),t[1]){let a=t[1];a=(a+"000000000").substr(0,9),e=Number(a)}const s=new Date(r);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:rs(r.seconds),nanos:rs(r.nanos)}}function rs(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function sl(r){return typeof r=="string"?Ps.fromBase64String(r):Ps.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nI="server_timestamp",sI="__type__",rI="__previous_value__",iI="__local_write_time__";function B0(r){return(r?.mapValue?.fields||{})[sI]?.stringValue===nI}function yx(r){const e=r.mapValue.fields[rI];return B0(e)?yx(e):e}function uf(r){const e=nl(r.mapValue.fields[iI].timestampValue);return new In(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xP{constructor(e,t,s,a,l,c,u,m,p,b){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=a,this.ssl=l,this.forceLongPolling=c,this.autoDetectLongPolling=u,this.longPollingOptions=m,this.useFetchStreams=p,this.isUsingEmulator=b}}const hf="(default)";class vd{constructor(e,t){this.projectId=e,this.database=t||hf}static empty(){return new vd("","")}get isDefaultDatabase(){return this.database===hf}isEqual(e){return e instanceof vd&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q0="__type__",aI="__max__",rc={mapValue:{fields:{__type__:{stringValue:aI}}}},H0="__vector__",qu="value",yg={nullValue:"NULL_VALUE"};function pc(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?B0(r)?4:oI(r)?9007199254740991:bx(r)?10:11:gt(28295,{value:r})}function so(r,e){if(r===e)return!0;const t=pc(r);if(t!==pc(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return uf(r).isEqual(uf(e));case 3:return function(a,l){if(typeof a.timestampValue=="string"&&typeof l.timestampValue=="string"&&a.timestampValue.length===l.timestampValue.length)return a.timestampValue===l.timestampValue;const c=nl(a.timestampValue),u=nl(l.timestampValue);return c.seconds===u.seconds&&c.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(a,l){return sl(a.bytesValue).isEqual(sl(l.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(a,l){return rs(a.geoPointValue.latitude)===rs(l.geoPointValue.latitude)&&rs(a.geoPointValue.longitude)===rs(l.geoPointValue.longitude)}(r,e);case 2:return function(a,l){if("integerValue"in a&&"integerValue"in l)return rs(a.integerValue)===rs(l.integerValue);if("doubleValue"in a&&"doubleValue"in l){const c=rs(a.doubleValue),u=rs(l.doubleValue);return c===u?of(c)===of(u):isNaN(c)&&isNaN(u)}return!1}(r,e);case 9:return Fu(r.arrayValue.values||[],e.arrayValue.values||[],so);case 10:case 11:return function(a,l){const c=a.mapValue.fields||{},u=l.mapValue.fields||{};if(s_(c)!==s_(u))return!1;for(const m in c)if(c.hasOwnProperty(m)&&(u[m]===void 0||!so(c[m],u[m])))return!1;return!0}(r,e);default:return gt(52216,{left:r})}}function mf(r,e){return(r.values||[]).find(t=>so(t,e))!==void 0}function gc(r,e){if(r===e)return 0;const t=pc(r),s=pc(e);if(t!==s)return qt(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return qt(r.booleanValue,e.booleanValue);case 2:return function(l,c){const u=rs(l.integerValue||l.doubleValue),m=rs(c.integerValue||c.doubleValue);return u<m?-1:u>m?1:u===m?0:isNaN(u)?isNaN(m)?0:-1:1}(r,e);case 3:return i_(r.timestampValue,e.timestampValue);case 4:return i_(uf(r),uf(e));case 5:return Bb(r.stringValue,e.stringValue);case 6:return function(l,c){const u=sl(l),m=sl(c);return u.compareTo(m)}(r.bytesValue,e.bytesValue);case 7:return function(l,c){const u=l.split("/"),m=c.split("/");for(let p=0;p<u.length&&p<m.length;p++){const b=qt(u[p],m[p]);if(b!==0)return b}return qt(u.length,m.length)}(r.referenceValue,e.referenceValue);case 8:return function(l,c){const u=qt(rs(l.latitude),rs(c.latitude));return u!==0?u:qt(rs(l.longitude),rs(c.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return a_(r.arrayValue,e.arrayValue);case 10:return function(l,c){const u=l.fields||{},m=c.fields||{},p=u[qu]?.arrayValue,b=m[qu]?.arrayValue,w=qt(p?.values?.length||0,b?.values?.length||0);return w!==0?w:a_(p,b)}(r.mapValue,e.mapValue);case 11:return function(l,c){if(l===rc.mapValue&&c===rc.mapValue)return 0;if(l===rc.mapValue)return 1;if(c===rc.mapValue)return-1;const u=l.fields||{},m=Object.keys(u),p=c.fields||{},b=Object.keys(p);m.sort(),b.sort();for(let w=0;w<m.length&&w<b.length;++w){const N=Bb(m[w],b[w]);if(N!==0)return N;const R=gc(u[m[w]],p[b[w]]);if(R!==0)return R}return qt(m.length,b.length)}(r.mapValue,e.mapValue);default:throw gt(23264,{he:t})}}function i_(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return qt(r,e);const t=nl(r),s=nl(e),a=qt(t.seconds,s.seconds);return a!==0?a:qt(t.nanos,s.nanos)}function a_(r,e){const t=r.values||[],s=e.values||[];for(let a=0;a<t.length&&a<s.length;++a){const l=gc(t[a],s[a]);if(l)return l}return qt(t.length,s.length)}function Hu(r){return Kb(r)}function Kb(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const s=nl(t);return`time(${s.seconds},${s.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return sl(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return at.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let s="[",a=!0;for(const l of t.values||[])a?a=!1:s+=",",s+=Kb(l);return s+"]"}(r.arrayValue):"mapValue"in r?function(t){const s=Object.keys(t.fields||{}).sort();let a="{",l=!0;for(const c of s)l?l=!1:a+=",",a+=`${c}:${Kb(t.fields[c])}`;return a+"}"}(r.mapValue):gt(61005,{value:r})}function bg(r){switch(pc(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=yx(r);return e?16+bg(e):16;case 5:return 2*r.stringValue.length;case 6:return sl(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(s){return(s.values||[]).reduce((a,l)=>a+bg(l),0)}(r.arrayValue);case 10:case 11:return function(s){let a=0;return vc(s.fields,(l,c)=>{a+=l.length+bg(c)}),a}(r.mapValue);default:throw gt(13486,{value:r})}}function ff(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Yb(r){return!!r&&"integerValue"in r}function pf(r){return!!r&&"arrayValue"in r}function o_(r){return!!r&&"nullValue"in r}function l_(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function wg(r){return!!r&&"mapValue"in r}function bx(r){return(r?.mapValue?.fields||{})[q0]?.stringValue===H0}function Gm(r){if(r.geoPointValue)return{geoPointValue:{...r.geoPointValue}};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:{...r.timestampValue}};if(r.mapValue){const e={mapValue:{fields:{}}};return vc(r.mapValue.fields,(t,s)=>e.mapValue.fields[t]=Gm(s)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Gm(r.arrayValue.values[t]);return e}return{...r}}function oI(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===aI}const lI={mapValue:{fields:{[q0]:{stringValue:H0},[qu]:{arrayValue:{}}}}};function yP(r){return"nullValue"in r?yg:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?ff(vd.empty(),at.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?bx(r)?lI:{mapValue:{}}:gt(35942,{value:r})}function bP(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?ff(vd.empty(),at.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?lI:"mapValue"in r?bx(r)?{mapValue:{}}:rc:gt(61959,{value:r})}function c_(r,e){const t=gc(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function d_(r,e){const t=gc(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jr{constructor(e){this.value=e}static empty(){return new jr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!wg(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Gm(t)}setAll(e){let t=us.emptyPath(),s={},a=[];e.forEach((c,u)=>{if(!t.isImmediateParentOf(u)){const m=this.getFieldsMap(t);this.applyChanges(m,s,a),s={},a=[],t=u.popLast()}c?s[u.lastSegment()]=Gm(c):a.push(u.lastSegment())});const l=this.getFieldsMap(t);this.applyChanges(l,s,a)}delete(e){const t=this.field(e.popLast());wg(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return so(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let a=t.mapValue.fields[e.get(s)];wg(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=a),t=a}return t.mapValue.fields}applyChanges(e,t,s){vc(t,(a,l)=>e[a]=l);for(const a of s)delete e[a]}clone(){return new jr(Gm(this.value))}}function cI(r){const e=[];return vc(r.fields,(t,s)=>{const a=new us([t]);if(wg(s)){const l=cI(s.mapValue).fields;if(l.length===0)e.push(a);else for(const c of l)e.push(a.child(c))}else e.push(a)}),new ai(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class is{constructor(e,t,s,a,l,c,u){this.key=e,this.documentType=t,this.version=s,this.readTime=a,this.createTime=l,this.data=c,this.documentState=u}static newInvalidDocument(e){return new is(e,0,jt.min(),jt.min(),jt.min(),jr.empty(),0)}static newFoundDocument(e,t,s,a){return new is(e,1,t,jt.min(),s,a,0)}static newNoDocument(e,t){return new is(e,2,t,jt.min(),jt.min(),jr.empty(),0)}static newUnknownDocument(e,t){return new is(e,3,t,jt.min(),jt.min(),jr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(jt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=jr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=jr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=jt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof is&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new is(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gu{constructor(e,t){this.position=e,this.inclusive=t}}function u_(r,e,t){let s=0;for(let a=0;a<r.position.length;a++){const l=e[a],c=r.position[a];if(l.field.isKeyField()?s=at.comparator(at.fromName(c.referenceValue),t.key):s=gc(c,t.data.field(l.field)),l.dir==="desc"&&(s*=-1),s!==0)break}return s}function h_(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!so(r.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gf{constructor(e,t="asc"){this.field=e,this.dir=t}}function wP(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dI{}class dn extends dI{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new vP(e,t,s):t==="array-contains"?new _P(e,s):t==="in"?new gI(e,s):t==="not-in"?new EP(e,s):t==="array-contains-any"?new SP(e,s):new dn(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new NP(e,s):new jP(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(gc(t,this.value)):t!==null&&pc(this.value)===pc(t)&&this.matchesComparison(gc(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return gt(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class kn extends dI{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new kn(e,t)}matches(e){return Qu(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Qu(r){return r.op==="and"}function Xb(r){return r.op==="or"}function G0(r){return uI(r)&&Qu(r)}function uI(r){for(const e of r.filters)if(e instanceof kn)return!1;return!0}function Jb(r){if(r instanceof dn)return r.field.canonicalString()+r.op.toString()+Hu(r.value);if(G0(r))return r.filters.map(e=>Jb(e)).join(",");{const e=r.filters.map(t=>Jb(t)).join(",");return`${r.op}(${e})`}}function hI(r,e){return r instanceof dn?function(s,a){return a instanceof dn&&s.op===a.op&&s.field.isEqual(a.field)&&so(s.value,a.value)}(r,e):r instanceof kn?function(s,a){return a instanceof kn&&s.op===a.op&&s.filters.length===a.filters.length?s.filters.reduce((l,c,u)=>l&&hI(c,a.filters[u]),!0):!1}(r,e):void gt(19439)}function mI(r,e){const t=r.filters.concat(e);return kn.create(t,r.op)}function fI(r){return r instanceof dn?function(t){return`${t.field.canonicalString()} ${t.op} ${Hu(t.value)}`}(r):r instanceof kn?function(t){return t.op.toString()+" {"+t.getFilters().map(fI).join(" ,")+"}"}(r):"Filter"}class vP extends dn{constructor(e,t,s){super(e,t,s),this.key=at.fromName(s.referenceValue)}matches(e){const t=at.comparator(e.key,this.key);return this.matchesComparison(t)}}class NP extends dn{constructor(e,t){super(e,"in",t),this.keys=pI("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class jP extends dn{constructor(e,t){super(e,"not-in",t),this.keys=pI("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function pI(r,e){return(e.arrayValue?.values||[]).map(t=>at.fromName(t.referenceValue))}class _P extends dn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return pf(t)&&mf(t.arrayValue,this.value)}}class gI extends dn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&mf(this.value.arrayValue,t)}}class EP extends dn{constructor(e,t){super(e,"not-in",t)}matches(e){if(mf(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!mf(this.value.arrayValue,t)}}class SP extends dn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!pf(t)||!t.arrayValue.values)&&t.arrayValue.values.some(s=>mf(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IP{constructor(e,t=null,s=[],a=[],l=null,c=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=a,this.limit=l,this.startAt=c,this.endAt=u,this.Te=null}}function Zb(r,e=null,t=[],s=[],a=null,l=null,c=null){return new IP(r,e,t,s,a,l,c)}function Nd(r){const e=wt(r);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(s=>Jb(s)).join(","),t+="|ob:",t+=e.orderBy.map(s=>function(l){return l.field.canonicalString()+l.dir}(s)).join(","),Af(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(s=>Hu(s)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(s=>Hu(s)).join(",")),e.Te=t}return e.Te}function Rf(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!wP(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!hI(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!h_(r.startAt,e.startAt)&&h_(r.endAt,e.endAt)}function Ug(r){return at.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function Vg(r,e){return r.filters.filter(t=>t instanceof dn&&t.field.isEqual(e))}function m_(r,e,t){let s=yg,a=!0;for(const l of Vg(r,e)){let c=yg,u=!0;switch(l.op){case"<":case"<=":c=yP(l.value);break;case"==":case"in":case">=":c=l.value;break;case">":c=l.value,u=!1;break;case"!=":case"not-in":c=yg}c_({value:s,inclusive:a},{value:c,inclusive:u})<0&&(s=c,a=u)}if(t!==null){for(let l=0;l<r.orderBy.length;++l)if(r.orderBy[l].field.isEqual(e)){const c=t.position[l];c_({value:s,inclusive:a},{value:c,inclusive:t.inclusive})<0&&(s=c,a=t.inclusive);break}}return{value:s,inclusive:a}}function f_(r,e,t){let s=rc,a=!0;for(const l of Vg(r,e)){let c=rc,u=!0;switch(l.op){case">=":case">":c=bP(l.value),u=!1;break;case"==":case"in":case"<=":c=l.value;break;case"<":c=l.value,u=!1;break;case"!=":case"not-in":c=rc}d_({value:s,inclusive:a},{value:c,inclusive:u})>0&&(s=c,a=u)}if(t!==null){for(let l=0;l<r.orderBy.length;++l)if(r.orderBy[l].field.isEqual(e)){const c=t.position[l];d_({value:s,inclusive:a},{value:c,inclusive:t.inclusive})>0&&(s=c,a=t.inclusive);break}}return{value:s,inclusive:a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lh{constructor(e,t=null,s=[],a=[],l=null,c="F",u=null,m=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=a,this.limit=l,this.limitType=c,this.startAt=u,this.endAt=m,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function xI(r,e,t,s,a,l,c,u){return new lh(r,e,t,s,a,l,c,u)}function Pf(r){return new lh(r)}function p_(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function yI(r){return r.collectionGroup!==null}function Qm(r){const e=wt(r);if(e.Ie===null){e.Ie=[];const t=new Set;for(const l of e.explicitOrderBy)e.Ie.push(l),t.add(l.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(c){let u=new On(us.comparator);return c.filters.forEach(m=>{m.getFlattenedFilters().forEach(p=>{p.isInequality()&&(u=u.add(p.field))})}),u})(e).forEach(l=>{t.has(l.canonicalString())||l.isKeyField()||e.Ie.push(new gf(l,s))}),t.has(us.keyField().canonicalString())||e.Ie.push(new gf(us.keyField(),s))}return e.Ie}function Ti(r){const e=wt(r);return e.Ee||(e.Ee=TP(e,Qm(r))),e.Ee}function TP(r,e){if(r.limitType==="F")return Zb(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(a=>{const l=a.dir==="desc"?"asc":"desc";return new gf(a.field,l)});const t=r.endAt?new Gu(r.endAt.position,r.endAt.inclusive):null,s=r.startAt?new Gu(r.startAt.position,r.startAt.inclusive):null;return Zb(r.path,r.collectionGroup,e,r.filters,r.limit,t,s)}}function e0(r,e){const t=r.filters.concat([e]);return new lh(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function zg(r,e,t){return new lh(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function wx(r,e){return Rf(Ti(r),Ti(e))&&r.limitType===e.limitType}function bI(r){return`${Nd(Ti(r))}|lt:${r.limitType}`}function Nu(r){return`Query(target=${function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map(a=>fI(a)).join(", ")}]`),Af(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map(a=>function(c){return`${c.field.canonicalString()} (${c.dir})`}(a)).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map(a=>Hu(a)).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map(a=>Hu(a)).join(",")),`Target(${s})`}(Ti(r))}; limitType=${r.limitType})`}function kf(r,e){return e.isFoundDocument()&&function(s,a){const l=a.key.path;return s.collectionGroup!==null?a.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(l):at.isDocumentKey(s.path)?s.path.isEqual(l):s.path.isImmediateParentOf(l)}(r,e)&&function(s,a){for(const l of Qm(s))if(!l.field.isKeyField()&&a.data.field(l.field)===null)return!1;return!0}(r,e)&&function(s,a){for(const l of s.filters)if(!l.matches(a))return!1;return!0}(r,e)&&function(s,a){return!(s.startAt&&!function(c,u,m){const p=u_(c,u,m);return c.inclusive?p<=0:p<0}(s.startAt,Qm(s),a)||s.endAt&&!function(c,u,m){const p=u_(c,u,m);return c.inclusive?p>=0:p>0}(s.endAt,Qm(s),a))}(r,e)}function wI(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function vI(r){return(e,t)=>{let s=!1;for(const a of Qm(r)){const l=CP(a,e,t);if(l!==0)return l;s=s||a.field.isKeyField()}return 0}}function CP(r,e,t){const s=r.field.isKeyField()?at.comparator(e.key,t.key):function(l,c,u){const m=c.data.field(l),p=u.data.field(l);return m!==null&&p!==null?gc(m,p):gt(42886)}(r.field,e,t);switch(r.dir){case"asc":return s;case"desc":return-1*s;default:return gt(19790,{direction:r.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[a,l]of s)if(this.equalsFn(a,e))return l}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),a=this.inner[s];if(a===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],e))return void(a[l]=[e,t]);a.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let a=0;a<s.length;a++)if(this.equalsFn(s[a][0],e))return s.length===1?delete this.inner[t]:s.splice(a,1),this.innerSize--,!0;return!1}forEach(e){vc(this.inner,(t,s)=>{for(const[a,l]of s)e(a,l)})}isEmpty(){return eI(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AP=new Kn(at.comparator);function Si(){return AP}const NI=new Kn(at.comparator);function Fm(...r){let e=NI;for(const t of r)e=e.insert(t.key,t);return e}function jI(r){let e=NI;return r.forEach((t,s)=>e=e.insert(t,s.overlayedDocument)),e}function Qa(){return Wm()}function _I(){return Wm()}function Wm(){return new ll(r=>r.toString(),(r,e)=>r.isEqual(e))}const DP=new Kn(at.comparator),RP=new On(at.comparator);function Jt(...r){let e=RP;for(const t of r)e=e.add(t);return e}const PP=new On(qt);function Q0(){return PP}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W0(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:of(e)?"-0":e}}function EI(r){return{integerValue:""+r}}function SI(r,e){return BS(e)?EI(e):W0(r,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vx{constructor(){this._=void 0}}function kP(r,e,t){return r instanceof Wu?function(a,l){const c={fields:{[sI]:{stringValue:nI},[iI]:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return l&&B0(l)&&(l=yx(l)),l&&(c.fields[rI]=l),{mapValue:c}}(t,e):r instanceof Ku?TI(r,e):r instanceof Yu?CI(r,e):function(a,l){const c=II(a,l),u=g_(c)+g_(a.Ae);return Yb(c)&&Yb(a.Ae)?EI(u):W0(a.serializer,u)}(r,e)}function OP(r,e,t){return r instanceof Ku?TI(r,e):r instanceof Yu?CI(r,e):t}function II(r,e){return r instanceof Xu?function(s){return Yb(s)||function(l){return!!l&&"doubleValue"in l}(s)}(e)?e:{integerValue:0}:null}class Wu extends vx{}class Ku extends vx{constructor(e){super(),this.elements=e}}function TI(r,e){const t=AI(e);for(const s of r.elements)t.some(a=>so(a,s))||t.push(s);return{arrayValue:{values:t}}}class Yu extends vx{constructor(e){super(),this.elements=e}}function CI(r,e){let t=AI(e);for(const s of r.elements)t=t.filter(a=>!so(a,s));return{arrayValue:{values:t}}}class Xu extends vx{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function g_(r){return rs(r.integerValue||r.doubleValue)}function AI(r){return pf(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K0{constructor(e,t){this.field=e,this.transform=t}}function MP(r,e){return r.field.isEqual(e.field)&&function(s,a){return s instanceof Ku&&a instanceof Ku||s instanceof Yu&&a instanceof Yu?Fu(s.elements,a.elements,so):s instanceof Xu&&a instanceof Xu?so(s.Ae,a.Ae):s instanceof Wu&&a instanceof Wu}(r.transform,e.transform)}class LP{constructor(e,t){this.version=e,this.transformResults=t}}class as{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new as}static exists(e){return new as(void 0,e)}static updateTime(e){return new as(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function vg(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}class Nx{}function DI(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new dh(r.key,as.none()):new ch(r.key,r.data,as.none());{const t=r.data,s=jr.empty();let a=new On(us.comparator);for(let l of e.fields)if(!a.has(l)){let c=t.field(l);c===null&&l.length>1&&(l=l.popLast(),c=t.field(l)),c===null?s.delete(l):s.set(l,c),a=a.add(l)}return new cl(r.key,s,new ai(a.toArray()),as.none())}}function FP(r,e,t){r instanceof ch?function(a,l,c){const u=a.value.clone(),m=y_(a.fieldTransforms,l,c.transformResults);u.setAll(m),l.convertToFoundDocument(c.version,u).setHasCommittedMutations()}(r,e,t):r instanceof cl?function(a,l,c){if(!vg(a.precondition,l))return void l.convertToUnknownDocument(c.version);const u=y_(a.fieldTransforms,l,c.transformResults),m=l.data;m.setAll(RI(a)),m.setAll(u),l.convertToFoundDocument(c.version,m).setHasCommittedMutations()}(r,e,t):function(a,l,c){l.convertToNoDocument(c.version).setHasCommittedMutations()}(0,e,t)}function Km(r,e,t,s){return r instanceof ch?function(l,c,u,m){if(!vg(l.precondition,c))return u;const p=l.value.clone(),b=b_(l.fieldTransforms,m,c);return p.setAll(b),c.convertToFoundDocument(c.version,p).setHasLocalMutations(),null}(r,e,t,s):r instanceof cl?function(l,c,u,m){if(!vg(l.precondition,c))return u;const p=b_(l.fieldTransforms,m,c),b=c.data;return b.setAll(RI(l)),b.setAll(p),c.convertToFoundDocument(c.version,b).setHasLocalMutations(),u===null?null:u.unionWith(l.fieldMask.fields).unionWith(l.fieldTransforms.map(w=>w.field))}(r,e,t,s):function(l,c,u){return vg(l.precondition,c)?(c.convertToNoDocument(c.version).setHasLocalMutations(),null):u}(r,e,t)}function UP(r,e){let t=null;for(const s of r.fieldTransforms){const a=e.data.field(s.field),l=II(s.transform,a||null);l!=null&&(t===null&&(t=jr.empty()),t.set(s.field,l))}return t||null}function x_(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(s,a){return s===void 0&&a===void 0||!(!s||!a)&&Fu(s,a,(l,c)=>MP(l,c))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}class ch extends Nx{constructor(e,t,s,a=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class cl extends Nx{constructor(e,t,s,a,l=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=a,this.fieldTransforms=l,this.type=1}getFieldMask(){return this.fieldMask}}function RI(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const s=r.data.field(t);e.set(t,s)}}),e}function y_(r,e,t){const s=new Map;vt(r.length===t.length,32656,{Re:t.length,Ve:r.length});for(let a=0;a<t.length;a++){const l=r[a],c=l.transform,u=e.data.field(l.field);s.set(l.field,OP(c,u,t[a]))}return s}function b_(r,e,t){const s=new Map;for(const a of r){const l=a.transform,c=t.data.field(a.field);s.set(a.field,kP(l,c,e))}return s}class dh extends Nx{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Y0 extends Nx{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X0{constructor(e,t,s,a){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=a}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let a=0;a<this.mutations.length;a++){const l=this.mutations[a];l.key.isEqual(e.key)&&FP(l,e,s[a])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=Km(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=Km(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=_I();return this.mutations.forEach(a=>{const l=e.get(a.key),c=l.overlayedDocument;let u=this.applyToLocalView(c,l.mutatedFields);u=t.has(a.key)?null:u;const m=DI(c,u);m!==null&&s.set(a.key,m),c.isValidDocument()||c.convertToNoDocument(jt.min())}),s}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Jt())}isEqual(e){return this.batchId===e.batchId&&Fu(this.mutations,e.mutations,(t,s)=>x_(t,s))&&Fu(this.baseMutations,e.baseMutations,(t,s)=>x_(t,s))}}class J0{constructor(e,t,s,a){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=a}static from(e,t,s){vt(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let a=function(){return DP}();const l=e.mutations;for(let c=0;c<l.length;c++)a=a.insert(l[c].key,s[c].version);return new J0(e,t,s,a)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z0{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VP{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Vs,yn;function PI(r){switch(r){case Fe.OK:return gt(64938);case Fe.CANCELLED:case Fe.UNKNOWN:case Fe.DEADLINE_EXCEEDED:case Fe.RESOURCE_EXHAUSTED:case Fe.INTERNAL:case Fe.UNAVAILABLE:case Fe.UNAUTHENTICATED:return!1;case Fe.INVALID_ARGUMENT:case Fe.NOT_FOUND:case Fe.ALREADY_EXISTS:case Fe.PERMISSION_DENIED:case Fe.FAILED_PRECONDITION:case Fe.ABORTED:case Fe.OUT_OF_RANGE:case Fe.UNIMPLEMENTED:case Fe.DATA_LOSS:return!0;default:return gt(15467,{code:r})}}function kI(r){if(r===void 0)return Rs("GRPC error has no .code"),Fe.UNKNOWN;switch(r){case Vs.OK:return Fe.OK;case Vs.CANCELLED:return Fe.CANCELLED;case Vs.UNKNOWN:return Fe.UNKNOWN;case Vs.DEADLINE_EXCEEDED:return Fe.DEADLINE_EXCEEDED;case Vs.RESOURCE_EXHAUSTED:return Fe.RESOURCE_EXHAUSTED;case Vs.INTERNAL:return Fe.INTERNAL;case Vs.UNAVAILABLE:return Fe.UNAVAILABLE;case Vs.UNAUTHENTICATED:return Fe.UNAUTHENTICATED;case Vs.INVALID_ARGUMENT:return Fe.INVALID_ARGUMENT;case Vs.NOT_FOUND:return Fe.NOT_FOUND;case Vs.ALREADY_EXISTS:return Fe.ALREADY_EXISTS;case Vs.PERMISSION_DENIED:return Fe.PERMISSION_DENIED;case Vs.FAILED_PRECONDITION:return Fe.FAILED_PRECONDITION;case Vs.ABORTED:return Fe.ABORTED;case Vs.OUT_OF_RANGE:return Fe.OUT_OF_RANGE;case Vs.UNIMPLEMENTED:return Fe.UNIMPLEMENTED;case Vs.DATA_LOSS:return Fe.DATA_LOSS;default:return gt(39323,{code:r})}}(yn=Vs||(Vs={}))[yn.OK=0]="OK",yn[yn.CANCELLED=1]="CANCELLED",yn[yn.UNKNOWN=2]="UNKNOWN",yn[yn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",yn[yn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",yn[yn.NOT_FOUND=5]="NOT_FOUND",yn[yn.ALREADY_EXISTS=6]="ALREADY_EXISTS",yn[yn.PERMISSION_DENIED=7]="PERMISSION_DENIED",yn[yn.UNAUTHENTICATED=16]="UNAUTHENTICATED",yn[yn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",yn[yn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",yn[yn.ABORTED=10]="ABORTED",yn[yn.OUT_OF_RANGE=11]="OUT_OF_RANGE",yn[yn.UNIMPLEMENTED=12]="UNIMPLEMENTED",yn[yn.INTERNAL=13]="INTERNAL",yn[yn.UNAVAILABLE=14]="UNAVAILABLE",yn[yn.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zP(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $P=new cc([4294967295,4294967295],0);function w_(r){const e=zP().encode(r),t=new IS;return t.update(e),new Uint8Array(t.digest())}function v_(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),a=e.getUint32(8,!0),l=e.getUint32(12,!0);return[new cc([t,s],0),new cc([a,l],0)]}class ew{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new Um(`Invalid padding: ${t}`);if(s<0)throw new Um(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new Um(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new Um(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=cc.fromNumber(this.ge)}ye(e,t,s){let a=e.add(t.multiply(cc.fromNumber(s)));return a.compare($P)===1&&(a=new cc([a.getBits(0),a.getBits(1)],0)),a.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=w_(e),[s,a]=v_(t);for(let l=0;l<this.hashCount;l++){const c=this.ye(s,a,l);if(!this.we(c))return!1}return!0}static create(e,t,s){const a=e%8==0?0:8-e%8,l=new Uint8Array(Math.ceil(e/8)),c=new ew(l,a,t);return s.forEach(u=>c.insert(u)),c}insert(e){if(this.ge===0)return;const t=w_(e),[s,a]=v_(t);for(let l=0;l<this.hashCount;l++){const c=this.ye(s,a,l);this.Se(c)}}Se(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class Um extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Of{constructor(e,t,s,a,l){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=a,this.resolvedLimboDocuments=l}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const a=new Map;return a.set(e,Mf.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new Of(jt.min(),a,new Kn(qt),Si(),Jt())}}class Mf{constructor(e,t,s,a,l){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=a,this.removedDocuments=l}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new Mf(s,t,Jt(),Jt(),Jt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ng{constructor(e,t,s,a){this.be=e,this.removedTargetIds=t,this.key=s,this.De=a}}class OI{constructor(e,t){this.targetId=e,this.Ce=t}}class MI{constructor(e,t,s=Ps.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=a}}class N_{constructor(){this.ve=0,this.Fe=j_(),this.Me=Ps.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Jt(),t=Jt(),s=Jt();return this.Fe.forEach((a,l)=>{switch(l){case 0:e=e.add(a);break;case 2:t=t.add(a);break;case 1:s=s.add(a);break;default:gt(38017,{changeType:l})}}),new Mf(this.Me,this.xe,e,t,s)}qe(){this.Oe=!1,this.Fe=j_()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,vt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class BP{constructor(e){this.Ge=e,this.ze=new Map,this.je=Si(),this.Je=sg(),this.He=sg(),this.Ye=new Kn(qt)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(e.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.We(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:gt(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((s,a)=>{this.rt(a)&&t(a)})}st(e){const t=e.targetId,s=e.Ce.count,a=this.ot(t);if(a){const l=a.target;if(Ug(l))if(s===0){const c=new at(l.path);this.et(t,c,is.newNoDocument(c,jt.min()))}else vt(s===1,20013,{expectedCount:s});else{const c=this._t(t);if(c!==s){const u=this.ut(e),m=u?this.ct(u,e,c):1;if(m!==0){this.it(t);const p=m===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,p)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:a=0},hashCount:l=0}=t;let c,u;try{c=sl(s).toUint8Array()}catch(m){if(m instanceof tI)return Lu("Decoding the base64 bloom filter in existence filter failed ("+m.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw m}try{u=new ew(c,a,l)}catch(m){return Lu(m instanceof Um?"BloomFilter error: ":"Applying bloom filter failed: ",m),null}return u.ge===0?null:u}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let a=0;return s.forEach(l=>{const c=this.Ge.ht(),u=`projects/${c.projectId}/databases/${c.database}/documents/${l.path.canonicalString()}`;e.mightContain(u)||(this.et(t,l,null),a++)}),a}Tt(e){const t=new Map;this.ze.forEach((l,c)=>{const u=this.ot(c);if(u){if(l.current&&Ug(u.target)){const m=new at(u.target.path);this.It(m).has(c)||this.Et(c,m)||this.et(c,m,is.newNoDocument(m,e))}l.Be&&(t.set(c,l.ke()),l.qe())}});let s=Jt();this.He.forEach((l,c)=>{let u=!0;c.forEachWhile(m=>{const p=this.ot(m);return!p||p.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(s=s.add(l))}),this.je.forEach((l,c)=>c.setReadTime(e));const a=new Of(e,t,this.Ye,this.je,s);return this.je=Si(),this.Je=sg(),this.He=sg(),this.Ye=new Kn(qt),a}Xe(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,s),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const a=this.nt(e);this.Et(e,t)?a.Qe(t,1):a.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new N_,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new On(qt),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new On(qt),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Ye("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new N_),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function sg(){return new Kn(at.comparator)}function j_(){return new Kn(at.comparator)}const qP={asc:"ASCENDING",desc:"DESCENDING"},HP={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},GP={and:"AND",or:"OR"};class QP{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function t0(r,e){return r.useProto3Json||Af(e)?e:{value:e}}function Ju(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function LI(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function WP(r,e){return Ju(r,e.toTimestamp())}function dr(r){return vt(!!r,49232),jt.fromTimestamp(function(t){const s=nl(t);return new In(s.seconds,s.nanos)}(r))}function tw(r,e){return n0(r,e).canonicalString()}function n0(r,e){const t=function(a){return new Nn(["projects",a.projectId,"databases",a.database])}(r).child("documents");return e===void 0?t:t.child(e)}function FI(r){const e=Nn.fromString(r);return vt(QI(e),10190,{key:e.toString()}),e}function xf(r,e){return tw(r.databaseId,e.path)}function Jo(r,e){const t=FI(e);if(t.get(1)!==r.databaseId.projectId)throw new tt(Fe.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new tt(Fe.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new at(zI(t))}function UI(r,e){return tw(r.databaseId,e)}function VI(r){const e=FI(r);return e.length===4?Nn.emptyPath():zI(e)}function s0(r){return new Nn(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function zI(r){return vt(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function __(r,e,t){return{name:xf(r,e),fields:t.value.mapValue.fields}}function KP(r,e,t){const s=Jo(r,e.name),a=dr(e.updateTime),l=e.createTime?dr(e.createTime):jt.min(),c=new jr({mapValue:{fields:e.fields}}),u=is.newFoundDocument(s,a,l,c);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function YP(r,e){return"found"in e?function(s,a){vt(!!a.found,43571),a.found.name,a.found.updateTime;const l=Jo(s,a.found.name),c=dr(a.found.updateTime),u=a.found.createTime?dr(a.found.createTime):jt.min(),m=new jr({mapValue:{fields:a.found.fields}});return is.newFoundDocument(l,c,u,m)}(r,e):"missing"in e?function(s,a){vt(!!a.missing,3894),vt(!!a.readTime,22933);const l=Jo(s,a.missing),c=dr(a.readTime);return is.newNoDocument(l,c)}(r,e):gt(7234,{result:e})}function XP(r,e){let t;if("targetChange"in e){e.targetChange;const s=function(p){return p==="NO_CHANGE"?0:p==="ADD"?1:p==="REMOVE"?2:p==="CURRENT"?3:p==="RESET"?4:gt(39313,{state:p})}(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],l=function(p,b){return p.useProto3Json?(vt(b===void 0||typeof b=="string",58123),Ps.fromBase64String(b||"")):(vt(b===void 0||b instanceof Buffer||b instanceof Uint8Array,16193),Ps.fromUint8Array(b||new Uint8Array))}(r,e.targetChange.resumeToken),c=e.targetChange.cause,u=c&&function(p){const b=p.code===void 0?Fe.UNKNOWN:kI(p.code);return new tt(b,p.message||"")}(c);t=new MI(s,a,l,u||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const a=Jo(r,s.document.name),l=dr(s.document.updateTime),c=s.document.createTime?dr(s.document.createTime):jt.min(),u=new jr({mapValue:{fields:s.document.fields}}),m=is.newFoundDocument(a,l,c,u),p=s.targetIds||[],b=s.removedTargetIds||[];t=new Ng(p,b,m.key,m)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const a=Jo(r,s.document),l=s.readTime?dr(s.readTime):jt.min(),c=is.newNoDocument(a,l),u=s.removedTargetIds||[];t=new Ng([],u,c.key,c)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const a=Jo(r,s.document),l=s.removedTargetIds||[];t=new Ng([],l,a,null)}else{if(!("filter"in e))return gt(11601,{Rt:e});{e.filter;const s=e.filter;s.targetId;const{count:a=0,unchangedNames:l}=s,c=new VP(a,l),u=s.targetId;t=new OI(u,c)}}return t}function yf(r,e){let t;if(e instanceof ch)t={update:__(r,e.key,e.value)};else if(e instanceof dh)t={delete:xf(r,e.key)};else if(e instanceof cl)t={update:__(r,e.key,e.data),updateMask:sk(e.fieldMask)};else{if(!(e instanceof Y0))return gt(16599,{Vt:e.type});t={verify:xf(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(s=>function(l,c){const u=c.transform;if(u instanceof Wu)return{fieldPath:c.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Ku)return{fieldPath:c.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Yu)return{fieldPath:c.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Xu)return{fieldPath:c.field.canonicalString(),increment:u.Ae};throw gt(20930,{transform:c.transform})}(0,s))),e.precondition.isNone||(t.currentDocument=function(a,l){return l.updateTime!==void 0?{updateTime:WP(a,l.updateTime)}:l.exists!==void 0?{exists:l.exists}:gt(27497)}(r,e.precondition)),t}function r0(r,e){const t=e.currentDocument?function(l){return l.updateTime!==void 0?as.updateTime(dr(l.updateTime)):l.exists!==void 0?as.exists(l.exists):as.none()}(e.currentDocument):as.none(),s=e.updateTransforms?e.updateTransforms.map(a=>function(c,u){let m=null;if("setToServerValue"in u)vt(u.setToServerValue==="REQUEST_TIME",16630,{proto:u}),m=new Wu;else if("appendMissingElements"in u){const b=u.appendMissingElements.values||[];m=new Ku(b)}else if("removeAllFromArray"in u){const b=u.removeAllFromArray.values||[];m=new Yu(b)}else"increment"in u?m=new Xu(c,u.increment):gt(16584,{proto:u});const p=us.fromServerFormat(u.fieldPath);return new K0(p,m)}(r,a)):[];if(e.update){e.update.name;const a=Jo(r,e.update.name),l=new jr({mapValue:{fields:e.update.fields}});if(e.updateMask){const c=function(m){const p=m.fieldPaths||[];return new ai(p.map(b=>us.fromServerFormat(b)))}(e.updateMask);return new cl(a,l,c,t,s)}return new ch(a,l,t,s)}if(e.delete){const a=Jo(r,e.delete);return new dh(a,t)}if(e.verify){const a=Jo(r,e.verify);return new Y0(a,t)}return gt(1463,{proto:e})}function JP(r,e){return r&&r.length>0?(vt(e!==void 0,14353),r.map(t=>function(a,l){let c=a.updateTime?dr(a.updateTime):dr(l);return c.isEqual(jt.min())&&(c=dr(l)),new LP(c,a.transformResults||[])}(t,e))):[]}function $I(r,e){return{documents:[UI(r,e.path)]}}function BI(r,e){const t={structuredQuery:{}},s=e.path;let a;e.collectionGroup!==null?(a=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(a=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=UI(r,a);const l=function(p){if(p.length!==0)return GI(kn.create(p,"and"))}(e.filters);l&&(t.structuredQuery.where=l);const c=function(p){if(p.length!==0)return p.map(b=>function(N){return{field:ju(N.field),direction:ek(N.dir)}}(b))}(e.orderBy);c&&(t.structuredQuery.orderBy=c);const u=t0(r,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(p){return{before:p.inclusive,values:p.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(p){return{before:!p.inclusive,values:p.position}}(e.endAt)),{ft:t,parent:a}}function qI(r){let e=VI(r.parent);const t=r.structuredQuery,s=t.from?t.from.length:0;let a=null;if(s>0){vt(s===1,65062);const b=t.from[0];b.allDescendants?a=b.collectionId:e=e.child(b.collectionId)}let l=[];t.where&&(l=function(w){const N=HI(w);return N instanceof kn&&G0(N)?N.getFilters():[N]}(t.where));let c=[];t.orderBy&&(c=function(w){return w.map(N=>function(O){return new gf(_u(O.field),function(U){switch(U){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(O.direction))}(N))}(t.orderBy));let u=null;t.limit&&(u=function(w){let N;return N=typeof w=="object"?w.value:w,Af(N)?null:N}(t.limit));let m=null;t.startAt&&(m=function(w){const N=!!w.before,R=w.values||[];return new Gu(R,N)}(t.startAt));let p=null;return t.endAt&&(p=function(w){const N=!w.before,R=w.values||[];return new Gu(R,N)}(t.endAt)),xI(e,a,c,l,u,"F",m,p)}function ZP(r,e){const t=function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return gt(28987,{purpose:a})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function HI(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=_u(t.unaryFilter.field);return dn.create(s,"==",{doubleValue:NaN});case"IS_NULL":const a=_u(t.unaryFilter.field);return dn.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const l=_u(t.unaryFilter.field);return dn.create(l,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const c=_u(t.unaryFilter.field);return dn.create(c,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return gt(61313);default:return gt(60726)}}(r):r.fieldFilter!==void 0?function(t){return dn.create(_u(t.fieldFilter.field),function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return gt(58110);default:return gt(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return kn.create(t.compositeFilter.filters.map(s=>HI(s)),function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return gt(1026)}}(t.compositeFilter.op))}(r):gt(30097,{filter:r})}function ek(r){return qP[r]}function tk(r){return HP[r]}function nk(r){return GP[r]}function ju(r){return{fieldPath:r.canonicalString()}}function _u(r){return us.fromServerFormat(r.fieldPath)}function GI(r){return r instanceof dn?function(t){if(t.op==="=="){if(l_(t.value))return{unaryFilter:{field:ju(t.field),op:"IS_NAN"}};if(o_(t.value))return{unaryFilter:{field:ju(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(l_(t.value))return{unaryFilter:{field:ju(t.field),op:"IS_NOT_NAN"}};if(o_(t.value))return{unaryFilter:{field:ju(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ju(t.field),op:tk(t.op),value:t.value}}}(r):r instanceof kn?function(t){const s=t.getFilters().map(a=>GI(a));return s.length===1?s[0]:{compositeFilter:{op:nk(t.op),filters:s}}}(r):gt(54877,{filter:r})}function sk(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function QI(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qo{constructor(e,t,s,a,l=jt.min(),c=jt.min(),u=Ps.EMPTY_BYTE_STRING,m=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=a,this.snapshotVersion=l,this.lastLimboFreeSnapshotVersion=c,this.resumeToken=u,this.expectedCount=m}withSequenceNumber(e){return new Qo(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Qo(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Qo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Qo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WI{constructor(e){this.yt=e}}function rk(r,e){let t;if(e.document)t=KP(r.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const s=at.fromSegments(e.noDocument.path),a=_d(e.noDocument.readTime);t=is.newNoDocument(s,a),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return gt(56709);{const s=at.fromSegments(e.unknownDocument.path),a=_d(e.unknownDocument.version);t=is.newUnknownDocument(s,a)}}return e.readTime&&t.setReadTime(function(a){const l=new In(a[0],a[1]);return jt.fromTimestamp(l)}(e.readTime)),t}function E_(r,e){const t=e.key,s={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:$g(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())s.document=function(l,c){return{name:xf(l,c.key),fields:c.data.value.mapValue.fields,updateTime:Ju(l,c.version.toTimestamp()),createTime:Ju(l,c.createTime.toTimestamp())}}(r.yt,e);else if(e.isNoDocument())s.noDocument={path:t.path.toArray(),readTime:jd(e.version)};else{if(!e.isUnknownDocument())return gt(57904,{document:e});s.unknownDocument={path:t.path.toArray(),version:jd(e.version)}}return s}function $g(r){const e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function jd(r){const e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function _d(r){const e=new In(r.seconds,r.nanoseconds);return jt.fromTimestamp(e)}function cd(r,e){const t=(e.baseMutations||[]).map(l=>r0(r.yt,l));for(let l=0;l<e.mutations.length-1;++l){const c=e.mutations[l];if(l+1<e.mutations.length&&e.mutations[l+1].transform!==void 0){const u=e.mutations[l+1];c.updateTransforms=u.transform.fieldTransforms,e.mutations.splice(l+1,1),++l}}const s=e.mutations.map(l=>r0(r.yt,l)),a=In.fromMillis(e.localWriteTimeMs);return new X0(e.batchId,a,t,s)}function Vm(r){const e=_d(r.readTime),t=r.lastLimboFreeSnapshotVersion!==void 0?_d(r.lastLimboFreeSnapshotVersion):jt.min();let s;return s=function(l){return l.documents!==void 0}(r.query)?function(l){const c=l.documents.length;return vt(c===1,1966,{count:c}),Ti(Pf(VI(l.documents[0])))}(r.query):function(l){return Ti(qI(l))}(r.query),new Qo(s,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,Ps.fromBase64String(r.resumeToken))}function KI(r,e){const t=jd(e.snapshotVersion),s=jd(e.lastLimboFreeSnapshotVersion);let a;a=Ug(e.target)?$I(r.yt,e.target):BI(r.yt,e.target).ft;const l=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Nd(e.target),readTime:t,resumeToken:l,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:s,query:a}}function YI(r){const e=qI({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?zg(e,e.limit,"L"):e}function xb(r,e){return new Z0(e.largestBatchId,r0(r.yt,e.overlayMutation))}function S_(r,e){const t=e.path.lastSegment();return[r,Or(e.path.popLast()),t]}function I_(r,e,t,s){return{indexId:r,uid:e,sequenceNumber:t,readTime:jd(s.readTime),documentKey:Or(s.documentKey.path),largestBatchId:s.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ik{getBundleMetadata(e,t){return T_(e).get(t).next(s=>{if(s)return function(l){return{id:l.bundleId,createTime:_d(l.createTime),version:l.version}}(s)})}saveBundleMetadata(e,t){return T_(e).put(function(a){return{bundleId:a.id,createTime:jd(dr(a.createTime)),version:a.version}}(t))}getNamedQuery(e,t){return C_(e).get(t).next(s=>{if(s)return function(l){return{name:l.name,query:YI(l.bundledQuery),readTime:_d(l.readTime)}}(s)})}saveNamedQuery(e,t){return C_(e).put(function(a){return{name:a.name,readTime:jd(dr(a.readTime)),bundledQuery:a.bundledQuery}}(t))}}function T_(r){return tr(r,px)}function C_(r){return tr(r,gx)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jx{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const s=t.uid||"";return new jx(e,s)}getOverlay(e,t){return Cm(e).get(S_(this.userId,t)).next(s=>s?xb(this.serializer,s):null)}getOverlays(e,t){const s=Qa();return Se.forEach(t,a=>this.getOverlay(e,a).next(l=>{l!==null&&s.set(a,l)})).next(()=>s)}saveOverlays(e,t,s){const a=[];return s.forEach((l,c)=>{const u=new Z0(t,c);a.push(this.St(e,u))}),Se.waitFor(a)}removeOverlaysForBatchId(e,t,s){const a=new Set;t.forEach(c=>a.add(Or(c.getCollectionPath())));const l=[];return a.forEach(c=>{const u=IDBKeyRange.bound([this.userId,c,s],[this.userId,c,s+1],!1,!0);l.push(Cm(e).Z(Qb,u))}),Se.waitFor(l)}getOverlaysForCollection(e,t,s){const a=Qa(),l=Or(t),c=IDBKeyRange.bound([this.userId,l,s],[this.userId,l,Number.POSITIVE_INFINITY],!0);return Cm(e).J(Qb,c).next(u=>{for(const m of u){const p=xb(this.serializer,m);a.set(p.getKey(),p)}return a})}getOverlaysForCollectionGroup(e,t,s,a){const l=Qa();let c;const u=IDBKeyRange.bound([this.userId,t,s],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Cm(e).ee({index:KS,range:u},(m,p,b)=>{const w=xb(this.serializer,p);l.size()<a||w.largestBatchId===c?(l.set(w.getKey(),w),c=w.largestBatchId):b.done()}).next(()=>l)}St(e,t){return Cm(e).put(function(a,l,c){const[u,m,p]=S_(l,c.mutation.key);return{userId:l,collectionPath:m,documentId:p,collectionGroup:c.mutation.key.getCollectionGroup(),largestBatchId:c.largestBatchId,overlayMutation:yf(a.yt,c.mutation)}}(this.serializer,this.userId,t))}}function Cm(r){return tr(r,xx)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ak{bt(e){return tr(e,z0)}getSessionToken(e){return this.bt(e).get("sessionToken").next(t=>{const s=t?.value;return s?Ps.fromUint8Array(s):Ps.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dd{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(rs(e.integerValue));else if("doubleValue"in e){const s=rs(e.doubleValue);isNaN(s)?this.Ft(t,13):(this.Ft(t,15),of(s)?t.Mt(0):t.Mt(s))}else if("timestampValue"in e){let s=e.timestampValue;this.Ft(t,20),typeof s=="string"&&(s=nl(s)),t.xt(`${s.seconds||""}`),t.Mt(s.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(sl(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const s=e.geoPointValue;this.Ft(t,45),t.Mt(s.latitude||0),t.Mt(s.longitude||0)}else"mapValue"in e?oI(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):bx(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):gt(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const s=e.fields||{};this.Ft(t,55);for(const a of Object.keys(s))this.Ot(a,t),this.Ct(s[a],t)}kt(e,t){const s=e.fields||{};this.Ft(t,53);const a=qu,l=s[a].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(rs(l)),this.Ot(a,t),this.Ct(s[a],t)}Qt(e,t){const s=e.values||[];this.Ft(t,50);for(const a of s)this.Ct(a,t)}Lt(e,t){this.Ft(t,37),at.fromName(e).path.forEach(s=>{this.Ft(t,60),this.Ut(s,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}dd.Kt=new dd;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xu=255;function ok(r){if(r===0)return 8;let e=0;return r>>4||(e+=4,r<<=4),r>>6||(e+=2,r<<=2),r>>7||(e+=1),e}function A_(r){const e=64-function(s){let a=0;for(let l=0;l<8;++l){const c=ok(255&s[l]);if(a+=c,c!==8)break}return a}(r);return Math.ceil(e/8)}class lk{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Gt(s.value),s=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Jt(s.value),s=t.next();this.Ht()}Yt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Gt(s);else if(s<2048)this.Gt(960|s>>>6),this.Gt(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s);else{const a=t.codePointAt(0);this.Gt(240|a>>>18),this.Gt(128|63&a>>>12),this.Gt(128|63&a>>>6),this.Gt(128|63&a)}}this.zt()}Zt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Jt(s);else if(s<2048)this.Jt(960|s>>>6),this.Jt(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s);else{const a=t.codePointAt(0);this.Jt(240|a>>>18),this.Jt(128|63&a>>>12),this.Jt(128|63&a>>>6),this.Jt(128|63&a)}}this.Ht()}Xt(e){const t=this.en(e),s=A_(t);this.tn(1+s),this.buffer[this.position++]=255&s;for(let a=t.length-s;a<t.length;++a)this.buffer[this.position++]=255&t[a]}nn(e){const t=this.en(e),s=A_(t);this.tn(1+s),this.buffer[this.position++]=~(255&s);for(let a=t.length-s;a<t.length;++a)this.buffer[this.position++]=~(255&t[a])}rn(){this.sn(xu),this.sn(255)}_n(){this.an(xu),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=function(l){const c=new DataView(new ArrayBuffer(8));return c.setFloat64(0,l,!1),new Uint8Array(c.buffer)}(e),s=!!(128&t[0]);t[0]^=s?255:128;for(let a=1;a<t.length;++a)t[a]^=s?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===xu?(this.sn(xu),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===xu?(this.an(xu),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let s=2*this.buffer.length;s<t&&(s=t);const a=new Uint8Array(s);a.set(this.buffer),this.buffer=a}}class ck{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class dk{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Am{constructor(){this.cn=new lk,this.ln=new ck(this.cn),this.hn=new dk(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ud{constructor(e,t,s,a){this.Tn=e,this.In=t,this.En=s,this.dn=a}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,s=new Uint8Array(t);return s.set(this.dn,0),t!==e?s.set([0],this.dn.length):++s[s.length-1],new ud(this.Tn,this.In,this.En,s)}Rn(e,t,s){return{indexId:this.Tn,uid:e,arrayValue:jg(this.En),directionalValue:jg(this.dn),orderedDocumentKey:jg(t),documentKey:s.path.toArray()}}Vn(e,t,s){const a=this.Rn(e,t,s);return[a.indexId,a.uid,a.arrayValue,a.directionalValue,a.orderedDocumentKey,a.documentKey]}}function Wl(r,e){let t=r.Tn-e.Tn;return t!==0?t:(t=D_(r.En,e.En),t!==0?t:(t=D_(r.dn,e.dn),t!==0?t:at.comparator(r.In,e.In)))}function D_(r,e){for(let t=0;t<r.length&&t<e.length;++t){const s=r[t]-e[t];if(s!==0)return s}return r.length-e.length}function jg(r){return vS()?function(t){let s="";for(let a=0;a<t.length;a++)s+=String.fromCharCode(t[a]);return s}(r):r}function R_(r){return typeof r!="string"?r:function(t){const s=new Uint8Array(t.length);for(let a=0;a<t.length;a++)s[a]=t.charCodeAt(a);return s}(r)}class P_{constructor(e){this.mn=new On((t,s)=>us.comparator(t.field,s.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const s=t;s.isInequality()?this.mn=this.mn.add(s):this.gn.push(s)}}get pn(){return this.mn.size>1}yn(e){if(vt(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=qb(e);if(t!==void 0&&!this.wn(t))return!1;const s=id(e);let a=new Set,l=0,c=0;for(;l<s.length&&this.wn(s[l]);++l)a=a.add(s[l].fieldPath.canonicalString());if(l===s.length)return!0;if(this.mn.size>0){const u=this.mn.getIterator().getNext();if(!a.has(u.field.canonicalString())){const m=s[l];if(!this.Sn(u,m)||!this.bn(this.fn[c++],m))return!1}++l}for(;l<s.length;++l){const u=s[l];if(c>=this.fn.length||!this.bn(this.fn[c++],u))return!1}return!0}Dn(){if(this.pn)return null;let e=new On(us.comparator);const t=[];for(const s of this.gn)if(!s.field.isKeyField())if(s.op==="array-contains"||s.op==="array-contains-any")t.push(new pg(s.field,2));else{if(e.has(s.field))continue;e=e.add(s.field),t.push(new pg(s.field,0))}for(const s of this.fn)s.field.isKeyField()||e.has(s.field)||(e=e.add(s.field),t.push(new pg(s.field,s.dir==="asc"?0:1)));return new Og(Og.UNKNOWN_ID,this.collectionId,t,af.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const s=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===s}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XI(r){if(vt(r instanceof dn||r instanceof kn,20012),r instanceof dn){if(r instanceof gI){const t=r.value.arrayValue?.values?.map(s=>dn.create(r.field,"==",s))||[];return kn.create(t,"or")}return r}const e=r.filters.map(t=>XI(t));return kn.create(e,r.op)}function uk(r){if(r.getFilters().length===0)return[];const e=o0(XI(r));return vt(JI(e),7391),i0(e)||a0(e)?[e]:e.getFilters()}function i0(r){return r instanceof dn}function a0(r){return r instanceof kn&&G0(r)}function JI(r){return i0(r)||a0(r)||function(t){if(t instanceof kn&&Xb(t)){for(const s of t.getFilters())if(!i0(s)&&!a0(s))return!1;return!0}return!1}(r)}function o0(r){if(vt(r instanceof dn||r instanceof kn,34018),r instanceof dn)return r;if(r.filters.length===1)return o0(r.filters[0]);const e=r.filters.map(s=>o0(s));let t=kn.create(e,r.op);return t=Bg(t),JI(t)?t:(vt(t instanceof kn,64498),vt(Qu(t),40251),vt(t.filters.length>1,57927),t.filters.reduce((s,a)=>nw(s,a)))}function nw(r,e){let t;return vt(r instanceof dn||r instanceof kn,38388),vt(e instanceof dn||e instanceof kn,25473),t=r instanceof dn?e instanceof dn?function(a,l){return kn.create([a,l],"and")}(r,e):k_(r,e):e instanceof dn?k_(e,r):function(a,l){if(vt(a.filters.length>0&&l.filters.length>0,48005),Qu(a)&&Qu(l))return mI(a,l.getFilters());const c=Xb(a)?a:l,u=Xb(a)?l:a,m=c.filters.map(p=>nw(p,u));return kn.create(m,"or")}(r,e),Bg(t)}function k_(r,e){if(Qu(e))return mI(e,r.getFilters());{const t=e.filters.map(s=>nw(r,s));return kn.create(t,"or")}}function Bg(r){if(vt(r instanceof dn||r instanceof kn,11850),r instanceof dn)return r;const e=r.getFilters();if(e.length===1)return Bg(e[0]);if(uI(r))return r;const t=e.map(a=>Bg(a)),s=[];return t.forEach(a=>{a instanceof dn?s.push(a):a instanceof kn&&(a.op===r.op?s.push(...a.filters):s.push(a))}),s.length===1?s[0]:kn.create(s,r.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hk{constructor(){this.Cn=new sw}addToCollectionParentIndex(e,t){return this.Cn.add(t),Se.resolve()}getCollectionParents(e,t){return Se.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return Se.resolve()}deleteFieldIndex(e,t){return Se.resolve()}deleteAllFieldIndexes(e){return Se.resolve()}createTargetIndexes(e,t){return Se.resolve()}getDocumentsMatchingTarget(e,t){return Se.resolve(null)}getIndexType(e,t){return Se.resolve(0)}getFieldIndexes(e,t){return Se.resolve([])}getNextCollectionGroupToUpdate(e){return Se.resolve(null)}getMinOffset(e,t){return Se.resolve(Ci.min())}getMinOffsetFromCollectionGroup(e,t){return Se.resolve(Ci.min())}updateCollectionGroup(e,t,s){return Se.resolve()}updateIndexEntries(e,t){return Se.resolve()}}class sw{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),a=this.index[t]||new On(Nn.comparator),l=!a.has(s);return this.index[t]=a.add(s),l}has(e){const t=e.lastSegment(),s=e.popLast(),a=this.index[t];return a&&a.has(s)}getEntries(e){return(this.index[e]||new On(Nn.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O_="IndexedDbIndexManager",rg=new Uint8Array(0);class mk{constructor(e,t){this.databaseId=t,this.vn=new sw,this.Fn=new ll(s=>Nd(s),(s,a)=>Rf(s,a)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const s=t.lastSegment(),a=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const l={collectionId:s,parent:Or(a)};return M_(e).put(l)}return Se.resolve()}getCollectionParents(e,t){const s=[],a=IDBKeyRange.bound([t,""],[OS(t),""],!1,!0);return M_(e).J(a).next(l=>{for(const c of l){if(c.collectionId!==t)break;s.push(Ga(c.parent))}return s})}addFieldIndex(e,t){const s=Dm(e),a=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(m=>[m.fieldPath.canonicalString(),m.kind])}}(t);delete a.indexId;const l=s.add(a);if(t.indexState){const c=bu(e);return l.next(u=>{c.put(I_(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return l.next()}deleteFieldIndex(e,t){const s=Dm(e),a=bu(e),l=yu(e);return s.delete(t.indexId).next(()=>a.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>l.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Dm(e),s=yu(e),a=bu(e);return t.Z().next(()=>s.Z()).next(()=>a.Z())}createTargetIndexes(e,t){return Se.forEach(this.Mn(t),s=>this.getIndexType(e,s).next(a=>{if(a===0||a===1){const l=new P_(s).Dn();if(l!=null)return this.addFieldIndex(e,l)}}))}getDocumentsMatchingTarget(e,t){const s=yu(e);let a=!0;const l=new Map;return Se.forEach(this.Mn(t),c=>this.xn(e,c).next(u=>{a&&(a=!!u),l.set(c,u)})).next(()=>{if(a){let c=Jt();const u=[];return Se.forEach(l,(m,p)=>{Ye(O_,`Using index ${function(Z){return`id=${Z.indexId}|cg=${Z.collectionGroup}|f=${Z.fields.map(ie=>`${ie.fieldPath}:${ie.kind}`).join(",")}`}(m)} to execute ${Nd(t)}`);const b=function(Z,ie){const X=qb(ie);if(X===void 0)return null;for(const pe of Vg(Z,X.fieldPath))switch(pe.op){case"array-contains-any":return pe.value.arrayValue.values||[];case"array-contains":return[pe.value]}return null}(p,m),w=function(Z,ie){const X=new Map;for(const pe of id(ie))for(const H of Vg(Z,pe.fieldPath))switch(H.op){case"==":case"in":X.set(pe.fieldPath.canonicalString(),H.value);break;case"not-in":case"!=":return X.set(pe.fieldPath.canonicalString(),H.value),Array.from(X.values())}return null}(p,m),N=function(Z,ie){const X=[];let pe=!0;for(const H of id(ie)){const B=H.kind===0?m_(Z,H.fieldPath,Z.startAt):f_(Z,H.fieldPath,Z.startAt);X.push(B.value),pe&&(pe=B.inclusive)}return new Gu(X,pe)}(p,m),R=function(Z,ie){const X=[];let pe=!0;for(const H of id(ie)){const B=H.kind===0?f_(Z,H.fieldPath,Z.endAt):m_(Z,H.fieldPath,Z.endAt);X.push(B.value),pe&&(pe=B.inclusive)}return new Gu(X,pe)}(p,m),O=this.On(m,p,N),G=this.On(m,p,R),U=this.Nn(m,p,w),T=this.Bn(m.indexId,b,O,N.inclusive,G,R.inclusive,U);return Se.forEach(T,ee=>s.Y(ee,t.limit).next(Z=>{Z.forEach(ie=>{const X=at.fromSegments(ie.documentKey);c.has(X)||(c=c.add(X),u.push(X))})}))}).next(()=>u)}return Se.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=uk(kn.create(e.filters,"and")).map(s=>Zb(e.path,e.collectionGroup,e.orderBy,s.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t),t)}Bn(e,t,s,a,l,c,u){const m=(t!=null?t.length:1)*Math.max(s.length,l.length),p=m/(t!=null?t.length:1),b=[];for(let w=0;w<m;++w){const N=t?this.Ln(t[w/p]):rg,R=this.kn(e,N,s[w%p],a),O=this.qn(e,N,l[w%p],c),G=u.map(U=>this.kn(e,N,U,!0));b.push(...this.createRange(R,O,G))}return b}kn(e,t,s,a){const l=new ud(e,at.empty(),t,s);return a?l:l.An()}qn(e,t,s,a){const l=new ud(e,at.empty(),t,s);return a?l.An():l}xn(e,t){const s=new P_(t),a=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,a).next(l=>{let c=null;for(const u of l)s.yn(u)&&(!c||u.fields.length>c.fields.length)&&(c=u);return c})}getIndexType(e,t){let s=2;const a=this.Mn(t);return Se.forEach(a,l=>this.xn(e,l).next(c=>{c?s!==0&&c.fields.length<function(m){let p=new On(us.comparator),b=!1;for(const w of m.filters)for(const N of w.getFlattenedFilters())N.field.isKeyField()||(N.op==="array-contains"||N.op==="array-contains-any"?b=!0:p=p.add(N.field));for(const w of m.orderBy)w.field.isKeyField()||(p=p.add(w.field));return p.size+(b?1:0)}(l)&&(s=1):s=0})).next(()=>function(c){return c.limit!==null}(t)&&a.length>1&&s===2?1:s)}Qn(e,t){const s=new Am;for(const a of id(e)){const l=t.data.field(a.fieldPath);if(l==null)return null;const c=s.Pn(a.kind);dd.Kt.Dt(l,c)}return s.un()}Ln(e){const t=new Am;return dd.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const s=new Am;return dd.Kt.Dt(ff(this.databaseId,t),s.Pn(function(l){const c=id(l);return c.length===0?0:c[c.length-1].kind}(e))),s.un()}Nn(e,t,s){if(s===null)return[];let a=[];a.push(new Am);let l=0;for(const c of id(e)){const u=s[l++];for(const m of a)if(this.Un(t,c.fieldPath)&&pf(u))a=this.Kn(a,c,u);else{const p=m.Pn(c.kind);dd.Kt.Dt(u,p)}}return this.Wn(a)}On(e,t,s){return this.Nn(e,t,s.position)}Wn(e){const t=[];for(let s=0;s<e.length;++s)t[s]=e[s].un();return t}Kn(e,t,s){const a=[...e],l=[];for(const c of s.arrayValue.values||[])for(const u of a){const m=new Am;m.seed(u.un()),dd.Kt.Dt(c,m.Pn(t.kind)),l.push(m)}return l}Un(e,t){return!!e.filters.find(s=>s instanceof dn&&s.field.isEqual(t)&&(s.op==="in"||s.op==="not-in"))}getFieldIndexes(e,t){const s=Dm(e),a=bu(e);return(t?s.J(Gb,IDBKeyRange.bound(t,t)):s.J()).next(l=>{const c=[];return Se.forEach(l,u=>a.get([u.indexId,this.uid]).next(m=>{c.push(function(b,w){const N=w?new af(w.sequenceNumber,new Ci(_d(w.readTime),new at(Ga(w.documentKey)),w.largestBatchId)):af.empty(),R=b.fields.map(([O,G])=>new pg(us.fromServerFormat(O),G));return new Og(b.indexId,b.collectionGroup,R,N)}(u,m))})).next(()=>c)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((s,a)=>{const l=s.indexState.sequenceNumber-a.indexState.sequenceNumber;return l!==0?l:qt(s.collectionGroup,a.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,s){const a=Dm(e),l=bu(e);return this.Gn(e).next(c=>a.J(Gb,IDBKeyRange.bound(t,t)).next(u=>Se.forEach(u,m=>l.put(I_(m.indexId,this.uid,c,s)))))}updateIndexEntries(e,t){const s=new Map;return Se.forEach(t,(a,l)=>{const c=s.get(a.collectionGroup);return(c?Se.resolve(c):this.getFieldIndexes(e,a.collectionGroup)).next(u=>(s.set(a.collectionGroup,u),Se.forEach(u,m=>this.zn(e,a,m).next(p=>{const b=this.jn(l,m);return p.isEqual(b)?Se.resolve():this.Jn(e,l,m,p,b)}))))})}Hn(e,t,s,a){return yu(e).put(a.Rn(this.uid,this.$n(s,t.key),t.key))}Yn(e,t,s,a){return yu(e).delete(a.Vn(this.uid,this.$n(s,t.key),t.key))}zn(e,t,s){const a=yu(e);let l=new On(Wl);return a.ee({index:WS,range:IDBKeyRange.only([s.indexId,this.uid,jg(this.$n(s,t))])},(c,u)=>{l=l.add(new ud(s.indexId,t,R_(u.arrayValue),R_(u.directionalValue)))}).next(()=>l)}jn(e,t){let s=new On(Wl);const a=this.Qn(t,e);if(a==null)return s;const l=qb(t);if(l!=null){const c=e.data.field(l.fieldPath);if(pf(c))for(const u of c.arrayValue.values||[])s=s.add(new ud(t.indexId,e.key,this.Ln(u),a))}else s=s.add(new ud(t.indexId,e.key,rg,a));return s}Jn(e,t,s,a,l){Ye(O_,"Updating index entries for document '%s'",t.key);const c=[];return function(m,p,b,w,N){const R=m.getIterator(),O=p.getIterator();let G=gu(R),U=gu(O);for(;G||U;){let T=!1,ee=!1;if(G&&U){const Z=b(G,U);Z<0?ee=!0:Z>0&&(T=!0)}else G!=null?ee=!0:T=!0;T?(w(U),U=gu(O)):ee?(N(G),G=gu(R)):(G=gu(R),U=gu(O))}}(a,l,Wl,u=>{c.push(this.Hn(e,t,s,u))},u=>{c.push(this.Yn(e,t,s,u))}),Se.waitFor(c)}Gn(e){let t=1;return bu(e).ee({index:QS,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(s,a,l)=>{l.done(),t=a.sequenceNumber+1}).next(()=>t)}createRange(e,t,s){s=s.sort((c,u)=>Wl(c,u)).filter((c,u,m)=>!u||Wl(c,m[u-1])!==0);const a=[];a.push(e);for(const c of s){const u=Wl(c,e),m=Wl(c,t);if(u===0)a[0]=e.An();else if(u>0&&m<0)a.push(c),a.push(c.An());else if(m>0)break}a.push(t);const l=[];for(let c=0;c<a.length;c+=2){if(this.Zn(a[c],a[c+1]))return[];const u=a[c].Vn(this.uid,rg,at.empty()),m=a[c+1].Vn(this.uid,rg,at.empty());l.push(IDBKeyRange.bound(u,m))}return l}Zn(e,t){return Wl(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(L_)}getMinOffset(e,t){return Se.mapArray(this.Mn(t),s=>this.xn(e,s).next(a=>a||gt(44426))).next(L_)}}function M_(r){return tr(r,df)}function yu(r){return tr(r,Hm)}function Dm(r){return tr(r,V0)}function bu(r){return tr(r,qm)}function L_(r){vt(r.length!==0,28825);let e=r[0].indexState.offset,t=e.largestBatchId;for(let s=1;s<r.length;s++){const a=r[s].indexState.offset;L0(a,e)<0&&(e=a),t<a.largestBatchId&&(t=a.largestBatchId)}return new Ci(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ZI=41943040;class Pr{static withCacheSize(e){return new Pr(e,Pr.DEFAULT_COLLECTION_PERCENTILE,Pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eT(r,e,t){const s=r.store(pa),a=r.store(Vu),l=[],c=IDBKeyRange.only(t.batchId);let u=0;const m=s.ee({range:c},(b,w,N)=>(u++,N.delete()));l.push(m.next(()=>{vt(u===1,47070,{batchId:t.batchId})}));const p=[];for(const b of t.mutations){const w=qS(e,b.key.path,t.batchId);l.push(a.delete(w)),p.push(b.key)}return Se.waitFor(l).next(()=>p)}function qg(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw gt(14731);e=r.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Pr.DEFAULT_COLLECTION_PERCENTILE=10,Pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Pr.DEFAULT=new Pr(ZI,Pr.DEFAULT_COLLECTION_PERCENTILE,Pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Pr.DISABLED=new Pr(-1,0,0);class _x{constructor(e,t,s,a){this.userId=e,this.serializer=t,this.indexManager=s,this.referenceDelegate=a,this.Xn={}}static wt(e,t,s,a){vt(e.uid!=="",64387);const l=e.isAuthenticated()?e.uid:"";return new _x(l,t,s,a)}checkEmpty(e){let t=!0;const s=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Kl(e).ee({index:md,range:s},(a,l,c)=>{t=!1,c.done()}).next(()=>t)}addMutationBatch(e,t,s,a){const l=Eu(e),c=Kl(e);return c.add({}).next(u=>{vt(typeof u=="number",49019);const m=new X0(u,t,s,a),p=function(R,O,G){const U=G.baseMutations.map(ee=>yf(R.yt,ee)),T=G.mutations.map(ee=>yf(R.yt,ee));return{userId:O,batchId:G.batchId,localWriteTimeMs:G.localWriteTime.toMillis(),baseMutations:U,mutations:T}}(this.serializer,this.userId,m),b=[];let w=new On((N,R)=>qt(N.canonicalString(),R.canonicalString()));for(const N of a){const R=qS(this.userId,N.key.path,u);w=w.add(N.key.path.popLast()),b.push(c.put(p)),b.push(l.put(R,GR))}return w.forEach(N=>{b.push(this.indexManager.addToCollectionParentIndex(e,N))}),e.addOnCommittedListener(()=>{this.Xn[u]=m.keys()}),Se.waitFor(b).next(()=>m)})}lookupMutationBatch(e,t){return Kl(e).get(t).next(s=>s?(vt(s.userId===this.userId,48,"Unexpected user for mutation batch",{userId:s.userId,batchId:t}),cd(this.serializer,s)):null)}er(e,t){return this.Xn[t]?Se.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(s=>{if(s){const a=s.keys();return this.Xn[t]=a,a}return null})}getNextMutationBatchAfterBatchId(e,t){const s=t+1,a=IDBKeyRange.lowerBound([this.userId,s]);let l=null;return Kl(e).ee({index:md,range:a},(c,u,m)=>{u.userId===this.userId&&(vt(u.batchId>=s,47524,{tr:s}),l=cd(this.serializer,u)),m.done()}).next(()=>l)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let s=pd;return Kl(e).ee({index:md,range:t,reverse:!0},(a,l,c)=>{s=l.batchId,c.done()}).next(()=>s)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,pd],[this.userId,Number.POSITIVE_INFINITY]);return Kl(e).J(md,t).next(s=>s.map(a=>cd(this.serializer,a)))}getAllMutationBatchesAffectingDocumentKey(e,t){const s=gg(this.userId,t.path),a=IDBKeyRange.lowerBound(s),l=[];return Eu(e).ee({range:a},(c,u,m)=>{const[p,b,w]=c,N=Ga(b);if(p===this.userId&&t.path.isEqual(N))return Kl(e).get(w).next(R=>{if(!R)throw gt(61480,{nr:c,batchId:w});vt(R.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:R.userId,batchId:w}),l.push(cd(this.serializer,R))});m.done()}).next(()=>l)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new On(qt);const a=[];return t.forEach(l=>{const c=gg(this.userId,l.path),u=IDBKeyRange.lowerBound(c),m=Eu(e).ee({range:u},(p,b,w)=>{const[N,R,O]=p,G=Ga(R);N===this.userId&&l.path.isEqual(G)?s=s.add(O):w.done()});a.push(m)}),Se.waitFor(a).next(()=>this.rr(e,s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,a=s.length+1,l=gg(this.userId,s),c=IDBKeyRange.lowerBound(l);let u=new On(qt);return Eu(e).ee({range:c},(m,p,b)=>{const[w,N,R]=m,O=Ga(N);w===this.userId&&s.isPrefixOf(O)?O.length===a&&(u=u.add(R)):b.done()}).next(()=>this.rr(e,u))}rr(e,t){const s=[],a=[];return t.forEach(l=>{a.push(Kl(e).get(l).next(c=>{if(c===null)throw gt(35274,{batchId:l});vt(c.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:c.userId,batchId:l}),s.push(cd(this.serializer,c))}))}),Se.waitFor(a).next(()=>s)}removeMutationBatch(e,t){return eT(e.le,this.userId,t).next(s=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),Se.forEach(s,a=>this.referenceDelegate.markPotentiallyOrphaned(e,a))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return Se.resolve();const s=IDBKeyRange.lowerBound(function(c){return[c]}(this.userId)),a=[];return Eu(e).ee({range:s},(l,c,u)=>{if(l[0]===this.userId){const m=Ga(l[1]);a.push(m)}else u.done()}).next(()=>{vt(a.length===0,56720,{sr:a.map(l=>l.canonicalString())})})})}containsKey(e,t){return tT(e,this.userId,t)}_r(e){return nT(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:pd,lastStreamToken:""})}}function tT(r,e,t){const s=gg(e,t.path),a=s[1],l=IDBKeyRange.lowerBound(s);let c=!1;return Eu(r).ee({range:l,X:!0},(u,m,p)=>{const[b,w,N]=u;b===e&&w===a&&(c=!0),p.done()}).next(()=>c)}function Kl(r){return tr(r,pa)}function Eu(r){return tr(r,Vu)}function nT(r){return tr(r,lf)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ed{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Ed(0)}static cr(){return new Ed(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fk{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{const s=new Ed(t.highestTargetId);return t.highestTargetId=s.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(t=>jt.fromTimestamp(new In(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,s){return this.lr(e).next(a=>(a.highestListenSequenceNumber=t,s&&(a.lastRemoteSnapshotVersion=s.toTimestamp()),t>a.highestListenSequenceNumber&&(a.highestListenSequenceNumber=t),this.hr(e,a)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(s=>(s.targetCount+=1,this.Tr(t,s),this.hr(e,s))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>wu(e).delete(t.targetId)).next(()=>this.lr(e)).next(s=>(vt(s.targetCount>0,8065),s.targetCount-=1,this.hr(e,s)))}removeTargets(e,t,s){let a=0;const l=[];return wu(e).ee((c,u)=>{const m=Vm(u);m.sequenceNumber<=t&&s.get(m.targetId)===null&&(a++,l.push(this.removeTargetData(e,m)))}).next(()=>Se.waitFor(l)).next(()=>a)}forEachTarget(e,t){return wu(e).ee((s,a)=>{const l=Vm(a);t(l)})}lr(e){return U_(e).get(Fg).next(t=>(vt(t!==null,2888),t))}hr(e,t){return U_(e).put(Fg,t)}Pr(e,t){return wu(e).put(KI(this.serializer,t))}Tr(e,t){let s=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,s=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,s=!0),s}getTargetCount(e){return this.lr(e).next(t=>t.targetCount)}getTargetData(e,t){const s=Nd(t),a=IDBKeyRange.bound([s,Number.NEGATIVE_INFINITY],[s,Number.POSITIVE_INFINITY]);let l=null;return wu(e).ee({range:a,index:GS},(c,u,m)=>{const p=Vm(u);Rf(t,p.target)&&(l=p,m.done())}).next(()=>l)}addMatchingKeys(e,t,s){const a=[],l=Jl(e);return t.forEach(c=>{const u=Or(c.path);a.push(l.put({targetId:s,path:u})),a.push(this.referenceDelegate.addReference(e,s,c))}),Se.waitFor(a)}removeMatchingKeys(e,t,s){const a=Jl(e);return Se.forEach(t,l=>{const c=Or(l.path);return Se.waitFor([a.delete([s,c]),this.referenceDelegate.removeReference(e,s,l)])})}removeMatchingKeysForTargetId(e,t){const s=Jl(e),a=IDBKeyRange.bound([t],[t+1],!1,!0);return s.delete(a)}getMatchingKeysForTargetId(e,t){const s=IDBKeyRange.bound([t],[t+1],!1,!0),a=Jl(e);let l=Jt();return a.ee({range:s,X:!0},(c,u,m)=>{const p=Ga(c[1]),b=new at(p);l=l.add(b)}).next(()=>l)}containsKey(e,t){const s=Or(t.path),a=IDBKeyRange.bound([s],[OS(s)],!1,!0);let l=0;return Jl(e).ee({index:U0,X:!0,range:a},([c,u],m,p)=>{c!==0&&(l++,p.done())}).next(()=>l>0)}At(e,t){return wu(e).get(t).next(s=>s?Vm(s):null)}}function wu(r){return tr(r,zu)}function U_(r){return tr(r,gd)}function Jl(r){return tr(r,$u)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V_="LruGarbageCollector",sT=1048576;function z_([r,e],[t,s]){const a=qt(r,t);return a===0?qt(e,s):a}class pk{constructor(e){this.Ir=e,this.buffer=new On(z_),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();z_(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class rT{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Ye(V_,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){wc(t)?Ye(V_,"Ignoring IndexedDB error during garbage collection: ",t):await bc(t)}await this.Vr(3e5)})}}class gk{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(s=>Math.floor(t/100*s))}nthSequenceNumber(e,t){if(t===0)return Se.resolve(ii.ce);const s=new pk(t);return this.mr.forEachTarget(e,a=>s.Ar(a.sequenceNumber)).next(()=>this.mr.pr(e,a=>s.Ar(a))).next(()=>s.maxValue)}removeTargets(e,t,s){return this.mr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Ye("LruGarbageCollector","Garbage collection skipped; disabled"),Se.resolve(F_)):this.getCacheSize(e).next(s=>s<this.params.cacheSizeCollectionThreshold?(Ye("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),F_):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let s,a,l,c,u,m,p;const b=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(w=>(w>this.params.maximumSequenceNumbersToCollect?(Ye("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${w}`),a=this.params.maximumSequenceNumbersToCollect):a=w,c=Date.now(),this.nthSequenceNumber(e,a))).next(w=>(s=w,u=Date.now(),this.removeTargets(e,s,t))).next(w=>(l=w,m=Date.now(),this.removeOrphanedDocuments(e,s))).next(w=>(p=Date.now(),vu()<=cn.DEBUG&&Ye("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${c-b}ms
	Determined least recently used ${a} in `+(u-c)+`ms
	Removed ${l} targets in `+(m-u)+`ms
	Removed ${w} documents in `+(p-m)+`ms
Total Duration: ${p-b}ms`),Se.resolve({didRun:!0,sequenceNumbersCollected:a,targetsRemoved:l,documentsRemoved:w})))}}function iT(r,e){return new gk(r,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xk{constructor(e,t){this.db=e,this.garbageCollector=iT(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(s=>t.next(a=>s+a))}wr(e){let t=0;return this.pr(e,s=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(s,a)=>t(a))}addReference(e,t,s){return ig(e,s)}removeReference(e,t,s){return ig(e,s)}removeTargets(e,t,s){return this.db.getTargetCache().removeTargets(e,t,s)}markPotentiallyOrphaned(e,t){return ig(e,t)}br(e,t){return function(a,l){let c=!1;return nT(a).te(u=>tT(a,u,l).next(m=>(m&&(c=!0),Se.resolve(!m)))).next(()=>c)}(e,t)}removeOrphanedDocuments(e,t){const s=this.db.getRemoteDocumentCache().newChangeBuffer(),a=[];let l=0;return this.Sr(e,(c,u)=>{if(u<=t){const m=this.br(e,c).next(p=>{if(!p)return l++,s.getEntry(e,c).next(()=>(s.removeEntry(c,jt.min()),Jl(e).delete(function(w){return[0,Or(w.path)]}(c))))});a.push(m)}}).next(()=>Se.waitFor(a)).next(()=>s.apply(e)).next(()=>l)}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,s)}updateLimboDocument(e,t){return ig(e,t)}Sr(e,t){const s=Jl(e);let a,l=ii.ce;return s.ee({index:U0},([c,u],{path:m,sequenceNumber:p})=>{c===0?(l!==ii.ce&&t(new at(Ga(a)),l),l=p,a=m):l=ii.ce}).next(()=>{l!==ii.ce&&t(new at(Ga(a)),l)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ig(r,e){return Jl(r).put(function(s,a){return{targetId:0,path:Or(s.path),sequenceNumber:a}}(e,r.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aT{constructor(){this.changes=new ll(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,is.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?Se.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yk{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,s){return Yc(e).put(s)}removeEntry(e,t,s){return Yc(e).delete(function(l,c){const u=l.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],$g(c),u[u.length-1]]}(t,s))}updateMetadata(e,t){return this.getMetadata(e).next(s=>(s.byteSize+=t,this.Dr(e,s)))}getEntry(e,t){let s=is.newInvalidDocument(t);return Yc(e).ee({index:xg,range:IDBKeyRange.only(Rm(t))},(a,l)=>{s=this.Cr(t,l)}).next(()=>s)}vr(e,t){let s={size:0,document:is.newInvalidDocument(t)};return Yc(e).ee({index:xg,range:IDBKeyRange.only(Rm(t))},(a,l)=>{s={document:this.Cr(t,l),size:qg(l)}}).next(()=>s)}getEntries(e,t){let s=Si();return this.Fr(e,t,(a,l)=>{const c=this.Cr(a,l);s=s.insert(a,c)}).next(()=>s)}Mr(e,t){let s=Si(),a=new Kn(at.comparator);return this.Fr(e,t,(l,c)=>{const u=this.Cr(l,c);s=s.insert(l,u),a=a.insert(l,qg(c))}).next(()=>({documents:s,Or:a}))}Fr(e,t,s){if(t.isEmpty())return Se.resolve();let a=new On(q_);t.forEach(m=>a=a.add(m));const l=IDBKeyRange.bound(Rm(a.first()),Rm(a.last())),c=a.getIterator();let u=c.getNext();return Yc(e).ee({index:xg,range:l},(m,p,b)=>{const w=at.fromSegments([...p.prefixPath,p.collectionGroup,p.documentId]);for(;u&&q_(u,w)<0;)s(u,null),u=c.getNext();u&&u.isEqual(w)&&(s(u,p),u=c.hasNext()?c.getNext():null),u?b.j(Rm(u)):b.done()}).next(()=>{for(;u;)s(u,null),u=c.hasNext()?c.getNext():null})}getDocumentsMatchingQuery(e,t,s,a,l){const c=t.path,u=[c.popLast().toArray(),c.lastSegment(),$g(s.readTime),s.documentKey.path.isEmpty()?"":s.documentKey.path.lastSegment()],m=[c.popLast().toArray(),c.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Yc(e).J(IDBKeyRange.bound(u,m,!0)).next(p=>{l?.incrementDocumentReadCount(p.length);let b=Si();for(const w of p){const N=this.Cr(at.fromSegments(w.prefixPath.concat(w.collectionGroup,w.documentId)),w);N.isFoundDocument()&&(kf(t,N)||a.has(N.key))&&(b=b.insert(N.key,N))}return b})}getAllFromCollectionGroup(e,t,s,a){let l=Si();const c=B_(t,s),u=B_(t,Ci.max());return Yc(e).ee({index:HS,range:IDBKeyRange.bound(c,u,!0)},(m,p,b)=>{const w=this.Cr(at.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);l=l.insert(w.key,w),l.size===a&&b.done()}).next(()=>l)}newChangeBuffer(e){return new bk(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return $_(e).get(Hb).next(t=>(vt(!!t,20021),t))}Dr(e,t){return $_(e).put(Hb,t)}Cr(e,t){if(t){const s=rk(this.serializer,t);if(!(s.isNoDocument()&&s.version.isEqual(jt.min())))return s}return is.newInvalidDocument(e)}}function oT(r){return new yk(r)}class bk extends aT{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new ll(s=>s.toString(),(s,a)=>s.isEqual(a))}applyChanges(e){const t=[];let s=0,a=new On((l,c)=>qt(l.canonicalString(),c.canonicalString()));return this.changes.forEach((l,c)=>{const u=this.Br.get(l);if(t.push(this.Nr.removeEntry(e,l,u.readTime)),c.isValidDocument()){const m=E_(this.Nr.serializer,c);a=a.add(l.path.popLast());const p=qg(m);s+=p-u.size,t.push(this.Nr.addEntry(e,l,m))}else if(s-=u.size,this.trackRemovals){const m=E_(this.Nr.serializer,c.convertToNoDocument(jt.min()));t.push(this.Nr.addEntry(e,l,m))}}),a.forEach(l=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,l))}),t.push(this.Nr.updateMetadata(e,s)),Se.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(s=>(this.Br.set(t,{size:s.size,readTime:s.document.readTime}),s.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:s,Or:a})=>(a.forEach((l,c)=>{this.Br.set(l,{size:c,readTime:s.get(l).readTime})}),s))}}function $_(r){return tr(r,cf)}function Yc(r){return tr(r,Lg)}function Rm(r){const e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function B_(r,e){const t=e.documentKey.path.toArray();return[r,$g(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function q_(r,e){const t=r.path.toArray(),s=e.path.toArray();let a=0;for(let l=0;l<t.length-2&&l<s.length-2;++l)if(a=qt(t[l],s[l]),a)return a;return a=qt(t.length,s.length),a||(a=qt(t[t.length-2],s[s.length-2]),a||qt(t[t.length-1],s[s.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lT{constructor(e,t,s,a){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=a}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next(a=>(s=a,this.remoteDocumentCache.getEntry(e,t))).next(a=>(s!==null&&Km(s.mutation,a,ai.empty(),In.now()),a))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.getLocalViewOfDocuments(e,s,Jt()).next(()=>s))}getLocalViewOfDocuments(e,t,s=Jt()){const a=Qa();return this.populateOverlays(e,a,t).next(()=>this.computeViews(e,t,a,s).next(l=>{let c=Fm();return l.forEach((u,m)=>{c=c.insert(u,m.overlayedDocument)}),c}))}getOverlayedDocuments(e,t){const s=Qa();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,Jt()))}populateOverlays(e,t,s){const a=[];return s.forEach(l=>{t.has(l)||a.push(l)}),this.documentOverlayCache.getOverlays(e,a).next(l=>{l.forEach((c,u)=>{t.set(c,u)})})}computeViews(e,t,s,a){let l=Si();const c=Wm(),u=function(){return Wm()}();return t.forEach((m,p)=>{const b=s.get(p.key);a.has(p.key)&&(b===void 0||b.mutation instanceof cl)?l=l.insert(p.key,p):b!==void 0?(c.set(p.key,b.mutation.getFieldMask()),Km(b.mutation,p,b.mutation.getFieldMask(),In.now())):c.set(p.key,ai.empty())}),this.recalculateAndSaveOverlays(e,l).next(m=>(m.forEach((p,b)=>c.set(p,b)),t.forEach((p,b)=>u.set(p,new wk(b,c.get(p)??null))),u))}recalculateAndSaveOverlays(e,t){const s=Wm();let a=new Kn((c,u)=>c-u),l=Jt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(c=>{for(const u of c)u.keys().forEach(m=>{const p=t.get(m);if(p===null)return;let b=s.get(m)||ai.empty();b=u.applyToLocalView(p,b),s.set(m,b);const w=(a.get(u.batchId)||Jt()).add(m);a=a.insert(u.batchId,w)})}).next(()=>{const c=[],u=a.getReverseIterator();for(;u.hasNext();){const m=u.getNext(),p=m.key,b=m.value,w=_I();b.forEach(N=>{if(!l.has(N)){const R=DI(t.get(N),s.get(N));R!==null&&w.set(N,R),l=l.add(N)}}),c.push(this.documentOverlayCache.saveOverlays(e,p,w))}return Se.waitFor(c)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.recalculateAndSaveOverlays(e,s))}getDocumentsMatchingQuery(e,t,s,a){return function(c){return at.isDocumentKey(c.path)&&c.collectionGroup===null&&c.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):yI(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,a):this.getDocumentsMatchingCollectionQuery(e,t,s,a)}getNextDocuments(e,t,s,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,a).next(l=>{const c=a-l.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,a-l.size):Se.resolve(Qa());let u=Uu,m=l;return c.next(p=>Se.forEach(p,(b,w)=>(u<w.largestBatchId&&(u=w.largestBatchId),l.get(b)?Se.resolve():this.remoteDocumentCache.getEntry(e,b).next(N=>{m=m.insert(b,N)}))).next(()=>this.populateOverlays(e,p,l)).next(()=>this.computeViews(e,m,p,Jt())).next(b=>({batchId:u,changes:jI(b)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new at(t)).next(s=>{let a=Fm();return s.isFoundDocument()&&(a=a.insert(s.key,s)),a})}getDocumentsMatchingCollectionGroupQuery(e,t,s,a){const l=t.collectionGroup;let c=Fm();return this.indexManager.getCollectionParents(e,l).next(u=>Se.forEach(u,m=>{const p=function(w,N){return new lh(N,null,w.explicitOrderBy.slice(),w.filters.slice(),w.limit,w.limitType,w.startAt,w.endAt)}(t,m.child(l));return this.getDocumentsMatchingCollectionQuery(e,p,s,a).next(b=>{b.forEach((w,N)=>{c=c.insert(w,N)})})}).next(()=>c))}getDocumentsMatchingCollectionQuery(e,t,s,a){let l;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next(c=>(l=c,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,l,a))).next(c=>{l.forEach((m,p)=>{const b=p.getKey();c.get(b)===null&&(c=c.insert(b,is.newInvalidDocument(b)))});let u=Fm();return c.forEach((m,p)=>{const b=l.get(m);b!==void 0&&Km(b.mutation,p,ai.empty(),In.now()),kf(t,p)&&(u=u.insert(m,p))}),u})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vk{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return Se.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(a){return{id:a.id,version:a.version,createTime:dr(a.createTime)}}(t)),Se.resolve()}getNamedQuery(e,t){return Se.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(a){return{name:a.name,query:YI(a.bundledQuery),readTime:dr(a.readTime)}}(t)),Se.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nk{constructor(){this.overlays=new Kn(at.comparator),this.qr=new Map}getOverlay(e,t){return Se.resolve(this.overlays.get(t))}getOverlays(e,t){const s=Qa();return Se.forEach(t,a=>this.getOverlay(e,a).next(l=>{l!==null&&s.set(a,l)})).next(()=>s)}saveOverlays(e,t,s){return s.forEach((a,l)=>{this.St(e,t,l)}),Se.resolve()}removeOverlaysForBatchId(e,t,s){const a=this.qr.get(s);return a!==void 0&&(a.forEach(l=>this.overlays=this.overlays.remove(l)),this.qr.delete(s)),Se.resolve()}getOverlaysForCollection(e,t,s){const a=Qa(),l=t.length+1,c=new at(t.child("")),u=this.overlays.getIteratorFrom(c);for(;u.hasNext();){const m=u.getNext().value,p=m.getKey();if(!t.isPrefixOf(p.path))break;p.path.length===l&&m.largestBatchId>s&&a.set(m.getKey(),m)}return Se.resolve(a)}getOverlaysForCollectionGroup(e,t,s,a){let l=new Kn((p,b)=>p-b);const c=this.overlays.getIterator();for(;c.hasNext();){const p=c.getNext().value;if(p.getKey().getCollectionGroup()===t&&p.largestBatchId>s){let b=l.get(p.largestBatchId);b===null&&(b=Qa(),l=l.insert(p.largestBatchId,b)),b.set(p.getKey(),p)}}const u=Qa(),m=l.getIterator();for(;m.hasNext()&&(m.getNext().value.forEach((p,b)=>u.set(p,b)),!(u.size()>=a)););return Se.resolve(u)}St(e,t,s){const a=this.overlays.get(s.key);if(a!==null){const c=this.qr.get(a.largestBatchId).delete(s.key);this.qr.set(a.largestBatchId,c)}this.overlays=this.overlays.insert(s.key,new Z0(t,s));let l=this.qr.get(t);l===void 0&&(l=Jt(),this.qr.set(t,l)),this.qr.set(t,l.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jk{constructor(){this.sessionToken=Ps.EMPTY_BYTE_STRING}getSessionToken(e){return Se.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Se.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rw{constructor(){this.Qr=new On(lr.$r),this.Ur=new On(lr.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const s=new lr(e,t);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(e,t){e.forEach(s=>this.addReference(s,t))}removeReference(e,t){this.Gr(new lr(e,t))}zr(e,t){e.forEach(s=>this.removeReference(s,t))}jr(e){const t=new at(new Nn([])),s=new lr(t,e),a=new lr(t,e+1),l=[];return this.Ur.forEachInRange([s,a],c=>{this.Gr(c),l.push(c.key)}),l}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new at(new Nn([])),s=new lr(t,e),a=new lr(t,e+1);let l=Jt();return this.Ur.forEachInRange([s,a],c=>{l=l.add(c.key)}),l}containsKey(e){const t=new lr(e,0),s=this.Qr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class lr{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return at.comparator(e.key,t.key)||qt(e.Yr,t.Yr)}static Kr(e,t){return qt(e.Yr,t.Yr)||at.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _k{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new On(lr.$r)}checkEmpty(e){return Se.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,a){const l=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const c=new X0(l,t,s,a);this.mutationQueue.push(c);for(const u of a)this.Zr=this.Zr.add(new lr(u.key,l)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return Se.resolve(c)}lookupMutationBatch(e,t){return Se.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,a=this.ei(s),l=a<0?0:a;return Se.resolve(this.mutationQueue.length>l?this.mutationQueue[l]:null)}getHighestUnacknowledgedBatchId(){return Se.resolve(this.mutationQueue.length===0?pd:this.tr-1)}getAllMutationBatches(e){return Se.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new lr(t,0),a=new lr(t,Number.POSITIVE_INFINITY),l=[];return this.Zr.forEachInRange([s,a],c=>{const u=this.Xr(c.Yr);l.push(u)}),Se.resolve(l)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new On(qt);return t.forEach(a=>{const l=new lr(a,0),c=new lr(a,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([l,c],u=>{s=s.add(u.Yr)})}),Se.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,a=s.length+1;let l=s;at.isDocumentKey(l)||(l=l.child(""));const c=new lr(new at(l),0);let u=new On(qt);return this.Zr.forEachWhile(m=>{const p=m.key.path;return!!s.isPrefixOf(p)&&(p.length===a&&(u=u.add(m.Yr)),!0)},c),Se.resolve(this.ti(u))}ti(e){const t=[];return e.forEach(s=>{const a=this.Xr(s);a!==null&&t.push(a)}),t}removeMutationBatch(e,t){vt(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Zr;return Se.forEach(t.mutations,a=>{const l=new lr(a.key,t.batchId);return s=s.delete(l),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)}).next(()=>{this.Zr=s})}ir(e){}containsKey(e,t){const s=new lr(t,0),a=this.Zr.firstAfterOrEqual(s);return Se.resolve(t.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,Se.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ek{constructor(e){this.ri=e,this.docs=function(){return new Kn(at.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,a=this.docs.get(s),l=a?a.size:0,c=this.ri(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:c}),this.size+=c-l,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return Se.resolve(s?s.document.mutableCopy():is.newInvalidDocument(t))}getEntries(e,t){let s=Si();return t.forEach(a=>{const l=this.docs.get(a);s=s.insert(a,l?l.document.mutableCopy():is.newInvalidDocument(a))}),Se.resolve(s)}getDocumentsMatchingQuery(e,t,s,a){let l=Si();const c=t.path,u=new at(c.child("__id-9223372036854775808__")),m=this.docs.getIteratorFrom(u);for(;m.hasNext();){const{key:p,value:{document:b}}=m.getNext();if(!c.isPrefixOf(p.path))break;p.path.length>c.length+1||L0(US(b),s)<=0||(a.has(b.key)||kf(t,b))&&(l=l.insert(b.key,b.mutableCopy()))}return Se.resolve(l)}getAllFromCollectionGroup(e,t,s,a){gt(9500)}ii(e,t){return Se.forEach(this.docs,s=>t(s))}newChangeBuffer(e){return new Sk(this)}getSize(e){return Se.resolve(this.size)}}class Sk extends aT{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((s,a)=>{a.isValidDocument()?t.push(this.Nr.addEntry(e,a)):this.Nr.removeEntry(s)}),Se.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ik{constructor(e){this.persistence=e,this.si=new ll(t=>Nd(t),Rf),this.lastRemoteSnapshotVersion=jt.min(),this.highestTargetId=0,this.oi=0,this._i=new rw,this.targetCount=0,this.ai=Ed.ur()}forEachTarget(e,t){return this.si.forEach((s,a)=>t(a)),Se.resolve()}getLastRemoteSnapshotVersion(e){return Se.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Se.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),Se.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.oi&&(this.oi=t),Se.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Ed(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,Se.resolve()}updateTargetData(e,t){return this.Pr(t),Se.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,Se.resolve()}removeTargets(e,t,s){let a=0;const l=[];return this.si.forEach((c,u)=>{u.sequenceNumber<=t&&s.get(u.targetId)===null&&(this.si.delete(c),l.push(this.removeMatchingKeysForTargetId(e,u.targetId)),a++)}),Se.waitFor(l).next(()=>a)}getTargetCount(e){return Se.resolve(this.targetCount)}getTargetData(e,t){const s=this.si.get(t)||null;return Se.resolve(s)}addMatchingKeys(e,t,s){return this._i.Wr(t,s),Se.resolve()}removeMatchingKeys(e,t,s){this._i.zr(t,s);const a=this.persistence.referenceDelegate,l=[];return a&&t.forEach(c=>{l.push(a.markPotentiallyOrphaned(e,c))}),Se.waitFor(l)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),Se.resolve()}getMatchingKeysForTargetId(e,t){const s=this._i.Hr(t);return Se.resolve(s)}containsKey(e,t){return Se.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iw{constructor(e,t){this.ui={},this.overlays={},this.ci=new ii(0),this.li=!1,this.li=!0,this.hi=new jk,this.referenceDelegate=e(this),this.Pi=new Ik(this),this.indexManager=new hk,this.remoteDocumentCache=function(a){return new Ek(a)}(s=>this.referenceDelegate.Ti(s)),this.serializer=new WI(t),this.Ii=new vk(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Nk,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.ui[e.toKey()];return s||(s=new _k(t,this.referenceDelegate),this.ui[e.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,s){Ye("MemoryPersistence","Starting transaction:",e);const a=new Tk(this.ci.next());return this.referenceDelegate.Ei(),s(a).next(l=>this.referenceDelegate.di(a).next(()=>l)).toPromise().then(l=>(a.raiseOnCommittedEvent(),l))}Ai(e,t){return Se.or(Object.values(this.ui).map(s=>()=>s.containsKey(e,t)))}}class Tk extends zS{constructor(e){super(),this.currentSequenceNumber=e}}class Ex{constructor(e){this.persistence=e,this.Ri=new rw,this.Vi=null}static mi(e){return new Ex(e)}get fi(){if(this.Vi)return this.Vi;throw gt(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.fi.delete(s.toString()),Se.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.fi.add(s.toString()),Se.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),Se.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(a=>this.fi.add(a.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next(a=>{a.forEach(l=>this.fi.add(l.toString()))}).next(()=>s.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Se.forEach(this.fi,s=>{const a=at.fromPath(s);return this.gi(e,a).next(l=>{l||t.removeEntry(a,jt.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(s=>{s?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return Se.or([()=>Se.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Hg{constructor(e,t){this.persistence=e,this.pi=new ll(s=>Or(s.path),(s,a)=>s.isEqual(a)),this.garbageCollector=iT(this,t)}static mi(e,t){return new Hg(e,t)}Ei(){}di(e){return Se.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(s=>t.next(a=>s+a))}wr(e){let t=0;return this.pr(e,s=>{t++}).next(()=>t)}pr(e,t){return Se.forEach(this.pi,(s,a)=>this.br(e,s,a).next(l=>l?Se.resolve():t(a)))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const a=this.persistence.getRemoteDocumentCache(),l=a.newChangeBuffer();return a.ii(e,c=>this.br(e,c,t).next(u=>{u||(s++,l.removeEntry(c,jt.min()))})).next(()=>l.apply(e)).next(()=>s)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),Se.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),Se.resolve()}removeReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),Se.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),Se.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=bg(e.data.value)),t}br(e,t,s){return Se.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const a=this.pi.get(t);return Se.resolve(a!==void 0&&a>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ck{constructor(e){this.serializer=e}k(e,t,s,a){const l=new fx("createOrUpgrade",t);s<1&&a>=1&&(function(m){m.createObjectStore(Df)}(e),function(m){m.createObjectStore(lf,{keyPath:HR}),m.createObjectStore(pa,{keyPath:t_,autoIncrement:!0}).createIndex(md,n_,{unique:!0}),m.createObjectStore(Vu)}(e),H_(e),function(m){m.createObjectStore(ad)}(e));let c=Se.resolve();return s<3&&a>=3&&(s!==0&&(function(m){m.deleteObjectStore($u),m.deleteObjectStore(zu),m.deleteObjectStore(gd)}(e),H_(e)),c=c.next(()=>function(m){const p=m.store(gd),b={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:jt.min().toTimestamp(),targetCount:0};return p.put(Fg,b)}(l))),s<4&&a>=4&&(s!==0&&(c=c.next(()=>function(m,p){return p.store(pa).J().next(w=>{m.deleteObjectStore(pa),m.createObjectStore(pa,{keyPath:t_,autoIncrement:!0}).createIndex(md,n_,{unique:!0});const N=p.store(pa),R=w.map(O=>N.put(O));return Se.waitFor(R)})}(e,l))),c=c.next(()=>{(function(m){m.createObjectStore(Bu,{keyPath:eP})})(e)})),s<5&&a>=5&&(c=c.next(()=>this.yi(l))),s<6&&a>=6&&(c=c.next(()=>(function(m){m.createObjectStore(cf)}(e),this.wi(l)))),s<7&&a>=7&&(c=c.next(()=>this.Si(l))),s<8&&a>=8&&(c=c.next(()=>this.bi(e,l))),s<9&&a>=9&&(c=c.next(()=>{(function(m){m.objectStoreNames.contains("remoteDocumentChanges")&&m.deleteObjectStore("remoteDocumentChanges")})(e)})),s<10&&a>=10&&(c=c.next(()=>this.Di(l))),s<11&&a>=11&&(c=c.next(()=>{(function(m){m.createObjectStore(px,{keyPath:tP})})(e),function(m){m.createObjectStore(gx,{keyPath:nP})}(e)})),s<12&&a>=12&&(c=c.next(()=>{(function(m){const p=m.createObjectStore(xx,{keyPath:cP});p.createIndex(Qb,dP,{unique:!1}),p.createIndex(KS,uP,{unique:!1})})(e)})),s<13&&a>=13&&(c=c.next(()=>function(m){const p=m.createObjectStore(Lg,{keyPath:QR});p.createIndex(xg,WR),p.createIndex(HS,KR)}(e)).next(()=>this.Ci(e,l)).next(()=>e.deleteObjectStore(ad))),s<14&&a>=14&&(c=c.next(()=>this.Fi(e,l))),s<15&&a>=15&&(c=c.next(()=>function(m){m.createObjectStore(V0,{keyPath:sP,autoIncrement:!0}).createIndex(Gb,rP,{unique:!1}),m.createObjectStore(qm,{keyPath:iP}).createIndex(QS,aP,{unique:!1}),m.createObjectStore(Hm,{keyPath:oP}).createIndex(WS,lP,{unique:!1})}(e))),s<16&&a>=16&&(c=c.next(()=>{t.objectStore(qm).clear()}).next(()=>{t.objectStore(Hm).clear()})),s<17&&a>=17&&(c=c.next(()=>{(function(m){m.createObjectStore(z0,{keyPath:hP})})(e)})),s<18&&a>=18&&vS()&&(c=c.next(()=>{t.objectStore(qm).clear()}).next(()=>{t.objectStore(Hm).clear()})),c}wi(e){let t=0;return e.store(ad).ee((s,a)=>{t+=qg(a)}).next(()=>{const s={byteSize:t};return e.store(cf).put(Hb,s)})}yi(e){const t=e.store(lf),s=e.store(pa);return t.J().next(a=>Se.forEach(a,l=>{const c=IDBKeyRange.bound([l.userId,pd],[l.userId,l.lastAcknowledgedBatchId]);return s.J(md,c).next(u=>Se.forEach(u,m=>{vt(m.userId===l.userId,18650,"Cannot process batch from unexpected user",{batchId:m.batchId});const p=cd(this.serializer,m);return eT(e,l.userId,p).next(()=>{})}))}))}Si(e){const t=e.store($u),s=e.store(ad);return e.store(gd).get(Fg).next(a=>{const l=[];return s.ee((c,u)=>{const m=new Nn(c),p=function(w){return[0,Or(w)]}(m);l.push(t.get(p).next(b=>b?Se.resolve():(w=>t.put({targetId:0,path:Or(w),sequenceNumber:a.highestListenSequenceNumber}))(m)))}).next(()=>Se.waitFor(l))})}bi(e,t){e.createObjectStore(df,{keyPath:ZR});const s=t.store(df),a=new sw,l=c=>{if(a.add(c)){const u=c.lastSegment(),m=c.popLast();return s.put({collectionId:u,parent:Or(m)})}};return t.store(ad).ee({X:!0},(c,u)=>{const m=new Nn(c);return l(m.popLast())}).next(()=>t.store(Vu).ee({X:!0},([c,u,m],p)=>{const b=Ga(u);return l(b.popLast())}))}Di(e){const t=e.store(zu);return t.ee((s,a)=>{const l=Vm(a),c=KI(this.serializer,l);return t.put(c)})}Ci(e,t){const s=t.store(ad),a=[];return s.ee((l,c)=>{const u=t.store(Lg),m=function(w){return w.document?new at(Nn.fromString(w.document.name).popFirst(5)):w.noDocument?at.fromSegments(w.noDocument.path):w.unknownDocument?at.fromSegments(w.unknownDocument.path):gt(36783)}(c).path.toArray(),p={prefixPath:m.slice(0,m.length-2),collectionGroup:m[m.length-2],documentId:m[m.length-1],readTime:c.readTime||[0,0],unknownDocument:c.unknownDocument,noDocument:c.noDocument,document:c.document,hasCommittedMutations:!!c.hasCommittedMutations};a.push(u.put(p))}).next(()=>Se.waitFor(a))}Fi(e,t){const s=t.store(pa),a=oT(this.serializer),l=new iw(Ex.mi,this.serializer.yt);return s.J().next(c=>{const u=new Map;return c.forEach(m=>{let p=u.get(m.userId)??Jt();cd(this.serializer,m).keys().forEach(b=>p=p.add(b)),u.set(m.userId,p)}),Se.forEach(u,(m,p)=>{const b=new cr(p),w=jx.wt(this.serializer,b),N=l.getIndexManager(b),R=_x.wt(b,this.serializer,N,l.referenceDelegate);return new lT(a,R,w,N).recalculateAndSaveOverlaysForDocumentKeys(new Wb(t,ii.ce),m).next()})})}}function H_(r){r.createObjectStore($u,{keyPath:XR}).createIndex(U0,JR,{unique:!0}),r.createObjectStore(zu,{keyPath:"targetId"}).createIndex(GS,YR,{unique:!0}),r.createObjectStore(gd)}const Yl="IndexedDbPersistence",yb=18e5,bb=5e3,wb="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Ak="main";class aw{constructor(e,t,s,a,l,c,u,m,p,b,w=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=s,this.Mi=l,this.window=c,this.document=u,this.xi=p,this.Oi=b,this.Ni=w,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=N=>Promise.resolve(),!aw.v())throw new tt(Fe.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new xk(this,a),this.$i=t+Ak,this.serializer=new WI(m),this.Ui=new dc(this.$i,this.Ni,new Ck(this.serializer)),this.hi=new ak,this.Pi=new fk(this.referenceDelegate,this.serializer),this.remoteDocumentCache=oT(this.serializer),this.Ii=new ik,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,b===!1&&Rs(Yl,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new tt(Fe.FAILED_PRECONDITION,wb);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new ii(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ag(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(wc(e))return Ye(Yl,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Ye(Yl,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return Pm(e).get(pu).next(t=>Se.resolve(this.es(t)))}ts(e){return ag(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,yb)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const s=tr(t,Bu);return s.J().next(a=>{const l=this.ss(a,yb),c=a.filter(u=>l.indexOf(u)===-1);return Se.forEach(c,u=>s.delete(u.clientId)).next(()=>c)})}).catch(()=>[]);if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?Se.resolve(!0):Pm(e).get(pu).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,bb)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new tt(Fe.FAILED_PRECONDITION,wb);return!1}}return!(!this.networkEnabled||!this.inForeground)||ag(e).J().next(s=>this.ss(s,bb).find(a=>{if(this.clientId!==a.clientId){const l=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,u=this.networkEnabled===a.networkEnabled;if(l||c&&u)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&Ye(Yl,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Df,Bu],e=>{const t=new Wb(e,ii.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(s=>this.rs(s.updateTimeMs,t)&&!this.us(s.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>ag(e).J().next(t=>this.ss(t,yb).map(s=>s.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return _x.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new mk(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return jx.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,s){Ye(Yl,"Starting transaction:",e);const a=t==="readonly"?"readonly":"readwrite",l=function(m){return m===18?pP:m===17?ZS:m===16?fP:m===15?$0:m===14?JS:m===13?XS:m===12?mP:m===11?YS:void gt(60245)}(this.Ni);let c;return this.Ui.runTransaction(e,a,l,u=>(c=new Wb(u,this.ci?this.ci.next():ii.ce),t==="readwrite-primary"?this.Hi(c).next(m=>!!m||this.Yi(c)).next(m=>{if(!m)throw Rs(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new tt(Fe.FAILED_PRECONDITION,VS);return s(c)}).next(m=>this.Xi(c).next(()=>m)):this.Is(c).next(()=>s(c)))).then(u=>(c.raiseOnCommittedEvent(),u))}Is(e){return Pm(e).get(pu).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,bb)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new tt(Fe.FAILED_PRECONDITION,wb)})}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Pm(e).put(pu,t)}static v(){return dc.v()}Zi(e){const t=Pm(e);return t.get(pu).next(s=>this.es(s)?(Ye(Yl,"Releasing primary lease."),t.delete(pu)):Se.resolve())}rs(e,t){const s=Date.now();return!(e<s-t)&&(!(e>s)||(Rs(`Detected an update time that is in the future: ${e} > ${s}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){typeof this.window?.addEventListener=="function"&&(this.Bi=()=>{this.cs();const e=/(?:Version|Mobile)\/1[456]/;wS()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{const t=this.Ki?.getItem(this._s(e))!==null;return Ye(Yl,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(t){return Rs(Yl,"Failed to get zombied client id.",t),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){Rs("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Pm(r){return tr(r,Df)}function ag(r){return tr(r,Bu)}function cT(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ow{constructor(e,t,s,a){this.targetId=e,this.fromCache=t,this.Es=s,this.ds=a}static As(e,t){let s=Jt(),a=Jt();for(const l of t.docChanges)switch(l.type){case 0:s=s.add(l.doc.key);break;case 1:a=a.add(l.doc.key)}return new ow(e,t.fromCache,s,a)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dk{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dT{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return wS()?8:$S(Js())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,a){const l={result:null};return this.ys(e,t).next(c=>{l.result=c}).next(()=>{if(!l.result)return this.ws(e,t,a,s).next(c=>{l.result=c})}).next(()=>{if(l.result)return;const c=new Dk;return this.Ss(e,t,c).next(u=>{if(l.result=u,this.Vs)return this.bs(e,t,c,u.size)})}).next(()=>l.result)}bs(e,t,s,a){return s.documentReadCount<this.fs?(vu()<=cn.DEBUG&&Ye("QueryEngine","SDK will not create cache indexes for query:",Nu(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Se.resolve()):(vu()<=cn.DEBUG&&Ye("QueryEngine","Query:",Nu(t),"scans",s.documentReadCount,"local documents and returns",a,"documents as results."),s.documentReadCount>this.gs*a?(vu()<=cn.DEBUG&&Ye("QueryEngine","The SDK decides to create cache indexes for query:",Nu(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ti(t))):Se.resolve())}ys(e,t){if(p_(t))return Se.resolve(null);let s=Ti(t);return this.indexManager.getIndexType(e,s).next(a=>a===0?null:(t.limit!==null&&a===1&&(t=zg(t,null,"F"),s=Ti(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next(l=>{const c=Jt(...l);return this.ps.getDocuments(e,c).next(u=>this.indexManager.getMinOffset(e,s).next(m=>{const p=this.Ds(t,u);return this.Cs(t,p,c,m.readTime)?this.ys(e,zg(t,null,"F")):this.vs(e,p,t,m)}))})))}ws(e,t,s,a){return p_(t)||a.isEqual(jt.min())?Se.resolve(null):this.ps.getDocuments(e,s).next(l=>{const c=this.Ds(t,l);return this.Cs(t,c,s,a)?Se.resolve(null):(vu()<=cn.DEBUG&&Ye("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),Nu(t)),this.vs(e,c,t,FS(a,Uu)).next(u=>u))})}Ds(e,t){let s=new On(vI(e));return t.forEach((a,l)=>{kf(e,l)&&(s=s.add(l))}),s}Cs(e,t,s,a){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const l=e.limitType==="F"?t.last():t.first();return!!l&&(l.hasPendingWrites||l.version.compareTo(a)>0)}Ss(e,t,s){return vu()<=cn.DEBUG&&Ye("QueryEngine","Using full collection scan to execute query:",Nu(t)),this.ps.getDocumentsMatchingQuery(e,t,Ci.min(),s)}vs(e,t,s,a){return this.ps.getDocumentsMatchingQuery(e,s,a).next(l=>(t.forEach(c=>{l=l.insert(c.key,c)}),l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lw="LocalStore",Rk=3e8;class Pk{constructor(e,t,s,a){this.persistence=e,this.Fs=t,this.serializer=a,this.Ms=new Kn(qt),this.xs=new ll(l=>Nd(l),Rf),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(s)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new lT(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function uT(r,e,t,s){return new Pk(r,e,t,s)}async function hT(r,e){const t=wt(r);return await t.persistence.runTransaction("Handle user change","readonly",s=>{let a;return t.mutationQueue.getAllMutationBatches(s).next(l=>(a=l,t.Bs(e),t.mutationQueue.getAllMutationBatches(s))).next(l=>{const c=[],u=[];let m=Jt();for(const p of a){c.push(p.batchId);for(const b of p.mutations)m=m.add(b.key)}for(const p of l){u.push(p.batchId);for(const b of p.mutations)m=m.add(b.key)}return t.localDocuments.getDocuments(s,m).next(p=>({Ls:p,removedBatchIds:c,addedBatchIds:u}))})})}function kk(r,e){const t=wt(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const a=e.batch.keys(),l=t.Ns.newChangeBuffer({trackRemovals:!0});return function(u,m,p,b){const w=p.batch,N=w.keys();let R=Se.resolve();return N.forEach(O=>{R=R.next(()=>b.getEntry(m,O)).next(G=>{const U=p.docVersions.get(O);vt(U!==null,48541),G.version.compareTo(U)<0&&(w.applyToRemoteDocument(G,p),G.isValidDocument()&&(G.setReadTime(p.commitVersion),b.addEntry(G)))})}),R.next(()=>u.mutationQueue.removeMutationBatch(m,w))}(t,s,e,l).next(()=>l.apply(s)).next(()=>t.mutationQueue.performConsistencyCheck(s)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(s,a,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(u){let m=Jt();for(let p=0;p<u.mutationResults.length;++p)u.mutationResults[p].transformResults.length>0&&(m=m.add(u.batch.mutations[p].key));return m}(e))).next(()=>t.localDocuments.getDocuments(s,a))})}function mT(r){const e=wt(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function Ok(r,e){const t=wt(r),s=e.snapshotVersion;let a=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",l=>{const c=t.Ns.newChangeBuffer({trackRemovals:!0});a=t.Ms;const u=[];e.targetChanges.forEach((b,w)=>{const N=a.get(w);if(!N)return;u.push(t.Pi.removeMatchingKeys(l,b.removedDocuments,w).next(()=>t.Pi.addMatchingKeys(l,b.addedDocuments,w)));let R=N.withSequenceNumber(l.currentSequenceNumber);e.targetMismatches.get(w)!==null?R=R.withResumeToken(Ps.EMPTY_BYTE_STRING,jt.min()).withLastLimboFreeSnapshotVersion(jt.min()):b.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(b.resumeToken,s)),a=a.insert(w,R),function(G,U,T){return G.resumeToken.approximateByteSize()===0||U.snapshotVersion.toMicroseconds()-G.snapshotVersion.toMicroseconds()>=Rk?!0:T.addedDocuments.size+T.modifiedDocuments.size+T.removedDocuments.size>0}(N,R,b)&&u.push(t.Pi.updateTargetData(l,R))});let m=Si(),p=Jt();if(e.documentUpdates.forEach(b=>{e.resolvedLimboDocuments.has(b)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(l,b))}),u.push(Mk(l,c,e.documentUpdates).next(b=>{m=b.ks,p=b.qs})),!s.isEqual(jt.min())){const b=t.Pi.getLastRemoteSnapshotVersion(l).next(w=>t.Pi.setTargetsMetadata(l,l.currentSequenceNumber,s));u.push(b)}return Se.waitFor(u).next(()=>c.apply(l)).next(()=>t.localDocuments.getLocalViewOfDocuments(l,m,p)).next(()=>m)}).then(l=>(t.Ms=a,l))}function Mk(r,e,t){let s=Jt(),a=Jt();return t.forEach(l=>s=s.add(l)),e.getEntries(r,s).next(l=>{let c=Si();return t.forEach((u,m)=>{const p=l.get(u);m.isFoundDocument()!==p.isFoundDocument()&&(a=a.add(u)),m.isNoDocument()&&m.version.isEqual(jt.min())?(e.removeEntry(u,m.readTime),c=c.insert(u,m)):!p.isValidDocument()||m.version.compareTo(p.version)>0||m.version.compareTo(p.version)===0&&p.hasPendingWrites?(e.addEntry(m),c=c.insert(u,m)):Ye(lw,"Ignoring outdated watch update for ",u,". Current version:",p.version," Watch version:",m.version)}),{ks:c,qs:a}})}function Lk(r,e){const t=wt(r);return t.persistence.runTransaction("Get next mutation batch","readonly",s=>(e===void 0&&(e=pd),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e)))}function Gg(r,e){const t=wt(r);return t.persistence.runTransaction("Allocate target","readwrite",s=>{let a;return t.Pi.getTargetData(s,e).next(l=>l?(a=l,Se.resolve(a)):t.Pi.allocateTargetId(s).next(c=>(a=new Qo(e,c,"TargetPurposeListen",s.currentSequenceNumber),t.Pi.addTargetData(s,a).next(()=>a))))}).then(s=>{const a=t.Ms.get(s.targetId);return(a===null||s.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(s.targetId,s),t.xs.set(e,s.targetId)),s})}async function Zu(r,e,t){const s=wt(r),a=s.Ms.get(e),l=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",l,c=>s.persistence.referenceDelegate.removeTarget(c,a))}catch(c){if(!wc(c))throw c;Ye(lw,`Failed to update sequence numbers for target ${e}: ${c}`)}s.Ms=s.Ms.remove(e),s.xs.delete(a.target)}function l0(r,e,t){const s=wt(r);let a=jt.min(),l=Jt();return s.persistence.runTransaction("Execute query","readwrite",c=>function(m,p,b){const w=wt(m),N=w.xs.get(b);return N!==void 0?Se.resolve(w.Ms.get(N)):w.Pi.getTargetData(p,b)}(s,c,Ti(e)).next(u=>{if(u)return a=u.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(c,u.targetId).next(m=>{l=m})}).next(()=>s.Fs.getDocumentsMatchingQuery(c,e,t?a:jt.min(),t?l:Jt())).next(u=>(gT(s,wI(e),u),{documents:u,Qs:l})))}function fT(r,e){const t=wt(r),s=wt(t.Pi),a=t.Ms.get(e);return a?Promise.resolve(a.target):t.persistence.runTransaction("Get target data","readonly",l=>s.At(l,e).next(c=>c?c.target:null))}function pT(r,e){const t=wt(r),s=t.Os.get(e)||jt.min();return t.persistence.runTransaction("Get new document changes","readonly",a=>t.Ns.getAllFromCollectionGroup(a,e,FS(s,Uu),Number.MAX_SAFE_INTEGER)).then(a=>(gT(t,e,a),a))}function gT(r,e,t){let s=r.Os.get(e)||jt.min();t.forEach((a,l)=>{l.readTime.compareTo(s)>0&&(s=l.readTime)}),r.Os.set(e,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xT="firestore_clients";function G_(r,e){return`${xT}_${r}_${e}`}const yT="firestore_mutations";function Q_(r,e,t){let s=`${yT}_${r}_${t}`;return e.isAuthenticated()&&(s+=`_${e.uid}`),s}const bT="firestore_targets";function vb(r,e){return`${bT}_${r}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ha="SharedClientState";class Qg{constructor(e,t,s,a){this.user=e,this.batchId=t,this.state=s,this.error=a}static Ws(e,t,s){const a=JSON.parse(s);let l,c=typeof a=="object"&&["pending","acknowledged","rejected"].indexOf(a.state)!==-1&&(a.error===void 0||typeof a.error=="object");return c&&a.error&&(c=typeof a.error.message=="string"&&typeof a.error.code=="string",c&&(l=new tt(a.error.code,a.error.message))),c?new Qg(e,t,a.state,l):(Rs(Ha,`Failed to parse mutation state for ID '${t}': ${s}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ym{constructor(e,t,s){this.targetId=e,this.state=t,this.error=s}static Ws(e,t){const s=JSON.parse(t);let a,l=typeof s=="object"&&["not-current","current","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return l&&s.error&&(l=typeof s.error.message=="string"&&typeof s.error.code=="string",l&&(a=new tt(s.error.code,s.error.message))),l?new Ym(e,s.state,a):(Rs(Ha,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Wg{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const s=JSON.parse(t);let a=typeof s=="object"&&s.activeTargetIds instanceof Array,l=Q0();for(let c=0;a&&c<s.activeTargetIds.length;++c)a=BS(s.activeTargetIds[c]),l=l.add(s.activeTargetIds[c]);return a?new Wg(e,l):(Rs(Ha,`Failed to parse client data for instance '${e}': ${t}`),null)}}class cw{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new cw(t.clientId,t.onlineState):(Rs(Ha,`Failed to parse online state: ${e}`),null)}}class c0{constructor(){this.activeTargetIds=Q0()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Nb{constructor(e,t,s,a,l){this.window=e,this.Mi=t,this.persistenceKey=s,this.Js=a,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new Kn(qt),this.started=!1,this.Xs=[];const c=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=l,this.eo=G_(this.persistenceKey,this.Js),this.no=function(m){return`firestore_sequence_number_${m}`}(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new c0),this.ro=new RegExp(`^${xT}_${c}_([^_]*)$`),this.io=new RegExp(`^${yT}_${c}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${bT}_${c}_(\\d+)$`),this.oo=function(m){return`firestore_online_state_${m}`}(this.persistenceKey),this._o=function(m){return`firestore_bundle_loaded_v2_${m}`}(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const s of e){if(s===this.Js)continue;const a=this.getItem(G_(this.persistenceKey,s));if(a){const l=Wg.Ws(s,a);l&&(this.Zs=this.Zs.insert(l.clientId,l))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const s=this.uo(t);s&&this.co(s)}for(const s of this.Xs)this.Ys(s);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach((s,a)=>{a.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,s){this.ho(e,t,s),this.Po(e)}addLocalQueryTarget(e,t=!0){let s="not-current";if(this.isActiveQueryTarget(e)){const a=this.storage.getItem(vb(this.persistenceKey,e));if(a){const l=Ym.Ws(e,a);l&&(s=l.state)}}return t&&this.To.zs(e),this.ao(),s}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(vb(this.persistenceKey,e))}updateQueryState(e,t,s){this.Io(e,t,s)}handleUserChange(e,t,s){t.forEach(a=>{this.Po(a)}),this.currentUser=e,s.forEach(a=>{this.addPendingMutation(a)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return Ye(Ha,"READ",e,t),t}setItem(e,t){Ye(Ha,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){Ye(Ha,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(Ye(Ha,"EVENT",t.key,t.newValue),t.key===this.eo)return void Rs("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const s=this.Ro(t.key);return this.Vo(s,null)}{const s=this.mo(t.key,t.newValue);if(s)return this.Vo(s.clientId,s)}}else if(this.io.test(t.key)){if(t.newValue!==null){const s=this.fo(t.key,t.newValue);if(s)return this.po(s)}}else if(this.so.test(t.key)){if(t.newValue!==null){const s=this.yo(t.key,t.newValue);if(s)return this.wo(s)}}else if(t.key===this.oo){if(t.newValue!==null){const s=this.uo(t.newValue);if(s)return this.co(s)}}else if(t.key===this.no){const s=function(l){let c=ii.ce;if(l!=null)try{const u=JSON.parse(l);vt(typeof u=="number",30636,{So:l}),c=u}catch(u){Rs(Ha,"Failed to read sequence number from WebStorage",u)}return c}(t.newValue);s!==ii.ce&&this.sequenceNumberHandler(s)}else if(t.key===this._o){const s=this.bo(t.newValue);await Promise.all(s.map(a=>this.syncEngine.Do(a)))}}}else this.Xs.push(t)})}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,s){const a=new Qg(this.currentUser,e,t,s),l=Q_(this.persistenceKey,this.currentUser,e);this.setItem(l,a.Gs())}Po(e){const t=Q_(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,s){const a=vb(this.persistenceKey,e),l=new Ym(e,t,s);this.setItem(a,l.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const s=this.Ro(e);return Wg.Ws(s,t)}fo(e,t){const s=this.io.exec(e),a=Number(s[1]),l=s[2]!==void 0?s[2]:null;return Qg.Ws(new cr(l),a,t)}yo(e,t){const s=this.so.exec(e),a=Number(s[1]);return Ym.Ws(a,t)}uo(e){return cw.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);Ye(Ha,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const s=t?this.Zs.insert(e,t):this.Zs.remove(e),a=this.lo(this.Zs),l=this.lo(s),c=[],u=[];return l.forEach(m=>{a.has(m)||c.push(m)}),a.forEach(m=>{l.has(m)||u.push(m)}),this.syncEngine.Fo(c,u).then(()=>{this.Zs=s})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=Q0();return e.forEach((s,a)=>{t=t.unionWith(a.activeTargetIds)}),t}}class wT{constructor(){this.Mo=new c0,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,s){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new c0,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fk{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W_="ConnectivityMonitor";class K_{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Ye(W_,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Ye(W_,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let og=null;function d0(){return og===null?og=function(){return 268435456+Math.round(2147483648*Math.random())}():og++,"0x"+og.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jb="RestConnection",Uk={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Vk{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),a=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${s}/databases/${a}`,this.Wo=this.databaseId.database===hf?`project_id=${s}`:`project_id=${s}&database_id=${a}`}Go(e,t,s,a,l){const c=d0(),u=this.zo(e,t.toUriEncodedString());Ye(jb,`Sending RPC '${e}' ${c}:`,u,s);const m={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(m,a,l);const{host:p}=new URL(u),b=ol(p);return this.Jo(e,u,m,s,b).then(w=>(Ye(jb,`Received RPC '${e}' ${c}: `,w),w),w=>{throw Lu(jb,`RPC '${e}' ${c} failed with error: `,w,"url: ",u,"request:",s),w})}Ho(e,t,s,a,l,c){return this.Go(e,t,s,a,l)}jo(e,t,s){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+oh}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((a,l)=>e[l]=a),s&&s.headers.forEach((a,l)=>e[l]=a)}zo(e,t){const s=Uk[e];return`${this.Uo}/v1/${t}:${s}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zk{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rr="WebChannelConnection";class $k extends Vk{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,s,a,l){const c=d0();return new Promise((u,m)=>{const p=new TS;p.setWithCredentials(!0),p.listenOnce(CS.COMPLETE,()=>{try{switch(p.getLastErrorCode()){case fg.NO_ERROR:const w=p.getResponseJson();Ye(Rr,`XHR for RPC '${e}' ${c} received:`,JSON.stringify(w)),u(w);break;case fg.TIMEOUT:Ye(Rr,`RPC '${e}' ${c} timed out`),m(new tt(Fe.DEADLINE_EXCEEDED,"Request time out"));break;case fg.HTTP_ERROR:const N=p.getStatus();if(Ye(Rr,`RPC '${e}' ${c} failed with status:`,N,"response text:",p.getResponseText()),N>0){let R=p.getResponseJson();Array.isArray(R)&&(R=R[0]);const O=R?.error;if(O&&O.status&&O.message){const G=function(T){const ee=T.toLowerCase().replace(/_/g,"-");return Object.values(Fe).indexOf(ee)>=0?ee:Fe.UNKNOWN}(O.status);m(new tt(G,O.message))}else m(new tt(Fe.UNKNOWN,"Server responded with status "+p.getStatus()))}else m(new tt(Fe.UNAVAILABLE,"Connection failed."));break;default:gt(9055,{l_:e,streamId:c,h_:p.getLastErrorCode(),P_:p.getLastError()})}}finally{Ye(Rr,`RPC '${e}' ${c} completed.`)}});const b=JSON.stringify(a);Ye(Rr,`RPC '${e}' ${c} sending request:`,a),p.send(t,"POST",b,s,15)})}T_(e,t,s){const a=d0(),l=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],c=RS(),u=DS(),m={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},p=this.longPollingOptions.timeoutSeconds;p!==void 0&&(m.longPollingTimeout=Math.round(1e3*p)),this.useFetchStreams&&(m.useFetchStreams=!0),this.jo(m.initMessageHeaders,t,s),m.encodeInitMessageHeaders=!0;const b=l.join("");Ye(Rr,`Creating RPC '${e}' stream ${a}: ${b}`,m);const w=c.createWebChannel(b,m);this.I_(w);let N=!1,R=!1;const O=new zk({Yo:U=>{R?Ye(Rr,`Not sending because RPC '${e}' stream ${a} is closed:`,U):(N||(Ye(Rr,`Opening RPC '${e}' stream ${a} transport.`),w.open(),N=!0),Ye(Rr,`RPC '${e}' stream ${a} sending:`,U),w.send(U))},Zo:()=>w.close()}),G=(U,T,ee)=>{U.listen(T,Z=>{try{ee(Z)}catch(ie){setTimeout(()=>{throw ie},0)}})};return G(w,Lm.EventType.OPEN,()=>{R||(Ye(Rr,`RPC '${e}' stream ${a} transport opened.`),O.o_())}),G(w,Lm.EventType.CLOSE,()=>{R||(R=!0,Ye(Rr,`RPC '${e}' stream ${a} transport closed`),O.a_(),this.E_(w))}),G(w,Lm.EventType.ERROR,U=>{R||(R=!0,Lu(Rr,`RPC '${e}' stream ${a} transport errored. Name:`,U.name,"Message:",U.message),O.a_(new tt(Fe.UNAVAILABLE,"The operation could not be completed")))}),G(w,Lm.EventType.MESSAGE,U=>{if(!R){const T=U.data[0];vt(!!T,16349);const ee=T,Z=ee?.error||ee[0]?.error;if(Z){Ye(Rr,`RPC '${e}' stream ${a} received error:`,Z);const ie=Z.status;let X=function(B){const k=Vs[B];if(k!==void 0)return kI(k)}(ie),pe=Z.message;X===void 0&&(X=Fe.INTERNAL,pe="Unknown error status: "+ie+" with message "+Z.message),R=!0,O.a_(new tt(X,pe)),w.close()}else Ye(Rr,`RPC '${e}' stream ${a} received:`,T),O.u_(T)}}),G(u,AS.STAT_EVENT,U=>{U.stat===$b.PROXY?Ye(Rr,`RPC '${e}' stream ${a} detected buffering proxy`):U.stat===$b.NOPROXY&&Ye(Rr,`RPC '${e}' stream ${a} detected no buffering proxy`)}),setTimeout(()=>{O.__()},0),O}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vT(){return typeof window<"u"?window:null}function _g(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sx(r){return new QP(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dw{constructor(e,t,s=1e3,a=1.5,l=6e4){this.Mi=e,this.timerId=t,this.d_=s,this.A_=a,this.R_=l,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),a=Math.max(0,t-s);a>0&&Ye("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,a,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y_="PersistentStream";class NT{constructor(e,t,s,a,l,c,u,m){this.Mi=e,this.S_=s,this.b_=a,this.connection=l,this.authCredentialsProvider=c,this.appCheckCredentialsProvider=u,this.listener=m,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new dw(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===Fe.RESOURCE_EXHAUSTED?(Rs(t.toString()),Rs("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===Fe.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,a])=>{this.D_===t&&this.G_(s,a)},s=>{e(()=>{const a=new tt(Fe.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(a)})})}G_(e,t){const s=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{s(()=>this.listener.Xo())}),this.stream.t_(()=>{s(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(a=>{s(()=>this.z_(a))}),this.stream.onMessage(a=>{s(()=>++this.F_==1?this.J_(a):this.onNext(a))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return Ye(Y_,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(Ye(Y_,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Bk extends NT{constructor(e,t,s,a,l,c){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,a,c),this.serializer=l}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=XP(this.serializer,e),s=function(l){if(!("targetChange"in l))return jt.min();const c=l.targetChange;return c.targetIds&&c.targetIds.length?jt.min():c.readTime?dr(c.readTime):jt.min()}(e);return this.listener.H_(t,s)}Y_(e){const t={};t.database=s0(this.serializer),t.addTarget=function(l,c){let u;const m=c.target;if(u=Ug(m)?{documents:$I(l,m)}:{query:BI(l,m).ft},u.targetId=c.targetId,c.resumeToken.approximateByteSize()>0){u.resumeToken=LI(l,c.resumeToken);const p=t0(l,c.expectedCount);p!==null&&(u.expectedCount=p)}else if(c.snapshotVersion.compareTo(jt.min())>0){u.readTime=Ju(l,c.snapshotVersion.toTimestamp());const p=t0(l,c.expectedCount);p!==null&&(u.expectedCount=p)}return u}(this.serializer,e);const s=ZP(this.serializer,e);s&&(t.labels=s),this.q_(t)}Z_(e){const t={};t.database=s0(this.serializer),t.removeTarget=e,this.q_(t)}}class qk extends NT{constructor(e,t,s,a,l,c){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,a,c),this.serializer=l}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return vt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,vt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){vt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=JP(e.writeResults,e.commitTime),s=dr(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=s0(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(s=>yf(this.serializer,s))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hk{}class Gk extends Hk{constructor(e,t,s,a){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=a,this.ia=!1}sa(){if(this.ia)throw new tt(Fe.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,s,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([l,c])=>this.connection.Go(e,n0(t,s),a,l,c)).catch(l=>{throw l.name==="FirebaseError"?(l.code===Fe.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new tt(Fe.UNKNOWN,l.toString())})}Ho(e,t,s,a,l){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([c,u])=>this.connection.Ho(e,n0(t,s),a,c,u,l)).catch(c=>{throw c.name==="FirebaseError"?(c.code===Fe.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new tt(Fe.UNKNOWN,c.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class Qk{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Rs(t),this.aa=!1):Ye("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sd="RemoteStore";class Wk{constructor(e,t,s,a,l){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=l,this.Aa.Oo(c=>{s.enqueueAndForget(async()=>{Ad(this)&&(Ye(Sd,"Restarting streams for network reachability change."),await async function(m){const p=wt(m);p.Ea.add(4),await Lf(p),p.Ra.set("Unknown"),p.Ea.delete(4),await Ix(p)}(this))})}),this.Ra=new Qk(s,a)}}async function Ix(r){if(Ad(r))for(const e of r.da)await e(!0)}async function Lf(r){for(const e of r.da)await e(!1)}function Tx(r,e){const t=wt(r);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),mw(t)?hw(t):hh(t).O_()&&uw(t,e))}function eh(r,e){const t=wt(r),s=hh(t);t.Ia.delete(e),s.O_()&&jT(t,e),t.Ia.size===0&&(s.O_()?s.L_():Ad(t)&&t.Ra.set("Unknown"))}function uw(r,e){if(r.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(jt.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}hh(r).Y_(e)}function jT(r,e){r.Va.Ue(e),hh(r).Z_(e)}function hw(r){r.Va=new BP({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),At:e=>r.Ia.get(e)||null,ht:()=>r.datastore.serializer.databaseId}),hh(r).start(),r.Ra.ua()}function mw(r){return Ad(r)&&!hh(r).x_()&&r.Ia.size>0}function Ad(r){return wt(r).Ea.size===0}function _T(r){r.Va=void 0}async function Kk(r){r.Ra.set("Online")}async function Yk(r){r.Ia.forEach((e,t)=>{uw(r,e)})}async function Xk(r,e){_T(r),mw(r)?(r.Ra.ha(e),hw(r)):r.Ra.set("Unknown")}async function Jk(r,e,t){if(r.Ra.set("Online"),e instanceof MI&&e.state===2&&e.cause)try{await async function(a,l){const c=l.cause;for(const u of l.targetIds)a.Ia.has(u)&&(await a.remoteSyncer.rejectListen(u,c),a.Ia.delete(u),a.Va.removeTarget(u))}(r,e)}catch(s){Ye(Sd,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await Kg(r,s)}else if(e instanceof Ng?r.Va.Ze(e):e instanceof OI?r.Va.st(e):r.Va.tt(e),!t.isEqual(jt.min()))try{const s=await mT(r.localStore);t.compareTo(s)>=0&&await function(l,c){const u=l.Va.Tt(c);return u.targetChanges.forEach((m,p)=>{if(m.resumeToken.approximateByteSize()>0){const b=l.Ia.get(p);b&&l.Ia.set(p,b.withResumeToken(m.resumeToken,c))}}),u.targetMismatches.forEach((m,p)=>{const b=l.Ia.get(m);if(!b)return;l.Ia.set(m,b.withResumeToken(Ps.EMPTY_BYTE_STRING,b.snapshotVersion)),jT(l,m);const w=new Qo(b.target,m,p,b.sequenceNumber);uw(l,w)}),l.remoteSyncer.applyRemoteEvent(u)}(r,t)}catch(s){Ye(Sd,"Failed to raise snapshot:",s),await Kg(r,s)}}async function Kg(r,e,t){if(!wc(e))throw e;r.Ea.add(1),await Lf(r),r.Ra.set("Offline"),t||(t=()=>mT(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{Ye(Sd,"Retrying IndexedDB access"),await t(),r.Ea.delete(1),await Ix(r)})}function ET(r,e){return e().catch(t=>Kg(r,t,e))}async function uh(r){const e=wt(r),t=xc(e);let s=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:pd;for(;Zk(e);)try{const a=await Lk(e.localStore,s);if(a===null){e.Ta.length===0&&t.L_();break}s=a.batchId,eO(e,a)}catch(a){await Kg(e,a)}ST(e)&&IT(e)}function Zk(r){return Ad(r)&&r.Ta.length<10}function eO(r,e){r.Ta.push(e);const t=xc(r);t.O_()&&t.X_&&t.ea(e.mutations)}function ST(r){return Ad(r)&&!xc(r).x_()&&r.Ta.length>0}function IT(r){xc(r).start()}async function tO(r){xc(r).ra()}async function nO(r){const e=xc(r);for(const t of r.Ta)e.ea(t.mutations)}async function sO(r,e,t){const s=r.Ta.shift(),a=J0.from(s,e,t);await ET(r,()=>r.remoteSyncer.applySuccessfulWrite(a)),await uh(r)}async function rO(r,e){e&&xc(r).X_&&await async function(s,a){if(function(c){return PI(c)&&c!==Fe.ABORTED}(a.code)){const l=s.Ta.shift();xc(s).B_(),await ET(s,()=>s.remoteSyncer.rejectFailedWrite(l.batchId,a)),await uh(s)}}(r,e),ST(r)&&IT(r)}async function X_(r,e){const t=wt(r);t.asyncQueue.verifyOperationInProgress(),Ye(Sd,"RemoteStore received new credentials");const s=Ad(t);t.Ea.add(3),await Lf(t),s&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Ix(t)}async function u0(r,e){const t=wt(r);e?(t.Ea.delete(2),await Ix(t)):e||(t.Ea.add(2),await Lf(t),t.Ra.set("Unknown"))}function hh(r){return r.ma||(r.ma=function(t,s,a){const l=wt(t);return l.sa(),new Bk(s,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,a)}(r.datastore,r.asyncQueue,{Xo:Kk.bind(null,r),t_:Yk.bind(null,r),r_:Xk.bind(null,r),H_:Jk.bind(null,r)}),r.da.push(async e=>{e?(r.ma.B_(),mw(r)?hw(r):r.Ra.set("Unknown")):(await r.ma.stop(),_T(r))})),r.ma}function xc(r){return r.fa||(r.fa=function(t,s,a){const l=wt(t);return l.sa(),new qk(s,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,a)}(r.datastore,r.asyncQueue,{Xo:()=>Promise.resolve(),t_:tO.bind(null,r),r_:rO.bind(null,r),ta:nO.bind(null,r),na:sO.bind(null,r)}),r.da.push(async e=>{e?(r.fa.B_(),await uh(r)):(await r.fa.stop(),r.Ta.length>0&&(Ye(Sd,`Stopping write stream with ${r.Ta.length} pending writes`),r.Ta=[]))})),r.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fw{constructor(e,t,s,a,l){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=a,this.removalCallback=l,this.deferred=new xa,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(c=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,a,l){const c=Date.now()+s,u=new fw(e,t,c,a,l);return u.start(s),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new tt(Fe.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function pw(r,e){if(Rs("AsyncQueue",`${e}: ${r}`),wc(r))return new tt(Fe.UNAVAILABLE,`${e}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Au{static emptySet(e){return new Au(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||at.comparator(t.key,s.key):(t,s)=>at.comparator(t.key,s.key),this.keyedMap=Fm(),this.sortedSet=new Kn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,s)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Au)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const a=t.getNext().key,l=s.getNext().key;if(!a.isEqual(l))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new Au;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J_{constructor(){this.ga=new Kn(at.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):gt(63341,{Rt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,s)=>{e.push(s)}),e}}class th{constructor(e,t,s,a,l,c,u,m,p){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=a,this.mutatedKeys=l,this.fromCache=c,this.syncStateChanged=u,this.excludesMetadataChanges=m,this.hasCachedResults=p}static fromInitialDocuments(e,t,s,a,l){const c=[];return t.forEach(u=>{c.push({type:0,doc:u})}),new th(e,t,Au.emptySet(t),c,s,a,!0,!1,l)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&wx(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let a=0;a<t.length;a++)if(t[a].type!==s[a].type||!t[a].doc.isEqual(s[a].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iO{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class aO{constructor(){this.queries=Z_(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const a=wt(t),l=a.queries;a.queries=Z_(),l.forEach((c,u)=>{for(const m of u.Sa)m.onError(s)})})(this,new tt(Fe.ABORTED,"Firestore shutting down"))}}function Z_(){return new ll(r=>bI(r),wx)}async function gw(r,e){const t=wt(r);let s=3;const a=e.query;let l=t.queries.get(a);l?!l.ba()&&e.Da()&&(s=2):(l=new iO,s=e.Da()?0:1);try{switch(s){case 0:l.wa=await t.onListen(a,!0);break;case 1:l.wa=await t.onListen(a,!1);break;case 2:await t.onFirstRemoteStoreListen(a)}}catch(c){const u=pw(c,`Initialization of query '${Nu(e.query)}' failed`);return void e.onError(u)}t.queries.set(a,l),l.Sa.push(e),e.va(t.onlineState),l.wa&&e.Fa(l.wa)&&yw(t)}async function xw(r,e){const t=wt(r),s=e.query;let a=3;const l=t.queries.get(s);if(l){const c=l.Sa.indexOf(e);c>=0&&(l.Sa.splice(c,1),l.Sa.length===0?a=e.Da()?0:1:!l.ba()&&e.Da()&&(a=2))}switch(a){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function oO(r,e){const t=wt(r);let s=!1;for(const a of e){const l=a.query,c=t.queries.get(l);if(c){for(const u of c.Sa)u.Fa(a)&&(s=!0);c.wa=a}}s&&yw(t)}function lO(r,e,t){const s=wt(r),a=s.queries.get(e);if(a)for(const l of a.Sa)l.onError(t);s.queries.delete(e)}function yw(r){r.Ca.forEach(e=>{e.next()})}var h0,eE;(eE=h0||(h0={})).Ma="default",eE.Cache="cache";class bw{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const a of e.docChanges)a.type!==3&&s.push(a);e=new th(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.qa||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=th.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==h0.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TT{constructor(e){this.key=e}}class CT{constructor(e){this.key=e}}class cO{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Jt(),this.mutatedKeys=Jt(),this.eu=vI(e),this.tu=new Au(this.eu)}get nu(){return this.Ya}ru(e,t){const s=t?t.iu:new J_,a=t?t.tu:this.tu;let l=t?t.mutatedKeys:this.mutatedKeys,c=a,u=!1;const m=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,p=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal((b,w)=>{const N=a.get(b),R=kf(this.query,w)?w:null,O=!!N&&this.mutatedKeys.has(N.key),G=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations);let U=!1;N&&R?N.data.isEqual(R.data)?O!==G&&(s.track({type:3,doc:R}),U=!0):this.su(N,R)||(s.track({type:2,doc:R}),U=!0,(m&&this.eu(R,m)>0||p&&this.eu(R,p)<0)&&(u=!0)):!N&&R?(s.track({type:0,doc:R}),U=!0):N&&!R&&(s.track({type:1,doc:N}),U=!0,(m||p)&&(u=!0)),U&&(R?(c=c.add(R),l=G?l.add(b):l.delete(b)):(c=c.delete(b),l=l.delete(b)))}),this.query.limit!==null)for(;c.size>this.query.limit;){const b=this.query.limitType==="F"?c.last():c.first();c=c.delete(b.key),l=l.delete(b.key),s.track({type:1,doc:b})}return{tu:c,iu:s,Cs:u,mutatedKeys:l}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,a){const l=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const c=e.iu.ya();c.sort((b,w)=>function(R,O){const G=U=>{switch(U){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return gt(20277,{Rt:U})}};return G(R)-G(O)}(b.type,w.type)||this.eu(b.doc,w.doc)),this.ou(s),a=a??!1;const u=t&&!a?this._u():[],m=this.Xa.size===0&&this.current&&!a?1:0,p=m!==this.Za;return this.Za=m,c.length!==0||p?{snapshot:new th(this.query,e.tu,l,c,e.mutatedKeys,m===0,p,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new J_,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Jt(),this.tu.forEach(s=>{this.uu(s.key)&&(this.Xa=this.Xa.add(s.key))});const t=[];return e.forEach(s=>{this.Xa.has(s)||t.push(new CT(s))}),this.Xa.forEach(s=>{e.has(s)||t.push(new TT(s))}),t}cu(e){this.Ya=e.Qs,this.Xa=Jt();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return th.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const mh="SyncEngine";class dO{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class uO{constructor(e){this.key=e,this.hu=!1}}class hO{constructor(e,t,s,a,l,c){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=a,this.currentUser=l,this.maxConcurrentLimboResolutions=c,this.Pu={},this.Tu=new ll(u=>bI(u),wx),this.Iu=new Map,this.Eu=new Set,this.du=new Kn(at.comparator),this.Au=new Map,this.Ru=new rw,this.Vu={},this.mu=new Map,this.fu=Ed.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function mO(r,e,t=!0){const s=Cx(r);let a;const l=s.Tu.get(e);return l?(s.sharedClientState.addLocalQueryTarget(l.targetId),a=l.view.lu()):a=await AT(s,e,t,!0),a}async function fO(r,e){const t=Cx(r);await AT(t,e,!0,!1)}async function AT(r,e,t,s){const a=await Gg(r.localStore,Ti(e)),l=a.targetId,c=r.sharedClientState.addLocalQueryTarget(l,t);let u;return s&&(u=await ww(r,e,l,c==="current",a.resumeToken)),r.isPrimaryClient&&t&&Tx(r.remoteStore,a),u}async function ww(r,e,t,s,a){r.pu=(w,N,R)=>async function(G,U,T,ee){let Z=U.view.ru(T);Z.Cs&&(Z=await l0(G.localStore,U.query,!1).then(({documents:H})=>U.view.ru(H,Z)));const ie=ee&&ee.targetChanges.get(U.targetId),X=ee&&ee.targetMismatches.get(U.targetId)!=null,pe=U.view.applyChanges(Z,G.isPrimaryClient,ie,X);return m0(G,U.targetId,pe.au),pe.snapshot}(r,w,N,R);const l=await l0(r.localStore,e,!0),c=new cO(e,l.Qs),u=c.ru(l.documents),m=Mf.createSynthesizedTargetChangeForCurrentChange(t,s&&r.onlineState!=="Offline",a),p=c.applyChanges(u,r.isPrimaryClient,m);m0(r,t,p.au);const b=new dO(e,t,c);return r.Tu.set(e,b),r.Iu.has(t)?r.Iu.get(t).push(e):r.Iu.set(t,[e]),p.snapshot}async function pO(r,e,t){const s=wt(r),a=s.Tu.get(e),l=s.Iu.get(a.targetId);if(l.length>1)return s.Iu.set(a.targetId,l.filter(c=>!wx(c,e))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(a.targetId),s.sharedClientState.isActiveQueryTarget(a.targetId)||await Zu(s.localStore,a.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(a.targetId),t&&eh(s.remoteStore,a.targetId),nh(s,a.targetId)}).catch(bc)):(nh(s,a.targetId),await Zu(s.localStore,a.targetId,!0))}async function gO(r,e){const t=wt(r),s=t.Tu.get(e),a=t.Iu.get(s.targetId);t.isPrimaryClient&&a.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),eh(t.remoteStore,s.targetId))}async function xO(r,e,t){const s=_w(r);try{const a=await function(c,u){const m=wt(c),p=In.now(),b=u.reduce((R,O)=>R.add(O.key),Jt());let w,N;return m.persistence.runTransaction("Locally write mutations","readwrite",R=>{let O=Si(),G=Jt();return m.Ns.getEntries(R,b).next(U=>{O=U,O.forEach((T,ee)=>{ee.isValidDocument()||(G=G.add(T))})}).next(()=>m.localDocuments.getOverlayedDocuments(R,O)).next(U=>{w=U;const T=[];for(const ee of u){const Z=UP(ee,w.get(ee.key).overlayedDocument);Z!=null&&T.push(new cl(ee.key,Z,cI(Z.value.mapValue),as.exists(!0)))}return m.mutationQueue.addMutationBatch(R,p,T,u)}).next(U=>{N=U;const T=U.applyToLocalDocumentSet(w,G);return m.documentOverlayCache.saveOverlays(R,U.batchId,T)})}).then(()=>({batchId:N.batchId,changes:jI(w)}))}(s.localStore,e);s.sharedClientState.addPendingMutation(a.batchId),function(c,u,m){let p=c.Vu[c.currentUser.toKey()];p||(p=new Kn(qt)),p=p.insert(u,m),c.Vu[c.currentUser.toKey()]=p}(s,a.batchId,t),await Nc(s,a.changes),await uh(s.remoteStore)}catch(a){const l=pw(a,"Failed to persist write");t.reject(l)}}async function DT(r,e){const t=wt(r);try{const s=await Ok(t.localStore,e);e.targetChanges.forEach((a,l)=>{const c=t.Au.get(l);c&&(vt(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1,22616),a.addedDocuments.size>0?c.hu=!0:a.modifiedDocuments.size>0?vt(c.hu,14607):a.removedDocuments.size>0&&(vt(c.hu,42227),c.hu=!1))}),await Nc(t,s,e)}catch(s){await bc(s)}}function tE(r,e,t){const s=wt(r);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const a=[];s.Tu.forEach((l,c)=>{const u=c.view.va(e);u.snapshot&&a.push(u.snapshot)}),function(c,u){const m=wt(c);m.onlineState=u;let p=!1;m.queries.forEach((b,w)=>{for(const N of w.Sa)N.va(u)&&(p=!0)}),p&&yw(m)}(s.eventManager,e),a.length&&s.Pu.H_(a),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function yO(r,e,t){const s=wt(r);s.sharedClientState.updateQueryState(e,"rejected",t);const a=s.Au.get(e),l=a&&a.key;if(l){let c=new Kn(at.comparator);c=c.insert(l,is.newNoDocument(l,jt.min()));const u=Jt().add(l),m=new Of(jt.min(),new Map,new Kn(qt),c,u);await DT(s,m),s.du=s.du.remove(l),s.Au.delete(e),jw(s)}else await Zu(s.localStore,e,!1).then(()=>nh(s,e,t)).catch(bc)}async function bO(r,e){const t=wt(r),s=e.batch.batchId;try{const a=await kk(t.localStore,e);Nw(t,s,null),vw(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),await Nc(t,a)}catch(a){await bc(a)}}async function wO(r,e,t){const s=wt(r);try{const a=await function(c,u){const m=wt(c);return m.persistence.runTransaction("Reject batch","readwrite-primary",p=>{let b;return m.mutationQueue.lookupMutationBatch(p,u).next(w=>(vt(w!==null,37113),b=w.keys(),m.mutationQueue.removeMutationBatch(p,w))).next(()=>m.mutationQueue.performConsistencyCheck(p)).next(()=>m.documentOverlayCache.removeOverlaysForBatchId(p,b,u)).next(()=>m.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(p,b)).next(()=>m.localDocuments.getDocuments(p,b))})}(s.localStore,e);Nw(s,e,t),vw(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),await Nc(s,a)}catch(a){await bc(a)}}function vw(r,e){(r.mu.get(e)||[]).forEach(t=>{t.resolve()}),r.mu.delete(e)}function Nw(r,e,t){const s=wt(r);let a=s.Vu[s.currentUser.toKey()];if(a){const l=a.get(e);l&&(t?l.reject(t):l.resolve(),a=a.remove(e)),s.Vu[s.currentUser.toKey()]=a}}function nh(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const s of r.Iu.get(e))r.Tu.delete(s),t&&r.Pu.yu(s,t);r.Iu.delete(e),r.isPrimaryClient&&r.Ru.jr(e).forEach(s=>{r.Ru.containsKey(s)||RT(r,s)})}function RT(r,e){r.Eu.delete(e.path.canonicalString());const t=r.du.get(e);t!==null&&(eh(r.remoteStore,t),r.du=r.du.remove(e),r.Au.delete(t),jw(r))}function m0(r,e,t){for(const s of t)s instanceof TT?(r.Ru.addReference(s.key,e),vO(r,s)):s instanceof CT?(Ye(mh,"Document no longer in limbo: "+s.key),r.Ru.removeReference(s.key,e),r.Ru.containsKey(s.key)||RT(r,s.key)):gt(19791,{wu:s})}function vO(r,e){const t=e.key,s=t.path.canonicalString();r.du.get(t)||r.Eu.has(s)||(Ye(mh,"New document in limbo: "+t),r.Eu.add(s),jw(r))}function jw(r){for(;r.Eu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){const e=r.Eu.values().next().value;r.Eu.delete(e);const t=new at(Nn.fromString(e)),s=r.fu.next();r.Au.set(s,new uO(t)),r.du=r.du.insert(t,s),Tx(r.remoteStore,new Qo(Ti(Pf(t.path)),s,"TargetPurposeLimboResolution",ii.ce))}}async function Nc(r,e,t){const s=wt(r),a=[],l=[],c=[];s.Tu.isEmpty()||(s.Tu.forEach((u,m)=>{c.push(s.pu(m,e,t).then(p=>{if((p||t)&&s.isPrimaryClient){const b=p?!p.fromCache:t?.targetChanges.get(m.targetId)?.current;s.sharedClientState.updateQueryState(m.targetId,b?"current":"not-current")}if(p){a.push(p);const b=ow.As(m.targetId,p);l.push(b)}}))}),await Promise.all(c),s.Pu.H_(a),await async function(m,p){const b=wt(m);try{await b.persistence.runTransaction("notifyLocalViewChanges","readwrite",w=>Se.forEach(p,N=>Se.forEach(N.Es,R=>b.persistence.referenceDelegate.addReference(w,N.targetId,R)).next(()=>Se.forEach(N.ds,R=>b.persistence.referenceDelegate.removeReference(w,N.targetId,R)))))}catch(w){if(!wc(w))throw w;Ye(lw,"Failed to update sequence numbers: "+w)}for(const w of p){const N=w.targetId;if(!w.fromCache){const R=b.Ms.get(N),O=R.snapshotVersion,G=R.withLastLimboFreeSnapshotVersion(O);b.Ms=b.Ms.insert(N,G)}}}(s.localStore,l))}async function NO(r,e){const t=wt(r);if(!t.currentUser.isEqual(e)){Ye(mh,"User change. New user:",e.toKey());const s=await hT(t.localStore,e);t.currentUser=e,function(l,c){l.mu.forEach(u=>{u.forEach(m=>{m.reject(new tt(Fe.CANCELLED,c))})}),l.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await Nc(t,s.Ls)}}function jO(r,e){const t=wt(r),s=t.Au.get(e);if(s&&s.hu)return Jt().add(s.key);{let a=Jt();const l=t.Iu.get(e);if(!l)return a;for(const c of l){const u=t.Tu.get(c);a=a.unionWith(u.view.nu)}return a}}async function _O(r,e){const t=wt(r),s=await l0(t.localStore,e.query,!0),a=e.view.cu(s);return t.isPrimaryClient&&m0(t,e.targetId,a.au),a}async function EO(r,e){const t=wt(r);return pT(t.localStore,e).then(s=>Nc(t,s))}async function SO(r,e,t,s){const a=wt(r),l=await function(u,m){const p=wt(u),b=wt(p.mutationQueue);return p.persistence.runTransaction("Lookup mutation documents","readonly",w=>b.er(w,m).next(N=>N?p.localDocuments.getDocuments(w,N):Se.resolve(null)))}(a.localStore,e);l!==null?(t==="pending"?await uh(a.remoteStore):t==="acknowledged"||t==="rejected"?(Nw(a,e,s||null),vw(a,e),function(u,m){wt(wt(u).mutationQueue).ir(m)}(a.localStore,e)):gt(6720,"Unknown batchState",{Su:t}),await Nc(a,l)):Ye(mh,"Cannot apply mutation batch with id: "+e)}async function IO(r,e){const t=wt(r);if(Cx(t),_w(t),e===!0&&t.gu!==!0){const s=t.sharedClientState.getAllActiveQueryTargets(),a=await nE(t,s.toArray());t.gu=!0,await u0(t.remoteStore,!0);for(const l of a)Tx(t.remoteStore,l)}else if(e===!1&&t.gu!==!1){const s=[];let a=Promise.resolve();t.Iu.forEach((l,c)=>{t.sharedClientState.isLocalQueryTarget(c)?s.push(c):a=a.then(()=>(nh(t,c),Zu(t.localStore,c,!0))),eh(t.remoteStore,c)}),await a,await nE(t,s),function(c){const u=wt(c);u.Au.forEach((m,p)=>{eh(u.remoteStore,p)}),u.Ru.Jr(),u.Au=new Map,u.du=new Kn(at.comparator)}(t),t.gu=!1,await u0(t.remoteStore,!1)}}async function nE(r,e,t){const s=wt(r),a=[],l=[];for(const c of e){let u;const m=s.Iu.get(c);if(m&&m.length!==0){u=await Gg(s.localStore,Ti(m[0]));for(const p of m){const b=s.Tu.get(p),w=await _O(s,b);w.snapshot&&l.push(w.snapshot)}}else{const p=await fT(s.localStore,c);u=await Gg(s.localStore,p),await ww(s,PT(p),c,!1,u.resumeToken)}a.push(u)}return s.Pu.H_(l),a}function PT(r){return xI(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function TO(r){return function(t){return wt(wt(t).persistence).Ts()}(wt(r).localStore)}async function CO(r,e,t,s){const a=wt(r);if(a.gu)return void Ye(mh,"Ignoring unexpected query state notification.");const l=a.Iu.get(e);if(l&&l.length>0)switch(t){case"current":case"not-current":{const c=await pT(a.localStore,wI(l[0])),u=Of.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ps.EMPTY_BYTE_STRING);await Nc(a,c,u);break}case"rejected":await Zu(a.localStore,e,!0),nh(a,e,s);break;default:gt(64155,t)}}async function AO(r,e,t){const s=Cx(r);if(s.gu){for(const a of e){if(s.Iu.has(a)&&s.sharedClientState.isActiveQueryTarget(a)){Ye(mh,"Adding an already active target "+a);continue}const l=await fT(s.localStore,a),c=await Gg(s.localStore,l);await ww(s,PT(l),c.targetId,!1,c.resumeToken),Tx(s.remoteStore,c)}for(const a of t)s.Iu.has(a)&&await Zu(s.localStore,a,!1).then(()=>{eh(s.remoteStore,a),nh(s,a)}).catch(bc)}}function Cx(r){const e=wt(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=DT.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=jO.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=yO.bind(null,e),e.Pu.H_=oO.bind(null,e.eventManager),e.Pu.yu=lO.bind(null,e.eventManager),e}function _w(r){const e=wt(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=bO.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=wO.bind(null,e),e}class bf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Sx(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return uT(this.persistence,new dT,e.initialUser,this.serializer)}Cu(e){return new iw(Ex.mi,this.serializer)}Du(e){return new wT}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}bf.provider={build:()=>new bf};class DO extends bf{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){vt(this.persistence.referenceDelegate instanceof Hg,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new rT(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Pr.withCacheSize(this.cacheSizeBytes):Pr.DEFAULT;return new iw(s=>Hg.mi(s,t),this.serializer)}}class kT extends bf{constructor(e,t,s){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=s,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await _w(this.xu.syncEngine),await uh(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return uT(this.persistence,new dT,e.initialUser,this.serializer)}Fu(e,t){const s=this.persistence.referenceDelegate.garbageCollector;return new rT(s,e.asyncQueue,t)}Mu(e,t){const s=new BR(t,this.persistence);return new $R(e.asyncQueue,s)}Cu(e){const t=cT(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),s=this.cacheSizeBytes!==void 0?Pr.withCacheSize(this.cacheSizeBytes):Pr.DEFAULT;return new aw(this.synchronizeTabs,t,e.clientId,s,e.asyncQueue,vT(),_g(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new wT}}class RO extends kT{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof Nb&&(this.sharedClientState.syncEngine={Co:SO.bind(null,t),vo:CO.bind(null,t),Fo:AO.bind(null,t),Ts:TO.bind(null,t),Do:EO.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async s=>{await IO(this.xu.syncEngine,s),this.gcScheduler&&(s&&!this.gcScheduler.started?this.gcScheduler.start():s||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(s&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():s||this.indexBackfillerScheduler.stop())})}Du(e){const t=vT();if(!Nb.v(t))throw new tt(Fe.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const s=cT(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Nb(t,e.asyncQueue,s,e.clientId,e.initialUser)}}class wf{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>tE(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=NO.bind(null,this.syncEngine),await u0(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new aO}()}createDatastore(e){const t=Sx(e.databaseInfo.databaseId),s=function(l){return new $k(l)}(e.databaseInfo);return function(l,c,u,m){return new Gk(l,c,u,m)}(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return function(s,a,l,c,u){return new Wk(s,a,l,c,u)}(this.localStore,this.datastore,e.asyncQueue,t=>tE(this.syncEngine,t,0),function(){return K_.v()?new K_:new Fk}())}createSyncEngine(e,t){return function(a,l,c,u,m,p,b){const w=new hO(a,l,c,u,m,p);return b&&(w.gu=!0),w}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await async function(t){const s=wt(t);Ye(Sd,"RemoteStore shutting down."),s.Ea.add(5),await Lf(s),s.Aa.shutdown(),s.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}wf.provider={build:()=>new wf};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ew{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Rs("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PO{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new tt(Fe.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(a,l){const c=wt(a),u={documents:l.map(w=>xf(c.serializer,w))},m=await c.Ho("BatchGetDocuments",c.serializer.databaseId,Nn.emptyPath(),u,l.length),p=new Map;m.forEach(w=>{const N=YP(c.serializer,w);p.set(N.key.toString(),N)});const b=[];return l.forEach(w=>{const N=p.get(w.toString());vt(!!N,55234,{key:w}),b.push(N)}),b}(this.datastore,e);return t.forEach(s=>this.recordVersion(s)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(s){this.lastTransactionError=s}this.writtenDocs.add(e.toString())}delete(e){this.write(new dh(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,s)=>{const a=at.fromPath(s);this.mutations.push(new Y0(a,this.precondition(a)))}),await async function(s,a){const l=wt(s),c={writes:a.map(u=>yf(l.serializer,u))};await l.Go("Commit",l.serializer.databaseId,Nn.emptyPath(),c)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw gt(50498,{Gu:e.constructor.name});t=jt.min()}const s=this.readVersions.get(e.key.toString());if(s){if(!t.isEqual(s))throw new tt(Fe.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(jt.min())?as.exists(!1):as.updateTime(t):as.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(jt.min()))throw new tt(Fe.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return as.updateTime(t)}return as.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kO{constructor(e,t,s,a,l){this.asyncQueue=e,this.datastore=t,this.options=s,this.updateFunction=a,this.deferred=l,this.zu=s.maxAttempts,this.M_=new dw(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(async()=>{const e=new PO(this.datastore),t=this.Hu(e);t&&t.then(s=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(s)}).catch(a=>{this.Yu(a)}))}).catch(s=>{this.Yu(s)})})}Hu(e){try{const t=this.updateFunction(e);return!Af(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!PI(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yc="FirestoreClient";class OO{constructor(e,t,s,a,l){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=a,this.user=cr.UNAUTHENTICATED,this.clientId=M0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=l,this.authCredentials.start(s,async c=>{Ye(yc,"Received user=",c.uid),await this.authCredentialListener(c),this.user=c}),this.appCheckCredentials.start(s,c=>(Ye(yc,"Received new app check token=",c),this.appCheckCredentialListener(c,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new xa;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=pw(t,"Failed to shutdown persistence");e.reject(s)}}),e.promise}}async function _b(r,e){r.asyncQueue.verifyOperationInProgress(),Ye(yc,"Initializing OfflineComponentProvider");const t=r.configuration;await e.initialize(t);let s=t.initialUser;r.setCredentialChangeListener(async a=>{s.isEqual(a)||(await hT(e.localStore,a),s=a)}),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}async function sE(r,e){r.asyncQueue.verifyOperationInProgress();const t=await MO(r);Ye(yc,"Initializing OnlineComponentProvider"),await e.initialize(t,r.configuration),r.setCredentialChangeListener(s=>X_(e.remoteStore,s)),r.setAppCheckTokenChangeListener((s,a)=>X_(e.remoteStore,a)),r._onlineComponents=e}async function MO(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){Ye(yc,"Using user provided OfflineComponentProvider");try{await _b(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(a){return a.name==="FirebaseError"?a.code===Fe.FAILED_PRECONDITION||a.code===Fe.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11}(t))throw t;Lu("Error using user provided cache. Falling back to memory cache: "+t),await _b(r,new bf)}}else Ye(yc,"Using default OfflineComponentProvider"),await _b(r,new DO(void 0));return r._offlineComponents}async function Sw(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(Ye(yc,"Using user provided OnlineComponentProvider"),await sE(r,r._uninitializedComponentsProvider._online)):(Ye(yc,"Using default OnlineComponentProvider"),await sE(r,new wf))),r._onlineComponents}function LO(r){return Sw(r).then(e=>e.syncEngine)}function FO(r){return Sw(r).then(e=>e.datastore)}async function Yg(r){const e=await Sw(r),t=e.eventManager;return t.onListen=mO.bind(null,e.syncEngine),t.onUnlisten=pO.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=fO.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=gO.bind(null,e.syncEngine),t}function UO(r,e,t={}){const s=new xa;return r.asyncQueue.enqueueAndForget(async()=>function(l,c,u,m,p){const b=new Ew({next:N=>{b.Nu(),c.enqueueAndForget(()=>xw(l,w));const R=N.docs.has(u);!R&&N.fromCache?p.reject(new tt(Fe.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&N.fromCache&&m&&m.source==="server"?p.reject(new tt(Fe.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):p.resolve(N)},error:N=>p.reject(N)}),w=new bw(Pf(u.path),b,{includeMetadataChanges:!0,qa:!0});return gw(l,w)}(await Yg(r),r.asyncQueue,e,t,s)),s.promise}function VO(r,e,t={}){const s=new xa;return r.asyncQueue.enqueueAndForget(async()=>function(l,c,u,m,p){const b=new Ew({next:N=>{b.Nu(),c.enqueueAndForget(()=>xw(l,w)),N.fromCache&&m.source==="server"?p.reject(new tt(Fe.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):p.resolve(N)},error:N=>p.reject(N)}),w=new bw(u,b,{includeMetadataChanges:!0,qa:!0});return gw(l,w)}(await Yg(r),r.asyncQueue,e,t,s)),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OT(r){const e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rE=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MT="firestore.googleapis.com",iE=!0;class aE{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new tt(Fe.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=MT,this.ssl=iE}else this.host=e.host,this.ssl=e.ssl??iE;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=ZI;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<sT)throw new tt(Fe.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}FR("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=OT(e.experimentalLongPollingOptions??{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new tt(Fe.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new tt(Fe.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new tt(Fe.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(s,a){return s.timeoutSeconds===a.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ax{constructor(e,t,s,a){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new aE({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new tt(Fe.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new tt(Fe.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new aE(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new TR;switch(s.type){case"firstParty":return new RR(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new tt(Fe.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const s=rE.get(t);s&&(Ye("ComponentProvider","Removing Datastore"),rE.delete(t),s.terminate())}(this),Promise.resolve()}}function zO(r,e,t,s={}){r=kr(r,Ax);const a=ol(e),l=r._getSettings(),c={...l,emulatorOptions:r._getEmulatorOptions()},u=`${e}:${t}`;a&&(hx(`https://${u}`),A0("Firestore",!0)),l.host!==MT&&l.host!==u&&Lu("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const m={...l,host:u,ssl:a,emulatorOptions:s};if(!mc(m,c)&&(r._setSettings(m),s.mockUserToken)){let p,b;if(typeof s.mockUserToken=="string")p=s.mockUserToken,b=cr.MOCK_USER;else{p=yS(s.mockUserToken,r._app?.options.projectId);const w=s.mockUserToken.sub||s.mockUserToken.user_id;if(!w)throw new tt(Fe.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");b=new cr(w)}r._authCredentials=new CR(new kS(p,b))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dl{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new dl(this.firestore,e,this._query)}}class ms{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new uc(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ms(this.firestore,e,this._key)}toJSON(){return{type:ms._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(Cf(t,ms._jsonSchema))return new ms(e,s||null,new at(Nn.fromString(t.referencePath)))}}ms._jsonSchemaVersion="firestore/documentReference/1.0",ms._jsonSchema={type:zs("string",ms._jsonSchemaVersion),referencePath:zs("string")};class uc extends dl{constructor(e,t,s){super(e,t,Pf(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ms(this.firestore,null,new at(e))}withConverter(e){return new uc(this.firestore,e,this._path)}}function dt(r,e,...t){if(r=zn(r),MS("collection","path",e),r instanceof Ax){const s=Nn.fromString(e,...t);return Yj(s),new uc(r,null,s)}{if(!(r instanceof ms||r instanceof uc))throw new tt(Fe.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=r._path.child(Nn.fromString(e,...t));return Yj(s),new uc(r.firestore,null,s)}}function ht(r,e,...t){if(r=zn(r),arguments.length===1&&(e=M0.newId()),MS("doc","path",e),r instanceof Ax){const s=Nn.fromString(e,...t);return Kj(s),new ms(r,null,new at(s))}{if(!(r instanceof ms||r instanceof uc))throw new tt(Fe.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=r._path.child(Nn.fromString(e,...t));return Kj(s),new ms(r.firestore,r instanceof uc?r.converter:null,new at(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oE="AsyncQueue";class lE{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new dw(this,"async_queue_retry"),this._c=()=>{const s=_g();s&&Ye(oE,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=_g();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=_g();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new xa;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!wc(e))throw e;Ye(oE,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(s=>{throw this.nc=s,this.rc=!1,Rs("INTERNAL UNHANDLED ERROR: ",cE(s)),s}).then(s=>(this.rc=!1,s))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const a=fw.createAndSchedule(this,e,t,s,l=>this.hc(l));return this.tc.push(a),a}uc(){this.nc&&gt(47125,{Pc:cE(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,s)=>t.targetTimeMs-s.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function cE(r){let e=r.message||"";return r.stack&&(e=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dE(r){return function(t,s){if(typeof t!="object"||t===null)return!1;const a=t;for(const l of s)if(l in a&&typeof a[l]=="function")return!0;return!1}(r,["next","error","complete"])}class ya extends Ax{constructor(e,t,s,a){super(e,t,s,a),this.type="firestore",this._queue=new lE,this._persistenceKey=a?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new lE(e),this._firestoreClient=void 0,await e}}}function $O(r,e,t){t||(t=hf);const s=Tf(r,"firestore");if(s.isInitialized(t)){const a=s.getImmediate({identifier:t}),l=s.getOptions(t);if(mc(l,e))return a;throw new tt(Fe.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new tt(Fe.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<sT)throw new tt(Fe.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&ol(e.host)&&hx(e.host),s.initialize({options:e,instanceIdentifier:t})}function BO(r,e){const t=typeof r=="object"?r:k0(),s=typeof r=="string"?r:hf,a=Tf(t,"firestore").getImmediate({identifier:s});if(!a._initialized){const l=pS("firestore");l&&zO(a,...l)}return a}function fh(r){if(r._terminated)throw new tt(Fe.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||qO(r),r._firestoreClient}function qO(r){const e=r._freezeSettings(),t=function(a,l,c,u){return new xP(a,l,c,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,OT(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)}(r._databaseId,r._app?.options.appId||"",r._persistenceKey,e);r._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(r._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),r._firestoreClient=new OO(r._authCredentials,r._appCheckCredentials,r._queue,t,r._componentsProvider&&function(a){const l=a?._online.build();return{_offline:a?._offline.build(l),_online:l}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ei{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ei(Ps.fromBase64String(e))}catch(t){throw new tt(Fe.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ei(Ps.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Ei._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Cf(e,Ei._jsonSchema))return Ei.fromBase64String(e.bytes)}}Ei._jsonSchemaVersion="firestore/bytes/1.0",Ei._jsonSchema={type:zs("string",Ei._jsonSchemaVersion),bytes:zs("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ph{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new tt(Fe.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new us(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ff{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ya{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new tt(Fe.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new tt(Fe.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return qt(this._lat,e._lat)||qt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ya._jsonSchemaVersion}}static fromJSON(e){if(Cf(e,Ya._jsonSchema))return new Ya(e.latitude,e.longitude)}}Ya._jsonSchemaVersion="firestore/geoPoint/1.0",Ya._jsonSchema={type:zs("string",Ya._jsonSchemaVersion),latitude:zs("number"),longitude:zs("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xa{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(s,a){if(s.length!==a.length)return!1;for(let l=0;l<s.length;++l)if(s[l]!==a[l])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Xa._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Cf(e,Xa._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new Xa(e.vectorValues);throw new tt(Fe.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Xa._jsonSchemaVersion="firestore/vectorValue/1.0",Xa._jsonSchema={type:zs("string",Xa._jsonSchemaVersion),vectorValues:zs("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HO=/^__.*__$/;class GO{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new cl(e,this.data,this.fieldMask,t,this.fieldTransforms):new ch(e,this.data,t,this.fieldTransforms)}}class LT{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return new cl(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function FT(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw gt(40011,{Ac:r})}}class Iw{constructor(e,t,s,a,l,c){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=a,l===void 0&&this.Rc(),this.fieldTransforms=l||[],this.fieldMask=c||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Iw({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.gc(e),s}yc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.Rc(),s}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Xg(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(FT(this.Ac)&&HO.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class QO{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||Sx(e)}Cc(e,t,s,a=!1){return new Iw({Ac:e,methodName:t,Dc:s,path:us.emptyPath(),fc:!1,bc:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function gh(r){const e=r._freezeSettings(),t=Sx(r._databaseId);return new QO(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Dx(r,e,t,s,a,l={}){const c=r.Cc(l.merge||l.mergeFields?2:0,e,t,a);Rw("Data must be an object, but it was:",c,s);const u=UT(s,c);let m,p;if(l.merge)m=new ai(c.fieldMask),p=c.fieldTransforms;else if(l.mergeFields){const b=[];for(const w of l.mergeFields){const N=f0(e,w,t);if(!c.contains(N))throw new tt(Fe.INVALID_ARGUMENT,`Field '${N}' is specified in your field mask but missing from your input data.`);zT(b,N)||b.push(N)}m=new ai(b),p=c.fieldTransforms.filter(w=>m.covers(w.field))}else m=null,p=c.fieldTransforms;return new GO(new jr(u),m,p)}class Rx extends Ff{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Rx}}class Tw extends Ff{_toFieldTransform(e){return new K0(e.path,new Wu)}isEqual(e){return e instanceof Tw}}class Cw extends Ff{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new Xu(e.serializer,SI(e.serializer,this.Fc));return new K0(e.path,t)}isEqual(e){return e instanceof Cw&&this.Fc===e.Fc}}function Aw(r,e,t,s){const a=r.Cc(1,e,t);Rw("Data must be an object, but it was:",a,s);const l=[],c=jr.empty();vc(s,(m,p)=>{const b=Pw(e,m,t);p=zn(p);const w=a.yc(b);if(p instanceof Rx)l.push(b);else{const N=Uf(p,w);N!=null&&(l.push(b),c.set(b,N))}});const u=new ai(l);return new LT(c,u,a.fieldTransforms)}function Dw(r,e,t,s,a,l){const c=r.Cc(1,e,t),u=[f0(e,s,t)],m=[a];if(l.length%2!=0)throw new tt(Fe.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let N=0;N<l.length;N+=2)u.push(f0(e,l[N])),m.push(l[N+1]);const p=[],b=jr.empty();for(let N=u.length-1;N>=0;--N)if(!zT(p,u[N])){const R=u[N];let O=m[N];O=zn(O);const G=c.yc(R);if(O instanceof Rx)p.push(R);else{const U=Uf(O,G);U!=null&&(p.push(R),b.set(R,U))}}const w=new ai(p);return new LT(b,w,c.fieldTransforms)}function WO(r,e,t,s=!1){return Uf(t,r.Cc(s?4:3,e))}function Uf(r,e){if(VT(r=zn(r)))return Rw("Unsupported field value:",e,r),UT(r,e);if(r instanceof Ff)return function(s,a){if(!FT(a.Ac))throw a.Sc(`${s._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Sc(`${s._methodName}() is not currently supported inside arrays`);const l=s._toFieldTransform(a);l&&a.fieldTransforms.push(l)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(s,a){const l=[];let c=0;for(const u of s){let m=Uf(u,a.wc(c));m==null&&(m={nullValue:"NULL_VALUE"}),l.push(m),c++}return{arrayValue:{values:l}}}(r,e)}return function(s,a){if((s=zn(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return SI(a.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const l=In.fromDate(s);return{timestampValue:Ju(a.serializer,l)}}if(s instanceof In){const l=new In(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:Ju(a.serializer,l)}}if(s instanceof Ya)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Ei)return{bytesValue:LI(a.serializer,s._byteString)};if(s instanceof ms){const l=a.databaseId,c=s.firestore._databaseId;if(!c.isEqual(l))throw a.Sc(`Document reference is for database ${c.projectId}/${c.database} but should be for database ${l.projectId}/${l.database}`);return{referenceValue:tw(s.firestore._databaseId||a.databaseId,s._key.path)}}if(s instanceof Xa)return function(c,u){return{mapValue:{fields:{[q0]:{stringValue:H0},[qu]:{arrayValue:{values:c.toArray().map(p=>{if(typeof p!="number")throw u.Sc("VectorValues must only contain numeric values.");return W0(u.serializer,p)})}}}}}}(s,a);throw a.Sc(`Unsupported field value: ${mx(s)}`)}(r,e)}function UT(r,e){const t={};return eI(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):vc(r,(s,a)=>{const l=Uf(a,e.mc(s));l!=null&&(t[s]=l)}),{mapValue:{fields:t}}}function VT(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof In||r instanceof Ya||r instanceof Ei||r instanceof ms||r instanceof Ff||r instanceof Xa)}function Rw(r,e,t){if(!VT(t)||!LS(t)){const s=mx(t);throw s==="an object"?e.Sc(r+" a custom object"):e.Sc(r+" "+s)}}function f0(r,e,t){if((e=zn(e))instanceof ph)return e._internalPath;if(typeof e=="string")return Pw(r,e);throw Xg("Field path arguments must be of type string or ",r,!1,void 0,t)}const KO=new RegExp("[~\\*/\\[\\]]");function Pw(r,e,t){if(e.search(KO)>=0)throw Xg(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new ph(...e.split("."))._internalPath}catch{throw Xg(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function Xg(r,e,t,s,a){const l=s&&!s.isEmpty(),c=a!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let m="";return(l||c)&&(m+=" (found",l&&(m+=` in field ${s}`),c&&(m+=` in document ${a}`),m+=")"),new tt(Fe.INVALID_ARGUMENT,u+r+m)}function zT(r,e){return r.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jg{constructor(e,t,s,a,l){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=a,this._converter=l}get id(){return this._key.path.lastSegment()}get ref(){return new ms(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new YO(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Px("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class YO extends Jg{data(){return super.data()}}function Px(r,e){return typeof e=="string"?Pw(r,e):e instanceof ph?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $T(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new tt(Fe.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class kw{}class Ow extends kw{}function Gt(r,e,...t){let s=[];e instanceof kw&&s.push(e),s=s.concat(t),function(l){const c=l.filter(m=>m instanceof Mw).length,u=l.filter(m=>m instanceof kx).length;if(c>1||c>0&&u>0)throw new tt(Fe.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const a of s)r=a._apply(r);return r}class kx extends Ow{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new kx(e,t,s)}_apply(e){const t=this._parse(e);return BT(e._query,t),new dl(e.firestore,e.converter,e0(e._query,t))}_parse(e){const t=gh(e.firestore);return function(l,c,u,m,p,b,w){let N;if(p.isKeyField()){if(b==="array-contains"||b==="array-contains-any")throw new tt(Fe.INVALID_ARGUMENT,`Invalid Query. You can't perform '${b}' queries on documentId().`);if(b==="in"||b==="not-in"){hE(w,b);const O=[];for(const G of w)O.push(uE(m,l,G));N={arrayValue:{values:O}}}else N=uE(m,l,w)}else b!=="in"&&b!=="not-in"&&b!=="array-contains-any"||hE(w,b),N=WO(u,c,w,b==="in"||b==="not-in");return dn.create(p,b,N)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Sn(r,e,t){const s=e,a=Px("where",r);return kx._create(a,s,t)}class Mw extends kw{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Mw(e,t)}_parse(e){const t=this._queryConstraints.map(s=>s._parse(e)).filter(s=>s.getFilters().length>0);return t.length===1?t[0]:kn.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(a,l){let c=a;const u=l.getFlattenedFilters();for(const m of u)BT(c,m),c=e0(c,m)}(e._query,t),new dl(e.firestore,e.converter,e0(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Lw extends Ow{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Lw(e,t)}_apply(e){const t=function(a,l,c){if(a.startAt!==null)throw new tt(Fe.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(a.endAt!==null)throw new tt(Fe.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new gf(l,c)}(e._query,this._field,this._direction);return new dl(e.firestore,e.converter,function(a,l){const c=a.explicitOrderBy.concat([l]);return new lh(a.path,a.collectionGroup,c,a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}(e._query,t))}}function ps(r,e="asc"){const t=e,s=Px("orderBy",r);return Lw._create(s,t)}class Fw extends Ow{constructor(e,t,s){super(),this.type=e,this._limit=t,this._limitType=s}static _create(e,t,s){return new Fw(e,t,s)}_apply(e){return new dl(e.firestore,e.converter,zg(e._query,this._limit,this._limitType))}}function XO(r){return UR("limit",r),Fw._create("limit",r,"F")}function uE(r,e,t){if(typeof(t=zn(t))=="string"){if(t==="")throw new tt(Fe.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!yI(e)&&t.indexOf("/")!==-1)throw new tt(Fe.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const s=e.path.child(Nn.fromString(t));if(!at.isDocumentKey(s))throw new tt(Fe.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return ff(r,new at(s))}if(t instanceof ms)return ff(r,t._key);throw new tt(Fe.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${mx(t)}.`)}function hE(r,e){if(!Array.isArray(r)||r.length===0)throw new tt(Fe.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function BT(r,e){const t=function(a,l){for(const c of a)for(const u of c.getFlattenedFilters())if(l.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new tt(Fe.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new tt(Fe.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class qT{convertValue(e,t="none"){switch(pc(e)){case 0:return null;case 1:return e.booleanValue;case 2:return rs(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(sl(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw gt(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return vc(e,(a,l)=>{s[a]=this.convertValue(l,t)}),s}convertVectorValue(e){const t=e.fields?.[qu].arrayValue?.values?.map(s=>rs(s.doubleValue));return new Xa(t)}convertGeoPoint(e){return new Ya(rs(e.latitude),rs(e.longitude))}convertArray(e,t){return(e.values||[]).map(s=>this.convertValue(s,t))}convertServerTimestamp(e,t){switch(t){case"previous":const s=yx(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(uf(e));default:return null}}convertTimestamp(e){const t=nl(e);return new In(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=Nn.fromString(e);vt(QI(s),9688,{name:e});const a=new vd(s.get(1),s.get(3)),l=new at(s.popFirst(5));return a.isEqual(t)||Rs(`Document ${l} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ox(r,e,t){let s;return s=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,s}class JO extends qT{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ei(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ms(this.firestore,null,t)}}class Tu{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hc extends Jg{constructor(e,t,s,a,l,c){super(e,t,s,a,c),this._firestore=e,this._firestoreImpl=e,this.metadata=l}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Eg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(Px("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new tt(Fe.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=hc._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}hc._jsonSchemaVersion="firestore/documentSnapshot/1.0",hc._jsonSchema={type:zs("string",hc._jsonSchemaVersion),bundleSource:zs("string","DocumentSnapshot"),bundleName:zs("string"),bundle:zs("string")};class Eg extends hc{data(e={}){return super.data(e)}}class xd{constructor(e,t,s,a){this._firestore=e,this._userDataWriter=t,this._snapshot=a,this.metadata=new Tu(a.hasPendingWrites,a.fromCache),this.query=s}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(s=>{e.call(t,new Eg(this._firestore,this._userDataWriter,s.key,s,new Tu(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new tt(Fe.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(a,l){if(a._snapshot.oldDocs.isEmpty()){let c=0;return a._snapshot.docChanges.map(u=>{const m=new Eg(a._firestore,a._userDataWriter,u.doc.key,u.doc,new Tu(a._snapshot.mutatedKeys.has(u.doc.key),a._snapshot.fromCache),a.query.converter);return u.doc,{type:"added",doc:m,oldIndex:-1,newIndex:c++}})}{let c=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(u=>l||u.type!==3).map(u=>{const m=new Eg(a._firestore,a._userDataWriter,u.doc.key,u.doc,new Tu(a._snapshot.mutatedKeys.has(u.doc.key),a._snapshot.fromCache),a.query.converter);let p=-1,b=-1;return u.type!==0&&(p=c.indexOf(u.doc.key),c=c.delete(u.doc.key)),u.type!==1&&(c=c.add(u.doc),b=c.indexOf(u.doc.key)),{type:ZO(u.type),doc:m,oldIndex:p,newIndex:b}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new tt(Fe.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=xd._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=M0.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],a=[];return this.docs.forEach(l=>{l._document!==null&&(t.push(l._document),s.push(this._userDataWriter.convertObjectMap(l._document.data.value.mapValue.fields,"previous")),a.push(l.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function ZO(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return gt(61501,{type:r})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hs(r){r=kr(r,ms);const e=kr(r.firestore,ya);return UO(fh(e),r._key).then(t=>HT(e,r,t))}xd._jsonSchemaVersion="firestore/querySnapshot/1.0",xd._jsonSchema={type:zs("string",xd._jsonSchemaVersion),bundleSource:zs("string","QuerySnapshot"),bundleName:zs("string"),bundle:zs("string")};class Mx extends qT{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ei(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ms(this.firestore,null,t)}}function At(r){r=kr(r,dl);const e=kr(r.firestore,ya),t=fh(e),s=new Mx(e);return $T(r._query),VO(t,r._query).then(a=>new xd(e,s,r,a))}function sh(r,e,t){r=kr(r,ms);const s=kr(r.firestore,ya),a=Ox(r.converter,e,t);return Vf(s,[Dx(gh(s),"setDoc",r._key,a,r.converter!==null,t).toMutation(r._key,as.none())])}function Zs(r,e,t,...s){r=kr(r,ms);const a=kr(r.firestore,ya),l=gh(a);let c;return c=typeof(e=zn(e))=="string"||e instanceof ph?Dw(l,"updateDoc",r._key,e,t,s):Aw(l,"updateDoc",r._key,e),Vf(a,[c.toMutation(r._key,as.exists(!0))])}function er(r){return Vf(kr(r.firestore,ya),[new dh(r._key,as.none())])}function Mr(r,e){const t=kr(r.firestore,ya),s=ht(r),a=Ox(r.converter,e);return Vf(t,[Dx(gh(r.firestore),"addDoc",s._key,a,r.converter!==null,{}).toMutation(s._key,as.exists(!1))]).then(()=>s)}function vf(r,...e){r=zn(r);let t={includeMetadataChanges:!1,source:"default"},s=0;typeof e[s]!="object"||dE(e[s])||(t=e[s++]);const a={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(dE(e[s])){const m=e[s];e[s]=m.next?.bind(m),e[s+1]=m.error?.bind(m),e[s+2]=m.complete?.bind(m)}let l,c,u;if(r instanceof ms)c=kr(r.firestore,ya),u=Pf(r._key.path),l={next:m=>{e[s]&&e[s](HT(c,r,m))},error:e[s+1],complete:e[s+2]};else{const m=kr(r,dl);c=kr(m.firestore,ya),u=m._query;const p=new Mx(c);l={next:b=>{e[s]&&e[s](new xd(c,p,m,b))},error:e[s+1],complete:e[s+2]},$T(r._query)}return function(p,b,w,N){const R=new Ew(N),O=new bw(b,R,w);return p.asyncQueue.enqueueAndForget(async()=>gw(await Yg(p),O)),()=>{R.Nu(),p.asyncQueue.enqueueAndForget(async()=>xw(await Yg(p),O))}}(fh(c),u,a,l)}function Vf(r,e){return function(s,a){const l=new xa;return s.asyncQueue.enqueueAndForget(async()=>xO(await LO(s),a,l)),l.promise}(fh(r),e)}function HT(r,e,t){const s=t.docs.get(e._key),a=new Mx(r);return new hc(r,a,e._key,s,new Tu(t.hasPendingWrites,t.fromCache),e.converter)}class eM{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=rM(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}function tM(r){return new eM(r)}class nM{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=wf.provider,this._offlineComponentProvider={build:t=>new kT(t,e?.cacheSizeBytes,this.forceOwnership)}}}class sM{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=wf.provider,this._offlineComponentProvider={build:t=>new RO(t,e?.cacheSizeBytes)}}}function rM(r){return new nM(r?.forceOwnership)}function iM(){return new sM}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aM={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oM{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=gh(e)}set(e,t,s){this._verifyNotCommitted();const a=ic(e,this._firestore),l=Ox(a.converter,t,s),c=Dx(this._dataReader,"WriteBatch.set",a._key,l,a.converter!==null,s);return this._mutations.push(c.toMutation(a._key,as.none())),this}update(e,t,s,...a){this._verifyNotCommitted();const l=ic(e,this._firestore);let c;return c=typeof(t=zn(t))=="string"||t instanceof ph?Dw(this._dataReader,"WriteBatch.update",l._key,t,s,a):Aw(this._dataReader,"WriteBatch.update",l._key,t),this._mutations.push(c.toMutation(l._key,as.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ic(e,this._firestore);return this._mutations=this._mutations.concat(new dh(t._key,as.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new tt(Fe.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ic(r,e){if((r=zn(r)).firestore!==e)throw new tt(Fe.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lM{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=gh(e)}get(e){const t=ic(e,this._firestore),s=new JO(this._firestore);return this._transaction.lookup([t._key]).then(a=>{if(!a||a.length!==1)return gt(24041);const l=a[0];if(l.isFoundDocument())return new Jg(this._firestore,s,l.key,l,t.converter);if(l.isNoDocument())return new Jg(this._firestore,s,t._key,null,t.converter);throw gt(18433,{doc:l})})}set(e,t,s){const a=ic(e,this._firestore),l=Ox(a.converter,t,s),c=Dx(this._dataReader,"Transaction.set",a._key,l,a.converter!==null,s);return this._transaction.set(a._key,c),this}update(e,t,s,...a){const l=ic(e,this._firestore);let c;return c=typeof(t=zn(t))=="string"||t instanceof ph?Dw(this._dataReader,"Transaction.update",l._key,t,s,a):Aw(this._dataReader,"Transaction.update",l._key,t),this._transaction.update(l._key,c),this}delete(e){const t=ic(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cM extends lM{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ic(e,this._firestore),s=new Mx(this._firestore);return super.get(e).then(a=>new hc(this._firestore,s,t._key,a._document,new Tu(!1,!1),t.converter))}}function p0(r,e,t){r=kr(r,ya);const s={...aM,...t};return function(l){if(l.maxAttempts<1)throw new tt(Fe.INVALID_ARGUMENT,"Max attempts must be at least 1")}(s),function(l,c,u){const m=new xa;return l.asyncQueue.enqueueAndForget(async()=>{const p=await FO(l);new kO(l.asyncQueue,p,u,c,m).ju()}),m.promise}(fh(r),a=>e(new cM(r,a)),s)}function _t(){return new Tw("serverTimestamp")}function GT(r){return new Cw("increment",r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zo(r){return fh(r=kr(r,ya)),new oM(r,e=>Vf(r,e))}(function(e,t=!0){(function(a){oh=a})(Cd),bd(new fc("firestore",(s,{instanceIdentifier:a,options:l})=>{const c=s.getProvider("app").getImmediate(),u=new ya(new AR(s.getProvider("auth-internal")),new PR(c,s.getProvider("app-check-internal")),function(p,b){if(!Object.prototype.hasOwnProperty.apply(p.options,["projectId"]))throw new tt(Fe.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vd(p.options.projectId,b)}(c,a),c);return l={useFetchStreams:t,...l},u._setSettings(l),u},"PUBLIC").setMultipleInstances(!0)),Ka(Hj,Gj,e),Ka(Hj,Gj,"esm2020")})();var dM="firebase",uM="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ka(dM,uM,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QT="firebasestorage.googleapis.com",WT="storageBucket",hM=120*1e3,mM=600*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vs extends ao{constructor(e,t,s=0){super(Eb(e),`Firebase Storage: ${t} (${Eb(e)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,vs.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Eb(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var ws;(function(r){r.UNKNOWN="unknown",r.OBJECT_NOT_FOUND="object-not-found",r.BUCKET_NOT_FOUND="bucket-not-found",r.PROJECT_NOT_FOUND="project-not-found",r.QUOTA_EXCEEDED="quota-exceeded",r.UNAUTHENTICATED="unauthenticated",r.UNAUTHORIZED="unauthorized",r.UNAUTHORIZED_APP="unauthorized-app",r.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",r.INVALID_CHECKSUM="invalid-checksum",r.CANCELED="canceled",r.INVALID_EVENT_NAME="invalid-event-name",r.INVALID_URL="invalid-url",r.INVALID_DEFAULT_BUCKET="invalid-default-bucket",r.NO_DEFAULT_BUCKET="no-default-bucket",r.CANNOT_SLICE_BLOB="cannot-slice-blob",r.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",r.NO_DOWNLOAD_URL="no-download-url",r.INVALID_ARGUMENT="invalid-argument",r.INVALID_ARGUMENT_COUNT="invalid-argument-count",r.APP_DELETED="app-deleted",r.INVALID_ROOT_OPERATION="invalid-root-operation",r.INVALID_FORMAT="invalid-format",r.INTERNAL_ERROR="internal-error",r.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(ws||(ws={}));function Eb(r){return"storage/"+r}function Uw(){const r="An unknown error occurred, please check the error payload for server response.";return new vs(ws.UNKNOWN,r)}function fM(r){return new vs(ws.OBJECT_NOT_FOUND,"Object '"+r+"' does not exist.")}function pM(r){return new vs(ws.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function gM(){const r="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new vs(ws.UNAUTHENTICATED,r)}function xM(){return new vs(ws.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function yM(r){return new vs(ws.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")}function bM(){return new vs(ws.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function wM(){return new vs(ws.CANCELED,"User canceled the upload/download.")}function vM(r){return new vs(ws.INVALID_URL,"Invalid URL '"+r+"'.")}function NM(r){return new vs(ws.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")}function jM(){return new vs(ws.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+WT+"' property when initializing the app?")}function _M(){return new vs(ws.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function EM(){return new vs(ws.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function SM(r){return new vs(ws.UNSUPPORTED_ENVIRONMENT,`${r} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function g0(r){return new vs(ws.INVALID_ARGUMENT,r)}function KT(){return new vs(ws.APP_DELETED,"The Firebase app was deleted.")}function IM(r){return new vs(ws.INVALID_ROOT_OPERATION,"The operation '"+r+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Xm(r,e){return new vs(ws.INVALID_FORMAT,"String does not match format '"+r+"': "+e)}function km(r){throw new vs(ws.INTERNAL_ERROR,"Internal error: "+r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ii{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let s;try{s=Ii.makeFromUrl(e,t)}catch{return new Ii(e,"")}if(s.path==="")return s;throw NM(e)}static makeFromUrl(e,t){let s=null;const a="([A-Za-z0-9.\\-_]+)";function l(ie){ie.path.charAt(ie.path.length-1)==="/"&&(ie.path_=ie.path_.slice(0,-1))}const c="(/(.*))?$",u=new RegExp("^gs://"+a+c,"i"),m={bucket:1,path:3};function p(ie){ie.path_=decodeURIComponent(ie.path)}const b="v[A-Za-z0-9_]+",w=t.replace(/[.]/g,"\\."),N="(/([^?#]*).*)?$",R=new RegExp(`^https?://${w}/${b}/b/${a}/o${N}`,"i"),O={bucket:1,path:3},G=t===QT?"(?:storage.googleapis.com|storage.cloud.google.com)":t,U="([^?#]*)",T=new RegExp(`^https?://${G}/${a}/${U}`,"i"),Z=[{regex:u,indices:m,postModify:l},{regex:R,indices:O,postModify:p},{regex:T,indices:{bucket:1,path:2},postModify:p}];for(let ie=0;ie<Z.length;ie++){const X=Z[ie],pe=X.regex.exec(e);if(pe){const H=pe[X.indices.bucket];let B=pe[X.indices.path];B||(B=""),s=new Ii(H,B),X.postModify(s);break}}if(s==null)throw vM(e);return s}}class TM{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CM(r,e,t){let s=1,a=null,l=null,c=!1,u=0;function m(){return u===2}let p=!1;function b(...U){p||(p=!0,e.apply(null,U))}function w(U){a=setTimeout(()=>{a=null,r(R,m())},U)}function N(){l&&clearTimeout(l)}function R(U,...T){if(p){N();return}if(U){N(),b.call(null,U,...T);return}if(m()||c){N(),b.call(null,U,...T);return}s<64&&(s*=2);let Z;u===1?(u=2,Z=0):Z=(s+Math.random())*1e3,w(Z)}let O=!1;function G(U){O||(O=!0,N(),!p&&(a!==null?(U||(u=2),clearTimeout(a),w(0)):U||(u=1)))}return w(0),l=setTimeout(()=>{c=!0,G(!0)},t),G}function AM(r){r(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DM(r){return r!==void 0}function RM(r){return typeof r=="object"&&!Array.isArray(r)}function Vw(r){return typeof r=="string"||r instanceof String}function mE(r){return zw()&&r instanceof Blob}function zw(){return typeof Blob<"u"}function fE(r,e,t,s){if(s<e)throw g0(`Invalid value for '${r}'. Expected ${e} or greater.`);if(s>t)throw g0(`Invalid value for '${r}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lx(r,e,t){let s=e;return t==null&&(s=`https://${e}`),`${t}://${s}/v0${r}`}function YT(r){const e=encodeURIComponent;let t="?";for(const s in r)if(r.hasOwnProperty(s)){const a=e(s)+"="+e(r[s]);t=t+a+"&"}return t=t.slice(0,-1),t}var yd;(function(r){r[r.NO_ERROR=0]="NO_ERROR",r[r.NETWORK_ERROR=1]="NETWORK_ERROR",r[r.ABORT=2]="ABORT"})(yd||(yd={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PM(r,e){const t=r>=500&&r<600,a=[408,429].indexOf(r)!==-1,l=e.indexOf(r)!==-1;return t||a||l}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kM{constructor(e,t,s,a,l,c,u,m,p,b,w,N=!0,R=!1){this.url_=e,this.method_=t,this.headers_=s,this.body_=a,this.successCodes_=l,this.additionalRetryCodes_=c,this.callback_=u,this.errorCallback_=m,this.timeout_=p,this.progressCallback_=b,this.connectionFactory_=w,this.retry=N,this.isUsingEmulator=R,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((O,G)=>{this.resolve_=O,this.reject_=G,this.start_()})}start_(){const e=(s,a)=>{if(a){s(!1,new lg(!1,null,!0));return}const l=this.connectionFactory_();this.pendingConnection_=l;const c=u=>{const m=u.loaded,p=u.lengthComputable?u.total:-1;this.progressCallback_!==null&&this.progressCallback_(m,p)};this.progressCallback_!==null&&l.addUploadProgressListener(c),l.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&l.removeUploadProgressListener(c),this.pendingConnection_=null;const u=l.getErrorCode()===yd.NO_ERROR,m=l.getStatus();if(!u||PM(m,this.additionalRetryCodes_)&&this.retry){const b=l.getErrorCode()===yd.ABORT;s(!1,new lg(!1,null,b));return}const p=this.successCodes_.indexOf(m)!==-1;s(!0,new lg(p,l))})},t=(s,a)=>{const l=this.resolve_,c=this.reject_,u=a.connection;if(a.wasSuccessCode)try{const m=this.callback_(u,u.getResponse());DM(m)?l(m):l()}catch(m){c(m)}else if(u!==null){const m=Uw();m.serverResponse=u.getErrorText(),this.errorCallback_?c(this.errorCallback_(u,m)):c(m)}else if(a.canceled){const m=this.appDelete_?KT():wM();c(m)}else{const m=bM();c(m)}};this.canceled_?t(!1,new lg(!1,null,!0)):this.backoffId_=CM(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&AM(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class lg{constructor(e,t,s){this.wasSuccessCode=e,this.connection=t,this.canceled=!!s}}function OM(r,e){e!==null&&e.length>0&&(r.Authorization="Firebase "+e)}function MM(r,e){r["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function LM(r,e){e&&(r["X-Firebase-GMPID"]=e)}function FM(r,e){e!==null&&(r["X-Firebase-AppCheck"]=e)}function UM(r,e,t,s,a,l,c=!0,u=!1){const m=YT(r.urlParams),p=r.url+m,b=Object.assign({},r.headers);return LM(b,e),OM(b,t),MM(b,l),FM(b,s),new kM(p,r.method,b,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,a,c,u)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VM(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function zM(...r){const e=VM();if(e!==void 0){const t=new e;for(let s=0;s<r.length;s++)t.append(r[s]);return t.getBlob()}else{if(zw())return new Blob(r);throw new vs(ws.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function $M(r,e,t){return r.webkitSlice?r.webkitSlice(e,t):r.mozSlice?r.mozSlice(e,t):r.slice?r.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BM(r){if(typeof atob>"u")throw SM("base-64");return atob(r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wa={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Sb{constructor(e,t){this.data=e,this.contentType=t||null}}function qM(r,e){switch(r){case Wa.RAW:return new Sb(XT(e));case Wa.BASE64:case Wa.BASE64URL:return new Sb(JT(r,e));case Wa.DATA_URL:return new Sb(GM(e),QM(e))}throw Uw()}function XT(r){const e=[];for(let t=0;t<r.length;t++){let s=r.charCodeAt(t);if(s<=127)e.push(s);else if(s<=2047)e.push(192|s>>6,128|s&63);else if((s&64512)===55296)if(!(t<r.length-1&&(r.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const l=s,c=r.charCodeAt(++t);s=65536|(l&1023)<<10|c&1023,e.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|s&63)}else(s&64512)===56320?e.push(239,191,189):e.push(224|s>>12,128|s>>6&63,128|s&63)}return new Uint8Array(e)}function HM(r){let e;try{e=decodeURIComponent(r)}catch{throw Xm(Wa.DATA_URL,"Malformed data URL.")}return XT(e)}function JT(r,e){switch(r){case Wa.BASE64:{const a=e.indexOf("-")!==-1,l=e.indexOf("_")!==-1;if(a||l)throw Xm(r,"Invalid character '"+(a?"-":"_")+"' found: is it base64url encoded?");break}case Wa.BASE64URL:{const a=e.indexOf("+")!==-1,l=e.indexOf("/")!==-1;if(a||l)throw Xm(r,"Invalid character '"+(a?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=BM(e)}catch(a){throw a.message.includes("polyfill")?a:Xm(r,"Invalid character found")}const s=new Uint8Array(t.length);for(let a=0;a<t.length;a++)s[a]=t.charCodeAt(a);return s}class ZT{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw Xm(Wa.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const s=t[1]||null;s!=null&&(this.base64=WM(s,";base64"),this.contentType=this.base64?s.substring(0,s.length-7):s),this.rest=e.substring(e.indexOf(",")+1)}}function GM(r){const e=new ZT(r);return e.base64?JT(Wa.BASE64,e.rest):HM(e.rest)}function QM(r){return new ZT(r).contentType}function WM(r,e){return r.length>=e.length?r.substring(r.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zl{constructor(e,t){let s=0,a="";mE(e)?(this.data_=e,s=e.size,a=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),s=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),s=e.length),this.size_=s,this.type_=a}size(){return this.size_}type(){return this.type_}slice(e,t){if(mE(this.data_)){const s=this.data_,a=$M(s,e,t);return a===null?null:new Zl(a)}else{const s=new Uint8Array(this.data_.buffer,e,t-e);return new Zl(s,!0)}}static getBlob(...e){if(zw()){const t=e.map(s=>s instanceof Zl?s.data_:s);return new Zl(zM.apply(null,t))}else{const t=e.map(c=>Vw(c)?qM(Wa.RAW,c).data:c.data_);let s=0;t.forEach(c=>{s+=c.byteLength});const a=new Uint8Array(s);let l=0;return t.forEach(c=>{for(let u=0;u<c.length;u++)a[l++]=c[u]}),new Zl(a,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e1(r){let e;try{e=JSON.parse(r)}catch{return null}return RM(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KM(r){if(r.length===0)return null;const e=r.lastIndexOf("/");return e===-1?"":r.slice(0,e)}function YM(r,e){const t=e.split("/").filter(s=>s.length>0).join("/");return r.length===0?t:r+"/"+t}function t1(r){const e=r.lastIndexOf("/",r.length-2);return e===-1?r:r.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XM(r,e){return e}class qr{constructor(e,t,s,a){this.server=e,this.local=t||e,this.writable=!!s,this.xform=a||XM}}let cg=null;function JM(r){return!Vw(r)||r.length<2?r:t1(r)}function n1(){if(cg)return cg;const r=[];r.push(new qr("bucket")),r.push(new qr("generation")),r.push(new qr("metageneration")),r.push(new qr("name","fullPath",!0));function e(l,c){return JM(c)}const t=new qr("name");t.xform=e,r.push(t);function s(l,c){return c!==void 0?Number(c):c}const a=new qr("size");return a.xform=s,r.push(a),r.push(new qr("timeCreated")),r.push(new qr("updated")),r.push(new qr("md5Hash",null,!0)),r.push(new qr("cacheControl",null,!0)),r.push(new qr("contentDisposition",null,!0)),r.push(new qr("contentEncoding",null,!0)),r.push(new qr("contentLanguage",null,!0)),r.push(new qr("contentType",null,!0)),r.push(new qr("metadata","customMetadata",!0)),cg=r,cg}function ZM(r,e){function t(){const s=r.bucket,a=r.fullPath,l=new Ii(s,a);return e._makeStorageReference(l)}Object.defineProperty(r,"ref",{get:t})}function eL(r,e,t){const s={};s.type="file";const a=t.length;for(let l=0;l<a;l++){const c=t[l];s[c.local]=c.xform(s,e[c.server])}return ZM(s,r),s}function s1(r,e,t){const s=e1(e);return s===null?null:eL(r,s,t)}function tL(r,e,t,s){const a=e1(e);if(a===null||!Vw(a.downloadTokens))return null;const l=a.downloadTokens;if(l.length===0)return null;const c=encodeURIComponent;return l.split(",").map(p=>{const b=r.bucket,w=r.fullPath,N="/b/"+c(b)+"/o/"+c(w),R=Lx(N,t,s),O=YT({alt:"media",token:p});return R+O})[0]}function nL(r,e){const t={},s=e.length;for(let a=0;a<s;a++){const l=e[a];l.writable&&(t[l.server]=r[l.local])}return JSON.stringify(t)}class $w{constructor(e,t,s,a){this.url=e,this.method=t,this.handler=s,this.timeout=a,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r1(r){if(!r)throw Uw()}function sL(r,e){function t(s,a){const l=s1(r,a,e);return r1(l!==null),l}return t}function rL(r,e){function t(s,a){const l=s1(r,a,e);return r1(l!==null),tL(l,a,r.host,r._protocol)}return t}function i1(r){function e(t,s){let a;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?a=xM():a=gM():t.getStatus()===402?a=pM(r.bucket):t.getStatus()===403?a=yM(r.path):a=s,a.status=t.getStatus(),a.serverResponse=s.serverResponse,a}return e}function a1(r){const e=i1(r);function t(s,a){let l=e(s,a);return s.getStatus()===404&&(l=fM(r.path)),l.serverResponse=a.serverResponse,l}return t}function iL(r,e,t){const s=e.fullServerUrl(),a=Lx(s,r.host,r._protocol),l="GET",c=r.maxOperationRetryTime,u=new $w(a,l,rL(r,t),c);return u.errorHandler=a1(e),u}function aL(r,e){const t=e.fullServerUrl(),s=Lx(t,r.host,r._protocol),a="DELETE",l=r.maxOperationRetryTime;function c(m,p){}const u=new $w(s,a,c,l);return u.successCodes=[200,204],u.errorHandler=a1(e),u}function oL(r,e){return r&&r.contentType||e&&e.type()||"application/octet-stream"}function lL(r,e,t){const s=Object.assign({},t);return s.fullPath=r.path,s.size=e.size(),s.contentType||(s.contentType=oL(null,e)),s}function cL(r,e,t,s,a){const l=e.bucketOnlyServerUrl(),c={"X-Goog-Upload-Protocol":"multipart"};function u(){let Z="";for(let ie=0;ie<2;ie++)Z=Z+Math.random().toString().slice(2);return Z}const m=u();c["Content-Type"]="multipart/related; boundary="+m;const p=lL(e,s,a),b=nL(p,t),w="--"+m+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+b+`\r
--`+m+`\r
Content-Type: `+p.contentType+`\r
\r
`,N=`\r
--`+m+"--",R=Zl.getBlob(w,s,N);if(R===null)throw _M();const O={name:p.fullPath},G=Lx(l,r.host,r._protocol),U="POST",T=r.maxUploadRetryTime,ee=new $w(G,U,sL(r,t),T);return ee.urlParams=O,ee.headers=c,ee.body=R.uploadData(),ee.errorHandler=i1(e),ee}class dL{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=yd.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=yd.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=yd.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,s,a,l){if(this.sent_)throw km("cannot .send() more than once");if(ol(e)&&s&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),l!==void 0)for(const c in l)l.hasOwnProperty(c)&&this.xhr_.setRequestHeader(c,l[c].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw km("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw km("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw km("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw km("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class uL extends dL{initXhr(){this.xhr_.responseType="text"}}function Bw(){return new uL}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Id{constructor(e,t){this._service=e,t instanceof Ii?this._location=t:this._location=Ii.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Id(e,t)}get root(){const e=new Ii(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return t1(this._location.path)}get storage(){return this._service}get parent(){const e=KM(this._location.path);if(e===null)return null;const t=new Ii(this._location.bucket,e);return new Id(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw IM(e)}}function hL(r,e,t){r._throwIfRoot("uploadBytes");const s=cL(r.storage,r._location,n1(),new Zl(e,!0),t);return r.storage.makeRequestWithTokens(s,Bw).then(a=>({metadata:a,ref:r}))}function mL(r){r._throwIfRoot("getDownloadURL");const e=iL(r.storage,r._location,n1());return r.storage.makeRequestWithTokens(e,Bw).then(t=>{if(t===null)throw EM();return t})}function fL(r){r._throwIfRoot("deleteObject");const e=aL(r.storage,r._location);return r.storage.makeRequestWithTokens(e,Bw)}function pL(r,e){const t=YM(r._location.path,e),s=new Ii(r._location.bucket,t);return new Id(r.storage,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gL(r){return/^[A-Za-z]+:\/\//.test(r)}function xL(r,e){return new Id(r,e)}function o1(r,e){if(r instanceof qw){const t=r;if(t._bucket==null)throw jM();const s=new Id(t,t._bucket);return e!=null?o1(s,e):s}else return e!==void 0?pL(r,e):r}function yL(r,e){if(e&&gL(e)){if(r instanceof qw)return xL(r,e);throw g0("To use ref(service, url), the first argument must be a Storage instance.")}else return o1(r,e)}function pE(r,e){const t=e?.[WT];return t==null?null:Ii.makeFromBucketSpec(t,r)}function bL(r,e,t,s={}){r.host=`${e}:${t}`;const a=ol(e);a&&(hx(`https://${r.host}/b`),A0("Storage",!0)),r._isUsingEmulator=!0,r._protocol=a?"https":"http";const{mockUserToken:l}=s;l&&(r._overrideAuthToken=typeof l=="string"?l:yS(l,r.app.options.projectId))}class qw{constructor(e,t,s,a,l,c=!1){this.app=e,this._authProvider=t,this._appCheckProvider=s,this._url=a,this._firebaseVersion=l,this._isUsingEmulator=c,this._bucket=null,this._host=QT,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=hM,this._maxUploadRetryTime=mM,this._requests=new Set,a!=null?this._bucket=Ii.makeFromBucketSpec(a,this._host):this._bucket=pE(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Ii.makeFromBucketSpec(this._url,e):this._bucket=pE(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){fE("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){fE("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(si(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Id(this,e)}_makeRequest(e,t,s,a,l=!0){if(this._deleted)return new TM(KT());{const c=UM(e,this._appId,s,a,t,this._firebaseVersion,l,this._isUsingEmulator);return this._requests.add(c),c.getPromise().then(()=>this._requests.delete(c),()=>this._requests.delete(c)),c}}async makeRequestWithTokens(e,t){const[s,a]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,s,a).getPromise()}}const gE="@firebase/storage",xE="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l1="storage";function Zg(r,e,t){return r=zn(r),hL(r,e,t)}function Jm(r){return r=zn(r),mL(r)}function Fx(r){return r=zn(r),fL(r)}function Wo(r,e){return r=zn(r),yL(r,e)}function c1(r=k0(),e){r=zn(r);const s=Tf(r,l1).getImmediate({identifier:e}),a=pS("storage");return a&&wL(s,...a),s}function wL(r,e,t,s={}){bL(r,e,t,s)}function vL(r,{instanceIdentifier:e}){const t=r.getProvider("app").getImmediate(),s=r.getProvider("auth-internal"),a=r.getProvider("app-check-internal");return new qw(t,s,a,e,Cd)}function NL(){bd(new fc(l1,vL,"PUBLIC").setMultipleInstances(!0)),Ka(gE,xE,""),Ka(gE,xE,"esm2020")}NL();function d1(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const jL=d1,u1=new Sf("auth","Firebase",d1());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ex=new D0("@firebase/auth");function _L(r,...e){ex.logLevel<=cn.WARN&&ex.warn(`Auth (${Cd}): ${r}`,...e)}function Sg(r,...e){ex.logLevel<=cn.ERROR&&ex.error(`Auth (${Cd}): ${r}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ba(r,...e){throw Hw(r,...e)}function Ja(r,...e){return Hw(r,...e)}function h1(r,e,t){const s={...jL(),[e]:t};return new Sf("auth","Firebase",s).create(e,{appName:r.name})}function Za(r){return h1(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Hw(r,...e){if(typeof r!="string"){const t=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=r.name),r._errorFactory.create(t,...s)}return u1.create(r,...e)}function Ut(r,e,...t){if(!r)throw Hw(e,...t)}function Ko(r){const e="INTERNAL ASSERTION FAILED: "+r;throw Sg(e),new Error(e)}function rl(r,e){r||Ko(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x0(){return typeof self<"u"&&self.location?.href||""}function EL(){return yE()==="http:"||yE()==="https:"}function yE(){return typeof self<"u"&&self.location?.protocol||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SL(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(EL()||cD()||"connection"in navigator)?navigator.onLine:!0}function IL(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zf{constructor(e,t){this.shortDelay=e,this.longDelay=t,rl(t>e,"Short delay should be less than long delay!"),this.isMobile=oD()||dD()}get(){return SL()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gw(r,e){rl(r.emulator,"Emulator should always be set here");const{url:t}=r.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m1{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ko("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ko("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ko("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TL={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CL=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],AL=new zf(3e4,6e4);function jc(r,e){return r.tenantId&&!e.tenantId?{...e,tenantId:r.tenantId}:e}async function ul(r,e,t,s,a={}){return f1(r,a,async()=>{let l={},c={};s&&(e==="GET"?c=s:l={body:JSON.stringify(s)});const u=If({key:r.config.apiKey,...c}).slice(1),m=await r._getAdditionalHeaders();m["Content-Type"]="application/json",r.languageCode&&(m["X-Firebase-Locale"]=r.languageCode);const p={method:e,headers:m,...l};return lD()||(p.referrerPolicy="no-referrer"),r.emulatorConfig&&ol(r.emulatorConfig.host)&&(p.credentials="include"),m1.fetch()(await p1(r,r.config.apiHost,t,u),p)})}async function f1(r,e,t){r._canInitEmulator=!1;const s={...TL,...e};try{const a=new RL(r),l=await Promise.race([t(),a.promise]);a.clearNetworkTimeout();const c=await l.json();if("needConfirmation"in c)throw dg(r,"account-exists-with-different-credential",c);if(l.ok&&!("errorMessage"in c))return c;{const u=l.ok?c.errorMessage:c.error.message,[m,p]=u.split(" : ");if(m==="FEDERATED_USER_ID_ALREADY_LINKED")throw dg(r,"credential-already-in-use",c);if(m==="EMAIL_EXISTS")throw dg(r,"email-already-in-use",c);if(m==="USER_DISABLED")throw dg(r,"user-disabled",c);const b=s[m]||m.toLowerCase().replace(/[_\s]+/g,"-");if(p)throw h1(r,b,p);ba(r,b)}}catch(a){if(a instanceof ao)throw a;ba(r,"network-request-failed",{message:String(a)})}}async function $f(r,e,t,s,a={}){const l=await ul(r,e,t,s,a);return"mfaPendingCredential"in l&&ba(r,"multi-factor-auth-required",{_serverResponse:l}),l}async function p1(r,e,t,s){const a=`${e}${t}?${s}`,l=r,c=l.config.emulator?Gw(r.config,a):`${r.config.apiScheme}://${a}`;return CL.includes(t)&&(await l._persistenceManagerAvailable,l._getPersistenceType()==="COOKIE")?l._getPersistence()._getFinalTarget(c).toString():c}function DL(r){switch(r){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class RL{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,s)=>{this.timer=setTimeout(()=>s(Ja(this.auth,"network-request-failed")),AL.get())})}}function dg(r,e,t){const s={appName:r.name};t.email&&(s.email=t.email),t.phoneNumber&&(s.phoneNumber=t.phoneNumber);const a=Ja(r,e,s);return a.customData._tokenResponse=t,a}function bE(r){return r!==void 0&&r.enterprise!==void 0}class PL{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return DL(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function kL(r,e){return ul(r,"GET","/v2/recaptchaConfig",jc(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OL(r,e){return ul(r,"POST","/v1/accounts:delete",e)}async function tx(r,e){return ul(r,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zm(r){if(r)try{const e=new Date(Number(r));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function ML(r,e=!1){const t=zn(r),s=await t.getIdToken(e),a=Qw(s);Ut(a&&a.exp&&a.auth_time&&a.iat,t.auth,"internal-error");const l=typeof a.firebase=="object"?a.firebase:void 0,c=l?.sign_in_provider;return{claims:a,token:s,authTime:Zm(Ib(a.auth_time)),issuedAtTime:Zm(Ib(a.iat)),expirationTime:Zm(Ib(a.exp)),signInProvider:c||null,signInSecondFactor:l?.sign_in_second_factor||null}}function Ib(r){return Number(r)*1e3}function Qw(r){const[e,t,s]=r.split(".");if(e===void 0||t===void 0||s===void 0)return Sg("JWT malformed, contained fewer than 3 sections"),null;try{const a=hS(t);return a?JSON.parse(a):(Sg("Failed to decode base64 JWT payload"),null)}catch(a){return Sg("Caught error parsing JWT payload as JSON",a?.toString()),null}}function wE(r){const e=Qw(r);return Ut(e,"internal-error"),Ut(typeof e.exp<"u","internal-error"),Ut(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rh(r,e,t=!1){if(t)return e;try{return await e}catch(s){throw s instanceof ao&&LL(s)&&r.auth.currentUser===r&&await r.auth.signOut(),s}}function LL({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FL{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y0{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Zm(this.lastLoginAt),this.creationTime=Zm(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nx(r){const e=r.auth,t=await r.getIdToken(),s=await rh(r,tx(e,{idToken:t}));Ut(s?.users.length,e,"internal-error");const a=s.users[0];r._notifyReloadListener(a);const l=a.providerUserInfo?.length?g1(a.providerUserInfo):[],c=VL(r.providerData,l),u=r.isAnonymous,m=!(r.email&&a.passwordHash)&&!c?.length,p=u?m:!1,b={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:c,metadata:new y0(a.createdAt,a.lastLoginAt),isAnonymous:p};Object.assign(r,b)}async function UL(r){const e=zn(r);await nx(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function VL(r,e){return[...r.filter(s=>!e.some(a=>a.providerId===s.providerId)),...e]}function g1(r){return r.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zL(r,e){const t=await f1(r,{},async()=>{const s=If({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:l}=r.config,c=await p1(r,a,"/v1/token",`key=${l}`),u=await r._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";const m={method:"POST",headers:u,body:s};return r.emulatorConfig&&ol(r.emulatorConfig.host)&&(m.credentials="include"),m1.fetch()(c,m)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function $L(r,e){return ul(r,"POST","/v2/accounts:revokeToken",jc(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Du{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ut(e.idToken,"internal-error"),Ut(typeof e.idToken<"u","internal-error"),Ut(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):wE(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ut(e.length!==0,"internal-error");const t=wE(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ut(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:s,refreshToken:a,expiresIn:l}=await zL(e,t);this.updateTokensAndExpiration(s,a,Number(l))}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,t){const{refreshToken:s,accessToken:a,expirationTime:l}=t,c=new Du;return s&&(Ut(typeof s=="string","internal-error",{appName:e}),c.refreshToken=s),a&&(Ut(typeof a=="string","internal-error",{appName:e}),c.accessToken=a),l&&(Ut(typeof l=="number","internal-error",{appName:e}),c.expirationTime=l),c}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Du,this.toJSON())}_performRefresh(){return Ko("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xl(r,e){Ut(typeof r=="string"||typeof r>"u","internal-error",{appName:e})}class ga{constructor({uid:e,auth:t,stsTokenManager:s,...a}){this.providerId="firebase",this.proactiveRefresh=new FL(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new y0(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const t=await rh(this,this.stsTokenManager.getToken(this.auth,e));return Ut(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return ML(this,e)}reload(){return UL(this)}_assign(e){this!==e&&(Ut(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ga({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){Ut(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&await nx(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(si(this.auth.app))return Promise.reject(Za(this.auth));const e=await this.getIdToken();return await rh(this,OL(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const s=t.displayName??void 0,a=t.email??void 0,l=t.phoneNumber??void 0,c=t.photoURL??void 0,u=t.tenantId??void 0,m=t._redirectEventId??void 0,p=t.createdAt??void 0,b=t.lastLoginAt??void 0,{uid:w,emailVerified:N,isAnonymous:R,providerData:O,stsTokenManager:G}=t;Ut(w&&G,e,"internal-error");const U=Du.fromJSON(this.name,G);Ut(typeof w=="string",e,"internal-error"),Xl(s,e.name),Xl(a,e.name),Ut(typeof N=="boolean",e,"internal-error"),Ut(typeof R=="boolean",e,"internal-error"),Xl(l,e.name),Xl(c,e.name),Xl(u,e.name),Xl(m,e.name),Xl(p,e.name),Xl(b,e.name);const T=new ga({uid:w,auth:e,email:a,emailVerified:N,displayName:s,isAnonymous:R,photoURL:c,phoneNumber:l,tenantId:u,stsTokenManager:U,createdAt:p,lastLoginAt:b});return O&&Array.isArray(O)&&(T.providerData=O.map(ee=>({...ee}))),m&&(T._redirectEventId=m),T}static async _fromIdTokenResponse(e,t,s=!1){const a=new Du;a.updateFromServerResponse(t);const l=new ga({uid:t.localId,auth:e,stsTokenManager:a,isAnonymous:s});return await nx(l),l}static async _fromGetAccountInfoResponse(e,t,s){const a=t.users[0];Ut(a.localId!==void 0,"internal-error");const l=a.providerUserInfo!==void 0?g1(a.providerUserInfo):[],c=!(a.email&&a.passwordHash)&&!l?.length,u=new Du;u.updateFromIdToken(s);const m=new ga({uid:a.localId,auth:e,stsTokenManager:u,isAnonymous:c}),p={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:l,metadata:new y0(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!l?.length};return Object.assign(m,p),m}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vE=new Map;function Yo(r){rl(r instanceof Function,"Expected a class definition");let e=vE.get(r);return e?(rl(e instanceof r,"Instance stored in cache mismatched with class"),e):(e=new r,vE.set(r,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x1{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}x1.type="NONE";const NE=x1;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ig(r,e,t){return`firebase:${r}:${e}:${t}`}class Ru{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:a,name:l}=this.auth;this.fullUserKey=Ig(this.userKey,a.apiKey,l),this.fullPersistenceKey=Ig("persistence",a.apiKey,l),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await tx(this.auth,{idToken:e}).catch(()=>{});return t?ga._fromGetAccountInfoResponse(this.auth,t,e):null}return ga._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,s="authUser"){if(!t.length)return new Ru(Yo(NE),e,s);const a=(await Promise.all(t.map(async p=>{if(await p._isAvailable())return p}))).filter(p=>p);let l=a[0]||Yo(NE);const c=Ig(s,e.config.apiKey,e.name);let u=null;for(const p of t)try{const b=await p._get(c);if(b){let w;if(typeof b=="string"){const N=await tx(e,{idToken:b}).catch(()=>{});if(!N)break;w=await ga._fromGetAccountInfoResponse(e,N,b)}else w=ga._fromJSON(e,b);p!==l&&(u=w),l=p;break}}catch{}const m=a.filter(p=>p._shouldAllowMigration);return!l._shouldAllowMigration||!m.length?new Ru(l,e,s):(l=m[0],u&&await l._set(c,u.toJSON()),await Promise.all(t.map(async p=>{if(p!==l)try{await p._remove(c)}catch{}})),new Ru(l,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jE(r){const e=r.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(v1(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(y1(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(j1(e))return"Blackberry";if(_1(e))return"Webos";if(b1(e))return"Safari";if((e.includes("chrome/")||w1(e))&&!e.includes("edge/"))return"Chrome";if(N1(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=r.match(t);if(s?.length===2)return s[1]}return"Other"}function y1(r=Js()){return/firefox\//i.test(r)}function b1(r=Js()){const e=r.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function w1(r=Js()){return/crios\//i.test(r)}function v1(r=Js()){return/iemobile/i.test(r)}function N1(r=Js()){return/android/i.test(r)}function j1(r=Js()){return/blackberry/i.test(r)}function _1(r=Js()){return/webos/i.test(r)}function Ww(r=Js()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function BL(r=Js()){return Ww(r)&&!!window.navigator?.standalone}function qL(){return uD()&&document.documentMode===10}function E1(r=Js()){return Ww(r)||N1(r)||_1(r)||j1(r)||/windows phone/i.test(r)||v1(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S1(r,e=[]){let t;switch(r){case"Browser":t=jE(Js());break;case"Worker":t=`${jE(Js())}-${r}`;break;default:t=r}const s=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Cd}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HL{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=l=>new Promise((c,u)=>{try{const m=e(l);c(m)}catch(m){u(m)}});s.onAbort=t,this.queue.push(s);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)await s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const a of t)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GL(r,e={}){return ul(r,"GET","/v2/passwordPolicy",jc(r,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QL=6;class WL{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??QL,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),a&&(t.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let s;for(let a=0;a<e.length;a++)s=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,a,l){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KL{constructor(e,t,s,a){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new _E(this),this.idTokenSubscription=new _E(this),this.beforeStateQueue=new HL(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=u1,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion,this._persistenceManagerAvailable=new Promise(l=>this._resolvePersistenceManagerAvailable=l)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Yo(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Ru.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await tx(this,{idToken:e}),s=await ga._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(si(this.app)){const l=this.app.settings.authIdToken;return l?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(l).then(c,c))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let s=t,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const l=this.redirectUser?._redirectEventId,c=s?._redirectEventId,u=await this.tryRedirectSignIn(e);(!l||l===c)&&u?.user&&(s=u.user,a=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(s)}catch(l){s=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(l))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Ut(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await nx(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=IL()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(si(this.app))return Promise.reject(Za(this));const t=e?zn(e):null;return t&&Ut(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ut(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return si(this.app)?Promise.reject(Za(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return si(this.app)?Promise.reject(Za(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Yo(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await GL(this),t=new WL(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Sf("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(s.tenantId=this.tenantId),await $L(this,s)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const s=await this.getOrInitRedirectPersistenceManager(t);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Yo(e)||this._popupRedirectResolver;Ut(t,this,"argument-error"),this.redirectPersistenceManager=await Ru.create(this,[Yo(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,a){if(this._deleted)return()=>{};const l=typeof t=="function"?t:t.next.bind(t);let c=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ut(u,this,"internal-error"),u.then(()=>{c||l(this.currentUser)}),typeof t=="function"){const m=e.addObserver(t,s,a);return()=>{c=!0,m()}}else{const m=e.addObserver(t);return()=>{c=!0,m()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ut(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=S1(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const s=await this._getAppCheckToken();return s&&(e["X-Firebase-AppCheck"]=s),e}async _getAppCheckToken(){if(si(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&_L(`Error while retrieving App Check token: ${e.error}`),e?.token}}function _c(r){return zn(r)}class _E{constructor(e){this.auth=e,this.observer=null,this.addObserver=xD(t=>this.observer=t)}get next(){return Ut(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ux={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function YL(r){Ux=r}function I1(r){return Ux.loadJS(r)}function XL(){return Ux.recaptchaEnterpriseScript}function JL(){return Ux.gapiScript}function ZL(r){return`__${r}${Math.floor(Math.random()*1e6)}`}class e3{constructor(){this.enterprise=new t3}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class t3{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const n3="recaptcha-enterprise",T1="NO_RECAPTCHA";class s3{constructor(e){this.type=n3,this.auth=_c(e)}async verify(e="verify",t=!1){async function s(l){if(!t){if(l.tenantId==null&&l._agentRecaptchaConfig!=null)return l._agentRecaptchaConfig.siteKey;if(l.tenantId!=null&&l._tenantRecaptchaConfigs[l.tenantId]!==void 0)return l._tenantRecaptchaConfigs[l.tenantId].siteKey}return new Promise(async(c,u)=>{kL(l,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(m=>{if(m.recaptchaKey===void 0)u(new Error("recaptcha Enterprise site key undefined"));else{const p=new PL(m);return l.tenantId==null?l._agentRecaptchaConfig=p:l._tenantRecaptchaConfigs[l.tenantId]=p,c(p.siteKey)}}).catch(m=>{u(m)})})}function a(l,c,u){const m=window.grecaptcha;bE(m)?m.enterprise.ready(()=>{m.enterprise.execute(l,{action:e}).then(p=>{c(p)}).catch(()=>{c(T1)})}):u(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new e3().execute("siteKey",{action:"verify"}):new Promise((l,c)=>{s(this.auth).then(u=>{if(!t&&bE(window.grecaptcha))a(u,l,c);else{if(typeof window>"u"){c(new Error("RecaptchaVerifier is only supported in browser"));return}let m=XL();m.length!==0&&(m+=u),I1(m).then(()=>{a(u,l,c)}).catch(p=>{c(p)})}}).catch(u=>{c(u)})})}}async function EE(r,e,t,s=!1,a=!1){const l=new s3(r);let c;if(a)c=T1;else try{c=await l.verify(t)}catch{c=await l.verify(t,!0)}const u={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in u){const m=u.phoneEnrollmentInfo.phoneNumber,p=u.phoneEnrollmentInfo.recaptchaToken;Object.assign(u,{phoneEnrollmentInfo:{phoneNumber:m,recaptchaToken:p,captchaResponse:c,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in u){const m=u.phoneSignInInfo.recaptchaToken;Object.assign(u,{phoneSignInInfo:{recaptchaToken:m,captchaResponse:c,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return u}return s?Object.assign(u,{captchaResp:c}):Object.assign(u,{captchaResponse:c}),Object.assign(u,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(u,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),u}async function b0(r,e,t,s,a){if(r._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const l=await EE(r,e,t,t==="getOobCode");return s(r,l)}else return s(r,e).catch(async l=>{if(l.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const c=await EE(r,e,t,t==="getOobCode");return s(r,c)}else return Promise.reject(l)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r3(r,e){const t=Tf(r,"auth");if(t.isInitialized()){const a=t.getImmediate(),l=t.getOptions();if(mc(l,e??{}))return a;ba(a,"already-initialized")}return t.initialize({options:e})}function i3(r,e){const t=e?.persistence||[],s=(Array.isArray(t)?t:[t]).map(Yo);e?.errorMap&&r._updateErrorMap(e.errorMap),r._initializeWithPersistence(s,e?.popupRedirectResolver)}function a3(r,e,t){const s=_c(r);Ut(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const a=!1,l=C1(e),{host:c,port:u}=o3(e),m=u===null?"":`:${u}`,p={url:`${l}//${c}${m}/`},b=Object.freeze({host:c,port:u,protocol:l.replace(":",""),options:Object.freeze({disableWarnings:a})});if(!s._canInitEmulator){Ut(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),Ut(mc(p,s.config.emulator)&&mc(b,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=p,s.emulatorConfig=b,s.settings.appVerificationDisabledForTesting=!0,ol(c)?(hx(`${l}//${c}${m}`),A0("Auth",!0)):l3()}function C1(r){const e=r.indexOf(":");return e<0?"":r.substr(0,e+1)}function o3(r){const e=C1(r),t=/(\/\/)?([^?#/]+)/.exec(r.substr(e.length));if(!t)return{host:"",port:null};const s=t[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(s);if(a){const l=a[1];return{host:l,port:SE(s.substr(l.length+1))}}else{const[l,c]=s.split(":");return{host:l,port:SE(c)}}}function SE(r){if(!r)return null;const e=Number(r);return isNaN(e)?null:e}function l3(){function r(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kw{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ko("not implemented")}_getIdTokenResponse(e){return Ko("not implemented")}_linkToIdToken(e,t){return Ko("not implemented")}_getReauthenticationResolver(e){return Ko("not implemented")}}async function c3(r,e){return ul(r,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function d3(r,e){return $f(r,"POST","/v1/accounts:signInWithPassword",jc(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function u3(r,e){return $f(r,"POST","/v1/accounts:signInWithEmailLink",jc(r,e))}async function h3(r,e){return $f(r,"POST","/v1/accounts:signInWithEmailLink",jc(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nf extends Kw{constructor(e,t,s,a=null){super("password",s),this._email=e,this._password=t,this._tenantId=a}static _fromEmailAndPassword(e,t){return new Nf(e,t,"password")}static _fromEmailAndCode(e,t,s=null){return new Nf(e,t,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return b0(e,t,"signInWithPassword",d3);case"emailLink":return u3(e,{email:this._email,oobCode:this._password});default:ba(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const s={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return b0(e,s,"signUpPassword",c3);case"emailLink":return h3(e,{idToken:t,email:this._email,oobCode:this._password});default:ba(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pu(r,e){return $f(r,"POST","/v1/accounts:signInWithIdp",jc(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m3="http://localhost";class Td extends Kw{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Td(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ba("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:a,...l}=t;if(!s||!a)return null;const c=new Td(s,a);return c.idToken=l.idToken||void 0,c.accessToken=l.accessToken||void 0,c.secret=l.secret,c.nonce=l.nonce,c.pendingToken=l.pendingToken||null,c}_getIdTokenResponse(e){const t=this.buildRequest();return Pu(e,t)}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,Pu(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Pu(e,t)}buildRequest(){const e={requestUri:m3,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=If(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f3(r){switch(r){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function p3(r){const e=Om(Mm(r)).link,t=e?Om(Mm(e)).deep_link_id:null,s=Om(Mm(r)).deep_link_id;return(s?Om(Mm(s)).link:null)||s||t||e||r}class Yw{constructor(e){const t=Om(Mm(e)),s=t.apiKey??null,a=t.oobCode??null,l=f3(t.mode??null);Ut(s&&a&&l,"argument-error"),this.apiKey=s,this.operation=l,this.code=a,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=p3(e);try{return new Yw(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xh{constructor(){this.providerId=xh.PROVIDER_ID}static credential(e,t){return Nf._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const s=Yw.parseLink(t);return Ut(s,"argument-error"),Nf._fromEmailAndCode(e,s.code,s.tenantId)}}xh.PROVIDER_ID="password";xh.EMAIL_PASSWORD_SIGN_IN_METHOD="password";xh.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A1{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bf extends A1{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec extends Bf{constructor(){super("facebook.com")}static credential(e){return Td._fromParams({providerId:ec.PROVIDER_ID,signInMethod:ec.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ec.credentialFromTaggedObject(e)}static credentialFromError(e){return ec.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ec.credential(e.oauthAccessToken)}catch{return null}}}ec.FACEBOOK_SIGN_IN_METHOD="facebook.com";ec.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc extends Bf{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Td._fromParams({providerId:tc.PROVIDER_ID,signInMethod:tc.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return tc.credentialFromTaggedObject(e)}static credentialFromError(e){return tc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return tc.credential(t,s)}catch{return null}}}tc.GOOGLE_SIGN_IN_METHOD="google.com";tc.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nc extends Bf{constructor(){super("github.com")}static credential(e){return Td._fromParams({providerId:nc.PROVIDER_ID,signInMethod:nc.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return nc.credentialFromTaggedObject(e)}static credentialFromError(e){return nc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return nc.credential(e.oauthAccessToken)}catch{return null}}}nc.GITHUB_SIGN_IN_METHOD="github.com";nc.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sc extends Bf{constructor(){super("twitter.com")}static credential(e,t){return Td._fromParams({providerId:sc.PROVIDER_ID,signInMethod:sc.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return sc.credentialFromTaggedObject(e)}static credentialFromError(e){return sc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return sc.credential(t,s)}catch{return null}}}sc.TWITTER_SIGN_IN_METHOD="twitter.com";sc.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function D1(r,e){return $f(r,"POST","/v1/accounts:signUp",jc(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,s,a=!1){const l=await ga._fromIdTokenResponse(e,s,a),c=IE(s);return new il({user:l,providerId:c,_tokenResponse:s,operationType:t})}static async _forOperation(e,t,s){await e._updateTokensIfNecessary(s,!0);const a=IE(s);return new il({user:e,providerId:a,_tokenResponse:s,operationType:t})}}function IE(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function g3(r){if(si(r.app))return Promise.reject(Za(r));const e=_c(r);if(await e._initializationPromise,e.currentUser?.isAnonymous)return new il({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await D1(e,{returnSecureToken:!0}),s=await il._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sx extends ao{constructor(e,t,s,a){super(t.code,t.message),this.operationType=s,this.user=a,Object.setPrototypeOf(this,sx.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,a){return new sx(e,t,s,a)}}function R1(r,e,t,s){return(e==="reauthenticate"?t._getReauthenticationResolver(r):t._getIdTokenResponse(r)).catch(l=>{throw l.code==="auth/multi-factor-auth-required"?sx._fromErrorAndOperation(r,l,e,s):l})}async function x3(r,e,t=!1){const s=await rh(r,e._linkToIdToken(r.auth,await r.getIdToken()),t);return il._forOperation(r,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y3(r,e,t=!1){const{auth:s}=r;if(si(s.app))return Promise.reject(Za(s));const a="reauthenticate";try{const l=await rh(r,R1(s,a,e,r),t);Ut(l.idToken,s,"internal-error");const c=Qw(l.idToken);Ut(c,s,"internal-error");const{sub:u}=c;return Ut(r.uid===u,s,"user-mismatch"),il._forOperation(r,a,l)}catch(l){throw l?.code==="auth/user-not-found"&&ba(s,"user-mismatch"),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function P1(r,e,t=!1){if(si(r.app))return Promise.reject(Za(r));const s="signIn",a=await R1(r,s,e),l=await il._fromIdTokenResponse(r,s,a);return t||await r._updateCurrentUser(l.user),l}async function b3(r,e){return P1(_c(r),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k1(r){const e=_c(r);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function w3(r,e,t){if(si(r.app))return Promise.reject(Za(r));const s=_c(r),c=await b0(s,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",D1).catch(m=>{throw m.code==="auth/password-does-not-meet-requirements"&&k1(r),m}),u=await il._fromIdTokenResponse(s,"signIn",c);return await s._updateCurrentUser(u.user),u}function v3(r,e,t){return si(r.app)?Promise.reject(Za(r)):b3(zn(r),xh.credential(e,t)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&k1(r),s})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N3(r,e){return ul(r,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function j3(r,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const s=zn(r),l={idToken:await s.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},c=await rh(s,N3(s.auth,l));s.displayName=c.displayName||null,s.photoURL=c.photoUrl||null;const u=s.providerData.find(({providerId:m})=>m==="password");u&&(u.displayName=s.displayName,u.photoURL=s.photoURL),await s._updateTokensIfNecessary(c)}function _3(r,e,t,s){return zn(r).onIdTokenChanged(e,t,s)}function E3(r,e,t){return zn(r).beforeAuthStateChanged(e,t)}function Xw(r,e,t,s){return zn(r).onAuthStateChanged(e,t,s)}function S3(r){return zn(r).signOut()}const rx="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O1{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(rx,"1"),this.storage.removeItem(rx),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I3=1e3,T3=10;class M1 extends O1{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=E1(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),a=this.localCache[t];s!==a&&e(t,a,s)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((c,u,m)=>{this.notifyListeners(c,m)});return}const s=e.key;t?this.detachListener():this.stopPolling();const a=()=>{const c=this.storage.getItem(s);!t&&this.localCache[s]===c||this.notifyListeners(s,c)},l=this.storage.getItem(s);qL()&&l!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,T3):a()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const a of Array.from(s))a(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},I3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}M1.type="LOCAL";const C3=M1;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L1 extends O1{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}L1.type="SESSION";const F1=L1;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A3(r){return Promise.all(r.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vx{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(a=>a.isListeningto(e));if(t)return t;const s=new Vx(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:s,eventType:a,data:l}=t.data,c=this.handlersMap[a];if(!c?.size)return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:a});const u=Array.from(c).map(async p=>p(t.origin,l)),m=await A3(u);t.ports[0].postMessage({status:"done",eventId:s,eventType:a,response:m})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Vx.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jw(r="",e=10){let t="";for(let s=0;s<e;s++)t+=Math.floor(Math.random()*10);return r+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D3{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,s=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let l,c;return new Promise((u,m)=>{const p=Jw("",20);a.port1.start();const b=setTimeout(()=>{m(new Error("unsupported_event"))},s);c={messageChannel:a,onMessage(w){const N=w;if(N.data.eventId===p)switch(N.data.status){case"ack":clearTimeout(b),l=setTimeout(()=>{m(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),u(N.data.response);break;default:clearTimeout(b),clearTimeout(l),m(new Error("invalid_response"));break}}},this.handlers.add(c),a.port1.addEventListener("message",c.onMessage),this.target.postMessage({eventType:e,eventId:p,data:t},[a.port2])}).finally(()=>{c&&this.removeMessageHandler(c)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eo(){return window}function R3(r){eo().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U1(){return typeof eo().WorkerGlobalScope<"u"&&typeof eo().importScripts=="function"}async function P3(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function k3(){return navigator?.serviceWorker?.controller||null}function O3(){return U1()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V1="firebaseLocalStorageDb",M3=1,ix="firebaseLocalStorage",z1="fbase_key";class qf{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function zx(r,e){return r.transaction([ix],e?"readwrite":"readonly").objectStore(ix)}function L3(){const r=indexedDB.deleteDatabase(V1);return new qf(r).toPromise()}function w0(){const r=indexedDB.open(V1,M3);return new Promise((e,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const s=r.result;try{s.createObjectStore(ix,{keyPath:z1})}catch(a){t(a)}}),r.addEventListener("success",async()=>{const s=r.result;s.objectStoreNames.contains(ix)?e(s):(s.close(),await L3(),e(await w0()))})})}async function TE(r,e,t){const s=zx(r,!0).put({[z1]:e,value:t});return new qf(s).toPromise()}async function F3(r,e){const t=zx(r,!1).get(e),s=await new qf(t).toPromise();return s===void 0?null:s.value}function CE(r,e){const t=zx(r,!0).delete(e);return new qf(t).toPromise()}const U3=800,V3=3;class $1{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await w0(),this.db)}async _withRetries(e){let t=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(t++>V3)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return U1()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Vx._getInstance(O3()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await P3(),!this.activeServiceWorker)return;this.sender=new D3(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||k3()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await w0();return await TE(e,rx,"1"),await CE(e,rx),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(s=>TE(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(s=>F3(s,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>CE(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const l=zx(a,!1).getAll();return new qf(l).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],s=new Set;if(e.length!==0)for(const{fbase_key:a,value:l}of e)s.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(l)&&(this.notifyListeners(a,l),t.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!s.has(a)&&(this.notifyListeners(a,null),t.push(a));return t}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const a of Array.from(s))a(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),U3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}$1.type="LOCAL";const z3=$1;new zf(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $3(r,e){return e?Yo(e):(Ut(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zw extends Kw{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Pu(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Pu(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Pu(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function B3(r){return P1(r.auth,new Zw(r),r.bypassAuthState)}function q3(r){const{auth:e,user:t}=r;return Ut(t,e,"internal-error"),y3(t,new Zw(r),r.bypassAuthState)}async function H3(r){const{auth:e,user:t}=r;return Ut(t,e,"internal-error"),x3(t,new Zw(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B1{constructor(e,t,s,a,l=!1){this.auth=e,this.resolver=s,this.user=a,this.bypassAuthState=l,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:s,postBody:a,tenantId:l,error:c,type:u}=e;if(c){this.reject(c);return}const m={auth:this.auth,requestUri:t,sessionId:s,tenantId:l||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(m))}catch(p){this.reject(p)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return B3;case"linkViaPopup":case"linkViaRedirect":return H3;case"reauthViaPopup":case"reauthViaRedirect":return q3;default:ba(this.auth,"internal-error")}}resolve(e){rl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){rl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G3=new zf(2e3,1e4);class Cu extends B1{constructor(e,t,s,a,l){super(e,t,a,l),this.provider=s,this.authWindow=null,this.pollId=null,Cu.currentPopupAction&&Cu.currentPopupAction.cancel(),Cu.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ut(e,this.auth,"internal-error"),e}async onExecution(){rl(this.filter.length===1,"Popup operations only handle one event");const e=Jw();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Ja(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Ja(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Cu.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ja(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,G3.get())};e()}}Cu.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q3="pendingRedirect",Tg=new Map;class W3 extends B1{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}async execute(){let e=Tg.get(this.auth._key());if(!e){try{const s=await K3(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(t){e=()=>Promise.reject(t)}Tg.set(this.auth._key(),e)}return this.bypassAuthState||Tg.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function K3(r,e){const t=J3(e),s=X3(r);if(!await s._isAvailable())return!1;const a=await s._get(t)==="true";return await s._remove(t),a}function Y3(r,e){Tg.set(r._key(),e)}function X3(r){return Yo(r._redirectPersistence)}function J3(r){return Ig(Q3,r.config.apiKey,r.name)}async function Z3(r,e,t=!1){if(si(r.app))return Promise.reject(Za(r));const s=_c(r),a=$3(s,e),c=await new W3(s,a,t).execute();return c&&!t&&(delete c.user._redirectEventId,await s._persistUserIfCurrent(c.user),await s._setRedirectUser(null,e)),c}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e5=600*1e3;class t5{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!n5(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!q1(e)){const s=e.error.code?.split("auth/")[1]||"internal-error";t.onError(Ja(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(AE(e))}saveEventToCache(e){this.cachedEventUids.add(AE(e)),this.lastProcessedEventTime=Date.now()}}function AE(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(e=>e).join("-")}function q1({type:r,error:e}){return r==="unknown"&&e?.code==="auth/no-auth-event"}function n5(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return q1(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s5(r,e={}){return ul(r,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r5=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,i5=/^https?/;async function a5(r){if(r.config.emulator)return;const{authorizedDomains:e}=await s5(r);for(const t of e)try{if(o5(t))return}catch{}ba(r,"unauthorized-domain")}function o5(r){const e=x0(),{protocol:t,hostname:s}=new URL(e);if(r.startsWith("chrome-extension://")){const c=new URL(r);return c.hostname===""&&s===""?t==="chrome-extension:"&&r.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&c.hostname===s}if(!i5.test(t))return!1;if(r5.test(r))return s===r;const a=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l5=new zf(3e4,6e4);function DE(){const r=eo().___jsl;if(r?.H){for(const e of Object.keys(r.H))if(r.H[e].r=r.H[e].r||[],r.H[e].L=r.H[e].L||[],r.H[e].r=[...r.H[e].L],r.CP)for(let t=0;t<r.CP.length;t++)r.CP[t]=null}}function c5(r){return new Promise((e,t)=>{function s(){DE(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{DE(),t(Ja(r,"network-request-failed"))},timeout:l5.get()})}if(eo().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(eo().gapi?.load)s();else{const a=ZL("iframefcb");return eo()[a]=()=>{gapi.load?s():t(Ja(r,"network-request-failed"))},I1(`${JL()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw Cg=null,e})}let Cg=null;function d5(r){return Cg=Cg||c5(r),Cg}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u5=new zf(5e3,15e3),h5="__/auth/iframe",m5="emulator/auth/iframe",f5={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},p5=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function g5(r){const e=r.config;Ut(e.authDomain,r,"auth-domain-config-required");const t=e.emulator?Gw(e,m5):`https://${r.config.authDomain}/${h5}`,s={apiKey:e.apiKey,appName:r.name,v:Cd},a=p5.get(r.config.apiHost);a&&(s.eid=a);const l=r._getFrameworks();return l.length&&(s.fw=l.join(",")),`${t}?${If(s).slice(1)}`}async function x5(r){const e=await d5(r),t=eo().gapi;return Ut(t,r,"internal-error"),e.open({where:document.body,url:g5(r),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:f5,dontclear:!0},s=>new Promise(async(a,l)=>{await s.restyle({setHideOnLeave:!1});const c=Ja(r,"network-request-failed"),u=eo().setTimeout(()=>{l(c)},u5.get());function m(){eo().clearTimeout(u),a(s)}s.ping(m).then(m,()=>{l(c)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y5={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},b5=500,w5=600,v5="_blank",N5="http://localhost";class RE{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function j5(r,e,t,s=b5,a=w5){const l=Math.max((window.screen.availHeight-a)/2,0).toString(),c=Math.max((window.screen.availWidth-s)/2,0).toString();let u="";const m={...y5,width:s.toString(),height:a.toString(),top:l,left:c},p=Js().toLowerCase();t&&(u=w1(p)?v5:t),y1(p)&&(e=e||N5,m.scrollbars="yes");const b=Object.entries(m).reduce((N,[R,O])=>`${N}${R}=${O},`,"");if(BL(p)&&u!=="_self")return _5(e||"",u),new RE(null);const w=window.open(e||"",u,b);Ut(w,r,"popup-blocked");try{w.focus()}catch{}return new RE(w)}function _5(r,e){const t=document.createElement("a");t.href=r,t.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E5="__/auth/handler",S5="emulator/auth/handler",I5=encodeURIComponent("fac");async function PE(r,e,t,s,a,l){Ut(r.config.authDomain,r,"auth-domain-config-required"),Ut(r.config.apiKey,r,"invalid-api-key");const c={apiKey:r.config.apiKey,appName:r.name,authType:t,redirectUrl:s,v:Cd,eventId:a};if(e instanceof A1){e.setDefaultLanguage(r.languageCode),c.providerId=e.providerId||"",gD(e.getCustomParameters())||(c.customParameters=JSON.stringify(e.getCustomParameters()));for(const[b,w]of Object.entries({}))c[b]=w}if(e instanceof Bf){const b=e.getScopes().filter(w=>w!=="");b.length>0&&(c.scopes=b.join(","))}r.tenantId&&(c.tid=r.tenantId);const u=c;for(const b of Object.keys(u))u[b]===void 0&&delete u[b];const m=await r._getAppCheckToken(),p=m?`#${I5}=${encodeURIComponent(m)}`:"";return`${T5(r)}?${If(u).slice(1)}${p}`}function T5({config:r}){return r.emulator?Gw(r,S5):`https://${r.authDomain}/${E5}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tb="webStorageSupport";class C5{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=F1,this._completeRedirectFn=Z3,this._overrideRedirectResult=Y3}async _openPopup(e,t,s,a){rl(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const l=await PE(e,t,s,x0(),a);return j5(e,l,Jw())}async _openRedirect(e,t,s,a){await this._originValidation(e);const l=await PE(e,t,s,x0(),a);return R3(l),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:a,promise:l}=this.eventManagers[t];return a?Promise.resolve(a):(rl(l,"If manager is not set, promise should be"),l)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){const t=await x5(e),s=new t5(e);return t.register("authEvent",a=>(Ut(a?.authEvent,e,"invalid-auth-event"),{status:s.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Tb,{type:Tb},a=>{const l=a?.[0]?.[Tb];l!==void 0&&t(!!l),ba(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=a5(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return E1()||b1()||Ww()}}const A5=C5;var kE="@firebase/auth",OE="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D5{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(s=>{e(s?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ut(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R5(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function P5(r){bd(new fc("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),l=e.getProvider("app-check-internal"),{apiKey:c,authDomain:u}=s.options;Ut(c&&!c.includes(":"),"invalid-api-key",{appName:s.name});const m={apiKey:c,authDomain:u,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:S1(r)},p=new KL(s,a,l,m);return i3(p,t),p},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),bd(new fc("auth-internal",e=>{const t=_c(e.getProvider("auth").getImmediate());return(s=>new D5(s))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ka(kE,OE,R5(r)),Ka(kE,OE,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k5=300,O5=xS("authIdTokenMaxAge")||k5;let ME=null;const M5=r=>async e=>{const t=e&&await e.getIdTokenResult(),s=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>O5)return;const a=t?.token;ME!==a&&(ME=a,await fetch(r,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function H1(r=k0()){const e=Tf(r,"auth");if(e.isInitialized())return e.getImmediate();const t=r3(r,{popupRedirectResolver:A5,persistence:[z3,C3,F1]}),s=xS("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const l=new URL(s,location.origin);if(location.origin===l.origin){const c=M5(l.toString());E3(t,c,()=>c(t.currentUser)),_3(t,u=>c(u))}}const a=fS("auth");return a&&a3(t,`http://${a}`),t}function L5(){return document.getElementsByTagName("head")?.[0]??document}YL({loadJS(r){return new Promise((e,t)=>{const s=document.createElement("script");s.setAttribute("src",r),s.onload=e,s.onerror=a=>{const l=Ja("internal-error");l.customData=a,t(l)},s.type="text/javascript",s.charset="UTF-8",L5().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});P5("Browser");let v0;try{v0={apiKey:"AIzaSyCF4OZxfGELDmooid5mAL51l0t7Cxx6W3k",authDomain:"tender-74a2b.firebaseapp.com",projectId:"tender-74a2b",storageBucket:"tender-74a2b.firebasestorage.app",messagingSenderId:"300993197682",appId:"1:300993197682:web:e75fab78c4d6afc91ff4eb",measurementId:"G-D2CYMMNSB8"}}catch(r){console.error("Error loading Firebase config:",r),v0={}}let Su,Ce,ri,sn;try{console.log("Initializing Firebase..."),Su=P0(v0);try{Ce=BO(Su),console.log("✅ Firestore initialized")}catch(r){console.error("Firestore initialization error:",r),Ce=null}try{ri=c1(Su),console.log("✅ Storage initialized")}catch(r){console.error("Storage initialization error:",r),ri=null}try{sn=H1(Su),console.log("✅ Auth initialized")}catch(r){console.error("Auth initialization error:",r),sn=null}console.log("✅ Firebase initialization completed")}catch(r){console.error("❌ Critical Firebase initialization error:",r),Su=null,Ce=null,ri=null,sn=null}window.addEventListener("unhandledrejection",r=>{r.reason&&r.reason.message&&(r.reason.message.includes("_getRecaptchaConfig")||r.reason.message.includes("client is offline")||r.reason.message.includes("auth/network-request-failed"))&&(console.log("🔧 Suppressed Firebase error:",r.reason.message),r.preventDefault())});console.log("🔥 Firebase services status:",{app:!!Su,database:!!Ce,storage:!!ri,auth:!!sn});class ev{constructor(e){this.collectionName=e,this.collectionRef=dt(Ce,e)}getCurrentUserId(){const e=sn.currentUser;if(!e)throw new Error("User not authenticated");return e.uid}addOwnershipFields(e,t=!1){const a={ownerId:this.getCurrentUserId(),updatedAt:_t(),version:t?GT(1):1};return t||(a.createdAt=_t()),{...e,...a}}async create(e,t={}){try{console.log(`🔥 Creating document in ${this.collectionName}:`,e);const s=this.addOwnershipFields(e,!1),a={id:crypto.randomUUID(),...s,createdAt:new Date,updatedAt:new Date,version:1,_optimistic:!0};t.onOptimisticUpdate&&t.onOptimisticUpdate(a);try{const l=await Mr(this.collectionRef,s);console.log(`✅ Document created in Firestore: ${l.id}`);const c=await this.getById(l.id);return t.updateCache&&this.updateCache(c),t.onSuccess&&t.onSuccess(c),c}catch(l){throw console.error(`❌ Firestore create failed for ${this.collectionName}:`,l),t.onRollback&&t.onRollback(a),l}}catch(s){throw console.error("Error in create operation:",s),new Error(`فشل في إنشاء ${this.collectionName}: ${s.message}`)}}async update(e,t,s={}){try{console.log(`🔥 Updating document ${e} in ${this.collectionName}:`,t);const a=ht(Ce,this.collectionName,e),l=await hs(a);if(!l.exists())throw new Error("Document not found");const c=l.data(),u=this.getCurrentUserId();if(c.ownerId!==u)throw new Error("Unauthorized to update this document");const m=this.addOwnershipFields(t,!0),p={id:e,...c,...t,updatedAt:new Date,version:(c.version||1)+1,_optimistic:!0};s.onOptimisticUpdate&&s.onOptimisticUpdate(p);try{await Zs(a,m),console.log(`✅ Document updated in Firestore: ${e}`);const b=await this.getById(e);return s.updateCache&&this.updateCache(b),s.onSuccess&&s.onSuccess(b),b}catch(b){throw console.error(`❌ Firestore update failed for ${this.collectionName}:`,b),s.onRollback&&s.onRollback(c),b}}catch(a){throw a.message==="Document not found"?console.log(`📄 Document not found in ${this.collectionName} - will be handled by caller`):console.error("Error in update operation:",a),new Error(`فشل في تحديث ${this.collectionName}: ${a.message}`)}}async delete(e,t={}){try{console.log(`🔥 Deleting document ${e} from ${this.collectionName}`);const s=ht(Ce,this.collectionName,e),a=await hs(s);if(!a.exists())throw new Error("Document not found");const l=a.data(),c=this.getCurrentUserId();if(l.ownerId!==c)throw new Error("Unauthorized to delete this document");t.onOptimisticUpdate&&t.onOptimisticUpdate(null);try{return await er(s),console.log(`✅ Document deleted from Firestore: ${e}`),t.updateCache&&this.removeFromCache(e),t.onSuccess&&t.onSuccess(),!0}catch(u){throw console.error(`❌ Firestore delete failed for ${this.collectionName}:`,u),t.onRollback&&t.onRollback(l),u}}catch(s){throw console.error("Error in delete operation:",s),new Error(`فشل في حذف ${this.collectionName}: ${s.message}`)}}async getById(e){try{const t=ht(Ce,this.collectionName,e),s=await hs(t);if(s.exists()){const a=s.data(),l=this.getCurrentUserId();if(a.ownerId!==l)throw new Error("Unauthorized to access this document");return{id:s.id,...a,createdAt:a.createdAt?.toDate(),updatedAt:a.updatedAt?.toDate()}}else return null}catch(t){throw console.error("Error fetching document by ID:",t),new Error(`فشل في جلب ${this.collectionName}: ${t.message}`)}}async getAll(e={}){try{const t=this.getCurrentUserId();let s=Gt(this.collectionRef,Sn("ownerId","==",t));e.limit&&(s=Gt(s,XO(e.limit)));const l=(await At(s)).docs.map(c=>{const u=c.data();return{id:c.id,...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate()}});return console.log(`✅ Retrieved ${l.length} documents from ${this.collectionName}`),e.updateCache&&this.setCacheAll(l),l}catch(t){throw console.error("Error fetching all documents:",t),new Error(`فشل في جلب ${this.collectionName}: ${t.message}`)}}async search(e,t=[],s={}){try{const a=this.getCurrentUserId(),l=Gt(this.collectionRef,Sn("ownerId","==",a)),m=(await At(l)).docs.map(p=>{const b=p.data();return{id:p.id,...b,createdAt:b.createdAt?.toDate(),updatedAt:b.updatedAt?.toDate()}}).filter(p=>t.some(b=>{const w=p[b];return typeof w=="string"?w.toLowerCase().includes(e.toLowerCase()):!1}));return console.log(`✅ Found ${m.length} matching documents in ${this.collectionName}`),m}catch(a){throw console.error("Error searching documents:",a),new Error(`فشل في البحث في ${this.collectionName}: ${a.message}`)}}async batchOperation(e){try{const t=Zo(Ce),s=this.getCurrentUserId();for(const a of e){const{type:l,id:c,data:u}=a;if(l==="create"){const m=ht(this.collectionRef),p=this.addOwnershipFields(u,!1);t.set(m,p)}else if(l==="update"){const m=ht(Ce,this.collectionName,c),p=await hs(m);if(p.exists()&&p.data().ownerId!==s)throw new Error(`Unauthorized to update document ${c}`);const b=this.addOwnershipFields(u,!0);t.update(m,b)}else if(l==="delete"){const m=ht(Ce,this.collectionName,c),p=await hs(m);if(p.exists()&&p.data().ownerId!==s)throw new Error(`Unauthorized to delete document ${c}`);t.delete(m)}}return await t.commit(),console.log(`✅ Batch operation completed for ${this.collectionName}`),!0}catch(t){throw console.error("Error in batch operation:",t),new Error(`فشل في العملية المجمعة لـ ${this.collectionName}: ${t.message}`)}}getCacheKey(){return`firestore_cache_${this.collectionName}`}updateCache(e){try{const t=this.getCacheKey(),s=JSON.parse(localStorage.getItem(t)||"[]"),a=s.findIndex(l=>l.id===e.id);a>=0?s[a]={...e,_cached:!0,_cachedAt:Date.now(),_checksum:this.generateChecksum(e)}:s.push({...e,_cached:!0,_cachedAt:Date.now(),_checksum:this.generateChecksum(e)}),localStorage.setItem(t,JSON.stringify(s))}catch(t){console.warn("Cache update failed:",t)}}setCacheAll(e){try{const t=this.getCacheKey(),s=e.map(a=>({...a,_cached:!0,_cachedAt:Date.now(),_checksum:this.generateChecksum(a)}));localStorage.setItem(t,JSON.stringify(s))}catch(t){console.warn("Cache set all failed:",t)}}removeFromCache(e){try{const t=this.getCacheKey(),a=JSON.parse(localStorage.getItem(t)||"[]").filter(l=>l.id!==e);localStorage.setItem(t,JSON.stringify(a))}catch(t){console.warn("Cache remove failed:",t)}}getFromCache(){try{const e=this.getCacheKey(),t=localStorage.getItem(e);return t?JSON.parse(t):[]}catch(e){return console.warn("Cache read failed:",e),[]}}generateChecksum(e){const t=JSON.stringify(e);let s=0;for(let a=0;a<t.length;a++){const l=t.charCodeAt(a);s=(s<<5)-s+l,s=s&s}return s.toString()}validateCacheIntegrity(e,t){const s=e._checksum,a=this.generateChecksum(t);return s===a}}const F5="modulepreload",U5=function(r){return"/"+r},LE={},Ds=function(e,t,s){let a=Promise.resolve();if(t&&t.length>0){let p=function(b){return Promise.all(b.map(w=>Promise.resolve(w).then(N=>({status:"fulfilled",value:N}),N=>({status:"rejected",reason:N}))))};var c=p;document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),m=u?.nonce||u?.getAttribute("nonce");a=p(t.map(b=>{if(b=U5(b),b in LE)return;LE[b]=!0;const w=b.endsWith(".css"),N=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${b}"]${N}`))return;const R=document.createElement("link");if(R.rel=w?"stylesheet":F5,w||(R.as="script"),R.crossOrigin="",R.href=b,m&&R.setAttribute("nonce",m),document.head.appendChild(R),w)return new Promise((O,G)=>{R.addEventListener("load",O),R.addEventListener("error",()=>G(new Error(`Unable to preload CSS for ${b}`)))})}))}function l(u){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=u,window.dispatchEvent(m),!m.defaultPrevented)throw u}return a.then(u=>{for(const m of u||[])m.status==="rejected"&&l(m.reason);return e().catch(l)})};let N0;try{N0={apiKey:"AIzaSyCF4OZxfGELDmooid5mAL51l0t7Cxx6W3k",authDomain:"tender-74a2b.firebaseapp.com",projectId:"tender-74a2b",storageBucket:"tender-74a2b.firebasestorage.app",messagingSenderId:"300993197682",appId:"1:300993197682:web:e75fab78c4d6afc91ff4eb",measurementId:"G-D2CYMMNSB8"}}catch(r){console.error("Error loading Firebase config:",r),N0={}}let Iu,ef,Ag,to;try{console.log("🔥 Initializing Firebase with offline persistence..."),Iu=P0(N0);try{ef=$O(Iu,{localCache:tM({tabManager:iM()}),ignoreUndefinedProperties:!0}),console.log("✅ Firestore initialized with offline persistence")}catch(r){console.error("❌ Firestore initialization error:",r),ef=null}try{Ag=c1(Iu),console.log("✅ Storage initialized")}catch(r){console.error("❌ Storage initialization error:",r),Ag=null}try{to=H1(Iu),console.log("✅ Auth initialized")}catch(r){console.error("❌ Auth initialization error:",r),to=null}console.log("✅ Firebase initialization completed with offline persistence")}catch(r){console.error("❌ Critical Firebase initialization error:",r),Iu=null,ef=null,Ag=null,to=null}window.addEventListener("unhandledrejection",r=>{if(r.reason&&r.reason.message){const e=r.reason.message.toLowerCase();(e.includes("_getrecaptchaconfig")||e.includes("client is offline")||e.includes("auth/network-request-failed")||e.includes("failed to get document because the client is offline")||e.includes("the operation was aborted"))&&(console.log("🔧 Suppressed Firebase error:",r.reason.message),r.preventDefault())}});console.log("🔥 Firebase services status:",{app:!!Iu,database:!!ef,storage:!!Ag,auth:!!to,offlinePersistence:!!ef});class V5 extends ev{constructor(){super("usersettings"),this.currentUserId=null,this.settings={},this.listeners=new Set}async initialize(){try{if(!to.currentUser)throw new Error("User not authenticated");return this.currentUserId=to.currentUser.uid,await this.loadSettings(),this.settings}catch(e){return console.error("Error initializing user settings:",e),{}}}async loadSettings(){try{if(!this.currentUserId)throw new Error("User not initialized");const e=await this.getById(this.currentUserId);return e?this.settings=e.settings||{}:await this.createDefaultSettings(),this.notifyListeners(),this.settings}catch(e){return console.error("Error loading settings:",e),{}}}async createDefaultSettings(){try{const e={activityTimelineVisible:!1,sidebarCollapsed:!1,theme:"light",language:"ar",tablePageSize:10,defaultOrderBy:"createdAt",defaultSortDirection:"desc",showNotifications:!0,notificationSound:!0,autoSaveForms:!0,confirmBeforeDelete:!0,showHelpTips:!0,compactMode:!1},t={userId:this.currentUserId,settings:e,version:1};return await this.create(t),this.settings=e,e}catch(e){return console.error("Error creating default settings:",e),{}}}getSetting(e,t=null){return this.settings[e]!==void 0?this.settings[e]:t}async setSetting(e,t){try{this.currentUserId||await this.initialize(),this.settings[e]=t,this.notifyListeners();const s={...this.settings,[e]:t};try{await this.update(this.currentUserId,{settings:s,lastUpdated:new Date})}catch(a){if(a.message.includes("Document not found"))console.log("📄 Creating new user settings document for:",this.currentUserId),await this.create({id:this.currentUserId,ownerId:this.currentUserId,settings:s,createdAt:new Date,lastUpdated:new Date}),console.log("✅ User settings document created successfully");else throw a}return console.log(`✅ Setting updated: ${e} = ${t}`),!0}catch(s){return console.error(`Error setting ${e}:`,s),delete this.settings[e],this.notifyListeners(),!1}}async setSettings(e){try{this.currentUserId||await this.initialize();const t={...this.settings};Object.assign(this.settings,e),this.notifyListeners();const s={...this.settings,...e};return await this.update(this.currentUserId,{settings:s,lastUpdated:new Date}),console.log("✅ Multiple settings updated:",Object.keys(e)),!0}catch(t){return console.error("Error setting multiple settings:",t),this.settings=oldSettings,this.notifyListeners(),!1}}async resetSettings(){try{return await this.createDefaultSettings(),await this.update(this.currentUserId,{settings:this.settings,lastUpdated:new Date}),console.log("✅ Settings reset to defaults"),!0}catch(e){return console.error("Error resetting settings:",e),!1}}addListener(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(){this.listeners.forEach(e=>{try{e(this.settings)}catch(t){console.error("Error in settings listener:",t)}})}exportSettings(){return{userId:this.currentUserId,settings:this.settings,exportedAt:new Date().toISOString()}}async importSettings(e){try{return e.settings?(await this.setSettings(e.settings),console.log("✅ Settings imported successfully"),!0):!1}catch(t){return console.error("Error importing settings:",t),!1}}async setActivityTimelineVisible(e){return await this.setSetting("activityTimelineVisible",e)}getActivityTimelineVisible(){return this.getSetting("activityTimelineVisible",!1)}async setSidebarCollapsed(e){return await this.setSetting("sidebarCollapsed",e)}getSidebarCollapsed(){return this.getSetting("sidebarCollapsed",!1)}async setTheme(e){return await this.setSetting("theme",e)}getTheme(){return this.getSetting("theme","light")}async setTablePageSize(e){return await this.setSetting("tablePageSize",e)}getTablePageSize(){return this.getSetting("tablePageSize",10)}}const oi=new V5;to.onAuthStateChanged(async r=>{if(r)try{await oi.initialize(),console.log("✅ User settings initialized")}catch(e){console.error("Error initializing user settings:",e)}else oi.currentUserId=null,oi.settings={}});const G1=j.createContext(),Hn=()=>{const r=j.useContext(G1);if(!r)throw new Error("useActivityTimeline must be used within an ActivityTimelineProvider");return r},z5=({children:r})=>{const[e,t]=j.useState(!1),[s,a]=j.useState(!0);j.useEffect(()=>{(async()=>{try{await oi.initialize();const m=oi.getActivityTimelineVisible();t(m),console.log("✅ Activity timeline visibility loaded from Firestore:",m)}catch(m){console.warn("⚠️ Firestore initialization failed, using fallback strategies:",m.message);try{const b=localStorage.getItem("activityTimelineVisible")==="true";t(b),console.log("📝 Fallback: Timeline state loaded from localStorage:",b)}catch(p){console.warn("⚠️ localStorage fallback failed, using defaults:",p.message),t(!1),console.log("🛡️ Using default timeline state: false")}}finally{a(!1),console.log("✅ Timeline initialization completed")}})()},[]),j.useEffect(()=>{const m=setTimeout(async()=>{if(!s)try{await oi.setActivityTimelineVisible(e),console.log("✅ Activity timeline visibility saved to Firestore:",e)}catch(p){console.warn("⚠️ Failed to save timeline state to Firestore (non-critical):",p.message);try{localStorage.setItem("activityTimelineVisible",e.toString()),console.log("📝 Fallback: Timeline state saved to localStorage")}catch(b){console.warn("⚠️ localStorage fallback also failed:",b.message)}}},500);return()=>clearTimeout(m)},[e,s]);const c={isTimelineVisible:e,setIsTimelineVisible:t,toggleTimeline:async()=>{const u=!e;t(u);try{await oi.setActivityTimelineVisible(u),console.log("✅ Timeline toggle saved to Firestore:",u)}catch(m){console.warn("⚠️ Failed to save timeline toggle to Firestore (non-critical):",m.message);try{localStorage.setItem("activityTimelineVisible",u.toString()),console.log("📝 Fallback: Timeline toggle saved to localStorage")}catch(p){console.warn("⚠️ localStorage fallback failed:",p.message)}}},loading:s};return n.jsx(G1.Provider,{value:c,children:r})};class Yi{static CATEGORIES_COLLECTION="global_categories";static UNITS_COLLECTION="global_units";static async getAllCategories(){try{const e=Gt(dt(Ce,this.CATEGORIES_COLLECTION),ps("name","asc")),t=await At(e),s=[];return t.forEach(a=>{s.push({id:a.id,...a.data()})}),console.log("✅ Loaded categories:",s.length),s}catch(e){throw console.error("❌ Error loading categories:",e),new Error("فشل في تحميل الفئات")}}static async createCategory(e){try{const t={...e,createdAt:_t(),updatedAt:_t()},s=await Mr(dt(Ce,this.CATEGORIES_COLLECTION),t);return console.log("✅ Category created:",s.id),s.id}catch(t){throw console.error("❌ Error creating category:",t),new Error("فشل في إنشاء الفئة")}}static async updateCategory(e,t){try{const s={...t,updatedAt:_t()};return await Zs(ht(Ce,this.CATEGORIES_COLLECTION,e),s),console.log("✅ Category updated:",e),!0}catch(s){throw console.error("❌ Error updating category:",s),new Error("فشل في تحديث الفئة")}}static async deleteCategory(e){try{return await er(ht(Ce,this.CATEGORIES_COLLECTION,e)),console.log("✅ Category deleted:",e),!0}catch(t){throw console.error("❌ Error deleting category:",t),new Error("فشل في حذف الفئة")}}static async getAllUnits(){try{const e=Gt(dt(Ce,this.UNITS_COLLECTION),ps("name","asc")),t=await At(e),s=[];return t.forEach(a=>{s.push({id:a.id,...a.data()})}),console.log("✅ Loaded units:",s.length),s}catch(e){throw console.error("❌ Error loading units:",e),new Error("فشل في تحميل الوحدات")}}static async createUnit(e){try{const t={...e,createdAt:_t(),updatedAt:_t()},s=await Mr(dt(Ce,this.UNITS_COLLECTION),t);return console.log("✅ Unit created:",s.id),s.id}catch(t){throw console.error("❌ Error creating unit:",t),new Error("فشل في إنشاء الوحدة")}}static async updateUnit(e,t){try{const s={...t,updatedAt:_t()};return await Zs(ht(Ce,this.UNITS_COLLECTION,e),s),console.log("✅ Unit updated:",e),!0}catch(s){throw console.error("❌ Error updating unit:",s),new Error("فشل في تحديث الوحدة")}}static async deleteUnit(e){try{return await er(ht(Ce,this.UNITS_COLLECTION,e)),console.log("✅ Unit deleted:",e),!0}catch(t){throw console.error("❌ Error deleting unit:",t),new Error("فشل في حذف الوحدة")}}static async getCategoryNames(){try{return(await this.getAllCategories()).map(t=>t.name)}catch(e){return console.error("❌ Error loading category names:",e),[]}}static async getUnitNames(){try{return(await this.getAllUnits()).map(t=>t.name)}catch(e){return console.error("❌ Error loading unit names:",e),[]}}static async initializeDefaultSettings(){try{if(console.log("🚀 Initializing default settings..."),(await this.getAllCategories()).length===0){console.log("📝 Creating default categories...");const s=[{name:"مواد البناء",description:"مواد البناء والإنشاءات",isDefault:!0},{name:"الأدوات والمعدات",description:"الأدوات والمعدات المختلفة",isDefault:!0},{name:"المواد الكهربائية",description:"المواد والمعدات الكهربائية",isDefault:!0},{name:"مواد السباكة",description:"مواد وأدوات السباكة",isDefault:!0},{name:"مواد التشطيب",description:"مواد التشطيب والديكور",isDefault:!0}];for(const a of s)await this.createCategory(a);console.log("✅ Default categories created")}if((await this.getAllUnits()).length===0){console.log("📝 Creating default units...");const s=[{name:"قطعة",description:"العدد بالقطع",isDefault:!0},{name:"متر",description:"وحدة الطول",isDefault:!0},{name:"متر مربع",description:"وحدة المساحة",isDefault:!0},{name:"متر مكعب",description:"وحدة الحجم",isDefault:!0},{name:"كيلو جرام",description:"وحدة الوزن",isDefault:!0},{name:"لتر",description:"وحدة السعة",isDefault:!0},{name:"طن",description:"وحدة الوزن الثقيل",isDefault:!0},{name:"صندوق",description:"العبوة الصندوقية",isDefault:!0}];for(const a of s)await this.createUnit(a);console.log("✅ Default units created")}return console.log("✅ Settings initialization completed"),!0}catch(e){throw console.error("❌ Error initializing default settings:",e),new Error("فشل في تهيئة الإعدادات الافتراضية")}}}const bs={SET_LOADING:"SET_LOADING",SET_ERROR:"SET_ERROR",SET_CATEGORIES:"SET_CATEGORIES",SET_UNITS:"SET_UNITS",ADD_CATEGORY:"ADD_CATEGORY",UPDATE_CATEGORY:"UPDATE_CATEGORY",REMOVE_CATEGORY:"REMOVE_CATEGORY",ADD_UNIT:"ADD_UNIT",UPDATE_UNIT:"UPDATE_UNIT",REMOVE_UNIT:"REMOVE_UNIT",SET_INITIALIZED:"SET_INITIALIZED"},$5={categories:[],units:[],loading:{categories:!0,units:!0,initializing:!0},error:{categories:null,units:null},initialized:!1,lastUpdated:{categories:null,units:null}},B5=(r,e)=>{switch(e.type){case bs.SET_LOADING:return{...r,loading:{...r.loading,[e.payload.type]:e.payload.loading}};case bs.SET_ERROR:return{...r,error:{...r.error,[e.payload.type]:e.payload.error}};case bs.SET_CATEGORIES:return{...r,categories:e.payload,loading:{...r.loading,categories:!1},error:{...r.error,categories:null},lastUpdated:{...r.lastUpdated,categories:new Date().toISOString()}};case bs.SET_UNITS:return{...r,units:e.payload,loading:{...r.loading,units:!1},error:{...r.error,units:null},lastUpdated:{...r.lastUpdated,units:new Date().toISOString()}};case bs.ADD_CATEGORY:return{...r,categories:[...r.categories,e.payload].sort((t,s)=>t.name.localeCompare(s.name)),lastUpdated:{...r.lastUpdated,categories:new Date().toISOString()}};case bs.UPDATE_CATEGORY:return{...r,categories:r.categories.map(t=>t.id===e.payload.id?{...t,...e.payload.data}:t).sort((t,s)=>t.name.localeCompare(s.name)),lastUpdated:{...r.lastUpdated,categories:new Date().toISOString()}};case bs.REMOVE_CATEGORY:return{...r,categories:r.categories.filter(t=>t.id!==e.payload),lastUpdated:{...r.lastUpdated,categories:new Date().toISOString()}};case bs.ADD_UNIT:return{...r,units:[...r.units,e.payload].sort((t,s)=>t.name.localeCompare(s.name)),lastUpdated:{...r.lastUpdated,units:new Date().toISOString()}};case bs.UPDATE_UNIT:return{...r,units:r.units.map(t=>t.id===e.payload.id?{...t,...e.payload.data}:t).sort((t,s)=>t.name.localeCompare(s.name)),lastUpdated:{...r.lastUpdated,units:new Date().toISOString()}};case bs.REMOVE_UNIT:return{...r,units:r.units.filter(t=>t.id!==e.payload),lastUpdated:{...r.lastUpdated,units:new Date().toISOString()}};case bs.SET_INITIALIZED:return{...r,initialized:!0,loading:{...r.loading,initializing:!1}};default:return r}},Q1=j.createContext(),q5=({children:r})=>{const[e,t]=j.useReducer(B5,$5);j.useEffect(()=>{console.log("🔥 Setting up real-time Firebase listeners for global settings...");let m,p;return(async()=>{try{await Yi.initializeDefaultSettings();const w=Gt(dt(Ce,Yi.CATEGORIES_COLLECTION),ps("name","asc"));m=vf(w,R=>{console.log("📋 Categories updated from Firebase:",R.docs.length);const O=R.docs.map(G=>({id:G.id,...G.data()}));t({type:bs.SET_CATEGORIES,payload:O})},R=>{console.error("❌ Categories listener error:",R),t({type:bs.SET_ERROR,payload:{type:"categories",error:R.message}})});const N=Gt(dt(Ce,Yi.UNITS_COLLECTION),ps("name","asc"));p=vf(N,R=>{console.log("📏 Units updated from Firebase:",R.docs.length);const O=R.docs.map(G=>({id:G.id,...G.data()}));t({type:bs.SET_UNITS,payload:O})},R=>{console.error("❌ Units listener error:",R),t({type:bs.SET_ERROR,payload:{type:"units",error:R.message}})}),t({type:bs.SET_INITIALIZED}),console.log("✅ Real-time listeners initialized successfully")}catch(w){console.error("❌ Failed to setup Firebase listeners:",w),t({type:bs.SET_ERROR,payload:{type:"categories",error:"Failed to initialize settings"}}),t({type:bs.SET_ERROR,payload:{type:"units",error:"Failed to initialize settings"}})}})(),()=>{console.log("🧹 Cleaning up Firebase listeners..."),m&&m(),p&&p()}},[]),j.useEffect(()=>{const m=p=>{p.key==="settings_force_refresh"&&console.log("🔄 Cross-tab settings refresh triggered")};return window.addEventListener("storage",m),()=>window.removeEventListener("storage",m)},[]);const s=j.useCallback((m,p)=>{t({type:bs.UPDATE_CATEGORY,payload:{id:m,data:p}})},[]),a=j.useCallback((m,p)=>{t({type:bs.UPDATE_UNIT,payload:{id:m,data:p}})},[]),l=j.useMemo(()=>({getCategoryNames:()=>e.categories.map(m=>m.name),getUnitNames:()=>e.units.map(m=>m.name),getCategoriesWithDetails:()=>e.categories.map(m=>({value:m.name,label:m.name,description:m.description,isDefault:m.isDefault})),getUnitsWithDetails:()=>e.units.map(m=>({value:m.name,label:m.name,name:m.name,description:m.description,isDefault:m.isDefault})),findCategoryByName:m=>e.categories.find(p=>p.name===m),findUnitByName:m=>e.units.find(p=>p.name===m),isReady:()=>e.initialized&&!e.loading.categories&&!e.loading.units,isLoading:()=>e.loading.categories||e.loading.units||e.loading.initializing}),[e.categories,e.units,e.initialized,e.loading]),c=j.useCallback(()=>{console.log("🔄 Force refreshing settings...");const m=new CustomEvent("settings_force_refresh",{detail:{timestamp:Date.now()}});window.dispatchEvent(m)},[]),u=j.useMemo(()=>({categories:e.categories,units:e.units,loading:e.loading,error:e.error,initialized:e.initialized,lastUpdated:e.lastUpdated,...l,dispatch:t,optimisticCategoryUpdate:s,optimisticUnitUpdate:a,forceRefresh:c,ACTIONS:bs}),[e,l,s,a,c]);return n.jsx(Q1.Provider,{value:u,children:r})},Hf=()=>{const r=j.useContext(Q1);return r||(console.warn("useSettings must be used within a SettingsProvider - returning default values"),{categories:[],units:[],loading:{categories:!0,units:!0,initializing:!0},error:{categories:null,units:null},initialized:!1,lastUpdated:{categories:null,units:null},getCategoryNames:()=>[],getUnitNames:()=>[],getCategoriesWithDetails:()=>[],getUnitsWithDetails:()=>[],findCategoryByName:()=>null,findUnitByName:()=>null,isReady:()=>!1,isLoading:()=>!0,dispatch:()=>{},optimisticCategoryUpdate:()=>{},optimisticUnitUpdate:()=>{},forceRefresh:()=>{},ACTIONS:bs})},H5=()=>{const r=Hf(),{categories:e=[],getCategoryNames:t=()=>[],getCategoriesWithDetails:s=()=>[],findCategoryByName:a=()=>null,loading:l={categories:!0},error:c={categories:null},isReady:u=()=>!1}=r||{};return j.useMemo(()=>({categories:e,categoryNames:t(),categoriesWithDetails:s(),findByName:a,loading:l.categories||!1,error:c.categories,isReady:u()&&e.length>0}),[e,t,s,a,l.categories,c.categories,u])},G5=()=>{const r=Hf(),{units:e=[],getUnitNames:t=()=>[],getUnitsWithDetails:s=()=>[],findUnitByName:a=()=>null,loading:l={units:!0},error:c={units:null},isReady:u=()=>!1}=r||{};return j.useMemo(()=>({units:e,unitNames:t(),unitsWithDetails:s(),findByName:a,loading:l.units||!1,error:c.units,isReady:u()&&e.length>0}),[e,t,s,a,l.units,c.units,u])},Mn=({show:r=!0,size:e="medium",overlay:t=!0,message:s="جاري التحميل..."})=>{if(!r)return null;const a=()=>{switch(e){case"small":return"spinner-small";case"large":return"spinner-large";default:return"spinner-medium"}},l=n.jsxs("div",{className:`modern-spinner-container ${a()}`,children:[n.jsxs("div",{className:"modern-spinner",children:[n.jsx("div",{className:"spinner-ring"}),n.jsx("div",{className:"spinner-ring"}),n.jsx("div",{className:"spinner-ring"}),n.jsx("div",{className:"spinner-ring"})]}),s&&n.jsx("div",{className:"spinner-message",children:s})]});return t?n.jsx("div",{className:"modern-spinner-overlay",children:l}):l},W1=j.createContext(),tv=()=>{const r=j.useContext(W1);if(!r)throw new Error("useAuth must be used within an AuthProvider");return r},Q5=({children:r})=>{const[e,t]=j.useState(null),[s,a]=j.useState(null),[l,c]=j.useState(!0),[u,m]=j.useState(null),p=async N=>{try{if(!N)return a(null),null;const R=ht(Ce,"employees",N.uid),O=await hs(R);if(console.log("📄 Employee doc exists:",O.exists()),!O.exists())return console.warn("❌ No employee record found for user:",N.uid),console.warn("💡 This usually means the employee document was not created with the Auth UID"),console.log('🔧 To fix: Run window.createEmployeeForUser("'+N.uid+'") in console'),m("لا يوجد حساب موظف مرتبط بهذا المستخدم - تحقق من وحدة التحكم لإنشاء الحساب"),null;const G=O.data();return console.log("📊 Employee data:",G),G.status!=="active"?(console.warn("❌ Employee account is not active:",G.status),m("حسابك غير نشط. يرجى التواصل مع الإدارة"),null):(console.log("✅ Employee access granted:",{uid:N.uid,name:G.fullName,email:G.email,role:G.role||"employee"}),a(G),m(null),G)}catch(R){return console.error("❌ Employee access check failed:",R),console.error("❌ Error details:",R),m(`خطأ في التحقق من صلاحيات الموظف: ${R.message}`),a(null),null}},b=async()=>{try{await S3(sn),t(null),a(null),m(null),console.log("✅ Sign out successful")}catch(N){console.error("❌ Sign out error:",N)}};if(j.useEffect(()=>{console.log("🔧 Setting up auth state listener...");let N;try{N=Xw(sn,async R=>{console.log("🔄 Auth state changed:",R?`User: ${R.uid}`:"No user"),c(!0);try{R?(console.log("👤 User authenticated, checking employee access..."),t(R),await p(R)):(console.log("👋 User signed out, showing login page"),t(null),a(null),m(null))}catch(O){if(O.message&&O.message.includes("_getRecaptchaConfig")){console.log("🔧 [AuthContext] Ignored reCAPTCHA error:",O.message);return}console.error("❌ Auth state change error:",O),m("خطأ في تحديث حالة المصادقة")}finally{c(!1)}})}catch(R){R.message&&R.message.includes("_getRecaptchaConfig")?console.log("🔧 [AuthContext] Ignored reCAPTCHA setup error:",R.message):(console.error("❌ Auth listener setup error:",R),m("خطأ في إعداد نظام المصادقة")),c(!1)}return()=>{if(console.log("🔧 Cleaning up auth listener"),N)try{N()}catch(R){R.message&&R.message.includes("_getRecaptchaConfig")?console.log("🔧 [AuthContext] Ignored reCAPTCHA cleanup error:",R.message):console.error("❌ Auth cleanup error:",R)}}},[]),j.useEffect(()=>{if(l){const N=setTimeout(()=>{console.log("⚠️ Authentication timeout - proceeding with demo mode"),c(!1),t({uid:"demo-user",email:"demo@demo.com"}),a({fullName:"Demo User",email:"demo@demo.com",status:"active",role:"admin"})},2e3);return()=>clearTimeout(N)}},[l]),l)return n.jsx("div",{className:"min-vh-100 d-flex align-items-center justify-content-center bg-light",children:n.jsxs("div",{className:"text-center",children:[n.jsx(Mn,{size:"large"}),n.jsxs("div",{className:"mt-3",children:[n.jsx("h5",{className:"text-muted",children:"جار تحميل النظام..."}),n.jsx("p",{className:"text-muted small",children:"يرجى الانتظار"}),n.jsx("p",{className:"text-muted small",children:"سيتم التحميل تلقائياً خلال 5 ثواني..."})]})]})});const w={currentUser:e,employeeData:s,authError:u,signOut:b,isAuthenticated:!!(e&&s&&s.status==="active"),isLoading:l,checkEmployeeAccess:p};return n.jsx(W1.Provider,{value:w,children:r})},Tn=({show:r,onClose:e,title:t,message:s,type:a="info",onConfirm:l,confirmText:c="تأكيد",cancelText:u="إلغاء",showCancel:m=!1})=>{if(!r)return null;const p=()=>{switch(a){case"success":return{icon:"bi-check-circle-fill",color:"text-success",bgColor:"bg-success"};case"error":return{icon:"bi-exclamation-triangle-fill",color:"text-danger",bgColor:"bg-danger"};case"warning":return{icon:"bi-exclamation-triangle",color:"text-warning",bgColor:"bg-warning"};case"confirm":return{icon:"bi-question-circle-fill",color:"text-primary",bgColor:"bg-primary"};default:return{icon:"bi-info-circle-fill",color:"text-info",bgColor:"bg-info"}}},{icon:b,color:w,bgColor:N}=p(),R=()=>{console.log("CustomAlert handleConfirm called"),console.log("onConfirm:",l),console.log("onClose:",e),l&&(console.log("Calling onConfirm"),l()),console.log("Calling onClose"),e()},O=()=>{e()};return n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},children:n.jsx("div",{className:"modal-dialog modal-dialog-centered modal-sm",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",overflow:"hidden"},children:[n.jsx("div",{className:"modal-header border-0 text-white p-3",style:{background:a==="error"?"linear-gradient(135deg, #dc3545 0%, #b02a37 100%)":a==="success"?"linear-gradient(135deg, #28a745 0%, #1e7e34 100%)":a==="warning"?"linear-gradient(135deg, #ffc107 0%, #e0a800 100%)":a==="confirm"?"linear-gradient(135deg, #007bff 0%, #0056b3 100%)":"linear-gradient(135deg, #17a2b8 0%, #138496 100%)"},children:n.jsxs("div",{className:"d-flex align-items-center w-100 justify-content-center",children:[n.jsx("i",{className:`${b} me-2`,style:{fontSize:"20px"}}),n.jsx("h6",{className:"modal-title mb-0 fw-bold",children:t})]})}),n.jsx("div",{className:"modal-body py-4 px-4",children:n.jsx("div",{className:"text-center",children:n.jsx("p",{className:"mb-0",style:{fontSize:"14px",lineHeight:"1.5",color:"#333"},children:s})})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-4 d-flex justify-content-center",children:n.jsxs("div",{className:"d-flex gap-3",children:[m&&n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:O,autoFocus:!0,tabIndex:"1",style:{borderRadius:"8px",height:"36px",fontSize:"13px",fontWeight:"600",width:"80px",background:"linear-gradient(135deg, #6c757d 0%, #495057 100%)",border:"none",color:"white"},children:u}),n.jsx("button",{type:"button",className:"btn btn-sm",onClick:R,autoFocus:!1,tabIndex:m?"2":"1",style:{borderRadius:"8px",height:"36px",fontSize:"13px",fontWeight:"600",width:m?"80px":"100px",background:a==="error"?"linear-gradient(135deg, #dc3545 0%, #b02a37 100%)":a==="success"?"linear-gradient(135deg, #28a745 0%, #1e7e34 100%)":a==="warning"?"linear-gradient(135deg, #ffc107 0%, #e0a800 100%)":"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none",color:a==="warning"?"#000":"#fff"},children:c})]})})]})})})},Cn=()=>{const[r,e]=j.useState({show:!1,title:null,message:null,type:"info",onConfirm:null,confirmText:"تأكيد",cancelText:"إلغاء",showCancel:!1}),[t,s]=j.useState(!1);j.useEffect(()=>{console.log("alertConfig changed:",r)},[r]);const a=()=>{if(t){console.log("closeAlert already in progress, ignoring");return}console.log("closeAlert called"),console.log("Current alertConfig before close:",r),s(!0),e(N=>(console.log("Setting show to false"),{...N,show:!1})),setTimeout(()=>{s(!1)},100)},l=N=>{console.log("showAlert called with config:",N);const R={show:!0,title:N.title||"تنبيه",message:N.message||"",type:N.type||"info",onConfirm:N.onConfirm||null,confirmText:N.confirmText||"تأكيد",cancelText:N.cancelText||"إلغاء",showCancel:N.showCancel||!1};console.log("Setting alertConfig to:",R),e(R)};return{alertConfig:r,closeAlert:a,showAlert:l,showSuccess:(N,R="نجح العملية")=>{console.log("showSuccess called:",N,R),l({title:R,message:N,type:"success",confirmText:"حسناً",onConfirm:null})},showError:(N,R="خطأ")=>{l({title:R,message:N,type:"error",confirmText:"حسناً"})},showWarning:(N,R="تحذير")=>{l({title:R,message:N,type:"warning",confirmText:"حسناً"})},showInfo:(N,R="معلومات")=>{l({title:R,message:N,type:"info",confirmText:"حسناً"})},showConfirm:(N,R,O="تأكيد العملية")=>{l({title:O,message:N,type:"confirm",onConfirm:R,confirmText:"تأكيد",cancelText:"إلغاء",showCancel:!0})},showDeleteConfirm:(N,R,O="تأكيد الحذف")=>{l({title:O,message:N,type:"confirm",onConfirm:R,confirmText:"حذف",cancelText:"إلغاء",showCancel:!0})}}},W5=({onSignIn:r})=>{const[e,t]=j.useState({email:"",password:"",rememberMe:!1}),[s,a]=j.useState(!1),[l,c]=j.useState({}),[u,m]=j.useState(!1),{alertConfig:p,closeAlert:b,showError:w,showSuccess:N}=Cn(),[R,O]=j.useState("");j.useEffect(()=>{O("animate-in"),(async()=>{try{await oi.initialize();const ie=oi.getSetting("rememberedEmail");ie&&t(X=>({...X,email:ie,rememberMe:!0}))}catch(ie){console.error("Error loading remembered email:",ie)}})()},[]);const G=Z=>{const{name:ie,value:X,type:pe,checked:H}=Z.target;t(B=>({...B,[ie]:pe==="checkbox"?H:X})),l[ie]&&c(B=>({...B,[ie]:""}))},U=()=>{const Z={};return e.email.trim()?/\S+@\S+\.\S+/.test(e.email)||(Z.email="البريد الإلكتروني غير صحيح"):Z.email="البريد الإلكتروني مطلوب",e.password.trim()?e.password.length<6&&(Z.password="كلمة المرور يجب أن تكون 6 أحرف على الأقل"):Z.password="كلمة المرور مطلوبة",c(Z),Object.keys(Z).length===0},T=async Z=>{try{const ie=ht(Ce,"employees",Z),X=await hs(ie);if(!X.exists())throw new Error("لا يوجد حساب موظف مرتبط بهذا البريد الإلكتروني");const pe=X.data();if(pe.status!=="active")throw new Error("حسابك غير نشط. يرجى التواصل مع الإدارة");try{await Zs(ht(Ce,"employees",Z),{lastLoginAt:_t(),loginCount:GT(1),updatedAt:_t()})}catch(H){console.log("Login tracking update failed:",H)}return pe}catch(ie){throw console.error("Employee status check failed:",ie),ie}},ee=async Z=>{if(Z.preventDefault(),!!U()){a(!0);try{const ie=await v3(sn,e.email.trim(),e.password),X=await T(ie.user.uid);e.rememberMe?await oi.setSetting("rememberedEmail",e.email.trim()):await oi.removeSetting("rememberedEmail"),console.log("✅ Sign-in successful:",{uid:ie.user.uid,email:ie.user.email,employeeName:X.fullName,role:X.role||"employee"}),N(`مرحباً بك، ${X.fullName}`,"تم تسجيل الدخول بنجاح"),r&&r({user:ie.user,employee:X})}catch(ie){console.error("Sign-in error:",ie);let X="خطأ في تسجيل الدخول";switch(ie.code){case"auth/user-not-found":case"auth/wrong-password":case"auth/invalid-credential":X="البريد الإلكتروني أو كلمة المرور غير صحيحة";break;case"auth/user-disabled":X="تم تعطيل هذا الحساب. يرجى التواصل مع الإدارة";break;case"auth/too-many-requests":X="محاولات كثيرة جداً. يرجى المحاولة لاحقاً";break;case"auth/network-request-failed":X="خطأ في الاتصال. يرجى التحقق من الإنترنت";break;default:X=ie.message||"خطأ غير معروف";break}w(X,"فشل في تسجيل الدخول")}finally{a(!1)}}};return n.jsxs("div",{className:`login-page ${R}`,children:[n.jsx("div",{className:"login-background",children:n.jsx("div",{className:"login-container",children:n.jsxs("div",{className:"row min-vh-100 g-0",children:[n.jsx("div",{className:"col-lg-6",children:n.jsxs("div",{className:"login-form-panel",children:[n.jsxs("div",{className:"login-form-container",children:[n.jsxs("div",{className:"mobile-logo d-lg-none text-center mb-4",children:[n.jsx("div",{className:"logo-circle-small",children:n.jsx("i",{className:"bi bi-building-fill"})}),n.jsx("h4",{className:"mt-3 mb-0",children:"نظام إدارة المناقصات"}),n.jsx("p",{className:"text-muted small",children:"تسجيل دخول الموظفين"})]}),n.jsxs("div",{className:"login-form",children:[n.jsxs("div",{className:"form-header text-center mb-4",children:[n.jsx("h3",{className:"login-title",children:"تسجيل الدخول"}),n.jsx("p",{className:"login-subtitle text-muted",children:"أدخل بياناتك للوصول إلى النظام"})]}),n.jsxs("form",{onSubmit:ee,className:"needs-validation",noValidate:!0,children:[n.jsxs("div",{className:"form-group mb-3",children:[n.jsx("label",{className:"form-label",children:"البريد الإلكتروني"}),n.jsxs("div",{className:"input-group input-group-modern",children:[n.jsx("span",{className:"input-group-text",children:n.jsx("i",{className:"bi bi-envelope"})}),n.jsx("input",{type:"email",className:`form-control ${l.email?"is-invalid":""}`,name:"email",value:e.email,onChange:G,placeholder:"أدخل بريدك الإلكتروني",disabled:s,autoComplete:"email"}),l.email&&n.jsx("div",{className:"invalid-feedback",children:l.email})]})]}),n.jsxs("div",{className:"form-group mb-3",children:[n.jsx("label",{className:"form-label",children:"كلمة المرور"}),n.jsxs("div",{className:"input-group input-group-modern",children:[n.jsx("span",{className:"input-group-text",children:n.jsx("i",{className:"bi bi-lock"})}),n.jsx("input",{type:u?"text":"password",className:`form-control ${l.password?"is-invalid":""}`,name:"password",value:e.password,onChange:G,placeholder:"أدخل كلمة المرور",disabled:s,autoComplete:"current-password"}),n.jsx("button",{type:"button",className:"input-group-text btn-show-password",onClick:()=>m(!u),disabled:s,children:n.jsx("i",{className:`bi ${u?"bi-eye-slash":"bi-eye"}`})}),l.password&&n.jsx("div",{className:"invalid-feedback",children:l.password})]})]}),n.jsx("div",{className:"form-group mb-4",children:n.jsxs("div",{className:"form-check",children:[n.jsx("input",{className:"form-check-input",type:"checkbox",name:"rememberMe",checked:e.rememberMe,onChange:G,id:"rememberMe",disabled:s}),n.jsx("label",{className:"form-check-label",htmlFor:"rememberMe",children:"تذكرني في هذا الجهاز"})]})}),n.jsx("button",{type:"submit",className:"btn btn-login w-100",disabled:s,children:s?n.jsxs(n.Fragment,{children:[n.jsx(Mn,{size:"small"}),n.jsx("span",{className:"ms-2",children:"جار تسجيل الدخول..."})]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-box-arrow-in-right me-2"}),"تسجيل الدخول"]})})]}),n.jsx("div",{className:"security-notice mt-4",children:n.jsxs("div",{className:"notice-card",children:[n.jsx("div",{className:"notice-icon",children:n.jsx("i",{className:"bi bi-shield-fill-check text-success"})}),n.jsxs("div",{className:"notice-content",children:[n.jsx("h6",{className:"mb-1",children:"نظام آمن ومحمي"}),n.jsx("p",{className:"mb-0 small text-muted",children:"هذا النظام مخصص للموظفين المعتمدين فقط. جميع الأنشطة مراقبة ومسجلة لضمان الأمان."})]})]})})]})]}),n.jsx("div",{className:"login-footer",children:n.jsx("p",{className:"text-center text-muted small mb-0",children:"© 2024 نظام إدارة المناقصات. جميع الحقوق محفوظة."})})]})}),n.jsx("div",{className:"col-lg-6 d-none d-lg-flex",children:n.jsxs("div",{className:"login-brand-panel",children:[n.jsxs("div",{className:"brand-content",children:[n.jsx("div",{className:"company-logo mb-4",children:n.jsx("div",{className:"logo-circle",children:n.jsx("i",{className:"bi bi-building-fill"})})}),n.jsxs("div",{className:"company-info text-center mb-5",children:[n.jsx("h2",{className:"company-name",children:"نظام إدارة المناقصات"}),n.jsx("p",{className:"company-subtitle",children:"منصة متكاملة لإدارة المناقصات والموردين"}),n.jsxs("div",{className:"company-features mt-4",children:[n.jsxs("div",{className:"feature-item",children:[n.jsx("i",{className:"bi bi-check-circle-fill feature-icon"}),n.jsx("span",{children:"إدارة شاملة للمناقصات"})]}),n.jsxs("div",{className:"feature-item",children:[n.jsx("i",{className:"bi bi-check-circle-fill feature-icon"}),n.jsx("span",{children:"تتبع دقيق للموردين"})]}),n.jsxs("div",{className:"feature-item",children:[n.jsx("i",{className:"bi bi-check-circle-fill feature-icon"}),n.jsx("span",{children:"تقارير مفصلة وتحليلات"})]})]})]})]}),n.jsxs("div",{className:"decorative-elements",children:[n.jsx("div",{className:"floating-card floating-1",children:n.jsx("i",{className:"bi bi-graph-up text-primary"})}),n.jsx("div",{className:"floating-card floating-2",children:n.jsx("i",{className:"bi bi-people text-info"})}),n.jsx("div",{className:"floating-card floating-3",children:n.jsx("i",{className:"bi bi-award text-warning"})})]})]})})]})})}),n.jsx(Tn,{show:p.show,onClose:b,title:p.title,message:p.message,type:p.type,onConfirm:p.onConfirm,confirmText:p.confirmText,cancelText:p.cancelText,showCancel:p.showCancel})]})},K5=({onSignIn:r})=>n.jsx(W5,{onSignIn:r}),Y5=({children:r})=>{const{currentUser:e,employeeData:t,authError:s,isAuthenticated:a,isLoading:l}=tv(),{alertConfig:c,closeAlert:u,showError:m}=Cn();return QE.useEffect(()=>{s&&m(s,"خطأ في المصادقة")},[s,m]),l?null:(console.log("🔍 ProtectedRoute Debug:",{isAuthenticated:a,hasCurrentUser:!!e,currentUserUid:e?.uid,hasEmployeeData:!!t,employeeDataStatus:t?.status,isLoading:l}),!a||!e||!t?n.jsxs(n.Fragment,{children:[n.jsx(K5,{onSignIn:p=>{console.log("✅ User signed in successfully:",p)}}),n.jsx(Tn,{show:c.show,onClose:u,title:c.title,message:c.message,type:c.type,onConfirm:c.onConfirm,confirmText:c.confirmText,cancelText:c.cancelText,showCancel:c.showCancel})]}):(console.log("🚀 SUCCESS! Rendering dashboard for authenticated user:",t.fullName),console.log("🎉 Navigation successful - user will see dashboard now"),n.jsx("div",{className:"app-wrapper",children:r})))},X5=({children:r})=>n.jsx(Q5,{children:n.jsx(Y5,{children:r})}),K1="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNTguNDMgMTUxLjI4Ij4KICA8ZGVmcz4KICAgIDxzdHlsZT4KICAgICAgLmNscy0xIHsKICAgICAgICBmaWxsOiAjMTBhMGMxOwogICAgICB9CgogICAgICAuY2xzLTIgewogICAgICAgIGZvbnQtZmFtaWx5OiBDYWlyby1Cb2xkLCBDYWlybzsKICAgICAgICBmb250LXNpemU6IDY1cHg7CiAgICAgICAgZm9udC13ZWlnaHQ6IDcwMDsKICAgICAgfQoKICAgICAgLmNscy0zIHsKICAgICAgICBmaWxsOiAjMTg2MmE0OwogICAgICB9CgogICAgICAuY2xzLTQgewogICAgICAgIGZpbGw6IG5vbmU7CiAgICAgICAgc3Ryb2tlOiAjMTg2MmE0OwogICAgICAgIHN0cm9rZS1taXRlcmxpbWl0OiAxMDsKICAgICAgICBzdHJva2Utd2lkdGg6IDRweDsKICAgICAgfQogICAgPC9zdHlsZT4KICA8L2RlZnM+CiAgPGc+CiAgICA8bGluZSBjbGFzcz0iY2xzLTQiIHgxPSIzLjQzIiB5MT0iMTQ1LjIzIiB4Mj0iMzU4LjQzIiB5Mj0iMTQ1LjIzIi8+CiAgICA8bGluZSBjbGFzcz0iY2xzLTMiIHgxPSIzLjQzIiB5MT0iMTQ1LjIzIiB4Mj0iMzU4LjQzIiB5Mj0iMTQ1LjIzIi8+CiAgPC9nPgogIDxwb2x5bGluZSBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMS4xMiA2My44NCA4NC42MSA3LjY0IDk4LjcyIDE0Ljk3IDk4LjcyIDIgMTA4Ljk4IDIgMTA4Ljk4IDE5LjE3IDIwMi43IDY0Ljk4IDM1Mi4yNyA2Mi45NiIvPgogIDx0ZXh0IGNsYXNzPSJjbHMtMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTUuMzQgMTIzLjMzKSI+PHRzcGFuIGNsYXNzPSJjbHMtMSIgeD0iMCIgeT0iMCI+TW9kZXJuIDwvdHNwYW4+PHRzcGFuIGNsYXNzPSJjbHMtMyIgeD0iMjMyLjUiIHk9IjAiPkJpbjwvdHNwYW4+PC90ZXh0Pgo8L3N2Zz4=",Y1="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='176.459'%20height='110.288'%20viewBox='0%200%20176.459%20110.288'%3e%3cg%20id='Group_1'%20data-name='Group%201'%20transform='translate(-824.544%20-530.958)'%3e%3crect%20id='Rectangle_4'%20data-name='Rectangle%204'%20width='31.194'%20height='31.194'%20transform='translate(868.659%20553.016)%20rotate(45)'%20fill='%230073d8'%20opacity='0.6'/%3e%3cpath%20id='Rectangle_11'%20data-name='Rectangle%2011'%20d='M0,0H31.194V31.194H4a4,4,0,0,1-4-4Z'%20transform='translate(846.602%20575.073)%20rotate(45)'%20fill='%230073d8'%20opacity='0.8'/%3e%3crect%20id='Rectangle_7'%20data-name='Rectangle%207'%20width='31.194'%20height='31.194'%20transform='translate(912.774%20553.016)%20rotate(45)'%20fill='%230073d8'%20opacity='0.6'/%3e%3crect%20id='Rectangle_9'%20data-name='Rectangle%209'%20width='31.194'%20height='31.194'%20transform='translate(890.716%20575.073)%20rotate(45)'%20fill='%230073d8'%20opacity='0.8'/%3e%3cpath%20id='Rectangle_13'%20data-name='Rectangle%2013'%20d='M0,0H31.194V27.194a4,4,0,0,1-4,4H0Z'%20transform='translate(912.774%20597.131)%20rotate(45)'%20fill='%230073d8'/%3e%3cpath%20id='Rectangle_14'%20data-name='Rectangle%2014'%20d='M0,0H31.194V27.194a4,4,0,0,1-4,4H0Z'%20transform='translate(868.659%20597.131)%20rotate(45)'%20fill='%230073d8'/%3e%3cpath%20id='Rectangle_15'%20data-name='Rectangle%2015'%20d='M0,0H31.194V27.194a4,4,0,0,1-4,4H0Z'%20transform='translate(956.889%20597.131)%20rotate(45)'%20fill='%230073d8'/%3e%3crect%20id='Rectangle_10'%20data-name='Rectangle%2010'%20width='31.194'%20height='31.194'%20transform='translate(934.831%20575.073)%20rotate(45)'%20fill='%230073d8'%20opacity='0.8'/%3e%3cpath%20id='Rectangle_12'%20data-name='Rectangle%2012'%20d='M0,0H27.194a4,4,0,0,1,4,4V31.194H0Z'%20transform='translate(978.946%20575.073)%20rotate(45)'%20fill='%230073d8'%20opacity='0.8'/%3e%3crect%20id='Rectangle_8'%20data-name='Rectangle%208'%20width='31.194'%20height='31.194'%20transform='translate(956.889%20553.016)%20rotate(45)'%20fill='%230073d8'%20opacity='0.6'/%3e%3cpath%20id='Rectangle_5'%20data-name='Rectangle%205'%20d='M3,0H31.194V31.194H0V3A3,3,0,0,1,3,0Z'%20transform='translate(890.716%20530.958)%20rotate(45)'%20fill='%230073d8'%20opacity='0.4'/%3e%3cpath%20id='Rectangle_6'%20data-name='Rectangle%206'%20d='M3,0H31.194V31.194H0V3A3,3,0,0,1,3,0Z'%20transform='translate(934.831%20530.958)%20rotate(45)'%20fill='%230073d8'%20opacity='0.4'/%3e%3c/g%3e%3c/svg%3e",X1="/images/user.png",J1="/images/pdf-icon.png",Z1="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='14'%20height='32'%20viewBox='0%200%2014%2032'%3e%3cpath%20id='Path_2'%20data-name='Path%202'%20d='M968.1,368.23v32l-14-15.835Z'%20transform='translate(-954.096%20-368.23)'%20fill='%23ffffff'/%3e%3c/svg%3e",J5="/images/pattern.jpg",Z5="/images/pattern2.jpg",e4="/images/pattern3.jpg",t4="/images/pattern4.jpg",n4="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='6.697'%20height='28.873'%20viewBox='0%200%206.697%2028.873'%3e%3cg%20id='Group_1'%20data-name='Group%201'%20transform='translate(-984.438%20-402.547)'%3e%3cpath%20id='Path_1'%20data-name='Path%201'%20d='M965.5,414l-5.137,6.779,4.861,7.062-4.861,7.041,5.1,7.1'%20transform='translate(25%20-11)'%20fill='none'%20stroke='%23e2dfdc'%20stroke-width='1.5'/%3e%3c/g%3e%3c/svg%3e",s4="/images/dots.svg";class r4{constructor(){this.imageCache=new Map,this.initializeImages()}initializeImages(){this.images={"logo.svg":K1,"logo-sm.svg":Y1,"user.png":X1,"pdf-icon.png":J1,"menu-arrow.svg":Z1,"pattern.jpg":J5,"pattern2.jpg":Z5,"pattern3.jpg":e4,"pattern4.jpg":t4,"curve-line.svg":n4,"dots.svg":s4}}getImage(e){return this.images[e]?this.images[e]:`/images/${e}`}getAllImages(){return this.images}injectImageCSS(){if(typeof document>"u")return;const e=document.createElement("style");e.id="senior-react-images";const t=document.getElementById("senior-react-images");t&&t.remove();const s=[":root {",`  --image-logo: url("${this.getImage("logo.svg")}");`,`  --image-logo-sm: url("${this.getImage("logo-sm.svg")}");`,`  --image-user: url("${this.getImage("user.png")}");`,`  --image-pdf-icon: url("${this.getImage("pdf-icon.png")}");`,`  --image-menu-arrow: url("${this.getImage("menu-arrow.svg")}");`,`  --image-pattern: url("${this.getImage("pattern.jpg")}");`,`  --image-pattern2: url("${this.getImage("pattern2.jpg")}");`,`  --image-pattern3: url("${this.getImage("pattern3.jpg")}");`,`  --image-pattern4: url("${this.getImage("pattern4.jpg")}");`,`  --image-curve-line: url("${this.getImage("curve-line.svg")}");`,`  --image-dots: url("${this.getImage("dots.svg")}");`,"}","","/* Fix main.scss background images */",".pattern-bg:nth-child(1) { background: var(--image-pattern) !important; }",".pattern-bg:nth-child(2) { background: var(--image-pattern2) !important; }",".pattern-bg:nth-child(3) { background: var(--image-pattern3) !important; }",".pattern-bg:nth-child(4) { background: var(--image-pattern4) !important; }","","/* Fix menu arrow in CSS */",".sidebar-menu > li.active > a::after,",".menu-arrow::before { background: var(--image-menu-arrow) !important; }","","/* Fix curve line */",".curve-line { background: var(--image-curve-line) repeat-y !important; }","","/* Fix dots */",".dots-bg { background: var(--image-dots) no-repeat !important; }"];e.textContent=s.join(`
`),document.head.appendChild(e)}}const j0=new r4,i4=r=>j0.getImage(r);typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>j0.injectImageCSS(),100)}):setTimeout(()=>j0.injectImageCSS(),100));function Yn({isCollapsed:r}){const e=al(),[t,s]=j.useState("dashboard"),[a,l]=j.useState(!1),[c,u]=j.useState(!1),[m,p]=j.useState(!1),[b,w]=j.useState(!1);j.useEffect(()=>{const oe=e.pathname;oe==="/"||oe==="/tender"?(s("dashboard"),u(!1)):oe==="/raw-materials"?(s("raw-materials"),u(!0)):oe==="/local-products"?(s("local-product"),u(!0)):oe==="/foreign-products"?(s("imported-product"),u(!0)):oe==="/suppliers/local"?(s("local-suppliers"),p(!0),u(!1)):oe==="/suppliers/foreign"?(s("foreign-suppliers"),p(!0),u(!1)):oe==="/clients"?(s("clients"),u(!1)):oe==="/companies"?(s("companies"),u(!1)):oe==="/tenders/list"?(s("list"),l(!0),u(!1)):oe==="/tenders/add"||oe.startsWith("/tenders/edit/")?(s("add"),l(!0),u(!1)):oe==="/tenders/tracking"?(s("tracking"),l(!0),u(!1)):oe==="/employees"?(s("employees"),w(!0),u(!1)):(s("dashboard"),u(!1))},[e.pathname]);const N=[{id:"dashboard",type:"main",component:"dashboard"},{id:"tenders",type:"treeview",component:"tenders"},{id:"tender-details",type:"treeview",component:"tender-details"},{id:"suppliers",type:"treeview",component:"suppliers"},{id:"clients",type:"main",component:"clients"},{id:"companies",type:"main",component:"companies"},{id:"hr",type:"treeview",component:"hr"}],R=[{id:"list",type:"sub",component:"list"},{id:"add",type:"sub",component:"add"},{id:"tracking",type:"sub",component:"tracking"}],O=[{id:"raw-materials",type:"sub",component:"raw-materials"},{id:"local-product",type:"sub",component:"local-product"},{id:"imported-product",type:"sub",component:"imported-product"},{id:"manufactured-product",type:"sub",component:"manufactured-product"}],G=[{id:"local-suppliers",type:"sub",component:"local-suppliers"},{id:"foreign-suppliers",type:"sub",component:"foreign-suppliers"}],U=[{id:"employees",type:"sub",component:"employees"}],T=(oe,Ue)=>{try{const Je=localStorage.getItem(oe);if(Je){const lt=JSON.parse(Je);if(Array.isArray(lt)&&lt.length===Ue.length)return lt}}catch(Je){console.error("Error loading saved order:",Je)}return Ue},[ee,Z]=j.useState(()=>T("sidebar-menu-items",N)),[ie,X]=j.useState(()=>T("sidebar-tender-sub-items",R)),[pe,H]=j.useState(()=>T("sidebar-tender-detail-sub-items",O)),[B,k]=j.useState(()=>T("sidebar-supplier-sub-items",G)),[W,J]=j.useState(()=>T("sidebar-hr-sub-items",U));j.useEffect(()=>{localStorage.setItem("sidebar-menu-items",JSON.stringify(ee))},[ee]),j.useEffect(()=>{localStorage.setItem("sidebar-tender-sub-items",JSON.stringify(ie))},[ie]),j.useEffect(()=>{localStorage.setItem("sidebar-tender-detail-sub-items",JSON.stringify(pe))},[pe]),j.useEffect(()=>{localStorage.setItem("sidebar-supplier-sub-items",JSON.stringify(B))},[B]),j.useEffect(()=>{localStorage.setItem("sidebar-hr-sub-items",JSON.stringify(W))},[W]);const[z,L]=j.useState(()=>{try{const oe=localStorage.getItem("sidebar-sort-enabled");return oe!==null?JSON.parse(oe):!1}catch{return!1}});j.useEffect(()=>{localStorage.setItem("sidebar-sort-enabled",JSON.stringify(z))},[z]);const de=()=>{L(!z)},[Pe,V]=j.useState(null),[se,fe]=j.useState(null),re=(oe,Ue,Je)=>{V(Ue),fe(Je),oe.dataTransfer.effectAllowed="move"},_=oe=>{oe.preventDefault(),oe.dataTransfer.dropEffect="move"},E=(oe,Ue,Je)=>{if(oe.preventDefault(),!(!Pe||Pe.id===Ue.id||se!==Je)){if(Je==="main"){const lt=[...ee],Dt=lt.findIndex(Ze=>Ze.id===Pe.id),Ht=lt.findIndex(Ze=>Ze.id===Ue.id);lt.splice(Dt,1),lt.splice(Ht,0,Pe),Z(lt)}else if(Je==="tender-sub"){const lt=[...ie],Dt=lt.findIndex(Ze=>Ze.id===Pe.id),Ht=lt.findIndex(Ze=>Ze.id===Ue.id);lt.splice(Dt,1),lt.splice(Ht,0,Pe),X(lt)}else if(Je==="tender-detail-sub"){const lt=[...pe],Dt=lt.findIndex(Ze=>Ze.id===Pe.id),Ht=lt.findIndex(Ze=>Ze.id===Ue.id);lt.splice(Dt,1),lt.splice(Ht,0,Pe),H(lt)}else if(Je==="supplier-sub"){const lt=[...B],Dt=lt.findIndex(Ze=>Ze.id===Pe.id),Ht=lt.findIndex(Ze=>Ze.id===Ue.id);lt.splice(Dt,1),lt.splice(Ht,0,Pe),k(lt)}else if(Je==="hr-sub"){const lt=[...W],Dt=lt.findIndex(Ze=>Ze.id===Pe.id),Ht=lt.findIndex(Ze=>Ze.id===Ue.id);lt.splice(Dt,1),lt.splice(Ht,0,Pe),J(lt)}V(null),fe(null)}},D=()=>{V(null),fe(null)},F=oe=>n.jsx("li",{className:t==="dashboard"?"active current-page":"",style:r?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:Pe&&Pe.id===oe.id?.5:1,transition:"opacity 0.2s ease"},draggable:!r&&z,onDragStart:z?Ue=>re(Ue,oe,"main"):void 0,onDragOver:z?_:void 0,onDrop:z?Ue=>E(Ue,oe,"main"):void 0,onDragEnd:z?D:void 0,children:n.jsxs(Ho,{to:"/tender",onClick:Ue=>{if(Ue.target.closest(".drag-handle")){Ue.preventDefault();return}s("dashboard")},style:r?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",width:"100%"},children:[!r&&z&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),n.jsx("i",{className:"bi bi-pie-chart",style:r?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:t==="dashboard"?"#0073d8 !important":"transparent !important",color:t==="dashboard"?"white !important":"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!r&&n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:"لوحة التحكم"})]})},oe.id),te=oe=>n.jsxs("li",{className:`treeview ${a?"open":""}`,style:r?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:Pe&&Pe.id===oe.id?.5:1,transition:"opacity 0.2s ease"},"data-collapsed":r,draggable:!r&&z,onDragStart:z?Ue=>re(Ue,oe,"main"):void 0,onDragOver:z?_:void 0,onDrop:z?Ue=>E(Ue,oe,"main"):void 0,onDragEnd:z?D:void 0,children:[n.jsxs("a",{href:"#!",onClick:Ue=>{if(Ue.target.closest(".drag-handle")){Ue.preventDefault();return}l(!a)},style:r?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",color:"#4d4d4d !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",color:"#4d4d4d",width:"100%"},children:[!r&&z&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),n.jsx("i",{className:"bi bi-box-seam",style:r?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:"transparent !important",color:"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!r&&n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:"المناقصات"})]}),a&&!r&&n.jsx("ul",{className:"treeview-menu",children:ie.map(Ue=>Q(Ue))})]},oe.id),$=oe=>n.jsxs("li",{className:`treeview ${c?"open":""}`,style:r?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:Pe&&Pe.id===oe.id?.5:1,transition:"opacity 0.2s ease"},"data-collapsed":r,draggable:!r&&z,onDragStart:z?Ue=>re(Ue,oe,"main"):void 0,onDragOver:z?_:void 0,onDrop:z?Ue=>E(Ue,oe,"main"):void 0,onDragEnd:z?D:void 0,children:[n.jsxs("a",{href:"#!",onClick:Ue=>{if(Ue.target.closest(".drag-handle")){Ue.preventDefault();return}u(!c)},style:r?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",color:"#4d4d4d !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",color:"#4d4d4d",width:"100%"},children:[!r&&z&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),n.jsx("i",{className:"bi bi-clipboard-data",style:r?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:"transparent !important",color:"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!r&&n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:"بنود المناقصات"})]}),c&&!r&&n.jsx("ul",{className:"treeview-menu",children:pe.map(Ue=>me(Ue))})]},oe.id),Q=oe=>{const Je={list:{to:"/tenders/list",icon:"bi-list-ul",text:"جميع المناقصات"},add:{to:"/tenders/add",icon:"bi-plus-circle",text:"إضافة مناقصة"},tracking:{to:"/tenders/tracking",icon:"bi-kanban",text:"متابعة المناقصات"}}[oe.id];if(!Je)return null;const lt=Ze=>{Ze.stopPropagation(),re(Ze,oe,"tender-sub")},Dt=Ze=>{Ze.stopPropagation(),_(Ze)},Ht=Ze=>{Ze.stopPropagation(),E(Ze,oe,"tender-sub")};return n.jsx("li",{className:t===oe.id?"active":"",style:{opacity:Pe&&Pe.id===oe.id?.5:1,transition:"opacity 0.2s ease"},draggable:z,onDragStart:z?lt:void 0,onDragOver:z?Dt:void 0,onDrop:z?Ht:void 0,onDragEnd:z?D:void 0,children:Je.to?n.jsxs(Ho,{to:Je.to,onClick:Ze=>{if(Ze.target.closest(".drag-handle")){Ze.preventDefault();return}s(oe.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[z&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:Ze=>Ze.stopPropagation()}),n.jsx("i",{className:Je.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:Je.text})]}):n.jsxs("a",{href:"#!",onClick:Ze=>{if(Ze.target.closest(".drag-handle")){Ze.preventDefault();return}Ze.preventDefault(),s(oe.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[z&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:Ze=>Ze.stopPropagation()}),n.jsx("i",{className:Je.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:Je.text})]})},oe.id)},me=oe=>{const Je={"raw-materials":{to:"/raw-materials",icon:"bi-gear",text:"مواد خام"},"local-product":{to:"/local-products",icon:"bi-house",text:"منتج محلي"},"imported-product":{to:"/foreign-products",icon:"bi-globe",text:"منتج مستورد"},"manufactured-product":{icon:"bi-tools",text:"منتج مصنع"}}[oe.id];if(!Je)return null;const lt=Vt=>{Vt.stopPropagation(),re(Vt,oe,"tender-detail-sub")},Dt=Vt=>{Vt.stopPropagation(),_(Vt)},Ht=Vt=>{Vt.stopPropagation(),E(Vt,oe,"tender-detail-sub")},Ze=oe.id==="raw-materials"||oe.id==="local-product"||oe.id==="imported-product";return n.jsx("li",{className:t===oe.id?"active":"",style:{opacity:Pe&&Pe.id===oe.id?.5:1,transition:"opacity 0.2s ease"},draggable:z,onDragStart:z?lt:void 0,onDragOver:z?Dt:void 0,onDrop:z?Ht:void 0,onDragEnd:z?D:void 0,children:Ze?n.jsxs(Ho,{to:Je.to,onClick:Vt=>{if(Vt.target.closest(".drag-handle")){Vt.preventDefault();return}s(oe.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[z&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:Vt=>Vt.stopPropagation()}),n.jsx("i",{className:Je.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:Je.text})]}):n.jsxs("a",{href:"#!",onClick:Vt=>{if(Vt.target.closest(".drag-handle")){Vt.preventDefault();return}Vt.preventDefault(),s(oe.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[z&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:Vt=>Vt.stopPropagation()}),n.jsx("i",{className:Je.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:Je.text})]})},oe.id)},I=oe=>{const Je={"local-suppliers":{to:"/suppliers/local",icon:"bi-house-fill",text:"مورد محلي"},"foreign-suppliers":{to:"/suppliers/foreign",icon:"bi-globe",text:"مورد أجنبي"}}[oe.id];if(!Je)return null;const lt=Ze=>{Ze.stopPropagation(),re(Ze,oe,"supplier-sub")},Dt=Ze=>{Ze.stopPropagation(),_(Ze)},Ht=Ze=>{Ze.stopPropagation(),E(Ze,oe,"supplier-sub")};return n.jsx("li",{className:t===oe.id?"active":"",style:{opacity:Pe&&Pe.id===oe.id?.5:1,transition:"opacity 0.2s ease"},draggable:z,onDragStart:z?lt:void 0,onDragOver:z?Dt:void 0,onDrop:z?Ht:void 0,onDragEnd:z?D:void 0,children:n.jsxs(Ho,{to:Je.to,onClick:Ze=>{if(Ze.target.closest(".drag-handle")){Ze.preventDefault();return}s(oe.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[z&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:Ze=>Ze.stopPropagation()}),n.jsx("i",{className:Je.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:Je.text})]})},oe.id)},le=oe=>n.jsxs("li",{className:`treeview ${m?"open":""}`,style:r?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:Pe&&Pe.id===oe.id?.5:1,transition:"opacity 0.2s ease"},"data-collapsed":r,draggable:!r&&z,onDragStart:z?Ue=>re(Ue,oe,"main"):void 0,onDragOver:z?_:void 0,onDrop:z?Ue=>E(Ue,oe,"main"):void 0,onDragEnd:z?D:void 0,children:[n.jsxs("a",{href:"#!",onClick:Ue=>{if(Ue.target.closest(".drag-handle")){Ue.preventDefault();return}p(!m)},style:r?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",color:"#4d4d4d !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",color:"#4d4d4d",width:"100%"},children:[!r&&z&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),n.jsx("i",{className:"bi bi-people-fill",style:r?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:"transparent !important",color:"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!r&&n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:"الموردون"})]}),m&&!r&&n.jsx("ul",{className:"treeview-menu",children:B.map(Ue=>I(Ue))})]},oe.id),We=oe=>n.jsx("li",{className:t==="clients"?"active current-page":"",style:r?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:Pe&&Pe.id===oe.id?.5:1,transition:"opacity 0.2s ease"},draggable:!r&&z,onDragStart:z?Ue=>re(Ue,oe,"main"):void 0,onDragOver:z?_:void 0,onDrop:z?Ue=>E(Ue,oe,"main"):void 0,onDragEnd:z?D:void 0,children:n.jsxs(Ho,{to:"/clients",onClick:Ue=>{if(Ue.target.closest(".drag-handle")){Ue.preventDefault();return}s("clients")},style:r?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",width:"100%"},children:[!r&&z&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),n.jsx("i",{className:"bi bi-person-vcard-fill",style:r?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:t==="clients"?"#0073d8 !important":"transparent !important",color:t==="clients"?"white !important":"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!r&&n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:"العملاء"})]})},oe.id),nt=oe=>n.jsx("li",{className:t==="companies"?"active current-page":"",style:r?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:Pe&&Pe.id===oe.id?.5:1,transition:"opacity 0.2s ease"},draggable:!r&&z,onDragStart:z?Ue=>re(Ue,oe,"main"):void 0,onDragOver:z?_:void 0,onDrop:z?Ue=>E(Ue,oe,"main"):void 0,onDragEnd:z?D:void 0,children:n.jsxs(Ho,{to:"/companies",onClick:Ue=>{if(Ue.target.closest(".drag-handle")){Ue.preventDefault();return}s("companies")},style:r?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",width:"100%"},children:[!r&&z&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),n.jsx("i",{className:"bi bi-building",style:r?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:t==="companies"?"#0073d8 !important":"transparent !important",color:t==="companies"?"white !important":"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!r&&n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:"الشركات"})]})},oe.id),mt=oe=>{const Je={employees:{to:"/employees",icon:"bi-person-badge-fill",text:"الموظفين"}}[oe.id];if(!Je)return null;const lt=Ze=>{Ze.stopPropagation(),re(Ze,oe,"hr-sub")},Dt=Ze=>{Ze.stopPropagation(),_(Ze)},Ht=Ze=>{Ze.stopPropagation(),E(Ze,oe,"hr-sub")};return n.jsx("li",{className:t===oe.id?"active":"",style:{opacity:Pe&&Pe.id===oe.id?.5:1,transition:"opacity 0.2s ease"},draggable:z,onDragStart:z?lt:void 0,onDragOver:z?Dt:void 0,onDrop:z?Ht:void 0,onDragEnd:z?D:void 0,children:n.jsxs(Ho,{to:Je.to,onClick:Ze=>{if(Ze.target.closest(".drag-handle")){Ze.preventDefault();return}s(oe.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[z&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:Ze=>Ze.stopPropagation()}),n.jsx("i",{className:Je.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:Je.text})]})},oe.id)},It=oe=>n.jsxs("li",{className:`treeview ${b?"open":""}`,style:r?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:Pe&&Pe.id===oe.id?.5:1,transition:"opacity 0.2s ease"},"data-collapsed":r,draggable:!r&&z,onDragStart:z?Ue=>re(Ue,oe,"main"):void 0,onDragOver:z?_:void 0,onDrop:z?Ue=>E(Ue,oe,"main"):void 0,onDragEnd:z?D:void 0,children:[n.jsxs("a",{href:"#!",onClick:Ue=>{if(Ue.target.closest(".drag-handle")){Ue.preventDefault();return}w(!b)},style:r?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",color:"#4d4d4d !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",color:"#4d4d4d",width:"100%"},children:[!r&&z&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),n.jsx("i",{className:"bi bi-person-workspace",style:r?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:"transparent !important",color:"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!r&&n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:"الموارد البشرية"})]}),b&&!r&&n.jsx("ul",{className:"treeview-menu",children:W.map(Ue=>mt(Ue))})]},oe.id),rn=oe=>{switch(oe.component){case"dashboard":return F(oe);case"tenders":return te(oe);case"tender-details":return $(oe);case"suppliers":return le(oe);case"clients":return We(oe);case"companies":return nt(oe);case"hr":return It(oe);default:return null}};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"shop-profile",style:{padding:r?"0.5rem":"1rem",textAlign:r?"center":"right",display:"flex",alignItems:"center",justifyContent:r?"center":"flex-end"},children:r?n.jsx("img",{src:i4("logo.svg"),alt:"Modern Bin",style:{width:"40px",height:"40px",objectFit:"contain"}}):n.jsxs(n.Fragment,{children:[n.jsx("p",{className:"mb-1 fw-bold text-primary",style:{opacity:r?0:1,transition:"opacity 0.3s ease"},children:"شركة الحاويات الحديثة"}),n.jsx("p",{className:"m-0",style:{opacity:r?0:1,transition:"opacity 0.3s ease"},children:"للمقاولات"})]})}),n.jsxs("div",{className:"sidebarMenuScroll",style:{position:"relative"},children:[n.jsx("ul",{className:"sidebar-menu",children:ee.map(oe=>rn(oe))}),n.jsx("div",{className:"sidebar-sort-toggle",style:{position:"fixed",right:r?"15px":"20px",bottom:"20px",zIndex:1050,background:z?"#28a745":"#0d6efd",color:"white",width:r?"46px":"52px",height:r?"46px":"52px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",transition:"all 0.3s ease",transform:"scale(1)"},onClick:de,onMouseEnter:oe=>{oe.target.style.transform="scale(1.1)",oe.target.style.boxShadow="0 6px 16px rgba(0,0,0,0.2)"},onMouseLeave:oe=>{oe.target.style.transform="scale(1)",oe.target.style.boxShadow="0 4px 12px rgba(0,0,0,0.15)"},title:z?"تعطيل الترتيب":"تفعيل الترتيب",children:n.jsx("i",{className:`bi ${z?"bi-arrows-move":"bi-lock"}`,style:{fontSize:r?"18px":"20px",transition:"transform 0.2s ease"}})})]})]})}function Xn({onToggle:r}){const e=os(),{isTimelineVisible:t,toggleTimeline:s}=Hn(),{signOut:a,employeeData:l}=tv(),{alertConfig:c,closeAlert:u,showConfirm:m}=Cn(),p=()=>{m("هل أنت متأكد من تسجيل الخروج؟",async()=>{try{await a(),console.log("✅ تم تسجيل الخروج بنجاح")}catch(b){console.error("❌ خطأ في تسجيل الخروج:",b)}},"تأكيد تسجيل الخروج")};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"app-header-wrapper",children:n.jsxs("div",{className:"app-header d-flex align-items-center justify-content-between px-3",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("button",{onClick:r,type:"button",style:{border:"0",borderRight:"1px solid #e8ebf4",background:"transparent",marginLeft:"10px",padding:"1.35rem 1.5rem",cursor:"pointer",marginBottom:"-11px"},children:n.jsx("i",{className:"bi bi-list lh-1",style:{color:"#0073d8",fontSize:"1.8rem"}})}),n.jsxs("div",{className:"app-brand py-2",style:{marginTop:"-8px",marginRight:"-20px"},children:[n.jsx("a",{href:"/",className:"d-sm-block d-none",children:n.jsx("img",{src:"/Tender-app/images/logo.svg",className:"logo",alt:"Modern Bin",style:{height:"40px",width:"auto"}})}),n.jsx("a",{href:"/",className:"d-sm-none d-block",children:n.jsx("img",{src:"/Tender-app/images/logo-sm.svg",className:"logo",alt:"Modern Bin",style:{height:"40px",width:"auto"}})})]})]}),n.jsxs("div",{className:"header-actions d-lg-flex d-none",children:[n.jsx("div",{className:"settings-icon-container d-flex align-items-center me-3",children:n.jsx("button",{onClick:()=>e("/settings"),className:"d-flex align-items-center justify-content-center position-relative",style:{width:"48px",height:"48px",background:"linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",borderRadius:"12px",color:"#6c757d",border:"none",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},onMouseOver:b=>{const w=b.currentTarget,N=w.querySelector("i");w.style.background="linear-gradient(135deg, #007bff 0%, #0056b3 100%)",w.style.color="white",w.style.transform="translateY(-2px)",w.style.boxShadow="0 4px 15px rgba(0, 123, 255, 0.4)",N&&N.style.setProperty("color","white","important")},onMouseOut:b=>{const w=b.currentTarget,N=w.querySelector("i");w.style.background="linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",w.style.color="#6c757d",w.style.transform="translateY(0)",w.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)",N&&N.style.setProperty("color","#6c757d","important")},title:"الإعدادات",children:n.jsx("i",{className:"bi bi-gear fs-5 lh-1",style:{color:"inherit"}})})}),n.jsx("div",{className:"activity-toggle-container d-flex align-items-center me-3",children:n.jsx("button",{onClick:s,className:"d-flex align-items-center justify-content-center position-relative",style:{width:"48px",height:"48px",background:t?"linear-gradient(135deg, #007bff 0%, #0056b3 100%)":"linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",borderRadius:"12px",color:t?"white":"#6c757d",border:"none",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},onMouseOver:b=>{b.target.style.transform="translateY(-2px)",b.target.style.boxShadow="0 4px 15px rgba(0, 0, 0, 0.15)"},onMouseOut:b=>{b.target.style.transform="translateY(0)",b.target.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)"},title:t?"إخفاء الأنشطة":"إظهار الأنشطة",children:n.jsx("i",{className:`bi ${t?"bi-clock-history":"bi-clock"} fs-5 lh-1`})})}),n.jsx("div",{className:"logout-button-container d-flex align-items-center me-3",children:n.jsx("button",{onClick:p,className:"d-flex align-items-center justify-content-center position-relative",style:{width:"48px",height:"48px",background:"linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",borderRadius:"12px",color:"#6c757d",border:"none",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},onMouseOver:b=>{const w=b.currentTarget,N=w.querySelector("i");w.style.background="linear-gradient(135deg, #dc3545 0%, #c82333 100%)",w.style.color="white",w.style.transform="translateY(-2px)",w.style.boxShadow="0 4px 15px rgba(220, 53, 69, 0.4)",N&&N.style.setProperty("color","white","important")},onMouseOut:b=>{const w=b.currentTarget,N=w.querySelector("i");w.style.background="linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",w.style.color="#6c757d",w.style.transform="translateY(0)",w.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)",N&&N.style.setProperty("color","#6c757d","important")},title:"تسجيل الخروج",children:n.jsx("i",{className:"bi bi-box-arrow-right fs-5 lh-1",style:{color:"inherit"}})})}),n.jsx("div",{className:"trash-icon-container d-flex align-items-center me-3",children:n.jsx("button",{onClick:()=>e("/trash"),className:"d-flex align-items-center justify-content-center position-relative",style:{width:"48px",height:"48px",background:"linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",borderRadius:"12px",color:"#6c757d",border:"none",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},onMouseOver:b=>{const w=b.currentTarget,N=w.querySelector("i");w.style.background="linear-gradient(135deg, #dc3545 0%, #c82333 100%)",w.style.color="white",w.style.transform="translateY(-2px)",w.style.boxShadow="0 4px 15px rgba(220, 53, 69, 0.4)",N&&N.style.setProperty("color","white","important")},onMouseOut:b=>{const w=b.currentTarget,N=w.querySelector("i");w.style.background="linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",w.style.color="#6c757d",w.style.transform="translateY(0)",w.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)",N&&N.style.setProperty("color","#6c757d","important")},title:"سلة المهملات",children:n.jsx("i",{className:"bi bi-trash fs-5 lh-1",style:{color:"inherit"}})})})]}),n.jsx("div",{className:"d-flex align-items-center",children:n.jsxs("div",{className:"dropdown ms-2",children:[n.jsxs("a",{className:"dropdown-toggle d-flex py-2 align-items-center text-decoration-none",href:"#!",role:"button","data-bs-toggle":"dropdown",children:[n.jsx("img",{src:"/Tender-app/images/user.png",className:"rounded-2 img-3x",alt:"User"}),n.jsx("span",{className:"ms-2 text-truncate d-lg-block d-none",children:l?.fullName||"المستخدم"})]}),n.jsxs("div",{className:"dropdown-menu dropdown-menu-end shadow-lg",children:[n.jsxs("div",{className:"header-action-links mx-3 gap-2",children:[n.jsxs("a",{className:"dropdown-item",href:"profile.html",children:[n.jsx("i",{className:"bi bi-person text-primary"})," الملف الشخصي"]}),n.jsxs("a",{className:"dropdown-item",href:"settings.html",children:[n.jsx("i",{className:"bi bi-gear text-danger"})," الإعدادات"]}),n.jsxs("a",{className:"dropdown-item",href:"widgets.html",children:[n.jsx("i",{className:"bi bi-box text-success"})," الأدوات"]})]}),n.jsx("div",{className:"mx-3 mt-2 d-grid",children:n.jsxs("button",{onClick:p,className:"btn btn-danger btn-sm",children:[n.jsx("i",{className:"bi bi-box-arrow-right me-1"}),"تسجيل الخروج"]})})]})]})})]})}),n.jsx(Tn,{show:c.show,onClose:u,title:c.title,message:c.message,type:c.type,onConfirm:c.onConfirm,confirmText:c.confirmText,cancelText:c.cancelText,showCancel:c.showCancel})]})}function Jn(){const[r,e]=j.useState(["المبيعات"]),[t,s]=j.useState(!0),a=["المشتريات","المبيعات","الحسابات","الموظفون","التصميم"];j.useEffect(()=>{(async()=>{try{await oi.initialize();const u=oi.getSetting("sidebar-active-button");u&&e([u])}catch(u){console.error("Error loading active button:",u)}finally{s(!1)}})()},[]),j.useEffect(()=>{!t&&r.length>0&&oi.setSetting("sidebar-active-button",r[0])},[r,t]);const l=c=>{a.includes(c)&&(r.includes(c)||e([c]))};return n.jsx("div",{className:"rectangle-buttons-row px-3 py-2",style:{backgroundColor:"#e6f3ff",borderBottom:"1px solid #b3d9ff"},children:n.jsx("div",{className:"d-flex align-items-center gap-3",children:a.map((c,u)=>{const m=r.includes(c);return n.jsx("div",{className:"rectangle-button d-flex align-items-center justify-content-center",onClick:()=>l(c),style:{background:m?"linear-gradient(135deg, #007bff 0%, #0056b3 100%)":"#e9ecef",border:`1px solid ${m?"#0056b3":"#dee2e6"}`,borderRadius:"6px",padding:"4px 8px",fontSize:"12px",color:m?"white":"#212529",transition:"all 0.2s ease",cursor:"pointer",minHeight:"24px",width:"80px",textAlign:"center"},onMouseEnter:p=>{m?(p.currentTarget.style.background="linear-gradient(135deg, #0056b3 0%, #004085 100%)",p.currentTarget.style.borderColor="#004085"):(p.currentTarget.style.background="#dee2e6",p.currentTarget.style.borderColor="#ced4da")},onMouseLeave:p=>{m?(p.currentTarget.style.background="linear-gradient(135deg, #007bff 0%, #0056b3 100%)",p.currentTarget.style.borderColor="#0056b3"):(p.currentTarget.style.background="#e9ecef",p.currentTarget.style.borderColor="#dee2e6")},children:n.jsx("span",{children:c})},u)})})})}const Cb={RAW_MATERIAL:"rm",LOCAL_PRODUCT:"lp",FOREIGN_PRODUCT:"fp",MANUFACTURED_PRODUCT:"mp",TENDER:"tdr",CUSTOMER:"cst",LOCAL_SUPPLIER:"ls",FOREIGN_SUPPLIER:"fs",COMPANY:"comp",EMPLOYEE:"emp",PRICE_QUOTE:"pq",TENDER_ITEM:"ti",ORDER:"ord",INVOICE:"inv",ACTIVITY:"act",TRASH_ITEM:"trs"},kt=(r,e=null)=>{if(!Cb[r])throw new Error(`Invalid entity type: ${r}. Valid types: ${Object.keys(Cb).join(", ")}`);const t=Cb[r],s=Date.now().toString(36),a=Math.random().toString(36).substring(2,8);return e?`${t}_${e}_${s}${a}`:`${t}_${s}${a}`};class hd extends ev{constructor(){super("activitylogs"),this.currentUserId=null,this.activities=[],this.listeners=new Set,this.maxActivities=1e3}async initialize(){try{if(!to.currentUser)throw new Error("User not authenticated");return this.currentUserId=to.currentUser.uid,await this.loadActivities(),this.activities}catch(e){return console.error("Error initializing activity log:",e),[]}}async loadActivities(){try{if(!this.currentUserId)throw new Error("User not initialized");const t=(await this.getAll({limit:this.maxActivities*2})||[]).sort((s,a)=>{const l=new Date(s.createdAt);return new Date(a.createdAt)-l}).slice(0,this.maxActivities);return this.activities=t,this.notifyListeners(),console.log(`✅ Loaded ${this.activities.length} activities from Firestore (sorted client-side)`),this.activities}catch(e){return console.error("Error loading activities:",e),[]}}async logActivity(e,t,s={}){try{this.currentUserId||await this.initialize();const a={internalId:kt("ACTIVITY"),type:e,description:t,details:s,timestamp:new Date,userId:this.currentUserId,userAgent:navigator.userAgent,url:window.location.pathname};this.activities.unshift(a),this.notifyListeners();try{const l=await this.create(a),c=this.activities.findIndex(u=>u.internalId===a.internalId);return c>=0&&(this.activities[c]=l,this.notifyListeners()),this.activities.length>this.maxActivities&&await this.cleanupOldActivities(),console.log(`✅ Activity logged: ${e} - ${t}`),l}catch(l){throw console.error("Error saving activity to Firestore:",l),this.activities=this.activities.filter(c=>c.internalId!==a.internalId),this.notifyListeners(),l}}catch(a){return console.error("Error logging activity:",a),null}}getActivitiesByType(e){return this.activities.filter(t=>t.type===e)}getActivitiesByDateRange(e,t){return this.activities.filter(s=>{const a=new Date(s.timestamp);return a>=e&&a<=t})}getRecentActivities(e=50){return this.activities.slice(0,e)}searchActivities(e){const t=e.toLowerCase();return this.activities.filter(s=>s.description.toLowerCase().includes(t)||s.type.toLowerCase().includes(t)||s.details&&JSON.stringify(s.details).toLowerCase().includes(t))}async deleteActivity(e){try{return await this.delete(e),this.activities=this.activities.filter(t=>t.id!==e),this.notifyListeners(),console.log(`✅ Activity deleted: ${e}`),!0}catch(t){return console.error("Error deleting activity:",t),!1}}async clearAllActivities(){try{const e=this.activities.map(t=>this.delete(t.id).catch(s=>console.error(`Error deleting activity ${t.id}:`,s)));return await Promise.allSettled(e),this.activities=[],this.notifyListeners(),console.log("✅ All activities cleared"),!0}catch(e){return console.error("Error clearing activities:",e),!1}}async cleanupOldActivities(){try{if(this.activities.length<=this.maxActivities)return;const e=[...this.activities].sort((l,c)=>new Date(c.timestamp)-new Date(l.timestamp)),t=e.slice(0,this.maxActivities),s=e.slice(this.maxActivities),a=s.map(l=>this.delete(l.id).catch(c=>console.error(`Error deleting old activity ${l.id}:`,c)));await Promise.allSettled(a),this.activities=t,this.notifyListeners(),console.log(`✅ Cleaned up ${s.length} old activities`)}catch(e){console.error("Error cleaning up old activities:",e)}}addListener(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(){this.listeners.forEach(e=>{try{e(this.activities)}catch(t){console.error("Error in activity listener:",t)}})}getActivityStats(){const e={total:this.activities.length,byType:{},byDate:{},recentActivity:null};this.activities.forEach(s=>{e.byType[s.type]=(e.byType[s.type]||0)+1});const t=new Date(Date.now()-720*60*60*1e3);return this.activities.forEach(s=>{const a=new Date(s.timestamp);if(a>=t){const l=a.toDateString();e.byDate[l]=(e.byDate[l]||0)+1}}),this.activities.length>0&&(e.recentActivity=this.activities[0]),e}exportActivities(){return{userId:this.currentUserId,activities:this.activities,exportedAt:new Date().toISOString(),count:this.activities.length}}static ActivityTypes={TENDER_CREATE:"tender_create",TENDER_UPDATE:"tender_update",TENDER_DELETE:"tender_delete",TENDER_SUBMIT:"tender_submit",ITEM_ADD:"item_add",ITEM_UPDATE:"item_update",ITEM_DELETE:"item_delete",DOCUMENT_UPLOAD:"document_upload",DOCUMENT_DELETE:"document_delete",MATERIAL_CREATE:"material_create",MATERIAL_UPDATE:"material_update",MATERIAL_DELETE:"material_delete",SUPPLIER_CREATE:"supplier_create",SUPPLIER_UPDATE:"supplier_update",USER_LOGIN:"user_login",USER_LOGOUT:"user_logout",SETTINGS_UPDATE:"settings_update",DATA_IMPORT:"data_import",DATA_EXPORT:"data_export"};async logTenderCreate(e,t){return await this.logActivity(hd.ActivityTypes.TENDER_CREATE,`تم إنشاء مناقصة جديدة: ${e}`,{tenderInternalId:t,tenderTitle:e})}async logTenderUpdate(e,t){return await this.logActivity(hd.ActivityTypes.TENDER_UPDATE,`تم تحديث المناقصة: ${e}`,{tenderInternalId:t,tenderTitle:e})}async logItemAdd(e,t){return await this.logActivity(hd.ActivityTypes.ITEM_ADD,`تم إضافة بند: ${e} إلى مناقصة ${t}`,{itemName:e,tenderTitle:t})}async logDocumentUpload(e,t){return await this.logActivity(hd.ActivityTypes.DOCUMENT_UPLOAD,`تم رفع مستند: ${e} للمناقصة ${t}`,{fileName:e,tenderTitle:t})}async logUserLogin(){return await this.logActivity(hd.ActivityTypes.USER_LOGIN,"تم تسجيل الدخول",{loginTime:new Date().toISOString()})}}const ji=new hd;to.onAuthStateChanged(async r=>{if(r)try{await ji.initialize(),await ji.logUserLogin(),console.log("✅ Activity logging initialized")}catch(e){console.error("Error initializing activity logging:",e)}else ji.currentUserId=null,ji.activities=[]});const eC=j.createContext(),_n=()=>{const r=j.useContext(eC);if(!r)throw new Error("useActivity must be used within ActivityProvider");return r},un=({children:r})=>{const[e,t]=j.useState([]),[s,a]=j.useState(!0),[l,c]=j.useState(null);j.useEffect(()=>{const ee=async()=>{try{a(!0),c(null),await ji.initialize();const ie=(ji.activities||[]).map(X=>({...X,status:X.status==="open"?"done":X.status}));t(ie),console.log(`✅ Loaded ${ie.length} activities from Firestore`)}catch(Z){console.error("Error initializing activities:",Z),c("فشل في تحميل سجل الأنشطة"),t([])}finally{a(!1)}};if(sn.currentUser)ee();else return sn.onAuthStateChanged(ie=>{ie?ee():(t([]),a(!1))})},[]),j.useEffect(()=>ji.addListener(Z=>{if(Z){const ie=Z.map(X=>({...X,status:X.status==="open"?"done":X.status}));t(ie)}}),[]);const[u]=j.useState([{id:"user1",name:"أحمد محمد",avatarUrl:null},{id:"user2",name:"فاطمة السالم",avatarUrl:null},{id:"user3",name:"محمد عبدالله",avatarUrl:null},{id:"user4",name:"نورا أحمد",avatarUrl:null}]),m=()=>u[0],p=async(ee,Z,ie,X=!1)=>{try{const pe=await ji.logActivity(ee,ie,{title:Z,isManual:X,status:"done",user:m(),at:Date.now(),createdAt:new Date().toISOString()});return pe?(console.log("✅ Activity logged:",ie),pe):(console.error("Failed to log activity:",ie),null)}catch(pe){return console.error("Error logging activity:",pe),null}},T={activities:e,users:u,loading:s,error:l,addActivity:p,logActivity:async(ee,Z,ie)=>await p(ee,Z,ie,!1),createManualActivity:async ee=>await p(ee.type,ee.title,ee.description,!0),updateActivityStatus:async(ee,Z)=>{try{await ji.updateActivity(ee,{status:Z})?console.log("✅ Activity status updated:",ee,Z):console.error("Failed to update activity status:",ee)}catch(ie){console.error("Error updating activity status:",ie)}},deleteActivity:async ee=>{try{await ji.deleteActivity(ee)?console.log("✅ Activity deleted:",ee):console.error("Failed to delete activity:",ee)}catch(Z){console.error("Error deleting activity:",Z)}},clearAllActivities:async()=>{try{const ee=await ji.clearAllActivities();return ee&&console.log("✅ All activities cleared"),ee}catch(ee){return console.error("Error clearing activities:",ee),!1}},getActivityStats:()=>ji.getActivityStats(),searchActivities:ee=>ji.searchActivities(ee),getCurrentUser:m};return n.jsx(eC.Provider,{value:T,children:r})},hn=({children:r})=>r;function Zn({rtl:r=!0}){const{activities:e,users:t}=_n(),[s,a]=j.useState(!1),[l,c]=j.useState(!1),[u,m]=j.useState(new Date),[p,b]=j.useState(null),[w,N]=j.useState(null),R=k=>{const W=["#e74c3c","#3498db","#2ecc71","#f39c12","#9b59b6","#1abc9c","#34495e","#e67e22","#95a5a6","#fd79a8"];if(!k)return W[0];let J=0;for(let L=0;L<k.length;L++)J=k.charCodeAt(L)+((J<<5)-J);const z=Math.abs(J)%W.length;return W[z]},O=["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],G=["ح","ن","ث","ر","خ","ج","س"],U=k=>{const W=k.getFullYear(),J=k.getMonth(),z=new Date(W,J,1),de=new Date(W,J+1,0).getDate(),Pe=z.getDay(),V=[],se=new Date(W,J-1,0);for(let re=Pe-1;re>=0;re--)V.push({day:se.getDate()-re,isCurrentMonth:!1,isNextMonth:!1});for(let re=1;re<=de;re++)V.push({day:re,isCurrentMonth:!0,isNextMonth:!1});const fe=42-V.length;for(let re=1;re<=fe;re++)V.push({day:re,isCurrentMonth:!1,isNextMonth:!0});return V},T=()=>{m(new Date(u.getFullYear(),u.getMonth()-1))},ee=()=>{m(new Date(u.getFullYear(),u.getMonth()+1))},Z=(k,W,J)=>{if(!W)return;const z=new Date(u.getFullYear(),u.getMonth(),k);b(z)},ie=()=>{console.log("Filter applied:",{selectedDate:p}),a(!1)},X=()=>{a(!1),b(null)},pe=k=>{N(k===w?null:k)},H=()=>{console.log("User filter applied:",w),c(!1)},B=()=>{c(!1),N(null)};return n.jsxs("div",{className:"card shadow-lg",style:{position:"fixed",left:"20px",top:"145px",width:"360px",height:"calc(100vh - 185px)",zIndex:10,border:"none",borderRadius:"12px",display:"flex",flexDirection:"column"},children:[n.jsx("div",{style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",padding:"20px",color:"white",height:"80px",display:"flex",flexDirection:"column",justifyContent:"center",flexShrink:0,borderTopLeftRadius:"12px",borderTopRightRadius:"12px"},children:n.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-clock-history me-2",style:{fontSize:"20px"}}),n.jsx("h6",{className:"mb-0 fw-semibold",children:"الأنشطة الحديثة"})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsxs("button",{className:`btn btn-sm ${l?"btn-light":"btn-outline-light"} border-0`,onClick:()=>c(!l),style:{fontSize:"12px",borderRadius:"8px",padding:"6px 12px",transition:"all 0.2s ease",backgroundColor:l?"rgba(255,255,255,0.2)":"transparent",color:"white",border:l?"1px solid rgba(255,255,255,0.3)":"1px solid transparent"},onMouseEnter:k=>{l||(k.target.style.backgroundColor="rgba(255,255,255,0.1)",k.target.style.borderColor="rgba(255,255,255,0.2)")},onMouseLeave:k=>{l||(k.target.style.backgroundColor="transparent",k.target.style.borderColor="transparent")},children:[n.jsx("i",{className:`bi ${l?"bi-person-fill":"bi-person"} me-2`}),"Users"]}),n.jsxs("button",{className:`btn btn-sm ${s?"btn-light":"btn-outline-light"} border-0`,onClick:()=>a(!s),style:{fontSize:"12px",borderRadius:"8px",padding:"6px 12px",transition:"all 0.2s ease",backgroundColor:s?"rgba(255,255,255,0.2)":"transparent",color:"white",border:s?"1px solid rgba(255,255,255,0.3)":"1px solid transparent"},onMouseEnter:k=>{s||(k.target.style.backgroundColor="rgba(255,255,255,0.1)",k.target.style.borderColor="rgba(255,255,255,0.2)")},onMouseLeave:k=>{s||(k.target.style.backgroundColor="transparent",k.target.style.borderColor="transparent")},children:[n.jsx("i",{className:`bi ${s?"bi-funnel-fill":"bi-funnel"} me-2`}),"Filter"]})]})]})}),n.jsxs("div",{style:{flex:1,overflow:"auto",display:"flex",flexDirection:"column"},children:[s&&n.jsx("div",{style:{background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)",borderTop:"1px solid rgba(0,0,0,0.08)"},children:n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[n.jsx("button",{className:"btn btn-sm shadow-sm",onClick:T,style:{backgroundColor:"#ffffff",border:"1px solid #dee2e6",borderRadius:"12px",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",color:"#495057"},onMouseEnter:k=>{k.target.style.backgroundColor="#e9ecef",k.target.style.transform="translateY(-1px)",k.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:k=>{k.target.style.backgroundColor="#ffffff",k.target.style.transform="translateY(0)",k.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:n.jsx("i",{className:"bi bi-chevron-right"})}),n.jsx("div",{className:"text-center",children:n.jsxs("h6",{className:"mb-0 fw-semibold",style:{color:"#2c3e50",fontSize:"16px",letterSpacing:"0.5px"},children:[O[u.getMonth()]," ",u.getFullYear()]})}),n.jsx("button",{className:"btn btn-sm shadow-sm",onClick:ee,style:{backgroundColor:"#ffffff",border:"1px solid #dee2e6",borderRadius:"12px",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",color:"#495057"},onMouseEnter:k=>{k.target.style.backgroundColor="#e9ecef",k.target.style.transform="translateY(-1px)",k.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:k=>{k.target.style.backgroundColor="#ffffff",k.target.style.transform="translateY(0)",k.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:n.jsx("i",{className:"bi bi-chevron-left"})})]}),n.jsxs("div",{className:"calendar-grid mb-3",children:[n.jsx("div",{className:"row g-1 mb-3",children:G.map((k,W)=>n.jsx("div",{className:"col text-center",children:n.jsx("small",{className:"fw-bold",style:{color:"#6c757d",fontSize:"11px",letterSpacing:"0.5px"},children:k})},W))}),Array.from({length:6}).map((k,W)=>n.jsx("div",{className:"row g-1 mb-1",children:U(u).slice(W*7,(W+1)*7).map((J,z)=>n.jsx("div",{className:"col",children:n.jsx("button",{className:"btn btn-sm w-100 shadow-sm",style:{fontSize:"12px",height:"32px",borderRadius:"8px",border:"1px solid #dee2e6",backgroundColor:J.isCurrentMonth?p&&p.getDate()===J.day?"#0d6efd":J.day===new Date().getDate()&&u.getMonth()===new Date().getMonth()&&u.getFullYear()===new Date().getFullYear()?"#e7f3ff":"#ffffff":"#f8f9fa",color:J.isCurrentMonth?p&&p.getDate()===J.day?"#ffffff":J.day===new Date().getDate()&&u.getMonth()===new Date().getMonth()&&u.getFullYear()===new Date().getFullYear()?"#0d6efd":"#495057":"#adb5bd",opacity:J.isCurrentMonth?1:.6,transition:"all 0.2s ease",fontWeight:p&&p.getDate()===J.day?"600":"400"},onClick:()=>Z(J.day,J.isCurrentMonth,J.isNextMonth),disabled:!J.isCurrentMonth,onMouseEnter:L=>{J.isCurrentMonth&&!(p&&p.getDate()===J.day)&&(L.target.style.backgroundColor="#e9ecef",L.target.style.transform="translateY(-1px)")},onMouseLeave:L=>{J.isCurrentMonth&&!(p&&p.getDate()===J.day)&&(L.target.style.backgroundColor=J.day===new Date().getDate()&&u.getMonth()===new Date().getMonth()&&u.getFullYear()===new Date().getFullYear()?"#e7f3ff":"#ffffff",L.target.style.transform="translateY(0)")},children:J.day})},z))},W))]}),n.jsxs("div",{className:"row g-3 mx-2 justify-content-center align-items-center",style:{marginTop:"22px"},children:[n.jsx("div",{className:"col-6",children:n.jsx("button",{className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:X,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#ffffff",border:"1px solid #dee2e6",color:"#6c757d",transition:"all 0.2s ease"},onMouseEnter:k=>{k.target.style.backgroundColor="#f8f9fa",k.target.style.transform="translateY(-1px)",k.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:k=>{k.target.style.backgroundColor="#ffffff",k.target.style.transform="translateY(0)",k.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:"الغاء"})}),n.jsx("div",{className:"col-6",children:n.jsx("button",{className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:ie,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#0d6efd",border:"1px solid #0d6efd",color:"#ffffff",transition:"all 0.2s ease"},onMouseEnter:k=>{k.target.style.backgroundColor="#0b5ed7",k.target.style.transform="translateY(-1px)",k.target.style.boxShadow="0 4px 12px rgba(13,110,253,0.3)"},onMouseLeave:k=>{k.target.style.backgroundColor="#0d6efd",k.target.style.transform="translateY(0)",k.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:"تأكيد"})})]})]})}),l&&n.jsx("div",{style:{background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)",borderTop:"1px solid rgba(0,0,0,0.08)"},children:n.jsxs("div",{className:"p-4",children:[n.jsx("div",{className:"text-center mb-3",children:n.jsx("h6",{className:"mb-0 fw-semibold",style:{color:"#2c3e50",fontSize:"16px",letterSpacing:"0.5px"},children:"تصفية حسب المستخدم"})}),n.jsx("div",{className:"mb-4",style:{background:"#ffffff",border:"1px solid #dee2e6",borderRadius:"8px",padding:"16px"},children:t.length>0?n.jsx("div",{className:"d-flex flex-column gap-1",children:t.map((k,W)=>n.jsx("div",{className:"d-flex align-items-center p-2",style:{borderBottom:W!==t.length-1?"1px solid #f8f9fa":"none"},children:n.jsxs("div",{className:"d-flex align-items-center w-100 justify-content-between",children:[n.jsx("input",{className:"form-check-input",type:"radio",name:"userFilter",id:`user-${k.id}`,checked:w===k.id,onChange:()=>pe(k.id),style:{cursor:"pointer",margin:"0",transform:"scale(0.7)",width:"14px",height:"14px",minWidth:"14px"}}),n.jsx("label",{className:"form-check-label flex-grow-1 text-end",htmlFor:`user-${k.id}`,style:{cursor:"pointer",fontSize:"14px",fontWeight:"500",color:w===k.id?"#0d6efd":"#495057",marginRight:"8px"},children:k.name})]})},k.id))}):n.jsxs("div",{className:"text-center py-3",children:[n.jsx("i",{className:"bi bi-people text-muted",style:{fontSize:"2rem"}}),n.jsx("p",{className:"text-muted mt-2 mb-0",children:"لا يوجد مستخدمين متاحين"})]})}),n.jsxs("div",{className:"row g-3 mx-2 justify-content-center align-items-center",children:[n.jsx("div",{className:"col-6",children:n.jsx("button",{className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:B,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#ffffff",border:"1px solid #dee2e6",color:"#6c757d",transition:"all 0.2s ease"},onMouseEnter:k=>{k.target.style.backgroundColor="#f8f9fa",k.target.style.transform="translateY(-1px)",k.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:k=>{k.target.style.backgroundColor="#ffffff",k.target.style.transform="translateY(0)",k.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:"الغاء"})}),n.jsx("div",{className:"col-6",children:n.jsx("button",{className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:H,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#0d6efd",border:"1px solid #0d6efd",color:"#ffffff",transition:"all 0.2s ease"},onMouseEnter:k=>{k.target.style.backgroundColor="#0b5ed7",k.target.style.transform="translateY(-1px)",k.target.style.boxShadow="0 4px 12px rgba(13,110,253,0.3)"},onMouseLeave:k=>{k.target.style.backgroundColor="#0d6efd",k.target.style.transform="translateY(0)",k.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:"تأكيد"})})]})]})}),n.jsx("div",{className:"card-body p-0",style:{flex:1},children:e.length>0?n.jsx("div",{className:"list-group list-group-flush",children:e.map((k,W)=>n.jsxs("div",{className:`list-group-item border-0 py-3 ${W!==e.length-1?"border-bottom":""}`,style:{borderBottomColor:"#e9ecef !important",borderBottomWidth:"1px !important"},children:[n.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[n.jsxs("div",{className:"d-flex align-items-center gap-2",children:[n.jsx("h6",{className:"mb-1 text-dark",children:k.title}),k.isManual&&n.jsx("span",{className:"badge bg-info",style:{fontSize:"10px"},children:"يدوي"})]}),n.jsx("span",{className:`badge ${k.status==="done"?"bg-success":k.status==="open"?"bg-warning":"bg-danger"}`,children:k.status==="done"?"مكتمل":k.status==="open"?"مفتوح":"متأخر"})]}),k.description&&n.jsx("p",{className:"mb-2 text-muted small",children:k.description}),n.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[n.jsxs("div",{className:"d-flex align-items-center text-muted small",children:[n.jsx("i",{className:"bi bi-person me-1"}),n.jsx("span",{className:"me-3 fw-semibold",style:{color:R(k.user?.name),fontSize:"13px"},children:k.user?.name})]}),n.jsx("small",{className:"text-muted",children:new Date(k.at).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})})]}),k.type&&n.jsxs("div",{className:"mt-2",children:[n.jsx("i",{className:`bi ${k.type==="task"?"bi-list-task":k.type==="call"?"bi-telephone":k.type==="email"?"bi-envelope":k.type==="meeting"?"bi-people":"bi-sticky"} me-1 text-primary`}),n.jsx("small",{className:"text-primary",children:k.type==="task"?"مهام":k.type==="call"?"مكالمة":k.type==="email"?"بريد إلكتروني":k.type==="meeting"?"اجتماع":"ملاحظة"})]})]},k.id||W))}):n.jsxs("div",{className:"text-center py-5",children:[n.jsx("i",{className:"bi bi-clock-history text-muted",style:{fontSize:"3rem"}}),n.jsx("p",{className:"text-muted mt-3 mb-0",children:"لا توجد أنشطة حديثة"})]})})]})]})}function es(){const[r,e]=j.useState(!1),[t,s]=j.useState({type:"task",title:"",description:""}),{createManualActivity:a}=_n(),l=[{value:"task",label:"مهام",icon:"bi-list-task"},{value:"call",label:"مكالمة",icon:"bi-telephone"},{value:"email",label:"بريد إلكتروني",icon:"bi-envelope"},{value:"meeting",label:"اجتماع",icon:"bi-people"},{value:"note",label:"ملاحظة",icon:"bi-sticky"}],c=m=>{m.preventDefault(),t.title.trim()&&(a(t),s({type:"task",title:"",description:""}),e(!1))},u=()=>{s({type:"task",title:"",description:""}),e(!1)};return n.jsx("div",{style:{position:"fixed",left:"20px",bottom:"20px",zIndex:1e3},children:r?n.jsxs("div",{className:"card shadow-lg",style:{width:"360px",maxHeight:"500px",border:"none",borderRadius:"12px",overflow:"hidden"},children:[n.jsx("div",{style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",padding:"20px",color:"white"},children:n.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[n.jsx("div",{className:"d-flex align-items-center",children:n.jsx("h6",{className:"mb-0 fw-semibold",children:"إضافة نشاط جديد"})}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:u,style:{fontSize:"12px",opacity:.8},onMouseEnter:m=>m.target.style.opacity="1",onMouseLeave:m=>m.target.style.opacity="0.8"})]})}),n.jsx("div",{style:{background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)",padding:"24px"},children:n.jsxs("form",{onSubmit:c,children:[n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"form-label fw-semibold",style:{color:"#2c3e50",fontSize:"14px",letterSpacing:"0.3px"},children:"نوع النشاط"}),n.jsx("select",{className:"form-select shadow-sm",value:t.type,onChange:m=>s(p=>({...p,type:m.target.value})),style:{fontSize:"14px",borderRadius:"8px",border:"1px solid #dee2e6",backgroundColor:"#ffffff",padding:"10px 12px",transition:"all 0.2s ease",backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"left 12px center",backgroundSize:"12px",paddingLeft:"36px",paddingRight:"12px",textAlign:"right",direction:"rtl"},onFocus:m=>{m.target.style.borderColor="#0d6efd",m.target.style.boxShadow="0 0 0 0.2rem rgba(13,110,253,.25)"},onBlur:m=>{m.target.style.borderColor="#dee2e6",m.target.style.boxShadow="none"},children:l.map(m=>n.jsx("option",{value:m.value,children:m.label},m.value))})]}),n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"form-label fw-semibold",style:{color:"#2c3e50",fontSize:"14px",letterSpacing:"0.3px"},children:"العنوان *"}),n.jsx("input",{type:"text",className:"form-control shadow-sm",value:t.title,onChange:m=>s(p=>({...p,title:m.target.value})),placeholder:"أدخل عنوان النشاط",required:!0,style:{fontSize:"14px",borderRadius:"8px",border:"1px solid #dee2e6",backgroundColor:"#ffffff",padding:"10px 12px",transition:"all 0.2s ease"},onFocus:m=>{m.target.style.borderColor="#0d6efd",m.target.style.boxShadow="0 0 0 0.2rem rgba(13,110,253,.25)"},onBlur:m=>{m.target.style.borderColor="#dee2e6",m.target.style.boxShadow="none"}})]}),n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"form-label fw-semibold",style:{color:"#2c3e50",fontSize:"14px",letterSpacing:"0.3px"},children:"الوصف"}),n.jsx("textarea",{className:"form-control shadow-sm",rows:"3",value:t.description,onChange:m=>s(p=>({...p,description:m.target.value})),placeholder:"أدخل وصف النشاط (اختياري)",style:{fontSize:"14px",borderRadius:"8px",border:"1px solid #dee2e6",backgroundColor:"#ffffff",padding:"10px 12px",resize:"none",transition:"all 0.2s ease"},onFocus:m=>{m.target.style.borderColor="#0d6efd",m.target.style.boxShadow="0 0 0 0.2rem rgba(13,110,253,.25)"},onBlur:m=>{m.target.style.borderColor="#dee2e6",m.target.style.boxShadow="none"}})]}),n.jsxs("div",{className:"row g-3 mx-2 justify-content-center align-items-center",style:{marginTop:"22px"},children:[n.jsx("div",{className:"col-6",children:n.jsx("button",{type:"button",className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:u,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#ffffff",border:"1px solid #dee2e6",color:"#6c757d",transition:"all 0.2s ease"},onMouseEnter:m=>{m.target.style.backgroundColor="#f8f9fa",m.target.style.transform="translateY(-1px)",m.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:m=>{m.target.style.backgroundColor="#ffffff",m.target.style.transform="translateY(0)",m.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:"إلغاء"})}),n.jsx("div",{className:"col-6",children:n.jsx("button",{type:"submit",className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#0d6efd",border:"1px solid #0d6efd",color:"#ffffff",transition:"all 0.2s ease"},onMouseEnter:m=>{m.target.style.backgroundColor="#0b5ed7",m.target.style.transform="translateY(-1px)",m.target.style.boxShadow="0 4px 12px rgba(13,110,253,0.3)"},onMouseLeave:m=>{m.target.style.backgroundColor="#0d6efd",m.target.style.transform="translateY(0)",m.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:"إضافة"})})]})]})})]}):n.jsx("button",{onClick:()=>e(!0),className:"btn btn-primary rounded-circle shadow-lg",style:{width:"56px",height:"56px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",border:"none"},title:"إضافة نشاط يدوي",children:n.jsx("i",{className:"bi bi-chat-left-text"})})})}function a4(){const[r,e]=j.useState(!1),{isTimelineVisible:t}=Hn(),s=()=>{e(!r)};return n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Xn,{onToggle:s}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"لوحة التحكم"})]})}),n.jsx(Jn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"mb-4",children:n.jsx("i",{className:"bi bi-speedometer2",style:{fontSize:"80px",color:"#007bff"}})}),n.jsx("h4",{className:"text-muted mb-3",children:"لوحة التحكم"}),n.jsx("p",{className:"text-muted",children:"مرحباً بك في لوحة التحكم الرئيسية"})]})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&t&&n.jsx(Zn,{rtl:!0}),!r&&t&&n.jsx(es,{})]})}function FE(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(a4,{})})})}class tC extends ev{constructor(){super("tenders")}validateTenderData(e){const t={};return e.title?.trim()||(t.title="عنوان المناقصة مطلوب"),e.referenceNumber?.trim()||(t.referenceNumber="رقم المرجع مطلوب"),e.entity?.trim()||(t.entity="الجهة المطروحة مطلوبة"),e.submissionDeadline||(t.submissionDeadline="موعد انتهاء التقديم مطلوب"),t}async checkDuplicateReferenceNumber(e,t=null){try{return(await this.search(e,["referenceNumber"])).some(a=>a.referenceNumber===e&&a.id!==t)}catch(s){return console.error("Error checking duplicate reference number:",s),!1}}async createTender(e,t={}){try{const s=this.validateTenderData(e);if(Object.keys(s).length>0)throw new Error(`بيانات غير صحيحة: ${Object.values(s).join(", ")}`);if(await this.checkDuplicateReferenceNumber(e.referenceNumber))throw new Error("هذا الرقم المرجعي مسجل مسبقاً - يرجى اختيار رقم مختلف");const a={...e,internalId:kt("TENDER"),status:"draft",items:e.items||[],documents:e.documents||[],submissionDeadline:e.submissionDeadline?new Date(e.submissionDeadline):null};return await this.create(a,{...t,updateCache:!0})}catch(s){throw console.error("Error creating tender:",s),s}}async updateTender(e,t,s={}){try{const a=this.validateTenderData(t);if(Object.keys(a).length>0)throw new Error(`بيانات غير صحيحة: ${Object.values(a).join(", ")}`);if(t.referenceNumber&&await this.checkDuplicateReferenceNumber(t.referenceNumber,e))throw new Error("هذا الرقم المرجعي مسجل مسبقاً - يرجى اختيار رقم مختلف");const l={...t,submissionDeadline:t.submissionDeadline?new Date(t.submissionDeadline):null};return await this.update(e,l,{...s,updateCache:!0})}catch(a){throw console.error("Error updating tender:",a),a}}async getTenderByInternalId(e){try{return(await this.search(e,["internalId"])).find(s=>s.internalId===e)||null}catch(t){throw console.error("Error fetching tender by internal ID:",t),t}}async getAllTenders(e={}){return await this.getAll({updateCache:!0,...e})}async searchTenders(e){return await this.search(e,["title","referenceNumber","entity","description","internalId"])}async addTenderItem(e,t){try{const s=await this.getById(e);if(!s)throw new Error("Tender not found");const a={...t,internalId:kt("TENDER_ITEM"),addedAt:new Date,materialInternalId:t.materialInternalId||t.materialId},l=s.items||[];if(l.some(m=>m.materialInternalId===a.materialInternalId))throw new Error(`البند ${t.materialName||"غير معروف"} موجود مسبقاً في المناقصة`);const u=[...l,a];return await this.updateTender(e,{...s,items:u,estimatedValue:this.calculateEstimatedValue(u)}),a.internalId}catch(s){throw console.error("Error adding tender item:",s),s}}async updateTenderItem(e,t,s){try{const a=await this.getById(e);if(!a)throw new Error("Tender not found");const l=a.items||[],c=l.findIndex(u=>u.internalId===t);if(c===-1)throw new Error("Tender item not found");return l[c]={...l[c],...s,updatedAt:new Date},await this.updateTender(e,{...a,items:l,estimatedValue:this.calculateEstimatedValue(l)}),!0}catch(a){throw console.error("Error updating tender item:",a),a}}async removeTenderItem(e,t){try{const s=await this.getById(e);if(!s)throw new Error("Tender not found");const l=(s.items||[]).filter(c=>c.internalId!==t);return await this.updateTender(e,{...s,items:l,estimatedValue:this.calculateEstimatedValue(l)}),!0}catch(s){throw console.error("Error removing tender item:",s),s}}calculateEstimatedValue(e){return!e||!Array.isArray(e)?0:e.reduce((t,s)=>{const a=parseFloat(s.unitPrice||0),l=parseFloat(s.quantity||1);return t+a*l},0)}async addTenderDocument(e,t){try{const s=await this.getById(e);if(!s)throw new Error("Tender not found");const a={...t,internalId:kt("DOCUMENT"),uploadedAt:new Date},c=[...s.documents||[],a];return await this.updateTender(e,{...s,documents:c}),a.internalId}catch(s){throw console.error("Error adding tender document:",s),s}}async removeTenderDocument(e,t){try{const s=await this.getById(e);if(!s)throw new Error("Tender not found");const l=(s.documents||[]).filter(c=>c.internalId!==t);return await this.updateTender(e,{...s,documents:l}),!0}catch(s){throw console.error("Error removing tender document:",s),s}}async updateTenderStatus(e,t){try{if(!["draft","submitted","in_review","awarded","rejected","cancelled"].includes(t))throw new Error(`حالة غير صحيحة: ${t}`);const a=await this.getById(e);if(!a)throw new Error("Tender not found");return await this.updateTender(e,{...a,status:t,statusUpdatedAt:new Date}),!0}catch(s){throw console.error("Error updating tender status:",s),s}}}const Go=new tC,nv=Object.freeze(Object.defineProperty({__proto__:null,TenderServiceNew:tC,tenderServiceNew:Go},Symbol.toStringTag,{value:"Module"}));class tf{static async getAllTenders(){try{console.log("🔥 Fetching tenders from Firestore...");const e=await Go.getAllTenders();return console.log("✅ Loaded tenders from Firestore:",e.length),e}catch(e){throw console.error("❌ Error fetching tenders:",e),new Error("فشل في جلب بيانات المناقصات: "+e.message)}}static async getTenderById(e){try{console.log("🔥 Fetching tender by ID:",e);const t=await Go.getById(e);if(!t)throw new Error("المناقصة غير موجودة");return t}catch(t){throw console.error("❌ Error fetching tender:",t),new Error("فشل في جلب بيانات المناقصة: "+t.message)}}static async createTender(e){try{console.log("🔥 Creating tender in Firestore...");const t={...e,internalId:e.internalId||kt("TENDER")},s=await Go.create(t);return console.log("✅ Tender created in Firestore with ID:",s.id),s.id}catch(t){throw console.error("❌ Error creating tender:",t),new Error("فشل في إنشاء المناقصة: "+t.message)}}static async updateTender(e,t){try{console.log("🔥 Updating tender in Firestore:",e);const s={...t},a=await Go.update(e,s);return console.log("✅ Tender updated in Firestore"),!0}catch(s){throw console.error("❌ Error updating tender:",s),new Error("فشل في تحديث بيانات المناقصة: "+s.message)}}static async deleteTender(e){try{return console.log("🔥 Deleting tender from Firestore:",e),await Go.delete(e),console.log("✅ Tender deleted from Firestore"),!0}catch(t){throw console.error("❌ Error deleting tender:",t),new Error("فشل في حذف المناقصة: "+t.message)}}static validateTenderData(e){const t={};if(e.title?.trim()||(t.title="اسم المناقصة مطلوب"),e.referenceNumber?.trim()||(t.referenceNumber="رقم المرجع مطلوب"),e.entity?.trim()||(t.entity="الجهة مطلوبة"),e.submissionDeadline){const s=new Date(e.submissionDeadline),a=new Date;a.setHours(0,0,0,0),s<a&&(t.submissionDeadline="تاريخ التسليم يجب أن يكون في المستقبل")}if(e.estimatedValue!==void 0&&e.estimatedValue!==""){const s=parseFloat(e.estimatedValue);(isNaN(s)||s<0)&&(t.estimatedValue="القيمة التقديرية يجب أن تكون رقم موجب")}return e.contactEmail&&e.contactEmail.trim()&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.contactEmail.trim())||(t.contactEmail="عنوان البريد الإلكتروني غير صالح")),t}static async searchTenders(e){try{return(await this.getAllTenders()).filter(s=>s.title?.toLowerCase().includes(e.toLowerCase())||s.referenceNumber?.toLowerCase().includes(e.toLowerCase())||s.entity?.toLowerCase().includes(e.toLowerCase()))}catch(t){throw console.error("❌ Error searching tenders:",t),new Error("فشل في البحث عن المناقصات: "+t.message)}}static async getTendersByStatus(e){try{return(await this.getAllTenders()).filter(s=>s.status===e)}catch(t){throw console.error("❌ Error fetching tenders by status:",t),new Error("فشل في جلب المناقصات حسب الحالة: "+t.message)}}}class it{static COLLECTION_NAME="pendingData";static DEFAULT_EXPIRY_HOURS=24;static getCurrentUserId(){if(!sn.currentUser)throw new Error("User not authenticated");return sn.currentUser.uid}static createExpiryTimestamp(e=this.DEFAULT_EXPIRY_HOURS){const t=new Date;return t.setHours(t.getHours()+e),In.fromDate(t)}static async setPendingData(e,t,s=this.DEFAULT_EXPIRY_HOURS){try{const a=this.getCurrentUserId();console.log("🔥 [FIRESTORE] Setting pending data:",e);const l=ht(Ce,this.COLLECTION_NAME,`${a}_${e}`),c={ownerId:a,key:e,data:t,expiresAt:this.createExpiryTimestamp(s),createdAt:_t(),updatedAt:_t()};return await sh(l,c),console.log("✅ [FIRESTORE] Pending data set:",e),!0}catch(a){throw console.error("❌ [FIRESTORE] Error setting pending data:",a),new Error("Failed to set pending data: "+a.message)}}static async getPendingData(e){try{const t=this.getCurrentUserId();console.log("🔥 [FIRESTORE] Getting pending data:",e);const s=ht(Ce,this.COLLECTION_NAME,`${t}_${e}`),a=await hs(s);if(!a.exists())return console.log("📭 [FIRESTORE] No pending data found for key:",e),null;const l=a.data();return l.expiresAt&&l.expiresAt.toDate()<new Date?(console.log("⏰ [FIRESTORE] Pending data expired, cleaning up:",e),await this.clearPendingData(e),null):(console.log("✅ [FIRESTORE] Retrieved pending data:",e),l.data)}catch(t){return console.error("❌ [FIRESTORE] Error getting pending data:",t),null}}static async clearPendingData(e){try{const t=this.getCurrentUserId();console.log("🔥 [FIRESTORE] Clearing pending data:",e);const s=ht(Ce,this.COLLECTION_NAME,`${t}_${e}`);return await er(s),console.log("✅ [FIRESTORE] Pending data cleared:",e),!0}catch(t){return console.error("❌ [FIRESTORE] Error clearing pending data:",t),!1}}static async getAllPendingData(){try{const e=this.getCurrentUserId();console.log("🔥 [FIRESTORE] Getting all pending data");const t=dt(Ce,this.COLLECTION_NAME),s=Gt(t,Sn("ownerId","==",e),ps("createdAt","desc")),a=await At(s),l={},c=[];return a.docs.forEach(u=>{const m=u.data();m.expiresAt&&m.expiresAt.toDate()<new Date?c.push(m.key):l[m.key]=m.data}),c.length>0&&await this.clearMultiplePendingData(c),console.log("✅ [FIRESTORE] Retrieved all pending data, keys:",Object.keys(l)),l}catch(e){return console.error("❌ [FIRESTORE] Error getting all pending data:",e),{}}}static async clearMultiplePendingData(e){try{const t=this.getCurrentUserId();console.log("🔥 [FIRESTORE] Clearing multiple pending data:",e.length);const s=Zo(Ce);return e.forEach(a=>{const l=ht(Ce,this.COLLECTION_NAME,`${t}_${a}`);s.delete(l)}),await s.commit(),console.log("✅ [FIRESTORE] Multiple pending data cleared"),!0}catch(t){return console.error("❌ [FIRESTORE] Error clearing multiple pending data:",t),!1}}static async clearAllPendingData(){try{const e=this.getCurrentUserId();console.log("🔥 [FIRESTORE] Clearing all pending data");const t=dt(Ce,this.COLLECTION_NAME),s=Gt(t,Sn("ownerId","==",e)),a=await At(s),l=Zo(Ce);return a.docs.forEach(c=>{l.delete(c.ref)}),await l.commit(),console.log("✅ [FIRESTORE] All pending data cleared:",a.docs.length),a.docs.length}catch(e){return console.error("❌ [FIRESTORE] Error clearing all pending data:",e),0}}static async cleanupExpiredData(){try{const e=this.getCurrentUserId();console.log("🔥 [FIRESTORE] Cleaning up expired data");const t=dt(Ce,this.COLLECTION_NAME),s=Gt(t,Sn("ownerId","==",e),Sn("expiresAt","<",In.now())),a=await At(s),l=Zo(Ce);return a.docs.forEach(c=>{l.delete(c.ref)}),await l.commit(),console.log("✅ [FIRESTORE] Expired data cleaned up:",a.docs.length),a.docs.length}catch(e){return console.error("❌ [FIRESTORE] Error cleaning up expired data:",e),0}}static async setPendingTenderItems(e){return this.setPendingData("pendingTenderItems",e,48)}static async getPendingTenderItems(){return this.getPendingData("pendingTenderItems")}static async clearPendingTenderItems(){return this.clearPendingData("pendingTenderItems")}static async mergePendingTenderItems(e){try{console.log("🔄 [FIRESTORE] Merging pending tender items:",e.length);const t=await this.getPendingTenderItems()||[],s=[...t,...e];return await this.setPendingTenderItems(s),console.log("✅ [FIRESTORE] Pending tender items merged:",{existing:t.length,new:e.length,total:s.length}),!0}catch(t){throw console.error("❌ [FIRESTORE] Error merging pending tender items:",t),new Error("Failed to merge pending tender items: "+t.message)}}static async setPendingProductItems(e){return this.setPendingData("pendingProductItems",e,48)}static async getPendingProductItems(){return this.getPendingData("pendingProductItems")}static async clearPendingProductItems(){return this.clearPendingData("pendingProductItems")}static async mergePendingProductItems(e){try{console.log("🔄 [FIRESTORE] Merging pending product items:",e.length);const t=await this.getPendingProductItems()||[],s=[...t,...e];return await this.setPendingProductItems(s),console.log("✅ [FIRESTORE] Pending product items merged:",{existing:t.length,new:e.length,total:s.length}),!0}catch(t){throw console.error("❌ [FIRESTORE] Error merging pending product items:",t),new Error("Failed to merge pending product items: "+t.message)}}static async setSessionData(e,t,s=24){return this.setPendingData(e,t,s)}static async getSessionData(e){return this.getPendingData(e)}static async clearSessionData(e){return this.clearPendingData(e)}}class qn{static COLLECTION_NAME="trash";static sanitizeData(e){const t={};for(const[s,a]of Object.entries(e))a!=null&&(a instanceof Date?t[s]=a.toISOString():typeof a=="object"&&a!==null&&!Array.isArray(a)?t[s]=this.sanitizeData(a):t[s]=a);return t}static async moveToTrash(e,t){try{const s=e.title||e.name||e.fileName||e.supplierName||"عنصر غير محدد";console.log("Moving to trash:",s,"from",t);let{id:a,...l}=e;if((!a||a===void 0||a===null)&&(a=`generated_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,console.log("⚠️ Missing document ID, generated new one:",a)),(await this.getAllTrashItems()).some(w=>w.originalId===a&&w.originalCollection===t&&(w.name===e.name||w.title===e.title||w.fileName===e.fileName||w.supplierName===e.supplierName)))return console.log("Item already exists in trash, skipping"),null;const p={...this.sanitizeData(l),originalId:a,originalCollection:t,deletedAt:_t(),deletedBy:"المستخدم الحالي"};console.log("📤 Adding to trash collection:",{displayName:s,originalCollection:t,originalId:a,hasRequiredFields:!!(p.originalId&&p.originalCollection)});const b=await Mr(dt(Ce,this.COLLECTION_NAME),p);return console.log("✅ Successfully moved to trash with ID:",b.id),b.id}catch(s){throw console.error("❌ Error moving to trash:",s),console.error("Error details:",{name:s.name,message:s.message,code:s.code,stack:s.stack,itemData:{id:e.id,displayName:e.name||e.fileName||e.supplierName,originalCollection:t,hasId:!!e.id}}),new Error(`فشل في نقل العنصر إلى سلة المهملات: ${s.message}`)}}static async getAllTrashItems(){try{const e=Gt(dt(Ce,this.COLLECTION_NAME),ps("deletedAt","desc")),t=await At(e),s=[],a=new Map;return t.forEach(l=>{const c=l.data(),u={id:l.id,...c,deletedAt:c.deletedAt?.toDate?.()||new Date};c.originalCollection==="price_quotes"&&(console.log("=== TRASH RECORD DEBUG ==="),console.log("Document ID:",l.id),console.log("Original Collection:",c.originalCollection),console.log("Item keys:",Object.keys(c)),console.log("Context data:",{rawMaterialId:c.rawMaterialId,rawMaterialName:c.rawMaterialName,localProductId:c.localProductId,localProductName:c.localProductName,foreignProductId:c.foreignProductId,foreignProductName:c.foreignProductName,supplierName:c.supplierName,price:c.price,date:c.date}),console.log("Full item data:",c));const m=`${c.originalId||c.id}-${c.originalCollection}-${c.name||c.title}`;a.has(m)?(console.log("Found duplicate item:",m,"marking for deletion"),this.permanentlyDelete(l.id).catch(console.error)):(a.set(m,u),s.push(u))}),console.log("Found",s.length,"unique items in trash (removed duplicates)"),s}catch(e){throw console.error("Error getting trash items:",e),new Error("فشل في جلب عناصر سلة المهملات")}}static async permanentlyDelete(e){try{if(console.log("Permanently deleting item:",e),!(await this.getAllTrashItems()).some(c=>c.id===e))return console.log("Item already deleted or does not exist:",e),!0;if(await er(ht(Ce,this.COLLECTION_NAME,e)),(await this.getAllTrashItems()).some(c=>c.id===e))throw new Error("فشل في حذف العنصر - العنصر لا يزال موجوداً");return console.log("Successfully deleted from trash:",e),!0}catch(t){throw console.error("Error deleting from trash:",t),new Error("فشل في حذف العنصر من سلة المهملات: "+t.message)}}static async restoreItem(e){let t=null;try{console.log("=== STARTING RESTORATION PROCESS ==="),console.log("Trash ID to restore:",e);const s=await this.getAllTrashItems();if(console.log("Total trash items found:",s.length),t=s.find(b=>b.id===e),!t)throw console.error("RESTORATION FAILED: Item not found in trash"),console.log("Available trash IDs:",s.map(b=>b.id)),new Error("العنصر غير موجود في سلة المهملات");console.log("=== TRASH ITEM FOUND ==="),console.log("Item to restore:",{id:t.id,originalCollection:t.originalCollection,name:t.name||t.supplierName,hasRawMaterialId:!!t.rawMaterialId,hasLocalProductId:!!t.localProductId,hasForeignProductId:!!t.foreignProductId});const{id:a,originalId:l,originalCollection:c,deletedAt:u,deletedBy:m,...p}=t;if(c==="suppliers"){const{SupplierService:b}=await Ds(async()=>{const{SupplierService:w}=await Promise.resolve().then(()=>R4);return{SupplierService:w}},[]);await b.createSupplier(p)}else if(c==="foreignSuppliers"){const{ForeignSupplierService:b}=await Ds(async()=>{const{ForeignSupplierService:w}=await Promise.resolve().then(()=>P4);return{ForeignSupplierService:w}},void 0);await b.createSupplier(p)}else if(c==="customers"){const{CustomerService:b}=await Ds(async()=>{const{CustomerService:w}=await Promise.resolve().then(()=>mF);return{CustomerService:w}},void 0);await b.createCustomer(p)}else if(c==="employees"){const{EmployeeService:b}=await Ds(async()=>{const{EmployeeService:w}=await Promise.resolve().then(()=>_F);return{EmployeeService:w}},void 0);await b.createEmployee(p)}else if(c==="rawmaterials"){const{RawMaterialService:b}=await Ds(async()=>{const{RawMaterialService:w}=await Promise.resolve().then(()=>ax);return{RawMaterialService:w}},void 0);await b.createRawMaterial(p)}else if(c==="localproducts"){const{LocalProductService:b}=await Ds(async()=>{const{LocalProductService:w}=await Promise.resolve().then(()=>ox);return{LocalProductService:w}},void 0);await b.createLocalProduct(p)}else if(c==="foreignproducts"){const{ForeignProductService:b}=await Ds(async()=>{const{ForeignProductService:w}=await Promise.resolve().then(()=>lx);return{ForeignProductService:w}},void 0);await b.createForeignProduct(p)}else if(c==="price_quotes")if(console.log("=== RESTORING PRICE QUOTE ==="),console.log("Trash item keys:",Object.keys(t)),console.log("Has rawMaterialId:",!!t.rawMaterialId,t.rawMaterialId),console.log("Has localProductId:",!!t.localProductId,t.localProductId),console.log("Has foreignProductId:",!!t.foreignProductId,t.foreignProductId),t.rawMaterialId)console.log("Restoring to raw material..."),await this.restorePriceQuoteToRawMaterial(t,p);else if(t.localProductId)console.log("Restoring to local product..."),await this.restorePriceQuoteToLocalProduct(t,p);else if(t.foreignProductId)console.log("Restoring to foreign product..."),await this.restorePriceQuoteToForeignProduct(t,p);else throw console.error("No valid product ID found in trash item:",{rawMaterialId:t.rawMaterialId,localProductId:t.localProductId,foreignProductId:t.foreignProductId,allKeys:Object.keys(t)}),new Error("لا يمكن استعادة عرض السعر - لم يتم العثور على السياق الأصلي");else if(c==="tenderItems"){console.log("=== RESTORING TENDER ITEM ==="),console.log("Tender context:",t.tenderContext);const b=t.tenderContext?.tenderId||"new",w=`tenderItems_${b}`;let N=[];try{const O=await it.getPendingData(w);N=O?JSON.parse(O):[]}catch(O){console.warn("Error parsing existing tender items:",O),N=[]}if(N.some(O=>O.internalId===p.internalId||O.materialInternalId===p.materialInternalId&&O.materialName===p.materialName))throw console.warn("Tender item already exists, not restoring to prevent duplicate"),new Error("هذا البند موجود بالفعل في المناقصة");N.push({...p,restoredAt:new Date().toISOString(),restoredFrom:"trash"}),await it.setPendingData(w,N),await it.setPendingData("tenderItems_restored",Date.now().toString()),window.dispatchEvent(new CustomEvent("tenderItemRestored",{detail:{tenderId:b,restoredItem:p}})),console.log("Successfully restored tender item to Firestore session:",{tenderId:b,storageKey:w,itemCount:N.length,restoredItem:p.materialName||p.name})}else if(c==="tender_documents"){console.log("=== RESTORING TENDER DOCUMENT ==="),console.log("Document data:",p);const b=p.tenderId||"new",w=`tenderDocuments_${b}`;console.log("Restoring document to:",{tenderId:b,storageKey:w});let N=[];try{N=await it.getPendingData(w)||[],console.log("Existing documents in Firestore session:",N.length)}catch(G){console.warn("Error parsing existing tender documents:",G),N=[]}if(N.some(G=>G.id===p.id&&G.storagePath===p.storagePath)){console.warn("Exact same document already exists, generating new ID for restoration");const G=Date.now(),U=Math.random().toString(36).substr(2,9);p.id=`${G}_${U}_restored`,console.log("Generated new document ID for restoration:",p.id)}const O={...p,restoredAt:new Date().toISOString(),restoredFrom:"trash"};N.push(O),console.log("📄 Adding restored document:",{documentId:O.id,fileName:O.fileName,tenderId:b,totalDocuments:N.length});try{await it.setPendingData(w,N),console.log("✅ Successfully saved to Firestore session:",w)}catch(G){throw console.error("❌ Failed to save to Firestore session:",G),new Error("فشل في حفظ الملف المستعاد")}try{await it.setPendingData("tenderDocuments_restored",Date.now().toString());const G=new CustomEvent("tenderDocumentRestored",{detail:{tenderId:b,restoredDocument:O,allDocuments:N}});window.dispatchEvent(G),window.dispatchEvent(new StorageEvent("storage",{key:w,newValue:JSON.stringify(N),url:window.location.href})),console.log("✅ Events dispatched successfully")}catch(G){console.warn("⚠️ Event dispatch failed (non-critical):",G)}console.log("✅ Successfully restored tender document:",{tenderId:b,storageKey:w,documentCount:N.length,restoredDocument:O.fileName||O.originalFileName})}else if(c==="manufacturedProducts"){const{ManufacturedProductService:b}=await Ds(async()=>{const{ManufacturedProductService:w}=await Promise.resolve().then(()=>uC);return{ManufacturedProductService:w}},void 0);await b.createManufacturedProduct(p),console.log("Successfully restored manufactured product")}else throw new Error("نوع العنصر غير مدعوم للاستعادة");return await this.permanentlyDelete(e),console.log("Successfully restored item"),!0}catch(s){console.error("=== RESTORATION ERROR ==="),console.error("Error type:",s.constructor.name),console.error("Error message:",s.message),console.error("Error stack:",s.stack),console.error("Error details:",{trashId:e,itemType:t?.originalCollection,itemName:t?.name||t?.supplierName,hasValidItem:!!t,contextIds:{rawMaterialId:t?.rawMaterialId,localProductId:t?.localProductId,foreignProductId:t?.foreignProductId}});let a="فشل في استعادة العنصر";throw s.message.includes("المادة الخام الأصلية غير موجودة")?a="فشل في الاستعادة: المادة الخام الأصلية غير موجودة أو تم حذفها":s.message.includes("المنتج المحلي الأصلي غير موجود")?a="فشل في الاستعادة: المنتج المحلي الأصلي غير موجود أو تم حذفه":s.message.includes("المنتج المستورد الأصلي غير موجود")?a="فشل في الاستعادة: المنتج المستورد الأصلي غير موجود أو تم حذفه":s.message.includes("لم يتم العثور على السياق الأصلي")?a="فشل في الاستعادة: لم يتم العثور على السياق الأصلي للعنصر":s.message.includes("نوع العنصر غير مدعوم")?a="فشل في الاستعادة: نوع العنصر غير مدعوم للاستعادة":a=`فشل في الاستعادة: ${s.message}`,new Error(a)}}static async restorePriceQuoteToRawMaterial(e,t){try{console.log("Restoring price quote to raw material:",e.rawMaterialId),console.log("Original trash item:",e);const{RawMaterialService:s}=await Ds(async()=>{const{RawMaterialService:U}=await Promise.resolve().then(()=>ax);return{RawMaterialService:U}},void 0),a=await s.getRawMaterialById(e.rawMaterialId);if(!a)throw new Error("المادة الخام الأصلية غير موجودة");console.log("Found raw material for restore:",{id:a.id,name:a.name,currentQuotesCount:(a.priceQuotes||[]).length});const{rawMaterialId:l,rawMaterialName:c,...u}=t;u.id||(console.warn("Quote missing ID, generating new one:",u),u.id=Date.now().toString()+"_recovered");const m=Date.now(),p=Math.random().toString(36).substr(2,9);u.id=`${m}_${p}_restored`,u.supplierName=u.supplierName||"مورد غير معروف",u.price=u.price||"0",u.date=u.date||"",u.supplierType=u.supplierType||"local",u.id=String(u.id),console.log("Restoring quote data with normalized structure:",u);const b=a.priceQuotes||[];if(console.log("Checking for duplicates in raw material:",{existingQuotesCount:b.length,newQuoteId:u.id,newQuoteSupplier:u.supplierName,newQuotePrice:u.price,newQuoteDate:u.date,existingQuotes:b.map(U=>({id:U.id,supplier:U.supplierName,price:U.price,date:U.date}))}),b.some(U=>U.id===u.id)){console.warn("Quote with same ID already exists, generating new ID");const U=Date.now()+Math.random()*1e3,T=Math.random().toString(36).substr(2,12);u.id=`${U}_${T}_restored_v2`,console.log("Generated new unique ID:",u.id)}const N=[...b,u];console.log("Updated price quotes after restore:",N.length,"total quotes");let R=null,O=null;if(N.length>0){const U=N.reduce((T,ee)=>{const Z=parseFloat(T.price)||0;return(parseFloat(ee.price)||0)<Z?ee:T});R=U.price,O=U.supplierName}const G={...a,priceQuotes:N};R&&(G.price=R,G.supplier=O,G.lowestPriceSupplier=O),await s.updateRawMaterial(e.rawMaterialId,G),console.log("Price quote successfully restored to raw material")}catch(s){throw console.error("=== RAW MATERIAL RESTORATION ERROR ==="),console.error("Error message:",s.message),console.error("Error stack:",s.stack),console.error("Error details:",{rawMaterialId:e.rawMaterialId,quoteName:t.supplierName,step:"Raw Material Restoration",originalDataKeys:Object.keys(t),trashItemKeys:Object.keys(e)}),s.message.includes("المادة الخام الأصلية غير موجودة")?s:new Error(`فشل في استعادة عرض السعر للمادة الخام: ${s.message}`)}}static async restorePriceQuoteToLocalProduct(e,t){try{console.log("Restoring price quote to local product:",e.localProductId),console.log("Original trash item:",e);const{LocalProductService:s}=await Ds(async()=>{const{LocalProductService:T}=await Promise.resolve().then(()=>ox);return{LocalProductService:T}},void 0),l=(await s.getAllLocalProducts()).find(T=>T.id===e.localProductId);if(!l)throw new Error("المنتج المحلي الأصلي غير موجود");console.log("Found local product for restore:",{id:l.id,name:l.name,currentQuotesCount:(l.priceQuotes||[]).length});const{localProductId:c,localProductName:u,...m}=t,p=Date.now(),b=Math.random().toString(36).substr(2,9);m.id=`${p}_${b}_restored`,m.supplierName=m.supplierName||"مورد غير معروف",m.price=m.price||"0",m.date=m.date||"",m.supplierType=m.supplierType||"local",m.id=String(m.id),console.log("Restoring quote data with normalized structure:",m);const w=l.priceQuotes||[];if(console.log("Checking for duplicates in local product:",{existingQuotesCount:w.length,newQuoteId:m.id,newQuoteSupplier:m.supplierName,newQuotePrice:m.price,newQuoteDate:m.date,existingQuotes:w.map(T=>({id:T.id,supplier:T.supplierName,price:T.price,date:T.date}))}),w.some(T=>T.id===m.id)){console.warn("Quote with same ID already exists, generating new ID");const T=Date.now()+Math.random()*1e3,ee=Math.random().toString(36).substr(2,12);m.id=`${T}_${ee}_restored_v2`,console.log("Generated new unique ID:",m.id)}const R=[...w,m];console.log("Updated price quotes after restore:",R.length,"total quotes");let O=null,G=null;if(R.length>0){const T=R.reduce((ee,Z)=>{const ie=parseFloat(ee.price)||0;return(parseFloat(Z.price)||0)<ie?Z:ee});O=T.price,G=T.supplierName}const U={...l,priceQuotes:R};O&&(U.price=O,U.supplier=G),await s.updateLocalProduct(e.localProductId,U),console.log("Price quote successfully restored to local product")}catch(s){throw console.error("=== LOCAL PRODUCT RESTORATION ERROR ==="),console.error("Error message:",s.message),console.error("Error stack:",s.stack),console.error("Error details:",{localProductId:e.localProductId,quoteName:t.supplierName,step:"Local Product Restoration",originalDataKeys:Object.keys(t),trashItemKeys:Object.keys(e)}),s.message.includes("المنتج المحلي الأصلي غير موجود")?s:new Error(`فشل في استعادة عرض السعر للمنتج المحلي: ${s.message}`)}}static async restorePriceQuoteToForeignProduct(e,t){try{console.log("Restoring price quote to foreign product:",e.foreignProductId),console.log("Original trash item:",e);const{ForeignProductService:s}=await Ds(async()=>{const{ForeignProductService:T}=await Promise.resolve().then(()=>lx);return{ForeignProductService:T}},void 0),l=(await s.getAllForeignProducts()).find(T=>T.id===e.foreignProductId);if(!l)throw new Error("المنتج المستورد الأصلي غير موجود");console.log("Found foreign product for restore:",{id:l.id,name:l.name,currentQuotesCount:(l.priceQuotes||[]).length});const{foreignProductId:c,foreignProductName:u,...m}=t,p=Date.now(),b=Math.random().toString(36).substr(2,9);m.id=`${p}_${b}_restored`,m.supplierName=m.supplierName||"مورد غير معروف",m.price=m.price||"0",m.date=m.date||"",m.supplierType=m.supplierType||"foreign",m.id=String(m.id),console.log("Restoring quote data with normalized structure:",m);const w=l.priceQuotes||[];if(console.log("Checking for duplicates in foreign product:",{existingQuotesCount:w.length,newQuoteId:m.id,newQuoteSupplier:m.supplierName,newQuotePrice:m.price,newQuoteDate:m.date,existingQuotes:w.map(T=>({id:T.id,supplier:T.supplierName,price:T.price,date:T.date}))}),w.some(T=>T.id===m.id)){console.warn("Quote with same ID already exists, generating new ID");const T=Date.now()+Math.random()*1e3,ee=Math.random().toString(36).substr(2,12);m.id=`${T}_${ee}_restored_v2`,console.log("Generated new unique ID:",m.id)}const R=[...w,m];console.log("Updated price quotes after restore:",R.length,"total quotes");let O=null,G=null;if(R.length>0){const T=R.reduce((ee,Z)=>{const ie=parseFloat(ee.price)||0;return(parseFloat(Z.price)||0)<ie?Z:ee});O=T.price,G=T.supplierName}const U={...l,priceQuotes:R};O&&(U.price=O,U.supplier=G),await s.updateForeignProduct(e.foreignProductId,U),console.log("Price quote successfully restored to foreign product")}catch(s){throw console.error("=== FOREIGN PRODUCT RESTORATION ERROR ==="),console.error("Error message:",s.message),console.error("Error stack:",s.stack),console.error("Error details:",{foreignProductId:e.foreignProductId,quoteName:t.supplierName,step:"Foreign Product Restoration",originalDataKeys:Object.keys(t),trashItemKeys:Object.keys(e)}),s.message.includes("المنتج المستورد الأصلي غير موجود")?s:new Error(`فشل في استعادة عرض السعر للمنتج المستورد: ${s.message}`)}}static async emptyTrash(){try{console.log("Emptying trash...");const e=await this.getAllTrashItems();console.log("Found",e.length,"items to delete");for(const t of e)await this.permanentlyDelete(t.id);return console.log("Successfully emptied trash"),!0}catch(e){throw console.error("Error emptying trash:",e),new Error("فشل في إفراغ سلة المهملات")}}static getItemDisplayInfo(e){const s={suppliers:{name:"مورد محلي",icon:"bi-building",color:"primary"},foreignSuppliers:{name:"مورد أجنبي",icon:"bi-globe",color:"info"},customers:{name:"عميل",icon:"bi-person-check",color:"success"},rawmaterials:{name:"مادة خام",icon:"bi-box-seam",color:"warning"},localproducts:{name:"منتج محلي",icon:"bi-box-seam",color:"success"},foreignproducts:{name:"منتج مستورد",icon:"bi-box-seam",color:"info"},manufacturedProducts:{name:"منتج مصنع",icon:"bi-boxes",color:"info"},manufactured_product_documents:{name:"وثيقة منتج مصنع",icon:"bi-file-earmark-text",color:"info"},price_quotes:{name:"عرض سعر",icon:"bi-currency-dollar",color:"dark"},tenderItems:{name:"بند مناقصة",icon:"bi-list-task",color:"secondary"},tender_documents:{name:"وثيقة مناقصة",icon:"bi-file-earmark",color:"warning"}}[e.originalCollection]||{name:"عنصر غير معروف",icon:"bi-question-circle",color:"secondary"};let a={};if(e.originalCollection==="rawmaterials")a={displayName:e.name||"بدون اسم",category:e.category||"غير محدد",minimumStock:e.minimumStock||0,supplier:e.lowestPriceSupplier||"لا يوجد"};else if(e.originalCollection==="localproducts")a={displayName:e.name||"بدون اسم",category:e.category||"غير محدد",unit:e.unit||"غير محدد",price:e.price?`${e.price} ريال`:"غير محدد",supplier:e.supplier||"لا يوجد"};else if(e.originalCollection==="foreignproducts")a={displayName:e.name||"بدون اسم",category:e.category||"غير محدد",unit:e.unit||"غير محدد",price:e.price?`${e.price} ريال`:"غير محدد",supplier:e.supplier||"لا يوجد"};else if(e.originalCollection==="price_quotes"){let l="غير معروف",c="السياق";e.rawMaterialId&&e.rawMaterialName?(l=e.rawMaterialName,c="المادة الخام"):e.localProductId&&e.localProductName?(l=e.localProductName,c="المنتج المحلي"):e.foreignProductId&&e.foreignProductName?(l=e.foreignProductName,c="المنتج المستورد"):e.rawMaterialName?(l=e.rawMaterialName,c="المادة الخام"):e.localProductName?(l=e.localProductName,c="المنتج المحلي"):e.foreignProductName&&(l=e.foreignProductName,c="المنتج المستورد"),console.log("Price quote context detection:",{rawMaterialId:e.rawMaterialId,rawMaterialName:e.rawMaterialName,localProductId:e.localProductId,localProductName:e.localProductName,foreignProductId:e.foreignProductId,foreignProductName:e.foreignProductName,finalContextName:l,finalContextLabel:c}),a={displayName:`عرض سعر - ${e.supplierName||"مورد غير معروف"}`,price:e.price?`${e.price} ريال`:"غير محدد",supplierName:e.supplierName||"غير معروف",date:e.date||"غير محدد",contextName:l,contextLabel:c}}else e.originalCollection==="tenderItems"?a={displayName:e.materialName||e.name||"بند مناقصة",quantity:e.quantity||1,price:e.totalPrice?`${Math.round(e.totalPrice)} ريال`:"غير محدد",contextName:e.tenderContext?.tenderTitle||"مناقصة غير معروفة",contextLabel:"المناقصة",itemType:e.type==="localProduct"?"منتج محلي":e.type==="foreignProduct"?"منتج أجنبي":"مادة خام"}:a={displayName:e.name||"بدون اسم",email:e.email||"لا يوجد",phone:e.phone||"لا يوجد"};return{...s,...a}}static getTimeSinceDeleted(e){const t=new Date,s=new Date(e),a=t.getTime()-s.getTime(),l=Math.floor(a/(1e3*60*60*24)),c=Math.floor(a/(1e3*60*60)),u=Math.floor(a/(1e3*60));return l>0?`منذ ${l} يوم${l>1,""}`:c>0?`منذ ${c} ساعة${c>1,""}`:u>0?`منذ ${u} دقيقة${u>1,""}`:"منذ لحظات"}static async clearAllTrashRecords(){try{console.log("🗑️ Clearing all trash records...");const e=Gt(dt(Ce,this.COLLECTION_NAME)),t=await At(e);console.log(`Found ${t.docs.length} records to delete`);const s=[];return t.forEach(a=>{s.push(er(a.ref))}),await Promise.all(s),console.log("✅ Successfully cleared all trash records"),!0}catch(e){throw console.error("❌ Error clearing trash records:",e),new Error("فشل في مسح سجلات المهملات: "+e.message)}}static getItemDisplayInfo(e){const s={suppliers:{name:"مورد محلي",icon:"bi-building",color:"primary"},foreignSuppliers:{name:"مورد أجنبي",icon:"bi-globe",color:"info"},customers:{name:"عميل",icon:"bi-person-check",color:"success"},employees:{name:"موظف",icon:"bi-person-badge",color:"primary"},rawmaterials:{name:"مادة خام",icon:"bi-box-seam",color:"warning"},localproducts:{name:"منتج محلي",icon:"bi-box-seam",color:"success"},foreignproducts:{name:"منتج مستورد",icon:"bi-box-seam",color:"info"},manufacturedProducts:{name:"منتج مصنع",icon:"bi-boxes",color:"info"},manufactured_product_documents:{name:"وثيقة منتج مصنع",icon:"bi-file-earmark-text",color:"info"},price_quotes:{name:"عرض سعر",icon:"bi-currency-dollar",color:"dark"},tenderItems:{name:"بند مناقصة",icon:"bi-list-task",color:"secondary"},tender_documents:{name:"وثيقة مناقصة",icon:"bi-file-earmark",color:"warning"},employee_documents:{name:"وثيقة موظف",icon:"bi-file-earmark-person",color:"success"},manufacturedProducts:{name:"منتج مصنع",icon:"bi-boxes",color:"info"}}[e.originalCollection]||{name:"عنصر غير معروف",icon:"bi-question-circle",color:"secondary"};let a={},l=e.name||"غير محدد",c="";switch(e.originalCollection){case"suppliers":case"foreignSuppliers":a={email:e.email,phone:e.phone,address:e.address,taxNumber:e.taxNumber};break;case"customers":a={email:e.email,phone:e.phone,address:e.address,taxNumber:e.taxNumber};break;case"employees":l=e.fullName||e.name||"موظف غير محدد",a={email:e.email,phone:e.phone,department:e.department,jobTitle:e.jobTitle,status:e.status,autoCreated:e.autoCreated};break;case"rawmaterials":case"localproducts":case"foreignproducts":a={category:e.category,unit:e.unit,price:e.price?`${e.price} ر.س`:"غير محدد",supplier:e.supplier||e.manufacturer};break;case"price_quotes":l=`عرض سعر من ${e.supplierName||"غير محدد"}`,c=e.rawMaterialName||e.localProductName||e.foreignProductName||"غير محدد",a={supplierName:e.supplierName,price:e.price?`${e.price} ر.س`:"غير محدد",contextName:c,date:e.date};break;case"tenderItems":l=e.materialName||e.name||"بند مناقصة",c=e.tenderContext?.tenderTitle||"مناقصة غير محددة",a={materialName:e.materialName,quantity:e.quantity,unitPrice:e.unitPrice?`${e.unitPrice} ر.س`:"غير محدد",totalPrice:e.totalPrice?`${e.totalPrice} ر.س`:"غير محدد",contextName:c,materialCategory:e.materialCategory,materialUnit:e.materialUnit};break;case"tender_documents":l=e.fileName||e.originalFileName||"وثيقة غير محددة",c=e.tenderTitle||"مناقصة غير محددة",a={fileName:e.fileName,originalFileName:e.originalFileName,fileSize:e.fileSize?`${(e.fileSize/1024/1024).toFixed(2)} م.ب`:"غير محدد",fileType:e.fileType||"نوع غير معروف",contextName:c,uploadedAt:e.uploadedAt||e.createdAt};break;case"employee_documents":l=e.fileName||e.originalFileName||"وثيقة غير محددة",c=e.employeeName||"موظف غير محدد",a={fileName:e.fileName,originalFileName:e.originalFileName,fileSize:e.fileSize?`${(e.fileSize/1024/1024).toFixed(2)} م.ب`:"غير محدد",fileType:e.fileType||"نوع غير معروف",contextName:c,uploadedAt:e.uploadedAt||e.createdAt};break;case"manufacturedProducts":l=e.title||e.productName||e.name||"منتج غير محدد",a={productCode:e.productCode,category:e.category,manufacturer:e.manufacturer,unitPrice:e.unitPrice?`${parseFloat(e.unitPrice).toLocaleString("en-US")} ريال`:"غير محدد",stockQuantity:e.stockQuantity||"غير محدد",unit:e.unit,status:e.status==="active"?"نشط":"غير نشط",batchNumber:e.batchNumber,referenceNumber:e.referenceNumber,estimatedValue:e.estimatedValue,description:e.description,submissionDeadline:e.submissionDeadline};break;default:a={}}return{...s,displayName:l,contextName:c,...a}}}const wa=(r,e=30)=>{const[t,s]=j.useState(1),a=Math.ceil(r.length/e),l=j.useMemo(()=>{const b=(t-1)*e,w=b+e;return r.slice(b,w)},[r,t,e]);return{currentPage:t,totalPages:a,paginatedItems:l,handlePageChange:b=>{b>=1&&b<=a&&(s(b),window.scrollTo({top:0,behavior:"smooth"}))},resetPage:()=>{s(1)},goToFirstPage:()=>{s(1)},goToLastPage:()=>{s(a)},totalItems:r.length,itemsPerPage:e,hasNextPage:t<a,hasPreviousPage:t>1}},nC=r=>{if(!r)return"";const e=r instanceof Date?r:new Date(r);if(isNaN(e.getTime()))return"";const t=e.getDate().toString().padStart(2,"0"),s=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getFullYear();return`${t}/${s}/${a}`},sC=r=>{if(!r)return"";const e=r instanceof Date?r:new Date(r);if(isNaN(e.getTime()))return"";const t=e.getDate().toString().padStart(2,"0"),s=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getFullYear(),l=e.getHours().toString().padStart(2,"0"),c=e.getMinutes().toString().padStart(2,"0");return`${t}/${s}/${a} ${l}:${c}`},ku=r=>{if(!r)return"";const e=r instanceof Date?r:new Date(r);if(isNaN(e.getTime()))return"";const t=e.getFullYear(),s=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0");return`${t}-${s}-${a}`},o4=r=>{if(!r||typeof r!="string")return null;const e=r.split("/");if(e.length===3){const t=parseInt(e[0],10),s=parseInt(e[1],10)-1,a=parseInt(e[2],10);if(!isNaN(t)&&!isNaN(s)&&!isNaN(a))return new Date(a,s,t)}return new Date(r)},l4=()=>nC(new Date),c4=()=>sC(new Date),yh=()=>({formatDate:r=>{if(!r)return"-";try{return nC(r)}catch(e){return console.error("Date formatting error:",e),"-"}},formatDateTime:r=>{if(!r)return"-";try{return sC(r)}catch(e){return console.error("DateTime formatting error:",e),"-"}},formatDateForInput:r=>{if(!r)return"";try{return ku(r)}catch(e){return console.error("Date input formatting error:",e),""}},parseDate:r=>{try{return o4(r)}catch(e){return console.error("Date parsing error:",e),null}},getToday:()=>{try{return l4()}catch(r){return console.error("Today date error:",r),"-"}},getCurrentDateTime:()=>{try{return c4()}catch(r){return console.error("Current datetime error:",r),"-"}},isExpired:r=>{if(!r)return!1;try{return(r instanceof Date?r:new Date(r))<new Date}catch{return!1}},getDaysRemaining:r=>{if(!r)return 0;try{const s=(r instanceof Date?r:new Date(r))-new Date;return Math.ceil(s/(1e3*60*60*24))}catch{return 0}}}),va=({currentPage:r,totalPages:e,onPageChange:t,totalItems:s,itemsPerPage:a=30,showItemsInfo:l=!0})=>{const c=()=>{const w=[],N=[];for(let R=Math.max(2,r-2);R<=Math.min(e-1,r+2);R++)w.push(R);return r-2>2?N.push(1,"..."):N.push(1),N.push(...w),r+2<e-1?N.push("...",e):N.push(e),N},u=b=>{b!=="..."&&b!==r&&b>=1&&b<=e&&t(b)},m=(r-1)*a+1,p=Math.min(r*a,s);return e<=1?null:n.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-4 px-3 py-3 border-top bg-light",children:[l&&n.jsx("div",{className:"text-muted",children:n.jsxs("small",{children:["عرض ",m.toLocaleString("en-US")," - ",p.toLocaleString("en-US")," من ",s.toLocaleString("en-US")," عنصر"]})}),n.jsx("nav",{"aria-label":"التنقل بين الصفحات",children:n.jsxs("ul",{className:"pagination pagination-sm mb-0",style:{direction:"ltr"},children:[n.jsx("li",{className:`page-item ${r===1?"disabled":""}`,children:n.jsxs("button",{className:"page-link",onClick:()=>u(r-1),disabled:r===1,style:{borderRadius:"6px 0 0 6px",border:"1px solid #dee2e6",color:r===1?"#6c757d":"#007bff"},children:[n.jsx("i",{className:"bi bi-chevron-right",style:{fontSize:"12px"}}),n.jsx("span",{className:"me-1",children:"السابق"})]})}),c().map((b,w)=>n.jsx("li",{className:`page-item ${b===r?"active":""}`,children:b==="..."?n.jsx("span",{className:"page-link",style:{border:"1px solid #dee2e6",color:"#6c757d",cursor:"default"},children:"..."}):n.jsx("button",{className:"page-link",onClick:()=>u(b),style:{border:"1px solid #dee2e6",minWidth:"40px",backgroundColor:b===r?"#007bff":"white",color:b===r?"white":"#007bff",fontWeight:b===r?"600":"400"},children:b})},w)),n.jsx("li",{className:`page-item ${r===e?"disabled":""}`,children:n.jsxs("button",{className:"page-link",onClick:()=>u(r+1),disabled:r===e,style:{borderRadius:"0 6px 6px 0",border:"1px solid #dee2e6",color:r===e?"#6c757d":"#007bff"},children:[n.jsx("span",{className:"ms-1",children:"التالي"}),n.jsx("i",{className:"bi bi-chevron-left",style:{fontSize:"12px"}})]})})]})}),!l&&n.jsx("div",{})]})},d4=({refreshTrigger:r})=>{const e=os();console.log("TendersListFixed is rendering");const[t,s]=j.useState([]),[a,l]=j.useState(!0),[c,u]=j.useState(null),[m,p]=j.useState(""),[b,w]=j.useState([]),[N,R]=j.useState(!1),{logActivity:O,getCurrentUser:G}=_n(),{alertConfig:U,closeAlert:T,showSuccess:ee,showError:Z,showConfirm:ie}=Cn(),{formatDate:X}=yh(),{currentPage:pe,totalPages:H,paginatedItems:B,handlePageChange:k,resetPage:W,totalItems:J,itemsPerPage:z}=wa(b,30);console.log("TendersListFixed state:",{tendersCount:t.length,loading:a,error:c});const L=async()=>{try{l(!0),u(null),console.log("Loading tenders...");const se=await tf.getAllTenders();console.log("Tenders loaded:",se.length),s(se)}catch(se){console.error("Error loading tenders:",se),u(se.message||"فشل في تحميل المناقصات")}finally{l(!1)}};j.useEffect(()=>{L()},[r]),j.useEffect(()=>{if(m.trim()){const se=t.filter(fe=>fe.title?.toLowerCase().includes(m.toLowerCase())||fe.referenceNumber?.toLowerCase().includes(m.toLowerCase())||fe.entity?.toLowerCase().includes(m.toLowerCase())||fe.description?.toLowerCase().includes(m.toLowerCase()));w(se)}else w(t);W()},[m,t,W]);const de=se=>{ie(`هل أنت متأكد من حذف هذه المناقصة؟

${se.title}`,()=>Pe(se),"تأكيد حذف المناقصة")},Pe=async se=>{try{R(!0),await qn.moveToTrash(se,"tenders"),await tf.deleteTender(se.id);const fe=G();O("task",`${fe.name} حذف مناقصة`,`تم حذف المناقصة: ${se.title}`),L(),ee(`تم نقل المناقصة للمهملات: ${se.title}`,"تم النقل للمهملات")}catch(fe){console.error("Error deleting tender:",fe),Z(`فشل في نقل المناقصة للمهملات: ${fe.message}`,"خطأ في النقل")}finally{R(!1)}},V=se=>{const fe=new Date,re=new Date(se.submissionDeadline);return fe>re?n.jsx("span",{className:"badge bg-danger text-white",children:"مغلقة للتقديم"}):n.jsx("span",{className:"badge bg-success",children:"مفتوحة"})};return a?(console.log("TendersListFixed: Showing loading state"),n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"spinner-border text-primary",role:"status",children:n.jsx("span",{className:"visually-hidden",children:"جار التحميل..."})}),n.jsx("p",{className:"mt-3 text-muted",children:"جار تحميل بيانات المناقصات..."})]})})):c?(console.log("TendersListFixed: Showing error state:",c),n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:c}),n.jsx("div",{className:"d-flex gap-2 justify-content-center",children:n.jsxs("button",{className:"btn btn-primary",onClick:L,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة تحميل البيانات"]})})]})})):(console.log("TendersListFixed: Showing main content with",b.length,"tenders"),n.jsxs("div",{className:"card shadow-sm","data-list":"tenders",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-clipboard-check-fill text-primary me-2"}),"قائمة المناقصات المحدثة (",b.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsx("div",{className:"d-flex justify-content-end align-items-center gap-3",children:n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المناقصات...",value:m,onChange:se=>p(se.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]})})})]})}),n.jsxs("div",{className:"card-body p-0",children:[b.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-clipboard-check fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد مناقصات"}),n.jsx("p",{className:"text-muted",children:m?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي مناقصات بعد"}),!m&&n.jsxs("button",{className:"btn btn-primary",onClick:()=>e("/tenders/add"),children:[n.jsx("i",{className:"bi bi-plus-lg me-1"}),"إضافة أول مناقصة"]})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"عنوان المناقصة"}),n.jsx("th",{className:"text-center",children:"التكلفة التقديرية"}),n.jsx("th",{className:"text-center",children:"جهة المناقصة"}),n.jsx("th",{className:"text-center",children:"موعد انتهاء التقديم"}),n.jsx("th",{className:"text-center",children:"الحالة"}),n.jsx("th",{className:"text-center",style:{width:"120px",paddingLeft:"40px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:B.map((se,fe)=>n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(pe-1)*z+fe+1})}),n.jsx("td",{className:"text-center",children:n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary tender-title-btn",onClick:()=>{se.id?e(`/tenders/edit/${se.id}`):Z("معرف المناقصة مفقود، لا يمكن التنقل","خطأ في التنقل")},style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0"},title:`انقر للتعديل | Firebase ID: ${se.id||"Missing"}`,children:se.title})}),n.jsx("td",{className:"text-center",children:n.jsxs("span",{className:"badge bg-success text-white",children:[(se.estimatedValue||0).toLocaleString("en-US")," ر.س"]})}),n.jsx("td",{className:"text-center",children:se.entity}),n.jsx("td",{className:"text-center",children:X(se.submissionDeadline)}),n.jsx("td",{className:"text-center",children:V(se)}),n.jsx("td",{className:"text-center",style:{paddingLeft:"40px"},children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{className:"btn btn-outline-primary",onClick:()=>{if(!se||!se.id){Z("بيانات المناقصة غير صحيحة أو مفقودة","خطأ في البيانات");return}e(`/tenders/edit/${se.id}`)},title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{className:"btn btn-outline-danger",onClick:()=>de(se),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},se.internalId||se.id||`tender-${fe}`))})]})}),b.length>0&&n.jsx(va,{currentPage:pe,totalPages:H,onPageChange:k,totalItems:J,itemsPerPage:z})]}),n.jsx(Tn,{show:U.show,onClose:T,title:U.title,message:U.message,type:U.type,onConfirm:U.onConfirm,showConfirm:U.showConfirm})]}))},u4=({refreshTrigger:r})=>(console.log("TendersList wrapper is rendering - delegating to TendersListFixed"),n.jsx(d4,{refreshTrigger:r}));function h4(){const[r,e]=j.useState(!1),[t,s]=j.useState(0),{isTimelineVisible:a}=Hn(),l=os(),c=()=>{e(!r)},u=async()=>{try{await it.clearPendingData("tenderFormData_new"),await it.clearPendingData("tenderDocuments_new"),await it.clearPendingTenderItems(),console.log("✅ All pending data cleared - navigating to fresh Add Tender form"),l("/tenders/add")}catch(m){console.error("❌ Error clearing pending data:",m),l("/tenders/add")}};return n.jsx(un,{children:n.jsx(hn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Xn,{onToggle:c}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!a?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"قائمة المناقصات"})]})}),n.jsx(Jn,{}),n.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:n.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[n.jsx("div",{className:"d-flex align-items-center",children:n.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[n.jsx("i",{className:"bi bi-file-earmark-text text-primary me-2"}),"إدارة المناقصات"]})}),n.jsx("button",{onClick:u,className:"btn btn-primary",style:{height:"32px",width:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center"},children:"إضافة مناقصة"})]})}),n.jsx("div",{className:"card-body p-0",children:n.jsx(u4,{refreshTrigger:t})})]})})})]}),!r&&a&&n.jsx(Zn,{rtl:!0}),!r&&a&&n.jsx(es,{})]})]})})})}function m4(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(h4,{})})})}class oo{static COLLECTIONS={customers:"customers",suppliers:"suppliers",foreignSuppliers:"foreignSuppliers",rawmaterials:"rawmaterials"};static async isFieldUnique(e,t,s=null,a=null){if(!t||t.trim()==="")return!0;const l=t.trim().toLowerCase();console.log(`🔍 Checking uniqueness for ${e}: "${l}"`);for(const[c,u]of Object.entries(this.COLLECTIONS))try{console.log(`📋 Checking collection: ${c} (exclude: ${a})`);const m=await At(dt(Ce,u));console.log(`📊 Found ${m.docs.length} documents in ${c}`);for(const p of m.docs){const b=p.data();if(s&&p.id===s&&a===c){console.log(`⏭️ Skipping same document: ${p.id} in ${c}`);continue}const w=b[e]?.toString().trim().toLowerCase();if(w&&w!==""&&(console.log(`🔎 Comparing "${l}" with "${w}" from ${c}`),w===l)){const N=`هذا ${this.getFieldDisplayName(e)} مستخدم بالفعل في ${this.getCollectionDisplayName(c)}`;throw console.log(`❌ Duplicate found: ${N}`),new Error(N)}}}catch(m){if(m.message.includes("مستخدم بالفعل"))throw m;console.error(`Error checking uniqueness in ${c}:`,m)}return console.log(`✅ ${e} is unique: "${l}"`),!0}static async validateUniqueFields(e,t=null,s=null){const a={},l=["phone","email","taxNumber"];for(const c of l)if(e[c]&&e[c].trim()!=="")try{await this.isFieldUnique(c,e[c],t,s)}catch(u){a[c]=u.message}return a}static getFieldDisplayName(e){return{name:"الاسم",phone:"رقم الهاتف",email:"البريد الإلكتروني",taxNumber:"الرقم الضريبي"}[e]||e}static getCollectionDisplayName(e){return{customers:"العملاء",suppliers:"الموردين المحليين",foreignSuppliers:"الموردين الأجانب",rawmaterials:"المواد الخام"}[e]||e}static async isNameUnique(e,t=null,s=null){return!0}static async isPhoneUnique(e,t=null,s=null){return await this.isFieldUnique("phone",e,t,s)}static async isEmailUnique(e,t=null,s=null){return await this.isFieldUnique("email",e,t,s)}static async isTaxNumberUnique(e,t=null,s=null){return await this.isFieldUnique("taxNumber",e,t,s)}static async validateFieldRealTime(e,t,s=null,a=null){if(!t||t.trim()==="")return null;try{return await this.isFieldUnique(e,t,s,a),null}catch(l){return l.message}}}const rC=({show:r,onClose:e,onItemSelect:t,selectedItemType:s,setSelectedItemType:a})=>{if(!r)return null;const l=c=>{try{const u=c.target.value;console.log("Selected item type:",u),a(u),setTimeout(()=>{try{e(),t&&t(u)}catch(m){console.error("Navigation error:",m)}},300)}catch(u){console.error("Error handling item type change:",u)}};return n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:n.jsx("div",{className:"modal-dialog modal-dialog-centered",style:{maxWidth:"500px"},children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header border-bottom-0 pb-0",children:[n.jsx("h5",{className:"modal-title fw-bold text-primary",children:"اختر نوع البند"}),n.jsx("button",{type:"button",className:"btn-close",onClick:e,"aria-label":"Close"})]}),n.jsx("div",{className:"modal-body py-4",children:n.jsxs("div",{className:"row g-3",children:[n.jsx("div",{className:"col-6",children:n.jsxs("div",{className:"form-check p-0",children:[n.jsx("input",{className:"form-check-input d-none",type:"radio",name:"itemType",id:"raw-materials",value:"raw-materials",checked:s==="raw-materials",onChange:l}),n.jsxs("label",{className:`form-check-label w-100 p-3 border rounded-3 text-center cursor-pointer transition-all ${s==="raw-materials"?"border-primary text-primary":"border-light hover-border-primary"}`,htmlFor:"raw-materials",style:{cursor:"pointer",backgroundColor:s==="raw-materials"?"#f8f9fa":"#f5f5f5"},children:[n.jsx("i",{className:"bi bi-gear fs-1 d-block mb-2",style:{color:"#dc3545"}}),n.jsx("span",{className:"fw-medium",children:"مواد خام"})]})]})}),n.jsx("div",{className:"col-6",children:n.jsxs("div",{className:"form-check p-0",children:[n.jsx("input",{className:"form-check-input d-none",type:"radio",name:"itemType",id:"local-product",value:"local-product",checked:s==="local-product",onChange:l}),n.jsxs("label",{className:`form-check-label w-100 p-3 border rounded-3 text-center cursor-pointer transition-all ${s==="local-product"?"border-primary text-primary":"border-light hover-border-primary"}`,htmlFor:"local-product",style:{cursor:"pointer",backgroundColor:s==="local-product"?"#f8f9fa":"#f5f5f5"},children:[n.jsx("i",{className:"bi bi-house fs-1 d-block mb-2",style:{color:"#198754"}}),n.jsx("span",{className:"fw-medium",children:"منتج محلي"})]})]})}),n.jsx("div",{className:"col-6",children:n.jsxs("div",{className:"form-check p-0",children:[n.jsx("input",{className:"form-check-input d-none",type:"radio",name:"itemType",id:"imported-product",value:"imported-product",checked:s==="imported-product",onChange:l}),n.jsxs("label",{className:`form-check-label w-100 p-3 border rounded-3 text-center cursor-pointer transition-all ${s==="imported-product"?"border-primary text-primary":"border-light hover-border-primary"}`,htmlFor:"imported-product",style:{cursor:"pointer",backgroundColor:s==="imported-product"?"#f8f9fa":"#f5f5f5"},children:[n.jsx("i",{className:"bi bi-globe fs-1 d-block mb-2",style:{color:"#0dcaf0"}}),n.jsx("span",{className:"fw-medium",children:"منتج مستورد"})]})]})}),n.jsx("div",{className:"col-6",children:n.jsxs("div",{className:"form-check p-0",children:[n.jsx("input",{className:"form-check-input d-none",type:"radio",name:"itemType",id:"manufactured-product",value:"manufactured-product",checked:s==="manufactured-product",onChange:l}),n.jsxs("label",{className:`form-check-label w-100 p-3 border rounded-3 text-center cursor-pointer transition-all ${s==="manufactured-product"?"border-primary text-primary":"border-light hover-border-primary"}`,htmlFor:"manufactured-product",style:{cursor:"pointer",backgroundColor:s==="manufactured-product"?"#f8f9fa":"#f5f5f5"},children:[n.jsx("i",{className:"bi bi-tools fs-1 d-block mb-2",style:{color:"#fd7e14"}}),n.jsx("span",{className:"fw-medium",children:"منتج مصنع"})]})]})})]})})]})})})},Xc="rawmaterials",Ab=()=>{window.dispatchEvent(new CustomEvent("rawMaterialsUpdated"))};class wr{static async getAllRawMaterials(){try{const e=dt(Ce,Xc),t=Gt(e,ps("createdAt","desc"));return(await At(t)).docs.map(a=>{const l=a.data();return{id:a.id,internalId:l.internalId||kt("RAW_MATERIAL"),...l,createdAt:l.createdAt?.toDate(),updatedAt:l.updatedAt?.toDate()}})}catch(e){throw console.error("Error fetching raw materials:",e),new Error("فشل في جلب بيانات المواد الخام")}}static async getRawMaterialById(e){try{const t=ht(Ce,Xc,e),s=await hs(t);if(s.exists()){const a=s.data();return{id:s.id,internalId:a.internalId||kt("RAW_MATERIAL"),...a,createdAt:a.createdAt?.toDate(),updatedAt:a.updatedAt?.toDate()}}else return null}catch(t){throw console.error("Error fetching raw material by ID:",t),new Error("فشل في جلب بيانات المادة الخام")}}static async getRawMaterialByInternalId(e){try{const t=dt(Ce,Xc),s=Gt(t,Sn("internalId","==",e)),a=await At(s);if(a.empty)return null;{const l=a.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:c.createdAt?.toDate(),updatedAt:c.updatedAt?.toDate()}}}catch(t){throw console.error("Error fetching raw material by internal ID:",t),new Error("فشل في جلب بيانات المادة الخام")}}static async updateRawMaterialByInternalId(e,t){try{const s=await this.getRawMaterialByInternalId(e);if(!s)throw new Error("Raw material not found");return await this.updateRawMaterial(s.id,t)}catch(s){throw console.error("Error updating raw material by internal ID:",s),new Error("فشل في تحديث بيانات المادة الخام")}}static async deleteRawMaterialByInternalId(e){try{const t=await this.getRawMaterialByInternalId(e);if(!t)throw new Error("Raw material not found");return await this.deleteRawMaterial(t.id)}catch(t){throw console.error("Error deleting raw material by internal ID:",t),new Error("فشل في حذف المادة الخام")}}static async createRawMaterial(e){try{const t=kt("RAW_MATERIAL"),s={...e,internalId:t,createdAt:_t(),updatedAt:_t()},a=await Mr(dt(Ce,Xc),s);return Ab(),a.id}catch(t){throw console.error("Error creating raw material:",t),new Error("فشل في إنشاء المادة الخام")}}static async updateRawMaterial(e,t){try{const s=ht(Ce,Xc,e),a={...t,updatedAt:_t()};return await Zs(s,a),Ab(),!0}catch(s){throw console.error("Error updating raw material:",s),new Error("فشل في تحديث بيانات المادة الخام")}}static async deleteRawMaterial(e){try{const t=ht(Ce,Xc,e);return await er(t),Ab(),!0}catch(t){throw console.error("Error deleting raw material:",t),new Error("فشل في حذف المادة الخام")}}static async searchRawMaterials(e){try{const t=dt(Ce,Xc);return(await At(t)).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||kt("RAW_MATERIAL"),...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate()}}).filter(c=>c.name?.toLowerCase().includes(e.toLowerCase())||c.category?.toLowerCase().includes(e.toLowerCase())||c.description?.toLowerCase().includes(e.toLowerCase())||c.supplier?.toLowerCase().includes(e.toLowerCase()))}catch(t){throw console.error("Error searching raw materials:",t),new Error("فشل في البحث عن المواد الخام")}}static async migrateExistingData(){try{console.log("Starting raw materials migration...");const e=await this.getAllRawMaterials();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("rm_")){const a=kt("RAW_MATERIAL");await this.updateRawMaterial(s.id,{...s,internalId:a}),t++,console.log(`Migrated raw material: ${s.name} -> ${a}`)}return console.log(`Migration completed. ${t} raw materials migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("فشل في ترحيل البيانات")}}static async getRawMaterialsByInternalIds(e){try{const t=e.map(a=>this.getRawMaterialByInternalId(a));return(await Promise.all(t)).filter(a=>a!==null)}catch(t){throw console.error("Error fetching raw materials by internal IDs:",t),new Error("فشل في جلب بيانات المواد الخام")}}static validateRawMaterialData(e){const t={};return e.name?.trim()||(t.name="اسم المادة الخام مطلوب"),e.category?.trim()||(t.category="فئة المادة الخام مطلوبة"),e.unit?.trim()||(t.unit="الوحدة مطلوبة"),(!e.price||parseFloat(e.price)<=0)&&(t.price="السعر يجب أن يكون أكبر من صفر"),t}}const ax=Object.freeze(Object.defineProperty({__proto__:null,RawMaterialService:wr},Symbol.toStringTag,{value:"Module"})),Jc="localproducts",Db=()=>{window.dispatchEvent(new CustomEvent("localProductsUpdated"))};class vr{static async getAllLocalProducts(){try{const e=dt(Ce,Jc);let t;try{t=Gt(e,ps("createdAt","desc"))}catch{console.log("Using query without orderBy for empty collection"),t=Gt(e)}const a=(await At(t)).docs.map(l=>{const c=l.data();return{id:l.id,internalId:c.internalId||kt("LOCAL_PRODUCT"),...c,createdAt:c.createdAt?.toDate(),updatedAt:c.updatedAt?.toDate()}});return a.length>0&&a[0].createdAt&&a.sort((l,c)=>(c.createdAt||new Date(0))-(l.createdAt||new Date(0))),a}catch(e){if(console.error("Error fetching local products:",e),console.error("Error details:",e.code,e.message),e.code==="failed-precondition"||e.message.includes("index"))return console.log("Collection appears to be empty or missing index, returning empty array"),[];throw new Error("فشل في جلب بيانات المنتجات المحلية: "+e.message)}}static async getLocalProductById(e){try{const t=ht(Ce,Jc,e),s=await hs(t);if(s.exists()){const a=s.data();return{id:s.id,internalId:a.internalId||kt("LOCAL_PRODUCT"),...a,createdAt:a.createdAt?.toDate(),updatedAt:a.updatedAt?.toDate()}}else return null}catch(t){throw console.error("Error fetching local product by ID:",t),new Error("فشل في جلب بيانات المنتج المحلي")}}static async createLocalProduct(e){try{const t=kt("LOCAL_PRODUCT"),s={...e,internalId:t,createdAt:_t(),updatedAt:_t()},a=await Mr(dt(Ce,Jc),s);return Db(),a.id}catch(t){throw console.error("Error creating local product:",t),new Error("فشل في إنشاء المنتج المحلي")}}static async updateLocalProduct(e,t){try{const s=ht(Ce,Jc,e),a={...t,updatedAt:_t()};return await Zs(s,a),Db(),!0}catch(s){throw console.error("Error updating local product:",s),new Error("فشل في تحديث بيانات المنتج المحلي")}}static async getLocalProductByInternalId(e){try{const t=dt(Ce,Jc),s=Gt(t,Sn("internalId","==",e)),a=await At(s);if(a.empty)return null;{const l=a.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:c.createdAt?.toDate(),updatedAt:c.updatedAt?.toDate()}}}catch(t){throw console.error("Error fetching local product by internal ID:",t),new Error("فشل في جلب بيانات المنتج المحلي")}}static async updateLocalProductByInternalId(e,t){try{const s=await this.getLocalProductByInternalId(e);if(!s)throw new Error("Local product not found");return await this.updateLocalProduct(s.id,t)}catch(s){throw console.error("Error updating local product by internal ID:",s),new Error("فشل في تحديث بيانات المنتج المحلي")}}static async deleteLocalProduct(e){try{const t=ht(Ce,Jc,e);return await er(t),Db(),!0}catch(t){throw console.error("Error deleting local product:",t),new Error("فشل في حذف المنتج المحلي")}}static async deleteLocalProductByInternalId(e){try{const t=await this.getLocalProductByInternalId(e);if(!t)throw new Error("Local product not found");return await this.deleteLocalProduct(t.id)}catch(t){throw console.error("Error deleting local product by internal ID:",t),new Error("فشل في حذف المنتج المحلي")}}static async searchLocalProducts(e){try{const t=dt(Ce,Jc);return(await At(t)).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||kt("LOCAL_PRODUCT"),...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate()}}).filter(c=>c.name?.toLowerCase().includes(e.toLowerCase())||c.category?.toLowerCase().includes(e.toLowerCase())||c.description?.toLowerCase().includes(e.toLowerCase())||c.supplier?.toLowerCase().includes(e.toLowerCase()))}catch(t){if(console.error("Error searching local products:",t),console.error("Error details:",t.code,t.message),t.code==="failed-precondition"||t.message.includes("index")||t.code==="not-found")return console.log("Collection appears to be empty or missing, returning empty array"),[];throw new Error("فشل في البحث عن المنتجات المحلية: "+t.message)}}static async migrateExistingData(){try{console.log("Starting local products migration...");const e=await this.getAllLocalProducts();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("lp_")){const a=kt("LOCAL_PRODUCT");await this.updateLocalProduct(s.id,{...s,internalId:a}),t++,console.log(`Migrated local product: ${s.name} -> ${a}`)}return console.log(`Migration completed. ${t} local products migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("فشل في ترحيل البيانات")}}static validateLocalProductData(e){const t={};return e.name?.trim()||(t.name="اسم المنتج المحلي مطلوب"),e.category?.trim()||(t.category="فئة المنتج المحلي مطلوبة"),e.unit?.trim()||(t.unit="الوحدة مطلوبة"),(!e.price||parseFloat(e.price)<=0)&&(t.price="السعر يجب أن يكون أكبر من صفر"),t}}const ox=Object.freeze(Object.defineProperty({__proto__:null,LocalProductService:vr},Symbol.toStringTag,{value:"Module"}));async function iC(r,e){const t=await Mr(dt(Ce,r),{...e,_createdAt:new Date});return await sh(t,{...e,id:t.id,_createdAt:new Date},{merge:!0}),t.id}async function aC(r,e){const t=await hs(ht(Ce,r,e));return t.exists()?{id:t.id,...t.data()}:null}const Zc="foreignproducts",Rb=()=>{window.dispatchEvent(new CustomEvent("foreignProductsUpdated"))};class Nr{static async getAllForeignProducts(){try{const e=dt(Ce,Zc);let t;try{const a=Gt(e,ps("createdAt","desc"));t=await At(a,"getAllForeignProducts")}catch(a){console.log("OrderBy failed, using simple query:",a.message),t=await At(e,"getAllForeignProducts-simple")}const s=t.docs.map(a=>{const l=a.data();return{id:a.id,internalId:l.internalId||kt("FOREIGN_PRODUCT"),...l,createdAt:l.createdAt?.toDate(),updatedAt:l.updatedAt?.toDate()}});return s.length>0&&s[0].createdAt&&s.sort((a,l)=>(l.createdAt||new Date(0))-(a.createdAt||new Date(0))),s}catch(e){if(console.error("Error fetching foreign products:",e),console.error("Error details:",e.code,e.message),e.code==="failed-precondition"||e.message.includes("index"))return console.log("Collection appears to be empty or missing index, returning empty array"),[];throw new Error("فشل في جلب بيانات المنتجات المستوردة: "+e.message)}}static async getForeignProductById(e){try{const t=await aC(Zc,e);return t?{...t,internalId:t.internalId||kt("FOREIGN_PRODUCT"),createdAt:t.createdAt?.toDate(),updatedAt:t.updatedAt?.toDate()}:null}catch(t){throw console.error("Error fetching foreign product by ID:",t),new Error("فشل في جلب بيانات المنتج المستورد")}}static async addForeignProduct(e){try{const t=kt("FOREIGN_PRODUCT");let s=null;if(e.priceQuotes&&e.priceQuotes.length>0){const c=e.priceQuotes.map(u=>parseFloat(u.price)).filter(u=>!isNaN(u));c.length>0&&(s=Math.min(...c))}const a={...e,internalId:t,price:s!==null?s.toString():e.price||"",createdAt:_t(),updatedAt:_t()},l=await iC(Zc,a);return Rb(),l}catch(t){throw console.error("Error adding foreign product:",t),new Error("فشل في إضافة المنتج المستورد")}}static async createForeignProduct(e){return this.addForeignProduct(e)}static async updateForeignProduct(e,t){try{let s=null;if(t.priceQuotes&&t.priceQuotes.length>0){const c=t.priceQuotes.map(u=>parseFloat(u.price)).filter(u=>!isNaN(u));c.length>0&&(s=Math.min(...c))}const a=ht(Ce,Zc,e),l={...t,price:s!==null?s.toString():t.price||"",updatedAt:_t()};return await Zs(a,l,"updateForeignProduct"),Rb(),!0}catch(s){throw console.error("Error updating foreign product:",s),new Error("فشل في تحديث بيانات المنتج المستورد")}}static async getForeignProductByInternalId(e){try{const t=dt(Ce,Zc),s=Gt(t,Sn("internalId","==",e)),a=await At(s,"getForeignProductByInternalId");if(a.empty)return null;{const l=a.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:c.createdAt?.toDate(),updatedAt:c.updatedAt?.toDate()}}}catch(t){throw console.error("Error fetching foreign product by internal ID:",t),new Error("فشل في جلب بيانات المنتج المستورد")}}static async updateForeignProductByInternalId(e,t){try{const s=await this.getForeignProductByInternalId(e);if(!s)throw new Error("Foreign product not found");return await this.updateForeignProduct(s.id,t)}catch(s){throw console.error("Error updating foreign product by internal ID:",s),new Error("فشل في تحديث بيانات المنتج المستورد")}}static async deleteForeignProduct(e){try{const t=ht(Ce,Zc,e);return await er(t,"deleteForeignProduct"),Rb(),!0}catch(t){throw console.error("Error deleting foreign product:",t),new Error("فشل في حذف المنتج المستورد")}}static async deleteForeignProductByInternalId(e){try{const t=await this.getForeignProductByInternalId(e);if(!t)throw new Error("Foreign product not found");return await this.deleteForeignProduct(t.id)}catch(t){throw console.error("Error deleting foreign product by internal ID:",t),new Error("فشل في حذف المنتج المستورد")}}static async searchForeignProducts(e){try{const t=dt(Ce,Zc);return(await At(t,"searchForeignProducts")).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||kt("FOREIGN_PRODUCT"),...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate()}}).filter(c=>c.name?.toLowerCase().includes(e.toLowerCase())||c.category?.toLowerCase().includes(e.toLowerCase())||c.description?.toLowerCase().includes(e.toLowerCase())||c.supplier?.toLowerCase().includes(e.toLowerCase()))}catch(t){if(console.error("Error searching foreign products:",t),console.error("Error details:",t.code,t.message),t.code==="failed-precondition"||t.message.includes("index")||t.code==="not-found")return console.log("Collection appears to be empty or missing, returning empty array"),[];throw new Error("فشل في البحث عن المنتجات المستوردة: "+t.message)}}static async migrateExistingData(){try{console.log("Starting foreign products migration...");const e=await this.getAllForeignProducts();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("fp_")){const a=kt("FOREIGN_PRODUCT");await this.updateForeignProduct(s.id,{...s,internalId:a}),t++,console.log(`Migrated foreign product: ${s.name} -> ${a}`)}return console.log(`Migration completed. ${t} foreign products migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("فشل في ترحيل البيانات")}}static validateForeignProductData(e){const t={};return e.name?.trim()||(t.name="اسم المنتج المستورد مطلوب"),e.category?.trim()||(t.category="فئة المنتج المستورد مطلوبة"),e.unit?.trim()||(t.unit="الوحدة مطلوبة"),(!e.price||parseFloat(e.price)<=0)&&(t.price="السعر يجب أن يكون أكبر من صفر"),t}}const lx=Object.freeze(Object.defineProperty({__proto__:null,ForeignProductService:Nr},Symbol.toStringTag,{value:"Module"})),fa="tenderItems",ed=()=>{window.dispatchEvent(new CustomEvent("tenderItemsUpdated",{detail:{timestamp:Date.now()}}))};class sv{static async getTenderItems(e){try{console.log("🔍 Fetching tender items for tender:",e);const t=dt(Ce,fa),s=Gt(t,Sn("tenderId","==",e),ps("createdAt","desc")),l=(await At(s)).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||kt("TENDER_ITEM"),...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate()}});return console.log("✅ Fetched tender items:",l.length),l}catch(t){if(console.error("❌ Error fetching tender items:",t),t.code==="failed-precondition"){console.log("⚠️ OrderBy failed, trying simple query...");try{const s=dt(Ce,fa),a=Gt(s,Sn("tenderId","==",e)),c=(await At(a)).docs.map(u=>{const m=u.data();return{id:u.id,internalId:m.internalId||kt("TENDER_ITEM"),...m,createdAt:m.createdAt?.toDate(),updatedAt:m.updatedAt?.toDate()}});return c.sort((u,m)=>(m.createdAt||new Date(0))-(u.createdAt||new Date(0))),c}catch(s){return console.error("❌ Fallback query failed:",s),[]}}throw new Error("فشل في جلب بنود المناقصة")}}static async addMaterialToTender(e,t,s,a=1){try{console.log("📝 Adding material to tender:",{tenderId:e,materialInternalId:t,materialType:s,quantity:a});const c=(await this.getTenderItems(e)).find(R=>R.materialInternalId===t&&R.materialType===s);if(c){console.log("⚠️ Duplicate material found, updating quantity instead");const R=(c.quantity||1)+a;return await this.updateTenderItemQuantity(c.id,R)}let u=null;switch(s){case"rawMaterial":u=await wr.getRawMaterialByInternalId(t);break;case"localProduct":u=await vr.getLocalProductByInternalId(t);break;case"foreignProduct":u=await Nr.getForeignProductByInternalId(t);break;default:throw new Error(`نوع المادة غير مدعوم: ${s}`)}if(!u)throw new Error(`لا يمكن العثور على المادة: ${t}`);const m=parseFloat(a)||1,p=parseFloat(u.price)||0,b=m*p,w={internalId:kt("TENDER_ITEM"),tenderId:e,materialInternalId:t,materialType:s,materialName:u.name,materialCategory:u.category,materialUnit:u.unit,quantity:m,unitPrice:p,totalPrice:b,supplierInfo:{name:u.supplier||"",id:u.supplierId||""},createdAt:_t(),updatedAt:_t()},N=await Mr(dt(Ce,fa),w);return console.log("✅ Added tender item with ID:",N.id),ed(),{id:N.id,...w,createdAt:new Date,updatedAt:new Date}}catch(l){throw console.error("❌ Error adding material to tender:",l),new Error(`فشل في إضافة المادة للمناقصة: ${l.message}`)}}static async updateTenderItemQuantity(e,t){try{console.log("📝 Updating tender item quantity:",{itemId:e,newQuantity:t});const s=await this.getTenderItemById(e);if(!s)throw new Error("البند غير موجود");const a=parseFloat(t)||1,l=a*(s.unitPrice||0),c=ht(Ce,fa,e);return await Zs(c,{quantity:a,totalPrice:l,updatedAt:_t()}),console.log("✅ Updated tender item quantity"),ed(),{...s,quantity:a,totalPrice:l,updatedAt:new Date}}catch(s){throw console.error("❌ Error updating tender item quantity:",s),new Error("فشل في تحديث كمية البند")}}static async getTenderItemById(e){try{const t=ht(Ce,fa,e),s=await hs(t);if(s.exists()){const a=s.data();return{id:s.id,internalId:a.internalId||kt("TENDER_ITEM"),...a,createdAt:a.createdAt?.toDate(),updatedAt:a.updatedAt?.toDate()}}else return null}catch(t){throw console.error("❌ Error fetching tender item by ID:",t),new Error("فشل في جلب بيانات البند")}}static async updateTenderItem(e,t){try{const s=ht(Ce,fa,e);return await Zs(s,{...t,updatedAt:_t()}),ed(),!0}catch(s){throw console.error("❌ Error updating tender item:",s),new Error("فشل في تحديث البند")}}static async deleteTenderItem(e){try{const t=ht(Ce,fa,e);return await er(t),ed(),!0}catch(t){throw console.error("❌ Error deleting tender item:",t),new Error("فشل في حذف البند")}}static async deleteAllTenderItems(e){try{console.log("🗑️ Deleting all items for tender:",e);const t=await this.getTenderItems(e);if(t.length===0)return!0;const s=Zo(Ce);return t.forEach(a=>{const l=ht(Ce,fa,a.id);s.delete(l)}),await s.commit(),console.log("✅ Deleted all tender items:",t.length),ed(),!0}catch(t){throw console.error("❌ Error deleting all tender items:",t),new Error("فشل في حذف جميع بنود المناقصة")}}static async refreshTenderItemsPricing(e){try{console.log("🔄 Refreshing prices for tender:",e);let t;if(Array.isArray(e)?(console.log("📦 Input is array of items, using directly"),t=e):(console.log("🔍 Input is tender ID, fetching items from database"),t=await this.getTenderItems(e)),!t||t.length===0)return console.log("📭 No items to refresh pricing for"),[];const s=[],a=Zo(Ce);let l=0;const c=Array.isArray(e);for(const u of t)try{let m=null;switch(u.materialType){case"rawMaterial":m=await wr.getRawMaterialByInternalId(u.materialInternalId);break;case"localProduct":m=await vr.getLocalProductByInternalId(u.materialInternalId);break;case"foreignProduct":m=await Nr.getForeignProductByInternalId(u.materialInternalId);break}if(m){const p=parseFloat(m.price)||0,b=(u.quantity||1)*p;if(!c&&u.id&&p!==u.unitPrice){console.log("🔄 Updating database item price:",u.materialName);const N=ht(Ce,fa,u.id);a.update(N,{unitPrice:p,totalPrice:b,supplierInfo:{name:m.supplier||"",id:m.supplierId||""},updatedAt:_t()}),l++}s.push({...u,unitPrice:p,totalPrice:b,supplierInfo:m.supplier||u.supplierInfo||"",materialUnit:m.unit||u.materialUnit||"قطعة"})}else console.warn("⚠️ Material not found for item:",u.materialInternalId),s.push(u)}catch(m){console.error("❌ Error refreshing item:",u.materialName,m),s.push(u)}return l>0&&(await a.commit(),console.log("✅ Batch updated",l,"items")),ed(),s}catch(t){throw console.error("❌ Error refreshing tender items pricing:",t),new Error("فشل في تحديث أسعار البنود")}}static async addMultipleMaterialsToTender(e,t){try{console.log("📝 Bulk adding materials to tender:",{tenderId:e,count:t.length});const s=Zo(Ce),a=[],l=await this.getTenderItems(e),c=new Set(l.map(u=>`${u.materialInternalId}_${u.materialType}`));for(const u of t){const m=`${u.materialInternalId}_${u.materialType}`;if(c.has(m)){console.log("⚠️ Skipping duplicate material:",u.materialInternalId);continue}let p=null;switch(u.materialType){case"rawMaterial":p=await wr.getRawMaterialByInternalId(u.materialInternalId);break;case"localProduct":p=await vr.getLocalProductByInternalId(u.materialInternalId);break;case"foreignProduct":p=await Nr.getForeignProductByInternalId(u.materialInternalId);break}if(p){const b=parseFloat(u.quantity)||1,w=parseFloat(p.price)||0,N=b*w,R={internalId:kt("TENDER_ITEM"),tenderId:e,materialInternalId:u.materialInternalId,materialType:u.materialType,materialName:p.name,materialCategory:p.category,materialUnit:p.unit,quantity:b,unitPrice:w,totalPrice:N,supplierInfo:{name:p.supplier||"",id:p.supplierId||""},createdAt:_t(),updatedAt:_t()},O=ht(dt(Ce,fa));s.set(O,R),a.push({id:O.id,...R,createdAt:new Date,updatedAt:new Date})}}return a.length>0&&(await s.commit(),console.log("✅ Bulk added items:",a.length)),ed(),a}catch(s){throw console.error("❌ Error bulk adding materials:",s),new Error("فشل في إضافة المواد للمناقصة")}}static async materialExistsInTender(e,t,s){try{return(await this.getTenderItems(e)).some(l=>l.materialInternalId===t&&l.materialType===s)}catch(a){return console.error("❌ Error checking material existence:",a),!1}}static async getTenderTotals(e){try{const t=await this.getTenderItems(e),s=t.reduce((c,u)=>c+(u.totalPrice||0),0),a=t.reduce((c,u)=>c+(u.quantity||0),0),l=t.length;return{totalPrice:s,totalQuantity:a,itemsCount:l,items:t}}catch(t){throw console.error("❌ Error calculating tender totals:",t),new Error("فشل في حساب إجماليات المناقصة")}}static async getTenderItemsByType(e,t){try{const s=dt(Ce,fa),a=Gt(s,Sn("tenderId","==",e),Sn("materialType","==",t),ps("createdAt","desc"));return(await At(a)).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||kt("TENDER_ITEM"),...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate()}})}catch(s){return console.error("❌ Error fetching items by type:",s),(await this.getTenderItems(e)).filter(l=>l.materialType===t)}}static async migrateLocalStorageItems(e,t){try{if(console.log("🔄 Migrating localStorage items to Firebase:",t.length),!Array.isArray(t)||t.length===0)return[];const s=[];for(const a of t)try{if(!await this.materialExistsInTender(e,a.materialInternalId,a.materialType||"rawMaterial")){const c=await this.addMaterialToTender(e,a.materialInternalId,a.materialType||"rawMaterial",a.quantity||1);s.push(c)}}catch(l){console.error("⚠️ Failed to migrate item:",a.materialName,l)}return console.log("✅ Migration completed:",s.length,"items migrated"),s}catch(s){throw console.error("❌ Error migrating localStorage items:",s),new Error("فشل في ترحيل البيانات")}}static async searchTenderItems(e,t){try{const s=await this.getTenderItems(e);if(!t.trim())return s;const a=t.toLowerCase();return s.filter(l=>(l.materialName||"").toLowerCase().includes(a)||(l.materialCategory||"").toLowerCase().includes(a)||(l.supplierInfo?.name||"").toLowerCase().includes(a)||(l.materialType||"").toLowerCase().includes(a))}catch(s){throw console.error("❌ Error searching tender items:",s),new Error("فشل في البحث عن البنود")}}static async getMaterialsSummary(e){try{const t=await this.getTenderItems(e),s={rawMaterial:{count:0,totalPrice:0},localProduct:{count:0,totalPrice:0},foreignProduct:{count:0,totalPrice:0}};return t.forEach(a=>{const l=a.materialType||"rawMaterial";s[l]&&(s[l].count++,s[l].totalPrice+=a.totalPrice||0)}),s}catch(t){throw console.error("❌ Error getting materials summary:",t),new Error("فشل في تجميع بيانات المواد")}}static validateTenderItemData(e){const t={};return e.tenderId?.trim()||(t.tenderId="معرف المناقصة مطلوب"),e.materialInternalId?.trim()||(t.materialInternalId="معرف المادة مطلوب"),e.materialType?.trim()||(t.materialType="نوع المادة مطلوب"),(!e.quantity||parseFloat(e.quantity)<=0)&&(t.quantity="الكمية يجب أن تكون أكبر من صفر"),t}static async getTenderStatistics(e){try{const t=await this.getTenderItems(e),s=await this.getMaterialsSummary(e);return{totalItems:t.length,totalValue:t.reduce((l,c)=>l+(c.totalPrice||0),0),totalQuantity:t.reduce((l,c)=>l+(c.quantity||0),0),materialTypes:s,averageItemValue:t.length>0?t.reduce((l,c)=>l+(c.totalPrice||0),0)/t.length:0,highestValueItem:t.reduce((l,c)=>(c.totalPrice||0)>(l.totalPrice||0)?c:l,{}),lowestValueItem:t.reduce((l,c)=>(c.totalPrice||0)<(l.totalPrice||Number.MAX_VALUE)?c:l,{})}}catch(t){throw console.error("❌ Error getting tender statistics:",t),new Error("فشل في جلب إحصائيات المناقصة")}}}class f4{static cache=new Map;static creationPromises=new Map;static async ensureEmployeeDocument(e=null){try{const t=e||sn.currentUser;if(!t)throw new Error("No authenticated user");const s=t.uid;if(this.cache.has(s)){const l=this.cache.get(s);if(Date.now()-l.timestamp<6e4)return l.employee}if(this.creationPromises.has(s))return await this.creationPromises.get(s);const a=this.createOrGetEmployee(t);this.creationPromises.set(s,a);try{const l=await a;return this.creationPromises.delete(s),l}catch(l){throw this.creationPromises.delete(s),l}}catch(t){throw console.error("❌ Employee document validation failed:",t),new Error(`فشل في التحقق من سجل الموظف: ${t.message}`)}}static async createOrGetEmployee(e){const t=e.uid;console.log("🔍 Checking employee document for user:",t);const s=ht(Ce,"employees",t),a=await hs(s);if(a.exists()){const l=a.data();return console.log("✅ Employee document found:",{uid:t,name:l.fullName||l.name,status:l.status,email:l.email}),this.cache.set(t,{employee:l,timestamp:Date.now()}),l}return console.log("⚠️ Employee document not found, creating automatically..."),await this.createEmployeeDocument(e)}static async createEmployeeDocument(e){const t=e.uid,s=e.email||"",a=e.displayName||"",l=s.split("@")[0]||"مستخدم",c={fullName:a||l,name:a||l,email:s,status:"active",role:"employee",department:"عام",jobTitle:"موظف",phone:"",nationalId:"",hireDate:new Date().toISOString(),salary:0,createdAt:_t(),updatedAt:_t(),createdBy:"auto-system",autoCreated:!0,uid:t};console.log("🔄 Creating employee document:",c);const u=ht(Ce,"employees",t);return await sh(u,c),console.log("✅ Employee document created successfully for:",t),this.cache.set(t,{employee:c,timestamp:Date.now()}),this.logAutoCreation(t,s),c}static logAutoCreation(e,t){console.log("🔒 Auto-Creation Event:",{type:"EMPLOYEE_AUTO_CREATED",uid:e,email:t,timestamp:new Date().toISOString(),reason:"Missing employee document for authenticated user"})}static clearCache(e=null){e?this.cache.delete(e):this.cache.clear()}static async validateEmployee(e=null){try{const t=await this.ensureEmployeeDocument(e);return{isValid:t.status==="active"||t.autoCreated,employee:t,autoCreated:t.autoCreated||!1}}catch(t){return console.error("❌ Employee validation failed:",t),{isValid:!1,employee:null,error:t.message}}}}typeof window<"u"&&(window.EmployeeAutoCreator=f4);class p4{async uploadFile(e,t="uploads"){try{if(console.log("🔄 Starting file upload...",{fileName:e.name,fileSize:e.size,folder:t,fileType:e.type}),!sn.currentUser)throw console.log("❌ No authenticated user found - cannot upload to Storage"),new Error("يجب تسجيل الدخول أولاً لرفع الملفات");const s=sn.currentUser.uid;if(console.log("✅ Current user:",s),!e)throw new Error("لم يتم تحديد ملف للرفع");const a=10*1024*1024;if(e.size>a)throw new Error("حجم الملف كبير جداً. الحد الأقصى 10 ميجابايت");const l=Date.now(),c=`${t}/${l}_${e.name}`;console.log("📁 Upload path:",c);const u=Wo(ri,c);console.log("📎 Storage reference created for bucket:",ri.app.options.storageBucket),console.log("⬆️ Uploading to Firebase Storage folder:",t);const m=await Zg(u,e),p=await Jm(u);return console.log("✅ File upload successful:",p),{url:p,path:c,originalName:e.name,size:e.size,type:e.type,uploadedBy:s,uploadedAt:new Date().toISOString()}}catch(s){throw console.error("❌ File upload error:",s),console.error("❌ Error code:",s.code),console.error("❌ Error message:",s.message),console.error("❌ Full error object:",s),console.error("❌ Auth state during error:",{hasUser:!!sn.currentUser,uid:sn.currentUser?.uid,email:sn.currentUser?.email}),s.code==="storage/unauthorized"?new Error("غير مخول لرفع الملفات. تحقق من صلاحيات Firebase"):s.code==="storage/canceled"?new Error("تم إلغاء رفع الملف"):s.code==="storage/unknown"?new Error("حدث خطأ غير معروف أثناء رفع الملف"):new Error(s.message||"فشل في رفع الملف")}}async uploadFileWithCustomName(e,t="uploads",s){try{if(!e)throw new Error("لم يتم تحديد ملف للرفع");const a=10*1024*1024;if(e.size>a)throw new Error("حجم الملف كبير جداً. الحد الأقصى 10 ميجابايت");const l=Date.now(),c=s?`${t}/${l}_${s}`:`${t}/${l}_${e.name}`,u=Wo(ri,c),m=await Zg(u,e);return{url:await Jm(u),path:c,originalName:s||e.name,size:e.size,type:e.type,uploadedAt:new Date().toISOString()}}catch(a){throw console.error("❌ File upload error:",a),console.error("❌ Error code:",a.code),console.error("❌ Error message:",a.message),console.error("❌ Full error object:",a),console.error("❌ Auth state during error:",{hasUser:!!sn.currentUser,uid:sn.currentUser?.uid,email:sn.currentUser?.email}),a.code==="storage/unauthorized"?new Error("غير مخول لرفع الملفات. تحقق من صلاحيات Firebase"):a.code==="storage/canceled"?new Error("تم إلغاء رفع الملف"):a.code==="storage/unknown"?new Error("حدث خطأ غير معروف أثناء رفع الملف"):new Error(a.message||"فشل في رفع الملف")}}async deleteFile(e){try{if(!e)throw new Error("مسار الملف غير محدد");const t=Wo(ri,e);await Fx(t),console.log("File deleted successfully:",e)}catch(t){if(console.error("File deletion error:",t),t.code==="storage/object-not-found"){console.warn("File not found for deletion:",e);return}throw new Error(`فشل في حذف الملف: ${t.message}`)}}async getFileURL(e){try{if(!e)throw new Error("مسار الملف غير محدد");const t=Wo(ri,e);return await Jm(t)}catch(t){throw console.error("Get file URL error:",t),new Error(`فشل في الحصول على رابط الملف: ${t.message}`)}}async saveDocumentsToFirestore(e,t){if(!e||!Array.isArray(t))return;const s=t.map(a=>{const l=ht(dt(Ce,`tenders/${e}/tenderDocuments`),a.id||Date.now().toString());return sh(l,a)});await Promise.all(s)}async loadDocumentsFromFirestore(e){try{if(!e)return[];const t=dt(Ce,`tenders/${e}/tenderDocuments`),s=await At(t),a=[];return s.forEach(l=>{a.push({...l.data(),id:l.id})}),console.log(`Loaded ${a.length} documents from Firestore for tender: ${e}`),a}catch(t){return console.error("Error loading documents from Firestore:",t),[]}}validateFile(e,t={}){const{maxSize:s=10*1024*1024,allowedTypes:a=["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}=t;if(!e)throw new Error("لم يتم تحديد ملف");if(e.size>s)throw new Error(`حجم الملف كبير جداً. الحد الأقصى ${Math.round(s/(1024*1024))} ميجابايت`);if(!a.includes(e.type))throw new Error("نوع الملف غير مدعوم. الأنواع المدعومة: PDF, Word, صور");return!0}}const _r=new p4,rv=({show:r,onClose:e,documents:t,setDocuments:s,tenderId:a,uploadingDocument:l,setUploadingDocument:c,handleDocumentUpload:u,handleDeleteClick:m,deleting:p,title:b="وثائق المناقصة"})=>{const{alertConfig:w,closeAlert:N,showSuccess:R,showError:O}=Cn(),{formatDate:G}=yh();return r?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},tabIndex:"-1",dir:"rtl",children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-file-earmark-text me-2"}),b]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:e,"aria-label":"Close"})]}),n.jsx("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"},children:n.jsxs("div",{className:"mb-4",children:[n.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("div",{className:"bg-primary bg-opacity-10 p-2 rounded-circle me-3",children:n.jsx("i",{className:"bi bi-files text-primary"})}),n.jsxs("div",{children:[n.jsx("h6",{className:"mb-0 fw-bold text-primary",children:"مكتبة الوثائق"}),n.jsxs("small",{className:"text-muted",children:["إجمالي الملفات: ",t.length]})]})]}),n.jsxs("div",{style:{marginTop:"10px",marginBottom:"10px"},children:[n.jsx("input",{type:"file",id:"documentUpload",onChange:u,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",style:{display:"none"}}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{console.log("💼 Upload button clicked");const U=document.getElementById("documentUpload");U?(U.click(),console.log("💼 File input triggered")):console.error("❌ File input not found")},disabled:l,style:{height:"32px",minWidth:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",fontWeight:"500"},children:l?n.jsxs(n.Fragment,{children:[n.jsx(Mn,{size:"small"}),n.jsx("span",{className:"ms-2",children:"رفع..."})]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-cloud-upload me-1"}),"إضافة ملف"]})})]})]}),(console.log("🔄 MODAL RENDER CHECK:",new Date().toLocaleTimeString()),console.log("📊 Documents state:",{length:t.length,docs:t.map(U=>({name:U.fileName,url:!!U.fileURL,id:U.id}))}),null),t.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-folder2-open",style:{fontSize:"3rem"}})}),n.jsx("h5",{className:"text-muted",children:"لا توجد وثائق مرفوعة"}),n.jsx("p",{className:"text-muted",children:'انقر على "إضافة ملف" لرفع الوثائق'})]}):n.jsx("div",{className:"table-responsive",style:{maxHeight:"400px",overflowY:"auto"},children:n.jsxs("table",{className:"table table-hover",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",children:"#"}),n.jsx("th",{className:"text-center",children:"اسم الملف"}),n.jsx("th",{className:"text-center",children:"الحجم"}),n.jsx("th",{className:"text-center",children:"تاريخ الإضافة"}),n.jsx("th",{className:"text-center",children:"الإجراءات"})]})}),n.jsx("tbody",{children:t.map((U,T)=>{if(!U||typeof U!="object")return null;const Z=(pe=>!pe||typeof pe!="string"?{icon:"bi-file-earmark",color:"#6c757d"}:pe.includes("pdf")?{icon:"bi-file-earmark-pdf",color:"#dc3545"}:pe.includes("word")||pe.includes("document")?{icon:"bi-file-earmark-word",color:"#2b579a"}:pe.includes("image")?{icon:"bi-file-earmark-image",color:"#198754"}:{icon:"bi-file-earmark",color:"#6c757d"})(U.fileType||""),ie=U.fileName||U.originalFileName||"ملف غير محدد",X=U.fileSize||0;return U.uploadDate,n.jsxs("tr",{children:[n.jsx("td",{className:"text-center fw-bold text-muted",children:T+1}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:`${Z.icon} me-2`,style:{color:Z.color}}),n.jsx("span",{className:"fw-bold text-primary",title:ie,children:ie.length>25?ie.substring(0,25)+"...":ie})]})}),n.jsx("td",{className:"text-center",children:n.jsxs("span",{className:"badge bg-light text-dark",children:[(X/1024/1024).toFixed(2)," م.ب"]})}),n.jsx("td",{className:"text-center",children:n.jsx("small",{className:"text-muted",children:G(U.uploadedAt||U.uploadDate||new Date)})}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("a",{href:U.fileURL||"#",target:"_blank",rel:"noopener noreferrer",className:"btn btn-success",title:"عرض الملف",style:{width:"32px",height:"32px",padding:"0",borderRadius:"6px 0 0 6px",fontSize:"12px"},onClick:pe=>{U.fileURL||(pe.preventDefault(),O("رابط الملف غير متاح","خطأ"))},children:n.jsx("i",{className:"bi bi-eye"})}),n.jsx("button",{className:"btn btn-outline-danger",onClick:()=>m(U),title:"حذف",disabled:p,style:{width:"32px",height:"32px",padding:"0",borderRadius:"0 6px 6px 0",fontSize:"12px"},children:n.jsx("i",{className:"bi bi-trash"})})]})})]},U.id||`doc-${T}`)})})]})})]})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:n.jsxs("div",{className:"d-flex",style:{gap:"10px"},children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:e,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},children:"إغلاق"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>R("الوثائق تحفظ تلقائياً مع المناقصة","تم الحفظ"),style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},children:"حفظ"})]})})]})})}),n.jsx(Tn,{show:w.show,onClose:N,title:w.title,message:w.message,type:w.type,onConfirm:w.onConfirm,showConfirm:w.showConfirm})]}):null};function g4(){const r=os(),{id:e}=ea(),{logActivity:t,getCurrentUser:s}=_n(),{alertConfig:a,closeAlert:l,showSuccess:c,showError:u,showConfirm:m}=Cn(),{isTimelineVisible:p}=Hn(),b=!!e,[w,N]=j.useState(!1),[R,O]=j.useState({title:"",referenceNumber:"",entity:"",description:"",submissionDeadline:"",estimatedValue:"",location:"",contactPerson:"",contactPhone:"",contactEmail:""}),[G,U]=j.useState({}),[T,ee]=j.useState(!1),[Z,ie]=j.useState(!1),[X,pe]=j.useState(!1),[H,B]=j.useState(""),[k,W]=j.useState(!1),[J,z]=j.useState([]),[L,de]=j.useState(!1),[Pe,V]=j.useState(!1),[se,fe]=j.useState(null),[re,_]=j.useState(""),[E,D]=j.useState(!1),[F,te]=j.useState([]),[$,Q]=j.useState([]),[me,I]=j.useState(!1),[le,We]=j.useState(null),[nt,mt]=j.useState(null),[It,rn]=j.useState(!1),[oe,Ue]=j.useState(!1);j.useEffect(()=>{(async()=>{try{if(ie(!0),console.log("🚀 SENIOR REACT: Starting unified data initialization..."),e)console.log("🏷️ EDIT MODE: Skipping pending items check - will load from saved tender");else{console.log("📦 NEW TENDER: Loading pending tender items...");const be=await it.getPendingTenderItems();if(be&&Array.isArray(be)&&be.length>0){console.log("✅ NEW TENDER: Found",be.length,"pending items - SETTING STATE IMMEDIATELY"),console.log("📋 PENDING ITEMS DATA:",be.map(ve=>({id:ve.internalId||ve.materialInternalId,name:ve.materialName||ve.name||"UNNAMED"}))),te(be);const De=be.map(ve=>ve.internalId||ve.materialInternalId||ve.id).filter(ve=>ve);Q(De),console.log("✅ Loaded item IDs for new tender mode:",De),console.log("🎯 NEW TENDER STATE SET: Items initialized with pending data")}else console.log("📦 NEW TENDER: No pending items found")}if(e){console.log("🎯 EDIT MODE: Starting - IDENTICAL to creation mode logic");const be=await Go.getById(e);if(!be){console.error("❌ EDIT MODE: Tender not found");return}console.log("📄 EDIT MODE: Tender loaded:",be.title);const De=await it.getPendingData(`tenderFormData_${e}`);if(De&&Object.keys(De).some($e=>De[$e])){console.log("📋 EDIT MODE: Found saved form changes, using them");const $e={...be,...De};O($e)}else{console.log("📋 EDIT MODE: Using original tender data");const $e={...be};if($e.submissionDeadline){let we=$e.submissionDeadline;we&&typeof we=="object"&&we.seconds?we=new Date(we.seconds*1e3):we&&typeof we=="object"&&we.toDate&&(we=we.toDate()),$e.submissionDeadline=ku(we)}if($e.deadline){let we=$e.deadline;we&&typeof we=="object"&&we.seconds?we=new Date(we.seconds*1e3):we&&typeof we=="object"&&we.toDate&&(we=we.toDate()),$e.submissionDeadline=ku(we),delete $e.deadline}if($e.submissionDate){let we=$e.submissionDate;we&&typeof we=="object"&&we.seconds?we=new Date(we.seconds*1e3):we&&typeof we=="object"&&we.toDate&&(we=we.toDate()),$e.submissionDeadline=ku(we),delete $e.submissionDate}const Ke=await it.getPendingData(`tenderFormData_${e}`);Ke&&(console.log("📋 EDIT MODE: Found pending form changes, merging with tender data"),Object.assign($e,Ke)),O($e)}be.documents&&Array.isArray(be.documents)&&z(be.documents);const ve=await it.getPendingTenderItems();let ze=[];if(be.items&&Array.isArray(be.items)&&(console.log("✅ EDIT MODE: Found existing saved items:",be.items.length),ze=[...be.items]),ve&&ve.length>0){console.log("📦 EDIT MODE: Found pending items from material pages:",ve.length);const $e=ze.map(we=>we.internalId||we.materialInternalId||we.id).filter(we=>we),Ke=ve.filter(we=>{const et=we.internalId||we.materialInternalId||we.id;return et&&!$e.includes(et)});Ke.length>0?(console.log("✅ Adding new items to tender:",Ke.length),ze=[...ze,...Ke]):console.log("⚠️ All pending items were duplicates, skipping"),await it.clearPendingTenderItems(),console.log("🧹 EDIT MODE: Cleared pending items after merging")}if(ze.length>0){console.log("📦 FINAL ITEMS LIST:",ze.map(we=>({internalId:we.internalId||we.materialInternalId,materialName:we.materialName||we.name,supplierInfo:we.supplierInfo,unitPrice:we.unitPrice,quantity:we.quantity,totalPrice:we.totalPrice}))),te(ze);const $e=ze.map(we=>we.internalId||we.materialInternalId||we.id).filter(we=>we);Q($e),console.log("✅ Loaded all item IDs for edit mode:",$e);const Ke=ze.reduce((we,et)=>we+(et.unitPrice||et.price||0)*(et.quantity||1),0);O(we=>({...we,estimatedValue:Ke.toString()})),console.log("🎯 EDIT MODE STATE SET: Final items count:",ze.length)}else console.log("📦 EDIT MODE: No items to load")}else{console.log("🆕 NEW TENDER MODE: Checking for saved form data...");const be=await it.getPendingData("tenderFormData_new");be?(console.log("📋 NEW TENDER: Restoring saved form data from previous session"),O(be)):(console.log("📝 NEW TENDER: Starting with fresh empty form"),O({title:"",referenceNumber:"",entity:"",description:"",submissionDeadline:"",estimatedValue:"",category:"",location:"",contactPerson:"",contactPhone:"",contactEmail:""}));const De=await it.getPendingData("tenderDocuments_new");De&&Array.isArray(De)?(console.log("📄 NEW TENDER: Restoring saved documents"),z(De)):z([]);const ve=await it.getPendingTenderItems();if(ve&&ve.length>0){console.log("🔄 NEW TENDER: Found pending items, adding to form");const ze="tender_success_shown_new",$e=localStorage.getItem(ze)==="true",Ke=F.length===0&&!oe&&!$e;te(ve);const we=ve.reduce((et,ke)=>et+(ke.unitPrice||0)*(ke.quantity||1),0);if(we>0){console.log(`💰 Updating estimated value from items: ${we}`);const et={...be||R,estimatedValue:we.toString()};O(et),await it.setPendingData("tenderFormData_new",et)}Ke?(Ue(!0),localStorage.setItem(ze,"true"),m(`تم إضافة ${ve.length} عنصر للمناقصة بنجاح.

يمكنك الآن مراجعة البنود ومتابعة ملء بيانات المناقصة.`,()=>{},"تمت إضافة البنود","موافق","",!1)):console.log("🔕 Success message skipped (items already exist or already shown)")}else te([]);console.log("✅ NEW TENDER: Form initialized with persistence")}console.log("✅ Data initialization completed")}catch(be){console.error("Error initializing data:",be),u("فشل في تحميل البيانات","خطأ")}finally{ie(!1)}})()},[e]),j.useEffect(()=>()=>{console.log("🔒 COMPONENT UNMOUNT: Keeping pending items for next navigation")},[]);const Je=j.useRef(!1),lt=j.useRef(Date.now()),Dt=async()=>{if(Je.current){console.log("🚫 loadPendingItems already running, skipping...");return}if(e&&F.length>0){console.log("🚫 EDIT MODE: Skipping pending items load - already have saved tender items");return}try{Je.current=!0,console.log("🔍 Loading pending tender items from Firestore...");const he=await it.getPendingTenderItems();if(he){const be=Array.isArray(he)?he:JSON.parse(he);console.log("📦 Found pending tender items:",be.length,"items"),console.log("📋 STORAGE CONTENT:",be.map(De=>({id:De.internalId||De.materialInternalId,name:De.materialName||De.name}))),te(De=>{console.log("✅ PROCESSING NEW ITEMS WITH ID-BASED DUPLICATE PREVENTION");const ve=be.filter(Ke=>{const we=Ke.internalId||Ke.materialInternalId||Ke.id,et=we&&$.includes(we);return et&&console.log("⚠️ DUPLICATE DETECTED (ID-based):",{itemName:Ke.materialName||Ke.name,itemId:we,action:"FILTERED_OUT"}),!et});if(console.log("✅ DUPLICATE PREVENTION RESULTS:",{totalNewItems:be.length,duplicatesFiltered:be.length-ve.length,itemsToAdd:ve.length,existingItems:De.length}),ve.length===0)return console.log("📝 No new items to add after duplicate filtering"),De;const ze=[...De,...ve];if(ve.length>0){const Ke=ve.map(we=>we.internalId||we.materialInternalId||we.id).filter(we=>we);Q(we=>{const et=[...we,...Ke];return console.log("✅ Updated selectedItemIds:",et),et})}const $e=ze.reduce((Ke,we)=>Ke+(we.unitPrice||0)*(we.quantity||1),0);return $e>0&&O(Ke=>({...Ke,estimatedValue:$e.toString()})),console.log("🛡️ SENIOR REACT STORAGE REPLACEMENT COMPLETED:",{prevItemsCount:De.length,storageItemsCount:be.length,finalCount:ze.length,replacementSuccess:"COMPLETE_REPLACEMENT_FROM_STORAGE"}),ze}),setTimeout(()=>{te(De=>(console.log("🔄 FORCE RE-RENDER: Ensuring UI reflects current items count:",De.length),[...De]))},100),console.log("✅ Items loaded and ready - keeping in storage until tender is saved")}else{console.log("📦 No pending tender items found in Firestore");const be=await it.getPendingData(`tenderItems_${e||"new"}`);if(be&&F.length===0)try{Array.isArray(be)&&be.length>0&&(console.log("📦 Loading existing tender items from Firestore:",be.length),te(be))}catch(De){console.error("Error loading Firestore items:",De)}}}catch(he){console.error("Error loading pending items:",he)}finally{setTimeout(()=>{Je.current=!1,console.log("🔓 Released loadPendingItems lock after 3-second cooldown")},3e3)}};j.useEffect(()=>{const he=()=>{console.log("🔍 Custom event received - reloading items..."),Dt()},be=De=>{console.log("🔄 TRASH RESTORE: Tender item restored from trash, reloading items...");const{tenderId:ve,restoredItem:ze}=De.detail||{};ve===(e||"new")?(console.log("✅ RESTORE FOR THIS TENDER: Reloading items for tender",ve),Dt()):console.log("ℹ️ RESTORE FOR OTHER TENDER: Ignoring restoration for tender",ve)};return window.addEventListener("tenderItemsAdded",he),window.addEventListener("tenderItemRestored",be),()=>{window.removeEventListener("tenderItemsAdded",he),window.removeEventListener("tenderItemRestored",be)}},[]);const Ht=j.useRef(!1);j.useEffect(()=>{const be=setTimeout(async()=>{const De=Date.now()-lt.current,ve=De<5e3,ze=Ht.current;if(console.log("🤖 AUTO-SAVE TRIGGERED:",{itemsCount:F.length,isLoadingLocked:Je.current,timeSinceMount:De,isRecentMount:ve,isDeletingOperation:ze,willSave:F.length>0&&!Je.current&&!ve&&!ze}),F.length>0&&!Je.current&&!ve&&!ze)try{await it.setPendingTenderItems(F),console.log("✅ SMART AUTO-SAVE: Saved tender items to Firestore:",F.length,"items"),console.log("📋 AUTO-SAVE CONTENT:",F.map($e=>({id:$e.internalId||$e.materialInternalId,name:$e.materialName||$e.name})))}catch($e){console.error("Error saving tender items:",$e)}else Je.current?console.log("🚫 SMART AUTO-SAVE: Skipping save during item loading to prevent race condition"):ve?console.log("🚫 SMART AUTO-SAVE: Skipping save - component recently mounted, allowing time for item loading"):ze?console.log("🚫 SMART AUTO-SAVE: Skipping save during deletion operation to prevent restoring deleted items"):F.length===0&&console.log("🚫 SMART AUTO-SAVE: Skipping save for empty items array")},2e3);return()=>clearTimeout(be)},[F]),j.useEffect(()=>{const be=setTimeout(async()=>{if(J.length>0)try{await it.setPendingData(`tenderDocuments_${e||"new"}`,J),console.log("Saved tender documents to Firestore:",J.length,"documents")}catch(De){console.error("Error saving tender documents:",De)}},1e3);return()=>clearTimeout(be)},[J,e]),j.useEffect(()=>{const he=e||"new",be=ve=>{const ze=`tenderDocuments_${he}`;if(console.log("💾 Storage event detected:",{key:ve.key,expectedKey:ze,isMatch:ve.key===ze}),ve.key===ze&&ve.newValue)try{const $e=JSON.parse(ve.newValue);console.log("📄 Restoring documents from storage event:",$e.length),z($e);const Ke=$e.filter(we=>we.restoredFrom==="trash").sort((we,et)=>new Date(et.restoredAt||0)-new Date(we.restoredAt||0))[0];if(Ke){const we=s();t("file",`${we.name} استعاد وثيقة من المهملات`,`تم استعادة: ${Ke.fileName}`)}}catch($e){console.error("Error parsing restored documents:",$e)}},De=ve=>{const{tenderId:ze,restoredDocument:$e,allDocuments:Ke}=ve.detail;if(console.log("🎯 Custom restore event detected:",{eventTenderId:ze,currentTenderId:he,isMatch:ze===he,documentName:$e?.fileName}),ze===he){console.log("📄 Updating documents from custom event:",Ke.length),z([...Ke]);const we=s();t("file",`${we.name} استعاد وثيقة من المهملات`,`تم استعادة: ${$e.fileName}`)}};return window.addEventListener("storage",be),window.addEventListener("tenderDocumentRestored",De),()=>{window.removeEventListener("storage",be),window.removeEventListener("tenderDocumentRestored",De)}},[e,c,s,t]);const Ze=j.useCallback(()=>{if(!F||F.length===0)return 0;const he=F.reduce((be,De)=>be+(De.totalPrice||0),0);return console.log("📊 INSTANT: Reflecting pre-calculated total from items:",he),he},[F]);j.useCallback(()=>{const he=F.reduce((be,De)=>be+(De.totalPrice||0),0);return O(be=>({...be,estimatedValue:he.toString()})),console.log("💰 CONTROLLED: Updated estimated value explicitly:",he),he},[F]),j.useEffect(()=>{const be=setTimeout(async()=>{if(Object.keys(R).some(De=>R[De]))try{await it.setPendingData(`tenderFormData_${e||"new"}`,R),console.log("💾 Saved tender form data for navigation persistence:",R.title||"New Tender")}catch(De){console.error("Error saving form data:",De)}},1e3);return()=>clearTimeout(be)},[R,e]);const Vt=()=>{N(!w)},Xt=async he=>{const{name:be,value:De,type:ve,checked:ze}=he.target,$e={...R,[be]:ve==="checkbox"?ze:De};O($e);try{const Ke=e?`tenderFormData_${e}`:"tenderFormData_new";await it.setPendingData(Ke,$e),console.log(`💾 Form data saved for field: ${be}`)}catch(Ke){console.error("Error saving form data:",Ke)}G[be]&&U(Ke=>({...Ke,[be]:""}))},ts=async he=>{he.preventDefault();const be=tf.validateTenderData({...R,submissionDeadline:R.submissionDeadline?new Date(R.submissionDeadline):null});if(Object.keys(be).length>0){U(be);return}ee(!0),U({});try{const De=await oo.validateUniqueFields({referenceNumber:R.referenceNumber},b?e:null,"tenders");if(Object.keys(De).length>0){U(De),ee(!1);return}const ve=F.reduce((Ke,we)=>Ke+(we.totalPrice||0),0),ze={...R,submissionDeadline:R.submissionDeadline?new Date(R.submissionDeadline):null,estimatedValue:ve,documents:J,items:F||[]};console.log("💾 Saving complete tender data to Firebase with calculated total:",{title:ze.title,estimatedValue:ve,documentsCount:(ze.documents||[]).length,itemsCount:(ze.items||[]).length});let $e;if(b){$e=await Go.updateTender(e,ze);const Ke=s();await t("task",`${Ke.name} عدل مناقصة`,`تم تعديل المناقصة: ${ze.title}`),await it.clearPendingData(`tenderFormData_${e}`),await it.clearPendingData(`tenderDocuments_${e}`),await it.clearPendingTenderItems(),c("تم تحديث المناقصة بنجاح","تم التحديث")}else{$e=await Go.createTender(ze);const Ke=s();await t("task",`${Ke.name} أضاف مناقصة`,`تم إضافة المناقصة: ${ze.title}`),await it.clearPendingData("tenderFormData_new"),await it.clearPendingData("tenderDocuments_new"),await it.clearPendingTenderItems(),localStorage.removeItem("tender_success_shown_new"),c("تم إضافة المناقصة بنجاح","تمت الإضافة")}setTimeout(()=>{r("/tenders/list")},1500)}catch(De){U({submit:De.message}),u("فشل في حفظ المناقصة","خطأ في الحفظ")}finally{ee(!1)}},ns=async()=>{try{b||(console.log("🧹 CANCEL: Clearing all pending data for cancelled new tender"),await it.clearPendingData("tenderFormData_new"),await it.clearPendingData("tenderDocuments_new"),await it.clearPendingTenderItems(),localStorage.removeItem("tender_success_shown_new"),console.log("✅ CANCEL: All pending data cleared successfully"))}catch(he){console.error("Error clearing pending data on cancel:",he)}r("/tenders/list")},mn=()=>{pe(!0)},Kt=()=>{pe(!1),B("")},En=he=>{try{switch(console.log("Selected item type:",he),he){case"raw-materials":const be=`/tenders/raw-materials/${e||"new"}`;console.log("Navigating to:",be),r(be);break;case"local-product":const De=`/tenders/local-products/${e||"new"}`;console.log("Navigating to local products:",De),r(De);break;case"imported-product":const ve=`/tenders/foreign-products/${e||"new"}`;console.log("Navigating to foreign products:",ve),r(ve);break;case"manufactured-product":const ze=`/tenders/manufactured-products/${e||"new"}`;console.log("Navigating to manufactured products:",ze),r(ze);break;default:console.log("Unknown item type:",he),u("نوع البند غير معروف","خطأ")}}catch(be){console.error("Error handling item type selection:",be),u("فشل في اختيار نوع البند","خطأ")}},C=(he,be)=>{const De=he.materialName||he.name||"بند غير معروف";m(`هل أنت متأكد من حذف هذا البند؟

${De}`,()=>ne(he,be),"تأكيد حذف البند")},ne=async(he,be)=>{try{D(!0),Ht.current=!0,console.log("🗑️ Starting deletion process:",{itemName:he.materialName||he.name,itemId:he.internalId||he.materialInternalId,isDeletingFlag:Ht.current});const De={...he,tenderContext:{tenderId:e||"new",tenderTitle:R.title||"مناقصة جديدة",addedAt:new Date().toISOString()}};await qn.moveToTrash(De,"tenderItems"),console.log("✅ Successfully moved to trash"),te($e=>{const Ke=$e.filter((ke,Ve)=>Ve!==be),we=he?.internalId||he?.materialInternalId||he?.id;we&&Q(ke=>ke.filter(Ve=>Ve!==we));const et=Ke.reduce((ke,Ve)=>ke+(Ve.totalPrice||0),0);return O(ke=>({...ke,estimatedValue:et.toString()})),console.log("✅ Item removed from list, new count:",Ke.length),Ke}),setTimeout(()=>{Ht.current=!1,console.log("✅ Deletion flag cleared, auto-save can resume")},5e3);const ve=s(),ze=he.materialName||he.name||"بند غير معروف";t("task",`${ve.name} حذف بند مناقصة`,`تم حذف البند: ${ze}`),c(`تم نقل البند للمهملات: ${ze}`,"تم النقل للمهملات")}catch(De){console.error("❌ Error moving tender item to trash:",De),u(`فشل في نقل البند للمهملات: ${De.message}`,"خطأ في النقل"),Ht.current=!1}finally{D(!1)}},ue=(he,be)=>{We({...he}),mt(be),I(!0)},ce=(he,be)=>{const De=Math.max(0,parseFloat(be)||0);We(ve=>({...ve,quantity:Number(De.toFixed(1)),totalPrice:(ve.unitPrice||0)*Number(De.toFixed(1))}))},ye=()=>{nt!==null&&le&&(te(he=>he.map((be,De)=>De===nt?le:be)),I(!1),We(null),mt(null),c("تم تحديث بيانات البند بنجاح","تم التحديث"))},Le=()=>{I(!1),We(null),mt(null)},Nt=()=>Math.round(le?.totalPrice||0),yt=async he=>{const be=he.target.files[0];if(be){de(!0);try{try{_r.validateFile(be,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]})}catch(ve){throw new Error(ve.message)}console.log("📤 Uploading document:",be.name);const De=await _r.uploadFile(be,"tender-documents");fe({...De,originalFileName:be.name,fileSize:be.size,fileType:be.type}),_(be.name.split(".")[0]),V(!0),he.target.value=""}catch(De){console.error("Error uploading document:",De),u(De.message||"فشل في رفع الملف","خطأ في الرفع"),he.target&&(he.target.value="")}finally{de(!1)}}},$s=async()=>{if(!re.trim()){u("يرجى إدخال اسم الملف","اسم الملف مطلوب");return}if(!se){u("بيانات الملف غير متاحة","خطأ");return}try{de(!0),console.log("📤 Creating document with Firebase database storage:",re);const he={id:Date.now().toString(),fileName:re.trim(),originalFileName:se.originalFileName,fileURL:se.url,storagePath:se.path,fileSize:se.fileSize,fileType:se.fileType,uploadedAt:new Date().toISOString(),uploadDate:new Date().toISOString(),tenderId:e||"new",tenderTitle:R.title||"مناقصة جديدة",tenderReferenceNumber:R.referenceNumber||"غير محدد"};if(z(De=>[...De,he]),e&&e!=="new")try{console.log("💾 Saving document to Firebase database for existing tender:",e);const De=await tf.getTenderById(e);if(De){const ve=[...De.documents||[],he];await tf.updateTender(e,{...De,documents:ve}),console.log("✅ Document saved to Firebase database successfully")}}catch(De){console.warn("⚠️ Firebase database save failed, document stored locally only:",De.message)}else console.log("📋 Document stored locally for new tender, will be saved to Firebase when tender is created");c(`تم رفع الملف بنجاح: ${re}`,"تم الرفع");const be=s();t("file",`${be.name} رفع وثيقة`,`تم رفع الملف: ${re}`),V(!1),fe(null),_("")}catch(he){console.error("Error saving document:",he),u(`فشل في رفع الملف: ${he.message}`,"خطأ في الرفع")}finally{de(!1)}},_e=()=>{console.log("User cancelled file upload"),V(!1),fe(null),_("")},Xe=he=>{m(`هل أنت متأكد من حذف هذا الملف؟

${he.fileName}`,()=>Be(he),"تأكيد حذف الملف")},Be=async he=>{try{D(!0),await qn.moveToTrash(he,"tender_documents"),z(De=>De.filter(ve=>ve.id!==he.id));const be=s();t("task",`${be.name} حذف وثيقة`,`تم حذف الوثيقة: ${he.fileName}`),c(`تم نقل الملف للمهملات: ${he.fileName}`,"تم النقل للمهملات")}catch(be){u(`فشل في نقل الملف للمهملات: ${be.message}`,"خطأ في النقل")}finally{D(!1)}};return n.jsx(n.Fragment,{children:n.jsxs("div",{className:`page-wrapper ${w?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Xn,{onToggle:Vt}),n.jsxs("div",{className:"main-container",style:{paddingRight:w?"72px":"250px",paddingLeft:w||!p?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:w?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:w})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item",children:n.jsx("a",{href:"/tenders/list",className:"text-decoration-none text-primary",children:"المناقصات"})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:b?"تعديل مناقصة":"إضافة مناقصة جديدة"})]})}),n.jsx(Jn,{}),n.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:n.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[n.jsx("div",{className:"d-flex align-items-center",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:`bi ${b?"bi-pencil-square":"bi-plus-circle-fill"} text-primary me-2`}),b?"تعديل المناقصة":"إضافة مناقصة جديدة"]})}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-primary",onClick:mn,style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:"إضافة بند"}),n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>W(!0),style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:"وثائق المناقصة"})]})]})}),n.jsx("div",{className:"card-body",children:Z?n.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:n.jsx(Mn,{size:"large"})}):n.jsxs("form",{onSubmit:ts,children:[G.submit&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),G.submit]}),n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-8 mb-3",children:[n.jsx("label",{className:"form-label",children:"عنوان المناقصة *"}),n.jsx("input",{type:"text",className:`form-control ${G.title?"is-invalid":""}`,name:"title",value:R.title,onChange:Xt,placeholder:"أدخل عنوان المناقصة",disabled:T}),G.title&&n.jsx("div",{className:"invalid-feedback",children:G.title})]}),n.jsxs("div",{className:"col-md-4 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم المرجع *"}),n.jsx("input",{type:"text",className:`form-control ${G.referenceNumber?"is-invalid":""}`,name:"referenceNumber",value:R.referenceNumber,onChange:Xt,placeholder:"رقم المرجع",disabled:T}),G.referenceNumber&&n.jsx("div",{className:"invalid-feedback",children:G.referenceNumber})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"جهة المناقصة *"}),n.jsx("input",{type:"text",className:`form-control ${G.entity?"is-invalid":""}`,name:"entity",value:R.entity,onChange:Xt,placeholder:"اسم جهة المناقصة",disabled:T}),G.entity&&n.jsx("div",{className:"invalid-feedback",children:G.entity})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"موعد انتهاء التقديم *"}),n.jsx("input",{type:"date",className:`form-control ${G.submissionDeadline?"is-invalid":""}`,name:"submissionDeadline",value:R.submissionDeadline,onChange:Xt,disabled:T,required:!0}),G.submissionDeadline&&n.jsx("div",{className:"invalid-feedback",children:G.submissionDeadline})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsxs("label",{className:"form-label",children:["التكلفة التقديرية",n.jsx("small",{className:"text-muted ms-2",children:"(محسوبة تلقائياً من البنود)"})]}),n.jsxs("div",{className:"input-group",children:[n.jsx("input",{type:"text",className:"form-control bg-light",name:"estimatedValue",value:(()=>{const he=parseFloat(R.estimatedValue)||0;return he>0?`${he.toLocaleString("en-US")} ريال`:"0 ريال"})(),readOnly:!0,placeholder:"سيتم حسابها من البنود المضافة",style:{backgroundColor:"#f8f9fa",fontWeight:"bold",color:"#198754"}}),n.jsx("span",{className:"input-group-text bg-light text-success",children:n.jsx("i",{className:"bi bi-calculator"})})]})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"المدينة"}),n.jsx("input",{type:"text",className:"form-control",name:"location",value:R.location,onChange:Xt,placeholder:"مدينة تنفيذ المناقصة",disabled:T})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"الشخص المسؤول"}),n.jsx("input",{type:"text",className:"form-control",name:"contactPerson",value:R.contactPerson,onChange:Xt,placeholder:"اسم الشخص المسؤول",disabled:T})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الهاتف"}),n.jsx("input",{type:"tel",className:"form-control",name:"contactPhone",value:R.contactPhone,onChange:Xt,placeholder:"رقم الهاتف",disabled:T})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"البريد الإلكتروني"}),n.jsx("input",{type:"email",className:"form-control",name:"contactEmail",value:R.contactEmail,onChange:Xt,placeholder:"البريد الإلكتروني",disabled:T})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"وصف المناقصة"}),n.jsx("textarea",{className:"form-control",name:"description",value:R.description,onChange:Xt,rows:"4",placeholder:"وصف تفصيلي للمناقصة ومتطلباتها...",disabled:T})]}),n.jsx("div",{className:"col-md-12 mb-4",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-light",children:n.jsx("div",{className:"d-flex justify-content-between align-items-center",children:n.jsxs("h6",{className:"mb-0 fw-bold text-primary",children:[n.jsx("i",{className:"bi bi-list-task me-2"}),"بنود المناقصة (",F.length,")",F.length===0&&n.jsx("span",{className:"text-danger",children:"- لا توجد بنود"})]})})}),n.jsx("div",{className:"card-body p-0",children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"اسم المادة"}),n.jsx("th",{className:"text-center",children:"الكمية"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر الإجمالي"}),n.jsx("th",{className:"text-center",style:{width:"60px"},children:"إجراء"})]})}),n.jsx("tbody",{children:F&&F.length>0?F.map((he,be)=>{let De=he.materialName||he.name||"مادة غير محددة";De&&De.toString().startsWith("rm_")&&(De="مادة غير محددة");const ve=he.materialUnit||he.unit||"قطعة",ze=he.totalPrice||0,$e=he.internalId;return n.jsxs("tr",{style:{backgroundColor:be%2===0?"#ffffff":"#f8f9fa"},children:[n.jsx("td",{className:"text-center fw-bold text-muted",children:be+1}),n.jsx("td",{className:"text-center fw-medium",children:n.jsx("div",{children:n.jsx("button",{className:"btn btn-link p-0 fw-medium text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:async Ke=>{Ke.preventDefault(),Ke.stopPropagation();try{console.log("=== DETAILED DEBUGGING ==="),console.log("Full item object:",JSON.stringify(he,null,2)),console.log("All item keys:",Object.keys(he));const we=he.materialInternalId,et=he.materialType||"rawMaterial";console.log("Searching for:"),console.log("- materialInternalId:",we),console.log("- materialType:",et);let ke=null,Ve=[];if(et==="rawMaterial"){console.log("Loading raw materials...");const{RawMaterialService:Tt}=await Ds(async()=>{const{RawMaterialService:pt}=await Promise.resolve().then(()=>ax);return{RawMaterialService:pt}},void 0);Ve=await Tt.getAllRawMaterials(),console.log("Total raw materials loaded:",Ve.length),console.log("Sample raw material IDs:",Ve.slice(0,3).map(pt=>({id:pt.id,internalId:pt.internalId,name:pt.name})));let ft=Ve.find(pt=>pt.internalId===we);if(ft||(ft=Ve.find(pt=>pt.id===we)),!ft){const pt=he.materialName||he.name;ft=Ve.find(ls=>ls.name===pt)}console.log("Found raw material:",ft?"YES":"NO"),ft&&(console.log("Material details:",{id:ft.id,internalId:ft.internalId,name:ft.name}),ke=ft.id,r(`/raw-materials/edit/${ke}`))}else if(et==="localProduct"){console.log("Loading local products...");const{LocalProductService:Tt}=await Ds(async()=>{const{LocalProductService:pt}=await Promise.resolve().then(()=>ox);return{LocalProductService:pt}},void 0);Ve=await Tt.getAllLocalProducts(),console.log("Total local products loaded:",Ve.length),console.log("Sample local product IDs:",Ve.slice(0,3).map(pt=>({id:pt.id,internalId:pt.internalId,name:pt.name})));let ft=Ve.find(pt=>pt.internalId===we);if(ft||(ft=Ve.find(pt=>pt.id===we)),!ft){const pt=he.materialName||he.name;ft=Ve.find(ls=>ls.name===pt)}console.log("Found local product:",ft?"YES":"NO"),ft&&(console.log("Product details:",{id:ft.id,internalId:ft.internalId,name:ft.name}),ke=ft.id,r(`/local-products/edit/${ke}`))}else if(et==="foreignProduct"){console.log("Loading foreign products...");const{ForeignProductService:Tt}=await Ds(async()=>{const{ForeignProductService:pt}=await Promise.resolve().then(()=>lx);return{ForeignProductService:pt}},void 0);Ve=await Tt.getAllForeignProducts(),console.log("Total foreign products loaded:",Ve.length),console.log("Sample foreign product IDs:",Ve.slice(0,3).map(pt=>({id:pt.id,internalId:pt.internalId,name:pt.name})));let ft=Ve.find(pt=>pt.internalId===we);if(ft||(ft=Ve.find(pt=>pt.id===we)),!ft){const pt=he.materialName||he.name;ft=Ve.find(ls=>ls.name===pt)}console.log("Found foreign product:",ft?"YES":"NO"),ft&&(console.log("Product details:",{id:ft.id,internalId:ft.internalId,name:ft.name}),ke=ft.id,r(`/foreign-products/edit/${ke}`))}else if(et==="manufacturedProduct"){console.log("Loading manufactured products...");const{ManufacturedProductService:Tt}=await Ds(async()=>{const{ManufacturedProductService:pt}=await Promise.resolve().then(()=>uC);return{ManufacturedProductService:pt}},void 0);Ve=await Tt.getAllManufacturedProducts(),console.log("Total manufactured products loaded:",Ve.length),console.log("Sample manufactured product IDs:",Ve.slice(0,3).map(pt=>({id:pt.id,internalId:pt.internalId,title:pt.title})));let ft=Ve.find(pt=>pt.internalId===we);ft||(ft=Ve.find(pt=>pt.id===we)),ft||(ft=Ve.find(pt=>pt.title===he.materialName)),console.log("Found manufactured product:",ft?"YES":"NO"),ft&&(console.log("Product details:",{id:ft.id,internalId:ft.internalId,title:ft.title}),ke=ft.id,r(`/manufactured-products/edit/${ke}`))}ke||(console.error("=== SEARCH FAILED ==="),console.error("Could not find Firebase ID for:",we),console.error("Available items in this category:",Ve.map(Tt=>({id:Tt.id,internalId:Tt.internalId,name:Tt.name}))),alert(`لا يمكن العثور على هذه المادة
ID: ${we}
Type: ${et}`))}catch(we){console.error("=== NAVIGATION ERROR ===",we),alert("حدث خطأ أثناء محاولة فتح المادة")}},title:`تحرير: ${De}`,children:De})})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"badge bg-primary",children:he.quantity||1})}),n.jsx("td",{className:"text-center",children:ve}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{children:[n.jsxs("span",{className:"text-success fw-bold",children:[ze.toLocaleString("en-US")," ر.س"]}),he.unitPrice&&n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:[he.unitPrice.toLocaleString("en-US")," × ",he.quantity]})})]})}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"btn-group btn-group-sm",style:{marginLeft:"20px"},children:[n.jsx("button",{className:"btn btn-outline-primary",type:"button",onClick:Ke=>{Ke.preventDefault(),Ke.stopPropagation(),ue(he,be)},title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{className:"btn btn-outline-danger",type:"button",onClick:Ke=>{Ke.preventDefault(),Ke.stopPropagation(),C(he,be)},title:"حذف",disabled:E,children:n.jsx("i",{className:"bi bi-trash"})})]})})]},$e||`item-${be}`)}):n.jsx("tr",{children:n.jsx("td",{colSpan:"6",className:"text-center py-4 text-muted",children:"لا توجد بنود في المناقصة"})})}),n.jsx("tfoot",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{colSpan:"4",className:"text-end",children:"إجمالي القيمة:"}),n.jsxs("th",{className:"text-center text-primary fw-bold",children:[Ze().toLocaleString("en-US")," ر.س"]}),n.jsx("th",{})]})})]})})})]})})]}),n.jsx("div",{className:"row",children:n.jsxs("div",{className:"col-12 d-flex justify-content-center gap-3 mt-4",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",style:{height:"32px",minWidth:"80px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},onClick:ns,disabled:T,children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary",style:{height:"32px",minWidth:"80px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},disabled:T,children:T?n.jsxs(n.Fragment,{children:[n.jsx(Mn,{size:"small"}),n.jsx("span",{className:"ms-2",children:b?"تحديث...":"حفظ..."})]}):b?"تحديث":"حفظ"})]})})]})})]})})}),!w&&p&&n.jsx(Zn,{rtl:!0}),!w&&p&&n.jsx(es,{})]})]}),me&&le&&n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-calculator me-2"}),"تحديد الكميات والأسعار"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:Le,"aria-label":"Close"})]}),n.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"30%"},children:"البند"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"السعر الأساسي"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"المورد"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"إجمالي السعر"})]})}),n.jsx("tbody",{children:n.jsxs("tr",{style:{height:"60px"},children:[n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:"bi bi-layers text-danger me-2"}),n.jsxs("div",{children:[n.jsx("div",{className:"fw-bold text-primary",children:le.materialName||le.name}),n.jsx("small",{className:"text-muted",children:le.materialCategory||le.category})]})]})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("span",{className:"fw-bold text-success",children:[Math.round(le.unitPrice)," ريال"]}),n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:["/",le.materialUnit||le.unit||"وحدة"]})})]}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:he=>{he.preventDefault(),he.stopPropagation(),ce(le.internalId,Math.max(0,Number((le.quantity-.1).toFixed(1))))},disabled:le.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-dash"})}),n.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:le.quantity,min:"0",step:"any",onChange:he=>{he.preventDefault(),he.stopPropagation(),ce(le.internalId,he.target.value)},onBlur:he=>{he.preventDefault(),he.stopPropagation();const be=Number(he.target.value||0).toFixed(1);ce(le.internalId,be)}}),n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:he=>{he.preventDefault(),he.stopPropagation(),ce(le.internalId,Number((le.quantity+.1).toFixed(1)))},style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-plus"})})]})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"text-muted",children:le.displaySupplier||le.supplierInfo||"-"})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(le.totalPrice)," ريال"]}),n.jsxs("small",{className:"text-success",children:["(",le.quantity.toFixed(1)," × ",Math.round(le.unitPrice),")"]})]})]},le.internalId)})]})})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:n.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("span",{className:"text-muted me-3",children:"إجمالي البند:"}),n.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[Nt()," ريال"]}),n.jsxs("span",{className:"badge bg-info ms-2",children:[le.quantity.toFixed(1)," قطعة"]})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:Le,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:he=>{he.preventDefault(),he.stopPropagation(),ye()},style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"تأكيد"})]})]})})]})})}),n.jsx(Tn,{show:a.show,onClose:l,title:a.title,message:a.message,type:a.type,onConfirm:a.onConfirm,confirmText:a.confirmText,cancelText:a.cancelText,showCancel:a.showCancel}),n.jsx(rC,{show:X,onClose:Kt,onItemSelect:En,selectedItemType:H,setSelectedItemType:B}),n.jsx(rv,{show:k,onClose:()=>W(!1),documents:J,setDocuments:z,tenderId:e||"new",uploadingDocument:L,setUploadingDocument:de,handleDocumentUpload:yt,handleDeleteClick:Xe,deleting:E}),Pe&&n.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.7)",zIndex:1060},tabIndex:"-1",dir:"rtl",children:n.jsx("div",{className:"modal-dialog modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsx("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"12px 12px 0 0"},children:n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-pencil-square me-2"}),"تسمية الملف"]})}),n.jsx("div",{className:"modal-body",style:{padding:"25px"},children:n.jsxs("div",{className:"mb-4",children:[n.jsxs("div",{className:"d-flex align-items-center mb-3",children:[n.jsx("div",{className:"bg-success bg-opacity-10 p-2 rounded-circle me-3",children:n.jsx("i",{className:"bi bi-file-earmark-check text-success"})}),n.jsxs("div",{children:[n.jsx("h6",{className:"mb-0 fw-bold text-success",children:"تم رفع الملف بنجاح"}),n.jsx("small",{className:"text-muted",children:se?.originalFileName})]})]}),n.jsxs("div",{className:"mb-3",children:[n.jsxs("label",{className:"form-label fw-bold text-primary",children:[n.jsx("i",{className:"bi bi-tag me-1"}),"اسم الملف المخصص *"]}),n.jsx("input",{type:"text",className:"form-control",value:re,onChange:he=>_(he.target.value),placeholder:"أدخل اسم الملف المخصص",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:he=>{he.target.style.borderColor="#28a745",he.target.style.boxShadow="0 0 0 0.2rem rgba(40, 167, 69, 0.25)"},onBlur:he=>{he.target.style.borderColor="#e9ecef",he.target.style.boxShadow="none"},autoFocus:!0}),n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),"سيتم استخدام هذا الاسم لعرض الملف في قائمة الوثائق"]})]})]})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:n.jsxs("div",{className:"d-flex justify-content-end",style:{gap:"12px"},children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:_e,style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500"},children:"إلغاء"}),n.jsxs("button",{type:"button",className:"btn btn-success",onClick:$s,disabled:!re.trim(),style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500",opacity:re.trim()?1:.6},children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),"حفظ"]})]})})]})})})]})})}function UE(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(g4,{})})})}const x4=()=>{const[r,e]=j.useState({isDragging:!1,draggedItem:null,draggedFrom:null,dragOverTarget:null}),t=j.useRef(null);j.useRef(null);const s=j.useCallback(()=>{e({isDragging:!1,draggedItem:null,draggedFrom:null,dragOverTarget:null})},[]),a=j.useCallback((p,b,w)=>{try{console.log("🚀 [DRAG START] Item:",b?.title||b?.id,"Source:",w),p.dataTransfer.effectAllowed="move",p.dataTransfer.setData("text/plain",JSON.stringify({item:b,source:w})),e({isDragging:!0,draggedItem:b,draggedFrom:w,dragOverTarget:null}),t.current=p.currentTarget}catch(N){console.error("❌ [DRAG START ERROR]:",N),s()}},[s]),l=j.useCallback(p=>{console.log("🏁 [DRAG END]"),t.current=null,s()},[s]),c=j.useCallback((p,b)=>{p.preventDefault(),p.dataTransfer.dropEffect="move",e(w=>({...w,dragOverTarget:b}))},[]),u=j.useCallback(p=>{const b=p.relatedTarget;p.currentTarget.contains(b)||e(N=>({...N,dragOverTarget:null}))},[]),m=j.useCallback((p,b,w)=>{p.preventDefault(),console.log("💧 [DROP] Target:",b);try{const N=p.dataTransfer.getData("text/plain");let R=null;try{R=JSON.parse(N)}catch{R={item:r.draggedItem,source:r.draggedFrom}}if(!R||!R.item){console.error("❌ [DROP ERROR] No drag data available");return}const{item:O,source:G}=R;if(G===b){console.log("⚠️ [DROP CANCELLED] Same source and target");return}console.log("✅ [DROP SUCCESS] Moving:",O?.title||O?.id,"from",G,"to",b),typeof w=="function"&&w(O,G,b)}catch(N){console.error("❌ [DROP ERROR]:",N)}finally{e(N=>({...N,dragOverTarget:null}))}},[r]);return{dragState:r,handleDragStart:a,handleDragEnd:l,handleDragOver:c,handleDragLeave:u,handleDrop:m,resetDragState:s}},Xi={PENDING:"pending",IN_PROGRESS:"inProgress",REVIEW:"review",COMPLETED:"completed"},oC={[Xi.PENDING]:{title:"قيد الانتظار",icon:"bi-hourglass-split",bgColor:"linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%)",progress:0},[Xi.IN_PROGRESS]:{title:"قيد التنفيذ",icon:"bi-gear-fill",bgColor:"linear-gradient(135deg, #4834d4 0%, #686de0 100%)",progress:50},[Xi.REVIEW]:{title:"قيد المراجعة",icon:"bi-clipboard-check",bgColor:"linear-gradient(135deg, #f39c12 0%, #e67e22 100%)",progress:90},[Xi.COMPLETED]:{title:"مكتملة",icon:"bi-check-circle-fill",bgColor:"linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)",progress:100}},y4={[Xi.PENDING]:[{id:1,title:"مناقصة إنشاء مبنى سكني",client:"شركة العمارة الحديثة",deadline:"2024-01-15",value:"2,500,000",priority:"high",progress:0},{id:2,title:"مناقصة توريد مواد بناء",client:"مؤسسة البناء المتقدم",deadline:"2024-01-20",value:"850,000",priority:"medium",progress:0}],[Xi.IN_PROGRESS]:[{id:3,title:"مناقصة تشطيب فيلا",client:"العميل الخاص",deadline:"2024-02-01",value:"1,200,000",priority:"high",progress:65},{id:4,title:"مناقصة صيانة مباني",client:"الهيئة الحكومية",deadline:"2024-01-25",value:"450,000",priority:"low",progress:30}],[Xi.REVIEW]:[{id:5,title:"مناقصة مشروع تجاري",client:"مجمع التسوق الكبير",deadline:"2024-02-10",value:"3,800,000",priority:"high",progress:90}],[Xi.COMPLETED]:[{id:6,title:"مناقصة ترميم مسجد",client:"وزارة الأوقاف",deadline:"2023-12-30",value:"680,000",priority:"medium",progress:100},{id:7,title:"مناقصة بناء مدرسة",client:"وزارة التربية",deadline:"2023-12-15",value:"1,950,000",priority:"high",progress:100}]},b4=r=>{switch(r){case"high":return"#dc3545";case"medium":return"#ffc107";case"low":return"#28a745";default:return"#6c757d"}},VE=r=>{switch(r){case"high":return"عالية";case"medium":return"متوسطة";case"low":return"منخفضة";default:return"غير محددة"}},w4=r=>new Intl.NumberFormat("ar-SA",{style:"currency",currency:"SAR",minimumFractionDigits:0,maximumFractionDigits:0}).format(r),lC=j.memo(({tender:r,stage:e,onDragStart:t,onDragEnd:s,isDragging:a})=>{const l=`kanban-card ${a?"kanban-card--dragging":""}`;return n.jsxs("div",{className:l,draggable:!0,onDragStart:c=>t(c,r,e),onDragEnd:s,"data-testid":`kanban-card-${r.id}`,role:"button",tabIndex:0,"aria-label":`${r.title} - ${VE(r.priority)} priority`,children:[n.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[n.jsx("h6",{className:"card-title mb-0",children:r.title}),n.jsx("span",{className:`badge priority-badge priority-badge--${r.priority}`,style:{backgroundColor:b4(r.priority)},children:VE(r.priority)})]}),n.jsxs("div",{className:"card-info mb-2",children:[n.jsx("i",{className:"bi bi-building me-1"}),r.client]}),n.jsxs("div",{className:"card-info mb-2",children:[n.jsx("i",{className:"bi bi-calendar-event me-1"}),new Date(r.deadline).toLocaleDateString("ar-SA")]}),n.jsxs("div",{className:"card-value mb-3",children:[n.jsx("i",{className:"bi bi-currency-dollar me-1"}),w4(r.value)]}),r.progress>0&&n.jsxs("div",{className:"mb-2",children:[n.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[n.jsx("small",{className:"text-muted",children:"التقدم"}),n.jsxs("small",{className:"fw-bold text-primary",children:[r.progress,"%"]})]}),n.jsx("div",{className:"progress-custom",children:n.jsx("div",{className:"progress-bar-custom",style:{width:`${r.progress}%`}})})]}),n.jsxs("div",{className:"card-timestamp",children:[n.jsx("i",{className:"bi bi-clock me-1"}),"منذ يومين"]})]})});lC.displayName="KanbanCard";const cC=j.memo(({stage:r,tenders:e,onDragOver:t,onDragLeave:s,onDrop:a,onCardDragStart:l,onCardDragEnd:c,dragState:u})=>{const m=oC[r],p=e.length,b=u.dragOverTarget===r,w=u.isDragging&&u.draggedFrom!==r,N=`kanban-column ${b?"kanban-column--drag-over":""} ${w?"kanban-column--drag-active":""}`;return n.jsxs("div",{className:N,onDragOver:R=>t(R,r),onDragLeave:s,onDrop:R=>a(R,r),"data-testid":`kanban-column-${r}`,role:"region","aria-label":`${m.title} - ${p} items`,children:[n.jsx("div",{className:"kanban-header",style:{background:m.bgColor},children:n.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("i",{className:`bi ${m.icon} me-2`,style:{fontSize:"18px"}}),n.jsx("h6",{className:"fw-bold mb-0",children:m.title})]}),n.jsx("span",{className:"badge bg-white text-dark",children:p})]})}),n.jsx("div",{className:"kanban-content",children:e.length>0?e.map(R=>n.jsx(lC,{tender:R,stage:r,onDragStart:l,onDragEnd:c,isDragging:u.draggedItem?.id===R.id},R.id)):n.jsxs("div",{className:"kanban-empty",children:[n.jsx("div",{className:"kanban-empty-icon",children:n.jsx("i",{className:"bi bi-inbox"})}),n.jsx("p",{className:"mb-1",children:"لا توجد مناقصات"}),n.jsx("small",{children:"اسحب البطاقات هنا"})]})})]})});cC.displayName="KanbanColumn";const dC=j.memo(({kanbanData:r,onMoveCard:e})=>{const{dragState:t,handleDragStart:s,handleDragEnd:a,handleDragOver:l,handleDragLeave:c,handleDrop:u}=x4(),m=j.useCallback((w,N,R)=>{if(N===R)return;console.log("🎯 [KANBAN] Moving card:",w.title,"from",N,"to",R);const O={...w,progress:oC[R].progress};e(O,N,R)},[e]),p=j.useCallback((w,N)=>{u(w,N,m)},[u,m]),b=[Xi.COMPLETED,Xi.REVIEW,Xi.IN_PROGRESS,Xi.PENDING];return n.jsx("div",{className:"kanban-board",style:{minHeight:"calc(100vh - 400px)",marginTop:"15px"},children:b.map(w=>n.jsx(cC,{stage:w,tenders:r[w],onDragOver:l,onDragLeave:c,onDrop:p,onCardDragStart:s,onCardDragEnd:a,dragState:t},w))})});dC.displayName="KanbanBoard";function v4(){const[r,e]=j.useState(!1),{isTimelineVisible:t}=Hn(),[s,a]=j.useState(y4),l=os(),c=j.useCallback(()=>{e(w=>!w)},[]),u=async()=>{try{await it.clearPendingData("tenderFormData_new"),await it.clearPendingData("tenderDocuments_new"),await it.clearPendingTenderItems(),console.log("✅ [TRACKING] All pending data cleared - navigating to fresh Add Tender form"),l("/tenders/add")}catch(w){console.error("❌ [TRACKING] Error clearing pending data:",w),l("/tenders/add")}},m=j.useCallback((w,N,R)=>{a(O=>{const G={};return Object.keys(O).forEach(U=>{U===N?G[U]=O[U].filter(T=>T.id!==w.id):U===R?G[U]=[w,...O[U]]:G[U]=[...O[U]]}),console.log("📊 [STATE UPDATE] Card moved to top of target column successfully"),G})},[]),p=j.useMemo(()=>({paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"}),[r,t]),b=j.useMemo(()=>({width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"}),[r]);return n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Xn,{onToggle:c}),n.jsxs("div",{className:"main-container",style:p,children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:b,children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"متابعة المناقصات"})]})}),n.jsx(Jn,{}),n.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:n.jsxs("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:[n.jsx("div",{className:"card shadow-sm mb-4",children:n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[n.jsx("i",{className:"bi bi-kanban text-primary me-2"}),"متابعة المناقصات"]}),n.jsx("span",{className:"text-muted",children:"لوحة تتبع حالة المناقصات"})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsxs("button",{className:"btn btn-outline-primary",style:{height:"32px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px"},children:[n.jsx("i",{className:"bi bi-filter me-1"}),"تصفية"]}),n.jsxs("button",{className:"btn btn-primary",onClick:u,style:{height:"32px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px"},children:[n.jsx("i",{className:"bi bi-plus-circle me-1"}),"إضافة مناقصة"]})]})]})})}),n.jsx("div",{className:"card shadow-sm",children:n.jsx("div",{className:"card-body p-0",children:n.jsx(dC,{kanbanData:s,onMoveCard:m})})})]})})]}),!r&&t&&n.jsx(Zn,{rtl:!0}),!r&&t&&n.jsx(es,{})]})]})}function N4(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(v4,{})})})}function j4(){const[r,e]=j.useState(!1),{isTimelineVisible:t}=Hn(),[s,a]=j.useState([]),[l,c]=j.useState([]),[u,m]=j.useState(!1),[p,b]=j.useState(null),[w,N]=j.useState(""),[R,O]=j.useState([]),[G,U]=j.useState(!1),[T,ee]=j.useState([]),[Z,ie]=j.useState(null),X=os(),{tenderId:pe}=ea(),{logActivity:H,getCurrentUser:B}=_n(),{alertConfig:k,closeAlert:W,showSuccess:J,showError:z}=Cn(),L=()=>{e(!r)};j.useEffect(()=>{de();const E=te=>{te.type==="rawMaterialsUpdated"&&de()},D=()=>{de()};window.addEventListener("storage",E),window.addEventListener("rawMaterialsUpdated",D);const F=()=>{de()};return window.addEventListener("focus",F),()=>{window.removeEventListener("storage",E),window.removeEventListener("rawMaterialsUpdated",D),window.removeEventListener("focus",F)}},[]),j.useEffect(()=>{if(w.trim()){const E=s.filter(D=>D.name?.toLowerCase().includes(w.toLowerCase())||D.category?.toLowerCase().includes(w.toLowerCase())||D.description?.toLowerCase().includes(w.toLowerCase())||D.supplier?.toLowerCase().includes(w.toLowerCase()));O(E)}else O(s)},[w,s]);const de=async()=>{try{m(!0);const D=(await wr.getAllRawMaterials()).filter(F=>F.active!==!1);a(D),b(null)}catch(E){b(E.message)}finally{m(!1)}},Pe=E=>{if(l.some(F=>F.internalId===E.internalId))c(F=>F.filter(te=>te.internalId!==E.internalId));else{const F={...E,type:"rawMaterials",quantity:1};c(te=>[...te,F])}},V=async()=>{if(l.length===0){z("يرجى اختيار مادة خام واحدة على الأقل","لا توجد مواد مختارة");return}const E=l.map(D=>{let F=D.price||0,te=D.supplier;if(D.priceQuotes&&Array.isArray(D.priceQuotes)&&D.priceQuotes.length>0){const $=D.priceQuotes.reduce((Q,me)=>{const I=parseFloat(Q.price)||0;return(parseFloat(me.price)||0)<I?me:Q});F=parseFloat($.price)||0,te=$.supplierName}return{...D,quantity:1,unitPrice:F,totalPrice:F,displaySupplier:te}});ee(E),ie(null),U(!0)},se=(E,D)=>{const F=Math.max(0,parseFloat(D)||0);ee(te=>te.map($=>$.id===E?{...$,quantity:Number(F.toFixed(1)),totalPrice:$.unitPrice*Number(F.toFixed(1))}:$))},fe=async()=>{console.log("🚀 FUNCTION START: handleConfirmQuantities called");try{if(!Array.isArray(T)||T.length===0){console.log("🚨 EARLY EXIT: No modal items to process"),z("لا توجد مواد مختارة للإضافة","خطأ في البيانات");return}console.log("🔍 STEP 1: Starting duplicate check process..."),console.log("🔍 Modal items to check:",T.map(I=>({name:I.name,internalId:I.internalId,id:I.id})));let E=await it.getPendingTenderItems()||[];if(pe&&pe!=="new")try{console.log("🎯 EDIT MODE: Loading existing tender items for duplicate check, tender ID:",pe);const{tenderServiceNew:I}=await Ds(async()=>{const{tenderServiceNew:We}=await Promise.resolve().then(()=>nv);return{tenderServiceNew:We}},void 0),le=await I.getById(pe);le&&le.items&&Array.isArray(le.items)&&(console.log("📦 EDIT MODE: Found existing tender items:",le.items.length),E=[...E,...le.items])}catch(I){console.error("❌ Error loading existing tender items for duplicate check:",I)}console.log("🔍 STEP 2: Retrieved existing items from storage:",{count:E.length,items:E.map(I=>({name:I.materialName||I.name,materialInternalId:I.materialInternalId,internalId:I.internalId,id:I.id}))});const D=E.map(I=>I.materialInternalId||I.internalId||I.id).filter(Boolean);console.log("🔍 STEP 3: Extracted existing material IDs:",D);const F=[];for(const I of T){const le=[I.internalId,I.id,I.materialInternalId,I.materialId].filter(Boolean),We=le.some(nt=>D.includes(nt));console.log(`🔍 STEP 4: Duplicate check for "${I.name}":`),console.log(`  - Possible IDs: [${le.join(", ")}]`),console.log(`  - Existing IDs: [${D.join(", ")}]`),console.log(`  - Is Duplicate: ${We}`),We&&(F.push(I.name),console.log(`🚨 DUPLICATE FOUND: "${I.name}" with IDs [${le.join(", ")}] matches existing items!`))}if(console.log("🔍 STEP 5: Duplicate prevention analysis complete:",{totalModalItems:T.length,duplicatesFound:F.length,duplicateNames:F,existingIds:D}),F.length>0){console.log("🚨🚨🚨 CRITICAL: DUPLICATE PREVENTION ACTIVATED 🚨🚨🚨"),console.log("🚨 STEP 6: Execution will be FORCEFULLY STOPPED"),console.log("🚨 Duplicate items blocking execution:",F),console.log("🚨 Function will return immediately after showing warnings");const I=F.join("، ");z(`⚠️ البنود التالية موجودة مسبقاً في قائمة المناقصة:

${I}

❌ لا يمكن إضافة نفس البند مرتين.

✅ يرجى إلغاء تحديد البنود المكررة والمحاولة مرة أخرى.`,"🛡️ تحذير: منع التكرار"),ie(`⚠️ البنود المكررة: ${I}`),console.log("🚨 STEP 7: About to return and stop execution completely"),console.log("🚨 If you see any code execution after this point, there is a bug!");return}console.log("✅ STEP 8: NO DUPLICATES DETECTED - Safe to proceed"),console.log("✅ Continuing with item creation process...");const te=T,$=[];for(const I of te)try{const le={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:I.internalId,materialType:"rawMaterial",materialName:I.name,materialCategory:I.category||"",materialUnit:I.unit||"قطعة",quantity:I.quantity||1,unitPrice:I.unitPrice||I.price||0,totalPrice:(I.quantity||1)*(I.unitPrice||I.price||0),supplierInfo:I.displaySupplier||I.supplier||"",tenderId:pe==="new"?"new":pe,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};$.push(le),console.log("Created tender item with ID relationship:",{tenderItemId:le.internalId,linkedMaterialId:le.materialInternalId,materialName:le.materialName,currentPrice:le.unitPrice,totalPrice:le.totalPrice})}catch(le){console.error("Error creating tender item for material:",I.name,le),z(`فشل في إضافة المادة: ${I.name}`,"خطأ في البيانات");return}const Q=await it.getPendingTenderItems()||[];let me=[...$];if(Q.length>0)try{if(Array.isArray(Q)){const I=await sv.refreshTenderItemsPricing(Q);console.log("🔄 SAFE MERGE: Our enhanced duplicate prevention handled conflicts, merging safely"),me=[...I,...$],console.log("✅ SAFE MERGE completed:",{existingItemsCount:I.length,newItemsCount:$.length,finalItemsCount:me.length,note:"No conflicts - duplicates were prevented above"})}}catch(I){console.error("Error parsing existing items:",I)}console.log("Storing ID-based tender items:",{totalItems:me.length,newItems:$.length,items:me.map(I=>({id:I.internalId,materialId:I.materialInternalId,name:I.materialName,price:I.unitPrice,total:I.totalPrice}))}),await it.setPendingTenderItems(me);try{const I=B();I&&I.name&&H("task",`${I.name} أضاف مواد خام للمناقصة`,`تم إضافة ${$.length} مادة خام بنظام الهوية الفريدة`)}catch(I){console.error("Failed to log activity:",I)}window.dispatchEvent(new CustomEvent("tenderItemsAdded",{detail:{count:$.length,type:"rawMaterial",items:$}})),J(`تم إضافة ${$.length} مادة خام بنجاح إلى قائمة المناقصة`,"نجحت العملية"),U(!1),ee([]),ie(null),setTimeout(()=>{X(pe==="new"?"/tenders/add":`/tenders/edit/${pe}`)},2e3)}catch(E){console.error("Error in handleConfirmQuantities:",E),z("فشل في إضافة المواد الخام للمناقصة - تحقق من البيانات","خطأ في النظام")}},re=()=>{U(!1),ee([]),ie(null)},_=()=>Math.round(T.reduce((E,D)=>E+D.totalPrice,0));return u?n.jsx(Mn,{show:!0,message:"جار تحميل بيانات المواد الخام...",overlay:!1}):p?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:p}),n.jsxs("button",{className:"btn btn-primary",onClick:de,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Xn,{onToggle:L}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المناقصات"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"مواد خام"})]})}),n.jsx(Jn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"raw-materials-table",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-gear text-danger me-2"}),"قائمة المواد الخام (",R.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المواد الخام...",value:w,onChange:E=>N(E.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),n.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:V,disabled:l.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["إضافة المحدد (",l.length,")"]}),n.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const E=pe!=="new"?`/tenders/edit/${pe}`:"/tenders/add";X(E)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:"العودة للمناقصة"})]})})]})}),n.jsx("div",{className:"card-body p-0",children:R.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-gear fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد مواد خام"}),n.jsx("p",{className:"text-muted",children:w?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي مواد خام بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",children:"اختيار"}),n.jsx("th",{className:"text-center",children:"اسم المادة"}),n.jsx("th",{className:"text-center",children:"الفئة"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر"}),n.jsx("th",{className:"text-center",children:"المورد"})]})}),n.jsx("tbody",{children:R.map(E=>{let D=E.price,F=E.supplier,te=!1,$=null;return E.priceQuotes&&Array.isArray(E.priceQuotes)&&E.priceQuotes.length>0&&(te=!0,$=E.priceQuotes.reduce((Q,me)=>{const I=parseFloat(Q.price)||0;return(parseFloat(me.price)||0)<I?me:Q}),D=$.price,F=$.supplierName),n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input",type:"checkbox",checked:l.some(Q=>Q.internalId===E.internalId),onChange:()=>Pe(E),style:{transform:"scale(1.2)"}})})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-primary",children:E.name})}),n.jsx("td",{className:"text-center",children:E.category||"-"}),n.jsx("td",{className:"text-center",children:E.unit||"-"}),n.jsx("td",{className:"text-center",children:D?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsxs("span",{children:[D," ريال"]}),te&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}):"-"}),n.jsx("td",{className:"text-center",children:F?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("span",{children:F}),te&&n.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:"أقل مورد"})]}):"-"})]},E.id)})})]})})})]})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&t&&n.jsx(Zn,{rtl:!0}),!r&&t&&n.jsx(es,{})]}),G&&n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-calculator me-2"}),"تحديد الكميات والأسعار"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:re,"aria-label":"Close"})]}),n.jsxs("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:[Z&&n.jsxs("div",{className:"alert alert-warning alert-dismissible m-3 mb-2",role:"alert",style:{background:"linear-gradient(45deg, #fff3cd, #ffeaa7)",border:"2px solid #f39c12",borderRadius:"8px",boxShadow:"0 4px 12px rgba(243, 156, 18, 0.3)"},children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-exclamation-triangle-fill text-warning me-2",style:{fontSize:"20px"}}),n.jsxs("div",{className:"flex-grow-1",children:[n.jsx("strong",{children:"تحذير: بنود مكررة!"}),n.jsx("div",{className:"mt-1 text-dark",children:Z}),n.jsx("small",{className:"text-muted",children:"يرجى إلغاء تحديد البنود المكررة قبل المتابعة"})]})]}),n.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>ie(null)})]}),n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"30%"},children:"المادة الخام"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"السعر الأساسي"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"المورد"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"إجمالي السعر"})]})}),n.jsx("tbody",{children:T.map((E,D)=>n.jsxs("tr",{style:{height:"60px"},children:[n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:"bi bi-gear text-danger me-2"}),n.jsxs("div",{children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:F=>{F.preventDefault(),F.stopPropagation(),X(`/raw-materials/edit/${E.id}`)},title:`تحرير المادة الخام: ${E.name}`,children:E.name}),n.jsx("small",{className:"text-muted",children:E.category})]})]})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("span",{className:"fw-bold text-success",children:[Math.round(E.unitPrice)," ريال"]}),n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:["/",E.unit||"وحدة"]})})]}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>se(E.id,Math.max(0,Number((E.quantity-.1).toFixed(1)))),disabled:E.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-dash"})}),n.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:E.quantity,min:"0",step:"any",onChange:F=>se(E.id,F.target.value),onBlur:F=>{const te=Number(F.target.value||0).toFixed(1);se(E.id,te)}}),n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>se(E.id,Number((E.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-plus"})})]})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"text-muted",children:E.displaySupplier||"-"})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(E.totalPrice)," ريال"]}),n.jsxs("small",{className:"text-success",children:["(",E.quantity.toFixed(1)," × ",Math.round(E.unitPrice),")"]})]})]},E.id))})]})})]}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:n.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("span",{className:"text-muted me-3",children:"إجمالي الطلبية:"}),n.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[_()," ريال"]}),n.jsxs("span",{className:"badge bg-info ms-2",children:[T.reduce((E,D)=>E+D.quantity,0).toFixed(1)," قطعة"]})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:re,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:fe,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"تأكيد"})]})]})})]})})}),n.jsx(Tn,{show:k.show,onClose:W,title:k.title,message:k.message,type:k.type,onConfirm:k.onConfirm,showConfirm:k.showConfirm})]})}function _4(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(j4,{})})})}function E4(){const[r,e]=j.useState(!1),{isTimelineVisible:t}=Hn(),[s,a]=j.useState([]),[l,c]=j.useState([]),[u,m]=j.useState(!1),[p,b]=j.useState(null),[w,N]=j.useState(""),[R,O]=j.useState([]),[G,U]=j.useState(!1),[T,ee]=j.useState([]),[Z,ie]=j.useState(null),X=os(),{tenderId:pe}=ea(),{logActivity:H,getCurrentUser:B}=_n(),{alertConfig:k,closeAlert:W,showSuccess:J,showError:z}=Cn(),L=()=>{e(!r)};j.useEffect(()=>{de();const E=te=>{te.type==="localProductsUpdated"&&de()},D=()=>{de()};window.addEventListener("storage",E),window.addEventListener("localProductsUpdated",D);const F=()=>{de()};return window.addEventListener("focus",F),()=>{window.removeEventListener("storage",E),window.removeEventListener("localProductsUpdated",D),window.removeEventListener("focus",F)}},[]),j.useEffect(()=>{if(w.trim()){const E=s.filter(D=>D.name?.toLowerCase().includes(w.toLowerCase())||D.category?.toLowerCase().includes(w.toLowerCase())||D.description?.toLowerCase().includes(w.toLowerCase())||D.manufacturer?.toLowerCase().includes(w.toLowerCase()));O(E)}else O(s)},[w,s]);const de=async()=>{try{m(!0);const D=(await vr.getAllLocalProducts()).filter(F=>F.active!==!1);a(D),b(null)}catch(E){b(E.message)}finally{m(!1)}},Pe=E=>{if(l.some(F=>F.internalId===E.internalId))c(F=>F.filter(te=>te.internalId!==E.internalId));else{const F={...E,type:"localProducts",quantity:1};c(te=>[...te,F])}},V=async()=>{if(u){console.log("🚫 PREVENTING DUPLICATE CLICK: Operation already in progress");return}if(l.length===0){z("يرجى اختيار منتج محلي واحد على الأقل","لا توجد منتجات مختارة");return}m(!0);const E=await it.getPendingTenderItems()||[];let D=[];if(E.length>0)try{Array.isArray(E)&&(D=E.map(Q=>Q.materialInternalId||Q.internalId||Q.id).filter(Boolean))}catch(Q){console.error("Error parsing existing items:",Q)}const F=[],te=l.filter(Q=>{const I=[Q.internalId,Q.id,Q.materialInternalId,Q.materialId].filter(Boolean).some(le=>D.includes(le));return I&&F.push(Q.name),!I});if(F.length>0){const Q=F.join("، ");if(z(`البنود التالية موجودة مسبقاً في القائمة: ${Q}`,"بنود مكررة"),te.length===0)return;console.log(`Found ${F.length} duplicate items, proceeding with ${te.length} unique items`)}const $=te.map(Q=>{let me=Q.price||0,I=Q.manufacturer;if(Q.priceQuotes&&Array.isArray(Q.priceQuotes)&&Q.priceQuotes.length>0){const le=Q.priceQuotes.reduce((We,nt)=>{const mt=parseFloat(We.price)||0;return(parseFloat(nt.price)||0)<mt?nt:We});me=parseFloat(le.price)||0,I=le.supplierName}return{...Q,quantity:1,unitPrice:me,totalPrice:me,displaySupplier:I}});ee($),ie(null),U(!0)},se=(E,D)=>{const F=Math.max(0,parseFloat(D)||0);ee(te=>te.map($=>$.id===E?{...$,quantity:Number(F.toFixed(1)),totalPrice:$.unitPrice*Number(F.toFixed(1))}:$))},fe=async()=>{try{if(!Array.isArray(T)||T.length===0){z("لا توجد منتجات مختارة للإضافة","خطأ في البيانات");return}console.log("🛡️ STARTING DUPLICATE PREVENTION FOR LOCAL PRODUCTS...");let E=await it.getPendingTenderItems()||[];if(pe&&pe!=="new")try{console.log("🎯 EDIT MODE: Loading existing tender items for duplicate check, tender ID:",pe);const{tenderServiceNew:I}=await Ds(async()=>{const{tenderServiceNew:We}=await Promise.resolve().then(()=>nv);return{tenderServiceNew:We}},void 0),le=await I.getById(pe);le&&le.items&&Array.isArray(le.items)&&(console.log("📦 EDIT MODE: Found existing tender items:",le.items.length),E=[...E,...le.items])}catch(I){console.error("❌ Error loading existing tender items for duplicate check:",I)}let D=[];if(E.length>0)try{Array.isArray(E)&&(D=E.map(I=>I.materialInternalId||I.internalId||I.id).filter(Boolean))}catch(I){console.error("Error parsing existing items:",I)}console.log("🔍 Existing material IDs:",D),console.log("🔍 Modal items to check:",T.map(I=>({name:I.name,internalId:I.internalId,id:I.id})));const F=[];for(const I of T){const le=[I.internalId,I.id,I.materialInternalId,I.materialId].filter(Boolean),We=le.some(nt=>D.includes(nt));console.log(`🔍 DUPLICATE CHECK: "${I.name}":`),console.log(`  - Possible IDs: [${le.join(", ")}]`),console.log(`  - Existing IDs: [${D.join(", ")}]`),console.log(`  - Is Duplicate: ${We}`),We&&(F.push(I.name),console.log(`🚨 DUPLICATE FOUND: "${I.name}" with IDs [${le.join(", ")}] matches existing items!`))}if(console.log("🛡️ DUPLICATE PREVENTION RESULT:",{totalItems:T.length,duplicatesFound:F.length,duplicateNames:F}),F.length>0){const I=F.join("، ");console.log("🚨 DUPLICATE PREVENTION ACTIVATED: Blocking duplicates:",I),z(`⚠️ البنود التالية موجودة مسبقاً في قائمة المناقصة:

${I}

❌ لا يمكن إضافة نفس البند مرتين.

✅ يرجى إلغاء تحديد البنود المكررة والمحاولة مرة أخرى.`,"🛡️ تحذير: منع التكرار"),ie(`⚠️ البنود المكررة: ${I}`);return}console.log("✅ No duplicates found, proceeding with creation...");const te=T,$=[];for(const I of te)try{const le={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:I.internalId,materialType:"localProduct",materialName:I.name,materialCategory:I.category||"",materialUnit:I.unit||"قطعة",quantity:I.quantity||1,unitPrice:I.unitPrice||I.price||0,totalPrice:(I.quantity||1)*(I.unitPrice||I.price||0),supplierInfo:I.displaySupplier||I.supplier||"",tenderId:pe==="new"?"new":pe,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};$.push(le),console.log("Created tender item with ID relationship:",{tenderItemId:le.internalId,linkedProductId:le.materialInternalId,productName:le.materialName,currentPrice:le.unitPrice,totalPrice:le.totalPrice})}catch(le){console.error("Error creating tender item for product:",I.name,le),z(`فشل في إضافة المنتج: ${I.name}`,"خطأ في البيانات");return}const Q=await it.getPendingTenderItems()||[];let me=[...$];if(Q.length>0)try{if(Array.isArray(Q)){const I=await sv.refreshTenderItemsPricing(Q);console.log("🔄 SAFE MERGE: Our enhanced duplicate prevention handled conflicts, merging safely"),me=[...I,...$],console.log("Duplicate prevention results:",{existingItemsCount:I.length,newItemsCount:$.length,finalItemsCount:me.length})}}catch(I){console.error("Error parsing existing items:",I)}console.log("Storing ID-based tender items:",{totalItems:me.length,newItems:$.length,items:me.map(I=>({id:I.internalId,materialId:I.materialInternalId,name:I.materialName,price:I.unitPrice,total:I.totalPrice}))}),await it.setPendingTenderItems(me);try{const I=B();I&&I.name&&H("task",`${I.name} أضاف منتجات محلية للمناقصة`,`تم إضافة ${$.length} منتج محلي بنظام الهوية الفريدة`)}catch(I){console.error("Failed to log activity:",I)}J(`تم إضافة ${$.length} منتج محلي بنجاح إلى قائمة المناقصة`,"نجحت العملية"),window.dispatchEvent(new CustomEvent("tenderItemsAdded",{detail:{count:$.length,type:"localProduct",items:$}})),U(!1),ee([]),ie(null),setTimeout(()=>{X(pe==="new"?"/tenders/add":`/tenders/edit/${pe}`)},2e3)}catch(E){console.error("Error in handleConfirmQuantities:",E),z("فشل في إضافة المنتجات المحلية للمناقصة - تحقق من البيانات","خطأ في النظام"),m(!1)}finally{setTimeout(()=>m(!1),2100)}},re=()=>{U(!1),ee([]),ie(null)},_=()=>Math.round(T.reduce((E,D)=>E+D.totalPrice,0));return u?n.jsx(Mn,{show:!0,message:"جار تحميل بيانات المنتجات المحلية...",overlay:!1}):p?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:p}),n.jsxs("button",{className:"btn btn-primary",onClick:de,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Xn,{onToggle:L}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المناقصات"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"منتجات محلية"})]})}),n.jsx(Jn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"raw-materials-table",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-house text-success me-2"}),"قائمة المنتجات المحلية (",R.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المنتجات المحلية...",value:w,onChange:E=>N(E.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),n.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:V,disabled:l.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["إضافة المحدد (",l.length,")"]}),n.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const E=pe!=="new"?`/tenders/edit/${pe}`:"/tenders/add";X(E)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:"العودة للمناقصة"})]})})]})}),n.jsx("div",{className:"card-body p-0",children:R.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-house fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد منتجات محلية"}),n.jsx("p",{className:"text-muted",children:w?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي منتجات محلية بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",children:"اختيار"}),n.jsx("th",{className:"text-center",children:"اسم المنتج"}),n.jsx("th",{className:"text-center",children:"الفئة"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر"}),n.jsx("th",{className:"text-center",children:"الشركة المصنعة"})]})}),n.jsx("tbody",{children:R.map(E=>{let D=E.price,F=E.manufacturer,te=!1,$=null;return E.priceQuotes&&Array.isArray(E.priceQuotes)&&E.priceQuotes.length>0&&(te=!0,$=E.priceQuotes.reduce((Q,me)=>{const I=parseFloat(Q.price)||0;return(parseFloat(me.price)||0)<I?me:Q}),D=$.price,F=$.supplierName),n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input",type:"checkbox",checked:l.some(Q=>Q.internalId===E.internalId),onChange:()=>Pe(E),style:{transform:"scale(1.2)"}})})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-primary",children:E.name})}),n.jsx("td",{className:"text-center",children:E.category||"-"}),n.jsx("td",{className:"text-center",children:E.unit||"-"}),n.jsx("td",{className:"text-center",children:D?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsxs("span",{children:[D," ريال"]}),te&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}):"-"}),n.jsx("td",{className:"text-center",children:F?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("span",{children:F}),te&&n.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:"أقل مورد"})]}):"-"})]},E.id)})})]})})})]})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&t&&n.jsx(Zn,{rtl:!0}),!r&&t&&n.jsx(es,{})]}),G&&n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-calculator me-2"}),"تحديد الكميات والأسعار"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:re,"aria-label":"Close"})]}),n.jsxs("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:[Z&&n.jsxs("div",{className:"alert alert-warning alert-dismissible m-3 mb-2",role:"alert",style:{background:"linear-gradient(45deg, #fff3cd, #ffeaa7)",border:"2px solid #f39c12",borderRadius:"8px",boxShadow:"0 4px 12px rgba(243, 156, 18, 0.3)"},children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-exclamation-triangle-fill text-warning me-2",style:{fontSize:"20px"}}),n.jsxs("div",{className:"flex-grow-1",children:[n.jsx("strong",{children:"تحذير: بنود مكررة!"}),n.jsx("div",{className:"mt-1 text-dark",children:Z}),n.jsx("small",{className:"text-muted",children:"يرجى إلغاء تحديد البنود المكررة قبل المتابعة"})]})]}),n.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>ie(null)})]}),n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"30%"},children:"المنتج المحلي"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"السعر الأساسي"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"الشركة المصنعة"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"إجمالي السعر"})]})}),n.jsx("tbody",{children:T.map((E,D)=>n.jsxs("tr",{style:{height:"60px"},children:[n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:"bi bi-house text-success me-2"}),n.jsxs("div",{children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:F=>{F.preventDefault(),F.stopPropagation(),X(`/local-products/edit/${E.id}`)},title:`تحرير المنتج المحلي: ${E.name}`,children:E.name}),n.jsx("small",{className:"text-muted",children:E.category})]})]})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("span",{className:"fw-bold text-success",children:[Math.round(E.unitPrice)," ريال"]}),n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:["/",E.unit||"وحدة"]})})]}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>se(E.id,Math.max(0,Number((E.quantity-.1).toFixed(1)))),disabled:E.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-dash"})}),n.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:E.quantity,min:"0",step:"any",onChange:F=>se(E.id,F.target.value),onBlur:F=>{const te=Number(F.target.value||0).toFixed(1);se(E.id,te)}}),n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>se(E.id,Number((E.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-plus"})})]})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"text-muted",children:E.displaySupplier||"-"})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(E.totalPrice)," ريال"]}),n.jsxs("small",{className:"text-success",children:["(",E.quantity.toFixed(1)," × ",Math.round(E.unitPrice),")"]})]})]},E.id))})]})})]}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:n.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("span",{className:"text-muted me-3",children:"إجمالي الطلبية:"}),n.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[_()," ريال"]}),n.jsxs("span",{className:"badge bg-info ms-2",children:[T.reduce((E,D)=>E+D.quantity,0).toFixed(1)," قطعة"]})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:re,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:fe,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"تأكيد"})]})]})})]})})}),n.jsx(Tn,{show:k.show,onClose:W,title:k.title,message:k.message,type:k.type,onConfirm:k.onConfirm,showConfirm:k.showConfirm})]})}function S4(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(E4,{})})})}function I4(){const[r,e]=j.useState(!1),{isTimelineVisible:t}=Hn(),[s,a]=j.useState([]),[l,c]=j.useState([]),[u,m]=j.useState(!1),[p,b]=j.useState(null),[w,N]=j.useState(""),[R,O]=j.useState([]),[G,U]=j.useState(!1),[T,ee]=j.useState([]),[Z,ie]=j.useState(null),X=os(),{tenderId:pe}=ea(),{logActivity:H,getCurrentUser:B}=_n(),{alertConfig:k,closeAlert:W,showSuccess:J,showError:z}=Cn(),L=()=>{e(!r)};j.useEffect(()=>{de();const E=te=>{te.type==="foreignProductsUpdated"&&de()},D=()=>{de()};window.addEventListener("storage",E),window.addEventListener("foreignProductsUpdated",D);const F=()=>{de()};return window.addEventListener("focus",F),()=>{window.removeEventListener("storage",E),window.removeEventListener("foreignProductsUpdated",D),window.removeEventListener("focus",F)}},[]),j.useEffect(()=>{if(w.trim()){const E=s.filter(D=>D.name?.toLowerCase().includes(w.toLowerCase())||D.category?.toLowerCase().includes(w.toLowerCase())||D.description?.toLowerCase().includes(w.toLowerCase())||D.supplier?.toLowerCase().includes(w.toLowerCase())||D.countryOfOrigin?.toLowerCase().includes(w.toLowerCase()));O(E)}else O(s)},[w,s]);const de=async()=>{try{m(!0);const D=(await Nr.getAllForeignProducts()).filter(F=>F.active!==!1);a(D),b(null)}catch(E){b(E.message)}finally{m(!1)}},Pe=E=>{if(l.some(F=>F.internalId===E.internalId))c(F=>F.filter(te=>te.internalId!==E.internalId));else{const F={...E,type:"foreignProduct",quantity:1};c(te=>[...te,F])}},V=async()=>{if(l.length===0){z("يرجى اختيار منتج أجنبي واحد على الأقل","لا توجد منتجات مختارة");return}console.log("🔍 FOREIGN PRODUCTS: Fetching existing items for duplicate check...");const E=await it.getPendingTenderItems()||[];console.log("📦 FOREIGN PRODUCTS: Existing items found:",E.length);let D=[];E&&Array.isArray(E)&&(D=E.map(Q=>Q.materialInternalId),console.log("🆔 FOREIGN PRODUCTS: Existing material IDs:",D));const F=[],te=l.filter(Q=>{const I=[Q.internalId,Q.id,Q.materialInternalId,Q.materialId].filter(Boolean).some(le=>D.includes(le));return I&&F.push(Q.name),!I});if(F.length>0){const Q=F.join("، ");if(z(`البنود التالية موجودة مسبقاً في القائمة: ${Q}`,"بنود مكررة"),te.length===0)return;console.log(`Found ${F.length} duplicate items, proceeding with ${te.length} unique items`)}const $=te.map(Q=>{let me=Q.price||0,I=Q.supplier;if(Q.priceQuotes&&Array.isArray(Q.priceQuotes)&&Q.priceQuotes.length>0){const le=Q.priceQuotes.reduce((We,nt)=>{const mt=parseFloat(We.price)||0;return(parseFloat(nt.price)||0)<mt?nt:We});me=parseFloat(le.price)||0,I=le.supplierName}return{...Q,quantity:1,unitPrice:me,totalPrice:me,displaySupplier:I}});ee($),ie(null),U(!0)},se=(E,D)=>{const F=Math.max(0,parseFloat(D)||0);ee(te=>te.map($=>$.id===E?{...$,quantity:Number(F.toFixed(1)),totalPrice:$.unitPrice*Number(F.toFixed(1))}:$))},fe=async()=>{try{if(!Array.isArray(T)||T.length===0){z("لا توجد منتجات مختارة للإضافة","خطأ في البيانات");return}console.log("🛡️ STARTING DUPLICATE PREVENTION FOR FOREIGN PRODUCTS...");let E=await it.getPendingTenderItems()||[];if(pe&&pe!=="new")try{console.log("🎯 EDIT MODE: Loading existing tender items for duplicate check, tender ID:",pe);const{tenderServiceNew:I}=await Ds(async()=>{const{tenderServiceNew:We}=await Promise.resolve().then(()=>nv);return{tenderServiceNew:We}},void 0),le=await I.getById(pe);le&&le.items&&Array.isArray(le.items)&&(console.log("📦 EDIT MODE: Found existing tender items:",le.items.length),E=[...E,...le.items])}catch(I){console.error("❌ Error loading existing tender items for duplicate check:",I)}let D=[];E&&Array.isArray(E)&&(D=E.map(I=>I.materialInternalId||I.internalId||I.id).filter(Boolean)),console.log("🔍 Existing material IDs:",D),console.log("🔍 Modal items to check:",T.map(I=>({name:I.name,internalId:I.internalId,id:I.id})));const F=[];for(const I of T){const le=[I.internalId,I.id,I.materialInternalId,I.materialId].filter(Boolean),We=le.some(nt=>D.includes(nt));console.log(`🔍 DUPLICATE CHECK: "${I.name}":`),console.log(`  - Possible IDs: [${le.join(", ")}]`),console.log(`  - Existing IDs: [${D.join(", ")}]`),console.log(`  - Is Duplicate: ${We}`),We&&(F.push(I.name),console.log(`🚨 DUPLICATE FOUND: "${I.name}" with IDs [${le.join(", ")}] matches existing items!`))}if(console.log("🛡️ DUPLICATE PREVENTION RESULT:",{totalItems:T.length,duplicatesFound:F.length,duplicateNames:F}),F.length>0){const I=F.join("، ");console.log("🚨 DUPLICATE PREVENTION ACTIVATED: Blocking duplicates:",I),z(`⚠️ البنود التالية موجودة مسبقاً في قائمة المناقصة:

${I}

❌ لا يمكن إضافة نفس البند مرتين.

✅ يرجى إلغاء تحديد البنود المكررة والمحاولة مرة أخرى.`,"🛡️ تحذير: منع التكرار"),ie(`⚠️ البنود المكررة: ${I}`);return}console.log("✅ No duplicates found, proceeding with creation...");const te=T,$=[];for(const I of te)try{console.log("🔄 Creating tender item directly:",I.name);const le={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:I.internalId,materialType:"foreignProduct",materialName:I.name,materialCategory:I.category||"",materialUnit:I.unit||"قطعة",quantity:I.quantity||1,unitPrice:I.unitPrice||I.price||0,totalPrice:(I.quantity||1)*(I.unitPrice||I.price||0),supplierInfo:I.displaySupplier||I.supplier||"",tenderId:pe==="new"?"new":pe,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};$.push(le),console.log("✅ Created tender item directly:",{internalId:le.internalId,materialName:le.materialName,quantity:le.quantity,unitPrice:le.unitPrice,totalPrice:le.totalPrice})}catch(le){console.error("❌ Error creating tender item for product:",I.name,le),z(`فشل في إضافة المنتج "${I.name}": ${le.message||"خطأ غير معروف"}`,"خطأ في البيانات");return}console.log("🔍 MERGE PHASE: Fetching existing items for merge...");const Q=await it.getPendingTenderItems()||[];console.log("📦 MERGE PHASE: Existing items fetched:",{count:Q.length,items:Q.map(I=>({id:I.materialInternalId,name:I.materialName,type:I.materialType}))});let me=[...$];if(console.log("🆕 MERGE PHASE: Starting with new items:",$.length),Q.length>0)try{if(Array.isArray(Q)){console.log("🔄 MERGE PHASE: Refreshing pricing for existing items...");const I=await sv.refreshTenderItemsPricing(Q);console.log("💰 MERGE PHASE: Price refresh completed:",{originalCount:Q.length,refreshedCount:I.length,refreshedItems:I.map(le=>({id:le.materialInternalId,name:le.materialName,price:le.unitPrice}))}),console.log("🔄 MERGE PHASE: Performing safe merge..."),console.log("📋 Before merge - Existing items:",I.length),console.log("📋 Before merge - New items:",$.length),me=[...I,...$],console.log("✅ MERGE PHASE: Safe merge completed:",{existingItemsCount:I.length,newItemsCount:$.length,finalItemsCount:me.length,finalItems:me.map(le=>({id:le.materialInternalId,name:le.materialName,type:le.materialType}))})}}catch(I){console.error("❌ MERGE PHASE: Error in merge operation:",I)}else console.log("📭 MERGE PHASE: No existing items found, using only new items");console.log("Storing ID-based tender items:",{totalItems:me.length,newItems:$.length,items:me.map(I=>({id:I.internalId,materialId:I.materialInternalId,name:I.materialName,price:I.unitPrice,total:I.totalPrice}))}),await it.setPendingTenderItems(me),console.log("✅ STORAGE COMPLETE - Stored items to FirestorePendingDataService:",me.length),setTimeout(async()=>{const I=await it.getPendingTenderItems();console.log("🔍 VERIFICATION: Items in storage after save:",{count:I?.length||0,items:I})},100),console.log("📡 DISPATCHING CUSTOM EVENT: tenderItemsAdded"),window.dispatchEvent(new CustomEvent("tenderItemsAdded",{detail:{count:$.length,type:"foreignProduct",items:me}}));try{const I=B();I&&I.name&&H("task",`${I.name} أضاف منتجات أجنبية للمناقصة`,`تم إضافة ${$.length} منتج أجنبي بنظام الهوية الفريدة`)}catch(I){console.error("Failed to log activity:",I)}J(`تم إضافة ${$.length} منتج أجنبي بنجاح إلى قائمة المناقصة`,"نجحت العملية"),U(!1),ee([]),ie(null),setTimeout(()=>{X(pe==="new"?"/tenders/add":`/tenders/edit/${pe}`)},2e3)}catch(E){console.error("Error in handleConfirmQuantities:",E),z("فشل في إضافة المنتجات الأجنبية للمناقصة - تحقق من البيانات","خطأ في النظام")}},re=()=>{U(!1),ee([]),ie(null)},_=()=>Math.round(T.reduce((E,D)=>E+D.totalPrice,0));return u?n.jsx(Mn,{show:!0,message:"جار تحميل بيانات المنتجات الأجنبية...",overlay:!1}):p?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:p}),n.jsxs("button",{className:"btn btn-primary",onClick:de,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Xn,{onToggle:L}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المناقصات"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"منتجات أجنبية"})]})}),n.jsx(Jn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"raw-materials-table",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-globe text-warning me-2"}),"قائمة المنتجات الأجنبية (",R.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المنتجات الأجنبية...",value:w,onChange:E=>N(E.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),n.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:V,disabled:l.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["إضافة المحدد (",l.length,")"]}),n.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const E=pe!=="new"?`/tenders/edit/${pe}`:"/tenders/add";X(E)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:"العودة للمناقصة"})]})})]})}),n.jsx("div",{className:"card-body p-0",children:R.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-globe fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد منتجات أجنبية"}),n.jsx("p",{className:"text-muted",children:w?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي منتجات أجنبية بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",children:"اختيار"}),n.jsx("th",{className:"text-center",children:"اسم المنتج"}),n.jsx("th",{className:"text-center",children:"الفئة"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر"}),n.jsx("th",{className:"text-center",children:"المورد"}),n.jsx("th",{className:"text-center",children:"بلد المنشأ"})]})}),n.jsx("tbody",{children:R.map(E=>{let D=E.price,F=E.supplier,te=!1,$=null;return E.priceQuotes&&Array.isArray(E.priceQuotes)&&E.priceQuotes.length>0&&(te=!0,$=E.priceQuotes.reduce((Q,me)=>{const I=parseFloat(Q.price)||0;return(parseFloat(me.price)||0)<I?me:Q}),D=$.price,F=$.supplierName),n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input",type:"checkbox",checked:l.some(Q=>Q.internalId===E.internalId),onChange:()=>Pe(E),style:{transform:"scale(1.2)"}})})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-primary",children:E.name})}),n.jsx("td",{className:"text-center",children:E.category||"-"}),n.jsx("td",{className:"text-center",children:E.unit||"-"}),n.jsx("td",{className:"text-center",children:D?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsxs("span",{children:[D," ريال"]}),te&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}):"-"}),n.jsx("td",{className:"text-center",children:F?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("span",{children:F}),te&&n.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:"أقل مورد"})]}):"-"}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"badge bg-warning text-dark",children:E.countryOfOrigin||"غير محدد"})})]},E.id)})})]})})})]})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&t&&n.jsx(Zn,{rtl:!0}),!r&&t&&n.jsx(es,{})]}),G&&n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-calculator me-2"}),"تحديد الكميات والأسعار"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:re,"aria-label":"Close"})]}),n.jsxs("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:[Z&&n.jsxs("div",{className:"alert alert-warning alert-dismissible m-3 mb-2",role:"alert",style:{background:"linear-gradient(45deg, #fff3cd, #ffeaa7)",border:"2px solid #f39c12",borderRadius:"8px",boxShadow:"0 4px 12px rgba(243, 156, 18, 0.3)"},children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-exclamation-triangle-fill text-warning me-2",style:{fontSize:"20px"}}),n.jsxs("div",{className:"flex-grow-1",children:[n.jsx("strong",{children:"تحذير: بنود مكررة!"}),n.jsx("div",{className:"mt-1 text-dark",children:Z}),n.jsx("small",{className:"text-muted",children:"يرجى إلغاء تحديد البنود المكررة قبل المتابعة"})]})]}),n.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>ie(null)})]}),n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"30%"},children:"المنتج الأجنبي"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"السعر الأساسي"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"المورد"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"إجمالي السعر"})]})}),n.jsx("tbody",{children:T.map((E,D)=>n.jsxs("tr",{style:{height:"60px"},children:[n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:"bi bi-globe text-warning me-2"}),n.jsxs("div",{children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:F=>{F.preventDefault(),F.stopPropagation(),X(`/foreign-products/edit/${E.id}`)},title:`تحرير المنتج المستورد: ${E.name}`,children:E.name}),n.jsx("small",{className:"text-muted",children:E.category}),n.jsx("div",{children:n.jsx("span",{className:"badge bg-warning text-dark",style:{fontSize:"10px"},children:E.countryOfOrigin||"غير محدد"})})]})]})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("span",{className:"fw-bold text-success",children:[Math.round(E.unitPrice)," ريال"]}),n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:["/",E.unit||"وحدة"]})})]}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>se(E.id,Math.max(0,Number((E.quantity-.1).toFixed(1)))),disabled:E.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-dash"})}),n.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:E.quantity,min:"0",step:"any",onChange:F=>se(E.id,F.target.value),onBlur:F=>{const te=Number(F.target.value||0).toFixed(1);se(E.id,te)}}),n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>se(E.id,Number((E.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-plus"})})]})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"text-muted",children:E.displaySupplier||"-"})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(E.totalPrice)," ريال"]}),n.jsxs("small",{className:"text-success",children:["(",E.quantity.toFixed(1)," × ",Math.round(E.unitPrice),")"]})]})]},E.id))})]})})]}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:n.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("span",{className:"text-muted me-3",children:"إجمالي الطلبية:"}),n.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[_()," ريال"]}),n.jsxs("span",{className:"badge bg-info ms-2",children:[T.reduce((E,D)=>E+D.quantity,0).toFixed(1)," قطعة"]})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:re,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{console.log("🔥 CONFIRM BUTTON CLICKED! Modal items:",T),fe()},style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"تأكيد"})]})]})})]})})}),n.jsx(Tn,{show:k.show,onClose:W,title:k.title,message:k.message,type:k.type,onConfirm:k.onConfirm,showConfirm:k.showConfirm})]})}function T4(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(I4,{})})})}const C4=()=>{window.dispatchEvent(new CustomEvent("manufacturedProductsUpdated"))};class ac{static COLLECTION_NAME="manufacturedProducts";static async createManufacturedProduct(e){try{console.log("📤 Creating manufactured product:",e.title);const t=kt("MANUFACTURED_PRODUCT"),s={...e,internalId:t,createdAt:_t(),updatedAt:_t(),status:e.status||"active"},a=await Mr(dt(Ce,this.COLLECTION_NAME),s);return console.log("✅ Manufactured product created with ID:",a.id),{id:a.id,internalId:t,...s,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}catch(t){throw console.error("❌ Error creating manufactured product:",t),new Error(`فشل في إنشاء المنتج المصنع: ${t.message}`)}}static async getAllManufacturedProducts(){try{console.log("📋 Loading all manufactured products...");const e=Gt(dt(Ce,this.COLLECTION_NAME),ps("createdAt","desc")),t=await At(e),s=[];return t.forEach(a=>{const l=a.data();s.push({id:a.id,internalId:l.internalId||kt("MANUFACTURED_PRODUCT"),...l,createdAt:l.createdAt?.toDate?.()?.toISOString()||new Date().toISOString(),updatedAt:l.updatedAt?.toDate?.()?.toISOString()||new Date().toISOString()})}),console.log("✅ Loaded manufactured products:",s.length),s}catch(e){throw console.error("❌ Error loading manufactured products:",e),new Error(`فشل في تحميل المنتجات المصنعة: ${e.message}`)}}static async getManufacturedProductById(e){try{console.log("📋 Loading manufactured product:",e);const t=ht(Ce,this.COLLECTION_NAME,e),s=await hs(t);if(!s.exists())throw new Error("المنتج المصنع غير موجود");const a=s.data(),l={id:s.id,internalId:a.internalId||kt("MANUFACTURED_PRODUCT"),...a,createdAt:a.createdAt?.toDate?.()?.toISOString()||new Date().toISOString(),updatedAt:a.updatedAt?.toDate?.()?.toISOString()||new Date().toISOString()};return console.log("✅ Loaded manufactured product:",l.title),l}catch(t){throw console.error("❌ Error loading manufactured product:",t),new Error(`فشل في تحميل المنتج المصنع: ${t.message}`)}}static async getManufacturedProductByInternalId(e){try{console.log("📋 Loading manufactured product by internal ID:",e);const t=Gt(dt(Ce,this.COLLECTION_NAME),Sn("internalId","==",e)),s=await At(t);if(s.empty)throw new Error(`المنتج المصنع غير موجود: ${e}`);const a=s.docs[0],l=a.data(),c={id:a.id,internalId:l.internalId||e,...l,createdAt:l.createdAt?.toDate?.()?.toISOString()||new Date().toISOString(),updatedAt:l.updatedAt?.toDate?.()?.toISOString()||new Date().toISOString()};if(c.items&&Array.isArray(c.items)&&c.items.length>0){const u=c.items.reduce((m,p)=>m+(p.totalPrice||0),0);c.price=u}else c.price=c.estimatedValue||0;return c.name=c.title,c.category="منتج مصنع",c.unit="قطعة",c.supplier="منتج مصنع",console.log("✅ Loaded manufactured product by internal ID:",c.title),c}catch(t){throw console.error("❌ Error loading manufactured product by internal ID:",t),new Error(`فشل في تحميل المنتج المصنع: ${t.message}`)}}static async updateManufacturedProduct(e,t){try{console.log("📝 Updating manufactured product:",e);const s=ht(Ce,this.COLLECTION_NAME,e),a={...t,updatedAt:_t()};return await Zs(s,a),C4(),console.log("✅ Manufactured product updated successfully"),!0}catch(s){throw console.error("❌ Error updating manufactured product:",s),new Error(`فشل في تحديث المنتج المصنع: ${s.message}`)}}static async deleteManufacturedProduct(e){try{console.log("🗑️ Deleting manufactured product:",e);const t=ht(Ce,this.COLLECTION_NAME,e);return await er(t),console.log("✅ Manufactured product deleted successfully"),!0}catch(t){throw console.error("❌ Error deleting manufactured product:",t),new Error(`فشل في حذف المنتج المصنع: ${t.message}`)}}static async searchManufacturedProducts(e){try{console.log("🔍 Searching manufactured products:",e);const t=await this.getAllManufacturedProducts();if(!e.trim())return t;const s=e.toLowerCase(),a=t.filter(l=>l.title?.toLowerCase().includes(s)||l.referenceNumber?.toLowerCase().includes(s)||l.description?.toLowerCase().includes(s)||l.category?.toLowerCase().includes(s)||l.entity?.toLowerCase().includes(s));return console.log("✅ Search results:",a.length),a}catch(t){throw console.error("❌ Error searching manufactured products:",t),new Error(`فشل في البحث عن المنتجات المصنعة: ${t.message}`)}}static async getManufacturedProductsByStatus(e){try{console.log("📋 Loading manufactured products by status:",e);const t=Gt(dt(Ce,this.COLLECTION_NAME),Sn("status","==",e),ps("createdAt","desc")),s=await At(t),a=[];return s.forEach(l=>{const c=l.data();a.push({id:l.id,internalId:c.internalId||kt("MANUFACTURED_PRODUCT"),...c,createdAt:c.createdAt?.toDate?.()?.toISOString()||new Date().toISOString(),updatedAt:c.updatedAt?.toDate?.()?.toISOString()||new Date().toISOString()})}),console.log("✅ Loaded manufactured products by status:",a.length),a}catch(t){throw console.error("❌ Error loading manufactured products by status:",t),new Error(`فشل في تحميل المنتجات المصنعة: ${t.message}`)}}static validateManufacturedProductData(e){const t={};return(!e.title||!e.title.trim())&&(t.title="اسم المنتج مطلوب"),(!e.referenceNumber||!e.referenceNumber.trim())&&(t.referenceNumber="رقم المرجع مطلوب"),(!e.entity||!e.entity.trim())&&(t.entity="الجهة المصنعة مطلوبة"),e.submissionDeadline||(t.submissionDeadline="تاريخ الإنتاج المتوقع مطلوب"),e.estimatedValue&&isNaN(parseFloat(e.estimatedValue))&&(t.estimatedValue="التكلفة التقديرية يجب أن تكون رقماً صحيحاً"),t}}const uC=Object.freeze(Object.defineProperty({__proto__:null,ManufacturedProductService:ac},Symbol.toStringTag,{value:"Module"}));function A4(){const[r,e]=j.useState(!1),{isTimelineVisible:t}=Hn(),[s,a]=j.useState([]),[l,c]=j.useState([]),[u,m]=j.useState(!1),[p,b]=j.useState(null),[w,N]=j.useState(""),[R,O]=j.useState([]),[G,U]=j.useState(!1),[T,ee]=j.useState([]),Z=os(),{tenderId:ie}=ea(),{logActivity:X,getCurrentUser:pe}=_n(),{alertConfig:H,closeAlert:B,showSuccess:k,showError:W}=Cn(),{formatDate:J}=yh(),z=()=>{e(!r)},L=(E,D)=>{console.log("🧠 SENIOR REACT: Starting advanced duplicate prevention analysis...");const F=[],te=[],$=new Map,Q=new Map;return E.forEach((me,I)=>{const le=me.materialInternalId||me.internalId||me.id;le&&$.set(le,{item:me,index:I});const We=(me.materialName||me.name||me.title||"").trim();if(We){const nt=We.toLowerCase();Q.set(nt,{item:me,index:I})}}),console.log("🧠 DUPLICATE PREVENTION MAPS:",{existingIdsCount:$.size,existingNamesCount:Q.size}),D.forEach(me=>{const I=me.materialInternalId||me.internalId||me.id,le=(me.materialName||me.name||me.title||"").trim(),We=le.toLowerCase();let nt=!1,mt="",It=null;I&&$.has(I)&&(nt=!0,mt="ID",It=$.get(I).item,console.log(`🚨 ID DUPLICATE: ${le} matches existing ID: ${I}`)),!nt&&le&&Q.has(We)&&(nt=!0,mt="NAME",It=Q.get(We).item,console.log(`🚨 NAME DUPLICATE: "${le}" matches existing name (case-insensitive)`)),nt?F.push({newItem:me,existingItem:It,type:mt,displayName:le||"بند غير محدد"}):(te.push(me),console.log(`✅ UNIQUE ITEM: ${le} - Adding to list`),I&&$.set(I,{item:me,index:-1}),le&&Q.set(We,{item:me,index:-1}))}),console.log("🧠 DUPLICATE ANALYSIS COMPLETE:",{totalNewItems:D.length,uniqueItemsFound:te.length,duplicatesFound:F.length,duplicateDetails:F.map(me=>({name:me.displayName,type:me.type}))}),{duplicates:F,uniqueItems:te}};j.useEffect(()=>{de();const E=D=>{D.type==="manufacturedProductsUpdated"&&de()};return window.addEventListener("storage",E),window.addEventListener("focus",de),()=>{window.removeEventListener("storage",E),window.removeEventListener("focus",de)}},[]),j.useEffect(()=>{if(w.trim()){const E=s.filter(D=>D.title?.toLowerCase().includes(w.toLowerCase())||D.referenceNumber?.toLowerCase().includes(w.toLowerCase())||D.description?.toLowerCase().includes(w.toLowerCase()));O(E)}else O(s)},[w,s]);const de=async()=>{try{m(!0);const D=(await ac.getAllManufacturedProducts()).filter(F=>F.status!=="inactive");a(D),b(null)}catch(E){b(E.message)}finally{m(!1)}},Pe=E=>{if(l.some(F=>F.internalId===E.internalId))c(F=>F.filter(te=>te.internalId!==E.internalId));else{const F={...E,type:"manufacturedProduct",quantity:1};c(te=>[...te,F])}},V=async()=>{if(l.length===0){W("يرجى اختيار منتج مصنع واحد على الأقل","لا توجد منتجات مختارة");return}const E=l.map(D=>{let F=0;return D.items&&Array.isArray(D.items)&&D.items.length>0?F=D.items.reduce((te,$)=>te+($.totalPrice||0),0):F=D.estimatedValue||0,{...D,quantity:1,unitPrice:F,totalPrice:F,displaySupplier:"منتج مصنع"}});ee(E),U(!0)},se=(E,D)=>{const F=Math.max(0,parseFloat(D)||0);ee(te=>te.map($=>$.id===E?{...$,quantity:Number(F.toFixed(1)),totalPrice:$.unitPrice*Number(F.toFixed(1))}:$))},fe=async()=>{try{if(!Array.isArray(T)||T.length===0){W("لا توجد منتجات مختارة للإضافة","خطأ في البيانات");return}const E=await it.getPendingTenderItems()||[],D=T.map(I=>({...I,materialName:I.title,materialInternalId:I.internalId})),F=L(E,D),{duplicates:te,uniqueItems:$}=F;if(te.length>0){const I=te.map(le=>{const We=le.type==="ID"?"معرف مطابق":"اسم مطابق";return`⚠️ "${le.displayName}" (${We})`});W(`تم العثور على ${te.length} بند مكرر. لن يتم إضافة البنود المكررة.

${I.join(`
`)}`,"بنود مكررة"),console.log("🚨 DUPLICATES BLOCKED:",{count:te.length,names:te.map(le=>le.displayName)});return}const Q=[];for(const I of $)try{const le={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:I.internalId,materialType:"manufacturedProduct",materialName:I.title,materialCategory:"منتج مصنع",materialUnit:"قطعة",quantity:I.quantity||1,unitPrice:I.unitPrice||0,totalPrice:(I.quantity||1)*(I.unitPrice||0),supplierInfo:"منتج مصنع",tenderId:ie==="new"?"new":ie,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};Q.push(le)}catch(le){console.error("Error creating tender item:",le),W(`فشل في إضافة المنتج: ${I.title}`,"خطأ في البيانات");return}const me=[...E,...Q];await it.setPendingTenderItems(me);try{const I=pe();I&&I.name&&X("task",`${I.name} أضاف منتجات مصنعة للمناقصة`,`تم إضافة ${Q.length} منتج مصنع`)}catch(I){console.error("Failed to log activity:",I)}k(`تم إضافة ${Q.length} منتج مصنع للمناقصة`,"تمت الإضافة"),window.dispatchEvent(new CustomEvent("tenderItemsAdded",{detail:{count:Q.length,type:"manufacturedProduct",items:Q}})),U(!1),ee([]),setTimeout(()=>{Z(ie==="new"?"/tenders/add":`/tenders/edit/${ie}`)},100)}catch(E){console.error("Error in handleConfirmQuantities:",E),W("فشل في إضافة المنتجات المصنعة للمناقصة","خطأ في النظام")}},re=()=>{U(!1),ee([])},_=()=>Math.round(T.reduce((E,D)=>E+D.totalPrice,0));return u?n.jsx(Mn,{show:!0,message:"جار تحميل بيانات المنتجات المصنعة...",overlay:!1}):p?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:p}),n.jsxs("button",{className:"btn btn-primary",onClick:de,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Xn,{onToggle:z}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المناقصات"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"منتجات مصنعة"})]})}),n.jsx(Jn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"manufactured-products-table",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-tools text-warning me-2"}),"قائمة المنتجات المصنعة (",R.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المنتجات المصنعة...",value:w,onChange:E=>N(E.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),n.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:V,disabled:l.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["إضافة المحدد (",l.length,")"]}),n.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const E=ie!=="new"?`/tenders/edit/${ie}`:"/tenders/add";Z(E)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:"العودة للمناقصة"})]})})]})}),n.jsx("div",{className:"card-body p-0",children:R.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-tools fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد منتجات مصنعة"}),n.jsx("p",{className:"text-muted",children:w?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي منتجات مصنعة بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",children:"اختيار"}),n.jsx("th",{className:"text-center",children:"اسم المنتج"}),n.jsx("th",{className:"text-center",children:"رقم المرجع"}),n.jsx("th",{className:"text-center",children:"التكلفة التقديرية"}),n.jsx("th",{className:"text-center",children:"تاريخ الإضافة"})]})}),n.jsx("tbody",{children:R.map(E=>{let D=0;return E.items&&Array.isArray(E.items)&&E.items.length>0?D=E.items.reduce((F,te)=>F+(te.totalPrice||0),0):D=E.estimatedValue||0,n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input",type:"checkbox",checked:l.some(F=>F.internalId===E.internalId),onChange:()=>Pe(E),style:{transform:"scale(1.2)"}})})}),n.jsx("td",{className:"text-center",children:n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:F=>{F.preventDefault(),F.stopPropagation(),Z(`/manufactured-products/edit/${E.id}`)},title:`تحرير المنتج المصنع: ${E.title}`,children:E.title})}),n.jsx("td",{className:"text-center",children:E.referenceNumber||"-"}),n.jsx("td",{className:"text-center",children:D?n.jsxs("span",{className:"badge bg-success text-white",children:[D.toLocaleString("en-US")," ر.س"]}):"-"}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"text-muted",children:J(E.submissionDeadline)})})]},E.id)})})]})})})]})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&t&&n.jsx(Zn,{rtl:!0}),!r&&t&&n.jsx(es,{})]}),G&&n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-calculator me-2"}),"تحديد الكميات والأسعار"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:re,"aria-label":"Close"})]}),n.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"30%"},children:"المنتج المصنع"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"السعر الأساسي"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"النوع"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"إجمالي السعر"})]})}),n.jsx("tbody",{children:T.map((E,D)=>n.jsxs("tr",{style:{height:"60px"},children:[n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:"bi bi-tools text-warning me-2"}),n.jsxs("div",{children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:F=>{F.preventDefault(),F.stopPropagation(),Z(`/manufactured-products/edit/${E.id}`)},title:`تحرير المنتج المصنع: ${E.title}`,children:E.title}),n.jsx("small",{className:"text-muted",children:E.referenceNumber})]})]})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("span",{className:"fw-bold text-success",children:[Math.round(E.unitPrice)," ريال"]}),n.jsx("div",{children:n.jsx("small",{className:"text-muted",children:"/قطعة"})})]}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>se(E.id,Math.max(0,Number((E.quantity-.1).toFixed(1)))),disabled:E.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-dash"})}),n.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:E.quantity,min:"0",step:"any",onChange:F=>se(E.id,F.target.value),onBlur:F=>{const te=Number(F.target.value||0).toFixed(1);se(E.id,te)}}),n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>se(E.id,Number((E.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-plus"})})]})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"badge bg-warning text-dark",children:"منتج مصنع"})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(E.totalPrice)," ريال"]}),n.jsxs("small",{className:"text-success",children:["(",E.quantity.toFixed(1)," × ",Math.round(E.unitPrice),")"]})]})]},E.id))})]})})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:n.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("span",{className:"text-muted me-3",children:"إجمالي الطلبية:"}),n.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[_()," ريال"]}),n.jsxs("span",{className:"badge bg-info ms-2",children:[T.reduce((E,D)=>E+D.quantity,0).toFixed(1)," قطعة"]})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:re,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:fe,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"تأكيد"})]})]})})]})})}),n.jsx(Tn,{show:H.show,onClose:B,title:H.title,message:H.message,type:H.type,onConfirm:H.onConfirm,showConfirm:H.showConfirm})]})}function D4(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(A4,{})})})}const td="suppliers";class Ji{static async getAllSuppliers(){try{const e=dt(Ce,td);let t;try{t=Gt(e,ps("createdAt","desc"))}catch{console.log("Using query without orderBy for empty collection"),t=Gt(e)}const a=(await At(t)).docs.map(l=>{const c=l.data();return{id:l.id,internalId:c.internalId||kt("LOCAL_SUPPLIER"),...c,createdAt:c.createdAt?.toDate(),updatedAt:c.updatedAt?.toDate()}});return a.length>0&&a[0].createdAt&&a.sort((l,c)=>(c.createdAt||new Date(0))-(l.createdAt||new Date(0))),a}catch(e){if(console.error("Error fetching suppliers:",e),e.code==="failed-precondition"||e.code==="not-found")return console.log("Suppliers collection not found, returning empty array"),[];throw new Error("فشل في تحميل الموردين")}}static async createSupplier(e){try{const t=kt("LOCAL_SUPPLIER"),s={...e,internalId:t,createdAt:_t(),updatedAt:_t()};return(await Mr(dt(Ce,td),s)).id}catch(t){throw console.error("Error creating supplier:",t),new Error("فشل في إنشاء المورد")}}static async updateSupplier(e,t){try{const s=ht(Ce,td,e),a={...t,updatedAt:_t()};return await Zs(s,a),!0}catch(s){throw console.error("Error updating supplier:",s),new Error("فشل في تحديث بيانات المورد")}}static async getSupplierById(e){try{const t=ht(Ce,td,e),s=await hs(t);if(s.exists()){const a=s.data();return{id:s.id,internalId:a.internalId||kt("LOCAL_SUPPLIER"),...a,createdAt:a.createdAt?.toDate(),updatedAt:a.updatedAt?.toDate()}}else return null}catch(t){throw console.error("Error fetching supplier by ID:",t),new Error("فشل في جلب بيانات المورد")}}static async getSupplierByInternalId(e){try{const t=dt(Ce,td),s=Gt(t,Sn("internalId","==",e)),a=await At(s);if(a.empty)return null;{const l=a.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:c.createdAt?.toDate(),updatedAt:c.updatedAt?.toDate()}}}catch(t){throw console.error("Error fetching supplier by internal ID:",t),new Error("فشل في جلب بيانات المورد")}}static async updateSupplierByInternalId(e,t){try{const s=await this.getSupplierByInternalId(e);if(!s)throw new Error("Supplier not found");return await this.updateSupplier(s.id,t)}catch(s){throw console.error("Error updating supplier by internal ID:",s),new Error("فشل في تحديث بيانات المورد")}}static async deleteSupplier(e){try{const t=ht(Ce,td,e);return await er(t),!0}catch(t){throw console.error("Error deleting supplier:",t),new Error("فشل في حذف المورد")}}static async deleteSupplierByInternalId(e){try{const t=await this.getSupplierByInternalId(e);if(!t)throw new Error("Supplier not found");return await this.deleteSupplier(t.id)}catch(t){throw console.error("Error deleting supplier by internal ID:",t),new Error("فشل في حذف المورد")}}static async searchSuppliers(e){try{const t=dt(Ce,td);return(await At(t)).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||kt("LOCAL_SUPPLIER"),...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate()}}).filter(c=>c.name?.toLowerCase().includes(e.toLowerCase())||c.email?.toLowerCase().includes(e.toLowerCase())||c.phone?.includes(e))}catch(t){throw console.error("Error searching suppliers:",t),new Error("فشل في البحث عن الموردين")}}static async migrateExistingData(){try{console.log("Starting local suppliers migration...");const e=await this.getAllSuppliers();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("ls_")){const a=kt("LOCAL_SUPPLIER");await this.updateSupplier(s.id,{...s,internalId:a}),t++,console.log(`Migrated local supplier: ${s.name} -> ${a}`)}return console.log(`Migration completed. ${t} local suppliers migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("فشل في ترحيل البيانات")}}static validateSupplierData(e){const t={};return e.name?.trim()||(t.name="اسم المورد مطلوب"),e.email?.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(t.email="صيغة البريد الإلكتروني غير صحيحة"):t.email="البريد الإلكتروني مطلوب",e.phone?.trim()||(t.phone="رقم الهاتف مطلوب"),t}}const R4=Object.freeze(Object.defineProperty({__proto__:null,SupplierService:Ji},Symbol.toStringTag,{value:"Module"})),$a="foreignSuppliers";class Zi{static async getAllForeignSuppliers(){return this.getAllSuppliers()}static async getAllSuppliers(){try{const e=dt(Ce,$a);let t;try{const a=Gt(e,ps("createdAt","desc"));t=await At(a,"getAllForeignSuppliers")}catch(a){console.log("OrderBy failed, using simple query:",a.message),t=await At(e,"getAllForeignSuppliers-simple")}const s=t.docs.map(a=>{const l=a.data();return{id:a.id,internalId:l.internalId||kt("FOREIGN_SUPPLIER"),...l,createdAt:l.createdAt?.toDate?.()||new Date,updatedAt:l.updatedAt?.toDate?.()||new Date}});return s.length>0&&s[0].createdAt&&s.sort((a,l)=>(l.createdAt||new Date(0))-(a.createdAt||new Date(0))),s}catch(e){if(console.error("Error fetching foreign suppliers:",e),e.code==="failed-precondition"||e.code==="not-found")return console.log("Foreign suppliers collection not found, returning empty array"),[];throw new Error("فشل في تحميل الموردين الأجانب: "+e.message)}}static async getSupplierById(e){try{const t=await aC($a,e);if(!t)throw new Error("Foreign supplier not found");return{...t,internalId:t.internalId||kt("FOREIGN_SUPPLIER"),createdAt:t.createdAt?.toDate?.()||new Date,updatedAt:t.updatedAt?.toDate?.()||new Date}}catch(t){throw console.error("Error fetching foreign supplier:",t),new Error("Failed to fetch foreign supplier: "+t.message)}}static async createSupplier(e){try{const t=this.validateSupplierData(e);if(Object.keys(t).length>0)throw new Error("Validation failed: "+Object.values(t).join(", "));const s=dt(Ce,$a),a=kt("FOREIGN_SUPPLIER"),l={...e,internalId:a,createdAt:_t(),updatedAt:_t(),status:e.status||"active"};return{id:await iC($a,l),...l,createdAt:new Date,updatedAt:new Date}}catch(t){throw console.error("Error creating foreign supplier:",t),new Error("Failed to create foreign supplier: "+t.message)}}static async updateSupplier(e,t){try{const s=this.validateSupplierData(t);if(Object.keys(s).length>0)throw new Error("Validation failed: "+Object.values(s).join(", "));const a=ht(Ce,$a,e),l={...t,updatedAt:_t()};return await Zs(a,l,"updateForeignSupplier"),{id:e,...l,updatedAt:new Date}}catch(s){throw console.error("Error updating foreign supplier:",s),new Error("Failed to update foreign supplier: "+s.message)}}static async getSupplierByInternalId(e){try{const t=dt(Ce,$a),s=Gt(t,Sn("internalId","==",e)),a=await At(s,"getForeignSupplierByInternalId");if(a.empty)return null;{const l=a.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:c.createdAt?.toDate?.()||new Date,updatedAt:c.updatedAt?.toDate?.()||new Date}}}catch(t){throw console.error("Error fetching foreign supplier by internal ID:",t),new Error("Failed to fetch foreign supplier by internal ID: "+t.message)}}static async updateSupplierByInternalId(e,t){try{const s=await this.getSupplierByInternalId(e);if(!s)throw new Error("Foreign supplier not found");return await this.updateSupplier(s.id,t)}catch(s){throw console.error("Error updating foreign supplier by internal ID:",s),new Error("Failed to update foreign supplier by internal ID: "+s.message)}}static async deleteSupplier(e){try{const t=ht(Ce,$a,e);return await er(t,"deleteForeignSupplier"),{success:!0,message:"Foreign supplier deleted successfully"}}catch(t){throw console.error("Error deleting foreign supplier:",t),new Error("Failed to delete foreign supplier: "+t.message)}}static async deleteSupplierByInternalId(e){try{const t=await this.getSupplierByInternalId(e);if(!t)throw new Error("Foreign supplier not found");return await this.deleteSupplier(t.id)}catch(t){throw console.error("Error deleting foreign supplier by internal ID:",t),new Error("Failed to delete foreign supplier by internal ID: "+t.message)}}static async getSuppliersByStatus(e){try{const t=dt(Ce,$a),s=Gt(t,Sn("status","==",e),ps("createdAt","desc"));return(await At(s,"getForeignSuppliersByStatus")).docs.map(l=>{const c=l.data();return{id:l.id,internalId:c.internalId||kt("FOREIGN_SUPPLIER"),...c,createdAt:c.createdAt?.toDate?.()||new Date,updatedAt:c.updatedAt?.toDate?.()||new Date}})}catch(t){throw console.error("Error fetching foreign suppliers by status:",t),new Error("Failed to fetch foreign suppliers by status: "+t.message)}}static async searchSuppliers(e){try{const t=dt(Ce,$a),a=(await At(t,"searchForeignSuppliers")).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||kt("FOREIGN_SUPPLIER"),...u,createdAt:u.createdAt?.toDate?.()||new Date,updatedAt:u.updatedAt?.toDate?.()||new Date}});if(!e||e.trim()==="")return a;const l=e.toLowerCase();return a.filter(c=>c.name?.toLowerCase().includes(l)||c.email?.toLowerCase().includes(l)||c.phone?.includes(e)||c.city?.toLowerCase().includes(l)||c.address?.toLowerCase().includes(l))}catch(t){throw console.error("Error searching foreign suppliers:",t),new Error("Failed to search foreign suppliers: "+t.message)}}static validateSupplierData(e){const t={};return(!e.name||e.name.trim()==="")&&(t.name="Company name is required"),!e.email||e.email.trim()===""?t.email="Email is required":this.validateEmail(e.email)||(t.email="Please enter a valid email address"),(!e.phone||e.phone.trim()==="")&&(t.phone="Phone number is required"),e.email&&!this.validateEmail(e.email)&&(t.email="Please enter a valid email address"),e.name&&e.name.length<2&&(t.name="Company name must be at least 2 characters long"),e.phone&&e.phone.length<10&&(t.phone="Phone number must be at least 10 digits long"),t}static validateEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static async uploadDocument(e,t,s="general"){try{if(!t)throw new Error("No file provided");const a=`${Date.now()}_${t.name}`,l=Wo(ri,`foreign-suppliers/${e}/documents/${s}/${a}`),c=await Zg(l,t),u=await Jm(c.ref);return{fileName:t.name,url:u,type:s,uploadedAt:new Date,size:t.size}}catch(a){throw console.error("Error uploading document:",a),new Error("Failed to upload document: "+a.message)}}static async deleteDocument(e){try{const t=Wo(ri,e);return await Fx(t),{success:!0,message:"Document deleted successfully"}}catch(t){throw console.error("Error deleting document:",t),new Error("Failed to delete document: "+t.message)}}static async migrateExistingData(){try{console.log("Starting foreign suppliers migration...");const e=await this.getAllSuppliers();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("fs_")){const a=kt("FOREIGN_SUPPLIER");await this.updateSupplier(s.id,{...s,internalId:a}),t++,console.log(`Migrated foreign supplier: ${s.name} -> ${a}`)}return console.log(`Migration completed. ${t} foreign suppliers migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("Failed to migrate foreign suppliers: "+e.message)}}static async getSupplierStats(){try{const e=dt(Ce,$a),s=(await At(e,"getForeignSupplierStats")).docs.map(a=>a.data());return{total:s.length,active:s.filter(a=>a.status==="active").length,inactive:s.filter(a=>a.status==="inactive").length,pending:s.filter(a=>a.status==="pending").length,byCity:s.reduce((a,l)=>{const c=l.city||"Unknown";return a[c]=(a[c]||0)+1,a},{})}}catch(e){throw console.error("Error fetching foreign supplier stats:",e),new Error("Failed to fetch foreign supplier statistics: "+e.message)}}}const P4=Object.freeze(Object.defineProperty({__proto__:null,ForeignSupplierService:Zi},Symbol.toStringTag,{value:"Module"})),k4=({refreshTrigger:r})=>{const[e,t]=j.useState([]),[s,a]=j.useState(!0),[l,c]=j.useState(null),[u,m]=j.useState(""),[p,b]=j.useState([]),[w,N]=j.useState(!1),[R,O]=j.useState(!1),[G,U]=j.useState(!1),[T,ee]=j.useState(null),[Z,ie]=j.useState([]),[X,pe]=j.useState([]),[H,B]=j.useState([]),k=os(),W=al(),{logActivity:J,getCurrentUser:z}=_n(),{alertConfig:L,closeAlert:de,showSuccess:Pe,showError:V,showConfirm:se}=Cn(),fe=W.state?.fromTender||!1,re=W.state?.tenderData||null,{currentPage:_,totalPages:E,paginatedItems:D,handlePageChange:F,resetPage:te,totalItems:$,itemsPerPage:Q}=wa(p,30);j.useEffect(()=>{me(),I();const oe=lt=>{lt.key==="rawMaterials_updated"&&me()},Ue=()=>{me()};window.addEventListener("storage",oe),window.addEventListener("rawMaterialsUpdated",Ue);const Je=()=>{me()};return window.addEventListener("focus",Je),()=>{window.removeEventListener("storage",oe),window.removeEventListener("rawMaterialsUpdated",Ue),window.removeEventListener("focus",Je)}},[]),j.useEffect(()=>{r&&me()},[r]),j.useEffect(()=>{if(u.trim()){console.log("Searching for:",u),console.log("Total materials before filter:",e.length);const oe=e.filter(Ue=>Ue.name?.toLowerCase().includes(u.toLowerCase())||Ue.category?.toLowerCase().includes(u.toLowerCase())||Ue.description?.toLowerCase().includes(u.toLowerCase())||Ue.supplier?.toLowerCase().includes(u.toLowerCase()));console.log("Filtered materials:",oe.length),console.log("First filtered material:",oe[0]),b(oe)}else console.log("No search term, showing all materials:",e.length),b(e);te()},[u,e,te]);const me=async()=>{try{a(!0);const oe=await wr.getAllRawMaterials();t(oe),c(null)}catch(oe){c(oe.message)}finally{a(!1)}},I=async()=>{try{const[oe,Ue]=await Promise.all([Ji.getAllSuppliers(),Zi.getAllSuppliers()]);ie(oe),pe(Ue)}catch(oe){console.error("Error loading suppliers:",oe)}},le=async(oe,Ue)=>{try{if(Ue==="local"){const Je=Z.find(lt=>lt.name===oe);Je&&(ee(Je),O(!0))}else if(Ue==="foreign"){const Je=X.find(lt=>lt.name===oe);Je&&(ee(Je),U(!0))}}catch(Je){console.error("Error opening supplier modal:",Je)}},We=()=>{O(!1),U(!1),ee(null)},nt=oe=>{se(`هل أنت متأكد من حذف هذه المادة الخام؟

${oe.name}`,()=>mt(oe),"تأكيد حذف المادة الخام")},mt=async oe=>{try{N(!0),await qn.moveToTrash(oe,"rawmaterials"),await wr.deleteRawMaterial(oe.id);const Ue=z();J("task",`${Ue.name} حذف مادة خام`,`تم حذف المادة الخام: ${oe.name}`),await me(),Pe(`تم نقل المادة الخام للمهملات: ${oe.name}`,"تم النقل للمهملات")}catch(Ue){c(Ue.message),V(`فشل في نقل المادة الخام للمهملات: ${Ue.message}`,"خطأ في النقل")}finally{N(!1)}},It=oe=>{if(H.some(Je=>Je.internalId===oe.internalId))B(Je=>Je.filter(lt=>lt.internalId!==oe.internalId));else{const Je={...oe,type:"rawMaterials",quantity:1};B(lt=>[...lt,Je])}},rn=async()=>{const oe=H.map(Je=>({internalId:Je.internalId,type:"rawMaterials",quantity:Je.quantity||1,addedAt:new Date().toISOString()}));await it.setPendingTenderItems(oe);const Ue=re?.id?`/tenders/edit/${re.id}`:"/tenders/add";k(Ue,{state:{selectedItems:oe,fromSelection:!0}})};return s?n.jsx(Mn,{show:!0,message:"جار تحميل بيانات المواد الخام...",overlay:!1}):l?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:l}),n.jsxs("button",{className:"btn btn-primary",onClick:me,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs("div",{className:"card shadow-sm","data-list":"raw-materials",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),"قائمة المواد الخام (",p.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المواد الخام...",value:u,onChange:oe=>m(oe.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),fe?n.jsxs(n.Fragment,{children:[n.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:rn,disabled:H.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-check-circle-fill me-2"}),"إضافة المحدد (",H.length,")"]}),n.jsxs("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const oe=re?.id?`/tenders/edit/${re.id}`:"/tenders/add";k(oe)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-arrow-left me-2"}),"العودة للمناقصة"]})]}):n.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:()=>k("/raw-materials/add"),style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"إضافة مادة خام جديدة"]})]})})]})}),n.jsxs("div",{className:"card-body p-0",children:[p.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-box-seam fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد مواد خام"}),n.jsx("p",{className:"text-muted",children:u?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي مواد خام بعد"}),!u&&n.jsxs("button",{className:"btn btn-primary",onClick:()=>k("/raw-materials/add"),children:[n.jsx("i",{className:"bi bi-plus-lg me-1"}),"إضافة أول مادة خام"]})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"اسم المادة"}),n.jsx("th",{className:"text-center",children:"الفئة"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر"}),n.jsx("th",{className:"text-center",children:"المورد"}),n.jsx("th",{className:"text-center",style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:D.map((oe,Ue)=>{let Je=oe.price,lt=oe.supplier,Dt=!1,Ht=null,Ze=null;return oe.priceQuotes&&Array.isArray(oe.priceQuotes)&&oe.priceQuotes.length>0&&(Dt=!0,Ze=oe.priceQuotes.reduce((Vt,Xt)=>{const ts=parseFloat(Vt.price)||0;return(parseFloat(Xt.price)||0)<ts?Xt:Vt}),Je=Ze.price,lt=Ze.supplierName,Ht=Ze.supplierType),n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(_-1)*Q+Ue+1})}),n.jsx("td",{className:"text-center",children:n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary material-name-btn",onClick:Vt=>{if(Vt.preventDefault(),Vt.stopPropagation(),console.log("=== MATERIAL BUTTON CLICKED ==="),console.log("Material Name:",oe.name),console.log("Material ID:",oe.id),console.log("Material Object:",oe),console.log("Navigate function:",typeof k),oe.id){const Xt=`/raw-materials/edit/${oe.id}`;console.log("Target URL:",Xt),console.log("Attempting navigation..."),console.log("🚀 FORCING NAVIGATION TO:",Xt),console.log("✅ Method 1: Direct window.location"),window.location.href=Xt;try{console.log("✅ Method 2: React Router navigate"),k(Xt)}catch(ts){console.log("❌ React Router failed:",ts)}console.log("🎯 NAVIGATION FORCED - Should redirect immediately!")}else console.error("Material ID is missing:",oe),V("معرف المادة مفقود، لا يمكن التنقل","خطأ في التنقل");console.log("=== END CLICK HANDLER ===")},onMouseDown:Vt=>Vt.preventDefault(),style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0",userSelect:"none",pointerEvents:"auto",zIndex:"1"},title:`انقر للتعديل | Internal ID: ${oe.internalId||"Not Set"} | Firebase ID: ${oe.id||"Missing"}`,children:oe.name})}),n.jsx("td",{className:"text-center",children:oe.category||"-"}),n.jsx("td",{className:"text-center",children:oe.unit||"-"}),n.jsx("td",{className:"text-center",children:Je?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsxs("span",{children:[Je," ريال"]}),Dt&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}):"-"}),n.jsx("td",{className:"text-center",children:lt?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[Dt&&Ht?n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",onClick:()=>le(lt,Ht),style:{textDecoration:"none"},title:`فتح تفاصيل ${Ht==="local"?"المورد المحلي":"المورد الأجنبي"}`,children:lt}):n.jsx("span",{children:lt}),Dt&&n.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:"أقل مورد"})]}):"-"}),n.jsx("td",{className:"text-center",children:fe?n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input",type:"checkbox",checked:H.some(Vt=>Vt.internalId===oe.internalId),onChange:()=>It(oe),style:{transform:"scale(1.2)"}})}):n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>k(`/raw-materials/edit/${oe.id}`),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>nt(oe),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},oe.internalId||oe.id)})})]})}),p.length>0&&n.jsx(va,{currentPage:_,totalPages:E,onPageChange:F,totalItems:$,itemsPerPage:Q})]}),R&&T&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:oe=>{oe.target===oe.currentTarget&&We()},children:n.jsx("div",{className:"modal-dialog modal-lg",onClick:oe=>oe.stopPropagation(),children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"معلومات المورد - ",T.name,n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:"محلي"})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:We})]}),n.jsx("div",{className:"modal-body",children:n.jsxs("div",{className:"row g-3",children:[n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"اسم المورد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.name})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البريد الإلكتروني"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.email||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الهاتف"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:T.phone||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"المدينة"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.city||""})]}),n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"العنوان"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.address||""})]}),T.taxNumber&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"الرقم الضريبي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.taxNumber})]}),T.bankAccount&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الحساب البنكي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.bankAccount})]}),T.notes&&n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"ملاحظات"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.notes})]})]})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:We,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إغلاق"})})]})})}),G&&T&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:oe=>{oe.target===oe.currentTarget&&We()},children:n.jsx("div",{className:"modal-dialog modal-lg",onClick:oe=>oe.stopPropagation(),children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"معلومات المورد - ",T.name,n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:"أجنبي"})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:We})]}),n.jsx("div",{className:"modal-body",children:n.jsxs("div",{className:"row g-3",children:[n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"اسم المورد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.name})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البريد الإلكتروني"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.email||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الهاتف"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:T.phone||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البلد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.country||""})]}),n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"العنوان"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.address||""})]}),T.taxNumber&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"الرقم الضريبي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.taxNumber})]}),T.bankAccount&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الحساب البنكي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.bankAccount})]}),T.notes&&n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"ملاحظات"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.notes})]})]})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:We,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إغلاق"})})]})})}),n.jsx(Tn,{show:L.show,onClose:de,title:L.title,message:L.message,type:L.type,onConfirm:L.onConfirm,confirmText:L.confirmText,cancelText:L.cancelText,showCancel:L.showCancel})]})};function O4(){const[r,e]=j.useState(!1),[t,s]=j.useState(0),{isTimelineVisible:a}=Hn(),l=()=>{e(!r)};return n.jsx(un,{children:n.jsx(hn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Xn,{onToggle:l}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!a?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المناقصات"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"مواد خام"})]})}),n.jsx(Jn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"raw-materials-table",children:n.jsx(k4,{refreshTrigger:t})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&a&&n.jsx(Zn,{rtl:!0}),!r&&a&&n.jsx(es,{})]})})})}function M4(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(O4,{})})})}const L4={logo:()=>K1,logoSm:()=>Y1,user:()=>X1,pdfIcon:()=>J1,menuArrow:()=>Z1},$x=({size:r=32,clickable:e=!1,onClick:t=null,title:s="PDF",className:a="",style:l={}})=>{const c={width:`${r}px`,height:`${r}px`,objectFit:"contain",...e&&{cursor:"pointer"},...l},u=m=>{e&&t&&(m.preventDefault(),t(m))};return n.jsx("img",{src:L4.pdfIcon(),alt:"PDF",title:s,className:a,style:c,onClick:u})},Bx=j.memo(({value:r="",onChange:e,onBlur:t,name:s="category",required:a=!1,disabled:l=!1,placeholder:c="اختر الفئة",className:u="form-select",style:m={},showDescription:p=!1,"data-testid":b,...w})=>{const{categoriesWithDetails:N,loading:R,error:O,isReady:G}=H5(),U=j.useMemo(()=>G?N.map(T=>({value:T.value,label:T.label,description:T.description,isDefault:T.isDefault})):[],[N,G]);return R?n.jsx("select",{className:u,style:m,disabled:!0,...w,children:n.jsx("option",{value:"",children:"جاري تحميل الفئات..."})}):O?n.jsxs("div",{children:[n.jsx("select",{className:`${u} is-invalid`,style:m,disabled:!0,...w,children:n.jsx("option",{value:"",children:"خطأ في تحميل الفئات"})}),n.jsx("div",{className:"invalid-feedback",children:O})]}):!G||U.length===0?n.jsxs("div",{children:[n.jsx("select",{className:u,style:m,disabled:!0,...w,children:n.jsx("option",{value:"",children:"لا توجد فئات متاحة"})}),n.jsx("small",{className:"form-text text-muted",children:"يرجى إضافة فئات من صفحة الإعدادات"})]}):n.jsxs("div",{children:[n.jsxs("select",{name:s,value:r,onChange:e,onBlur:t,required:a,disabled:l,className:u,style:m,"data-testid":b,"aria-label":"اختيار الفئة",...w,children:[n.jsx("option",{value:"",children:c}),U.map(T=>n.jsx("option",{value:T.value,title:p&&T.description?T.description:void 0,children:T.label},T.value))]}),G&&n.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-1",children:[n.jsxs("small",{className:"form-text text-muted",children:[U.length," فئة متاحة"]}),n.jsxs("small",{className:"form-text text-success",style:{fontSize:"10px"},children:[n.jsx("i",{className:"bi bi-wifi me-1"}),"متصل"]})]})]})});Bx.displayName="GlobalCategorySelect";const qx=j.memo(({value:r="",onChange:e,onBlur:t,name:s="unit",required:a=!1,disabled:l=!1,placeholder:c="اختر الوحدة",className:u="form-select",style:m={},showDescription:p=!1,"data-testid":b,...w})=>{const{unitsWithDetails:N,loading:R,error:O,isReady:G}=G5(),U=j.useMemo(()=>G?N.map(T=>({value:T.name,label:T.name,description:T.description,isDefault:T.isDefault})):[],[N,G]);return R?n.jsx("select",{className:u,style:m,disabled:!0,...w,children:n.jsx("option",{value:"",children:"جاري تحميل الوحدات..."})}):O?n.jsxs("div",{children:[n.jsx("select",{className:`${u} is-invalid`,style:m,disabled:!0,...w,children:n.jsx("option",{value:"",children:"خطأ في تحميل الوحدات"})}),n.jsx("div",{className:"invalid-feedback",children:O})]}):!G||U.length===0?n.jsxs("div",{children:[n.jsx("select",{className:u,style:m,disabled:!0,...w,children:n.jsx("option",{value:"",children:"لا توجد وحدات متاحة"})}),n.jsx("small",{className:"form-text text-muted",children:"يرجى إضافة وحدات من صفحة الإعدادات"})]}):n.jsxs("div",{children:[n.jsxs("select",{name:s,value:r,onChange:e,onBlur:t,required:a,disabled:l,className:u,style:m,"data-testid":b,"aria-label":"اختيار الوحدة",...w,children:[n.jsx("option",{value:"",children:c}),U.map(T=>n.jsx("option",{value:T.value,title:p&&T.description?T.description:void 0,children:T.label},T.value))]}),G&&n.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-1",children:[n.jsxs("small",{className:"form-text text-muted",children:[U.length," وحدة متاحة"]}),n.jsxs("small",{className:"form-text text-success",style:{fontSize:"10px"},children:[n.jsx("i",{className:"bi bi-wifi me-1"}),"متصل"]})]})]})});qx.displayName="GlobalUnitSelect";const Hx=j.memo(({position:r="bottom-right",showDetails:e=!1,className:t="",style:s={}})=>{const{isReady:a,loading:l,lastUpdated:c}=Hf(),u=l?.categories||l?.units||!1,p=r?{"top-right":{position:"fixed",top:"80px",right:"20px",zIndex:1040},"bottom-right":{position:"fixed",bottom:"20px",right:"20px",zIndex:1040},"top-left":{position:"fixed",top:"80px",left:"20px",zIndex:1040},"bottom-left":{position:"fixed",bottom:"20px",left:"20px",zIndex:1040}}[r]:{},b=typeof a=="function"?a():a;return n.jsxs("div",{className:`badge ${b?"bg-success":u?"bg-warning":"bg-danger"} ${t}`,style:{...p,...s},children:[n.jsx("i",{className:`bi ${b?"bi-wifi":u?"bi-arrow-clockwise":"bi-wifi-off"} me-1`}),b?"الإعدادات متصلة":u?"جاري التحميل...":"غير متصل",e&&c?.categories&&n.jsxs("div",{className:"mt-1",style:{fontSize:"10px"},children:["آخر تحديث: ",new Date(c.categories).toLocaleTimeString("ar")]})]})});Hx.displayName="SettingsSyncStatus";const F4=j.memo(({showSettingsLink:r=!0,showRefreshButton:e=!0,size:t="sm",className:s="d-flex gap-2",style:a={}})=>{const{forceRefresh:l,isReady:c}=Hf(),u=()=>{l&&l()};return n.jsxs("div",{className:s,style:a,children:[e&&n.jsx("button",{type:"button",className:`btn btn-outline-primary btn-${t}`,onClick:u,disabled:!(typeof c=="function"?c():c),title:"تحديث الإعدادات",children:n.jsx("i",{className:"bi bi-arrow-clockwise"})}),r&&n.jsx("a",{href:"/settings",className:`btn btn-outline-secondary btn-${t}`,title:"إدارة الإعدادات",children:n.jsx("i",{className:"bi bi-gear"})})]})});F4.displayName="SettingsQuickActions";const U4=j.memo(()=>{const{categories:r,units:e,loading:t,error:s,initialized:a,lastUpdated:l,isReady:c}=Hf();return null});U4.displayName="SettingsStatusPanel";function V4(){const[r,e]=j.useState(!1),{isTimelineVisible:t}=Hn(),[s,a]=j.useState({name:"",category:"",description:"",unit:"",price:"",supplier:"",stockQuantity:"",minimumStock:"",storageConditions:"",expiryDate:"",batchNumber:"",origin:"",notes:"",active:!0}),[l,c]=j.useState({}),[u,m]=j.useState(!1),[p,b]=j.useState(!1),[w,N]=j.useState(!1),[R,O]=j.useState(!1),[G,U]=j.useState(null),[T,ee]=j.useState(!1),[Z,ie]=j.useState(null),[X,pe]=j.useState({supplierType:"local",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),[H,B]=j.useState(null),[k,W]=j.useState([]),[J,z]=j.useState([]),[L,de]=j.useState([]),[Pe,V]=j.useState(!1),{alertConfig:se,closeAlert:fe,showSuccess:re,showError:_,showConfirm:E}=Cn(),D=C=>{if(C.length===0)return;const ne=C.reduce((ue,ce)=>{const ye=parseFloat(ue.price)||0;return(parseFloat(ce.price)||0)<ye?ce:ue});a(ue=>({...ue,price:ne.price,supplier:ne.supplierName}))},F=os(),{id:te}=ea(),$=!!te,{logActivity:Q,getCurrentUser:me}=_n();j.useMemo(()=>L.map(C=>({...C,formattedPrice:`${C.price} ريال`,formattedDate:new Date(C.date).toLocaleDateString("ar-SA")})),[L]),j.useMemo(()=>L.length===0?null:L.reduce((C,ne)=>{const ue=parseFloat(C.price)||0;return(parseFloat(ne.price)||0)<ue?ne:C}),[L]);const I=()=>{e(!r)};j.useEffect(()=>{$&&We(),le();const C=()=>{$&&te&&(console.log("Window focused - refreshing raw material data..."),We())};return window.addEventListener("focus",C),()=>{window.removeEventListener("focus",C)}},[te]),j.useEffect(()=>{console.log("PriceQuoteData changed:",{hasFile:!!X.quotationFile,fileName:X.quotationFile?.name,supplierName:X.supplierName,price:X.price})},[X]);const le=async()=>{try{const[C,ne]=await Promise.all([Ji.getAllSuppliers(),Zi.getAllSuppliers()]);W(C),z(ne)}catch(C){console.error("Error loading suppliers:",C)}},We=async()=>{try{b(!0),console.log("Loading raw material data for ID:",te);const C=await wr.getAllRawMaterials(),ne=C.find(ue=>ue.id===te);ne?(console.log("Raw material found:",ne.name),a({name:ne.name||"",category:ne.category||"",description:ne.description||"",unit:ne.unit||"",price:ne.price||"",supplier:ne.supplier||"",stockQuantity:ne.stockQuantity||"",minimumStock:ne.minimumStock||"",storageConditions:ne.storageConditions||"",expiryDate:ne.expiryDate||"",batchNumber:ne.batchNumber||"",origin:ne.origin||"",notes:ne.notes||"",active:ne.active!==void 0?ne.active:!0}),ne.priceQuotes&&Array.isArray(ne.priceQuotes)?(console.log("Loading price quotes for raw material:",ne.name,ne.priceQuotes),console.log("Price quotes analysis:"),ne.priceQuotes.forEach((ue,ce)=>{console.log(`Quote ${ce}:`,{id:ue.id,supplierName:ue.supplierName,price:ue.price,hasId:!!ue.id,keys:Object.keys(ue)})}),de(ne.priceQuotes),setTimeout(()=>{D(ne.priceQuotes)},200)):console.log("No price quotes found for raw material:",ne.name)):(console.error("Raw material not found with ID:",te),console.log("Available raw materials:",C.map(ue=>({id:ue.id,name:ue.name}))),c({submit:"المادة الخام غير موجودة أو تم حذفها"}))}catch(C){console.error("Error loading raw material:",C),c({submit:"فشل في تحميل بيانات المادة الخام: "+C.message})}finally{b(!1)}},nt=C=>{const{name:ne,value:ue,type:ce,checked:ye}=C.target;a(Le=>({...Le,[ne]:ce==="checkbox"?ye:ue})),l[ne]&&c(Le=>({...Le,[ne]:""}))},mt=async C=>{C.preventDefault();const ne=wr.validateRawMaterialData(s);if(L.length===0&&(ne.priceQuotes="يجب إضافة عرض سعر واحد على الأقل"),Object.keys(ne).length>0){c(ne);return}m(!0),c({});try{const ue=await oo.validateUniqueFields({name:s.name},$?te:null,$?"rawmaterials":null);if(Object.keys(ue).length>0){c(ue),m(!1);return}const ce={...s,price:parseFloat(s.price)||0,stockQuantity:parseFloat(s.stockQuantity)||0,minimumStock:parseFloat(s.minimumStock)||0,priceQuotes:L,status:"active"};if(console.log("Saving raw material with price quotes:",{name:ce.name,priceQuotes:ce.priceQuotes,priceQuotesCount:ce.priceQuotes.length}),$){await wr.updateRawMaterial(te,ce);const ye=me();Q("task",`${ye.name} عدل مادة خام`,`تم تعديل المادة الخام: ${ce.name}`)}else{await wr.createRawMaterial(ce);const ye=me();Q("task",`${ye.name} أضاف مادة خام`,`تم إضافة المادة الخام: ${ce.name}`)}F("/raw-materials")}catch(ue){c({submit:ue.message})}finally{m(!1)}},It=()=>{F("/raw-materials")},rn=()=>{N(!0)},oe=()=>{N(!1),B(null),pe({supplierType:"local",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),c(C=>({...C,fileUpload:""})),console.log("Modal closed and state reset")},Ue=()=>{O(!0)},Je=()=>{O(!1),U(null)},lt=j.useCallback((C,ne)=>{try{let ue=null,ce=[];if(ne==="local")ce=k,ue=ce.find(ye=>ye.name===C);else if(ne==="foreign")ce=J,ue=ce.find(ye=>ye.name===C);else{console.error("Invalid supplier type:",ne),_(`نوع مورد غير صحيح: ${ne}`,"خطأ");return}if(ue){console.log("SUCCESS: Supplier found:",ue.name),console.log("Supplier data:",ue);const ye={...ue,supplierType:ne};console.log("Setting supplier to edit:",ye),ie(ye),ee(!0),console.log("Modal state should be true now")}else ce.length===0?(loadSuppliersData(),_("لا توجد بيانات موردين. جار إعادة التحميل...","لا توجد بيانات")):_(`لم يتم العثور على المورد: ${C}`,"مورد غير موجود")}catch(ue){_(`خطأ في البحث عن المورد: ${ue.message}`,"خطأ في البحث")}},[k,J,_]),Dt=()=>{ee(!1),ie(null)},Ht=C=>{U(C)},Ze=()=>{G&&pe(C=>{console.log("Before supplier selection - preserving file:",C.quotationFile?.name);const ne={...C,supplier:G.id,supplierName:G.name};return console.log("After supplier selection - file preserved:",ne.quotationFile?.name),ne}),O(!1),U(null)},Vt=C=>{console.log("File details:",{name:C?.name,size:C?.size,type:C?.type,lastModified:C?.lastModified}),l.fileUpload&&c(ne=>({...ne,fileUpload:""})),pe(ne=>{const ue={...ne,quotationFile:C};return console.log("Updated priceQuoteData with file:",{hasFile:!!ue.quotationFile,fileName:ue.quotationFile?.name}),ue})},Xt=C=>{const{name:ne,value:ue,type:ce}=C.target;ce!=="file"&&pe(ne==="supplierType"?ye=>({...ye,[ne]:ue,supplier:"",supplierName:""}):ye=>({...ye,[ne]:ue}))},ts=async C=>{if(C.preventDefault(),console.log("Form element:",C.target),console.log("Current priceQuoteData:",X),console.log("Editing quote ID:",H),!X.supplierName){c(ye=>({...ye,fileUpload:"يجب اختيار المورد أولاً"}));return}if(!X.date){c(ye=>({...ye,fileUpload:"يجب إدخال تاريخ العرض"}));return}if(!X.price){c(ye=>({...ye,fileUpload:"يجب إدخال السعر"}));return}const ne=new FormData(C.target),ue=ne.get("quotationFile");console.log("File from form directly:",ue),console.log("File from state:",X.quotationFile);const ce=X.quotationFile||ue;console.log("File to upload:",ce),console.log("File upload details:",{exists:!!ce,isFile:ce instanceof File,name:ce?.name,size:ce?.size,type:ce?.type,lastModified:ce?.lastModified});try{if(m(!0),!H&&(!ce||ce.size===0))throw new Error("يجب اختيار ملف عرض السعر");let ye=null;if(console.log("File upload analysis:",{hasFileInState:!!X.quotationFile,hasFileInForm:!!ue,hasFileToUpload:!!ce,fileType:typeof ce,fileName:ce?.name,fileSize:ce?.size}),ce&&typeof ce!="string"&&ce.size>0){console.log("Starting file upload:",ce.name);try{_r.validateFile(ce,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}),console.log("File validation passed")}catch(Le){throw console.error("File validation failed:",Le),new Error(Le.message)}console.log("Attempting file upload to Firebase...");try{const Le=ce.name.split(".").pop()||"pdf",Nt=X.supplierName?`عرض سعر ${X.supplierName}.${Le}`:ce.name;console.log("Uploading with custom name:",Nt),ye=await _r.uploadFileWithCustomName(ce,"quotations",Nt),console.log("File uploaded successfully:",ye)}catch(Le){throw console.error("Firebase upload failed:",Le),new Error(`فشل في رفع الملف: ${Le.message}`)}}else console.log("No valid file to upload:",{fileExists:!!ce,isString:typeof ce=="string",hasSize:ce?.size>0});if(H)console.log("Updating existing price quote with ID:",H),de(Le=>{const Nt=Le.map(yt=>yt.id===H?{...yt,supplierType:X.supplierType,supplier:X.supplier,supplierName:X.supplierName,date:X.date,price:X.price,quotationFile:ye?ye.path:yt.quotationFile,quotationFileURL:ye?ye.url:yt.quotationFileURL,quotationFileName:ye?ye.originalName:yt.quotationFileName,quotationFileSize:ye?ye.size:yt.quotationFileSize,quotationFileType:ye?ye.type:yt.quotationFileType,updatedAt:new Date}:yt);return console.log("Updated price quotes:",Nt),setTimeout(()=>{D(Nt)},100),Nt});else{const Le={id:Date.now().toString(),supplierType:X.supplierType,supplier:X.supplier,supplierName:X.supplierName,date:X.date,price:X.price,quotationFile:ye?ye.path:null,quotationFileURL:ye?ye.url:null,quotationFileName:ye?ye.originalName:null,quotationFileSize:ye?ye.size:null,quotationFileType:ye?ye.type:null,createdAt:new Date};console.log("Adding new price quote:",Le),de(Nt=>{const yt=[...Nt,Le];return console.log("Updated price quotes:",yt),setTimeout(()=>{D(yt)},100),yt})}l.priceQuotes&&c(Le=>({...Le,priceQuotes:""})),oe(),$&&te&&setTimeout(async()=>{try{console.log("Auto-saving raw material after price quote change..."),de(Le=>{const Nt={...ne,priceQuotes:Le};return wr.updateRawMaterial(te,Nt).then(()=>{console.log("Auto-save successful")}).catch(yt=>{console.error("Auto-save failed:",yt),_("فشل في الحفظ التلقائي","خطأ في الحفظ")}),Le})}catch(Le){console.error("Auto-save setup error:",Le)}},200)}catch(ye){console.error("Error uploading file:",ye),c(Le=>({...Le,fileUpload:ye.message||"فشل في رفع الملف. حاول مرة أخرى."}))}finally{m(!1)}},ns=C=>{console.log("Starting edit for quote:",C),B(C.id),pe({supplierType:C.supplierType||"local",supplier:C.supplier||"",supplierName:C.supplierName||"",date:C.date||"",price:C.price||"",quotationFile:C.quotationFile||null}),N(!0)},mn=C=>{if(console.log("Price quote delete button clicked:",C),console.log("Quote ID:",C?.id),console.log("Quote keys:",C?Object.keys(C):"quote is null/undefined"),!C||!C.id){console.error("Invalid quote object - missing quote or ID:",{quote:C,hasId:!!C?.id,quoteId:C?.id,quoteType:typeof C}),_("خطأ في بيانات عرض السعر","خطأ");return}E(`هل أنت متأكد من حذف عرض السعر؟

${C.supplierName} - ${C.price} ريال`,()=>Kt(C),"تأكيد حذف عرض السعر")},Kt=async C=>{if(console.log("Delete confirmation called for quote:",C),console.log("Confirmation - Quote ID:",C?.id),console.log("Confirmation - Quote keys:",C?Object.keys(C):"quote is null/undefined"),console.log("Is editing mode:",$),console.log("Raw material ID:",te),console.log("Form data name:",s.name),!C||!C.id){console.error("Invalid quote in confirmation - missing quote or ID:",{quote:C,hasId:!!C?.id,quoteId:C?.id,quoteType:typeof C}),_("خطأ في بيانات عرض السعر","خطأ"),V(!1);return}try{if(V(!0),console.log("Starting delete process..."),console.log("Moving to trash..."),$&&te){const ue={...C,rawMaterialId:te,rawMaterialName:s.name};console.log("Quote with context for trash:",ue),console.log("Calling SimpleTrashService.moveToTrash...");const ce=await qn.moveToTrash(ue,"price_quotes");console.log("Trash service result:",ce),console.log("Moved to trash successfully")}else console.log("Skipping trash - raw material not saved yet (isEditing:",$,", id:",te,")");const ne=me();console.log("Logging activity with current user:",ne),Q("task",`${ne.name} حذف عرض سعر`,`تم حذف عرض السعر: ${C.supplierName} - ${C.price} ريال`),console.log("Updating local state..."),console.log("Current price quotes before deletion:",L),de(ue=>{const ce=ue.filter(ye=>ye.id!==C.id);return console.log("Filtered quotes:",ce.length,"from",ue.length),console.log("Removed quote with ID:",C.id),console.log("Remaining quotes:",ce.map(ye=>({id:ye.id,supplierName:ye.supplierName}))),setTimeout(()=>{D(ce)},100),ce}),console.log("Showing success message..."),$&&te?re(`تم نقل عرض السعر للمهملات: ${C.supplierName}`,"تم النقل للمهملات"):re(`تم حذف عرض السعر: ${C.supplierName}`,"تم الحذف"),console.log("Delete process completed successfully"),$&&te&&setTimeout(async()=>{try{console.log("Auto-saving raw material after price quote deletion..."),de(ue=>{const ce={...s,priceQuotes:ue};return wr.updateRawMaterial(te,ce).then(()=>{console.log("Auto-save after deletion successful")}).catch(ye=>{console.error("Auto-save after deletion failed:",ye)}),ue})}catch(ue){console.error("Auto-save after deletion setup error:",ue)}},200)}catch(ne){console.error("Error deleting price quote:",ne),console.error("Error stack:",ne.stack),_(`فشل في حذف عرض السعر: ${ne.message||"خطأ غير معروف"}`,"خطأ في الحذف")}finally{console.log("Setting deleting to false"),V(!1)}},En=()=>(X.supplierType==="local"?k:J).filter(ue=>{const ce=ue.hasOwnProperty("active"),ye=ue.hasOwnProperty("status");return ce?ue.active===!0:ye?ue.status==="active":!0});return p?n.jsx(Mn,{show:!0,message:"جار تحميل بيانات المادة الخام..."}):n.jsxs(hn,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Xn,{onToggle:I}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsxs("div",{style:{position:"sticky",top:0,zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item",children:n.jsx("a",{href:"/raw-materials",className:"text-decoration-none text-primary",children:"بنود المناقصات"})}),n.jsx("li",{className:"breadcrumb-item",children:n.jsx("a",{href:"/raw-materials",className:"text-decoration-none text-primary",children:"مواد خام"})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:$?"تعديل مادة خام":"إضافة مادة خام جديدة"})]})}),n.jsx(Jn,{})]}),n.jsxs("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:[n.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"60px"},children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsxs("div",{className:"card-header bg-white border-bottom py-4 d-flex align-items-center",children:[n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),$?"تعديل المادة الخام":"إضافة مادة خام جديدة"]}),n.jsx("div",{style:{flex:1}}),n.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:rn,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:"1",paddingTop:"2px"},children:"عرض سعر"})]}),n.jsxs("form",{onSubmit:mt,children:[n.jsxs("div",{className:"card-body p-4",children:[l.submit&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.submit]}),n.jsxs("div",{className:"row mb-4",children:[n.jsx("div",{className:"col-12",children:n.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[n.jsx("i",{className:"bi bi-info-circle me-2"}),"المعلومات الأساسية"]})}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"اسم المادة الخام *"}),n.jsx("input",{type:"text",className:`form-control ${l.name?"is-invalid":""}`,name:"name",value:s.name,onChange:nt,placeholder:"أدخل اسم المادة الخام"}),l.name&&n.jsx("div",{className:"invalid-feedback",children:l.name})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الفئة *"}),n.jsx(Bx,{name:"category",value:s.category,onChange:nt,required:!0,className:`form-select ${l.category?"is-invalid":""}`,placeholder:"اختر الفئة",showDescription:!0}),l.category&&n.jsx("div",{className:"invalid-feedback",children:l.category})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الوحدة *"}),n.jsx(qx,{name:"unit",value:s.unit,onChange:nt,required:!0,className:`form-select ${l.unit?"is-invalid":""}`,placeholder:"اختر الوحدة",showDescription:!0}),l.unit&&n.jsx("div",{className:"invalid-feedback",children:l.unit})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsxs("label",{className:"form-label fw-bold",children:["السعر (ريال) *",n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:L.length>0?"أقل سعر تلقائي":"سعر تلقائي"})]}),n.jsx("input",{type:"number",step:"0.01",min:"0",className:`form-control ${l.price?"is-invalid":""}`,name:"price",value:s.price,onChange:null,onKeyPress:null,placeholder:"0.00",readOnly:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"}}),l.price&&n.jsx("div",{className:"invalid-feedback",children:l.price}),n.jsx("div",{className:"mt-1",children:n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),L.length>0?"السعر محدد تلقائياً من أقل عرض سعر في القائمة":"السعر سيتم تحديده تلقائياً عند إضافة عروض الأسعار"]})})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الوصف"}),n.jsx("textarea",{className:"form-control",name:"description",value:s.description,onChange:nt,rows:"3",placeholder:"وصف المادة الخام"})]}),n.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:n.jsxs("div",{className:"d-flex align-items-center gap-2",children:[n.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"نشط":"غير نشط"}),n.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"rawMaterialActiveSwitch",name:"active",checked:s.active,onChange:nt,style:{width:"48px",height:"24px",marginRight:"8px"}})]})})]}),n.jsxs("div",{className:"row mb-4",children:[n.jsxs("div",{className:"col-12",children:[n.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[n.jsx("i",{className:"bi bi-receipt me-2"}),"عروض الأسعار"]}),l.priceQuotes&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.priceQuotes]})]}),L.length>0&&n.jsx("div",{className:"col-12",children:n.jsxs("div",{className:"card mb-3 border-0 shadow-lg",style:{background:"linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%)",borderRadius:"16px"},children:[n.jsx("div",{className:"card-header border-0",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"16px 16px 0 0",padding:"20px"},children:n.jsxs("h5",{className:"card-title text-white mb-0 d-flex align-items-center",children:[n.jsx("div",{className:"me-3",style:{background:"rgba(255,255,255,0.2)",borderRadius:"12px",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsx("i",{className:"bi bi-bar-chart-fill fs-5"})}),n.jsx("span",{className:"fw-bold",children:"مقارنة أسعار الموردين"}),n.jsxs("span",{className:"badge bg-light text-primary ms-3",style:{borderRadius:"20px",fontSize:"12px",padding:"6px 12px"},children:[L.length," موردين"]})]})}),n.jsx("div",{className:"card-body",style:{padding:"30px"},children:n.jsx("div",{style:{minHeight:"625px",direction:"ltr"},children:n.jsx("div",{style:{width:"100%",height:"605px",position:"relative"},children:(()=>{L.map(Le=>parseFloat(Le.price)||0);const C=640,ce=L.length*150,ye=Math.max(C,ce);return n.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${ye+160} 605`,style:{direction:"ltr"},children:[n.jsxs("defs",{children:[n.jsxs("linearGradient",{id:"chartBg",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#ffffff",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#f8f9ff",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"bestPriceGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#00f5a0",stopOpacity:1}}),n.jsx("stop",{offset:"30%",style:{stopColor:"#00d9f5",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#0066cc",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"regularPriceGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),n.jsx("stop",{offset:"50%",style:{stopColor:"#764ba2",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#f093fb",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient0",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#764ba2",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient1",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#f093fb",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#f5576c",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient2",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#4facfe",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#00f2fe",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient3",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#a8edea",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#fed6e3",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient4",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#ffecd2",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#fcb69f",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient5",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#a18cd1",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#fbc2eb",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient6",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#fad0c4",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#ffd1ff",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient7",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#a1c4fd",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#c2e9fb",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"metallicShine",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),n.jsx("stop",{offset:"45%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),n.jsx("stop",{offset:"50%",style:{stopColor:"rgba(255,255,255,0.8)",stopOpacity:1}}),n.jsx("stop",{offset:"55%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),n.jsx("stop",{offset:"100%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}})]}),n.jsx("filter",{id:"dropShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:n.jsx("feDropShadow",{dx:"0",dy:"6",stdDeviation:"8",floodColor:"rgba(0,0,0,0.15)"})}),n.jsxs("filter",{id:"premiumGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{stdDeviation:"5",result:"coloredBlur"}),n.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0 0 0  0 1 1 0 0  0 0 1 0 0  0 0 0 1 0"}),n.jsxs("feMerge",{children:[n.jsx("feMergeNode",{in:"coloredBlur"}),n.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),n.jsxs("filter",{id:"bevelEffect",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2",result:"blur"}),n.jsx("feSpecularLighting",{in:"blur",result:"specOut",surfaceScale:"5",specularConstant:"0.8",specularExponent:"20","lighting-color":"white",children:n.jsx("fePointLight",{x:"-50",y:"-50",z:"200"})}),n.jsx("feComposite",{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut2"}),n.jsx("feComposite",{in:"SourceGraphic",in2:"specOut2",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"})]}),n.jsxs("filter",{id:"pulseGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),n.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0.8 0 0  0 1 1 0 0  0 0 1 0.2 0  0 0 0 1 0"}),n.jsxs("feMerge",{children:[n.jsx("feMergeNode",{in:"coloredBlur"}),n.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),n.jsx("rect",{width:ye+160,height:"605",fill:"url(#chartBg)",rx:"12",style:{filter:"drop-shadow(0 4px 20px rgba(0,0,0,0.1))"}}),n.jsx("g",{transform:"translate(80, 40)",children:(()=>{const Le=L.map($e=>parseFloat($e.price)||0),Nt=Math.max(...Le),yt=Math.min(...Le),$s=Nt-yt||1,_e=300,Xe=640,be=L.length*150,De=Math.max(Xe,be),ve=Math.min(De/L.length*.6,80),ze=De/L.length;return n.jsxs(n.Fragment,{children:[[0,1,2,3,4,5].map($e=>{const we=130+(_e-130)/5*$e,ke=(1-$e/5)*Math.max(...Le);return n.jsxs("g",{children:[n.jsx("line",{x1:"0",y1:we,x2:De,y2:we,stroke:$e===5?"#007bff":"rgba(123, 140, 252, 0.2)",strokeWidth:$e===5?"2":"1",strokeDasharray:$e===5?"0":"5,5"}),n.jsx("text",{x:"-15",y:we+5,textAnchor:"end",fontSize:"12",fill:"#4f46e5",fontWeight:"600",children:Math.round(ke).toLocaleString()})]},$e)}),L.map(($e,Ke)=>{const we=parseFloat($e.price)||0;let et;if($s>0){const pt=_e-130,ls=we/Math.max(...Le);et=Math.max(ls*pt,15)}else et=(_e-130)*.8;const ke=ze*Ke+(ze-ve)/2,Ve=_e-et,Tt=we===yt;let ft;return Tt?ft="bestPriceGradient":ft=`gradient${Ke%8}`,n.jsxs("g",{children:[n.jsx("rect",{x:ke+4,y:Ve+8,width:ve,height:et,fill:"rgba(0,0,0,0.05)",rx:"10"}),n.jsx("rect",{x:ke+2,y:Ve+4,width:ve,height:et,fill:"rgba(0,0,0,0.08)",rx:"9"}),n.jsxs("rect",{x:ke,y:Ve,width:ve,height:et,fill:`url(#${ft})`,rx:"10",filter:Tt?"url(#premiumGlow)":"url(#bevelEffect)",style:{transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer"},children:[n.jsx("animate",{attributeName:"height",from:"0",to:et,dur:"2s",begin:`${Ke*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),n.jsx("animate",{attributeName:"y",from:_e,to:Ve,dur:"2s",begin:`${Ke*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),Tt&&n.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;1.05;1",dur:"3s",repeatCount:"indefinite",begin:`${Ke*.3+2}s`})]}),n.jsx("rect",{x:ke+2,y:Ve+2,width:ve-4,height:Math.max(et/2.5,30),fill:"url(#metallicShine)",rx:"8",opacity:"0.6",children:n.jsx("animateTransform",{attributeName:"transform",type:"translate",values:`-${ve};${ve}`,dur:"4s",repeatCount:"indefinite",begin:`${Ke*.5+3}s`})}),n.jsx("rect",{x:ke+3,y:Ve+3,width:Math.max(ve/4,8),height:Math.max(et-6,20),fill:"rgba(255,255,255,0.4)",rx:"6"}),n.jsx("rect",{x:ke+ve-6,y:Ve+6,width:"3",height:Math.max(et-12,15),fill:"rgba(255,255,255,0.2)",rx:"1.5"}),n.jsxs("g",{children:[n.jsx("rect",{x:ke+ve/2-30,y:Ve-28,width:"60",height:"20",fill:"rgba(0,0,0,0.8)",rx:"10",opacity:"0.9"}),n.jsxs("text",{x:ke+ve/2,y:Ve-15,textAnchor:"middle",fontSize:"12",fill:"white",fontWeight:"bold",children:["ر.س ",we.toLocaleString()]})]}),n.jsx("g",{children:(()=>{const pt=$e.supplierName,ls=pt.length*7,Ns=Math.max(ls+20,ve+10);return n.jsxs(n.Fragment,{children:[n.jsx("rect",{x:ke+ve/2-Ns/2,y:_e+30,width:Ns,height:22,fill:"rgba(255,255,255,0.96)",rx:"11",stroke:"rgba(0,123,255,0.5)",strokeWidth:"1.5",filter:"url(#dropShadow)"}),n.jsx("text",{x:ke+ve/2,y:_e+41,textAnchor:"middle",fontSize:"11",fill:"#1e40af",fontWeight:"700",style:{fontFamily:"system-ui, -apple-system, sans-serif",letterSpacing:"0.2px"},dominantBaseline:"middle",children:pt})]})})()}),Tt&&n.jsxs("g",{children:[n.jsx("circle",{cx:ke+ve/2,cy:Ve-100,r:"18",fill:"linear-gradient(135deg, #ffd700 0%, #ffb300 100%)",stroke:"#fff",strokeWidth:"3",filter:"url(#dropShadow)"}),n.jsx("text",{x:ke+ve/2,y:Ve-95,textAnchor:"middle",fontSize:"16",fill:"#fff",children:"👑"}),n.jsx("rect",{x:ke-5,y:Ve-70,width:ve+10,height:"20",fill:"#28a745",rx:"10",opacity:"0.9"}),n.jsx("text",{x:ke+ve/2,y:Ve-57,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:"أفضل سعر"})]})]},$e.id)}),n.jsx("text",{x:De/2,y:30,textAnchor:"middle",fontSize:"16",fill:"url(#bestPriceGradient)",fontWeight:"bold",direction:"rtl",children:"مقارنة الأسعار بالريال السعودي"}),n.jsxs("g",{transform:`translate(${De/2}, ${_e+110})`,children:[n.jsx("rect",{x:"-200",y:"-25",width:"400",height:"145",fill:"rgba(255,255,255,0.98)",rx:"20",stroke:"url(#bestPriceGradient)",strokeWidth:"2",filter:"url(#dropShadow)"}),n.jsx("text",{x:"0",y:"-5",textAnchor:"middle",fontSize:"16",fill:"#1f2937",fontWeight:"800",letterSpacing:"0.5px",children:"مؤشر الأسعار"}),n.jsxs("g",{transform:"translate(0, 15)",children:[n.jsxs("g",{transform:"translate(-125, 0)",children:[n.jsxs("g",{transform:"translate(0, 0)",children:[n.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#bestPriceGradient)",rx:"7",filter:"url(#premiumGlow)"}),n.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#059669",fontWeight:"700",children:"أفضل سعر"}),n.jsx("text",{x:"80",y:"13",fontSize:"18",children:"👑"})]}),n.jsx("line",{x1:"110",y1:"-5",x2:"110",y2:"19",stroke:"rgba(0,0,0,0.15)",strokeWidth:"2"}),n.jsxs("g",{transform:"translate(125, 0)",children:[n.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#regularPriceGradient)",rx:"7"}),n.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#6366f1",fontWeight:"700",children:"أسعار أخرى"}),n.jsx("text",{x:"90",y:"13",fontSize:"16",children:"📊"})]})]}),n.jsxs("g",{transform:"translate(0, 40)",children:[n.jsx("rect",{x:"-170",y:"-8",width:"340",height:"22",fill:"rgba(59, 130, 246, 0.08)",rx:"11"}),n.jsxs("text",{x:"0",y:"5",textAnchor:"middle",fontSize:"14",fill:"#1e40af",fontWeight:"700",children:["💰 الفرق في السعر: ",(Math.max(...Le)-Math.min(...Le)).toLocaleString()," ر.س"]})]}),n.jsx("g",{transform:"translate(0, 90)",children:n.jsxs("text",{x:"0",y:"0",textAnchor:"middle",fontSize:"12",fill:"#6b7280",fontWeight:"600",children:["📈 أعلى سعر: ",Math.max(...Le).toLocaleString()," ر.س  •  📉 أقل سعر: ",Math.min(...Le).toLocaleString()," ر.س"]})})]})]})]})})()})]})})()})})})]})}),n.jsx("div",{className:"col-12",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsx("div",{className:"d-flex justify-content-between align-items-center",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-list-ul text-primary me-2"}),"قائمة عروض الأسعار (",L.length,")"]})})}),n.jsx("div",{className:"card-body p-0",children:L.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-receipt fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد عروض أسعار"}),n.jsx("p",{className:"text-muted",children:"لم يتم إضافة أي عروض أسعار بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"المورد"}),n.jsx("th",{className:"text-center",children:"النوع"}),n.jsx("th",{className:"text-center",children:"التاريخ"}),n.jsx("th",{className:"text-center",children:"السعر (ريال)"}),n.jsx("th",{className:"text-center",children:"الملف"}),n.jsx("th",{className:"text-center",style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:L.map((C,ne)=>{const ue=L.length>=1&&L.reduce((ce,ye)=>{const Le=parseFloat(ce.price)||0;return(parseFloat(ye.price)||0)<Le?ye:ce}).id===C.id;return n.jsxs("tr",{className:ue?"table-success":"",children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:ne+1})}),n.jsxs("td",{className:"text-center",children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},onClick:ce=>{ce.preventDefault(),ce.stopPropagation(),console.log("Button clicked, calling handleSupplierEdit..."),lt(C.supplierName,C.supplierType)},title:`تحرير مورد: ${C.supplierName}`,type:"button",children:C.supplierName}),ue&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:`badge ${C.supplierType==="local"?"bg-success":"bg-info"}`,children:C.supplierType==="local"?"محلي":"أجنبي"})}),n.jsx("td",{className:"text-center",children:C.date}),n.jsxs("td",{className:"text-center",children:[C.price," ريال",ue&&n.jsx("i",{className:"bi bi-arrow-down-circle-fill text-success ms-2",title:"أقل سعر"})]}),n.jsx("td",{className:"text-center",children:C.quotationFile&&n.jsx($x,{size:25,clickable:!0,onClick:()=>{C.quotationFileURL?window.open(C.quotationFileURL,"_blank"):(console.log("No file URL available for:",C.quotationFile),alert("الملف غير متوفر للعرض"))},title:`عرض الملف: ${C.quotationFileName||C.quotationFile}`})}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>ns(C),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>mn(C),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},C.id)})})]})})})]})})]})]}),n.jsx("div",{className:"card-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsxs("div",{className:"d-flex gap-3",style:{marginBottom:"15px"},children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:It,disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?"جار الحفظ...":n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),$?"تحديث":"حفظ"]})})]})})]})]})}),n.jsx("div",{className:"app-footer",style:{textAlign:"center",padding:"20px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",marginTop:"20px"},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]})]}),!r&&t&&n.jsx(Zn,{rtl:!0}),!r&&t&&n.jsx(es,{}),w&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:n.jsx("div",{className:"modal-dialog modal-lg",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0 pb-2",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-receipt text-primary me-2"}),"طلب عرض سعر"]}),n.jsx("button",{type:"button",className:"btn-close",onClick:oe,style:{fontSize:"12px"}})]}),n.jsxs("form",{onSubmit:ts,onReset:C=>C.preventDefault(),children:[n.jsxs("div",{className:"modal-body px-4",children:[l.fileUpload&&n.jsxs("div",{className:"alert alert-danger mb-3",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.fileUpload]}),n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"نوع المورد *"}),n.jsxs("select",{className:"form-select",name:"supplierType",value:X.supplierType,onChange:Xt,required:!0,children:[n.jsx("option",{value:"local",children:"مورد محلي"}),n.jsx("option",{value:"foreign",children:"مورد أجنبي"})]})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"المورد *"}),n.jsxs("div",{className:"form-control d-flex align-items-center justify-content-between",onClick:Ue,style:{cursor:"pointer",backgroundColor:"#f8f9fa"},children:[n.jsx("span",{className:X.supplierName?"text-dark":"text-muted",children:X.supplierName||"اختر المورد"}),n.jsx("i",{className:"bi bi-chevron-down"})]})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"تاريخ العرض *"}),n.jsx("input",{type:"date",className:"form-control",name:"date",value:X.date,onChange:Xt,required:!0})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"السعر (ريال) *"}),n.jsx("input",{type:"number",step:"0.01",min:"0",className:"form-control",name:"price",value:X.price,onChange:Xt,onKeyPress:C=>{(C.key==="-"||C.key!=="."&&C.key!=="Backspace"&&(C.key<"0"||C.key>"9"))&&C.preventDefault()},placeholder:"0.00",required:!0})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsxs("label",{className:"form-label fw-bold",children:["رفع عرض السعر ",H?"(اختياري)":"*"]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.jpg,.png,.jpeg",style:{display:"none"},ref:C=>{C&&(C.onclick=()=>{C.value=""},C.onchange=ne=>{const ue=ne.target.files?.[0];ue&&Vt(ue)})},id:`fileInput_${w}_${Date.now()}`}),n.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>{const C=document.querySelector(`#fileInput_${w}_${Date.now()}`);if(C)C.click();else{const ne=document.createElement("input");ne.type="file",ne.accept=".pdf,.doc,.docx,.jpg,.png,.jpeg",ne.style.display="none",ne.onchange=ue=>{const ce=ue.target.files?.[0];ce&&Vt(ce),document.body.removeChild(ne)},document.body.appendChild(ne),ne.click()}},style:{borderRadius:"6px",height:"38px",minWidth:"150px"},children:[n.jsx("i",{className:"bi bi-upload me-2"}),"اختر ملف"]})]}),X.quotationFile&&n.jsxs("div",{className:"alert alert-success py-2 mb-2",style:{position:"relative"},children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-check-circle me-2 text-success"}),n.jsxs("div",{className:"flex-grow-1",children:[n.jsx("strong",{children:X.quotationFile.name?X.supplierName?`عرض سعر ${X.supplierName}.${X.quotationFile.name.split(".").pop()}`:X.quotationFile.name:H?X.supplierName?`عرض سعر ${X.supplierName}.pdf`:L.find(C=>C.id===H)?.quotationFileName||"ملف موجود":"ملف موجود"}),n.jsxs("small",{className:"text-muted ms-2",children:["(",X.quotationFile.size?Math.round(X.quotationFile.size/1024):H?Math.round((L.find(C=>C.id===H)?.quotationFileSize||0)/1024):0," KB)"]})]})]}),n.jsx("button",{type:"button",className:"btn-close btn-close-sm",onClick:()=>{pe(C=>({...C,quotationFile:null}))},title:"إزالة الملف",style:{position:"absolute",top:"8px",left:"8px",width:"20px",height:"20px",fontSize:"10px",opacity:.7},onMouseEnter:C=>C.target.style.opacity=1,onMouseLeave:C=>C.target.style.opacity=.7})]}),H&&!X.quotationFile&&n.jsxs("div",{className:"alert alert-info py-2 mb-2",children:[n.jsx("i",{className:"bi bi-info-circle me-2"}),n.jsxs("small",{children:["ملف موجود: ",L.find(C=>C.id===H)?.quotationFileName||"ملف موجود"]})]}),!X.quotationFile&&!H&&n.jsx("div",{className:"mt-1",children:n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),"يجب اختيار ملف PDF أو Word أو صورة"]})})]})]})]}),n.jsx("div",{className:"modal-footer border-0 pt-0 d-flex justify-content-center",style:{marginBottom:"10px"},children:n.jsxs("div",{className:"d-flex gap-3",children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:oe,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"10px",height:"10px"}}),"رفع..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),"إرسال"]})})]})})]})]})})}),R&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:n.jsx("div",{className:"modal-dialog modal-xl",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0 pb-2",style:{marginBottom:"5px"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-people-fill text-primary me-2"}),X.supplierType==="local"?"اختر مورد محلي":"اختر مورد أجنبي",n.jsxs("span",{className:"text-muted ms-2",children:["(",En().length,")"]})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:Je,style:{fontSize:"12px"}})]}),n.jsx("div",{className:"modal-body p-0",children:En().length>0?n.jsx("div",{className:"table-responsive suppliers-table",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"50px"}}),n.jsx("th",{children:"اسم المورد"}),n.jsx("th",{children:"البريد الإلكتروني"}),n.jsx("th",{children:"الهاتف"}),n.jsx("th",{children:"المدينة"})]})}),n.jsx("tbody",{children:En().map(C=>n.jsxs("tr",{onClick:()=>Ht(C),style:{cursor:"pointer"},children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input custom-radio",type:"radio",name:"selectedSupplier",checked:G?.id===C.id,onChange:()=>{},style:{pointerEvents:"none",width:"18px",height:"18px",borderWidth:"2px",borderColor:G?.id===C.id?"#007bff":"#dee2e6"}})})}),n.jsx("td",{children:n.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},children:C.name})}),n.jsx("td",{children:n.jsx("a",{href:`mailto:${C.email}`,className:"text-decoration-none",children:C.email})}),n.jsx("td",{children:C.phone}),n.jsx("td",{children:C.city||"-"})]},C.id))})]})}):n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-people fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد موردين"}),n.jsxs("p",{className:"text-muted",children:["لا توجد ",X.supplierType==="local"?"موردين محليين":"موردين أجانب"," مسجلين"]})]})}),n.jsx("div",{className:"modal-footer border-0 d-flex justify-content-center",style:{marginTop:"15px"},children:n.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:Ze,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",margin:"20px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:"تأكيد"})})]})})}),T&&Z&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:C=>{C.target===C.currentTarget&&Dt()},children:n.jsx("div",{className:"modal-dialog modal-lg",onClick:C=>C.stopPropagation(),children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"معلومات المورد - ",Z.name,n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:Z.supplierType==="local"?"محلي":"أجنبي"})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:Dt})]}),n.jsx("div",{className:"modal-body",children:n.jsxs("div",{className:"row g-3",children:[n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"اسم المورد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z.name})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البريد الإلكتروني"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z.email||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الهاتف"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:Z.phone||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"المدينة"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z.city||""})]}),n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"العنوان"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z.address||""})]}),Z.taxNumber&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"الرقم الضريبي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z.taxNumber})]}),Z.bankAccount&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الحساب البنكي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z.bankAccount})]}),Z.notes&&n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"ملاحظات"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z.notes})]})]})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:Dt,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إغلاق"})})]})})})]}),n.jsx(Mn,{show:u,message:$?"جار تحديث المادة الخام...":"جار حفظ المادة الخام..."}),n.jsx(Tn,{show:se.show,onClose:fe,title:se.title,message:se.message,type:se.type,onConfirm:se.onConfirm,confirmText:se.confirmText,cancelText:se.cancelText,showCancel:se.showCancel}),n.jsx(Hx,{position:"bottom-right",showDetails:!0})]})}function zE(){return n.jsx(un,{children:n.jsx(V4,{})})}const z4=({refreshTrigger:r})=>{const[e,t]=j.useState([]),[s,a]=j.useState(!0),[l,c]=j.useState(null),[u,m]=j.useState(""),[p,b]=j.useState([]),[w,N]=j.useState(!1),[R,O]=j.useState(!1),[G,U]=j.useState(!1),[T,ee]=j.useState(null),[Z,ie]=j.useState([]),[X,pe]=j.useState([]),H=os(),{logActivity:B,getCurrentUser:k}=_n(),{alertConfig:W,closeAlert:J,showSuccess:z,showError:L,showConfirm:de}=Cn(),{currentPage:Pe,totalPages:V,paginatedItems:se,handlePageChange:fe,resetPage:re,totalItems:_,itemsPerPage:E}=wa(p,30);j.useEffect(()=>{D(),F()},[]),j.useEffect(()=>{r&&D()},[r]),j.useEffect(()=>{if(u.trim()){const I=e.filter(le=>le.name?.toLowerCase().includes(u.toLowerCase())||le.category?.toLowerCase().includes(u.toLowerCase())||le.description?.toLowerCase().includes(u.toLowerCase())||le.supplier?.toLowerCase().includes(u.toLowerCase()));b(I)}else b(e);re()},[u,e,re]);const D=async()=>{try{a(!0);const I=await vr.getAllLocalProducts();t(I),c(null)}catch(I){c(I.message)}finally{a(!1)}},F=async()=>{try{const[I,le]=await Promise.all([Ji.getAllSuppliers(),Zi.getAllSuppliers()]);ie(I),pe(le)}catch(I){console.error("Error loading suppliers:",I)}},te=async(I,le)=>{try{if(le==="local"){const We=Z.find(nt=>nt.name===I);We&&(ee(We),O(!0))}else if(le==="foreign"){const We=X.find(nt=>nt.name===I);We&&(ee(We),U(!0))}}catch(We){console.error("Error opening supplier modal:",We)}},$=()=>{O(!1),U(!1),ee(null)},Q=I=>{de(`هل أنت متأكد من حذف هذا المنتج المحلي؟

${I.name}`,()=>me(I),"تأكيد حذف المنتج المحلي")},me=async I=>{try{N(!0),await qn.moveToTrash(I,"localproducts"),await vr.deleteLocalProduct(I.id);const le=k();B("task",`${le.name} حذف منتج محلي`,`تم حذف المنتج المحلي: ${I.name}`),await D(),z(`تم نقل المنتج المحلي للمهملات: ${I.name}`,"تم النقل للمهملات")}catch(le){c(le.message),L(`فشل في نقل المنتج المحلي للمهملات: ${le.message}`,"خطأ في النقل")}finally{N(!1)}};return s?n.jsx(Mn,{show:!0,message:"جار تحميل بيانات المنتجات المحلية...",overlay:!1}):l?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:l}),n.jsxs("button",{className:"btn btn-primary",onClick:D,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs("div",{className:"card shadow-sm","data-list":"local-products",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),"قائمة المنتجات المحلية (",p.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المنتجات المحلية...",value:u,onChange:I=>m(I.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),n.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:()=>H("/local-products/add"),style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"إضافة منتج محلي جديد"]})]})})]})}),n.jsxs("div",{className:"card-body p-0",children:[p.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-box-seam fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد منتجات محلية"}),n.jsx("p",{className:"text-muted",children:u?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي منتجات محلية بعد"}),!u&&n.jsxs("button",{className:"btn btn-primary",onClick:()=>H("/local-products/add"),children:[n.jsx("i",{className:"bi bi-plus-lg me-1"}),"إضافة أول منتج محلي"]})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"اسم المنتج"}),n.jsx("th",{className:"text-center",children:"الفئة"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر"}),n.jsx("th",{className:"text-center",children:"المورد"}),n.jsx("th",{className:"text-center",style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:se.map((I,le)=>{let We=I.price,nt=I.supplier,mt=!1,It=null,rn=null;return I.priceQuotes&&Array.isArray(I.priceQuotes)&&I.priceQuotes.length>0&&(mt=!0,rn=I.priceQuotes.reduce((oe,Ue)=>{const Je=parseFloat(oe.price)||0;return(parseFloat(Ue.price)||0)<Je?Ue:oe}),We=rn.price,nt=rn.supplierName,It=rn.supplierType),n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(Pe-1)*E+le+1})}),n.jsx("td",{className:"text-center",children:n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary product-name-btn",onClick:oe=>{if(oe.preventDefault(),oe.stopPropagation(),console.log("=== LOCAL PRODUCT BUTTON CLICKED ==="),console.log("Product Name:",I.name),console.log("Product ID:",I.id),I.id){const Ue=`/local-products/edit/${I.id}`;console.log("Target URL:",Ue),console.log("🚀 FORCING NAVIGATION TO:",Ue),window.location.href=Ue}else console.error("Product ID is missing:",I),L("معرف المنتج مفقود، لا يمكن التنقل","خطأ في التنقل")},onMouseDown:oe=>oe.preventDefault(),style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0",userSelect:"none",pointerEvents:"auto",zIndex:"1"},title:`انقر للتعديل | Internal ID: ${I.internalId||"Not Set"} | Firebase ID: ${I.id||"Missing"}`,children:I.name})}),n.jsx("td",{className:"text-center",children:I.category||"-"}),n.jsx("td",{className:"text-center",children:I.unit||"-"}),n.jsx("td",{className:"text-center",children:We?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsxs("span",{children:[We," ريال"]}),mt&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}):"-"}),n.jsx("td",{className:"text-center",children:nt?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[mt&&It?n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",onClick:()=>te(nt,It),style:{textDecoration:"none"},title:`فتح تفاصيل ${It==="local"?"المورد المحلي":"المورد الأجنبي"}`,children:nt}):n.jsx("span",{children:nt}),mt&&n.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:"أقل مورد"})]}):"-"}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>H(`/local-products/edit/${I.id}`),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>Q(I),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},I.internalId||I.id)})})]})}),p.length>0&&n.jsx(va,{currentPage:Pe,totalPages:V,onPageChange:fe,totalItems:_,itemsPerPage:E})]}),R&&T&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:I=>{I.target===I.currentTarget&&$()},children:n.jsx("div",{className:"modal-dialog modal-lg",onClick:I=>I.stopPropagation(),children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"معلومات المورد - ",T.name,n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:"محلي"})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:$})]}),n.jsx("div",{className:"modal-body",children:n.jsxs("div",{className:"row g-3",children:[n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"اسم المورد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.name})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البريد الإلكتروني"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.email||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الهاتف"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:T.phone||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"المدينة"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.city||""})]}),n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"العنوان"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.address||""})]}),T.taxNumber&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"الرقم الضريبي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.taxNumber})]}),T.bankAccount&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الحساب البنكي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.bankAccount})]}),T.notes&&n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"ملاحظات"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.notes})]})]})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:$,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إغلاق"})})]})})}),G&&T&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:I=>{I.target===I.currentTarget&&$()},children:n.jsx("div",{className:"modal-dialog modal-lg",onClick:I=>I.stopPropagation(),children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"معلومات المورد - ",T.name,n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:"أجنبي"})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:$})]}),n.jsx("div",{className:"modal-body",children:n.jsxs("div",{className:"row g-3",children:[n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"اسم المورد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.name})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البريد الإلكتروني"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.email||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الهاتف"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:T.phone||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البلد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.country||""})]}),n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"العنوان"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.address||""})]}),T.taxNumber&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"الرقم الضريبي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.taxNumber})]}),T.bankAccount&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الحساب البنكي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.bankAccount})]}),T.notes&&n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"ملاحظات"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.notes})]})]})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:$,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إغلاق"})})]})})}),n.jsx(Tn,{show:W.show,onClose:J,title:W.title,message:W.message,type:W.type,onConfirm:W.onConfirm,confirmText:W.confirmText,cancelText:W.cancelText,showCancel:W.showCancel})]})};function $4(){const[r,e]=j.useState(!1),[t,s]=j.useState(0),{isTimelineVisible:a}=Hn(),l=()=>{e(!r)};return n.jsx(un,{children:n.jsx(hn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Xn,{onToggle:l}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!a?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المناقصات"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"منتج محلي"})]})}),n.jsx(Jn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"local-products-table",children:n.jsx(z4,{refreshTrigger:t})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&a&&n.jsx(Zn,{rtl:!0}),!r&&a&&n.jsx(es,{})]})})})}function B4(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx($4,{})})})}function q4(){const[r,e]=j.useState(!1),{isTimelineVisible:t}=Hn(),[s,a]=j.useState({name:"",category:"",description:"",unit:"",price:"",supplier:"",stockQuantity:"",minimumStock:"",storageConditions:"",expiryDate:"",batchNumber:"",origin:"",notes:"",active:!0}),[l,c]=j.useState({}),[u,m]=j.useState(!1),[p,b]=j.useState(!1),[w,N]=j.useState(!1),[R,O]=j.useState(!1),[G,U]=j.useState(null),[T,ee]=j.useState(!1),[Z,ie]=j.useState(null),[X,pe]=j.useState({supplierType:"local",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),[H,B]=j.useState(null),[k,W]=j.useState([]),[J,z]=j.useState([]),[L,de]=j.useState([]),[Pe,V]=j.useState(!1),{alertConfig:se,closeAlert:fe,showSuccess:re,showError:_,showConfirm:E}=Cn(),D=C=>{if(C.length===0)return;const ne=C.reduce((ue,ce)=>{const ye=parseFloat(ue.price)||0;return(parseFloat(ce.price)||0)<ye?ce:ue});console.log("Lowest price quote found:",ne),a(ue=>({...ue,price:ne.price,supplier:ne.supplierName}))},F=os(),{id:te}=ea(),$=!!te,{logActivity:Q,getCurrentUser:me}=_n(),I=()=>{e(!r)};j.useEffect(()=>{$&&We(),le();const C=()=>{$&&te&&(console.log("Window focused - refreshing local product data..."),We())};return window.addEventListener("focus",C),()=>{window.removeEventListener("focus",C)}},[te]),j.useEffect(()=>{console.log("PriceQuoteData changed:",{hasFile:!!X.quotationFile,fileName:X.quotationFile?.name,supplierName:X.supplierName,price:X.price})},[X]);const le=async()=>{try{const[C,ne]=await Promise.all([Ji.getAllSuppliers(),Zi.getAllSuppliers()]);W(C),z(ne)}catch(C){console.error("Error loading suppliers:",C)}},We=async()=>{try{b(!0),console.log("Loading local product data for ID:",te);const C=await vr.getAllLocalProducts(),ne=C.find(ue=>ue.id===te);ne?(console.log("Local product found:",ne.name),a({name:ne.name||"",category:ne.category||"",description:ne.description||"",unit:ne.unit||"",price:ne.price||"",supplier:ne.supplier||"",stockQuantity:ne.stockQuantity||"",minimumStock:ne.minimumStock||"",storageConditions:ne.storageConditions||"",expiryDate:ne.expiryDate||"",batchNumber:ne.batchNumber||"",origin:ne.origin||"",notes:ne.notes||"",active:ne.active!==void 0?ne.active:!0}),ne.priceQuotes&&Array.isArray(ne.priceQuotes)?(console.log("Loading price quotes for local product:",ne.name,ne.priceQuotes),de(ne.priceQuotes),setTimeout(()=>{D(ne.priceQuotes)},200)):console.log("No price quotes found for local product:",ne.name)):(console.error("Local product not found with ID:",te),console.log("Available local products:",C.map(ue=>({id:ue.id,name:ue.name}))),c({submit:"المنتج المحلي غير موجود أو تم حذفه"}))}catch(C){console.error("Error loading local product:",C),c({submit:"فشل في تحميل بيانات المنتج المحلي: "+C.message})}finally{b(!1)}},nt=C=>{const{name:ne,value:ue,type:ce,checked:ye}=C.target;a(Le=>({...Le,[ne]:ce==="checkbox"?ye:ue})),l[ne]&&c(Le=>({...Le,[ne]:""}))},mt=async C=>{C.preventDefault();const ne=vr.validateLocalProductData(s);if(L.length===0&&(ne.priceQuotes="يجب إضافة عرض سعر واحد على الأقل"),Object.keys(ne).length>0){c(ne);return}m(!0),c({});try{const ue=await oo.validateUniqueFields({name:s.name},$?te:null,$?"localproducts":null);if(Object.keys(ue).length>0){c(ue),m(!1);return}const ce={...s,price:parseFloat(s.price)||0,stockQuantity:parseFloat(s.stockQuantity)||0,minimumStock:parseFloat(s.minimumStock)||0,priceQuotes:L,status:"active"};if(console.log("Saving local product with price quotes:",{name:ce.name,priceQuotes:ce.priceQuotes,priceQuotesCount:ce.priceQuotes.length}),$){await vr.updateLocalProduct(te,ce);const ye=me();Q("task",`${ye.name} عدل منتج محلي`,`تم تعديل المنتج المحلي: ${ce.name}`)}else{await vr.createLocalProduct(ce);const ye=me();Q("task",`${ye.name} أضاف منتج محلي`,`تم إضافة المنتج المحلي: ${ce.name}`)}F("/local-products")}catch(ue){c({submit:ue.message})}finally{m(!1)}},It=()=>{F("/local-products")},rn=()=>{N(!0)},oe=()=>{N(!1),B(null),pe({supplierType:"local",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),c(C=>({...C,fileUpload:""})),console.log("Modal closed and state reset")},Ue=()=>{O(!0)},Je=()=>{O(!1),U(null)},lt=C=>{console.log("Supplier Name:",C);try{console.log("Using already loaded local supplier data...");const ne=k;console.log("Available local suppliers:",ne.length),console.log("Local suppliers list:",ne.map(ce=>({id:ce.id,name:ce.name})));const ue=ne.find(ce=>ce.name===C);console.log("Found supplier:",ue?"YES":"NO"),ue?(console.log("SUCCESS: Local supplier found:",ue.name),console.log("Supplier data:",ue),ie(ue),ee(!0),console.log("Modal state should be true now"),setTimeout(()=>{console.log("Modal state check - showSupplierEditModal:",T),console.log("Modal state check - selectedSupplierToEdit:",Z?.name)},100)):(console.error("LOCAL SUPPLIER NOT FOUND"),console.error("Looking for supplier name:",C),console.error("Available suppliers:",ne.map(ce=>ce.name)),ne.length===0?(console.log("No suppliers loaded, triggering data reload..."),loadSuppliersData(),_("لا توجد بيانات موردين محليين. جار إعادة التحميل...","لا توجد بيانات")):_(`لم يتم العثور على المورد المحلي: ${C}`,"مورد غير موجود"))}catch(ne){console.error("=== LOCAL SUPPLIER SEARCH ERROR ==="),console.error("Error details:",ne),console.error("Error message:",ne.message),_(`خطأ في البحث عن المورد المحلي: ${ne.message}`,"خطأ في البحث")}},Dt=()=>{console.log("Called by:",new Error().stack),ee(!1),ie(null)},Ht=C=>{U(C)},Ze=()=>{G&&pe(C=>{console.log("Before supplier selection - preserving file:",C.quotationFile?.name);const ne={...C,supplier:G.id,supplierName:G.name};return console.log("After supplier selection - file preserved:",ne.quotationFile?.name),ne}),O(!1),U(null)},Vt=C=>{console.log("File details:",{name:C?.name,size:C?.size,type:C?.type,lastModified:C?.lastModified}),l.fileUpload&&c(ne=>({...ne,fileUpload:""})),pe(ne=>{const ue={...ne,quotationFile:C};return console.log("Updated priceQuoteData with file:",{hasFile:!!ue.quotationFile,fileName:ue.quotationFile?.name}),ue})},Xt=C=>{const{name:ne,value:ue,type:ce}=C.target;ce!=="file"&&pe(ne==="supplierType"?ye=>({...ye,[ne]:ue,supplier:"",supplierName:""}):ye=>({...ye,[ne]:ue}))},ts=async C=>{if(C.preventDefault(),console.log("Form element:",C.target),console.log("Current priceQuoteData:",X),console.log("Editing quote ID:",H),!X.supplierName){c(ye=>({...ye,fileUpload:"يجب اختيار المورد أولاً"}));return}if(!X.date){c(ye=>({...ye,fileUpload:"يجب إدخال تاريخ العرض"}));return}if(!X.price){c(ye=>({...ye,fileUpload:"يجب إدخال السعر"}));return}const ne=new FormData(C.target),ue=ne.get("quotationFile");console.log("File from form directly:",ue),console.log("File from state:",X.quotationFile);const ce=X.quotationFile||ue;console.log("File to upload:",ce),console.log("File upload details:",{exists:!!ce,isFile:ce instanceof File,name:ce?.name,size:ce?.size,type:ce?.type,lastModified:ce?.lastModified});try{if(m(!0),!H&&(!ce||ce.size===0))throw new Error("يجب اختيار ملف عرض السعر");let ye=null;if(ce&&typeof ce!="string"&&ce.size>0){console.log("Starting file upload:",ce.name);try{_r.validateFile(ce,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}),console.log("File validation passed")}catch(Le){throw console.error("File validation failed:",Le),new Error(Le.message)}console.log("Attempting file upload to Firebase...");try{const Le=ce.name.split(".").pop()||"pdf",Nt=X.supplierName?`عرض سعر ${X.supplierName}.${Le}`:ce.name;console.log("Uploading with custom name:",Nt),ye=await _r.uploadFileWithCustomName(ce,"quotations",Nt),console.log("File uploaded successfully:",ye)}catch(Le){throw console.error("Firebase upload failed:",Le),new Error(`فشل في رفع الملف: ${Le.message}`)}}if(H)console.log("Updating existing price quote with ID:",H),de(Le=>{const Nt=Le.map(yt=>yt.id===H?{...yt,supplierType:X.supplierType,supplier:X.supplier,supplierName:X.supplierName,date:X.date,price:X.price,quotationFile:ye?ye.path:yt.quotationFile,quotationFileURL:ye?ye.url:yt.quotationFileURL,quotationFileName:ye?ye.originalName:yt.quotationFileName,quotationFileSize:ye?ye.size:yt.quotationFileSize,quotationFileType:ye?ye.type:yt.quotationFileType,updatedAt:new Date}:yt);return console.log("Updated price quotes:",Nt),setTimeout(()=>{D(Nt)},100),Nt});else{const Le={id:Date.now().toString(),supplierType:X.supplierType,supplier:X.supplier,supplierName:X.supplierName,date:X.date,price:X.price,quotationFile:ye?ye.path:null,quotationFileURL:ye?ye.url:null,quotationFileName:ye?ye.originalName:null,quotationFileSize:ye?ye.size:null,quotationFileType:ye?ye.type:null,createdAt:new Date};console.log("Adding new price quote:",Le),de(Nt=>{const yt=[...Nt,Le];return console.log("Updated price quotes:",yt),setTimeout(()=>{D(yt)},100),yt})}l.priceQuotes&&c(Le=>({...Le,priceQuotes:""})),oe(),$&&te&&setTimeout(async()=>{try{console.log("Auto-saving local product after price quote change..."),de(Le=>{const Nt={...ne,priceQuotes:Le};return vr.updateLocalProduct(te,Nt).then(()=>{console.log("Auto-save successful")}).catch(yt=>{console.error("Auto-save failed:",yt),_("فشل في الحفظ التلقائي","خطأ في الحفظ")}),Le})}catch(Le){console.error("Auto-save setup error:",Le)}},200)}catch(ye){console.error("Error uploading file:",ye),c(Le=>({...Le,fileUpload:ye.message||"فشل في رفع الملف. حاول مرة أخرى."}))}finally{m(!1)}},ns=C=>{console.log("Starting edit for quote:",C),B(C.id),pe({supplierType:C.supplierType||"local",supplier:C.supplier||"",supplierName:C.supplierName||"",date:C.date||"",price:C.price||"",quotationFile:C.quotationFile||null}),N(!0)},mn=C=>{if(console.log("Price quote delete button clicked:",C),console.log("Quote ID:",C?.id),console.log("Quote keys:",C?Object.keys(C):"quote is null/undefined"),!C||!C.id){console.error("Invalid quote object - missing quote or ID:",{quote:C,hasId:!!C?.id,quoteId:C?.id,quoteType:typeof C}),_("خطأ في بيانات عرض السعر","خطأ");return}E(`هل أنت متأكد من حذف عرض السعر؟

${C.supplierName} - ${C.price} ريال`,()=>Kt(C),"تأكيد حذف عرض السعر")},Kt=async C=>{if(console.log("Delete confirmation called for quote:",C),console.log("Confirmation - Quote ID:",C?.id),console.log("Confirmation - Quote keys:",C?Object.keys(C):"quote is null/undefined"),console.log("Is editing mode:",$),console.log("Local product ID:",te),console.log("Form data name:",s.name),!C||!C.id){console.error("Invalid quote in confirmation - missing quote or ID:",{quote:C,hasId:!!C?.id,quoteId:C?.id,quoteType:typeof C}),_("خطأ في بيانات عرض السعر","خطأ"),V(!1);return}try{if(V(!0),console.log("Starting delete process..."),console.log("Moving to trash..."),$&&te){const ue={...C,localProductId:te,localProductName:s.name};console.log("Quote with context for trash:",ue),console.log("Calling SimpleTrashService.moveToTrash...");const ce=await qn.moveToTrash(ue,"price_quotes");console.log("Trash service result:",ce),console.log("Moved to trash successfully")}else console.log("Skipping trash - local product not saved yet (isEditing:",$,", id:",te,")");const ne=me();console.log("Logging activity with current user:",ne),Q("task",`${ne.name} حذف عرض سعر`,`تم حذف عرض السعر: ${C.supplierName} - ${C.price} ريال`),console.log("Updating local state..."),console.log("Current price quotes before deletion:",L),de(ue=>{const ce=ue.filter(ye=>ye.id!==C.id);return console.log("Filtered quotes:",ce.length,"from",ue.length),console.log("Removed quote with ID:",C.id),console.log("Remaining quotes:",ce.map(ye=>({id:ye.id,supplierName:ye.supplierName}))),setTimeout(()=>{D(ce)},100),ce}),console.log("Showing success message..."),$&&te?re(`تم نقل عرض السعر للمهملات: ${C.supplierName}`,"تم النقل للمهملات"):re(`تم حذف عرض السعر: ${C.supplierName}`,"تم الحذف"),console.log("Delete process completed successfully"),$&&te&&setTimeout(async()=>{try{console.log("Auto-saving local product after price quote deletion..."),de(ue=>{const ce={...s,priceQuotes:ue};return vr.updateLocalProduct(te,ce).then(()=>{console.log("Auto-save after deletion successful")}).catch(ye=>{console.error("Auto-save after deletion failed:",ye)}),ue})}catch(ue){console.error("Auto-save after deletion setup error:",ue)}},200)}catch(ne){console.error("Error deleting price quote:",ne),console.error("Error stack:",ne.stack),_(`فشل في حذف عرض السعر: ${ne.message||"خطأ غير معروف"}`,"خطأ في الحذف")}finally{console.log("Setting deleting to false"),V(!1)}},En=()=>k.filter(ue=>{const ce=ue.hasOwnProperty("active"),ye=ue.hasOwnProperty("status");return ce?ue.active===!0:ye?ue.status==="active":!0});return p?n.jsx(Mn,{show:!0,message:"جار تحميل بيانات المنتج المحلي..."}):n.jsxs(hn,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Xn,{onToggle:I}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsxs("div",{style:{position:"sticky",top:0,zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item",children:n.jsx("a",{href:"/local-products",className:"text-decoration-none text-primary",children:"بنود المناقصات"})}),n.jsx("li",{className:"breadcrumb-item",children:n.jsx("a",{href:"/local-products",className:"text-decoration-none text-primary",children:"منتج محلي"})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:$?"تعديل منتج محلي":"إضافة منتج محلي جديد"})]})}),n.jsx(Jn,{})]}),n.jsxs("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:[n.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"60px"},children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsxs("div",{className:"card-header bg-white border-bottom py-4 d-flex align-items-center",children:[n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),$?"تعديل المنتج المحلي":"إضافة منتج محلي جديد"]}),n.jsx("div",{style:{flex:1}}),n.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:rn,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:"1",paddingTop:"2px"},children:"عرض سعر"})]}),n.jsxs("form",{onSubmit:mt,children:[n.jsxs("div",{className:"card-body p-4",children:[l.submit&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.submit]}),n.jsxs("div",{className:"row mb-4",children:[n.jsx("div",{className:"col-12",children:n.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[n.jsx("i",{className:"bi bi-info-circle me-2"}),"المعلومات الأساسية"]})}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"اسم المنتج المحلي *"}),n.jsx("input",{type:"text",className:`form-control ${l.name?"is-invalid":""}`,name:"name",value:s.name,onChange:nt,placeholder:"أدخل اسم المنتج المحلي"}),l.name&&n.jsx("div",{className:"invalid-feedback",children:l.name})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الفئة *"}),n.jsx(Bx,{name:"category",value:s.category,onChange:nt,required:!0,className:`form-select ${l.category?"is-invalid":""}`,placeholder:"اختر الفئة",showDescription:!0}),l.category&&n.jsx("div",{className:"invalid-feedback",children:l.category})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الوحدة *"}),n.jsx(qx,{name:"unit",value:s.unit,onChange:nt,required:!0,className:`form-select ${l.unit?"is-invalid":""}`,placeholder:"اختر الوحدة",showDescription:!0}),l.unit&&n.jsx("div",{className:"invalid-feedback",children:l.unit})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsxs("label",{className:"form-label fw-bold",children:["السعر (ريال) *",n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:L.length>0?"أقل سعر تلقائي":"سعر تلقائي"})]}),n.jsx("input",{type:"number",step:"0.01",min:"0",className:`form-control ${l.price?"is-invalid":""}`,name:"price",value:s.price,onChange:null,onKeyPress:null,placeholder:"0.00",readOnly:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"}}),l.price&&n.jsx("div",{className:"invalid-feedback",children:l.price}),n.jsx("div",{className:"mt-1",children:n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),L.length>0?"السعر محدد تلقائياً من أقل عرض سعر في القائمة":"السعر سيتم تحديده تلقائياً عند إضافة عروض الأسعار"]})})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الوصف"}),n.jsx("textarea",{className:"form-control",name:"description",value:s.description,onChange:nt,rows:"3",placeholder:"وصف المنتج المحلي"})]}),n.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:n.jsxs("div",{className:"d-flex align-items-center gap-2",children:[n.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"نشط":"غير نشط"}),n.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"localProductActiveSwitch",name:"active",checked:s.active,onChange:nt,style:{width:"48px",height:"24px",marginRight:"8px"}})]})})]}),n.jsxs("div",{className:"row mb-4",children:[n.jsxs("div",{className:"col-12",children:[n.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[n.jsx("i",{className:"bi bi-receipt me-2"}),"عروض الأسعار"]}),l.priceQuotes&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.priceQuotes]})]}),L.length>0&&n.jsx("div",{className:"col-12",children:n.jsxs("div",{className:"card mb-3 border-0 shadow-lg",style:{background:"linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%)",borderRadius:"16px"},children:[n.jsx("div",{className:"card-header border-0",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"16px 16px 0 0",padding:"20px"},children:n.jsxs("h5",{className:"card-title text-white mb-0 d-flex align-items-center",children:[n.jsx("div",{className:"me-3",style:{background:"rgba(255,255,255,0.2)",borderRadius:"12px",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsx("i",{className:"bi bi-bar-chart-fill fs-5"})}),n.jsx("span",{className:"fw-bold",children:"مقارنة أسعار الموردين"}),n.jsxs("span",{className:"badge bg-light text-primary ms-3",style:{borderRadius:"20px",fontSize:"12px",padding:"6px 12px"},children:[L.length," موردين"]})]})}),n.jsx("div",{className:"card-body",style:{padding:"30px"},children:n.jsx("div",{style:{minHeight:"625px",direction:"ltr"},children:n.jsx("div",{style:{width:"100%",height:"605px",position:"relative"},children:(()=>{L.map(Le=>parseFloat(Le.price)||0);const C=640,ce=L.length*150,ye=Math.max(C,ce);return n.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${ye+160} 605`,style:{direction:"ltr"},children:[n.jsxs("defs",{children:[n.jsxs("linearGradient",{id:"chartBgLocal",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#ffffff",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#f8f9ff",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"bestPriceGradientLocal",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#00f5a0",stopOpacity:1}}),n.jsx("stop",{offset:"30%",style:{stopColor:"#00d9f5",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#0066cc",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"regularPriceGradientLocal",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),n.jsx("stop",{offset:"50%",style:{stopColor:"#764ba2",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#f093fb",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient0Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#764ba2",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient1Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#f093fb",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#f5576c",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient2Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#4facfe",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#00f2fe",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient3Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#a8edea",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#fed6e3",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient4Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#ffecd2",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#fcb69f",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient5Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#a18cd1",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#fbc2eb",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient6Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#fad0c4",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#ffd1ff",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient7Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#a1c4fd",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#c2e9fb",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"metallicShineLocal",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),n.jsx("stop",{offset:"45%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),n.jsx("stop",{offset:"50%",style:{stopColor:"rgba(255,255,255,0.8)",stopOpacity:1}}),n.jsx("stop",{offset:"55%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),n.jsx("stop",{offset:"100%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}})]}),n.jsx("filter",{id:"dropShadowLocal",x:"-50%",y:"-50%",width:"200%",height:"200%",children:n.jsx("feDropShadow",{dx:"0",dy:"6",stdDeviation:"8",floodColor:"rgba(0,0,0,0.15)"})}),n.jsxs("filter",{id:"premiumGlowLocal",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{stdDeviation:"5",result:"coloredBlur"}),n.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0 0 0  0 1 1 0 0  0 0 1 0 0  0 0 0 1 0"}),n.jsxs("feMerge",{children:[n.jsx("feMergeNode",{in:"coloredBlur"}),n.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),n.jsxs("filter",{id:"bevelEffectLocal",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2",result:"blur"}),n.jsx("feSpecularLighting",{in:"blur",result:"specOut",surfaceScale:"5",specularConstant:"0.8",specularExponent:"20","lighting-color":"white",children:n.jsx("fePointLight",{x:"-50",y:"-50",z:"200"})}),n.jsx("feComposite",{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut2"}),n.jsx("feComposite",{in:"SourceGraphic",in2:"specOut2",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"})]}),n.jsxs("filter",{id:"pulseGlowLocal",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),n.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0.8 0 0  0 1 1 0 0  0 0 1 0.2 0  0 0 0 1 0"}),n.jsxs("feMerge",{children:[n.jsx("feMergeNode",{in:"coloredBlur"}),n.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),n.jsx("rect",{width:ye+160,height:"605",fill:"url(#chartBgLocal)",rx:"12",style:{filter:"drop-shadow(0 4px 20px rgba(0,0,0,0.1))"}}),n.jsx("g",{transform:"translate(80, 40)",children:(()=>{const Le=L.map($e=>parseFloat($e.price)||0),Nt=Math.max(...Le),yt=Math.min(...Le),$s=Nt-yt||1,_e=300,Xe=640,be=L.length*150,De=Math.max(Xe,be),ve=Math.min(De/L.length*.6,80),ze=De/L.length;return n.jsxs(n.Fragment,{children:[[0,1,2,3,4,5].map($e=>{const we=130+(_e-130)/5*$e,ke=(1-$e/5)*Math.max(...Le);return n.jsxs("g",{children:[n.jsx("line",{x1:"0",y1:we,x2:De,y2:we,stroke:$e===5?"#007bff":"rgba(123, 140, 252, 0.2)",strokeWidth:$e===5?"2":"1",strokeDasharray:$e===5?"0":"5,5"}),n.jsx("text",{x:"-15",y:we+5,textAnchor:"end",fontSize:"12",fill:"#4f46e5",fontWeight:"600",children:Math.round(ke).toLocaleString()})]},$e)}),L.map(($e,Ke)=>{const we=parseFloat($e.price)||0;let et;if($s>0){const pt=_e-130,ls=we/Math.max(...Le);et=Math.max(ls*pt,15)}else et=(_e-130)*.8;const ke=ze*Ke+(ze-ve)/2,Ve=_e-et,Tt=we===yt;let ft;return Tt?ft="bestPriceGradientLocal":ft=`gradient${Ke%8}Local`,n.jsxs("g",{children:[n.jsx("rect",{x:ke+4,y:Ve+8,width:ve,height:et,fill:"rgba(0,0,0,0.05)",rx:"10"}),n.jsx("rect",{x:ke+2,y:Ve+4,width:ve,height:et,fill:"rgba(0,0,0,0.08)",rx:"9"}),n.jsxs("rect",{x:ke,y:Ve,width:ve,height:et,fill:`url(#${ft})`,rx:"10",filter:Tt?"url(#premiumGlowLocal)":"url(#bevelEffectLocal)",style:{transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer"},children:[n.jsx("animate",{attributeName:"height",from:"0",to:et,dur:"2s",begin:`${Ke*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),n.jsx("animate",{attributeName:"y",from:_e,to:Ve,dur:"2s",begin:`${Ke*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),Tt&&n.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;1.05;1",dur:"3s",repeatCount:"indefinite",begin:`${Ke*.3+2}s`})]}),n.jsx("rect",{x:ke+2,y:Ve+2,width:ve-4,height:Math.max(et/2.5,30),fill:"url(#metallicShineLocal)",rx:"8",opacity:"0.6",children:n.jsx("animateTransform",{attributeName:"transform",type:"translate",values:`-${ve};${ve}`,dur:"4s",repeatCount:"indefinite",begin:`${Ke*.5+3}s`})}),n.jsx("rect",{x:ke+3,y:Ve+3,width:Math.max(ve/4,8),height:Math.max(et-6,20),fill:"rgba(255,255,255,0.4)",rx:"6"}),n.jsx("rect",{x:ke+ve-6,y:Ve+6,width:"3",height:Math.max(et-12,15),fill:"rgba(255,255,255,0.2)",rx:"1.5"}),n.jsxs("g",{children:[n.jsx("rect",{x:ke+ve/2-30,y:Ve-28,width:"60",height:"20",fill:"rgba(0,0,0,0.8)",rx:"10",opacity:"0.9"}),n.jsxs("text",{x:ke+ve/2,y:Ve-15,textAnchor:"middle",fontSize:"12",fill:"white",fontWeight:"bold",children:["ر.س ",we.toLocaleString()]})]}),n.jsx("g",{children:(()=>{const pt=$e.supplierName,ls=pt.length*7,Ns=Math.max(ls+20,ve+10);return n.jsxs(n.Fragment,{children:[n.jsx("rect",{x:ke+ve/2-Ns/2,y:_e+30,width:Ns,height:22,fill:"rgba(255,255,255,0.96)",rx:"11",stroke:"rgba(0,123,255,0.5)",strokeWidth:"1.5",filter:"url(#dropShadowLocal)"}),n.jsx("text",{x:ke+ve/2,y:_e+41,textAnchor:"middle",fontSize:"11",fill:"#1e40af",fontWeight:"700",style:{fontFamily:"system-ui, -apple-system, sans-serif",letterSpacing:"0.2px"},dominantBaseline:"middle",children:pt})]})})()}),Tt&&n.jsxs("g",{children:[n.jsx("circle",{cx:ke+ve/2,cy:Ve-100,r:"18",fill:"linear-gradient(135deg, #ffd700 0%, #ffb300 100%)",stroke:"#fff",strokeWidth:"3",filter:"url(#dropShadowLocal)"}),n.jsx("text",{x:ke+ve/2,y:Ve-95,textAnchor:"middle",fontSize:"16",fill:"#fff",children:"👑"}),n.jsx("rect",{x:ke-5,y:Ve-70,width:ve+10,height:"20",fill:"#28a745",rx:"10",opacity:"0.9"}),n.jsx("text",{x:ke+ve/2,y:Ve-57,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:"أفضل سعر"})]})]},$e.id)}),n.jsx("text",{x:De/2,y:30,textAnchor:"middle",fontSize:"16",fill:"url(#bestPriceGradientLocal)",fontWeight:"bold",direction:"rtl",children:"مقارنة الأسعار بالريال السعودي"}),n.jsxs("g",{transform:`translate(${De/2}, ${_e+110})`,children:[n.jsx("rect",{x:"-200",y:"-25",width:"400",height:"145",fill:"rgba(255,255,255,0.98)",rx:"20",stroke:"url(#bestPriceGradientLocal)",strokeWidth:"2",filter:"url(#dropShadowLocal)"}),n.jsx("text",{x:"0",y:"-5",textAnchor:"middle",fontSize:"16",fill:"#1f2937",fontWeight:"800",letterSpacing:"0.5px",children:"مؤشر الأسعار"}),n.jsxs("g",{transform:"translate(0, 15)",children:[n.jsxs("g",{transform:"translate(-125, 0)",children:[n.jsxs("g",{transform:"translate(0, 0)",children:[n.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#bestPriceGradientLocal)",rx:"7",filter:"url(#premiumGlowLocal)"}),n.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#059669",fontWeight:"700",children:"أفضل سعر"}),n.jsx("text",{x:"80",y:"13",fontSize:"18",children:"👑"})]}),n.jsx("line",{x1:"110",y1:"-5",x2:"110",y2:"19",stroke:"rgba(0,0,0,0.15)",strokeWidth:"2"}),n.jsxs("g",{transform:"translate(125, 0)",children:[n.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#regularPriceGradientLocal)",rx:"7"}),n.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#6366f1",fontWeight:"700",children:"أسعار أخرى"}),n.jsx("text",{x:"90",y:"13",fontSize:"16",children:"📊"})]})]}),n.jsxs("g",{transform:"translate(0, 40)",children:[n.jsx("rect",{x:"-170",y:"-8",width:"340",height:"22",fill:"rgba(59, 130, 246, 0.08)",rx:"11"}),n.jsxs("text",{x:"0",y:"5",textAnchor:"middle",fontSize:"14",fill:"#1e40af",fontWeight:"700",children:["💰 الفرق في السعر: ",(Math.max(...Le)-Math.min(...Le)).toLocaleString()," ر.س"]})]}),n.jsx("g",{transform:"translate(0, 90)",children:n.jsxs("text",{x:"0",y:"0",textAnchor:"middle",fontSize:"12",fill:"#6b7280",fontWeight:"600",children:["📈 أعلى سعر: ",Math.max(...Le).toLocaleString()," ر.س  •  📉 أقل سعر: ",Math.min(...Le).toLocaleString()," ر.س"]})})]})]})]})})()})]})})()})})})]})}),n.jsx("div",{className:"col-12",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsx("div",{className:"d-flex justify-content-between align-items-center",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-list-ul text-primary me-2"}),"قائمة عروض الأسعار (",L.length,")"]})})}),n.jsx("div",{className:"card-body p-0",children:L.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-receipt fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد عروض أسعار"}),n.jsx("p",{className:"text-muted",children:"لم يتم إضافة أي عروض أسعار بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"المورد"}),n.jsx("th",{className:"text-center",children:"النوع"}),n.jsx("th",{className:"text-center",children:"التاريخ"}),n.jsx("th",{className:"text-center",children:"السعر (ريال)"}),n.jsx("th",{className:"text-center",children:"الملف"}),n.jsx("th",{className:"text-center",style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:L.map((C,ne)=>{const ue=L.length>=1&&L.reduce((ce,ye)=>{const Le=parseFloat(ce.price)||0;return(parseFloat(ye.price)||0)<Le?ye:ce}).id===C.id;return n.jsxs("tr",{className:ue?"table-success":"",children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:ne+1})}),n.jsxs("td",{className:"text-center",children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},onClick:ce=>{ce.preventDefault(),ce.stopPropagation(),console.log("Button clicked, calling handleSupplierEdit..."),lt(C.supplierName)},title:`تحرير مورد: ${C.supplierName}`,type:"button",children:C.supplierName}),ue&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:`badge ${C.supplierType==="local"?"bg-success":"bg-info"}`,children:C.supplierType==="local"?"محلي":"أجنبي"})}),n.jsx("td",{className:"text-center",children:C.date}),n.jsxs("td",{className:"text-center",children:[C.price," ريال",ue&&n.jsx("i",{className:"bi bi-arrow-down-circle-fill text-success ms-2",title:"أقل سعر"})]}),n.jsx("td",{className:"text-center",children:C.quotationFile&&n.jsx($x,{size:25,clickable:!0,onClick:()=>{C.quotationFileURL?window.open(C.quotationFileURL,"_blank"):(console.log("No file URL available for:",C.quotationFile),alert("الملف غير متوفر للعرض"))},title:`عرض الملف: ${C.quotationFileName||C.quotationFile}`})}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>ns(C),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>mn(C),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},C.id)})})]})})})]})})]})]}),n.jsx("div",{className:"card-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsxs("div",{className:"d-flex gap-3",style:{marginBottom:"15px"},children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:It,disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?"جار الحفظ...":n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),$?"تحديث":"حفظ"]})})]})})]})]})}),n.jsx("div",{className:"app-footer",style:{textAlign:"center",padding:"20px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",marginTop:"20px"},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]})]}),!r&&t&&n.jsx(Zn,{rtl:!0}),!r&&t&&n.jsx(es,{}),w&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:n.jsx("div",{className:"modal-dialog modal-lg",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0 pb-2",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-receipt text-primary me-2"}),"طلب عرض سعر"]}),n.jsx("button",{type:"button",className:"btn-close",onClick:oe,style:{fontSize:"12px"}})]}),n.jsxs("form",{onSubmit:ts,onReset:C=>C.preventDefault(),children:[n.jsxs("div",{className:"modal-body px-4",children:[l.fileUpload&&n.jsxs("div",{className:"alert alert-danger mb-3",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.fileUpload]}),n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"نوع المورد *"}),n.jsx("select",{className:"form-select",name:"supplierType",value:"local",onChange:Xt,required:!0,disabled:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"},children:n.jsx("option",{value:"local",children:"مورد محلي"})})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"المورد *"}),n.jsxs("div",{className:"form-control d-flex align-items-center justify-content-between",onClick:Ue,style:{cursor:"pointer",backgroundColor:"#f8f9fa"},children:[n.jsx("span",{className:X.supplierName?"text-dark":"text-muted",children:X.supplierName||"اختر المورد"}),n.jsx("i",{className:"bi bi-chevron-down"})]})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"تاريخ العرض *"}),n.jsx("input",{type:"date",className:"form-control",name:"date",value:X.date,onChange:Xt,required:!0})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"السعر (ريال) *"}),n.jsx("input",{type:"number",step:"0.01",min:"0",className:"form-control",name:"price",value:X.price,onChange:Xt,onKeyPress:C=>{(C.key==="-"||C.key!=="."&&C.key!=="Backspace"&&(C.key<"0"||C.key>"9"))&&C.preventDefault()},placeholder:"0.00",required:!0})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsxs("label",{className:"form-label fw-bold",children:["رفع عرض السعر ",H?"(اختياري)":"*"]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.jpg,.png,.jpeg",style:{display:"none"},ref:C=>{C&&(C.onclick=()=>{C.value=""},C.onchange=ne=>{const ue=ne.target.files?.[0];ue&&Vt(ue)})},id:`fileInput_${w}_${Date.now()}`}),n.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>{const C=document.querySelector(`#fileInput_${w}_${Date.now()}`);if(C)C.click();else{const ne=document.createElement("input");ne.type="file",ne.accept=".pdf,.doc,.docx,.jpg,.png,.jpeg",ne.style.display="none",ne.onchange=ue=>{const ce=ue.target.files?.[0];ce&&Vt(ce),document.body.removeChild(ne)},document.body.appendChild(ne),ne.click()}},style:{borderRadius:"6px",height:"38px",minWidth:"150px"},children:[n.jsx("i",{className:"bi bi-upload me-2"}),"اختر ملف"]})]}),X.quotationFile&&n.jsxs("div",{className:"alert alert-success py-2 mb-2",style:{position:"relative"},children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-check-circle me-2 text-success"}),n.jsxs("div",{className:"flex-grow-1",children:[n.jsx("strong",{children:X.quotationFile.name?X.supplierName?`عرض سعر ${X.supplierName}.${X.quotationFile.name.split(".").pop()}`:X.quotationFile.name:H?X.supplierName?`عرض سعر ${X.supplierName}.pdf`:L.find(C=>C.id===H)?.quotationFileName||"ملف موجود":"ملف موجود"}),n.jsxs("small",{className:"text-muted ms-2",children:["(",X.quotationFile.size?Math.round(X.quotationFile.size/1024):H?Math.round((L.find(C=>C.id===H)?.quotationFileSize||0)/1024):0," KB)"]})]})]}),n.jsx("button",{type:"button",className:"btn-close btn-close-sm",onClick:()=>{pe(C=>({...C,quotationFile:null}))},title:"إزالة الملف",style:{position:"absolute",top:"8px",left:"8px",width:"20px",height:"20px",fontSize:"10px",opacity:.7},onMouseEnter:C=>C.target.style.opacity=1,onMouseLeave:C=>C.target.style.opacity=.7})]}),H&&!X.quotationFile&&n.jsxs("div",{className:"alert alert-info py-2 mb-2",children:[n.jsx("i",{className:"bi bi-info-circle me-2"}),n.jsxs("small",{children:["ملف موجود: ",L.find(C=>C.id===H)?.quotationFileName||"ملف موجود"]})]}),!X.quotationFile&&!H&&n.jsx("div",{className:"mt-1",children:n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),"يجب اختيار ملف PDF أو Word أو صورة"]})})]})]})]}),n.jsx("div",{className:"modal-footer border-0 pt-0 d-flex justify-content-center",style:{marginBottom:"10px"},children:n.jsxs("div",{className:"d-flex gap-3",children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:oe,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"10px",height:"10px"}}),"رفع..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),"إرسال"]})})]})})]})]})})}),R&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:n.jsx("div",{className:"modal-dialog modal-xl",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0 pb-2",style:{marginBottom:"5px"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-people-fill text-primary me-2"}),"اختر مورد محلي",n.jsxs("span",{className:"text-muted ms-2",children:["(",En().length,")"]})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:Je,style:{fontSize:"12px"}})]}),n.jsx("div",{className:"modal-body p-0",children:En().length>0?n.jsx("div",{className:"table-responsive suppliers-table",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"50px"}}),n.jsx("th",{children:"اسم المورد"}),n.jsx("th",{children:"البريد الإلكتروني"}),n.jsx("th",{children:"الهاتف"}),n.jsx("th",{children:"المدينة"})]})}),n.jsx("tbody",{children:En().map(C=>n.jsxs("tr",{onClick:()=>Ht(C),style:{cursor:"pointer"},children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input custom-radio",type:"radio",name:"selectedSupplier",checked:G?.id===C.id,onChange:()=>{},style:{pointerEvents:"none",width:"18px",height:"18px",borderWidth:"2px",borderColor:G?.id===C.id?"#007bff":"#dee2e6"}})})}),n.jsx("td",{children:n.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},children:C.name})}),n.jsx("td",{children:n.jsx("a",{href:`mailto:${C.email}`,className:"text-decoration-none",children:C.email})}),n.jsx("td",{children:C.phone}),n.jsx("td",{children:C.city||"-"})]},C.id))})]})}):n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-people fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد موردين"}),n.jsx("p",{className:"text-muted",children:"لا توجد موردين محليين مسجلين"})]})}),n.jsx("div",{className:"modal-footer border-0 d-flex justify-content-center",style:{marginTop:"15px"},children:n.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:Ze,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",margin:"20px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:"تأكيد"})})]})})}),T&&Z&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:C=>{C.target===C.currentTarget&&Dt()},children:n.jsx("div",{className:"modal-dialog modal-lg",onClick:C=>C.stopPropagation(),children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"معلومات المورد - ",Z?.name,n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:"محلي"})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:Dt})]}),n.jsx("div",{className:"modal-body",children:n.jsxs("div",{className:"row g-3",children:[n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"اسم المورد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z?.name})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البريد الإلكتروني"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z?.email||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الهاتف"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:Z?.phone||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"المدينة"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z?.city||""})]}),n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"العنوان"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z?.address||""})]}),Z?.taxNumber&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"الرقم الضريبي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z.taxNumber})]}),Z?.bankAccount&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الحساب البنكي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z.bankAccount})]}),Z?.notes&&n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"ملاحظات"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z.notes})]})]})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsx("div",{className:"d-flex gap-3",children:n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:Dt,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إغلاق"})})})]})})})]}),n.jsx(Mn,{show:u,message:$?"جار تحديث المنتج المحلي...":"جار حفظ المنتج المحلي..."}),n.jsx(Tn,{show:se.show,onClose:fe,title:se.title,message:se.message,type:se.type,onConfirm:se.onConfirm,confirmText:se.confirmText,cancelText:se.cancelText,showCancel:se.showCancel}),n.jsx(Hx,{position:"bottom-right",showDetails:!0})]})}function $E(){return n.jsx(un,{children:n.jsx(q4,{})})}const H4=({refreshTrigger:r})=>{const[e,t]=j.useState([]),[s,a]=j.useState(!0),[l,c]=j.useState(null),[u,m]=j.useState(""),[p,b]=j.useState([]),[w,N]=j.useState(!1),[R,O]=j.useState(!1),[G,U]=j.useState(!1),[T,ee]=j.useState(null),[Z,ie]=j.useState([]),[X,pe]=j.useState([]),H=os(),{logActivity:B,getCurrentUser:k}=_n(),{alertConfig:W,closeAlert:J,showSuccess:z,showError:L,showConfirm:de}=Cn(),{currentPage:Pe,totalPages:V,paginatedItems:se,handlePageChange:fe,resetPage:re,totalItems:_,itemsPerPage:E}=wa(p,30);j.useEffect(()=>{D(),F()},[]),j.useEffect(()=>{r&&D()},[r]),j.useEffect(()=>{if(u.trim()){const I=e.filter(le=>le.name?.toLowerCase().includes(u.toLowerCase())||le.category?.toLowerCase().includes(u.toLowerCase())||le.description?.toLowerCase().includes(u.toLowerCase())||le.supplier?.toLowerCase().includes(u.toLowerCase()));b(I)}else b(e);re()},[u,e,re]);const D=async()=>{try{a(!0);const I=await Nr.getAllForeignProducts();t(I),c(null)}catch(I){c(I.message)}finally{a(!1)}},F=async()=>{try{const[I,le]=await Promise.all([Ji.getAllSuppliers(),Zi.getAllSuppliers()]);ie(I),pe(le)}catch(I){console.error("Error loading suppliers:",I)}},te=async(I,le)=>{try{if(le==="local"){const We=Z.find(nt=>nt.name===I);We&&(ee(We),O(!0))}else if(le==="foreign"){const We=X.find(nt=>nt.name===I);We&&(ee(We),U(!0))}}catch(We){console.error("Error opening supplier modal:",We)}},$=()=>{O(!1),U(!1),ee(null)},Q=I=>{de(`هل أنت متأكد من حذف هذا المنتج المستورد؟

${I.name}`,()=>me(I),"تأكيد حذف المنتج المستورد")},me=async I=>{try{N(!0),await qn.moveToTrash(I,"foreignproducts"),await Nr.deleteForeignProduct(I.id);const le=k();B("task",`${le.name} حذف منتج مستورد`,`تم حذف المنتج المستورد: ${I.name}`),await D(),z(`تم نقل المنتج المستورد للمهملات: ${I.name}`,"تم النقل للمهملات")}catch(le){c(le.message),L(`فشل في نقل المنتج المستورد للمهملات: ${le.message}`,"خطأ في النقل")}finally{N(!1)}};return s?n.jsx(Mn,{show:!0,message:"جار تحميل بيانات المنتجات المستوردة...",overlay:!1}):l?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:l}),n.jsxs("button",{className:"btn btn-primary",onClick:D,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs("div",{className:"card shadow-sm","data-list":"foreign-products",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),"قائمة المنتجات المستوردة (",p.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المنتجات المستوردة...",value:u,onChange:I=>m(I.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),n.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:()=>H("/foreign-products/add"),style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"إضافة منتج مستورد جديد"]})]})})]})}),n.jsxs("div",{className:"card-body p-0",children:[p.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-box-seam fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد منتجات مستوردة"}),n.jsx("p",{className:"text-muted",children:u?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي منتجات مستوردة بعد"}),!u&&n.jsxs("button",{className:"btn btn-primary",onClick:()=>H("/foreign-products/add"),children:[n.jsx("i",{className:"bi bi-plus-lg me-1"}),"إضافة أول منتج مستورد"]})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"اسم المنتج"}),n.jsx("th",{className:"text-center",children:"الفئة"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر"}),n.jsx("th",{className:"text-center",children:"المورد"}),n.jsx("th",{className:"text-center",style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:se.map((I,le)=>{let We=I.price,nt=I.supplier,mt=!1,It=null,rn=null;return I.priceQuotes&&Array.isArray(I.priceQuotes)&&I.priceQuotes.length>0&&(mt=!0,rn=I.priceQuotes.reduce((oe,Ue)=>{const Je=parseFloat(oe.price)||0;return(parseFloat(Ue.price)||0)<Je?Ue:oe}),We=rn.price,nt=rn.supplierName,It=rn.supplierType),n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(Pe-1)*E+le+1})}),n.jsx("td",{className:"text-center",children:n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary product-name-btn",onClick:oe=>{if(oe.preventDefault(),oe.stopPropagation(),console.log("=== FOREIGN PRODUCT BUTTON CLICKED ==="),console.log("Product Name:",I.name),console.log("Product ID:",I.id),I.id){const Ue=`/foreign-products/edit/${I.id}`;console.log("Target URL:",Ue),console.log("🚀 FORCING NAVIGATION TO:",Ue),window.location.href=Ue}else console.error("Product ID is missing:",I),L("معرف المنتج مفقود، لا يمكن التنقل","خطأ في التنقل")},onMouseDown:oe=>oe.preventDefault(),style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0",userSelect:"none",pointerEvents:"auto",zIndex:"1"},title:`انقر للتعديل | Internal ID: ${I.internalId||"Not Set"} | Firebase ID: ${I.id||"Missing"}`,children:I.name})}),n.jsx("td",{className:"text-center",children:I.category||"-"}),n.jsx("td",{className:"text-center",children:I.unit||"-"}),n.jsx("td",{className:"text-center",children:We?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsxs("span",{children:[We," ريال"]}),mt&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}):"-"}),n.jsx("td",{className:"text-center",children:nt?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[mt&&It?n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",onClick:()=>te(nt,It),style:{textDecoration:"none"},title:`فتح تفاصيل ${It==="local"?"المورد المحلي":"المورد الأجنبي"}`,children:nt}):n.jsx("span",{children:nt}),mt&&n.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:"أقل مورد"})]}):"-"}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>H(`/foreign-products/edit/${I.id}`),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>Q(I),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},I.internalId||I.id)})})]})}),p.length>0&&n.jsx(va,{currentPage:Pe,totalPages:V,onPageChange:fe,totalItems:_,itemsPerPage:E})]}),R&&T&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:I=>{I.target===I.currentTarget&&$()},children:n.jsx("div",{className:"modal-dialog modal-lg",onClick:I=>I.stopPropagation(),children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"معلومات المورد - ",T.name,n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:"محلي"})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:$})]}),n.jsx("div",{className:"modal-body",children:n.jsxs("div",{className:"row g-3",children:[n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"اسم المورد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.name})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البريد الإلكتروني"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.email||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الهاتف"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:T.phone||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"المدينة"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.city||""})]}),n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"العنوان"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.address||""})]}),T.taxNumber&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"الرقم الضريبي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.taxNumber})]}),T.bankAccount&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الحساب البنكي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.bankAccount})]}),T.notes&&n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"ملاحظات"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.notes})]})]})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:$,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إغلاق"})})]})})}),G&&T&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:I=>{I.target===I.currentTarget&&$()},children:n.jsx("div",{className:"modal-dialog modal-lg",onClick:I=>I.stopPropagation(),children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"معلومات المورد - ",T.name,n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:"أجنبي"})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:$})]}),n.jsx("div",{className:"modal-body",children:n.jsxs("div",{className:"row g-3",children:[n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"اسم المورد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.name})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البريد الإلكتروني"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.email||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الهاتف"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:T.phone||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البلد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.country||""})]}),n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"العنوان"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.address||""})]}),T.taxNumber&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"الرقم الضريبي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.taxNumber})]}),T.bankAccount&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الحساب البنكي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.bankAccount})]}),T.notes&&n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"ملاحظات"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:T.notes})]})]})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:$,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إغلاق"})})]})})}),n.jsx(Tn,{show:W.show,onClose:J,title:W.title,message:W.message,type:W.type,onConfirm:W.onConfirm,confirmText:W.confirmText,cancelText:W.cancelText,showCancel:W.showCancel})]})};function G4(){const[r,e]=j.useState(!1),[t,s]=j.useState(0),{isTimelineVisible:a}=Hn(),l=()=>{e(!r)};return n.jsx(un,{children:n.jsx(hn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Xn,{onToggle:l}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!a?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المناقصات"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"منتج مستورد"})]})}),n.jsx(Jn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"foreign-products-table",children:n.jsx(H4,{refreshTrigger:t})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&a&&n.jsx(Zn,{rtl:!0}),!r&&a&&n.jsx(es,{})]})})})}function Q4(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(G4,{})})})}function W4(){const[r,e]=j.useState(!1),{isTimelineVisible:t}=Hn(),[s,a]=j.useState({name:"",category:"",description:"",unit:"",price:"",supplier:"",stockQuantity:"",minimumStock:"",importLicense:"",customsCode:"",origin:"",notes:"",active:!0}),[l,c]=j.useState({}),[u,m]=j.useState(!1),[p,b]=j.useState(!1),[w,N]=j.useState(!1),[R,O]=j.useState(!1),[G,U]=j.useState(null),[T,ee]=j.useState(!1),[Z,ie]=j.useState(null),[X,pe]=j.useState({supplierType:"foreign",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),[H,B]=j.useState(null),[k,W]=j.useState([]),[J,z]=j.useState([]),[L,de]=j.useState([]),[Pe,V]=j.useState(!1),{alertConfig:se,closeAlert:fe,showSuccess:re,showError:_,showConfirm:E}=Cn(),D=C=>{if(C.length===0)return;const ne=C.reduce((ue,ce)=>{const ye=parseFloat(ue.price)||0;return(parseFloat(ce.price)||0)<ye?ce:ue});console.log("Lowest price quote found:",ne),a(ue=>({...ue,price:ne.price,supplier:ne.supplierName}))},F=os(),{id:te}=ea(),$=!!te,{logActivity:Q,getCurrentUser:me}=_n(),I=()=>{e(!r)};j.useEffect(()=>{$&&We(),le();const C=()=>{$&&te&&(console.log("Window focused - refreshing foreign product data..."),We())};return window.addEventListener("focus",C),()=>{window.removeEventListener("focus",C)}},[te]),j.useEffect(()=>{console.log("PriceQuoteData changed:",{hasFile:!!X.quotationFile,fileName:X.quotationFile?.name,supplierName:X.supplierName,price:X.price})},[X]);const le=async()=>{try{const[C,ne]=await Promise.all([Ji.getAllSuppliers(),Zi.getAllSuppliers()]);W(C),z(ne)}catch(C){console.error("Error loading suppliers:",C)}},We=async()=>{try{b(!0),console.log("Loading foreign product data for ID:",te);const C=await Nr.getAllForeignProducts(),ne=C.find(ue=>ue.id===te);ne?(console.log("Foreign product found:",ne.name),a({name:ne.name||"",category:ne.category||"",description:ne.description||"",unit:ne.unit||"",price:ne.price||"",supplier:ne.supplier||"",stockQuantity:ne.stockQuantity||"",minimumStock:ne.minimumStock||"",importLicense:ne.importLicense||"",customsCode:ne.customsCode||"",origin:ne.origin||"",notes:ne.notes||"",active:ne.active!==void 0?ne.active:!0}),ne.priceQuotes&&Array.isArray(ne.priceQuotes)?(console.log("Loading price quotes for foreign product:",ne.name,ne.priceQuotes),console.log("Price quotes analysis:"),ne.priceQuotes.forEach((ue,ce)=>{console.log(`Quote ${ce}:`,{id:ue.id,supplierName:ue.supplierName,price:ue.price,hasId:!!ue.id,keys:Object.keys(ue)})}),de(ne.priceQuotes),setTimeout(()=>{D(ne.priceQuotes)},200)):console.log("No price quotes found for foreign product:",ne.name)):(console.error("Foreign product not found with ID:",te),console.log("Available foreign products:",C.map(ue=>({id:ue.id,name:ue.name}))),c({submit:"المنتج المستورد غير موجود أو تم حذفه"}))}catch(C){console.error("Error loading foreign product:",C),c({submit:"فشل في تحميل بيانات المنتج المستورد: "+C.message})}finally{b(!1)}},nt=C=>{const{name:ne,value:ue,type:ce,checked:ye}=C.target;a(Le=>({...Le,[ne]:ce==="checkbox"?ye:ue})),l[ne]&&c(Le=>({...Le,[ne]:""}))},mt=async C=>{C.preventDefault();const ne=Nr.validateForeignProductData(s);if(L.length===0&&(ne.priceQuotes="يجب إضافة عرض سعر واحد على الأقل"),Object.keys(ne).length>0){c(ne);return}m(!0),c({});try{const ue=await oo.validateUniqueFields({name:s.name},$?te:null,$?"foreignproducts":null);if(Object.keys(ue).length>0){c(ue),m(!1);return}const ce={...s,price:parseFloat(s.price)||0,stockQuantity:parseFloat(s.stockQuantity)||0,minimumStock:parseFloat(s.minimumStock)||0,priceQuotes:L,status:"active"};if(console.log("Saving foreign product with price quotes:",{name:ce.name,priceQuotes:ce.priceQuotes,priceQuotesCount:ce.priceQuotes.length}),$){await Nr.updateForeignProduct(te,ce);const ye=me();Q("task",`${ye.name} عدل منتج مستورد`,`تم تعديل المنتج المستورد: ${ce.name}`)}else{await Nr.addForeignProduct(ce);const ye=me();Q("task",`${ye.name} أضاف منتج مستورد`,`تم إضافة المنتج المستورد: ${ce.name}`)}F("/foreign-products")}catch(ue){c({submit:ue.message})}finally{m(!1)}},It=()=>{F("/foreign-products")},rn=()=>{N(!0)},oe=()=>{N(!1),B(null),pe({supplierType:"foreign",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),c(C=>({...C,fileUpload:""})),console.log("Modal closed and state reset")},Ue=()=>{O(!0)},Je=()=>{O(!1),U(null)},lt=C=>{console.log("Supplier Name:",C);try{console.log("Using already loaded foreign supplier data...");const ne=J;console.log("Available foreign suppliers:",ne.length),console.log("Foreign suppliers list:",ne.map(ce=>({id:ce.id,name:ce.name})));const ue=ne.find(ce=>ce.name===C);console.log("Found supplier:",ue?"YES":"NO"),ue?(console.log("SUCCESS: Foreign supplier found:",ue.name),console.log("Supplier data:",ue),ie(ue),ee(!0),console.log("Modal state should be true now"),setTimeout(()=>{console.log("Modal state check - showSupplierEditModal:",T),console.log("Modal state check - selectedSupplierToEdit:",Z?.name)},100)):(console.error("FOREIGN SUPPLIER NOT FOUND"),console.error("Looking for supplier name:",C),console.error("Available suppliers:",ne.map(ce=>ce.name)),ne.length===0?(console.log("No suppliers loaded, triggering data reload..."),loadSuppliersData(),_("لا توجد بيانات موردين أجانب. جار إعادة التحميل...","لا توجد بيانات")):_(`لم يتم العثور على المورد الأجنبي: ${C}`,"مورد غير موجود"))}catch(ne){console.error("=== FOREIGN SUPPLIER SEARCH ERROR ==="),console.error("Error details:",ne),console.error("Error message:",ne.message),_(`خطأ في البحث عن المورد الأجنبي: ${ne.message}`,"خطأ في البحث")}},Dt=()=>{console.log("Called by:",new Error().stack),ee(!1),ie(null)},Ht=C=>{U(C)},Ze=()=>{G&&pe(C=>{console.log("Before supplier selection - preserving file:",C.quotationFile?.name);const ne={...C,supplier:G.id,supplierName:G.name};return console.log("After supplier selection - file preserved:",ne.quotationFile?.name),ne}),O(!1),U(null)},Vt=C=>{console.log("File details:",{name:C?.name,size:C?.size,type:C?.type,lastModified:C?.lastModified}),l.fileUpload&&c(ne=>({...ne,fileUpload:""})),pe(ne=>{const ue={...ne,quotationFile:C};return console.log("Updated priceQuoteData with file:",{hasFile:!!ue.quotationFile,fileName:ue.quotationFile?.name}),ue})},Xt=C=>{const{name:ne,value:ue,type:ce}=C.target;ce!=="file"&&pe(ne==="supplierType"?ye=>({...ye,[ne]:ue,supplier:"",supplierName:""}):ye=>({...ye,[ne]:ue}))},ts=async C=>{if(C.preventDefault(),console.log("Form element:",C.target),console.log("Current priceQuoteData:",X),console.log("Editing quote ID:",H),!X.supplierName){c(ye=>({...ye,fileUpload:"يجب اختيار المورد أولاً"}));return}if(!X.date){c(ye=>({...ye,fileUpload:"يجب إدخال تاريخ العرض"}));return}if(!X.price){c(ye=>({...ye,fileUpload:"يجب إدخال السعر"}));return}const ne=new FormData(C.target),ue=ne.get("quotationFile");console.log("File from form directly:",ue),console.log("File from state:",X.quotationFile);const ce=X.quotationFile||ue;console.log("File to upload:",ce),console.log("File upload details:",{exists:!!ce,isFile:ce instanceof File,name:ce?.name,size:ce?.size,type:ce?.type,lastModified:ce?.lastModified});try{if(m(!0),!H&&(!ce||ce.size===0))throw new Error("يجب اختيار ملف عرض السعر");let ye=null;if(console.log("File upload analysis:",{hasFileInState:!!X.quotationFile,hasFileInForm:!!ue,hasFileToUpload:!!ce,fileType:typeof ce,fileName:ce?.name,fileSize:ce?.size}),ce&&typeof ce!="string"&&ce.size>0){console.log("Starting file upload:",ce.name);try{_r.validateFile(ce,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}),console.log("File validation passed")}catch(Le){throw console.error("File validation failed:",Le),new Error(Le.message)}console.log("Attempting file upload to Firebase...");try{const Le=ce.name.split(".").pop()||"pdf",Nt=X.supplierName?`عرض سعر ${X.supplierName}.${Le}`:ce.name;console.log("Uploading with custom name:",Nt),ye=await _r.uploadFileWithCustomName(ce,"quotations",Nt),console.log("File uploaded successfully:",ye)}catch(Le){throw console.error("Firebase upload failed:",Le),new Error(`فشل في رفع الملف: ${Le.message}`)}}else console.log("No valid file to upload:",{fileExists:!!ce,isString:typeof ce=="string",hasSize:ce?.size>0});if(H)console.log("Updating existing price quote with ID:",H),de(Le=>{const Nt=Le.map(yt=>yt.id===H?{...yt,supplierType:X.supplierType,supplier:X.supplier,supplierName:X.supplierName,date:X.date,price:X.price,quotationFile:ye?ye.path:yt.quotationFile,quotationFileURL:ye?ye.url:yt.quotationFileURL,quotationFileName:ye?ye.originalName:yt.quotationFileName,quotationFileSize:ye?ye.size:yt.quotationFileSize,quotationFileType:ye?ye.type:yt.quotationFileType,updatedAt:new Date}:yt);return console.log("Updated price quotes:",Nt),setTimeout(()=>{D(Nt)},100),Nt});else{const Le={id:Date.now().toString(),supplierType:X.supplierType,supplier:X.supplier,supplierName:X.supplierName,date:X.date,price:X.price,quotationFile:ye?ye.path:null,quotationFileURL:ye?ye.url:null,quotationFileName:ye?ye.originalName:null,quotationFileSize:ye?ye.size:null,quotationFileType:ye?ye.type:null,createdAt:new Date};console.log("Adding new price quote:",Le),de(Nt=>{const yt=[...Nt,Le];return console.log("Updated price quotes:",yt),setTimeout(()=>{D(yt)},100),yt})}l.priceQuotes&&c(Le=>({...Le,priceQuotes:""})),oe(),$&&te&&setTimeout(async()=>{try{console.log("Auto-saving foreign product after price quote change..."),de(Le=>{const Nt={...ne,priceQuotes:Le};return Nr.updateForeignProduct(te,Nt).then(()=>{console.log("Auto-save successful")}).catch(yt=>{console.error("Auto-save failed:",yt),_("فشل في الحفظ التلقائي","خطأ في الحفظ")}),Le})}catch(Le){console.error("Auto-save setup error:",Le)}},200)}catch(ye){console.error("Error uploading file:",ye),c(Le=>({...Le,fileUpload:ye.message||"فشل في رفع الملف. حاول مرة أخرى."}))}finally{m(!1)}},ns=C=>{console.log("Starting edit for quote:",C),B(C.id),pe({supplierType:C.supplierType||"local",supplier:C.supplier||"",supplierName:C.supplierName||"",date:C.date||"",price:C.price||"",quotationFile:C.quotationFile||null}),N(!0)},mn=C=>{if(console.log("Price quote delete button clicked:",C),console.log("Quote ID:",C?.id),console.log("Quote keys:",C?Object.keys(C):"quote is null/undefined"),!C||!C.id){console.error("Invalid quote object - missing quote or ID:",{quote:C,hasId:!!C?.id,quoteId:C?.id,quoteType:typeof C}),_("خطأ في بيانات عرض السعر","خطأ");return}E(`هل أنت متأكد من حذف عرض السعر؟

${C.supplierName} - ${C.price} ريال`,()=>Kt(C),"تأكيد حذف عرض السعر")},Kt=async C=>{if(console.log("Delete confirmation called for quote:",C),console.log("Confirmation - Quote ID:",C?.id),console.log("Confirmation - Quote keys:",C?Object.keys(C):"quote is null/undefined"),console.log("Is editing mode:",$),console.log("Foreign product ID:",te),console.log("Form data name:",s.name),!C||!C.id){console.error("Invalid quote in confirmation - missing quote or ID:",{quote:C,hasId:!!C?.id,quoteId:C?.id,quoteType:typeof C}),_("خطأ في بيانات عرض السعر","خطأ"),V(!1);return}try{if(V(!0),console.log("Starting delete process..."),console.log("Moving to trash..."),$&&te){const ue={...C,foreignProductId:te,foreignProductName:s.name};console.log("Quote with context for trash:",ue),console.log("Calling SimpleTrashService.moveToTrash...");const ce=await qn.moveToTrash(ue,"price_quotes");console.log("Trash service result:",ce),console.log("Moved to trash successfully")}else console.log("Skipping trash - foreign product not saved yet (isEditing:",$,", id:",te,")");const ne=me();console.log("Logging activity with current user:",ne),Q("task",`${ne.name} حذف عرض سعر`,`تم حذف عرض السعر: ${C.supplierName} - ${C.price} ريال`),console.log("Updating local state..."),console.log("Current price quotes before deletion:",L),de(ue=>{const ce=ue.filter(ye=>ye.id!==C.id);return console.log("Filtered quotes:",ce.length,"from",ue.length),console.log("Removed quote with ID:",C.id),console.log("Remaining quotes:",ce.map(ye=>({id:ye.id,supplierName:ye.supplierName}))),setTimeout(()=>{D(ce)},100),ce}),console.log("Showing success message..."),$&&te?re(`تم نقل عرض السعر للمهملات: ${C.supplierName}`,"تم النقل للمهملات"):re(`تم حذف عرض السعر: ${C.supplierName}`,"تم الحذف"),console.log("Delete process completed successfully"),$&&te&&setTimeout(async()=>{try{console.log("Auto-saving foreign product after price quote deletion..."),de(ue=>{const ce={...s,priceQuotes:ue};return Nr.updateForeignProduct(te,ce).then(()=>{console.log("Auto-save after deletion successful")}).catch(ye=>{console.error("Auto-save after deletion failed:",ye)}),ue})}catch(ue){console.error("Auto-save after deletion setup error:",ue)}},200)}catch(ne){console.error("Error deleting price quote:",ne),console.error("Error stack:",ne.stack),_(`فشل في حذف عرض السعر: ${ne.message||"خطأ غير معروف"}`,"خطأ في الحذف")}finally{console.log("Setting deleting to false"),V(!1)}},En=()=>(X.supplierType==="local"?k:J).filter(ue=>{const ce=ue.hasOwnProperty("active"),ye=ue.hasOwnProperty("status");return ce?ue.active===!0:ye?ue.status==="active":!0});return p?n.jsx(Mn,{show:!0,message:"جار تحميل بيانات المنتج المستورد..."}):n.jsxs(hn,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Xn,{onToggle:I}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsxs("div",{style:{position:"sticky",top:0,zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item",children:n.jsx("a",{href:"/foreign-products",className:"text-decoration-none text-primary",children:"بنود المناقصات"})}),n.jsx("li",{className:"breadcrumb-item",children:n.jsx("a",{href:"/foreign-products",className:"text-decoration-none text-primary",children:"مواد خام"})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:$?"تعديل منتج مستورد":"إضافة منتج مستورد جديد"})]})}),n.jsx(Jn,{})]}),n.jsxs("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:[n.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"60px"},children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsxs("div",{className:"card-header bg-white border-bottom py-4 d-flex align-items-center",children:[n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),$?"تعديل المنتج المستورد":"إضافة منتج مستورد جديد"]}),n.jsx("div",{style:{flex:1}}),n.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:rn,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:"1",paddingTop:"2px"},children:"عرض سعر"})]}),n.jsxs("form",{onSubmit:mt,children:[n.jsxs("div",{className:"card-body p-4",children:[l.submit&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.submit]}),n.jsxs("div",{className:"row mb-4",children:[n.jsx("div",{className:"col-12",children:n.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[n.jsx("i",{className:"bi bi-info-circle me-2"}),"المعلومات الأساسية"]})}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"اسم المنتج المستورد *"}),n.jsx("input",{type:"text",className:`form-control ${l.name?"is-invalid":""}`,name:"name",value:s.name,onChange:nt,placeholder:"أدخل اسم المنتج المستورد"}),l.name&&n.jsx("div",{className:"invalid-feedback",children:l.name})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الفئة *"}),n.jsx(Bx,{name:"category",value:s.category,onChange:nt,required:!0,className:`form-select ${l.category?"is-invalid":""}`,placeholder:"اختر الفئة",showDescription:!0}),l.category&&n.jsx("div",{className:"invalid-feedback",children:l.category})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الوحدة *"}),n.jsx(qx,{name:"unit",value:s.unit,onChange:nt,required:!0,className:`form-select ${l.unit?"is-invalid":""}`,placeholder:"اختر الوحدة",showDescription:!0}),l.unit&&n.jsx("div",{className:"invalid-feedback",children:l.unit})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsxs("label",{className:"form-label fw-bold",children:["السعر (ريال) *",n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:L.length>0?"أقل سعر تلقائي":"سعر تلقائي"})]}),n.jsx("input",{type:"number",step:"0.01",min:"0",className:`form-control ${l.price?"is-invalid":""}`,name:"price",value:s.price,onChange:null,onKeyPress:null,placeholder:"0.00",readOnly:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"}}),l.price&&n.jsx("div",{className:"invalid-feedback",children:l.price}),n.jsx("div",{className:"mt-1",children:n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),L.length>0?"السعر محدد تلقائياً من أقل عرض سعر في القائمة":"السعر سيتم تحديده تلقائياً عند إضافة عروض الأسعار"]})})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الوصف"}),n.jsx("textarea",{className:"form-control",name:"description",value:s.description,onChange:nt,rows:"3",placeholder:"وصف المنتج المستورد"})]}),n.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:n.jsxs("div",{className:"d-flex align-items-center gap-2",children:[n.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"نشط":"غير نشط"}),n.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"foreignProductActiveSwitch",name:"active",checked:s.active,onChange:nt,style:{width:"48px",height:"24px",marginRight:"8px"}})]})})]}),n.jsxs("div",{className:"row mb-4",children:[n.jsxs("div",{className:"col-12",children:[n.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[n.jsx("i",{className:"bi bi-receipt me-2"}),"عروض الأسعار"]}),l.priceQuotes&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.priceQuotes]})]}),L.length>0&&n.jsx("div",{className:"col-12",children:n.jsxs("div",{className:"card mb-3 border-0 shadow-lg",style:{background:"linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%)",borderRadius:"16px"},children:[n.jsx("div",{className:"card-header border-0",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"16px 16px 0 0",padding:"20px"},children:n.jsxs("h5",{className:"card-title text-white mb-0 d-flex align-items-center",children:[n.jsx("div",{className:"me-3",style:{background:"rgba(255,255,255,0.2)",borderRadius:"12px",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsx("i",{className:"bi bi-bar-chart-fill fs-5"})}),n.jsx("span",{className:"fw-bold",children:"مقارنة أسعار الموردين"}),n.jsxs("span",{className:"badge bg-light text-primary ms-3",style:{borderRadius:"20px",fontSize:"12px",padding:"6px 12px"},children:[L.length," موردين"]})]})}),n.jsx("div",{className:"card-body",style:{padding:"30px"},children:n.jsx("div",{style:{minHeight:"625px",direction:"ltr"},children:n.jsx("div",{style:{width:"100%",height:"605px",position:"relative"},children:(()=>{L.map(Le=>parseFloat(Le.price)||0);const C=640,ce=L.length*150,ye=Math.max(C,ce);return n.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${ye+160} 605`,style:{direction:"ltr"},children:[n.jsxs("defs",{children:[n.jsxs("linearGradient",{id:"chartBgForeign",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#ffffff",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#f8f9ff",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"bestPriceGradientForeign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#00f5a0",stopOpacity:1}}),n.jsx("stop",{offset:"30%",style:{stopColor:"#00d9f5",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#0066cc",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"regularPriceGradientForeign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),n.jsx("stop",{offset:"50%",style:{stopColor:"#764ba2",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#f093fb",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient0Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#764ba2",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient1Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#f093fb",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#f5576c",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient2Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#4facfe",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#00f2fe",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient3Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#a8edea",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#fed6e3",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient4Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#ffecd2",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#fcb69f",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient5Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#a18cd1",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#fbc2eb",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient6Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#fad0c4",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#ffd1ff",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient7Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#a1c4fd",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#c2e9fb",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"metallicShineForeign",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),n.jsx("stop",{offset:"45%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),n.jsx("stop",{offset:"50%",style:{stopColor:"rgba(255,255,255,0.8)",stopOpacity:1}}),n.jsx("stop",{offset:"55%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),n.jsx("stop",{offset:"100%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}})]}),n.jsx("filter",{id:"dropShadowForeign",x:"-50%",y:"-50%",width:"200%",height:"200%",children:n.jsx("feDropShadow",{dx:"0",dy:"6",stdDeviation:"8",floodColor:"rgba(0,0,0,0.15)"})}),n.jsxs("filter",{id:"premiumGlowForeign",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{stdDeviation:"5",result:"coloredBlur"}),n.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0 0 0  0 1 1 0 0  0 0 1 0 0  0 0 0 1 0"}),n.jsxs("feMerge",{children:[n.jsx("feMergeNode",{in:"coloredBlur"}),n.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),n.jsxs("filter",{id:"bevelEffectForeign",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2",result:"blur"}),n.jsx("feSpecularLighting",{in:"blur",result:"specOut",surfaceScale:"5",specularConstant:"0.8",specularExponent:"20","lighting-color":"white",children:n.jsx("fePointLight",{x:"-50",y:"-50",z:"200"})}),n.jsx("feComposite",{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut2"}),n.jsx("feComposite",{in:"SourceGraphic",in2:"specOut2",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"})]}),n.jsxs("filter",{id:"pulseGlowForeign",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),n.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0.8 0 0  0 1 1 0 0  0 0 1 0.2 0  0 0 0 1 0"}),n.jsxs("feMerge",{children:[n.jsx("feMergeNode",{in:"coloredBlur"}),n.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),n.jsx("rect",{width:ye+160,height:"605",fill:"url(#chartBgForeign)",rx:"12",style:{filter:"drop-shadow(0 4px 20px rgba(0,0,0,0.1))"}}),n.jsx("g",{transform:"translate(80, 40)",children:(()=>{const Le=L.map($e=>parseFloat($e.price)||0),Nt=Math.max(...Le),yt=Math.min(...Le),$s=Nt-yt||1,_e=300,Xe=640,be=L.length*150,De=Math.max(Xe,be),ve=Math.min(De/L.length*.6,80),ze=De/L.length;return n.jsxs(n.Fragment,{children:[[0,1,2,3,4,5].map($e=>{const we=130+(_e-130)/5*$e,ke=(1-$e/5)*Math.max(...Le);return n.jsxs("g",{children:[n.jsx("line",{x1:"0",y1:we,x2:De,y2:we,stroke:$e===5?"#007bff":"rgba(123, 140, 252, 0.2)",strokeWidth:$e===5?"2":"1",strokeDasharray:$e===5?"0":"5,5"}),n.jsx("text",{x:"-15",y:we+5,textAnchor:"end",fontSize:"12",fill:"#4f46e5",fontWeight:"600",children:Math.round(ke).toLocaleString()})]},$e)}),L.map(($e,Ke)=>{const we=parseFloat($e.price)||0;let et;if($s>0){const pt=_e-130,ls=we/Math.max(...Le);et=Math.max(ls*pt,15)}else et=(_e-130)*.8;const ke=ze*Ke+(ze-ve)/2,Ve=_e-et,Tt=we===yt;let ft;return Tt?ft="bestPriceGradientForeign":ft=`gradient${Ke%8}Foreign`,n.jsxs("g",{children:[n.jsx("rect",{x:ke+4,y:Ve+8,width:ve,height:et,fill:"rgba(0,0,0,0.05)",rx:"10"}),n.jsx("rect",{x:ke+2,y:Ve+4,width:ve,height:et,fill:"rgba(0,0,0,0.08)",rx:"9"}),n.jsxs("rect",{x:ke,y:Ve,width:ve,height:et,fill:`url(#${ft})`,rx:"10",filter:Tt?"url(#premiumGlowForeign)":"url(#bevelEffectForeign)",style:{transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer"},children:[n.jsx("animate",{attributeName:"height",from:"0",to:et,dur:"2s",begin:`${Ke*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),n.jsx("animate",{attributeName:"y",from:_e,to:Ve,dur:"2s",begin:`${Ke*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),Tt&&n.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;1.05;1",dur:"3s",repeatCount:"indefinite",begin:`${Ke*.3+2}s`})]}),n.jsx("rect",{x:ke+2,y:Ve+2,width:ve-4,height:Math.max(et/2.5,30),fill:"url(#metallicShineForeign)",rx:"8",opacity:"0.6",children:n.jsx("animateTransform",{attributeName:"transform",type:"translate",values:`-${ve};${ve}`,dur:"4s",repeatCount:"indefinite",begin:`${Ke*.5+3}s`})}),n.jsx("rect",{x:ke+3,y:Ve+3,width:Math.max(ve/4,8),height:Math.max(et-6,20),fill:"rgba(255,255,255,0.4)",rx:"6"}),n.jsx("rect",{x:ke+ve-6,y:Ve+6,width:"3",height:Math.max(et-12,15),fill:"rgba(255,255,255,0.2)",rx:"1.5"}),n.jsxs("g",{children:[n.jsx("rect",{x:ke+ve/2-30,y:Ve-28,width:"60",height:"20",fill:"rgba(0,0,0,0.8)",rx:"10",opacity:"0.9"}),n.jsxs("text",{x:ke+ve/2,y:Ve-15,textAnchor:"middle",fontSize:"12",fill:"white",fontWeight:"bold",children:["ر.س ",we.toLocaleString()]})]}),n.jsx("g",{children:(()=>{const pt=$e.supplierName,ls=pt.length*7,Ns=Math.max(ls+20,ve+10);return n.jsxs(n.Fragment,{children:[n.jsx("rect",{x:ke+ve/2-Ns/2,y:_e+30,width:Ns,height:22,fill:"rgba(255,255,255,0.96)",rx:"11",stroke:"rgba(0,123,255,0.5)",strokeWidth:"1.5",filter:"url(#dropShadowForeign)"}),n.jsx("text",{x:ke+ve/2,y:_e+41,textAnchor:"middle",fontSize:"11",fill:"#1e40af",fontWeight:"700",style:{fontFamily:"system-ui, -apple-system, sans-serif",letterSpacing:"0.2px"},dominantBaseline:"middle",children:pt})]})})()}),Tt&&n.jsxs("g",{children:[n.jsx("circle",{cx:ke+ve/2,cy:Ve-100,r:"18",fill:"linear-gradient(135deg, #ffd700 0%, #ffb300 100%)",stroke:"#fff",strokeWidth:"3",filter:"url(#dropShadowForeign)"}),n.jsx("text",{x:ke+ve/2,y:Ve-95,textAnchor:"middle",fontSize:"16",fill:"#fff",children:"👑"}),n.jsx("rect",{x:ke-5,y:Ve-70,width:ve+10,height:"20",fill:"#28a745",rx:"10",opacity:"0.9"}),n.jsx("text",{x:ke+ve/2,y:Ve-57,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:"أفضل سعر"})]})]},$e.id)}),n.jsx("text",{x:De/2,y:30,textAnchor:"middle",fontSize:"16",fill:"url(#bestPriceGradientForeign)",fontWeight:"bold",direction:"rtl",children:"مقارنة الأسعار بالريال السعودي"}),n.jsxs("g",{transform:`translate(${De/2}, ${_e+110})`,children:[n.jsx("rect",{x:"-200",y:"-25",width:"400",height:"145",fill:"rgba(255,255,255,0.98)",rx:"20",stroke:"url(#bestPriceGradientForeign)",strokeWidth:"2",filter:"url(#dropShadowForeign)"}),n.jsx("text",{x:"0",y:"-5",textAnchor:"middle",fontSize:"16",fill:"#1f2937",fontWeight:"800",letterSpacing:"0.5px",children:"مؤشر الأسعار"}),n.jsxs("g",{transform:"translate(0, 15)",children:[n.jsxs("g",{transform:"translate(-125, 0)",children:[n.jsxs("g",{transform:"translate(0, 0)",children:[n.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#bestPriceGradientForeign)",rx:"7",filter:"url(#premiumGlowForeign)"}),n.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#059669",fontWeight:"700",children:"أفضل سعر"}),n.jsx("text",{x:"80",y:"13",fontSize:"18",children:"👑"})]}),n.jsx("line",{x1:"110",y1:"-5",x2:"110",y2:"19",stroke:"rgba(0,0,0,0.15)",strokeWidth:"2"}),n.jsxs("g",{transform:"translate(125, 0)",children:[n.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#regularPriceGradientForeign)",rx:"7"}),n.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#6366f1",fontWeight:"700",children:"أسعار أخرى"}),n.jsx("text",{x:"90",y:"13",fontSize:"16",children:"📊"})]})]}),n.jsxs("g",{transform:"translate(0, 40)",children:[n.jsx("rect",{x:"-170",y:"-8",width:"340",height:"22",fill:"rgba(59, 130, 246, 0.08)",rx:"11"}),n.jsxs("text",{x:"0",y:"5",textAnchor:"middle",fontSize:"14",fill:"#1e40af",fontWeight:"700",children:["💰 الفرق في السعر: ",(Math.max(...Le)-Math.min(...Le)).toLocaleString()," ر.س"]})]}),n.jsx("g",{transform:"translate(0, 90)",children:n.jsxs("text",{x:"0",y:"0",textAnchor:"middle",fontSize:"12",fill:"#6b7280",fontWeight:"600",children:["📈 أعلى سعر: ",Math.max(...Le).toLocaleString()," ر.س  •  📉 أقل سعر: ",Math.min(...Le).toLocaleString()," ر.س"]})})]})]})]})})()})]})})()})})})]})}),n.jsx("div",{className:"col-12",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsx("div",{className:"d-flex justify-content-between align-items-center",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-list-ul text-primary me-2"}),"قائمة عروض الأسعار (",L.length,")"]})})}),n.jsx("div",{className:"card-body p-0",children:L.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-receipt fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد عروض أسعار"}),n.jsx("p",{className:"text-muted",children:"لم يتم إضافة أي عروض أسعار بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"المورد"}),n.jsx("th",{className:"text-center",children:"النوع"}),n.jsx("th",{className:"text-center",children:"التاريخ"}),n.jsx("th",{className:"text-center",children:"السعر (ريال)"}),n.jsx("th",{className:"text-center",children:"الملف"}),n.jsx("th",{className:"text-center",style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:L.map((C,ne)=>{const ue=L.length>=1&&L.reduce((ce,ye)=>{const Le=parseFloat(ce.price)||0;return(parseFloat(ye.price)||0)<Le?ye:ce}).id===C.id;return n.jsxs("tr",{className:ue?"table-success":"",children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:ne+1})}),n.jsxs("td",{className:"text-center",children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},onClick:ce=>{ce.preventDefault(),ce.stopPropagation(),console.log("Button clicked, calling handleSupplierEdit..."),lt(C.supplierName)},title:`تحرير مورد: ${C.supplierName}`,type:"button",children:C.supplierName}),ue&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:`badge ${C.supplierType==="local"?"bg-success":"bg-info"}`,children:C.supplierType==="local"?"محلي":"أجنبي"})}),n.jsx("td",{className:"text-center",children:C.date}),n.jsxs("td",{className:"text-center",children:[C.price," ريال",ue&&n.jsx("i",{className:"bi bi-arrow-down-circle-fill text-success ms-2",title:"أقل سعر"})]}),n.jsx("td",{className:"text-center",children:C.quotationFile&&n.jsx($x,{size:25,clickable:!0,onClick:()=>{C.quotationFileURL?window.open(C.quotationFileURL,"_blank"):(console.log("No file URL available for:",C.quotationFile),alert("الملف غير متوفر للعرض"))},title:`عرض الملف: ${C.quotationFileName||C.quotationFile}`})}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>ns(C),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>mn(C),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},C.id)})})]})})})]})})]})]}),n.jsx("div",{className:"card-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsxs("div",{className:"d-flex gap-3",style:{marginBottom:"15px"},children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:It,disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?"جار الحفظ...":n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),$?"تحديث":"حفظ"]})})]})})]})]})}),n.jsx("div",{className:"app-footer",style:{textAlign:"center",padding:"20px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",marginTop:"20px"},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]})]}),!r&&t&&n.jsx(Zn,{rtl:!0}),!r&&t&&n.jsx(es,{}),w&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:n.jsx("div",{className:"modal-dialog modal-lg",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0 pb-2",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-receipt text-primary me-2"}),"طلب عرض سعر"]}),n.jsx("button",{type:"button",className:"btn-close",onClick:oe,style:{fontSize:"12px"}})]}),n.jsxs("form",{onSubmit:ts,onReset:C=>C.preventDefault(),children:[n.jsxs("div",{className:"modal-body px-4",children:[l.fileUpload&&n.jsxs("div",{className:"alert alert-danger mb-3",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.fileUpload]}),n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"نوع المورد *"}),n.jsx("select",{className:"form-select",name:"supplierType",value:X.supplierType,onChange:Xt,required:!0,disabled:!0,children:n.jsx("option",{value:"foreign",children:"مورد أجنبي"})})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"المورد *"}),n.jsxs("div",{className:"form-control d-flex align-items-center justify-content-between",onClick:Ue,style:{cursor:"pointer",backgroundColor:"#f8f9fa"},children:[n.jsx("span",{className:X.supplierName?"text-dark":"text-muted",children:X.supplierName||"اختر المورد"}),n.jsx("i",{className:"bi bi-chevron-down"})]})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"تاريخ العرض *"}),n.jsx("input",{type:"date",className:"form-control",name:"date",value:X.date,onChange:Xt,required:!0})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"السعر (ريال) *"}),n.jsx("input",{type:"number",step:"0.01",min:"0",className:"form-control",name:"price",value:X.price,onChange:Xt,onKeyPress:C=>{(C.key==="-"||C.key!=="."&&C.key!=="Backspace"&&(C.key<"0"||C.key>"9"))&&C.preventDefault()},placeholder:"0.00",required:!0})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsxs("label",{className:"form-label fw-bold",children:["رفع عرض السعر ",H?"(اختياري)":"*"]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.jpg,.png,.jpeg",style:{display:"none"},ref:C=>{C&&(C.onclick=()=>{C.value=""},C.onchange=ne=>{const ue=ne.target.files?.[0];ue&&Vt(ue)})},id:`fileInput_${w}_${Date.now()}`}),n.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>{const C=document.querySelector(`#fileInput_${w}_${Date.now()}`);if(C)C.click();else{const ne=document.createElement("input");ne.type="file",ne.accept=".pdf,.doc,.docx,.jpg,.png,.jpeg",ne.style.display="none",ne.onchange=ue=>{const ce=ue.target.files?.[0];ce&&Vt(ce),document.body.removeChild(ne)},document.body.appendChild(ne),ne.click()}},style:{borderRadius:"6px",height:"38px",minWidth:"150px"},children:[n.jsx("i",{className:"bi bi-upload me-2"}),"اختر ملف"]})]}),X.quotationFile&&n.jsxs("div",{className:"alert alert-success py-2 mb-2",style:{position:"relative"},children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-check-circle me-2 text-success"}),n.jsxs("div",{className:"flex-grow-1",children:[n.jsx("strong",{children:X.quotationFile.name?X.supplierName?`عرض سعر ${X.supplierName}.${X.quotationFile.name.split(".").pop()}`:X.quotationFile.name:H?X.supplierName?`عرض سعر ${X.supplierName}.pdf`:L.find(C=>C.id===H)?.quotationFileName||"ملف موجود":"ملف موجود"}),n.jsxs("small",{className:"text-muted ms-2",children:["(",X.quotationFile.size?Math.round(X.quotationFile.size/1024):H?Math.round((L.find(C=>C.id===H)?.quotationFileSize||0)/1024):0," KB)"]})]})]}),n.jsx("button",{type:"button",className:"btn-close btn-close-sm",onClick:()=>{pe(C=>({...C,quotationFile:null}))},title:"إزالة الملف",style:{position:"absolute",top:"8px",left:"8px",width:"20px",height:"20px",fontSize:"10px",opacity:.7},onMouseEnter:C=>C.target.style.opacity=1,onMouseLeave:C=>C.target.style.opacity=.7})]}),H&&!X.quotationFile&&n.jsxs("div",{className:"alert alert-info py-2 mb-2",children:[n.jsx("i",{className:"bi bi-info-circle me-2"}),n.jsxs("small",{children:["ملف موجود: ",L.find(C=>C.id===H)?.quotationFileName||"ملف موجود"]})]}),!X.quotationFile&&!H&&n.jsx("div",{className:"mt-1",children:n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),"يجب اختيار ملف PDF أو Word أو صورة"]})})]})]})]}),n.jsx("div",{className:"modal-footer border-0 pt-0 d-flex justify-content-center",style:{marginBottom:"10px"},children:n.jsxs("div",{className:"d-flex gap-3",children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:oe,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"10px",height:"10px"}}),"رفع..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),"إرسال"]})})]})})]})]})})}),R&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:n.jsx("div",{className:"modal-dialog modal-xl",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0 pb-2",style:{marginBottom:"5px"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-people-fill text-primary me-2"}),X.supplierType==="local"?"اختر مورد محلي":"اختر مورد أجنبي",n.jsxs("span",{className:"text-muted ms-2",children:["(",En().length,")"]})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:Je,style:{fontSize:"12px"}})]}),n.jsx("div",{className:"modal-body p-0",children:En().length>0?n.jsx("div",{className:"table-responsive suppliers-table",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"50px"}}),n.jsx("th",{children:"اسم المورد"}),n.jsx("th",{children:"البريد الإلكتروني"}),n.jsx("th",{children:"الهاتف"}),n.jsx("th",{children:"المدينة"})]})}),n.jsx("tbody",{children:En().map(C=>n.jsxs("tr",{onClick:()=>Ht(C),style:{cursor:"pointer"},children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input custom-radio",type:"radio",name:"selectedSupplier",checked:G?.id===C.id,onChange:()=>{},style:{pointerEvents:"none",width:"18px",height:"18px",borderWidth:"2px",borderColor:G?.id===C.id?"#007bff":"#dee2e6"}})})}),n.jsx("td",{children:n.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},children:C.name})}),n.jsx("td",{children:n.jsx("a",{href:`mailto:${C.email}`,className:"text-decoration-none",children:C.email})}),n.jsx("td",{children:C.phone}),n.jsx("td",{children:C.city||"-"})]},C.id))})]})}):n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-people fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد موردين"}),n.jsxs("p",{className:"text-muted",children:["لا توجد ",X.supplierType==="local"?"موردين محليين":"موردين أجانب"," مسجلين"]})]})}),n.jsx("div",{className:"modal-footer border-0 d-flex justify-content-center",style:{marginTop:"15px"},children:n.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:Ze,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",margin:"20px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:"تأكيد"})})]})})}),T&&Z&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:C=>{C.target===C.currentTarget&&Dt()},children:n.jsx("div",{className:"modal-dialog modal-lg",onClick:C=>C.stopPropagation(),children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"معلومات المورد - ",Z?.name,n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:"أجنبي"})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:Dt})]}),n.jsx("div",{className:"modal-body",children:n.jsxs("div",{className:"row g-3",children:[n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"اسم المورد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z?.name})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البريد الإلكتروني"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z?.email||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الهاتف"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:Z?.phone||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البلد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z?.country||""})]}),n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"العنوان"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z?.address||""})]}),Z?.taxNumber&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"الرقم الضريبي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z.taxNumber})]}),Z?.bankAccount&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الحساب البنكي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z.bankAccount})]}),Z?.notes&&n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"ملاحظات"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:Z.notes})]})]})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsx("div",{className:"d-flex gap-3",children:n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:Dt,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إغلاق"})})})]})})})]}),n.jsx(Mn,{show:u,message:$?"جار تحديث المنتج المستورد...":"جار حفظ المنتج المستورد..."}),n.jsx(Tn,{show:se.show,onClose:fe,title:se.title,message:se.message,type:se.type,onConfirm:se.onConfirm,confirmText:se.confirmText,cancelText:se.cancelText,showCancel:se.showCancel}),n.jsx(Hx,{position:"bottom-right",showDetails:!0})]})}function BE(){return n.jsx(un,{children:n.jsx(W4,{})})}const K4=({refreshTrigger:r})=>{const e=os();console.log("ManufacturedProductsListFixed is rendering");const[t,s]=j.useState([]),[a,l]=j.useState(!0),[c,u]=j.useState(null),[m,p]=j.useState(""),[b,w]=j.useState([]),[N,R]=j.useState(!1),[O,G]=j.useState(!1),{logActivity:U,getCurrentUser:T}=_n(),{alertConfig:ee,closeAlert:Z,showSuccess:ie,showError:X,showConfirm:pe}=Cn(),{formatDate:H}=yh(),{currentPage:B,totalPages:k,paginatedItems:W,handlePageChange:J,resetPage:z,totalItems:L,itemsPerPage:de}=wa(b,30);console.log("ManufacturedProductsListFixed state:",{productsCount:t.length,loading:a,error:c});const Pe=async()=>{try{l(!0),u(null),console.log("Loading manufactured products...");const fe=await ac.getAllManufacturedProducts();console.log("Manufactured products loaded:",fe.length),s(fe)}catch(fe){console.error("Error loading manufactured products:",fe),u(fe.message||"فشل في تحميل المنتجات المصنعة")}finally{l(!1)}};j.useEffect(()=>{(async()=>{try{if(console.log("🔐 [List] Initializing Firebase authentication..."),sn.currentUser){console.log("✅ [List] User already authenticated:",sn.currentUser.uid),G(!0);return}return Xw(sn,async _=>{if(_)console.log("✅ [List] User authenticated:",_.uid),G(!0);else{console.log("❌ [List] No user found, attempting anonymous sign-in...");try{await g3(sn),console.log("✅ [List] Anonymous sign-in successful"),G(!0)}catch(E){console.error("❌ [List] Anonymous sign-in failed:",E),G(!1)}}})}catch(re){console.error("❌ [List] Auth initialization error:",re),u("فشل في تهيئة المصادقة")}})()},[]),j.useEffect(()=>{O&&Pe()},[r,O]),j.useEffect(()=>{if(m.trim()){const fe=t.filter(re=>re.title?.toLowerCase().includes(m.toLowerCase())||re.referenceNumber?.toLowerCase().includes(m.toLowerCase())||re.description?.toLowerCase().includes(m.toLowerCase()));w(fe)}else w(t);z()},[m,t,z]);const V=fe=>{pe(`هل أنت متأكد من حذف هذا المنتج المصنع؟

${fe.title}`,()=>se(fe),"تأكيد حذف المنتج المصنع")},se=async fe=>{try{R(!0),await qn.moveToTrash(fe,"manufacturedProducts"),await ac.deleteManufacturedProduct(fe.id);const re=T();U("task",`${re.name} حذف منتج مصنع`,`تم حذف المنتج المصنع: ${fe.title}`),Pe(),ie(`تم نقل المنتج المصنع للمهملات: ${fe.title}`,"تم النقل للمهملات")}catch(re){console.error("Error deleting manufactured product:",re),X(`فشل في نقل المنتج المصنع للمهملات: ${re.message}`,"خطأ في النقل")}finally{R(!1)}};return a?(console.log("ManufacturedProductsListFixed: Showing loading state"),n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"spinner-border text-primary",role:"status",children:n.jsx("span",{className:"visually-hidden",children:"جار التحميل..."})}),n.jsx("p",{className:"mt-3 text-muted",children:"جار تحميل بيانات المنتجات المصنعة..."})]})})):c?(console.log("ManufacturedProductsListFixed: Showing error state:",c),n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:c}),n.jsx("div",{className:"d-flex gap-2 justify-content-center",children:n.jsxs("button",{className:"btn btn-primary",onClick:Pe,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة تحميل البيانات"]})})]})})):(console.log("ManufacturedProductsListFixed: Showing main content with",b.length,"products"),n.jsxs("div",{className:"card shadow-sm","data-list":"manufactured-products",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-gear-wide-connected text-primary me-2"}),"قائمة المنتجات المصنعة (",b.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsx("div",{className:"d-flex justify-content-end align-items-center gap-3",children:n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المنتجات المصنعة...",value:m,onChange:fe=>p(fe.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]})})})]})}),n.jsxs("div",{className:"card-body p-0",children:[b.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-gear-wide-connected fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد منتجات مصنعة"}),n.jsx("p",{className:"text-muted",children:m?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي منتجات مصنعة بعد"}),!m&&n.jsxs("button",{className:"btn btn-primary",onClick:()=>e("/manufactured-products/add"),children:[n.jsx("i",{className:"bi bi-plus-lg me-1"}),"إضافة أول منتج مصنع"]})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"اسم المنتج المصنع"}),n.jsx("th",{className:"text-center",children:"التكلفة التقديرية"}),n.jsx("th",{className:"text-center",children:"تاريخ الإضافة"}),n.jsx("th",{className:"text-center",style:{width:"120px",paddingLeft:"40px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:W.map((fe,re)=>n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(B-1)*de+re+1})}),n.jsx("td",{className:"text-center",children:n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary product-title-btn",onClick:()=>{fe.id?e(`/manufactured-products/edit/${fe.id}`):X("معرف المنتج مفقود، لا يمكن التنقل","خطأ في التنقل")},style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0"},title:`انقر للتعديل | Firebase ID: ${fe.id||"Missing"}`,children:fe.title})}),n.jsx("td",{className:"text-center",children:n.jsxs("span",{className:"badge bg-success text-white",children:[(()=>{let _=0;return fe.items&&Array.isArray(fe.items)&&fe.items.length>0?_=fe.items.reduce((E,D)=>E+(D.totalPrice||0),0):_=fe.estimatedValue||0,_.toLocaleString("en-US")})()," ر.س"]})}),n.jsx("td",{className:"text-center",children:H(fe.submissionDeadline)}),n.jsx("td",{className:"text-center",style:{paddingLeft:"40px"},children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{className:"btn btn-outline-primary",onClick:()=>{if(!fe||!fe.id){X("بيانات المنتج غير صحيحة أو مفقودة","خطأ في البيانات");return}e(`/manufactured-products/edit/${fe.id}`)},title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{className:"btn btn-outline-danger",onClick:()=>V(fe),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},fe.internalId||fe.id||`product-${re}`))})]})}),b.length>0&&n.jsx(va,{currentPage:B,totalPages:k,onPageChange:J,totalItems:L,itemsPerPage:de})]}),n.jsx(Tn,{show:ee.show,onClose:Z,title:ee.title,message:ee.message,type:ee.type,onConfirm:ee.onConfirm,showConfirm:ee.showConfirm})]}))};function Y4(){const[r,e]=j.useState(!1),[t,s]=j.useState(0),{isTimelineVisible:a}=Hn(),l=os(),c=()=>{e(!r)};return n.jsx(un,{children:n.jsx(hn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Xn,{onToggle:c}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!a?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"قائمة المنتجات المصنعة"})]})}),n.jsx(Jn,{}),n.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:n.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[n.jsx("div",{className:"d-flex align-items-center",children:n.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[n.jsx("i",{className:"bi bi-gear-wide-connected text-primary me-2"}),"إدارة المنتجات المصنعة"]})}),n.jsx("button",{onClick:()=>l("/manufactured-products/add"),className:"btn btn-primary",style:{height:"32px",width:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:"إضافة منتج"})]})}),n.jsx("div",{className:"card-body p-0",children:n.jsx(K4,{refreshTrigger:t})})]})})})]}),!r&&a&&n.jsx(Zn,{rtl:!0}),!r&&a&&n.jsx(es,{})]})]})})})}function X4(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(Y4,{})})})}function J4(){const r=os(),{id:e}=ea(),{logActivity:t,getCurrentUser:s}=_n(),{alertConfig:a,closeAlert:l,showSuccess:c,showError:u,showConfirm:m}=Cn(),{isTimelineVisible:p}=Hn(),{formatDate:b}=yh(),w=!!e,[N,R]=j.useState(!1),[O,G]=j.useState(!1),[U,T]=j.useState(()=>(console.log("📋 Initializing form data, will load from Firebase..."),{title:"",referenceNumber:"",description:"",submissionDeadline:"",estimatedValue:""})),[ee,Z]=j.useState({}),[ie,X]=j.useState(!1),[pe,H]=j.useState(!1),[B,k]=j.useState(!1),[W,J]=j.useState(""),[z,L]=j.useState(!1),[de,Pe]=j.useState([]),[V,se]=j.useState(!1),[fe,re]=j.useState(!1),[_,E]=j.useState(null),[D,F]=j.useState(""),[te,$]=j.useState(!1),[Q,me]=j.useState(!1),[I,le]=j.useState(null),[We,nt]=j.useState(-1),[mt,It]=j.useState([]),rn=()=>{R(!N)},[oe,Ue]=j.useState(!1),Je=async()=>{if(mt.length===0){u("لا توجد بنود للتحديث","قائمة فارغة");return}Ue(!0);try{console.log("🔄 PRODUCTITEMS RAW DATA:",JSON.stringify(mt,null,2)),console.log("🔄 Starting direct price refresh for",mt.length,"items");let _e=0;const Xe=[];for(const Be of mt){console.log("🔍 Refreshing item:",{name:Be.materialName,type:Be.materialType,id:Be.materialInternalId,currentPrice:Be.unitPrice});try{let he=null;if(Be.materialType==="rawMaterial"){console.log("🔍 Looking up raw material with ID:",Be.materialInternalId);let be=await wr.getRawMaterialByInternalId(Be.materialInternalId);if(!be){console.log("⚠️ InternalId lookup failed, trying Firebase document ID...");try{be=await wr.getRawMaterial(Be.id)}catch{console.log("⚠️ Firebase ID lookup also failed")}}if(!be){console.log("⚠️ All lookups failed, trying to find by name...");try{be=(await wr.getAllRawMaterials()).find(ve=>ve.name===Be.materialName),console.log("🔍 Found by name:",be?"YES":"NO")}catch{console.log("⚠️ Name lookup also failed")}}he=parseFloat(be?.price)||null,console.log("🔍 Final raw material result:",{found:!!be,price:be?.price,newPrice:he})}else if(Be.materialType==="localProduct"){console.log("🔍 Looking up local product with ID:",Be.materialInternalId);let be=await vr.getLocalProductByInternalId(Be.materialInternalId);if(!be){console.log("⚠️ InternalId lookup failed, trying Firebase document ID...");try{be=await vr.getLocalProduct(Be.id)}catch{console.log("⚠️ Firebase ID lookup also failed")}}if(!be){console.log("⚠️ All lookups failed, trying to find by name...");try{be=(await vr.getAllLocalProducts()).find(ve=>ve.name===Be.materialName),console.log("🔍 Found by name:",be?"YES":"NO")}catch{console.log("⚠️ Name lookup also failed")}}he=parseFloat(be?.price)||null,console.log("🔍 Final local product result:",{found:!!be,price:be?.price,newPrice:he})}else if(Be.materialType==="foreignProduct"){console.log("🔍 Looking up foreign product with ID:",Be.materialInternalId);let be=await Nr.getForeignProductByInternalId(Be.materialInternalId);if(!be){console.log("⚠️ InternalId lookup failed, trying Firebase document ID...");try{be=await Nr.getForeignProduct(Be.id)}catch{console.log("⚠️ Firebase ID lookup also failed")}}if(!be){console.log("⚠️ All lookups failed, trying to find by name...");try{be=(await Nr.getAllForeignProducts()).find(ve=>ve.name===Be.materialName),console.log("🔍 Found by name:",be?"YES":"NO")}catch{console.log("⚠️ Name lookup also failed")}}he=parseFloat(be?.price)||null,console.log("🔍 Final foreign product result:",{found:!!be,price:be?.price,newPrice:he})}if(console.log("🔍 EXACT VALUES:",{itemName:Be.materialName,currentUnitPrice:Be.unitPrice,currentUnitPriceType:typeof Be.unitPrice,sourcePrice:he,sourcePriceType:typeof he,areEqual:he===Be.unitPrice,willUpdate:he!==null&&he!==Be.unitPrice}),he!==null&&he!==Be.unitPrice){console.log("💰 UPDATING PRICE for",Be.materialName,":",Be.unitPrice,"→",he);const be={...Be,unitPrice:he,totalPrice:he*(Be.quantity||1)};Xe.push(be),_e++}else console.log("✅ NO UPDATE for",Be.materialName,"- Current:",Be.unitPrice,"Source:",he),Xe.push(Be)}catch(he){console.error("❌ Failed to refresh item:",Be.materialName,he),Xe.push(Be)}}if(It(Xe),w&&_e>0)try{console.log("💾 Saving manufactured product with updated prices to database...");const Be=Xe.reduce((De,ve)=>De+(ve.unitPrice||0)*(ve.quantity||1),0);T(De=>({...De,estimatedValue:Be.toString()}));const he={...U,estimatedValue:Be.toString(),items:Xe,updatedAt:new Date,lastPriceRefresh:new Date};await ac.updateManufacturedProduct(e,he);const be=s();t("task",`${be.name} حدث أسعار المنتج المصنع`,`تم تحديث ${_e} بند وحفظ المنتج: ${U.title||"غير محدد"}`),console.log("✅ Manufactured product saved successfully with updated prices"),setTimeout(()=>{console.log("🧭 Navigating to manufactured products list..."),r("/manufactured-products")},1500)}catch(Be){console.error("❌ Failed to save manufactured product:",Be),u(`تم تحديث الأسعار ولكن فشل حفظ المنتج: ${Be?.message||Be}`,"تحذير")}else _e>0}catch(_e){console.error("🚨 Refresh failed:",_e),u(`فشل في تحديث الأسعار: ${_e?.message||_e}`,"خطأ في التحديث")}finally{Ue(!1)}};j.useEffect(()=>{(async()=>{try{if(console.log("🔐 Initializing Firebase authentication..."),sn.currentUser){console.log("✅ User already authenticated:",sn.currentUser.uid),G(!0);return}return Xw(sn,async Be=>{Be?(console.log("✅ User authenticated:",Be.uid),G(!0)):(console.log("❌ No user found - authentication required through login page"),G(!1))})}catch(Xe){console.error("❌ Auth initialization error:",Xe),u("فشل في تهيئة المصادقة. يرجى إعادة تحميل الصفحة.","خطأ في التهيئة")}})()},[]),j.useEffect(()=>{const _e=async()=>{if(w)await Ht();else{console.log("🆕 NEW MANUFACTURED PRODUCT MODE: Checking for pending items before clearing");const Be=await it.getPendingProductItems(),he=await it.getPendingData(`productDocuments_${e||"new"}`);console.log("🔍 NEW MANUFACTURED PRODUCT: Checking for saved form data..."),console.log("🔐 AUTH STATE: authReady =",O,"currentUser =",sn.currentUser?"EXISTS":"NULL");let be=null;try{be=await it.getPendingData("productFormData_new"),console.log("📋 NEW MANUFACTURED PRODUCT: Saved form data result:",be)}catch(De){console.error("❌ NEW MANUFACTURED PRODUCT: Error loading saved form data:",De),console.error("❌ Error details:",De.message)}if(be?(console.log("📋 NEW MANUFACTURED PRODUCT: Restoring saved form data from previous session:",be),T(be)):(console.log("📝 NEW MANUFACTURED PRODUCT: Starting with fresh empty form"),T({title:"",referenceNumber:"",description:"",submissionDeadline:"",estimatedValue:""})),Be&&Be.length>0){console.log("🔄 NEW MANUFACTURED PRODUCT: Found pending items, loading them first"),It(Be);const De=Be.reduce((ve,ze)=>ve+(ze.unitPrice||0)*(ze.quantity||1),0);De>0&&(console.log(`💰 Setting estimated value from items: ${De}`),T(ve=>({...ve,estimatedValue:De.toString()}))),m(`تم إضافة ${Be.length} عنصر للمنتج المصنع بنجاح.

يمكنك الآن مراجعة البنود في القائمة أدناه.`,()=>{},"تمت إضافة البنود","موافق","",!1)}he&&he.length>0&&(console.log("📁 NEW MANUFACTURED PRODUCT: Found pending documents, loading them"),Pe(he)),be&&(console.log("📋 NEW MANUFACTURED PRODUCT: Found pending form data, loading it"),T(De=>({...De,...be}))),console.log("✅ NEW MANUFACTURED PRODUCT: Initialization completed (form data preserved)"),console.log("✅ NEW MANUFACTURED PRODUCT: Initialization completed")}const Xe=setInterval(async()=>{const Be=await it.getPendingProductItems();Be&&Be.length>0&&(console.log("🔄 Periodic check found pending items, loading..."),await Dt())},1e3);return setTimeout(()=>clearInterval(Xe),1e4),()=>clearInterval(Xe)};O?(console.log("🔐 AUTH READY: Starting to load data for manufactured products"),_e()):console.log("⏳ AUTH NOT READY: Waiting for authentication...")},[e,O]);const lt=(_e,Xe)=>{console.log("🧠 SENIOR REACT: Starting advanced duplicate prevention analysis..."),console.log("🔍 EXISTING ITEMS:",_e.map(ze=>({id:ze.internalId||ze.materialInternalId,name:ze.materialName||ze.name}))),console.log("🔍 NEW ITEMS:",Xe.map(ze=>({id:ze.internalId||ze.materialInternalId,name:ze.materialName||ze.name})));const Be=[],he=[],be=new Map,De=new Map,ve=new Map;return _e.forEach((ze,$e)=>{const Ke=ze.internalId||ze.materialInternalId,we=ze.materialInternalId||ze.internalId,et=(ze.materialName||ze.name||"").toLowerCase().trim();console.log("📋 EXISTING ITEM:",{internalId:Ke,materialId:we,itemName:et}),Ke&&be.set(Ke,{item:ze,index:$e}),we&&De.set(we,{item:ze,index:$e}),et&&ve.set(et,{item:ze,index:$e})}),Xe.forEach(ze=>{const $e=ze.internalId||ze.materialInternalId,Ke=ze.materialInternalId||ze.internalId,we=(ze.materialName||ze.name||"").toLowerCase().trim();console.log("🆕 CHECKING NEW ITEM:",{newInternalId:$e,newMaterialId:Ke,newItemName:we});let et=!1,ke=null;$e&&be.has($e)?(console.log("🚨 DUPLICATE BY INTERNAL ID:",$e),et=!0,ke={type:"ID",displayName:ze.materialName||ze.name,matchedItem:be.get($e).item}):Ke&&De.has(Ke)?(console.log("🚨 DUPLICATE BY MATERIAL ID:",Ke),et=!0,ke={type:"ID",displayName:ze.materialName||ze.name,matchedItem:De.get(Ke).item}):we&&ve.has(we)&&(console.log("🚨 DUPLICATE BY NAME:",we),et=!0,ke={type:"NAME",displayName:ze.materialName||ze.name,matchedItem:ve.get(we).item}),et?(Be.push(ke),console.log("⚠️ DUPLICATE DETECTED:",{newItem:ze.materialName||ze.name,type:ke.type,matchedWith:ke.matchedItem.materialName||ke.matchedItem.name})):(he.push(ze),console.log("✅ UNIQUE ITEM ADDED:",ze.materialName||ze.name))}),console.log("🛡️ DUPLICATE PREVENTION SUMMARY:",{totalNewItems:Xe.length,duplicatesFound:Be.length,uniqueItemsToAdd:he.length}),{duplicates:Be,uniqueItems:he}},Dt=async()=>{try{console.log("🔍 Loading pending product items from Firestore...");const _e=await it.getPendingProductItems();if(_e){const Xe=Array.isArray(_e)?_e:JSON.parse(_e);console.log("📦 Found pending product items:",Xe.length,"items"),It(Be=>{if(Be.length===Xe.length&&Be.length>0){const ze=Be.map(we=>we.internalId||we.materialInternalId).sort(),$e=Xe.map(we=>we.internalId||we.materialInternalId).sort();if(ze.length===$e.length&&ze.every((we,et)=>we===$e[et]))return console.log("🔄 ITEMS UNCHANGED: Same length and same IDs, skipping update"),Be}console.log("🔄 ITEMS CHANGED: Different length or different IDs, processing update..."),console.log("📊 Prev items:",Be.length,"Parsed items:",Xe.length),console.log("🛡️ SENIOR REACT: Processing new/changed items...");let he=[],be=[];if(Be.length===0)console.log("🆕 EMPTY STATE: Loading initial pending items"),he=[],be=Xe;else{console.log("🔄 EXISTING STATE: Checking for duplicates");const ze=lt(Be,Xe);if(he=ze.duplicates,be=ze.uniqueItems,he.length>0){const $e=he.map(Ke=>{const we=Ke.type==="ID"?"معرف مطابق":"اسم مطابق";return`⚠️ "${Ke.displayName}" (${we})`});u(`تم العثور على ${he.length} بند مكرر. تم إضافة ${be.length} بند جديد فقط.

${$e.join(`
`)}`,"بنود مكررة")}console.log("🚨 DUPLICATES BLOCKED:",{count:he.length,names:he.map($e=>$e.displayName)})}const De=[...Be,...be],ve=De.reduce((ze,$e)=>ze+($e.unitPrice||0)*($e.quantity||1),0);return T(ze=>({...ze,estimatedValue:ve.toString()})),console.log("🛡️ SENIOR REACT DUPLICATE PREVENTION RESULT:",{existingCount:Be.length,newUniqueItems:be.length,duplicatesBlocked:he.length,finalCount:De.length,preventionSuccess:he.length===0?"ALL_UNIQUE":"DUPLICATES_FILTERED"}),De}),console.log("✅ Items loaded and ready - keeping in storage until product is saved")}else{console.log("📦 No pending product items found in Firestore");const Xe=await it.getPendingData(`productItems_${e||"new"}`);if(Xe&&mt.length===0)try{Array.isArray(Xe)&&Xe.length>0&&(console.log("📦 Loading existing product items from Firestore:",Xe.length),It(Xe))}catch(Be){console.error("Error loading Firestore items:",Be)}}}catch(_e){console.error("Error loading pending items:",_e)}};j.useEffect(()=>{let _e=null,Xe=null;const Be=()=>{_e&&clearTimeout(_e),_e=setTimeout(()=>{console.log("🔍 WINDOW FOCUS: Checking for pending product items..."),Dt()},500)},he=De=>{console.log("🎯 CUSTOM EVENT: productItemsAdded detected"),_e&&clearTimeout(_e),_e=setTimeout(()=>{Dt()},300)},be=()=>{document.hidden||(console.log("🔍 PAGE VISIBLE: Checking for pending product items..."),_e&&clearTimeout(_e),_e=setTimeout(()=>{Dt()},500))};return O&&(console.log("🎧 ADDING EVENT LISTENERS for product item detection"),Xe=setTimeout(()=>{console.log("🔍 INITIAL CHECK: Looking for pending product items..."),Dt()},1e3)),window.addEventListener("focus",Be),document.addEventListener("visibilitychange",be),window.addEventListener("productItemsAdded",he),()=>{window.removeEventListener("focus",Be),document.removeEventListener("visibilitychange",be),window.removeEventListener("productItemsAdded",he),_e&&clearTimeout(_e),Xe&&clearTimeout(Xe)}},[O]);const Ht=async()=>{if(e)try{H(!0),console.log("🔍 Loading manufactured product:",e);const _e=await ac.getManufacturedProductById(e),Xe={..._e,submissionDeadline:_e.submissionDeadline?ku(_e.submissionDeadline):""};if(T(Xe),_e.documents&&Array.isArray(_e.documents)){const Be=_e.documents.filter(he=>he&&typeof he=="object"&&he.fileName&&he.fileURL);Pe(Be),console.log("✅ Loaded product documents from Firebase database:",Be.length)}_e.items&&Array.isArray(_e.items)&&It(_e.items),console.log("✅ Loaded manufactured product successfully:",_e.title)}catch(_e){console.error("❌ Error loading manufactured product:",_e),u(`فشل في تحميل بيانات المنتج: ${_e.message}`,"خطأ في التحميل")}finally{H(!1)}},Ze=async _e=>{const{name:Xe,value:Be,type:he,checked:be}=_e.target,De={...U,[Xe]:he==="checkbox"?be:Be};T(De);try{const ve=e?`productFormData_${e}`:"productFormData_new";await it.setPendingData(ve,De),console.log(`💾 Form data saved for field: ${Xe}`)}catch(ve){console.error("Error saving form data:",ve)}ee[Xe]&&Z(ve=>({...ve,[Xe]:void 0}))},Vt=async()=>{const _e={};if(U.title?.trim()||(_e.title="اسم المنتج مطلوب"),U.referenceNumber?.trim()||(_e.referenceNumber="رقم المرجع مطلوب"),U.submissionDeadline||(_e.submissionDeadline="تاريخ الإضافة مطلوب"),U.referenceNumber?.trim())try{await oo.checkUnique("manufacturedProducts","referenceNumber",U.referenceNumber.trim(),w?e:null)&&(_e.referenceNumber="رقم المرجع موجود مسبقاً")}catch(Xe){console.warn("Could not validate reference number uniqueness:",Xe)}return Z(_e),Object.keys(_e).length===0},Xt=async _e=>{if(_e.preventDefault(),ie)return;if(!O){u("جار تهيئة المصادقة، يرجى المحاولة مرة أخرى","المصادقة غير جاهزة");return}if(!await Vt()){u("يرجى تصحيح الأخطاء المذكورة أعلاه","بيانات غير صحيحة");return}try{X(!0),console.log("💾 Saving manufactured product...");const Be={...U,documents:de||[],items:mt||[]};let he;if(w){he=await ac.updateManufacturedProduct(e,Be);const be=s();t("task",`${be.name} عدل منتج مصنع`,`تم تعديل: ${U.title}`),c("تم تحديث المنتج المصنع بنجاح!","تم التحديث"),await it.clearPendingData(`productFormData_${e}`),await it.clearPendingData(`productDocuments_${e}`),await it.clearPendingProductItems(),setTimeout(()=>{r("/manufactured-products")},2e3)}else{he=await ac.createManufacturedProduct(Be);const be=s();t("task",`${be.name} أضاف منتج مصنع جديد`,`تم إضافة: ${U.title}`),c("تم إضافة المنتج المصنع بنجاح!","تم الحفظ"),await it.clearPendingData("productFormData_new"),await it.clearPendingData("productDocuments_new"),await it.clearPendingProductItems(),setTimeout(()=>{r("/manufactured-products")},2e3)}console.log("✅ Manufactured product saved successfully:",he?.id||"unknown")}catch(Be){console.error("❌ Error saving manufactured product:",Be),u(`فشل في حفظ المنتج: ${Be.message}`,"خطأ في الحفظ"),Z(he=>({...he,submit:`فشل في حفظ المنتج: ${Be.message}`}))}finally{X(!1)}},ts=j.useCallback(()=>{if(!mt||mt.length===0)return 0;const _e=mt.reduce((Xe,Be)=>Xe+(Be.totalPrice||0),0);return console.log("📊 INSTANT: Reflecting pre-calculated total from items:",_e),_e},[mt]),ns=()=>{k(!0)},mn=_e=>{console.log("🔧 Manufacturing Item Selected:",_e),J(_e);const Be={"raw-materials":`/manufactured-products/raw-materials/${e||"new"}`,"local-product":`/manufactured-products/local-products/${e||"new"}`,"imported-product":`/manufactured-products/foreign-products/${e||"new"}`,"manufactured-product":`/manufactured-products/edit/${e||"new"}`}[_e];Be&&_e!=="manufactured-product"&&r(Be)},Kt=async _e=>{It(Xe=>{const Be=Xe.filter((he,be)=>be!==_e);return it.setPendingData(`productItems_${e||"new"}`,Be),Be})},En=(_e,Xe)=>{console.log("🔧 handleEditItem called with:",{item:_e,index:Xe}),console.log("🔧 Opening edit modal for item:",_e),le({..._e,quantity:_e.quantity||1}),nt(Xe),me(!0),console.log("🔧 Edit modal state should be open now")},C=_e=>{const Xe=Math.max(0,parseFloat(_e)||0);le(Be=>({...Be,quantity:Number(Xe.toFixed(1)),totalPrice:(Be.unitPrice||0)*Number(Xe.toFixed(1))}))},ne=()=>{if(console.log("🔧 handleSaveEditedItem called"),!I||We===-1){u("بيانات البند غير صحيحة","خطأ في البيانات");return}It(_e=>{const Xe=[..._e];return Xe[We]=I,it.setPendingData(`productItems_${e||"new"}`,Xe),console.log("✅ Item updated successfully:",I),Xe}),me(!1),le(null),nt(-1),console.log("✅ Item updated and modal closed")},ue=()=>{console.log("🔧 handleCloseEditModal called"),me(!1),le(null),nt(-1)},ce=async()=>{try{w||(console.log("🧹 CANCEL: Clearing all pending data for cancelled new manufactured product"),await it.clearPendingData(`productFormData_${e||"new"}`),await it.clearPendingData(`productDocuments_${e||"new"}`),await it.clearPendingProductItems(),console.log("✅ CANCEL: All pending data cleared successfully"))}catch(_e){console.error("Error clearing pending data on cancel:",_e)}r("/manufactured-products")},ye=async _e=>{const Xe=_e.target.files[0];if(Xe){se(!0);try{try{_r.validateFile(Xe,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]})}catch(Be){throw new Error(Be.message)}E({file:Xe,originalFileName:Xe.name,fileSize:Xe.size,fileType:Xe.type}),re(!0)}catch(Be){console.error("File upload error:",Be),u(`فشل في رفع الملف: ${Be.message}`,"خطأ في الرفع")}finally{se(!1),_e.target&&(_e.target.value="")}}},Le=async()=>{if(!D.trim()){u("يرجى إدخال اسم للملف","اسم الملف مطلوب");return}if(!_){u("لم يتم العثور على بيانات الملف","خطأ في البيانات");return}se(!0);try{console.log("🔄 Starting file upload with custom name:",D);const _e=await _r.uploadFile(_.file,"product-documents");if(console.log("✅ File uploaded successfully:",_e),console.log("📄 Download URL for access:",_e.url),!_e.url||!_e.url.startsWith("https://"))throw new Error("فشل في الحصول على رابط تحميل صالح من Firebase Storage");const Xe={id:`doc_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,fileName:D.trim(),originalFileName:_.originalFileName,fileSize:_.fileSize,fileType:_.fileType,fileURL:_e.url,uploadedAt:new Date().toISOString(),storagePath:_e.path};Pe(be=>[...be,Xe]);const Be=[...de,Xe];await it.setPendingData(`productDocuments_${e||"new"}`,Be),console.log("✅ Document added to list:",Xe),c(`تم رفع الملف بنجاح: ${D}`,"تم الرفع");const he=s();t("file",`${he.name} رفع ملف للمنتج المصنع`,`رفع: ${D}`)}catch(_e){console.error("❌ Error in handleFileNameSave:",_e),u(`فشل في حفظ الملف: ${_e.message}`,"خطأ في الحفظ")}finally{se(!1),re(!1),E(null),F("")}},Nt=()=>{re(!1),E(null),F("")},yt=_e=>{m(`هل أنت متأكد من حذف هذا الملف؟

${_e.fileName}`,()=>$s(_e),"تأكيد حذف الملف")},$s=async _e=>{try{$(!0),await qn.moveToTrash(_e,"product_documents"),Pe(he=>he.filter(be=>be.id!==_e.id));const Xe=de.filter(he=>he.id!==_e.id);await it.setPendingData(`productDocuments_${e||"new"}`,Xe);const Be=s();t("file",`${Be.name} حذف ملف من المنتج المصنع`,`حذف: ${_e.fileName}`),c(`تم نقل الملف للمهملات: ${_e.fileName}`,"تم النقل للمهملات")}catch(Xe){console.error("Error deleting document:",Xe),u(`فشل في نقل الملف للمهملات: ${Xe.message}`,"خطأ في النقل")}finally{$(!1)}};return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`page-wrapper ${N?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Xn,{onToggle:rn}),n.jsxs("div",{className:"main-container",style:{paddingRight:N?"72px":"250px",paddingLeft:N||!p?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:N?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:N})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item",children:n.jsx("a",{href:"/manufactured-products",className:"text-decoration-none text-primary",children:"المنتجات المصنعة"})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:w?"تعديل منتج مصنع":"إضافة منتج مصنع جديد"})]})}),n.jsx(Jn,{}),n.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:n.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[n.jsx("div",{className:"d-flex align-items-center",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:`bi ${w?"bi-pencil-square":"bi-plus-circle-fill"} text-primary me-2`}),w?"تعديل المنتج المصنع":"إضافة منتج مصنع جديد"]})}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-primary",onClick:ns,style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:"إضافة بند"}),n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>L(!0),style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:"وثائق المنتج"})]})]})}),n.jsx("div",{className:"card-body",children:pe?n.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:n.jsx(Mn,{size:"large"})}):n.jsxs("form",{onSubmit:Xt,children:[ee.submit&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),ee.submit]}),n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-8 mb-3",children:[n.jsx("label",{className:"form-label",children:"اسم المنتج *"}),n.jsx("input",{type:"text",className:`form-control ${ee.title?"is-invalid":""}`,name:"title",value:U.title,onChange:Ze,placeholder:"أدخل اسم المنتج المصنع",disabled:ie}),ee.title&&n.jsx("div",{className:"invalid-feedback",children:ee.title})]}),n.jsxs("div",{className:"col-md-4 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم المرجع *"}),n.jsx("input",{type:"text",className:`form-control ${ee.referenceNumber?"is-invalid":""}`,name:"referenceNumber",value:U.referenceNumber,onChange:Ze,placeholder:"رقم المرجع",disabled:ie}),ee.referenceNumber&&n.jsx("div",{className:"invalid-feedback",children:ee.referenceNumber})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsxs("label",{className:"form-label",children:["التكلفة التقديرية",n.jsx("small",{className:"text-muted ms-2",children:"(محسوبة تلقائياً من البنود)"})]}),n.jsxs("div",{className:"input-group",children:[n.jsx("input",{type:"text",className:"form-control bg-light",name:"estimatedValue",value:(()=>{const _e=ts();return _e>0?`${_e.toLocaleString("en-US")} ريال`:"0 ريال"})(),readOnly:!0,placeholder:"سيتم حسابها من البنود المضافة",style:{backgroundColor:"#f8f9fa",fontWeight:"bold",color:"#198754"}}),n.jsx("span",{className:"input-group-text bg-light text-success",children:n.jsx("i",{className:"bi bi-calculator"})})]})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"تاريخ الإضافة *"}),n.jsxs("div",{className:"input-group",children:[n.jsx("input",{type:"date",className:`form-control ${ee.submissionDeadline?"is-invalid":""}`,name:"submissionDeadline",value:U.submissionDeadline||"",onChange:Ze,disabled:ie,required:!0,style:{backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23212529'%3e%3cpath d='M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v1h14V3a1 1 0 0 0-1-1H2zm13 3H1v9a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V5z'/%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"left 12px center",backgroundSize:"16px 16px",paddingLeft:"40px"}}),n.jsx("span",{className:"input-group-text bg-light",children:n.jsx("i",{className:"bi bi-calendar-event text-primary"})})]}),U.submissionDeadline&&n.jsxs("small",{className:"text-muted d-block mt-1",children:["التاريخ المحدد: ",b(U.submissionDeadline)]}),ee.submissionDeadline&&n.jsx("div",{className:"invalid-feedback",children:ee.submissionDeadline})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"وصف المنتج"}),n.jsx("textarea",{className:"form-control",name:"description",value:U.description,onChange:Ze,rows:"4",placeholder:"وصف تفصيلي للمنتج المصنع ومتطلباته...",disabled:ie})]}),mt.length>0&&n.jsx("div",{className:"col-md-12 mb-4",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-light",children:n.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[n.jsxs("h6",{className:"mb-0 fw-bold text-primary",children:[n.jsx("i",{className:"bi bi-list-task me-2"}),"بنود المنتج (",mt.length,")"]}),n.jsx("button",{type:"button",className:"btn btn-success btn-sm",onClick:Je,disabled:oe||mt.length===0,style:{fontSize:"12px",padding:"4px 12px",borderRadius:"4px"},children:oe?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status"}),"جار التحديث..."]}):n.jsx(n.Fragment,{children:"🔄 تحديث أسعار"})})]})}),n.jsx("div",{className:"card-body p-0",children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"اسم المادة"}),n.jsx("th",{className:"text-center",style:{paddingRight:"20px"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{paddingRight:"20px"},children:"الوحدة"}),n.jsx("th",{className:"text-center",style:{paddingRight:"20px"},children:"السعر الإجمالي"}),n.jsx("th",{className:"text-center",style:{width:"60px",paddingRight:"20px",paddingLeft:"40px"},children:"إجراء"})]})}),n.jsx("tbody",{children:mt.map((_e,Xe)=>{let Be=_e.materialName||_e.name||"مادة غير محددة";Be&&Be.toString().startsWith("rm_")&&(Be="مادة غير محددة");const he=_e.materialUnit||_e.unit||"قطعة",be=_e.totalPrice||0,De=_e.internalId;return n.jsxs("tr",{className:"",style:{backgroundColor:Xe%2===0?"#ffffff":"#f8f9fa"},children:[n.jsx("td",{className:"text-center fw-bold text-muted",children:Xe+1}),n.jsx("td",{className:"text-center fw-medium",children:n.jsx("div",{children:n.jsx("button",{className:"btn btn-link p-0 fw-medium text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:async ve=>{ve.preventDefault(),ve.stopPropagation();try{console.log("=== DETAILED DEBUGGING ==="),console.log("Full item object:",JSON.stringify(_e,null,2)),console.log("All item keys:",Object.keys(_e));const ze=_e.materialInternalId,$e=_e.materialType||"rawMaterial";console.log("Searching for:"),console.log("- materialInternalId:",ze),console.log("- materialType:",$e);let Ke=null,we=[];if($e==="rawMaterial"){console.log("Loading raw materials...");const{RawMaterialService:et}=await Ds(async()=>{const{RawMaterialService:Ve}=await Promise.resolve().then(()=>ax);return{RawMaterialService:Ve}},void 0);we=await et.getAllRawMaterials(),console.log("Total raw materials loaded:",we.length),console.log("Sample raw material IDs:",we.slice(0,3).map(Ve=>({id:Ve.id,internalId:Ve.internalId,name:Ve.name})));let ke=we.find(Ve=>Ve.internalId===ze);if(ke||(ke=we.find(Ve=>Ve.id===ze)),!ke){const Ve=_e.materialName||_e.name;ke=we.find(Tt=>Tt.name===Ve)}console.log("Found raw material:",ke?"YES":"NO"),ke&&(console.log("Material details:",{id:ke.id,internalId:ke.internalId,name:ke.name}),Ke=ke.id,r(`/raw-materials/edit/${Ke}`))}else if($e==="localProduct"){console.log("Loading local products...");const{LocalProductService:et}=await Ds(async()=>{const{LocalProductService:Ve}=await Promise.resolve().then(()=>ox);return{LocalProductService:Ve}},void 0);we=await et.getAllLocalProducts(),console.log("Total local products loaded:",we.length),console.log("Sample local product IDs:",we.slice(0,3).map(Ve=>({id:Ve.id,internalId:Ve.internalId,name:Ve.name})));let ke=we.find(Ve=>Ve.internalId===ze);if(ke||(ke=we.find(Ve=>Ve.id===ze)),!ke){const Ve=_e.materialName||_e.name;ke=we.find(Tt=>Tt.name===Ve)}console.log("Found local product:",ke?"YES":"NO"),ke&&(console.log("Product details:",{id:ke.id,internalId:ke.internalId,name:ke.name}),Ke=ke.id,r(`/local-products/edit/${Ke}`))}else if($e==="foreignProduct"){console.log("Loading foreign products...");const{ForeignProductService:et}=await Ds(async()=>{const{ForeignProductService:Ve}=await Promise.resolve().then(()=>lx);return{ForeignProductService:Ve}},void 0);we=await et.getAllForeignProducts(),console.log("Total foreign products loaded:",we.length),console.log("Sample foreign product IDs:",we.slice(0,3).map(Ve=>({id:Ve.id,internalId:Ve.internalId,name:Ve.name})));let ke=we.find(Ve=>Ve.internalId===ze);if(ke||(ke=we.find(Ve=>Ve.id===ze)),!ke){const Ve=_e.materialName||_e.name;ke=we.find(Tt=>Tt.name===Ve)}console.log("Found foreign product:",ke?"YES":"NO"),ke&&(console.log("Product details:",{id:ke.id,internalId:ke.internalId,name:ke.name}),Ke=ke.id,r(`/foreign-products/edit/${Ke}`))}Ke||(console.error("=== SEARCH FAILED ==="),console.error("Could not find Firebase ID for:",ze),console.error("Available items in this category:",we.map(et=>({id:et.id,internalId:et.internalId,name:et.name}))),alert(`لا يمكن العثور على هذه المادة
ID: ${ze}
Type: ${$e}`))}catch(ze){console.error("=== NAVIGATION ERROR ===",ze),alert("حدث خطأ أثناء محاولة فتح المادة")}},title:`تحرير: ${Be}`,children:Be})})}),n.jsx("td",{className:"text-center",style:{paddingRight:"20px"},children:n.jsx("span",{className:"badge bg-primary",children:_e.quantity||1})}),n.jsx("td",{className:"text-center",style:{paddingRight:"20px"},children:he}),n.jsx("td",{className:"text-center",style:{paddingRight:"20px"},children:n.jsxs("div",{children:[n.jsxs("span",{className:"text-success fw-bold",children:[be.toLocaleString("en-US")," ر.س"]}),_e.unitPrice&&n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:[_e.unitPrice.toLocaleString("en-US")," × ",_e.quantity]})})]})}),n.jsx("td",{className:"text-center",style:{paddingRight:"20px",paddingLeft:"40px"},children:n.jsxs("div",{className:"d-flex justify-content-center gap-1",children:[n.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:ve=>{ve.preventDefault(),ve.stopPropagation(),En(_e,Xe)},title:"تعديل الكمية",style:{width:"27px",height:"27px",padding:"0",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #007bff",color:"#007bff",backgroundColor:"transparent",transition:"all 0.2s ease"},onMouseEnter:ve=>{ve.target.style.backgroundColor="#007bff",ve.target.style.color="white"},onMouseLeave:ve=>{ve.target.style.backgroundColor="transparent",ve.target.style.color="#007bff"},children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:ve=>{ve.preventDefault(),ve.stopPropagation(),Kt(Xe)},title:"حذف",style:{width:"27px",height:"27px",padding:"0",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #dc3545",color:"#dc3545",backgroundColor:"transparent",transition:"all 0.2s ease"},onMouseEnter:ve=>{ve.target.style.backgroundColor="#dc3545",ve.target.style.color="white"},onMouseLeave:ve=>{ve.target.style.backgroundColor="transparent",ve.target.style.color="#dc3545"},children:n.jsx("i",{className:"bi bi-trash"})})]})})]},De||`item-${Xe}`)})}),n.jsx("tfoot",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{colSpan:"4",className:"text-end",children:"إجمالي القيمة:"}),n.jsxs("th",{className:"text-center text-primary fw-bold",children:[ts().toLocaleString("en-US")," ر.س"]}),n.jsx("th",{})]})})]})})})]})})]}),n.jsx("div",{className:"row",children:n.jsxs("div",{className:"col-12 d-flex justify-content-center gap-3 mt-4",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",style:{height:"32px",minWidth:"80px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},onClick:ce,disabled:ie,children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary",style:{height:"32px",minWidth:"80px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},disabled:ie,children:ie?n.jsxs(n.Fragment,{children:[n.jsx(Mn,{size:"small"}),n.jsx("span",{className:"ms-2",children:w?"تحديث...":"حفظ..."})]}):w?"تحديث":"حفظ"})]})})]})})]})})})]}),p&&n.jsxs("div",{style:{position:"fixed",left:"20px",top:"70px",width:"350px",height:"calc(100vh - 90px)",zIndex:10,background:"white",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",display:"flex",flexDirection:"column"},children:[n.jsx("div",{style:{flex:1,overflow:"hidden"},children:n.jsx(Zn,{})}),n.jsx("div",{style:{borderTop:"1px solid #e9ecef",padding:"10px",background:"#f8f9fa",borderRadius:"0 0 8px 8px"},children:n.jsx(es,{})})]})]})]}),n.jsx(rC,{show:B,onClose:()=>k(!1),onItemSelect:mn,selectedItemType:W,setSelectedItemType:J}),n.jsx(rv,{show:z,onClose:()=>L(!1),documents:de,setDocuments:Pe,tenderId:e||"new",tenderTitle:U.title||"منتج جديد",uploadingDocument:V,setUploadingDocument:se,handleDocumentUpload:ye,handleDeleteClick:yt,deleting:te}),n.jsx(Tn,{show:a.show,onClose:l,title:a.title,message:a.message,type:a.type,onConfirm:a.onConfirm,confirmText:a.confirmText,cancelText:a.cancelText,showCancel:a.showCancel}),fe&&n.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.7)",zIndex:1060},tabIndex:"-1",dir:"rtl",children:n.jsx("div",{className:"modal-dialog modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsx("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"12px 12px 0 0"},children:n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-pencil-square me-2"}),"تسمية الملف"]})}),n.jsx("div",{className:"modal-body",style:{padding:"25px"},children:n.jsxs("div",{className:"mb-4",children:[n.jsxs("div",{className:"d-flex align-items-center mb-3",children:[n.jsx("div",{className:"bg-success bg-opacity-10 p-2 rounded-circle me-3",children:n.jsx("i",{className:"bi bi-file-earmark-check text-success"})}),n.jsxs("div",{children:[n.jsx("h6",{className:"mb-0 fw-bold text-success",children:"تم رفع الملف بنجاح"}),n.jsx("small",{className:"text-muted",children:_?.originalFileName})]})]}),n.jsxs("div",{className:"mb-3",children:[n.jsxs("label",{className:"form-label fw-bold text-primary",children:[n.jsx("i",{className:"bi bi-tag me-1"}),"اسم الملف المخصص *"]}),n.jsx("input",{type:"text",className:"form-control",value:D,onChange:_e=>F(_e.target.value),placeholder:"أدخل اسم الملف المخصص",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:_e=>{_e.target.style.borderColor="#28a745",_e.target.style.boxShadow="0 0 0 0.2rem rgba(40, 167, 69, 0.25)"},onBlur:_e=>{_e.target.style.borderColor="#e9ecef",_e.target.style.boxShadow="none"},autoFocus:!0}),n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),"سيتم استخدام هذا الاسم لعرض الملف في قائمة الوثائق"]})]})]})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:n.jsxs("div",{className:"d-flex justify-content-end",style:{gap:"12px"},children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:Nt,style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-success",onClick:Le,disabled:!D.trim()||V,style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500",opacity:D.trim()&&!V?1:.6},children:V?n.jsxs(n.Fragment,{children:[n.jsx(Mn,{size:"small"}),n.jsx("span",{className:"ms-1",children:"حفظ..."})]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),"حفظ"]})})]})})]})})}),Q&&I&&n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-calculator me-2"}),"تعديل كمية البند"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:ue,"aria-label":"Close"})]}),n.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"30%"},children:"اسم المادة"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"السعر الأساسي"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"المورد"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"إجمالي السعر"})]})}),n.jsx("tbody",{children:n.jsxs("tr",{style:{height:"60px"},children:[n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:"bi bi-layers text-danger me-2"}),n.jsxs("div",{children:[n.jsx("div",{className:"fw-bold text-primary",children:I.materialName||I.name||"مادة غير محددة"}),n.jsx("small",{className:"text-muted",children:I.materialCategory||I.category||""})]})]})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("span",{className:"fw-bold text-success",children:[Math.round(I.unitPrice||0)," ريال"]}),n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:["/",I.materialUnit||I.unit||"وحدة"]})})]}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>C(Math.max(0,Number((I.quantity-.1).toFixed(1)))),disabled:I.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-dash"})}),n.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:I.quantity||0,min:"0",step:"any",onChange:_e=>C(_e.target.value),onBlur:_e=>{const Xe=Number(_e.target.value||0).toFixed(1);C(Xe)}}),n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>C(Number((I.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-plus"})})]})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"text-muted",children:I.displaySupplier||I.supplier||"-"})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(I.totalPrice||0)," ريال"]}),n.jsxs("small",{className:"text-success",children:["(",(I.quantity||.1).toFixed(1)," × ",Math.round(I.unitPrice||0),")"]})]})]})})]})})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:n.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("span",{className:"text-muted me-3",children:"إجمالي البند:"}),n.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[Math.round(I.totalPrice||0)," ريال"]}),n.jsxs("span",{className:"badge bg-info ms-2",children:[(I.quantity||.1).toFixed(1)," ",I.materialUnit||I.unit||"قطعة"]})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:ue,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:ne,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"تأكيد"})]})]})})]})})})]})}function qE(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(J4,{})})})}function Z4(){const[r,e]=j.useState(!1),{isTimelineVisible:t}=Hn(),[s,a]=j.useState([]),[l,c]=j.useState([]),[u,m]=j.useState(!1),[p,b]=j.useState(null),[w,N]=j.useState(""),[R,O]=j.useState([]),[G,U]=j.useState(!1),[T,ee]=j.useState([]),Z=os(),{productId:ie}=ea(),{logActivity:X,getCurrentUser:pe}=_n(),{alertConfig:H,closeAlert:B,showSuccess:k,showError:W}=Cn(),J=async(_,E={})=>{try{console.log("🔍 DUPLICATE CHECK: Checking",_.length,"items against existing product items");const D=await it.getPendingProductItems()||[];if(console.log("🔍 DUPLICATE CHECK: Found",D.length,"existing items"),D.length===0)return console.log("✅ DUPLICATE CHECK: No existing items, all items are unique"),{success:!0,uniqueItems:_||[]};const F=[],te=[];for(const $ of _){const Q=$.materialInternalId||$.internalId||$.id,me=($.materialName||$.name||"").trim().toLowerCase();D.some(le=>{const We=le.materialInternalId||le.internalId||le.id,nt=(le.materialName||le.name||"").trim().toLowerCase();return Q&&We&&Q===We||me&&nt&&me===nt})?(F.push($),console.log("🚨 DUPLICATE FOUND:",$.materialName||$.name)):(te.push($),console.log("✅ UNIQUE ITEM:",$.materialName||$.name))}if(F.length>0&&E.showError){const $=F.map(Q=>Q.materialName||Q.name).join("، ");if(E.showError(`تم العثور على ${F.length} بند مكرر: ${$}. لن يتم إضافة البنود المكررة.`,E.errorTitle||"بنود مكررة"),E.stopOnDuplicates&&te.length===0)return{success:!1,uniqueItems:[]}}return console.log("🔍 DUPLICATE CHECK RESULT:",{totalItems:_.length,duplicates:F.length,uniqueItems:te.length}),{success:!0,uniqueItems:te}}catch(D){return console.error("❌ Error in duplicate prevention:",D),{success:!0,uniqueItems:_||[]}}},z=()=>{e(!r)};j.useEffect(()=>{L();const _=F=>{F.type==="rawMaterialsUpdated"&&L()},E=()=>{L()};window.addEventListener("storage",_),window.addEventListener("rawMaterialsUpdated",E);const D=()=>{L()};return window.addEventListener("focus",D),()=>{window.removeEventListener("storage",_),window.removeEventListener("rawMaterialsUpdated",E),window.removeEventListener("focus",D)}},[]),j.useEffect(()=>{if(w.trim()){const _=s.filter(E=>E.name?.toLowerCase().includes(w.toLowerCase())||E.category?.toLowerCase().includes(w.toLowerCase())||E.description?.toLowerCase().includes(w.toLowerCase())||E.supplier?.toLowerCase().includes(w.toLowerCase()));O(_)}else O(s)},[w,s]);const L=async()=>{try{m(!0);const E=(await wr.getAllRawMaterials()).filter(D=>D.active!==!1);a(E),b(null)}catch(_){b(_.message)}finally{m(!1)}},de=_=>{if(l.some(D=>D.internalId===_.internalId))c(D=>D.filter(F=>F.internalId!==_.internalId));else{const D={..._,type:"rawMaterials",quantity:1};c(F=>[...F,D])}},Pe=()=>{if(l.length===0){W("يرجى اختيار مادة خام واحدة على الأقل","لا توجد مواد مختارة");return}const _=l.map(E=>{let D=E.price||0,F=E.supplier;if(E.priceQuotes&&Array.isArray(E.priceQuotes)&&E.priceQuotes.length>0){const te=E.priceQuotes.reduce(($,Q)=>{const me=parseFloat($.price)||0;return(parseFloat(Q.price)||0)<me?Q:$});D=parseFloat(te.price)||0,F=te.supplierName}return{...E,quantity:1,unitPrice:D,totalPrice:D,displaySupplier:F}});ee(_),U(!0)},V=(_,E)=>{const D=Math.max(0,parseFloat(E)||0);ee(F=>F.map(te=>te.id===_?{...te,quantity:Number(D.toFixed(1)),totalPrice:te.unitPrice*Number(D.toFixed(1))}:te))},se=async()=>{try{if(!Array.isArray(T)||T.length===0){W("لا توجد مواد مختارة للإضافة","خطأ في البيانات");return}console.log("🛡️ SENIOR REACT: Using advanced duplicate prevention hook...");const _=await J(T,{showError:W,errorTitle:"بنود مكررة",stopOnDuplicates:!0});if(console.log("🛡️ SENIOR REACT: Duplicate check result:",_),!_.success){console.log("🚨 SENIOR REACT: Execution stopped due to duplicates");return}const E=_.uniqueItems;console.log("✅ SENIOR REACT: Proceeding with unique items:",E.length),console.log("No duplicates found, proceeding with item creation...");const D=[];for(const $ of E)try{console.log("🔧 SENIOR REACT: Creating tender item directly for:",$.name);const Q={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:$.internalId,materialType:"rawMaterial",materialName:$.name,materialCategory:$.category||"",materialUnit:$.unit||"قطعة",quantity:$.quantity||1,unitPrice:$.unitPrice||0,totalPrice:($.quantity||1)*($.unitPrice||0),supplierInfo:$.displaySupplier||"",tenderId:ie==="new"?"new":ie,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};D.push(Q),console.log("✅ SENIOR REACT: Created tender item directly:",{id:Q.internalId,materialId:Q.materialInternalId,name:Q.materialName,quantity:Q.quantity,unitPrice:Q.unitPrice,totalPrice:Q.totalPrice})}catch(Q){console.error("Error creating manufactured product item for material:",$.name,Q),W(`فشل في إضافة المادة: ${$.name}`,"خطأ في البيانات");return}const F=await it.getPendingProductItems()||[],te=[...F,...D];console.log("📦 SENIOR REACT: Merging manufactured product items:",{existingCount:F.length,newCount:D.length,totalCount:te.length,items:D.map($=>({id:$.internalId,materialId:$.materialInternalId,name:$.materialName,price:$.unitPrice,total:$.totalPrice}))}),await it.setPendingProductItems(te),console.log("🚀 SENIOR REACT: Dispatching product items added event"),window.dispatchEvent(new CustomEvent("productItemsAdded",{detail:{source:"ManufacturedRawMaterials",itemsCount:D.length,items:D.map($=>({id:$.internalId,name:$.materialName,type:$.materialType}))}}));try{const $=pe();$&&$.name&&X("task",`${$.name} أضاف مواد خام للمنتج المصنع`,`تم إضافة ${D.length} مادة خام`)}catch($){console.error("Failed to log activity:",$)}k(`تم إضافة ${D.length} مادة خام للمنتج المصنع بنجاح`,"تمت الإضافة"),U(!1),ee([]),setTimeout(()=>{Z(ie==="new"?"/manufactured-products/add":`/manufactured-products/edit/${ie}`)},100)}catch(_){console.error("Error in handleConfirmQuantities:",_),W("فشل في إضافة المواد الخام للمنتج المصنع - تحقق من البيانات","خطأ في النظام")}},fe=()=>{U(!1),ee([])},re=()=>Math.round(T.reduce((_,E)=>_+E.totalPrice,0));return u?n.jsx(Mn,{show:!0,message:"جار تحميل بيانات المواد الخام...",overlay:!1}):p?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:p}),n.jsxs("button",{className:"btn btn-primary",onClick:L,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Xn,{onToggle:z}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المنتجات المصنعة"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"مواد خام"})]})}),n.jsx(Jn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"raw-materials-table",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-layers text-danger me-2"}),"قائمة المواد الخام (",R.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المواد الخام...",value:w,onChange:_=>N(_.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),n.jsxs("button",{className:"btn btn-danger shadow-sm px-4",onClick:Pe,disabled:l.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["إضافة المحدد (",l.length,")"]}),n.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const _=ie!=="new"?`/manufactured-products/edit/${ie}`:"/manufactured-products/add";Z(_)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:"العودة للمنتج المصنع"})]})})]})}),n.jsx("div",{className:"card-body p-0",children:R.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-layers fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد مواد خام"}),n.jsx("p",{className:"text-muted",children:w?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي مواد خام بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",children:"اختيار"}),n.jsx("th",{className:"text-center",children:"اسم المادة"}),n.jsx("th",{className:"text-center",children:"الفئة"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر"}),n.jsx("th",{className:"text-center",children:"المورد"})]})}),n.jsx("tbody",{children:R.map(_=>{let E=_.price,D=_.supplier,F=!1,te=null;return _.priceQuotes&&Array.isArray(_.priceQuotes)&&_.priceQuotes.length>0&&(F=!0,te=_.priceQuotes.reduce(($,Q)=>{const me=parseFloat($.price)||0;return(parseFloat(Q.price)||0)<me?Q:$}),E=te.price,D=te.supplierName),n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input",type:"checkbox",checked:l.some($=>$.internalId===_.internalId),onChange:()=>de(_),style:{transform:"scale(1.2)"}})})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-primary",children:_.name})}),n.jsx("td",{className:"text-center",children:_.category||"-"}),n.jsx("td",{className:"text-center",children:_.unit||"-"}),n.jsx("td",{className:"text-center",children:E?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsxs("span",{children:[E," ريال"]}),F&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}):"-"}),n.jsx("td",{className:"text-center",children:D?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("span",{children:D}),F&&n.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:"أقل مورد"})]}):"-"})]},_.id)})})]})})})]})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&t&&n.jsx(Zn,{rtl:!0}),!r&&t&&n.jsx(es,{})]}),G&&n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-calculator me-2"}),"تحديد الكميات والأسعار"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:fe,"aria-label":"Close"})]}),n.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"30%"},children:"المادة الخام"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"السعر الأساسي"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"المورد"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"إجمالي السعر"})]})}),n.jsx("tbody",{children:T.map((_,E)=>n.jsxs("tr",{style:{height:"60px"},children:[n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:"bi bi-layers text-danger me-2"}),n.jsxs("div",{children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:D=>{D.preventDefault(),D.stopPropagation(),Z(`/raw-materials/edit/${_.id}`)},title:`تحرير المادة الخام: ${_.name}`,children:_.name}),n.jsx("small",{className:"text-muted",children:_.category})]})]})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("span",{className:"fw-bold text-success",children:[Math.round(_.unitPrice)," ريال"]}),n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:["/",_.unit||"وحدة"]})})]}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>V(_.id,Math.max(0,Number((_.quantity-.1).toFixed(1)))),disabled:_.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-dash"})}),n.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:_.quantity,min:"0",step:"any",onChange:D=>V(_.id,D.target.value),onBlur:D=>{const F=Number(D.target.value||0).toFixed(1);V(_.id,F)}}),n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>V(_.id,Number((_.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-plus"})})]})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"text-muted",children:_.displaySupplier||"-"})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(_.totalPrice)," ريال"]}),n.jsxs("small",{className:"text-success",children:["(",_.quantity.toFixed(1)," × ",Math.round(_.unitPrice),")"]})]})]},_.id))})]})})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:n.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("span",{className:"text-muted me-3",children:"إجمالي الطلبية:"}),n.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[re()," ريال"]}),n.jsxs("span",{className:"badge bg-info ms-2",children:[T.reduce((_,E)=>_+E.quantity,0).toFixed(1)," قطعة"]})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:fe,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:se,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"تأكيد"})]})]})})]})})}),n.jsx(Tn,{show:H.show,onClose:B,title:H.title,message:H.message,type:H.type,onConfirm:H.onConfirm,showConfirm:H.showConfirm})]})}function eF(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(Z4,{})})})}function tF(){const[r,e]=j.useState(!1),{isTimelineVisible:t}=Hn(),[s,a]=j.useState([]),[l,c]=j.useState([]),[u,m]=j.useState(!1),[p,b]=j.useState(null),[w,N]=j.useState(""),[R,O]=j.useState([]),[G,U]=j.useState(!1),[T,ee]=j.useState([]),Z=os(),{productId:ie}=ea(),{logActivity:X,getCurrentUser:pe}=_n(),{alertConfig:H,closeAlert:B,showSuccess:k,showError:W}=Cn(),J=async(_,E={})=>{try{console.log("🔍 DUPLICATE CHECK: Checking",_.length,"items against existing product items");const D=await it.getPendingProductItems()||[];if(console.log("🔍 DUPLICATE CHECK: Found",D.length,"existing items"),D.length===0)return console.log("✅ DUPLICATE CHECK: No existing items, all items are unique"),{success:!0,uniqueItems:_||[]};const F=[],te=[];for(const $ of _){const Q=$.materialInternalId||$.internalId||$.id,me=($.materialName||$.name||"").trim().toLowerCase();D.some(le=>{const We=le.materialInternalId||le.internalId||le.id,nt=(le.materialName||le.name||"").trim().toLowerCase();return Q&&We&&Q===We||me&&nt&&me===nt})?(F.push($),console.log("🚨 DUPLICATE FOUND:",$.materialName||$.name)):(te.push($),console.log("✅ UNIQUE ITEM:",$.materialName||$.name))}if(F.length>0&&E.showError){const $=F.map(Q=>Q.materialName||Q.name).join("، ");if(E.showError(`تم العثور على ${F.length} بند مكرر: ${$}. لن يتم إضافة البنود المكررة.`,E.errorTitle||"بنود مكررة"),E.stopOnDuplicates&&te.length===0)return{success:!1,uniqueItems:[]}}return console.log("🔍 DUPLICATE CHECK RESULT:",{totalItems:_.length,duplicates:F.length,uniqueItems:te.length}),{success:!0,uniqueItems:te}}catch(D){return console.error("❌ Error in duplicate prevention:",D),{success:!0,uniqueItems:_||[]}}},z=()=>{e(!r)};j.useEffect(()=>{L();const _=F=>{F.type==="localProductsUpdated"&&L()},E=()=>{L()};window.addEventListener("storage",_),window.addEventListener("localProductsUpdated",E);const D=()=>{L()};return window.addEventListener("focus",D),()=>{window.removeEventListener("storage",_),window.removeEventListener("localProductsUpdated",E),window.removeEventListener("focus",D)}},[]),j.useEffect(()=>{if(w.trim()){const _=s.filter(E=>E.name?.toLowerCase().includes(w.toLowerCase())||E.category?.toLowerCase().includes(w.toLowerCase())||E.description?.toLowerCase().includes(w.toLowerCase())||E.manufacturer?.toLowerCase().includes(w.toLowerCase()));O(_)}else O(s)},[w,s]);const L=async()=>{try{m(!0);const E=(await vr.getAllLocalProducts()).filter(D=>D.active!==!1);a(E),b(null)}catch(_){b(_.message)}finally{m(!1)}},de=_=>{if(l.some(D=>D.internalId===_.internalId))c(D=>D.filter(F=>F.internalId!==_.internalId));else{const D={..._,type:"localProducts",quantity:1};c(F=>[...F,D])}},Pe=()=>{if(l.length===0){W("يرجى اختيار منتج محلي واحد على الأقل","لا توجد منتجات مختارة");return}const _=l.map(E=>{let D=E.price||0,F=E.manufacturer;if(E.priceQuotes&&Array.isArray(E.priceQuotes)&&E.priceQuotes.length>0){const te=E.priceQuotes.reduce(($,Q)=>{const me=parseFloat($.price)||0;return(parseFloat(Q.price)||0)<me?Q:$});D=parseFloat(te.price)||0,F=te.supplierName}return{...E,quantity:1,unitPrice:D,totalPrice:D,displaySupplier:F}});ee(_),U(!0)},V=(_,E)=>{const D=Math.max(0,parseFloat(E)||0);ee(F=>F.map(te=>te.id===_?{...te,quantity:Number(D.toFixed(1)),totalPrice:te.unitPrice*Number(D.toFixed(1))}:te))},se=async()=>{try{if(!Array.isArray(T)||T.length===0){W("لا توجد منتجات مختارة للإضافة","خطأ في البيانات");return}console.log("🛡️ SENIOR REACT: Using advanced duplicate prevention hook...");const _=await J(T,{showError:W,errorTitle:"بنود مكررة",stopOnDuplicates:!0});if(console.log("🛡️ SENIOR REACT: Duplicate check result:",_),!_.success){console.log("🚨 SENIOR REACT: Execution stopped due to duplicates");return}const E=_.uniqueItems;console.log("✅ SENIOR REACT: Proceeding with unique items:",E.length),console.log("No duplicates found, proceeding with item creation...");const D=[];for(const $ of E)try{console.log("🔧 SENIOR REACT: Creating tender item directly for:",$.name);const Q={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:$.internalId,materialType:"localProduct",materialName:$.name,materialCategory:$.category||"",materialUnit:$.unit||"قطعة",quantity:$.quantity||1,unitPrice:$.unitPrice||0,totalPrice:($.quantity||1)*($.unitPrice||0),supplierInfo:$.displaySupplier||"",tenderId:ie==="new"?"new":ie,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};D.push(Q),console.log("✅ SENIOR REACT: Created tender item directly:",{id:Q.internalId,materialId:Q.materialInternalId,name:Q.materialName,quantity:Q.quantity,unitPrice:Q.unitPrice,totalPrice:Q.totalPrice})}catch(Q){console.error("Error creating manufactured product item for product:",$.name,Q),W(`فشل في إضافة المنتج: ${$.name}`,"خطأ في البيانات");return}const F=await it.getPendingProductItems()||[],te=[...F,...D];console.log("📦 SENIOR REACT: Merging manufactured product items:",{existingCount:F.length,newCount:D.length,totalCount:te.length,items:D.map($=>({id:$.internalId,materialId:$.materialInternalId,name:$.materialName,price:$.unitPrice,total:$.totalPrice}))}),await it.setPendingProductItems(te),console.log("🚀 SENIOR REACT: Dispatching product items added event"),window.dispatchEvent(new CustomEvent("productItemsAdded",{detail:{source:"ManufacturedLocalProducts",itemsCount:D.length,items:D.map($=>({id:$.internalId,name:$.materialName,type:$.materialType}))}}));try{const $=pe();$&&$.name&&X("task",`${$.name} أضاف منتجات محلية للمنتج المصنع`,`تم إضافة ${D.length} منتج محلي`)}catch($){console.error("Failed to log activity:",$)}k(`تم إضافة ${D.length} منتج محلي للمنتج المصنع بنجاح`,"تمت الإضافة"),U(!1),ee([]),setTimeout(()=>{Z(ie==="new"?"/manufactured-products/add":`/manufactured-products/edit/${ie}`)},100)}catch(_){console.error("Error in handleConfirmQuantities:",_),W("فشل في إضافة المنتجات المحلية للمنتج المصنع - تحقق من البيانات","خطأ في النظام")}},fe=()=>{U(!1),ee([])},re=()=>Math.round(T.reduce((_,E)=>_+E.totalPrice,0));return u?n.jsx(Mn,{show:!0,message:"جار تحميل بيانات المنتجات المحلية...",overlay:!1}):p?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:p}),n.jsxs("button",{className:"btn btn-primary",onClick:L,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Xn,{onToggle:z}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المنتجات المصنعة"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"منتجات محلية"})]})}),n.jsx(Jn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"raw-materials-table",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-house text-success me-2"}),"قائمة المنتجات المحلية (",R.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المنتجات المحلية...",value:w,onChange:_=>N(_.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),n.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:Pe,disabled:l.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["إضافة المحدد (",l.length,")"]}),n.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const _=ie!=="new"?`/manufactured-products/edit/${ie}`:"/manufactured-products/add";Z(_)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:"العودة للمنتج المصنع"})]})})]})}),n.jsx("div",{className:"card-body p-0",children:R.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-house fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد منتجات محلية"}),n.jsx("p",{className:"text-muted",children:w?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي منتجات محلية بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",children:"اختيار"}),n.jsx("th",{className:"text-center",children:"اسم المنتج"}),n.jsx("th",{className:"text-center",children:"الفئة"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر"}),n.jsx("th",{className:"text-center",children:"الشركة المصنعة"})]})}),n.jsx("tbody",{children:R.map(_=>{let E=_.price,D=_.manufacturer,F=!1,te=null;return _.priceQuotes&&Array.isArray(_.priceQuotes)&&_.priceQuotes.length>0&&(F=!0,te=_.priceQuotes.reduce(($,Q)=>{const me=parseFloat($.price)||0;return(parseFloat(Q.price)||0)<me?Q:$}),E=te.price,D=te.supplierName),n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input",type:"checkbox",checked:l.some($=>$.internalId===_.internalId),onChange:()=>de(_),style:{transform:"scale(1.2)"}})})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-primary",children:_.name})}),n.jsx("td",{className:"text-center",children:_.category||"-"}),n.jsx("td",{className:"text-center",children:_.unit||"-"}),n.jsx("td",{className:"text-center",children:E?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsxs("span",{children:[E," ريال"]}),F&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}):"-"}),n.jsx("td",{className:"text-center",children:D?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("span",{children:D}),F&&n.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:"أقل مورد"})]}):"-"})]},_.id)})})]})})})]})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&t&&n.jsx(Zn,{rtl:!0}),!r&&t&&n.jsx(es,{})]}),G&&n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-calculator me-2"}),"تحديد الكميات والأسعار"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:fe,"aria-label":"Close"})]}),n.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"30%"},children:"المنتج المحلي"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"السعر الأساسي"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"الشركة المصنعة"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"إجمالي السعر"})]})}),n.jsx("tbody",{children:T.map((_,E)=>n.jsxs("tr",{style:{height:"60px"},children:[n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:"bi bi-house text-success me-2"}),n.jsxs("div",{children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:D=>{D.preventDefault(),D.stopPropagation(),Z(`/local-products/edit/${_.id}`)},title:`تحرير المنتج المحلي: ${_.name}`,children:_.name}),n.jsx("small",{className:"text-muted",children:_.category})]})]})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("span",{className:"fw-bold text-success",children:[Math.round(_.unitPrice)," ريال"]}),n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:["/",_.unit||"وحدة"]})})]}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>V(_.id,Math.max(0,Number((_.quantity-.1).toFixed(1)))),disabled:_.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-dash"})}),n.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:_.quantity,min:"0",step:"any",onChange:D=>V(_.id,D.target.value),onBlur:D=>{const F=Number(D.target.value||0).toFixed(1);V(_.id,F)}}),n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>V(_.id,Number((_.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-plus"})})]})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"text-muted",children:_.displaySupplier||"-"})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(_.totalPrice)," ريال"]}),n.jsxs("small",{className:"text-success",children:["(",_.quantity.toFixed(1)," × ",Math.round(_.unitPrice),")"]})]})]},_.id))})]})})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:n.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("span",{className:"text-muted me-3",children:"إجمالي الطلبية:"}),n.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[re()," ريال"]}),n.jsxs("span",{className:"badge bg-info ms-2",children:[T.reduce((_,E)=>_+E.quantity,0).toFixed(1)," قطعة"]})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:fe,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:se,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"تأكيد"})]})]})})]})})}),n.jsx(Tn,{show:H.show,onClose:B,title:H.title,message:H.message,type:H.type,onConfirm:H.onConfirm,showConfirm:H.showConfirm})]})}function nF(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(tF,{})})})}function sF(){const[r,e]=j.useState(!1),{isTimelineVisible:t}=Hn(),[s,a]=j.useState([]),[l,c]=j.useState([]),[u,m]=j.useState(!1),[p,b]=j.useState(null),[w,N]=j.useState(""),[R,O]=j.useState([]),[G,U]=j.useState(!1),[T,ee]=j.useState([]),Z=os(),{productId:ie}=ea(),{logActivity:X,getCurrentUser:pe}=_n(),{alertConfig:H,closeAlert:B,showSuccess:k,showError:W}=Cn(),J=()=>{e(!r)};j.useEffect(()=>{z();const re=D=>{D.type==="foreignProductsUpdated"&&z()},_=()=>{z()};window.addEventListener("storage",re),window.addEventListener("foreignProductsUpdated",_);const E=()=>{z()};return window.addEventListener("focus",E),()=>{window.removeEventListener("storage",re),window.removeEventListener("foreignProductsUpdated",_),window.removeEventListener("focus",E)}},[]),j.useEffect(()=>{if(w.trim()){const re=s.filter(_=>_.name?.toLowerCase().includes(w.toLowerCase())||_.category?.toLowerCase().includes(w.toLowerCase())||_.description?.toLowerCase().includes(w.toLowerCase())||_.supplier?.toLowerCase().includes(w.toLowerCase())||_.countryOfOrigin?.toLowerCase().includes(w.toLowerCase()));O(re)}else O(s)},[w,s]);const z=async()=>{try{m(!0);const _=(await Nr.getAllForeignProducts()).filter(E=>E.active!==!1);a(_),b(null)}catch(re){b(re.message)}finally{m(!1)}},L=re=>{if(l.some(E=>E.internalId===re.internalId))c(E=>E.filter(D=>D.internalId!==re.internalId));else{const E={...re,type:"foreignProduct",quantity:1};c(D=>[...D,E])}},de=async()=>{if(l.length===0){W("يرجى اختيار منتج أجنبي واحد على الأقل","لا توجد منتجات مختارة");return}const re=await it.getPendingProductItems()||[];let _=[];re&&Array.isArray(re)&&(_=re.map(te=>te.materialInternalId));const E=[],D=l.filter(te=>{const $=_.includes(te.internalId);return $&&E.push(te.name),!$});if(E.length>0){const te=E.join("، ");if(W(`البنود التالية موجودة مسبقاً في القائمة: ${te}`,"بنود مكررة"),D.length===0)return;console.log(`Found ${E.length} duplicate items, proceeding with ${D.length} unique items`)}const F=D.map(te=>{let $=te.price||0,Q=te.supplier;if(te.priceQuotes&&Array.isArray(te.priceQuotes)&&te.priceQuotes.length>0){const me=te.priceQuotes.reduce((I,le)=>{const We=parseFloat(I.price)||0;return(parseFloat(le.price)||0)<We?le:I});$=parseFloat(me.price)||0,Q=me.supplierName}return{...te,quantity:1,unitPrice:$,totalPrice:$,displaySupplier:Q}});ee(F),U(!0)},Pe=(re,_)=>{const E=Math.max(0,parseFloat(_)||0);ee(D=>D.map(F=>F.id===re?{...F,quantity:Number(E.toFixed(1)),totalPrice:F.unitPrice*Number(E.toFixed(1))}:F))},V=async()=>{try{if(!Array.isArray(T)||T.length===0){W("لا توجد منتجات مختارة للإضافة","خطأ في البيانات");return}const re=[];for(const D of T)try{console.log("🔧 SENIOR REACT: Creating tender item directly for:",D.name);const F={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:D.internalId,materialType:"foreignProduct",materialName:D.name,materialCategory:D.category||"",materialUnit:D.unit||"قطعة",quantity:D.quantity||1,unitPrice:D.unitPrice||0,totalPrice:(D.quantity||1)*(D.unitPrice||0),supplierInfo:D.displaySupplier||"",tenderId:ie==="new"?"new":ie,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};re.push(F),console.log("✅ SENIOR REACT: Created tender item directly:",{id:F.internalId,materialId:F.materialInternalId,name:F.materialName,quantity:F.quantity,unitPrice:F.unitPrice,totalPrice:F.totalPrice})}catch(F){console.error("Error creating manufactured product item for product:",D.name,F),W(`فشل في إضافة المنتج: ${D.name}`,"خطأ في البيانات");return}const _=await it.getPendingProductItems()||[],E=[..._,...re];console.log("📦 SENIOR REACT: Merging manufactured product items:",{existingCount:_.length,newCount:re.length,totalCount:E.length,items:re.map(D=>({id:D.internalId,materialId:D.materialInternalId,name:D.materialName,price:D.unitPrice,total:D.totalPrice}))}),await it.setPendingProductItems(E),console.log("🚀 SENIOR REACT: Dispatching product items added event"),window.dispatchEvent(new CustomEvent("productItemsAdded",{detail:{source:"ManufacturedForeignProducts",itemsCount:re.length,items:re.map(D=>({id:D.internalId,name:D.materialName,type:D.materialType}))}}));try{const D=pe();D&&D.name&&X("task",`${D.name} أضاف منتجات أجنبية للمنتج المصنع`,`تم إضافة ${re.length} منتج أجنبي`)}catch(D){console.error("Failed to log activity:",D)}k(`تم إضافة ${re.length} منتج مستورد للمنتج المصنع بنجاح`,"تمت الإضافة"),U(!1),ee([]),setTimeout(()=>{Z(ie==="new"?"/manufactured-products/add":`/manufactured-products/edit/${ie}`)},100)}catch(re){console.error("Error in handleConfirmQuantities:",re),W("فشل في إضافة المنتجات الأجنبية للمنتج المصنع - تحقق من البيانات","خطأ في النظام")}},se=()=>{U(!1),ee([])},fe=()=>Math.round(T.reduce((re,_)=>re+_.totalPrice,0));return u?n.jsx(Mn,{show:!0,message:"جار تحميل بيانات المنتجات الأجنبية...",overlay:!1}):p?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:p}),n.jsxs("button",{className:"btn btn-primary",onClick:z,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Xn,{onToggle:J}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المنتجات المصنعة"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"منتجات أجنبية"})]})}),n.jsx(Jn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"raw-materials-table",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-globe text-info me-2"}),"قائمة المنتجات الأجنبية (",R.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المنتجات الأجنبية...",value:w,onChange:re=>N(re.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),n.jsxs("button",{className:"btn btn-info shadow-sm px-4",onClick:de,disabled:l.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["إضافة المحدد (",l.length,")"]}),n.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const re=ie!=="new"?`/manufactured-products/edit/${ie}`:"/manufactured-products/add";Z(re)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:"العودة للمنتج المصنع"})]})})]})}),n.jsx("div",{className:"card-body p-0",children:R.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-globe fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد منتجات أجنبية"}),n.jsx("p",{className:"text-muted",children:w?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي منتجات أجنبية بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",children:"اختيار"}),n.jsx("th",{className:"text-center",children:"اسم المنتج"}),n.jsx("th",{className:"text-center",children:"الفئة"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر"}),n.jsx("th",{className:"text-center",children:"المورد"}),n.jsx("th",{className:"text-center",children:"بلد المنشأ"})]})}),n.jsx("tbody",{children:R.map(re=>{let _=re.price,E=re.supplier,D=!1,F=null;return re.priceQuotes&&Array.isArray(re.priceQuotes)&&re.priceQuotes.length>0&&(D=!0,F=re.priceQuotes.reduce((te,$)=>{const Q=parseFloat(te.price)||0;return(parseFloat($.price)||0)<Q?$:te}),_=F.price,E=F.supplierName),n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input",type:"checkbox",checked:l.some(te=>te.internalId===re.internalId),onChange:()=>L(re),style:{transform:"scale(1.2)"}})})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-primary",children:re.name})}),n.jsx("td",{className:"text-center",children:re.category||"-"}),n.jsx("td",{className:"text-center",children:re.unit||"-"}),n.jsx("td",{className:"text-center",children:_?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsxs("span",{children:[_," ريال"]}),D&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}):"-"}),n.jsx("td",{className:"text-center",children:E?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("span",{children:E}),D&&n.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:"أقل مورد"})]}):"-"}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"badge bg-warning text-dark",children:re.countryOfOrigin||"غير محدد"})})]},re.id)})})]})})})]})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&t&&n.jsx(Zn,{rtl:!0}),!r&&t&&n.jsx(es,{})]}),G&&n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-calculator me-2"}),"تحديد الكميات والأسعار"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:se,"aria-label":"Close"})]}),n.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"30%"},children:"المنتج الأجنبي"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"السعر الأساسي"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"المورد"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"إجمالي السعر"})]})}),n.jsx("tbody",{children:T.map((re,_)=>n.jsxs("tr",{style:{height:"60px"},children:[n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:"bi bi-globe text-info me-2"}),n.jsxs("div",{children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:E=>{E.preventDefault(),E.stopPropagation(),Z(`/foreign-products/edit/${re.id}`)},title:`تحرير المنتج المستورد: ${re.name}`,children:re.name}),n.jsx("small",{className:"text-muted",children:re.category}),n.jsx("div",{children:n.jsx("span",{className:"badge bg-warning text-dark",style:{fontSize:"10px"},children:re.countryOfOrigin||"غير محدد"})})]})]})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("span",{className:"fw-bold text-success",children:[Math.round(re.unitPrice)," ريال"]}),n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:["/",re.unit||"وحدة"]})})]}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>Pe(re.id,Math.max(0,Number((re.quantity-.1).toFixed(1)))),disabled:re.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-dash"})}),n.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:re.quantity,min:"0",step:"any",onChange:E=>Pe(re.id,E.target.value),onBlur:E=>{const D=Number(E.target.value||0).toFixed(1);Pe(re.id,D)}}),n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>Pe(re.id,Number((re.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-plus"})})]})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"text-muted",children:re.displaySupplier||"-"})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(re.totalPrice)," ريال"]}),n.jsxs("small",{className:"text-success",children:["(",re.quantity.toFixed(1)," × ",Math.round(re.unitPrice),")"]})]})]},re.id))})]})})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:n.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("span",{className:"text-muted me-3",children:"إجمالي الطلبية:"}),n.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[fe()," ريال"]}),n.jsxs("span",{className:"badge bg-info ms-2",children:[T.reduce((re,_)=>re+_.quantity,0).toFixed(1)," قطعة"]})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:se,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:V,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"تأكيد"})]})]})})]})})}),n.jsx(Tn,{show:H.show,onClose:B,title:H.title,message:H.message,type:H.type,onConfirm:H.onConfirm,showConfirm:H.showConfirm})]})}function rF(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(sF,{})})})}const iF=({onEdit:r,onAdd:e,refreshTrigger:t})=>{const[s,a]=j.useState([]),[l,c]=j.useState(!0),[u,m]=j.useState(null),[p,b]=j.useState(""),[w,N]=j.useState([]),[R,O]=j.useState(!1),{logActivity:G,getCurrentUser:U}=_n(),{alertConfig:T,closeAlert:ee,showSuccess:Z,showError:ie,showConfirm:X}=Cn(),{currentPage:pe,totalPages:H,paginatedItems:B,handlePageChange:k,resetPage:W,totalItems:J,itemsPerPage:z}=wa(w,30);j.useEffect(()=>{L()},[]),j.useEffect(()=>{t&&L()},[t]),j.useEffect(()=>{if(p.trim()){const V=s.filter(se=>se.name?.toLowerCase().includes(p.toLowerCase())||se.email?.toLowerCase().includes(p.toLowerCase())||se.phone?.includes(p));N(V)}else N(s);W()},[p,s,W]);const L=async()=>{try{c(!0);const V=await Ji.getAllSuppliers();a(V),m(null)}catch(V){m(V.message)}finally{c(!1)}},de=V=>{X(`هل أنت متأكد من حذف هذا المورد؟

${V.name}`,()=>Pe(V),"تأكيد حذف المورد")},Pe=async V=>{try{O(!0),await qn.moveToTrash(V,"suppliers"),await Ji.deleteSupplier(V.id);const se=U();G("task",`${se.name} حذف مورد محلي`,`تم حذف المورد: ${V.name}`),await L(),Z(`تم نقل المورد للمهملات: ${V.name}`,"تم النقل للمهملات")}catch(se){m(se.message),ie(`فشل في نقل المورد للمهملات: ${se.message}`,"خطأ في النقل")}finally{O(!1)}};return l?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"spinner-border text-primary",role:"status",children:n.jsx("span",{className:"visually-hidden",children:"جار التحميل..."})}),n.jsx("p",{className:"mt-3 text-muted",children:"جار تحميل بيانات الموردين..."})]})}):u?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:u}),n.jsxs("button",{className:"btn btn-primary",onClick:L,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs("div",{className:"card shadow-sm","data-list":"suppliers",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-people-fill text-primary me-2"}),"قائمة الموردين (",w.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group suppliers-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في الموردين...",value:p,onChange:V=>b(V.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted"})})]}),n.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:e,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"إضافة مورد جديد"]})]})})]})}),n.jsxs("div",{className:"card-body p-0",children:[w.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-people fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد موردين"}),n.jsx("p",{className:"text-muted",children:p?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي موردين بعد"}),!p&&n.jsxs("button",{className:"btn btn-primary",onClick:e,children:[n.jsx("i",{className:"bi bi-plus-lg me-1"}),"إضافة أول مورد"]})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{style:{width:"60px"},children:"#"}),n.jsx("th",{children:"اسم المورد"}),n.jsx("th",{children:"البريد الإلكتروني"}),n.jsx("th",{children:"الهاتف"}),n.jsx("th",{children:"المدينة"}),n.jsx("th",{style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:B.map((V,se)=>n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(pe-1)*z+se+1})}),n.jsx("td",{children:n.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",onClick:()=>r(V),style:{textDecoration:"none"},title:`Internal ID: ${V.internalId||"Not Set"}`,children:V.name})}),n.jsx("td",{children:n.jsx("a",{href:`mailto:${V.email}`,className:"text-decoration-none",children:V.email})}),n.jsx("td",{style:{direction:"ltr",textAlign:"left"},children:V.phone}),n.jsx("td",{children:V.city||"-"}),n.jsx("td",{children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{className:"btn btn-outline-primary",onClick:()=>r(V),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{className:"btn btn-outline-danger",onClick:()=>de(V),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},V.internalId||V.id))})]})}),w.length>0&&n.jsx(va,{currentPage:pe,totalPages:H,onPageChange:k,totalItems:J,itemsPerPage:z})]}),n.jsx(Tn,{show:T.show,onClose:ee,title:T.title,message:T.message,type:T.type,onConfirm:T.onConfirm,confirmText:T.confirmText,cancelText:T.cancelText,showCancel:T.showCancel})]})},aF=({supplier:r,onSave:e,onCancel:t})=>{const[s,a]=j.useState({name:"",email:"",phone:"",address:"",city:"",taxNumber:"",bankAccount:"",notes:"",active:!0}),[l,c]=j.useState({}),[u,m]=j.useState(!1),p=!!r,{logActivity:b,getCurrentUser:w}=_n();j.useEffect(()=>{r&&a({name:r.name||"",email:r.email||"",phone:r.phone||"",address:r.address||"",city:r.city||"",taxNumber:r.taxNumber||"",bankAccount:r.bankAccount||"",notes:r.notes||"",active:r.active!==void 0?r.active:!0})},[r]);const N=O=>{const{name:G,value:U,type:T,checked:ee}=O.target;a(Z=>({...Z,[G]:T==="checkbox"?ee:U})),l[G]&&c(Z=>({...Z,[G]:""}))},R=async O=>{O.preventDefault();const G=Ji.validateSupplierData(s);if(Object.keys(G).length>0){c(G);return}m(!0),c({});try{const U=await oo.validateUniqueFields(s,p?r.id:null,p?"suppliers":null);if(Object.keys(U).length>0){c(U),m(!1);return}const T={...s,status:p&&r.status||"active"};if(p){await Ji.updateSupplier(r.id,T);const ee=w();b("task",`${ee.name} عدل مورد محلي`,`تم تعديل المورد: ${T.name}`)}else{await Ji.createSupplier(T);const ee=w();b("task",`${ee.name} أضاف مورد محلي`,`تم إضافة المورد: ${T.name}`)}e()}catch(U){c({submit:U.message})}finally{m(!1)}};return n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",children:[n.jsxs("div",{className:"modal-header",children:[n.jsxs("h5",{className:"modal-title",children:[n.jsx("i",{className:"bi bi-person-plus-fill text-primary me-2"}),p?"تعديل المورد":"إضافة مورد جديد"]}),n.jsx("button",{type:"button",className:"btn-close",onClick:t})]}),n.jsxs("form",{onSubmit:R,children:[n.jsxs("div",{className:"modal-body",children:[l.submit&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.submit]}),n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"اسم المورد *"}),n.jsx("input",{type:"text",className:`form-control ${l.name?"is-invalid":""}`,name:"name",value:s.name,onChange:N,placeholder:"أدخل اسم المورد"}),l.name&&n.jsx("div",{className:"invalid-feedback",children:l.name})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"البريد الإلكتروني *"}),n.jsx("input",{type:"email",className:`form-control ${l.email?"is-invalid":""}`,name:"email",value:s.email,onChange:N,placeholder:"example@company.com"}),l.email&&n.jsx("div",{className:"invalid-feedback",children:l.email})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الهاتف *"}),n.jsx("input",{type:"tel",className:`form-control ${l.phone?"is-invalid":""}`,name:"phone",value:s.phone,onKeyPress:O=>{/[0-9+]/.test(O.key)||O.preventDefault()},onChange:O=>{const G=O.target.value.replace(/[^0-9+]/g,"");N({target:{name:"phone",value:G}})},placeholder:"+966 50 123 4567"}),l.phone&&n.jsx("div",{className:"invalid-feedback",children:l.phone})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"المدينة"}),n.jsx("input",{type:"text",className:"form-control",name:"city",value:s.city,onChange:N,placeholder:"المدينة"})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"العنوان"}),n.jsx("textarea",{className:"form-control",name:"address",value:s.address,onChange:N,rows:"2",placeholder:"أدخل عنوان الشركة"})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"الرقم الضريبي"}),n.jsx("input",{type:"text",className:"form-control",name:"taxNumber",value:s.taxNumber,onChange:N,placeholder:"الرقم الضريبي"})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الحساب المصرفي"}),n.jsx("input",{type:"text",className:"form-control",name:"bankAccount",value:s.bankAccount,onChange:N,placeholder:"رقم الحساب المصرفي"})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"ملاحظات"}),n.jsx("textarea",{className:"form-control",name:"notes",value:s.notes,onChange:N,rows:"3",placeholder:"أي ملاحظات إضافية..."})]}),n.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:n.jsxs("div",{className:"d-flex align-items-center gap-2",children:[n.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"نشط":"غير نشط"}),n.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"supplierActiveSwitch",name:"active",checked:s.active,onChange:N,style:{width:"50px",height:"25px",cursor:"pointer"}})]})})]})]}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsxs("div",{className:"d-flex gap-3",children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:t,disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"12px",height:"12px"}}),"حفظ..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),p?"تحديث":"حفظ"]})})]})})]})]})})})};function oF(){const[r,e]=j.useState(!1),[t,s]=j.useState(!1),[a,l]=j.useState(null),[c,u]=j.useState(0),{isTimelineVisible:m}=Hn(),p=()=>{e(!r)},b=()=>{l(null),s(!0)},w=O=>{l(O),s(!0)},N=()=>{s(!1),l(null),u(O=>O+1)},R=()=>{s(!1),l(null)};return n.jsx(un,{children:n.jsx(hn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Xn,{onToggle:p}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!m?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"الموردون"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"مورد محلي"})]})}),n.jsx(Jn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"suppliers-table",children:n.jsx(iF,{onAdd:b,onEdit:w,refreshTrigger:c})})})]}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]}),!r&&m&&n.jsx(Zn,{rtl:!0}),!r&&m&&n.jsx(es,{}),t&&n.jsx("div",{className:"supplier-form",children:n.jsx(aF,{supplier:a,onSave:N,onCancel:R})})]})})})}function lF(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(oF,{})})})}const cF=({onEdit:r,onAdd:e,refreshTrigger:t})=>{const[s,a]=j.useState([]),[l,c]=j.useState(!0),[u,m]=j.useState(null),[p,b]=j.useState(""),[w,N]=j.useState([]),[R,O]=j.useState(!1),{logActivity:G,getCurrentUser:U}=_n(),{alertConfig:T,closeAlert:ee,showSuccess:Z,showError:ie,showConfirm:X}=Cn(),{currentPage:pe,totalPages:H,paginatedItems:B,handlePageChange:k,resetPage:W,totalItems:J,itemsPerPage:z}=wa(w,30);j.useEffect(()=>{L()},[]),j.useEffect(()=>{t&&L()},[t]),j.useEffect(()=>{if(p.trim()){const V=s.filter(se=>se.name?.toLowerCase().includes(p.toLowerCase())||se.email?.toLowerCase().includes(p.toLowerCase())||se.phone?.includes(p));N(V)}else N(s);W()},[p,s,W]);const L=async()=>{try{c(!0);const V=await Zi.getAllSuppliers();a(V),m(null)}catch(V){m(V.message)}finally{c(!1)}},de=V=>{X(`هل أنت متأكد من حذف هذا المورد؟

${V.name}`,()=>Pe(V),"تأكيد حذف المورد")},Pe=async V=>{try{O(!0),await qn.moveToTrash(V,"foreignSuppliers"),await Zi.deleteSupplier(V.id);const se=U();G("task",`${se.name} حذف مورد أجنبي`,`تم حذف المورد: ${V.name}`),await L(),Z(`تم نقل المورد الأجنبي للمهملات بنجاح: ${V.name}`,"تم النقل للمهملات")}catch(se){m(se.message),ie(`فشل في نقل المورد للمهملات: ${se.message}`,"خطأ في النقل")}finally{O(!1)}};return l?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"spinner-border text-primary",role:"status",children:n.jsx("span",{className:"visually-hidden",children:"جار التحميل..."})}),n.jsx("p",{className:"mt-3 text-muted",children:"جار تحميل بيانات الموردين..."})]})}):u?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:u}),n.jsxs("button",{className:"btn btn-primary",onClick:L,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs("div",{className:"card shadow-sm","data-list":"foreign-suppliers",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-people-fill text-primary me-2"}),"قائمة الموردين (",w.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group suppliers-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في الموردين...",value:p,onChange:V=>b(V.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted"})})]}),n.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:e,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"إضافة مورد جديد"]})]})})]})}),n.jsxs("div",{className:"card-body p-0",children:[w.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-people fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد موردين"}),n.jsx("p",{className:"text-muted",children:p?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي موردين بعد"}),!p&&n.jsxs("button",{className:"btn btn-primary",onClick:e,children:[n.jsx("i",{className:"bi bi-plus-lg me-1"}),"إضافة أول مورد"]})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{style:{width:"60px"},children:"#"}),n.jsx("th",{children:"اسم المورد"}),n.jsx("th",{children:"البريد الإلكتروني"}),n.jsx("th",{children:"الهاتف"}),n.jsx("th",{children:"المدينة"}),n.jsx("th",{style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:B.map((V,se)=>n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(pe-1)*z+se+1})}),n.jsx("td",{children:n.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",onClick:()=>r(V),style:{textDecoration:"none"},title:`Internal ID: ${V.internalId||"Not Set"}`,children:V.name})}),n.jsx("td",{children:n.jsx("a",{href:`mailto:${V.email}`,className:"text-decoration-none",children:V.email})}),n.jsx("td",{style:{direction:"ltr",textAlign:"left"},children:V.phone}),n.jsx("td",{children:V.city||"-"}),n.jsx("td",{children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{className:"btn btn-outline-primary",onClick:()=>r(V),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{className:"btn btn-outline-danger",onClick:()=>de(V),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},V.internalId||V.id))})]})}),w.length>0&&n.jsx(va,{currentPage:pe,totalPages:H,onPageChange:k,totalItems:J,itemsPerPage:z})]}),n.jsx(Tn,{show:T.show,onClose:ee,title:T.title,message:T.message,type:T.type,onConfirm:T.onConfirm,confirmText:T.confirmText,cancelText:T.cancelText,showCancel:T.showCancel})]})},dF=({supplier:r,onSave:e,onCancel:t})=>{const[s,a]=j.useState({name:"",email:"",phone:"",address:"",city:"",website:"",bankAccount:"",notes:"",active:!0}),[l,c]=j.useState({}),[u,m]=j.useState(!1),p=!!r,{logActivity:b,getCurrentUser:w}=_n();j.useEffect(()=>{r&&a({name:r.name||"",email:r.email||"",phone:r.phone||"",address:r.address||"",city:r.city||"",website:r.website||"",bankAccount:r.bankAccount||"",notes:r.notes||"",active:r.active!==void 0?r.active:!0})},[r]);const N=O=>{const{name:G,value:U,type:T,checked:ee}=O.target;a(Z=>({...Z,[G]:T==="checkbox"?ee:U})),l[G]&&c(Z=>({...Z,[G]:""}))},R=async O=>{O.preventDefault();const G=Zi.validateSupplierData(s);if(Object.keys(G).length>0){c(G);return}m(!0),c({});try{const U=await oo.validateUniqueFields(s,p?r.id:null,p?"foreignSuppliers":null);if(Object.keys(U).length>0){c(U),m(!1);return}const T={...s,status:p&&r.status||"active"};if(p){await Zi.updateSupplier(r.id,T);const ee=w();b("task",`${ee.name} عدل مورد أجنبي`,`تم تعديل المورد: ${T.name}`)}else{await Zi.createSupplier(T);const ee=w();b("task",`${ee.name} أضاف مورد أجنبي`,`تم إضافة المورد: ${T.name}`)}e()}catch(U){c({submit:U.message})}finally{m(!1)}};return n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",children:[n.jsxs("div",{className:"modal-header",children:[n.jsxs("h5",{className:"modal-title",children:[n.jsx("i",{className:"bi bi-person-plus-fill text-primary me-2"}),p?"تعديل المورد":"إضافة مورد جديد"]}),n.jsx("button",{type:"button",className:"btn-close",onClick:t})]}),n.jsxs("form",{onSubmit:R,children:[n.jsxs("div",{className:"modal-body",children:[l.submit&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.submit]}),n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"اسم المورد *"}),n.jsx("input",{type:"text",className:`form-control ${l.name?"is-invalid":""}`,name:"name",value:s.name,onChange:N,placeholder:"أدخل اسم المورد"}),l.name&&n.jsx("div",{className:"invalid-feedback",children:l.name})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"البريد الإلكتروني *"}),n.jsx("input",{type:"email",className:`form-control ${l.email?"is-invalid":""}`,name:"email",value:s.email,onChange:N,placeholder:"example@company.com"}),l.email&&n.jsx("div",{className:"invalid-feedback",children:l.email})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الهاتف *"}),n.jsx("input",{type:"tel",className:`form-control ${l.phone?"is-invalid":""}`,name:"phone",value:s.phone,onKeyPress:O=>{/[0-9+]/.test(O.key)||O.preventDefault()},onChange:O=>{const G=O.target.value.replace(/[^0-9+]/g,"");N({target:{name:"phone",value:G}})},placeholder:"+966 50 123 4567"}),l.phone&&n.jsx("div",{className:"invalid-feedback",children:l.phone})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"المدينة"}),n.jsx("input",{type:"text",className:"form-control",name:"city",value:s.city,onChange:N,placeholder:"المدينة"})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"العنوان"}),n.jsx("textarea",{className:"form-control",name:"address",value:s.address,onChange:N,rows:"2",placeholder:"أدخل عنوان الشركة"})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"الموقع الإلكتروني"}),n.jsx("input",{type:"url",className:"form-control",name:"website",value:s.website,onChange:N,placeholder:"https://www.company.com"})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الحساب المصرفي"}),n.jsx("input",{type:"text",className:"form-control",name:"bankAccount",value:s.bankAccount,onChange:N,placeholder:"رقم الحساب المصرفي"})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"ملاحظات"}),n.jsx("textarea",{className:"form-control",name:"notes",value:s.notes,onChange:N,rows:"3",placeholder:"أي ملاحظات إضافية..."})]}),n.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:n.jsxs("div",{className:"d-flex align-items-center gap-2",children:[n.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"نشط":"غير نشط"}),n.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"foreignSupplierActiveSwitch",name:"active",checked:s.active,onChange:N,style:{width:"50px",height:"25px",cursor:"pointer"}})]})})]})]}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsxs("div",{className:"d-flex gap-3",children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:t,disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"12px",height:"12px"}}),"حفظ..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),p?"تحديث":"حفظ"]})})]})})]})]})})})};function uF(){const[r,e]=j.useState(!1),[t,s]=j.useState(!1),[a,l]=j.useState(null),[c,u]=j.useState(0),{isTimelineVisible:m}=Hn(),p=()=>{e(!r)},b=()=>{l(null),s(!0)},w=O=>{l(O),s(!0)},N=()=>{s(!1),l(null),u(O=>O+1)},R=()=>{s(!1),l(null)};return n.jsx(un,{children:n.jsx(hn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Xn,{onToggle:p}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!m?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"الموردون"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"مورد أجنبي"})]})}),n.jsx(Jn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"suppliers-table",children:n.jsx(cF,{onAdd:b,onEdit:w,refreshTrigger:c})})})]}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]}),!r&&m&&n.jsx(Zn,{rtl:!0}),!r&&m&&n.jsx(es,{}),t&&n.jsx("div",{className:"supplier-form",children:n.jsx(dF,{supplier:a,onSave:N,onCancel:R})})]})})})}function hF(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(uF,{})})})}const nd="customers";class Ou{static async getAllCustomers(){try{const e=dt(Ce,nd),t=Gt(e,ps("createdAt","desc"));return(await At(t)).docs.map(a=>{const l=a.data();return{id:a.id,internalId:l.internalId||kt("CUSTOMER"),...l,createdAt:l.createdAt?.toDate(),updatedAt:l.updatedAt?.toDate()}})}catch(e){throw console.error("Error fetching customers:",e),new Error("فشل في جلب بيانات العملاء")}}static async createCustomer(e){try{const t=kt("CUSTOMER"),s={...e,internalId:t,createdAt:_t(),updatedAt:_t()};return(await Mr(dt(Ce,nd),s)).id}catch(t){throw console.error("Error creating customer:",t),new Error("فشل في إنشاء العميل")}}static async updateCustomer(e,t){try{const s=ht(Ce,nd,e),a={...t,updatedAt:_t()};return await Zs(s,a),!0}catch(s){throw console.error("Error updating customer:",s),new Error("فشل في تحديث بيانات العميل")}}static async getCustomerById(e){try{const t=ht(Ce,nd,e),s=await hs(t);if(s.exists()){const a=s.data();return{id:s.id,internalId:a.internalId||kt("CUSTOMER"),...a,createdAt:a.createdAt?.toDate(),updatedAt:a.updatedAt?.toDate()}}else return null}catch(t){throw console.error("Error fetching customer by ID:",t),new Error("فشل في جلب بيانات العميل")}}static async getCustomerByInternalId(e){try{const t=dt(Ce,nd),s=Gt(t,Sn("internalId","==",e)),a=await At(s);if(a.empty)return null;{const l=a.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:c.createdAt?.toDate(),updatedAt:c.updatedAt?.toDate()}}}catch(t){throw console.error("Error fetching customer by internal ID:",t),new Error("فشل في جلب بيانات العميل")}}static async updateCustomerByInternalId(e,t){try{const s=await this.getCustomerByInternalId(e);if(!s)throw new Error("Customer not found");return await this.updateCustomer(s.id,t)}catch(s){throw console.error("Error updating customer by internal ID:",s),new Error("فشل في تحديث بيانات العميل")}}static async deleteCustomer(e){try{const t=ht(Ce,nd,e);return await er(t),!0}catch(t){throw console.error("Error deleting customer:",t),new Error("فشل في حذف العميل")}}static async deleteCustomerByInternalId(e){try{const t=await this.getCustomerByInternalId(e);if(!t)throw new Error("Customer not found");return await this.deleteCustomer(t.id)}catch(t){throw console.error("Error deleting customer by internal ID:",t),new Error("فشل في حذف العميل")}}static async searchCustomers(e){try{const t=dt(Ce,nd);return(await At(t)).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||kt("CUSTOMER"),...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate()}}).filter(c=>c.name?.toLowerCase().includes(e.toLowerCase())||c.email?.toLowerCase().includes(e.toLowerCase())||c.phone?.includes(e))}catch(t){throw console.error("Error searching customers:",t),new Error("فشل في البحث عن العملاء")}}static async migrateExistingData(){try{console.log("Starting customers migration...");const e=await this.getAllCustomers();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("cst_")){const a=kt("CUSTOMER");await this.updateCustomer(s.id,{...s,internalId:a}),t++,console.log(`Migrated customer: ${s.name} -> ${a}`)}return console.log(`Migration completed. ${t} customers migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("فشل في ترحيل البيانات")}}static validateCustomerData(e){const t={};return e.name?.trim()||(t.name="اسم العميل مطلوب"),e.email?.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(t.email="صيغة البريد الإلكتروني غير صحيحة"):t.email="البريد الإلكتروني مطلوب",e.phone?.trim()||(t.phone="رقم الهاتف مطلوب"),t}}const mF=Object.freeze(Object.defineProperty({__proto__:null,CustomerService:Ou},Symbol.toStringTag,{value:"Module"})),fF=({onEdit:r,onAdd:e,refreshTrigger:t})=>{const[s,a]=j.useState([]),[l,c]=j.useState(!0),[u,m]=j.useState(null),[p,b]=j.useState(""),[w,N]=j.useState([]),[R,O]=j.useState(!1),{logActivity:G,getCurrentUser:U}=_n(),{alertConfig:T,closeAlert:ee,showSuccess:Z,showError:ie,showConfirm:X}=Cn(),{currentPage:pe,totalPages:H,paginatedItems:B,handlePageChange:k,resetPage:W,totalItems:J,itemsPerPage:z}=wa(w,30);j.useEffect(()=>{L()},[]),j.useEffect(()=>{t&&L()},[t]),j.useEffect(()=>{if(p.trim()){const V=s.filter(se=>se.name?.toLowerCase().includes(p.toLowerCase())||se.email?.toLowerCase().includes(p.toLowerCase())||se.phone?.includes(p));N(V)}else N(s);W()},[p,s,W]);const L=async()=>{try{c(!0);const V=await Ou.getAllCustomers();a(V),m(null)}catch(V){m(V.message)}finally{c(!1)}},de=V=>{X(`هل أنت متأكد من حذف هذا العميل؟

${V.name}`,()=>Pe(V),"تأكيد حذف العميل")},Pe=async V=>{try{O(!0),await qn.moveToTrash(V,"customers"),await Ou.deleteCustomer(V.id);const se=U();G("task",`${se.name} حذف عميل`,`تم حذف العميل: ${V.name}`),await L(),Z(`تم نقل العميل للمهملات: ${V.name}`,"تم النقل للمهملات")}catch(se){m(se.message),ie(`فشل في نقل العميل للمهملات: ${se.message}`,"خطأ في النقل")}finally{O(!1)}};return l?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"spinner-border text-primary",role:"status",children:n.jsx("span",{className:"visually-hidden",children:"جار التحميل..."})}),n.jsx("p",{className:"mt-3 text-muted",children:"جار تحميل بيانات العملاء..."})]})}):u?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:u}),n.jsxs("button",{className:"btn btn-primary",onClick:L,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs("div",{className:"card shadow-sm","data-list":"customers",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-person-lines-fill text-primary me-2"}),"قائمة العملاء (",w.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group customers-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في العملاء...",value:p,onChange:V=>b(V.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted"})})]}),n.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:e,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"إضافة عميل جديد"]})]})})]})}),n.jsxs("div",{className:"card-body p-0",children:[w.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-person-lines-fill fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد عملاء"}),n.jsx("p",{className:"text-muted",children:p?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي عملاء بعد"}),!p&&n.jsxs("button",{className:"btn btn-primary",onClick:e,children:[n.jsx("i",{className:"bi bi-plus-lg me-1"}),"إضافة أول عميل"]})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{style:{width:"60px"},children:"#"}),n.jsx("th",{children:"اسم العميل"}),n.jsx("th",{children:"البريد الإلكتروني"}),n.jsx("th",{children:"الهاتف"}),n.jsx("th",{children:"المدينة"}),n.jsx("th",{style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:B.map((V,se)=>n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(pe-1)*z+se+1})}),n.jsx("td",{children:n.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",onClick:()=>r(V),style:{textDecoration:"none"},title:`Internal ID: ${V.internalId||"Not Set"}`,children:V.name})}),n.jsx("td",{children:n.jsx("a",{href:`mailto:${V.email}`,className:"text-decoration-none",children:V.email})}),n.jsx("td",{children:V.phone}),n.jsx("td",{children:V.city||"-"}),n.jsx("td",{children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{className:"btn btn-outline-primary",onClick:()=>r(V),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{className:"btn btn-outline-danger",onClick:()=>de(V),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},V.internalId||V.id))})]})}),w.length>0&&n.jsx(va,{currentPage:pe,totalPages:H,onPageChange:k,totalItems:J,itemsPerPage:z})]}),n.jsx(Tn,{show:T.show,onClose:ee,title:T.title,message:T.message,type:T.type,onConfirm:T.onConfirm,confirmText:T.confirmText,cancelText:T.cancelText,showCancel:T.showCancel})]})},pF=({customer:r,onSave:e,onCancel:t})=>{const[s,a]=j.useState({name:"",email:"",phone:"",address:"",city:"",taxNumber:"",bankAccount:"",notes:"",active:!0}),[l,c]=j.useState({}),[u,m]=j.useState(!1),p=!!r,{logActivity:b,getCurrentUser:w}=_n();j.useEffect(()=>{r&&a({name:r.name||"",email:r.email||"",phone:r.phone||"",address:r.address||"",city:r.city||"",taxNumber:r.taxNumber||"",bankAccount:r.bankAccount||"",notes:r.notes||"",active:r.active!==void 0?r.active:!0})},[r]);const N=O=>{const{name:G,value:U,type:T,checked:ee}=O.target;a(Z=>({...Z,[G]:T==="checkbox"?ee:U})),l[G]&&c(Z=>({...Z,[G]:""}))},R=async O=>{O.preventDefault();const G=Ou.validateCustomerData(s);if(Object.keys(G).length>0){c(G);return}m(!0),c({});try{const U=await oo.validateUniqueFields(s,p?r.id:null,p?"customers":null);if(Object.keys(U).length>0){c(U),m(!1);return}const T={...s,status:p&&r.status||"active"};if(p){await Ou.updateCustomer(r.id,T);const ee=w();b("task",`${ee.name} عدل عميل`,`تم تعديل العميل: ${T.name}`)}else{await Ou.createCustomer(T);const ee=w();b("task",`${ee.name} أضاف عميل`,`تم إضافة العميل: ${T.name}`)}e()}catch(U){c({submit:U.message})}finally{m(!1)}};return n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",children:[n.jsxs("div",{className:"modal-header",children:[n.jsxs("h5",{className:"modal-title",children:[n.jsx("i",{className:"bi bi-person-plus-fill text-primary me-2"}),p?"تعديل العميل":"إضافة عميل جديد"]}),n.jsx("button",{type:"button",className:"btn-close",onClick:t})]}),n.jsxs("form",{onSubmit:R,children:[n.jsxs("div",{className:"modal-body",children:[l.submit&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.submit]}),n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"اسم العميل *"}),n.jsx("input",{type:"text",className:`form-control ${l.name?"is-invalid":""}`,name:"name",value:s.name,onChange:N,placeholder:"أدخل اسم العميل"}),l.name&&n.jsx("div",{className:"invalid-feedback",children:l.name})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"البريد الإلكتروني *"}),n.jsx("input",{type:"email",className:`form-control ${l.email?"is-invalid":""}`,name:"email",value:s.email,onChange:N,placeholder:"example@company.com"}),l.email&&n.jsx("div",{className:"invalid-feedback",children:l.email})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الهاتف *"}),n.jsx("input",{type:"tel",className:`form-control ${l.phone?"is-invalid":""}`,name:"phone",value:s.phone,onKeyPress:O=>{/[0-9+]/.test(O.key)||O.preventDefault()},onChange:O=>{const G=O.target.value.replace(/[^0-9+]/g,"");N({target:{name:"phone",value:G}})},placeholder:"+966 50 123 4567"}),l.phone&&n.jsx("div",{className:"invalid-feedback",children:l.phone})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"المدينة"}),n.jsx("input",{type:"text",className:"form-control",name:"city",value:s.city,onChange:N,placeholder:"المدينة"})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"العنوان"}),n.jsx("textarea",{className:"form-control",name:"address",value:s.address,onChange:N,rows:"2",placeholder:"أدخل عنوان الشركة"})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"الرقم الضريبي"}),n.jsx("input",{type:"text",className:"form-control",name:"taxNumber",value:s.taxNumber,onChange:N,placeholder:"الرقم الضريبي"})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الحساب المصرفي"}),n.jsx("input",{type:"text",className:"form-control",name:"bankAccount",value:s.bankAccount,onChange:N,placeholder:"رقم الحساب المصرفي"})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"ملاحظات"}),n.jsx("textarea",{className:"form-control",name:"notes",value:s.notes,onChange:N,rows:"3",placeholder:"أي ملاحظات إضافية..."})]}),n.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:n.jsxs("div",{className:"d-flex align-items-center gap-2",children:[n.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"نشط":"غير نشط"}),n.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"customerActiveSwitch",name:"active",checked:s.active,onChange:N,style:{width:"50px",height:"25px",cursor:"pointer"}})]})})]})]}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsxs("div",{className:"d-flex gap-3",children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:t,disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"12px",height:"12px"}}),"حفظ..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),p?"تحديث":"حفظ"]})})]})})]})]})})})};function gF(){const[r,e]=j.useState(!1),[t,s]=j.useState(!1),[a,l]=j.useState(null),[c,u]=j.useState(0),{isTimelineVisible:m}=Hn(),p=()=>{e(!r)},b=()=>{l(null),s(!0)},w=O=>{l(O),s(!0)},N=()=>{s(!1),l(null),u(O=>O+1)},R=()=>{s(!1),l(null)};return n.jsx(un,{children:n.jsx(hn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Xn,{onToggle:p}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!m?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"العملاء"})]})}),n.jsx(Jn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"customers-table",children:n.jsx(fF,{onAdd:b,onEdit:w,refreshTrigger:c})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&m&&n.jsx(Zn,{rtl:!0}),!r&&m&&n.jsx(es,{}),t&&n.jsx("div",{className:"customer-form",children:n.jsx(pF,{customer:a,onSave:N,onCancel:R})})]})})})}function xF(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(gF,{})})})}class qo{static getCurrentUserUID(){if(!sn.currentUser)throw new Error("يجب تسجيل الدخول للوصول إلى البيانات");return sn.currentUser.uid}static async validateActiveEmployee(){const e=this.getCurrentUserUID();try{const t=await hs(ht(Ce,"employees",e));if(!t.exists())throw new Error("لا يوجد سجل موظف لهذا المستخدم");const s=t.data();if(s.status!=="active")throw new Error("حساب الموظف غير مفعل");return{uid:e,employeeData:s}}catch(t){throw new Error(`فشل التحقق من صلاحيات الموظف: ${t.message}`)}}static async secureCollection(e){return await this.validateActiveEmployee(),dt(Ce,e)}static async secureDoc(e,t){return await this.validateActiveEmployee(),ht(Ce,e,t)}static async secureAddDoc(e,t,s={}){const{uid:a}=await this.validateActiveEmployee(),l={...t,createdBy:a,createdAt:new Date().toISOString(),updatedBy:a,updatedAt:new Date().toISOString(),...s.additionalFields},c=dt(Ce,e);return await Mr(c,l)}static async secureSetDoc(e,t,s,a={}){const{uid:l}=await this.validateActiveEmployee(),c={...s,createdBy:l,createdAt:new Date().toISOString(),updatedBy:l,updatedAt:new Date().toISOString(),...a.additionalFields},u=ht(Ce,e,t);return await sh(u,c,a.merge?{merge:!0}:{})}static async secureGetDoc(e,t){await this.validateActiveEmployee();const s=ht(Ce,e,t);return await hs(s)}static async secureGetDocs(e,t=[]){await this.validateActiveEmployee();const s=dt(Ce,e);let a=s;return t.length>0&&(a=Gt(s,...t)),await At(a)}static async secureUpdateDoc(e,t,s,a={}){const{uid:l}=await this.validateActiveEmployee(),c={...s,updatedBy:l,updatedAt:new Date().toISOString(),...a.additionalFields},u=ht(Ce,e,t);return await Zs(u,c)}static async secureDeleteDoc(e,t,s={}){const{uid:a}=await this.validateActiveEmployee();if(s.hardDelete){const l=ht(Ce,e,t);return await er(l)}else return await this.secureUpdateDoc(e,t,{isDeleted:!0,deletedBy:a,deletedAt:new Date().toISOString()})}static async secureOnSnapshot(e,t,s=[]){await this.validateActiveEmployee();const a=dt(Ce,e);let l=a;return s.length>0&&(l=Gt(a,...s)),vf(l,t)}static async secureBatchWrite(e){const{uid:t}=await this.validateActiveEmployee(),s=Zo(Ce);return e.forEach(a=>{const l=ht(Ce,a.collection,a.id);if(a.type==="set"){const c={...a.data,createdBy:t,createdAt:new Date().toISOString(),updatedBy:t,updatedAt:new Date().toISOString()};s.set(l,c)}else if(a.type==="update"){const c={...a.data,updatedBy:t,updatedAt:new Date().toISOString()};s.update(l,c)}else a.type==="delete"&&s.delete(l)}),await s.commit()}static async secureTransaction(e){const{uid:t}=await this.validateActiveEmployee();return await p0(Ce,s=>e(s,t))}static async createEmployeeDoc(e,t=null){const s=this.getCurrentUserUID(),a=t||s;t&&t!==s&&await this.validateActiveEmployee();const l={...e,createdBy:s,createdAt:new Date().toISOString(),updatedBy:s,updatedAt:new Date().toISOString()},c=ht(Ce,"employees",a);return await sh(c,l)}static async updateOwnEmployeeDoc(e){const t=this.getCurrentUserUID(),s={...e,updatedBy:t,updatedAt:new Date().toISOString()},a=ht(Ce,"employees",t);return await Zs(a,s)}static async getOwnEmployeeDoc(){const e=this.getCurrentUserUID(),t=ht(Ce,"employees",e);return await hs(t)}}const sd="companies";class nf{static async getAllCompanies(){try{let e=[];try{e.push(ps("createdAt","desc"))}catch{console.log("Using query without orderBy for empty collection"),e=[]}const s=(await qo.secureGetDocs(sd,e)).docs.map(a=>{const l=a.data();return{id:a.id,internalId:l.internalId||kt("COMPANY"),...l,createdAt:l.createdAt?.toDate(),updatedAt:l.updatedAt?.toDate()}});return s.length>0&&s[0].createdAt&&s.sort((a,l)=>(l.createdAt||new Date(0))-(a.createdAt||new Date(0))),s}catch(e){if(console.error("Error fetching companies:",e),e.code==="failed-precondition"||e.code==="not-found")return console.log("Companies collection not found, returning empty array"),[];throw new Error("فشل في تحميل الشركات")}}static async createCompany(e){try{const t=kt("COMPANY"),s={...e,internalId:t,createdAt:_t(),updatedAt:_t()};return(await Mr(dt(Ce,sd),s)).id}catch(t){throw console.error("Error creating company:",t),new Error("فشل في إنشاء الشركة")}}static async updateCompany(e,t){try{const s=ht(Ce,sd,e),a={...t,updatedAt:_t()};return await Zs(s,a),!0}catch(s){throw console.error("Error updating company:",s),new Error("فشل في تحديث بيانات الشركة")}}static async getCompanyById(e){try{const t=ht(Ce,sd,e),s=await hs(t);if(s.exists()){const a=s.data();return{id:s.id,internalId:a.internalId||kt("COMPANY"),...a,createdAt:a.createdAt?.toDate(),updatedAt:a.updatedAt?.toDate()}}else return null}catch(t){throw console.error("Error fetching company by ID:",t),new Error("فشل في جلب بيانات الشركة")}}static async getCompanyByInternalId(e){try{const t=dt(Ce,sd),s=Gt(t,Sn("internalId","==",e)),a=await At(s);if(a.empty)return null;{const l=a.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:c.createdAt?.toDate(),updatedAt:c.updatedAt?.toDate()}}}catch(t){throw console.error("Error fetching company by internal ID:",t),new Error("فشل في جلب بيانات الشركة")}}static async updateCompanyByInternalId(e,t){try{const s=await this.getCompanyByInternalId(e);if(!s)throw new Error("Company not found");return await this.updateCompany(s.id,t)}catch(s){throw console.error("Error updating company by internal ID:",s),new Error("فشل في تحديث بيانات الشركة")}}static async deleteCompany(e){try{const t=ht(Ce,sd,e);return await er(t),!0}catch(t){throw console.error("Error deleting company:",t),new Error("فشل في حذف الشركة")}}static async deleteCompanyByInternalId(e){try{const t=await this.getCompanyByInternalId(e);if(!t)throw new Error("Company not found");return await this.deleteCompany(t.id)}catch(t){throw console.error("Error deleting company by internal ID:",t),new Error("فشل في حذف الشركة")}}static async searchCompanies(e){try{const t=dt(Ce,sd);return(await At(t)).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||kt("COMPANY"),...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate()}}).filter(c=>c.name?.toLowerCase().includes(e.toLowerCase())||c.email?.toLowerCase().includes(e.toLowerCase())||c.phone?.includes(e))}catch(t){throw console.error("Error searching companies:",t),new Error("فشل في البحث عن الشركات")}}static async migrateExistingData(){try{console.log("Starting companies migration...");const e=await this.getAllCompanies();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("comp_")){const a=kt("COMPANY");await this.updateCompany(s.id,{...s,internalId:a}),t++,console.log(`Migrated company: ${s.name} -> ${a}`)}return console.log(`Migration completed. ${t} companies migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("فشل في ترحيل البيانات")}}static validateCompanyData(e){const t={};return e.name?.trim()||(t.name="اسم الشركة مطلوب"),e.email?.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(t.email="صيغة البريد الإلكتروني غير صحيحة"):t.email="البريد الإلكتروني مطلوب",e.phone?.trim()||(t.phone="رقم الهاتف مطلوب"),t}}const yF=({onEdit:r,onAdd:e,refreshTrigger:t})=>{const[s,a]=j.useState([]),[l,c]=j.useState(!0),[u,m]=j.useState(null),[p,b]=j.useState(""),[w,N]=j.useState([]),[R,O]=j.useState(!1),{logActivity:G,getCurrentUser:U}=_n(),{alertConfig:T,closeAlert:ee,showSuccess:Z,showError:ie,showConfirm:X}=Cn(),{currentPage:pe,totalPages:H,paginatedItems:B,handlePageChange:k,resetPage:W,totalItems:J,itemsPerPage:z}=wa(w,30);j.useEffect(()=>{L()},[]),j.useEffect(()=>{t&&L()},[t]),j.useEffect(()=>{if(p.trim()){const V=s.filter(se=>se.name?.toLowerCase().includes(p.toLowerCase())||se.email?.toLowerCase().includes(p.toLowerCase())||se.phone?.includes(p));N(V)}else N(s);W()},[p,s,W]);const L=async()=>{try{c(!0);const V=await nf.getAllCompanies();a(V),m(null)}catch(V){m(V.message)}finally{c(!1)}},de=V=>{X(`هل أنت متأكد من حذف هذه الشركة؟

${V.name}`,()=>Pe(V),"تأكيد حذف الشركة")},Pe=async V=>{try{O(!0),await qn.moveToTrash(V,"companies"),await nf.deleteCompany(V.id);const se=U();G("task",`${se.name} حذف شركة`,`تم حذف الشركة: ${V.name}`),await L(),Z(`تم نقل الشركة للمهملات: ${V.name}`,"تم النقل للمهملات")}catch(se){m(se.message),ie(`فشل في نقل الشركة للمهملات: ${se.message}`,"خطأ في النقل")}finally{O(!1)}};return l?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"spinner-border text-primary",role:"status",children:n.jsx("span",{className:"visually-hidden",children:"جار التحميل..."})}),n.jsx("p",{className:"mt-3 text-muted",children:"جار تحميل بيانات الشركات..."})]})}):u?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:u}),n.jsxs("button",{className:"btn btn-primary",onClick:L,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs("div",{className:"card shadow-sm","data-list":"companies",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-building-fill text-primary me-2"}),"قائمة الشركات (",w.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group suppliers-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في الشركات...",value:p,onChange:V=>b(V.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted"})})]}),n.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:e,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"إضافة شركة جديدة"]})]})})]})}),n.jsxs("div",{className:"card-body p-0",children:[w.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-building fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد شركات"}),n.jsx("p",{className:"text-muted",children:p?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي شركات بعد"}),!p&&n.jsxs("button",{className:"btn btn-primary",onClick:e,children:[n.jsx("i",{className:"bi bi-plus-lg me-1"}),"إضافة أول شركة"]})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{style:{width:"60px"},children:"#"}),n.jsx("th",{children:"اسم الشركة"}),n.jsx("th",{children:"البريد الإلكتروني"}),n.jsx("th",{children:"الهاتف"}),n.jsx("th",{children:"المدينة"}),n.jsx("th",{style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:B.map((V,se)=>n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(pe-1)*z+se+1})}),n.jsx("td",{children:n.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",onClick:()=>r(V),style:{textDecoration:"none"},title:`Internal ID: ${V.internalId||"Not Set"}`,children:V.name})}),n.jsx("td",{children:n.jsx("a",{href:`mailto:${V.email}`,className:"text-decoration-none",children:V.email})}),n.jsx("td",{style:{direction:"ltr",textAlign:"left"},children:V.phone}),n.jsx("td",{children:V.city||"-"}),n.jsx("td",{children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{className:"btn btn-outline-primary",onClick:()=>r(V),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{className:"btn btn-outline-danger",onClick:()=>de(V),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},V.internalId||V.id))})]})}),w.length>0&&n.jsx(va,{currentPage:pe,totalPages:H,onPageChange:k,totalItems:J,itemsPerPage:z})]}),n.jsx(Tn,{show:T.show,onClose:ee,title:T.title,message:T.message,type:T.type,onConfirm:T.onConfirm,confirmText:T.confirmText,cancelText:T.cancelText,showCancel:T.showCancel})]})};class fd{static collectionName="companydocuments";static storagePath="company-documents";static async withRetry(e,{retries:t=5,base:s=150}={}){let a=0;for(;;)try{return await e()}catch(l){if(a++,a>t)throw l;const c=Math.floor(s*Math.pow(2,a-1)+Math.random()*s);await new Promise(u=>setTimeout(u,c))}}static async uploadDocument(e,{companyId:t,companyName:s="",companyEmail:a="",customFileName:l,expiryDate:c,userId:u}={}){console.log("📤 Starting company document upload:",e.name);try{if(!sn.currentUser)throw new Error("يجب تسجيل الدخول لرفع الوثائق");const m=u||sn.currentUser.uid,p=await Mr(dt(Ce,this.collectionName),{fileName:l||e.name,originalFileName:e.name,size:e.size,fileSize:e.size,contentType:e.type||"application/octet-stream",fileType:e.type||"application/octet-stream",status:"uploading",isTrashed:!1,companyId:t||"new",companyName:s,companyEmail:a,expiryDate:c||null,createdAt:_t(),updatedAt:_t(),trashedAt:null,trashedBy:null,uploadedBy:m,url:null,fileURL:null,storagePath:null});console.log("✅ Company document shell created:",p.id),console.log("🔄 About to call fileStorageService.uploadFile with:",{fileName:e.name,fileSize:e.size,folder:"company-documents"});const b=await _r.uploadFile(e,"company-documents");return console.log("✅ File uploaded to storage:",b.path),await Zs(ht(Ce,this.collectionName,p.id),{url:b.url,fileURL:b.url,storagePath:b.path,status:"ready",updatedAt:_t()}),console.log("✅ Company document upload completed:",p.id),{id:p.id,fileName:l||e.name,originalFileName:e.name,url:b.url,fileURL:b.url,storagePath:b.path,size:e.size,fileSize:e.size,contentType:e.type||"application/octet-stream",fileType:e.type||"application/octet-stream"}}catch(m){throw console.error("❌ Company document upload failed:",m),new Error(`فشل في رفع وثيقة الشركة: ${m.message}`)}}static async moveDocumentToTrash(e,{userId:t}={}){const s=t||sn.currentUser?.uid||"system";console.log("🗑️ Moving company document to trash:",{documentId:e,userId:s,collection:this.collectionName});try{await this.withRetry(async()=>{await p0(Ce,async a=>{const l=ht(Ce,this.collectionName,e),c=await a.get(l);if(console.log("📄 Document lookup result:",{documentId:e,exists:c.exists(),collection:this.collectionName}),!c.exists())throw console.error("❌ Document not found in Firebase:",{documentId:e,collection:this.collectionName,attemptedPath:`${this.collectionName}/${e}`}),new Error(`وثيقة الشركة غير موجودة في قاعدة البيانات (ID: ${e})`);const u=c.data();if(console.log("📊 Document data:",{fileName:u.fileName,isTrashed:u.isTrashed,status:u.status}),u.isTrashed===!0){console.log("Company document already trashed - idempotent operation");return}a.update(l,{isTrashed:!0,trashedAt:_t(),trashedBy:s,updatedAt:_t()})})}),console.log("✅ Company document moved to trash successfully")}catch(a){throw console.error("❌ Error moving company document to trash:",{documentId:e,error:a.message,stack:a.stack}),a.message.includes("وثيقة الشركة غير موجودة")?a:new Error(`فشل في نقل وثيقة الشركة للمهملات: ${a.message}`)}}static async restoreDocumentFromTrash(e){console.log("♻️ Restoring company document from trash:",e),await this.withRetry(async()=>{await p0(Ce,async t=>{const s=ht(Ce,this.collectionName,e),a=await t.get(s);if(!a.exists())throw new Error("وثيقة الشركة غير موجودة");if(a.data().isTrashed===!1){console.log("Company document already active - idempotent operation");return}t.update(s,{isTrashed:!1,trashedAt:null,trashedBy:null,updatedAt:_t()})})}),console.log("✅ Company document restored from trash successfully")}static subscribeToCompanyDocuments(e,t){console.log("📡 Setting up Firebase subscription for companyId:",e);const s=Gt(dt(Ce,this.collectionName),Sn("companyId","==",e),Sn("isTrashed","==",!1));return console.log("📡 Firebase query created for company documents:",{collection:this.collectionName,companyId:e,filters:["companyId ==",e,"isTrashed ==",!1]}),vf(s,a=>{console.log("📡 Firebase snapshot received for company documents:"),console.log("- Snapshot size:",a.size),console.log("- Snapshot empty:",a.empty);const l=[];a.forEach(c=>{const u=c.data(),m={id:c.id,...u,fileURL:u.fileURL||u.url,fileType:u.fileType||u.contentType,fileSize:u.fileSize||u.size};console.log("- Company document found:",{id:c.id,fileName:m.fileName,companyId:m.companyId,isTrashed:m.isTrashed,status:m.status,hasURL:!!m.fileURL,hasExpiryDate:!!m.expiryDate}),l.push(m)}),l.sort((c,u)=>{const m=c.updatedAt?.seconds||0;return(u.updatedAt?.seconds||0)-m}),console.log("📡 Calling callback with",l.length,"company documents (sorted manually)"),t(l)},a=>{console.error("❌ Company document subscription error:",a),console.error("Error details:",{code:a.code,message:a.message,companyId:e,collection:this.collectionName}),t([])})}static subscribeToTrashedDocuments(e){const t=Gt(dt(Ce,this.collectionName),Sn("isTrashed","==",!0));return vf(t,s=>{const a=[];s.forEach(l=>{a.push({id:l.id,...l.data()})}),a.sort((l,c)=>{const u=l.updatedAt?.seconds||0;return(c.updatedAt?.seconds||0)-u}),e(a)},s=>{console.error("Company trashed documents subscription error:",s),e([])})}static async getCompanyDocuments(e){try{console.log("🔍 Getting company documents for ID:",e);const t=Gt(dt(Ce,this.collectionName),Sn("companyId","==",e),Sn("isTrashed","==",!1)),s=await At(t),a=[];return s.forEach(l=>{const c=l.data(),u={id:l.id,...c,fileURL:c.fileURL||c.url,fileType:c.fileType||c.contentType,fileSize:c.fileSize||c.size};console.log("📄 Found document:",u.fileName,"for company:",u.companyId),a.push(u)}),console.log(`📊 Total documents found for company ${e}: ${a.length}`),a.sort((l,c)=>{const u=l.updatedAt?.seconds||0;return(c.updatedAt?.seconds||0)-u}),a}catch(t){throw console.error("Error getting company documents:",t),new Error(`فشل في تحميل وثائق الشركة: ${t.message}`)}}static async getAllDocuments(){try{const e=await At(dt(Ce,this.collectionName)),t=[];return e.forEach(s=>{t.push({id:s.id,...s.data()})}),t.sort((s,a)=>{const l=s.updatedAt?.seconds||0;return(a.updatedAt?.seconds||0)-l}),t}catch(e){throw console.error("Error getting all company documents:",e),new Error(`فشل في تحميل جميع وثائق الشركات: ${e.message}`)}}static async getTrashedDocuments(){try{const e=Gt(dt(Ce,this.collectionName),Sn("isTrashed","==",!0)),t=await At(e),s=[];return t.forEach(a=>{s.push({id:a.id,...a.data()})}),s.sort((a,l)=>{const c=a.updatedAt?.seconds||0;return(l.updatedAt?.seconds||0)-c}),s}catch(e){throw console.error("Error getting trashed company documents:",e),new Error(`فشل في تحميل مهملات وثائق الشركة: ${e.message}`)}}static async permanentlyDeleteDocuments(e=[]){if(!e.length)return;console.log("🔥 Permanently deleting company documents:",e);const t=Zo(Ce),s=e.map(c=>ht(Ce,this.collectionName,c)),a=await Promise.all(s.map(c=>hs(c))),l=[];a.forEach(c=>{if(!c.exists())return;const u=c.data();if(u.isTrashed===!0&&(t.delete(ht(Ce,this.collectionName,c.id)),u.storagePath)){const m=Wo(ri,u.storagePath);l.push(Fx(m).catch(p=>{console.warn("Storage delete failed (continuing):",p)}))}}),await t.commit(),await Promise.allSettled(l),console.log("✅ Company documents permanently deleted")}static async updateDocumentCompanyId(e,t,s={}){console.log("🔄 Updating company documents from temp ID to real ID:",{oldCompanyId:e,newCompanyId:t,companyName:s.name});try{const a=Gt(dt(Ce,this.collectionName),Sn("companyId","==",e),Sn("isTrashed","==",!1)),l=await At(a);if(l.empty)return console.log("No documents found with old company ID:",e),0;console.log(`Found ${l.size} documents to update company ID`);const c=[];return l.forEach(u=>{const m={companyId:t,companyName:s.name||"",companyEmail:s.email||"",updatedAt:_t()};c.push(Zs(ht(Ce,this.collectionName,u.id),m))}),await Promise.all(c),console.log(`✅ Updated ${l.size} documents with new company ID:`,t),l.size}catch(a){throw console.error("❌ Error updating document company IDs:",a),new Error(`فشل في ربط الوثائق بالشركة: ${a.message}`)}}static async deleteDocument(e){return await this.moveDocumentToTrash(e)}}const bF=({expiryDate:r,className:e="",style:t={}})=>{const[s,a]=j.useState("00"),[l,c]=j.useState(!1);return j.useEffect(()=>{if(!r){a("00"),c(!1);return}const u=()=>{try{const p=new Date,[b,w,N]=r.split("-").map(Number),O=new Date(b,w-1,N,23,59,59).getTime()-p.getTime();if(O<=0){a("00"),c(!0);return}const G=Math.floor(O/1e3),U=Math.floor(G/(1440*60)),ee=(Z=>Z.toString().padStart(2,"0"))(U);a(ee),c(!1)}catch(p){console.error("CountdownTimer error:",p),a("--"),c(!1)}};u();const m=setInterval(u,1e3);return()=>clearInterval(m)},[r]),l?n.jsx("div",{className:`countdown-timer expired ${e}`,style:t,children:n.jsx("div",{className:"digital-display text-danger",children:n.jsx("small",{className:"fw-bold",children:"منتهي الصلاحية"})})}):n.jsx("div",{className:`countdown-timer ${e}`,style:t,children:n.jsx("div",{className:"digital-display",children:n.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{fontSize:"14px",fontFamily:"monospace"},children:n.jsx("span",{className:"text-danger fw-bold",children:s})})})})},wF=({show:r,onClose:e,title:t="أوراق الشركة",documents:s=[],setDocuments:a,companyId:l="new",companyName:c="",companyEmail:u=""})=>{const[m,p]=j.useState(!1),[b,w]=j.useState(null),[N,R]=j.useState(""),[O,G]=j.useState(""),[U,T]=j.useState(!1),[ee,Z]=j.useState(null),[ie,X]=j.useState(null),[pe,H]=j.useState(null),{alertConfig:B,closeAlert:k,showSuccess:W,showError:J,showConfirm:z}=Cn(),{logActivity:L,getCurrentUser:de}=_n(),{currentUser:Pe}=tv(),{formatDate:V}=yh();j.useEffect(()=>{if(r&&l){console.log("📂 Modal opened - setting up Firebase subscription for company documents:",l);const Q=fd.subscribeToCompanyDocuments(l,me=>{console.log("✅ Received company documents from Firebase:",me.length),a&&a(me)});return H(()=>Q),()=>{Q&&(console.log("🔌 Cleaning up Firebase subscription for company documents"),Q())}}},[r,l,a]),j.useEffect(()=>{!r&&pe&&(console.log("🔌 Modal closed - cleaning up Firebase subscription"),pe(),H(null))},[r,pe]);const se=Q=>{console.log("📎 Document file selected:",{name:Q.name,size:Q.size,type:Q.type}),T(!0);try{_r.validateFile(Q,{maxSize:10*1024*1024,allowedTypes:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png","image/jpg"]}),console.log("📤 Preparing company document for upload:",Q.name),w({file:Q,originalFileName:Q.name,fileSize:Q.size,fileType:Q.type}),R(Q.name.split(".")[0]),p(!0),console.log("✅ Document file validated and ready for naming")}catch(me){console.error("❌ File validation failed:",me),J(me.message,"خطأ في الملف")}finally{T(!1)}},fe=()=>{try{const Q=document.createElement("input");Q.type="file",Q.accept=".pdf,.doc,.docx,.jpg,.png,.jpeg",Q.style.display="none",Q.onchange=me=>{const I=me.target.files?.[0];I&&se(I),document.body.contains(Q)&&document.body.removeChild(Q)},Q.onclick=()=>{Q.value=""},document.body.appendChild(Q),Q.click()}catch(Q){console.error("❌ File input creation failed:",Q),J("فشل في فتح منتقي الملفات","خطأ في النظام")}},re=Q=>{try{X(Q.id);const me=document.createElement("input");me.type="file",me.accept=".pdf,.doc,.docx,.jpg,.png,.jpeg",me.style.display="none",me.onchange=I=>{const le=I.target.files?.[0];le&&se(le),document.body.contains(me)&&document.body.removeChild(me)},me.onclick=()=>{me.value=""},document.body.appendChild(me),me.click()}catch(me){console.error("❌ File replacement failed:",me),J("فشل في فتح منتقي الملفات","خطأ في النظام"),X(null)}},_=async()=>{if(!N.trim()){J("يرجى إدخال اسم الملف","اسم الملف مطلوب");return}if(!b){J("بيانات الملف غير متاحة","خطأ");return}p(!1);const Q=b.file,me=N.trim(),I=ie;w(null),R(""),G(""),X(null);try{T(!0),console.log("📤 Uploading company document to Firebase via service:",me);const le=de();I&&(console.log("🗑️ Deleting old expired document before uploading replacement:",I),s.find(mt=>mt.id===I)&&(await fd.deleteDocument(I),console.log("✅ Old expired document deleted successfully"))),console.log("🔐 About to upload document with authUser:",{uid:Pe?.uid,email:Pe?.email,hasUser:!!Pe});const We=await fd.uploadDocument(Q,{companyId:l,companyName:c,companyEmail:u,customFileName:me,uploadDate:new Date().toISOString().split("T")[0],expiryDate:O||null,userId:Pe?.uid});console.log("✅ Document uploaded successfully via Firebase service:",We),I?(W(`تم استبدال الملف بنجاح: ${me}`,"تم الاستبدال"),L("file",`${le.name} استبدل وثيقة شركة منتهية الصلاحية`,`تم استبدال الملف: ${me}`)):(W(`تم رفع الملف بنجاح: ${me}`,"تم الرفع"),L("file",`${le.name} رفع وثيقة شركة`,`تم رفع الملف: ${me}`))}catch(le){console.error("❌ Error uploading company document via Firebase:",le),J(`فشل في رفع الملف: ${le.message}`,"خطأ في الرفع")}finally{T(!1)}},E=()=>{console.log("User cancelled company document upload"),p(!1),w(null),R(""),G("")},D=Q=>{const me=Q.documentFileURL||Q.fileURL||Q.url;me?window.open(me,"_blank"):J("الملف غير متوفر للعرض","ملف غير موجود")},F=Q=>{z(`هل أنت متأكد من حذف هذا الملف؟

${Q.fileName}`,async()=>{try{T(!0);const me=de();await fd.moveDocumentToTrash(Q.id,{userId:Pe?.uid}),L("task",`${me.name} حذف وثيقة شركة`,`تم حذف الوثيقة: ${Q.fileName}`),W(`تم نقل الملف للمهملات: ${Q.fileName}`,"تم النقل للمهملات")}catch(me){console.error("❌ Error deleting company document:",me),J(`فشل في حذف الملف: ${me.message}`,"خطأ في الحذف")}finally{T(!1)}},"تأكيد حذف الملف")},te=()=>{p(!1),w(null),R(""),G(""),e()},$=Q=>Q?Q.includes("pdf")?{icon:"bi-file-earmark-pdf",color:"#dc3545"}:Q.includes("word")||Q.includes("document")?{icon:"bi-file-earmark-word",color:"#2b579a"}:Q.includes("image")?{icon:"bi-file-earmark-image",color:"#198754"}:{icon:"bi-file-earmark",color:"#6c757d"}:{icon:"bi-file-earmark",color:"#6c757d"};return r?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},tabIndex:"-1",dir:"rtl",children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-building-fill me-2"}),t]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:te,"aria-label":"Close"})]}),n.jsxs("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"},children:[n.jsx("div",{className:"mb-4",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[n.jsxs("div",{children:[n.jsx("h6",{className:"mb-0 fw-bold text-primary",children:"مكتبة وثائق الشركة"}),n.jsx("div",{className:"d-flex align-items-center gap-3",children:n.jsxs("small",{className:"text-muted",children:["إجمالي الملفات: ",s.length]})})]}),n.jsx("div",{style:{marginLeft:"20px"},children:n.jsx("button",{type:"button",className:"btn btn-primary",onClick:fe,disabled:U,style:{height:"32px",minWidth:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",fontWeight:"500"},children:U?n.jsxs(n.Fragment,{children:[n.jsx(Mn,{size:"small"}),n.jsx("span",{className:"ms-2",children:"رفع..."})]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-cloud-upload me-1"}),"إضافة ملف"]})})})]})}),s.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-building fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا توجد وثائق"}),n.jsx("p",{className:"text-muted",children:"ابدأ بإضافة وثائق الشركة المطلوبة"})]}):n.jsx("div",{className:"table-responsive company-documents-table",children:n.jsxs("table",{className:"table table-hover custom-striped",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",children:"نوع الملف"}),n.jsx("th",{className:"text-center",children:"اسم الوثيقة"}),n.jsx("th",{className:"text-center",children:"تاريخ الانتهاء"}),n.jsx("th",{className:"text-center",children:"الوقت المتبقي"}),n.jsx("th",{className:"text-center",children:"الإجراءات"})]})}),n.jsx("tbody",{children:s.map((Q,me)=>{const I=Q.fileName||"وثيقة غير محددة",le=$(Q.documentFileType),We=Q.expiryDate&&new Date(Q.expiryDate)<new Date;return n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:Q.documentFileURL||Q.fileURL||Q.url?n.jsx($x,{size:25,clickable:!0,onClick:()=>D(Q),title:`عرض الملف: ${Q.documentFileName||Q.fileName}`}):n.jsx("i",{className:le.icon,style:{color:le.color,fontSize:"24px"}})}),n.jsxs("td",{className:"text-center",children:[n.jsx("div",{className:"fw-bold",children:I}),Q.description&&n.jsx("small",{className:"text-muted",children:Q.description})]}),n.jsx("td",{className:"text-center",children:Q.expiryDate?n.jsx("small",{className:"text-muted",children:V(Q.expiryDate)}):n.jsx("small",{className:"text-muted",children:"غير محدد"})}),n.jsx("td",{className:"text-center",children:Q.expiryDate?n.jsx(bF,{expiryDate:Q.expiryDate,style:{minWidth:"80px"}},`countdown-${Q.id}-${Q.expiryDate}`):n.jsx("small",{className:"text-muted",children:"-"})}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[!We&&n.jsx("button",{className:"btn btn-outline-primary",onClick:()=>D(Q),disabled:!Q.documentFileURL&&!Q.fileURL&&!Q.url,title:Q.documentFileURL||Q.fileURL||Q.url?`عرض الملف: ${Q.documentFileName||Q.fileName}`:"الملف غير متوفر",style:{width:"28px",height:"32px"},children:n.jsx("i",{className:"bi bi-eye"})}),We?n.jsx("button",{className:"btn btn-warning",onClick:()=>re(Q),title:"اختيار ملف جديد",style:{width:"28px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsx("i",{className:"bi bi-folder2-open",style:{color:"black",fontSize:"12px"}})}):n.jsx("button",{className:"btn btn-outline-danger",onClick:()=>F(Q),title:"حذف",style:{width:"28px",height:"32px"},children:n.jsx("i",{className:"bi bi-trash"})})]})})]},Q.id||me)})})]})})]}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:e,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px"},children:"إغلاق"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{W("وثائق الشركة تحفظ تلقائياً","تم الحفظ"),setTimeout(()=>e(),1500)},style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px"},children:"حفظ"})]})})]})})}),m&&n.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.7)",zIndex:1060},tabIndex:"-1",dir:"rtl",children:n.jsx("div",{className:"modal-dialog modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-pencil-square me-2"}),"تسمية الملف"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:E,"aria-label":"Close"})]}),n.jsx("div",{className:"modal-body",style:{padding:"25px"},children:n.jsxs("div",{className:"mb-4",children:[n.jsxs("div",{className:"d-flex align-items-center mb-3",children:[n.jsx("div",{className:"bg-success bg-opacity-10 p-2 rounded-circle me-3",children:n.jsx("i",{className:"bi bi-file-earmark-check text-success"})}),n.jsxs("div",{children:[n.jsx("h6",{className:"mb-0 fw-bold text-success",children:"تم رفع الملف بنجاح"}),n.jsx("small",{className:"text-muted",children:b?.originalFileName})]})]}),n.jsxs("div",{className:"mb-3",children:[n.jsxs("label",{className:"form-label fw-bold text-primary",children:[n.jsx("i",{className:"bi bi-tag me-1"}),"اسم الملف المخصص *"]}),n.jsx("input",{type:"text",className:"form-control",value:N,onChange:Q=>R(Q.target.value),placeholder:"أدخل اسم الملف المخصص",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:Q=>{Q.target.style.borderColor="#28a745",Q.target.style.boxShadow="0 0 0 0.2rem rgba(40, 167, 69, 0.25)"},onBlur:Q=>{Q.target.style.borderColor="#e9ecef",Q.target.style.boxShadow="none"},autoFocus:!0}),n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),"سيتم استخدام هذا الاسم لعرض الملف في قائمة وثائق الشركة"]})]}),n.jsxs("div",{className:"mb-3",children:[n.jsxs("label",{className:"form-label fw-bold text-warning",children:[n.jsx("i",{className:"bi bi-calendar-event me-1"}),"تاريخ انتهاء الصلاحية"]}),n.jsx("input",{type:"date",className:"form-control",value:O,onChange:Q=>G(Q.target.value),placeholder:"اختر تاريخ انتهاء الصلاحية",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:Q=>{Q.target.style.borderColor="#ffc107",Q.target.style.boxShadow="0 0 0 0.2rem rgba(255, 193, 7, 0.25)"},onBlur:Q=>{Q.target.style.borderColor="#e9ecef",Q.target.style.boxShadow="none"}}),n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),"اتركه فارغاً إذا لم تكن هناك صلاحية محددة"]})]})]})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:n.jsxs("div",{className:"d-flex justify-content-end",style:{gap:"12px"},children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:E,style:{height:"32px",fontSize:"13px",borderRadius:"6px",padding:"0 12px",width:"80px"},children:"إلغاء"}),n.jsxs("button",{type:"button",className:"btn btn-primary",onClick:_,disabled:!N.trim(),style:{height:"32px",fontSize:"13px",borderRadius:"6px",padding:"0 12px",width:"80px"},children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),"حفظ"]})]})})]})})}),n.jsx(Tn,{show:B.show,onClose:k,title:B.title,message:B.message,type:B.type,onConfirm:B.onConfirm,showConfirm:B.showConfirm})]}):null},vF=({company:r,onSave:e,onCancel:t})=>{const[s,a]=j.useState({name:"",email:"",phone:"",address:"",city:"",taxNumber:"",bankAccount:"",notes:"",active:!0}),[l,c]=j.useState({}),[u,m]=j.useState(!1),[p,b]=j.useState(!1),[w,N]=j.useState([]),[R,O]=j.useState(!1),[G,U]=j.useState(null),[T,ee]=j.useState(null),Z=!!r,{logActivity:ie,getCurrentUser:X}=_n();j.useEffect(()=>{r&&a({name:r.name||"",email:r.email||"",phone:r.phone||"",address:r.address||"",city:r.city||"",taxNumber:r.taxNumber||"",bankAccount:r.bankAccount||"",notes:r.notes||"",active:r.active!==void 0?r.active:!0})},[r]),j.useEffect(()=>{(()=>{Z&&r?.id?pe():(async()=>{O(!0);try{const z=await fd.getCompanyDocuments("new");console.log("📄 Loaded temp company documents from Firebase:",z.length),N(z)}catch(z){console.error("Error loading temp company documents from Firebase:",z),N([])}finally{O(!1)}})()})()},[Z,r?.id]),j.useEffect(()=>()=>{T&&(console.log("🔌 Cleaning up Firebase subscription for company documents"),T())},[T]);const pe=()=>{if(!r?.id)return;O(!0),T&&T();const W=fd.subscribeToCompanyDocuments(r.id,J=>{console.log("📄 Received company documents from Firebase:",J.length),N(J),O(!1),U(null)});ee(()=>W)},H=()=>{console.log("Opening document modal..."),b(!0)},B=W=>{const{name:J,value:z,type:L,checked:de}=W.target;a(Pe=>({...Pe,[J]:L==="checkbox"?de:z})),l[J]&&c(Pe=>({...Pe,[J]:""}))},k=async W=>{W.preventDefault();const J=nf.validateCompanyData(s);if(Object.keys(J).length>0){c(J);return}m(!0),c({});try{const z=await oo.validateUniqueFields(s,Z?r.id:null,Z?"companies":null);if(Object.keys(z).length>0){c(z),m(!1);return}const L={...s,status:Z&&r.status||"active"};if(Z){await nf.updateCompany(r.id,L);const de=X();ie("task",`${de.name} عدل شركة`,`تم تعديل الشركة: ${L.name}`)}else{const de=await nf.createCompany(L);try{const V=await fd.updateDocumentCompanyId("new",de,L);V>0&&console.log(`✅ Linked ${V} documents to new company:`,de)}catch(V){console.warn("⚠️ Failed to link documents to new company:",V)}const Pe=X();ie("task",`${Pe.name} أضاف شركة`,`تم إضافة الشركة: ${L.name}`)}e()}catch(z){c({submit:z.message})}finally{m(!1)}};return n.jsxs("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:[n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",children:[n.jsx("div",{className:"modal-header",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-between w-100",children:[n.jsxs("h5",{className:"modal-title mb-0",children:[n.jsx("i",{className:"bi bi-building-plus-fill text-primary me-2"}),Z?"تعديل الشركة":"إضافة شركة جديدة"]}),n.jsxs("div",{className:"d-flex align-items-center",style:{gap:"15px"},children:[Z&&n.jsx("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:H,disabled:R,style:{height:"32px",fontSize:"13px",borderRadius:"6px",padding:"0 12px",whiteSpace:"nowrap",marginLeft:"20px"},children:R?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"spinner-border spinner-border-sm me-1",role:"status",style:{width:"12px",height:"12px"}}),"تحميل..."]}):G?n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-1 text-warning"}),"أوراق الشركة"]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-file-earmark-text me-1"}),"أوراق الشركة (",w.length,")"]})}),n.jsx("button",{type:"button",className:"btn-close",onClick:t})]})]})}),n.jsxs("form",{onSubmit:k,children:[n.jsxs("div",{className:"modal-body",children:[l.submit&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.submit]}),G&&n.jsxs("div",{className:"alert alert-warning d-flex align-items-center justify-content-between",children:[n.jsxs("div",{children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"فشل في تحميل وثائق الشركة: ",G]}),n.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:pe,style:{borderRadius:"4px"},children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-1"}),"إعادة تحميل"]})]}),n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"اسم الشركة *"}),n.jsx("input",{type:"text",className:`form-control ${l.name?"is-invalid":""}`,name:"name",value:s.name,onChange:B,placeholder:"أدخل اسم الشركة"}),l.name&&n.jsx("div",{className:"invalid-feedback",children:l.name})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"البريد الإلكتروني *"}),n.jsx("input",{type:"email",className:`form-control ${l.email?"is-invalid":""}`,name:"email",value:s.email,onChange:B,placeholder:"example@company.com"}),l.email&&n.jsx("div",{className:"invalid-feedback",children:l.email})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الهاتف *"}),n.jsx("input",{type:"tel",className:`form-control ${l.phone?"is-invalid":""}`,name:"phone",value:s.phone,onKeyPress:W=>{/[0-9+]/.test(W.key)||W.preventDefault()},onChange:W=>{const J=W.target.value.replace(/[^0-9+]/g,"");B({target:{name:"phone",value:J}})},placeholder:"+966 50 123 4567"}),l.phone&&n.jsx("div",{className:"invalid-feedback",children:l.phone})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"المدينة"}),n.jsx("input",{type:"text",className:"form-control",name:"city",value:s.city,onChange:B,placeholder:"المدينة"})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"العنوان"}),n.jsx("textarea",{className:"form-control",name:"address",value:s.address,onChange:B,rows:"2",placeholder:"أدخل عنوان الشركة"})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"الرقم الضريبي"}),n.jsx("input",{type:"text",className:"form-control",name:"taxNumber",value:s.taxNumber,onChange:B,placeholder:"الرقم الضريبي"})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الحساب المصرفي"}),n.jsx("input",{type:"text",className:"form-control",name:"bankAccount",value:s.bankAccount,onChange:B,placeholder:"رقم الحساب المصرفي"})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"ملاحظات"}),n.jsx("textarea",{className:"form-control",name:"notes",value:s.notes,onChange:B,rows:"3",placeholder:"أي ملاحظات إضافية..."})]}),n.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:n.jsxs("div",{className:"d-flex align-items-center gap-2",children:[n.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"نشط":"غير نشط"}),n.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"companyActiveSwitch",name:"active",checked:s.active,onChange:B,style:{width:"50px",height:"25px",cursor:"pointer"}})]})})]})]}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsxs("div",{className:"d-flex gap-3",children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:t,disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"12px",height:"12px"}}),"حفظ..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),Z?"تحديث":"حفظ"]})})]})})]})]})}),p&&n.jsx(wF,{show:p,onClose:()=>b(!1),title:"أوراق الشركة",documents:w,setDocuments:N,companyId:r?.id||"new",companyName:r?.name||"شركة جديدة",companyEmail:r?.email||""})]})};function NF(){const[r,e]=j.useState(!1),[t,s]=j.useState(!1),[a,l]=j.useState(null),[c,u]=j.useState(0),{isTimelineVisible:m}=Hn(),p=()=>{e(!r)},b=()=>{l(null),s(!0)},w=O=>{l(O),s(!0)},N=()=>{s(!1),l(null),u(O=>O+1)},R=()=>{s(!1),l(null)};return n.jsx(un,{children:n.jsx(hn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Xn,{onToggle:p}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!m?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"الشركات"})]})}),n.jsx(Jn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"suppliers-table",children:n.jsx(yF,{onAdd:b,onEdit:w,refreshTrigger:c})})})]}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]}),!r&&m&&n.jsx(Zn,{rtl:!0}),!r&&m&&n.jsx(es,{}),t&&n.jsx("div",{className:"company-form",children:n.jsx(vF,{company:a,onSave:N,onCancel:R})})]})})})}function jF(){return n.jsx(NF,{})}const Ba="employees",Pb="documents",od=()=>{const r=new Date,e=r.getFullYear(),t=String(r.getMonth()+1).padStart(2,"0"),s=String(r.getDate()).padStart(2,"0"),a=Math.floor(Math.random()*9999).toString().padStart(4,"0");return`EMP-${e}${t}${s}-${a}`};class Mu{static async getAllEmployees(e={}){try{console.log("🔄 Fetching all employees from Firestore...");const{search:t,filters:s={},sort:a="updatedAt",page:l=1,limit:c=30}=e;let u=[];try{a==="name"?u.push(ps("fullName","asc")):a==="hireDate"?u.push(ps("hireDate","desc")):u.push(ps("createdAt","desc"))}catch(R){console.warn("⚠️ Sorting failed, using basic query:",R.message),u=[]}const m=await qo.secureGetDocs(Ba,u);console.log("📊 Firestore query results:",m.size,"documents");let p=m.docs.map(R=>{const O=R.data();return console.log("📄 Processing employee document:",R.id,O.fullName||"Unknown"),{id:R.id,internalId:O.internalId||od(),...O,createdAt:O.createdAt?.toDate(),updatedAt:O.updatedAt?.toDate(),hireDate:O.hireDate?.toDate()}});if(console.log("✅ Processed employees:",p.length,"total"),t&&t.trim()){const R=t.toLowerCase();p=p.filter(O=>O.fullName?.toLowerCase().includes(R)||O.department?.toLowerCase().includes(R)||O.jobTitle?.toLowerCase().includes(R)||O.email?.toLowerCase().includes(R)||O.phone?.includes(t)||O.nationalId?.includes(t))}s.department&&s.department!=="all"&&(p=p.filter(R=>R.department===s.department)),s.status&&s.status!=="all"&&(p=p.filter(R=>R.status===s.status));const b=(l-1)*c,w=b+c;return{employees:p.slice(b,w),totalCount:p.length,totalPages:Math.ceil(p.length/c),currentPage:l}}catch(t){throw console.error("Error fetching employees:",t),new Error("فشل في جلب بيانات الموظفين")}}static async createEmployee(e){try{if(!e.email||!e.email.trim())throw new Error("البريد الإلكتروني مطلوب لإنشاء حساب الموظف");if(!e.nationalId||!e.nationalId.trim())throw new Error("كلمة المرور مطلوبة لإنشاء حساب الموظف");let t=od(),s=0;for(;s<5&&await this.getEmployeeByInternalId(t);)t=od(),s++;if(s===5)throw new Error("فشل في توليد معرف فريد للموظف");console.log("🔄 Creating Firebase Auth user for employee...");const a=await w3(sn,e.email.trim(),e.nationalId),l=a.user.uid;console.log("✅ Firebase Auth user created:",l),await j3(a.user,{displayName:e.fullName});const c={...e,internalId:t,status:e.status||"active",role:e.role||"employee",hireDate:e.hireDate?new Date(e.hireDate):new Date,createdAt:_t(),updatedAt:_t()};return await qo.createEmployeeDoc(c,l),console.log("✅ Employee document created with UID:",l),{id:l,internalId:t,uid:l}}catch(t){throw console.error("Error creating employee:",t),t.code==="auth/email-already-in-use"?new Error("البريد الإلكتروني مستخدم بالفعل"):t.code==="auth/invalid-email"?new Error("صيغة البريد الإلكتروني غير صحيحة"):t.code==="auth/weak-password"?new Error("كلمة المرور ضعيفة جداً - يجب أن تكون 6 أحرف على الأقل"):new Error(t.message||"فشل في إنشاء الموظف")}}static async updateEmployee(e,t){try{const s={...t};t.hireDate&&(s.hireDate=new Date(t.hireDate));const a=sn.currentUser?.uid;return e===a?await qo.updateOwnEmployeeDoc(s):await qo.secureUpdateDoc(Ba,e,s),!0}catch(s){throw console.error("Error updating employee:",s),new Error("فشل في تحديث بيانات الموظف")}}static async getEmployeeById(e){try{const t=sn.currentUser?.uid;let s;if(e===t?s=await qo.getOwnEmployeeDoc():s=await qo.secureGetDoc(Ba,e),s.exists()){const a=s.data();return{id:s.id,internalId:a.internalId||od(),...a,createdAt:a.createdAt?.toDate(),updatedAt:a.updatedAt?.toDate(),hireDate:a.hireDate?.toDate()}}else return null}catch(t){throw console.error("Error fetching employee by ID:",t),new Error("فشل في جلب بيانات الموظف")}}static async getEmployeeByInternalId(e){try{const t=dt(Ce,Ba),s=Gt(t,Sn("internalId","==",e)),a=await At(s);if(a.empty)return null;{const l=a.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:c.createdAt?.toDate(),updatedAt:c.updatedAt?.toDate(),hireDate:c.hireDate?.toDate()}}}catch(t){throw console.error("Error fetching employee by internal ID:",t),new Error("فشل في جلب بيانات الموظف")}}static async updateEmployeeByInternalId(e,t){try{const s=await this.getEmployeeByInternalId(e);if(!s)throw new Error("الموظف غير موجود");return await this.updateEmployee(s.id,t)}catch(s){throw console.error("Error updating employee by internal ID:",s),new Error("فشل في تحديث بيانات الموظف")}}static async deleteEmployee(e){try{const t=ht(Ce,Ba,e);return await er(t),!0}catch(t){throw console.error("Error deleting employee:",t),new Error("فشل في حذف الموظف")}}static async deleteEmployeeByInternalId(e){try{const t=await this.getEmployeeByInternalId(e);if(!t)throw new Error("الموظف غير موجود");return await this.deleteEmployee(t.id)}catch(t){throw console.error("Error deleting employee by internal ID:",t),new Error("فشل في حذف الموظف")}}static async searchEmployees(e){try{const t=dt(Ce,Ba);return(await At(t)).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||od(),...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate(),hireDate:u.hireDate?.toDate()}}).filter(c=>c.fullName?.toLowerCase().includes(e.toLowerCase())||c.department?.toLowerCase().includes(e.toLowerCase())||c.jobTitle?.toLowerCase().includes(e.toLowerCase())||c.email?.toLowerCase().includes(e.toLowerCase())||c.phone?.includes(e)||c.nationalId?.includes(e))}catch(t){throw console.error("Error searching employees:",t),new Error("فشل في البحث عن الموظفين")}}static async uploadEmployeeFile(e,t,s=null){try{const a=qo.getCurrentUserUID(),l=s||t.name,c=Date.now(),u=`uploads/employee_${e}_${c}_${l}`,m=Wo(ri,u),p=await Zg(m,t),b=await Jm(p.ref),w=await this.getEmployeeByInternalId(e);if(!w)throw new Error("الموظف غير موجود");const N={name:l,originalName:t.name,path:u,url:b,type:t.type,size:t.size,uploadedBy:a,uploadedAt:new Date().toISOString()};await qo.validateActiveEmployee();const R=dt(Ce,Ba,w.id,Pb);return{id:(await Mr(R,N)).id,url:b,path:u,...N}}catch(a){throw console.error("Error uploading employee file:",a),new Error("فشل في رفع الملف")}}static async listEmployeeFiles(e){try{const t=await this.getEmployeeByInternalId(e);if(!t)throw new Error("الموظف غير موجود");const s=dt(Ce,Ba,t.id,Pb);return(await At(s)).docs.map(l=>{const c=l.data();return{id:l.id,...c,uploadedAt:c.uploadedAt?.toDate()}})}catch(t){throw console.error("Error listing employee files:",t),new Error("فشل في جلب ملفات الموظف")}}static async deleteEmployeeFile(e,t){try{const s=await this.getEmployeeByInternalId(e);if(!s)throw new Error("الموظف غير موجود");const a=ht(Ce,Ba,s.id,Pb,t),l=await hs(a);if(!l.exists())throw new Error("الملف غير موجود");const c=l.data(),u=Wo(ri,c.path);return await Fx(u),await er(a),!0}catch(s){throw console.error("Error deleting employee file:",s),new Error("فشل في حذف الملف")}}static async getDepartments(){try{const e=dt(Ce,Ba),t=await At(e),s=new Set;return t.docs.forEach(a=>{const l=a.data();l.department&&s.add(l.department)}),Array.from(s).sort()}catch(e){throw console.error("Error fetching departments:",e),new Error("فشل في جلب الأقسام")}}static validateEmployeeData(e){const t={};if(e.fullName?.trim()||(t.fullName="الاسم الكامل مطلوب"),e.email&&e.email.trim()&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(t.email="صيغة البريد الإلكتروني غير صحيحة")),e.phone&&e.phone.trim()&&(/^[\+\d\-\s\(\)]+$/.test(e.phone)||(t.phone="صيغة رقم الهاتف غير صحيحة")),e.salary&&e.salary!==""){const s=parseFloat(e.salary);(isNaN(s)||s<0)&&(t.salary="الراتب يجب أن يكون رقماً موجباً")}return t}static async migrateExistingData(){try{console.log("Starting employees migration...");const t=(await this.getAllEmployees({limit:1e3})).employees;let s=0;for(const a of t)if(!a.internalId||!a.internalId.startsWith("EMP-")){const l=od();await this.updateEmployee(a.id,{...a,internalId:l}),s++,console.log(`Migrated employee: ${a.fullName} -> ${l}`)}return console.log(`Migration completed. ${s} employees migrated.`),{success:!0,migratedCount:s}}catch(e){throw console.error("Error during migration:",e),new Error("فشل في ترحيل البيانات")}}}const _F=Object.freeze(Object.defineProperty({__proto__:null,EmployeeService:Mu,generateEmployeeId:od},Symbol.toStringTag,{value:"Module"})),EF=({onEdit:r,onAdd:e,onView:t,refreshTrigger:s})=>{const[a,l]=j.useState([]),[c,u]=j.useState(!0),[m,p]=j.useState(null),[b,w]=j.useState(""),[N,R]=j.useState([]),[O,G]=j.useState(!1),{logActivity:U,getCurrentUser:T}=_n(),{alertConfig:ee,closeAlert:Z,showSuccess:ie,showError:X,showConfirm:pe}=Cn(),{currentPage:H,totalPages:B,paginatedItems:k,handlePageChange:W,resetPage:J,totalItems:z,itemsPerPage:L}=wa(N,30);j.useEffect(()=>{de()},[]),j.useEffect(()=>{s&&de()},[s]),j.useEffect(()=>{Pe()},[a,b]);const de=async()=>{try{u(!0),p(null);const E=await Mu.getAllEmployees({limit:1e3});l(E.employees||[])}catch(E){console.error("Error loading employees:",E),p(E.message),X(E.message,"خطأ في التحميل")}finally{u(!1)}},Pe=()=>{let E=[...a];if(b.trim()){const D=b.toLowerCase();E=E.filter(F=>F.fullName?.toLowerCase().includes(D)||F.department?.toLowerCase().includes(D)||F.jobTitle?.toLowerCase().includes(D)||F.email?.toLowerCase().includes(D)||F.phone?.includes(b)||F.nationalId?.includes(b))}R(E),J()},V=E=>{pe(`هل أنت متأكد من حذف الموظف؟

${E.fullName}

سيتم نقل البيانات إلى المهملات ويمكن استعادتها لاحقاً.`,()=>se(E),"تأكيد حذف الموظف")},se=async E=>{try{G(!0),await qn.moveToTrash(E,"employees"),await Mu.deleteEmployee(E.id);const D=T();U("task",`${D.name} حذف موظف`,`تم حذف الموظف: ${E.fullName}`),await de(),ie(`تم نقل الموظف للمهملات: ${E.fullName}`,"تم النقل للمهملات")}catch(D){p(D.message),X(`فشل في نقل الموظف للمهملات: ${D.message}`,"خطأ في النقل")}finally{G(!1)}},fe=E=>E?`${parseFloat(E).toLocaleString("en-US")} ريال`:"غير محدد",re=E=>{if(!E)return"غير محدد";const D=new Date(E),F=String(D.getDate()).padStart(2,"0"),te=String(D.getMonth()+1).padStart(2,"0"),$=D.getFullYear();return`${F}/${te}/${$}`},_=E=>{const D={active:{class:"bg-light text-dark",text:"نشط"},inactive:{class:"bg-light text-dark",text:"غير نشط"}},F=D[E]||D.active;return n.jsx("span",{className:`badge ${F.class}`,children:F.text})};return c?n.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"400px"},children:n.jsx(Mn,{size:"large"})}):n.jsxs("div",{className:"card shadow-sm","data-list":"employees",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-person-badge-fill text-primary me-2"}),"قائمة الموظفين (",N.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center",style:{gap:"25px"},children:[n.jsxs("div",{className:"input-group employees-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في الموظفين...",value:b,onChange:E=>w(E.target.value),style:{borderRadius:"0 8px 8px 0",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"8px 0 0 8px",borderRight:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted"})})]}),n.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:e,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"إضافة موظف جديد"]})]})})]})}),n.jsxs("div",{className:"card-body p-0",children:[m&&n.jsxs("div",{className:"alert alert-danger m-4",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),m]}),!m&&N.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-person-x",style:{fontSize:"3rem"}})}),n.jsx("h5",{className:"text-muted",children:"لا توجد موظفين"}),n.jsx("p",{className:"text-muted",children:b?"لا توجد نتائج تطابق البحث المحدد":"لم يتم إضافة أي موظفين بعد"}),!b&&n.jsxs("button",{className:"btn btn-primary",onClick:e,children:[n.jsx("i",{className:"bi bi-plus-circle me-1"}),"إضافة أول موظف"]})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"الاسم الكامل"}),n.jsx("th",{className:"text-center",children:"رقم الهاتف"}),n.jsx("th",{className:"text-center",children:"البريد الإلكتروني"}),n.jsx("th",{className:"text-center",children:"الراتب"}),n.jsx("th",{className:"text-center",children:"الحالة"}),n.jsx("th",{className:"text-center",children:"تاريخ التوظيف"}),n.jsx("th",{className:"text-center",style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:k.map((E,D)=>n.jsxs("tr",{style:{backgroundColor:((H-1)*L+D)%2===0?"#ffffff":"#f8f9fa"},children:[n.jsx("td",{className:"text-center fw-bold text-muted",children:(H-1)*L+D+1}),n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"d-flex align-items-center justify-content-center",children:n.jsx("div",{children:n.jsx("div",{className:"fw-bold text-primary",style:{cursor:"pointer",textDecoration:"underline"},onClick:()=>t&&t(E),title:"عرض تفاصيل الموظف",children:E.fullName})})})}),n.jsx("td",{className:"text-center",children:E.phone||"غير محدد"}),n.jsx("td",{className:"text-center",children:E.email||"غير محدد"}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-success",children:fe(E.salary)})}),n.jsx("td",{className:"text-center",children:_(E.status)}),n.jsx("td",{className:"text-center",children:n.jsx("small",{className:"text-muted",children:re(E.hireDate)})}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{className:"btn btn-outline-primary",onClick:()=>t&&t(E),title:"عرض التفاصيل",style:{width:"32px",height:"32px",padding:"0",borderRadius:"6px 0 0 6px"},children:n.jsx("i",{className:"bi bi-eye"})}),n.jsx("button",{className:"btn btn-outline-danger",onClick:()=>V(E),title:"حذف",disabled:O,style:{width:"32px",height:"32px",padding:"0",borderRadius:"0 6px 6px 0"},children:n.jsx("i",{className:"bi bi-trash"})})]})})]},E.id))})]})}),B>1&&n.jsx("div",{className:"d-flex justify-content-center p-4",children:n.jsx(va,{currentPage:H,totalPages:B,onPageChange:W,totalItems:z,itemsPerPage:L})})]})]}),n.jsx(Tn,{show:ee.show,onClose:Z,title:ee.title,message:ee.message,type:ee.type,onConfirm:ee.onConfirm,confirmText:ee.confirmText,cancelText:ee.cancelText,showCancel:ee.showCancel})]})};class ug{static COLLECTION_NAME="employee_documents";static async uploadDocument(e,t,s){try{console.log("📤 Uploading employee document:",e.name,"for employee:",t),_r.validateFile(e,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]});const a=await _r.uploadFile(e,"employee-documents"),l={fileName:s.trim(),originalFileName:e.name,fileURL:a.url,storagePath:a.path,fileSize:e.size,fileType:e.type,employeeId:t||"new",ownerId:a.uploadedBy||"unknown",uploadedAt:_t(),createdAt:_t(),updatedAt:_t()},c=await Mr(dt(Ce,this.COLLECTION_NAME),l);return console.log("✅ Employee document uploaded successfully:",c.id),{id:c.id,...l,uploadedAt:new Date().toISOString(),createdAt:new Date().toISOString()}}catch(a){throw console.error("❌ Error uploading employee document:",a),new Error(`فشل في رفع الوثيقة: ${a.message}`)}}static async getEmployeeDocuments(e){try{if(console.log("📋 Loading documents for employee:",e),!e||e==="new")return console.log("⚠️ No employee ID provided, returning empty array"),[];let t;try{const a=Gt(dt(Ce,this.COLLECTION_NAME),Sn("employeeId","==",e),ps("uploadedAt","desc"));t=await At(a)}catch(a){console.warn("⚠️ OrderBy query failed (missing index), trying simple where query:",a.message);const l=Gt(dt(Ce,this.COLLECTION_NAME),Sn("employeeId","==",e));t=await At(l)}const s=[];return t.forEach(a=>{const l=a.data();s.push({id:a.id,...l,uploadedAt:l.uploadedAt?.toDate?.()||new Date,createdAt:l.createdAt?.toDate?.()||new Date})}),s.sort((a,l)=>new Date(l.uploadedAt)-new Date(a.uploadedAt)),console.log("✅ Loaded employee documents:",s.length),s}catch(t){if(console.error("❌ Error loading employee documents:",t),t.code==="permission-denied"||t.code==="not-found")return console.log("📋 Collection not accessible or doesn't exist, returning empty array"),[];throw new Error(`فشل في تحميل الوثائق: ${t.message}`)}}static async deleteDocument(e){try{console.log("🗑️ Deleting employee document:",e);const t=ht(Ce,this.COLLECTION_NAME,e),s=await hs(t);if(!s.exists())throw new Error("الوثيقة غير موجودة");const a=s.data();if(a.storagePath)try{await _r.deleteFile(a.storagePath),console.log("✅ File deleted from storage:",a.storagePath)}catch(l){console.warn("⚠️ Error deleting from storage (non-critical):",l.message)}return await er(t),console.log("✅ Employee document deleted successfully"),!0}catch(t){throw console.error("❌ Error deleting employee document:",t),new Error(`فشل في حذف الوثيقة: ${t.message}`)}}static async updateDocument(e,t){try{console.log("📝 Updating employee document:",e);const s=ht(Ce,this.COLLECTION_NAME,e),a={...t,updatedAt:_t()};return await Zs(s,a),console.log("✅ Employee document updated successfully"),!0}catch(s){throw console.error("❌ Error updating employee document:",s),new Error(`فشل في تحديث الوثيقة: ${s.message}`)}}static async transferDocuments(e,t){try{console.log("🔄 Transferring documents from:",e,"to:",t);const s=await this.getEmployeeDocuments(e);if(s.length===0)return console.log("⚠️ No documents to transfer"),[];const a=s.map(l=>this.updateDocument(l.id,{employeeId:t}));return await Promise.all(a),console.log("✅ Documents transferred successfully:",s.length),s}catch(s){throw console.error("❌ Error transferring documents:",s),new Error(`فشل في نقل الوثائق: ${s.message}`)}}static async getAllDocuments(){try{console.log("📋 Loading all employee documents");const e=Gt(dt(Ce,this.COLLECTION_NAME),ps("uploadedAt","desc")),t=await At(e),s=[];return t.forEach(a=>{const l=a.data();s.push({id:a.id,...l,uploadedAt:l.uploadedAt?.toDate?.()||new Date,createdAt:l.createdAt?.toDate?.()||new Date})}),console.log("✅ Loaded all employee documents:",s.length),s}catch(e){throw console.error("❌ Error loading all employee documents:",e),new Error(`فشل في تحميل جميع الوثائق: ${e.message}`)}}static validateDocumentData(e){const t={};return(!e.fileName||!e.fileName.trim())&&(t.fileName="اسم الملف مطلوب"),e.fileURL||(t.fileURL="رابط الملف مطلوب"),e.employeeId||(t.employeeId="معرف الموظف مطلوب"),t}}const kb=({employee:r,onSave:e,onCancel:t})=>{const[s,a]=j.useState({fullName:"",jobTitle:"",department:"",phone:"",email:"",nationalId:"",status:"active",salary:"",hireDate:"",notes:""}),[l,c]=j.useState({}),[u,m]=j.useState(!1),[p,b]=j.useState(!1),[w,N]=j.useState([]),[R,O]=j.useState(!1),[G,U]=j.useState(!1),[T,ee]=j.useState(null),[Z,ie]=j.useState(""),[X,pe]=j.useState(!1),{logActivity:H,getCurrentUser:B}=_n(),{alertConfig:k,closeAlert:W,showSuccess:J,showError:z,showConfirm:L}=Cn(),de=!!r;j.useEffect(()=>{r?(a({fullName:r.fullName||"",jobTitle:r.jobTitle||"",department:r.department||"",phone:r.phone||"",email:r.email||"",nationalId:r.nationalId||"",status:r.status||"active",salary:r.salary?r.salary.toString():"",hireDate:r.hireDate?ku(r.hireDate):"",notes:r.notes||""}),Pe()):N([])},[r]);const Pe=async()=>{if(!r?.id||r.id==="new"){N([]);return}try{console.log("📋 Loading documents for employee:",r.id);const $=await ug.getEmployeeDocuments(r.id);N($),console.log("✅ Loaded employee documents:",$.length)}catch($){console.error("❌ Error loading employee documents:",$),N([])}},V=$=>{const{name:Q,value:me}=$.target;a(I=>({...I,[Q]:me})),l[Q]&&c(I=>({...I,[Q]:""}))},se=async()=>{const $=Mu.validateEmployeeData(s),Q={};s.email&&s.email.trim()&&(Q.email=s.email.trim());try{const me=await oo.validateUniqueFields(Q,de?r.id:null,"employees"),I={...$,...me};return c(I),Object.keys(I).length===0}catch(me){return console.error("Validation error:",me),c($),Object.keys($).length===0}},fe=async $=>{if($.preventDefault(),!(u||!await se())){m(!0);try{const me={...s,salary:s.salary?parseFloat(s.salary):null,hireDate:s.hireDate?new Date(s.hireDate):new Date};let I;const le=B();if(de)await Mu.updateEmployee(r.id,me),I={...r,...me},H("task",`${le.name} عدل موظف`,`تم تعديل بيانات الموظف: ${s.fullName}`),J("تم تحديث بيانات الموظف بنجاح","تم التحديث");else{const We=await Mu.createEmployee(me);if(I={...me,id:We.id,internalId:We.internalId},w.length>0)try{console.log("📄 Transferring documents to new employee:",We.id);const nt=w.map(mt=>({...mt,employeeId:We.id,employeeName:s.fullName,employeeEmail:s.email}));for(const mt of nt)try{const It=new File([""],mt.originalFileName,{type:mt.fileType});Object.defineProperty(It,"name",{value:mt.originalFileName}),Object.defineProperty(It,"size",{value:mt.fileSize}),Object.defineProperty(It,"type",{value:mt.fileType});const rn=await ug.uploadDocument(It,We.id,mt.fileName);rn.fileURL=mt.fileURL,rn.storagePath=mt.storagePath,console.log("✅ Document transferred to Firebase:",mt.fileName)}catch(It){console.warn("⚠️ Failed to save document to Firebase:",mt.fileName,It.message)}console.log("✅ All documents transferred successfully")}catch(nt){console.warn("⚠️ Document transfer failed:",nt.message)}H("task",`${le.name} أضاف موظف`,`تم إضافة موظف جديد: ${s.fullName}`),J("تم إضافة الموظف بنجاح","تمت الإضافة")}e&&e(I)}catch(me){console.error("Error saving employee:",me),z(me.message||"فشل في حفظ بيانات الموظف","خطأ في الحفظ")}finally{m(!1)}}},re=()=>{t&&t()},_=async $=>{const Q=$.target.files[0];if(Q){O(!0);try{try{_r.validateFile(Q,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]})}catch(I){throw new Error(I.message)}console.log("📤 Uploading employee document:",Q.name);const me=await _r.uploadFile(Q,"employee-documents");ee({...me,originalFileName:Q.name,fileSize:Q.size,fileType:Q.type}),ie(Q.name.split(".")[0]),U(!0),$.target.value=""}catch(me){console.error("Error uploading employee document:",me),z(me.message||"فشل في رفع الملف","خطأ في الرفع"),$.target&&($.target.value="")}finally{O(!1)}}},E=async()=>{if(!Z.trim()){z("يرجى إدخال اسم الملف","اسم الملف مطلوب");return}if(!T){z("بيانات الملف غير متاحة","خطأ");return}try{O(!0),console.log("📤 Saving employee document via EmployeeDocumentService:",Z);const $=new File([""],T.originalFileName,{type:T.fileType});Object.defineProperty($,"name",{value:T.originalFileName}),Object.defineProperty($,"size",{value:T.fileSize}),Object.defineProperty($,"type",{value:T.fileType});const Q={fileName:Z.trim(),originalFileName:T.originalFileName,fileURL:T.url,storagePath:T.path,fileSize:T.fileSize,fileType:T.fileType,employeeId:r?.id||"new",employeeName:s.fullName||"موظف جديد",employeeEmail:s.email||"غير محدد",uploadedAt:new Date().toISOString(),createdAt:new Date().toISOString(),id:Date.now().toString()};if(r?.id&&r.id!=="new")try{const I=await ug.uploadDocument($,r.id,Z.trim());I.fileURL=T.url,I.storagePath=T.path,N(le=>[...le,I]),console.log("✅ Document saved to Firebase successfully")}catch(I){console.warn("⚠️ Firebase save failed, storing locally for now:",I.message),N(le=>[...le,Q])}else console.log("📋 New employee - storing document locally until employee is saved"),N(I=>[...I,Q]);J(`تم رفع الملف بنجاح: ${Z}`,"تم الرفع");const me=B();H("file",`${me.name} رفع وثيقة موظف`,`تم رفع الملف: ${Z} للموظف: ${s.fullName||"موظف جديد"}`),U(!1),ee(null),ie("")}catch($){console.error("Error saving employee document:",$),z(`فشل في رفع الملف: ${$.message}`,"خطأ في الرفع")}finally{O(!1)}},D=()=>{console.log("User cancelled employee file upload"),U(!1),ee(null),ie("")},F=$=>{L(`هل أنت متأكد من حذف هذا الملف؟

${$.fileName}`,()=>te($),"تأكيد حذف الملف")},te=async $=>{try{if(pe(!0),r?.id&&r.id!=="new"&&!$.id.toString().startsWith("temp_"))try{await ug.deleteDocument($.id),console.log("✅ Document deleted from Firebase")}catch(me){console.warn("⚠️ Firebase delete failed, removing locally:",me.message)}else try{await qn.moveToTrash($,"employee_documents"),console.log("✅ Document moved to trash")}catch(me){console.warn("⚠️ Trash service failed, removing locally only:",me.message)}N(me=>me.filter(I=>I.id!==$.id));const Q=B();H("task",`${Q.name} حذف وثيقة موظف`,`تم حذف الوثيقة: ${$.fileName} للموظف: ${s.fullName||"موظف"}`),J(`تم حذف الملف: ${$.fileName}`,"تم الحذف")}catch(Q){z(`فشل في حذف الملف: ${Q.message}`,"خطأ في الحذف")}finally{pe(!1)}};return n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[n.jsx("div",{className:"d-flex align-items-center",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:`bi ${de?"bi-pencil-square":"bi-person-plus-fill"} text-primary me-2`}),de?"تعديل بيانات الموظف":"إضافة موظف جديد"]})}),n.jsx("div",{className:"d-flex gap-2",children:n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>b(!0),style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:"وثائق الموظف"})})]})}),n.jsx("div",{className:"card-body",children:n.jsxs("form",{onSubmit:fe,children:[n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"الاسم الكامل *"}),n.jsx("input",{type:"text",className:`form-control ${l.fullName?"is-invalid":""}`,name:"fullName",value:s.fullName,onChange:V,placeholder:"أدخل الاسم الكامل",disabled:u,required:!0}),l.fullName&&n.jsx("div",{className:"invalid-feedback",children:l.fullName})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"المسمى الوظيفي"}),n.jsx("input",{type:"text",className:`form-control ${l.jobTitle?"is-invalid":""}`,name:"jobTitle",value:s.jobTitle,onChange:V,placeholder:"أدخل المسمى الوظيفي",disabled:u}),l.jobTitle&&n.jsx("div",{className:"invalid-feedback",children:l.jobTitle})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"القسم"}),n.jsx("input",{type:"text",className:`form-control ${l.department?"is-invalid":""}`,name:"department",value:s.department,onChange:V,placeholder:"أدخل اسم القسم",disabled:u}),l.department&&n.jsx("div",{className:"invalid-feedback",children:l.department})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الهاتف *"}),n.jsx("input",{type:"tel",className:`form-control ${l.phone?"is-invalid":""}`,name:"phone",value:s.phone,onChange:V,placeholder:"أدخل رقم الهاتف",disabled:u,required:!0}),l.phone&&n.jsx("div",{className:"invalid-feedback",children:l.phone})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"البريد الإلكتروني *"}),n.jsx("input",{type:"email",className:`form-control ${l.email?"is-invalid":""}`,name:"email",value:s.email,onChange:V,placeholder:"أدخل البريد الإلكتروني",disabled:u,required:!0}),l.email&&n.jsx("div",{className:"invalid-feedback",children:l.email})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"كلمة المرور *"}),n.jsx("input",{type:"password",className:`form-control ${l.nationalId?"is-invalid":""}`,name:"nationalId",value:s.nationalId,onChange:V,placeholder:"أدخل كلمة المرور",disabled:u,required:!0}),l.nationalId&&n.jsx("div",{className:"invalid-feedback",children:l.nationalId})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"الراتب (ريال)"}),n.jsx("input",{type:"number",className:`form-control ${l.salary?"is-invalid":""}`,name:"salary",value:s.salary,onChange:V,placeholder:"أدخل الراتب",min:"0",step:"0.01",disabled:u}),l.salary&&n.jsx("div",{className:"invalid-feedback",children:l.salary})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"تاريخ التوظيف *"}),n.jsx("input",{type:"date",className:`form-control ${l.hireDate?"is-invalid":""}`,name:"hireDate",value:s.hireDate,onChange:V,disabled:u,required:!0}),l.hireDate&&n.jsx("div",{className:"invalid-feedback",children:l.hireDate})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الحالة"}),n.jsxs("div",{className:"d-flex gap-2 mt-2",children:[n.jsxs("button",{type:"button",className:`btn ${s.status==="active"?"btn-primary":"btn-outline-secondary"}`,onClick:()=>V({target:{name:"status",value:"active"}}),disabled:u,style:{minWidth:"80px",height:"38px",fontSize:"14px",borderRadius:"6px"},children:[s.status==="active"&&n.jsx("i",{className:"bi bi-check me-1"}),"نشط"]}),n.jsxs("button",{type:"button",className:`btn ${s.status==="inactive"?"btn-success":"btn-outline-secondary"}`,onClick:()=>V({target:{name:"status",value:"inactive"}}),disabled:u,style:{minWidth:"80px",height:"38px",fontSize:"14px",borderRadius:"6px"},children:[s.status==="inactive"&&n.jsx("i",{className:"bi bi-check me-1"}),"غير نشط"]})]}),l.status&&n.jsx("div",{className:"invalid-feedback d-block",children:l.status})]}),n.jsxs("div",{className:"col-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"ملاحظات"}),n.jsx("textarea",{className:`form-control ${l.notes?"is-invalid":""}`,name:"notes",value:s.notes,onChange:V,rows:"4",placeholder:"أدخل ملاحظات إضافية...",disabled:u}),l.notes&&n.jsx("div",{className:"invalid-feedback",children:l.notes})]})]}),n.jsx("div",{className:"row",children:n.jsxs("div",{className:"col-12 d-flex justify-content-center gap-3 mt-4 mb-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:re,disabled:u,style:{height:"32px",width:"80px",fontSize:"14px",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary",disabled:u,style:{height:"32px",width:"80px",fontSize:"14px",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center"},children:u?n.jsxs(n.Fragment,{children:[n.jsx(Mn,{size:"small"}),n.jsx("span",{className:"ms-2",children:de?"تحديث...":"حفظ..."})]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:`bi ${de?"bi-check-lg":"bi-plus-circle"} me-1`}),de?"تحديث":"حفظ"]})})]})})]})}),n.jsx(Tn,{show:k.show,onClose:W,title:k.title,message:k.message,type:k.type,onConfirm:k.onConfirm,confirmText:k.confirmText,cancelText:k.cancelText,showCancel:k.showCancel}),n.jsx(rv,{show:p,onClose:()=>b(!1),documents:w,setDocuments:N,tenderId:r?.id||"new",uploadingDocument:R,setUploadingDocument:O,handleDocumentUpload:_,handleDeleteClick:F,deleting:X,title:"وثائق الموظف"}),G&&n.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.7)",zIndex:1060},tabIndex:"-1",dir:"rtl",children:n.jsx("div",{className:"modal-dialog modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsx("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"12px 12px 0 0"},children:n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-pencil-square me-2"}),"تسمية الملف"]})}),n.jsx("div",{className:"modal-body",style:{padding:"25px"},children:n.jsxs("div",{className:"mb-4",children:[n.jsxs("div",{className:"d-flex align-items-center mb-3",children:[n.jsx("div",{className:"bg-success bg-opacity-10 p-2 rounded-circle me-3",children:n.jsx("i",{className:"bi bi-file-earmark-check text-success"})}),n.jsxs("div",{children:[n.jsx("h6",{className:"mb-0 fw-bold text-success",children:"تم رفع الملف بنجاح"}),n.jsx("small",{className:"text-muted",children:T?.originalFileName})]})]}),n.jsxs("div",{className:"mb-3",children:[n.jsxs("label",{className:"form-label fw-bold text-primary",children:[n.jsx("i",{className:"bi bi-tag me-1"}),"اسم الملف المخصص *"]}),n.jsx("input",{type:"text",className:"form-control",value:Z,onChange:$=>ie($.target.value),placeholder:"أدخل اسم الملف المخصص",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:$=>{$.target.style.borderColor="#28a745",$.target.style.boxShadow="0 0 0 0.2rem rgba(40, 167, 69, 0.25)"},onBlur:$=>{$.target.style.borderColor="#e9ecef",$.target.style.boxShadow="none"},autoFocus:!0}),n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),"سيتم استخدام هذا الاسم لعرض الملف في قائمة الوثائق"]})]})]})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:n.jsxs("div",{className:"d-flex justify-content-end",style:{gap:"12px"},children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:D,style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500"},children:"إلغاء"}),n.jsxs("button",{type:"button",className:"btn btn-success",onClick:E,disabled:!Z.trim(),style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500",opacity:Z.trim()?1:.6},children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),"حفظ"]})]})})]})})})]})};function SF(){os();const[r,e]=j.useState(!1),[t,s]=j.useState("list"),[a,l]=j.useState(null),[c,u]=j.useState(0),{isTimelineVisible:m}=Hn(),p=()=>{e(!r)},b=()=>{l(null),s("add")},w=T=>{l(T),s("edit")},N=T=>{l(T),s("view")},R=()=>{s("list"),l(null),u(T=>T+1)},O=()=>{R()},G=()=>{switch(t){case"add":return n.jsx(kb,{onSave:O,onCancel:R});case"edit":return n.jsx(kb,{employee:a,onSave:O,onCancel:R});case"view":return n.jsx(kb,{employee:a,onSave:O,onCancel:R});case"list":default:return n.jsx(EF,{onEdit:w,onAdd:b,onView:N,refreshTrigger:c})}},U=()=>{const T=[{text:"الرئيسية",href:"/"},{text:"الموارد البشرية",href:"/employees"}];switch(t){case"add":T.push({text:"إضافة موظف جديد",active:!0});break;case"edit":T.push({text:"تعديل موظف",active:!0});break;case"view":T.push({text:"عرض بيانات الموظف",active:!0});break;default:T.push({text:"الموظفون",active:!0});break}return T};return n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Xn,{onToggle:p}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!m?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsx("ol",{className:"breadcrumb m-0",children:U().map((T,ee)=>n.jsx("li",{className:`breadcrumb-item ${T.active?"text-secondary":""}`,...T.active&&{"aria-current":"page"},children:T.active?T.text:n.jsxs("a",{href:T.href,className:"text-decoration-none d-flex align-items-center",children:[ee===0&&n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:T.text})]})},ee))})}),n.jsx(Jn,{}),n.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:n.jsxs("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:[t!=="list"&&n.jsx("div",{className:"mb-3 d-flex justify-content-end",children:n.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:R,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-arrow-right",style:{marginRight:"5px"}}),"العودة للقائمة"]})}),G()]})}),!r&&m&&n.jsx(Zn,{rtl:!0}),!r&&m&&n.jsx(es,{})]})]})]})}function IF(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(SF,{})})})}const TF=()=>{const[r,e]=j.useState([]),[t,s]=j.useState([]),[a,l]=j.useState(!0),[c,u]=j.useState(""),[m,p]=j.useState(""),[b,w]=j.useState(""),{logActivity:N,getCurrentUser:R}=_n(),{alertConfig:O,closeAlert:G,showSuccess:U,showError:T,showConfirm:ee}=Cn(),{currentPage:Z,totalPages:ie,paginatedItems:X,handlePageChange:pe,resetPage:H,totalItems:B,itemsPerPage:k}=wa(t,30);j.useEffect(()=>{W()},[]),j.useEffect(()=>{if(b.trim()){const de=r.filter(Pe=>{const V=qn.getItemDisplayInfo(Pe),se=b.toLowerCase();return V.displayName?.toLowerCase().includes(se)||V.email?.toLowerCase().includes(se)||V.phone?.includes(b)||V.supplierName?.toLowerCase().includes(se)||V.category?.toLowerCase().includes(se)||V.contextName?.toLowerCase().includes(se)||V.price?.toLowerCase().includes(se)||V.name?.toLowerCase().includes(se)||Pe.originalCollection?.toLowerCase().includes(se)});s(de)}else s(r);H()},[b,r,H]);const W=async()=>{try{l(!0),u("");const de=await qn.getAllTrashItems();e(de),s(de)}catch(de){u(de.message)}finally{l(!1)}},J=async(de,Pe)=>{try{p(de),u("");const V=r.find(re=>re.id===de);if(V&&V.originalCollection==="tenderItems"){const re=V.tenderContext?.tenderTitle||"مناقصة غير محددة",_=V.tenderContext?.tenderId||"new";ee(`هل أنت متأكد من استعادة هذا البند؟

البند: ${Pe}
سيتم استعادته إلى: ${re}`,async()=>{try{e(D=>D.filter(F=>F.id!==de)),await qn.restoreItem(de);const E=R();N("task",`${E.name} استعاد بند مناقصة من المهملات`,`تم استعادة البند: ${Pe} للمناقصة: ${re}`),U(`تم استعادة البند بنجاح إلى المناقصة: ${re}`,"تمت الاستعادة"),setTimeout(W,1e3)}catch(E){console.error("Error restoring tender item:",E),e(D=>[...D,V]),T(`فشل في استعادة البند: ${E.message}`,"خطأ في الاستعادة")}finally{p("")}},"تأكيد استعادة بند المناقصة"),p("");return}e(re=>re.filter(_=>_.id!==de)),await qn.restoreItem(de);const se=R(),fe=qn.getItemDisplayInfo(V).name;N("task",`${se.name} استعاد ${fe} من المهملات`,`تم استعادة ${fe}: ${Pe}`),setTimeout(async()=>{await W()},500),U(`تم استعادة العنصر بنجاح: ${Pe}`,"تم الاستعادة بنجاح")}catch(V){console.error("Restore error:",V),u(V.message),T(`فشل في الاستعادة: ${V.message}`,"خطأ في الاستعادة"),await W()}finally{p("")}},z=(de,Pe)=>{ee(`هل تريد حذف "${Pe}" نهائياً؟
لا يمكن التراجع عن هذا الإجراء!`,async()=>{try{p(de),u(""),e(re=>re.filter(_=>_.id!==de)),await qn.permanentlyDelete(de);const V=R(),se=r.find(re=>re.id===de),fe=qn.getItemDisplayInfo(se).name;N("task",`${V.name} حذف ${fe} نهائياً من المهملات`,`تم حذف ${fe} نهائياً: ${Pe}`),setTimeout(async()=>{await W()},500),U(`تم حذف العنصر نهائياً: ${Pe}`,"تم الحذف بنجاح")}catch(V){console.error("Permanent delete error:",V),u(V.message),T(`فشل في الحذف: ${V.message}`,"خطأ في الحذف"),await W()}finally{p("")}},"تأكيد الحذف النهائي")},L=()=>{ee(`⚠️ تحذير: هل تريد مسح جميع سجلات المهملات نهائياً؟
هذا سيحذف جميع السجلات بما في ذلك التكرارات والبيانات الفاسدة.
لا يمكن التراجع عن هذا الإجراء!`,async()=>{try{l(!0),e([]),await qn.clearAllTrashRecords();const de=R();N("task",`${de.name} مسح جميع سجلات المهملات`,"تم مسح جميع السجلات من قاعدة البيانات"),await W(),U("تم مسح جميع سجلات المهملات بنجاح","تم المسح بنجاح")}catch(de){u(de.message),T(`فشل في مسح السجلات: ${de.message}`,"خطأ في المسح"),await W()}finally{l(!1)}},"تحذير - مسح جميع السجلات")};return n.jsxs("div",{className:"trash-list",children:[n.jsxs("div",{className:"card shadow-sm",children:[n.jsxs("div",{className:"card-header bg-white border-bottom py-4",children:[n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-trash text-danger me-2"}),"سلة المهملات (",t.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group trash-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المهملات...",value:b,onChange:de=>w(de.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted"})})]}),r.length>0&&n.jsxs("button",{className:"btn btn-danger shadow-sm px-4",onClick:L,disabled:a,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500",background:"linear-gradient(135deg, #dc3545 0%, #b02a37 100%)",border:"none",color:"white"},children:[n.jsx("i",{className:"bi bi-trash3 me-2"}),"مسح جميع السجلات"]})]})})]}),c&&n.jsxs("div",{className:"alert alert-danger mt-3 mb-0",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),c]})]}),n.jsx("div",{className:"card-body p-0",children:a?n.jsx(Mn,{show:!0,message:"جاري تحميل المهملات...",overlay:!1}):t.length===0?n.jsx("div",{className:"text-center py-5",children:n.jsxs("div",{className:"empty-state",children:[n.jsx("i",{className:"bi bi-trash3 text-muted mb-3",style:{fontSize:"4rem"}}),n.jsx("h5",{className:"text-muted",children:r.length===0?"سلة المهملات فارغة":"لا توجد نتائج للبحث"}),n.jsx("p",{className:"text-muted",children:r.length===0?"لا توجد عناصر محذوفة":"لا توجد عناصر تطابق البحث المحدد"})]})}):n.jsxs("div",{className:"p-4",children:[n.jsx("div",{className:"row g-3",children:X.map((de,Pe)=>{const V=qn.getItemDisplayInfo(de),se=qn.getTimeSinceDeleted(de.deletedAt),fe={fontSize:"12px",fontWeight:"600",color:"#6c757d",marginLeft:"8px"},re={fontSize:"13px",color:"#495057",fontWeight:"500"};return n.jsx("div",{className:"col-lg-4 col-md-6",children:n.jsxs("div",{className:"card h-100 shadow-sm",style:{borderRadius:"10px",border:"1px solid #e3e6f0",transition:"all 0.3s ease",overflow:"hidden"},children:[n.jsxs("div",{className:"card-body p-4",children:[n.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-3",children:[n.jsxs("span",{className:`badge bg-${V.color} px-3 py-2`,style:{borderRadius:"20px",fontSize:"11px",fontWeight:"600"},children:[n.jsx("i",{className:`bi ${V.icon} me-1`}),V.name]}),n.jsx("small",{className:"text-muted fw-medium",style:{fontSize:"11px"},children:se})]}),n.jsx("h6",{className:"card-title mb-3",style:{color:"#2c3e50",fontSize:"16px",fontWeight:"600",lineHeight:"1.3"},children:V.displayName}),n.jsxs("div",{className:"card-text",children:[de.originalCollection==="rawmaterials"&&n.jsxs("div",{className:"info-grid",children:[n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الفئة:"}),n.jsx("span",{className:"info-value",style:re,children:V.category})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الحد الأدنى:"}),n.jsx("span",{className:"info-value",style:re,children:V.minimumStock})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"المورد:"}),n.jsx("span",{className:"info-value",style:re,children:V.supplier})]})]}),de.originalCollection==="employees"&&n.jsxs("div",{className:"info-grid",children:[n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"البريد الإلكتروني:"}),n.jsx("span",{className:"info-value",style:re,children:de.email||"غير محدد"})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"رقم الهاتف:"}),n.jsx("span",{className:"info-value",style:re,children:de.phone||"غير محدد"})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"القسم:"}),n.jsx("span",{className:"info-value",style:re,children:de.department||"غير محدد"})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"المنصب:"}),n.jsx("span",{className:"info-value",style:re,children:de.jobTitle||"غير محدد"})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الحالة:"}),n.jsx("span",{className:`badge ${de.status==="active"?"bg-success":"bg-secondary"}`,style:{fontSize:"10px"},children:de.status==="active"?"نشط":"غير نشط"})]}),de.autoCreated&&n.jsx("div",{className:"info-item mb-2",children:n.jsxs("span",{className:"badge bg-warning text-dark",style:{fontSize:"10px"},children:[n.jsx("i",{className:"bi bi-robot me-1"}),"تم إنشاؤه تلقائياً"]})})]}),de.originalCollection==="price_quotes"&&n.jsxs("div",{className:"info-grid",children:[n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"السعر:"}),n.jsx("span",{className:"info-value text-success fw-bold",style:{...re,color:"#28a745"},children:V.price})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"المورد:"}),n.jsx("span",{className:"info-value",style:re,children:V.supplierName})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"التاريخ:"}),n.jsx("span",{className:"info-value",style:re,children:V.date})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsxs("span",{className:"info-label",style:fe,children:[V.contextLabel,":"]}),n.jsx("span",{className:"info-value",style:{...re,color:"#007bff"},children:V.contextName})]})]}),(de.originalCollection==="localproducts"||de.originalCollection==="foreignproducts")&&n.jsxs("div",{className:"info-grid",children:[n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الفئة:"}),n.jsx("span",{className:"info-value",style:re,children:V.category})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الوحدة:"}),n.jsx("span",{className:"info-value",style:re,children:V.unit})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"السعر:"}),n.jsx("span",{className:"info-value text-success fw-bold",style:{...re,color:"#28a745"},children:V.price})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"المورد:"}),n.jsx("span",{className:"info-value",style:re,children:V.supplier})]})]}),de.originalCollection==="tenderItems"&&n.jsxs("div",{className:"info-grid",children:[n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الكمية:"}),n.jsx("span",{className:"info-value",style:re,children:V.quantity})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"السعر:"}),n.jsx("span",{className:"info-value text-success fw-bold",style:{...re,color:"#28a745"},children:V.price})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"النوع:"}),n.jsx("span",{className:"info-value",style:re,children:V.itemType})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsxs("span",{className:"info-label",style:fe,children:[V.contextLabel,":"]}),n.jsx("span",{className:"info-value",style:{...re,color:"#007bff"},children:V.contextName})]})]}),de.originalCollection==="tender_documents"&&n.jsxs("div",{className:"info-grid",children:[n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الحجم:"}),n.jsx("span",{className:"info-value",style:re,children:V.fileSize})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"النوع:"}),n.jsx("span",{className:"info-value",style:re,children:V.fileType})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"المناقصة:"}),n.jsx("span",{className:"info-value fw-bold",style:{...re,color:"#007bff"},children:V.contextName})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"رقم المرجع:"}),n.jsx("span",{className:"info-value",style:{...re,color:"#6c757d",fontFamily:"monospace"},children:de.tenderReferenceNumber||"غير محدد"})]})]}),de.originalCollection==="employee_documents"&&n.jsxs("div",{className:"info-grid",children:[n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الاسم الأصلي:"}),n.jsx("span",{className:"info-value",style:{...re,fontSize:"12px",color:"#6c757d"},children:de.originalFileName||"غير محدد"})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الحجم:"}),n.jsx("span",{className:"info-value",style:re,children:de.fileSize?`${(de.fileSize/1024/1024).toFixed(2)} م.ب`:"غير محدد"})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"نوع الملف:"}),n.jsx("span",{className:"info-value",style:re,children:(()=>{const _=de.fileType||"";return _.includes("pdf")?"PDF":_.includes("word")||_.includes("document")?"Word":_.includes("image")?"صورة":_.split("/")[1]?.toUpperCase()||"غير معروف"})()})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الموظف:"}),n.jsx("span",{className:"info-value fw-bold",style:{...re,color:"#28a745"},children:de.employeeName||V.contextName})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"معرف الموظف:"}),n.jsx("span",{className:"info-value",style:{...re,color:"#6c757d",fontFamily:"monospace",fontSize:"12px"},children:de.employeeId||"غير محدد"})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"تاريخ الرفع:"}),n.jsx("span",{className:"info-value",style:{...re,color:"#6c757d",fontSize:"12px"},children:(()=>{const _=de.uploadedAt||de.uploadDate;if(!_)return"غير محدد";try{return new Date(_).toLocaleDateString("ar-SA",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return"غير محدد"}})()})]}),de.fileURL&&n.jsx("div",{className:"info-item mb-2",children:n.jsxs("span",{className:"badge bg-success bg-opacity-10 text-success",style:{fontSize:"10px"},children:[n.jsx("i",{className:"bi bi-link-45deg me-1"}),"رابط متاح للعرض"]})})]}),de.originalCollection==="manufacturedProducts"&&n.jsxs("div",{className:"info-grid",children:[de.referenceNumber&&n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"رقم المرجع:"}),n.jsx("span",{className:"info-value",style:{...re,fontFamily:"monospace",color:"#007bff"},children:de.referenceNumber})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"التكلفة التقديرية:"}),n.jsx("span",{className:"info-value text-success fw-bold",style:{...re,color:"#28a745"},children:de.estimatedValue?`${parseFloat(de.estimatedValue).toLocaleString("en-US")} ريال`:"لم يتم تحديدها"})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"تاريخ الإضافة:"}),n.jsx("span",{className:"info-value",style:re,children:(()=>{const _=de.submissionDeadline;if(!_)return"غير محدد";try{return new Date(_).toLocaleDateString("ar-SA",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return _}})()})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الحالة:"}),n.jsx("span",{className:`badge ${de.status==="active"?"bg-success":"bg-secondary"}`,style:{fontSize:"10px"},children:de.status==="active"?"نشط":"غير نشط"})]}),de.description&&n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الوصف:"}),n.jsx("span",{className:"info-value",style:{...re,fontSize:"12px",color:"#6c757d",lineHeight:"1.4"},children:de.description.length>80?`${de.description.substring(0,80)}...`:de.description})]}),de.internalId&&n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"المعرف الداخلي:"}),n.jsx("span",{className:"info-value",style:{...re,color:"#6c757d",fontFamily:"monospace",fontSize:"11px"},children:de.internalId})]}),de.createdAt&&n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"تاريخ الإنشاء:"}),n.jsx("span",{className:"info-value",style:{...re,color:"#6c757d",fontSize:"12px"},children:(()=>{try{let _;if(de.createdAt?.toDate)_=de.createdAt.toDate();else if(de.createdAt)_=new Date(de.createdAt);else return"غير محدد";return _.toLocaleDateString("ar-SA",{year:"numeric",month:"short",day:"numeric"})}catch{return"غير محدد"}})()})]})]}),(de.originalCollection==="suppliers"||de.originalCollection==="foreignSuppliers"||de.originalCollection==="customers")&&n.jsxs("div",{className:"info-grid",children:[n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"البريد:"}),n.jsx("span",{className:"info-value",style:re,children:V.email})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الهاتف:"}),n.jsx("span",{className:"info-value",style:{...re,direction:"ltr"},children:V.phone})]})]})]})]}),n.jsx("div",{className:"card-footer bg-white border-top",children:n.jsxs("div",{className:"d-flex justify-content-center gap-3",children:[n.jsx("button",{className:"btn btn-success",onClick:()=>J(de.id,V.displayName),disabled:m===de.id,title:"استعادة",style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",border:"none",color:"white"},children:m===de.id?n.jsx("span",{className:"spinner-border spinner-border-sm",style:{width:"12px",height:"12px"}}):"استعادة"}),n.jsx("button",{className:"btn btn-danger",onClick:()=>z(de.id,V.displayName),disabled:m===de.id,title:"حذف نهائي",style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",border:"none",color:"white"},children:m===de.id?n.jsx("span",{className:"spinner-border spinner-border-sm",style:{width:"12px",height:"12px"}}):"حذف"})]})})]})},de.id)})}),t.length>0&&n.jsx(va,{currentPage:Z,totalPages:ie,onPageChange:pe,totalItems:B,itemsPerPage:k})]})})]}),n.jsx(Tn,{show:O.show,onClose:G,title:O.title,message:O.message,type:O.type,onConfirm:O.onConfirm,confirmText:O.confirmText,cancelText:O.cancelText,showCancel:O.showCancel})]})};function CF(){const[r,e]=j.useState(!1),{isTimelineVisible:t}=Hn(),s=()=>{e(!r)};return n.jsx(un,{children:n.jsx(hn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Xn,{onToggle:s}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsxs("div",{style:{position:"sticky",top:0,zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"سلة المهملات"})]})}),n.jsx(Jn,{})]}),n.jsxs("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:[n.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"60px"},children:n.jsx(TF,{})}),n.jsx("div",{className:"app-footer",style:{textAlign:"center",padding:"20px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",marginTop:"20px"},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]})]}),!r&&t&&n.jsx(Zn,{rtl:!0}),!r&&t&&n.jsx(es,{})]})})})}function AF(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(CF,{})})})}function DF(){os();const{logActivity:r,getCurrentUser:e}=_n(),{alertConfig:t,closeAlert:s,showSuccess:a,showError:l,showConfirm:c}=Cn(),{isTimelineVisible:u}=Hn(),[m,p]=j.useState(!1),[b,w]=j.useState(!0),[N,R]=j.useState([]),[O,G]=j.useState([]),[U,T]=j.useState("categories"),[ee,Z]=j.useState({name:"",description:""}),[ie,X]=j.useState(null),[pe,H]=j.useState({name:"",description:""}),[B,k]=j.useState(null),[W,J]=j.useState(!1);j.useEffect(()=>{z()},[]);const z=async()=>{try{w(!0),await Yi.initializeDefaultSettings();const[D,F]=await Promise.all([Yi.getAllCategories(),Yi.getAllUnits()]);R(D),G(F)}catch(D){console.error("Error loading settings:",D),l("فشل في تحميل الإعدادات","خطأ في التحميل")}finally{w(!1)}},L=()=>{p(!m)},de=async D=>{if(D.preventDefault(),!ee.name.trim()){l("اسم الفئة مطلوب","بيانات ناقصة");return}try{J(!0);const F=e();ie?(await Yi.updateCategory(ie,ee),r("task",`${F.name} حدث فئة`,`تم تحديث الفئة: ${ee.name}`),a("تم تحديث الفئة بنجاح","تم التحديث"),X(null)):(await Yi.createCategory(ee),r("task",`${F.name} أضاف فئة جديدة`,`تم إضافة الفئة: ${ee.name}`),a("تم إضافة الفئة بنجاح","تم الإضافة")),Z({name:"",description:""}),z()}catch(F){l(F.message,"خطأ")}finally{J(!1)}},Pe=D=>{Z({name:D.name,description:D.description||""}),X(D.id)},V=D=>{c(`هل أنت متأكد من حذف الفئة "${D.name}"؟
لا يمكن التراجع عن هذا الإجراء!`,async()=>{try{J(!0),await Yi.deleteCategory(D.id);const F=e();r("task",`${F.name} حذف فئة`,`تم حذف الفئة: ${D.name}`),a("تم حذف الفئة بنجاح","تم الحذف"),z()}catch(F){l(F.message,"خطأ في الحذف")}finally{J(!1)}},"تأكيد الحذف")},se=()=>{Z({name:"",description:""}),X(null)},fe=async D=>{if(D.preventDefault(),!pe.name.trim()){l("اسم الوحدة مطلوب","بيانات ناقصة");return}try{J(!0);const F=e();B?(await Yi.updateUnit(B,pe),r("task",`${F.name} حدث وحدة`,`تم تحديث الوحدة: ${pe.name}`),a("تم تحديث الوحدة بنجاح","تم التحديث"),k(null)):(await Yi.createUnit(pe),r("task",`${F.name} أضاف وحدة جديدة`,`تم إضافة الوحدة: ${pe.name}`),a("تم إضافة الوحدة بنجاح","تم الإضافة")),H({name:"",description:""}),z()}catch(F){l(F.message,"خطأ")}finally{J(!1)}},re=D=>{H({name:D.name,description:D.description||""}),k(D.id)},_=D=>{c(`هل أنت متأكد من حذف الوحدة "${D.name}"؟
لا يمكن التراجع عن هذا الإجراء!`,async()=>{try{J(!0),await Yi.deleteUnit(D.id);const F=e();r("task",`${F.name} حذف وحدة`,`تم حذف الوحدة: ${D.name}`),a("تم حذف الوحدة بنجاح","تم الحذف"),z()}catch(F){l(F.message,"خطأ في الحذف")}finally{J(!1)}},"تأكيد الحذف")},E=()=>{H({name:"",description:""}),k(null)};return b?n.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"100vh"},children:n.jsx(Mn,{show:!0,message:"جاري تحميل الإعدادات..."})}):n.jsx(un,{children:n.jsxs(hn,{children:[n.jsxs("div",{className:`page-wrapper ${m?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Xn,{onToggle:L}),n.jsxs("div",{className:"main-container",style:{paddingRight:m?"72px":"250px",paddingLeft:m||!u?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:m?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Yn,{isCollapsed:m})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"الإعدادات العامة"})]})}),n.jsx(Jn,{}),n.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:n.jsx("div",{className:"app-content-area p-4",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsx("div",{className:"d-flex justify-content-between align-items-center",children:n.jsx("div",{className:"d-flex align-items-center",children:n.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[n.jsx("i",{className:"bi bi-gear-wide-connected text-primary me-2"}),"الإعدادات العامة"]})})})}),n.jsxs("div",{className:"card-body p-0",children:[n.jsxs("ul",{className:"nav nav-tabs border-bottom-0",id:"settingsTabs",role:"tablist",children:[n.jsx("li",{className:"nav-item",role:"presentation",children:n.jsxs("button",{className:`nav-link ${U==="categories"?"active":""}`,onClick:()=>T("categories"),type:"button",style:{borderRadius:"0",borderBottom:U==="categories"?"3px solid #007bff":"1px solid #dee2e6",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-tags me-2"}),"إدارة الفئات"]})}),n.jsx("li",{className:"nav-item",role:"presentation",children:n.jsxs("button",{className:`nav-link ${U==="units"?"active":""}`,onClick:()=>T("units"),type:"button",style:{borderRadius:"0",borderBottom:U==="units"?"3px solid #007bff":"1px solid #dee2e6",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-rulers me-2"}),"إدارة الوحدات"]})})]}),n.jsxs("div",{className:"tab-content p-4",children:[U==="categories"&&n.jsx("div",{className:"tab-pane fade show active",children:n.jsxs("div",{className:"row",children:[n.jsx("div",{className:"col-md-4",children:n.jsxs("div",{className:"card bg-light",children:[n.jsx("div",{className:"card-header",children:n.jsxs("h6",{className:"mb-0",children:[n.jsx("i",{className:"bi bi-plus-circle me-2"}),ie?"تحديث الفئة":"إضافة فئة جديدة"]})}),n.jsx("div",{className:"card-body",children:n.jsxs("form",{onSubmit:de,children:[n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{className:"form-label",children:"اسم الفئة *"}),n.jsx("input",{type:"text",className:"form-control",value:ee.name,onChange:D=>Z({...ee,name:D.target.value}),placeholder:"أدخل اسم الفئة",required:!0})]}),n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{className:"form-label",children:"الوصف"}),n.jsx("textarea",{className:"form-control",rows:"2",value:ee.description,onChange:D=>Z({...ee,description:D.target.value}),placeholder:"وصف اختياري للفئة"})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsxs("button",{type:"submit",className:"btn btn-primary flex-fill",disabled:W,style:{height:"32px",fontSize:"14px"},children:[W?n.jsx("span",{className:"spinner-border spinner-border-sm me-2"}):n.jsx("i",{className:`bi ${ie?"bi-check-lg":"bi-plus-lg"} me-2`}),ie?"تحديث":"إضافة"]}),ie&&n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:se,style:{height:"32px",fontSize:"14px"},children:"إلغاء"})]})]})})]})}),n.jsx("div",{className:"col-md-8",children:n.jsxs("div",{className:"card",children:[n.jsx("div",{className:"card-header",children:n.jsxs("h6",{className:"mb-0",children:[n.jsx("i",{className:"bi bi-list me-2"}),"قائمة الفئات (",N.length,")"]})}),n.jsx("div",{className:"card-body p-0",children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{children:"اسم الفئة"}),n.jsx("th",{children:"الوصف"}),n.jsx("th",{style:{width:"100px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:N.length===0?n.jsx("tr",{children:n.jsxs("td",{colSpan:"3",className:"text-center py-4 text-muted",children:[n.jsx("i",{className:"bi bi-inbox fs-1 d-block mb-2"}),"لا توجد فئات مضافة"]})}):N.map(D=>n.jsxs("tr",{children:[n.jsx("td",{children:n.jsx("strong",{children:D.name})}),n.jsx("td",{children:n.jsx("small",{className:"text-muted",children:D.description||"لا يوجد وصف"})}),n.jsx("td",{children:n.jsxs("div",{className:"btn-group",style:{gap:"4px"},children:[n.jsx("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>Pe(D),title:"تحديث",style:{width:"32px",height:"28px"},children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>V(D),title:"حذف",style:{width:"32px",height:"28px"},children:n.jsx("i",{className:"bi bi-trash"})})]})})]},D.id))})]})})})]})})]})}),U==="units"&&n.jsx("div",{className:"tab-pane fade show active",children:n.jsxs("div",{className:"row",children:[n.jsx("div",{className:"col-md-4",children:n.jsxs("div",{className:"card bg-light",children:[n.jsx("div",{className:"card-header",children:n.jsxs("h6",{className:"mb-0",children:[n.jsx("i",{className:"bi bi-plus-circle me-2"}),B?"تحديث الوحدة":"إضافة وحدة جديدة"]})}),n.jsx("div",{className:"card-body",children:n.jsxs("form",{onSubmit:fe,children:[n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{className:"form-label",children:"اسم الوحدة *"}),n.jsx("input",{type:"text",className:"form-control",value:pe.name,onChange:D=>H({...pe,name:D.target.value}),placeholder:"مثال: متر، كيلو جرام",required:!0})]}),n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{className:"form-label",children:"الوصف"}),n.jsx("textarea",{className:"form-control",rows:"2",value:pe.description,onChange:D=>H({...pe,description:D.target.value}),placeholder:"وصف اختياري للوحدة"})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsxs("button",{type:"submit",className:"btn btn-primary flex-fill",disabled:W,style:{height:"32px",fontSize:"14px"},children:[W?n.jsx("span",{className:"spinner-border spinner-border-sm me-2"}):n.jsx("i",{className:`bi ${B?"bi-check-lg":"bi-plus-lg"} me-2`}),B?"تحديث":"إضافة"]}),B&&n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:E,style:{height:"32px",fontSize:"14px"},children:"إلغاء"})]})]})})]})}),n.jsx("div",{className:"col-md-8",children:n.jsxs("div",{className:"card",children:[n.jsx("div",{className:"card-header",children:n.jsxs("h6",{className:"mb-0",children:[n.jsx("i",{className:"bi bi-list me-2"}),"قائمة الوحدات (",O.length,")"]})}),n.jsx("div",{className:"card-body p-0",children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{children:"اسم الوحدة"}),n.jsx("th",{children:"الوصف"}),n.jsx("th",{style:{width:"100px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:O.length===0?n.jsx("tr",{children:n.jsxs("td",{colSpan:"3",className:"text-center py-4 text-muted",children:[n.jsx("i",{className:"bi bi-inbox fs-1 d-block mb-2"}),"لا توجد وحدات مضافة"]})}):O.map(D=>n.jsxs("tr",{children:[n.jsx("td",{children:n.jsx("strong",{children:D.name})}),n.jsx("td",{children:n.jsx("small",{className:"text-muted",children:D.description||"لا يوجد وصف"})}),n.jsx("td",{children:n.jsxs("div",{className:"btn-group",style:{gap:"4px"},children:[n.jsx("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>re(D),title:"تحديث",style:{width:"32px",height:"28px"},children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>_(D),title:"حذف",style:{width:"32px",height:"28px"},children:n.jsx("i",{className:"bi bi-trash"})})]})})]},D.id))})]})})})]})})]})})]})]})]})})})]}),!m&&u&&n.jsx(Zn,{rtl:!0}),!m&&u&&n.jsx(es,{})]})]}),n.jsx(Tn,{show:t.show,onClose:s,title:t.title,message:t.message,type:t.type,onConfirm:t.onConfirm,confirmText:t.confirmText,cancelText:t.cancelText,showCancel:t.showCancel})]})})}function RF(){return n.jsx(un,{children:n.jsx(hn,{children:n.jsx(DF,{})})})}const PF=()=>n.jsx(q5,{children:n.jsx(z5,{children:n.jsx(z2,{basename:"/",children:n.jsxs(y2,{children:[n.jsx(vn,{path:"/",element:n.jsx(FE,{})}),n.jsx(vn,{path:"/tender",element:n.jsx(FE,{})}),n.jsx(vn,{path:"/tenders/list",element:n.jsx(m4,{})}),n.jsx(vn,{path:"/tenders/add",element:n.jsx(UE,{})}),n.jsx(vn,{path:"/tenders/edit/:id",element:n.jsx(UE,{})}),n.jsx(vn,{path:"/tenders/tracking",element:n.jsx(N4,{})}),n.jsx(vn,{path:"/tenders/raw-materials/:tenderId",element:n.jsx(_4,{})}),n.jsx(vn,{path:"/tenders/local-products/:tenderId",element:n.jsx(S4,{})}),n.jsx(vn,{path:"/tenders/foreign-products/:tenderId",element:n.jsx(T4,{})}),n.jsx(vn,{path:"/tenders/manufactured-products/:tenderId",element:n.jsx(D4,{})}),n.jsx(vn,{path:"/raw-materials",element:n.jsx(M4,{})}),n.jsx(vn,{path:"/raw-materials/add",element:n.jsx(zE,{})}),n.jsx(vn,{path:"/raw-materials/edit/:id",element:n.jsx(zE,{})}),n.jsx(vn,{path:"/local-products",element:n.jsx(B4,{})}),n.jsx(vn,{path:"/local-products/add",element:n.jsx($E,{})}),n.jsx(vn,{path:"/local-products/edit/:id",element:n.jsx($E,{})}),n.jsx(vn,{path:"/foreign-products",element:n.jsx(Q4,{})}),n.jsx(vn,{path:"/foreign-products/add",element:n.jsx(BE,{})}),n.jsx(vn,{path:"/foreign-products/edit/:id",element:n.jsx(BE,{})}),n.jsx(vn,{path:"/manufactured-products",element:n.jsx(X4,{})}),n.jsx(vn,{path:"/manufactured-products/add",element:n.jsx(qE,{})}),n.jsx(vn,{path:"/manufactured-products/edit/:id",element:n.jsx(qE,{})}),n.jsx(vn,{path:"/manufactured-products/raw-materials/:productId",element:n.jsx(eF,{})}),n.jsx(vn,{path:"/manufactured-products/local-products/:productId",element:n.jsx(nF,{})}),n.jsx(vn,{path:"/manufactured-products/foreign-products/:productId",element:n.jsx(rF,{})}),n.jsx(vn,{path:"/suppliers/local",element:n.jsx(lF,{})}),n.jsx(vn,{path:"/suppliers/foreign",element:n.jsx(hF,{})}),n.jsx(vn,{path:"/clients",element:n.jsx(xF,{})}),n.jsx(vn,{path:"/companies",element:n.jsx(jF,{})}),n.jsx(vn,{path:"/employees",element:n.jsx(IF,{})}),n.jsx(vn,{path:"/trash",element:n.jsx(AF,{})}),n.jsx(vn,{path:"/settings",element:n.jsx(RF,{})})]})})})});function kF(){return n.jsx(X5,{children:n.jsx(PF,{})})}var Dg={exports:{}};/*!
  * Bootstrap v5.3.7 (https://getbootstrap.com/)
  * Copyright 2011-2025 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */var OF=Dg.exports,HE;function MF(){return HE||(HE=1,function(r,e){(function(t,s){r.exports=s()})(OF,function(){const t=new Map,s={set(M,x,S){t.has(M)||t.set(M,new Map);const K=t.get(M);K.has(x)||K.size===0?K.set(x,S):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(K.keys())[0]}.`)},get:(M,x)=>t.has(M)&&t.get(M).get(x)||null,remove(M,x){if(!t.has(M))return;const S=t.get(M);S.delete(x),S.size===0&&t.delete(M)}},a="transitionend",l=M=>(M&&window.CSS&&window.CSS.escape&&(M=M.replace(/#([^\s"#']+)/g,(x,S)=>`#${CSS.escape(S)}`)),M),c=M=>{M.dispatchEvent(new Event(a))},u=M=>!(!M||typeof M!="object")&&(M.jquery!==void 0&&(M=M[0]),M.nodeType!==void 0),m=M=>u(M)?M.jquery?M[0]:M:typeof M=="string"&&M.length>0?document.querySelector(l(M)):null,p=M=>{if(!u(M)||M.getClientRects().length===0)return!1;const x=getComputedStyle(M).getPropertyValue("visibility")==="visible",S=M.closest("details:not([open])");if(!S)return x;if(S!==M){const K=M.closest("summary");if(K&&K.parentNode!==S||K===null)return!1}return x},b=M=>!M||M.nodeType!==Node.ELEMENT_NODE||!!M.classList.contains("disabled")||(M.disabled!==void 0?M.disabled:M.hasAttribute("disabled")&&M.getAttribute("disabled")!=="false"),w=M=>{if(!document.documentElement.attachShadow)return null;if(typeof M.getRootNode=="function"){const x=M.getRootNode();return x instanceof ShadowRoot?x:null}return M instanceof ShadowRoot?M:M.parentNode?w(M.parentNode):null},N=()=>{},R=M=>{M.offsetHeight},O=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,G=[],U=()=>document.documentElement.dir==="rtl",T=M=>{var x;x=()=>{const S=O();if(S){const K=M.NAME,xe=S.fn[K];S.fn[K]=M.jQueryInterface,S.fn[K].Constructor=M,S.fn[K].noConflict=()=>(S.fn[K]=xe,M.jQueryInterface)}},document.readyState==="loading"?(G.length||document.addEventListener("DOMContentLoaded",()=>{for(const S of G)S()}),G.push(x)):x()},ee=(M,x=[],S=M)=>typeof M=="function"?M.call(...x):S,Z=(M,x,S=!0)=>{if(!S)return void ee(M);const K=(Me=>{if(!Me)return 0;let{transitionDuration:He,transitionDelay:st}=window.getComputedStyle(Me);const ut=Number.parseFloat(He),xt=Number.parseFloat(st);return ut||xt?(He=He.split(",")[0],st=st.split(",")[0],1e3*(Number.parseFloat(He)+Number.parseFloat(st))):0})(x)+5;let xe=!1;const Ne=({target:Me})=>{Me===x&&(xe=!0,x.removeEventListener(a,Ne),ee(M))};x.addEventListener(a,Ne),setTimeout(()=>{xe||c(x)},K)},ie=(M,x,S,K)=>{const xe=M.length;let Ne=M.indexOf(x);return Ne===-1?!S&&K?M[xe-1]:M[0]:(Ne+=S?1:-1,K&&(Ne=(Ne+xe)%xe),M[Math.max(0,Math.min(Ne,xe-1))])},X=/[^.]*(?=\..*)\.|.*/,pe=/\..*/,H=/::\d+$/,B={};let k=1;const W={mouseenter:"mouseover",mouseleave:"mouseout"},J=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function z(M,x){return x&&`${x}::${k++}`||M.uidEvent||k++}function L(M){const x=z(M);return M.uidEvent=x,B[x]=B[x]||{},B[x]}function de(M,x,S=null){return Object.values(M).find(K=>K.callable===x&&K.delegationSelector===S)}function Pe(M,x,S){const K=typeof x=="string",xe=K?S:x||S;let Ne=re(M);return J.has(Ne)||(Ne=M),[K,xe,Ne]}function V(M,x,S,K,xe){if(typeof x!="string"||!M)return;let[Ne,Me,He]=Pe(x,S,K);x in W&&(Me=(Bt=>function(Mt){if(!Mt.relatedTarget||Mt.relatedTarget!==Mt.delegateTarget&&!Mt.delegateTarget.contains(Mt.relatedTarget))return Bt.call(this,Mt)})(Me));const st=L(M),ut=st[He]||(st[He]={}),xt=de(ut,Me,Ne?S:null);if(xt)return void(xt.oneOff=xt.oneOff&&xe);const ot=z(Me,x.replace(X,"")),$t=Ne?function(Ct,Bt,Mt){return function Rt(wn){const An=Ct.querySelectorAll(Bt);for(let{target:Wt}=wn;Wt&&Wt!==this;Wt=Wt.parentNode)for(const fn of An)if(fn===Wt)return E(wn,{delegateTarget:Wt}),Rt.oneOff&&_.off(Ct,wn.type,Bt,Mt),Mt.apply(Wt,[wn])}}(M,S,Me):function(Ct,Bt){return function Mt(Rt){return E(Rt,{delegateTarget:Ct}),Mt.oneOff&&_.off(Ct,Rt.type,Bt),Bt.apply(Ct,[Rt])}}(M,Me);$t.delegationSelector=Ne?S:null,$t.callable=Me,$t.oneOff=xe,$t.uidEvent=ot,ut[ot]=$t,M.addEventListener(He,$t,Ne)}function se(M,x,S,K,xe){const Ne=de(x[S],K,xe);Ne&&(M.removeEventListener(S,Ne,!!xe),delete x[S][Ne.uidEvent])}function fe(M,x,S,K){const xe=x[S]||{};for(const[Ne,Me]of Object.entries(xe))Ne.includes(K)&&se(M,x,S,Me.callable,Me.delegationSelector)}function re(M){return M=M.replace(pe,""),W[M]||M}const _={on(M,x,S,K){V(M,x,S,K,!1)},one(M,x,S,K){V(M,x,S,K,!0)},off(M,x,S,K){if(typeof x!="string"||!M)return;const[xe,Ne,Me]=Pe(x,S,K),He=Me!==x,st=L(M),ut=st[Me]||{},xt=x.startsWith(".");if(Ne===void 0){if(xt)for(const ot of Object.keys(st))fe(M,st,ot,x.slice(1));for(const[ot,$t]of Object.entries(ut)){const Ct=ot.replace(H,"");He&&!x.includes(Ct)||se(M,st,Me,$t.callable,$t.delegationSelector)}}else{if(!Object.keys(ut).length)return;se(M,st,Me,Ne,xe?S:null)}},trigger(M,x,S){if(typeof x!="string"||!M)return null;const K=O();let xe=null,Ne=!0,Me=!0,He=!1;x!==re(x)&&K&&(xe=K.Event(x,S),K(M).trigger(xe),Ne=!xe.isPropagationStopped(),Me=!xe.isImmediatePropagationStopped(),He=xe.isDefaultPrevented());const st=E(new Event(x,{bubbles:Ne,cancelable:!0}),S);return He&&st.preventDefault(),Me&&M.dispatchEvent(st),st.defaultPrevented&&xe&&xe.preventDefault(),st}};function E(M,x={}){for(const[S,K]of Object.entries(x))try{M[S]=K}catch{Object.defineProperty(M,S,{configurable:!0,get:()=>K})}return M}function D(M){if(M==="true")return!0;if(M==="false")return!1;if(M===Number(M).toString())return Number(M);if(M===""||M==="null")return null;if(typeof M!="string")return M;try{return JSON.parse(decodeURIComponent(M))}catch{return M}}function F(M){return M.replace(/[A-Z]/g,x=>`-${x.toLowerCase()}`)}const te={setDataAttribute(M,x,S){M.setAttribute(`data-bs-${F(x)}`,S)},removeDataAttribute(M,x){M.removeAttribute(`data-bs-${F(x)}`)},getDataAttributes(M){if(!M)return{};const x={},S=Object.keys(M.dataset).filter(K=>K.startsWith("bs")&&!K.startsWith("bsConfig"));for(const K of S){let xe=K.replace(/^bs/,"");xe=xe.charAt(0).toLowerCase()+xe.slice(1),x[xe]=D(M.dataset[K])}return x},getDataAttribute:(M,x)=>D(M.getAttribute(`data-bs-${F(x)}`))};class ${static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(x){return x=this._mergeConfigObj(x),x=this._configAfterMerge(x),this._typeCheckConfig(x),x}_configAfterMerge(x){return x}_mergeConfigObj(x,S){const K=u(S)?te.getDataAttribute(S,"config"):{};return{...this.constructor.Default,...typeof K=="object"?K:{},...u(S)?te.getDataAttributes(S):{},...typeof x=="object"?x:{}}}_typeCheckConfig(x,S=this.constructor.DefaultType){for(const[xe,Ne]of Object.entries(S)){const Me=x[xe],He=u(Me)?"element":(K=Me)==null?`${K}`:Object.prototype.toString.call(K).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(Ne).test(He))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${xe}" provided type "${He}" but expected type "${Ne}".`)}var K}}class Q extends ${constructor(x,S){super(),(x=m(x))&&(this._element=x,this._config=this._getConfig(S),s.set(this._element,this.constructor.DATA_KEY,this))}dispose(){s.remove(this._element,this.constructor.DATA_KEY),_.off(this._element,this.constructor.EVENT_KEY);for(const x of Object.getOwnPropertyNames(this))this[x]=null}_queueCallback(x,S,K=!0){Z(x,S,K)}_getConfig(x){return x=this._mergeConfigObj(x,this._element),x=this._configAfterMerge(x),this._typeCheckConfig(x),x}static getInstance(x){return s.get(m(x),this.DATA_KEY)}static getOrCreateInstance(x,S={}){return this.getInstance(x)||new this(x,typeof S=="object"?S:null)}static get VERSION(){return"5.3.7"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(x){return`${x}${this.EVENT_KEY}`}}const me=M=>{let x=M.getAttribute("data-bs-target");if(!x||x==="#"){let S=M.getAttribute("href");if(!S||!S.includes("#")&&!S.startsWith("."))return null;S.includes("#")&&!S.startsWith("#")&&(S=`#${S.split("#")[1]}`),x=S&&S!=="#"?S.trim():null}return x?x.split(",").map(S=>l(S)).join(","):null},I={find:(M,x=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(x,M)),findOne:(M,x=document.documentElement)=>Element.prototype.querySelector.call(x,M),children:(M,x)=>[].concat(...M.children).filter(S=>S.matches(x)),parents(M,x){const S=[];let K=M.parentNode.closest(x);for(;K;)S.push(K),K=K.parentNode.closest(x);return S},prev(M,x){let S=M.previousElementSibling;for(;S;){if(S.matches(x))return[S];S=S.previousElementSibling}return[]},next(M,x){let S=M.nextElementSibling;for(;S;){if(S.matches(x))return[S];S=S.nextElementSibling}return[]},focusableChildren(M){const x=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(S=>`${S}:not([tabindex^="-"])`).join(",");return this.find(x,M).filter(S=>!b(S)&&p(S))},getSelectorFromElement(M){const x=me(M);return x&&I.findOne(x)?x:null},getElementFromSelector(M){const x=me(M);return x?I.findOne(x):null},getMultipleElementsFromSelector(M){const x=me(M);return x?I.find(x):[]}},le=(M,x="hide")=>{const S=`click.dismiss${M.EVENT_KEY}`,K=M.NAME;_.on(document,S,`[data-bs-dismiss="${K}"]`,function(xe){if(["A","AREA"].includes(this.tagName)&&xe.preventDefault(),b(this))return;const Ne=I.getElementFromSelector(this)||this.closest(`.${K}`);M.getOrCreateInstance(Ne)[x]()})},We=".bs.alert",nt=`close${We}`,mt=`closed${We}`;class It extends Q{static get NAME(){return"alert"}close(){if(_.trigger(this._element,nt).defaultPrevented)return;this._element.classList.remove("show");const x=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,x)}_destroyElement(){this._element.remove(),_.trigger(this._element,mt),this.dispose()}static jQueryInterface(x){return this.each(function(){const S=It.getOrCreateInstance(this);if(typeof x=="string"){if(S[x]===void 0||x.startsWith("_")||x==="constructor")throw new TypeError(`No method named "${x}"`);S[x](this)}})}}le(It,"close"),T(It);const rn='[data-bs-toggle="button"]';class oe extends Q{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(x){return this.each(function(){const S=oe.getOrCreateInstance(this);x==="toggle"&&S[x]()})}}_.on(document,"click.bs.button.data-api",rn,M=>{M.preventDefault();const x=M.target.closest(rn);oe.getOrCreateInstance(x).toggle()}),T(oe);const Ue=".bs.swipe",Je=`touchstart${Ue}`,lt=`touchmove${Ue}`,Dt=`touchend${Ue}`,Ht=`pointerdown${Ue}`,Ze=`pointerup${Ue}`,Vt={endCallback:null,leftCallback:null,rightCallback:null},Xt={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class ts extends ${constructor(x,S){super(),this._element=x,x&&ts.isSupported()&&(this._config=this._getConfig(S),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return Vt}static get DefaultType(){return Xt}static get NAME(){return"swipe"}dispose(){_.off(this._element,Ue)}_start(x){this._supportPointerEvents?this._eventIsPointerPenTouch(x)&&(this._deltaX=x.clientX):this._deltaX=x.touches[0].clientX}_end(x){this._eventIsPointerPenTouch(x)&&(this._deltaX=x.clientX-this._deltaX),this._handleSwipe(),ee(this._config.endCallback)}_move(x){this._deltaX=x.touches&&x.touches.length>1?0:x.touches[0].clientX-this._deltaX}_handleSwipe(){const x=Math.abs(this._deltaX);if(x<=40)return;const S=x/this._deltaX;this._deltaX=0,S&&ee(S>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(_.on(this._element,Ht,x=>this._start(x)),_.on(this._element,Ze,x=>this._end(x)),this._element.classList.add("pointer-event")):(_.on(this._element,Je,x=>this._start(x)),_.on(this._element,lt,x=>this._move(x)),_.on(this._element,Dt,x=>this._end(x)))}_eventIsPointerPenTouch(x){return this._supportPointerEvents&&(x.pointerType==="pen"||x.pointerType==="touch")}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const ns=".bs.carousel",mn=".data-api",Kt="ArrowLeft",En="ArrowRight",C="next",ne="prev",ue="left",ce="right",ye=`slide${ns}`,Le=`slid${ns}`,Nt=`keydown${ns}`,yt=`mouseenter${ns}`,$s=`mouseleave${ns}`,_e=`dragstart${ns}`,Xe=`load${ns}${mn}`,Be=`click${ns}${mn}`,he="carousel",be="active",De=".active",ve=".carousel-item",ze=De+ve,$e={[Kt]:ce,[En]:ue},Ke={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},we={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class et extends Q{constructor(x,S){super(x,S),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=I.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===he&&this.cycle()}static get Default(){return Ke}static get DefaultType(){return we}static get NAME(){return"carousel"}next(){this._slide(C)}nextWhenVisible(){!document.hidden&&p(this._element)&&this.next()}prev(){this._slide(ne)}pause(){this._isSliding&&c(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?_.one(this._element,Le,()=>this.cycle()):this.cycle())}to(x){const S=this._getItems();if(x>S.length-1||x<0)return;if(this._isSliding)return void _.one(this._element,Le,()=>this.to(x));const K=this._getItemIndex(this._getActive());if(K===x)return;const xe=x>K?C:ne;this._slide(xe,S[x])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(x){return x.defaultInterval=x.interval,x}_addEventListeners(){this._config.keyboard&&_.on(this._element,Nt,x=>this._keydown(x)),this._config.pause==="hover"&&(_.on(this._element,yt,()=>this.pause()),_.on(this._element,$s,()=>this._maybeEnableCycle())),this._config.touch&&ts.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const S of I.find(".carousel-item img",this._element))_.on(S,_e,K=>K.preventDefault());const x={leftCallback:()=>this._slide(this._directionToOrder(ue)),rightCallback:()=>this._slide(this._directionToOrder(ce)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}};this._swipeHelper=new ts(this._element,x)}_keydown(x){if(/input|textarea/i.test(x.target.tagName))return;const S=$e[x.key];S&&(x.preventDefault(),this._slide(this._directionToOrder(S)))}_getItemIndex(x){return this._getItems().indexOf(x)}_setActiveIndicatorElement(x){if(!this._indicatorsElement)return;const S=I.findOne(De,this._indicatorsElement);S.classList.remove(be),S.removeAttribute("aria-current");const K=I.findOne(`[data-bs-slide-to="${x}"]`,this._indicatorsElement);K&&(K.classList.add(be),K.setAttribute("aria-current","true"))}_updateInterval(){const x=this._activeElement||this._getActive();if(!x)return;const S=Number.parseInt(x.getAttribute("data-bs-interval"),10);this._config.interval=S||this._config.defaultInterval}_slide(x,S=null){if(this._isSliding)return;const K=this._getActive(),xe=x===C,Ne=S||ie(this._getItems(),K,xe,this._config.wrap);if(Ne===K)return;const Me=this._getItemIndex(Ne),He=ot=>_.trigger(this._element,ot,{relatedTarget:Ne,direction:this._orderToDirection(x),from:this._getItemIndex(K),to:Me});if(He(ye).defaultPrevented||!K||!Ne)return;const st=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(Me),this._activeElement=Ne;const ut=xe?"carousel-item-start":"carousel-item-end",xt=xe?"carousel-item-next":"carousel-item-prev";Ne.classList.add(xt),R(Ne),K.classList.add(ut),Ne.classList.add(ut),this._queueCallback(()=>{Ne.classList.remove(ut,xt),Ne.classList.add(be),K.classList.remove(be,xt,ut),this._isSliding=!1,He(Le)},K,this._isAnimated()),st&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return I.findOne(ze,this._element)}_getItems(){return I.find(ve,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(x){return U()?x===ue?ne:C:x===ue?C:ne}_orderToDirection(x){return U()?x===ne?ue:ce:x===ne?ce:ue}static jQueryInterface(x){return this.each(function(){const S=et.getOrCreateInstance(this,x);if(typeof x!="number"){if(typeof x=="string"){if(S[x]===void 0||x.startsWith("_")||x==="constructor")throw new TypeError(`No method named "${x}"`);S[x]()}}else S.to(x)})}}_.on(document,Be,"[data-bs-slide], [data-bs-slide-to]",function(M){const x=I.getElementFromSelector(this);if(!x||!x.classList.contains(he))return;M.preventDefault();const S=et.getOrCreateInstance(x),K=this.getAttribute("data-bs-slide-to");return K?(S.to(K),void S._maybeEnableCycle()):te.getDataAttribute(this,"slide")==="next"?(S.next(),void S._maybeEnableCycle()):(S.prev(),void S._maybeEnableCycle())}),_.on(window,Xe,()=>{const M=I.find('[data-bs-ride="carousel"]');for(const x of M)et.getOrCreateInstance(x)}),T(et);const ke=".bs.collapse",Ve=`show${ke}`,Tt=`shown${ke}`,ft=`hide${ke}`,pt=`hidden${ke}`,ls=`click${ke}.data-api`,Ns="show",Hr="collapse",Ai="collapsing",Na=`:scope .${Hr} .${Hr}`,li='[data-bs-toggle="collapse"]',Di={parent:null,toggle:!0},Ri={parent:"(null|element)",toggle:"boolean"};class gs extends Q{constructor(x,S){super(x,S),this._isTransitioning=!1,this._triggerArray=[];const K=I.find(li);for(const xe of K){const Ne=I.getSelectorFromElement(xe),Me=I.find(Ne).filter(He=>He===this._element);Ne!==null&&Me.length&&this._triggerArray.push(xe)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return Di}static get DefaultType(){return Ri}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let x=[];if(this._config.parent&&(x=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(xe=>xe!==this._element).map(xe=>gs.getOrCreateInstance(xe,{toggle:!1}))),x.length&&x[0]._isTransitioning||_.trigger(this._element,Ve).defaultPrevented)return;for(const xe of x)xe.hide();const S=this._getDimension();this._element.classList.remove(Hr),this._element.classList.add(Ai),this._element.style[S]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const K=`scroll${S[0].toUpperCase()+S.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(Ai),this._element.classList.add(Hr,Ns),this._element.style[S]="",_.trigger(this._element,Tt)},this._element,!0),this._element.style[S]=`${this._element[K]}px`}hide(){if(this._isTransitioning||!this._isShown()||_.trigger(this._element,ft).defaultPrevented)return;const x=this._getDimension();this._element.style[x]=`${this._element.getBoundingClientRect()[x]}px`,R(this._element),this._element.classList.add(Ai),this._element.classList.remove(Hr,Ns);for(const S of this._triggerArray){const K=I.getElementFromSelector(S);K&&!this._isShown(K)&&this._addAriaAndCollapsedClass([S],!1)}this._isTransitioning=!0,this._element.style[x]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(Ai),this._element.classList.add(Hr),_.trigger(this._element,pt)},this._element,!0)}_isShown(x=this._element){return x.classList.contains(Ns)}_configAfterMerge(x){return x.toggle=!!x.toggle,x.parent=m(x.parent),x}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const x=this._getFirstLevelChildren(li);for(const S of x){const K=I.getElementFromSelector(S);K&&this._addAriaAndCollapsedClass([S],this._isShown(K))}}_getFirstLevelChildren(x){const S=I.find(Na,this._config.parent);return I.find(x,this._config.parent).filter(K=>!S.includes(K))}_addAriaAndCollapsedClass(x,S){if(x.length)for(const K of x)K.classList.toggle("collapsed",!S),K.setAttribute("aria-expanded",S)}static jQueryInterface(x){const S={};return typeof x=="string"&&/show|hide/.test(x)&&(S.toggle=!1),this.each(function(){const K=gs.getOrCreateInstance(this,S);if(typeof x=="string"){if(K[x]===void 0)throw new TypeError(`No method named "${x}"`);K[x]()}})}}_.on(document,ls,li,function(M){(M.target.tagName==="A"||M.delegateTarget&&M.delegateTarget.tagName==="A")&&M.preventDefault();for(const x of I.getMultipleElementsFromSelector(this))gs.getOrCreateInstance(x,{toggle:!1}).toggle()}),T(gs);var en="top",Bs="bottom",ks="right",$n="left",Gr="auto",ta=[en,Bs,ks,$n],Pi="start",Qr="end",Ec="clippingParents",ki="viewport",ur="popper",Os="reference",na=ta.reduce(function(M,x){return M.concat([x+"-"+Pi,x+"-"+Qr])},[]),hl=[].concat(ta,[Gr]).reduce(function(M,x){return M.concat([x,x+"-"+Pi,x+"-"+Qr])},[]),Oi="beforeRead",lo="read",co="afterRead",ml="beforeMain",uo="main",nr="afterMain",fl="beforeWrite",Dd="write",ho="afterWrite",pl=[Oi,lo,co,ml,uo,nr,fl,Dd,ho];function sr(M){return M?(M.nodeName||"").toLowerCase():null}function hr(M){if(M==null)return window;if(M.toString()!=="[object Window]"){var x=M.ownerDocument;return x&&x.defaultView||window}return M}function Ln(M){return M instanceof hr(M).Element||M instanceof Element}function Gn(M){return M instanceof hr(M).HTMLElement||M instanceof HTMLElement}function sa(M){return typeof ShadowRoot<"u"&&(M instanceof hr(M).ShadowRoot||M instanceof ShadowRoot)}const Mi={name:"applyStyles",enabled:!0,phase:"write",fn:function(M){var x=M.state;Object.keys(x.elements).forEach(function(S){var K=x.styles[S]||{},xe=x.attributes[S]||{},Ne=x.elements[S];Gn(Ne)&&sr(Ne)&&(Object.assign(Ne.style,K),Object.keys(xe).forEach(function(Me){var He=xe[Me];He===!1?Ne.removeAttribute(Me):Ne.setAttribute(Me,He===!0?"":He)}))})},effect:function(M){var x=M.state,S={popper:{position:x.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(x.elements.popper.style,S.popper),x.styles=S,x.elements.arrow&&Object.assign(x.elements.arrow.style,S.arrow),function(){Object.keys(x.elements).forEach(function(K){var xe=x.elements[K],Ne=x.attributes[K]||{},Me=Object.keys(x.styles.hasOwnProperty(K)?x.styles[K]:S[K]).reduce(function(He,st){return He[st]="",He},{});Gn(xe)&&sr(xe)&&(Object.assign(xe.style,Me),Object.keys(Ne).forEach(function(He){xe.removeAttribute(He)}))})}},requires:["computeStyles"]};function Ms(M){return M.split("-")[0]}var an=Math.max,Li=Math.min,qs=Math.round;function ra(){var M=navigator.userAgentData;return M!=null&&M.brands&&Array.isArray(M.brands)?M.brands.map(function(x){return x.brand+"/"+x.version}).join(" "):navigator.userAgent}function Sc(){return!/^((?!chrome|android).)*safari/i.test(ra())}function Fi(M,x,S){x===void 0&&(x=!1),S===void 0&&(S=!1);var K=M.getBoundingClientRect(),xe=1,Ne=1;x&&Gn(M)&&(xe=M.offsetWidth>0&&qs(K.width)/M.offsetWidth||1,Ne=M.offsetHeight>0&&qs(K.height)/M.offsetHeight||1);var Me=(Ln(M)?hr(M):window).visualViewport,He=!Sc()&&S,st=(K.left+(He&&Me?Me.offsetLeft:0))/xe,ut=(K.top+(He&&Me?Me.offsetTop:0))/Ne,xt=K.width/xe,ot=K.height/Ne;return{width:xt,height:ot,top:ut,right:st+xt,bottom:ut+ot,left:st,x:st,y:ut}}function mo(M){var x=Fi(M),S=M.offsetWidth,K=M.offsetHeight;return Math.abs(x.width-S)<=1&&(S=x.width),Math.abs(x.height-K)<=1&&(K=x.height),{x:M.offsetLeft,y:M.offsetTop,width:S,height:K}}function Rd(M,x){var S=x.getRootNode&&x.getRootNode();if(M.contains(x))return!0;if(S&&sa(S)){var K=x;do{if(K&&M.isSameNode(K))return!0;K=K.parentNode||K.host}while(K)}return!1}function ci(M){return hr(M).getComputedStyle(M)}function gl(M){return["table","td","th"].indexOf(sr(M))>=0}function rr(M){return((Ln(M)?M.ownerDocument:M.document)||window.document).documentElement}function mr(M){return sr(M)==="html"?M:M.assignedSlot||M.parentNode||(sa(M)?M.host:null)||rr(M)}function Ui(M){return Gn(M)&&ci(M).position!=="fixed"?M.offsetParent:null}function Lr(M){for(var x=hr(M),S=Ui(M);S&&gl(S)&&ci(S).position==="static";)S=Ui(S);return S&&(sr(S)==="html"||sr(S)==="body"&&ci(S).position==="static")?x:S||function(K){var xe=/firefox/i.test(ra());if(/Trident/i.test(ra())&&Gn(K)&&ci(K).position==="fixed")return null;var Ne=mr(K);for(sa(Ne)&&(Ne=Ne.host);Gn(Ne)&&["html","body"].indexOf(sr(Ne))<0;){var Me=ci(Ne);if(Me.transform!=="none"||Me.perspective!=="none"||Me.contain==="paint"||["transform","perspective"].indexOf(Me.willChange)!==-1||xe&&Me.willChange==="filter"||xe&&Me.filter&&Me.filter!=="none")return Ne;Ne=Ne.parentNode}return null}(M)||x}function fo(M){return["top","bottom"].indexOf(M)>=0?"x":"y"}function Er(M,x,S){return an(M,Li(x,S))}function Ic(M){return Object.assign({},{top:0,right:0,bottom:0,left:0},M)}function ja(M,x){return x.reduce(function(S,K){return S[K]=M,S},{})}const Wr={name:"arrow",enabled:!0,phase:"main",fn:function(M){var x,S=M.state,K=M.name,xe=M.options,Ne=S.elements.arrow,Me=S.modifiersData.popperOffsets,He=Ms(S.placement),st=fo(He),ut=[$n,ks].indexOf(He)>=0?"height":"width";if(Ne&&Me){var xt=function(Ft,gn){return Ic(typeof(Ft=typeof Ft=="function"?Ft(Object.assign({},gn.rects,{placement:gn.placement})):Ft)!="number"?Ft:ja(Ft,ta))}(xe.padding,S),ot=mo(Ne),$t=st==="y"?en:$n,Ct=st==="y"?Bs:ks,Bt=S.rects.reference[ut]+S.rects.reference[st]-Me[st]-S.rects.popper[ut],Mt=Me[st]-S.rects.reference[st],Rt=Lr(Ne),wn=Rt?st==="y"?Rt.clientHeight||0:Rt.clientWidth||0:0,An=Bt/2-Mt/2,Wt=xt[$t],fn=wn-ot[ut]-xt[Ct],Lt=wn/2-ot[ut]/2+An,ct=Er(Wt,Lt,fn),Et=st;S.modifiersData[K]=((x={})[Et]=ct,x.centerOffset=ct-Lt,x)}},effect:function(M){var x=M.state,S=M.options.element,K=S===void 0?"[data-popper-arrow]":S;K!=null&&(typeof K!="string"||(K=x.elements.popper.querySelector(K)))&&Rd(x.elements.popper,K)&&(x.elements.arrow=K)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Hs(M){return M.split("-")[1]}var po={top:"auto",right:"auto",bottom:"auto",left:"auto"};function di(M){var x,S=M.popper,K=M.popperRect,xe=M.placement,Ne=M.variation,Me=M.offsets,He=M.position,st=M.gpuAcceleration,ut=M.adaptive,xt=M.roundOffsets,ot=M.isFixed,$t=Me.x,Ct=$t===void 0?0:$t,Bt=Me.y,Mt=Bt===void 0?0:Bt,Rt=typeof xt=="function"?xt({x:Ct,y:Mt}):{x:Ct,y:Mt};Ct=Rt.x,Mt=Rt.y;var wn=Me.hasOwnProperty("x"),An=Me.hasOwnProperty("y"),Wt=$n,fn=en,Lt=window;if(ut){var ct=Lr(S),Et="clientHeight",Ft="clientWidth";ct===hr(S)&&ci(ct=rr(S)).position!=="static"&&He==="absolute"&&(Et="scrollHeight",Ft="scrollWidth"),(xe===en||(xe===$n||xe===ks)&&Ne===Qr)&&(fn=Bs,Mt-=(ot&&ct===Lt&&Lt.visualViewport?Lt.visualViewport.height:ct[Et])-K.height,Mt*=st?1:-1),xe!==$n&&(xe!==en&&xe!==Bs||Ne!==Qr)||(Wt=ks,Ct-=(ot&&ct===Lt&&Lt.visualViewport?Lt.visualViewport.width:ct[Ft])-K.width,Ct*=st?1:-1)}var gn,Fn=Object.assign({position:He},ut&&po),Is=xt===!0?function(Cr,Ts){var Ws=Cr.x,Jr=Cr.y,Qt=Ts.devicePixelRatio||1;return{x:qs(Ws*Qt)/Qt||0,y:qs(Jr*Qt)/Qt||0}}({x:Ct,y:Mt},hr(S)):{x:Ct,y:Mt};return Ct=Is.x,Mt=Is.y,st?Object.assign({},Fn,((gn={})[fn]=An?"0":"",gn[Wt]=wn?"0":"",gn.transform=(Lt.devicePixelRatio||1)<=1?"translate("+Ct+"px, "+Mt+"px)":"translate3d("+Ct+"px, "+Mt+"px, 0)",gn)):Object.assign({},Fn,((x={})[fn]=An?Mt+"px":"",x[Wt]=wn?Ct+"px":"",x.transform="",x))}const Vi={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(M){var x=M.state,S=M.options,K=S.gpuAcceleration,xe=K===void 0||K,Ne=S.adaptive,Me=Ne===void 0||Ne,He=S.roundOffsets,st=He===void 0||He,ut={placement:Ms(x.placement),variation:Hs(x.placement),popper:x.elements.popper,popperRect:x.rects.popper,gpuAcceleration:xe,isFixed:x.options.strategy==="fixed"};x.modifiersData.popperOffsets!=null&&(x.styles.popper=Object.assign({},x.styles.popper,di(Object.assign({},ut,{offsets:x.modifiersData.popperOffsets,position:x.options.strategy,adaptive:Me,roundOffsets:st})))),x.modifiersData.arrow!=null&&(x.styles.arrow=Object.assign({},x.styles.arrow,di(Object.assign({},ut,{offsets:x.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:st})))),x.attributes.popper=Object.assign({},x.attributes.popper,{"data-popper-placement":x.placement})},data:{}};var Kr={passive:!0};const go={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(M){var x=M.state,S=M.instance,K=M.options,xe=K.scroll,Ne=xe===void 0||xe,Me=K.resize,He=Me===void 0||Me,st=hr(x.elements.popper),ut=[].concat(x.scrollParents.reference,x.scrollParents.popper);return Ne&&ut.forEach(function(xt){xt.addEventListener("scroll",S.update,Kr)}),He&&st.addEventListener("resize",S.update,Kr),function(){Ne&&ut.forEach(function(xt){xt.removeEventListener("scroll",S.update,Kr)}),He&&st.removeEventListener("resize",S.update,Kr)}},data:{}};var zi={left:"right",right:"left",bottom:"top",top:"bottom"};function Fr(M){return M.replace(/left|right|bottom|top/g,function(x){return zi[x]})}var Tc={start:"end",end:"start"};function js(M){return M.replace(/start|end/g,function(x){return Tc[x]})}function pn(M){var x=hr(M);return{scrollLeft:x.pageXOffset,scrollTop:x.pageYOffset}}function _a(M){return Fi(rr(M)).left+pn(M).scrollLeft}function ia(M){var x=ci(M),S=x.overflow,K=x.overflowX,xe=x.overflowY;return/auto|scroll|overlay|hidden/.test(S+xe+K)}function Cc(M){return["html","body","#document"].indexOf(sr(M))>=0?M.ownerDocument.body:Gn(M)&&ia(M)?M:Cc(mr(M))}function $i(M,x){var S;x===void 0&&(x=[]);var K=Cc(M),xe=K===((S=M.ownerDocument)==null?void 0:S.body),Ne=hr(K),Me=xe?[Ne].concat(Ne.visualViewport||[],ia(K)?K:[]):K,He=x.concat(Me);return xe?He:He.concat($i(mr(Me)))}function Ea(M){return Object.assign({},M,{left:M.x,top:M.y,right:M.x+M.width,bottom:M.y+M.height})}function ui(M,x,S){return x===ki?Ea(function(K,xe){var Ne=hr(K),Me=rr(K),He=Ne.visualViewport,st=Me.clientWidth,ut=Me.clientHeight,xt=0,ot=0;if(He){st=He.width,ut=He.height;var $t=Sc();($t||!$t&&xe==="fixed")&&(xt=He.offsetLeft,ot=He.offsetTop)}return{width:st,height:ut,x:xt+_a(K),y:ot}}(M,S)):Ln(x)?function(K,xe){var Ne=Fi(K,!1,xe==="fixed");return Ne.top=Ne.top+K.clientTop,Ne.left=Ne.left+K.clientLeft,Ne.bottom=Ne.top+K.clientHeight,Ne.right=Ne.left+K.clientWidth,Ne.width=K.clientWidth,Ne.height=K.clientHeight,Ne.x=Ne.left,Ne.y=Ne.top,Ne}(x,S):Ea(function(K){var xe,Ne=rr(K),Me=pn(K),He=(xe=K.ownerDocument)==null?void 0:xe.body,st=an(Ne.scrollWidth,Ne.clientWidth,He?He.scrollWidth:0,He?He.clientWidth:0),ut=an(Ne.scrollHeight,Ne.clientHeight,He?He.scrollHeight:0,He?He.clientHeight:0),xt=-Me.scrollLeft+_a(K),ot=-Me.scrollTop;return ci(He||Ne).direction==="rtl"&&(xt+=an(Ne.clientWidth,He?He.clientWidth:0)-st),{width:st,height:ut,x:xt,y:ot}}(rr(M)))}function Sa(M){var x,S=M.reference,K=M.element,xe=M.placement,Ne=xe?Ms(xe):null,Me=xe?Hs(xe):null,He=S.x+S.width/2-K.width/2,st=S.y+S.height/2-K.height/2;switch(Ne){case en:x={x:He,y:S.y-K.height};break;case Bs:x={x:He,y:S.y+S.height};break;case ks:x={x:S.x+S.width,y:st};break;case $n:x={x:S.x-K.width,y:st};break;default:x={x:S.x,y:S.y}}var ut=Ne?fo(Ne):null;if(ut!=null){var xt=ut==="y"?"height":"width";switch(Me){case Pi:x[ut]=x[ut]-(S[xt]/2-K[xt]/2);break;case Qr:x[ut]=x[ut]+(S[xt]/2-K[xt]/2)}}return x}function Gs(M,x){x===void 0&&(x={});var S=x,K=S.placement,xe=K===void 0?M.placement:K,Ne=S.strategy,Me=Ne===void 0?M.strategy:Ne,He=S.boundary,st=He===void 0?Ec:He,ut=S.rootBoundary,xt=ut===void 0?ki:ut,ot=S.elementContext,$t=ot===void 0?ur:ot,Ct=S.altBoundary,Bt=Ct!==void 0&&Ct,Mt=S.padding,Rt=Mt===void 0?0:Mt,wn=Ic(typeof Rt!="number"?Rt:ja(Rt,ta)),An=$t===ur?Os:ur,Wt=M.rects.popper,fn=M.elements[Bt?An:$t],Lt=function(Ts,Ws,Jr,Qt){var Zr=Ws==="clippingParents"?function(Dn){var Ks=$i(mr(Dn)),Ar=["absolute","fixed"].indexOf(ci(Dn).position)>=0&&Gn(Dn)?Lr(Dn):Dn;return Ln(Ar)?Ks.filter(function(Gi){return Ln(Gi)&&Rd(Gi,Ar)&&sr(Gi)!=="body"}):[]}(Ts):[].concat(Ws),ei=[].concat(Zr,[Jr]),Mo=ei[0],Cs=ei.reduce(function(Dn,Ks){var Ar=ui(Ts,Ks,Qt);return Dn.top=an(Ar.top,Dn.top),Dn.right=Li(Ar.right,Dn.right),Dn.bottom=Li(Ar.bottom,Dn.bottom),Dn.left=an(Ar.left,Dn.left),Dn},ui(Ts,Mo,Qt));return Cs.width=Cs.right-Cs.left,Cs.height=Cs.bottom-Cs.top,Cs.x=Cs.left,Cs.y=Cs.top,Cs}(Ln(fn)?fn:fn.contextElement||rr(M.elements.popper),st,xt,Me),ct=Fi(M.elements.reference),Et=Sa({reference:ct,element:Wt,placement:xe}),Ft=Ea(Object.assign({},Wt,Et)),gn=$t===ur?Ft:ct,Fn={top:Lt.top-gn.top+wn.top,bottom:gn.bottom-Lt.bottom+wn.bottom,left:Lt.left-gn.left+wn.left,right:gn.right-Lt.right+wn.right},Is=M.modifiersData.offset;if($t===ur&&Is){var Cr=Is[xe];Object.keys(Fn).forEach(function(Ts){var Ws=[ks,Bs].indexOf(Ts)>=0?1:-1,Jr=[en,Bs].indexOf(Ts)>=0?"y":"x";Fn[Ts]+=Cr[Jr]*Ws})}return Fn}function Pd(M,x){x===void 0&&(x={});var S=x,K=S.placement,xe=S.boundary,Ne=S.rootBoundary,Me=S.padding,He=S.flipVariations,st=S.allowedAutoPlacements,ut=st===void 0?hl:st,xt=Hs(K),ot=xt?He?na:na.filter(function(Bt){return Hs(Bt)===xt}):ta,$t=ot.filter(function(Bt){return ut.indexOf(Bt)>=0});$t.length===0&&($t=ot);var Ct=$t.reduce(function(Bt,Mt){return Bt[Mt]=Gs(M,{placement:Mt,boundary:xe,rootBoundary:Ne,padding:Me})[Ms(Mt)],Bt},{});return Object.keys(Ct).sort(function(Bt,Mt){return Ct[Bt]-Ct[Mt]})}const kd={name:"flip",enabled:!0,phase:"main",fn:function(M){var x=M.state,S=M.options,K=M.name;if(!x.modifiersData[K]._skip){for(var xe=S.mainAxis,Ne=xe===void 0||xe,Me=S.altAxis,He=Me===void 0||Me,st=S.fallbackPlacements,ut=S.padding,xt=S.boundary,ot=S.rootBoundary,$t=S.altBoundary,Ct=S.flipVariations,Bt=Ct===void 0||Ct,Mt=S.allowedAutoPlacements,Rt=x.options.placement,wn=Ms(Rt),An=st||(wn!==Rt&&Bt?function(Dn){if(Ms(Dn)===Gr)return[];var Ks=Fr(Dn);return[js(Dn),Ks,js(Ks)]}(Rt):[Fr(Rt)]),Wt=[Rt].concat(An).reduce(function(Dn,Ks){return Dn.concat(Ms(Ks)===Gr?Pd(x,{placement:Ks,boundary:xt,rootBoundary:ot,padding:ut,flipVariations:Bt,allowedAutoPlacements:Mt}):Ks)},[]),fn=x.rects.reference,Lt=x.rects.popper,ct=new Map,Et=!0,Ft=Wt[0],gn=0;gn<Wt.length;gn++){var Fn=Wt[gn],Is=Ms(Fn),Cr=Hs(Fn)===Pi,Ts=[en,Bs].indexOf(Is)>=0,Ws=Ts?"width":"height",Jr=Gs(x,{placement:Fn,boundary:xt,rootBoundary:ot,altBoundary:$t,padding:ut}),Qt=Ts?Cr?ks:$n:Cr?Bs:en;fn[Ws]>Lt[Ws]&&(Qt=Fr(Qt));var Zr=Fr(Qt),ei=[];if(Ne&&ei.push(Jr[Is]<=0),He&&ei.push(Jr[Qt]<=0,Jr[Zr]<=0),ei.every(function(Dn){return Dn})){Ft=Fn,Et=!1;break}ct.set(Fn,ei)}if(Et)for(var Mo=function(Dn){var Ks=Wt.find(function(Ar){var Gi=ct.get(Ar);if(Gi)return Gi.slice(0,Dn).every(function(Ys){return Ys})});if(Ks)return Ft=Ks,"break"},Cs=Bt?3:1;Cs>0&&Mo(Cs)!=="break";Cs--);x.placement!==Ft&&(x.modifiersData[K]._skip=!0,x.placement=Ft,x.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Ia(M,x,S){return S===void 0&&(S={x:0,y:0}),{top:M.top-x.height-S.y,right:M.right-x.width+S.x,bottom:M.bottom-x.height+S.y,left:M.left-x.width-S.x}}function xo(M){return[en,ks,Bs,$n].some(function(x){return M[x]>=0})}const xl={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(M){var x=M.state,S=M.name,K=x.rects.reference,xe=x.rects.popper,Ne=x.modifiersData.preventOverflow,Me=Gs(x,{elementContext:"reference"}),He=Gs(x,{altBoundary:!0}),st=Ia(Me,K),ut=Ia(He,xe,Ne),xt=xo(st),ot=xo(ut);x.modifiersData[S]={referenceClippingOffsets:st,popperEscapeOffsets:ut,isReferenceHidden:xt,hasPopperEscaped:ot},x.attributes.popper=Object.assign({},x.attributes.popper,{"data-popper-reference-hidden":xt,"data-popper-escaped":ot})}},yo={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(M){var x=M.state,S=M.options,K=M.name,xe=S.offset,Ne=xe===void 0?[0,0]:xe,Me=hl.reduce(function(xt,ot){return xt[ot]=function($t,Ct,Bt){var Mt=Ms($t),Rt=[$n,en].indexOf(Mt)>=0?-1:1,wn=typeof Bt=="function"?Bt(Object.assign({},Ct,{placement:$t})):Bt,An=wn[0],Wt=wn[1];return An=An||0,Wt=(Wt||0)*Rt,[$n,ks].indexOf(Mt)>=0?{x:Wt,y:An}:{x:An,y:Wt}}(ot,x.rects,Ne),xt},{}),He=Me[x.placement],st=He.x,ut=He.y;x.modifiersData.popperOffsets!=null&&(x.modifiersData.popperOffsets.x+=st,x.modifiersData.popperOffsets.y+=ut),x.modifiersData[K]=Me}},yl={name:"popperOffsets",enabled:!0,phase:"read",fn:function(M){var x=M.state,S=M.name;x.modifiersData[S]=Sa({reference:x.rects.reference,element:x.rects.popper,placement:x.placement})},data:{}},bo={name:"preventOverflow",enabled:!0,phase:"main",fn:function(M){var x=M.state,S=M.options,K=M.name,xe=S.mainAxis,Ne=xe===void 0||xe,Me=S.altAxis,He=Me!==void 0&&Me,st=S.boundary,ut=S.rootBoundary,xt=S.altBoundary,ot=S.padding,$t=S.tether,Ct=$t===void 0||$t,Bt=S.tetherOffset,Mt=Bt===void 0?0:Bt,Rt=Gs(x,{boundary:st,rootBoundary:ut,padding:ot,altBoundary:xt}),wn=Ms(x.placement),An=Hs(x.placement),Wt=!An,fn=fo(wn),Lt=fn==="x"?"y":"x",ct=x.modifiersData.popperOffsets,Et=x.rects.reference,Ft=x.rects.popper,gn=typeof Mt=="function"?Mt(Object.assign({},x.rects,{placement:x.placement})):Mt,Fn=typeof gn=="number"?{mainAxis:gn,altAxis:gn}:Object.assign({mainAxis:0,altAxis:0},gn),Is=x.modifiersData.offset?x.modifiersData.offset[x.placement]:null,Cr={x:0,y:0};if(ct){if(Ne){var Ts,Ws=fn==="y"?en:$n,Jr=fn==="y"?Bs:ks,Qt=fn==="y"?"height":"width",Zr=ct[fn],ei=Zr+Rt[Ws],Mo=Zr-Rt[Jr],Cs=Ct?-Ft[Qt]/2:0,Dn=An===Pi?Et[Qt]:Ft[Qt],Ks=An===Pi?-Ft[Qt]:-Et[Qt],Ar=x.elements.arrow,Gi=Ct&&Ar?mo(Ar):{width:0,height:0},Ys=x.modifiersData["arrow#persistent"]?x.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},cs=Ys[Ws],Gd=Ys[Jr],Ma=Er(0,Et[Qt],Gi[Qt]),Qd=Wt?Et[Qt]/2-Cs-Ma-cs-Fn.mainAxis:Dn-Ma-cs-Fn.mainAxis,Gh=Wt?-Et[Qt]/2+Cs+Ma+Gd+Fn.mainAxis:Ks+Ma+Gd+Fn.mainAxis,xi=x.elements.arrow&&Lr(x.elements.arrow),Wd=xi?fn==="y"?xi.clientTop||0:xi.clientLeft||0:0,Kd=(Ts=Is?.[fn])!=null?Ts:0,Qh=Zr+Gh-Kd,Wh=Er(Ct?Li(ei,Zr+Qd-Kd-Wd):ei,Zr,Ct?an(Mo,Qh):Mo);ct[fn]=Wh,Cr[fn]=Wh-Zr}if(He){var Kh,mp=fn==="x"?en:$n,fp=fn==="x"?Bs:ks,La=ct[Lt],Hc=Lt==="y"?"height":"width",Yd=La+Rt[mp],Yh=La-Rt[fp],Xh=[en,$n].indexOf(wn)!==-1,Jh=(Kh=Is?.[Lt])!=null?Kh:0,Zh=Xh?Yd:La-Et[Hc]-Ft[Hc]-Jh+Fn.altAxis,em=Xh?La+Et[Hc]+Ft[Hc]-Jh-Fn.altAxis:Yh,Xd=Ct&&Xh?function(pp,gp,Jd){var tm=Er(pp,gp,Jd);return tm>Jd?Jd:tm}(Zh,La,em):Er(Ct?Zh:Yd,La,Ct?em:Yh);ct[Lt]=Xd,Cr[Lt]=Xd-La}x.modifiersData[K]=Cr}},requiresIfExists:["offset"]};function bh(M,x,S){S===void 0&&(S=!1);var K,xe,Ne=Gn(x),Me=Gn(x)&&function(ot){var $t=ot.getBoundingClientRect(),Ct=qs($t.width)/ot.offsetWidth||1,Bt=qs($t.height)/ot.offsetHeight||1;return Ct!==1||Bt!==1}(x),He=rr(x),st=Fi(M,Me,S),ut={scrollLeft:0,scrollTop:0},xt={x:0,y:0};return(Ne||!Ne&&!S)&&((sr(x)!=="body"||ia(He))&&(ut=(K=x)!==hr(K)&&Gn(K)?{scrollLeft:(xe=K).scrollLeft,scrollTop:xe.scrollTop}:pn(K)),Gn(x)?((xt=Fi(x,!0)).x+=x.clientLeft,xt.y+=x.clientTop):He&&(xt.x=_a(He))),{x:st.left+ut.scrollLeft-xt.x,y:st.top+ut.scrollTop-xt.y,width:st.width,height:st.height}}function Ac(M){var x=new Map,S=new Set,K=[];function xe(Ne){S.add(Ne.name),[].concat(Ne.requires||[],Ne.requiresIfExists||[]).forEach(function(Me){if(!S.has(Me)){var He=x.get(Me);He&&xe(He)}}),K.push(Ne)}return M.forEach(function(Ne){x.set(Ne.name,Ne)}),M.forEach(function(Ne){S.has(Ne.name)||xe(Ne)}),K}var Ta={placement:"bottom",modifiers:[],strategy:"absolute"};function Dc(){for(var M=arguments.length,x=new Array(M),S=0;S<M;S++)x[S]=arguments[S];return!x.some(function(K){return!(K&&typeof K.getBoundingClientRect=="function")})}function wo(M){M===void 0&&(M={});var x=M,S=x.defaultModifiers,K=S===void 0?[]:S,xe=x.defaultOptions,Ne=xe===void 0?Ta:xe;return function(Me,He,st){st===void 0&&(st=Ne);var ut,xt,ot={placement:"bottom",orderedModifiers:[],options:Object.assign({},Ta,Ne),modifiersData:{},elements:{reference:Me,popper:He},attributes:{},styles:{}},$t=[],Ct=!1,Bt={state:ot,setOptions:function(Rt){var wn=typeof Rt=="function"?Rt(ot.options):Rt;Mt(),ot.options=Object.assign({},Ne,ot.options,wn),ot.scrollParents={reference:Ln(Me)?$i(Me):Me.contextElement?$i(Me.contextElement):[],popper:$i(He)};var An,Wt,fn=function(Lt){var ct=Ac(Lt);return pl.reduce(function(Et,Ft){return Et.concat(ct.filter(function(gn){return gn.phase===Ft}))},[])}((An=[].concat(K,ot.options.modifiers),Wt=An.reduce(function(Lt,ct){var Et=Lt[ct.name];return Lt[ct.name]=Et?Object.assign({},Et,ct,{options:Object.assign({},Et.options,ct.options),data:Object.assign({},Et.data,ct.data)}):ct,Lt},{}),Object.keys(Wt).map(function(Lt){return Wt[Lt]})));return ot.orderedModifiers=fn.filter(function(Lt){return Lt.enabled}),ot.orderedModifiers.forEach(function(Lt){var ct=Lt.name,Et=Lt.options,Ft=Et===void 0?{}:Et,gn=Lt.effect;if(typeof gn=="function"){var Fn=gn({state:ot,name:ct,instance:Bt,options:Ft});$t.push(Fn||function(){})}}),Bt.update()},forceUpdate:function(){if(!Ct){var Rt=ot.elements,wn=Rt.reference,An=Rt.popper;if(Dc(wn,An)){ot.rects={reference:bh(wn,Lr(An),ot.options.strategy==="fixed"),popper:mo(An)},ot.reset=!1,ot.placement=ot.options.placement,ot.orderedModifiers.forEach(function(gn){return ot.modifiersData[gn.name]=Object.assign({},gn.data)});for(var Wt=0;Wt<ot.orderedModifiers.length;Wt++)if(ot.reset!==!0){var fn=ot.orderedModifiers[Wt],Lt=fn.fn,ct=fn.options,Et=ct===void 0?{}:ct,Ft=fn.name;typeof Lt=="function"&&(ot=Lt({state:ot,options:Et,name:Ft,instance:Bt})||ot)}else ot.reset=!1,Wt=-1}}},update:(ut=function(){return new Promise(function(Rt){Bt.forceUpdate(),Rt(ot)})},function(){return xt||(xt=new Promise(function(Rt){Promise.resolve().then(function(){xt=void 0,Rt(ut())})})),xt}),destroy:function(){Mt(),Ct=!0}};if(!Dc(Me,He))return Bt;function Mt(){$t.forEach(function(Rt){return Rt()}),$t=[]}return Bt.setOptions(st).then(function(Rt){!Ct&&st.onFirstUpdate&&st.onFirstUpdate(Rt)}),Bt}}var Rc=wo(),vo=wo({defaultModifiers:[go,yl,Vi,Mi]}),bl=wo({defaultModifiers:[go,yl,Vi,Mi,yo,kd,bo,Wr,xl]});const No=Object.freeze(Object.defineProperty({__proto__:null,afterMain:nr,afterRead:co,afterWrite:ho,applyStyles:Mi,arrow:Wr,auto:Gr,basePlacements:ta,beforeMain:ml,beforeRead:Oi,beforeWrite:fl,bottom:Bs,clippingParents:Ec,computeStyles:Vi,createPopper:bl,createPopperBase:Rc,createPopperLite:vo,detectOverflow:Gs,end:Qr,eventListeners:go,flip:kd,hide:xl,left:$n,main:uo,modifierPhases:pl,offset:yo,placements:hl,popper:ur,popperGenerator:wo,popperOffsets:yl,preventOverflow:bo,read:lo,reference:Os,right:ks,start:Pi,top:en,variationPlacements:na,viewport:ki,write:Dd},Symbol.toStringTag,{value:"Module"})),Pc="dropdown",hi=".bs.dropdown",mi=".data-api",Od="ArrowUp",kc="ArrowDown",Md=`hide${hi}`,Ld=`hidden${hi}`,wl=`show${hi}`,fr=`shown${hi}`,Oc=`click${hi}${mi}`,Mc=`keydown${hi}${mi}`,Bi=`keyup${hi}${mi}`,f="show",v='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',A=`${v}.${f}`,Y=".dropdown-menu",Ee=U()?"top-end":"top-start",Oe=U()?"top-start":"top-end",rt=U()?"bottom-end":"bottom-start",on=U()?"bottom-start":"bottom-end",_s=U()?"left-start":"right-start",ln=U()?"right-start":"left-start",Ls={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Es={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class Ss extends Q{constructor(x,S){super(x,S),this._popper=null,this._parent=this._element.parentNode,this._menu=I.next(this._element,Y)[0]||I.prev(this._element,Y)[0]||I.findOne(Y,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return Ls}static get DefaultType(){return Es}static get NAME(){return Pc}toggle(){return this._isShown()?this.hide():this.show()}show(){if(b(this._element)||this._isShown())return;const x={relatedTarget:this._element};if(!_.trigger(this._element,wl,x).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const S of[].concat(...document.body.children))_.on(S,"mouseover",N);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(f),this._element.classList.add(f),_.trigger(this._element,fr,x)}}hide(){if(b(this._element)||!this._isShown())return;const x={relatedTarget:this._element};this._completeHide(x)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(x){if(!_.trigger(this._element,Md,x).defaultPrevented){if("ontouchstart"in document.documentElement)for(const S of[].concat(...document.body.children))_.off(S,"mouseover",N);this._popper&&this._popper.destroy(),this._menu.classList.remove(f),this._element.classList.remove(f),this._element.setAttribute("aria-expanded","false"),te.removeDataAttribute(this._menu,"popper"),_.trigger(this._element,Ld,x),this._element.focus()}}_getConfig(x){if(typeof(x=super._getConfig(x)).reference=="object"&&!u(x.reference)&&typeof x.reference.getBoundingClientRect!="function")throw new TypeError(`${Pc.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return x}_createPopper(){if(No===void 0)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org/docs/v2/)");let x=this._element;this._config.reference==="parent"?x=this._parent:u(this._config.reference)?x=m(this._config.reference):typeof this._config.reference=="object"&&(x=this._config.reference);const S=this._getPopperConfig();this._popper=bl(x,this._menu,S)}_isShown(){return this._menu.classList.contains(f)}_getPlacement(){const x=this._parent;if(x.classList.contains("dropend"))return _s;if(x.classList.contains("dropstart"))return ln;if(x.classList.contains("dropup-center"))return"top";if(x.classList.contains("dropdown-center"))return"bottom";const S=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return x.classList.contains("dropup")?S?Oe:Ee:S?on:rt}_detectNavbar(){return this._element.closest(".navbar")!==null}_getOffset(){const{offset:x}=this._config;return typeof x=="string"?x.split(",").map(S=>Number.parseInt(S,10)):typeof x=="function"?S=>x(S,this._element):x}_getPopperConfig(){const x={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(te.setDataAttribute(this._menu,"popper","static"),x.modifiers=[{name:"applyStyles",enabled:!1}]),{...x,...ee(this._config.popperConfig,[void 0,x])}}_selectMenuItem({key:x,target:S}){const K=I.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(xe=>p(xe));K.length&&ie(K,S,x===kc,!K.includes(S)).focus()}static jQueryInterface(x){return this.each(function(){const S=Ss.getOrCreateInstance(this,x);if(typeof x=="string"){if(S[x]===void 0)throw new TypeError(`No method named "${x}"`);S[x]()}})}static clearMenus(x){if(x.button===2||x.type==="keyup"&&x.key!=="Tab")return;const S=I.find(A);for(const K of S){const xe=Ss.getInstance(K);if(!xe||xe._config.autoClose===!1)continue;const Ne=x.composedPath(),Me=Ne.includes(xe._menu);if(Ne.includes(xe._element)||xe._config.autoClose==="inside"&&!Me||xe._config.autoClose==="outside"&&Me||xe._menu.contains(x.target)&&(x.type==="keyup"&&x.key==="Tab"||/input|select|option|textarea|form/i.test(x.target.tagName)))continue;const He={relatedTarget:xe._element};x.type==="click"&&(He.clickEvent=x),xe._completeHide(He)}}static dataApiKeydownHandler(x){const S=/input|textarea/i.test(x.target.tagName),K=x.key==="Escape",xe=[Od,kc].includes(x.key);if(!xe&&!K||S&&!K)return;x.preventDefault();const Ne=this.matches(v)?this:I.prev(this,v)[0]||I.next(this,v)[0]||I.findOne(v,x.delegateTarget.parentNode),Me=Ss.getOrCreateInstance(Ne);if(xe)return x.stopPropagation(),Me.show(),void Me._selectMenuItem(x);Me._isShown()&&(x.stopPropagation(),Me.hide(),Ne.focus())}}_.on(document,Mc,v,Ss.dataApiKeydownHandler),_.on(document,Mc,Y,Ss.dataApiKeydownHandler),_.on(document,Oc,Ss.clearMenus),_.on(document,Bi,Ss.clearMenus),_.on(document,Oc,v,function(M){M.preventDefault(),Ss.getOrCreateInstance(this).toggle()}),T(Ss);const Fs="backdrop",fi="show",vl=`mousedown.bs.${Fs}`,Fd={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},Gf={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class wh extends ${constructor(x){super(),this._config=this._getConfig(x),this._isAppended=!1,this._element=null}static get Default(){return Fd}static get DefaultType(){return Gf}static get NAME(){return Fs}show(x){if(!this._config.isVisible)return void ee(x);this._append();const S=this._getElement();this._config.isAnimated&&R(S),S.classList.add(fi),this._emulateAnimation(()=>{ee(x)})}hide(x){this._config.isVisible?(this._getElement().classList.remove(fi),this._emulateAnimation(()=>{this.dispose(),ee(x)})):ee(x)}dispose(){this._isAppended&&(_.off(this._element,vl),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const x=document.createElement("div");x.className=this._config.className,this._config.isAnimated&&x.classList.add("fade"),this._element=x}return this._element}_configAfterMerge(x){return x.rootElement=m(x.rootElement),x}_append(){if(this._isAppended)return;const x=this._getElement();this._config.rootElement.append(x),_.on(x,vl,()=>{ee(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(x){Z(x,this._getElement(),this._config.isAnimated)}}const Nl=".bs.focustrap",vh=`focusin${Nl}`,Qf=`keydown.tab${Nl}`,Nh="backward",Wf={autofocus:!0,trapElement:null},Gx={autofocus:"boolean",trapElement:"element"};class Kf extends ${constructor(x){super(),this._config=this._getConfig(x),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return Wf}static get DefaultType(){return Gx}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),_.off(document,Nl),_.on(document,vh,x=>this._handleFocusin(x)),_.on(document,Qf,x=>this._handleKeydown(x)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,_.off(document,Nl))}_handleFocusin(x){const{trapElement:S}=this._config;if(x.target===document||x.target===S||S.contains(x.target))return;const K=I.focusableChildren(S);K.length===0?S.focus():this._lastTabNavDirection===Nh?K[K.length-1].focus():K[0].focus()}_handleKeydown(x){x.key==="Tab"&&(this._lastTabNavDirection=x.shiftKey?Nh:"forward")}}const Yf=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Xf=".sticky-top",Ud="padding-right",Sr="margin-right";class jo{constructor(){this._element=document.body}getWidth(){const x=document.documentElement.clientWidth;return Math.abs(window.innerWidth-x)}hide(){const x=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Ud,S=>S+x),this._setElementAttributes(Yf,Ud,S=>S+x),this._setElementAttributes(Xf,Sr,S=>S-x)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Ud),this._resetElementAttributes(Yf,Ud),this._resetElementAttributes(Xf,Sr)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(x,S,K){const xe=this.getWidth();this._applyManipulationCallback(x,Ne=>{if(Ne!==this._element&&window.innerWidth>Ne.clientWidth+xe)return;this._saveInitialAttribute(Ne,S);const Me=window.getComputedStyle(Ne).getPropertyValue(S);Ne.style.setProperty(S,`${K(Number.parseFloat(Me))}px`)})}_saveInitialAttribute(x,S){const K=x.style.getPropertyValue(S);K&&te.setDataAttribute(x,S,K)}_resetElementAttributes(x,S){this._applyManipulationCallback(x,K=>{const xe=te.getDataAttribute(K,S);xe!==null?(te.removeDataAttribute(K,S),K.style.setProperty(S,xe)):K.style.removeProperty(S)})}_applyManipulationCallback(x,S){if(u(x))S(x);else for(const K of I.find(x,this._element))S(K)}}const Ur=".bs.modal",Jf=`hide${Ur}`,Zf=`hidePrevented${Ur}`,jh=`hidden${Ur}`,Vd=`show${Ur}`,Qx=`shown${Ur}`,jl=`resize${Ur}`,_h=`click.dismiss${Ur}`,Lc=`mousedown.dismiss${Ur}`,Eh=`keydown.dismiss${Ur}`,ep=`click${Ur}.data-api`,Ca="modal-open",_o="show",Fc="modal-static",tp={backdrop:!0,focus:!0,keyboard:!0},Eo={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Aa extends Q{constructor(x,S){super(x,S),this._dialog=I.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new jo,this._addEventListeners()}static get Default(){return tp}static get DefaultType(){return Eo}static get NAME(){return"modal"}toggle(x){return this._isShown?this.hide():this.show(x)}show(x){this._isShown||this._isTransitioning||_.trigger(this._element,Vd,{relatedTarget:x}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(Ca),this._adjustDialog(),this._backdrop.show(()=>this._showElement(x)))}hide(){this._isShown&&!this._isTransitioning&&(_.trigger(this._element,Jf).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(_o),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){_.off(window,Ur),_.off(this._dialog,Ur),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new wh({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Kf({trapElement:this._element})}_showElement(x){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const S=I.findOne(".modal-body",this._dialog);S&&(S.scrollTop=0),R(this._element),this._element.classList.add(_o),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,_.trigger(this._element,Qx,{relatedTarget:x})},this._dialog,this._isAnimated())}_addEventListeners(){_.on(this._element,Eh,x=>{x.key==="Escape"&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())}),_.on(window,jl,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),_.on(this._element,Lc,x=>{_.one(this._element,_h,S=>{this._element===x.target&&this._element===S.target&&(this._config.backdrop!=="static"?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(Ca),this._resetAdjustments(),this._scrollBar.reset(),_.trigger(this._element,jh)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(_.trigger(this._element,Zf).defaultPrevented)return;const x=this._element.scrollHeight>document.documentElement.clientHeight,S=this._element.style.overflowY;S==="hidden"||this._element.classList.contains(Fc)||(x||(this._element.style.overflowY="hidden"),this._element.classList.add(Fc),this._queueCallback(()=>{this._element.classList.remove(Fc),this._queueCallback(()=>{this._element.style.overflowY=S},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const x=this._element.scrollHeight>document.documentElement.clientHeight,S=this._scrollBar.getWidth(),K=S>0;if(K&&!x){const xe=U()?"paddingLeft":"paddingRight";this._element.style[xe]=`${S}px`}if(!K&&x){const xe=U()?"paddingRight":"paddingLeft";this._element.style[xe]=`${S}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(x,S){return this.each(function(){const K=Aa.getOrCreateInstance(this,x);if(typeof x=="string"){if(K[x]===void 0)throw new TypeError(`No method named "${x}"`);K[x](S)}})}}_.on(document,ep,'[data-bs-toggle="modal"]',function(M){const x=I.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&M.preventDefault(),_.one(x,Vd,K=>{K.defaultPrevented||_.one(x,jh,()=>{p(this)&&this.focus()})});const S=I.findOne(".modal.show");S&&Aa.getInstance(S).hide(),Aa.getOrCreateInstance(x).toggle(this)}),le(Aa),T(Aa);const qi=".bs.offcanvas",Sh=".data-api",Wx=`load${qi}${Sh}`,np="show",sp="showing",Ih="hiding",Th=".offcanvas.show",Ch=`show${qi}`,pi=`shown${qi}`,rp=`hide${qi}`,Vr=`hidePrevented${qi}`,zr=`hidden${qi}`,_l=`resize${qi}`,Ah=`click${qi}${Sh}`,zd=`keydown.dismiss${qi}`,$d={backdrop:!0,keyboard:!0,scroll:!1},Dh={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Ir extends Q{constructor(x,S){super(x,S),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return $d}static get DefaultType(){return Dh}static get NAME(){return"offcanvas"}toggle(x){return this._isShown?this.hide():this.show(x)}show(x){this._isShown||_.trigger(this._element,Ch,{relatedTarget:x}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||new jo().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(sp),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(np),this._element.classList.remove(sp),_.trigger(this._element,pi,{relatedTarget:x})},this._element,!0))}hide(){this._isShown&&(_.trigger(this._element,rp).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(Ih),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(np,Ih),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new jo().reset(),_.trigger(this._element,zr)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const x=!!this._config.backdrop;return new wh({className:"offcanvas-backdrop",isVisible:x,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:x?()=>{this._config.backdrop!=="static"?this.hide():_.trigger(this._element,Vr)}:null})}_initializeFocusTrap(){return new Kf({trapElement:this._element})}_addEventListeners(){_.on(this._element,zd,x=>{x.key==="Escape"&&(this._config.keyboard?this.hide():_.trigger(this._element,Vr))})}static jQueryInterface(x){return this.each(function(){const S=Ir.getOrCreateInstance(this,x);if(typeof x=="string"){if(S[x]===void 0||x.startsWith("_")||x==="constructor")throw new TypeError(`No method named "${x}"`);S[x](this)}})}}_.on(document,Ah,'[data-bs-toggle="offcanvas"]',function(M){const x=I.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&M.preventDefault(),b(this))return;_.one(x,zr,()=>{p(this)&&this.focus()});const S=I.findOne(Th);S&&S!==x&&Ir.getInstance(S).hide(),Ir.getOrCreateInstance(x).toggle(this)}),_.on(window,Wx,()=>{for(const M of I.find(Th))Ir.getOrCreateInstance(M).show()}),_.on(window,_l,()=>{for(const M of I.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(M).position!=="fixed"&&Ir.getOrCreateInstance(M).hide()}),le(Ir),T(Ir);const Rh={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},Bd=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),El=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,Kx=(M,x)=>{const S=M.nodeName.toLowerCase();return x.includes(S)?!Bd.has(S)||!!El.test(M.nodeValue):x.filter(K=>K instanceof RegExp).some(K=>K.test(S))},$r={allowList:Rh,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},Ph={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},aa={entry:"(string|element|function|null)",selector:"(string|element)"};class ip extends ${constructor(x){super(),this._config=this._getConfig(x)}static get Default(){return $r}static get DefaultType(){return Ph}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(x=>this._resolvePossibleFunction(x)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(x){return this._checkContent(x),this._config.content={...this._config.content,...x},this}toHtml(){const x=document.createElement("div");x.innerHTML=this._maybeSanitize(this._config.template);for(const[xe,Ne]of Object.entries(this._config.content))this._setContent(x,Ne,xe);const S=x.children[0],K=this._resolvePossibleFunction(this._config.extraClass);return K&&S.classList.add(...K.split(" ")),S}_typeCheckConfig(x){super._typeCheckConfig(x),this._checkContent(x.content)}_checkContent(x){for(const[S,K]of Object.entries(x))super._typeCheckConfig({selector:S,entry:K},aa)}_setContent(x,S,K){const xe=I.findOne(K,x);xe&&((S=this._resolvePossibleFunction(S))?u(S)?this._putElementInTemplate(m(S),xe):this._config.html?xe.innerHTML=this._maybeSanitize(S):xe.textContent=S:xe.remove())}_maybeSanitize(x){return this._config.sanitize?function(S,K,xe){if(!S.length)return S;if(xe&&typeof xe=="function")return xe(S);const Ne=new window.DOMParser().parseFromString(S,"text/html"),Me=[].concat(...Ne.body.querySelectorAll("*"));for(const He of Me){const st=He.nodeName.toLowerCase();if(!Object.keys(K).includes(st)){He.remove();continue}const ut=[].concat(...He.attributes),xt=[].concat(K["*"]||[],K[st]||[]);for(const ot of ut)Kx(ot,xt)||He.removeAttribute(ot.nodeName)}return Ne.body.innerHTML}(x,this._config.allowList,this._config.sanitizeFn):x}_resolvePossibleFunction(x){return ee(x,[void 0,this])}_putElementInTemplate(x,S){if(this._config.html)return S.innerHTML="",void S.append(x);S.textContent=x.textContent}}const qd=new Set(["sanitize","allowList","sanitizeFn"]),oa="fade",Sl="show",kh=".tooltip-inner",So=".modal",Io="hide.bs.modal",Da="hover",Il="focus",Tr="click",Yr={AUTO:"auto",TOP:"top",RIGHT:U()?"left":"right",BOTTOM:"bottom",LEFT:U()?"right":"left"},To={allowList:Rh,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},la={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class pr extends Q{constructor(x,S){if(No===void 0)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org/docs/v2/)");super(x,S),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return To}static get DefaultType(){return la}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),_.off(this._element.closest(So),Io,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const x=_.trigger(this._element,this.constructor.eventName("show")),S=(w(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(x.defaultPrevented||!S)return;this._disposePopper();const K=this._getTipElement();this._element.setAttribute("aria-describedby",K.getAttribute("id"));const{container:xe}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(xe.append(K),_.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(K),K.classList.add(Sl),"ontouchstart"in document.documentElement)for(const Ne of[].concat(...document.body.children))_.on(Ne,"mouseover",N);this._queueCallback(()=>{_.trigger(this._element,this.constructor.eventName("shown")),this._isHovered===!1&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!_.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(Sl),"ontouchstart"in document.documentElement)for(const x of[].concat(...document.body.children))_.off(x,"mouseover",N);this._activeTrigger[Tr]=!1,this._activeTrigger[Il]=!1,this._activeTrigger[Da]=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),_.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(x){const S=this._getTemplateFactory(x).toHtml();if(!S)return null;S.classList.remove(oa,Sl),S.classList.add(`bs-${this.constructor.NAME}-auto`);const K=(xe=>{do xe+=Math.floor(1e6*Math.random());while(document.getElementById(xe));return xe})(this.constructor.NAME).toString();return S.setAttribute("id",K),this._isAnimated()&&S.classList.add(oa),S}setContent(x){this._newContent=x,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(x){return this._templateFactory?this._templateFactory.changeContent(x):this._templateFactory=new ip({...this._config,content:x,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[kh]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(x){return this.constructor.getOrCreateInstance(x.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(oa)}_isShown(){return this.tip&&this.tip.classList.contains(Sl)}_createPopper(x){const S=ee(this._config.placement,[this,x,this._element]),K=Yr[S.toUpperCase()];return bl(this._element,x,this._getPopperConfig(K))}_getOffset(){const{offset:x}=this._config;return typeof x=="string"?x.split(",").map(S=>Number.parseInt(S,10)):typeof x=="function"?S=>x(S,this._element):x}_resolvePossibleFunction(x){return ee(x,[this._element,this._element])}_getPopperConfig(x){const S={placement:x,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:K=>{this._getTipElement().setAttribute("data-popper-placement",K.state.placement)}}]};return{...S,...ee(this._config.popperConfig,[void 0,S])}}_setListeners(){const x=this._config.trigger.split(" ");for(const S of x)if(S==="click")_.on(this._element,this.constructor.eventName("click"),this._config.selector,K=>{const xe=this._initializeOnDelegatedTarget(K);xe._activeTrigger[Tr]=!(xe._isShown()&&xe._activeTrigger[Tr]),xe.toggle()});else if(S!=="manual"){const K=S===Da?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),xe=S===Da?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");_.on(this._element,K,this._config.selector,Ne=>{const Me=this._initializeOnDelegatedTarget(Ne);Me._activeTrigger[Ne.type==="focusin"?Il:Da]=!0,Me._enter()}),_.on(this._element,xe,this._config.selector,Ne=>{const Me=this._initializeOnDelegatedTarget(Ne);Me._activeTrigger[Ne.type==="focusout"?Il:Da]=Me._element.contains(Ne.relatedTarget),Me._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},_.on(this._element.closest(So),Io,this._hideModalHandler)}_fixTitle(){const x=this._element.getAttribute("title");x&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",x),this._element.setAttribute("data-bs-original-title",x),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(x,S){clearTimeout(this._timeout),this._timeout=setTimeout(x,S)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(x){const S=te.getDataAttributes(this._element);for(const K of Object.keys(S))qd.has(K)&&delete S[K];return x={...S,...typeof x=="object"&&x?x:{}},x=this._mergeConfigObj(x),x=this._configAfterMerge(x),this._typeCheckConfig(x),x}_configAfterMerge(x){return x.container=x.container===!1?document.body:m(x.container),typeof x.delay=="number"&&(x.delay={show:x.delay,hide:x.delay}),typeof x.title=="number"&&(x.title=x.title.toString()),typeof x.content=="number"&&(x.content=x.content.toString()),x}_getDelegateConfig(){const x={};for(const[S,K]of Object.entries(this._config))this.constructor.Default[S]!==K&&(x[S]=K);return x.selector=!1,x.trigger="manual",x}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(x){return this.each(function(){const S=pr.getOrCreateInstance(this,x);if(typeof x=="string"){if(S[x]===void 0)throw new TypeError(`No method named "${x}"`);S[x]()}})}}T(pr);const Co=".popover-header",ap=".popover-body",Oh={...pr.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},Mh={...pr.DefaultType,content:"(null|string|element|function)"};class Us extends pr{static get Default(){return Oh}static get DefaultType(){return Mh}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[Co]:this._getTitle(),[ap]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(x){return this.each(function(){const S=Us.getOrCreateInstance(this,x);if(typeof x=="string"){if(S[x]===void 0)throw new TypeError(`No method named "${x}"`);S[x]()}})}}T(Us);const Qn=".bs.scrollspy",bn=`activate${Qn}`,Ra=`click${Qn}`,Hi=`load${Qn}.data-api`,Pa="active",ca="[href]",Lh=".nav-link",op=`${Lh}, .nav-item > ${Lh}, .list-group-item`,Uc={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},Vc={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class Tl extends Q{constructor(x,S){super(x,S),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return Uc}static get DefaultType(){return Vc}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const x of this._observableSections.values())this._observer.observe(x)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(x){return x.target=m(x.target)||document.body,x.rootMargin=x.offset?`${x.offset}px 0px -30%`:x.rootMargin,typeof x.threshold=="string"&&(x.threshold=x.threshold.split(",").map(S=>Number.parseFloat(S))),x}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(_.off(this._config.target,Ra),_.on(this._config.target,Ra,ca,x=>{const S=this._observableSections.get(x.target.hash);if(S){x.preventDefault();const K=this._rootElement||window,xe=S.offsetTop-this._element.offsetTop;if(K.scrollTo)return void K.scrollTo({top:xe,behavior:"smooth"});K.scrollTop=xe}}))}_getNewObserver(){const x={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(S=>this._observerCallback(S),x)}_observerCallback(x){const S=Me=>this._targetLinks.get(`#${Me.target.id}`),K=Me=>{this._previousScrollData.visibleEntryTop=Me.target.offsetTop,this._process(S(Me))},xe=(this._rootElement||document.documentElement).scrollTop,Ne=xe>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=xe;for(const Me of x){if(!Me.isIntersecting){this._activeTarget=null,this._clearActiveClass(S(Me));continue}const He=Me.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(Ne&&He){if(K(Me),!xe)return}else Ne||He||K(Me)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const x=I.find(ca,this._config.target);for(const S of x){if(!S.hash||b(S))continue;const K=I.findOne(decodeURI(S.hash),this._element);p(K)&&(this._targetLinks.set(decodeURI(S.hash),S),this._observableSections.set(S.hash,K))}}_process(x){this._activeTarget!==x&&(this._clearActiveClass(this._config.target),this._activeTarget=x,x.classList.add(Pa),this._activateParents(x),_.trigger(this._element,bn,{relatedTarget:x}))}_activateParents(x){if(x.classList.contains("dropdown-item"))I.findOne(".dropdown-toggle",x.closest(".dropdown")).classList.add(Pa);else for(const S of I.parents(x,".nav, .list-group"))for(const K of I.prev(S,op))K.classList.add(Pa)}_clearActiveClass(x){x.classList.remove(Pa);const S=I.find(`${ca}.${Pa}`,x);for(const K of S)K.classList.remove(Pa)}static jQueryInterface(x){return this.each(function(){const S=Tl.getOrCreateInstance(this,x);if(typeof x=="string"){if(S[x]===void 0||x.startsWith("_")||x==="constructor")throw new TypeError(`No method named "${x}"`);S[x]()}})}}_.on(window,Hi,()=>{for(const M of I.find('[data-bs-spy="scroll"]'))Tl.getOrCreateInstance(M)}),T(Tl);const gi=".bs.tab",Fh=`hide${gi}`,Ao=`hidden${gi}`,da=`show${gi}`,ka=`shown${gi}`,ua=`click${gi}`,Uh=`keydown${gi}`,Vh=`load${gi}`,zc="ArrowLeft",$c="ArrowRight",Do="ArrowUp",Qs="ArrowDown",Cl="Home",zh="End",Ro="active",lp="fade",$h="show",xs=".dropdown-toggle",Bc=`:not(${xs})`,Al='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',Po=`.nav-link${Bc}, .list-group-item${Bc}, [role="tab"]${Bc}, ${Al}`,Bh=`.${Ro}[data-bs-toggle="tab"], .${Ro}[data-bs-toggle="pill"], .${Ro}[data-bs-toggle="list"]`;class Xr extends Q{constructor(x){super(x),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),_.on(this._element,Uh,S=>this._keydown(S)))}static get NAME(){return"tab"}show(){const x=this._element;if(this._elemIsActive(x))return;const S=this._getActiveElem(),K=S?_.trigger(S,Fh,{relatedTarget:x}):null;_.trigger(x,da,{relatedTarget:S}).defaultPrevented||K&&K.defaultPrevented||(this._deactivate(S,x),this._activate(x,S))}_activate(x,S){x&&(x.classList.add(Ro),this._activate(I.getElementFromSelector(x)),this._queueCallback(()=>{x.getAttribute("role")==="tab"?(x.removeAttribute("tabindex"),x.setAttribute("aria-selected",!0),this._toggleDropDown(x,!0),_.trigger(x,ka,{relatedTarget:S})):x.classList.add($h)},x,x.classList.contains(lp)))}_deactivate(x,S){x&&(x.classList.remove(Ro),x.blur(),this._deactivate(I.getElementFromSelector(x)),this._queueCallback(()=>{x.getAttribute("role")==="tab"?(x.setAttribute("aria-selected",!1),x.setAttribute("tabindex","-1"),this._toggleDropDown(x,!1),_.trigger(x,Ao,{relatedTarget:S})):x.classList.remove($h)},x,x.classList.contains(lp)))}_keydown(x){if(![zc,$c,Do,Qs,Cl,zh].includes(x.key))return;x.stopPropagation(),x.preventDefault();const S=this._getChildren().filter(xe=>!b(xe));let K;if([Cl,zh].includes(x.key))K=S[x.key===Cl?0:S.length-1];else{const xe=[$c,Qs].includes(x.key);K=ie(S,x.target,xe,!0)}K&&(K.focus({preventScroll:!0}),Xr.getOrCreateInstance(K).show())}_getChildren(){return I.find(Po,this._parent)}_getActiveElem(){return this._getChildren().find(x=>this._elemIsActive(x))||null}_setInitialAttributes(x,S){this._setAttributeIfNotExists(x,"role","tablist");for(const K of S)this._setInitialAttributesOnChild(K)}_setInitialAttributesOnChild(x){x=this._getInnerElement(x);const S=this._elemIsActive(x),K=this._getOuterElement(x);x.setAttribute("aria-selected",S),K!==x&&this._setAttributeIfNotExists(K,"role","presentation"),S||x.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(x,"role","tab"),this._setInitialAttributesOnTargetPanel(x)}_setInitialAttributesOnTargetPanel(x){const S=I.getElementFromSelector(x);S&&(this._setAttributeIfNotExists(S,"role","tabpanel"),x.id&&this._setAttributeIfNotExists(S,"aria-labelledby",`${x.id}`))}_toggleDropDown(x,S){const K=this._getOuterElement(x);if(!K.classList.contains("dropdown"))return;const xe=(Ne,Me)=>{const He=I.findOne(Ne,K);He&&He.classList.toggle(Me,S)};xe(xs,Ro),xe(".dropdown-menu",$h),K.setAttribute("aria-expanded",S)}_setAttributeIfNotExists(x,S,K){x.hasAttribute(S)||x.setAttribute(S,K)}_elemIsActive(x){return x.classList.contains(Ro)}_getInnerElement(x){return x.matches(Po)?x:I.findOne(Po,x)}_getOuterElement(x){return x.closest(".nav-item, .list-group-item")||x}static jQueryInterface(x){return this.each(function(){const S=Xr.getOrCreateInstance(this);if(typeof x=="string"){if(S[x]===void 0||x.startsWith("_")||x==="constructor")throw new TypeError(`No method named "${x}"`);S[x]()}})}}_.on(document,ua,Al,function(M){["A","AREA"].includes(this.tagName)&&M.preventDefault(),b(this)||Xr.getOrCreateInstance(this).show()}),_.on(window,Vh,()=>{for(const M of I.find(Bh))Xr.getOrCreateInstance(M)}),T(Xr);const Br=".bs.toast",Yx=`mouseover${Br}`,cp=`mouseout${Br}`,Xx=`focusin${Br}`,dp=`focusout${Br}`,ko=`hide${Br}`,qh=`hidden${Br}`,Hd=`show${Br}`,up=`shown${Br}`,Dl="hide",qc="show",Oo="showing",Hh={animation:"boolean",autohide:"boolean",delay:"number"},hp={animation:!0,autohide:!0,delay:5e3};class Oa extends Q{constructor(x,S){super(x,S),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return hp}static get DefaultType(){return Hh}static get NAME(){return"toast"}show(){_.trigger(this._element,Hd).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(Dl),R(this._element),this._element.classList.add(qc,Oo),this._queueCallback(()=>{this._element.classList.remove(Oo),_.trigger(this._element,up),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(_.trigger(this._element,ko).defaultPrevented||(this._element.classList.add(Oo),this._queueCallback(()=>{this._element.classList.add(Dl),this._element.classList.remove(Oo,qc),_.trigger(this._element,qh)},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(qc),super.dispose()}isShown(){return this._element.classList.contains(qc)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(x,S){switch(x.type){case"mouseover":case"mouseout":this._hasMouseInteraction=S;break;case"focusin":case"focusout":this._hasKeyboardInteraction=S}if(S)return void this._clearTimeout();const K=x.relatedTarget;this._element===K||this._element.contains(K)||this._maybeScheduleHide()}_setListeners(){_.on(this._element,Yx,x=>this._onInteraction(x,!0)),_.on(this._element,cp,x=>this._onInteraction(x,!1)),_.on(this._element,Xx,x=>this._onInteraction(x,!0)),_.on(this._element,dp,x=>this._onInteraction(x,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(x){return this.each(function(){const S=Oa.getOrCreateInstance(this,x);if(typeof x=="string"){if(S[x]===void 0)throw new TypeError(`No method named "${x}"`);S[x](this)}})}}return le(Oa),T(Oa),{Alert:It,Button:oe,Carousel:et,Collapse:gs,Dropdown:Ss,Modal:Aa,Offcanvas:Ir,Popover:Us,ScrollSpy:Tl,Tab:Xr,Toast:Oa,Tooltip:pr}})}(Dg)),Dg.exports}MF();console.log("🚀 Starting application...");window.addEventListener("error",r=>{console.error("Global error:",r.error)});window.addEventListener("unhandledrejection",r=>{if(r.reason&&r.reason.message){const e=r.reason.message;if(e.includes("Document not found")||e.includes("فشل في تحديث usersettings")||e.includes("UserSettingsService")||e.includes("_getRecaptchaConfig")||e.includes("client is offline")||e.includes("auth/network-request-failed")){console.log("🔧 Suppressed non-critical Firebase error:",e),r.preventDefault();return}}console.error("Unhandled promise rejection:",r.reason)});console.log("✅ React imported");class LF extends QE.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Error boundary caught:",e,t)}render(){return this.state.hasError?n.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",fontFamily:"Arial",background:"#f8f9fa"},children:n.jsxs("div",{style:{textAlign:"center",padding:"40px",background:"white",borderRadius:"8px",boxShadow:"0 2px 10px rgba(0,0,0,0.1)",maxWidth:"500px"},children:[n.jsx("h2",{style:{color:"#dc3545"},children:"خطأ في التطبيق"}),n.jsx("p",{style:{color:"#666",margin:"20px 0"},children:"حدث خطأ غير متوقع. يرجى إعادة تحميل الصفحة."}),n.jsx("button",{onClick:()=>window.location.reload(),style:{padding:"12px 24px",background:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"16px"},children:"إعادة تحميل"}),n.jsxs("details",{style:{marginTop:"20px",textAlign:"left"},children:[n.jsx("summary",{style:{cursor:"pointer",color:"#666"},children:"تفاصيل الخطأ"}),n.jsx("pre",{style:{background:"#f8f9fa",padding:"10px",borderRadius:"4px",fontSize:"12px",overflow:"auto",maxHeight:"200px"},children:this.state.error?.toString()})]})]})}):this.props.children}}try{console.log("Loading core modules...")}catch(r){console.error("Import error:",r)}console.log("✅ All modules loaded");console.log("⚠️ Skipping dev utilities for stability");try{console.log("Creating React root...");const r=document.getElementById("root");if(!r)throw new Error("Root element not found");const e=TA.createRoot(r);console.log("✅ React root created"),console.log("Rendering application..."),e.render(n.jsx(LF,{children:n.jsx(kF,{})})),console.log("✅ Application rendered successfully")}catch(r){console.error("Critical rendering error:",r),document.body.innerHTML=`
    <div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-family: Arial;">
      <div style="text-align: center; padding: 40px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <h2 style="color: #dc3545;">خطأ حرج في التطبيق</h2>
        <p style="color: #666;">فشل في تحميل التطبيق: ${r.message}</p>
        <button onclick="window.location.reload()" style="padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
          إعادة تحميل
        </button>
      </div>
    </div>
  `}
