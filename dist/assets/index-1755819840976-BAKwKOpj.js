var dk=Object.defineProperty;var uk=(n,e,t)=>e in n?dk(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ur=(n,e,t)=>uk(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();var hk=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function TI(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var CI={exports:{}},cx={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mk=Symbol.for("react.transitional.element"),fk=Symbol.for("react.fragment");function AI(n,e,t){var s=null;if(t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),"key"in e){t={};for(var i in e)i!=="key"&&(t[i]=e[i])}else t=e;return e=t.ref,{$$typeof:mk,type:n,key:s,ref:e!==void 0?e:null,props:t}}cx.Fragment=fk;cx.jsx=AI;cx.jsxs=AI;CI.exports=cx;var r=CI.exports,DI={exports:{}},vt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ww=Symbol.for("react.transitional.element"),pk=Symbol.for("react.portal"),gk=Symbol.for("react.fragment"),xk=Symbol.for("react.strict_mode"),yk=Symbol.for("react.profiler"),bk=Symbol.for("react.consumer"),wk=Symbol.for("react.context"),vk=Symbol.for("react.forward_ref"),Nk=Symbol.for("react.suspense"),jk=Symbol.for("react.memo"),RI=Symbol.for("react.lazy"),Vj=Symbol.iterator;function _k(n){return n===null||typeof n!="object"?null:(n=Vj&&n[Vj]||n["@@iterator"],typeof n=="function"?n:null)}var PI={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},kI=Object.assign,OI={};function mu(n,e,t){this.props=n,this.context=e,this.refs=OI,this.updater=t||PI}mu.prototype.isReactComponent={};mu.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};mu.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function MI(){}MI.prototype=mu.prototype;function vw(n,e,t){this.props=n,this.context=e,this.refs=OI,this.updater=t||PI}var Nw=vw.prototype=new MI;Nw.constructor=vw;kI(Nw,mu.prototype);Nw.isPureReactComponent=!0;var zj=Array.isArray,Pn={H:null,A:null,T:null,S:null,V:null},LI=Object.prototype.hasOwnProperty;function jw(n,e,t,s,i,a){return t=a.ref,{$$typeof:ww,type:n,key:e,ref:t!==void 0?t:null,props:a}}function Ek(n,e){return jw(n.type,e,void 0,void 0,void 0,n.props)}function _w(n){return typeof n=="object"&&n!==null&&n.$$typeof===ww}function Sk(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var $j=/\/+/g;function Iy(n,e){return typeof n=="object"&&n!==null&&n.key!=null?Sk(""+n.key):e.toString(36)}function Bj(){}function Ik(n){switch(n.status){case"fulfilled":return n.value;case"rejected":throw n.reason;default:switch(typeof n.status=="string"?n.then(Bj,Bj):(n.status="pending",n.then(function(e){n.status==="pending"&&(n.status="fulfilled",n.value=e)},function(e){n.status==="pending"&&(n.status="rejected",n.reason=e)})),n.status){case"fulfilled":return n.value;case"rejected":throw n.reason}}throw n}function Wc(n,e,t,s,i){var a=typeof n;(a==="undefined"||a==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(a){case"bigint":case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case ww:case pk:o=!0;break;case RI:return o=n._init,Wc(o(n._payload),e,t,s,i)}}if(o)return i=i(n),o=s===""?"."+Iy(n,0):s,zj(i)?(t="",o!=null&&(t=o.replace($j,"$&/")+"/"),Wc(i,e,t,"",function(d){return d})):i!=null&&(_w(i)&&(i=Ek(i,t+(i.key==null||n&&n.key===i.key?"":(""+i.key).replace($j,"$&/")+"/")+o)),e.push(i)),1;o=0;var l=s===""?".":s+":";if(zj(n))for(var c=0;c<n.length;c++)s=n[c],a=l+Iy(s,c),o+=Wc(s,e,t,a,i);else if(c=_k(n),typeof c=="function")for(n=c.call(n),c=0;!(s=n.next()).done;)s=s.value,a=l+Iy(s,c++),o+=Wc(s,e,t,a,i);else if(a==="object"){if(typeof n.then=="function")return Wc(Ik(n),e,t,s,i);throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return o}function Jf(n,e,t){if(n==null)return n;var s=[],i=0;return Wc(n,s,"","",function(a){return e.call(t,a,i++)}),s}function Tk(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var qj=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)};function Ck(){}vt.Children={map:Jf,forEach:function(n,e,t){Jf(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Jf(n,function(){e++}),e},toArray:function(n){return Jf(n,function(e){return e})||[]},only:function(n){if(!_w(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};vt.Component=mu;vt.Fragment=gk;vt.Profiler=yk;vt.PureComponent=vw;vt.StrictMode=xk;vt.Suspense=Nk;vt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Pn;vt.__COMPILER_RUNTIME={__proto__:null,c:function(n){return Pn.H.useMemoCache(n)}};vt.cache=function(n){return function(){return n.apply(null,arguments)}};vt.cloneElement=function(n,e,t){if(n==null)throw Error("The argument must be a React element, but you passed "+n+".");var s=kI({},n.props),i=n.key,a=void 0;if(e!=null)for(o in e.ref!==void 0&&(a=void 0),e.key!==void 0&&(i=""+e.key),e)!LI.call(e,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&e.ref===void 0||(s[o]=e[o]);var o=arguments.length-2;if(o===1)s.children=t;else if(1<o){for(var l=Array(o),c=0;c<o;c++)l[c]=arguments[c+2];s.children=l}return jw(n.type,i,void 0,void 0,a,s)};vt.createContext=function(n){return n={$$typeof:wk,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null},n.Provider=n,n.Consumer={$$typeof:bk,_context:n},n};vt.createElement=function(n,e,t){var s,i={},a=null;if(e!=null)for(s in e.key!==void 0&&(a=""+e.key),e)LI.call(e,s)&&s!=="key"&&s!=="__self"&&s!=="__source"&&(i[s]=e[s]);var o=arguments.length-2;if(o===1)i.children=t;else if(1<o){for(var l=Array(o),c=0;c<o;c++)l[c]=arguments[c+2];i.children=l}if(n&&n.defaultProps)for(s in o=n.defaultProps,o)i[s]===void 0&&(i[s]=o[s]);return jw(n,a,void 0,void 0,null,i)};vt.createRef=function(){return{current:null}};vt.forwardRef=function(n){return{$$typeof:vk,render:n}};vt.isValidElement=_w;vt.lazy=function(n){return{$$typeof:RI,_payload:{_status:-1,_result:n},_init:Tk}};vt.memo=function(n,e){return{$$typeof:jk,type:n,compare:e===void 0?null:e}};vt.startTransition=function(n){var e=Pn.T,t={};Pn.T=t;try{var s=n(),i=Pn.S;i!==null&&i(t,s),typeof s=="object"&&s!==null&&typeof s.then=="function"&&s.then(Ck,qj)}catch(a){qj(a)}finally{Pn.T=e}};vt.unstable_useCacheRefresh=function(){return Pn.H.useCacheRefresh()};vt.use=function(n){return Pn.H.use(n)};vt.useActionState=function(n,e,t){return Pn.H.useActionState(n,e,t)};vt.useCallback=function(n,e){return Pn.H.useCallback(n,e)};vt.useContext=function(n){return Pn.H.useContext(n)};vt.useDebugValue=function(){};vt.useDeferredValue=function(n,e){return Pn.H.useDeferredValue(n,e)};vt.useEffect=function(n,e,t){var s=Pn.H;if(typeof t=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return s.useEffect(n,e)};vt.useId=function(){return Pn.H.useId()};vt.useImperativeHandle=function(n,e,t){return Pn.H.useImperativeHandle(n,e,t)};vt.useInsertionEffect=function(n,e){return Pn.H.useInsertionEffect(n,e)};vt.useLayoutEffect=function(n,e){return Pn.H.useLayoutEffect(n,e)};vt.useMemo=function(n,e){return Pn.H.useMemo(n,e)};vt.useOptimistic=function(n,e){return Pn.H.useOptimistic(n,e)};vt.useReducer=function(n,e,t){return Pn.H.useReducer(n,e,t)};vt.useRef=function(n){return Pn.H.useRef(n)};vt.useState=function(n){return Pn.H.useState(n)};vt.useSyncExternalStore=function(n,e,t){return Pn.H.useSyncExternalStore(n,e,t)};vt.useTransition=function(){return Pn.H.useTransition()};vt.version="19.1.1";DI.exports=vt;var b=DI.exports;const FI=TI(b);var UI={exports:{}},dx={},VI={exports:{}},zI={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(H,ee){var se=H.length;H.push(ee);e:for(;0<se;){var Y=se-1>>>1,R=H[Y];if(0<i(R,ee))H[Y]=ee,H[se]=R,se=Y;else break e}}function t(H){return H.length===0?null:H[0]}function s(H){if(H.length===0)return null;var ee=H[0],se=H.pop();if(se!==ee){H[0]=se;e:for(var Y=0,R=H.length,_=R>>>1;Y<_;){var C=2*(Y+1)-1,z=H[C],K=C+1,F=H[K];if(0>i(z,se))K<R&&0>i(F,z)?(H[Y]=F,H[K]=se,Y=K):(H[Y]=z,H[C]=se,Y=C);else if(K<R&&0>i(F,se))H[Y]=F,H[K]=se,Y=K;else break e}}return ee}function i(H,ee){var se=H.sortIndex-ee.sortIndex;return se!==0?se:H.id-ee.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();n.unstable_now=function(){return o.now()-l}}var c=[],d=[],h=1,f=null,p=3,x=!1,I=!1,D=!1,A=!1,g=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,j=typeof setImmediate<"u"?setImmediate:null;function V(H){for(var ee=t(d);ee!==null;){if(ee.callback===null)s(d);else if(ee.startTime<=H)s(d),ee.sortIndex=ee.expirationTime,e(c,ee);else break;ee=t(d)}}function $(H){if(D=!1,V(H),!I)if(t(c)!==null)I=!0,Z||(Z=!0,U());else{var ee=t(d);ee!==null&&xe($,ee.startTime-H)}}var Z=!1,O=-1,M=5,T=-1;function L(){return A?!0:!(n.unstable_now()-T<M)}function G(){if(A=!1,Z){var H=n.unstable_now();T=H;var ee=!0;try{e:{I=!1,D&&(D=!1,N(O),O=-1),x=!0;var se=p;try{t:{for(V(H),f=t(c);f!==null&&!(f.expirationTime>H&&L());){var Y=f.callback;if(typeof Y=="function"){f.callback=null,p=f.priorityLevel;var R=Y(f.expirationTime<=H);if(H=n.unstable_now(),typeof R=="function"){f.callback=R,V(H),ee=!0;break t}f===t(c)&&s(c),V(H)}else s(c);f=t(c)}if(f!==null)ee=!0;else{var _=t(d);_!==null&&xe($,_.startTime-H),ee=!1}}break e}finally{f=null,p=se,x=!1}ee=void 0}}finally{ee?U():Z=!1}}}var U;if(typeof j=="function")U=function(){j(G)};else if(typeof MessageChannel<"u"){var k=new MessageChannel,re=k.port2;k.port1.onmessage=G,U=function(){re.postMessage(null)}}else U=function(){g(G,0)};function xe(H,ee){O=g(function(){H(n.unstable_now())},ee)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(H){H.callback=null},n.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<H?Math.floor(1e3/H):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_next=function(H){switch(p){case 1:case 2:case 3:var ee=3;break;default:ee=p}var se=p;p=ee;try{return H()}finally{p=se}},n.unstable_requestPaint=function(){A=!0},n.unstable_runWithPriority=function(H,ee){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var se=p;p=H;try{return ee()}finally{p=se}},n.unstable_scheduleCallback=function(H,ee,se){var Y=n.unstable_now();switch(typeof se=="object"&&se!==null?(se=se.delay,se=typeof se=="number"&&0<se?Y+se:Y):se=Y,H){case 1:var R=-1;break;case 2:R=250;break;case 5:R=1073741823;break;case 4:R=1e4;break;default:R=5e3}return R=se+R,H={id:h++,callback:ee,priorityLevel:H,startTime:se,expirationTime:R,sortIndex:-1},se>Y?(H.sortIndex=se,e(d,H),t(c)===null&&H===t(d)&&(D?(N(O),O=-1):D=!0,xe($,se-Y))):(H.sortIndex=R,e(c,H),I||x||(I=!0,Z||(Z=!0,U()))),H},n.unstable_shouldYield=L,n.unstable_wrapCallback=function(H){var ee=p;return function(){var se=p;p=ee;try{return H.apply(this,arguments)}finally{p=se}}}})(zI);VI.exports=zI;var Ak=VI.exports,$I={exports:{}},lr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dk=b;function BI(n){var e="https://react.dev/errors/"+n;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var t=2;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t])}return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function lo(){}var or={d:{f:lo,r:function(){throw Error(BI(522))},D:lo,C:lo,L:lo,m:lo,X:lo,S:lo,M:lo},p:0,findDOMNode:null},Rk=Symbol.for("react.portal");function Pk(n,e,t){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Rk,key:s==null?null:""+s,children:n,containerInfo:e,implementation:t}}var Rh=Dk.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function ux(n,e){if(n==="font")return"";if(typeof e=="string")return e==="use-credentials"?e:""}lr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=or;lr.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)throw Error(BI(299));return Pk(n,e,null,t)};lr.flushSync=function(n){var e=Rh.T,t=or.p;try{if(Rh.T=null,or.p=2,n)return n()}finally{Rh.T=e,or.p=t,or.d.f()}};lr.preconnect=function(n,e){typeof n=="string"&&(e?(e=e.crossOrigin,e=typeof e=="string"?e==="use-credentials"?e:"":void 0):e=null,or.d.C(n,e))};lr.prefetchDNS=function(n){typeof n=="string"&&or.d.D(n)};lr.preinit=function(n,e){if(typeof n=="string"&&e&&typeof e.as=="string"){var t=e.as,s=ux(t,e.crossOrigin),i=typeof e.integrity=="string"?e.integrity:void 0,a=typeof e.fetchPriority=="string"?e.fetchPriority:void 0;t==="style"?or.d.S(n,typeof e.precedence=="string"?e.precedence:void 0,{crossOrigin:s,integrity:i,fetchPriority:a}):t==="script"&&or.d.X(n,{crossOrigin:s,integrity:i,fetchPriority:a,nonce:typeof e.nonce=="string"?e.nonce:void 0})}};lr.preinitModule=function(n,e){if(typeof n=="string")if(typeof e=="object"&&e!==null){if(e.as==null||e.as==="script"){var t=ux(e.as,e.crossOrigin);or.d.M(n,{crossOrigin:t,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0})}}else e==null&&or.d.M(n)};lr.preload=function(n,e){if(typeof n=="string"&&typeof e=="object"&&e!==null&&typeof e.as=="string"){var t=e.as,s=ux(t,e.crossOrigin);or.d.L(n,t,{crossOrigin:s,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0,type:typeof e.type=="string"?e.type:void 0,fetchPriority:typeof e.fetchPriority=="string"?e.fetchPriority:void 0,referrerPolicy:typeof e.referrerPolicy=="string"?e.referrerPolicy:void 0,imageSrcSet:typeof e.imageSrcSet=="string"?e.imageSrcSet:void 0,imageSizes:typeof e.imageSizes=="string"?e.imageSizes:void 0,media:typeof e.media=="string"?e.media:void 0})}};lr.preloadModule=function(n,e){if(typeof n=="string")if(e){var t=ux(e.as,e.crossOrigin);or.d.m(n,{as:typeof e.as=="string"&&e.as!=="script"?e.as:void 0,crossOrigin:t,integrity:typeof e.integrity=="string"?e.integrity:void 0})}else or.d.m(n)};lr.requestFormReset=function(n){or.d.r(n)};lr.unstable_batchedUpdates=function(n,e){return n(e)};lr.useFormState=function(n,e,t){return Rh.H.useFormState(n,e,t)};lr.useFormStatus=function(){return Rh.H.useHostTransitionStatus()};lr.version="19.1.1";function qI(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(qI)}catch(n){console.error(n)}}qI(),$I.exports=lr;var kk=$I.exports;/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fs=Ak,HI=b,Ok=kk;function Ae(n){var e="https://react.dev/errors/"+n;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var t=2;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t])}return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function GI(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function $m(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function QI(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function Hj(n){if($m(n)!==n)throw Error(Ae(188))}function Mk(n){var e=n.alternate;if(!e){if(e=$m(n),e===null)throw Error(Ae(188));return e!==n?null:n}for(var t=n,s=e;;){var i=t.return;if(i===null)break;var a=i.alternate;if(a===null){if(s=i.return,s!==null){t=s;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===t)return Hj(i),n;if(a===s)return Hj(i),e;a=a.sibling}throw Error(Ae(188))}if(t.return!==s.return)t=i,s=a;else{for(var o=!1,l=i.child;l;){if(l===t){o=!0,t=i,s=a;break}if(l===s){o=!0,s=i,t=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===t){o=!0,t=a,s=i;break}if(l===s){o=!0,s=a,t=i;break}l=l.sibling}if(!o)throw Error(Ae(189))}}if(t.alternate!==s)throw Error(Ae(190))}if(t.tag!==3)throw Error(Ae(188));return t.stateNode.current===t?n:e}function WI(n){var e=n.tag;if(e===5||e===26||e===27||e===6)return n;for(n=n.child;n!==null;){if(e=WI(n),e!==null)return e;n=n.sibling}return null}var Sn=Object.assign,Lk=Symbol.for("react.element"),Zf=Symbol.for("react.transitional.element"),vh=Symbol.for("react.portal"),id=Symbol.for("react.fragment"),KI=Symbol.for("react.strict_mode"),kb=Symbol.for("react.profiler"),Fk=Symbol.for("react.provider"),YI=Symbol.for("react.consumer"),ba=Symbol.for("react.context"),Ew=Symbol.for("react.forward_ref"),Ob=Symbol.for("react.suspense"),Mb=Symbol.for("react.suspense_list"),Sw=Symbol.for("react.memo"),go=Symbol.for("react.lazy"),Lb=Symbol.for("react.activity"),Uk=Symbol.for("react.memo_cache_sentinel"),Gj=Symbol.iterator;function ah(n){return n===null||typeof n!="object"?null:(n=Gj&&n[Gj]||n["@@iterator"],typeof n=="function"?n:null)}var Vk=Symbol.for("react.client.reference");function Fb(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===Vk?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case id:return"Fragment";case kb:return"Profiler";case KI:return"StrictMode";case Ob:return"Suspense";case Mb:return"SuspenseList";case Lb:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case vh:return"Portal";case ba:return(n.displayName||"Context")+".Provider";case YI:return(n._context.displayName||"Context")+".Consumer";case Ew:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Sw:return e=n.displayName||null,e!==null?e:Fb(n.type)||"Memo";case go:e=n._payload,n=n._init;try{return Fb(n(e))}catch{}}return null}var Nh=Array.isArray,ht=HI.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Qt=Ok.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Kl={pending:!1,data:null,method:null,action:null},Ub=[],ad=-1;function Ji(n){return{current:n}}function As(n){0>ad||(n.current=Ub[ad],Ub[ad]=null,ad--)}function kn(n,e){ad++,Ub[ad]=n.current,n.current=e}var Vi=Ji(null),cm=Ji(null),Oo=Ji(null),ng=Ji(null);function sg(n,e){switch(kn(Oo,e),kn(cm,n),kn(Vi,null),e.nodeType){case 9:case 11:n=(n=e.documentElement)&&(n=n.namespaceURI)?X_(n):0;break;default:if(n=e.tagName,e=e.namespaceURI)e=X_(e),n=mC(e,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}As(Vi),kn(Vi,n)}function kd(){As(Vi),As(cm),As(Oo)}function Vb(n){n.memoizedState!==null&&kn(ng,n);var e=Vi.current,t=mC(e,n.type);e!==t&&(kn(cm,n),kn(Vi,t))}function rg(n){cm.current===n&&(As(Vi),As(cm)),ng.current===n&&(As(ng),bm._currentValue=Kl)}var zb=Object.prototype.hasOwnProperty,Iw=fs.unstable_scheduleCallback,Ty=fs.unstable_cancelCallback,zk=fs.unstable_shouldYield,$k=fs.unstable_requestPaint,zi=fs.unstable_now,Bk=fs.unstable_getCurrentPriorityLevel,XI=fs.unstable_ImmediatePriority,JI=fs.unstable_UserBlockingPriority,ig=fs.unstable_NormalPriority,qk=fs.unstable_LowPriority,ZI=fs.unstable_IdlePriority,Hk=fs.log,Gk=fs.unstable_setDisableYieldValue,Bm=null,Mr=null;function Co(n){if(typeof Hk=="function"&&Gk(n),Mr&&typeof Mr.setStrictMode=="function")try{Mr.setStrictMode(Bm,n)}catch{}}var Lr=Math.clz32?Math.clz32:Kk,Qk=Math.log,Wk=Math.LN2;function Kk(n){return n>>>=0,n===0?32:31-(Qk(n)/Wk|0)|0}var ep=256,tp=4194304;function Ll(n){var e=n&42;if(e!==0)return e;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function hx(n,e,t){var s=n.pendingLanes;if(s===0)return 0;var i=0,a=n.suspendedLanes,o=n.pingedLanes;n=n.warmLanes;var l=s&134217727;return l!==0?(s=l&~a,s!==0?i=Ll(s):(o&=l,o!==0?i=Ll(o):t||(t=l&~n,t!==0&&(i=Ll(t))))):(l=s&~a,l!==0?i=Ll(l):o!==0?i=Ll(o):t||(t=s&~n,t!==0&&(i=Ll(t)))),i===0?0:e!==0&&e!==i&&!(e&a)&&(a=i&-i,t=e&-e,a>=t||a===32&&(t&4194048)!==0)?e:i}function qm(n,e){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&e)===0}function Yk(n,e){switch(n){case 1:case 2:case 4:case 8:case 64:return e+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function eT(){var n=ep;return ep<<=1,!(ep&4194048)&&(ep=256),n}function tT(){var n=tp;return tp<<=1,!(tp&62914560)&&(tp=4194304),n}function Cy(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Hm(n,e){n.pendingLanes|=e,e!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function Xk(n,e,t,s,i,a){var o=n.pendingLanes;n.pendingLanes=t,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=t,n.entangledLanes&=t,n.errorRecoveryDisabledLanes&=t,n.shellSuspendCounter=0;var l=n.entanglements,c=n.expirationTimes,d=n.hiddenUpdates;for(t=o&~t;0<t;){var h=31-Lr(t),f=1<<h;l[h]=0,c[h]=-1;var p=d[h];if(p!==null)for(d[h]=null,h=0;h<p.length;h++){var x=p[h];x!==null&&(x.lane&=-536870913)}t&=~f}s!==0&&nT(n,s,0),a!==0&&i===0&&n.tag!==0&&(n.suspendedLanes|=a&~(o&~e))}function nT(n,e,t){n.pendingLanes|=e,n.suspendedLanes&=~e;var s=31-Lr(e);n.entangledLanes|=e,n.entanglements[s]=n.entanglements[s]|1073741824|t&4194090}function sT(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var s=31-Lr(t),i=1<<s;i&e|n[s]&e&&(n[s]|=e),t&=~i}}function Tw(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function Cw(n){return n&=-n,2<n?8<n?n&134217727?32:268435456:8:2}function rT(){var n=Qt.p;return n!==0?n:(n=window.event,n===void 0?32:jC(n.type))}function Jk(n,e){var t=Qt.p;try{return Qt.p=n,e()}finally{Qt.p=t}}var rl=Math.random().toString(36).slice(2),Gs="__reactFiber$"+rl,vr="__reactProps$"+rl,fu="__reactContainer$"+rl,$b="__reactEvents$"+rl,Zk="__reactListeners$"+rl,eO="__reactHandles$"+rl,Qj="__reactResources$"+rl,Gm="__reactMarker$"+rl;function Aw(n){delete n[Gs],delete n[vr],delete n[$b],delete n[Zk],delete n[eO]}function od(n){var e=n[Gs];if(e)return e;for(var t=n.parentNode;t;){if(e=t[fu]||t[Gs]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=eE(n);n!==null;){if(t=n[Gs])return t;n=eE(n)}return e}n=t,t=n.parentNode}return null}function pu(n){if(n=n[Gs]||n[fu]){var e=n.tag;if(e===5||e===6||e===13||e===26||e===27||e===3)return n}return null}function jh(n){var e=n.tag;if(e===5||e===26||e===27||e===6)return n.stateNode;throw Error(Ae(33))}function bd(n){var e=n[Qj];return e||(e=n[Qj]={hoistableStyles:new Map,hoistableScripts:new Map}),e}function Ts(n){n[Gm]=!0}var iT=new Set,aT={};function wc(n,e){Od(n,e),Od(n+"Capture",e)}function Od(n,e){for(aT[n]=e,n=0;n<e.length;n++)iT.add(e[n])}var tO=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Wj={},Kj={};function nO(n){return zb.call(Kj,n)?!0:zb.call(Wj,n)?!1:tO.test(n)?Kj[n]=!0:(Wj[n]=!0,!1)}function _p(n,e,t){if(nO(e))if(t===null)n.removeAttribute(e);else{switch(typeof t){case"undefined":case"function":case"symbol":n.removeAttribute(e);return;case"boolean":var s=e.toLowerCase().slice(0,5);if(s!=="data-"&&s!=="aria-"){n.removeAttribute(e);return}}n.setAttribute(e,""+t)}}function np(n,e,t){if(t===null)n.removeAttribute(e);else{switch(typeof t){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(e);return}n.setAttribute(e,""+t)}}function ha(n,e,t,s){if(s===null)n.removeAttribute(t);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(t);return}n.setAttributeNS(e,t,""+s)}}var Ay,Yj;function Kc(n){if(Ay===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Ay=e&&e[1]||"",Yj=-1<t.stack.indexOf(`
    at`)?" (<anonymous>)":-1<t.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ay+n+Yj}var Dy=!1;function Ry(n,e){if(!n||Dy)return"";Dy=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var s={DetermineComponentFrameRoot:function(){try{if(e){var f=function(){throw Error()};if(Object.defineProperty(f.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(f,[])}catch(x){var p=x}Reflect.construct(n,[],f)}else{try{f.call()}catch(x){p=x}n.call(f.prototype)}}else{try{throw Error()}catch(x){p=x}(f=n())&&typeof f.catch=="function"&&f.catch(function(){})}}catch(x){if(x&&p&&typeof x.stack=="string")return[x.stack,p.stack]}return[null,null]}};s.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var i=Object.getOwnPropertyDescriptor(s.DetermineComponentFrameRoot,"name");i&&i.configurable&&Object.defineProperty(s.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var a=s.DetermineComponentFrameRoot(),o=a[0],l=a[1];if(o&&l){var c=o.split(`
`),d=l.split(`
`);for(i=s=0;s<c.length&&!c[s].includes("DetermineComponentFrameRoot");)s++;for(;i<d.length&&!d[i].includes("DetermineComponentFrameRoot");)i++;if(s===c.length||i===d.length)for(s=c.length-1,i=d.length-1;1<=s&&0<=i&&c[s]!==d[i];)i--;for(;1<=s&&0<=i;s--,i--)if(c[s]!==d[i]){if(s!==1||i!==1)do if(s--,i--,0>i||c[s]!==d[i]){var h=`
`+c[s].replace(" at new "," at ");return n.displayName&&h.includes("<anonymous>")&&(h=h.replace("<anonymous>",n.displayName)),h}while(1<=s&&0<=i);break}}}finally{Dy=!1,Error.prepareStackTrace=t}return(t=n?n.displayName||n.name:"")?Kc(t):""}function sO(n){switch(n.tag){case 26:case 27:case 5:return Kc(n.type);case 16:return Kc("Lazy");case 13:return Kc("Suspense");case 19:return Kc("SuspenseList");case 0:case 15:return Ry(n.type,!1);case 11:return Ry(n.type.render,!1);case 1:return Ry(n.type,!0);case 31:return Kc("Activity");default:return""}}function Xj(n){try{var e="";do e+=sO(n),n=n.return;while(n);return e}catch(t){return`
Error generating stack: `+t.message+`
`+t.stack}}function Xr(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function oT(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function rO(n){var e=oT(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),s=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,a=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){s=""+o,a.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function ag(n){n._valueTracker||(n._valueTracker=rO(n))}function lT(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),s="";return n&&(s=oT(n)?n.checked?"true":"false":n.value),n=s,n!==t?(e.setValue(n),!0):!1}function og(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var iO=/[\n"\\]/g;function ei(n){return n.replace(iO,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function Bb(n,e,t,s,i,a,o,l){n.name="",o!=null&&typeof o!="function"&&typeof o!="symbol"&&typeof o!="boolean"?n.type=o:n.removeAttribute("type"),e!=null?o==="number"?(e===0&&n.value===""||n.value!=e)&&(n.value=""+Xr(e)):n.value!==""+Xr(e)&&(n.value=""+Xr(e)):o!=="submit"&&o!=="reset"||n.removeAttribute("value"),e!=null?qb(n,o,Xr(e)):t!=null?qb(n,o,Xr(t)):s!=null&&n.removeAttribute("value"),i==null&&a!=null&&(n.defaultChecked=!!a),i!=null&&(n.checked=i&&typeof i!="function"&&typeof i!="symbol"),l!=null&&typeof l!="function"&&typeof l!="symbol"&&typeof l!="boolean"?n.name=""+Xr(l):n.removeAttribute("name")}function cT(n,e,t,s,i,a,o,l){if(a!=null&&typeof a!="function"&&typeof a!="symbol"&&typeof a!="boolean"&&(n.type=a),e!=null||t!=null){if(!(a!=="submit"&&a!=="reset"||e!=null))return;t=t!=null?""+Xr(t):"",e=e!=null?""+Xr(e):t,l||e===n.value||(n.value=e),n.defaultValue=e}s=s??i,s=typeof s!="function"&&typeof s!="symbol"&&!!s,n.checked=l?n.checked:!!s,n.defaultChecked=!!s,o!=null&&typeof o!="function"&&typeof o!="symbol"&&typeof o!="boolean"&&(n.name=o)}function qb(n,e,t){e==="number"&&og(n.ownerDocument)===n||n.defaultValue===""+t||(n.defaultValue=""+t)}function wd(n,e,t,s){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&s&&(n[t].defaultSelected=!0)}else{for(t=""+Xr(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,s&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function dT(n,e,t){if(e!=null&&(e=""+Xr(e),e!==n.value&&(n.value=e),t==null)){n.defaultValue!==e&&(n.defaultValue=e);return}n.defaultValue=t!=null?""+Xr(t):""}function uT(n,e,t,s){if(e==null){if(s!=null){if(t!=null)throw Error(Ae(92));if(Nh(s)){if(1<s.length)throw Error(Ae(93));s=s[0]}t=s}t==null&&(t=""),e=t}t=Xr(e),n.defaultValue=t,s=n.textContent,s===t&&s!==""&&s!==null&&(n.value=s)}function Md(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var aO=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Jj(n,e,t){var s=e.indexOf("--")===0;t==null||typeof t=="boolean"||t===""?s?n.setProperty(e,""):e==="float"?n.cssFloat="":n[e]="":s?n.setProperty(e,t):typeof t!="number"||t===0||aO.has(e)?e==="float"?n.cssFloat=t:n[e]=(""+t).trim():n[e]=t+"px"}function hT(n,e,t){if(e!=null&&typeof e!="object")throw Error(Ae(62));if(n=n.style,t!=null){for(var s in t)!t.hasOwnProperty(s)||e!=null&&e.hasOwnProperty(s)||(s.indexOf("--")===0?n.setProperty(s,""):s==="float"?n.cssFloat="":n[s]="");for(var i in e)s=e[i],e.hasOwnProperty(i)&&t[i]!==s&&Jj(n,i,s)}else for(var a in e)e.hasOwnProperty(a)&&Jj(n,a,e[a])}function Dw(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var oO=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),lO=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ep(n){return lO.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}var Hb=null;function Rw(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var ld=null,vd=null;function Zj(n){var e=pu(n);if(e&&(n=e.stateNode)){var t=n[vr]||null;e:switch(n=e.stateNode,e.type){case"input":if(Bb(n,t.value,t.defaultValue,t.defaultValue,t.checked,t.defaultChecked,t.type,t.name),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll('input[name="'+ei(""+e)+'"][type="radio"]'),e=0;e<t.length;e++){var s=t[e];if(s!==n&&s.form===n.form){var i=s[vr]||null;if(!i)throw Error(Ae(90));Bb(s,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name)}}for(e=0;e<t.length;e++)s=t[e],s.form===n.form&&lT(s)}break e;case"textarea":dT(n,t.value,t.defaultValue);break e;case"select":e=t.value,e!=null&&wd(n,!!t.multiple,e,!1)}}}var Py=!1;function mT(n,e,t){if(Py)return n(e,t);Py=!0;try{var s=n(e);return s}finally{if(Py=!1,(ld!==null||vd!==null)&&(Nx(),ld&&(e=ld,n=vd,vd=ld=null,Zj(e),n)))for(e=0;e<n.length;e++)Zj(n[e])}}function dm(n,e){var t=n.stateNode;if(t===null)return null;var s=t[vr]||null;if(s===null)return null;t=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(n=n.type,s=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!s;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Ae(231,e,typeof t));return t}var Oa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Gb=!1;if(Oa)try{var oh={};Object.defineProperty(oh,"passive",{get:function(){Gb=!0}}),window.addEventListener("test",oh,oh),window.removeEventListener("test",oh,oh)}catch{Gb=!1}var Ao=null,Pw=null,Sp=null;function fT(){if(Sp)return Sp;var n,e=Pw,t=e.length,s,i="value"in Ao?Ao.value:Ao.textContent,a=i.length;for(n=0;n<t&&e[n]===i[n];n++);var o=t-n;for(s=1;s<=o&&e[t-s]===i[a-s];s++);return Sp=i.slice(n,1<s?1-s:void 0)}function Ip(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function sp(){return!0}function e_(){return!1}function Nr(n){function e(t,s,i,a,o){this._reactName=t,this._targetInst=i,this.type=s,this.nativeEvent=a,this.target=o,this.currentTarget=null;for(var l in n)n.hasOwnProperty(l)&&(t=n[l],this[l]=t?t(a):a[l]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?sp:e_,this.isPropagationStopped=e_,this}return Sn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=sp)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=sp)},persist:function(){},isPersistent:sp}),e}var vc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},mx=Nr(vc),Qm=Sn({},vc,{view:0,detail:0}),cO=Nr(Qm),ky,Oy,lh,fx=Sn({},Qm,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kw,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==lh&&(lh&&n.type==="mousemove"?(ky=n.screenX-lh.screenX,Oy=n.screenY-lh.screenY):Oy=ky=0,lh=n),ky)},movementY:function(n){return"movementY"in n?n.movementY:Oy}}),t_=Nr(fx),dO=Sn({},fx,{dataTransfer:0}),uO=Nr(dO),hO=Sn({},Qm,{relatedTarget:0}),My=Nr(hO),mO=Sn({},vc,{animationName:0,elapsedTime:0,pseudoElement:0}),fO=Nr(mO),pO=Sn({},vc,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),gO=Nr(pO),xO=Sn({},vc,{data:0}),n_=Nr(xO),yO={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},bO={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wO={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vO(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=wO[n])?!!e[n]:!1}function kw(){return vO}var NO=Sn({},Qm,{key:function(n){if(n.key){var e=yO[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Ip(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?bO[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kw,charCode:function(n){return n.type==="keypress"?Ip(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Ip(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),jO=Nr(NO),_O=Sn({},fx,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),s_=Nr(_O),EO=Sn({},Qm,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kw}),SO=Nr(EO),IO=Sn({},vc,{propertyName:0,elapsedTime:0,pseudoElement:0}),TO=Nr(IO),CO=Sn({},fx,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),AO=Nr(CO),DO=Sn({},vc,{newState:0,oldState:0}),RO=Nr(DO),PO=[9,13,27,32],Ow=Oa&&"CompositionEvent"in window,Ph=null;Oa&&"documentMode"in document&&(Ph=document.documentMode);var kO=Oa&&"TextEvent"in window&&!Ph,pT=Oa&&(!Ow||Ph&&8<Ph&&11>=Ph),r_=" ",i_=!1;function gT(n,e){switch(n){case"keyup":return PO.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xT(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var cd=!1;function OO(n,e){switch(n){case"compositionend":return xT(e);case"keypress":return e.which!==32?null:(i_=!0,r_);case"textInput":return n=e.data,n===r_&&i_?null:n;default:return null}}function MO(n,e){if(cd)return n==="compositionend"||!Ow&&gT(n,e)?(n=fT(),Sp=Pw=Ao=null,cd=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return pT&&e.locale!=="ko"?null:e.data;default:return null}}var LO={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function a_(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!LO[n.type]:e==="textarea"}function yT(n,e,t,s){ld?vd?vd.push(s):vd=[s]:ld=s,e=Eg(e,"onChange"),0<e.length&&(t=new mx("onChange","change",null,t,s),n.push({event:t,listeners:e}))}var kh=null,um=null;function FO(n){dC(n,0)}function px(n){var e=jh(n);if(lT(e))return n}function o_(n,e){if(n==="change")return e}var bT=!1;if(Oa){var Ly;if(Oa){var Fy="oninput"in document;if(!Fy){var l_=document.createElement("div");l_.setAttribute("oninput","return;"),Fy=typeof l_.oninput=="function"}Ly=Fy}else Ly=!1;bT=Ly&&(!document.documentMode||9<document.documentMode)}function c_(){kh&&(kh.detachEvent("onpropertychange",wT),um=kh=null)}function wT(n){if(n.propertyName==="value"&&px(um)){var e=[];yT(e,um,n,Rw(n)),mT(FO,e)}}function UO(n,e,t){n==="focusin"?(c_(),kh=e,um=t,kh.attachEvent("onpropertychange",wT)):n==="focusout"&&c_()}function VO(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return px(um)}function zO(n,e){if(n==="click")return px(e)}function $O(n,e){if(n==="input"||n==="change")return px(e)}function BO(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var zr=typeof Object.is=="function"?Object.is:BO;function hm(n,e){if(zr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),s=Object.keys(e);if(t.length!==s.length)return!1;for(s=0;s<t.length;s++){var i=t[s];if(!zb.call(e,i)||!zr(n[i],e[i]))return!1}return!0}function d_(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function u_(n,e){var t=d_(n);n=0;for(var s;t;){if(t.nodeType===3){if(s=n+t.textContent.length,n<=e&&s>=e)return{node:t,offset:e-n};n=s}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=d_(t)}}function vT(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?vT(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function NT(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var e=og(n.document);e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=og(n.document)}return e}function Mw(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}var qO=Oa&&"documentMode"in document&&11>=document.documentMode,dd=null,Qb=null,Oh=null,Wb=!1;function h_(n,e,t){var s=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Wb||dd==null||dd!==og(s)||(s=dd,"selectionStart"in s&&Mw(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Oh&&hm(Oh,s)||(Oh=s,s=Eg(Qb,"onSelect"),0<s.length&&(e=new mx("onSelect","select",null,e,t),n.push({event:e,listeners:s}),e.target=dd)))}function Tl(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var ud={animationend:Tl("Animation","AnimationEnd"),animationiteration:Tl("Animation","AnimationIteration"),animationstart:Tl("Animation","AnimationStart"),transitionrun:Tl("Transition","TransitionRun"),transitionstart:Tl("Transition","TransitionStart"),transitioncancel:Tl("Transition","TransitionCancel"),transitionend:Tl("Transition","TransitionEnd")},Uy={},jT={};Oa&&(jT=document.createElement("div").style,"AnimationEvent"in window||(delete ud.animationend.animation,delete ud.animationiteration.animation,delete ud.animationstart.animation),"TransitionEvent"in window||delete ud.transitionend.transition);function Nc(n){if(Uy[n])return Uy[n];if(!ud[n])return n;var e=ud[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in jT)return Uy[n]=e[t];return n}var _T=Nc("animationend"),ET=Nc("animationiteration"),ST=Nc("animationstart"),HO=Nc("transitionrun"),GO=Nc("transitionstart"),QO=Nc("transitioncancel"),IT=Nc("transitionend"),TT=new Map,Kb="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Kb.push("scrollEnd");function vi(n,e){TT.set(n,e),wc(e,[n])}var m_=new WeakMap;function ti(n,e){if(typeof n=="object"&&n!==null){var t=m_.get(n);return t!==void 0?t:(e={value:n,source:e,stack:Xj(e)},m_.set(n,e),e)}return{value:n,source:e,stack:Xj(e)}}var Yr=[],hd=0,Lw=0;function gx(){for(var n=hd,e=Lw=hd=0;e<n;){var t=Yr[e];Yr[e++]=null;var s=Yr[e];Yr[e++]=null;var i=Yr[e];Yr[e++]=null;var a=Yr[e];if(Yr[e++]=null,s!==null&&i!==null){var o=s.pending;o===null?i.next=i:(i.next=o.next,o.next=i),s.pending=i}a!==0&&CT(t,i,a)}}function xx(n,e,t,s){Yr[hd++]=n,Yr[hd++]=e,Yr[hd++]=t,Yr[hd++]=s,Lw|=s,n.lanes|=s,n=n.alternate,n!==null&&(n.lanes|=s)}function Fw(n,e,t,s){return xx(n,e,t,s),lg(n)}function gu(n,e){return xx(n,null,null,e),lg(n)}function CT(n,e,t){n.lanes|=t;var s=n.alternate;s!==null&&(s.lanes|=t);for(var i=!1,a=n.return;a!==null;)a.childLanes|=t,s=a.alternate,s!==null&&(s.childLanes|=t),a.tag===22&&(n=a.stateNode,n===null||n._visibility&1||(i=!0)),n=a,a=a.return;return n.tag===3?(a=n.stateNode,i&&e!==null&&(i=31-Lr(t),n=a.hiddenUpdates,s=n[i],s===null?n[i]=[e]:s.push(e),e.lane=t|536870912),a):null}function lg(n){if(50<Hh)throw Hh=0,g0=null,Error(Ae(185));for(var e=n.return;e!==null;)n=e,e=n.return;return n.tag===3?n.stateNode:null}var md={};function WO(n,e,t,s){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rr(n,e,t,s){return new WO(n,e,t,s)}function Uw(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Aa(n,e){var t=n.alternate;return t===null?(t=Rr(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&65011712,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t.refCleanup=n.refCleanup,t}function AT(n,e){n.flags&=65011714;var t=n.alternate;return t===null?(n.childLanes=0,n.lanes=e,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,n.type=t.type,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n}function Tp(n,e,t,s,i,a){var o=0;if(s=n,typeof n=="function")Uw(n)&&(o=1);else if(typeof n=="string")o=YM(n,t,Vi.current)?26:n==="html"||n==="head"||n==="body"?27:5;else e:switch(n){case Lb:return n=Rr(31,t,e,i),n.elementType=Lb,n.lanes=a,n;case id:return Yl(t.children,i,a,e);case KI:o=8,i|=24;break;case kb:return n=Rr(12,t,e,i|2),n.elementType=kb,n.lanes=a,n;case Ob:return n=Rr(13,t,e,i),n.elementType=Ob,n.lanes=a,n;case Mb:return n=Rr(19,t,e,i),n.elementType=Mb,n.lanes=a,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Fk:case ba:o=10;break e;case YI:o=9;break e;case Ew:o=11;break e;case Sw:o=14;break e;case go:o=16,s=null;break e}o=29,t=Error(Ae(130,n===null?"null":typeof n,"")),s=null}return e=Rr(o,t,e,i),e.elementType=n,e.type=s,e.lanes=a,e}function Yl(n,e,t,s){return n=Rr(7,n,s,e),n.lanes=t,n}function Vy(n,e,t){return n=Rr(6,n,null,e),n.lanes=t,n}function zy(n,e,t){return e=Rr(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}var fd=[],pd=0,cg=null,dg=0,Jr=[],Zr=0,Xl=null,wa=1,va="";function Fl(n,e){fd[pd++]=dg,fd[pd++]=cg,cg=n,dg=e}function DT(n,e,t){Jr[Zr++]=wa,Jr[Zr++]=va,Jr[Zr++]=Xl,Xl=n;var s=wa;n=va;var i=32-Lr(s)-1;s&=~(1<<i),t+=1;var a=32-Lr(e)+i;if(30<a){var o=i-i%5;a=(s&(1<<o)-1).toString(32),s>>=o,i-=o,wa=1<<32-Lr(e)+i|t<<i|s,va=a+n}else wa=1<<a|t<<i|s,va=n}function Vw(n){n.return!==null&&(Fl(n,1),DT(n,1,0))}function zw(n){for(;n===cg;)cg=fd[--pd],fd[pd]=null,dg=fd[--pd],fd[pd]=null;for(;n===Xl;)Xl=Jr[--Zr],Jr[Zr]=null,va=Jr[--Zr],Jr[Zr]=null,wa=Jr[--Zr],Jr[Zr]=null}var ar=null,Yn=null,Ht=!1,Jl=null,Oi=!1,Yb=Error(Ae(519));function ac(n){var e=Error(Ae(418,""));throw mm(ti(e,n)),Yb}function f_(n){var e=n.stateNode,t=n.type,s=n.memoizedProps;switch(e[Gs]=n,e[vr]=s,t){case"dialog":Et("cancel",e),Et("close",e);break;case"iframe":case"object":case"embed":Et("load",e);break;case"video":case"audio":for(t=0;t<gm.length;t++)Et(gm[t],e);break;case"source":Et("error",e);break;case"img":case"image":case"link":Et("error",e),Et("load",e);break;case"details":Et("toggle",e);break;case"input":Et("invalid",e),cT(e,s.value,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name,!0),ag(e);break;case"select":Et("invalid",e);break;case"textarea":Et("invalid",e),uT(e,s.value,s.defaultValue,s.children),ag(e)}t=s.children,typeof t!="string"&&typeof t!="number"&&typeof t!="bigint"||e.textContent===""+t||s.suppressHydrationWarning===!0||hC(e.textContent,t)?(s.popover!=null&&(Et("beforetoggle",e),Et("toggle",e)),s.onScroll!=null&&Et("scroll",e),s.onScrollEnd!=null&&Et("scrollend",e),s.onClick!=null&&(e.onclick=Ex),e=!0):e=!1,e||ac(n)}function p_(n){for(ar=n.return;ar;)switch(ar.tag){case 5:case 13:Oi=!1;return;case 27:case 3:Oi=!0;return;default:ar=ar.return}}function ch(n){if(n!==ar)return!1;if(!Ht)return p_(n),Ht=!0,!1;var e=n.tag,t;if((t=e!==3&&e!==27)&&((t=e===5)&&(t=n.type,t=!(t!=="form"&&t!=="button")||N0(n.type,n.memoizedProps)),t=!t),t&&Yn&&ac(n),p_(n),e===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Ae(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8)if(t=n.data,t==="/$"){if(e===0){Yn=xi(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++;n=n.nextSibling}Yn=null}}else e===27?(e=Yn,il(n.type)?(n=E0,E0=null,Yn=n):Yn=e):Yn=ar?xi(n.stateNode.nextSibling):null;return!0}function Wm(){Yn=ar=null,Ht=!1}function g_(){var n=Jl;return n!==null&&(fr===null?fr=n:fr.push.apply(fr,n),Jl=null),n}function mm(n){Jl===null?Jl=[n]:Jl.push(n)}var Xb=Ji(null),jc=null,Na=null;function bo(n,e,t){kn(Xb,e._currentValue),e._currentValue=t}function Da(n){n._currentValue=Xb.current,As(Xb)}function Jb(n,e,t){for(;n!==null;){var s=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),n===t)break;n=n.return}}function Zb(n,e,t,s){var i=n.child;for(i!==null&&(i.return=n);i!==null;){var a=i.dependencies;if(a!==null){var o=i.child;a=a.firstContext;e:for(;a!==null;){var l=a;a=i;for(var c=0;c<e.length;c++)if(l.context===e[c]){a.lanes|=t,l=a.alternate,l!==null&&(l.lanes|=t),Jb(a.return,t,n),s||(o=null);break e}a=l.next}}else if(i.tag===18){if(o=i.return,o===null)throw Error(Ae(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),Jb(o,t,n),o=null}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===n){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}}function Km(n,e,t,s){n=null;for(var i=e,a=!1;i!==null;){if(!a){if(i.flags&524288)a=!0;else if(i.flags&262144)break}if(i.tag===10){var o=i.alternate;if(o===null)throw Error(Ae(387));if(o=o.memoizedProps,o!==null){var l=i.type;zr(i.pendingProps.value,o.value)||(n!==null?n.push(l):n=[l])}}else if(i===ng.current){if(o=i.alternate,o===null)throw Error(Ae(387));o.memoizedState.memoizedState!==i.memoizedState.memoizedState&&(n!==null?n.push(bm):n=[bm])}i=i.return}n!==null&&Zb(e,n,t,s),e.flags|=262144}function ug(n){for(n=n.firstContext;n!==null;){if(!zr(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function oc(n){jc=n,Na=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function Qs(n){return RT(jc,n)}function rp(n,e){return jc===null&&oc(n),RT(n,e)}function RT(n,e){var t=e._currentValue;if(e={context:e,memoizedValue:t,next:null},Na===null){if(n===null)throw Error(Ae(308));Na=e,n.dependencies={lanes:0,firstContext:e},n.flags|=524288}else Na=Na.next=e;return t}var KO=typeof AbortController<"u"?AbortController:function(){var n=[],e=this.signal={aborted:!1,addEventListener:function(t,s){n.push(s)}};this.abort=function(){e.aborted=!0,n.forEach(function(t){return t()})}},YO=fs.unstable_scheduleCallback,XO=fs.unstable_NormalPriority,hs={$$typeof:ba,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function $w(){return{controller:new KO,data:new Map,refCount:0}}function Ym(n){n.refCount--,n.refCount===0&&YO(XO,function(){n.controller.abort()})}var Mh=null,e0=0,Ld=0,Nd=null;function JO(n,e){if(Mh===null){var t=Mh=[];e0=0,Ld=uv(),Nd={status:"pending",value:void 0,then:function(s){t.push(s)}}}return e0++,e.then(x_,x_),e}function x_(){if(--e0===0&&Mh!==null){Nd!==null&&(Nd.status="fulfilled");var n=Mh;Mh=null,Ld=0,Nd=null;for(var e=0;e<n.length;e++)(0,n[e])()}}function ZO(n,e){var t=[],s={status:"pending",value:null,reason:null,then:function(i){t.push(i)}};return n.then(function(){s.status="fulfilled",s.value=e;for(var i=0;i<t.length;i++)(0,t[i])(e)},function(i){for(s.status="rejected",s.reason=i,i=0;i<t.length;i++)(0,t[i])(void 0)}),s}var y_=ht.S;ht.S=function(n,e){typeof e=="object"&&e!==null&&typeof e.then=="function"&&JO(n,e),y_!==null&&y_(n,e)};var Zl=Ji(null);function Bw(){var n=Zl.current;return n!==null?n:bn.pooledCache}function Cp(n,e){e===null?kn(Zl,Zl.current):kn(Zl,e.pool)}function PT(){var n=Bw();return n===null?null:{parent:hs._currentValue,pool:n}}var Xm=Error(Ae(460)),kT=Error(Ae(474)),yx=Error(Ae(542)),t0={then:function(){}};function b_(n){return n=n.status,n==="fulfilled"||n==="rejected"}function ip(){}function OT(n,e,t){switch(t=n[t],t===void 0?n.push(e):t!==e&&(e.then(ip,ip),e=t),e.status){case"fulfilled":return e.value;case"rejected":throw n=e.reason,v_(n),n;default:if(typeof e.status=="string")e.then(ip,ip);else{if(n=bn,n!==null&&100<n.shellSuspendCounter)throw Error(Ae(482));n=e,n.status="pending",n.then(function(s){if(e.status==="pending"){var i=e;i.status="fulfilled",i.value=s}},function(s){if(e.status==="pending"){var i=e;i.status="rejected",i.reason=s}})}switch(e.status){case"fulfilled":return e.value;case"rejected":throw n=e.reason,v_(n),n}throw Lh=e,Xm}}var Lh=null;function w_(){if(Lh===null)throw Error(Ae(459));var n=Lh;return Lh=null,n}function v_(n){if(n===Xm||n===yx)throw Error(Ae(483))}var xo=!1;function qw(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function n0(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function Mo(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function Lo(n,e,t){var s=n.updateQueue;if(s===null)return null;if(s=s.shared,nn&2){var i=s.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),s.pending=e,e=lg(n),CT(n,null,t),e}return xx(n,s,e,t),lg(n)}function Fh(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194048)!==0)){var s=e.lanes;s&=n.pendingLanes,t|=s,e.lanes=t,sT(n,t)}}function $y(n,e){var t=n.updateQueue,s=n.alternate;if(s!==null&&(s=s.updateQueue,t===s)){var i=null,a=null;if(t=t.firstBaseUpdate,t!==null){do{var o={lane:t.lane,tag:t.tag,payload:t.payload,callback:null,next:null};a===null?i=a=o:a=a.next=o,t=t.next}while(t!==null);a===null?i=a=e:a=a.next=e}else i=a=e;t={baseState:s.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:s.shared,callbacks:s.callbacks},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}var s0=!1;function Uh(){if(s0){var n=Nd;if(n!==null)throw n}}function Vh(n,e,t,s){s0=!1;var i=n.updateQueue;xo=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,l=i.shared.pending;if(l!==null){i.shared.pending=null;var c=l,d=c.next;c.next=null,o===null?a=d:o.next=d,o=c;var h=n.alternate;h!==null&&(h=h.updateQueue,l=h.lastBaseUpdate,l!==o&&(l===null?h.firstBaseUpdate=d:l.next=d,h.lastBaseUpdate=c))}if(a!==null){var f=i.baseState;o=0,h=d=c=null,l=a;do{var p=l.lane&-536870913,x=p!==l.lane;if(x?(Mt&p)===p:(s&p)===p){p!==0&&p===Ld&&(s0=!0),h!==null&&(h=h.next={lane:0,tag:l.tag,payload:l.payload,callback:null,next:null});e:{var I=n,D=l;p=e;var A=t;switch(D.tag){case 1:if(I=D.payload,typeof I=="function"){f=I.call(A,f,p);break e}f=I;break e;case 3:I.flags=I.flags&-65537|128;case 0:if(I=D.payload,p=typeof I=="function"?I.call(A,f,p):I,p==null)break e;f=Sn({},f,p);break e;case 2:xo=!0}}p=l.callback,p!==null&&(n.flags|=64,x&&(n.flags|=8192),x=i.callbacks,x===null?i.callbacks=[p]:x.push(p))}else x={lane:p,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(d=h=x,c=f):h=h.next=x,o|=p;if(l=l.next,l===null){if(l=i.shared.pending,l===null)break;x=l,l=x.next,x.next=null,i.lastBaseUpdate=x,i.shared.pending=null}}while(!0);h===null&&(c=f),i.baseState=c,i.firstBaseUpdate=d,i.lastBaseUpdate=h,a===null&&(i.shared.lanes=0),Xo|=o,n.lanes=o,n.memoizedState=f}}function MT(n,e){if(typeof n!="function")throw Error(Ae(191,n));n.call(e)}function LT(n,e){var t=n.callbacks;if(t!==null)for(n.callbacks=null,n=0;n<t.length;n++)MT(t[n],e)}var Fd=Ji(null),hg=Ji(0);function N_(n,e){n=Fa,kn(hg,n),kn(Fd,e),Fa=n|e.baseLanes}function r0(){kn(hg,Fa),kn(Fd,Fd.current)}function Hw(){Fa=hg.current,As(Fd),As(hg)}var Ko=0,Nt=null,hn=null,os=null,mg=!1,jd=!1,lc=!1,fg=0,fm=0,_d=null,eM=0;function ts(){throw Error(Ae(321))}function Gw(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!zr(n[t],e[t]))return!1;return!0}function Qw(n,e,t,s,i,a){return Ko=a,Nt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ht.H=n===null||n.memoizedState===null?f1:p1,lc=!1,a=t(s,i),lc=!1,jd&&(a=UT(e,t,s,i)),FT(n),a}function FT(n){ht.H=pg;var e=hn!==null&&hn.next!==null;if(Ko=0,os=hn=Nt=null,mg=!1,fm=0,_d=null,e)throw Error(Ae(300));n===null||Cs||(n=n.dependencies,n!==null&&ug(n)&&(Cs=!0))}function UT(n,e,t,s){Nt=n;var i=0;do{if(jd&&(_d=null),fm=0,jd=!1,25<=i)throw Error(Ae(301));if(i+=1,os=hn=null,n.updateQueue!=null){var a=n.updateQueue;a.lastEffect=null,a.events=null,a.stores=null,a.memoCache!=null&&(a.memoCache.index=0)}ht.H=oM,a=e(t,s)}while(jd);return a}function tM(){var n=ht.H,e=n.useState()[0];return e=typeof e.then=="function"?Jm(e):e,n=n.useState()[0],(hn!==null?hn.memoizedState:null)!==n&&(Nt.flags|=1024),e}function Ww(){var n=fg!==0;return fg=0,n}function Kw(n,e,t){e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~t}function Yw(n){if(mg){for(n=n.memoizedState;n!==null;){var e=n.queue;e!==null&&(e.pending=null),n=n.next}mg=!1}Ko=0,os=hn=Nt=null,jd=!1,fm=fg=0,_d=null}function hr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return os===null?Nt.memoizedState=os=n:os=os.next=n,os}function cs(){if(hn===null){var n=Nt.alternate;n=n!==null?n.memoizedState:null}else n=hn.next;var e=os===null?Nt.memoizedState:os.next;if(e!==null)os=e,hn=n;else{if(n===null)throw Nt.alternate===null?Error(Ae(467)):Error(Ae(310));hn=n,n={memoizedState:hn.memoizedState,baseState:hn.baseState,baseQueue:hn.baseQueue,queue:hn.queue,next:null},os===null?Nt.memoizedState=os=n:os=os.next=n}return os}function Xw(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Jm(n){var e=fm;return fm+=1,_d===null&&(_d=[]),n=OT(_d,n,e),e=Nt,(os===null?e.memoizedState:os.next)===null&&(e=e.alternate,ht.H=e===null||e.memoizedState===null?f1:p1),n}function bx(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return Jm(n);if(n.$$typeof===ba)return Qs(n)}throw Error(Ae(438,String(n)))}function Jw(n){var e=null,t=Nt.updateQueue;if(t!==null&&(e=t.memoCache),e==null){var s=Nt.alternate;s!==null&&(s=s.updateQueue,s!==null&&(s=s.memoCache,s!=null&&(e={data:s.data.map(function(i){return i.slice()}),index:0})))}if(e==null&&(e={data:[],index:0}),t===null&&(t=Xw(),Nt.updateQueue=t),t.memoCache=e,t=e.data[e.index],t===void 0)for(t=e.data[e.index]=Array(n),s=0;s<n;s++)t[s]=Uk;return e.index++,t}function Ma(n,e){return typeof e=="function"?e(n):e}function Ap(n){var e=cs();return Zw(e,hn,n)}function Zw(n,e,t){var s=n.queue;if(s===null)throw Error(Ae(311));s.lastRenderedReducer=t;var i=n.baseQueue,a=s.pending;if(a!==null){if(i!==null){var o=i.next;i.next=a.next,a.next=o}e.baseQueue=i=a,s.pending=null}if(a=n.baseState,i===null)n.memoizedState=a;else{e=i.next;var l=o=null,c=null,d=e,h=!1;do{var f=d.lane&-536870913;if(f!==d.lane?(Mt&f)===f:(Ko&f)===f){var p=d.revertLane;if(p===0)c!==null&&(c=c.next={lane:0,revertLane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),f===Ld&&(h=!0);else if((Ko&p)===p){d=d.next,p===Ld&&(h=!0);continue}else f={lane:0,revertLane:d.revertLane,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null},c===null?(l=c=f,o=a):c=c.next=f,Nt.lanes|=p,Xo|=p;f=d.action,lc&&t(a,f),a=d.hasEagerState?d.eagerState:t(a,f)}else p={lane:f,revertLane:d.revertLane,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null},c===null?(l=c=p,o=a):c=c.next=p,Nt.lanes|=f,Xo|=f;d=d.next}while(d!==null&&d!==e);if(c===null?o=a:c.next=l,!zr(a,n.memoizedState)&&(Cs=!0,h&&(t=Nd,t!==null)))throw t;n.memoizedState=a,n.baseState=o,n.baseQueue=c,s.lastRenderedState=a}return i===null&&(s.lanes=0),[n.memoizedState,s.dispatch]}function By(n){var e=cs(),t=e.queue;if(t===null)throw Error(Ae(311));t.lastRenderedReducer=n;var s=t.dispatch,i=t.pending,a=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do a=n(a,o.action),o=o.next;while(o!==i);zr(a,e.memoizedState)||(Cs=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),t.lastRenderedState=a}return[a,s]}function VT(n,e,t){var s=Nt,i=cs(),a=Ht;if(a){if(t===void 0)throw Error(Ae(407));t=t()}else t=e();var o=!zr((hn||i).memoizedState,t);o&&(i.memoizedState=t,Cs=!0),i=i.queue;var l=BT.bind(null,s,i,n);if(Zm(2048,8,l,[n]),i.getSnapshot!==e||o||os!==null&&os.memoizedState.tag&1){if(s.flags|=2048,Ud(9,wx(),$T.bind(null,s,i,t,e),null),bn===null)throw Error(Ae(349));a||Ko&124||zT(s,e,t)}return t}function zT(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Nt.updateQueue,e===null?(e=Xw(),Nt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function $T(n,e,t,s){e.value=t,e.getSnapshot=s,qT(e)&&HT(n)}function BT(n,e,t){return t(function(){qT(e)&&HT(n)})}function qT(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!zr(n,t)}catch{return!0}}function HT(n){var e=gu(n,2);e!==null&&Ur(e,n,2)}function i0(n){var e=hr();if(typeof n=="function"){var t=n;if(n=t(),lc){Co(!0);try{t()}finally{Co(!1)}}}return e.memoizedState=e.baseState=n,e.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ma,lastRenderedState:n},e}function GT(n,e,t,s){return n.baseState=t,Zw(n,hn,typeof s=="function"?s:Ma)}function nM(n,e,t,s,i){if(vx(n))throw Error(Ae(485));if(n=e.action,n!==null){var a={payload:i,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(o){a.listeners.push(o)}};ht.T!==null?t(!0):a.isTransition=!1,s(a),t=e.pending,t===null?(a.next=e.pending=a,QT(e,a)):(a.next=t.next,e.pending=t.next=a)}}function QT(n,e){var t=e.action,s=e.payload,i=n.state;if(e.isTransition){var a=ht.T,o={};ht.T=o;try{var l=t(i,s),c=ht.S;c!==null&&c(o,l),j_(n,e,l)}catch(d){a0(n,e,d)}finally{ht.T=a}}else try{a=t(i,s),j_(n,e,a)}catch(d){a0(n,e,d)}}function j_(n,e,t){t!==null&&typeof t=="object"&&typeof t.then=="function"?t.then(function(s){__(n,e,s)},function(s){return a0(n,e,s)}):__(n,e,t)}function __(n,e,t){e.status="fulfilled",e.value=t,WT(e),n.state=t,e=n.pending,e!==null&&(t=e.next,t===e?n.pending=null:(t=t.next,e.next=t,QT(n,t)))}function a0(n,e,t){var s=n.pending;if(n.pending=null,s!==null){s=s.next;do e.status="rejected",e.reason=t,WT(e),e=e.next;while(e!==s)}n.action=null}function WT(n){n=n.listeners;for(var e=0;e<n.length;e++)(0,n[e])()}function KT(n,e){return e}function E_(n,e){if(Ht){var t=bn.formState;if(t!==null){e:{var s=Nt;if(Ht){if(Yn){t:{for(var i=Yn,a=Oi;i.nodeType!==8;){if(!a){i=null;break t}if(i=xi(i.nextSibling),i===null){i=null;break t}}a=i.data,i=a==="F!"||a==="F"?i:null}if(i){Yn=xi(i.nextSibling),s=i.data==="F!";break e}}ac(s)}s=!1}s&&(e=t[0])}}return t=hr(),t.memoizedState=t.baseState=e,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:KT,lastRenderedState:e},t.queue=s,t=u1.bind(null,Nt,s),s.dispatch=t,s=i0(!1),a=sv.bind(null,Nt,!1,s.queue),s=hr(),i={state:e,dispatch:null,action:n,pending:null},s.queue=i,t=nM.bind(null,Nt,i,a,t),i.dispatch=t,s.memoizedState=n,[e,t,!1]}function S_(n){var e=cs();return YT(e,hn,n)}function YT(n,e,t){if(e=Zw(n,e,KT)[0],n=Ap(Ma)[0],typeof e=="object"&&e!==null&&typeof e.then=="function")try{var s=Jm(e)}catch(o){throw o===Xm?yx:o}else s=e;e=cs();var i=e.queue,a=i.dispatch;return t!==e.memoizedState&&(Nt.flags|=2048,Ud(9,wx(),sM.bind(null,i,t),null)),[s,a,n]}function sM(n,e){n.action=e}function I_(n){var e=cs(),t=hn;if(t!==null)return YT(e,t,n);cs(),e=e.memoizedState,t=cs();var s=t.queue.dispatch;return t.memoizedState=n,[e,s,!1]}function Ud(n,e,t,s){return n={tag:n,create:t,deps:s,inst:e,next:null},e=Nt.updateQueue,e===null&&(e=Xw(),Nt.updateQueue=e),t=e.lastEffect,t===null?e.lastEffect=n.next=n:(s=t.next,t.next=n,n.next=s,e.lastEffect=n),n}function wx(){return{destroy:void 0,resource:void 0}}function XT(){return cs().memoizedState}function Dp(n,e,t,s){var i=hr();s=s===void 0?null:s,Nt.flags|=n,i.memoizedState=Ud(1|e,wx(),t,s)}function Zm(n,e,t,s){var i=cs();s=s===void 0?null:s;var a=i.memoizedState.inst;hn!==null&&s!==null&&Gw(s,hn.memoizedState.deps)?i.memoizedState=Ud(e,a,t,s):(Nt.flags|=n,i.memoizedState=Ud(1|e,a,t,s))}function T_(n,e){Dp(8390656,8,n,e)}function JT(n,e){Zm(2048,8,n,e)}function ZT(n,e){return Zm(4,2,n,e)}function e1(n,e){return Zm(4,4,n,e)}function t1(n,e){if(typeof e=="function"){n=n();var t=e(n);return function(){typeof t=="function"?t():e(null)}}if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function n1(n,e,t){t=t!=null?t.concat([n]):null,Zm(4,4,t1.bind(null,e,n),t)}function ev(){}function s1(n,e){var t=cs();e=e===void 0?null:e;var s=t.memoizedState;return e!==null&&Gw(e,s[1])?s[0]:(t.memoizedState=[n,e],n)}function r1(n,e){var t=cs();e=e===void 0?null:e;var s=t.memoizedState;if(e!==null&&Gw(e,s[1]))return s[0];if(s=n(),lc){Co(!0);try{n()}finally{Co(!1)}}return t.memoizedState=[s,e],s}function tv(n,e,t){return t===void 0||Ko&1073741824?n.memoizedState=e:(n.memoizedState=t,n=W1(),Nt.lanes|=n,Xo|=n,t)}function i1(n,e,t,s){return zr(t,e)?t:Fd.current!==null?(n=tv(n,t,s),zr(n,e)||(Cs=!0),n):Ko&42?(n=W1(),Nt.lanes|=n,Xo|=n,e):(Cs=!0,n.memoizedState=t)}function a1(n,e,t,s,i){var a=Qt.p;Qt.p=a!==0&&8>a?a:8;var o=ht.T,l={};ht.T=l,sv(n,!1,e,t);try{var c=i(),d=ht.S;if(d!==null&&d(l,c),c!==null&&typeof c=="object"&&typeof c.then=="function"){var h=ZO(c,s);zh(n,e,h,Fr(n))}else zh(n,e,s,Fr(n))}catch(f){zh(n,e,{then:function(){},status:"rejected",reason:f},Fr())}finally{Qt.p=a,ht.T=o}}function rM(){}function o0(n,e,t,s){if(n.tag!==5)throw Error(Ae(476));var i=o1(n).queue;a1(n,i,e,Kl,t===null?rM:function(){return l1(n),t(s)})}function o1(n){var e=n.memoizedState;if(e!==null)return e;e={memoizedState:Kl,baseState:Kl,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ma,lastRenderedState:Kl},next:null};var t={};return e.next={memoizedState:t,baseState:t,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ma,lastRenderedState:t},next:null},n.memoizedState=e,n=n.alternate,n!==null&&(n.memoizedState=e),e}function l1(n){var e=o1(n).next.queue;zh(n,e,{},Fr())}function nv(){return Qs(bm)}function c1(){return cs().memoizedState}function d1(){return cs().memoizedState}function iM(n){for(var e=n.return;e!==null;){switch(e.tag){case 24:case 3:var t=Fr();n=Mo(t);var s=Lo(e,n,t);s!==null&&(Ur(s,e,t),Fh(s,e,t)),e={cache:$w()},n.payload=e;return}e=e.return}}function aM(n,e,t){var s=Fr();t={lane:s,revertLane:0,action:t,hasEagerState:!1,eagerState:null,next:null},vx(n)?h1(e,t):(t=Fw(n,e,t,s),t!==null&&(Ur(t,n,s),m1(t,e,s)))}function u1(n,e,t){var s=Fr();zh(n,e,t,s)}function zh(n,e,t,s){var i={lane:s,revertLane:0,action:t,hasEagerState:!1,eagerState:null,next:null};if(vx(n))h1(e,i);else{var a=n.alternate;if(n.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var o=e.lastRenderedState,l=a(o,t);if(i.hasEagerState=!0,i.eagerState=l,zr(l,o))return xx(n,e,i,0),bn===null&&gx(),!1}catch{}finally{}if(t=Fw(n,e,i,s),t!==null)return Ur(t,n,s),m1(t,e,s),!0}return!1}function sv(n,e,t,s){if(s={lane:2,revertLane:uv(),action:s,hasEagerState:!1,eagerState:null,next:null},vx(n)){if(e)throw Error(Ae(479))}else e=Fw(n,t,s,2),e!==null&&Ur(e,n,2)}function vx(n){var e=n.alternate;return n===Nt||e!==null&&e===Nt}function h1(n,e){jd=mg=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function m1(n,e,t){if(t&4194048){var s=e.lanes;s&=n.pendingLanes,t|=s,e.lanes=t,sT(n,t)}}var pg={readContext:Qs,use:bx,useCallback:ts,useContext:ts,useEffect:ts,useImperativeHandle:ts,useLayoutEffect:ts,useInsertionEffect:ts,useMemo:ts,useReducer:ts,useRef:ts,useState:ts,useDebugValue:ts,useDeferredValue:ts,useTransition:ts,useSyncExternalStore:ts,useId:ts,useHostTransitionStatus:ts,useFormState:ts,useActionState:ts,useOptimistic:ts,useMemoCache:ts,useCacheRefresh:ts},f1={readContext:Qs,use:bx,useCallback:function(n,e){return hr().memoizedState=[n,e===void 0?null:e],n},useContext:Qs,useEffect:T_,useImperativeHandle:function(n,e,t){t=t!=null?t.concat([n]):null,Dp(4194308,4,t1.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Dp(4194308,4,n,e)},useInsertionEffect:function(n,e){Dp(4,2,n,e)},useMemo:function(n,e){var t=hr();e=e===void 0?null:e;var s=n();if(lc){Co(!0);try{n()}finally{Co(!1)}}return t.memoizedState=[s,e],s},useReducer:function(n,e,t){var s=hr();if(t!==void 0){var i=t(e);if(lc){Co(!0);try{t(e)}finally{Co(!1)}}}else i=e;return s.memoizedState=s.baseState=i,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:i},s.queue=n,n=n.dispatch=aM.bind(null,Nt,n),[s.memoizedState,n]},useRef:function(n){var e=hr();return n={current:n},e.memoizedState=n},useState:function(n){n=i0(n);var e=n.queue,t=u1.bind(null,Nt,e);return e.dispatch=t,[n.memoizedState,t]},useDebugValue:ev,useDeferredValue:function(n,e){var t=hr();return tv(t,n,e)},useTransition:function(){var n=i0(!1);return n=a1.bind(null,Nt,n.queue,!0,!1),hr().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,e,t){var s=Nt,i=hr();if(Ht){if(t===void 0)throw Error(Ae(407));t=t()}else{if(t=e(),bn===null)throw Error(Ae(349));Mt&124||zT(s,e,t)}i.memoizedState=t;var a={value:t,getSnapshot:e};return i.queue=a,T_(BT.bind(null,s,a,n),[n]),s.flags|=2048,Ud(9,wx(),$T.bind(null,s,a,t,e),null),t},useId:function(){var n=hr(),e=bn.identifierPrefix;if(Ht){var t=va,s=wa;t=(s&~(1<<32-Lr(s)-1)).toString(32)+t,e=""+e+"R"+t,t=fg++,0<t&&(e+="H"+t.toString(32)),e+=""}else t=eM++,e=""+e+"r"+t.toString(32)+"";return n.memoizedState=e},useHostTransitionStatus:nv,useFormState:E_,useActionState:E_,useOptimistic:function(n){var e=hr();e.memoizedState=e.baseState=n;var t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return e.queue=t,e=sv.bind(null,Nt,!0,t),t.dispatch=e,[n,e]},useMemoCache:Jw,useCacheRefresh:function(){return hr().memoizedState=iM.bind(null,Nt)}},p1={readContext:Qs,use:bx,useCallback:s1,useContext:Qs,useEffect:JT,useImperativeHandle:n1,useInsertionEffect:ZT,useLayoutEffect:e1,useMemo:r1,useReducer:Ap,useRef:XT,useState:function(){return Ap(Ma)},useDebugValue:ev,useDeferredValue:function(n,e){var t=cs();return i1(t,hn.memoizedState,n,e)},useTransition:function(){var n=Ap(Ma)[0],e=cs().memoizedState;return[typeof n=="boolean"?n:Jm(n),e]},useSyncExternalStore:VT,useId:c1,useHostTransitionStatus:nv,useFormState:S_,useActionState:S_,useOptimistic:function(n,e){var t=cs();return GT(t,hn,n,e)},useMemoCache:Jw,useCacheRefresh:d1},oM={readContext:Qs,use:bx,useCallback:s1,useContext:Qs,useEffect:JT,useImperativeHandle:n1,useInsertionEffect:ZT,useLayoutEffect:e1,useMemo:r1,useReducer:By,useRef:XT,useState:function(){return By(Ma)},useDebugValue:ev,useDeferredValue:function(n,e){var t=cs();return hn===null?tv(t,n,e):i1(t,hn.memoizedState,n,e)},useTransition:function(){var n=By(Ma)[0],e=cs().memoizedState;return[typeof n=="boolean"?n:Jm(n),e]},useSyncExternalStore:VT,useId:c1,useHostTransitionStatus:nv,useFormState:I_,useActionState:I_,useOptimistic:function(n,e){var t=cs();return hn!==null?GT(t,hn,n,e):(t.baseState=n,[n,t.queue.dispatch])},useMemoCache:Jw,useCacheRefresh:d1},Ed=null,pm=0;function ap(n){var e=pm;return pm+=1,Ed===null&&(Ed=[]),OT(Ed,n,e)}function dh(n,e){e=e.props.ref,n.ref=e!==void 0?e:null}function op(n,e){throw e.$$typeof===Lk?Error(Ae(525)):(n=Object.prototype.toString.call(e),Error(Ae(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n)))}function C_(n){var e=n._init;return e(n._payload)}function g1(n){function e(g,N){if(n){var j=g.deletions;j===null?(g.deletions=[N],g.flags|=16):j.push(N)}}function t(g,N){if(!n)return null;for(;N!==null;)e(g,N),N=N.sibling;return null}function s(g){for(var N=new Map;g!==null;)g.key!==null?N.set(g.key,g):N.set(g.index,g),g=g.sibling;return N}function i(g,N){return g=Aa(g,N),g.index=0,g.sibling=null,g}function a(g,N,j){return g.index=j,n?(j=g.alternate,j!==null?(j=j.index,j<N?(g.flags|=67108866,N):j):(g.flags|=67108866,N)):(g.flags|=1048576,N)}function o(g){return n&&g.alternate===null&&(g.flags|=67108866),g}function l(g,N,j,V){return N===null||N.tag!==6?(N=Vy(j,g.mode,V),N.return=g,N):(N=i(N,j),N.return=g,N)}function c(g,N,j,V){var $=j.type;return $===id?h(g,N,j.props.children,V,j.key):N!==null&&(N.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===go&&C_($)===N.type)?(N=i(N,j.props),dh(N,j),N.return=g,N):(N=Tp(j.type,j.key,j.props,null,g.mode,V),dh(N,j),N.return=g,N)}function d(g,N,j,V){return N===null||N.tag!==4||N.stateNode.containerInfo!==j.containerInfo||N.stateNode.implementation!==j.implementation?(N=zy(j,g.mode,V),N.return=g,N):(N=i(N,j.children||[]),N.return=g,N)}function h(g,N,j,V,$){return N===null||N.tag!==7?(N=Yl(j,g.mode,V,$),N.return=g,N):(N=i(N,j),N.return=g,N)}function f(g,N,j){if(typeof N=="string"&&N!==""||typeof N=="number"||typeof N=="bigint")return N=Vy(""+N,g.mode,j),N.return=g,N;if(typeof N=="object"&&N!==null){switch(N.$$typeof){case Zf:return j=Tp(N.type,N.key,N.props,null,g.mode,j),dh(j,N),j.return=g,j;case vh:return N=zy(N,g.mode,j),N.return=g,N;case go:var V=N._init;return N=V(N._payload),f(g,N,j)}if(Nh(N)||ah(N))return N=Yl(N,g.mode,j,null),N.return=g,N;if(typeof N.then=="function")return f(g,ap(N),j);if(N.$$typeof===ba)return f(g,rp(g,N),j);op(g,N)}return null}function p(g,N,j,V){var $=N!==null?N.key:null;if(typeof j=="string"&&j!==""||typeof j=="number"||typeof j=="bigint")return $!==null?null:l(g,N,""+j,V);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case Zf:return j.key===$?c(g,N,j,V):null;case vh:return j.key===$?d(g,N,j,V):null;case go:return $=j._init,j=$(j._payload),p(g,N,j,V)}if(Nh(j)||ah(j))return $!==null?null:h(g,N,j,V,null);if(typeof j.then=="function")return p(g,N,ap(j),V);if(j.$$typeof===ba)return p(g,N,rp(g,j),V);op(g,j)}return null}function x(g,N,j,V,$){if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return g=g.get(j)||null,l(N,g,""+V,$);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case Zf:return g=g.get(V.key===null?j:V.key)||null,c(N,g,V,$);case vh:return g=g.get(V.key===null?j:V.key)||null,d(N,g,V,$);case go:var Z=V._init;return V=Z(V._payload),x(g,N,j,V,$)}if(Nh(V)||ah(V))return g=g.get(j)||null,h(N,g,V,$,null);if(typeof V.then=="function")return x(g,N,j,ap(V),$);if(V.$$typeof===ba)return x(g,N,j,rp(N,V),$);op(N,V)}return null}function I(g,N,j,V){for(var $=null,Z=null,O=N,M=N=0,T=null;O!==null&&M<j.length;M++){O.index>M?(T=O,O=null):T=O.sibling;var L=p(g,O,j[M],V);if(L===null){O===null&&(O=T);break}n&&O&&L.alternate===null&&e(g,O),N=a(L,N,M),Z===null?$=L:Z.sibling=L,Z=L,O=T}if(M===j.length)return t(g,O),Ht&&Fl(g,M),$;if(O===null){for(;M<j.length;M++)O=f(g,j[M],V),O!==null&&(N=a(O,N,M),Z===null?$=O:Z.sibling=O,Z=O);return Ht&&Fl(g,M),$}for(O=s(O);M<j.length;M++)T=x(O,g,M,j[M],V),T!==null&&(n&&T.alternate!==null&&O.delete(T.key===null?M:T.key),N=a(T,N,M),Z===null?$=T:Z.sibling=T,Z=T);return n&&O.forEach(function(G){return e(g,G)}),Ht&&Fl(g,M),$}function D(g,N,j,V){if(j==null)throw Error(Ae(151));for(var $=null,Z=null,O=N,M=N=0,T=null,L=j.next();O!==null&&!L.done;M++,L=j.next()){O.index>M?(T=O,O=null):T=O.sibling;var G=p(g,O,L.value,V);if(G===null){O===null&&(O=T);break}n&&O&&G.alternate===null&&e(g,O),N=a(G,N,M),Z===null?$=G:Z.sibling=G,Z=G,O=T}if(L.done)return t(g,O),Ht&&Fl(g,M),$;if(O===null){for(;!L.done;M++,L=j.next())L=f(g,L.value,V),L!==null&&(N=a(L,N,M),Z===null?$=L:Z.sibling=L,Z=L);return Ht&&Fl(g,M),$}for(O=s(O);!L.done;M++,L=j.next())L=x(O,g,M,L.value,V),L!==null&&(n&&L.alternate!==null&&O.delete(L.key===null?M:L.key),N=a(L,N,M),Z===null?$=L:Z.sibling=L,Z=L);return n&&O.forEach(function(U){return e(g,U)}),Ht&&Fl(g,M),$}function A(g,N,j,V){if(typeof j=="object"&&j!==null&&j.type===id&&j.key===null&&(j=j.props.children),typeof j=="object"&&j!==null){switch(j.$$typeof){case Zf:e:{for(var $=j.key;N!==null;){if(N.key===$){if($=j.type,$===id){if(N.tag===7){t(g,N.sibling),V=i(N,j.props.children),V.return=g,g=V;break e}}else if(N.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===go&&C_($)===N.type){t(g,N.sibling),V=i(N,j.props),dh(V,j),V.return=g,g=V;break e}t(g,N);break}else e(g,N);N=N.sibling}j.type===id?(V=Yl(j.props.children,g.mode,V,j.key),V.return=g,g=V):(V=Tp(j.type,j.key,j.props,null,g.mode,V),dh(V,j),V.return=g,g=V)}return o(g);case vh:e:{for($=j.key;N!==null;){if(N.key===$)if(N.tag===4&&N.stateNode.containerInfo===j.containerInfo&&N.stateNode.implementation===j.implementation){t(g,N.sibling),V=i(N,j.children||[]),V.return=g,g=V;break e}else{t(g,N);break}else e(g,N);N=N.sibling}V=zy(j,g.mode,V),V.return=g,g=V}return o(g);case go:return $=j._init,j=$(j._payload),A(g,N,j,V)}if(Nh(j))return I(g,N,j,V);if(ah(j)){if($=ah(j),typeof $!="function")throw Error(Ae(150));return j=$.call(j),D(g,N,j,V)}if(typeof j.then=="function")return A(g,N,ap(j),V);if(j.$$typeof===ba)return A(g,N,rp(g,j),V);op(g,j)}return typeof j=="string"&&j!==""||typeof j=="number"||typeof j=="bigint"?(j=""+j,N!==null&&N.tag===6?(t(g,N.sibling),V=i(N,j),V.return=g,g=V):(t(g,N),V=Vy(j,g.mode,V),V.return=g,g=V),o(g)):t(g,N)}return function(g,N,j,V){try{pm=0;var $=A(g,N,j,V);return Ed=null,$}catch(O){if(O===Xm||O===yx)throw O;var Z=Rr(29,O,null,g.mode);return Z.lanes=V,Z.return=g,Z}finally{}}}var Vd=g1(!0),x1=g1(!1),ai=Ji(null),$i=null;function wo(n){var e=n.alternate;kn(ms,ms.current&1),kn(ai,n),$i===null&&(e===null||Fd.current!==null||e.memoizedState!==null)&&($i=n)}function y1(n){if(n.tag===22){if(kn(ms,ms.current),kn(ai,n),$i===null){var e=n.alternate;e!==null&&e.memoizedState!==null&&($i=n)}}else vo()}function vo(){kn(ms,ms.current),kn(ai,ai.current)}function ja(n){As(ai),$i===n&&($i=null),As(ms)}var ms=Ji(0);function gg(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||_0(t)))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}function qy(n,e,t,s){e=n.memoizedState,t=t(s,e),t=t==null?e:Sn({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var l0={enqueueSetState:function(n,e,t){n=n._reactInternals;var s=Fr(),i=Mo(s);i.payload=e,t!=null&&(i.callback=t),e=Lo(n,i,s),e!==null&&(Ur(e,n,s),Fh(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var s=Fr(),i=Mo(s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Lo(n,i,s),e!==null&&(Ur(e,n,s),Fh(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Fr(),s=Mo(t);s.tag=2,e!=null&&(s.callback=e),e=Lo(n,s,t),e!==null&&(Ur(e,n,t),Fh(e,n,t))}};function A_(n,e,t,s,i,a,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(s,a,o):e.prototype&&e.prototype.isPureReactComponent?!hm(t,s)||!hm(i,a):!0}function D_(n,e,t,s){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,s),e.state!==n&&l0.enqueueReplaceState(e,e.state,null)}function cc(n,e){var t=e;if("ref"in e){t={};for(var s in e)s!=="ref"&&(t[s]=e[s])}if(n=n.defaultProps){t===e&&(t=Sn({},t));for(var i in n)t[i]===void 0&&(t[i]=n[i])}return t}var xg=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)};function b1(n){xg(n)}function w1(n){console.error(n)}function v1(n){xg(n)}function yg(n,e){try{var t=n.onUncaughtError;t(e.value,{componentStack:e.stack})}catch(s){setTimeout(function(){throw s})}}function R_(n,e,t){try{var s=n.onCaughtError;s(t.value,{componentStack:t.stack,errorBoundary:e.tag===1?e.stateNode:null})}catch(i){setTimeout(function(){throw i})}}function c0(n,e,t){return t=Mo(t),t.tag=3,t.payload={element:null},t.callback=function(){yg(n,e)},t}function N1(n){return n=Mo(n),n.tag=3,n}function j1(n,e,t,s){var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var a=s.value;n.payload=function(){return i(a)},n.callback=function(){R_(e,t,s)}}var o=t.stateNode;o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){R_(e,t,s),typeof i!="function"&&(Fo===null?Fo=new Set([this]):Fo.add(this));var l=s.stack;this.componentDidCatch(s.value,{componentStack:l!==null?l:""})})}function lM(n,e,t,s,i){if(t.flags|=32768,s!==null&&typeof s=="object"&&typeof s.then=="function"){if(e=t.alternate,e!==null&&Km(e,t,i,!0),t=ai.current,t!==null){switch(t.tag){case 13:return $i===null?x0():t.alternate===null&&Xn===0&&(Xn=3),t.flags&=-257,t.flags|=65536,t.lanes=i,s===t0?t.flags|=16384:(e=t.updateQueue,e===null?t.updateQueue=new Set([s]):e.add(s),tb(n,s,i)),!1;case 22:return t.flags|=65536,s===t0?t.flags|=16384:(e=t.updateQueue,e===null?(e={transitions:null,markerInstances:null,retryQueue:new Set([s])},t.updateQueue=e):(t=e.retryQueue,t===null?e.retryQueue=new Set([s]):t.add(s)),tb(n,s,i)),!1}throw Error(Ae(435,t.tag))}return tb(n,s,i),x0(),!1}if(Ht)return e=ai.current,e!==null?(!(e.flags&65536)&&(e.flags|=256),e.flags|=65536,e.lanes=i,s!==Yb&&(n=Error(Ae(422),{cause:s}),mm(ti(n,t)))):(s!==Yb&&(e=Error(Ae(423),{cause:s}),mm(ti(e,t))),n=n.current.alternate,n.flags|=65536,i&=-i,n.lanes|=i,s=ti(s,t),i=c0(n.stateNode,s,i),$y(n,i),Xn!==4&&(Xn=2)),!1;var a=Error(Ae(520),{cause:s});if(a=ti(a,t),qh===null?qh=[a]:qh.push(a),Xn!==4&&(Xn=2),e===null)return!0;s=ti(s,t),t=e;do{switch(t.tag){case 3:return t.flags|=65536,n=i&-i,t.lanes|=n,n=c0(t.stateNode,s,n),$y(t,n),!1;case 1:if(e=t.type,a=t.stateNode,(t.flags&128)===0&&(typeof e.getDerivedStateFromError=="function"||a!==null&&typeof a.componentDidCatch=="function"&&(Fo===null||!Fo.has(a))))return t.flags|=65536,i&=-i,t.lanes|=i,i=N1(i),j1(i,n,t,s),$y(t,i),!1}t=t.return}while(t!==null);return!1}var _1=Error(Ae(461)),Cs=!1;function Ps(n,e,t,s){e.child=n===null?x1(e,null,t,s):Vd(e,n.child,t,s)}function P_(n,e,t,s,i){t=t.render;var a=e.ref;if("ref"in s){var o={};for(var l in s)l!=="ref"&&(o[l]=s[l])}else o=s;return oc(e),s=Qw(n,e,t,o,a,i),l=Ww(),n!==null&&!Cs?(Kw(n,e,i),La(n,e,i)):(Ht&&l&&Vw(e),e.flags|=1,Ps(n,e,s,i),e.child)}function k_(n,e,t,s,i){if(n===null){var a=t.type;return typeof a=="function"&&!Uw(a)&&a.defaultProps===void 0&&t.compare===null?(e.tag=15,e.type=a,E1(n,e,a,s,i)):(n=Tp(t.type,null,s,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(a=n.child,!rv(n,i)){var o=a.memoizedProps;if(t=t.compare,t=t!==null?t:hm,t(o,s)&&n.ref===e.ref)return La(n,e,i)}return e.flags|=1,n=Aa(a,s),n.ref=e.ref,n.return=e,e.child=n}function E1(n,e,t,s,i){if(n!==null){var a=n.memoizedProps;if(hm(a,s)&&n.ref===e.ref)if(Cs=!1,e.pendingProps=s=a,rv(n,i))n.flags&131072&&(Cs=!0);else return e.lanes=n.lanes,La(n,e,i)}return d0(n,e,t,s,i)}function S1(n,e,t){var s=e.pendingProps,i=s.children,a=n!==null?n.memoizedState:null;if(s.mode==="hidden"){if(e.flags&128){if(s=a!==null?a.baseLanes|t:t,n!==null){for(i=e.child=n.child,a=0;i!==null;)a=a|i.lanes|i.childLanes,i=i.sibling;e.childLanes=a&~s}else e.childLanes=0,e.child=null;return O_(n,e,s,t)}if(t&536870912)e.memoizedState={baseLanes:0,cachePool:null},n!==null&&Cp(e,a!==null?a.cachePool:null),a!==null?N_(e,a):r0(),y1(e);else return e.lanes=e.childLanes=536870912,O_(n,e,a!==null?a.baseLanes|t:t,t)}else a!==null?(Cp(e,a.cachePool),N_(e,a),vo(),e.memoizedState=null):(n!==null&&Cp(e,null),r0(),vo());return Ps(n,e,i,t),e.child}function O_(n,e,t,s){var i=Bw();return i=i===null?null:{parent:hs._currentValue,pool:i},e.memoizedState={baseLanes:t,cachePool:i},n!==null&&Cp(e,null),r0(),y1(e),n!==null&&Km(n,e,s,!0),null}function Rp(n,e){var t=e.ref;if(t===null)n!==null&&n.ref!==null&&(e.flags|=4194816);else{if(typeof t!="function"&&typeof t!="object")throw Error(Ae(284));(n===null||n.ref!==t)&&(e.flags|=4194816)}}function d0(n,e,t,s,i){return oc(e),t=Qw(n,e,t,s,void 0,i),s=Ww(),n!==null&&!Cs?(Kw(n,e,i),La(n,e,i)):(Ht&&s&&Vw(e),e.flags|=1,Ps(n,e,t,i),e.child)}function M_(n,e,t,s,i,a){return oc(e),e.updateQueue=null,t=UT(e,s,t,i),FT(n),s=Ww(),n!==null&&!Cs?(Kw(n,e,a),La(n,e,a)):(Ht&&s&&Vw(e),e.flags|=1,Ps(n,e,t,a),e.child)}function L_(n,e,t,s,i){if(oc(e),e.stateNode===null){var a=md,o=t.contextType;typeof o=="object"&&o!==null&&(a=Qs(o)),a=new t(s,a),e.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=l0,e.stateNode=a,a._reactInternals=e,a=e.stateNode,a.props=s,a.state=e.memoizedState,a.refs={},qw(e),o=t.contextType,a.context=typeof o=="object"&&o!==null?Qs(o):md,a.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(qy(e,t,o,s),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(o=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),o!==a.state&&l0.enqueueReplaceState(a,a.state,null),Vh(e,s,a,i),Uh(),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308),s=!0}else if(n===null){a=e.stateNode;var l=e.memoizedProps,c=cc(t,l);a.props=c;var d=a.context,h=t.contextType;o=md,typeof h=="object"&&h!==null&&(o=Qs(h));var f=t.getDerivedStateFromProps;h=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function",l=e.pendingProps!==l,h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l||d!==o)&&D_(e,a,s,o),xo=!1;var p=e.memoizedState;a.state=p,Vh(e,s,a,i),Uh(),d=e.memoizedState,l||p!==d||xo?(typeof f=="function"&&(qy(e,t,f,s),d=e.memoizedState),(c=xo||A_(e,t,c,s,p,d,o))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=d),a.props=s,a.state=d,a.context=o,s=c):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{a=e.stateNode,n0(n,e),o=e.memoizedProps,h=cc(t,o),a.props=h,f=e.pendingProps,p=a.context,d=t.contextType,c=md,typeof d=="object"&&d!==null&&(c=Qs(d)),l=t.getDerivedStateFromProps,(d=typeof l=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==f||p!==c)&&D_(e,a,s,c),xo=!1,p=e.memoizedState,a.state=p,Vh(e,s,a,i),Uh();var x=e.memoizedState;o!==f||p!==x||xo||n!==null&&n.dependencies!==null&&ug(n.dependencies)?(typeof l=="function"&&(qy(e,t,l,s),x=e.memoizedState),(h=xo||A_(e,t,h,s,p,x,c)||n!==null&&n.dependencies!==null&&ug(n.dependencies))?(d||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(s,x,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(s,x,c)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=x),a.props=s,a.state=x,a.context=c,s=h):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),s=!1)}return a=s,Rp(n,e),s=(e.flags&128)!==0,a||s?(a=e.stateNode,t=s&&typeof t.getDerivedStateFromError!="function"?null:a.render(),e.flags|=1,n!==null&&s?(e.child=Vd(e,n.child,null,i),e.child=Vd(e,null,t,i)):Ps(n,e,t,i),e.memoizedState=a.state,n=e.child):n=La(n,e,i),n}function F_(n,e,t,s){return Wm(),e.flags|=256,Ps(n,e,t,s),e.child}var Hy={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Gy(n){return{baseLanes:n,cachePool:PT()}}function Qy(n,e,t){return n=n!==null?n.childLanes&~t:0,e&&(n|=ni),n}function I1(n,e,t){var s=e.pendingProps,i=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=n!==null&&n.memoizedState===null?!1:(ms.current&2)!==0),o&&(i=!0,e.flags&=-129),o=(e.flags&32)!==0,e.flags&=-33,n===null){if(Ht){if(i?wo(e):vo(),Ht){var l=Yn,c;if(c=l){e:{for(c=l,l=Oi;c.nodeType!==8;){if(!l){l=null;break e}if(c=xi(c.nextSibling),c===null){l=null;break e}}l=c}l!==null?(e.memoizedState={dehydrated:l,treeContext:Xl!==null?{id:wa,overflow:va}:null,retryLane:536870912,hydrationErrors:null},c=Rr(18,null,null,0),c.stateNode=l,c.return=e,e.child=c,ar=e,Yn=null,c=!0):c=!1}c||ac(e)}if(l=e.memoizedState,l!==null&&(l=l.dehydrated,l!==null))return _0(l)?e.lanes=32:e.lanes=536870912,null;ja(e)}return l=s.children,s=s.fallback,i?(vo(),i=e.mode,l=bg({mode:"hidden",children:l},i),s=Yl(s,i,t,null),l.return=e,s.return=e,l.sibling=s,e.child=l,i=e.child,i.memoizedState=Gy(t),i.childLanes=Qy(n,o,t),e.memoizedState=Hy,s):(wo(e),u0(e,l))}if(c=n.memoizedState,c!==null&&(l=c.dehydrated,l!==null)){if(a)e.flags&256?(wo(e),e.flags&=-257,e=Wy(n,e,t)):e.memoizedState!==null?(vo(),e.child=n.child,e.flags|=128,e=null):(vo(),i=s.fallback,l=e.mode,s=bg({mode:"visible",children:s.children},l),i=Yl(i,l,t,null),i.flags|=2,s.return=e,i.return=e,s.sibling=i,e.child=s,Vd(e,n.child,null,t),s=e.child,s.memoizedState=Gy(t),s.childLanes=Qy(n,o,t),e.memoizedState=Hy,e=i);else if(wo(e),_0(l)){if(o=l.nextSibling&&l.nextSibling.dataset,o)var d=o.dgst;o=d,s=Error(Ae(419)),s.stack="",s.digest=o,mm({value:s,source:null,stack:null}),e=Wy(n,e,t)}else if(Cs||Km(n,e,t,!1),o=(t&n.childLanes)!==0,Cs||o){if(o=bn,o!==null&&(s=t&-t,s=s&42?1:Tw(s),s=s&(o.suspendedLanes|t)?0:s,s!==0&&s!==c.retryLane))throw c.retryLane=s,gu(n,s),Ur(o,n,s),_1;l.data==="$?"||x0(),e=Wy(n,e,t)}else l.data==="$?"?(e.flags|=192,e.child=n.child,e=null):(n=c.treeContext,Yn=xi(l.nextSibling),ar=e,Ht=!0,Jl=null,Oi=!1,n!==null&&(Jr[Zr++]=wa,Jr[Zr++]=va,Jr[Zr++]=Xl,wa=n.id,va=n.overflow,Xl=e),e=u0(e,s.children),e.flags|=4096);return e}return i?(vo(),i=s.fallback,l=e.mode,c=n.child,d=c.sibling,s=Aa(c,{mode:"hidden",children:s.children}),s.subtreeFlags=c.subtreeFlags&65011712,d!==null?i=Aa(d,i):(i=Yl(i,l,t,null),i.flags|=2),i.return=e,s.return=e,s.sibling=i,e.child=s,s=i,i=e.child,l=n.child.memoizedState,l===null?l=Gy(t):(c=l.cachePool,c!==null?(d=hs._currentValue,c=c.parent!==d?{parent:d,pool:d}:c):c=PT(),l={baseLanes:l.baseLanes|t,cachePool:c}),i.memoizedState=l,i.childLanes=Qy(n,o,t),e.memoizedState=Hy,s):(wo(e),t=n.child,n=t.sibling,t=Aa(t,{mode:"visible",children:s.children}),t.return=e,t.sibling=null,n!==null&&(o=e.deletions,o===null?(e.deletions=[n],e.flags|=16):o.push(n)),e.child=t,e.memoizedState=null,t)}function u0(n,e){return e=bg({mode:"visible",children:e},n.mode),e.return=n,n.child=e}function bg(n,e){return n=Rr(22,n,null,e),n.lanes=0,n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},n}function Wy(n,e,t){return Vd(e,n.child,null,t),n=u0(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function U_(n,e,t){n.lanes|=e;var s=n.alternate;s!==null&&(s.lanes|=e),Jb(n.return,e,t)}function Ky(n,e,t,s,i){var a=n.memoizedState;a===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:t,tailMode:i}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=s,a.tail=t,a.tailMode=i)}function T1(n,e,t){var s=e.pendingProps,i=s.revealOrder,a=s.tail;if(Ps(n,e,s.children,t),s=ms.current,s&2)s=s&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&U_(n,t,e);else if(n.tag===19)U_(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}s&=1}switch(kn(ms,s),i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&gg(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),Ky(e,!1,i,t,a);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&gg(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}Ky(e,!0,t,null,a);break;case"together":Ky(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function La(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Xo|=e.lanes,!(t&e.childLanes))if(n!==null){if(Km(n,e,t,!1),(t&e.childLanes)===0)return null}else return null;if(n!==null&&e.child!==n.child)throw Error(Ae(153));if(e.child!==null){for(n=e.child,t=Aa(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Aa(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function rv(n,e){return n.lanes&e?!0:(n=n.dependencies,!!(n!==null&&ug(n)))}function cM(n,e,t){switch(e.tag){case 3:sg(e,e.stateNode.containerInfo),bo(e,hs,n.memoizedState.cache),Wm();break;case 27:case 5:Vb(e);break;case 4:sg(e,e.stateNode.containerInfo);break;case 10:bo(e,e.type,e.memoizedProps.value);break;case 13:var s=e.memoizedState;if(s!==null)return s.dehydrated!==null?(wo(e),e.flags|=128,null):t&e.child.childLanes?I1(n,e,t):(wo(e),n=La(n,e,t),n!==null?n.sibling:null);wo(e);break;case 19:var i=(n.flags&128)!==0;if(s=(t&e.childLanes)!==0,s||(Km(n,e,t,!1),s=(t&e.childLanes)!==0),i){if(s)return T1(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),kn(ms,ms.current),s)break;return null;case 22:case 23:return e.lanes=0,S1(n,e,t);case 24:bo(e,hs,n.memoizedState.cache)}return La(n,e,t)}function C1(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps)Cs=!0;else{if(!rv(n,t)&&!(e.flags&128))return Cs=!1,cM(n,e,t);Cs=!!(n.flags&131072)}else Cs=!1,Ht&&e.flags&1048576&&DT(e,dg,e.index);switch(e.lanes=0,e.tag){case 16:e:{n=e.pendingProps;var s=e.elementType,i=s._init;if(s=i(s._payload),e.type=s,typeof s=="function")Uw(s)?(n=cc(s,n),e.tag=1,e=L_(null,e,s,n,t)):(e.tag=0,e=d0(null,e,s,n,t));else{if(s!=null){if(i=s.$$typeof,i===Ew){e.tag=11,e=P_(null,e,s,n,t);break e}else if(i===Sw){e.tag=14,e=k_(null,e,s,n,t);break e}}throw e=Fb(s)||s,Error(Ae(306,e,""))}}return e;case 0:return d0(n,e,e.type,e.pendingProps,t);case 1:return s=e.type,i=cc(s,e.pendingProps),L_(n,e,s,i,t);case 3:e:{if(sg(e,e.stateNode.containerInfo),n===null)throw Error(Ae(387));s=e.pendingProps;var a=e.memoizedState;i=a.element,n0(n,e),Vh(e,s,null,t);var o=e.memoizedState;if(s=o.cache,bo(e,hs,s),s!==a.cache&&Zb(e,[hs],t,!0),Uh(),s=o.element,a.isDehydrated)if(a={element:s,isDehydrated:!1,cache:o.cache},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){e=F_(n,e,s,t);break e}else if(s!==i){i=ti(Error(Ae(424)),e),mm(i),e=F_(n,e,s,t);break e}else{switch(n=e.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for(Yn=xi(n.firstChild),ar=e,Ht=!0,Jl=null,Oi=!0,t=x1(e,null,s,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling}else{if(Wm(),s===i){e=La(n,e,t);break e}Ps(n,e,s,t)}e=e.child}return e;case 26:return Rp(n,e),n===null?(t=nE(e.type,null,e.pendingProps,null))?e.memoizedState=t:Ht||(t=e.type,n=e.pendingProps,s=Sg(Oo.current).createElement(t),s[Gs]=e,s[vr]=n,Vs(s,t,n),Ts(s),e.stateNode=s):e.memoizedState=nE(e.type,n.memoizedProps,e.pendingProps,n.memoizedState),null;case 27:return Vb(e),n===null&&Ht&&(s=e.stateNode=pC(e.type,e.pendingProps,Oo.current),ar=e,Oi=!0,i=Yn,il(e.type)?(E0=i,Yn=xi(s.firstChild)):Yn=i),Ps(n,e,e.pendingProps.children,t),Rp(n,e),n===null&&(e.flags|=4194304),e.child;case 5:return n===null&&Ht&&((i=s=Yn)&&(s=LM(s,e.type,e.pendingProps,Oi),s!==null?(e.stateNode=s,ar=e,Yn=xi(s.firstChild),Oi=!1,i=!0):i=!1),i||ac(e)),Vb(e),i=e.type,a=e.pendingProps,o=n!==null?n.memoizedProps:null,s=a.children,N0(i,a)?s=null:o!==null&&N0(i,o)&&(e.flags|=32),e.memoizedState!==null&&(i=Qw(n,e,tM,null,null,t),bm._currentValue=i),Rp(n,e),Ps(n,e,s,t),e.child;case 6:return n===null&&Ht&&((n=t=Yn)&&(t=FM(t,e.pendingProps,Oi),t!==null?(e.stateNode=t,ar=e,Yn=null,n=!0):n=!1),n||ac(e)),null;case 13:return I1(n,e,t);case 4:return sg(e,e.stateNode.containerInfo),s=e.pendingProps,n===null?e.child=Vd(e,null,s,t):Ps(n,e,s,t),e.child;case 11:return P_(n,e,e.type,e.pendingProps,t);case 7:return Ps(n,e,e.pendingProps,t),e.child;case 8:return Ps(n,e,e.pendingProps.children,t),e.child;case 12:return Ps(n,e,e.pendingProps.children,t),e.child;case 10:return s=e.pendingProps,bo(e,e.type,s.value),Ps(n,e,s.children,t),e.child;case 9:return i=e.type._context,s=e.pendingProps.children,oc(e),i=Qs(i),s=s(i),e.flags|=1,Ps(n,e,s,t),e.child;case 14:return k_(n,e,e.type,e.pendingProps,t);case 15:return E1(n,e,e.type,e.pendingProps,t);case 19:return T1(n,e,t);case 31:return s=e.pendingProps,t=e.mode,s={mode:s.mode,children:s.children},n===null?(t=bg(s,t),t.ref=e.ref,e.child=t,t.return=e,e=t):(t=Aa(n.child,s),t.ref=e.ref,e.child=t,t.return=e,e=t),e;case 22:return S1(n,e,t);case 24:return oc(e),s=Qs(hs),n===null?(i=Bw(),i===null&&(i=bn,a=$w(),i.pooledCache=a,a.refCount++,a!==null&&(i.pooledCacheLanes|=t),i=a),e.memoizedState={parent:s,cache:i},qw(e),bo(e,hs,i)):(n.lanes&t&&(n0(n,e),Vh(e,null,null,t),Uh()),i=n.memoizedState,a=e.memoizedState,i.parent!==s?(i={parent:s,cache:s},e.memoizedState=i,e.lanes===0&&(e.memoizedState=e.updateQueue.baseState=i),bo(e,hs,s)):(s=a.cache,bo(e,hs,s),s!==i.cache&&Zb(e,[hs],t,!0))),Ps(n,e,e.pendingProps.children,t),e.child;case 29:throw e.pendingProps}throw Error(Ae(156,e.tag))}function ma(n){n.flags|=4}function V_(n,e){if(e.type!=="stylesheet"||e.state.loading&4)n.flags&=-16777217;else if(n.flags|=16777216,!yC(e)){if(e=ai.current,e!==null&&((Mt&4194048)===Mt?$i!==null:(Mt&62914560)!==Mt&&!(Mt&536870912)||e!==$i))throw Lh=t0,kT;n.flags|=8192}}function lp(n,e){e!==null&&(n.flags|=4),n.flags&16384&&(e=n.tag!==22?tT():536870912,n.lanes|=e,zd|=e)}function uh(n,e){if(!Ht)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:s.sibling=null}}function Ln(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,s=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,s|=i.subtreeFlags&65011712,s|=i.flags&65011712,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,s|=i.subtreeFlags,s|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=s,n.childLanes=t,e}function dM(n,e,t){var s=e.pendingProps;switch(zw(e),e.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ln(e),null;case 1:return Ln(e),null;case 3:return t=e.stateNode,s=null,n!==null&&(s=n.memoizedState.cache),e.memoizedState.cache!==s&&(e.flags|=2048),Da(hs),kd(),t.pendingContext&&(t.context=t.pendingContext,t.pendingContext=null),(n===null||n.child===null)&&(ch(e)?ma(e):n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,g_())),Ln(e),null;case 26:return t=e.memoizedState,n===null?(ma(e),t!==null?(Ln(e),V_(e,t)):(Ln(e),e.flags&=-16777217)):t?t!==n.memoizedState?(ma(e),Ln(e),V_(e,t)):(Ln(e),e.flags&=-16777217):(n.memoizedProps!==s&&ma(e),Ln(e),e.flags&=-16777217),null;case 27:rg(e),t=Oo.current;var i=e.type;if(n!==null&&e.stateNode!=null)n.memoizedProps!==s&&ma(e);else{if(!s){if(e.stateNode===null)throw Error(Ae(166));return Ln(e),null}n=Vi.current,ch(e)?f_(e):(n=pC(i,s,t),e.stateNode=n,ma(e))}return Ln(e),null;case 5:if(rg(e),t=e.type,n!==null&&e.stateNode!=null)n.memoizedProps!==s&&ma(e);else{if(!s){if(e.stateNode===null)throw Error(Ae(166));return Ln(e),null}if(n=Vi.current,ch(e))f_(e);else{switch(i=Sg(Oo.current),n){case 1:n=i.createElementNS("http://www.w3.org/2000/svg",t);break;case 2:n=i.createElementNS("http://www.w3.org/1998/Math/MathML",t);break;default:switch(t){case"svg":n=i.createElementNS("http://www.w3.org/2000/svg",t);break;case"math":n=i.createElementNS("http://www.w3.org/1998/Math/MathML",t);break;case"script":n=i.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild);break;case"select":n=typeof s.is=="string"?i.createElement("select",{is:s.is}):i.createElement("select"),s.multiple?n.multiple=!0:s.size&&(n.size=s.size);break;default:n=typeof s.is=="string"?i.createElement(t,{is:s.is}):i.createElement(t)}}n[Gs]=e,n[vr]=s;e:for(i=e.child;i!==null;){if(i.tag===5||i.tag===6)n.appendChild(i.stateNode);else if(i.tag!==4&&i.tag!==27&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break e;for(;i.sibling===null;){if(i.return===null||i.return===e)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}e.stateNode=n;e:switch(Vs(n,t,s),t){case"button":case"input":case"select":case"textarea":n=!!s.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&ma(e)}}return Ln(e),e.flags&=-16777217,null;case 6:if(n&&e.stateNode!=null)n.memoizedProps!==s&&ma(e);else{if(typeof s!="string"&&e.stateNode===null)throw Error(Ae(166));if(n=Oo.current,ch(e)){if(n=e.stateNode,t=e.memoizedProps,s=null,i=ar,i!==null)switch(i.tag){case 27:case 5:s=i.memoizedProps}n[Gs]=e,n=!!(n.nodeValue===t||s!==null&&s.suppressHydrationWarning===!0||hC(n.nodeValue,t)),n||ac(e)}else n=Sg(n).createTextNode(s),n[Gs]=e,e.stateNode=n}return Ln(e),null;case 13:if(s=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(i=ch(e),s!==null&&s.dehydrated!==null){if(n===null){if(!i)throw Error(Ae(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Ae(317));i[Gs]=e}else Wm(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ln(e),i=!1}else i=g_(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=i),i=!0;if(!i)return e.flags&256?(ja(e),e):(ja(e),null)}if(ja(e),e.flags&128)return e.lanes=t,e;if(t=s!==null,n=n!==null&&n.memoizedState!==null,t){s=e.child,i=null,s.alternate!==null&&s.alternate.memoizedState!==null&&s.alternate.memoizedState.cachePool!==null&&(i=s.alternate.memoizedState.cachePool.pool);var a=null;s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(a=s.memoizedState.cachePool.pool),a!==i&&(s.flags|=2048)}return t!==n&&t&&(e.child.flags|=8192),lp(e,e.updateQueue),Ln(e),null;case 4:return kd(),n===null&&hv(e.stateNode.containerInfo),Ln(e),null;case 10:return Da(e.type),Ln(e),null;case 19:if(As(ms),i=e.memoizedState,i===null)return Ln(e),null;if(s=(e.flags&128)!==0,a=i.rendering,a===null)if(s)uh(i,!1);else{if(Xn!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=gg(n),a!==null){for(e.flags|=128,uh(i,!1),n=a.updateQueue,e.updateQueue=n,lp(e,n),e.subtreeFlags=0,n=t,t=e.child;t!==null;)AT(t,n),t=t.sibling;return kn(ms,ms.current&1|2),e.child}n=n.sibling}i.tail!==null&&zi()>vg&&(e.flags|=128,s=!0,uh(i,!1),e.lanes=4194304)}else{if(!s)if(n=gg(a),n!==null){if(e.flags|=128,s=!0,n=n.updateQueue,e.updateQueue=n,lp(e,n),uh(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!Ht)return Ln(e),null}else 2*zi()-i.renderingStartTime>vg&&t!==536870912&&(e.flags|=128,s=!0,uh(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(n=i.last,n!==null?n.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=zi(),e.sibling=null,n=ms.current,kn(ms,s?n&1|2:n&1),e):(Ln(e),null);case 22:case 23:return ja(e),Hw(),s=e.memoizedState!==null,n!==null?n.memoizedState!==null!==s&&(e.flags|=8192):s&&(e.flags|=8192),s?t&536870912&&!(e.flags&128)&&(Ln(e),e.subtreeFlags&6&&(e.flags|=8192)):Ln(e),t=e.updateQueue,t!==null&&lp(e,t.retryQueue),t=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(t=n.memoizedState.cachePool.pool),s=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(s=e.memoizedState.cachePool.pool),s!==t&&(e.flags|=2048),n!==null&&As(Zl),null;case 24:return t=null,n!==null&&(t=n.memoizedState.cache),e.memoizedState.cache!==t&&(e.flags|=2048),Da(hs),Ln(e),null;case 25:return null;case 30:return null}throw Error(Ae(156,e.tag))}function uM(n,e){switch(zw(e),e.tag){case 1:return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Da(hs),kd(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 26:case 27:case 5:return rg(e),null;case 13:if(ja(e),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Ae(340));Wm()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return As(ms),null;case 4:return kd(),null;case 10:return Da(e.type),null;case 22:case 23:return ja(e),Hw(),n!==null&&As(Zl),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 24:return Da(hs),null;case 25:return null;default:return null}}function A1(n,e){switch(zw(e),e.tag){case 3:Da(hs),kd();break;case 26:case 27:case 5:rg(e);break;case 4:kd();break;case 13:ja(e);break;case 19:As(ms);break;case 10:Da(e.type);break;case 22:case 23:ja(e),Hw(),n!==null&&As(Zl);break;case 24:Da(hs)}}function ef(n,e){try{var t=e.updateQueue,s=t!==null?t.lastEffect:null;if(s!==null){var i=s.next;t=i;do{if((t.tag&n)===n){s=void 0;var a=t.create,o=t.inst;s=a(),o.destroy=s}t=t.next}while(t!==i)}}catch(l){pn(e,e.return,l)}}function Yo(n,e,t){try{var s=e.updateQueue,i=s!==null?s.lastEffect:null;if(i!==null){var a=i.next;s=a;do{if((s.tag&n)===n){var o=s.inst,l=o.destroy;if(l!==void 0){o.destroy=void 0,i=e;var c=t,d=l;try{d()}catch(h){pn(i,c,h)}}}s=s.next}while(s!==a)}}catch(h){pn(e,e.return,h)}}function D1(n){var e=n.updateQueue;if(e!==null){var t=n.stateNode;try{LT(e,t)}catch(s){pn(n,n.return,s)}}}function R1(n,e,t){t.props=cc(n.type,n.memoizedProps),t.state=n.memoizedState;try{t.componentWillUnmount()}catch(s){pn(n,e,s)}}function $h(n,e){try{var t=n.ref;if(t!==null){switch(n.tag){case 26:case 27:case 5:var s=n.stateNode;break;case 30:s=n.stateNode;break;default:s=n.stateNode}typeof t=="function"?n.refCleanup=t(s):t.current=s}}catch(i){pn(n,e,i)}}function Mi(n,e){var t=n.ref,s=n.refCleanup;if(t!==null)if(typeof s=="function")try{s()}catch(i){pn(n,e,i)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof t=="function")try{t(null)}catch(i){pn(n,e,i)}else t.current=null}function P1(n){var e=n.type,t=n.memoizedProps,s=n.stateNode;try{e:switch(e){case"button":case"input":case"select":case"textarea":t.autoFocus&&s.focus();break e;case"img":t.src?s.src=t.src:t.srcSet&&(s.srcset=t.srcSet)}}catch(i){pn(n,n.return,i)}}function Yy(n,e,t){try{var s=n.stateNode;RM(s,n.type,t,e),s[vr]=e}catch(i){pn(n,n.return,i)}}function k1(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&il(n.type)||n.tag===4}function Xy(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||k1(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&il(n.type)||n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function h0(n,e,t){var s=n.tag;if(s===5||s===6)n=n.stateNode,e?(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t).insertBefore(n,e):(e=t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,e.appendChild(n),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Ex));else if(s!==4&&(s===27&&il(n.type)&&(t=n.stateNode,e=null),n=n.child,n!==null))for(h0(n,e,t),n=n.sibling;n!==null;)h0(n,e,t),n=n.sibling}function wg(n,e,t){var s=n.tag;if(s===5||s===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(s!==4&&(s===27&&il(n.type)&&(t=n.stateNode),n=n.child,n!==null))for(wg(n,e,t),n=n.sibling;n!==null;)wg(n,e,t),n=n.sibling}function O1(n){var e=n.stateNode,t=n.memoizedProps;try{for(var s=n.type,i=e.attributes;i.length;)e.removeAttributeNode(i[0]);Vs(e,s,t),e[Gs]=n,e[vr]=t}catch(a){pn(n,n.return,a)}}var xa=!1,ss=!1,Jy=!1,z_=typeof WeakSet=="function"?WeakSet:Set,Ss=null;function hM(n,e){if(n=n.containerInfo,w0=Ag,n=NT(n),Mw(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var s=t.getSelection&&t.getSelection();if(s&&s.rangeCount!==0){t=s.anchorNode;var i=s.anchorOffset,a=s.focusNode;s=s.focusOffset;try{t.nodeType,a.nodeType}catch{t=null;break e}var o=0,l=-1,c=-1,d=0,h=0,f=n,p=null;t:for(;;){for(var x;f!==t||i!==0&&f.nodeType!==3||(l=o+i),f!==a||s!==0&&f.nodeType!==3||(c=o+s),f.nodeType===3&&(o+=f.nodeValue.length),(x=f.firstChild)!==null;)p=f,f=x;for(;;){if(f===n)break t;if(p===t&&++d===i&&(l=o),p===a&&++h===s&&(c=o),(x=f.nextSibling)!==null)break;f=p,p=f.parentNode}f=x}t=l===-1||c===-1?null:{start:l,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(v0={focusedElem:n,selectionRange:t},Ag=!1,Ss=e;Ss!==null;)if(e=Ss,n=e.child,(e.subtreeFlags&1024)!==0&&n!==null)n.return=e,Ss=n;else for(;Ss!==null;){switch(e=Ss,a=e.alternate,n=e.flags,e.tag){case 0:break;case 11:case 15:break;case 1:if(n&1024&&a!==null){n=void 0,t=e,i=a.memoizedProps,a=a.memoizedState,s=t.stateNode;try{var I=cc(t.type,i,t.elementType===t.type);n=s.getSnapshotBeforeUpdate(I,a),s.__reactInternalSnapshotBeforeUpdate=n}catch(D){pn(t,t.return,D)}}break;case 3:if(n&1024){if(n=e.stateNode.containerInfo,t=n.nodeType,t===9)j0(n);else if(t===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":j0(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(n&1024)throw Error(Ae(163))}if(n=e.sibling,n!==null){n.return=e.return,Ss=n;break}Ss=e.return}}function M1(n,e,t){var s=t.flags;switch(t.tag){case 0:case 11:case 15:co(n,t),s&4&&ef(5,t);break;case 1:if(co(n,t),s&4)if(n=t.stateNode,e===null)try{n.componentDidMount()}catch(o){pn(t,t.return,o)}else{var i=cc(t.type,e.memoizedProps);e=e.memoizedState;try{n.componentDidUpdate(i,e,n.__reactInternalSnapshotBeforeUpdate)}catch(o){pn(t,t.return,o)}}s&64&&D1(t),s&512&&$h(t,t.return);break;case 3:if(co(n,t),s&64&&(n=t.updateQueue,n!==null)){if(e=null,t.child!==null)switch(t.child.tag){case 27:case 5:e=t.child.stateNode;break;case 1:e=t.child.stateNode}try{LT(n,e)}catch(o){pn(t,t.return,o)}}break;case 27:e===null&&s&4&&O1(t);case 26:case 5:co(n,t),e===null&&s&4&&P1(t),s&512&&$h(t,t.return);break;case 12:co(n,t);break;case 13:co(n,t),s&4&&U1(n,t),s&64&&(n=t.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(t=vM.bind(null,t),UM(n,t))));break;case 22:if(s=t.memoizedState!==null||xa,!s){e=e!==null&&e.memoizedState!==null||ss,i=xa;var a=ss;xa=s,(ss=e)&&!a?po(n,t,(t.subtreeFlags&8772)!==0):co(n,t),xa=i,ss=a}break;case 30:break;default:co(n,t)}}function L1(n){var e=n.alternate;e!==null&&(n.alternate=null,L1(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&Aw(e)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var Cn=null,mr=!1;function fa(n,e,t){for(t=t.child;t!==null;)F1(n,e,t),t=t.sibling}function F1(n,e,t){if(Mr&&typeof Mr.onCommitFiberUnmount=="function")try{Mr.onCommitFiberUnmount(Bm,t)}catch{}switch(t.tag){case 26:ss||Mi(t,e),fa(n,e,t),t.memoizedState?t.memoizedState.count--:t.stateNode&&(t=t.stateNode,t.parentNode.removeChild(t));break;case 27:ss||Mi(t,e);var s=Cn,i=mr;il(t.type)&&(Cn=t.stateNode,mr=!1),fa(n,e,t),Gh(t.stateNode),Cn=s,mr=i;break;case 5:ss||Mi(t,e);case 6:if(s=Cn,i=mr,Cn=null,fa(n,e,t),Cn=s,mr=i,Cn!==null)if(mr)try{(Cn.nodeType===9?Cn.body:Cn.nodeName==="HTML"?Cn.ownerDocument.body:Cn).removeChild(t.stateNode)}catch(a){pn(t,e,a)}else try{Cn.removeChild(t.stateNode)}catch(a){pn(t,e,a)}break;case 18:Cn!==null&&(mr?(n=Cn,Z_(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,t.stateNode),Nm(n)):Z_(Cn,t.stateNode));break;case 4:s=Cn,i=mr,Cn=t.stateNode.containerInfo,mr=!0,fa(n,e,t),Cn=s,mr=i;break;case 0:case 11:case 14:case 15:ss||Yo(2,t,e),ss||Yo(4,t,e),fa(n,e,t);break;case 1:ss||(Mi(t,e),s=t.stateNode,typeof s.componentWillUnmount=="function"&&R1(t,e,s)),fa(n,e,t);break;case 21:fa(n,e,t);break;case 22:ss=(s=ss)||t.memoizedState!==null,fa(n,e,t),ss=s;break;default:fa(n,e,t)}}function U1(n,e){if(e.memoizedState===null&&(n=e.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{Nm(n)}catch(t){pn(e,e.return,t)}}function mM(n){switch(n.tag){case 13:case 19:var e=n.stateNode;return e===null&&(e=n.stateNode=new z_),e;case 22:return n=n.stateNode,e=n._retryCache,e===null&&(e=n._retryCache=new z_),e;default:throw Error(Ae(435,n.tag))}}function Zy(n,e){var t=mM(n);e.forEach(function(s){var i=NM.bind(null,n,s);t.has(s)||(t.add(s),s.then(i,i))})}function Ir(n,e){var t=e.deletions;if(t!==null)for(var s=0;s<t.length;s++){var i=t[s],a=n,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 27:if(il(l.type)){Cn=l.stateNode,mr=!1;break e}break;case 5:Cn=l.stateNode,mr=!1;break e;case 3:case 4:Cn=l.stateNode.containerInfo,mr=!0;break e}l=l.return}if(Cn===null)throw Error(Ae(160));F1(a,o,i),Cn=null,mr=!1,a=i.alternate,a!==null&&(a.return=null),i.return=null}if(e.subtreeFlags&13878)for(e=e.child;e!==null;)V1(e,n),e=e.sibling}var fi=null;function V1(n,e){var t=n.alternate,s=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:Ir(e,n),Tr(n),s&4&&(Yo(3,n,n.return),ef(3,n),Yo(5,n,n.return));break;case 1:Ir(e,n),Tr(n),s&512&&(ss||t===null||Mi(t,t.return)),s&64&&xa&&(n=n.updateQueue,n!==null&&(s=n.callbacks,s!==null&&(t=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=t===null?s:t.concat(s))));break;case 26:var i=fi;if(Ir(e,n),Tr(n),s&512&&(ss||t===null||Mi(t,t.return)),s&4){var a=t!==null?t.memoizedState:null;if(s=n.memoizedState,t===null)if(s===null)if(n.stateNode===null){e:{s=n.type,t=n.memoizedProps,i=i.ownerDocument||i;t:switch(s){case"title":a=i.getElementsByTagName("title")[0],(!a||a[Gm]||a[Gs]||a.namespaceURI==="http://www.w3.org/2000/svg"||a.hasAttribute("itemprop"))&&(a=i.createElement(s),i.head.insertBefore(a,i.querySelector("head > title"))),Vs(a,s,t),a[Gs]=n,Ts(a),s=a;break e;case"link":var o=rE("link","href",i).get(s+(t.href||""));if(o){for(var l=0;l<o.length;l++)if(a=o[l],a.getAttribute("href")===(t.href==null||t.href===""?null:t.href)&&a.getAttribute("rel")===(t.rel==null?null:t.rel)&&a.getAttribute("title")===(t.title==null?null:t.title)&&a.getAttribute("crossorigin")===(t.crossOrigin==null?null:t.crossOrigin)){o.splice(l,1);break t}}a=i.createElement(s),Vs(a,s,t),i.head.appendChild(a);break;case"meta":if(o=rE("meta","content",i).get(s+(t.content||""))){for(l=0;l<o.length;l++)if(a=o[l],a.getAttribute("content")===(t.content==null?null:""+t.content)&&a.getAttribute("name")===(t.name==null?null:t.name)&&a.getAttribute("property")===(t.property==null?null:t.property)&&a.getAttribute("http-equiv")===(t.httpEquiv==null?null:t.httpEquiv)&&a.getAttribute("charset")===(t.charSet==null?null:t.charSet)){o.splice(l,1);break t}}a=i.createElement(s),Vs(a,s,t),i.head.appendChild(a);break;default:throw Error(Ae(468,s))}a[Gs]=n,Ts(a),s=a}n.stateNode=s}else iE(i,n.type,n.stateNode);else n.stateNode=sE(i,s,n.memoizedProps);else a!==s?(a===null?t.stateNode!==null&&(t=t.stateNode,t.parentNode.removeChild(t)):a.count--,s===null?iE(i,n.type,n.stateNode):sE(i,s,n.memoizedProps)):s===null&&n.stateNode!==null&&Yy(n,n.memoizedProps,t.memoizedProps)}break;case 27:Ir(e,n),Tr(n),s&512&&(ss||t===null||Mi(t,t.return)),t!==null&&s&4&&Yy(n,n.memoizedProps,t.memoizedProps);break;case 5:if(Ir(e,n),Tr(n),s&512&&(ss||t===null||Mi(t,t.return)),n.flags&32){i=n.stateNode;try{Md(i,"")}catch(x){pn(n,n.return,x)}}s&4&&n.stateNode!=null&&(i=n.memoizedProps,Yy(n,i,t!==null?t.memoizedProps:i)),s&1024&&(Jy=!0);break;case 6:if(Ir(e,n),Tr(n),s&4){if(n.stateNode===null)throw Error(Ae(162));s=n.memoizedProps,t=n.stateNode;try{t.nodeValue=s}catch(x){pn(n,n.return,x)}}break;case 3:if(Op=null,i=fi,fi=Ig(e.containerInfo),Ir(e,n),fi=i,Tr(n),s&4&&t!==null&&t.memoizedState.isDehydrated)try{Nm(e.containerInfo)}catch(x){pn(n,n.return,x)}Jy&&(Jy=!1,z1(n));break;case 4:s=fi,fi=Ig(n.stateNode.containerInfo),Ir(e,n),Tr(n),fi=s;break;case 12:Ir(e,n),Tr(n);break;case 13:Ir(e,n),Tr(n),n.child.flags&8192&&n.memoizedState!==null!=(t!==null&&t.memoizedState!==null)&&(cv=zi()),s&4&&(s=n.updateQueue,s!==null&&(n.updateQueue=null,Zy(n,s)));break;case 22:i=n.memoizedState!==null;var c=t!==null&&t.memoizedState!==null,d=xa,h=ss;if(xa=d||i,ss=h||c,Ir(e,n),ss=h,xa=d,Tr(n),s&8192)e:for(e=n.stateNode,e._visibility=i?e._visibility&-2:e._visibility|1,i&&(t===null||c||xa||ss||Ul(n)),t=null,e=n;;){if(e.tag===5||e.tag===26){if(t===null){c=t=e;try{if(a=c.stateNode,i)o=a.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none";else{l=c.stateNode;var f=c.memoizedProps.style,p=f!=null&&f.hasOwnProperty("display")?f.display:null;l.style.display=p==null||typeof p=="boolean"?"":(""+p).trim()}}catch(x){pn(c,c.return,x)}}}else if(e.tag===6){if(t===null){c=e;try{c.stateNode.nodeValue=i?"":c.memoizedProps}catch(x){pn(c,c.return,x)}}}else if((e.tag!==22&&e.tag!==23||e.memoizedState===null||e===n)&&e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;t===e&&(t=null),e=e.return}t===e&&(t=null),e.sibling.return=e.return,e=e.sibling}s&4&&(s=n.updateQueue,s!==null&&(t=s.retryQueue,t!==null&&(s.retryQueue=null,Zy(n,t))));break;case 19:Ir(e,n),Tr(n),s&4&&(s=n.updateQueue,s!==null&&(n.updateQueue=null,Zy(n,s)));break;case 30:break;case 21:break;default:Ir(e,n),Tr(n)}}function Tr(n){var e=n.flags;if(e&2){try{for(var t,s=n.return;s!==null;){if(k1(s)){t=s;break}s=s.return}if(t==null)throw Error(Ae(160));switch(t.tag){case 27:var i=t.stateNode,a=Xy(n);wg(n,a,i);break;case 5:var o=t.stateNode;t.flags&32&&(Md(o,""),t.flags&=-33);var l=Xy(n);wg(n,l,o);break;case 3:case 4:var c=t.stateNode.containerInfo,d=Xy(n);h0(n,d,c);break;default:throw Error(Ae(161))}}catch(h){pn(n,n.return,h)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function z1(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var e=n;z1(e),e.tag===5&&e.flags&1024&&e.stateNode.reset(),n=n.sibling}}function co(n,e){if(e.subtreeFlags&8772)for(e=e.child;e!==null;)M1(n,e.alternate,e),e=e.sibling}function Ul(n){for(n=n.child;n!==null;){var e=n;switch(e.tag){case 0:case 11:case 14:case 15:Yo(4,e,e.return),Ul(e);break;case 1:Mi(e,e.return);var t=e.stateNode;typeof t.componentWillUnmount=="function"&&R1(e,e.return,t),Ul(e);break;case 27:Gh(e.stateNode);case 26:case 5:Mi(e,e.return),Ul(e);break;case 22:e.memoizedState===null&&Ul(e);break;case 30:Ul(e);break;default:Ul(e)}n=n.sibling}}function po(n,e,t){for(t=t&&(e.subtreeFlags&8772)!==0,e=e.child;e!==null;){var s=e.alternate,i=n,a=e,o=a.flags;switch(a.tag){case 0:case 11:case 15:po(i,a,t),ef(4,a);break;case 1:if(po(i,a,t),s=a,i=s.stateNode,typeof i.componentDidMount=="function")try{i.componentDidMount()}catch(d){pn(s,s.return,d)}if(s=a,i=s.updateQueue,i!==null){var l=s.stateNode;try{var c=i.shared.hiddenCallbacks;if(c!==null)for(i.shared.hiddenCallbacks=null,i=0;i<c.length;i++)MT(c[i],l)}catch(d){pn(s,s.return,d)}}t&&o&64&&D1(a),$h(a,a.return);break;case 27:O1(a);case 26:case 5:po(i,a,t),t&&s===null&&o&4&&P1(a),$h(a,a.return);break;case 12:po(i,a,t);break;case 13:po(i,a,t),t&&o&4&&U1(i,a);break;case 22:a.memoizedState===null&&po(i,a,t),$h(a,a.return);break;case 30:break;default:po(i,a,t)}e=e.sibling}}function iv(n,e){var t=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(t=n.memoizedState.cachePool.pool),n=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(n=e.memoizedState.cachePool.pool),n!==t&&(n!=null&&n.refCount++,t!=null&&Ym(t))}function av(n,e){n=null,e.alternate!==null&&(n=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==n&&(e.refCount++,n!=null&&Ym(n))}function Ai(n,e,t,s){if(e.subtreeFlags&10256)for(e=e.child;e!==null;)$1(n,e,t,s),e=e.sibling}function $1(n,e,t,s){var i=e.flags;switch(e.tag){case 0:case 11:case 15:Ai(n,e,t,s),i&2048&&ef(9,e);break;case 1:Ai(n,e,t,s);break;case 3:Ai(n,e,t,s),i&2048&&(n=null,e.alternate!==null&&(n=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==n&&(e.refCount++,n!=null&&Ym(n)));break;case 12:if(i&2048){Ai(n,e,t,s),n=e.stateNode;try{var a=e.memoizedProps,o=a.id,l=a.onPostCommit;typeof l=="function"&&l(o,e.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(c){pn(e,e.return,c)}}else Ai(n,e,t,s);break;case 13:Ai(n,e,t,s);break;case 23:break;case 22:a=e.stateNode,o=e.alternate,e.memoizedState!==null?a._visibility&2?Ai(n,e,t,s):Bh(n,e):a._visibility&2?Ai(n,e,t,s):(a._visibility|=2,Yc(n,e,t,s,(e.subtreeFlags&10256)!==0)),i&2048&&iv(o,e);break;case 24:Ai(n,e,t,s),i&2048&&av(e.alternate,e);break;default:Ai(n,e,t,s)}}function Yc(n,e,t,s,i){for(i=i&&(e.subtreeFlags&10256)!==0,e=e.child;e!==null;){var a=n,o=e,l=t,c=s,d=o.flags;switch(o.tag){case 0:case 11:case 15:Yc(a,o,l,c,i),ef(8,o);break;case 23:break;case 22:var h=o.stateNode;o.memoizedState!==null?h._visibility&2?Yc(a,o,l,c,i):Bh(a,o):(h._visibility|=2,Yc(a,o,l,c,i)),i&&d&2048&&iv(o.alternate,o);break;case 24:Yc(a,o,l,c,i),i&&d&2048&&av(o.alternate,o);break;default:Yc(a,o,l,c,i)}e=e.sibling}}function Bh(n,e){if(e.subtreeFlags&10256)for(e=e.child;e!==null;){var t=n,s=e,i=s.flags;switch(s.tag){case 22:Bh(t,s),i&2048&&iv(s.alternate,s);break;case 24:Bh(t,s),i&2048&&av(s.alternate,s);break;default:Bh(t,s)}e=e.sibling}}var _h=8192;function Vc(n){if(n.subtreeFlags&_h)for(n=n.child;n!==null;)B1(n),n=n.sibling}function B1(n){switch(n.tag){case 26:Vc(n),n.flags&_h&&n.memoizedState!==null&&JM(fi,n.memoizedState,n.memoizedProps);break;case 5:Vc(n);break;case 3:case 4:var e=fi;fi=Ig(n.stateNode.containerInfo),Vc(n),fi=e;break;case 22:n.memoizedState===null&&(e=n.alternate,e!==null&&e.memoizedState!==null?(e=_h,_h=16777216,Vc(n),_h=e):Vc(n));break;default:Vc(n)}}function q1(n){var e=n.alternate;if(e!==null&&(n=e.child,n!==null)){e.child=null;do e=n.sibling,n.sibling=null,n=e;while(n!==null)}}function hh(n){var e=n.deletions;if(n.flags&16){if(e!==null)for(var t=0;t<e.length;t++){var s=e[t];Ss=s,G1(s,n)}q1(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)H1(n),n=n.sibling}function H1(n){switch(n.tag){case 0:case 11:case 15:hh(n),n.flags&2048&&Yo(9,n,n.return);break;case 3:hh(n);break;case 12:hh(n);break;case 22:var e=n.stateNode;n.memoizedState!==null&&e._visibility&2&&(n.return===null||n.return.tag!==13)?(e._visibility&=-3,Pp(n)):hh(n);break;default:hh(n)}}function Pp(n){var e=n.deletions;if(n.flags&16){if(e!==null)for(var t=0;t<e.length;t++){var s=e[t];Ss=s,G1(s,n)}q1(n)}for(n=n.child;n!==null;){switch(e=n,e.tag){case 0:case 11:case 15:Yo(8,e,e.return),Pp(e);break;case 22:t=e.stateNode,t._visibility&2&&(t._visibility&=-3,Pp(e));break;default:Pp(e)}n=n.sibling}}function G1(n,e){for(;Ss!==null;){var t=Ss;switch(t.tag){case 0:case 11:case 15:Yo(8,t,e);break;case 23:case 22:if(t.memoizedState!==null&&t.memoizedState.cachePool!==null){var s=t.memoizedState.cachePool.pool;s!=null&&s.refCount++}break;case 24:Ym(t.memoizedState.cache)}if(s=t.child,s!==null)s.return=t,Ss=s;else e:for(t=n;Ss!==null;){s=Ss;var i=s.sibling,a=s.return;if(L1(s),s===t){Ss=null;break e}if(i!==null){i.return=a,Ss=i;break e}Ss=a}}}var fM={getCacheForType:function(n){var e=Qs(hs),t=e.data.get(n);return t===void 0&&(t=n(),e.data.set(n,t)),t}},pM=typeof WeakMap=="function"?WeakMap:Map,nn=0,bn=null,St=null,Mt=0,tn=0,Ar=null,Do=!1,xu=!1,ov=!1,Fa=0,Xn=0,Xo=0,ec=0,lv=0,ni=0,zd=0,qh=null,fr=null,m0=!1,cv=0,vg=1/0,Ng=null,Fo=null,Fs=0,Uo=null,$d=null,Sd=0,f0=0,p0=null,Q1=null,Hh=0,g0=null;function Fr(){if(nn&2&&Mt!==0)return Mt&-Mt;if(ht.T!==null){var n=Ld;return n!==0?n:uv()}return rT()}function W1(){ni===0&&(ni=!(Mt&536870912)||Ht?eT():536870912);var n=ai.current;return n!==null&&(n.flags|=32),ni}function Ur(n,e,t){(n===bn&&(tn===2||tn===9)||n.cancelPendingCommit!==null)&&(Bd(n,0),Ro(n,Mt,ni,!1)),Hm(n,t),(!(nn&2)||n!==bn)&&(n===bn&&(!(nn&2)&&(ec|=t),Xn===4&&Ro(n,Mt,ni,!1)),Zi(n))}function K1(n,e,t){if(nn&6)throw Error(Ae(327));var s=!t&&(e&124)===0&&(e&n.expiredLanes)===0||qm(n,e),i=s?yM(n,e):eb(n,e,!0),a=s;do{if(i===0){xu&&!s&&Ro(n,e,0,!1);break}else{if(t=n.current.alternate,a&&!gM(t)){i=eb(n,e,!1),a=!1;continue}if(i===2){if(a=e,n.errorRecoveryDisabledLanes&a)var o=0;else o=n.pendingLanes&-536870913,o=o!==0?o:o&536870912?536870912:0;if(o!==0){e=o;e:{var l=n;i=qh;var c=l.current.memoizedState.isDehydrated;if(c&&(Bd(l,o).flags|=256),o=eb(l,o,!1),o!==2){if(ov&&!c){l.errorRecoveryDisabledLanes|=a,ec|=a,i=4;break e}a=fr,fr=i,a!==null&&(fr===null?fr=a:fr.push.apply(fr,a))}i=o}if(a=!1,i!==2)continue}}if(i===1){Bd(n,0),Ro(n,e,0,!0);break}e:{switch(s=n,a=i,a){case 0:case 1:throw Error(Ae(345));case 4:if((e&4194048)!==e)break;case 6:Ro(s,e,ni,!Do);break e;case 2:fr=null;break;case 3:case 5:break;default:throw Error(Ae(329))}if((e&62914560)===e&&(i=cv+300-zi(),10<i)){if(Ro(s,e,ni,!Do),hx(s,0,!0)!==0)break e;s.timeoutHandle=fC($_.bind(null,s,t,fr,Ng,m0,e,ni,ec,zd,Do,a,2,-0,0),i);break e}$_(s,t,fr,Ng,m0,e,ni,ec,zd,Do,a,0,-0,0)}}break}while(!0);Zi(n)}function $_(n,e,t,s,i,a,o,l,c,d,h,f,p,x){if(n.timeoutHandle=-1,f=e.subtreeFlags,(f&8192||(f&16785408)===16785408)&&(ym={stylesheets:null,count:0,unsuspend:XM},B1(e),f=ZM(),f!==null)){n.cancelPendingCommit=f(q_.bind(null,n,e,a,t,s,i,o,l,c,h,1,p,x)),Ro(n,a,o,!d);return}q_(n,e,a,t,s,i,o,l,c)}function gM(n){for(var e=n;;){var t=e.tag;if((t===0||t===11||t===15)&&e.flags&16384&&(t=e.updateQueue,t!==null&&(t=t.stores,t!==null)))for(var s=0;s<t.length;s++){var i=t[s],a=i.getSnapshot;i=i.value;try{if(!zr(a(),i))return!1}catch{return!1}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ro(n,e,t,s){e&=~lv,e&=~ec,n.suspendedLanes|=e,n.pingedLanes&=~e,s&&(n.warmLanes|=e),s=n.expirationTimes;for(var i=e;0<i;){var a=31-Lr(i),o=1<<a;s[a]=-1,i&=~o}t!==0&&nT(n,t,e)}function Nx(){return nn&6?!0:(tf(0),!1)}function dv(){if(St!==null){if(tn===0)var n=St.return;else n=St,Na=jc=null,Yw(n),Ed=null,pm=0,n=St;for(;n!==null;)A1(n.alternate,n),n=n.return;St=null}}function Bd(n,e){var t=n.timeoutHandle;t!==-1&&(n.timeoutHandle=-1,kM(t)),t=n.cancelPendingCommit,t!==null&&(n.cancelPendingCommit=null,t()),dv(),bn=n,St=t=Aa(n.current,null),Mt=e,tn=0,Ar=null,Do=!1,xu=qm(n,e),ov=!1,zd=ni=lv=ec=Xo=Xn=0,fr=qh=null,m0=!1,e&8&&(e|=e&32);var s=n.entangledLanes;if(s!==0)for(n=n.entanglements,s&=e;0<s;){var i=31-Lr(s),a=1<<i;e|=n[i],s&=~a}return Fa=e,gx(),t}function Y1(n,e){Nt=null,ht.H=pg,e===Xm||e===yx?(e=w_(),tn=3):e===kT?(e=w_(),tn=4):tn=e===_1?8:e!==null&&typeof e=="object"&&typeof e.then=="function"?6:1,Ar=e,St===null&&(Xn=1,yg(n,ti(e,n.current)))}function X1(){var n=ht.H;return ht.H=pg,n===null?pg:n}function J1(){var n=ht.A;return ht.A=fM,n}function x0(){Xn=4,Do||(Mt&4194048)!==Mt&&ai.current!==null||(xu=!0),!(Xo&134217727)&&!(ec&134217727)||bn===null||Ro(bn,Mt,ni,!1)}function eb(n,e,t){var s=nn;nn|=2;var i=X1(),a=J1();(bn!==n||Mt!==e)&&(Ng=null,Bd(n,e)),e=!1;var o=Xn;e:do try{if(tn!==0&&St!==null){var l=St,c=Ar;switch(tn){case 8:dv(),o=6;break e;case 3:case 2:case 9:case 6:ai.current===null&&(e=!0);var d=tn;if(tn=0,Ar=null,gd(n,l,c,d),t&&xu){o=0;break e}break;default:d=tn,tn=0,Ar=null,gd(n,l,c,d)}}xM(),o=Xn;break}catch(h){Y1(n,h)}while(!0);return e&&n.shellSuspendCounter++,Na=jc=null,nn=s,ht.H=i,ht.A=a,St===null&&(bn=null,Mt=0,gx()),o}function xM(){for(;St!==null;)Z1(St)}function yM(n,e){var t=nn;nn|=2;var s=X1(),i=J1();bn!==n||Mt!==e?(Ng=null,vg=zi()+500,Bd(n,e)):xu=qm(n,e);e:do try{if(tn!==0&&St!==null){e=St;var a=Ar;t:switch(tn){case 1:tn=0,Ar=null,gd(n,e,a,1);break;case 2:case 9:if(b_(a)){tn=0,Ar=null,B_(e);break}e=function(){tn!==2&&tn!==9||bn!==n||(tn=7),Zi(n)},a.then(e,e);break e;case 3:tn=7;break e;case 4:tn=5;break e;case 7:b_(a)?(tn=0,Ar=null,B_(e)):(tn=0,Ar=null,gd(n,e,a,7));break;case 5:var o=null;switch(St.tag){case 26:o=St.memoizedState;case 5:case 27:var l=St;if(!o||yC(o)){tn=0,Ar=null;var c=l.sibling;if(c!==null)St=c;else{var d=l.return;d!==null?(St=d,jx(d)):St=null}break t}}tn=0,Ar=null,gd(n,e,a,5);break;case 6:tn=0,Ar=null,gd(n,e,a,6);break;case 8:dv(),Xn=6;break e;default:throw Error(Ae(462))}}bM();break}catch(h){Y1(n,h)}while(!0);return Na=jc=null,ht.H=s,ht.A=i,nn=t,St!==null?0:(bn=null,Mt=0,gx(),Xn)}function bM(){for(;St!==null&&!zk();)Z1(St)}function Z1(n){var e=C1(n.alternate,n,Fa);n.memoizedProps=n.pendingProps,e===null?jx(n):St=e}function B_(n){var e=n,t=e.alternate;switch(e.tag){case 15:case 0:e=M_(t,e,e.pendingProps,e.type,void 0,Mt);break;case 11:e=M_(t,e,e.pendingProps,e.type.render,e.ref,Mt);break;case 5:Yw(e);default:A1(t,e),e=St=AT(e,Fa),e=C1(t,e,Fa)}n.memoizedProps=n.pendingProps,e===null?jx(n):St=e}function gd(n,e,t,s){Na=jc=null,Yw(e),Ed=null,pm=0;var i=e.return;try{if(lM(n,i,e,t,Mt)){Xn=1,yg(n,ti(t,n.current)),St=null;return}}catch(a){if(i!==null)throw St=i,a;Xn=1,yg(n,ti(t,n.current)),St=null;return}e.flags&32768?(Ht||s===1?n=!0:xu||Mt&536870912?n=!1:(Do=n=!0,(s===2||s===9||s===3||s===6)&&(s=ai.current,s!==null&&s.tag===13&&(s.flags|=16384))),eC(e,n)):jx(e)}function jx(n){var e=n;do{if(e.flags&32768){eC(e,Do);return}n=e.return;var t=dM(e.alternate,e,Fa);if(t!==null){St=t;return}if(e=e.sibling,e!==null){St=e;return}St=e=n}while(e!==null);Xn===0&&(Xn=5)}function eC(n,e){do{var t=uM(n.alternate,n);if(t!==null){t.flags&=32767,St=t;return}if(t=n.return,t!==null&&(t.flags|=32768,t.subtreeFlags=0,t.deletions=null),!e&&(n=n.sibling,n!==null)){St=n;return}St=n=t}while(n!==null);Xn=6,St=null}function q_(n,e,t,s,i,a,o,l,c){n.cancelPendingCommit=null;do _x();while(Fs!==0);if(nn&6)throw Error(Ae(327));if(e!==null){if(e===n.current)throw Error(Ae(177));if(a=e.lanes|e.childLanes,a|=Lw,Xk(n,t,a,o,l,c),n===bn&&(St=bn=null,Mt=0),$d=e,Uo=n,Sd=t,f0=a,p0=i,Q1=s,e.subtreeFlags&10256||e.flags&10256?(n.callbackNode=null,n.callbackPriority=0,jM(ig,function(){return iC(),null})):(n.callbackNode=null,n.callbackPriority=0),s=(e.flags&13878)!==0,e.subtreeFlags&13878||s){s=ht.T,ht.T=null,i=Qt.p,Qt.p=2,o=nn,nn|=4;try{hM(n,e,t)}finally{nn=o,Qt.p=i,ht.T=s}}Fs=1,tC(),nC(),sC()}}function tC(){if(Fs===1){Fs=0;var n=Uo,e=$d,t=(e.flags&13878)!==0;if(e.subtreeFlags&13878||t){t=ht.T,ht.T=null;var s=Qt.p;Qt.p=2;var i=nn;nn|=4;try{V1(e,n);var a=v0,o=NT(n.containerInfo),l=a.focusedElem,c=a.selectionRange;if(o!==l&&l&&l.ownerDocument&&vT(l.ownerDocument.documentElement,l)){if(c!==null&&Mw(l)){var d=c.start,h=c.end;if(h===void 0&&(h=d),"selectionStart"in l)l.selectionStart=d,l.selectionEnd=Math.min(h,l.value.length);else{var f=l.ownerDocument||document,p=f&&f.defaultView||window;if(p.getSelection){var x=p.getSelection(),I=l.textContent.length,D=Math.min(c.start,I),A=c.end===void 0?D:Math.min(c.end,I);!x.extend&&D>A&&(o=A,A=D,D=o);var g=u_(l,D),N=u_(l,A);if(g&&N&&(x.rangeCount!==1||x.anchorNode!==g.node||x.anchorOffset!==g.offset||x.focusNode!==N.node||x.focusOffset!==N.offset)){var j=f.createRange();j.setStart(g.node,g.offset),x.removeAllRanges(),D>A?(x.addRange(j),x.extend(N.node,N.offset)):(j.setEnd(N.node,N.offset),x.addRange(j))}}}}for(f=[],x=l;x=x.parentNode;)x.nodeType===1&&f.push({element:x,left:x.scrollLeft,top:x.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<f.length;l++){var V=f[l];V.element.scrollLeft=V.left,V.element.scrollTop=V.top}}Ag=!!w0,v0=w0=null}finally{nn=i,Qt.p=s,ht.T=t}}n.current=e,Fs=2}}function nC(){if(Fs===2){Fs=0;var n=Uo,e=$d,t=(e.flags&8772)!==0;if(e.subtreeFlags&8772||t){t=ht.T,ht.T=null;var s=Qt.p;Qt.p=2;var i=nn;nn|=4;try{M1(n,e.alternate,e)}finally{nn=i,Qt.p=s,ht.T=t}}Fs=3}}function sC(){if(Fs===4||Fs===3){Fs=0,$k();var n=Uo,e=$d,t=Sd,s=Q1;e.subtreeFlags&10256||e.flags&10256?Fs=5:(Fs=0,$d=Uo=null,rC(n,n.pendingLanes));var i=n.pendingLanes;if(i===0&&(Fo=null),Cw(t),e=e.stateNode,Mr&&typeof Mr.onCommitFiberRoot=="function")try{Mr.onCommitFiberRoot(Bm,e,void 0,(e.current.flags&128)===128)}catch{}if(s!==null){e=ht.T,i=Qt.p,Qt.p=2,ht.T=null;try{for(var a=n.onRecoverableError,o=0;o<s.length;o++){var l=s[o];a(l.value,{componentStack:l.stack})}}finally{ht.T=e,Qt.p=i}}Sd&3&&_x(),Zi(n),i=n.pendingLanes,t&4194090&&i&42?n===g0?Hh++:(Hh=0,g0=n):Hh=0,tf(0)}}function rC(n,e){(n.pooledCacheLanes&=e)===0&&(e=n.pooledCache,e!=null&&(n.pooledCache=null,Ym(e)))}function _x(n){return tC(),nC(),sC(),iC()}function iC(){if(Fs!==5)return!1;var n=Uo,e=f0;f0=0;var t=Cw(Sd),s=ht.T,i=Qt.p;try{Qt.p=32>t?32:t,ht.T=null,t=p0,p0=null;var a=Uo,o=Sd;if(Fs=0,$d=Uo=null,Sd=0,nn&6)throw Error(Ae(331));var l=nn;if(nn|=4,H1(a.current),$1(a,a.current,o,t),nn=l,tf(0,!1),Mr&&typeof Mr.onPostCommitFiberRoot=="function")try{Mr.onPostCommitFiberRoot(Bm,a)}catch{}return!0}finally{Qt.p=i,ht.T=s,rC(n,e)}}function H_(n,e,t){e=ti(t,e),e=c0(n.stateNode,e,2),n=Lo(n,e,2),n!==null&&(Hm(n,2),Zi(n))}function pn(n,e,t){if(n.tag===3)H_(n,n,t);else for(;e!==null;){if(e.tag===3){H_(e,n,t);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Fo===null||!Fo.has(s))){n=ti(t,n),t=N1(2),s=Lo(e,t,2),s!==null&&(j1(t,s,e,n),Hm(s,2),Zi(s));break}}e=e.return}}function tb(n,e,t){var s=n.pingCache;if(s===null){s=n.pingCache=new pM;var i=new Set;s.set(e,i)}else i=s.get(e),i===void 0&&(i=new Set,s.set(e,i));i.has(t)||(ov=!0,i.add(t),n=wM.bind(null,n,e,t),e.then(n,n))}function wM(n,e,t){var s=n.pingCache;s!==null&&s.delete(e),n.pingedLanes|=n.suspendedLanes&t,n.warmLanes&=~t,bn===n&&(Mt&t)===t&&(Xn===4||Xn===3&&(Mt&62914560)===Mt&&300>zi()-cv?!(nn&2)&&Bd(n,0):lv|=t,zd===Mt&&(zd=0)),Zi(n)}function aC(n,e){e===0&&(e=tT()),n=gu(n,e),n!==null&&(Hm(n,e),Zi(n))}function vM(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),aC(n,t)}function NM(n,e){var t=0;switch(n.tag){case 13:var s=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:s=n.stateNode;break;case 22:s=n.stateNode._retryCache;break;default:throw Error(Ae(314))}s!==null&&s.delete(e),aC(n,t)}function jM(n,e){return Iw(n,e)}var jg=null,Xc=null,y0=!1,_g=!1,nb=!1,tc=0;function Zi(n){n!==Xc&&n.next===null&&(Xc===null?jg=Xc=n:Xc=Xc.next=n),_g=!0,y0||(y0=!0,EM())}function tf(n,e){if(!nb&&_g){nb=!0;do for(var t=!1,s=jg;s!==null;){if(n!==0){var i=s.pendingLanes;if(i===0)var a=0;else{var o=s.suspendedLanes,l=s.pingedLanes;a=(1<<31-Lr(42|n)+1)-1,a&=i&~(o&~l),a=a&201326741?a&201326741|1:a?a|2:0}a!==0&&(t=!0,G_(s,a))}else a=Mt,a=hx(s,s===bn?a:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),!(a&3)||qm(s,a)||(t=!0,G_(s,a));s=s.next}while(t);nb=!1}}function _M(){oC()}function oC(){_g=y0=!1;var n=0;tc!==0&&(PM()&&(n=tc),tc=0);for(var e=zi(),t=null,s=jg;s!==null;){var i=s.next,a=lC(s,e);a===0?(s.next=null,t===null?jg=i:t.next=i,i===null&&(Xc=t)):(t=s,(n!==0||a&3)&&(_g=!0)),s=i}tf(n)}function lC(n,e){for(var t=n.suspendedLanes,s=n.pingedLanes,i=n.expirationTimes,a=n.pendingLanes&-62914561;0<a;){var o=31-Lr(a),l=1<<o,c=i[o];c===-1?(!(l&t)||l&s)&&(i[o]=Yk(l,e)):c<=e&&(n.expiredLanes|=l),a&=~l}if(e=bn,t=Mt,t=hx(n,n===e?t:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),s=n.callbackNode,t===0||n===e&&(tn===2||tn===9)||n.cancelPendingCommit!==null)return s!==null&&s!==null&&Ty(s),n.callbackNode=null,n.callbackPriority=0;if(!(t&3)||qm(n,t)){if(e=t&-t,e===n.callbackPriority)return e;switch(s!==null&&Ty(s),Cw(t)){case 2:case 8:t=JI;break;case 32:t=ig;break;case 268435456:t=ZI;break;default:t=ig}return s=cC.bind(null,n),t=Iw(t,s),n.callbackPriority=e,n.callbackNode=t,e}return s!==null&&s!==null&&Ty(s),n.callbackPriority=2,n.callbackNode=null,2}function cC(n,e){if(Fs!==0&&Fs!==5)return n.callbackNode=null,n.callbackPriority=0,null;var t=n.callbackNode;if(_x()&&n.callbackNode!==t)return null;var s=Mt;return s=hx(n,n===bn?s:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),s===0?null:(K1(n,s,e),lC(n,zi()),n.callbackNode!=null&&n.callbackNode===t?cC.bind(null,n):null)}function G_(n,e){if(_x())return null;K1(n,e,!0)}function EM(){OM(function(){nn&6?Iw(XI,_M):oC()})}function uv(){return tc===0&&(tc=eT()),tc}function Q_(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:Ep(""+n)}function W_(n,e){var t=e.ownerDocument.createElement("input");return t.name=e.name,t.value=e.value,n.id&&t.setAttribute("form",n.id),e.parentNode.insertBefore(t,e),n=new FormData(n),t.parentNode.removeChild(t),n}function SM(n,e,t,s,i){if(e==="submit"&&t&&t.stateNode===i){var a=Q_((i[vr]||null).action),o=s.submitter;o&&(e=(e=o[vr]||null)?Q_(e.formAction):o.getAttribute("formAction"),e!==null&&(a=e,o=null));var l=new mx("action","action",null,s,i);n.push({event:l,listeners:[{instance:null,listener:function(){if(s.defaultPrevented){if(tc!==0){var c=o?W_(i,o):new FormData(i);o0(t,{pending:!0,data:c,method:i.method,action:a},null,c)}}else typeof a=="function"&&(l.preventDefault(),c=o?W_(i,o):new FormData(i),o0(t,{pending:!0,data:c,method:i.method,action:a},a,c))},currentTarget:i}]})}}for(var sb=0;sb<Kb.length;sb++){var rb=Kb[sb],IM=rb.toLowerCase(),TM=rb[0].toUpperCase()+rb.slice(1);vi(IM,"on"+TM)}vi(_T,"onAnimationEnd");vi(ET,"onAnimationIteration");vi(ST,"onAnimationStart");vi("dblclick","onDoubleClick");vi("focusin","onFocus");vi("focusout","onBlur");vi(HO,"onTransitionRun");vi(GO,"onTransitionStart");vi(QO,"onTransitionCancel");vi(IT,"onTransitionEnd");Od("onMouseEnter",["mouseout","mouseover"]);Od("onMouseLeave",["mouseout","mouseover"]);Od("onPointerEnter",["pointerout","pointerover"]);Od("onPointerLeave",["pointerout","pointerover"]);wc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));wc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));wc("onBeforeInput",["compositionend","keypress","textInput","paste"]);wc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));wc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));wc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var gm="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),CM=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(gm));function dC(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var s=n[t],i=s.event;s=s.listeners;e:{var a=void 0;if(e)for(var o=s.length-1;0<=o;o--){var l=s[o],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==a&&i.isPropagationStopped())break e;a=l,i.currentTarget=d;try{a(i)}catch(h){xg(h)}i.currentTarget=null,a=c}else for(o=0;o<s.length;o++){if(l=s[o],c=l.instance,d=l.currentTarget,l=l.listener,c!==a&&i.isPropagationStopped())break e;a=l,i.currentTarget=d;try{a(i)}catch(h){xg(h)}i.currentTarget=null,a=c}}}}function Et(n,e){var t=e[$b];t===void 0&&(t=e[$b]=new Set);var s=n+"__bubble";t.has(s)||(uC(e,n,2,!1),t.add(s))}function ib(n,e,t){var s=0;e&&(s|=4),uC(t,n,s,e)}var cp="_reactListening"+Math.random().toString(36).slice(2);function hv(n){if(!n[cp]){n[cp]=!0,iT.forEach(function(t){t!=="selectionchange"&&(CM.has(t)||ib(t,!1,n),ib(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[cp]||(e[cp]=!0,ib("selectionchange",!1,e))}}function uC(n,e,t,s){switch(jC(e)){case 2:var i=nL;break;case 8:i=sL;break;default:i=gv}t=i.bind(null,e,t,n),i=void 0,!Gb||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),s?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function ab(n,e,t,s,i){var a=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var l=s.stateNode.containerInfo;if(l===i)break;if(o===4)for(o=s.return;o!==null;){var c=o.tag;if((c===3||c===4)&&o.stateNode.containerInfo===i)return;o=o.return}for(;l!==null;){if(o=od(l),o===null)return;if(c=o.tag,c===5||c===6||c===26||c===27){s=a=o;continue e}l=l.parentNode}}s=s.return}mT(function(){var d=a,h=Rw(t),f=[];e:{var p=TT.get(n);if(p!==void 0){var x=mx,I=n;switch(n){case"keypress":if(Ip(t)===0)break e;case"keydown":case"keyup":x=jO;break;case"focusin":I="focus",x=My;break;case"focusout":I="blur",x=My;break;case"beforeblur":case"afterblur":x=My;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=t_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=uO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=SO;break;case _T:case ET:case ST:x=fO;break;case IT:x=TO;break;case"scroll":case"scrollend":x=cO;break;case"wheel":x=AO;break;case"copy":case"cut":case"paste":x=gO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=s_;break;case"toggle":case"beforetoggle":x=RO}var D=(e&4)!==0,A=!D&&(n==="scroll"||n==="scrollend"),g=D?p!==null?p+"Capture":null:p;D=[];for(var N=d,j;N!==null;){var V=N;if(j=V.stateNode,V=V.tag,V!==5&&V!==26&&V!==27||j===null||g===null||(V=dm(N,g),V!=null&&D.push(xm(N,V,j))),A)break;N=N.return}0<D.length&&(p=new x(p,I,null,t,h),f.push({event:p,listeners:D}))}}if(!(e&7)){e:{if(p=n==="mouseover"||n==="pointerover",x=n==="mouseout"||n==="pointerout",p&&t!==Hb&&(I=t.relatedTarget||t.fromElement)&&(od(I)||I[fu]))break e;if((x||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,x?(I=t.relatedTarget||t.toElement,x=d,I=I?od(I):null,I!==null&&(A=$m(I),D=I.tag,I!==A||D!==5&&D!==27&&D!==6)&&(I=null)):(x=null,I=d),x!==I)){if(D=t_,V="onMouseLeave",g="onMouseEnter",N="mouse",(n==="pointerout"||n==="pointerover")&&(D=s_,V="onPointerLeave",g="onPointerEnter",N="pointer"),A=x==null?p:jh(x),j=I==null?p:jh(I),p=new D(V,N+"leave",x,t,h),p.target=A,p.relatedTarget=j,V=null,od(h)===d&&(D=new D(g,N+"enter",I,t,h),D.target=j,D.relatedTarget=A,V=D),A=V,x&&I)t:{for(D=x,g=I,N=0,j=D;j;j=zc(j))N++;for(j=0,V=g;V;V=zc(V))j++;for(;0<N-j;)D=zc(D),N--;for(;0<j-N;)g=zc(g),j--;for(;N--;){if(D===g||g!==null&&D===g.alternate)break t;D=zc(D),g=zc(g)}D=null}else D=null;x!==null&&K_(f,p,x,D,!1),I!==null&&A!==null&&K_(f,A,I,D,!0)}}e:{if(p=d?jh(d):window,x=p.nodeName&&p.nodeName.toLowerCase(),x==="select"||x==="input"&&p.type==="file")var $=o_;else if(a_(p))if(bT)$=$O;else{$=VO;var Z=UO}else x=p.nodeName,!x||x.toLowerCase()!=="input"||p.type!=="checkbox"&&p.type!=="radio"?d&&Dw(d.elementType)&&($=o_):$=zO;if($&&($=$(n,d))){yT(f,$,t,h);break e}Z&&Z(n,p,d),n==="focusout"&&d&&p.type==="number"&&d.memoizedProps.value!=null&&qb(p,"number",p.value)}switch(Z=d?jh(d):window,n){case"focusin":(a_(Z)||Z.contentEditable==="true")&&(dd=Z,Qb=d,Oh=null);break;case"focusout":Oh=Qb=dd=null;break;case"mousedown":Wb=!0;break;case"contextmenu":case"mouseup":case"dragend":Wb=!1,h_(f,t,h);break;case"selectionchange":if(qO)break;case"keydown":case"keyup":h_(f,t,h)}var O;if(Ow)e:{switch(n){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else cd?gT(n,t)&&(M="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(M="onCompositionStart");M&&(pT&&t.locale!=="ko"&&(cd||M!=="onCompositionStart"?M==="onCompositionEnd"&&cd&&(O=fT()):(Ao=h,Pw="value"in Ao?Ao.value:Ao.textContent,cd=!0)),Z=Eg(d,M),0<Z.length&&(M=new n_(M,n,null,t,h),f.push({event:M,listeners:Z}),O?M.data=O:(O=xT(t),O!==null&&(M.data=O)))),(O=kO?OO(n,t):MO(n,t))&&(M=Eg(d,"onBeforeInput"),0<M.length&&(Z=new n_("onBeforeInput","beforeinput",null,t,h),f.push({event:Z,listeners:M}),Z.data=O)),SM(f,n,d,t,h)}dC(f,e)})}function xm(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Eg(n,e){for(var t=e+"Capture",s=[];n!==null;){var i=n,a=i.stateNode;if(i=i.tag,i!==5&&i!==26&&i!==27||a===null||(i=dm(n,t),i!=null&&s.unshift(xm(n,i,a)),i=dm(n,e),i!=null&&s.push(xm(n,i,a))),n.tag===3)return s;n=n.return}return[]}function zc(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function K_(n,e,t,s,i){for(var a=e._reactName,o=[];t!==null&&t!==s;){var l=t,c=l.alternate,d=l.stateNode;if(l=l.tag,c!==null&&c===s)break;l!==5&&l!==26&&l!==27||d===null||(c=d,i?(d=dm(t,a),d!=null&&o.unshift(xm(t,d,c))):i||(d=dm(t,a),d!=null&&o.push(xm(t,d,c)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var AM=/\r\n?/g,DM=/\u0000|\uFFFD/g;function Y_(n){return(typeof n=="string"?n:""+n).replace(AM,`
`).replace(DM,"")}function hC(n,e){return e=Y_(e),Y_(n)===e}function Ex(){}function dn(n,e,t,s,i,a){switch(t){case"children":typeof s=="string"?e==="body"||e==="textarea"&&s===""||Md(n,s):(typeof s=="number"||typeof s=="bigint")&&e!=="body"&&Md(n,""+s);break;case"className":np(n,"class",s);break;case"tabIndex":np(n,"tabindex",s);break;case"dir":case"role":case"viewBox":case"width":case"height":np(n,t,s);break;case"style":hT(n,s,a);break;case"data":if(e!=="object"){np(n,"data",s);break}case"src":case"href":if(s===""&&(e!=="a"||t!=="href")){n.removeAttribute(t);break}if(s==null||typeof s=="function"||typeof s=="symbol"||typeof s=="boolean"){n.removeAttribute(t);break}s=Ep(""+s),n.setAttribute(t,s);break;case"action":case"formAction":if(typeof s=="function"){n.setAttribute(t,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof a=="function"&&(t==="formAction"?(e!=="input"&&dn(n,e,"name",i.name,i,null),dn(n,e,"formEncType",i.formEncType,i,null),dn(n,e,"formMethod",i.formMethod,i,null),dn(n,e,"formTarget",i.formTarget,i,null)):(dn(n,e,"encType",i.encType,i,null),dn(n,e,"method",i.method,i,null),dn(n,e,"target",i.target,i,null)));if(s==null||typeof s=="symbol"||typeof s=="boolean"){n.removeAttribute(t);break}s=Ep(""+s),n.setAttribute(t,s);break;case"onClick":s!=null&&(n.onclick=Ex);break;case"onScroll":s!=null&&Et("scroll",n);break;case"onScrollEnd":s!=null&&Et("scrollend",n);break;case"dangerouslySetInnerHTML":if(s!=null){if(typeof s!="object"||!("__html"in s))throw Error(Ae(61));if(t=s.__html,t!=null){if(i.children!=null)throw Error(Ae(60));n.innerHTML=t}}break;case"multiple":n.multiple=s&&typeof s!="function"&&typeof s!="symbol";break;case"muted":n.muted=s&&typeof s!="function"&&typeof s!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(s==null||typeof s=="function"||typeof s=="boolean"||typeof s=="symbol"){n.removeAttribute("xlink:href");break}t=Ep(""+s),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":s!=null&&typeof s!="function"&&typeof s!="symbol"?n.setAttribute(t,""+s):n.removeAttribute(t);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":s&&typeof s!="function"&&typeof s!="symbol"?n.setAttribute(t,""):n.removeAttribute(t);break;case"capture":case"download":s===!0?n.setAttribute(t,""):s!==!1&&s!=null&&typeof s!="function"&&typeof s!="symbol"?n.setAttribute(t,s):n.removeAttribute(t);break;case"cols":case"rows":case"size":case"span":s!=null&&typeof s!="function"&&typeof s!="symbol"&&!isNaN(s)&&1<=s?n.setAttribute(t,s):n.removeAttribute(t);break;case"rowSpan":case"start":s==null||typeof s=="function"||typeof s=="symbol"||isNaN(s)?n.removeAttribute(t):n.setAttribute(t,s);break;case"popover":Et("beforetoggle",n),Et("toggle",n),_p(n,"popover",s);break;case"xlinkActuate":ha(n,"http://www.w3.org/1999/xlink","xlink:actuate",s);break;case"xlinkArcrole":ha(n,"http://www.w3.org/1999/xlink","xlink:arcrole",s);break;case"xlinkRole":ha(n,"http://www.w3.org/1999/xlink","xlink:role",s);break;case"xlinkShow":ha(n,"http://www.w3.org/1999/xlink","xlink:show",s);break;case"xlinkTitle":ha(n,"http://www.w3.org/1999/xlink","xlink:title",s);break;case"xlinkType":ha(n,"http://www.w3.org/1999/xlink","xlink:type",s);break;case"xmlBase":ha(n,"http://www.w3.org/XML/1998/namespace","xml:base",s);break;case"xmlLang":ha(n,"http://www.w3.org/XML/1998/namespace","xml:lang",s);break;case"xmlSpace":ha(n,"http://www.w3.org/XML/1998/namespace","xml:space",s);break;case"is":_p(n,"is",s);break;case"innerText":case"textContent":break;default:(!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(t=oO.get(t)||t,_p(n,t,s))}}function b0(n,e,t,s,i,a){switch(t){case"style":hT(n,s,a);break;case"dangerouslySetInnerHTML":if(s!=null){if(typeof s!="object"||!("__html"in s))throw Error(Ae(61));if(t=s.__html,t!=null){if(i.children!=null)throw Error(Ae(60));n.innerHTML=t}}break;case"children":typeof s=="string"?Md(n,s):(typeof s=="number"||typeof s=="bigint")&&Md(n,""+s);break;case"onScroll":s!=null&&Et("scroll",n);break;case"onScrollEnd":s!=null&&Et("scrollend",n);break;case"onClick":s!=null&&(n.onclick=Ex);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!aT.hasOwnProperty(t))e:{if(t[0]==="o"&&t[1]==="n"&&(i=t.endsWith("Capture"),e=t.slice(2,i?t.length-7:void 0),a=n[vr]||null,a=a!=null?a[t]:null,typeof a=="function"&&n.removeEventListener(e,a,i),typeof s=="function")){typeof a!="function"&&a!==null&&(t in n?n[t]=null:n.hasAttribute(t)&&n.removeAttribute(t)),n.addEventListener(e,s,i);break e}t in n?n[t]=s:s===!0?n.setAttribute(t,""):_p(n,t,s)}}}function Vs(n,e,t){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Et("error",n),Et("load",n);var s=!1,i=!1,a;for(a in t)if(t.hasOwnProperty(a)){var o=t[a];if(o!=null)switch(a){case"src":s=!0;break;case"srcSet":i=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(Ae(137,e));default:dn(n,e,a,o,t,null)}}i&&dn(n,e,"srcSet",t.srcSet,t,null),s&&dn(n,e,"src",t.src,t,null);return;case"input":Et("invalid",n);var l=a=o=i=null,c=null,d=null;for(s in t)if(t.hasOwnProperty(s)){var h=t[s];if(h!=null)switch(s){case"name":i=h;break;case"type":o=h;break;case"checked":c=h;break;case"defaultChecked":d=h;break;case"value":a=h;break;case"defaultValue":l=h;break;case"children":case"dangerouslySetInnerHTML":if(h!=null)throw Error(Ae(137,e));break;default:dn(n,e,s,h,t,null)}}cT(n,a,l,c,d,o,i,!1),ag(n);return;case"select":Et("invalid",n),s=o=a=null;for(i in t)if(t.hasOwnProperty(i)&&(l=t[i],l!=null))switch(i){case"value":a=l;break;case"defaultValue":o=l;break;case"multiple":s=l;default:dn(n,e,i,l,t,null)}e=a,t=o,n.multiple=!!s,e!=null?wd(n,!!s,e,!1):t!=null&&wd(n,!!s,t,!0);return;case"textarea":Et("invalid",n),a=i=s=null;for(o in t)if(t.hasOwnProperty(o)&&(l=t[o],l!=null))switch(o){case"value":s=l;break;case"defaultValue":i=l;break;case"children":a=l;break;case"dangerouslySetInnerHTML":if(l!=null)throw Error(Ae(91));break;default:dn(n,e,o,l,t,null)}uT(n,s,i,a),ag(n);return;case"option":for(c in t)if(t.hasOwnProperty(c)&&(s=t[c],s!=null))switch(c){case"selected":n.selected=s&&typeof s!="function"&&typeof s!="symbol";break;default:dn(n,e,c,s,t,null)}return;case"dialog":Et("beforetoggle",n),Et("toggle",n),Et("cancel",n),Et("close",n);break;case"iframe":case"object":Et("load",n);break;case"video":case"audio":for(s=0;s<gm.length;s++)Et(gm[s],n);break;case"image":Et("error",n),Et("load",n);break;case"details":Et("toggle",n);break;case"embed":case"source":case"link":Et("error",n),Et("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(d in t)if(t.hasOwnProperty(d)&&(s=t[d],s!=null))switch(d){case"children":case"dangerouslySetInnerHTML":throw Error(Ae(137,e));default:dn(n,e,d,s,t,null)}return;default:if(Dw(e)){for(h in t)t.hasOwnProperty(h)&&(s=t[h],s!==void 0&&b0(n,e,h,s,t,void 0));return}}for(l in t)t.hasOwnProperty(l)&&(s=t[l],s!=null&&dn(n,e,l,s,t,null))}function RM(n,e,t,s){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var i=null,a=null,o=null,l=null,c=null,d=null,h=null;for(x in t){var f=t[x];if(t.hasOwnProperty(x)&&f!=null)switch(x){case"checked":break;case"value":break;case"defaultValue":c=f;default:s.hasOwnProperty(x)||dn(n,e,x,null,s,f)}}for(var p in s){var x=s[p];if(f=t[p],s.hasOwnProperty(p)&&(x!=null||f!=null))switch(p){case"type":a=x;break;case"name":i=x;break;case"checked":d=x;break;case"defaultChecked":h=x;break;case"value":o=x;break;case"defaultValue":l=x;break;case"children":case"dangerouslySetInnerHTML":if(x!=null)throw Error(Ae(137,e));break;default:x!==f&&dn(n,e,p,x,s,f)}}Bb(n,o,l,c,d,h,a,i);return;case"select":x=o=l=p=null;for(a in t)if(c=t[a],t.hasOwnProperty(a)&&c!=null)switch(a){case"value":break;case"multiple":x=c;default:s.hasOwnProperty(a)||dn(n,e,a,null,s,c)}for(i in s)if(a=s[i],c=t[i],s.hasOwnProperty(i)&&(a!=null||c!=null))switch(i){case"value":p=a;break;case"defaultValue":l=a;break;case"multiple":o=a;default:a!==c&&dn(n,e,i,a,s,c)}e=l,t=o,s=x,p!=null?wd(n,!!t,p,!1):!!s!=!!t&&(e!=null?wd(n,!!t,e,!0):wd(n,!!t,t?[]:"",!1));return;case"textarea":x=p=null;for(l in t)if(i=t[l],t.hasOwnProperty(l)&&i!=null&&!s.hasOwnProperty(l))switch(l){case"value":break;case"children":break;default:dn(n,e,l,null,s,i)}for(o in s)if(i=s[o],a=t[o],s.hasOwnProperty(o)&&(i!=null||a!=null))switch(o){case"value":p=i;break;case"defaultValue":x=i;break;case"children":break;case"dangerouslySetInnerHTML":if(i!=null)throw Error(Ae(91));break;default:i!==a&&dn(n,e,o,i,s,a)}dT(n,p,x);return;case"option":for(var I in t)if(p=t[I],t.hasOwnProperty(I)&&p!=null&&!s.hasOwnProperty(I))switch(I){case"selected":n.selected=!1;break;default:dn(n,e,I,null,s,p)}for(c in s)if(p=s[c],x=t[c],s.hasOwnProperty(c)&&p!==x&&(p!=null||x!=null))switch(c){case"selected":n.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:dn(n,e,c,p,s,x)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var D in t)p=t[D],t.hasOwnProperty(D)&&p!=null&&!s.hasOwnProperty(D)&&dn(n,e,D,null,s,p);for(d in s)if(p=s[d],x=t[d],s.hasOwnProperty(d)&&p!==x&&(p!=null||x!=null))switch(d){case"children":case"dangerouslySetInnerHTML":if(p!=null)throw Error(Ae(137,e));break;default:dn(n,e,d,p,s,x)}return;default:if(Dw(e)){for(var A in t)p=t[A],t.hasOwnProperty(A)&&p!==void 0&&!s.hasOwnProperty(A)&&b0(n,e,A,void 0,s,p);for(h in s)p=s[h],x=t[h],!s.hasOwnProperty(h)||p===x||p===void 0&&x===void 0||b0(n,e,h,p,s,x);return}}for(var g in t)p=t[g],t.hasOwnProperty(g)&&p!=null&&!s.hasOwnProperty(g)&&dn(n,e,g,null,s,p);for(f in s)p=s[f],x=t[f],!s.hasOwnProperty(f)||p===x||p==null&&x==null||dn(n,e,f,p,s,x)}var w0=null,v0=null;function Sg(n){return n.nodeType===9?n:n.ownerDocument}function X_(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function mC(n,e){if(n===0)switch(e){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&e==="foreignObject"?0:n}function N0(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.children=="bigint"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var ob=null;function PM(){var n=window.event;return n&&n.type==="popstate"?n===ob?!1:(ob=n,!0):(ob=null,!1)}var fC=typeof setTimeout=="function"?setTimeout:void 0,kM=typeof clearTimeout=="function"?clearTimeout:void 0,J_=typeof Promise=="function"?Promise:void 0,OM=typeof queueMicrotask=="function"?queueMicrotask:typeof J_<"u"?function(n){return J_.resolve(null).then(n).catch(MM)}:fC;function MM(n){setTimeout(function(){throw n})}function il(n){return n==="head"}function Z_(n,e){var t=e,s=0,i=0;do{var a=t.nextSibling;if(n.removeChild(t),a&&a.nodeType===8)if(t=a.data,t==="/$"){if(0<s&&8>s){t=s;var o=n.ownerDocument;if(t&1&&Gh(o.documentElement),t&2&&Gh(o.body),t&4)for(t=o.head,Gh(t),o=t.firstChild;o;){var l=o.nextSibling,c=o.nodeName;o[Gm]||c==="SCRIPT"||c==="STYLE"||c==="LINK"&&o.rel.toLowerCase()==="stylesheet"||t.removeChild(o),o=l}}if(i===0){n.removeChild(a),Nm(e);return}i--}else t==="$"||t==="$?"||t==="$!"?i++:s=t.charCodeAt(0)-48;else s=0;t=a}while(t);Nm(e)}function j0(n){var e=n.firstChild;for(e&&e.nodeType===10&&(e=e.nextSibling);e;){var t=e;switch(e=e.nextSibling,t.nodeName){case"HTML":case"HEAD":case"BODY":j0(t),Aw(t);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(t.rel.toLowerCase()==="stylesheet")continue}n.removeChild(t)}}function LM(n,e,t,s){for(;n.nodeType===1;){var i=t;if(n.nodeName.toLowerCase()!==e.toLowerCase()){if(!s&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(s){if(!n[Gm])switch(e){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(a=n.getAttribute("rel"),a==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(a!==i.rel||n.getAttribute("href")!==(i.href==null||i.href===""?null:i.href)||n.getAttribute("crossorigin")!==(i.crossOrigin==null?null:i.crossOrigin)||n.getAttribute("title")!==(i.title==null?null:i.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(a=n.getAttribute("src"),(a!==(i.src==null?null:i.src)||n.getAttribute("type")!==(i.type==null?null:i.type)||n.getAttribute("crossorigin")!==(i.crossOrigin==null?null:i.crossOrigin))&&a&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(e==="input"&&n.type==="hidden"){var a=i.name==null?null:""+i.name;if(i.type==="hidden"&&n.getAttribute("name")===a)return n}else return n;if(n=xi(n.nextSibling),n===null)break}return null}function FM(n,e,t){if(e==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!t||(n=xi(n.nextSibling),n===null))return null;return n}function _0(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState==="complete"}function UM(n,e){var t=n.ownerDocument;if(n.data!=="$?"||t.readyState==="complete")e();else{var s=function(){e(),t.removeEventListener("DOMContentLoaded",s)};t.addEventListener("DOMContentLoaded",s),n._reactRetry=s}}function xi(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?"||e==="F!"||e==="F")break;if(e==="/$")return null}}return n}var E0=null;function eE(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}function pC(n,e,t){switch(e=Sg(t),n){case"html":if(n=e.documentElement,!n)throw Error(Ae(452));return n;case"head":if(n=e.head,!n)throw Error(Ae(453));return n;case"body":if(n=e.body,!n)throw Error(Ae(454));return n;default:throw Error(Ae(451))}}function Gh(n){for(var e=n.attributes;e.length;)n.removeAttributeNode(e[0]);Aw(n)}var oi=new Map,tE=new Set;function Ig(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var Ha=Qt.d;Qt.d={f:VM,r:zM,D:$M,C:BM,L:qM,m:HM,X:QM,S:GM,M:WM};function VM(){var n=Ha.f(),e=Nx();return n||e}function zM(n){var e=pu(n);e!==null&&e.tag===5&&e.type==="form"?l1(e):Ha.r(n)}var yu=typeof document>"u"?null:document;function gC(n,e,t){var s=yu;if(s&&typeof e=="string"&&e){var i=ei(e);i='link[rel="'+n+'"][href="'+i+'"]',typeof t=="string"&&(i+='[crossorigin="'+t+'"]'),tE.has(i)||(tE.add(i),n={rel:n,crossOrigin:t,href:e},s.querySelector(i)===null&&(e=s.createElement("link"),Vs(e,"link",n),Ts(e),s.head.appendChild(e)))}}function $M(n){Ha.D(n),gC("dns-prefetch",n,null)}function BM(n,e){Ha.C(n,e),gC("preconnect",n,e)}function qM(n,e,t){Ha.L(n,e,t);var s=yu;if(s&&n&&e){var i='link[rel="preload"][as="'+ei(e)+'"]';e==="image"&&t&&t.imageSrcSet?(i+='[imagesrcset="'+ei(t.imageSrcSet)+'"]',typeof t.imageSizes=="string"&&(i+='[imagesizes="'+ei(t.imageSizes)+'"]')):i+='[href="'+ei(n)+'"]';var a=i;switch(e){case"style":a=qd(n);break;case"script":a=bu(n)}oi.has(a)||(n=Sn({rel:"preload",href:e==="image"&&t&&t.imageSrcSet?void 0:n,as:e},t),oi.set(a,n),s.querySelector(i)!==null||e==="style"&&s.querySelector(nf(a))||e==="script"&&s.querySelector(sf(a))||(e=s.createElement("link"),Vs(e,"link",n),Ts(e),s.head.appendChild(e)))}}function HM(n,e){Ha.m(n,e);var t=yu;if(t&&n){var s=e&&typeof e.as=="string"?e.as:"script",i='link[rel="modulepreload"][as="'+ei(s)+'"][href="'+ei(n)+'"]',a=i;switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":a=bu(n)}if(!oi.has(a)&&(n=Sn({rel:"modulepreload",href:n},e),oi.set(a,n),t.querySelector(i)===null)){switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(t.querySelector(sf(a)))return}s=t.createElement("link"),Vs(s,"link",n),Ts(s),t.head.appendChild(s)}}}function GM(n,e,t){Ha.S(n,e,t);var s=yu;if(s&&n){var i=bd(s).hoistableStyles,a=qd(n);e=e||"default";var o=i.get(a);if(!o){var l={loading:0,preload:null};if(o=s.querySelector(nf(a)))l.loading=5;else{n=Sn({rel:"stylesheet",href:n,"data-precedence":e},t),(t=oi.get(a))&&mv(n,t);var c=o=s.createElement("link");Ts(c),Vs(c,"link",n),c._p=new Promise(function(d,h){c.onload=d,c.onerror=h}),c.addEventListener("load",function(){l.loading|=1}),c.addEventListener("error",function(){l.loading|=2}),l.loading|=4,kp(o,e,s)}o={type:"stylesheet",instance:o,count:1,state:l},i.set(a,o)}}}function QM(n,e){Ha.X(n,e);var t=yu;if(t&&n){var s=bd(t).hoistableScripts,i=bu(n),a=s.get(i);a||(a=t.querySelector(sf(i)),a||(n=Sn({src:n,async:!0},e),(e=oi.get(i))&&fv(n,e),a=t.createElement("script"),Ts(a),Vs(a,"link",n),t.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},s.set(i,a))}}function WM(n,e){Ha.M(n,e);var t=yu;if(t&&n){var s=bd(t).hoistableScripts,i=bu(n),a=s.get(i);a||(a=t.querySelector(sf(i)),a||(n=Sn({src:n,async:!0,type:"module"},e),(e=oi.get(i))&&fv(n,e),a=t.createElement("script"),Ts(a),Vs(a,"link",n),t.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},s.set(i,a))}}function nE(n,e,t,s){var i=(i=Oo.current)?Ig(i):null;if(!i)throw Error(Ae(446));switch(n){case"meta":case"title":return null;case"style":return typeof t.precedence=="string"&&typeof t.href=="string"?(e=qd(t.href),t=bd(i).hoistableStyles,s=t.get(e),s||(s={type:"style",instance:null,count:0,state:null},t.set(e,s)),s):{type:"void",instance:null,count:0,state:null};case"link":if(t.rel==="stylesheet"&&typeof t.href=="string"&&typeof t.precedence=="string"){n=qd(t.href);var a=bd(i).hoistableStyles,o=a.get(n);if(o||(i=i.ownerDocument||i,o={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},a.set(n,o),(a=i.querySelector(nf(n)))&&!a._p&&(o.instance=a,o.state.loading=5),oi.has(n)||(t={rel:"preload",as:"style",href:t.href,crossOrigin:t.crossOrigin,integrity:t.integrity,media:t.media,hrefLang:t.hrefLang,referrerPolicy:t.referrerPolicy},oi.set(n,t),a||KM(i,n,t,o.state))),e&&s===null)throw Error(Ae(528,""));return o}if(e&&s!==null)throw Error(Ae(529,""));return null;case"script":return e=t.async,t=t.src,typeof t=="string"&&e&&typeof e!="function"&&typeof e!="symbol"?(e=bu(t),t=bd(i).hoistableScripts,s=t.get(e),s||(s={type:"script",instance:null,count:0,state:null},t.set(e,s)),s):{type:"void",instance:null,count:0,state:null};default:throw Error(Ae(444,n))}}function qd(n){return'href="'+ei(n)+'"'}function nf(n){return'link[rel="stylesheet"]['+n+"]"}function xC(n){return Sn({},n,{"data-precedence":n.precedence,precedence:null})}function KM(n,e,t,s){n.querySelector('link[rel="preload"][as="style"]['+e+"]")?s.loading=1:(e=n.createElement("link"),s.preload=e,e.addEventListener("load",function(){return s.loading|=1}),e.addEventListener("error",function(){return s.loading|=2}),Vs(e,"link",t),Ts(e),n.head.appendChild(e))}function bu(n){return'[src="'+ei(n)+'"]'}function sf(n){return"script[async]"+n}function sE(n,e,t){if(e.count++,e.instance===null)switch(e.type){case"style":var s=n.querySelector('style[data-href~="'+ei(t.href)+'"]');if(s)return e.instance=s,Ts(s),s;var i=Sn({},t,{"data-href":t.href,"data-precedence":t.precedence,href:null,precedence:null});return s=(n.ownerDocument||n).createElement("style"),Ts(s),Vs(s,"style",i),kp(s,t.precedence,n),e.instance=s;case"stylesheet":i=qd(t.href);var a=n.querySelector(nf(i));if(a)return e.state.loading|=4,e.instance=a,Ts(a),a;s=xC(t),(i=oi.get(i))&&mv(s,i),a=(n.ownerDocument||n).createElement("link"),Ts(a);var o=a;return o._p=new Promise(function(l,c){o.onload=l,o.onerror=c}),Vs(a,"link",s),e.state.loading|=4,kp(a,t.precedence,n),e.instance=a;case"script":return a=bu(t.src),(i=n.querySelector(sf(a)))?(e.instance=i,Ts(i),i):(s=t,(i=oi.get(a))&&(s=Sn({},t),fv(s,i)),n=n.ownerDocument||n,i=n.createElement("script"),Ts(i),Vs(i,"link",s),n.head.appendChild(i),e.instance=i);case"void":return null;default:throw Error(Ae(443,e.type))}else e.type==="stylesheet"&&!(e.state.loading&4)&&(s=e.instance,e.state.loading|=4,kp(s,t.precedence,n));return e.instance}function kp(n,e,t){for(var s=t.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),i=s.length?s[s.length-1]:null,a=i,o=0;o<s.length;o++){var l=s[o];if(l.dataset.precedence===e)a=l;else if(a!==i)break}a?a.parentNode.insertBefore(n,a.nextSibling):(e=t.nodeType===9?t.head:t,e.insertBefore(n,e.firstChild))}function mv(n,e){n.crossOrigin==null&&(n.crossOrigin=e.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=e.referrerPolicy),n.title==null&&(n.title=e.title)}function fv(n,e){n.crossOrigin==null&&(n.crossOrigin=e.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=e.referrerPolicy),n.integrity==null&&(n.integrity=e.integrity)}var Op=null;function rE(n,e,t){if(Op===null){var s=new Map,i=Op=new Map;i.set(t,s)}else i=Op,s=i.get(t),s||(s=new Map,i.set(t,s));if(s.has(n))return s;for(s.set(n,null),t=t.getElementsByTagName(n),i=0;i<t.length;i++){var a=t[i];if(!(a[Gm]||a[Gs]||n==="link"&&a.getAttribute("rel")==="stylesheet")&&a.namespaceURI!=="http://www.w3.org/2000/svg"){var o=a.getAttribute(e)||"";o=n+o;var l=s.get(o);l?l.push(a):s.set(o,[a])}}return s}function iE(n,e,t){n=n.ownerDocument||n,n.head.insertBefore(t,e==="title"?n.querySelector("head > title"):null)}function YM(n,e,t){if(t===1||e.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof e.precedence!="string"||typeof e.href!="string"||e.href==="")break;return!0;case"link":if(typeof e.rel!="string"||typeof e.href!="string"||e.href===""||e.onLoad||e.onError)break;switch(e.rel){case"stylesheet":return n=e.disabled,typeof e.precedence=="string"&&n==null;default:return!0}case"script":if(e.async&&typeof e.async!="function"&&typeof e.async!="symbol"&&!e.onLoad&&!e.onError&&e.src&&typeof e.src=="string")return!0}return!1}function yC(n){return!(n.type==="stylesheet"&&!(n.state.loading&3))}var ym=null;function XM(){}function JM(n,e,t){if(ym===null)throw Error(Ae(475));var s=ym;if(e.type==="stylesheet"&&(typeof t.media!="string"||matchMedia(t.media).matches!==!1)&&!(e.state.loading&4)){if(e.instance===null){var i=qd(t.href),a=n.querySelector(nf(i));if(a){n=a._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(s.count++,s=Tg.bind(s),n.then(s,s)),e.state.loading|=4,e.instance=a,Ts(a);return}a=n.ownerDocument||n,t=xC(t),(i=oi.get(i))&&mv(t,i),a=a.createElement("link"),Ts(a);var o=a;o._p=new Promise(function(l,c){o.onload=l,o.onerror=c}),Vs(a,"link",t),e.instance=a}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(e,n),(n=e.state.preload)&&!(e.state.loading&3)&&(s.count++,e=Tg.bind(s),n.addEventListener("load",e),n.addEventListener("error",e))}}function ZM(){if(ym===null)throw Error(Ae(475));var n=ym;return n.stylesheets&&n.count===0&&S0(n,n.stylesheets),0<n.count?function(e){var t=setTimeout(function(){if(n.stylesheets&&S0(n,n.stylesheets),n.unsuspend){var s=n.unsuspend;n.unsuspend=null,s()}},6e4);return n.unsuspend=e,function(){n.unsuspend=null,clearTimeout(t)}}:null}function Tg(){if(this.count--,this.count===0){if(this.stylesheets)S0(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var Cg=null;function S0(n,e){n.stylesheets=null,n.unsuspend!==null&&(n.count++,Cg=new Map,e.forEach(eL,n),Cg=null,Tg.call(n))}function eL(n,e){if(!(e.state.loading&4)){var t=Cg.get(n);if(t)var s=t.get(null);else{t=new Map,Cg.set(n,t);for(var i=n.querySelectorAll("link[data-precedence],style[data-precedence]"),a=0;a<i.length;a++){var o=i[a];(o.nodeName==="LINK"||o.getAttribute("media")!=="not all")&&(t.set(o.dataset.precedence,o),s=o)}s&&t.set(null,s)}i=e.instance,o=i.getAttribute("data-precedence"),a=t.get(o)||s,a===s&&t.set(null,i),t.set(o,i),this.count++,s=Tg.bind(this),i.addEventListener("load",s),i.addEventListener("error",s),a?a.parentNode.insertBefore(i,a.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(i,n.firstChild)),e.state.loading|=4}}var bm={$$typeof:ba,Provider:null,Consumer:null,_currentValue:Kl,_currentValue2:Kl,_threadCount:0};function tL(n,e,t,s,i,a,o,l){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Cy(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Cy(0),this.hiddenUpdates=Cy(null),this.identifierPrefix=s,this.onUncaughtError=i,this.onCaughtError=a,this.onRecoverableError=o,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=l,this.incompleteTransitions=new Map}function bC(n,e,t,s,i,a,o,l,c,d,h,f){return n=new tL(n,e,t,o,l,c,d,f),e=1,a===!0&&(e|=24),a=Rr(3,null,null,e),n.current=a,a.stateNode=n,e=$w(),e.refCount++,n.pooledCache=e,e.refCount++,a.memoizedState={element:s,isDehydrated:t,cache:e},qw(a),n}function wC(n){return n?(n=md,n):md}function vC(n,e,t,s,i,a){i=wC(i),s.context===null?s.context=i:s.pendingContext=i,s=Mo(e),s.payload={element:t},a=a===void 0?null:a,a!==null&&(s.callback=a),t=Lo(n,s,e),t!==null&&(Ur(t,n,e),Fh(t,n,e))}function aE(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function pv(n,e){aE(n,e),(n=n.alternate)&&aE(n,e)}function NC(n){if(n.tag===13){var e=gu(n,67108864);e!==null&&Ur(e,n,67108864),pv(n,67108864)}}var Ag=!0;function nL(n,e,t,s){var i=ht.T;ht.T=null;var a=Qt.p;try{Qt.p=2,gv(n,e,t,s)}finally{Qt.p=a,ht.T=i}}function sL(n,e,t,s){var i=ht.T;ht.T=null;var a=Qt.p;try{Qt.p=8,gv(n,e,t,s)}finally{Qt.p=a,ht.T=i}}function gv(n,e,t,s){if(Ag){var i=I0(s);if(i===null)ab(n,e,s,Dg,t),oE(n,s);else if(iL(i,n,e,t,s))s.stopPropagation();else if(oE(n,s),e&4&&-1<rL.indexOf(n)){for(;i!==null;){var a=pu(i);if(a!==null)switch(a.tag){case 3:if(a=a.stateNode,a.current.memoizedState.isDehydrated){var o=Ll(a.pendingLanes);if(o!==0){var l=a;for(l.pendingLanes|=2,l.entangledLanes|=2;o;){var c=1<<31-Lr(o);l.entanglements[1]|=c,o&=~c}Zi(a),!(nn&6)&&(vg=zi()+500,tf(0))}}break;case 13:l=gu(a,2),l!==null&&Ur(l,a,2),Nx(),pv(a,2)}if(a=I0(s),a===null&&ab(n,e,s,Dg,t),a===i)break;i=a}i!==null&&s.stopPropagation()}else ab(n,e,s,null,t)}}function I0(n){return n=Rw(n),xv(n)}var Dg=null;function xv(n){if(Dg=null,n=od(n),n!==null){var e=$m(n);if(e===null)n=null;else{var t=e.tag;if(t===13){if(n=QI(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null)}}return Dg=n,null}function jC(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Bk()){case XI:return 2;case JI:return 8;case ig:case qk:return 32;case ZI:return 268435456;default:return 32}default:return 32}}var T0=!1,Vo=null,zo=null,$o=null,wm=new Map,vm=new Map,No=[],rL="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function oE(n,e){switch(n){case"focusin":case"focusout":Vo=null;break;case"dragenter":case"dragleave":zo=null;break;case"mouseover":case"mouseout":$o=null;break;case"pointerover":case"pointerout":wm.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":vm.delete(e.pointerId)}}function mh(n,e,t,s,i,a){return n===null||n.nativeEvent!==a?(n={blockedOn:e,domEventName:t,eventSystemFlags:s,nativeEvent:a,targetContainers:[i]},e!==null&&(e=pu(e),e!==null&&NC(e)),n):(n.eventSystemFlags|=s,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function iL(n,e,t,s,i){switch(e){case"focusin":return Vo=mh(Vo,n,e,t,s,i),!0;case"dragenter":return zo=mh(zo,n,e,t,s,i),!0;case"mouseover":return $o=mh($o,n,e,t,s,i),!0;case"pointerover":var a=i.pointerId;return wm.set(a,mh(wm.get(a)||null,n,e,t,s,i)),!0;case"gotpointercapture":return a=i.pointerId,vm.set(a,mh(vm.get(a)||null,n,e,t,s,i)),!0}return!1}function _C(n){var e=od(n.target);if(e!==null){var t=$m(e);if(t!==null){if(e=t.tag,e===13){if(e=QI(t),e!==null){n.blockedOn=e,Jk(n.priority,function(){if(t.tag===13){var s=Fr();s=Tw(s);var i=gu(t,s);i!==null&&Ur(i,t,s),pv(t,s)}});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Mp(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=I0(n.nativeEvent);if(t===null){t=n.nativeEvent;var s=new t.constructor(t.type,t);Hb=s,t.target.dispatchEvent(s),Hb=null}else return e=pu(t),e!==null&&NC(e),n.blockedOn=t,!1;e.shift()}return!0}function lE(n,e,t){Mp(n)&&t.delete(e)}function aL(){T0=!1,Vo!==null&&Mp(Vo)&&(Vo=null),zo!==null&&Mp(zo)&&(zo=null),$o!==null&&Mp($o)&&($o=null),wm.forEach(lE),vm.forEach(lE)}function dp(n,e){n.blockedOn===e&&(n.blockedOn=null,T0||(T0=!0,fs.unstable_scheduleCallback(fs.unstable_NormalPriority,aL)))}var up=null;function cE(n){up!==n&&(up=n,fs.unstable_scheduleCallback(fs.unstable_NormalPriority,function(){up===n&&(up=null);for(var e=0;e<n.length;e+=3){var t=n[e],s=n[e+1],i=n[e+2];if(typeof s!="function"){if(xv(s||t)===null)continue;break}var a=pu(t);a!==null&&(n.splice(e,3),e-=3,o0(a,{pending:!0,data:i,method:t.method,action:s},s,i))}}))}function Nm(n){function e(c){return dp(c,n)}Vo!==null&&dp(Vo,n),zo!==null&&dp(zo,n),$o!==null&&dp($o,n),wm.forEach(e),vm.forEach(e);for(var t=0;t<No.length;t++){var s=No[t];s.blockedOn===n&&(s.blockedOn=null)}for(;0<No.length&&(t=No[0],t.blockedOn===null);)_C(t),t.blockedOn===null&&No.shift();if(t=(n.ownerDocument||n).$$reactFormReplay,t!=null)for(s=0;s<t.length;s+=3){var i=t[s],a=t[s+1],o=i[vr]||null;if(typeof a=="function")o||cE(t);else if(o){var l=null;if(a&&a.hasAttribute("formAction")){if(i=a,o=a[vr]||null)l=o.formAction;else if(xv(i)!==null)continue}else l=o.action;typeof l=="function"?t[s+1]=l:(t.splice(s,3),s-=3),cE(t)}}}function yv(n){this._internalRoot=n}Sx.prototype.render=yv.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Ae(409));var t=e.current,s=Fr();vC(t,s,n,e,null,null)};Sx.prototype.unmount=yv.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;vC(n.current,2,null,n,null,null),Nx(),e[fu]=null}};function Sx(n){this._internalRoot=n}Sx.prototype.unstable_scheduleHydration=function(n){if(n){var e=rT();n={blockedOn:null,target:n,priority:e};for(var t=0;t<No.length&&e!==0&&e<No[t].priority;t++);No.splice(t,0,n),t===0&&_C(n)}};var dE=HI.version;if(dE!=="19.1.1")throw Error(Ae(527,dE,"19.1.1"));Qt.findDOMNode=function(n){var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Ae(188)):(n=Object.keys(n).join(","),Error(Ae(268,n)));return n=Mk(e),n=n!==null?WI(n):null,n=n===null?null:n.stateNode,n};var oL={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:ht,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var hp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!hp.isDisabled&&hp.supportsFiber)try{Bm=hp.inject(oL),Mr=hp}catch{}}dx.createRoot=function(n,e){if(!GI(n))throw Error(Ae(299));var t=!1,s="",i=b1,a=w1,o=v1,l=null;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onUncaughtError!==void 0&&(i=e.onUncaughtError),e.onCaughtError!==void 0&&(a=e.onCaughtError),e.onRecoverableError!==void 0&&(o=e.onRecoverableError),e.unstable_transitionCallbacks!==void 0&&(l=e.unstable_transitionCallbacks)),e=bC(n,1,!1,null,null,t,s,i,a,o,l,null),n[fu]=e.current,hv(n),new yv(e)};dx.hydrateRoot=function(n,e,t){if(!GI(n))throw Error(Ae(299));var s=!1,i="",a=b1,o=w1,l=v1,c=null,d=null;return t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onUncaughtError!==void 0&&(a=t.onUncaughtError),t.onCaughtError!==void 0&&(o=t.onCaughtError),t.onRecoverableError!==void 0&&(l=t.onRecoverableError),t.unstable_transitionCallbacks!==void 0&&(c=t.unstable_transitionCallbacks),t.formState!==void 0&&(d=t.formState)),e=bC(n,1,!0,e,t??null,s,i,a,o,l,c,d),e.context=wC(null),t=e.current,s=Fr(),s=Tw(s),i=Mo(s),i.callback=null,Lo(t,i,s),t=s,e.current.lanes=t,Hm(e,t),Zi(e),n[fu]=e.current,hv(n),new Sx(e)};dx.version="19.1.1";function EC(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(EC)}catch(n){console.error(n)}}EC(),UI.exports=dx;var lL=UI.exports;const cL=TI(lL);/**
 * react-router v7.8.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var uE="popstate";function dL(n={}){function e(s,i){let{pathname:a,search:o,hash:l}=s.location;return C0("",{pathname:a,search:o,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(s,i){return typeof i=="string"?i:jm(i)}return hL(e,t,null,n)}function zn(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Yi(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function uL(){return Math.random().toString(36).substring(2,10)}function hE(n,e){return{usr:n.state,key:n.key,idx:e}}function C0(n,e,t=null,s){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?wu(e):e,state:t,key:e&&e.key||s||uL()}}function jm({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function wu(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let s=n.indexOf("?");s>=0&&(e.search=n.substring(s),n=n.substring(0,s)),n&&(e.pathname=n)}return e}function hL(n,e,t,s={}){let{window:i=document.defaultView,v5Compat:a=!1}=s,o=i.history,l="POP",c=null,d=h();d==null&&(d=0,o.replaceState({...o.state,idx:d},""));function h(){return(o.state||{idx:null}).idx}function f(){l="POP";let A=h(),g=A==null?null:A-d;d=A,c&&c({action:l,location:D.location,delta:g})}function p(A,g){l="PUSH";let N=C0(D.location,A,g);d=h()+1;let j=hE(N,d),V=D.createHref(N);try{o.pushState(j,"",V)}catch($){if($ instanceof DOMException&&$.name==="DataCloneError")throw $;i.location.assign(V)}a&&c&&c({action:l,location:D.location,delta:1})}function x(A,g){l="REPLACE";let N=C0(D.location,A,g);d=h();let j=hE(N,d),V=D.createHref(N);o.replaceState(j,"",V),a&&c&&c({action:l,location:D.location,delta:0})}function I(A){return mL(A)}let D={get action(){return l},get location(){return n(i,o)},listen(A){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(uE,f),c=A,()=>{i.removeEventListener(uE,f),c=null}},createHref(A){return e(i,A)},createURL:I,encodeLocation(A){let g=I(A);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:p,replace:x,go(A){return o.go(A)}};return D}function mL(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),zn(t,"No window.location.(origin|href) available to create URL");let s=typeof n=="string"?n:jm(n);return s=s.replace(/ $/,"%20"),!e&&s.startsWith("//")&&(s=t+s),new URL(s,t)}function SC(n,e,t="/"){return fL(n,e,t,!1)}function fL(n,e,t,s){let i=typeof e=="string"?wu(e):e,a=Ua(i.pathname||"/",t);if(a==null)return null;let o=IC(n);pL(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let d=SL(a);l=_L(o[c],d,s)}return l}function IC(n,e=[],t=[],s="",i=!1){let a=(o,l,c=i,d)=>{let h={relativePath:d===void 0?o.path||"":d,caseSensitive:o.caseSensitive===!0,childrenIndex:l,route:o};if(h.relativePath.startsWith("/")){if(!h.relativePath.startsWith(s)&&c)return;zn(h.relativePath.startsWith(s),`Absolute route path "${h.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),h.relativePath=h.relativePath.slice(s.length)}let f=Ra([s,h.relativePath]),p=t.concat(h);o.children&&o.children.length>0&&(zn(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${f}".`),IC(o.children,e,p,f,c)),!(o.path==null&&!o.index)&&e.push({path:f,score:NL(f,o.index),routesMeta:p})};return n.forEach((o,l)=>{var c;if(o.path===""||!((c=o.path)!=null&&c.includes("?")))a(o,l);else for(let d of TC(o.path))a(o,l,!0,d)}),e}function TC(n){let e=n.split("/");if(e.length===0)return[];let[t,...s]=e,i=t.endsWith("?"),a=t.replace(/\?$/,"");if(s.length===0)return i?[a,""]:[a];let o=TC(s.join("/")),l=[];return l.push(...o.map(c=>c===""?a:[a,c].join("/"))),i&&l.push(...o),l.map(c=>n.startsWith("/")&&c===""?"/":c)}function pL(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:jL(e.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}var gL=/^:[\w-]+$/,xL=3,yL=2,bL=1,wL=10,vL=-2,mE=n=>n==="*";function NL(n,e){let t=n.split("/"),s=t.length;return t.some(mE)&&(s+=vL),e&&(s+=yL),t.filter(i=>!mE(i)).reduce((i,a)=>i+(gL.test(a)?xL:a===""?bL:wL),s)}function jL(n,e){return n.length===e.length&&n.slice(0,-1).every((s,i)=>s===e[i])?n[n.length-1]-e[e.length-1]:0}function _L(n,e,t=!1){let{routesMeta:s}=n,i={},a="/",o=[];for(let l=0;l<s.length;++l){let c=s[l],d=l===s.length-1,h=a==="/"?e:e.slice(a.length)||"/",f=Rg({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},h),p=c.route;if(!f&&d&&t&&!s[s.length-1].route.index&&(f=Rg({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},h)),!f)return null;Object.assign(i,f.params),o.push({params:i,pathname:Ra([a,f.pathname]),pathnameBase:AL(Ra([a,f.pathnameBase])),route:p}),f.pathnameBase!=="/"&&(a=Ra([a,f.pathnameBase]))}return o}function Rg(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,s]=EL(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let a=i[0],o=a.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:s.reduce((d,{paramName:h,isOptional:f},p)=>{if(h==="*"){let I=l[p]||"";o=a.slice(0,a.length-I.length).replace(/(.)\/+$/,"$1")}const x=l[p];return f&&!x?d[h]=void 0:d[h]=(x||"").replace(/%2F/g,"/"),d},{}),pathname:a,pathnameBase:o,pattern:n}}function EL(n,e=!1,t=!0){Yi(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let s=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(s.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(s.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),s]}function SL(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Yi(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Ua(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=n.charAt(t);return s&&s!=="/"?null:n.slice(t)||"/"}function IL(n,e="/"){let{pathname:t,search:s="",hash:i=""}=typeof n=="string"?wu(n):n;return{pathname:t?t.startsWith("/")?t:TL(t,e):e,search:DL(s),hash:RL(i)}}function TL(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function lb(n,e,t,s){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function CL(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function CC(n){let e=CL(n);return e.map((t,s)=>s===e.length-1?t.pathname:t.pathnameBase)}function AC(n,e,t,s=!1){let i;typeof n=="string"?i=wu(n):(i={...n},zn(!i.pathname||!i.pathname.includes("?"),lb("?","pathname","search",i)),zn(!i.pathname||!i.pathname.includes("#"),lb("#","pathname","hash",i)),zn(!i.search||!i.search.includes("#"),lb("#","search","hash",i)));let a=n===""||i.pathname==="",o=a?"/":i.pathname,l;if(o==null)l=t;else{let f=e.length-1;if(!s&&o.startsWith("..")){let p=o.split("/");for(;p[0]==="..";)p.shift(),f-=1;i.pathname=p.join("/")}l=f>=0?e[f]:"/"}let c=IL(i,l),d=o&&o!=="/"&&o.endsWith("/"),h=(a||o===".")&&t.endsWith("/");return!c.pathname.endsWith("/")&&(d||h)&&(c.pathname+="/"),c}var Ra=n=>n.join("/").replace(/\/\/+/g,"/"),AL=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),DL=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,RL=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function PL(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var DC=["POST","PUT","PATCH","DELETE"];new Set(DC);var kL=["GET",...DC];new Set(kL);var vu=b.createContext(null);vu.displayName="DataRouter";var Ix=b.createContext(null);Ix.displayName="DataRouterState";b.createContext(!1);var RC=b.createContext({isTransitioning:!1});RC.displayName="ViewTransition";var OL=b.createContext(new Map);OL.displayName="Fetchers";var ML=b.createContext(null);ML.displayName="Await";var ea=b.createContext(null);ea.displayName="Navigation";var rf=b.createContext(null);rf.displayName="Location";var ta=b.createContext({outlet:null,matches:[],isDataRoute:!1});ta.displayName="Route";var bv=b.createContext(null);bv.displayName="RouteError";function LL(n,{relative:e}={}){zn(af(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:s}=b.useContext(ea),{hash:i,pathname:a,search:o}=of(n,{relative:e}),l=a;return t!=="/"&&(l=a==="/"?t:Ra([t,a])),s.createHref({pathname:l,search:o,hash:i})}function af(){return b.useContext(rf)!=null}function Ga(){return zn(af(),"useLocation() may be used only in the context of a <Router> component."),b.useContext(rf).location}var PC="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function kC(n){b.useContext(ea).static||b.useLayoutEffect(n)}function On(){let{isDataRoute:n}=b.useContext(ta);return n?YL():FL()}function FL(){zn(af(),"useNavigate() may be used only in the context of a <Router> component.");let n=b.useContext(vu),{basename:e,navigator:t}=b.useContext(ea),{matches:s}=b.useContext(ta),{pathname:i}=Ga(),a=JSON.stringify(CC(s)),o=b.useRef(!1);return kC(()=>{o.current=!0}),b.useCallback((c,d={})=>{if(Yi(o.current,PC),!o.current)return;if(typeof c=="number"){t.go(c);return}let h=AC(c,JSON.parse(a),i,d.relative==="path");n==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:Ra([e,h.pathname])),(d.replace?t.replace:t.push)(h,d.state,d)},[e,t,a,i,n])}b.createContext(null);function li(){let{matches:n}=b.useContext(ta),e=n[n.length-1];return e?e.params:{}}function of(n,{relative:e}={}){let{matches:t}=b.useContext(ta),{pathname:s}=Ga(),i=JSON.stringify(CC(t));return b.useMemo(()=>AC(n,JSON.parse(i),s,e==="path"),[n,i,s,e])}function UL(n,e){return OC(n,e)}function OC(n,e,t,s){var g;zn(af(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=b.useContext(ea),{matches:a}=b.useContext(ta),o=a[a.length-1],l=o?o.params:{},c=o?o.pathname:"/",d=o?o.pathnameBase:"/",h=o&&o.route;{let N=h&&h.path||"";MC(c,!h||N.endsWith("*")||N.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${N}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${N}"> to <Route path="${N==="/"?"*":`${N}/*`}">.`)}let f=Ga(),p;if(e){let N=typeof e=="string"?wu(e):e;zn(d==="/"||((g=N.pathname)==null?void 0:g.startsWith(d)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${N.pathname}" was given in the \`location\` prop.`),p=N}else p=f;let x=p.pathname||"/",I=x;if(d!=="/"){let N=d.replace(/^\//,"").split("/");I="/"+x.replace(/^\//,"").split("/").slice(N.length).join("/")}let D=SC(n,{pathname:I});Yi(h||D!=null,`No routes matched location "${p.pathname}${p.search}${p.hash}" `),Yi(D==null||D[D.length-1].route.element!==void 0||D[D.length-1].route.Component!==void 0||D[D.length-1].route.lazy!==void 0,`Matched leaf route at location "${p.pathname}${p.search}${p.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let A=qL(D&&D.map(N=>Object.assign({},N,{params:Object.assign({},l,N.params),pathname:Ra([d,i.encodeLocation?i.encodeLocation(N.pathname).pathname:N.pathname]),pathnameBase:N.pathnameBase==="/"?d:Ra([d,i.encodeLocation?i.encodeLocation(N.pathnameBase).pathname:N.pathnameBase])})),a,t,s);return e&&A?b.createElement(rf.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...p},navigationType:"POP"}},A):A}function VL(){let n=KL(),e=PL(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:s},a={padding:"2px 4px",backgroundColor:s},o=null;return console.error("Error handled by React Router default ErrorBoundary:",n),o=b.createElement(b.Fragment,null,b.createElement("p",null," Hey developer "),b.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",b.createElement("code",{style:a},"ErrorBoundary")," or"," ",b.createElement("code",{style:a},"errorElement")," prop on your route.")),b.createElement(b.Fragment,null,b.createElement("h2",null,"Unexpected Application Error!"),b.createElement("h3",{style:{fontStyle:"italic"}},e),t?b.createElement("pre",{style:i},t):null,o)}var zL=b.createElement(VL,null),$L=class extends b.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){console.error("React Router caught the following error during render",n,e)}render(){return this.state.error!==void 0?b.createElement(ta.Provider,{value:this.props.routeContext},b.createElement(bv.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function BL({routeContext:n,match:e,children:t}){let s=b.useContext(vu);return s&&s.static&&s.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=e.route.id),b.createElement(ta.Provider,{value:n},t)}function qL(n,e=[],t=null,s=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let i=n,a=t==null?void 0:t.errors;if(a!=null){let c=i.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id])!==void 0);zn(c>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),i=i.slice(0,Math.min(i.length,c+1))}let o=!1,l=-1;if(t)for(let c=0;c<i.length;c++){let d=i[c];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(l=c),d.route.id){let{loaderData:h,errors:f}=t,p=d.route.loader&&!h.hasOwnProperty(d.route.id)&&(!f||f[d.route.id]===void 0);if(d.route.lazy||p){o=!0,l>=0?i=i.slice(0,l+1):i=[i[0]];break}}}return i.reduceRight((c,d,h)=>{let f,p=!1,x=null,I=null;t&&(f=a&&d.route.id?a[d.route.id]:void 0,x=d.route.errorElement||zL,o&&(l<0&&h===0?(MC("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),p=!0,I=null):l===h&&(p=!0,I=d.route.hydrateFallbackElement||null)));let D=e.concat(i.slice(0,h+1)),A=()=>{let g;return f?g=x:p?g=I:d.route.Component?g=b.createElement(d.route.Component,null):d.route.element?g=d.route.element:g=c,b.createElement(BL,{match:d,routeContext:{outlet:c,matches:D,isDataRoute:t!=null},children:g})};return t&&(d.route.ErrorBoundary||d.route.errorElement||h===0)?b.createElement($L,{location:t.location,revalidation:t.revalidation,component:x,error:f,children:A(),routeContext:{outlet:null,matches:D,isDataRoute:!0}}):A()},null)}function wv(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function HL(n){let e=b.useContext(vu);return zn(e,wv(n)),e}function GL(n){let e=b.useContext(Ix);return zn(e,wv(n)),e}function QL(n){let e=b.useContext(ta);return zn(e,wv(n)),e}function vv(n){let e=QL(n),t=e.matches[e.matches.length-1];return zn(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function WL(){return vv("useRouteId")}function KL(){var s;let n=b.useContext(bv),e=GL("useRouteError"),t=vv("useRouteError");return n!==void 0?n:(s=e.errors)==null?void 0:s[t]}function YL(){let{router:n}=HL("useNavigate"),e=vv("useNavigate"),t=b.useRef(!1);return kC(()=>{t.current=!0}),b.useCallback(async(i,a={})=>{Yi(t.current,PC),t.current&&(typeof i=="number"?n.navigate(i):await n.navigate(i,{fromRouteId:e,...a}))},[n,e])}var fE={};function MC(n,e,t){!e&&!fE[n]&&(fE[n]=!0,Yi(!1,t))}b.memo(XL);function XL({routes:n,future:e,state:t}){return OC(n,void 0,t,e)}function Ut(n){zn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function JL({basename:n="/",children:e=null,location:t,navigationType:s="POP",navigator:i,static:a=!1}){zn(!af(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=n.replace(/^\/*/,"/"),l=b.useMemo(()=>({basename:o,navigator:i,static:a,future:{}}),[o,i,a]);typeof t=="string"&&(t=wu(t));let{pathname:c="/",search:d="",hash:h="",state:f=null,key:p="default"}=t,x=b.useMemo(()=>{let I=Ua(c,o);return I==null?null:{location:{pathname:I,search:d,hash:h,state:f,key:p},navigationType:s}},[o,c,d,h,f,p,s]);return Yi(x!=null,`<Router basename="${o}"> is not able to match the URL "${c}${d}${h}" because it does not start with the basename, so the <Router> won't render anything.`),x==null?null:b.createElement(ea.Provider,{value:l},b.createElement(rf.Provider,{children:e,value:x}))}function ZL({children:n,location:e}){return UL(A0(n),e)}function A0(n,e=[]){let t=[];return b.Children.forEach(n,(s,i)=>{if(!b.isValidElement(s))return;let a=[...e,i];if(s.type===b.Fragment){t.push.apply(t,A0(s.props.children,a));return}zn(s.type===Ut,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),zn(!s.props.index||!s.props.children,"An index route cannot have child routes.");let o={id:s.props.id||a.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(o.children=A0(s.props.children,a)),t.push(o)}),t}var Lp="get",Fp="application/x-www-form-urlencoded";function Tx(n){return n!=null&&typeof n.tagName=="string"}function e3(n){return Tx(n)&&n.tagName.toLowerCase()==="button"}function t3(n){return Tx(n)&&n.tagName.toLowerCase()==="form"}function n3(n){return Tx(n)&&n.tagName.toLowerCase()==="input"}function s3(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function r3(n,e){return n.button===0&&(!e||e==="_self")&&!s3(n)}var mp=null;function i3(){if(mp===null)try{new FormData(document.createElement("form"),0),mp=!1}catch{mp=!0}return mp}var a3=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function cb(n){return n!=null&&!a3.has(n)?(Yi(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Fp}"`),null):n}function o3(n,e){let t,s,i,a,o;if(t3(n)){let l=n.getAttribute("action");s=l?Ua(l,e):null,t=n.getAttribute("method")||Lp,i=cb(n.getAttribute("enctype"))||Fp,a=new FormData(n)}else if(e3(n)||n3(n)&&(n.type==="submit"||n.type==="image")){let l=n.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=n.getAttribute("formaction")||l.getAttribute("action");if(s=c?Ua(c,e):null,t=n.getAttribute("formmethod")||l.getAttribute("method")||Lp,i=cb(n.getAttribute("formenctype"))||cb(l.getAttribute("enctype"))||Fp,a=new FormData(l,n),!i3()){let{name:d,type:h,value:f}=n;if(h==="image"){let p=d?`${d}.`:"";a.append(`${p}x`,"0"),a.append(`${p}y`,"0")}else d&&a.append(d,f)}}else{if(Tx(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Lp,s=null,i=Fp,o=n}return a&&i==="text/plain"&&(o=a,a=void 0),{action:s,method:t.toLowerCase(),encType:i,formData:a,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Nv(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function l3(n,e,t){let s=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return s.pathname==="/"?s.pathname=`_root.${t}`:e&&Ua(s.pathname,e)==="/"?s.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:s.pathname=`${s.pathname.replace(/\/$/,"")}.${t}`,s}async function c3(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function d3(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function u3(n,e,t){let s=await Promise.all(n.map(async i=>{let a=e.routes[i.route.id];if(a){let o=await c3(a,t);return o.links?o.links():[]}return[]}));return p3(s.flat(1).filter(d3).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function pE(n,e,t,s,i,a){let o=(c,d)=>t[d]?c.route.id!==t[d].route.id:!0,l=(c,d)=>{var h;return t[d].pathname!==c.pathname||((h=t[d].route.path)==null?void 0:h.endsWith("*"))&&t[d].params["*"]!==c.params["*"]};return a==="assets"?e.filter((c,d)=>o(c,d)||l(c,d)):a==="data"?e.filter((c,d)=>{var f;let h=s.routes[c.route.id];if(!h||!h.hasLoader)return!1;if(o(c,d)||l(c,d))return!0;if(c.route.shouldRevalidate){let p=c.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:((f=t[0])==null?void 0:f.params)||{},nextUrl:new URL(n,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof p=="boolean")return p}return!0}):[]}function h3(n,e,{includeHydrateFallback:t}={}){return m3(n.map(s=>{let i=e.routes[s.route.id];if(!i)return[];let a=[i.module];return i.clientActionModule&&(a=a.concat(i.clientActionModule)),i.clientLoaderModule&&(a=a.concat(i.clientLoaderModule)),t&&i.hydrateFallbackModule&&(a=a.concat(i.hydrateFallbackModule)),i.imports&&(a=a.concat(i.imports)),a}).flat(1))}function m3(n){return[...new Set(n)]}function f3(n){let e={},t=Object.keys(n).sort();for(let s of t)e[s]=n[s];return e}function p3(n,e){let t=new Set;return new Set(e),n.reduce((s,i)=>{let a=JSON.stringify(f3(i));return t.has(a)||(t.add(a),s.push({key:a,link:i})),s},[])}function LC(){let n=b.useContext(vu);return Nv(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function g3(){let n=b.useContext(Ix);return Nv(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var jv=b.createContext(void 0);jv.displayName="FrameworkContext";function FC(){let n=b.useContext(jv);return Nv(n,"You must render this element inside a <HydratedRouter> element"),n}function x3(n,e){let t=b.useContext(jv),[s,i]=b.useState(!1),[a,o]=b.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:d,onMouseLeave:h,onTouchStart:f}=e,p=b.useRef(null);b.useEffect(()=>{if(n==="render"&&o(!0),n==="viewport"){let D=g=>{g.forEach(N=>{o(N.isIntersecting)})},A=new IntersectionObserver(D,{threshold:.5});return p.current&&A.observe(p.current),()=>{A.disconnect()}}},[n]),b.useEffect(()=>{if(s){let D=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(D)}}},[s]);let x=()=>{i(!0)},I=()=>{i(!1),o(!1)};return t?n!=="intent"?[a,p,{}]:[a,p,{onFocus:fh(l,x),onBlur:fh(c,I),onMouseEnter:fh(d,x),onMouseLeave:fh(h,I),onTouchStart:fh(f,x)}]:[!1,p,{}]}function fh(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function y3({page:n,...e}){let{router:t}=LC(),s=b.useMemo(()=>SC(t.routes,n,t.basename),[t.routes,n,t.basename]);return s?b.createElement(w3,{page:n,matches:s,...e}):null}function b3(n){let{manifest:e,routeModules:t}=FC(),[s,i]=b.useState([]);return b.useEffect(()=>{let a=!1;return u3(n,e,t).then(o=>{a||i(o)}),()=>{a=!0}},[n,e,t]),s}function w3({page:n,matches:e,...t}){let s=Ga(),{manifest:i,routeModules:a}=FC(),{basename:o}=LC(),{loaderData:l,matches:c}=g3(),d=b.useMemo(()=>pE(n,e,c,i,s,"data"),[n,e,c,i,s]),h=b.useMemo(()=>pE(n,e,c,i,s,"assets"),[n,e,c,i,s]),f=b.useMemo(()=>{if(n===s.pathname+s.search+s.hash)return[];let I=new Set,D=!1;if(e.forEach(g=>{var j;let N=i.routes[g.route.id];!N||!N.hasLoader||(!d.some(V=>V.route.id===g.route.id)&&g.route.id in l&&((j=a[g.route.id])!=null&&j.shouldRevalidate)||N.hasClientLoader?D=!0:I.add(g.route.id))}),I.size===0)return[];let A=l3(n,o,"data");return D&&I.size>0&&A.searchParams.set("_routes",e.filter(g=>I.has(g.route.id)).map(g=>g.route.id).join(",")),[A.pathname+A.search]},[o,l,s,i,d,e,n,a]),p=b.useMemo(()=>h3(h,i),[h,i]),x=b3(h);return b.createElement(b.Fragment,null,f.map(I=>b.createElement("link",{key:I,rel:"prefetch",as:"fetch",href:I,...t})),p.map(I=>b.createElement("link",{key:I,rel:"modulepreload",href:I,...t})),x.map(({key:I,link:D})=>b.createElement("link",{key:I,nonce:t.nonce,...D})))}function v3(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var UC=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{UC&&(window.__reactRouterVersion="7.8.1")}catch{}function N3({basename:n,children:e,window:t}){let s=b.useRef();s.current==null&&(s.current=dL({window:t,v5Compat:!0}));let i=s.current,[a,o]=b.useState({action:i.action,location:i.location}),l=b.useCallback(c=>{b.startTransition(()=>o(c))},[o]);return b.useLayoutEffect(()=>i.listen(l),[i,l]),b.createElement(JL,{basename:n,children:e,location:a.location,navigationType:a.action,navigator:i})}var VC=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ga=b.forwardRef(function({onClick:e,discover:t="render",prefetch:s="none",relative:i,reloadDocument:a,replace:o,state:l,target:c,to:d,preventScrollReset:h,viewTransition:f,...p},x){let{basename:I}=b.useContext(ea),D=typeof d=="string"&&VC.test(d),A,g=!1;if(typeof d=="string"&&D&&(A=d,UC))try{let T=new URL(window.location.href),L=d.startsWith("//")?new URL(T.protocol+d):new URL(d),G=Ua(L.pathname,I);L.origin===T.origin&&G!=null?d=G+L.search+L.hash:g=!0}catch{Yi(!1,`<Link to="${d}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let N=LL(d,{relative:i}),[j,V,$]=x3(s,p),Z=S3(d,{replace:o,state:l,target:c,preventScrollReset:h,relative:i,viewTransition:f});function O(T){e&&e(T),T.defaultPrevented||Z(T)}let M=b.createElement("a",{...p,...$,href:A||N,onClick:g||a?e:O,ref:v3(x,V),target:c,"data-discover":!D&&t==="render"?"true":void 0});return j&&!D?b.createElement(b.Fragment,null,M,b.createElement(y3,{page:N})):M});ga.displayName="Link";var j3=b.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:s="",end:i=!1,style:a,to:o,viewTransition:l,children:c,...d},h){let f=of(o,{relative:d.relative}),p=Ga(),x=b.useContext(Ix),{navigator:I,basename:D}=b.useContext(ea),A=x!=null&&D3(f)&&l===!0,g=I.encodeLocation?I.encodeLocation(f).pathname:f.pathname,N=p.pathname,j=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;t||(N=N.toLowerCase(),j=j?j.toLowerCase():null,g=g.toLowerCase()),j&&D&&(j=Ua(j,D)||j);const V=g!=="/"&&g.endsWith("/")?g.length-1:g.length;let $=N===g||!i&&N.startsWith(g)&&N.charAt(V)==="/",Z=j!=null&&(j===g||!i&&j.startsWith(g)&&j.charAt(g.length)==="/"),O={isActive:$,isPending:Z,isTransitioning:A},M=$?e:void 0,T;typeof s=="function"?T=s(O):T=[s,$?"active":null,Z?"pending":null,A?"transitioning":null].filter(Boolean).join(" ");let L=typeof a=="function"?a(O):a;return b.createElement(ga,{...d,"aria-current":M,className:T,ref:h,style:L,to:o,viewTransition:l},typeof c=="function"?c(O):c)});j3.displayName="NavLink";var _3=b.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:s,replace:i,state:a,method:o=Lp,action:l,onSubmit:c,relative:d,preventScrollReset:h,viewTransition:f,...p},x)=>{let I=C3(),D=A3(l,{relative:d}),A=o.toLowerCase()==="get"?"get":"post",g=typeof l=="string"&&VC.test(l),N=j=>{if(c&&c(j),j.defaultPrevented)return;j.preventDefault();let V=j.nativeEvent.submitter,$=(V==null?void 0:V.getAttribute("formmethod"))||o;I(V||j.currentTarget,{fetcherKey:e,method:$,navigate:t,replace:i,state:a,relative:d,preventScrollReset:h,viewTransition:f})};return b.createElement("form",{ref:x,method:A,action:D,onSubmit:s?c:N,...p,"data-discover":!g&&n==="render"?"true":void 0})});_3.displayName="Form";function E3(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function zC(n){let e=b.useContext(vu);return zn(e,E3(n)),e}function S3(n,{target:e,replace:t,state:s,preventScrollReset:i,relative:a,viewTransition:o}={}){let l=On(),c=Ga(),d=of(n,{relative:a});return b.useCallback(h=>{if(r3(h,e)){h.preventDefault();let f=t!==void 0?t:jm(c)===jm(d);l(n,{replace:f,state:s,preventScrollReset:i,relative:a,viewTransition:o})}},[c,l,d,t,s,e,n,i,a,o])}var I3=0,T3=()=>`__${String(++I3)}__`;function C3(){let{router:n}=zC("useSubmit"),{basename:e}=b.useContext(ea),t=WL();return b.useCallback(async(s,i={})=>{let{action:a,method:o,encType:l,formData:c,body:d}=o3(s,e);if(i.navigate===!1){let h=i.fetcherKey||T3();await n.fetch(h,t,i.action||a,{preventScrollReset:i.preventScrollReset,formData:c,body:d,formMethod:i.method||o,formEncType:i.encType||l,flushSync:i.flushSync})}else await n.navigate(i.action||a,{preventScrollReset:i.preventScrollReset,formData:c,body:d,formMethod:i.method||o,formEncType:i.encType||l,replace:i.replace,state:i.state,fromRouteId:t,flushSync:i.flushSync,viewTransition:i.viewTransition})},[n,e,t])}function A3(n,{relative:e}={}){let{basename:t}=b.useContext(ea),s=b.useContext(ta);zn(s,"useFormAction must be used inside a RouteContext");let[i]=s.matches.slice(-1),a={...of(n||".",{relative:e})},o=Ga();if(n==null){a.search=o.search;let l=new URLSearchParams(a.search),c=l.getAll("index");if(c.some(h=>h==="")){l.delete("index"),c.filter(f=>f).forEach(f=>l.append("index",f));let h=l.toString();a.search=h?`?${h}`:""}}return(!n||n===".")&&i.route.index&&(a.search=a.search?a.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(a.pathname=a.pathname==="/"?t:Ra([t,a.pathname])),jm(a)}function D3(n,{relative:e}={}){let t=b.useContext(RC);zn(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=zC("useViewTransitionState"),i=of(n,{relative:e});if(!t.isTransitioning)return!1;let a=Ua(t.currentLocation.pathname,s)||t.currentLocation.pathname,o=Ua(t.nextLocation.pathname,s)||t.nextLocation.pathname;return Rg(i.pathname,o)!=null||Rg(i.pathname,a)!=null}const R3=()=>{};var gE={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $C=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let i=n.charCodeAt(s);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},P3=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const i=n[t++];if(i<128)e[s++]=String.fromCharCode(i);else if(i>191&&i<224){const a=n[t++];e[s++]=String.fromCharCode((i&31)<<6|a&63)}else if(i>239&&i<365){const a=n[t++],o=n[t++],l=n[t++],c=((i&7)<<18|(a&63)<<12|(o&63)<<6|l&63)-65536;e[s++]=String.fromCharCode(55296+(c>>10)),e[s++]=String.fromCharCode(56320+(c&1023))}else{const a=n[t++],o=n[t++];e[s++]=String.fromCharCode((i&15)<<12|(a&63)<<6|o&63)}}return e.join("")},BC={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let i=0;i<n.length;i+=3){const a=n[i],o=i+1<n.length,l=o?n[i+1]:0,c=i+2<n.length,d=c?n[i+2]:0,h=a>>2,f=(a&3)<<4|l>>4;let p=(l&15)<<2|d>>6,x=d&63;c||(x=64,o||(p=64)),s.push(t[h],t[f],t[p],t[x])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray($C(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):P3(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<n.length;){const a=t[n.charAt(i++)],l=i<n.length?t[n.charAt(i)]:0;++i;const d=i<n.length?t[n.charAt(i)]:64;++i;const f=i<n.length?t[n.charAt(i)]:64;if(++i,a==null||l==null||d==null||f==null)throw new k3;const p=a<<2|l>>4;if(s.push(p),d!==64){const x=l<<4&240|d>>2;if(s.push(x),f!==64){const I=d<<6&192|f;s.push(I)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class k3 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const O3=function(n){const e=$C(n);return BC.encodeByteArray(e,!0)},Pg=function(n){return O3(n).replace(/\./g,"")},qC=function(n){try{return BC.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HC(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M3=()=>HC().__FIREBASE_DEFAULTS__,L3=()=>{if(typeof process>"u"||typeof gE>"u")return;const n=gE.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},F3=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&qC(n[1]);return e&&JSON.parse(e)},Cx=()=>{try{return R3()||M3()||L3()||F3()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},GC=n=>{var e,t;return(t=(e=Cx())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},QC=n=>{const e=GC(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},WC=()=>{var n;return(n=Cx())==null?void 0:n.config},KC=n=>{var e;return(e=Cx())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U3{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qa(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Ax(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YC(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",i=n.iat||0,a=n.sub||n.user_id;if(!a)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${s}`,aud:s,iat:i,exp:i+3600,auth_time:i,sub:a,user_id:a,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Pg(JSON.stringify(t)),Pg(JSON.stringify(o)),""].join(".")}const Qh={};function V3(){const n={prod:[],emulator:[]};for(const e of Object.keys(Qh))Qh[e]?n.emulator.push(e):n.prod.push(e);return n}function z3(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let xE=!1;function _v(n,e){if(typeof window>"u"||typeof document>"u"||!Qa(window.location.host)||Qh[n]===e||Qh[n]||xE)return;Qh[n]=e;function t(p){return`__firebase__banner__${p}`}const s="__firebase__banner",a=V3().prod.length>0;function o(){const p=document.getElementById(s);p&&p.remove()}function l(p){p.style.display="flex",p.style.background="#7faaf0",p.style.position="fixed",p.style.bottom="5px",p.style.left="5px",p.style.padding=".5em",p.style.borderRadius="5px",p.style.alignItems="center"}function c(p,x){p.setAttribute("width","24"),p.setAttribute("id",x),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),p.style.marginLeft="-6px"}function d(){const p=document.createElement("span");return p.style.cursor="pointer",p.style.marginLeft="16px",p.style.fontSize="24px",p.innerHTML=" &times;",p.onclick=()=>{xE=!0,o()},p}function h(p,x){p.setAttribute("id",x),p.innerText="Learn more",p.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",p.setAttribute("target","__blank"),p.style.paddingLeft="5px",p.style.textDecoration="underline"}function f(){const p=z3(s),x=t("text"),I=document.getElementById(x)||document.createElement("span"),D=t("learnmore"),A=document.getElementById(D)||document.createElement("a"),g=t("preprendIcon"),N=document.getElementById(g)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.created){const j=p.element;l(j),h(A,D);const V=d();c(N,g),j.append(N,I,A,V),document.body.appendChild(j)}a?(I.innerText="Preview backend disconnected.",N.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(N.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,I.innerText="Preview backend running in this workspace."),I.setAttribute("id",x)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ps(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function $3(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ps())}function XC(){var e;const n=(e=Cx())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function B3(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function q3(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function H3(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function G3(){const n=ps();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function JC(){return!XC()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ZC(){return!XC()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function eA(){try{return typeof indexedDB=="object"}catch{return!1}}function Q3(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var a;e(((a=i.error)==null?void 0:a.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W3="FirebaseError";class na extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=W3,Object.setPrototypeOf(this,na.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,lf.prototype.create)}}class lf{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},i=`${this.service}/${e}`,a=this.errors[e],o=a?K3(a,s):"Error",l=`${this.serviceName}: ${o} (${i}).`;return new na(i,l,s)}}function K3(n,e){return n.replace(Y3,(t,s)=>{const i=e[s];return i!=null?String(i):`<${s}?>`})}const Y3=/\{\$([^}]+)}/g;function X3(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Jo(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const i of t){if(!s.includes(i))return!1;const a=n[i],o=e[i];if(yE(a)&&yE(o)){if(!Jo(a,o))return!1}else if(a!==o)return!1}for(const i of s)if(!t.includes(i))return!1;return!0}function yE(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cf(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function Eh(n){const e={};return n.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[i,a]=s.split("=");e[decodeURIComponent(i)]=decodeURIComponent(a)}}),e}function Sh(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function J3(n,e){const t=new Z3(n,e);return t.subscribe.bind(t)}class Z3{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let i;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");e5(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:s},i.next===void 0&&(i.next=db),i.error===void 0&&(i.error=db),i.complete===void 0&&(i.complete=db);const a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),a}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function e5(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function db(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mn(n){return n&&n._delegate?n._delegate:n}class Zo{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vl="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t5{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new U3;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&s.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(s5(e))try{this.getOrInitializeService({instanceIdentifier:Vl})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const a=this.getOrInitializeService({instanceIdentifier:i});s.resolve(a)}catch{}}}}clearInstance(e=Vl){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Vl){return this.instances.has(e)}getOptions(e=Vl){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[a,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(a);s===l&&o.resolve(i)}return i}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(s)??new Set;i.add(e),this.onInitCallbacks.set(s,i);const a=this.instances.get(s);return a&&e(a,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const i of s)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:n5(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Vl){return this.component?this.component.multipleInstances?e:Vl:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function n5(n){return n===Vl?void 0:n}function s5(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r5{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new t5(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Tt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Tt||(Tt={}));const i5={debug:Tt.DEBUG,verbose:Tt.VERBOSE,info:Tt.INFO,warn:Tt.WARN,error:Tt.ERROR,silent:Tt.SILENT},a5=Tt.INFO,o5={[Tt.DEBUG]:"log",[Tt.VERBOSE]:"log",[Tt.INFO]:"info",[Tt.WARN]:"warn",[Tt.ERROR]:"error"},l5=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),i=o5[e];if(i)console[i](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Ev{constructor(e){this.name=e,this._logLevel=a5,this._logHandler=l5,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Tt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?i5[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Tt.DEBUG,...e),this._logHandler(this,Tt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Tt.VERBOSE,...e),this._logHandler(this,Tt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Tt.INFO,...e),this._logHandler(this,Tt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Tt.WARN,...e),this._logHandler(this,Tt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Tt.ERROR,...e),this._logHandler(this,Tt.ERROR,...e)}}const c5=(n,e)=>e.some(t=>n instanceof t);let bE,wE;function d5(){return bE||(bE=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function u5(){return wE||(wE=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const tA=new WeakMap,D0=new WeakMap,nA=new WeakMap,ub=new WeakMap,Sv=new WeakMap;function h5(n){const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("success",a),n.removeEventListener("error",o)},a=()=>{t(Bo(n.result)),i()},o=()=>{s(n.error),i()};n.addEventListener("success",a),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&tA.set(t,n)}).catch(()=>{}),Sv.set(e,n),e}function m5(n){if(D0.has(n))return;const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("complete",a),n.removeEventListener("error",o),n.removeEventListener("abort",o)},a=()=>{t(),i()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",a),n.addEventListener("error",o),n.addEventListener("abort",o)});D0.set(n,e)}let R0={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return D0.get(n);if(e==="objectStoreNames")return n.objectStoreNames||nA.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Bo(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function f5(n){R0=n(R0)}function p5(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(hb(this),e,...t);return nA.set(s,e.sort?e.sort():[e]),Bo(s)}:u5().includes(n)?function(...e){return n.apply(hb(this),e),Bo(tA.get(this))}:function(...e){return Bo(n.apply(hb(this),e))}}function g5(n){return typeof n=="function"?p5(n):(n instanceof IDBTransaction&&m5(n),c5(n,d5())?new Proxy(n,R0):n)}function Bo(n){if(n instanceof IDBRequest)return h5(n);if(ub.has(n))return ub.get(n);const e=g5(n);return e!==n&&(ub.set(n,e),Sv.set(e,n)),e}const hb=n=>Sv.get(n);function x5(n,e,{blocked:t,upgrade:s,blocking:i,terminated:a}={}){const o=indexedDB.open(n,e),l=Bo(o);return s&&o.addEventListener("upgradeneeded",c=>{s(Bo(o.result),c.oldVersion,c.newVersion,Bo(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),l.then(c=>{a&&c.addEventListener("close",()=>a()),i&&c.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const y5=["get","getKey","getAll","getAllKeys","count"],b5=["put","add","delete","clear"],mb=new Map;function vE(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(mb.get(e))return mb.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,i=b5.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(i||y5.includes(t)))return;const a=async function(o,...l){const c=this.transaction(o,i?"readwrite":"readonly");let d=c.store;return s&&(d=d.index(l.shift())),(await Promise.all([d[t](...l),i&&c.done]))[0]};return mb.set(e,a),a}f5(n=>({...n,get:(e,t,s)=>vE(e,t)||n.get(e,t,s),has:(e,t)=>!!vE(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w5{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(v5(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function v5(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const P0="@firebase/app",NE="0.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Va=new Ev("@firebase/app"),N5="@firebase/app-compat",j5="@firebase/analytics-compat",_5="@firebase/analytics",E5="@firebase/app-check-compat",S5="@firebase/app-check",I5="@firebase/auth",T5="@firebase/auth-compat",C5="@firebase/database",A5="@firebase/data-connect",D5="@firebase/database-compat",R5="@firebase/functions",P5="@firebase/functions-compat",k5="@firebase/installations",O5="@firebase/installations-compat",M5="@firebase/messaging",L5="@firebase/messaging-compat",F5="@firebase/performance",U5="@firebase/performance-compat",V5="@firebase/remote-config",z5="@firebase/remote-config-compat",$5="@firebase/storage",B5="@firebase/storage-compat",q5="@firebase/firestore",H5="@firebase/ai",G5="@firebase/firestore-compat",Q5="firebase",W5="12.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k0="[DEFAULT]",K5={[P0]:"fire-core",[N5]:"fire-core-compat",[_5]:"fire-analytics",[j5]:"fire-analytics-compat",[S5]:"fire-app-check",[E5]:"fire-app-check-compat",[I5]:"fire-auth",[T5]:"fire-auth-compat",[C5]:"fire-rtdb",[A5]:"fire-data-connect",[D5]:"fire-rtdb-compat",[R5]:"fire-fn",[P5]:"fire-fn-compat",[k5]:"fire-iid",[O5]:"fire-iid-compat",[M5]:"fire-fcm",[L5]:"fire-fcm-compat",[F5]:"fire-perf",[U5]:"fire-perf-compat",[V5]:"fire-rc",[z5]:"fire-rc-compat",[$5]:"fire-gcs",[B5]:"fire-gcs-compat",[q5]:"fire-fst",[G5]:"fire-fst-compat",[H5]:"fire-vertex","fire-js":"fire-js",[Q5]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kg=new Map,Y5=new Map,O0=new Map;function jE(n,e){try{n.container.addComponent(e)}catch(t){Va.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function dc(n){const e=n.name;if(O0.has(e))return Va.debug(`There were multiple attempts to register component ${e}.`),!1;O0.set(e,n);for(const t of kg.values())jE(t,n);for(const t of Y5.values())jE(t,n);return!0}function df(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function gr(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X5={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},qo=new lf("app","Firebase",X5);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J5{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Zo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw qo.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _c=W5;function Iv(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:k0,automaticDataCollectionEnabled:!0,...e},i=s.name;if(typeof i!="string"||!i)throw qo.create("bad-app-name",{appName:String(i)});if(t||(t=WC()),!t)throw qo.create("no-options");const a=kg.get(i);if(a){if(Jo(t,a.options)&&Jo(s,a.config))return a;throw qo.create("duplicate-app",{appName:i})}const o=new r5(i);for(const c of O0.values())o.addComponent(c);const l=new J5(t,s,o);return kg.set(i,l),l}function Tv(n=k0){const e=kg.get(n);if(!e&&n===k0&&WC())return Iv();if(!e)throw qo.create("no-app",{appName:n});return e}function Bi(n,e,t){let s=K5[n]??n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),a=e.match(/\s|\//);if(i||a){const o=[`Unable to register library "${s}" with version "${e}":`];i&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&a&&o.push("and"),a&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Va.warn(o.join(" "));return}dc(new Zo(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z5="firebase-heartbeat-database",e4=1,_m="firebase-heartbeat-store";let fb=null;function sA(){return fb||(fb=x5(Z5,e4,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(_m)}catch(t){console.warn(t)}}}}).catch(n=>{throw qo.create("idb-open",{originalErrorMessage:n.message})})),fb}async function t4(n){try{const t=(await sA()).transaction(_m),s=await t.objectStore(_m).get(rA(n));return await t.done,s}catch(e){if(e instanceof na)Va.warn(e.message);else{const t=qo.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Va.warn(t.message)}}}async function _E(n,e){try{const s=(await sA()).transaction(_m,"readwrite");await s.objectStore(_m).put(e,rA(n)),await s.done}catch(t){if(t instanceof na)Va.warn(t.message);else{const s=qo.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Va.warn(s.message)}}}function rA(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n4=1024,s4=30;class r4{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new a4(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),a=EE();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(o=>o.date===a))return;if(this._heartbeatsCache.heartbeats.push({date:a,agent:i}),this._heartbeatsCache.heartbeats.length>s4){const o=o4(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(s){Va.warn(s)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=EE(),{heartbeatsToSend:s,unsentEntries:i}=i4(this._heartbeatsCache.heartbeats),a=Pg(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(t){return Va.warn(t),""}}}function EE(){return new Date().toISOString().substring(0,10)}function i4(n,e=n4){const t=[];let s=n.slice();for(const i of n){const a=t.find(o=>o.agent===i.agent);if(a){if(a.dates.push(i.date),SE(t)>e){a.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),SE(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class a4{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return eA()?Q3().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await t4(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return _E(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return _E(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function SE(n){return Pg(JSON.stringify({version:2,heartbeats:n})).length}function o4(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l4(n){dc(new Zo("platform-logger",e=>new w5(e),"PRIVATE")),dc(new Zo("heartbeat",e=>new r4(e),"PRIVATE")),Bi(P0,NE,n),Bi(P0,NE,"esm2020"),Bi("fire-js","")}l4("");var IE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ho,iA;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(O,M){function T(){}T.prototype=M.prototype,O.D=M.prototype,O.prototype=new T,O.prototype.constructor=O,O.C=function(L,G,U){for(var k=Array(arguments.length-2),re=2;re<arguments.length;re++)k[re-2]=arguments[re];return M.prototype[G].apply(L,k)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(s,t),s.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(O,M,T){T||(T=0);var L=Array(16);if(typeof M=="string")for(var G=0;16>G;++G)L[G]=M.charCodeAt(T++)|M.charCodeAt(T++)<<8|M.charCodeAt(T++)<<16|M.charCodeAt(T++)<<24;else for(G=0;16>G;++G)L[G]=M[T++]|M[T++]<<8|M[T++]<<16|M[T++]<<24;M=O.g[0],T=O.g[1],G=O.g[2];var U=O.g[3],k=M+(U^T&(G^U))+L[0]+3614090360&4294967295;M=T+(k<<7&4294967295|k>>>25),k=U+(G^M&(T^G))+L[1]+3905402710&4294967295,U=M+(k<<12&4294967295|k>>>20),k=G+(T^U&(M^T))+L[2]+606105819&4294967295,G=U+(k<<17&4294967295|k>>>15),k=T+(M^G&(U^M))+L[3]+3250441966&4294967295,T=G+(k<<22&4294967295|k>>>10),k=M+(U^T&(G^U))+L[4]+4118548399&4294967295,M=T+(k<<7&4294967295|k>>>25),k=U+(G^M&(T^G))+L[5]+1200080426&4294967295,U=M+(k<<12&4294967295|k>>>20),k=G+(T^U&(M^T))+L[6]+2821735955&4294967295,G=U+(k<<17&4294967295|k>>>15),k=T+(M^G&(U^M))+L[7]+4249261313&4294967295,T=G+(k<<22&4294967295|k>>>10),k=M+(U^T&(G^U))+L[8]+1770035416&4294967295,M=T+(k<<7&4294967295|k>>>25),k=U+(G^M&(T^G))+L[9]+2336552879&4294967295,U=M+(k<<12&4294967295|k>>>20),k=G+(T^U&(M^T))+L[10]+4294925233&4294967295,G=U+(k<<17&4294967295|k>>>15),k=T+(M^G&(U^M))+L[11]+2304563134&4294967295,T=G+(k<<22&4294967295|k>>>10),k=M+(U^T&(G^U))+L[12]+1804603682&4294967295,M=T+(k<<7&4294967295|k>>>25),k=U+(G^M&(T^G))+L[13]+4254626195&4294967295,U=M+(k<<12&4294967295|k>>>20),k=G+(T^U&(M^T))+L[14]+2792965006&4294967295,G=U+(k<<17&4294967295|k>>>15),k=T+(M^G&(U^M))+L[15]+1236535329&4294967295,T=G+(k<<22&4294967295|k>>>10),k=M+(G^U&(T^G))+L[1]+4129170786&4294967295,M=T+(k<<5&4294967295|k>>>27),k=U+(T^G&(M^T))+L[6]+3225465664&4294967295,U=M+(k<<9&4294967295|k>>>23),k=G+(M^T&(U^M))+L[11]+643717713&4294967295,G=U+(k<<14&4294967295|k>>>18),k=T+(U^M&(G^U))+L[0]+3921069994&4294967295,T=G+(k<<20&4294967295|k>>>12),k=M+(G^U&(T^G))+L[5]+3593408605&4294967295,M=T+(k<<5&4294967295|k>>>27),k=U+(T^G&(M^T))+L[10]+38016083&4294967295,U=M+(k<<9&4294967295|k>>>23),k=G+(M^T&(U^M))+L[15]+3634488961&4294967295,G=U+(k<<14&4294967295|k>>>18),k=T+(U^M&(G^U))+L[4]+3889429448&4294967295,T=G+(k<<20&4294967295|k>>>12),k=M+(G^U&(T^G))+L[9]+568446438&4294967295,M=T+(k<<5&4294967295|k>>>27),k=U+(T^G&(M^T))+L[14]+3275163606&4294967295,U=M+(k<<9&4294967295|k>>>23),k=G+(M^T&(U^M))+L[3]+4107603335&4294967295,G=U+(k<<14&4294967295|k>>>18),k=T+(U^M&(G^U))+L[8]+1163531501&4294967295,T=G+(k<<20&4294967295|k>>>12),k=M+(G^U&(T^G))+L[13]+2850285829&4294967295,M=T+(k<<5&4294967295|k>>>27),k=U+(T^G&(M^T))+L[2]+4243563512&4294967295,U=M+(k<<9&4294967295|k>>>23),k=G+(M^T&(U^M))+L[7]+1735328473&4294967295,G=U+(k<<14&4294967295|k>>>18),k=T+(U^M&(G^U))+L[12]+2368359562&4294967295,T=G+(k<<20&4294967295|k>>>12),k=M+(T^G^U)+L[5]+4294588738&4294967295,M=T+(k<<4&4294967295|k>>>28),k=U+(M^T^G)+L[8]+2272392833&4294967295,U=M+(k<<11&4294967295|k>>>21),k=G+(U^M^T)+L[11]+1839030562&4294967295,G=U+(k<<16&4294967295|k>>>16),k=T+(G^U^M)+L[14]+4259657740&4294967295,T=G+(k<<23&4294967295|k>>>9),k=M+(T^G^U)+L[1]+2763975236&4294967295,M=T+(k<<4&4294967295|k>>>28),k=U+(M^T^G)+L[4]+1272893353&4294967295,U=M+(k<<11&4294967295|k>>>21),k=G+(U^M^T)+L[7]+4139469664&4294967295,G=U+(k<<16&4294967295|k>>>16),k=T+(G^U^M)+L[10]+3200236656&4294967295,T=G+(k<<23&4294967295|k>>>9),k=M+(T^G^U)+L[13]+681279174&4294967295,M=T+(k<<4&4294967295|k>>>28),k=U+(M^T^G)+L[0]+3936430074&4294967295,U=M+(k<<11&4294967295|k>>>21),k=G+(U^M^T)+L[3]+3572445317&4294967295,G=U+(k<<16&4294967295|k>>>16),k=T+(G^U^M)+L[6]+76029189&4294967295,T=G+(k<<23&4294967295|k>>>9),k=M+(T^G^U)+L[9]+3654602809&4294967295,M=T+(k<<4&4294967295|k>>>28),k=U+(M^T^G)+L[12]+3873151461&4294967295,U=M+(k<<11&4294967295|k>>>21),k=G+(U^M^T)+L[15]+530742520&4294967295,G=U+(k<<16&4294967295|k>>>16),k=T+(G^U^M)+L[2]+3299628645&4294967295,T=G+(k<<23&4294967295|k>>>9),k=M+(G^(T|~U))+L[0]+4096336452&4294967295,M=T+(k<<6&4294967295|k>>>26),k=U+(T^(M|~G))+L[7]+1126891415&4294967295,U=M+(k<<10&4294967295|k>>>22),k=G+(M^(U|~T))+L[14]+2878612391&4294967295,G=U+(k<<15&4294967295|k>>>17),k=T+(U^(G|~M))+L[5]+4237533241&4294967295,T=G+(k<<21&4294967295|k>>>11),k=M+(G^(T|~U))+L[12]+1700485571&4294967295,M=T+(k<<6&4294967295|k>>>26),k=U+(T^(M|~G))+L[3]+2399980690&4294967295,U=M+(k<<10&4294967295|k>>>22),k=G+(M^(U|~T))+L[10]+4293915773&4294967295,G=U+(k<<15&4294967295|k>>>17),k=T+(U^(G|~M))+L[1]+2240044497&4294967295,T=G+(k<<21&4294967295|k>>>11),k=M+(G^(T|~U))+L[8]+1873313359&4294967295,M=T+(k<<6&4294967295|k>>>26),k=U+(T^(M|~G))+L[15]+4264355552&4294967295,U=M+(k<<10&4294967295|k>>>22),k=G+(M^(U|~T))+L[6]+2734768916&4294967295,G=U+(k<<15&4294967295|k>>>17),k=T+(U^(G|~M))+L[13]+1309151649&4294967295,T=G+(k<<21&4294967295|k>>>11),k=M+(G^(T|~U))+L[4]+4149444226&4294967295,M=T+(k<<6&4294967295|k>>>26),k=U+(T^(M|~G))+L[11]+3174756917&4294967295,U=M+(k<<10&4294967295|k>>>22),k=G+(M^(U|~T))+L[2]+718787259&4294967295,G=U+(k<<15&4294967295|k>>>17),k=T+(U^(G|~M))+L[9]+3951481745&4294967295,O.g[0]=O.g[0]+M&4294967295,O.g[1]=O.g[1]+(G+(k<<21&4294967295|k>>>11))&4294967295,O.g[2]=O.g[2]+G&4294967295,O.g[3]=O.g[3]+U&4294967295}s.prototype.u=function(O,M){M===void 0&&(M=O.length);for(var T=M-this.blockSize,L=this.B,G=this.h,U=0;U<M;){if(G==0)for(;U<=T;)i(this,O,U),U+=this.blockSize;if(typeof O=="string"){for(;U<M;)if(L[G++]=O.charCodeAt(U++),G==this.blockSize){i(this,L),G=0;break}}else for(;U<M;)if(L[G++]=O[U++],G==this.blockSize){i(this,L),G=0;break}}this.h=G,this.o+=M},s.prototype.v=function(){var O=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);O[0]=128;for(var M=1;M<O.length-8;++M)O[M]=0;var T=8*this.o;for(M=O.length-8;M<O.length;++M)O[M]=T&255,T/=256;for(this.u(O),O=Array(16),M=T=0;4>M;++M)for(var L=0;32>L;L+=8)O[T++]=this.g[M]>>>L&255;return O};function a(O,M){var T=l;return Object.prototype.hasOwnProperty.call(T,O)?T[O]:T[O]=M(O)}function o(O,M){this.h=M;for(var T=[],L=!0,G=O.length-1;0<=G;G--){var U=O[G]|0;L&&U==M||(T[G]=U,L=!1)}this.g=T}var l={};function c(O){return-128<=O&&128>O?a(O,function(M){return new o([M|0],0>M?-1:0)}):new o([O|0],0>O?-1:0)}function d(O){if(isNaN(O)||!isFinite(O))return f;if(0>O)return A(d(-O));for(var M=[],T=1,L=0;O>=T;L++)M[L]=O/T|0,T*=4294967296;return new o(M,0)}function h(O,M){if(O.length==0)throw Error("number format error: empty string");if(M=M||10,2>M||36<M)throw Error("radix out of range: "+M);if(O.charAt(0)=="-")return A(h(O.substring(1),M));if(0<=O.indexOf("-"))throw Error('number format error: interior "-" character');for(var T=d(Math.pow(M,8)),L=f,G=0;G<O.length;G+=8){var U=Math.min(8,O.length-G),k=parseInt(O.substring(G,G+U),M);8>U?(U=d(Math.pow(M,U)),L=L.j(U).add(d(k))):(L=L.j(T),L=L.add(d(k)))}return L}var f=c(0),p=c(1),x=c(16777216);n=o.prototype,n.m=function(){if(D(this))return-A(this).m();for(var O=0,M=1,T=0;T<this.g.length;T++){var L=this.i(T);O+=(0<=L?L:4294967296+L)*M,M*=4294967296}return O},n.toString=function(O){if(O=O||10,2>O||36<O)throw Error("radix out of range: "+O);if(I(this))return"0";if(D(this))return"-"+A(this).toString(O);for(var M=d(Math.pow(O,6)),T=this,L="";;){var G=V(T,M).g;T=g(T,G.j(M));var U=((0<T.g.length?T.g[0]:T.h)>>>0).toString(O);if(T=G,I(T))return U+L;for(;6>U.length;)U="0"+U;L=U+L}},n.i=function(O){return 0>O?0:O<this.g.length?this.g[O]:this.h};function I(O){if(O.h!=0)return!1;for(var M=0;M<O.g.length;M++)if(O.g[M]!=0)return!1;return!0}function D(O){return O.h==-1}n.l=function(O){return O=g(this,O),D(O)?-1:I(O)?0:1};function A(O){for(var M=O.g.length,T=[],L=0;L<M;L++)T[L]=~O.g[L];return new o(T,~O.h).add(p)}n.abs=function(){return D(this)?A(this):this},n.add=function(O){for(var M=Math.max(this.g.length,O.g.length),T=[],L=0,G=0;G<=M;G++){var U=L+(this.i(G)&65535)+(O.i(G)&65535),k=(U>>>16)+(this.i(G)>>>16)+(O.i(G)>>>16);L=k>>>16,U&=65535,k&=65535,T[G]=k<<16|U}return new o(T,T[T.length-1]&-2147483648?-1:0)};function g(O,M){return O.add(A(M))}n.j=function(O){if(I(this)||I(O))return f;if(D(this))return D(O)?A(this).j(A(O)):A(A(this).j(O));if(D(O))return A(this.j(A(O)));if(0>this.l(x)&&0>O.l(x))return d(this.m()*O.m());for(var M=this.g.length+O.g.length,T=[],L=0;L<2*M;L++)T[L]=0;for(L=0;L<this.g.length;L++)for(var G=0;G<O.g.length;G++){var U=this.i(L)>>>16,k=this.i(L)&65535,re=O.i(G)>>>16,xe=O.i(G)&65535;T[2*L+2*G]+=k*xe,N(T,2*L+2*G),T[2*L+2*G+1]+=U*xe,N(T,2*L+2*G+1),T[2*L+2*G+1]+=k*re,N(T,2*L+2*G+1),T[2*L+2*G+2]+=U*re,N(T,2*L+2*G+2)}for(L=0;L<M;L++)T[L]=T[2*L+1]<<16|T[2*L];for(L=M;L<2*M;L++)T[L]=0;return new o(T,0)};function N(O,M){for(;(O[M]&65535)!=O[M];)O[M+1]+=O[M]>>>16,O[M]&=65535,M++}function j(O,M){this.g=O,this.h=M}function V(O,M){if(I(M))throw Error("division by zero");if(I(O))return new j(f,f);if(D(O))return M=V(A(O),M),new j(A(M.g),A(M.h));if(D(M))return M=V(O,A(M)),new j(A(M.g),M.h);if(30<O.g.length){if(D(O)||D(M))throw Error("slowDivide_ only works with positive integers.");for(var T=p,L=M;0>=L.l(O);)T=$(T),L=$(L);var G=Z(T,1),U=Z(L,1);for(L=Z(L,2),T=Z(T,2);!I(L);){var k=U.add(L);0>=k.l(O)&&(G=G.add(T),U=k),L=Z(L,1),T=Z(T,1)}return M=g(O,G.j(M)),new j(G,M)}for(G=f;0<=O.l(M);){for(T=Math.max(1,Math.floor(O.m()/M.m())),L=Math.ceil(Math.log(T)/Math.LN2),L=48>=L?1:Math.pow(2,L-48),U=d(T),k=U.j(M);D(k)||0<k.l(O);)T-=L,U=d(T),k=U.j(M);I(U)&&(U=p),G=G.add(U),O=g(O,k)}return new j(G,O)}n.A=function(O){return V(this,O).h},n.and=function(O){for(var M=Math.max(this.g.length,O.g.length),T=[],L=0;L<M;L++)T[L]=this.i(L)&O.i(L);return new o(T,this.h&O.h)},n.or=function(O){for(var M=Math.max(this.g.length,O.g.length),T=[],L=0;L<M;L++)T[L]=this.i(L)|O.i(L);return new o(T,this.h|O.h)},n.xor=function(O){for(var M=Math.max(this.g.length,O.g.length),T=[],L=0;L<M;L++)T[L]=this.i(L)^O.i(L);return new o(T,this.h^O.h)};function $(O){for(var M=O.g.length+1,T=[],L=0;L<M;L++)T[L]=O.i(L)<<1|O.i(L-1)>>>31;return new o(T,O.h)}function Z(O,M){var T=M>>5;M%=32;for(var L=O.g.length-T,G=[],U=0;U<L;U++)G[U]=0<M?O.i(U+T)>>>M|O.i(U+T+1)<<32-M:O.i(U+T);return new o(G,O.h)}s.prototype.digest=s.prototype.v,s.prototype.reset=s.prototype.s,s.prototype.update=s.prototype.u,iA=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=d,o.fromString=h,Ho=o}).apply(typeof IE<"u"?IE:typeof self<"u"?self:typeof window<"u"?window:{});var fp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var aA,Ih,oA,Up,M0,lA,cA,dA;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,y,S){return u==Array.prototype||u==Object.prototype||(u[y]=S.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof fp=="object"&&fp];for(var y=0;y<u.length;++y){var S=u[y];if(S&&S.Math==Math)return S}throw Error("Cannot find global object")}var s=t(this);function i(u,y){if(y)e:{var S=s;u=u.split(".");for(var q=0;q<u.length-1;q++){var me=u[q];if(!(me in S))break e;S=S[me]}u=u[u.length-1],q=S[u],y=y(q),y!=q&&y!=null&&e(S,u,{configurable:!0,writable:!0,value:y})}}function a(u,y){u instanceof String&&(u+="");var S=0,q=!1,me={next:function(){if(!q&&S<u.length){var be=S++;return{value:y(be,u[be]),done:!1}}return q=!0,{done:!0,value:void 0}}};return me[Symbol.iterator]=function(){return me},me}i("Array.prototype.values",function(u){return u||function(){return a(this,function(y,S){return S})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},l=this||self;function c(u){var y=typeof u;return y=y!="object"?y:u?Array.isArray(u)?"array":y:"null",y=="array"||y=="object"&&typeof u.length=="number"}function d(u){var y=typeof u;return y=="object"&&u!=null||y=="function"}function h(u,y,S){return u.call.apply(u.bind,arguments)}function f(u,y,S){if(!u)throw Error();if(2<arguments.length){var q=Array.prototype.slice.call(arguments,2);return function(){var me=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(me,q),u.apply(y,me)}}return function(){return u.apply(y,arguments)}}function p(u,y,S){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,p.apply(null,arguments)}function x(u,y){var S=Array.prototype.slice.call(arguments,1);return function(){var q=S.slice();return q.push.apply(q,arguments),u.apply(this,q)}}function I(u,y){function S(){}S.prototype=y.prototype,u.aa=y.prototype,u.prototype=new S,u.prototype.constructor=u,u.Qb=function(q,me,be){for(var $e=Array(arguments.length-2),Jt=2;Jt<arguments.length;Jt++)$e[Jt-2]=arguments[Jt];return y.prototype[me].apply(q,$e)}}function D(u){const y=u.length;if(0<y){const S=Array(y);for(let q=0;q<y;q++)S[q]=u[q];return S}return[]}function A(u,y){for(let S=1;S<arguments.length;S++){const q=arguments[S];if(c(q)){const me=u.length||0,be=q.length||0;u.length=me+be;for(let $e=0;$e<be;$e++)u[me+$e]=q[$e]}else u.push(q)}}class g{constructor(y,S){this.i=y,this.j=S,this.h=0,this.g=null}get(){let y;return 0<this.h?(this.h--,y=this.g,this.g=y.next,y.next=null):y=this.i(),y}}function N(u){return/^[\s\xa0]*$/.test(u)}function j(){var u=l.navigator;return u&&(u=u.userAgent)?u:""}function V(u){return V[" "](u),u}V[" "]=function(){};var $=j().indexOf("Gecko")!=-1&&!(j().toLowerCase().indexOf("webkit")!=-1&&j().indexOf("Edge")==-1)&&!(j().indexOf("Trident")!=-1||j().indexOf("MSIE")!=-1)&&j().indexOf("Edge")==-1;function Z(u,y,S){for(const q in u)y.call(S,u[q],q,u)}function O(u,y){for(const S in u)y.call(void 0,u[S],S,u)}function M(u){const y={};for(const S in u)y[S]=u[S];return y}const T="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function L(u,y){let S,q;for(let me=1;me<arguments.length;me++){q=arguments[me];for(S in q)u[S]=q[S];for(let be=0;be<T.length;be++)S=T[be],Object.prototype.hasOwnProperty.call(q,S)&&(u[S]=q[S])}}function G(u){var y=1;u=u.split(":");const S=[];for(;0<y&&u.length;)S.push(u.shift()),y--;return u.length&&S.push(u.join(":")),S}function U(u){l.setTimeout(()=>{throw u},0)}function k(){var u=Y;let y=null;return u.g&&(y=u.g,u.g=u.g.next,u.g||(u.h=null),y.next=null),y}class re{constructor(){this.h=this.g=null}add(y,S){const q=xe.get();q.set(y,S),this.h?this.h.next=q:this.g=q,this.h=q}}var xe=new g(()=>new H,u=>u.reset());class H{constructor(){this.next=this.g=this.h=null}set(y,S){this.h=y,this.g=S,this.next=null}reset(){this.next=this.g=this.h=null}}let ee,se=!1,Y=new re,R=()=>{const u=l.Promise.resolve(void 0);ee=()=>{u.then(_)}};var _=()=>{for(var u;u=k();){try{u.h.call(u.g)}catch(S){U(S)}var y=xe;y.j(u),100>y.h&&(y.h++,u.next=y.g,y.g=u)}se=!1};function C(){this.s=this.s,this.C=this.C}C.prototype.s=!1,C.prototype.ma=function(){this.s||(this.s=!0,this.N())},C.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function z(u,y){this.type=u,this.g=this.target=y,this.defaultPrevented=!1}z.prototype.h=function(){this.defaultPrevented=!0};var K=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var u=!1,y=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const S=()=>{};l.addEventListener("test",S,y),l.removeEventListener("test",S,y)}catch{}return u}();function F(u,y){if(z.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var S=this.type=u.type,q=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=y,y=u.relatedTarget){if($){e:{try{V(y.nodeName);var me=!0;break e}catch{}me=!1}me||(y=null)}}else S=="mouseover"?y=u.fromElement:S=="mouseout"&&(y=u.toElement);this.relatedTarget=y,q?(this.clientX=q.clientX!==void 0?q.clientX:q.pageX,this.clientY=q.clientY!==void 0?q.clientY:q.pageY,this.screenX=q.screenX||0,this.screenY=q.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:Q[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&F.aa.h.call(this)}}I(F,z);var Q={2:"touch",3:"pen",4:"mouse"};F.prototype.h=function(){F.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var oe="closure_listenable_"+(1e6*Math.random()|0),E=0;function te(u,y,S,q,me){this.listener=u,this.proxy=null,this.src=y,this.type=S,this.capture=!!q,this.ha=me,this.key=++E,this.da=this.fa=!1}function Te(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function ze(u){this.src=u,this.g={},this.h=0}ze.prototype.add=function(u,y,S,q,me){var be=u.toString();u=this.g[be],u||(u=this.g[be]=[],this.h++);var $e=at(u,y,q,me);return-1<$e?(y=u[$e],S||(y.fa=!1)):(y=new te(y,this.src,be,!!q,me),y.fa=S,u.push(y)),y};function We(u,y){var S=y.type;if(S in u.g){var q=u.g[S],me=Array.prototype.indexOf.call(q,y,void 0),be;(be=0<=me)&&Array.prototype.splice.call(q,me,1),be&&(Te(y),u.g[S].length==0&&(delete u.g[S],u.h--))}}function at(u,y,S,q){for(var me=0;me<u.length;++me){var be=u[me];if(!be.da&&be.listener==y&&be.capture==!!S&&be.ha==q)return me}return-1}var zt="closure_lm_"+(1e6*Math.random()|0),fe={};function Ce(u,y,S,q,me){if(Array.isArray(y)){for(var be=0;be<y.length;be++)Ce(u,y[be],S,q,me);return null}return S=Xt(S),u&&u[oe]?u.K(y,S,d(q)?!!q.capture:!1,me):Ne(u,y,S,!1,q,me)}function Ne(u,y,S,q,me,be){if(!y)throw Error("Invalid event type");var $e=d(me)?!!me.capture:!!me,Jt=Pt(u);if(Jt||(u[zt]=Jt=new ze(u)),S=Jt.add(y,S,q,$e,be),S.proxy)return S;if(q=He(),S.proxy=q,q.src=u,q.listener=S,u.addEventListener)K||(me=$e),me===void 0&&(me=!1),u.addEventListener(y.toString(),q,me);else if(u.attachEvent)u.attachEvent(Fe(y.toString()),q);else if(u.addListener&&u.removeListener)u.addListener(q);else throw Error("addEventListener and attachEvent are unavailable.");return S}function He(){function u(S){return y.call(u.src,u.listener,S)}const y=gt;return u}function Xe(u,y,S,q,me){if(Array.isArray(y))for(var be=0;be<y.length;be++)Xe(u,y[be],S,q,me);else q=d(q)?!!q.capture:!!q,S=Xt(S),u&&u[oe]?(u=u.i,y=String(y).toString(),y in u.g&&(be=u.g[y],S=at(be,S,q,me),-1<S&&(Te(be[S]),Array.prototype.splice.call(be,S,1),be.length==0&&(delete u.g[y],u.h--)))):u&&(u=Pt(u))&&(y=u.g[y.toString()],u=-1,y&&(u=at(y,S,q,me)),(S=-1<u?y[u]:null)&&ot(S))}function ot(u){if(typeof u!="number"&&u&&!u.da){var y=u.src;if(y&&y[oe])We(y.i,u);else{var S=u.type,q=u.proxy;y.removeEventListener?y.removeEventListener(S,q,u.capture):y.detachEvent?y.detachEvent(Fe(S),q):y.addListener&&y.removeListener&&y.removeListener(q),(S=Pt(y))?(We(S,u),S.h==0&&(S.src=null,y[zt]=null)):Te(u)}}}function Fe(u){return u in fe?fe[u]:fe[u]="on"+u}function gt(u,y){if(u.da)u=!0;else{y=new F(y,this);var S=u.listener,q=u.ha||u.src;u.fa&&ot(u),u=S.call(q,y)}return u}function Pt(u){return u=u[zt],u instanceof ze?u:null}var Yt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Xt(u){return typeof u=="function"?u:(u[Yt]||(u[Yt]=function(y){return u.handleEvent(y)}),u[Yt])}function Lt(){C.call(this),this.i=new ze(this),this.M=this,this.F=null}I(Lt,C),Lt.prototype[oe]=!0,Lt.prototype.removeEventListener=function(u,y,S,q){Xe(this,u,y,S,q)};function on(u,y){var S,q=u.F;if(q)for(S=[];q;q=q.F)S.push(q);if(u=u.M,q=y.type||y,typeof y=="string")y=new z(y,u);else if(y instanceof z)y.target=y.target||u;else{var me=y;y=new z(q,u),L(y,me)}if(me=!0,S)for(var be=S.length-1;0<=be;be--){var $e=y.g=S[be];me=Bn($e,q,!0,y)&&me}if($e=y.g=u,me=Bn($e,q,!0,y)&&me,me=Bn($e,q,!1,y)&&me,S)for(be=0;be<S.length;be++)$e=y.g=S[be],me=Bn($e,q,!1,y)&&me}Lt.prototype.N=function(){if(Lt.aa.N.call(this),this.i){var u=this.i,y;for(y in u.g){for(var S=u.g[y],q=0;q<S.length;q++)Te(S[q]);delete u.g[y],u.h--}}this.F=null},Lt.prototype.K=function(u,y,S,q){return this.i.add(String(u),y,!1,S,q)},Lt.prototype.L=function(u,y,S,q){return this.i.add(String(u),y,!0,S,q)};function Bn(u,y,S,q){if(y=u.i.g[String(y)],!y)return!0;y=y.concat();for(var me=!0,be=0;be<y.length;++be){var $e=y[be];if($e&&!$e.da&&$e.capture==S){var Jt=$e.listener,us=$e.ha||$e.src;$e.fa&&We(u.i,$e),me=Jt.call(us,q)!==!1&&me}}return me&&!q.defaultPrevented}function In(u,y,S){if(typeof u=="function")S&&(u=p(u,S));else if(u&&typeof u.handleEvent=="function")u=p(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(y)?-1:l.setTimeout(u,y||0)}function qn(u){u.g=In(()=>{u.g=null,u.i&&(u.i=!1,qn(u))},u.l);const y=u.h;u.h=null,u.m.apply(null,y)}class Hn extends C{constructor(y,S){super(),this.m=y,this.l=S,this.h=null,this.i=!1,this.g=null}j(y){this.h=arguments,this.g?this.i=!0:qn(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function w(u){C.call(this),this.h=u,this.g={}}I(w,C);var X=[];function ne(u){Z(u.g,function(y,S){this.g.hasOwnProperty(S)&&ot(y)},u),u.g={}}w.prototype.N=function(){w.aa.N.call(this),ne(this)},w.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var W=l.JSON.stringify,ie=l.JSON.parse,Ee=class{stringify(u){return l.JSON.stringify(u,void 0)}parse(u){return l.JSON.parse(u,void 0)}};function le(){}le.prototype.h=null;function ge(u){return u.h||(u.h=u.i())}function _e(){}var J={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ae(){z.call(this,"d")}I(ae,z);function je(){z.call(this,"c")}I(je,z);var Se={},Ie=null;function Re(){return Ie=Ie||new Lt}Se.La="serverreachability";function ye(u){z.call(this,Se.La,u)}I(ye,z);function ue(u){const y=Re();on(y,new ye(y))}Se.STAT_EVENT="statevent";function Me(u,y){z.call(this,Se.STAT_EVENT,u),this.stat=y}I(Me,z);function Pe(u){const y=Re();on(y,new Me(y,u))}Se.Ma="timingevent";function Le(u,y){z.call(this,Se.Ma,u),this.size=y}I(Le,z);function st(u,y){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){u()},y)}function ke(){this.g=!0}ke.prototype.xa=function(){this.g=!1};function Ve(u,y,S,q,me,be){u.info(function(){if(u.g)if(be)for(var $e="",Jt=be.split("&"),us=0;us<Jt.length;us++){var kt=Jt[us].split("=");if(1<kt.length){var vs=kt[0];kt=kt[1];var Ns=vs.split("_");$e=2<=Ns.length&&Ns[1]=="type"?$e+(vs+"="+kt+"&"):$e+(vs+"=redacted&")}}else $e=null;else $e=be;return"XMLHTTP REQ ("+q+") [attempt "+me+"]: "+y+`
`+S+`
`+$e})}function Tn(u,y,S,q,me,be,$e){u.info(function(){return"XMLHTTP RESP ("+q+") [ attempt "+me+"]: "+y+`
`+S+`
`+be+" "+$e})}function Gn(u,y,S,q){u.info(function(){return"XMLHTTP TEXT ("+y+"): "+bs(u,S)+(q?" "+q:"")})}function Mn(u,y){u.info(function(){return"TIMEOUT: "+y})}ke.prototype.info=function(){};function bs(u,y){if(!u.g)return y;if(!y)return null;try{var S=JSON.parse(y);if(S){for(u=0;u<S.length;u++)if(Array.isArray(S[u])){var q=S[u];if(!(2>q.length)){var me=q[1];if(Array.isArray(me)&&!(1>me.length)){var be=me[0];if(be!="noop"&&be!="stop"&&be!="close")for(var $e=1;$e<me.length;$e++)me[$e]=""}}}}return W(S)}catch{return y}}var Xs={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},sa={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ku;function Sc(){}I(Sc,le),Sc.prototype.g=function(){return new XMLHttpRequest},Sc.prototype.i=function(){return{}},ku=new Sc;function Js(u,y,S,q){this.j=u,this.i=y,this.l=S,this.R=q||1,this.U=new w(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ws}function ws(){this.i=null,this.g="",this.h=!1}var $s={},Rs={};function ds(u,y,S){u.L=1,u.v=aa(Qn(y)),u.m=S,u.P=!0,hl(u,null)}function hl(u,y){u.F=Date.now(),ci(u),u.A=Qn(u.v);var S=u.A,q=u.R;Array.isArray(q)||(q=[String(q)]),Cc(S.i,"t",q),u.C=0,S=u.j.J,u.h=new ws,u.g=zf(u.j,S?y:null,!u.m),0<u.O&&(u.M=new Hn(p(u.Y,u,u.g),u.O)),y=u.U,S=u.g,q=u.ca;var me="readystatechange";Array.isArray(me)||(me&&(X[0]=me.toString()),me=X);for(var be=0;be<me.length;be++){var $e=Ce(S,me[be],q||y.handleEvent,!1,y.h||y);if(!$e)break;y.g[$e.key]=$e}y=u.H?M(u.H):{},u.m?(u.u||(u.u="POST"),y["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,y)):(u.u="GET",u.g.ea(u.A,u.u,null,y)),ue(),Ve(u.i,u.u,u.A,u.l,u.R,u.m)}Js.prototype.ca=function(u){u=u.target;const y=this.M;y&&Bs(u)==3?y.j():this.Y(u)},Js.prototype.Y=function(u){try{if(u==this.g)e:{const Ns=Bs(this.g);var y=this.g.Ba();const js=this.g.Z();if(!(3>Ns)&&(Ns!=3||this.g&&(this.h.h||this.g.oa()||Lf(this.g)))){this.J||Ns!=4||y==7||(y==8||0>=js?ue(3):ue(2)),ml(this);var S=this.g.Z();this.X=S;t:if(ra(this)){var q=Lf(this.g);u="";var me=q.length,be=Bs(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ei(this),Br(this);var $e="";break t}this.h.i=new l.TextDecoder}for(y=0;y<me;y++)this.h.h=!0,u+=this.h.i.decode(q[y],{stream:!(be&&y==me-1)});q.length=0,this.h.g+=u,this.C=0,$e=this.h.g}else $e=this.g.oa();if(this.o=S==200,Tn(this.i,this.u,this.A,this.l,this.R,Ns,S),this.o){if(this.T&&!this.K){t:{if(this.g){var Jt,us=this.g;if((Jt=us.g?us.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!N(Jt)){var kt=Jt;break t}}kt=null}if(S=kt)Gn(this.i,this.l,S,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,fl(this,S);else{this.o=!1,this.s=3,Pe(12),Ei(this),Br(this);break e}}if(this.P){S=!0;let dr;for(;!this.J&&this.C<$e.length;)if(dr=ia(this,$e),dr==Rs){Ns==4&&(this.s=4,Pe(14),S=!1),Gn(this.i,this.l,null,"[Incomplete Response]");break}else if(dr==$s){this.s=4,Pe(15),Gn(this.i,this.l,$e,"[Invalid Chunk]"),S=!1;break}else Gn(this.i,this.l,dr,null),fl(this,dr);if(ra(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ns!=4||$e.length!=0||this.h.h||(this.s=1,Pe(16),S=!1),this.o=this.o&&S,!S)Gn(this.i,this.l,$e,"[Invalid Chunked Response]"),Ei(this),Br(this);else if(0<$e.length&&!this.W){this.W=!0;var vs=this.j;vs.g==this&&vs.ba&&!vs.M&&(vs.j.info("Great, no buffering proxy detected. Bytes received: "+$e.length),Ju(vs),vs.M=!0,Pe(11))}}else Gn(this.i,this.l,$e,null),fl(this,$e);Ns==4&&Ei(this),this.o&&!this.J&&(Ns==4?Zu(this.j,this):(this.o=!1,ci(this)))}else Ff(this.g),S==400&&0<$e.indexOf("Unknown SID")?(this.s=3,Pe(12)):(this.s=0,Pe(13)),Ei(this),Br(this)}}}catch{}finally{}};function ra(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function ia(u,y){var S=u.C,q=y.indexOf(`
`,S);return q==-1?Rs:(S=Number(y.substring(S,q)),isNaN(S)?$s:(q+=1,q+S>y.length?Rs:(y=y.slice(q,q+S),u.C=q+S,y)))}Js.prototype.cancel=function(){this.J=!0,Ei(this)};function ci(u){u.S=Date.now()+u.I,Ou(u,u.I)}function Ou(u,y){if(u.B!=null)throw Error("WatchDog timer not null");u.B=st(p(u.ba,u),y)}function ml(u){u.B&&(l.clearTimeout(u.B),u.B=null)}Js.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(Mn(this.i,this.A),this.L!=2&&(ue(),Pe(17)),Ei(this),this.s=2,Br(this)):Ou(this,this.S-u)};function Br(u){u.j.G==0||u.J||Zu(u.j,u)}function Ei(u){ml(u);var y=u.M;y&&typeof y.ma=="function"&&y.ma(),u.M=null,ne(u.U),u.g&&(y=u.g,u.g=null,y.abort(),y.ma())}function fl(u,y){try{var S=u.j;if(S.G!=0&&(S.g==u||Ic(S.h,u))){if(!u.K&&Ic(S.h,u)&&S.G==3){try{var q=S.Da.g.parse(y)}catch{q=null}if(Array.isArray(q)&&q.length==3){var me=q;if(me[0]==0){e:if(!S.u){if(S.g)if(S.g.F+3e3<u.F)wl(S),xl(S);else break e;Xu(S),Pe(18)}}else S.za=me[1],0<S.za-S.T&&37500>me[2]&&S.F&&S.v==0&&!S.C&&(S.C=st(p(S.Za,S),6e3));if(1>=Uu(S.h)&&S.ca){try{S.ca()}catch{}S.ca=void 0}}else ui(S,11)}else if((u.K||S.g==u)&&wl(S),!N(y))for(me=S.Da.g.parse(y),y=0;y<me.length;y++){let kt=me[y];if(S.T=kt[0],kt=kt[1],S.G==2)if(kt[0]=="c"){S.K=kt[1],S.ia=kt[2];const vs=kt[3];vs!=null&&(S.la=vs,S.j.info("VER="+S.la));const Ns=kt[4];Ns!=null&&(S.Aa=Ns,S.j.info("SVER="+S.Aa));const js=kt[5];js!=null&&typeof js=="number"&&0<js&&(q=1.5*js,S.L=q,S.j.info("backChannelRequestTimeoutMs_="+q)),q=S;const dr=u.g;if(dr){const vl=dr.g?dr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(vl){var be=q.h;be.g||vl.indexOf("spdy")==-1&&vl.indexOf("quic")==-1&&vl.indexOf("h2")==-1||(be.j=be.l,be.g=new Set,be.h&&(Tc(be,be.h),be.h=null))}if(q.D){const Lc=dr.g?dr.g.getResponseHeader("X-HTTP-Session-Id"):null;Lc&&(q.ya=Lc,Ft(q.I,q.D,Lc))}}S.G=3,S.l&&S.l.ua(),S.ba&&(S.R=Date.now()-u.F,S.j.info("Handshake RTT: "+S.R+"ms")),q=S;var $e=u;if(q.qa=eh(q,q.J?q.ia:null,q.W),$e.K){Vu(q.h,$e);var Jt=$e,us=q.L;us&&(Jt.I=us),Jt.B&&(ml(Jt),ci(Jt)),q.g=$e}else bl(q);0<S.i.length&&yl(S)}else kt[0]!="stop"&&kt[0]!="close"||ui(S,7);else S.G==3&&(kt[0]=="stop"||kt[0]=="close"?kt[0]=="stop"?ui(S,7):Pc(S):kt[0]!="noop"&&S.l&&S.l.ta(kt),S.v=0)}}ue(4)}catch{}}var Mu=class{constructor(u,y){this.g=u,this.map=y}};function Lu(u){this.l=u||10,l.PerformanceNavigationTiming?(u=l.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Fu(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function Uu(u){return u.h?1:u.g?u.g.size:0}function Ic(u,y){return u.h?u.h==y:u.g?u.g.has(y):!1}function Tc(u,y){u.g?u.g.add(y):u.h=y}function Vu(u,y){u.h&&u.h==y?u.h=null:u.g&&u.g.has(y)&&u.g.delete(y)}Lu.prototype.cancel=function(){if(this.i=zu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function zu(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let y=u.i;for(const S of u.g.values())y=y.concat(S.D);return y}return D(u.i)}function Tf(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(c(u)){for(var y=[],S=u.length,q=0;q<S;q++)y.push(u[q]);return y}y=[],S=0;for(q in u)y[S++]=u[q];return y}function Cf(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(c(u)||typeof u=="string"){var y=[];u=u.length;for(var S=0;S<u;S++)y.push(S);return y}y=[],S=0;for(const q in u)y[S++]=q;return y}}}function $u(u,y){if(u.forEach&&typeof u.forEach=="function")u.forEach(y,void 0);else if(c(u)||typeof u=="string")Array.prototype.forEach.call(u,y,void 0);else for(var S=Cf(u),q=Tf(u),me=q.length,be=0;be<me;be++)y.call(void 0,q[be],S&&S[be],u)}var jr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Zs(u,y){if(u){u=u.split("&");for(var S=0;S<u.length;S++){var q=u[S].indexOf("="),me=null;if(0<=q){var be=u[S].substring(0,q);me=u[S].substring(q+1)}else be=u[S];y(be,me?decodeURIComponent(me.replace(/\+/g," ")):"")}}}function er(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof er){this.h=u.h,Ja(this,u.j),this.o=u.o,this.g=u.g,Za(this,u.s),this.l=u.l;var y=u.i,S=new cr;S.i=y.i,y.g&&(S.g=new Map(y.g),S.h=y.h),_r(this,S),this.m=u.m}else u&&(y=String(u).match(jr))?(this.h=!1,Ja(this,y[1]||"",!0),this.o=qr(y[2]||""),this.g=qr(y[3]||"",!0),Za(this,y[4]),this.l=qr(y[5]||"",!0),_r(this,y[6]||"",!0),this.m=qr(y[7]||"")):(this.h=!1,this.i=new cr(null,this.h))}er.prototype.toString=function(){var u=[],y=this.j;y&&u.push(oa(y,la,!0),":");var S=this.g;return(S||y=="file")&&(u.push("//"),(y=this.o)&&u.push(oa(y,la,!0),"@"),u.push(encodeURIComponent(String(S)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),S=this.s,S!=null&&u.push(":",String(S))),(S=this.l)&&(this.g&&S.charAt(0)!="/"&&u.push("/"),u.push(oa(S,S.charAt(0)=="/"?Df:Bu,!0))),(S=this.i.toString())&&u.push("?",S),(S=this.m)&&u.push("#",oa(S,dy)),u.join("")};function Qn(u){return new er(u)}function Ja(u,y,S){u.j=S?qr(y,!0):y,u.j&&(u.j=u.j.replace(/:$/,""))}function Za(u,y){if(y){if(y=Number(y),isNaN(y)||0>y)throw Error("Bad port number "+y);u.s=y}else u.s=null}function _r(u,y,S){y instanceof cr?(u.i=y,Rf(u.i,u.h)):(S||(y=oa(y,di)),u.i=new cr(y,u.h))}function Ft(u,y,S){u.i.set(y,S)}function aa(u){return Ft(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function qr(u,y){return u?y?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function oa(u,y,S){return typeof u=="string"?(u=encodeURI(u).replace(y,Af),S&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function Af(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var la=/[#\/\?@]/g,Bu=/[#\?:]/g,Df=/[#\?]/g,di=/[#\?@]/g,dy=/#/g;function cr(u,y){this.h=this.g=null,this.i=u||null,this.j=!!y}function Er(u){u.g||(u.g=new Map,u.h=0,u.i&&Zs(u.i,function(y,S){u.add(decodeURIComponent(y.replace(/\+/g," ")),S)}))}n=cr.prototype,n.add=function(u,y){Er(this),this.i=null,u=Hr(this,u);var S=this.g.get(u);return S||this.g.set(u,S=[]),S.push(y),this.h+=1,this};function qu(u,y){Er(u),y=Hr(u,y),u.g.has(y)&&(u.i=null,u.h-=u.g.get(y).length,u.g.delete(y))}function eo(u,y){return Er(u),y=Hr(u,y),u.g.has(y)}n.forEach=function(u,y){Er(this),this.g.forEach(function(S,q){S.forEach(function(me){u.call(y,me,q,this)},this)},this)},n.na=function(){Er(this);const u=Array.from(this.g.values()),y=Array.from(this.g.keys()),S=[];for(let q=0;q<y.length;q++){const me=u[q];for(let be=0;be<me.length;be++)S.push(y[q])}return S},n.V=function(u){Er(this);let y=[];if(typeof u=="string")eo(this,u)&&(y=y.concat(this.g.get(Hr(this,u))));else{u=Array.from(this.g.values());for(let S=0;S<u.length;S++)y=y.concat(u[S])}return y},n.set=function(u,y){return Er(this),this.i=null,u=Hr(this,u),eo(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[y]),this.h+=1,this},n.get=function(u,y){return u?(u=this.V(u),0<u.length?String(u[0]):y):y};function Cc(u,y,S){qu(u,y),0<S.length&&(u.i=null,u.g.set(Hr(u,y),D(S)),u.h+=S.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],y=Array.from(this.g.keys());for(var S=0;S<y.length;S++){var q=y[S];const be=encodeURIComponent(String(q)),$e=this.V(q);for(q=0;q<$e.length;q++){var me=be;$e[q]!==""&&(me+="="+encodeURIComponent(String($e[q]))),u.push(me)}}return this.i=u.join("&")};function Hr(u,y){return y=String(y),u.j&&(y=y.toLowerCase()),y}function Rf(u,y){y&&!u.j&&(Er(u),u.i=null,u.g.forEach(function(S,q){var me=q.toLowerCase();q!=me&&(qu(this,q),Cc(this,me,S))},u)),u.j=y}function Pf(u,y){const S=new ke;if(l.Image){const q=new Image;q.onload=x(tr,S,"TestLoadImage: loaded",!0,y,q),q.onerror=x(tr,S,"TestLoadImage: error",!1,y,q),q.onabort=x(tr,S,"TestLoadImage: abort",!1,y,q),q.ontimeout=x(tr,S,"TestLoadImage: timeout",!1,y,q),l.setTimeout(function(){q.ontimeout&&q.ontimeout()},1e4),q.src=u}else y(!1)}function kf(u,y){const S=new ke,q=new AbortController,me=setTimeout(()=>{q.abort(),tr(S,"TestPingServer: timeout",!1,y)},1e4);fetch(u,{signal:q.signal}).then(be=>{clearTimeout(me),be.ok?tr(S,"TestPingServer: ok",!0,y):tr(S,"TestPingServer: server error",!1,y)}).catch(()=>{clearTimeout(me),tr(S,"TestPingServer: error",!1,y)})}function tr(u,y,S,q,me){try{me&&(me.onload=null,me.onerror=null,me.onabort=null,me.ontimeout=null),q(S)}catch{}}function uy(){this.g=new Ee}function Of(u,y,S){const q=S||"";try{$u(u,function(me,be){let $e=me;d(me)&&($e=W(me)),y.push(q+be+"="+encodeURIComponent($e))})}catch(me){throw y.push(q+"type="+encodeURIComponent("_badmap")),me}}function to(u){this.l=u.Ub||null,this.j=u.eb||!1}I(to,le),to.prototype.g=function(){return new ca(this.l,this.j)},to.prototype.i=function(u){return function(){return u}}({});function ca(u,y){Lt.call(this),this.D=u,this.o=y,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}I(ca,Lt),n=ca.prototype,n.open=function(u,y){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=y,this.readyState=1,Si(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const y={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(y.body=u),(this.D||l).fetch(new Request(this.A,y)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,pl(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Si(this)),this.g&&(this.readyState=3,Si(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ac(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ac(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var y=u.value?u.value:new Uint8Array(0);(y=this.v.decode(y,{stream:!u.done}))&&(this.response=this.responseText+=y)}u.done?pl(this):Si(this),this.readyState==3&&Ac(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,pl(this))},n.Qa=function(u){this.g&&(this.response=u,pl(this))},n.ga=function(){this.g&&pl(this)};function pl(u){u.readyState=4,u.l=null,u.j=null,u.v=null,Si(u)}n.setRequestHeader=function(u,y){this.u.append(u,y)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],y=this.h.entries();for(var S=y.next();!S.done;)S=S.value,u.push(S[0]+": "+S[1]),S=y.next();return u.join(`\r
`)};function Si(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(ca.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function Mf(u){let y="";return Z(u,function(S,q){y+=q,y+=":",y+=S,y+=`\r
`}),y}function Dc(u,y,S){e:{for(q in S){var q=!1;break e}q=!0}q||(S=Mf(S),typeof u=="string"?S!=null&&encodeURIComponent(String(S)):Ft(u,y,S))}function xn(u){Lt.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}I(xn,Lt);var Hu=/^https?$/i,Gu=["POST","PUT"];n=xn.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,y,S,q){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);y=y?y.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ku.g(),this.v=this.o?ge(this.o):ge(ku),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(y,String(u),!0),this.B=!1}catch(be){Qu(this,be);return}if(u=S||"",S=new Map(this.headers),q)if(Object.getPrototypeOf(q)===Object.prototype)for(var me in q)S.set(me,q[me]);else if(typeof q.keys=="function"&&typeof q.get=="function")for(const be of q.keys())S.set(be,q.get(be));else throw Error("Unknown input type for opt_headers: "+String(q));q=Array.from(S.keys()).find(be=>be.toLowerCase()=="content-type"),me=l.FormData&&u instanceof l.FormData,!(0<=Array.prototype.indexOf.call(Gu,y,void 0))||q||me||S.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[be,$e]of S)this.g.setRequestHeader(be,$e);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Wu(this),this.u=!0,this.g.send(u),this.u=!1}catch(be){Qu(this,be)}};function Qu(u,y){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=y,u.m=5,no(u),gl(u)}function no(u){u.A||(u.A=!0,on(u,"complete"),on(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,on(this,"complete"),on(this,"abort"),gl(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),gl(this,!0)),xn.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Rc(this):this.bb())},n.bb=function(){Rc(this)};function Rc(u){if(u.h&&typeof o<"u"&&(!u.v[1]||Bs(u)!=4||u.Z()!=2)){if(u.u&&Bs(u)==4)In(u.Ea,0,u);else if(on(u,"readystatechange"),Bs(u)==4){u.h=!1;try{const $e=u.Z();e:switch($e){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var y=!0;break e;default:y=!1}var S;if(!(S=y)){var q;if(q=$e===0){var me=String(u.D).match(jr)[1]||null;!me&&l.self&&l.self.location&&(me=l.self.location.protocol.slice(0,-1)),q=!Hu.test(me?me.toLowerCase():"")}S=q}if(S)on(u,"complete"),on(u,"success");else{u.m=6;try{var be=2<Bs(u)?u.g.statusText:""}catch{be=""}u.l=be+" ["+u.Z()+"]",no(u)}}finally{gl(u)}}}}function gl(u,y){if(u.g){Wu(u);const S=u.g,q=u.v[0]?()=>{}:null;u.g=null,u.v=null,y||on(u,"ready");try{S.onreadystatechange=q}catch{}}}function Wu(u){u.I&&(l.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function Bs(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<Bs(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var y=this.g.responseText;return u&&y.indexOf(u)==0&&(y=y.substring(u.length)),ie(y)}};function Lf(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function Ff(u){const y={};u=(u.g&&2<=Bs(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let q=0;q<u.length;q++){if(N(u[q]))continue;var S=G(u[q]);const me=S[0];if(S=S[1],typeof S!="string")continue;S=S.trim();const be=y[me]||[];y[me]=be,be.push(S)}O(y,function(q){return q.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function so(u,y,S){return S&&S.internalChannelParams&&S.internalChannelParams[u]||y}function Ku(u){this.Aa=0,this.i=[],this.j=new ke,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=so("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=so("baseRetryDelayMs",5e3,u),this.cb=so("retryDelaySeedMs",1e4,u),this.Wa=so("forwardChannelMaxRetries",2,u),this.wa=so("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new Lu(u&&u.concurrentRequestLimit),this.Da=new uy,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Ku.prototype,n.la=8,n.G=1,n.connect=function(u,y,S,q){Pe(0),this.W=u,this.H=y||{},S&&q!==void 0&&(this.H.OSID=S,this.H.OAID=q),this.F=this.X,this.I=eh(this,null,this.W),yl(this)};function Pc(u){if(kc(u),u.G==3){var y=u.U++,S=Qn(u.I);if(Ft(S,"SID",u.K),Ft(S,"RID",y),Ft(S,"TYPE","terminate"),ro(u,S),y=new Js(u,u.j,y),y.L=2,y.v=aa(Qn(S)),S=!1,l.navigator&&l.navigator.sendBeacon)try{S=l.navigator.sendBeacon(y.v.toString(),"")}catch{}!S&&l.Image&&(new Image().src=y.v,S=!0),S||(y.g=zf(y.j,null),y.g.ea(y.v)),y.F=Date.now(),ci(y)}Vf(u)}function xl(u){u.g&&(Ju(u),u.g.cancel(),u.g=null)}function kc(u){xl(u),u.u&&(l.clearTimeout(u.u),u.u=null),wl(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&l.clearTimeout(u.s),u.s=null)}function yl(u){if(!Fu(u.h)&&!u.s){u.s=!0;var y=u.Ga;ee||R(),se||(ee(),se=!0),Y.add(y,u),u.B=0}}function hy(u,y){return Uu(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=y.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=st(p(u.Ga,u,y),Ii(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const me=new Js(this,this.j,u);let be=this.o;if(this.S&&(be?(be=M(be),L(be,this.S)):be=this.S),this.m!==null||this.O||(me.H=be,be=null),this.P)e:{for(var y=0,S=0;S<this.i.length;S++){t:{var q=this.i[S];if("__data__"in q.map&&(q=q.map.__data__,typeof q=="string")){q=q.length;break t}q=void 0}if(q===void 0)break;if(y+=q,4096<y){y=S;break e}if(y===4096||S===this.i.length-1){y=S+1;break e}}y=1e3}else y=1e3;y=Yu(this,me,y),S=Qn(this.I),Ft(S,"RID",u),Ft(S,"CVER",22),this.D&&Ft(S,"X-HTTP-Session-Id",this.D),ro(this,S),be&&(this.O?y="headers="+encodeURIComponent(String(Mf(be)))+"&"+y:this.m&&Dc(S,this.m,be)),Tc(this.h,me),this.Ua&&Ft(S,"TYPE","init"),this.P?(Ft(S,"$req",y),Ft(S,"SID","null"),me.T=!0,ds(me,S,null)):ds(me,S,y),this.G=2}}else this.G==3&&(u?Uf(this,u):this.i.length==0||Fu(this.h)||Uf(this))};function Uf(u,y){var S;y?S=y.l:S=u.U++;const q=Qn(u.I);Ft(q,"SID",u.K),Ft(q,"RID",S),Ft(q,"AID",u.T),ro(u,q),u.m&&u.o&&Dc(q,u.m,u.o),S=new Js(u,u.j,S,u.B+1),u.m===null&&(S.H=u.o),y&&(u.i=y.D.concat(u.i)),y=Yu(u,S,1e3),S.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),Tc(u.h,S),ds(S,q,y)}function ro(u,y){u.H&&Z(u.H,function(S,q){Ft(y,q,S)}),u.l&&$u({},function(S,q){Ft(y,q,S)})}function Yu(u,y,S){S=Math.min(u.i.length,S);var q=u.l?p(u.l.Na,u.l,u):null;e:{var me=u.i;let be=-1;for(;;){const $e=["count="+S];be==-1?0<S?(be=me[0].g,$e.push("ofs="+be)):be=0:$e.push("ofs="+be);let Jt=!0;for(let us=0;us<S;us++){let kt=me[us].g;const vs=me[us].map;if(kt-=be,0>kt)be=Math.max(0,me[us].g-100),Jt=!1;else try{Of(vs,$e,"req"+kt+"_")}catch{q&&q(vs)}}if(Jt){q=$e.join("&");break e}}}return u=u.i.splice(0,S),y.D=u,q}function bl(u){if(!u.g&&!u.u){u.Y=1;var y=u.Fa;ee||R(),se||(ee(),se=!0),Y.add(y,u),u.v=0}}function Xu(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=st(p(u.Fa,u),Ii(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,Oc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=st(p(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Pe(10),xl(this),Oc(this))};function Ju(u){u.A!=null&&(l.clearTimeout(u.A),u.A=null)}function Oc(u){u.g=new Js(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var y=Qn(u.qa);Ft(y,"RID","rpc"),Ft(y,"SID",u.K),Ft(y,"AID",u.T),Ft(y,"CI",u.F?"0":"1"),!u.F&&u.ja&&Ft(y,"TO",u.ja),Ft(y,"TYPE","xmlhttp"),ro(u,y),u.m&&u.o&&Dc(y,u.m,u.o),u.L&&(u.g.I=u.L);var S=u.g;u=u.ia,S.L=1,S.v=aa(Qn(y)),S.m=null,S.P=!0,hl(S,u)}n.Za=function(){this.C!=null&&(this.C=null,xl(this),Xu(this),Pe(19))};function wl(u){u.C!=null&&(l.clearTimeout(u.C),u.C=null)}function Zu(u,y){var S=null;if(u.g==y){wl(u),Ju(u),u.g=null;var q=2}else if(Ic(u.h,y))S=y.D,Vu(u.h,y),q=1;else return;if(u.G!=0){if(y.o)if(q==1){S=y.m?y.m.length:0,y=Date.now()-y.F;var me=u.B;q=Re(),on(q,new Le(q,S)),yl(u)}else bl(u);else if(me=y.s,me==3||me==0&&0<y.X||!(q==1&&hy(u,y)||q==2&&Xu(u)))switch(S&&0<S.length&&(y=u.h,y.i=y.i.concat(S)),me){case 1:ui(u,5);break;case 4:ui(u,10);break;case 3:ui(u,6);break;default:ui(u,2)}}}function Ii(u,y){let S=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(S*=2),S*y}function ui(u,y){if(u.j.info("Error code "+y),y==2){var S=p(u.fb,u),q=u.Xa;const me=!q;q=new er(q||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Ja(q,"https"),aa(q),me?Pf(q.toString(),S):kf(q.toString(),S)}else Pe(2);u.G=0,u.l&&u.l.sa(y),Vf(u),kc(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),Pe(2)):(this.j.info("Failed to ping google.com"),Pe(1))};function Vf(u){if(u.G=0,u.ka=[],u.l){const y=zu(u.h);(y.length!=0||u.i.length!=0)&&(A(u.ka,y),A(u.ka,u.i),u.h.i.length=0,D(u.i),u.i.length=0),u.l.ra()}}function eh(u,y,S){var q=S instanceof er?Qn(S):new er(S);if(q.g!="")y&&(q.g=y+"."+q.g),Za(q,q.s);else{var me=l.location;q=me.protocol,y=y?y+"."+me.hostname:me.hostname,me=+me.port;var be=new er(null);q&&Ja(be,q),y&&(be.g=y),me&&Za(be,me),S&&(be.l=S),q=be}return S=u.D,y=u.ya,S&&y&&Ft(q,S,y),Ft(q,"VER",u.la),ro(u,q),q}function zf(u,y,S){if(y&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return y=u.Ca&&!u.pa?new xn(new to({eb:S})):new xn(u.pa),y.Ha(u.J),y}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function $f(){}n=$f.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Mc(){}Mc.prototype.g=function(u,y){return new nr(u,y)};function nr(u,y){Lt.call(this),this.g=new Ku(y),this.l=u,this.h=y&&y.messageUrlParams||null,u=y&&y.messageHeaders||null,y&&y.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=y&&y.initMessageHeaders||null,y&&y.messageContentType&&(u?u["X-WebChannel-Content-Type"]=y.messageContentType:u={"X-WebChannel-Content-Type":y.messageContentType}),y&&y.va&&(u?u["X-WebChannel-Client-Profile"]=y.va:u={"X-WebChannel-Client-Profile":y.va}),this.g.S=u,(u=y&&y.Sb)&&!N(u)&&(this.g.m=u),this.v=y&&y.supportsCrossDomainXhr||!1,this.u=y&&y.sendRawJson||!1,(y=y&&y.httpSessionIdParam)&&!N(y)&&(this.g.D=y,u=this.h,u!==null&&y in u&&(u=this.h,y in u&&delete u[y])),this.j=new io(this)}I(nr,Lt),nr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},nr.prototype.close=function(){Pc(this.g)},nr.prototype.o=function(u){var y=this.g;if(typeof u=="string"){var S={};S.__data__=u,u=S}else this.u&&(S={},S.__data__=W(u),u=S);y.i.push(new Mu(y.Ya++,u)),y.G==3&&yl(y)},nr.prototype.N=function(){this.g.l=null,delete this.j,Pc(this.g),delete this.g,nr.aa.N.call(this)};function th(u){ae.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var y=u.__sm__;if(y){e:{for(const S in y){u=S;break e}u=void 0}(this.i=u)&&(u=this.i,y=y!==null&&u in y?y[u]:void 0),this.data=y}else this.data=u}I(th,ae);function nh(){je.call(this),this.status=1}I(nh,je);function io(u){this.g=u}I(io,$f),io.prototype.ua=function(){on(this.g,"a")},io.prototype.ta=function(u){on(this.g,new th(u))},io.prototype.sa=function(u){on(this.g,new nh)},io.prototype.ra=function(){on(this.g,"b")},Mc.prototype.createWebChannel=Mc.prototype.g,nr.prototype.send=nr.prototype.o,nr.prototype.open=nr.prototype.m,nr.prototype.close=nr.prototype.close,dA=function(){return new Mc},cA=function(){return Re()},lA=Se,M0={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Xs.NO_ERROR=0,Xs.TIMEOUT=8,Xs.HTTP_ERROR=6,Up=Xs,sa.COMPLETE="complete",oA=sa,_e.EventType=J,J.OPEN="a",J.CLOSE="b",J.ERROR="c",J.MESSAGE="d",Lt.prototype.listen=Lt.prototype.K,Ih=_e,xn.prototype.listenOnce=xn.prototype.L,xn.prototype.getLastError=xn.prototype.Ka,xn.prototype.getLastErrorCode=xn.prototype.Ba,xn.prototype.getStatus=xn.prototype.Z,xn.prototype.getResponseJson=xn.prototype.Oa,xn.prototype.getResponseText=xn.prototype.oa,xn.prototype.send=xn.prototype.ea,xn.prototype.setWithCredentials=xn.prototype.Ha,aA=xn}).apply(typeof fp<"u"?fp:typeof self<"u"?self:typeof window<"u"?window:{});const TE="@firebase/firestore",CE="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Is{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Is.UNAUTHENTICATED=new Is(null),Is.GOOGLE_CREDENTIALS=new Is("google-credentials-uid"),Is.FIRST_PARTY=new Is("first-party-uid"),Is.MOCK_USER=new Is("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Nu="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uc=new Ev("@firebase/firestore");function Jc(){return uc.logLevel}function Oe(n,...e){if(uc.logLevel<=Tt.DEBUG){const t=e.map(Cv);uc.debug(`Firestore (${Nu}): ${n}`,...t)}}function rs(n,...e){if(uc.logLevel<=Tt.ERROR){const t=e.map(Cv);uc.error(`Firestore (${Nu}): ${n}`,...t)}}function Hd(n,...e){if(uc.logLevel<=Tt.WARN){const t=e.map(Cv);uc.warn(`Firestore (${Nu}): ${n}`,...t)}}function Cv(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Je(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,uA(n,s,t)}function uA(n,e,t){let s=`FIRESTORE (${Nu}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw rs(s),new Error(s)}function nt(n,e,t,s){let i="Unexpected state";typeof t=="string"?i=t:s=t,n||uA(e,i,s)}function tt(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const we={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ue extends na{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yi{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hA{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class c4{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Is.UNAUTHENTICATED))}shutdown(){}}class d4{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class u4{constructor(e){this.t=e,this.currentUser=Is.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){nt(this.o===void 0,42304);let s=this.i;const i=c=>this.i!==s?(s=this.i,t(c)):Promise.resolve();let a=new yi;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new yi,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const c=a;e.enqueueRetryable(async()=>{await c.promise,await i(this.currentUser)})},l=c=>{Oe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>l(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(Oe("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new yi)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(s=>this.i!==e?(Oe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(nt(typeof s.accessToken=="string",31837,{l:s}),new hA(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return nt(e===null||typeof e=="string",2055,{h:e}),new Is(e)}}class h4{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=Is.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class m4{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new h4(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Is.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class AE{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class f4{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,gr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){nt(this.o===void 0,3512);const s=a=>{a.error!=null&&Oe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);const o=a.token!==this.m;return this.m=a.token,Oe("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(a.token):Promise.resolve()};this.o=a=>{e.enqueueRetryable(()=>s(a))};const i=a=>{Oe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(a=>i(a)),setTimeout(()=>{if(!this.appCheck){const a=this.V.getImmediate({optional:!0});a?i(a):Oe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new AE(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(nt(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new AE(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p4(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Av{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const i=p4(40);for(let a=0;a<i.length;++a)s.length<20&&i[a]<t&&(s+=e.charAt(i[a]%62))}return s}}function ft(n,e){return n<e?-1:n>e?1:0}function L0(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const i=n.charAt(s),a=e.charAt(s);if(i!==a)return pb(i)===pb(a)?ft(i,a):pb(i)?1:-1}return ft(n.length,e.length)}const g4=55296,x4=57343;function pb(n){const e=n.charCodeAt(0);return e>=g4&&e<=x4}function Gd(n,e,t){return n.length===e.length&&n.every((s,i)=>t(s,e[i]))}function mA(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DE="__name__";class Pi{constructor(e,t,s){t===void 0?t=0:t>e.length&&Je(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&Je(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return Pi.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Pi?e.forEach(s=>{t.push(s)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let i=0;i<s;i++){const a=Pi.compareSegments(e.get(i),t.get(i));if(a!==0)return a}return ft(e.length,t.length)}static compareSegments(e,t){const s=Pi.isNumericId(e),i=Pi.isNumericId(t);return s&&!i?-1:!s&&i?1:s&&i?Pi.extractNumericId(e).compare(Pi.extractNumericId(t)):L0(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ho.fromString(e.substring(4,e.length-2))}}class Vt extends Pi{construct(e,t,s){return new Vt(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new Ue(we.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter(i=>i.length>0))}return new Vt(t)}static emptyPath(){return new Vt([])}}const y4=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Fn extends Pi{construct(e,t,s){return new Fn(e,t,s)}static isValidIdentifier(e){return y4.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Fn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===DE}static keyField(){return new Fn([DE])}static fromServerFormat(e){const t=[];let s="",i=0;const a=()=>{if(s.length===0)throw new Ue(we.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let o=!1;for(;i<e.length;){const l=e[i];if(l==="\\"){if(i+1===e.length)throw new Ue(we.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new Ue(we.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=c,i+=2}else l==="`"?(o=!o,i++):l!=="."||o?(s+=l,i++):(a(),i++)}if(a(),o)throw new Ue(we.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Fn(t)}static emptyPath(){return new Fn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ge{constructor(e){this.path=e}static fromPath(e){return new Ge(Vt.fromString(e))}static fromName(e){return new Ge(Vt.fromString(e).popFirst(5))}static empty(){return new Ge(Vt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Vt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Vt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ge(new Vt(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fA(n,e,t){if(!t)throw new Ue(we.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function b4(n,e,t,s){if(e===!0&&s===!0)throw new Ue(we.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function RE(n){if(!Ge.isDocumentKey(n))throw new Ue(we.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function PE(n){if(Ge.isDocumentKey(n))throw new Ue(we.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function pA(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Dx(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(s){return s.constructor?s.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Je(12329,{type:typeof n})}function Ws(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Ue(we.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Dx(n);throw new Ue(we.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function w4(n,e){if(e<=0)throw new Ue(we.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ls(n,e){const t={typeString:n};return e&&(t.value=e),t}function uf(n,e){if(!pA(n))throw new Ue(we.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const i=e[s].typeString,a="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const o=n[s];if(i&&typeof o!==i){t=`JSON field '${s}' must be a ${i}.`;break}if(a!==void 0&&o!==a.value){t=`Expected '${s}' field to equal '${a.value}'`;break}}if(t)throw new Ue(we.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kE=-62135596800,OE=1e6;class Gt{static now(){return Gt.fromMillis(Date.now())}static fromDate(e){return Gt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*OE);return new Gt(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Ue(we.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Ue(we.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<kE)throw new Ue(we.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ue(we.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/OE}_compareTo(e){return this.seconds===e.seconds?ft(this.nanoseconds,e.nanoseconds):ft(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Gt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(uf(e,Gt._jsonSchema))return new Gt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-kE;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Gt._jsonSchemaVersion="firestore/timestamp/1.0",Gt._jsonSchema={type:ls("string",Gt._jsonSchemaVersion),seconds:ls("number"),nanoseconds:ls("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rt{static fromTimestamp(e){return new rt(e)}static min(){return new rt(new Gt(0,0))}static max(){return new rt(new Gt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qd=-1;class Og{constructor(e,t,s,i){this.indexId=e,this.collectionGroup=t,this.fields=s,this.indexState=i}}function F0(n){return n.fields.find(e=>e.kind===2)}function zl(n){return n.fields.filter(e=>e.kind!==2)}Og.UNKNOWN_ID=-1;class Vp{constructor(e,t){this.fieldPath=e,this.kind=t}}class Em{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Em(0,$r.min())}}function gA(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,i=rt.fromTimestamp(s===1e9?new Gt(t+1,0):new Gt(t,s));return new $r(i,Ge.empty(),e)}function xA(n){return new $r(n.readTime,n.key,Qd)}class $r{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new $r(rt.min(),Ge.empty(),Qd)}static max(){return new $r(rt.max(),Ge.empty(),Qd)}}function Dv(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Ge.comparator(n.documentKey,e.documentKey),t!==0?t:ft(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yA="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class bA{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function al(n){if(n.code!==we.FAILED_PRECONDITION||n.message!==yA)throw n;Oe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class he{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Je(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new he((s,i)=>{this.nextCallback=a=>{this.wrapSuccess(e,a).next(s,i)},this.catchCallback=a=>{this.wrapFailure(t,a).next(s,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof he?t:he.resolve(t)}catch(t){return he.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):he.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):he.reject(t)}static resolve(e){return new he((t,s)=>{t(e)})}static reject(e){return new he((t,s)=>{s(e)})}static waitFor(e){return new he((t,s)=>{let i=0,a=0,o=!1;e.forEach(l=>{++i,l.next(()=>{++a,o&&a===i&&t()},c=>s(c))}),o=!0,a===i&&t()})}static or(e){let t=he.resolve(!1);for(const s of e)t=t.next(i=>i?he.resolve(i):s());return t}static forEach(e,t){const s=[];return e.forEach((i,a)=>{s.push(t.call(this,i,a))}),this.waitFor(s)}static mapArray(e,t){return new he((s,i)=>{const a=e.length,o=new Array(a);let l=0;for(let c=0;c<a;c++){const d=c;t(e[d]).next(h=>{o[d]=h,++l,l===a&&s(o)},h=>i(h))}})}static doWhile(e,t){return new he((s,i)=>{const a=()=>{e()===!0?t().next(()=>{a()},i):s()};a()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dr="SimpleDb";class Rx{static open(e,t,s,i){try{return new Rx(t,e.transaction(i,s))}catch(a){throw new Wh(t,a)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new yi,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Wh(e,t.error)):this.S.resolve()},this.transaction.onerror=s=>{const i=Rv(s.target.error);this.S.reject(new Wh(e,i))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(Oe(Dr,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new N4(t)}}class Go{static delete(e){return Oe(Dr,"Removing database:",e),ql(HC().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!eA())return!1;if(Go.F())return!0;const e=ps(),t=Go.M(e),s=0<t&&t<10,i=wA(e),a=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||s||a)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),s=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(s)}constructor(e,t,s){this.name=e,this.version=t,this.N=s,this.B=null,Go.M(ps())===12.2&&rs("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(Oe(Dr,"Opening database:",this.name),this.db=await new Promise((t,s)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=a=>{const o=a.target.result;t(o)},i.onblocked=()=>{s(new Wh(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=a=>{const o=a.target.error;o.name==="VersionError"?s(new Ue(we.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?s(new Ue(we.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):s(new Wh(e,o))},i.onupgradeneeded=a=>{Oe(Dr,'Database "'+this.name+'" requires upgrade from version:',a.oldVersion);const o=a.target.result;this.N.k(o,i.transaction,a.oldVersion,this.version).next(()=>{Oe(Dr,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,s,i){const a=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const l=Rx.open(this.db,e,a?"readonly":"readwrite",s),c=i(l).next(d=>(l.C(),d)).catch(d=>(l.abort(d),he.reject(d))).toPromise();return c.catch(()=>{}),await l.D,c}catch(l){const c=l,d=c.name!=="FirebaseError"&&o<3;if(Oe(Dr,"Transaction failed with error:",c.message,"Retrying:",d),this.close(),!d)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function wA(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class v4{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return ql(this.U.delete())}}class Wh extends Ue{constructor(e,t){super(we.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ol(n){return n.name==="IndexedDbTransactionError"}class N4{constructor(e){this.store=e}put(e,t){let s;return t!==void 0?(Oe(Dr,"PUT",this.store.name,e,t),s=this.store.put(t,e)):(Oe(Dr,"PUT",this.store.name,"<auto-key>",e),s=this.store.put(e)),ql(s)}add(e){return Oe(Dr,"ADD",this.store.name,e,e),ql(this.store.add(e))}get(e){return ql(this.store.get(e)).next(t=>(t===void 0&&(t=null),Oe(Dr,"GET",this.store.name,e,t),t))}delete(e){return Oe(Dr,"DELETE",this.store.name,e),ql(this.store.delete(e))}count(){return Oe(Dr,"COUNT",this.store.name),ql(this.store.count())}J(e,t){const s=this.options(e,t),i=s.index?this.store.index(s.index):this.store;if(typeof i.getAll=="function"){const a=i.getAll(s.range);return new he((o,l)=>{a.onerror=c=>{l(c.target.error)},a.onsuccess=c=>{o(c.target.result)}})}{const a=this.cursor(s),o=[];return this.H(a,(l,c)=>{o.push(c)}).next(()=>o)}}Y(e,t){const s=this.store.getAll(e,t===null?void 0:t);return new he((i,a)=>{s.onerror=o=>{a(o.target.error)},s.onsuccess=o=>{i(o.target.result)}})}Z(e,t){Oe(Dr,"DELETE ALL",this.store.name);const s=this.options(e,t);s.X=!1;const i=this.cursor(s);return this.H(i,(a,o,l)=>l.delete())}ee(e,t){let s;t?s=e:(s={},t=e);const i=this.cursor(s);return this.H(i,t)}te(e){const t=this.cursor({});return new he((s,i)=>{t.onerror=a=>{const o=Rv(a.target.error);i(o)},t.onsuccess=a=>{const o=a.target.result;o?e(o.primaryKey,o.value).next(l=>{l?o.continue():s()}):s()}})}H(e,t){const s=[];return new he((i,a)=>{e.onerror=o=>{a(o.target.error)},e.onsuccess=o=>{const l=o.target.result;if(!l)return void i();const c=new v4(l),d=t(l.primaryKey,l.value,c);if(d instanceof he){const h=d.catch(f=>(c.done(),he.reject(f)));s.push(h)}c.isDone?i():c.G===null?l.continue():l.continue(c.G)}}).next(()=>he.waitFor(s))}options(e,t){let s;return e!==void 0&&(typeof e=="string"?s=e:t=e),{index:s,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const s=this.store.index(e.index);return e.X?s.openKeyCursor(e.range,t):s.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ql(n){return new he((e,t)=>{n.onsuccess=s=>{const i=s.target.result;e(i)},n.onerror=s=>{const i=Rv(s.target.error);t(i)}})}let ME=!1;function Rv(n){const e=Go.M(ps());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const s=new Ue("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ME||(ME=!0,setTimeout(()=>{throw s},0)),s}}return n}const Kh="IndexBackfiller";class j4{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){Oe(Kh,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const t=await this.ne.ie();Oe(Kh,`Documents written: ${t}`)}catch(t){ol(t)?Oe(Kh,"Ignoring IndexedDB error during index backfill: ",t):await al(t)}await this.re(6e4)})}}class _4{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){const s=new Set;let i=t,a=!0;return he.doWhile(()=>a===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!s.has(o))return Oe(Kh,`Processing collection: ${o}`),this.oe(e,o,i).next(l=>{i-=l,s.add(o)});a=!1})).next(()=>t-i)}oe(e,t,s){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,s).next(a=>{const o=a.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(i,a)).next(l=>(Oe(Kh,`Updating offset: ${l}`),this.localStore.indexManager.updateCollectionGroup(e,t,l))).next(()=>o.size)}))}_e(e,t){let s=e;return t.changes.forEach((i,a)=>{const o=xA(a);Dv(o,s)>0&&(s=o)}),new $r(s.readTime,s.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}yr.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nc=-1;function hf(n){return n==null}function Sm(n){return n===0&&1/n==-1/0}function vA(n){return typeof n=="number"&&Number.isInteger(n)&&!Sm(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mg="";function Ks(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=LE(e)),e=E4(n.get(t),e);return LE(e)}function E4(n,e){let t=e;const s=n.length;for(let i=0;i<s;i++){const a=n.charAt(i);switch(a){case"\0":t+="";break;case Mg:t+="";break;default:t+=a}}return t}function LE(n){return n+Mg+""}function Li(n){const e=n.length;if(nt(e>=2,64408,{path:n}),e===2)return nt(n.charAt(0)===Mg&&n.charAt(1)==="",56145,{path:n}),Vt.emptyPath();const t=e-2,s=[];let i="";for(let a=0;a<e;){const o=n.indexOf(Mg,a);switch((o<0||o>t)&&Je(50515,{path:n}),n.charAt(o+1)){case"":const l=n.substring(a,o);let c;i.length===0?c=l:(i+=l,c=i,i=""),s.push(c);break;case"":i+=n.substring(a,o),i+="\0";break;case"":i+=n.substring(a,o+1);break;default:Je(61167,{path:n})}a=o+2}return new Vt(s)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $l="remoteDocuments",mf="owner",$c="owner",Im="mutationQueues",S4="userId",pi="mutations",FE="batchId",Wl="userMutationsIndex",UE=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zp(n,e){return[n,Ks(e)]}function NA(n,e,t){return[n,Ks(e),t]}const I4={},Wd="documentMutations",Lg="remoteDocumentsV14",T4=["prefixPath","collectionGroup","readTime","documentId"],$p="documentKeyIndex",C4=["prefixPath","collectionGroup","documentId"],jA="collectionGroupIndex",A4=["collectionGroup","readTime","prefixPath","documentId"],Tm="remoteDocumentGlobal",U0="remoteDocumentGlobalKey",Kd="targets",_A="queryTargetsIndex",D4=["canonicalId","targetId"],Yd="targetDocuments",R4=["targetId","path"],Pv="documentTargetsIndex",P4=["path","targetId"],Fg="targetGlobalKey",sc="targetGlobal",Cm="collectionParents",k4=["collectionId","parent"],Xd="clientMetadata",O4="clientId",Px="bundles",M4="bundleId",kx="namedQueries",L4="name",kv="indexConfiguration",F4="indexId",V0="collectionGroupIndex",U4="collectionGroup",Yh="indexState",V4=["indexId","uid"],EA="sequenceNumberIndex",z4=["uid","sequenceNumber"],Xh="indexEntries",$4=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],SA="documentKeyIndex",B4=["indexId","uid","orderedDocumentKey"],Ox="documentOverlays",q4=["userId","collectionPath","documentId"],z0="collectionPathOverlayIndex",H4=["userId","collectionPath","largestBatchId"],IA="collectionGroupOverlayIndex",G4=["userId","collectionGroup","largestBatchId"],Ov="globals",Q4="name",TA=[Im,pi,Wd,$l,Kd,mf,sc,Yd,Xd,Tm,Cm,Px,kx],W4=[...TA,Ox],CA=[Im,pi,Wd,Lg,Kd,mf,sc,Yd,Xd,Tm,Cm,Px,kx,Ox],AA=CA,Mv=[...AA,kv,Yh,Xh],K4=Mv,DA=[...Mv,Ov],Y4=DA;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $0 extends bA{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function ys(n,e){const t=tt(n);return Go.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VE(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function ll(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function RA(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wn{constructor(e,t){this.comparator=e,this.root=t||ks.EMPTY}insert(e,t){return new wn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ks.BLACK,null,null))}remove(e){return new wn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ks.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const i=this.comparator(e,s.key);if(i===0)return t+s.left.size;i<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,s)=>(e(t,s),!1))}toString(){const e=[];return this.inorderTraversal((t,s)=>(e.push(`${t}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new pp(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new pp(this.root,e,this.comparator,!1)}getReverseIterator(){return new pp(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new pp(this.root,e,this.comparator,!0)}}class pp{constructor(e,t,s,i){this.isReverse=i,this.nodeStack=[];let a=1;for(;!e.isEmpty();)if(a=t?s(e.key,t):1,t&&i&&(a*=-1),a<0)e=this.isReverse?e.left:e.right;else{if(a===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ks{constructor(e,t,s,i,a){this.key=e,this.value=t,this.color=s??ks.RED,this.left=i??ks.EMPTY,this.right=a??ks.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,i,a){return new ks(e??this.key,t??this.value,s??this.color,i??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let i=this;const a=s(e,i.key);return i=a<0?i.copy(null,null,null,i.left.insert(e,t,s),null):a===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,s)),i.fixUp()}removeMin(){if(this.left.isEmpty())return ks.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return ks.EMPTY;s=i.right.min(),i=i.copy(s.key,s.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ks.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ks.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Je(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Je(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Je(27949);return e+(this.isRed()?0:1)}}ks.EMPTY=null,ks.RED=!0,ks.BLACK=!1;ks.EMPTY=new class{constructor(){this.size=0}get key(){throw Je(57766)}get value(){throw Je(16141)}get color(){throw Je(16727)}get left(){throw Je(29726)}get right(){throw Je(36894)}copy(e,t,s,i,a){return this}insert(e,t,s){return new ks(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rn{constructor(e){this.comparator=e,this.data=new wn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,s)=>(e(t),!1))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const i=s.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new zE(this.data.getIterator())}getIteratorFrom(e){return new zE(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(s=>{t=t.add(s)}),t}isEqual(e){if(!(e instanceof rn)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,a=s.getNext().key;if(this.comparator(i,a)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new rn(this.comparator);return t.data=e,t}}class zE{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Bc(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class br{constructor(e){this.fields=e,e.sort(Fn.comparator)}static empty(){return new br([])}unionWith(e){let t=new rn(Fn.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new br(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Gd(this.fields,e.fields,(t,s)=>t.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PA extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class is{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(a){throw typeof DOMException<"u"&&a instanceof DOMException?new PA("Invalid base64 string: "+a):a}}(e);return new is(t)}static fromUint8Array(e){const t=function(i){let a="";for(let o=0;o<i.length;++o)a+=String.fromCharCode(i[o]);return a}(e);return new is(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const s=new Uint8Array(t.length);for(let i=0;i<t.length;i++)s[i]=t.charCodeAt(i);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ft(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}is.EMPTY_BYTE_STRING=new is("");const X4=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function za(n){if(nt(!!n,39018),typeof n=="string"){let e=0;const t=X4.exec(n);if(nt(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:An(n.seconds),nanos:An(n.nanos)}}function An(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function $a(n){return typeof n=="string"?is.fromBase64String(n):is.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kA="server_timestamp",OA="__type__",MA="__previous_value__",LA="__local_write_time__";function Lv(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[OA])==null?void 0:s.stringValue)===kA}function Mx(n){const e=n.mapValue.fields[MA];return Lv(e)?Mx(e):e}function Am(n){const e=za(n.mapValue.fields[LA].timestampValue);return new Gt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J4{constructor(e,t,s,i,a,o,l,c,d,h){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=i,this.ssl=a,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=d,this.isUsingEmulator=h}}const Dm="(default)";class hc{constructor(e,t){this.projectId=e,this.database=t||Dm}static empty(){return new hc("","")}get isDefaultDatabase(){return this.database===Dm}isEqual(e){return e instanceof hc&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fv="__type__",FA="__max__",Po={mapValue:{fields:{__type__:{stringValue:FA}}}},Uv="__vector__",Jd="value",Bp={nullValue:"NULL_VALUE"};function el(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Lv(n)?4:UA(n)?9007199254740991:Lx(n)?10:11:Je(28295,{value:n})}function Xi(n,e){if(n===e)return!0;const t=el(n);if(t!==el(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Am(n).isEqual(Am(e));case 3:return function(i,a){if(typeof i.timestampValue=="string"&&typeof a.timestampValue=="string"&&i.timestampValue.length===a.timestampValue.length)return i.timestampValue===a.timestampValue;const o=za(i.timestampValue),l=za(a.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,a){return $a(i.bytesValue).isEqual($a(a.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,a){return An(i.geoPointValue.latitude)===An(a.geoPointValue.latitude)&&An(i.geoPointValue.longitude)===An(a.geoPointValue.longitude)}(n,e);case 2:return function(i,a){if("integerValue"in i&&"integerValue"in a)return An(i.integerValue)===An(a.integerValue);if("doubleValue"in i&&"doubleValue"in a){const o=An(i.doubleValue),l=An(a.doubleValue);return o===l?Sm(o)===Sm(l):isNaN(o)&&isNaN(l)}return!1}(n,e);case 9:return Gd(n.arrayValue.values||[],e.arrayValue.values||[],Xi);case 10:case 11:return function(i,a){const o=i.mapValue.fields||{},l=a.mapValue.fields||{};if(VE(o)!==VE(l))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(l[c]===void 0||!Xi(o[c],l[c])))return!1;return!0}(n,e);default:return Je(52216,{left:n})}}function Rm(n,e){return(n.values||[]).find(t=>Xi(t,e))!==void 0}function tl(n,e){if(n===e)return 0;const t=el(n),s=el(e);if(t!==s)return ft(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return ft(n.booleanValue,e.booleanValue);case 2:return function(a,o){const l=An(a.integerValue||a.doubleValue),c=An(o.integerValue||o.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1}(n,e);case 3:return $E(n.timestampValue,e.timestampValue);case 4:return $E(Am(n),Am(e));case 5:return L0(n.stringValue,e.stringValue);case 6:return function(a,o){const l=$a(a),c=$a(o);return l.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(a,o){const l=a.split("/"),c=o.split("/");for(let d=0;d<l.length&&d<c.length;d++){const h=ft(l[d],c[d]);if(h!==0)return h}return ft(l.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(a,o){const l=ft(An(a.latitude),An(o.latitude));return l!==0?l:ft(An(a.longitude),An(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return BE(n.arrayValue,e.arrayValue);case 10:return function(a,o){var p,x,I,D;const l=a.fields||{},c=o.fields||{},d=(p=l[Jd])==null?void 0:p.arrayValue,h=(x=c[Jd])==null?void 0:x.arrayValue,f=ft(((I=d==null?void 0:d.values)==null?void 0:I.length)||0,((D=h==null?void 0:h.values)==null?void 0:D.length)||0);return f!==0?f:BE(d,h)}(n.mapValue,e.mapValue);case 11:return function(a,o){if(a===Po.mapValue&&o===Po.mapValue)return 0;if(a===Po.mapValue)return 1;if(o===Po.mapValue)return-1;const l=a.fields||{},c=Object.keys(l),d=o.fields||{},h=Object.keys(d);c.sort(),h.sort();for(let f=0;f<c.length&&f<h.length;++f){const p=L0(c[f],h[f]);if(p!==0)return p;const x=tl(l[c[f]],d[h[f]]);if(x!==0)return x}return ft(c.length,h.length)}(n.mapValue,e.mapValue);default:throw Je(23264,{he:t})}}function $E(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ft(n,e);const t=za(n),s=za(e),i=ft(t.seconds,s.seconds);return i!==0?i:ft(t.nanos,s.nanos)}function BE(n,e){const t=n.values||[],s=e.values||[];for(let i=0;i<t.length&&i<s.length;++i){const a=tl(t[i],s[i]);if(a)return a}return ft(t.length,s.length)}function Zd(n){return B0(n)}function B0(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const s=za(t);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return $a(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Ge.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let s="[",i=!0;for(const a of t.values||[])i?i=!1:s+=",",s+=B0(a);return s+"]"}(n.arrayValue):"mapValue"in n?function(t){const s=Object.keys(t.fields||{}).sort();let i="{",a=!0;for(const o of s)a?a=!1:i+=",",i+=`${o}:${B0(t.fields[o])}`;return i+"}"}(n.mapValue):Je(61005,{value:n})}function qp(n){switch(el(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Mx(n);return e?16+qp(e):16;case 5:return 2*n.stringValue.length;case 6:return $a(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(s){return(s.values||[]).reduce((i,a)=>i+qp(a),0)}(n.arrayValue);case 10:case 11:return function(s){let i=0;return ll(s.fields,(a,o)=>{i+=a.length+qp(o)}),i}(n.mapValue);default:throw Je(13486,{value:n})}}function Pm(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function q0(n){return!!n&&"integerValue"in n}function km(n){return!!n&&"arrayValue"in n}function qE(n){return!!n&&"nullValue"in n}function HE(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Hp(n){return!!n&&"mapValue"in n}function Lx(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Fv])==null?void 0:s.stringValue)===Uv}function Jh(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return ll(n.mapValue.fields,(t,s)=>e.mapValue.fields[t]=Jh(s)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Jh(n.arrayValue.values[t]);return e}return{...n}}function UA(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===FA}const VA={mapValue:{fields:{[Fv]:{stringValue:Uv},[Jd]:{arrayValue:{}}}}};function Z4(n){return"nullValue"in n?Bp:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Pm(hc.empty(),Ge.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Lx(n)?VA:{mapValue:{}}:Je(35942,{value:n})}function eF(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Pm(hc.empty(),Ge.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?VA:"mapValue"in n?Lx(n)?{mapValue:{}}:Po:Je(61959,{value:n})}function GE(n,e){const t=tl(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function QE(n,e){const t=tl(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Us{constructor(e){this.value=e}static empty(){return new Us({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!Hp(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Jh(t)}setAll(e){let t=Fn.emptyPath(),s={},i=[];e.forEach((o,l)=>{if(!t.isImmediateParentOf(l)){const c=this.getFieldsMap(t);this.applyChanges(c,s,i),s={},i=[],t=l.popLast()}o?s[l.lastSegment()]=Jh(o):i.push(l.lastSegment())});const a=this.getFieldsMap(t);this.applyChanges(a,s,i)}delete(e){const t=this.field(e.popLast());Hp(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Xi(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let i=t.mapValue.fields[e.get(s)];Hp(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,s){ll(t,(i,a)=>e[i]=a);for(const i of s)delete e[i]}clone(){return new Us(Jh(this.value))}}function zA(n){const e=[];return ll(n.fields,(t,s)=>{const i=new Fn([t]);if(Hp(s)){const a=zA(s.mapValue).fields;if(a.length===0)e.push(i);else for(const o of a)e.push(i.child(o))}else e.push(i)}),new br(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dn{constructor(e,t,s,i,a,o,l){this.key=e,this.documentType=t,this.version=s,this.readTime=i,this.createTime=a,this.data=o,this.documentState=l}static newInvalidDocument(e){return new Dn(e,0,rt.min(),rt.min(),rt.min(),Us.empty(),0)}static newFoundDocument(e,t,s,i){return new Dn(e,1,t,rt.min(),s,i,0)}static newNoDocument(e,t){return new Dn(e,2,t,rt.min(),rt.min(),Us.empty(),0)}static newUnknownDocument(e,t){return new Dn(e,3,t,rt.min(),rt.min(),Us.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(rt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Us.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Us.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=rt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Dn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Dn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eu{constructor(e,t){this.position=e,this.inclusive=t}}function WE(n,e,t){let s=0;for(let i=0;i<n.position.length;i++){const a=e[i],o=n.position[i];if(a.field.isKeyField()?s=Ge.comparator(Ge.fromName(o.referenceValue),t.key):s=tl(o,t.data.field(a.field)),a.dir==="desc"&&(s*=-1),s!==0)break}return s}function KE(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Xi(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Om{constructor(e,t="asc"){this.field=e,this.dir=t}}function tF(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $A{}class Ct extends $A{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new nF(e,t,s):t==="array-contains"?new iF(e,s):t==="in"?new WA(e,s):t==="not-in"?new aF(e,s):t==="array-contains-any"?new oF(e,s):new Ct(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new sF(e,s):new rF(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(tl(t,this.value)):t!==null&&el(this.value)===el(t)&&this.matchesComparison(tl(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Je(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class sn extends $A{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new sn(e,t)}matches(e){return tu(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function tu(n){return n.op==="and"}function H0(n){return n.op==="or"}function Vv(n){return BA(n)&&tu(n)}function BA(n){for(const e of n.filters)if(e instanceof sn)return!1;return!0}function G0(n){if(n instanceof Ct)return n.field.canonicalString()+n.op.toString()+Zd(n.value);if(Vv(n))return n.filters.map(e=>G0(e)).join(",");{const e=n.filters.map(t=>G0(t)).join(",");return`${n.op}(${e})`}}function qA(n,e){return n instanceof Ct?function(s,i){return i instanceof Ct&&s.op===i.op&&s.field.isEqual(i.field)&&Xi(s.value,i.value)}(n,e):n instanceof sn?function(s,i){return i instanceof sn&&s.op===i.op&&s.filters.length===i.filters.length?s.filters.reduce((a,o,l)=>a&&qA(o,i.filters[l]),!0):!1}(n,e):void Je(19439)}function HA(n,e){const t=n.filters.concat(e);return sn.create(t,n.op)}function GA(n){return n instanceof Ct?function(t){return`${t.field.canonicalString()} ${t.op} ${Zd(t.value)}`}(n):n instanceof sn?function(t){return t.op.toString()+" {"+t.getFilters().map(GA).join(" ,")+"}"}(n):"Filter"}class nF extends Ct{constructor(e,t,s){super(e,t,s),this.key=Ge.fromName(s.referenceValue)}matches(e){const t=Ge.comparator(e.key,this.key);return this.matchesComparison(t)}}class sF extends Ct{constructor(e,t){super(e,"in",t),this.keys=QA("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class rF extends Ct{constructor(e,t){super(e,"not-in",t),this.keys=QA("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function QA(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(s=>Ge.fromName(s.referenceValue))}class iF extends Ct{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return km(t)&&Rm(t.arrayValue,this.value)}}class WA extends Ct{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Rm(this.value.arrayValue,t)}}class aF extends Ct{constructor(e,t){super(e,"not-in",t)}matches(e){if(Rm(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Rm(this.value.arrayValue,t)}}class oF extends Ct{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!km(t)||!t.arrayValue.values)&&t.arrayValue.values.some(s=>Rm(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lF{constructor(e,t=null,s=[],i=[],a=null,o=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=i,this.limit=a,this.startAt=o,this.endAt=l,this.Te=null}}function Q0(n,e=null,t=[],s=[],i=null,a=null,o=null){return new lF(n,e,t,s,i,a,o)}function mc(n){const e=tt(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(s=>G0(s)).join(","),t+="|ob:",t+=e.orderBy.map(s=>function(a){return a.field.canonicalString()+a.dir}(s)).join(","),hf(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(s=>Zd(s)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(s=>Zd(s)).join(",")),e.Te=t}return e.Te}function ff(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!tF(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!qA(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!KE(n.startAt,e.startAt)&&KE(n.endAt,e.endAt)}function Ug(n){return Ge.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Vg(n,e){return n.filters.filter(t=>t instanceof Ct&&t.field.isEqual(e))}function YE(n,e,t){let s=Bp,i=!0;for(const a of Vg(n,e)){let o=Bp,l=!0;switch(a.op){case"<":case"<=":o=Z4(a.value);break;case"==":case"in":case">=":o=a.value;break;case">":o=a.value,l=!1;break;case"!=":case"not-in":o=Bp}GE({value:s,inclusive:i},{value:o,inclusive:l})<0&&(s=o,i=l)}if(t!==null){for(let a=0;a<n.orderBy.length;++a)if(n.orderBy[a].field.isEqual(e)){const o=t.position[a];GE({value:s,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(s=o,i=t.inclusive);break}}return{value:s,inclusive:i}}function XE(n,e,t){let s=Po,i=!0;for(const a of Vg(n,e)){let o=Po,l=!0;switch(a.op){case">=":case">":o=eF(a.value),l=!1;break;case"==":case"in":case"<=":o=a.value;break;case"<":o=a.value,l=!1;break;case"!=":case"not-in":o=Po}QE({value:s,inclusive:i},{value:o,inclusive:l})>0&&(s=o,i=l)}if(t!==null){for(let a=0;a<n.orderBy.length;++a)if(n.orderBy[a].field.isEqual(e)){const o=t.position[a];QE({value:s,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(s=o,i=t.inclusive);break}}return{value:s,inclusive:i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju{constructor(e,t=null,s=[],i=[],a=null,o="F",l=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=i,this.limit=a,this.limitType=o,this.startAt=l,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function KA(n,e,t,s,i,a,o,l){return new ju(n,e,t,s,i,a,o,l)}function pf(n){return new ju(n)}function JE(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function YA(n){return n.collectionGroup!==null}function Zh(n){const e=tt(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const a of e.explicitOrderBy)e.Ie.push(a),t.add(a.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new rn(Fn.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(l=l.add(d.field))})}),l})(e).forEach(a=>{t.has(a.canonicalString())||a.isKeyField()||e.Ie.push(new Om(a,s))}),t.has(Fn.keyField().canonicalString())||e.Ie.push(new Om(Fn.keyField(),s))}return e.Ie}function Vr(n){const e=tt(n);return e.Ee||(e.Ee=cF(e,Zh(n))),e.Ee}function cF(n,e){if(n.limitType==="F")return Q0(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{const a=i.dir==="desc"?"asc":"desc";return new Om(i.field,a)});const t=n.endAt?new eu(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new eu(n.startAt.position,n.startAt.inclusive):null;return Q0(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function W0(n,e){const t=n.filters.concat([e]);return new ju(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function zg(n,e,t){return new ju(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Fx(n,e){return ff(Vr(n),Vr(e))&&n.limitType===e.limitType}function XA(n){return`${mc(Vr(n))}|lt:${n.limitType}`}function Zc(n){return`Query(target=${function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map(i=>GA(i)).join(", ")}]`),hf(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map(i=>Zd(i)).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map(i=>Zd(i)).join(",")),`Target(${s})`}(Vr(n))}; limitType=${n.limitType})`}function gf(n,e){return e.isFoundDocument()&&function(s,i){const a=i.key.path;return s.collectionGroup!==null?i.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(a):Ge.isDocumentKey(s.path)?s.path.isEqual(a):s.path.isImmediateParentOf(a)}(n,e)&&function(s,i){for(const a of Zh(s))if(!a.field.isKeyField()&&i.data.field(a.field)===null)return!1;return!0}(n,e)&&function(s,i){for(const a of s.filters)if(!a.matches(i))return!1;return!0}(n,e)&&function(s,i){return!(s.startAt&&!function(o,l,c){const d=WE(o,l,c);return o.inclusive?d<=0:d<0}(s.startAt,Zh(s),i)||s.endAt&&!function(o,l,c){const d=WE(o,l,c);return o.inclusive?d>=0:d>0}(s.endAt,Zh(s),i))}(n,e)}function JA(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function ZA(n){return(e,t)=>{let s=!1;for(const i of Zh(n)){const a=dF(i,e,t);if(a!==0)return a;s=s||i.field.isKeyField()}return 0}}function dF(n,e,t){const s=n.field.isKeyField()?Ge.comparator(e.key,t.key):function(a,o,l){const c=o.data.field(a),d=l.data.field(a);return c!==null&&d!==null?tl(c,d):Je(42886)}(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return Je(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wa{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[i,a]of s)if(this.equalsFn(i,e))return a}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),i=this.inner[s];if(i===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let a=0;a<i.length;a++)if(this.equalsFn(i[a][0],e))return void(i[a]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return s.length===1?delete this.inner[t]:s.splice(i,1),this.innerSize--,!0;return!1}forEach(e){ll(this.inner,(t,s)=>{for(const[i,a]of s)e(i,a)})}isEmpty(){return RA(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uF=new wn(Ge.comparator);function kr(){return uF}const e2=new wn(Ge.comparator);function Th(...n){let e=e2;for(const t of n)e=e.insert(t.key,t);return e}function t2(n){let e=e2;return n.forEach((t,s)=>e=e.insert(t,s.overlayedDocument)),e}function Fi(){return em()}function n2(){return em()}function em(){return new Wa(n=>n.toString(),(n,e)=>n.isEqual(e))}const hF=new wn(Ge.comparator),mF=new rn(Ge.comparator);function jt(...n){let e=mF;for(const t of n)e=e.add(t);return e}const fF=new rn(ft);function zv(){return fF}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $v(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Sm(e)?"-0":e}}function s2(n){return{integerValue:""+n}}function r2(n,e){return vA(e)?s2(e):$v(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ux{constructor(){this._=void 0}}function pF(n,e,t){return n instanceof nu?function(i,a){const o={fields:{[OA]:{stringValue:kA},[LA]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return a&&Lv(a)&&(a=Mx(a)),a&&(o.fields[MA]=a),{mapValue:o}}(t,e):n instanceof su?a2(n,e):n instanceof ru?o2(n,e):function(i,a){const o=i2(i,a),l=ZE(o)+ZE(i.Ae);return q0(o)&&q0(i.Ae)?s2(l):$v(i.serializer,l)}(n,e)}function gF(n,e,t){return n instanceof su?a2(n,e):n instanceof ru?o2(n,e):t}function i2(n,e){return n instanceof iu?function(s){return q0(s)||function(a){return!!a&&"doubleValue"in a}(s)}(e)?e:{integerValue:0}:null}class nu extends Ux{}class su extends Ux{constructor(e){super(),this.elements=e}}function a2(n,e){const t=l2(e);for(const s of n.elements)t.some(i=>Xi(i,s))||t.push(s);return{arrayValue:{values:t}}}class ru extends Ux{constructor(e){super(),this.elements=e}}function o2(n,e){let t=l2(e);for(const s of n.elements)t=t.filter(i=>!Xi(i,s));return{arrayValue:{values:t}}}class iu extends Ux{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function ZE(n){return An(n.integerValue||n.doubleValue)}function l2(n){return km(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bv{constructor(e,t){this.field=e,this.transform=t}}function xF(n,e){return n.field.isEqual(e.field)&&function(s,i){return s instanceof su&&i instanceof su||s instanceof ru&&i instanceof ru?Gd(s.elements,i.elements,Xi):s instanceof iu&&i instanceof iu?Xi(s.Ae,i.Ae):s instanceof nu&&i instanceof nu}(n.transform,e.transform)}class yF{constructor(e,t){this.version=e,this.transformResults=t}}class Rn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Rn}static exists(e){return new Rn(void 0,e)}static updateTime(e){return new Rn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Gp(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Vx{}function c2(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Eu(n.key,Rn.none()):new _u(n.key,n.data,Rn.none());{const t=n.data,s=Us.empty();let i=new rn(Fn.comparator);for(let a of e.fields)if(!i.has(a)){let o=t.field(a);o===null&&a.length>1&&(a=a.popLast(),o=t.field(a)),o===null?s.delete(a):s.set(a,o),i=i.add(a)}return new Ka(n.key,s,new br(i.toArray()),Rn.none())}}function bF(n,e,t){n instanceof _u?function(i,a,o){const l=i.value.clone(),c=tS(i.fieldTransforms,a,o.transformResults);l.setAll(c),a.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):n instanceof Ka?function(i,a,o){if(!Gp(i.precondition,a))return void a.convertToUnknownDocument(o.version);const l=tS(i.fieldTransforms,a,o.transformResults),c=a.data;c.setAll(d2(i)),c.setAll(l),a.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):function(i,a,o){a.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function tm(n,e,t,s){return n instanceof _u?function(a,o,l,c){if(!Gp(a.precondition,o))return l;const d=a.value.clone(),h=nS(a.fieldTransforms,c,o);return d.setAll(h),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),null}(n,e,t,s):n instanceof Ka?function(a,o,l,c){if(!Gp(a.precondition,o))return l;const d=nS(a.fieldTransforms,c,o),h=o.data;return h.setAll(d2(a)),h.setAll(d),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),l===null?null:l.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(f=>f.field))}(n,e,t,s):function(a,o,l){return Gp(a.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l}(n,e,t)}function wF(n,e){let t=null;for(const s of n.fieldTransforms){const i=e.data.field(s.field),a=i2(s.transform,i||null);a!=null&&(t===null&&(t=Us.empty()),t.set(s.field,a))}return t||null}function eS(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(s,i){return s===void 0&&i===void 0||!(!s||!i)&&Gd(s,i,(a,o)=>xF(a,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class _u extends Vx{constructor(e,t,s,i=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Ka extends Vx{constructor(e,t,s,i,a=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=i,this.fieldTransforms=a,this.type=1}getFieldMask(){return this.fieldMask}}function d2(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}}),e}function tS(n,e,t){const s=new Map;nt(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let i=0;i<t.length;i++){const a=n[i],o=a.transform,l=e.data.field(a.field);s.set(a.field,gF(o,l,t[i]))}return s}function nS(n,e,t){const s=new Map;for(const i of n){const a=i.transform,o=t.data.field(i.field);s.set(i.field,pF(a,o,e))}return s}class Eu extends Vx{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class qv extends Vx{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hv{constructor(e,t,s,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=i}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const a=this.mutations[i];a.key.isEqual(e.key)&&bF(a,e,s[i])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=tm(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=tm(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=n2();return this.mutations.forEach(i=>{const a=e.get(i.key),o=a.overlayedDocument;let l=this.applyToLocalView(o,a.mutatedFields);l=t.has(i.key)?null:l;const c=c2(o,l);c!==null&&s.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(rt.min())}),s}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),jt())}isEqual(e){return this.batchId===e.batchId&&Gd(this.mutations,e.mutations,(t,s)=>eS(t,s))&&Gd(this.baseMutations,e.baseMutations,(t,s)=>eS(t,s))}}class Gv{constructor(e,t,s,i){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=i}static from(e,t,s){nt(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let i=function(){return hF}();const a=e.mutations;for(let o=0;o<a.length;o++)i=i.insert(a[o].key,s[o].version);return new Gv(e,t,s,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qv{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vF{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var as,Ot;function u2(n){switch(n){case we.OK:return Je(64938);case we.CANCELLED:case we.UNKNOWN:case we.DEADLINE_EXCEEDED:case we.RESOURCE_EXHAUSTED:case we.INTERNAL:case we.UNAVAILABLE:case we.UNAUTHENTICATED:return!1;case we.INVALID_ARGUMENT:case we.NOT_FOUND:case we.ALREADY_EXISTS:case we.PERMISSION_DENIED:case we.FAILED_PRECONDITION:case we.ABORTED:case we.OUT_OF_RANGE:case we.UNIMPLEMENTED:case we.DATA_LOSS:return!0;default:return Je(15467,{code:n})}}function h2(n){if(n===void 0)return rs("GRPC error has no .code"),we.UNKNOWN;switch(n){case as.OK:return we.OK;case as.CANCELLED:return we.CANCELLED;case as.UNKNOWN:return we.UNKNOWN;case as.DEADLINE_EXCEEDED:return we.DEADLINE_EXCEEDED;case as.RESOURCE_EXHAUSTED:return we.RESOURCE_EXHAUSTED;case as.INTERNAL:return we.INTERNAL;case as.UNAVAILABLE:return we.UNAVAILABLE;case as.UNAUTHENTICATED:return we.UNAUTHENTICATED;case as.INVALID_ARGUMENT:return we.INVALID_ARGUMENT;case as.NOT_FOUND:return we.NOT_FOUND;case as.ALREADY_EXISTS:return we.ALREADY_EXISTS;case as.PERMISSION_DENIED:return we.PERMISSION_DENIED;case as.FAILED_PRECONDITION:return we.FAILED_PRECONDITION;case as.ABORTED:return we.ABORTED;case as.OUT_OF_RANGE:return we.OUT_OF_RANGE;case as.UNIMPLEMENTED:return we.UNIMPLEMENTED;case as.DATA_LOSS:return we.DATA_LOSS;default:return Je(39323,{code:n})}}(Ot=as||(as={}))[Ot.OK=0]="OK",Ot[Ot.CANCELLED=1]="CANCELLED",Ot[Ot.UNKNOWN=2]="UNKNOWN",Ot[Ot.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ot[Ot.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ot[Ot.NOT_FOUND=5]="NOT_FOUND",Ot[Ot.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ot[Ot.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ot[Ot.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ot[Ot.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ot[Ot.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ot[Ot.ABORTED=10]="ABORTED",Ot[Ot.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ot[Ot.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ot[Ot.INTERNAL=13]="INTERNAL",Ot[Ot.UNAVAILABLE=14]="UNAVAILABLE",Ot[Ot.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NF(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jF=new Ho([4294967295,4294967295],0);function sS(n){const e=NF().encode(n),t=new iA;return t.update(e),new Uint8Array(t.digest())}function rS(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),i=e.getUint32(8,!0),a=e.getUint32(12,!0);return[new Ho([t,s],0),new Ho([i,a],0)]}class Wv{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new Ch(`Invalid padding: ${t}`);if(s<0)throw new Ch(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new Ch(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new Ch(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Ho.fromNumber(this.ge)}ye(e,t,s){let i=e.add(t.multiply(Ho.fromNumber(s)));return i.compare(jF)===1&&(i=new Ho([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=sS(e),[s,i]=rS(t);for(let a=0;a<this.hashCount;a++){const o=this.ye(s,i,a);if(!this.we(o))return!1}return!0}static create(e,t,s){const i=e%8==0?0:8-e%8,a=new Uint8Array(Math.ceil(e/8)),o=new Wv(a,i,t);return s.forEach(l=>o.insert(l)),o}insert(e){if(this.ge===0)return;const t=sS(e),[s,i]=rS(t);for(let a=0;a<this.hashCount;a++){const o=this.ye(s,i,a);this.Se(o)}}Se(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class Ch extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xf{constructor(e,t,s,i,a){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=i,this.resolvedLimboDocuments=a}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const i=new Map;return i.set(e,yf.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new xf(rt.min(),i,new wn(ft),kr(),jt())}}class yf{constructor(e,t,s,i,a){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=i,this.removedDocuments=a}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new yf(s,t,jt(),jt(),jt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qp{constructor(e,t,s,i){this.be=e,this.removedTargetIds=t,this.key=s,this.De=i}}class m2{constructor(e,t){this.targetId=e,this.Ce=t}}class f2{constructor(e,t,s=is.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=i}}class iS{constructor(){this.ve=0,this.Fe=aS(),this.Me=is.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=jt(),t=jt(),s=jt();return this.Fe.forEach((i,a)=>{switch(a){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:s=s.add(i);break;default:Je(38017,{changeType:a})}}),new yf(this.Me,this.xe,e,t,s)}qe(){this.Oe=!1,this.Fe=aS()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,nt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class _F{constructor(e){this.Ge=e,this.ze=new Map,this.je=kr(),this.Je=gp(),this.He=gp(),this.Ye=new wn(ft)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(e.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.We(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:Je(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((s,i)=>{this.rt(i)&&t(i)})}st(e){const t=e.targetId,s=e.Ce.count,i=this.ot(t);if(i){const a=i.target;if(Ug(a))if(s===0){const o=new Ge(a.path);this.et(t,o,Dn.newNoDocument(o,rt.min()))}else nt(s===1,20013,{expectedCount:s});else{const o=this._t(t);if(o!==s){const l=this.ut(e),c=l?this.ct(l,e,o):1;if(c!==0){this.it(t);const d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,d)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:i=0},hashCount:a=0}=t;let o,l;try{o=$a(s).toUint8Array()}catch(c){if(c instanceof PA)return Hd("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new Wv(o,i,a)}catch(c){return Hd(c instanceof Ch?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.ge===0?null:l}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let i=0;return s.forEach(a=>{const o=this.Ge.ht(),l=`projects/${o.projectId}/databases/${o.database}/documents/${a.path.canonicalString()}`;e.mightContain(l)||(this.et(t,a,null),i++)}),i}Tt(e){const t=new Map;this.ze.forEach((a,o)=>{const l=this.ot(o);if(l){if(a.current&&Ug(l.target)){const c=new Ge(l.target.path);this.It(c).has(o)||this.Et(o,c)||this.et(o,c,Dn.newNoDocument(c,e))}a.Be&&(t.set(o,a.ke()),a.qe())}});let s=jt();this.He.forEach((a,o)=>{let l=!0;o.forEachWhile(c=>{const d=this.ot(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(s=s.add(a))}),this.je.forEach((a,o)=>o.setReadTime(e));const i=new xf(e,t,this.Ye,this.je,s);return this.je=kr(),this.Je=gp(),this.He=gp(),this.Ye=new wn(ft),i}Xe(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,s),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new iS,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new rn(ft),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new rn(ft),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Oe("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new iS),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function gp(){return new wn(Ge.comparator)}function aS(){return new wn(Ge.comparator)}const EF={asc:"ASCENDING",desc:"DESCENDING"},SF={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},IF={and:"AND",or:"OR"};class TF{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function K0(n,e){return n.useProto3Json||hf(e)?e:{value:e}}function au(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function p2(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function CF(n,e){return au(n,e.toTimestamp())}function Ds(n){return nt(!!n,49232),rt.fromTimestamp(function(t){const s=za(t);return new Gt(s.seconds,s.nanos)}(n))}function Kv(n,e){return Y0(n,e).canonicalString()}function Y0(n,e){const t=function(i){return new Vt(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function g2(n){const e=Vt.fromString(n);return nt(E2(e),10190,{key:e.toString()}),e}function Mm(n,e){return Kv(n.databaseId,e.path)}function Pa(n,e){const t=g2(e);if(t.get(1)!==n.databaseId.projectId)throw new Ue(we.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Ue(we.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Ge(b2(t))}function x2(n,e){return Kv(n.databaseId,e)}function y2(n){const e=g2(n);return e.length===4?Vt.emptyPath():b2(e)}function X0(n){return new Vt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function b2(n){return nt(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function oS(n,e,t){return{name:Mm(n,e),fields:t.value.mapValue.fields}}function AF(n,e,t){const s=Pa(n,e.name),i=Ds(e.updateTime),a=e.createTime?Ds(e.createTime):rt.min(),o=new Us({mapValue:{fields:e.fields}}),l=Dn.newFoundDocument(s,i,a,o);return t&&l.setHasCommittedMutations(),t?l.setHasCommittedMutations():l}function DF(n,e){return"found"in e?function(s,i){nt(!!i.found,43571),i.found.name,i.found.updateTime;const a=Pa(s,i.found.name),o=Ds(i.found.updateTime),l=i.found.createTime?Ds(i.found.createTime):rt.min(),c=new Us({mapValue:{fields:i.found.fields}});return Dn.newFoundDocument(a,o,l,c)}(n,e):"missing"in e?function(s,i){nt(!!i.missing,3894),nt(!!i.readTime,22933);const a=Pa(s,i.missing),o=Ds(i.readTime);return Dn.newNoDocument(a,o)}(n,e):Je(7234,{result:e})}function RF(n,e){let t;if("targetChange"in e){e.targetChange;const s=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:Je(39313,{state:d})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],a=function(d,h){return d.useProto3Json?(nt(h===void 0||typeof h=="string",58123),is.fromBase64String(h||"")):(nt(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),is.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&function(d){const h=d.code===void 0?we.UNKNOWN:h2(d.code);return new Ue(h,d.message||"")}(o);t=new f2(s,i,a,l||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=Pa(n,s.document.name),a=Ds(s.document.updateTime),o=s.document.createTime?Ds(s.document.createTime):rt.min(),l=new Us({mapValue:{fields:s.document.fields}}),c=Dn.newFoundDocument(i,a,o,l),d=s.targetIds||[],h=s.removedTargetIds||[];t=new Qp(d,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=Pa(n,s.document),a=s.readTime?Ds(s.readTime):rt.min(),o=Dn.newNoDocument(i,a),l=s.removedTargetIds||[];t=new Qp([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=Pa(n,s.document),a=s.removedTargetIds||[];t=new Qp([],a,i,null)}else{if(!("filter"in e))return Je(11601,{Rt:e});{e.filter;const s=e.filter;s.targetId;const{count:i=0,unchangedNames:a}=s,o=new vF(i,a),l=s.targetId;t=new m2(l,o)}}return t}function Lm(n,e){let t;if(e instanceof _u)t={update:oS(n,e.key,e.value)};else if(e instanceof Eu)t={delete:Mm(n,e.key)};else if(e instanceof Ka)t={update:oS(n,e.key,e.data),updateMask:FF(e.fieldMask)};else{if(!(e instanceof qv))return Je(16599,{Vt:e.type});t={verify:Mm(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(s=>function(a,o){const l=o.transform;if(l instanceof nu)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof su)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof ru)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof iu)return{fieldPath:o.field.canonicalString(),increment:l.Ae};throw Je(20930,{transform:o.transform})}(0,s))),e.precondition.isNone||(t.currentDocument=function(i,a){return a.updateTime!==void 0?{updateTime:CF(i,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:Je(27497)}(n,e.precondition)),t}function J0(n,e){const t=e.currentDocument?function(a){return a.updateTime!==void 0?Rn.updateTime(Ds(a.updateTime)):a.exists!==void 0?Rn.exists(a.exists):Rn.none()}(e.currentDocument):Rn.none(),s=e.updateTransforms?e.updateTransforms.map(i=>function(o,l){let c=null;if("setToServerValue"in l)nt(l.setToServerValue==="REQUEST_TIME",16630,{proto:l}),c=new nu;else if("appendMissingElements"in l){const h=l.appendMissingElements.values||[];c=new su(h)}else if("removeAllFromArray"in l){const h=l.removeAllFromArray.values||[];c=new ru(h)}else"increment"in l?c=new iu(o,l.increment):Je(16584,{proto:l});const d=Fn.fromServerFormat(l.fieldPath);return new Bv(d,c)}(n,i)):[];if(e.update){e.update.name;const i=Pa(n,e.update.name),a=new Us({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(c){const d=c.fieldPaths||[];return new br(d.map(h=>Fn.fromServerFormat(h)))}(e.updateMask);return new Ka(i,a,o,t,s)}return new _u(i,a,t,s)}if(e.delete){const i=Pa(n,e.delete);return new Eu(i,t)}if(e.verify){const i=Pa(n,e.verify);return new qv(i,t)}return Je(1463,{proto:e})}function PF(n,e){return n&&n.length>0?(nt(e!==void 0,14353),n.map(t=>function(i,a){let o=i.updateTime?Ds(i.updateTime):Ds(a);return o.isEqual(rt.min())&&(o=Ds(a)),new yF(o,i.transformResults||[])}(t,e))):[]}function w2(n,e){return{documents:[x2(n,e.path)]}}function v2(n,e){const t={structuredQuery:{}},s=e.path;let i;e.collectionGroup!==null?(i=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=x2(n,i);const a=function(d){if(d.length!==0)return _2(sn.create(d,"and"))}(e.filters);a&&(t.structuredQuery.where=a);const o=function(d){if(d.length!==0)return d.map(h=>function(p){return{field:ed(p.field),direction:OF(p.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const l=K0(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{ft:t,parent:i}}function N2(n){let e=y2(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let i=null;if(s>0){nt(s===1,65062);const h=t.from[0];h.allDescendants?i=h.collectionId:e=e.child(h.collectionId)}let a=[];t.where&&(a=function(f){const p=j2(f);return p instanceof sn&&Vv(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(p=>function(I){return new Om(td(I.field),function(A){switch(A){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(I.direction))}(p))}(t.orderBy));let l=null;t.limit&&(l=function(f){let p;return p=typeof f=="object"?f.value:f,hf(p)?null:p}(t.limit));let c=null;t.startAt&&(c=function(f){const p=!!f.before,x=f.values||[];return new eu(x,p)}(t.startAt));let d=null;return t.endAt&&(d=function(f){const p=!f.before,x=f.values||[];return new eu(x,p)}(t.endAt)),KA(e,i,o,a,l,"F",c,d)}function kF(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Je(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function j2(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=td(t.unaryFilter.field);return Ct.create(s,"==",{doubleValue:NaN});case"IS_NULL":const i=td(t.unaryFilter.field);return Ct.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const a=td(t.unaryFilter.field);return Ct.create(a,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=td(t.unaryFilter.field);return Ct.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Je(61313);default:return Je(60726)}}(n):n.fieldFilter!==void 0?function(t){return Ct.create(td(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Je(58110);default:return Je(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return sn.create(t.compositeFilter.filters.map(s=>j2(s)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Je(1026)}}(t.compositeFilter.op))}(n):Je(30097,{filter:n})}function OF(n){return EF[n]}function MF(n){return SF[n]}function LF(n){return IF[n]}function ed(n){return{fieldPath:n.canonicalString()}}function td(n){return Fn.fromServerFormat(n.fieldPath)}function _2(n){return n instanceof Ct?function(t){if(t.op==="=="){if(HE(t.value))return{unaryFilter:{field:ed(t.field),op:"IS_NAN"}};if(qE(t.value))return{unaryFilter:{field:ed(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(HE(t.value))return{unaryFilter:{field:ed(t.field),op:"IS_NOT_NAN"}};if(qE(t.value))return{unaryFilter:{field:ed(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ed(t.field),op:MF(t.op),value:t.value}}}(n):n instanceof sn?function(t){const s=t.getFilters().map(i=>_2(i));return s.length===1?s[0]:{compositeFilter:{op:LF(t.op),filters:s}}}(n):Je(54877,{filter:n})}function FF(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function E2(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _a{constructor(e,t,s,i,a=rt.min(),o=rt.min(),l=is.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new _a(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new _a(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new _a(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new _a(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S2{constructor(e){this.yt=e}}function UF(n,e){let t;if(e.document)t=AF(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const s=Ge.fromSegments(e.noDocument.path),i=pc(e.noDocument.readTime);t=Dn.newNoDocument(s,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Je(56709);{const s=Ge.fromSegments(e.unknownDocument.path),i=pc(e.unknownDocument.version);t=Dn.newUnknownDocument(s,i)}}return e.readTime&&t.setReadTime(function(i){const a=new Gt(i[0],i[1]);return rt.fromTimestamp(a)}(e.readTime)),t}function lS(n,e){const t=e.key,s={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:$g(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())s.document=function(a,o){return{name:Mm(a,o.key),fields:o.data.value.mapValue.fields,updateTime:au(a,o.version.toTimestamp()),createTime:au(a,o.createTime.toTimestamp())}}(n.yt,e);else if(e.isNoDocument())s.noDocument={path:t.path.toArray(),readTime:fc(e.version)};else{if(!e.isUnknownDocument())return Je(57904,{document:e});s.unknownDocument={path:t.path.toArray(),version:fc(e.version)}}return s}function $g(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function fc(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function pc(n){const e=new Gt(n.seconds,n.nanoseconds);return rt.fromTimestamp(e)}function Hl(n,e){const t=(e.baseMutations||[]).map(a=>J0(n.yt,a));for(let a=0;a<e.mutations.length-1;++a){const o=e.mutations[a];if(a+1<e.mutations.length&&e.mutations[a+1].transform!==void 0){const l=e.mutations[a+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(a+1,1),++a}}const s=e.mutations.map(a=>J0(n.yt,a)),i=Gt.fromMillis(e.localWriteTimeMs);return new Hv(e.batchId,i,t,s)}function Ah(n){const e=pc(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?pc(n.lastLimboFreeSnapshotVersion):rt.min();let s;return s=function(a){return a.documents!==void 0}(n.query)?function(a){const o=a.documents.length;return nt(o===1,1966,{count:o}),Vr(pf(y2(a.documents[0])))}(n.query):function(a){return Vr(N2(a))}(n.query),new _a(s,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,is.fromBase64String(n.resumeToken))}function I2(n,e){const t=fc(e.snapshotVersion),s=fc(e.lastLimboFreeSnapshotVersion);let i;i=Ug(e.target)?w2(n.yt,e.target):v2(n.yt,e.target).ft;const a=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:mc(e.target),readTime:t,resumeToken:a,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:s,query:i}}function T2(n){const e=N2({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?zg(e,e.limit,"L"):e}function gb(n,e){return new Qv(e.largestBatchId,J0(n.yt,e.overlayMutation))}function cS(n,e){const t=e.path.lastSegment();return[n,Ks(e.path.popLast()),t]}function dS(n,e,t,s){return{indexId:n,uid:e,sequenceNumber:t,readTime:fc(s.readTime),documentKey:Ks(s.documentKey.path),largestBatchId:s.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VF{getBundleMetadata(e,t){return uS(e).get(t).next(s=>{if(s)return function(a){return{id:a.bundleId,createTime:pc(a.createTime),version:a.version}}(s)})}saveBundleMetadata(e,t){return uS(e).put(function(i){return{bundleId:i.id,createTime:fc(Ds(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return hS(e).get(t).next(s=>{if(s)return function(a){return{name:a.name,query:T2(a.bundledQuery),readTime:pc(a.readTime)}}(s)})}saveNamedQuery(e,t){return hS(e).put(function(i){return{name:i.name,readTime:fc(Ds(i.readTime)),bundledQuery:i.bundledQuery}}(t))}}function uS(n){return ys(n,Px)}function hS(n){return ys(n,kx)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zx{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const s=t.uid||"";return new zx(e,s)}getOverlay(e,t){return ph(e).get(cS(this.userId,t)).next(s=>s?gb(this.serializer,s):null)}getOverlays(e,t){const s=Fi();return he.forEach(t,i=>this.getOverlay(e,i).next(a=>{a!==null&&s.set(i,a)})).next(()=>s)}saveOverlays(e,t,s){const i=[];return s.forEach((a,o)=>{const l=new Qv(t,o);i.push(this.St(e,l))}),he.waitFor(i)}removeOverlaysForBatchId(e,t,s){const i=new Set;t.forEach(o=>i.add(Ks(o.getCollectionPath())));const a=[];return i.forEach(o=>{const l=IDBKeyRange.bound([this.userId,o,s],[this.userId,o,s+1],!1,!0);a.push(ph(e).Z(z0,l))}),he.waitFor(a)}getOverlaysForCollection(e,t,s){const i=Fi(),a=Ks(t),o=IDBKeyRange.bound([this.userId,a,s],[this.userId,a,Number.POSITIVE_INFINITY],!0);return ph(e).J(z0,o).next(l=>{for(const c of l){const d=gb(this.serializer,c);i.set(d.getKey(),d)}return i})}getOverlaysForCollectionGroup(e,t,s,i){const a=Fi();let o;const l=IDBKeyRange.bound([this.userId,t,s],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ph(e).ee({index:IA,range:l},(c,d,h)=>{const f=gb(this.serializer,d);a.size()<i||f.largestBatchId===o?(a.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>a)}St(e,t){return ph(e).put(function(i,a,o){const[l,c,d]=cS(a,o.mutation.key);return{userId:a,collectionPath:c,documentId:d,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Lm(i.yt,o.mutation)}}(this.serializer,this.userId,t))}}function ph(n){return ys(n,Ox)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zF{bt(e){return ys(e,Ov)}getSessionToken(e){return this.bt(e).get("sessionToken").next(t=>{const s=t==null?void 0:t.value;return s?is.fromUint8Array(s):is.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gl{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(An(e.integerValue));else if("doubleValue"in e){const s=An(e.doubleValue);isNaN(s)?this.Ft(t,13):(this.Ft(t,15),Sm(s)?t.Mt(0):t.Mt(s))}else if("timestampValue"in e){let s=e.timestampValue;this.Ft(t,20),typeof s=="string"&&(s=za(s)),t.xt(`${s.seconds||""}`),t.Mt(s.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt($a(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const s=e.geoPointValue;this.Ft(t,45),t.Mt(s.latitude||0),t.Mt(s.longitude||0)}else"mapValue"in e?UA(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Lx(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):Je(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const s=e.fields||{};this.Ft(t,55);for(const i of Object.keys(s))this.Ot(i,t),this.Ct(s[i],t)}kt(e,t){var o,l;const s=e.fields||{};this.Ft(t,53);const i=Jd,a=((l=(o=s[i].arrayValue)==null?void 0:o.values)==null?void 0:l.length)||0;this.Ft(t,15),t.Mt(An(a)),this.Ot(i,t),this.Ct(s[i],t)}Qt(e,t){const s=e.values||[];this.Ft(t,50);for(const i of s)this.Ct(i,t)}Lt(e,t){this.Ft(t,37),Ge.fromName(e).path.forEach(s=>{this.Ft(t,60),this.Ut(s,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Gl.Kt=new Gl;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qc=255;function $F(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function mS(n){const e=64-function(s){let i=0;for(let a=0;a<8;++a){const o=$F(255&s[a]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}class BF{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Gt(s.value),s=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Jt(s.value),s=t.next();this.Ht()}Yt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Gt(s);else if(s<2048)this.Gt(960|s>>>6),this.Gt(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s);else{const i=t.codePointAt(0);this.Gt(240|i>>>18),this.Gt(128|63&i>>>12),this.Gt(128|63&i>>>6),this.Gt(128|63&i)}}this.zt()}Zt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Jt(s);else if(s<2048)this.Jt(960|s>>>6),this.Jt(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s);else{const i=t.codePointAt(0);this.Jt(240|i>>>18),this.Jt(128|63&i>>>12),this.Jt(128|63&i>>>6),this.Jt(128|63&i)}}this.Ht()}Xt(e){const t=this.en(e),s=mS(t);this.tn(1+s),this.buffer[this.position++]=255&s;for(let i=t.length-s;i<t.length;++i)this.buffer[this.position++]=255&t[i]}nn(e){const t=this.en(e),s=mS(t);this.tn(1+s),this.buffer[this.position++]=~(255&s);for(let i=t.length-s;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}rn(){this.sn(qc),this.sn(255)}_n(){this.an(qc),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=function(a){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,a,!1),new Uint8Array(o.buffer)}(e),s=!!(128&t[0]);t[0]^=s?255:128;for(let i=1;i<t.length;++i)t[i]^=s?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===qc?(this.sn(qc),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===qc?(this.an(qc),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let s=2*this.buffer.length;s<t&&(s=t);const i=new Uint8Array(s);i.set(this.buffer),this.buffer=i}}class qF{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class HF{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class gh{constructor(){this.cn=new BF,this.ln=new qF(this.cn),this.hn=new HF(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ql{constructor(e,t,s,i){this.Tn=e,this.In=t,this.En=s,this.dn=i}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,s=new Uint8Array(t);return s.set(this.dn,0),t!==e?s.set([0],this.dn.length):++s[s.length-1],new Ql(this.Tn,this.In,this.En,s)}Rn(e,t,s){return{indexId:this.Tn,uid:e,arrayValue:Wp(this.En),directionalValue:Wp(this.dn),orderedDocumentKey:Wp(t),documentKey:s.path.toArray()}}Vn(e,t,s){const i=this.Rn(e,t,s);return[i.indexId,i.uid,i.arrayValue,i.directionalValue,i.orderedDocumentKey,i.documentKey]}}function uo(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=fS(n.En,e.En),t!==0?t:(t=fS(n.dn,e.dn),t!==0?t:Ge.comparator(n.In,e.In)))}function fS(n,e){for(let t=0;t<n.length&&t<e.length;++t){const s=n[t]-e[t];if(s!==0)return s}return n.length-e.length}function Wp(n){return ZC()?function(t){let s="";for(let i=0;i<t.length;i++)s+=String.fromCharCode(t[i]);return s}(n):n}function pS(n){return typeof n!="string"?n:function(t){const s=new Uint8Array(t.length);for(let i=0;i<t.length;i++)s[i]=t.charCodeAt(i);return s}(n)}class gS{constructor(e){this.mn=new rn((t,s)=>Fn.comparator(t.field,s.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const s=t;s.isInequality()?this.mn=this.mn.add(s):this.gn.push(s)}}get pn(){return this.mn.size>1}yn(e){if(nt(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=F0(e);if(t!==void 0&&!this.wn(t))return!1;const s=zl(e);let i=new Set,a=0,o=0;for(;a<s.length&&this.wn(s[a]);++a)i=i.add(s[a].fieldPath.canonicalString());if(a===s.length)return!0;if(this.mn.size>0){const l=this.mn.getIterator().getNext();if(!i.has(l.field.canonicalString())){const c=s[a];if(!this.Sn(l,c)||!this.bn(this.fn[o++],c))return!1}++a}for(;a<s.length;++a){const l=s[a];if(o>=this.fn.length||!this.bn(this.fn[o++],l))return!1}return!0}Dn(){if(this.pn)return null;let e=new rn(Fn.comparator);const t=[];for(const s of this.gn)if(!s.field.isKeyField())if(s.op==="array-contains"||s.op==="array-contains-any")t.push(new Vp(s.field,2));else{if(e.has(s.field))continue;e=e.add(s.field),t.push(new Vp(s.field,0))}for(const s of this.fn)s.field.isKeyField()||e.has(s.field)||(e=e.add(s.field),t.push(new Vp(s.field,s.dir==="asc"?0:1)));return new Og(Og.UNKNOWN_ID,this.collectionId,t,Em.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const s=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===s}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C2(n){var t,s;if(nt(n instanceof Ct||n instanceof sn,20012),n instanceof Ct){if(n instanceof WA){const i=((s=(t=n.value.arrayValue)==null?void 0:t.values)==null?void 0:s.map(a=>Ct.create(n.field,"==",a)))||[];return sn.create(i,"or")}return n}const e=n.filters.map(i=>C2(i));return sn.create(e,n.op)}function GF(n){if(n.getFilters().length===0)return[];const e=tw(C2(n));return nt(A2(e),7391),Z0(e)||ew(e)?[e]:e.getFilters()}function Z0(n){return n instanceof Ct}function ew(n){return n instanceof sn&&Vv(n)}function A2(n){return Z0(n)||ew(n)||function(t){if(t instanceof sn&&H0(t)){for(const s of t.getFilters())if(!Z0(s)&&!ew(s))return!1;return!0}return!1}(n)}function tw(n){if(nt(n instanceof Ct||n instanceof sn,34018),n instanceof Ct)return n;if(n.filters.length===1)return tw(n.filters[0]);const e=n.filters.map(s=>tw(s));let t=sn.create(e,n.op);return t=Bg(t),A2(t)?t:(nt(t instanceof sn,64498),nt(tu(t),40251),nt(t.filters.length>1,57927),t.filters.reduce((s,i)=>Yv(s,i)))}function Yv(n,e){let t;return nt(n instanceof Ct||n instanceof sn,38388),nt(e instanceof Ct||e instanceof sn,25473),t=n instanceof Ct?e instanceof Ct?function(i,a){return sn.create([i,a],"and")}(n,e):xS(n,e):e instanceof Ct?xS(e,n):function(i,a){if(nt(i.filters.length>0&&a.filters.length>0,48005),tu(i)&&tu(a))return HA(i,a.getFilters());const o=H0(i)?i:a,l=H0(i)?a:i,c=o.filters.map(d=>Yv(d,l));return sn.create(c,"or")}(n,e),Bg(t)}function xS(n,e){if(tu(e))return HA(e,n.getFilters());{const t=e.filters.map(s=>Yv(n,s));return sn.create(t,"or")}}function Bg(n){if(nt(n instanceof Ct||n instanceof sn,11850),n instanceof Ct)return n;const e=n.getFilters();if(e.length===1)return Bg(e[0]);if(BA(n))return n;const t=e.map(i=>Bg(i)),s=[];return t.forEach(i=>{i instanceof Ct?s.push(i):i instanceof sn&&(i.op===n.op?s.push(...i.filters):s.push(i))}),s.length===1?s[0]:sn.create(s,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QF{constructor(){this.Cn=new Xv}addToCollectionParentIndex(e,t){return this.Cn.add(t),he.resolve()}getCollectionParents(e,t){return he.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return he.resolve()}deleteFieldIndex(e,t){return he.resolve()}deleteAllFieldIndexes(e){return he.resolve()}createTargetIndexes(e,t){return he.resolve()}getDocumentsMatchingTarget(e,t){return he.resolve(null)}getIndexType(e,t){return he.resolve(0)}getFieldIndexes(e,t){return he.resolve([])}getNextCollectionGroupToUpdate(e){return he.resolve(null)}getMinOffset(e,t){return he.resolve($r.min())}getMinOffsetFromCollectionGroup(e,t){return he.resolve($r.min())}updateCollectionGroup(e,t,s){return he.resolve()}updateIndexEntries(e,t){return he.resolve()}}class Xv{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),i=this.index[t]||new rn(Vt.comparator),a=!i.has(s);return this.index[t]=i.add(s),a}has(e){const t=e.lastSegment(),s=e.popLast(),i=this.index[t];return i&&i.has(s)}getEntries(e){return(this.index[e]||new rn(Vt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yS="IndexedDbIndexManager",xp=new Uint8Array(0);class WF{constructor(e,t){this.databaseId=t,this.vn=new Xv,this.Fn=new Wa(s=>mc(s),(s,i)=>ff(s,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const s=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const a={collectionId:s,parent:Ks(i)};return bS(e).put(a)}return he.resolve()}getCollectionParents(e,t){const s=[],i=IDBKeyRange.bound([t,""],[mA(t),""],!1,!0);return bS(e).J(i).next(a=>{for(const o of a){if(o.collectionId!==t)break;s.push(Li(o.parent))}return s})}addFieldIndex(e,t){const s=xh(e),i=function(l){return{indexId:l.indexId,collectionGroup:l.collectionGroup,fields:l.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete i.indexId;const a=s.add(i);if(t.indexState){const o=Gc(e);return a.next(l=>{o.put(dS(l,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return a.next()}deleteFieldIndex(e,t){const s=xh(e),i=Gc(e),a=Hc(e);return s.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>a.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=xh(e),s=Hc(e),i=Gc(e);return t.Z().next(()=>s.Z()).next(()=>i.Z())}createTargetIndexes(e,t){return he.forEach(this.Mn(t),s=>this.getIndexType(e,s).next(i=>{if(i===0||i===1){const a=new gS(s).Dn();if(a!=null)return this.addFieldIndex(e,a)}}))}getDocumentsMatchingTarget(e,t){const s=Hc(e);let i=!0;const a=new Map;return he.forEach(this.Mn(t),o=>this.xn(e,o).next(l=>{i&&(i=!!l),a.set(o,l)})).next(()=>{if(i){let o=jt();const l=[];return he.forEach(a,(c,d)=>{Oe(yS,`Using index ${function(j){return`id=${j.indexId}|cg=${j.collectionGroup}|f=${j.fields.map(V=>`${V.fieldPath}:${V.kind}`).join(",")}`}(c)} to execute ${mc(t)}`);const h=function(j,V){const $=F0(V);if($===void 0)return null;for(const Z of Vg(j,$.fieldPath))switch(Z.op){case"array-contains-any":return Z.value.arrayValue.values||[];case"array-contains":return[Z.value]}return null}(d,c),f=function(j,V){const $=new Map;for(const Z of zl(V))for(const O of Vg(j,Z.fieldPath))switch(O.op){case"==":case"in":$.set(Z.fieldPath.canonicalString(),O.value);break;case"not-in":case"!=":return $.set(Z.fieldPath.canonicalString(),O.value),Array.from($.values())}return null}(d,c),p=function(j,V){const $=[];let Z=!0;for(const O of zl(V)){const M=O.kind===0?YE(j,O.fieldPath,j.startAt):XE(j,O.fieldPath,j.startAt);$.push(M.value),Z&&(Z=M.inclusive)}return new eu($,Z)}(d,c),x=function(j,V){const $=[];let Z=!0;for(const O of zl(V)){const M=O.kind===0?XE(j,O.fieldPath,j.endAt):YE(j,O.fieldPath,j.endAt);$.push(M.value),Z&&(Z=M.inclusive)}return new eu($,Z)}(d,c),I=this.On(c,d,p),D=this.On(c,d,x),A=this.Nn(c,d,f),g=this.Bn(c.indexId,h,I,p.inclusive,D,x.inclusive,A);return he.forEach(g,N=>s.Y(N,t.limit).next(j=>{j.forEach(V=>{const $=Ge.fromSegments(V.documentKey);o.has($)||(o=o.add($),l.push($))})}))}).next(()=>l)}return he.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=GF(sn.create(e.filters,"and")).map(s=>Q0(e.path,e.collectionGroup,e.orderBy,s.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t),t)}Bn(e,t,s,i,a,o,l){const c=(t!=null?t.length:1)*Math.max(s.length,a.length),d=c/(t!=null?t.length:1),h=[];for(let f=0;f<c;++f){const p=t?this.Ln(t[f/d]):xp,x=this.kn(e,p,s[f%d],i),I=this.qn(e,p,a[f%d],o),D=l.map(A=>this.kn(e,p,A,!0));h.push(...this.createRange(x,I,D))}return h}kn(e,t,s,i){const a=new Ql(e,Ge.empty(),t,s);return i?a:a.An()}qn(e,t,s,i){const a=new Ql(e,Ge.empty(),t,s);return i?a.An():a}xn(e,t){const s=new gS(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(a=>{let o=null;for(const l of a)s.yn(l)&&(!o||l.fields.length>o.fields.length)&&(o=l);return o})}getIndexType(e,t){let s=2;const i=this.Mn(t);return he.forEach(i,a=>this.xn(e,a).next(o=>{o?s!==0&&o.fields.length<function(c){let d=new rn(Fn.comparator),h=!1;for(const f of c.filters)for(const p of f.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?h=!0:d=d.add(p.field));for(const f of c.orderBy)f.field.isKeyField()||(d=d.add(f.field));return d.size+(h?1:0)}(a)&&(s=1):s=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&s===2?1:s)}Qn(e,t){const s=new gh;for(const i of zl(e)){const a=t.data.field(i.fieldPath);if(a==null)return null;const o=s.Pn(i.kind);Gl.Kt.Dt(a,o)}return s.un()}Ln(e){const t=new gh;return Gl.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const s=new gh;return Gl.Kt.Dt(Pm(this.databaseId,t),s.Pn(function(a){const o=zl(a);return o.length===0?0:o[o.length-1].kind}(e))),s.un()}Nn(e,t,s){if(s===null)return[];let i=[];i.push(new gh);let a=0;for(const o of zl(e)){const l=s[a++];for(const c of i)if(this.Un(t,o.fieldPath)&&km(l))i=this.Kn(i,o,l);else{const d=c.Pn(o.kind);Gl.Kt.Dt(l,d)}}return this.Wn(i)}On(e,t,s){return this.Nn(e,t,s.position)}Wn(e){const t=[];for(let s=0;s<e.length;++s)t[s]=e[s].un();return t}Kn(e,t,s){const i=[...e],a=[];for(const o of s.arrayValue.values||[])for(const l of i){const c=new gh;c.seed(l.un()),Gl.Kt.Dt(o,c.Pn(t.kind)),a.push(c)}return a}Un(e,t){return!!e.filters.find(s=>s instanceof Ct&&s.field.isEqual(t)&&(s.op==="in"||s.op==="not-in"))}getFieldIndexes(e,t){const s=xh(e),i=Gc(e);return(t?s.J(V0,IDBKeyRange.bound(t,t)):s.J()).next(a=>{const o=[];return he.forEach(a,l=>i.get([l.indexId,this.uid]).next(c=>{o.push(function(h,f){const p=f?new Em(f.sequenceNumber,new $r(pc(f.readTime),new Ge(Li(f.documentKey)),f.largestBatchId)):Em.empty(),x=h.fields.map(([I,D])=>new Vp(Fn.fromServerFormat(I),D));return new Og(h.indexId,h.collectionGroup,x,p)}(l,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((s,i)=>{const a=s.indexState.sequenceNumber-i.indexState.sequenceNumber;return a!==0?a:ft(s.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,s){const i=xh(e),a=Gc(e);return this.Gn(e).next(o=>i.J(V0,IDBKeyRange.bound(t,t)).next(l=>he.forEach(l,c=>a.put(dS(c.indexId,this.uid,o,s)))))}updateIndexEntries(e,t){const s=new Map;return he.forEach(t,(i,a)=>{const o=s.get(i.collectionGroup);return(o?he.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(s.set(i.collectionGroup,l),he.forEach(l,c=>this.zn(e,i,c).next(d=>{const h=this.jn(a,c);return d.isEqual(h)?he.resolve():this.Jn(e,a,c,d,h)}))))})}Hn(e,t,s,i){return Hc(e).put(i.Rn(this.uid,this.$n(s,t.key),t.key))}Yn(e,t,s,i){return Hc(e).delete(i.Vn(this.uid,this.$n(s,t.key),t.key))}zn(e,t,s){const i=Hc(e);let a=new rn(uo);return i.ee({index:SA,range:IDBKeyRange.only([s.indexId,this.uid,Wp(this.$n(s,t))])},(o,l)=>{a=a.add(new Ql(s.indexId,t,pS(l.arrayValue),pS(l.directionalValue)))}).next(()=>a)}jn(e,t){let s=new rn(uo);const i=this.Qn(t,e);if(i==null)return s;const a=F0(t);if(a!=null){const o=e.data.field(a.fieldPath);if(km(o))for(const l of o.arrayValue.values||[])s=s.add(new Ql(t.indexId,e.key,this.Ln(l),i))}else s=s.add(new Ql(t.indexId,e.key,xp,i));return s}Jn(e,t,s,i,a){Oe(yS,"Updating index entries for document '%s'",t.key);const o=[];return function(c,d,h,f,p){const x=c.getIterator(),I=d.getIterator();let D=Bc(x),A=Bc(I);for(;D||A;){let g=!1,N=!1;if(D&&A){const j=h(D,A);j<0?N=!0:j>0&&(g=!0)}else D!=null?N=!0:g=!0;g?(f(A),A=Bc(I)):N?(p(D),D=Bc(x)):(D=Bc(x),A=Bc(I))}}(i,a,uo,l=>{o.push(this.Hn(e,t,s,l))},l=>{o.push(this.Yn(e,t,s,l))}),he.waitFor(o)}Gn(e){let t=1;return Gc(e).ee({index:EA,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(s,i,a)=>{a.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,s){s=s.sort((o,l)=>uo(o,l)).filter((o,l,c)=>!l||uo(o,c[l-1])!==0);const i=[];i.push(e);for(const o of s){const l=uo(o,e),c=uo(o,t);if(l===0)i[0]=e.An();else if(l>0&&c<0)i.push(o),i.push(o.An());else if(c>0)break}i.push(t);const a=[];for(let o=0;o<i.length;o+=2){if(this.Zn(i[o],i[o+1]))return[];const l=i[o].Vn(this.uid,xp,Ge.empty()),c=i[o+1].Vn(this.uid,xp,Ge.empty());a.push(IDBKeyRange.bound(l,c))}return a}Zn(e,t){return uo(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(wS)}getMinOffset(e,t){return he.mapArray(this.Mn(t),s=>this.xn(e,s).next(i=>i||Je(44426))).next(wS)}}function bS(n){return ys(n,Cm)}function Hc(n){return ys(n,Xh)}function xh(n){return ys(n,kv)}function Gc(n){return ys(n,Yh)}function wS(n){nt(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let s=1;s<n.length;s++){const i=n[s].indexState.offset;Dv(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new $r(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vS={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},D2=41943040;class Hs{static withCacheSize(e){return new Hs(e,Hs.DEFAULT_COLLECTION_PERCENTILE,Hs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R2(n,e,t){const s=n.store(pi),i=n.store(Wd),a=[],o=IDBKeyRange.only(t.batchId);let l=0;const c=s.ee({range:o},(h,f,p)=>(l++,p.delete()));a.push(c.next(()=>{nt(l===1,47070,{batchId:t.batchId})}));const d=[];for(const h of t.mutations){const f=NA(e,h.key.path,t.batchId);a.push(i.delete(f)),d.push(h.key)}return he.waitFor(a).next(()=>d)}function qg(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Je(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Hs.DEFAULT_COLLECTION_PERCENTILE=10,Hs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Hs.DEFAULT=new Hs(D2,Hs.DEFAULT_COLLECTION_PERCENTILE,Hs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Hs.DISABLED=new Hs(-1,0,0);class $x{constructor(e,t,s,i){this.userId=e,this.serializer=t,this.indexManager=s,this.referenceDelegate=i,this.Xn={}}static wt(e,t,s,i){nt(e.uid!=="",64387);const a=e.isAuthenticated()?e.uid:"";return new $x(a,t,s,i)}checkEmpty(e){let t=!0;const s=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ho(e).ee({index:Wl,range:s},(i,a,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,s,i){const a=nd(e),o=ho(e);return o.add({}).next(l=>{nt(typeof l=="number",49019);const c=new Hv(l,t,s,i),d=function(x,I,D){const A=D.baseMutations.map(N=>Lm(x.yt,N)),g=D.mutations.map(N=>Lm(x.yt,N));return{userId:I,batchId:D.batchId,localWriteTimeMs:D.localWriteTime.toMillis(),baseMutations:A,mutations:g}}(this.serializer,this.userId,c),h=[];let f=new rn((p,x)=>ft(p.canonicalString(),x.canonicalString()));for(const p of i){const x=NA(this.userId,p.key.path,l);f=f.add(p.key.path.popLast()),h.push(o.put(d)),h.push(a.put(x,I4))}return f.forEach(p=>{h.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.Xn[l]=c.keys()}),he.waitFor(h).next(()=>c)})}lookupMutationBatch(e,t){return ho(e).get(t).next(s=>s?(nt(s.userId===this.userId,48,"Unexpected user for mutation batch",{userId:s.userId,batchId:t}),Hl(this.serializer,s)):null)}er(e,t){return this.Xn[t]?he.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(s=>{if(s){const i=s.keys();return this.Xn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const s=t+1,i=IDBKeyRange.lowerBound([this.userId,s]);let a=null;return ho(e).ee({index:Wl,range:i},(o,l,c)=>{l.userId===this.userId&&(nt(l.batchId>=s,47524,{tr:s}),a=Hl(this.serializer,l)),c.done()}).next(()=>a)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let s=nc;return ho(e).ee({index:Wl,range:t,reverse:!0},(i,a,o)=>{s=a.batchId,o.done()}).next(()=>s)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,nc],[this.userId,Number.POSITIVE_INFINITY]);return ho(e).J(Wl,t).next(s=>s.map(i=>Hl(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const s=zp(this.userId,t.path),i=IDBKeyRange.lowerBound(s),a=[];return nd(e).ee({range:i},(o,l,c)=>{const[d,h,f]=o,p=Li(h);if(d===this.userId&&t.path.isEqual(p))return ho(e).get(f).next(x=>{if(!x)throw Je(61480,{nr:o,batchId:f});nt(x.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:x.userId,batchId:f}),a.push(Hl(this.serializer,x))});c.done()}).next(()=>a)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new rn(ft);const i=[];return t.forEach(a=>{const o=zp(this.userId,a.path),l=IDBKeyRange.lowerBound(o),c=nd(e).ee({range:l},(d,h,f)=>{const[p,x,I]=d,D=Li(x);p===this.userId&&a.path.isEqual(D)?s=s.add(I):f.done()});i.push(c)}),he.waitFor(i).next(()=>this.rr(e,s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,i=s.length+1,a=zp(this.userId,s),o=IDBKeyRange.lowerBound(a);let l=new rn(ft);return nd(e).ee({range:o},(c,d,h)=>{const[f,p,x]=c,I=Li(p);f===this.userId&&s.isPrefixOf(I)?I.length===i&&(l=l.add(x)):h.done()}).next(()=>this.rr(e,l))}rr(e,t){const s=[],i=[];return t.forEach(a=>{i.push(ho(e).get(a).next(o=>{if(o===null)throw Je(35274,{batchId:a});nt(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:a}),s.push(Hl(this.serializer,o))}))}),he.waitFor(i).next(()=>s)}removeMutationBatch(e,t){return R2(e.le,this.userId,t).next(s=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),he.forEach(s,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return he.resolve();const s=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return nd(e).ee({range:s},(a,o,l)=>{if(a[0]===this.userId){const c=Li(a[1]);i.push(c)}else l.done()}).next(()=>{nt(i.length===0,56720,{sr:i.map(a=>a.canonicalString())})})})}containsKey(e,t){return P2(e,this.userId,t)}_r(e){return k2(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:nc,lastStreamToken:""})}}function P2(n,e,t){const s=zp(e,t.path),i=s[1],a=IDBKeyRange.lowerBound(s);let o=!1;return nd(n).ee({range:a,X:!0},(l,c,d)=>{const[h,f,p]=l;h===e&&f===i&&(o=!0),d.done()}).next(()=>o)}function ho(n){return ys(n,pi)}function nd(n){return ys(n,Wd)}function k2(n){return ys(n,Im)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gc{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new gc(0)}static cr(){return new gc(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KF{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{const s=new gc(t.highestTargetId);return t.highestTargetId=s.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(t=>rt.fromTimestamp(new Gt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,s){return this.lr(e).next(i=>(i.highestListenSequenceNumber=t,s&&(i.lastRemoteSnapshotVersion=s.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.hr(e,i)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(s=>(s.targetCount+=1,this.Tr(t,s),this.hr(e,s))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Qc(e).delete(t.targetId)).next(()=>this.lr(e)).next(s=>(nt(s.targetCount>0,8065),s.targetCount-=1,this.hr(e,s)))}removeTargets(e,t,s){let i=0;const a=[];return Qc(e).ee((o,l)=>{const c=Ah(l);c.sequenceNumber<=t&&s.get(c.targetId)===null&&(i++,a.push(this.removeTargetData(e,c)))}).next(()=>he.waitFor(a)).next(()=>i)}forEachTarget(e,t){return Qc(e).ee((s,i)=>{const a=Ah(i);t(a)})}lr(e){return NS(e).get(Fg).next(t=>(nt(t!==null,2888),t))}hr(e,t){return NS(e).put(Fg,t)}Pr(e,t){return Qc(e).put(I2(this.serializer,t))}Tr(e,t){let s=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,s=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,s=!0),s}getTargetCount(e){return this.lr(e).next(t=>t.targetCount)}getTargetData(e,t){const s=mc(t),i=IDBKeyRange.bound([s,Number.NEGATIVE_INFINITY],[s,Number.POSITIVE_INFINITY]);let a=null;return Qc(e).ee({range:i,index:_A},(o,l,c)=>{const d=Ah(l);ff(t,d.target)&&(a=d,c.done())}).next(()=>a)}addMatchingKeys(e,t,s){const i=[],a=jo(e);return t.forEach(o=>{const l=Ks(o.path);i.push(a.put({targetId:s,path:l})),i.push(this.referenceDelegate.addReference(e,s,o))}),he.waitFor(i)}removeMatchingKeys(e,t,s){const i=jo(e);return he.forEach(t,a=>{const o=Ks(a.path);return he.waitFor([i.delete([s,o]),this.referenceDelegate.removeReference(e,s,a)])})}removeMatchingKeysForTargetId(e,t){const s=jo(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return s.delete(i)}getMatchingKeysForTargetId(e,t){const s=IDBKeyRange.bound([t],[t+1],!1,!0),i=jo(e);let a=jt();return i.ee({range:s,X:!0},(o,l,c)=>{const d=Li(o[1]),h=new Ge(d);a=a.add(h)}).next(()=>a)}containsKey(e,t){const s=Ks(t.path),i=IDBKeyRange.bound([s],[mA(s)],!1,!0);let a=0;return jo(e).ee({index:Pv,X:!0,range:i},([o,l],c,d)=>{o!==0&&(a++,d.done())}).next(()=>a>0)}At(e,t){return Qc(e).get(t).next(s=>s?Ah(s):null)}}function Qc(n){return ys(n,Kd)}function NS(n){return ys(n,sc)}function jo(n){return ys(n,Yd)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jS="LruGarbageCollector",O2=1048576;function _S([n,e],[t,s]){const i=ft(n,t);return i===0?ft(e,s):i}class YF{constructor(e){this.Ir=e,this.buffer=new rn(_S),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();_S(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class M2{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Oe(jS,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){ol(t)?Oe(jS,"Ignoring IndexedDB error during garbage collection: ",t):await al(t)}await this.Vr(3e5)})}}class XF{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(s=>Math.floor(t/100*s))}nthSequenceNumber(e,t){if(t===0)return he.resolve(yr.ce);const s=new YF(t);return this.mr.forEachTarget(e,i=>s.Ar(i.sequenceNumber)).next(()=>this.mr.pr(e,i=>s.Ar(i))).next(()=>s.maxValue)}removeTargets(e,t,s){return this.mr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Oe("LruGarbageCollector","Garbage collection skipped; disabled"),he.resolve(vS)):this.getCacheSize(e).next(s=>s<this.params.cacheSizeCollectionThreshold?(Oe("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),vS):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let s,i,a,o,l,c,d;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(Oe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),i=this.params.maximumSequenceNumbersToCollect):i=f,o=Date.now(),this.nthSequenceNumber(e,i))).next(f=>(s=f,l=Date.now(),this.removeTargets(e,s,t))).next(f=>(a=f,c=Date.now(),this.removeOrphanedDocuments(e,s))).next(f=>(d=Date.now(),Jc()<=Tt.DEBUG&&Oe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${i} in `+(l-o)+`ms
	Removed ${a} targets in `+(c-l)+`ms
	Removed ${f} documents in `+(d-c)+`ms
Total Duration: ${d-h}ms`),he.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:a,documentsRemoved:f})))}}function L2(n,e){return new XF(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JF{constructor(e,t){this.db=e,this.garbageCollector=L2(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(s=>t.next(i=>s+i))}wr(e){let t=0;return this.pr(e,s=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(s,i)=>t(i))}addReference(e,t,s){return yp(e,s)}removeReference(e,t,s){return yp(e,s)}removeTargets(e,t,s){return this.db.getTargetCache().removeTargets(e,t,s)}markPotentiallyOrphaned(e,t){return yp(e,t)}br(e,t){return function(i,a){let o=!1;return k2(i).te(l=>P2(i,l,a).next(c=>(c&&(o=!0),he.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const s=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let a=0;return this.Sr(e,(o,l)=>{if(l<=t){const c=this.br(e,o).next(d=>{if(!d)return a++,s.getEntry(e,o).next(()=>(s.removeEntry(o,rt.min()),jo(e).delete(function(f){return[0,Ks(f.path)]}(o))))});i.push(c)}}).next(()=>he.waitFor(i)).next(()=>s.apply(e)).next(()=>a)}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,s)}updateLimboDocument(e,t){return yp(e,t)}Sr(e,t){const s=jo(e);let i,a=yr.ce;return s.ee({index:Pv},([o,l],{path:c,sequenceNumber:d})=>{o===0?(a!==yr.ce&&t(new Ge(Li(i)),a),a=d,i=c):a=yr.ce}).next(()=>{a!==yr.ce&&t(new Ge(Li(i)),a)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function yp(n,e){return jo(n).put(function(s,i){return{targetId:0,path:Ks(s.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F2{constructor(){this.changes=new Wa(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Dn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?he.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZF{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,s){return Cl(e).put(s)}removeEntry(e,t,s){return Cl(e).delete(function(a,o){const l=a.path.toArray();return[l.slice(0,l.length-2),l[l.length-2],$g(o),l[l.length-1]]}(t,s))}updateMetadata(e,t){return this.getMetadata(e).next(s=>(s.byteSize+=t,this.Dr(e,s)))}getEntry(e,t){let s=Dn.newInvalidDocument(t);return Cl(e).ee({index:$p,range:IDBKeyRange.only(yh(t))},(i,a)=>{s=this.Cr(t,a)}).next(()=>s)}vr(e,t){let s={size:0,document:Dn.newInvalidDocument(t)};return Cl(e).ee({index:$p,range:IDBKeyRange.only(yh(t))},(i,a)=>{s={document:this.Cr(t,a),size:qg(a)}}).next(()=>s)}getEntries(e,t){let s=kr();return this.Fr(e,t,(i,a)=>{const o=this.Cr(i,a);s=s.insert(i,o)}).next(()=>s)}Mr(e,t){let s=kr(),i=new wn(Ge.comparator);return this.Fr(e,t,(a,o)=>{const l=this.Cr(a,o);s=s.insert(a,l),i=i.insert(a,qg(o))}).next(()=>({documents:s,Or:i}))}Fr(e,t,s){if(t.isEmpty())return he.resolve();let i=new rn(IS);t.forEach(c=>i=i.add(c));const a=IDBKeyRange.bound(yh(i.first()),yh(i.last())),o=i.getIterator();let l=o.getNext();return Cl(e).ee({index:$p,range:a},(c,d,h)=>{const f=Ge.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;l&&IS(l,f)<0;)s(l,null),l=o.getNext();l&&l.isEqual(f)&&(s(l,d),l=o.hasNext()?o.getNext():null),l?h.j(yh(l)):h.done()}).next(()=>{for(;l;)s(l,null),l=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,s,i,a){const o=t.path,l=[o.popLast().toArray(),o.lastSegment(),$g(s.readTime),s.documentKey.path.isEmpty()?"":s.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Cl(e).J(IDBKeyRange.bound(l,c,!0)).next(d=>{a==null||a.incrementDocumentReadCount(d.length);let h=kr();for(const f of d){const p=this.Cr(Ge.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);p.isFoundDocument()&&(gf(t,p)||i.has(p.key))&&(h=h.insert(p.key,p))}return h})}getAllFromCollectionGroup(e,t,s,i){let a=kr();const o=SS(t,s),l=SS(t,$r.max());return Cl(e).ee({index:jA,range:IDBKeyRange.bound(o,l,!0)},(c,d,h)=>{const f=this.Cr(Ge.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);a=a.insert(f.key,f),a.size===i&&h.done()}).next(()=>a)}newChangeBuffer(e){return new eU(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return ES(e).get(U0).next(t=>(nt(!!t,20021),t))}Dr(e,t){return ES(e).put(U0,t)}Cr(e,t){if(t){const s=UF(this.serializer,t);if(!(s.isNoDocument()&&s.version.isEqual(rt.min())))return s}return Dn.newInvalidDocument(e)}}function U2(n){return new ZF(n)}class eU extends F2{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new Wa(s=>s.toString(),(s,i)=>s.isEqual(i))}applyChanges(e){const t=[];let s=0,i=new rn((a,o)=>ft(a.canonicalString(),o.canonicalString()));return this.changes.forEach((a,o)=>{const l=this.Br.get(a);if(t.push(this.Nr.removeEntry(e,a,l.readTime)),o.isValidDocument()){const c=lS(this.Nr.serializer,o);i=i.add(a.path.popLast());const d=qg(c);s+=d-l.size,t.push(this.Nr.addEntry(e,a,c))}else if(s-=l.size,this.trackRemovals){const c=lS(this.Nr.serializer,o.convertToNoDocument(rt.min()));t.push(this.Nr.addEntry(e,a,c))}}),i.forEach(a=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,a))}),t.push(this.Nr.updateMetadata(e,s)),he.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(s=>(this.Br.set(t,{size:s.size,readTime:s.document.readTime}),s.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:s,Or:i})=>(i.forEach((a,o)=>{this.Br.set(a,{size:o,readTime:s.get(a).readTime})}),s))}}function ES(n){return ys(n,Tm)}function Cl(n){return ys(n,Lg)}function yh(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function SS(n,e){const t=e.documentKey.path.toArray();return[n,$g(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function IS(n,e){const t=n.path.toArray(),s=e.path.toArray();let i=0;for(let a=0;a<t.length-2&&a<s.length-2;++a)if(i=ft(t[a],s[a]),i)return i;return i=ft(t.length,s.length),i||(i=ft(t[t.length-2],s[s.length-2]),i||ft(t[t.length-1],s[s.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tU{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V2{constructor(e,t,s,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=i}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(s=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(s!==null&&tm(s.mutation,i,br.empty(),Gt.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.getLocalViewOfDocuments(e,s,jt()).next(()=>s))}getLocalViewOfDocuments(e,t,s=jt()){const i=Fi();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,s).next(a=>{let o=Th();return a.forEach((l,c)=>{o=o.insert(l,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const s=Fi();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,jt()))}populateOverlays(e,t,s){const i=[];return s.forEach(a=>{t.has(a)||i.push(a)}),this.documentOverlayCache.getOverlays(e,i).next(a=>{a.forEach((o,l)=>{t.set(o,l)})})}computeViews(e,t,s,i){let a=kr();const o=em(),l=function(){return em()}();return t.forEach((c,d)=>{const h=s.get(d.key);i.has(d.key)&&(h===void 0||h.mutation instanceof Ka)?a=a.insert(d.key,d):h!==void 0?(o.set(d.key,h.mutation.getFieldMask()),tm(h.mutation,d,h.mutation.getFieldMask(),Gt.now())):o.set(d.key,br.empty())}),this.recalculateAndSaveOverlays(e,a).next(c=>(c.forEach((d,h)=>o.set(d,h)),t.forEach((d,h)=>l.set(d,new tU(h,o.get(d)??null))),l))}recalculateAndSaveOverlays(e,t){const s=em();let i=new wn((o,l)=>o-l),a=jt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const l of o)l.keys().forEach(c=>{const d=t.get(c);if(d===null)return;let h=s.get(c)||br.empty();h=l.applyToLocalView(d,h),s.set(c,h);const f=(i.get(l.batchId)||jt()).add(c);i=i.insert(l.batchId,f)})}).next(()=>{const o=[],l=i.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),d=c.key,h=c.value,f=n2();h.forEach(p=>{if(!a.has(p)){const x=c2(t.get(p),s.get(p));x!==null&&f.set(p,x),a=a.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,d,f))}return he.waitFor(o)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.recalculateAndSaveOverlays(e,s))}getDocumentsMatchingQuery(e,t,s,i){return function(o){return Ge.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):YA(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,i):this.getDocumentsMatchingCollectionQuery(e,t,s,i)}getNextDocuments(e,t,s,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,i).next(a=>{const o=i-a.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,i-a.size):he.resolve(Fi());let l=Qd,c=a;return o.next(d=>he.forEach(d,(h,f)=>(l<f.largestBatchId&&(l=f.largestBatchId),a.get(h)?he.resolve():this.remoteDocumentCache.getEntry(e,h).next(p=>{c=c.insert(h,p)}))).next(()=>this.populateOverlays(e,d,a)).next(()=>this.computeViews(e,c,d,jt())).next(h=>({batchId:l,changes:t2(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ge(t)).next(s=>{let i=Th();return s.isFoundDocument()&&(i=i.insert(s.key,s)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,s,i){const a=t.collectionGroup;let o=Th();return this.indexManager.getCollectionParents(e,a).next(l=>he.forEach(l,c=>{const d=function(f,p){return new ju(p,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,c.child(a));return this.getDocumentsMatchingCollectionQuery(e,d,s,i).next(h=>{h.forEach((f,p)=>{o=o.insert(f,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,s,i){let a;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next(o=>(a=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,a,i))).next(o=>{a.forEach((c,d)=>{const h=d.getKey();o.get(h)===null&&(o=o.insert(h,Dn.newInvalidDocument(h)))});let l=Th();return o.forEach((c,d)=>{const h=a.get(c);h!==void 0&&tm(h.mutation,d,br.empty(),Gt.now()),gf(t,d)&&(l=l.insert(c,d))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nU{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return he.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Ds(i.createTime)}}(t)),he.resolve()}getNamedQuery(e,t){return he.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(i){return{name:i.name,query:T2(i.bundledQuery),readTime:Ds(i.readTime)}}(t)),he.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sU{constructor(){this.overlays=new wn(Ge.comparator),this.qr=new Map}getOverlay(e,t){return he.resolve(this.overlays.get(t))}getOverlays(e,t){const s=Fi();return he.forEach(t,i=>this.getOverlay(e,i).next(a=>{a!==null&&s.set(i,a)})).next(()=>s)}saveOverlays(e,t,s){return s.forEach((i,a)=>{this.St(e,t,a)}),he.resolve()}removeOverlaysForBatchId(e,t,s){const i=this.qr.get(s);return i!==void 0&&(i.forEach(a=>this.overlays=this.overlays.remove(a)),this.qr.delete(s)),he.resolve()}getOverlaysForCollection(e,t,s){const i=Fi(),a=t.length+1,o=new Ge(t.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const c=l.getNext().value,d=c.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===a&&c.largestBatchId>s&&i.set(c.getKey(),c)}return he.resolve(i)}getOverlaysForCollectionGroup(e,t,s,i){let a=new wn((d,h)=>d-h);const o=this.overlays.getIterator();for(;o.hasNext();){const d=o.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>s){let h=a.get(d.largestBatchId);h===null&&(h=Fi(),a=a.insert(d.largestBatchId,h)),h.set(d.getKey(),d)}}const l=Fi(),c=a.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,h)=>l.set(d,h)),!(l.size()>=i)););return he.resolve(l)}St(e,t,s){const i=this.overlays.get(s.key);if(i!==null){const o=this.qr.get(i.largestBatchId).delete(s.key);this.qr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new Qv(t,s));let a=this.qr.get(t);a===void 0&&(a=jt(),this.qr.set(t,a)),this.qr.set(t,a.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rU{constructor(){this.sessionToken=is.EMPTY_BYTE_STRING}getSessionToken(e){return he.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,he.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jv{constructor(){this.Qr=new rn(Es.$r),this.Ur=new rn(Es.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const s=new Es(e,t);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(e,t){e.forEach(s=>this.addReference(s,t))}removeReference(e,t){this.Gr(new Es(e,t))}zr(e,t){e.forEach(s=>this.removeReference(s,t))}jr(e){const t=new Ge(new Vt([])),s=new Es(t,e),i=new Es(t,e+1),a=[];return this.Ur.forEachInRange([s,i],o=>{this.Gr(o),a.push(o.key)}),a}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Ge(new Vt([])),s=new Es(t,e),i=new Es(t,e+1);let a=jt();return this.Ur.forEachInRange([s,i],o=>{a=a.add(o.key)}),a}containsKey(e){const t=new Es(e,0),s=this.Qr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class Es{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Ge.comparator(e.key,t.key)||ft(e.Yr,t.Yr)}static Kr(e,t){return ft(e.Yr,t.Yr)||Ge.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iU{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new rn(Es.$r)}checkEmpty(e){return he.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,i){const a=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Hv(a,t,s,i);this.mutationQueue.push(o);for(const l of i)this.Zr=this.Zr.add(new Es(l.key,a)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return he.resolve(o)}lookupMutationBatch(e,t){return he.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,i=this.ei(s),a=i<0?0:i;return he.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}getHighestUnacknowledgedBatchId(){return he.resolve(this.mutationQueue.length===0?nc:this.tr-1)}getAllMutationBatches(e){return he.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new Es(t,0),i=new Es(t,Number.POSITIVE_INFINITY),a=[];return this.Zr.forEachInRange([s,i],o=>{const l=this.Xr(o.Yr);a.push(l)}),he.resolve(a)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new rn(ft);return t.forEach(i=>{const a=new Es(i,0),o=new Es(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([a,o],l=>{s=s.add(l.Yr)})}),he.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,i=s.length+1;let a=s;Ge.isDocumentKey(a)||(a=a.child(""));const o=new Es(new Ge(a),0);let l=new rn(ft);return this.Zr.forEachWhile(c=>{const d=c.key.path;return!!s.isPrefixOf(d)&&(d.length===i&&(l=l.add(c.Yr)),!0)},o),he.resolve(this.ti(l))}ti(e){const t=[];return e.forEach(s=>{const i=this.Xr(s);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){nt(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Zr;return he.forEach(t.mutations,i=>{const a=new Es(i.key,t.batchId);return s=s.delete(a),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Zr=s})}ir(e){}containsKey(e,t){const s=new Es(t,0),i=this.Zr.firstAfterOrEqual(s);return he.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,he.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aU{constructor(e){this.ri=e,this.docs=function(){return new wn(Ge.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,i=this.docs.get(s),a=i?i.size:0,o=this.ri(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:o}),this.size+=o-a,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return he.resolve(s?s.document.mutableCopy():Dn.newInvalidDocument(t))}getEntries(e,t){let s=kr();return t.forEach(i=>{const a=this.docs.get(i);s=s.insert(i,a?a.document.mutableCopy():Dn.newInvalidDocument(i))}),he.resolve(s)}getDocumentsMatchingQuery(e,t,s,i){let a=kr();const o=t.path,l=new Ge(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:d,value:{document:h}}=c.getNext();if(!o.isPrefixOf(d.path))break;d.path.length>o.length+1||Dv(xA(h),s)<=0||(i.has(h.key)||gf(t,h))&&(a=a.insert(h.key,h.mutableCopy()))}return he.resolve(a)}getAllFromCollectionGroup(e,t,s,i){Je(9500)}ii(e,t){return he.forEach(this.docs,s=>t(s))}newChangeBuffer(e){return new oU(this)}getSize(e){return he.resolve(this.size)}}class oU extends F2{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((s,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(s)}),he.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lU{constructor(e){this.persistence=e,this.si=new Wa(t=>mc(t),ff),this.lastRemoteSnapshotVersion=rt.min(),this.highestTargetId=0,this.oi=0,this._i=new Jv,this.targetCount=0,this.ai=gc.ur()}forEachTarget(e,t){return this.si.forEach((s,i)=>t(i)),he.resolve()}getLastRemoteSnapshotVersion(e){return he.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return he.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),he.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.oi&&(this.oi=t),he.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new gc(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,he.resolve()}updateTargetData(e,t){return this.Pr(t),he.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,he.resolve()}removeTargets(e,t,s){let i=0;const a=[];return this.si.forEach((o,l)=>{l.sequenceNumber<=t&&s.get(l.targetId)===null&&(this.si.delete(o),a.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)}),he.waitFor(a).next(()=>i)}getTargetCount(e){return he.resolve(this.targetCount)}getTargetData(e,t){const s=this.si.get(t)||null;return he.resolve(s)}addMatchingKeys(e,t,s){return this._i.Wr(t,s),he.resolve()}removeMatchingKeys(e,t,s){this._i.zr(t,s);const i=this.persistence.referenceDelegate,a=[];return i&&t.forEach(o=>{a.push(i.markPotentiallyOrphaned(e,o))}),he.waitFor(a)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),he.resolve()}getMatchingKeysForTargetId(e,t){const s=this._i.Hr(t);return he.resolve(s)}containsKey(e,t){return he.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zv{constructor(e,t){this.ui={},this.overlays={},this.ci=new yr(0),this.li=!1,this.li=!0,this.hi=new rU,this.referenceDelegate=e(this),this.Pi=new lU(this),this.indexManager=new QF,this.remoteDocumentCache=function(i){return new aU(i)}(s=>this.referenceDelegate.Ti(s)),this.serializer=new S2(t),this.Ii=new nU(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new sU,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.ui[e.toKey()];return s||(s=new iU(t,this.referenceDelegate),this.ui[e.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,s){Oe("MemoryPersistence","Starting transaction:",e);const i=new cU(this.ci.next());return this.referenceDelegate.Ei(),s(i).next(a=>this.referenceDelegate.di(i).next(()=>a)).toPromise().then(a=>(i.raiseOnCommittedEvent(),a))}Ai(e,t){return he.or(Object.values(this.ui).map(s=>()=>s.containsKey(e,t)))}}class cU extends bA{constructor(e){super(),this.currentSequenceNumber=e}}class Bx{constructor(e){this.persistence=e,this.Ri=new Jv,this.Vi=null}static mi(e){return new Bx(e)}get fi(){if(this.Vi)return this.Vi;throw Je(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.fi.delete(s.toString()),he.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.fi.add(s.toString()),he.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),he.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(i=>this.fi.add(i.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(a=>this.fi.add(a.toString()))}).next(()=>s.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return he.forEach(this.fi,s=>{const i=Ge.fromPath(s);return this.gi(e,i).next(a=>{a||t.removeEntry(i,rt.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(s=>{s?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return he.or([()=>he.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Hg{constructor(e,t){this.persistence=e,this.pi=new Wa(s=>Ks(s.path),(s,i)=>s.isEqual(i)),this.garbageCollector=L2(this,t)}static mi(e,t){return new Hg(e,t)}Ei(){}di(e){return he.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(s=>t.next(i=>s+i))}wr(e){let t=0;return this.pr(e,s=>{t++}).next(()=>t)}pr(e,t){return he.forEach(this.pi,(s,i)=>this.br(e,s,i).next(a=>a?he.resolve():t(i)))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const i=this.persistence.getRemoteDocumentCache(),a=i.newChangeBuffer();return i.ii(e,o=>this.br(e,o,t).next(l=>{l||(s++,a.removeEntry(o,rt.min()))})).next(()=>a.apply(e)).next(()=>s)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),he.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),he.resolve()}removeReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),he.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),he.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=qp(e.data.value)),t}br(e,t,s){return he.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.pi.get(t);return he.resolve(i!==void 0&&i>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dU{constructor(e){this.serializer=e}k(e,t,s,i){const a=new Rx("createOrUpgrade",t);s<1&&i>=1&&(function(c){c.createObjectStore(mf)}(e),function(c){c.createObjectStore(Im,{keyPath:S4}),c.createObjectStore(pi,{keyPath:FE,autoIncrement:!0}).createIndex(Wl,UE,{unique:!0}),c.createObjectStore(Wd)}(e),TS(e),function(c){c.createObjectStore($l)}(e));let o=he.resolve();return s<3&&i>=3&&(s!==0&&(function(c){c.deleteObjectStore(Yd),c.deleteObjectStore(Kd),c.deleteObjectStore(sc)}(e),TS(e)),o=o.next(()=>function(c){const d=c.store(sc),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:rt.min().toTimestamp(),targetCount:0};return d.put(Fg,h)}(a))),s<4&&i>=4&&(s!==0&&(o=o.next(()=>function(c,d){return d.store(pi).J().next(f=>{c.deleteObjectStore(pi),c.createObjectStore(pi,{keyPath:FE,autoIncrement:!0}).createIndex(Wl,UE,{unique:!0});const p=d.store(pi),x=f.map(I=>p.put(I));return he.waitFor(x)})}(e,a))),o=o.next(()=>{(function(c){c.createObjectStore(Xd,{keyPath:O4})})(e)})),s<5&&i>=5&&(o=o.next(()=>this.yi(a))),s<6&&i>=6&&(o=o.next(()=>(function(c){c.createObjectStore(Tm)}(e),this.wi(a)))),s<7&&i>=7&&(o=o.next(()=>this.Si(a))),s<8&&i>=8&&(o=o.next(()=>this.bi(e,a))),s<9&&i>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),s<10&&i>=10&&(o=o.next(()=>this.Di(a))),s<11&&i>=11&&(o=o.next(()=>{(function(c){c.createObjectStore(Px,{keyPath:M4})})(e),function(c){c.createObjectStore(kx,{keyPath:L4})}(e)})),s<12&&i>=12&&(o=o.next(()=>{(function(c){const d=c.createObjectStore(Ox,{keyPath:q4});d.createIndex(z0,H4,{unique:!1}),d.createIndex(IA,G4,{unique:!1})})(e)})),s<13&&i>=13&&(o=o.next(()=>function(c){const d=c.createObjectStore(Lg,{keyPath:T4});d.createIndex($p,C4),d.createIndex(jA,A4)}(e)).next(()=>this.Ci(e,a)).next(()=>e.deleteObjectStore($l))),s<14&&i>=14&&(o=o.next(()=>this.Fi(e,a))),s<15&&i>=15&&(o=o.next(()=>function(c){c.createObjectStore(kv,{keyPath:F4,autoIncrement:!0}).createIndex(V0,U4,{unique:!1}),c.createObjectStore(Yh,{keyPath:V4}).createIndex(EA,z4,{unique:!1}),c.createObjectStore(Xh,{keyPath:$4}).createIndex(SA,B4,{unique:!1})}(e))),s<16&&i>=16&&(o=o.next(()=>{t.objectStore(Yh).clear()}).next(()=>{t.objectStore(Xh).clear()})),s<17&&i>=17&&(o=o.next(()=>{(function(c){c.createObjectStore(Ov,{keyPath:Q4})})(e)})),s<18&&i>=18&&ZC()&&(o=o.next(()=>{t.objectStore(Yh).clear()}).next(()=>{t.objectStore(Xh).clear()})),o}wi(e){let t=0;return e.store($l).ee((s,i)=>{t+=qg(i)}).next(()=>{const s={byteSize:t};return e.store(Tm).put(U0,s)})}yi(e){const t=e.store(Im),s=e.store(pi);return t.J().next(i=>he.forEach(i,a=>{const o=IDBKeyRange.bound([a.userId,nc],[a.userId,a.lastAcknowledgedBatchId]);return s.J(Wl,o).next(l=>he.forEach(l,c=>{nt(c.userId===a.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});const d=Hl(this.serializer,c);return R2(e,a.userId,d).next(()=>{})}))}))}Si(e){const t=e.store(Yd),s=e.store($l);return e.store(sc).get(Fg).next(i=>{const a=[];return s.ee((o,l)=>{const c=new Vt(o),d=function(f){return[0,Ks(f)]}(c);a.push(t.get(d).next(h=>h?he.resolve():(f=>t.put({targetId:0,path:Ks(f),sequenceNumber:i.highestListenSequenceNumber}))(c)))}).next(()=>he.waitFor(a))})}bi(e,t){e.createObjectStore(Cm,{keyPath:k4});const s=t.store(Cm),i=new Xv,a=o=>{if(i.add(o)){const l=o.lastSegment(),c=o.popLast();return s.put({collectionId:l,parent:Ks(c)})}};return t.store($l).ee({X:!0},(o,l)=>{const c=new Vt(o);return a(c.popLast())}).next(()=>t.store(Wd).ee({X:!0},([o,l,c],d)=>{const h=Li(l);return a(h.popLast())}))}Di(e){const t=e.store(Kd);return t.ee((s,i)=>{const a=Ah(i),o=I2(this.serializer,a);return t.put(o)})}Ci(e,t){const s=t.store($l),i=[];return s.ee((a,o)=>{const l=t.store(Lg),c=function(f){return f.document?new Ge(Vt.fromString(f.document.name).popFirst(5)):f.noDocument?Ge.fromSegments(f.noDocument.path):f.unknownDocument?Ge.fromSegments(f.unknownDocument.path):Je(36783)}(o).path.toArray(),d={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(l.put(d))}).next(()=>he.waitFor(i))}Fi(e,t){const s=t.store(pi),i=U2(this.serializer),a=new Zv(Bx.mi,this.serializer.yt);return s.J().next(o=>{const l=new Map;return o.forEach(c=>{let d=l.get(c.userId)??jt();Hl(this.serializer,c).keys().forEach(h=>d=d.add(h)),l.set(c.userId,d)}),he.forEach(l,(c,d)=>{const h=new Is(d),f=zx.wt(this.serializer,h),p=a.getIndexManager(h),x=$x.wt(h,this.serializer,p,a.referenceDelegate);return new V2(i,x,f,p).recalculateAndSaveOverlaysForDocumentKeys(new $0(t,yr.ce),c).next()})})}}function TS(n){n.createObjectStore(Yd,{keyPath:R4}).createIndex(Pv,P4,{unique:!0}),n.createObjectStore(Kd,{keyPath:"targetId"}).createIndex(_A,D4,{unique:!0}),n.createObjectStore(sc)}const mo="IndexedDbPersistence",xb=18e5,yb=5e3,bb="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",uU="main";class eN{constructor(e,t,s,i,a,o,l,c,d,h,f=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=s,this.Mi=a,this.window=o,this.document=l,this.xi=d,this.Oi=h,this.Ni=f,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=p=>Promise.resolve(),!eN.v())throw new Ue(we.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new JF(this,i),this.$i=t+uU,this.serializer=new S2(c),this.Ui=new Go(this.$i,this.Ni,new dU(this.serializer)),this.hi=new zF,this.Pi=new KF(this.referenceDelegate,this.serializer),this.remoteDocumentCache=U2(this.serializer),this.Ii=new VF,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&rs(mo,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Ue(we.FAILED_PRECONDITION,bb);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new yr(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>bp(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(ol(e))return Oe(mo,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Oe(mo,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return bh(e).get($c).next(t=>he.resolve(this.es(t)))}ts(e){return bp(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,xb)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const s=ys(t,Xd);return s.J().next(i=>{const a=this.ss(i,xb),o=i.filter(l=>a.indexOf(l)===-1);return he.forEach(o,l=>s.delete(l.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?he.resolve(!0):bh(e).get($c).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,yb)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new Ue(we.FAILED_PRECONDITION,bb);return!1}}return!(!this.networkEnabled||!this.inForeground)||bp(e).J().next(s=>this.ss(s,yb).find(i=>{if(this.clientId!==i.clientId){const a=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,l=this.networkEnabled===i.networkEnabled;if(a||o&&l)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&Oe(mo,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[mf,Xd],e=>{const t=new $0(e,yr.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(s=>this.rs(s.updateTimeMs,t)&&!this.us(s.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>bp(e).J().next(t=>this.ss(t,xb).map(s=>s.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return $x.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new WF(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return zx.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,s){Oe(mo,"Starting transaction:",e);const i=t==="readonly"?"readonly":"readwrite",a=function(c){return c===18?Y4:c===17?DA:c===16?K4:c===15?Mv:c===14?AA:c===13?CA:c===12?W4:c===11?TA:void Je(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,i,a,l=>(o=new $0(l,this.ci?this.ci.next():yr.ce),t==="readwrite-primary"?this.Hi(o).next(c=>!!c||this.Yi(o)).next(c=>{if(!c)throw rs(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new Ue(we.FAILED_PRECONDITION,yA);return s(o)}).next(c=>this.Xi(o).next(()=>c)):this.Is(o).next(()=>s(o)))).then(l=>(o.raiseOnCommittedEvent(),l))}Is(e){return bh(e).get($c).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,yb)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Ue(we.FAILED_PRECONDITION,bb)})}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return bh(e).put($c,t)}static v(){return Go.v()}Zi(e){const t=bh(e);return t.get($c).next(s=>this.es(s)?(Oe(mo,"Releasing primary lease."),t.delete($c)):he.resolve())}rs(e,t){const s=Date.now();return!(e<s-t)&&(!(e>s)||(rs(`Detected an update time that is in the future: ${e} > ${s}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;JC()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var t;try{const s=((t=this.Ki)==null?void 0:t.getItem(this._s(e)))!==null;return Oe(mo,`Client '${e}' ${s?"is":"is not"} zombied in LocalStorage`),s}catch(s){return rs(mo,"Failed to get zombied client id.",s),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){rs("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function bh(n){return ys(n,mf)}function bp(n){return ys(n,Xd)}function z2(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tN{constructor(e,t,s,i){this.targetId=e,this.fromCache=t,this.Es=s,this.ds=i}static As(e,t){let s=jt(),i=jt();for(const a of t.docChanges)switch(a.type){case 0:s=s.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}return new tN(e,t.fromCache,s,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hU{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $2{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return JC()?8:wA(ps())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,i){const a={result:null};return this.ys(e,t).next(o=>{a.result=o}).next(()=>{if(!a.result)return this.ws(e,t,i,s).next(o=>{a.result=o})}).next(()=>{if(a.result)return;const o=new hU;return this.Ss(e,t,o).next(l=>{if(a.result=l,this.Vs)return this.bs(e,t,o,l.size)})}).next(()=>a.result)}bs(e,t,s,i){return s.documentReadCount<this.fs?(Jc()<=Tt.DEBUG&&Oe("QueryEngine","SDK will not create cache indexes for query:",Zc(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),he.resolve()):(Jc()<=Tt.DEBUG&&Oe("QueryEngine","Query:",Zc(t),"scans",s.documentReadCount,"local documents and returns",i,"documents as results."),s.documentReadCount>this.gs*i?(Jc()<=Tt.DEBUG&&Oe("QueryEngine","The SDK decides to create cache indexes for query:",Zc(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Vr(t))):he.resolve())}ys(e,t){if(JE(t))return he.resolve(null);let s=Vr(t);return this.indexManager.getIndexType(e,s).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=zg(t,null,"F"),s=Vr(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next(a=>{const o=jt(...a);return this.ps.getDocuments(e,o).next(l=>this.indexManager.getMinOffset(e,s).next(c=>{const d=this.Ds(t,l);return this.Cs(t,d,o,c.readTime)?this.ys(e,zg(t,null,"F")):this.vs(e,d,t,c)}))})))}ws(e,t,s,i){return JE(t)||i.isEqual(rt.min())?he.resolve(null):this.ps.getDocuments(e,s).next(a=>{const o=this.Ds(t,a);return this.Cs(t,o,s,i)?he.resolve(null):(Jc()<=Tt.DEBUG&&Oe("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Zc(t)),this.vs(e,o,t,gA(i,Qd)).next(l=>l))})}Ds(e,t){let s=new rn(ZA(e));return t.forEach((i,a)=>{gf(e,a)&&(s=s.add(a))}),s}Cs(e,t,s,i){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const a=e.limitType==="F"?t.last():t.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(i)>0)}Ss(e,t,s){return Jc()<=Tt.DEBUG&&Oe("QueryEngine","Using full collection scan to execute query:",Zc(t)),this.ps.getDocumentsMatchingQuery(e,t,$r.min(),s)}vs(e,t,s,i){return this.ps.getDocumentsMatchingQuery(e,s,i).next(a=>(t.forEach(o=>{a=a.insert(o.key,o)}),a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nN="LocalStore",mU=3e8;class fU{constructor(e,t,s,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new wn(ft),this.xs=new Wa(a=>mc(a),ff),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(s)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new V2(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function B2(n,e,t,s){return new fU(n,e,t,s)}async function q2(n,e){const t=tt(n);return await t.persistence.runTransaction("Handle user change","readonly",s=>{let i;return t.mutationQueue.getAllMutationBatches(s).next(a=>(i=a,t.Bs(e),t.mutationQueue.getAllMutationBatches(s))).next(a=>{const o=[],l=[];let c=jt();for(const d of i){o.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}for(const d of a){l.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}return t.localDocuments.getDocuments(s,c).next(d=>({Ls:d,removedBatchIds:o,addedBatchIds:l}))})})}function pU(n,e){const t=tt(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const i=e.batch.keys(),a=t.Ns.newChangeBuffer({trackRemovals:!0});return function(l,c,d,h){const f=d.batch,p=f.keys();let x=he.resolve();return p.forEach(I=>{x=x.next(()=>h.getEntry(c,I)).next(D=>{const A=d.docVersions.get(I);nt(A!==null,48541),D.version.compareTo(A)<0&&(f.applyToRemoteDocument(D,d),D.isValidDocument()&&(D.setReadTime(d.commitVersion),h.addEntry(D)))})}),x.next(()=>l.mutationQueue.removeMutationBatch(c,f))}(t,s,e,a).next(()=>a.apply(s)).next(()=>t.mutationQueue.performConsistencyCheck(s)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(s,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(l){let c=jt();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(c=c.add(l.batch.mutations[d].key));return c}(e))).next(()=>t.localDocuments.getDocuments(s,i))})}function H2(n){const e=tt(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function gU(n,e){const t=tt(n),s=e.snapshotVersion;let i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;const l=[];e.targetChanges.forEach((h,f)=>{const p=i.get(f);if(!p)return;l.push(t.Pi.removeMatchingKeys(a,h.removedDocuments,f).next(()=>t.Pi.addMatchingKeys(a,h.addedDocuments,f)));let x=p.withSequenceNumber(a.currentSequenceNumber);e.targetMismatches.get(f)!==null?x=x.withResumeToken(is.EMPTY_BYTE_STRING,rt.min()).withLastLimboFreeSnapshotVersion(rt.min()):h.resumeToken.approximateByteSize()>0&&(x=x.withResumeToken(h.resumeToken,s)),i=i.insert(f,x),function(D,A,g){return D.resumeToken.approximateByteSize()===0||A.snapshotVersion.toMicroseconds()-D.snapshotVersion.toMicroseconds()>=mU?!0:g.addedDocuments.size+g.modifiedDocuments.size+g.removedDocuments.size>0}(p,x,h)&&l.push(t.Pi.updateTargetData(a,x))});let c=kr(),d=jt();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(a,h))}),l.push(xU(a,o,e.documentUpdates).next(h=>{c=h.ks,d=h.qs})),!s.isEqual(rt.min())){const h=t.Pi.getLastRemoteSnapshotVersion(a).next(f=>t.Pi.setTargetsMetadata(a,a.currentSequenceNumber,s));l.push(h)}return he.waitFor(l).next(()=>o.apply(a)).next(()=>t.localDocuments.getLocalViewOfDocuments(a,c,d)).next(()=>c)}).then(a=>(t.Ms=i,a))}function xU(n,e,t){let s=jt(),i=jt();return t.forEach(a=>s=s.add(a)),e.getEntries(n,s).next(a=>{let o=kr();return t.forEach((l,c)=>{const d=a.get(l);c.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(l)),c.isNoDocument()&&c.version.isEqual(rt.min())?(e.removeEntry(l,c.readTime),o=o.insert(l,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c),o=o.insert(l,c)):Oe(nN,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",c.version)}),{ks:o,qs:i}})}function yU(n,e){const t=tt(n);return t.persistence.runTransaction("Get next mutation batch","readonly",s=>(e===void 0&&(e=nc),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e)))}function Gg(n,e){const t=tt(n);return t.persistence.runTransaction("Allocate target","readwrite",s=>{let i;return t.Pi.getTargetData(s,e).next(a=>a?(i=a,he.resolve(i)):t.Pi.allocateTargetId(s).next(o=>(i=new _a(e,o,"TargetPurposeListen",s.currentSequenceNumber),t.Pi.addTargetData(s,i).next(()=>i))))}).then(s=>{const i=t.Ms.get(s.targetId);return(i===null||s.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(s.targetId,s),t.xs.set(e,s.targetId)),s})}async function ou(n,e,t){const s=tt(n),i=s.Ms.get(e),a=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",a,o=>s.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!ol(o))throw o;Oe(nN,`Failed to update sequence numbers for target ${e}: ${o}`)}s.Ms=s.Ms.remove(e),s.xs.delete(i.target)}function nw(n,e,t){const s=tt(n);let i=rt.min(),a=jt();return s.persistence.runTransaction("Execute query","readwrite",o=>function(c,d,h){const f=tt(c),p=f.xs.get(h);return p!==void 0?he.resolve(f.Ms.get(p)):f.Pi.getTargetData(d,h)}(s,o,Vr(e)).next(l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(o,l.targetId).next(c=>{a=c})}).next(()=>s.Fs.getDocumentsMatchingQuery(o,e,t?i:rt.min(),t?a:jt())).next(l=>(W2(s,JA(e),l),{documents:l,Qs:a})))}function G2(n,e){const t=tt(n),s=tt(t.Pi),i=t.Ms.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",a=>s.At(a,e).next(o=>o?o.target:null))}function Q2(n,e){const t=tt(n),s=t.Os.get(e)||rt.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.Ns.getAllFromCollectionGroup(i,e,gA(s,Qd),Number.MAX_SAFE_INTEGER)).then(i=>(W2(t,e,i),i))}function W2(n,e,t){let s=n.Os.get(e)||rt.min();t.forEach((i,a)=>{a.readTime.compareTo(s)>0&&(s=a.readTime)}),n.Os.set(e,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K2="firestore_clients";function CS(n,e){return`${K2}_${n}_${e}`}const Y2="firestore_mutations";function AS(n,e,t){let s=`${Y2}_${n}_${t}`;return e.isAuthenticated()&&(s+=`_${e.uid}`),s}const X2="firestore_targets";function wb(n,e){return`${X2}_${n}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ki="SharedClientState";class Qg{constructor(e,t,s,i){this.user=e,this.batchId=t,this.state=s,this.error=i}static Ws(e,t,s){const i=JSON.parse(s);let a,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(a=new Ue(i.error.code,i.error.message))),o?new Qg(e,t,i.state,a):(rs(ki,`Failed to parse mutation state for ID '${t}': ${s}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class nm{constructor(e,t,s){this.targetId=e,this.state=t,this.error=s}static Ws(e,t){const s=JSON.parse(t);let i,a=typeof s=="object"&&["not-current","current","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return a&&s.error&&(a=typeof s.error.message=="string"&&typeof s.error.code=="string",a&&(i=new Ue(s.error.code,s.error.message))),a?new nm(e,s.state,i):(rs(ki,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Wg{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const s=JSON.parse(t);let i=typeof s=="object"&&s.activeTargetIds instanceof Array,a=zv();for(let o=0;i&&o<s.activeTargetIds.length;++o)i=vA(s.activeTargetIds[o]),a=a.add(s.activeTargetIds[o]);return i?new Wg(e,a):(rs(ki,`Failed to parse client data for instance '${e}': ${t}`),null)}}class sN{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new sN(t.clientId,t.onlineState):(rs(ki,`Failed to parse online state: ${e}`),null)}}class sw{constructor(){this.activeTargetIds=zv()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class vb{constructor(e,t,s,i,a){this.window=e,this.Mi=t,this.persistenceKey=s,this.Js=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new wn(ft),this.started=!1,this.Xs=[];const o=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=a,this.eo=CS(this.persistenceKey,this.Js),this.no=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new sw),this.ro=new RegExp(`^${K2}_${o}_([^_]*)$`),this.io=new RegExp(`^${Y2}_${o}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${X2}_${o}_(\\d+)$`),this.oo=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this._o=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const s of e){if(s===this.Js)continue;const i=this.getItem(CS(this.persistenceKey,s));if(i){const a=Wg.Ws(s,i);a&&(this.Zs=this.Zs.insert(a.clientId,a))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const s=this.uo(t);s&&this.co(s)}for(const s of this.Xs)this.Ys(s);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach((s,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,s){this.ho(e,t,s),this.Po(e)}addLocalQueryTarget(e,t=!0){let s="not-current";if(this.isActiveQueryTarget(e)){const i=this.storage.getItem(wb(this.persistenceKey,e));if(i){const a=nm.Ws(e,i);a&&(s=a.state)}}return t&&this.To.zs(e),this.ao(),s}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(wb(this.persistenceKey,e))}updateQueryState(e,t,s){this.Io(e,t,s)}handleUserChange(e,t,s){t.forEach(i=>{this.Po(i)}),this.currentUser=e,s.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return Oe(ki,"READ",e,t),t}setItem(e,t){Oe(ki,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){Oe(ki,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(Oe(ki,"EVENT",t.key,t.newValue),t.key===this.eo)return void rs("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const s=this.Ro(t.key);return this.Vo(s,null)}{const s=this.mo(t.key,t.newValue);if(s)return this.Vo(s.clientId,s)}}else if(this.io.test(t.key)){if(t.newValue!==null){const s=this.fo(t.key,t.newValue);if(s)return this.po(s)}}else if(this.so.test(t.key)){if(t.newValue!==null){const s=this.yo(t.key,t.newValue);if(s)return this.wo(s)}}else if(t.key===this.oo){if(t.newValue!==null){const s=this.uo(t.newValue);if(s)return this.co(s)}}else if(t.key===this.no){const s=function(a){let o=yr.ce;if(a!=null)try{const l=JSON.parse(a);nt(typeof l=="number",30636,{So:a}),o=l}catch(l){rs(ki,"Failed to read sequence number from WebStorage",l)}return o}(t.newValue);s!==yr.ce&&this.sequenceNumberHandler(s)}else if(t.key===this._o){const s=this.bo(t.newValue);await Promise.all(s.map(i=>this.syncEngine.Do(i)))}}}else this.Xs.push(t)})}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,s){const i=new Qg(this.currentUser,e,t,s),a=AS(this.persistenceKey,this.currentUser,e);this.setItem(a,i.Gs())}Po(e){const t=AS(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,s){const i=wb(this.persistenceKey,e),a=new nm(e,t,s);this.setItem(i,a.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const s=this.Ro(e);return Wg.Ws(s,t)}fo(e,t){const s=this.io.exec(e),i=Number(s[1]),a=s[2]!==void 0?s[2]:null;return Qg.Ws(new Is(a),i,t)}yo(e,t){const s=this.so.exec(e),i=Number(s[1]);return nm.Ws(i,t)}uo(e){return sN.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);Oe(ki,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const s=t?this.Zs.insert(e,t):this.Zs.remove(e),i=this.lo(this.Zs),a=this.lo(s),o=[],l=[];return a.forEach(c=>{i.has(c)||o.push(c)}),i.forEach(c=>{a.has(c)||l.push(c)}),this.syncEngine.Fo(o,l).then(()=>{this.Zs=s})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=zv();return e.forEach((s,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class J2{constructor(){this.Mo=new sw,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,s){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new sw,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bU{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DS="ConnectivityMonitor";class RS{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Oe(DS,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Oe(DS,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wp=null;function rw(){return wp===null?wp=function(){return 268435456+Math.round(2147483648*Math.random())}():wp++,"0x"+wp.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nb="RestConnection",wU={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class vU{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${s}/databases/${i}`,this.Wo=this.databaseId.database===Dm?`project_id=${s}`:`project_id=${s}&database_id=${i}`}Go(e,t,s,i,a){const o=rw(),l=this.zo(e,t.toUriEncodedString());Oe(Nb,`Sending RPC '${e}' ${o}:`,l,s);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,i,a);const{host:d}=new URL(l),h=Qa(d);return this.Jo(e,l,c,s,h).then(f=>(Oe(Nb,`Received RPC '${e}' ${o}: `,f),f),f=>{throw Hd(Nb,`RPC '${e}' ${o} failed with error: `,f,"url: ",l,"request:",s),f})}Ho(e,t,s,i,a,o){return this.Go(e,t,s,i,a)}jo(e,t,s){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Nu}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,a)=>e[a]=i),s&&s.headers.forEach((i,a)=>e[a]=i)}zo(e,t){const s=wU[e];return`${this.Uo}/v1/${t}:${s}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NU{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qs="WebChannelConnection";class jU extends vU{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,s,i,a){const o=rw();return new Promise((l,c)=>{const d=new aA;d.setWithCredentials(!0),d.listenOnce(oA.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Up.NO_ERROR:const f=d.getResponseJson();Oe(qs,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),l(f);break;case Up.TIMEOUT:Oe(qs,`RPC '${e}' ${o} timed out`),c(new Ue(we.DEADLINE_EXCEEDED,"Request time out"));break;case Up.HTTP_ERROR:const p=d.getStatus();if(Oe(qs,`RPC '${e}' ${o} failed with status:`,p,"response text:",d.getResponseText()),p>0){let x=d.getResponseJson();Array.isArray(x)&&(x=x[0]);const I=x==null?void 0:x.error;if(I&&I.status&&I.message){const D=function(g){const N=g.toLowerCase().replace(/_/g,"-");return Object.values(we).indexOf(N)>=0?N:we.UNKNOWN}(I.status);c(new Ue(D,I.message))}else c(new Ue(we.UNKNOWN,"Server responded with status "+d.getStatus()))}else c(new Ue(we.UNAVAILABLE,"Connection failed."));break;default:Je(9055,{l_:e,streamId:o,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{Oe(qs,`RPC '${e}' ${o} completed.`)}});const h=JSON.stringify(i);Oe(qs,`RPC '${e}' ${o} sending request:`,i),d.send(t,"POST",h,s,15)})}T_(e,t,s){const i=rw(),a=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=dA(),l=cA(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,t,s),c.encodeInitMessageHeaders=!0;const h=a.join("");Oe(qs,`Creating RPC '${e}' stream ${i}: ${h}`,c);const f=o.createWebChannel(h,c);this.I_(f);let p=!1,x=!1;const I=new NU({Yo:A=>{x?Oe(qs,`Not sending because RPC '${e}' stream ${i} is closed:`,A):(p||(Oe(qs,`Opening RPC '${e}' stream ${i} transport.`),f.open(),p=!0),Oe(qs,`RPC '${e}' stream ${i} sending:`,A),f.send(A))},Zo:()=>f.close()}),D=(A,g,N)=>{A.listen(g,j=>{try{N(j)}catch(V){setTimeout(()=>{throw V},0)}})};return D(f,Ih.EventType.OPEN,()=>{x||(Oe(qs,`RPC '${e}' stream ${i} transport opened.`),I.o_())}),D(f,Ih.EventType.CLOSE,()=>{x||(x=!0,Oe(qs,`RPC '${e}' stream ${i} transport closed`),I.a_(),this.E_(f))}),D(f,Ih.EventType.ERROR,A=>{x||(x=!0,Hd(qs,`RPC '${e}' stream ${i} transport errored. Name:`,A.name,"Message:",A.message),I.a_(new Ue(we.UNAVAILABLE,"The operation could not be completed")))}),D(f,Ih.EventType.MESSAGE,A=>{var g;if(!x){const N=A.data[0];nt(!!N,16349);const j=N,V=(j==null?void 0:j.error)||((g=j[0])==null?void 0:g.error);if(V){Oe(qs,`RPC '${e}' stream ${i} received error:`,V);const $=V.status;let Z=function(T){const L=as[T];if(L!==void 0)return h2(L)}($),O=V.message;Z===void 0&&(Z=we.INTERNAL,O="Unknown error status: "+$+" with message "+V.message),x=!0,I.a_(new Ue(Z,O)),f.close()}else Oe(qs,`RPC '${e}' stream ${i} received:`,N),I.u_(N)}}),D(l,lA.STAT_EVENT,A=>{A.stat===M0.PROXY?Oe(qs,`RPC '${e}' stream ${i} detected buffering proxy`):A.stat===M0.NOPROXY&&Oe(qs,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{I.__()},0),I}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z2(){return typeof window<"u"?window:null}function Kp(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qx(n){return new TF(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rN{constructor(e,t,s=1e3,i=1.5,a=6e4){this.Mi=e,this.timerId=t,this.d_=s,this.A_=i,this.R_=a,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-s);i>0&&Oe("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PS="PersistentStream";class eD{constructor(e,t,s,i,a,o,l,c){this.Mi=e,this.S_=s,this.b_=i,this.connection=a,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new rN(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===we.RESOURCE_EXHAUSTED?(rs(t.toString()),rs("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===we.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,i])=>{this.D_===t&&this.G_(s,i)},s=>{e(()=>{const i=new Ue(we.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(i)})})}G_(e,t){const s=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{s(()=>this.listener.Xo())}),this.stream.t_(()=>{s(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(i=>{s(()=>this.z_(i))}),this.stream.onMessage(i=>{s(()=>++this.F_==1?this.J_(i):this.onNext(i))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return Oe(PS,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(Oe(PS,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class _U extends eD{constructor(e,t,s,i,a,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,i,o),this.serializer=a}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=RF(this.serializer,e),s=function(a){if(!("targetChange"in a))return rt.min();const o=a.targetChange;return o.targetIds&&o.targetIds.length?rt.min():o.readTime?Ds(o.readTime):rt.min()}(e);return this.listener.H_(t,s)}Y_(e){const t={};t.database=X0(this.serializer),t.addTarget=function(a,o){let l;const c=o.target;if(l=Ug(c)?{documents:w2(a,c)}:{query:v2(a,c).ft},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=p2(a,o.resumeToken);const d=K0(a,o.expectedCount);d!==null&&(l.expectedCount=d)}else if(o.snapshotVersion.compareTo(rt.min())>0){l.readTime=au(a,o.snapshotVersion.toTimestamp());const d=K0(a,o.expectedCount);d!==null&&(l.expectedCount=d)}return l}(this.serializer,e);const s=kF(this.serializer,e);s&&(t.labels=s),this.q_(t)}Z_(e){const t={};t.database=X0(this.serializer),t.removeTarget=e,this.q_(t)}}class EU extends eD{constructor(e,t,s,i,a,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,i,o),this.serializer=a}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return nt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,nt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){nt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=PF(e.writeResults,e.commitTime),s=Ds(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=X0(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(s=>Lm(this.serializer,s))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SU{}class IU extends SU{constructor(e,t,s,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Ue(we.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.Go(e,Y0(t,s),i,a,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===we.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new Ue(we.UNKNOWN,a.toString())})}Ho(e,t,s,i,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Ho(e,Y0(t,s),i,o,l,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===we.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Ue(we.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class TU{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(rs(t),this.aa=!1):Oe("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xc="RemoteStore";class CU{constructor(e,t,s,i,a){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=a,this.Aa.Oo(o=>{s.enqueueAndForget(async()=>{Ec(this)&&(Oe(xc,"Restarting streams for network reachability change."),await async function(c){const d=tt(c);d.Ea.add(4),await bf(d),d.Ra.set("Unknown"),d.Ea.delete(4),await Hx(d)}(this))})}),this.Ra=new TU(s,i)}}async function Hx(n){if(Ec(n))for(const e of n.da)await e(!0)}async function bf(n){for(const e of n.da)await e(!1)}function Gx(n,e){const t=tt(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),oN(t)?aN(t):Iu(t).O_()&&iN(t,e))}function lu(n,e){const t=tt(n),s=Iu(t);t.Ia.delete(e),s.O_()&&tD(t,e),t.Ia.size===0&&(s.O_()?s.L_():Ec(t)&&t.Ra.set("Unknown"))}function iN(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(rt.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Iu(n).Y_(e)}function tD(n,e){n.Va.Ue(e),Iu(n).Z_(e)}function aN(n){n.Va=new _F({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Iu(n).start(),n.Ra.ua()}function oN(n){return Ec(n)&&!Iu(n).x_()&&n.Ia.size>0}function Ec(n){return tt(n).Ea.size===0}function nD(n){n.Va=void 0}async function AU(n){n.Ra.set("Online")}async function DU(n){n.Ia.forEach((e,t)=>{iN(n,e)})}async function RU(n,e){nD(n),oN(n)?(n.Ra.ha(e),aN(n)):n.Ra.set("Unknown")}async function PU(n,e,t){if(n.Ra.set("Online"),e instanceof f2&&e.state===2&&e.cause)try{await async function(i,a){const o=a.cause;for(const l of a.targetIds)i.Ia.has(l)&&(await i.remoteSyncer.rejectListen(l,o),i.Ia.delete(l),i.Va.removeTarget(l))}(n,e)}catch(s){Oe(xc,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await Kg(n,s)}else if(e instanceof Qp?n.Va.Ze(e):e instanceof m2?n.Va.st(e):n.Va.tt(e),!t.isEqual(rt.min()))try{const s=await H2(n.localStore);t.compareTo(s)>=0&&await function(a,o){const l=a.Va.Tt(o);return l.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){const h=a.Ia.get(d);h&&a.Ia.set(d,h.withResumeToken(c.resumeToken,o))}}),l.targetMismatches.forEach((c,d)=>{const h=a.Ia.get(c);if(!h)return;a.Ia.set(c,h.withResumeToken(is.EMPTY_BYTE_STRING,h.snapshotVersion)),tD(a,c);const f=new _a(h.target,c,d,h.sequenceNumber);iN(a,f)}),a.remoteSyncer.applyRemoteEvent(l)}(n,t)}catch(s){Oe(xc,"Failed to raise snapshot:",s),await Kg(n,s)}}async function Kg(n,e,t){if(!ol(e))throw e;n.Ea.add(1),await bf(n),n.Ra.set("Offline"),t||(t=()=>H2(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Oe(xc,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Hx(n)})}function sD(n,e){return e().catch(t=>Kg(n,t,e))}async function Su(n){const e=tt(n),t=nl(e);let s=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:nc;for(;kU(e);)try{const i=await yU(e.localStore,s);if(i===null){e.Ta.length===0&&t.L_();break}s=i.batchId,OU(e,i)}catch(i){await Kg(e,i)}rD(e)&&iD(e)}function kU(n){return Ec(n)&&n.Ta.length<10}function OU(n,e){n.Ta.push(e);const t=nl(n);t.O_()&&t.X_&&t.ea(e.mutations)}function rD(n){return Ec(n)&&!nl(n).x_()&&n.Ta.length>0}function iD(n){nl(n).start()}async function MU(n){nl(n).ra()}async function LU(n){const e=nl(n);for(const t of n.Ta)e.ea(t.mutations)}async function FU(n,e,t){const s=n.Ta.shift(),i=Gv.from(s,e,t);await sD(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),await Su(n)}async function UU(n,e){e&&nl(n).X_&&await async function(s,i){if(function(o){return u2(o)&&o!==we.ABORTED}(i.code)){const a=s.Ta.shift();nl(s).B_(),await sD(s,()=>s.remoteSyncer.rejectFailedWrite(a.batchId,i)),await Su(s)}}(n,e),rD(n)&&iD(n)}async function kS(n,e){const t=tt(n);t.asyncQueue.verifyOperationInProgress(),Oe(xc,"RemoteStore received new credentials");const s=Ec(t);t.Ea.add(3),await bf(t),s&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Hx(t)}async function iw(n,e){const t=tt(n);e?(t.Ea.delete(2),await Hx(t)):e||(t.Ea.add(2),await bf(t),t.Ra.set("Unknown"))}function Iu(n){return n.ma||(n.ma=function(t,s,i){const a=tt(t);return a.sa(),new _U(s,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,i)}(n.datastore,n.asyncQueue,{Xo:AU.bind(null,n),t_:DU.bind(null,n),r_:RU.bind(null,n),H_:PU.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),oN(n)?aN(n):n.Ra.set("Unknown")):(await n.ma.stop(),nD(n))})),n.ma}function nl(n){return n.fa||(n.fa=function(t,s,i){const a=tt(t);return a.sa(),new EU(s,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,i)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:MU.bind(null,n),r_:UU.bind(null,n),ta:LU.bind(null,n),na:FU.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await Su(n)):(await n.fa.stop(),n.Ta.length>0&&(Oe(xc,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lN{constructor(e,t,s,i,a){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=i,this.removalCallback=a,this.deferred=new yi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,i,a){const o=Date.now()+s,l=new lN(e,t,o,i,a);return l.start(s),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ue(we.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function cN(n,e){if(rs("AsyncQueue",`${e}: ${n}`),ol(n))return new Ue(we.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Id{static emptySet(e){return new Id(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||Ge.comparator(t.key,s.key):(t,s)=>Ge.comparator(t.key,s.key),this.keyedMap=Th(),this.sortedSet=new wn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,s)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Id)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,a=s.getNext().key;if(!i.isEqual(a))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new Id;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OS{constructor(){this.ga=new wn(Ge.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Je(63341,{Rt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,s)=>{e.push(s)}),e}}class cu{constructor(e,t,s,i,a,o,l,c,d){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=i,this.mutatedKeys=a,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(e,t,s,i,a){const o=[];return t.forEach(l=>{o.push({type:0,doc:l})}),new cu(e,t,Id.emptySet(t),o,s,i,!0,!1,a)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Fx(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==s[i].type||!t[i].doc.isEqual(s[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VU{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class zU{constructor(){this.queries=MS(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const i=tt(t),a=i.queries;i.queries=MS(),a.forEach((o,l)=>{for(const c of l.Sa)c.onError(s)})})(this,new Ue(we.ABORTED,"Firestore shutting down"))}}function MS(){return new Wa(n=>XA(n),Fx)}async function dN(n,e){const t=tt(n);let s=3;const i=e.query;let a=t.queries.get(i);a?!a.ba()&&e.Da()&&(s=2):(a=new VU,s=e.Da()?0:1);try{switch(s){case 0:a.wa=await t.onListen(i,!0);break;case 1:a.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(o){const l=cN(o,`Initialization of query '${Zc(e.query)}' failed`);return void e.onError(l)}t.queries.set(i,a),a.Sa.push(e),e.va(t.onlineState),a.wa&&e.Fa(a.wa)&&hN(t)}async function uN(n,e){const t=tt(n),s=e.query;let i=3;const a=t.queries.get(s);if(a){const o=a.Sa.indexOf(e);o>=0&&(a.Sa.splice(o,1),a.Sa.length===0?i=e.Da()?0:1:!a.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function $U(n,e){const t=tt(n);let s=!1;for(const i of e){const a=i.query,o=t.queries.get(a);if(o){for(const l of o.Sa)l.Fa(i)&&(s=!0);o.wa=i}}s&&hN(t)}function BU(n,e,t){const s=tt(n),i=s.queries.get(e);if(i)for(const a of i.Sa)a.onError(t);s.queries.delete(e)}function hN(n){n.Ca.forEach(e=>{e.next()})}var aw,LS;(LS=aw||(aw={})).Ma="default",LS.Cache="cache";class mN{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const i of e.docChanges)i.type!==3&&s.push(i);e=new cu(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.qa||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=cu.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==aw.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aD{constructor(e){this.key=e}}class oD{constructor(e){this.key=e}}class qU{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=jt(),this.mutatedKeys=jt(),this.eu=ZA(e),this.tu=new Id(this.eu)}get nu(){return this.Ya}ru(e,t){const s=t?t.iu:new OS,i=t?t.tu:this.tu;let a=t?t.mutatedKeys:this.mutatedKeys,o=i,l=!1;const c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((h,f)=>{const p=i.get(h),x=gf(this.query,f)?f:null,I=!!p&&this.mutatedKeys.has(p.key),D=!!x&&(x.hasLocalMutations||this.mutatedKeys.has(x.key)&&x.hasCommittedMutations);let A=!1;p&&x?p.data.isEqual(x.data)?I!==D&&(s.track({type:3,doc:x}),A=!0):this.su(p,x)||(s.track({type:2,doc:x}),A=!0,(c&&this.eu(x,c)>0||d&&this.eu(x,d)<0)&&(l=!0)):!p&&x?(s.track({type:0,doc:x}),A=!0):p&&!x&&(s.track({type:1,doc:p}),A=!0,(c||d)&&(l=!0)),A&&(x?(o=o.add(x),a=D?a.add(h):a.delete(h)):(o=o.delete(h),a=a.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),a=a.delete(h.key),s.track({type:1,doc:h})}return{tu:o,iu:s,Cs:l,mutatedKeys:a}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,i){const a=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((h,f)=>function(x,I){const D=A=>{switch(A){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Je(20277,{Rt:A})}};return D(x)-D(I)}(h.type,f.type)||this.eu(h.doc,f.doc)),this.ou(s),i=i??!1;const l=t&&!i?this._u():[],c=this.Xa.size===0&&this.current&&!i?1:0,d=c!==this.Za;return this.Za=c,o.length!==0||d?{snapshot:new cu(this.query,e.tu,a,o,e.mutatedKeys,c===0,d,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new OS,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=jt(),this.tu.forEach(s=>{this.uu(s.key)&&(this.Xa=this.Xa.add(s.key))});const t=[];return e.forEach(s=>{this.Xa.has(s)||t.push(new oD(s))}),this.Xa.forEach(s=>{e.has(s)||t.push(new aD(s))}),t}cu(e){this.Ya=e.Qs,this.Xa=jt();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return cu.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Tu="SyncEngine";class HU{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class GU{constructor(e){this.key=e,this.hu=!1}}class QU{constructor(e,t,s,i,a,o){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Wa(l=>XA(l),Fx),this.Iu=new Map,this.Eu=new Set,this.du=new wn(Ge.comparator),this.Au=new Map,this.Ru=new Jv,this.Vu={},this.mu=new Map,this.fu=gc.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function WU(n,e,t=!0){const s=Qx(n);let i;const a=s.Tu.get(e);return a?(s.sharedClientState.addLocalQueryTarget(a.targetId),i=a.view.lu()):i=await lD(s,e,t,!0),i}async function KU(n,e){const t=Qx(n);await lD(t,e,!0,!1)}async function lD(n,e,t,s){const i=await Gg(n.localStore,Vr(e)),a=i.targetId,o=n.sharedClientState.addLocalQueryTarget(a,t);let l;return s&&(l=await fN(n,e,a,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Gx(n.remoteStore,i),l}async function fN(n,e,t,s,i){n.pu=(f,p,x)=>async function(D,A,g,N){let j=A.view.ru(g);j.Cs&&(j=await nw(D.localStore,A.query,!1).then(({documents:O})=>A.view.ru(O,j)));const V=N&&N.targetChanges.get(A.targetId),$=N&&N.targetMismatches.get(A.targetId)!=null,Z=A.view.applyChanges(j,D.isPrimaryClient,V,$);return ow(D,A.targetId,Z.au),Z.snapshot}(n,f,p,x);const a=await nw(n.localStore,e,!0),o=new qU(e,a.Qs),l=o.ru(a.documents),c=yf.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",i),d=o.applyChanges(l,n.isPrimaryClient,c);ow(n,t,d.au);const h=new HU(e,t,o);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot}async function YU(n,e,t){const s=tt(n),i=s.Tu.get(e),a=s.Iu.get(i.targetId);if(a.length>1)return s.Iu.set(i.targetId,a.filter(o=>!Fx(o,e))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(i.targetId),s.sharedClientState.isActiveQueryTarget(i.targetId)||await ou(s.localStore,i.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(i.targetId),t&&lu(s.remoteStore,i.targetId),du(s,i.targetId)}).catch(al)):(du(s,i.targetId),await ou(s.localStore,i.targetId,!0))}async function XU(n,e){const t=tt(n),s=t.Tu.get(e),i=t.Iu.get(s.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),lu(t.remoteStore,s.targetId))}async function JU(n,e,t){const s=yN(n);try{const i=await function(o,l){const c=tt(o),d=Gt.now(),h=l.reduce((x,I)=>x.add(I.key),jt());let f,p;return c.persistence.runTransaction("Locally write mutations","readwrite",x=>{let I=kr(),D=jt();return c.Ns.getEntries(x,h).next(A=>{I=A,I.forEach((g,N)=>{N.isValidDocument()||(D=D.add(g))})}).next(()=>c.localDocuments.getOverlayedDocuments(x,I)).next(A=>{f=A;const g=[];for(const N of l){const j=wF(N,f.get(N.key).overlayedDocument);j!=null&&g.push(new Ka(N.key,j,zA(j.value.mapValue),Rn.exists(!0)))}return c.mutationQueue.addMutationBatch(x,d,g,l)}).next(A=>{p=A;const g=A.applyToLocalDocumentSet(f,D);return c.documentOverlayCache.saveOverlays(x,A.batchId,g)})}).then(()=>({batchId:p.batchId,changes:t2(f)}))}(s.localStore,e);s.sharedClientState.addPendingMutation(i.batchId),function(o,l,c){let d=o.Vu[o.currentUser.toKey()];d||(d=new wn(ft)),d=d.insert(l,c),o.Vu[o.currentUser.toKey()]=d}(s,i.batchId,t),await cl(s,i.changes),await Su(s.remoteStore)}catch(i){const a=cN(i,"Failed to persist write");t.reject(a)}}async function cD(n,e){const t=tt(n);try{const s=await gU(t.localStore,e);e.targetChanges.forEach((i,a)=>{const o=t.Au.get(a);o&&(nt(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.hu=!0:i.modifiedDocuments.size>0?nt(o.hu,14607):i.removedDocuments.size>0&&(nt(o.hu,42227),o.hu=!1))}),await cl(t,s,e)}catch(s){await al(s)}}function FS(n,e,t){const s=tt(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const i=[];s.Tu.forEach((a,o)=>{const l=o.view.va(e);l.snapshot&&i.push(l.snapshot)}),function(o,l){const c=tt(o);c.onlineState=l;let d=!1;c.queries.forEach((h,f)=>{for(const p of f.Sa)p.va(l)&&(d=!0)}),d&&hN(c)}(s.eventManager,e),i.length&&s.Pu.H_(i),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function ZU(n,e,t){const s=tt(n);s.sharedClientState.updateQueryState(e,"rejected",t);const i=s.Au.get(e),a=i&&i.key;if(a){let o=new wn(Ge.comparator);o=o.insert(a,Dn.newNoDocument(a,rt.min()));const l=jt().add(a),c=new xf(rt.min(),new Map,new wn(ft),o,l);await cD(s,c),s.du=s.du.remove(a),s.Au.delete(e),xN(s)}else await ou(s.localStore,e,!1).then(()=>du(s,e,t)).catch(al)}async function e6(n,e){const t=tt(n),s=e.batch.batchId;try{const i=await pU(t.localStore,e);gN(t,s,null),pN(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),await cl(t,i)}catch(i){await al(i)}}async function t6(n,e,t){const s=tt(n);try{const i=await function(o,l){const c=tt(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let h;return c.mutationQueue.lookupMutationBatch(d,l).next(f=>(nt(f!==null,37113),h=f.keys(),c.mutationQueue.removeMutationBatch(d,f))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,h,l)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,h)).next(()=>c.localDocuments.getDocuments(d,h))})}(s.localStore,e);gN(s,e,t),pN(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),await cl(s,i)}catch(i){await al(i)}}function pN(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function gN(n,e,t){const s=tt(n);let i=s.Vu[s.currentUser.toKey()];if(i){const a=i.get(e);a&&(t?a.reject(t):a.resolve(),i=i.remove(e)),s.Vu[s.currentUser.toKey()]=i}}function du(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(s=>{n.Ru.containsKey(s)||dD(n,s)})}function dD(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(lu(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),xN(n))}function ow(n,e,t){for(const s of t)s instanceof aD?(n.Ru.addReference(s.key,e),n6(n,s)):s instanceof oD?(Oe(Tu,"Document no longer in limbo: "+s.key),n.Ru.removeReference(s.key,e),n.Ru.containsKey(s.key)||dD(n,s.key)):Je(19791,{wu:s})}function n6(n,e){const t=e.key,s=t.path.canonicalString();n.du.get(t)||n.Eu.has(s)||(Oe(Tu,"New document in limbo: "+t),n.Eu.add(s),xN(n))}function xN(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new Ge(Vt.fromString(e)),s=n.fu.next();n.Au.set(s,new GU(t)),n.du=n.du.insert(t,s),Gx(n.remoteStore,new _a(Vr(pf(t.path)),s,"TargetPurposeLimboResolution",yr.ce))}}async function cl(n,e,t){const s=tt(n),i=[],a=[],o=[];s.Tu.isEmpty()||(s.Tu.forEach((l,c)=>{o.push(s.pu(c,e,t).then(d=>{var h;if((d||t)&&s.isPrimaryClient){const f=d?!d.fromCache:(h=t==null?void 0:t.targetChanges.get(c.targetId))==null?void 0:h.current;s.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(d){i.push(d);const f=tN.As(c.targetId,d);a.push(f)}}))}),await Promise.all(o),s.Pu.H_(i),await async function(c,d){const h=tt(c);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>he.forEach(d,p=>he.forEach(p.Es,x=>h.persistence.referenceDelegate.addReference(f,p.targetId,x)).next(()=>he.forEach(p.ds,x=>h.persistence.referenceDelegate.removeReference(f,p.targetId,x)))))}catch(f){if(!ol(f))throw f;Oe(nN,"Failed to update sequence numbers: "+f)}for(const f of d){const p=f.targetId;if(!f.fromCache){const x=h.Ms.get(p),I=x.snapshotVersion,D=x.withLastLimboFreeSnapshotVersion(I);h.Ms=h.Ms.insert(p,D)}}}(s.localStore,a))}async function s6(n,e){const t=tt(n);if(!t.currentUser.isEqual(e)){Oe(Tu,"User change. New user:",e.toKey());const s=await q2(t.localStore,e);t.currentUser=e,function(a,o){a.mu.forEach(l=>{l.forEach(c=>{c.reject(new Ue(we.CANCELLED,o))})}),a.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await cl(t,s.Ls)}}function r6(n,e){const t=tt(n),s=t.Au.get(e);if(s&&s.hu)return jt().add(s.key);{let i=jt();const a=t.Iu.get(e);if(!a)return i;for(const o of a){const l=t.Tu.get(o);i=i.unionWith(l.view.nu)}return i}}async function i6(n,e){const t=tt(n),s=await nw(t.localStore,e.query,!0),i=e.view.cu(s);return t.isPrimaryClient&&ow(t,e.targetId,i.au),i}async function a6(n,e){const t=tt(n);return Q2(t.localStore,e).then(s=>cl(t,s))}async function o6(n,e,t,s){const i=tt(n),a=await function(l,c){const d=tt(l),h=tt(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.er(f,c).next(p=>p?d.localDocuments.getDocuments(f,p):he.resolve(null)))}(i.localStore,e);a!==null?(t==="pending"?await Su(i.remoteStore):t==="acknowledged"||t==="rejected"?(gN(i,e,s||null),pN(i,e),function(l,c){tt(tt(l).mutationQueue).ir(c)}(i.localStore,e)):Je(6720,"Unknown batchState",{Su:t}),await cl(i,a)):Oe(Tu,"Cannot apply mutation batch with id: "+e)}async function l6(n,e){const t=tt(n);if(Qx(t),yN(t),e===!0&&t.gu!==!0){const s=t.sharedClientState.getAllActiveQueryTargets(),i=await US(t,s.toArray());t.gu=!0,await iw(t.remoteStore,!0);for(const a of i)Gx(t.remoteStore,a)}else if(e===!1&&t.gu!==!1){const s=[];let i=Promise.resolve();t.Iu.forEach((a,o)=>{t.sharedClientState.isLocalQueryTarget(o)?s.push(o):i=i.then(()=>(du(t,o),ou(t.localStore,o,!0))),lu(t.remoteStore,o)}),await i,await US(t,s),function(o){const l=tt(o);l.Au.forEach((c,d)=>{lu(l.remoteStore,d)}),l.Ru.Jr(),l.Au=new Map,l.du=new wn(Ge.comparator)}(t),t.gu=!1,await iw(t.remoteStore,!1)}}async function US(n,e,t){const s=tt(n),i=[],a=[];for(const o of e){let l;const c=s.Iu.get(o);if(c&&c.length!==0){l=await Gg(s.localStore,Vr(c[0]));for(const d of c){const h=s.Tu.get(d),f=await i6(s,h);f.snapshot&&a.push(f.snapshot)}}else{const d=await G2(s.localStore,o);l=await Gg(s.localStore,d),await fN(s,uD(d),o,!1,l.resumeToken)}i.push(l)}return s.Pu.H_(a),i}function uD(n){return KA(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function c6(n){return function(t){return tt(tt(t).persistence).Ts()}(tt(n).localStore)}async function d6(n,e,t,s){const i=tt(n);if(i.gu)return void Oe(Tu,"Ignoring unexpected query state notification.");const a=i.Iu.get(e);if(a&&a.length>0)switch(t){case"current":case"not-current":{const o=await Q2(i.localStore,JA(a[0])),l=xf.createSynthesizedRemoteEventForCurrentChange(e,t==="current",is.EMPTY_BYTE_STRING);await cl(i,o,l);break}case"rejected":await ou(i.localStore,e,!0),du(i,e,s);break;default:Je(64155,t)}}async function u6(n,e,t){const s=Qx(n);if(s.gu){for(const i of e){if(s.Iu.has(i)&&s.sharedClientState.isActiveQueryTarget(i)){Oe(Tu,"Adding an already active target "+i);continue}const a=await G2(s.localStore,i),o=await Gg(s.localStore,a);await fN(s,uD(a),o.targetId,!1,o.resumeToken),Gx(s.remoteStore,o)}for(const i of t)s.Iu.has(i)&&await ou(s.localStore,i,!1).then(()=>{lu(s.remoteStore,i),du(s,i)}).catch(al)}}function Qx(n){const e=tt(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=cD.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=r6.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ZU.bind(null,e),e.Pu.H_=$U.bind(null,e.eventManager),e.Pu.yu=BU.bind(null,e.eventManager),e}function yN(n){const e=tt(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=e6.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=t6.bind(null,e),e}class Fm{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=qx(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return B2(this.persistence,new $2,e.initialUser,this.serializer)}Cu(e){return new Zv(Bx.mi,this.serializer)}Du(e){return new J2}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Fm.provider={build:()=>new Fm};class h6 extends Fm{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){nt(this.persistence.referenceDelegate instanceof Hg,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new M2(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Hs.withCacheSize(this.cacheSizeBytes):Hs.DEFAULT;return new Zv(s=>Hg.mi(s,t),this.serializer)}}class hD extends Fm{constructor(e,t,s){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=s,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await yN(this.xu.syncEngine),await Su(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return B2(this.persistence,new $2,e.initialUser,this.serializer)}Fu(e,t){const s=this.persistence.referenceDelegate.garbageCollector;return new M2(s,e.asyncQueue,t)}Mu(e,t){const s=new _4(t,this.persistence);return new j4(e.asyncQueue,s)}Cu(e){const t=z2(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),s=this.cacheSizeBytes!==void 0?Hs.withCacheSize(this.cacheSizeBytes):Hs.DEFAULT;return new eN(this.synchronizeTabs,t,e.clientId,s,e.asyncQueue,Z2(),Kp(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new J2}}class m6 extends hD{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof vb&&(this.sharedClientState.syncEngine={Co:o6.bind(null,t),vo:d6.bind(null,t),Fo:u6.bind(null,t),Ts:c6.bind(null,t),Do:a6.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async s=>{await l6(this.xu.syncEngine,s),this.gcScheduler&&(s&&!this.gcScheduler.started?this.gcScheduler.start():s||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(s&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():s||this.indexBackfillerScheduler.stop())})}Du(e){const t=Z2();if(!vb.v(t))throw new Ue(we.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const s=z2(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new vb(t,e.asyncQueue,s,e.clientId,e.initialUser)}}class Um{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>FS(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=s6.bind(null,this.syncEngine),await iw(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new zU}()}createDatastore(e){const t=qx(e.databaseInfo.databaseId),s=function(a){return new jU(a)}(e.databaseInfo);return function(a,o,l,c){return new IU(a,o,l,c)}(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return function(s,i,a,o,l){return new CU(s,i,a,o,l)}(this.localStore,this.datastore,e.asyncQueue,t=>FS(this.syncEngine,t,0),function(){return RS.v()?new RS:new bU}())}createSyncEngine(e,t){return function(i,a,o,l,c,d,h){const f=new QU(i,a,o,l,c,d);return h&&(f.gu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(i){const a=tt(i);Oe(xc,"RemoteStore shutting down."),a.Ea.add(5),await bf(a),a.Aa.shutdown(),a.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}Um.provider={build:()=>new Um};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bN{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):rs("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f6{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new Ue(we.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(i,a){const o=tt(i),l={documents:a.map(f=>Mm(o.serializer,f))},c=await o.Ho("BatchGetDocuments",o.serializer.databaseId,Vt.emptyPath(),l,a.length),d=new Map;c.forEach(f=>{const p=DF(o.serializer,f);d.set(p.key.toString(),p)});const h=[];return a.forEach(f=>{const p=d.get(f.toString());nt(!!p,55234,{key:f}),h.push(p)}),h}(this.datastore,e);return t.forEach(s=>this.recordVersion(s)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(s){this.lastTransactionError=s}this.writtenDocs.add(e.toString())}delete(e){this.write(new Eu(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,s)=>{const i=Ge.fromPath(s);this.mutations.push(new qv(i,this.precondition(i)))}),await async function(s,i){const a=tt(s),o={writes:i.map(l=>Lm(a.serializer,l))};await a.Go("Commit",a.serializer.databaseId,Vt.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Je(50498,{Gu:e.constructor.name});t=rt.min()}const s=this.readVersions.get(e.key.toString());if(s){if(!t.isEqual(s))throw new Ue(we.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(rt.min())?Rn.exists(!1):Rn.updateTime(t):Rn.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(rt.min()))throw new Ue(we.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Rn.updateTime(t)}return Rn.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p6{constructor(e,t,s,i,a){this.asyncQueue=e,this.datastore=t,this.options=s,this.updateFunction=i,this.deferred=a,this.zu=s.maxAttempts,this.M_=new rN(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(async()=>{const e=new f6(this.datastore),t=this.Hu(e);t&&t.then(s=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(s)}).catch(i=>{this.Yu(i)}))}).catch(s=>{this.Yu(s)})})}Hu(e){try{const t=this.updateFunction(e);return!hf(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!u2(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sl="FirestoreClient";class g6{constructor(e,t,s,i,a){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=i,this.user=Is.UNAUTHENTICATED,this.clientId=Av.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=a,this.authCredentials.start(s,async o=>{Oe(sl,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(s,o=>(Oe(sl,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new yi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=cN(t,"Failed to shutdown persistence");e.reject(s)}}),e.promise}}async function jb(n,e){n.asyncQueue.verifyOperationInProgress(),Oe(sl,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener(async i=>{s.isEqual(i)||(await q2(e.localStore,i),s=i)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function VS(n,e){n.asyncQueue.verifyOperationInProgress();const t=await x6(n);Oe(sl,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(s=>kS(e.remoteStore,s)),n.setAppCheckTokenChangeListener((s,i)=>kS(e.remoteStore,i)),n._onlineComponents=e}async function x6(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Oe(sl,"Using user provided OfflineComponentProvider");try{await jb(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(i){return i.name==="FirebaseError"?i.code===we.FAILED_PRECONDITION||i.code===we.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;Hd("Error using user provided cache. Falling back to memory cache: "+t),await jb(n,new Fm)}}else Oe(sl,"Using default OfflineComponentProvider"),await jb(n,new h6(void 0));return n._offlineComponents}async function wN(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Oe(sl,"Using user provided OnlineComponentProvider"),await VS(n,n._uninitializedComponentsProvider._online)):(Oe(sl,"Using default OnlineComponentProvider"),await VS(n,new Um))),n._onlineComponents}function y6(n){return wN(n).then(e=>e.syncEngine)}function b6(n){return wN(n).then(e=>e.datastore)}async function Yg(n){const e=await wN(n),t=e.eventManager;return t.onListen=WU.bind(null,e.syncEngine),t.onUnlisten=YU.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=KU.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=XU.bind(null,e.syncEngine),t}function w6(n,e,t={}){const s=new yi;return n.asyncQueue.enqueueAndForget(async()=>function(a,o,l,c,d){const h=new bN({next:p=>{h.Nu(),o.enqueueAndForget(()=>uN(a,f));const x=p.docs.has(l);!x&&p.fromCache?d.reject(new Ue(we.UNAVAILABLE,"Failed to get document because the client is offline.")):x&&p.fromCache&&c&&c.source==="server"?d.reject(new Ue(we.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(p)},error:p=>d.reject(p)}),f=new mN(pf(l.path),h,{includeMetadataChanges:!0,qa:!0});return dN(a,f)}(await Yg(n),n.asyncQueue,e,t,s)),s.promise}function v6(n,e,t={}){const s=new yi;return n.asyncQueue.enqueueAndForget(async()=>function(a,o,l,c,d){const h=new bN({next:p=>{h.Nu(),o.enqueueAndForget(()=>uN(a,f)),p.fromCache&&c.source==="server"?d.reject(new Ue(we.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(p)},error:p=>d.reject(p)}),f=new mN(l,h,{includeMetadataChanges:!0,qa:!0});return dN(a,f)}(await Yg(n),n.asyncQueue,e,t,s)),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mD(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zS=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fD="firestore.googleapis.com",$S=!0;class BS{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Ue(we.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=fD,this.ssl=$S}else this.host=e.host,this.ssl=e.ssl??$S;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=D2;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<O2)throw new Ue(we.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}b4("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=mD(e.experimentalLongPollingOptions??{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new Ue(we.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new Ue(we.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new Ue(we.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(s,i){return s.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Wx{constructor(e,t,s,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new BS({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ue(we.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Ue(we.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new BS(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new c4;switch(s.type){case"firstParty":return new m4(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new Ue(we.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const s=zS.get(t);s&&(Oe("ComponentProvider","Removing Datastore"),zS.delete(t),s.terminate())}(this),Promise.resolve()}}function N6(n,e,t,s={}){var d;n=Ws(n,Wx);const i=Qa(e),a=n._getSettings(),o={...a,emulatorOptions:n._getEmulatorOptions()},l=`${e}:${t}`;i&&(Ax(`https://${l}`),_v("Firestore",!0)),a.host!==fD&&a.host!==l&&Hd("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...a,host:l,ssl:i,emulatorOptions:s};if(!Jo(c,o)&&(n._setSettings(c),s.mockUserToken)){let h,f;if(typeof s.mockUserToken=="string")h=s.mockUserToken,f=Is.MOCK_USER;else{h=YC(s.mockUserToken,(d=n._app)==null?void 0:d.options.projectId);const p=s.mockUserToken.sub||s.mockUserToken.user_id;if(!p)throw new Ue(we.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Is(p)}n._authCredentials=new d4(new hA(h,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ya{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new Ya(this.firestore,e,this._query)}}class Vn{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Qo(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Vn(this.firestore,e,this._key)}toJSON(){return{type:Vn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(uf(t,Vn._jsonSchema))return new Vn(e,s||null,new Ge(Vt.fromString(t.referencePath)))}}Vn._jsonSchemaVersion="firestore/documentReference/1.0",Vn._jsonSchema={type:ls("string",Vn._jsonSchemaVersion),referencePath:ls("string")};class Qo extends Ya{constructor(e,t,s){super(e,t,pf(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Vn(this.firestore,null,new Ge(e))}withConverter(e){return new Qo(this.firestore,e,this._path)}}function Qe(n,e,...t){if(n=mn(n),fA("collection","path",e),n instanceof Wx){const s=Vt.fromString(e,...t);return PE(s),new Qo(n,null,s)}{if(!(n instanceof Vn||n instanceof Qo))throw new Ue(we.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(Vt.fromString(e,...t));return PE(s),new Qo(n.firestore,null,s)}}function Ye(n,e,...t){if(n=mn(n),arguments.length===1&&(e=Av.newId()),fA("doc","path",e),n instanceof Wx){const s=Vt.fromString(e,...t);return RE(s),new Vn(n,null,new Ge(s))}{if(!(n instanceof Vn||n instanceof Qo))throw new Ue(we.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(Vt.fromString(e,...t));return RE(s),new Vn(n.firestore,n instanceof Qo?n.converter:null,new Ge(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qS="AsyncQueue";class HS{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new rN(this,"async_queue_retry"),this._c=()=>{const s=Kp();s&&Oe(qS,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=Kp();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Kp();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new yi;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!ol(e))throw e;Oe(qS,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(s=>{throw this.nc=s,this.rc=!1,rs("INTERNAL UNHANDLED ERROR: ",GS(s)),s}).then(s=>(this.rc=!1,s))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=lN.createAndSchedule(this,e,t,s,a=>this.hc(a));return this.tc.push(i),i}uc(){this.nc&&Je(47125,{Pc:GS(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,s)=>t.targetTimeMs-s.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function GS(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QS(n){return function(t,s){if(typeof t!="object"||t===null)return!1;const i=t;for(const a of s)if(a in i&&typeof i[a]=="function")return!0;return!1}(n,["next","error","complete"])}class bi extends Wx{constructor(e,t,s,i){super(e,t,s,i),this.type="firestore",this._queue=new HS,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new HS(e),this._firestoreClient=void 0,await e}}}function j6(n,e,t){t||(t=Dm);const s=df(n,"firestore");if(s.isInitialized(t)){const i=s.getImmediate({identifier:t}),a=s.getOptions(t);if(Jo(a,e))return i;throw new Ue(we.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new Ue(we.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<O2)throw new Ue(we.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&Qa(e.host)&&Ax(e.host),s.initialize({options:e,instanceIdentifier:t})}function _6(n,e){const t=typeof n=="object"?n:Tv(),s=typeof n=="string"?n:Dm,i=df(t,"firestore").getImmediate({identifier:s});if(!i._initialized){const a=QC("firestore");a&&N6(i,...a)}return i}function Cu(n){if(n._terminated)throw new Ue(we.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||E6(n),n._firestoreClient}function E6(n){var s,i,a;const e=n._freezeSettings(),t=function(l,c,d,h){return new J4(l,c,d,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,mD(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)}(n._databaseId,((s=n._app)==null?void 0:s.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(i=e.localCache)!=null&&i._offlineComponentProvider&&((a=e.localCache)!=null&&a._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new g6(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(l){const c=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(c),_online:c}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Pr(is.fromBase64String(e))}catch(t){throw new Ue(we.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Pr(is.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Pr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(uf(e,Pr._jsonSchema))return Pr.fromBase64String(e.bytes)}}Pr._jsonSchemaVersion="firestore/bytes/1.0",Pr._jsonSchema={type:ls("string",Pr._jsonSchemaVersion),bytes:ls("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Au{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Ue(we.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Fn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wf{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Ue(we.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Ue(we.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ft(this._lat,e._lat)||ft(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:qi._jsonSchemaVersion}}static fromJSON(e){if(uf(e,qi._jsonSchema))return new qi(e.latitude,e.longitude)}}qi._jsonSchemaVersion="firestore/geoPoint/1.0",qi._jsonSchema={type:ls("string",qi._jsonSchemaVersion),latitude:ls("number"),longitude:ls("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hi{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(s,i){if(s.length!==i.length)return!1;for(let a=0;a<s.length;++a)if(s[a]!==i[a])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Hi._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(uf(e,Hi._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new Hi(e.vectorValues);throw new Ue(we.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Hi._jsonSchemaVersion="firestore/vectorValue/1.0",Hi._jsonSchema={type:ls("string",Hi._jsonSchemaVersion),vectorValues:ls("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S6=/^__.*__$/;class I6{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new Ka(e,this.data,this.fieldMask,t,this.fieldTransforms):new _u(e,this.data,t,this.fieldTransforms)}}class pD{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return new Ka(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function gD(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Je(40011,{Ac:n})}}class vN{constructor(e,t,s,i,a,o){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=i,a===void 0&&this.Rc(),this.fieldTransforms=a||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new vN({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var i;const t=(i=this.path)==null?void 0:i.child(e),s=this.Vc({path:t,fc:!1});return s.gc(e),s}yc(e){var i;const t=(i=this.path)==null?void 0:i.child(e),s=this.Vc({path:t,fc:!1});return s.Rc(),s}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Xg(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(gD(this.Ac)&&S6.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class T6{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||qx(e)}Cc(e,t,s,i=!1){return new vN({Ac:e,methodName:t,Dc:s,path:Fn.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Du(n){const e=n._freezeSettings(),t=qx(n._databaseId);return new T6(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Kx(n,e,t,s,i,a={}){const o=n.Cc(a.merge||a.mergeFields?2:0,e,t,i);SN("Data must be an object, but it was:",o,s);const l=xD(s,o);let c,d;if(a.merge)c=new br(o.fieldMask),d=o.fieldTransforms;else if(a.mergeFields){const h=[];for(const f of a.mergeFields){const p=lw(e,f,t);if(!o.contains(p))throw new Ue(we.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);bD(h,p)||h.push(p)}c=new br(h),d=o.fieldTransforms.filter(f=>c.covers(f.field))}else c=null,d=o.fieldTransforms;return new I6(new Us(l),c,d)}class Yx extends wf{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Yx}}class NN extends wf{_toFieldTransform(e){return new Bv(e.path,new nu)}isEqual(e){return e instanceof NN}}class jN extends wf{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new iu(e.serializer,r2(e.serializer,this.Fc));return new Bv(e.path,t)}isEqual(e){return e instanceof jN&&this.Fc===e.Fc}}function _N(n,e,t,s){const i=n.Cc(1,e,t);SN("Data must be an object, but it was:",i,s);const a=[],o=Us.empty();ll(s,(c,d)=>{const h=IN(e,c,t);d=mn(d);const f=i.yc(h);if(d instanceof Yx)a.push(h);else{const p=vf(d,f);p!=null&&(a.push(h),o.set(h,p))}});const l=new br(a);return new pD(o,l,i.fieldTransforms)}function EN(n,e,t,s,i,a){const o=n.Cc(1,e,t),l=[lw(e,s,t)],c=[i];if(a.length%2!=0)throw new Ue(we.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<a.length;p+=2)l.push(lw(e,a[p])),c.push(a[p+1]);const d=[],h=Us.empty();for(let p=l.length-1;p>=0;--p)if(!bD(d,l[p])){const x=l[p];let I=c[p];I=mn(I);const D=o.yc(x);if(I instanceof Yx)d.push(x);else{const A=vf(I,D);A!=null&&(d.push(x),h.set(x,A))}}const f=new br(d);return new pD(h,f,o.fieldTransforms)}function C6(n,e,t,s=!1){return vf(t,n.Cc(s?4:3,e))}function vf(n,e){if(yD(n=mn(n)))return SN("Unsupported field value:",e,n),xD(n,e);if(n instanceof wf)return function(s,i){if(!gD(i.Ac))throw i.Sc(`${s._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${s._methodName}() is not currently supported inside arrays`);const a=s._toFieldTransform(i);a&&i.fieldTransforms.push(a)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(s,i){const a=[];let o=0;for(const l of s){let c=vf(l,i.wc(o));c==null&&(c={nullValue:"NULL_VALUE"}),a.push(c),o++}return{arrayValue:{values:a}}}(n,e)}return function(s,i){if((s=mn(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return r2(i.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const a=Gt.fromDate(s);return{timestampValue:au(i.serializer,a)}}if(s instanceof Gt){const a=new Gt(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:au(i.serializer,a)}}if(s instanceof qi)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Pr)return{bytesValue:p2(i.serializer,s._byteString)};if(s instanceof Vn){const a=i.databaseId,o=s.firestore._databaseId;if(!o.isEqual(a))throw i.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${a.projectId}/${a.database}`);return{referenceValue:Kv(s.firestore._databaseId||i.databaseId,s._key.path)}}if(s instanceof Hi)return function(o,l){return{mapValue:{fields:{[Fv]:{stringValue:Uv},[Jd]:{arrayValue:{values:o.toArray().map(d=>{if(typeof d!="number")throw l.Sc("VectorValues must only contain numeric values.");return $v(l.serializer,d)})}}}}}}(s,i);throw i.Sc(`Unsupported field value: ${Dx(s)}`)}(n,e)}function xD(n,e){const t={};return RA(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ll(n,(s,i)=>{const a=vf(i,e.mc(s));a!=null&&(t[s]=a)}),{mapValue:{fields:t}}}function yD(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Gt||n instanceof qi||n instanceof Pr||n instanceof Vn||n instanceof wf||n instanceof Hi)}function SN(n,e,t){if(!yD(t)||!pA(t)){const s=Dx(t);throw s==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+s)}}function lw(n,e,t){if((e=mn(e))instanceof Au)return e._internalPath;if(typeof e=="string")return IN(n,e);throw Xg("Field path arguments must be of type string or ",n,!1,void 0,t)}const A6=new RegExp("[~\\*/\\[\\]]");function IN(n,e,t){if(e.search(A6)>=0)throw Xg(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Au(...e.split("."))._internalPath}catch{throw Xg(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Xg(n,e,t,s,i){const a=s&&!s.isEmpty(),o=i!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(a||o)&&(c+=" (found",a&&(c+=` in field ${s}`),o&&(c+=` in document ${i}`),c+=")"),new Ue(we.INVALID_ARGUMENT,l+n+c)}function bD(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jg{constructor(e,t,s,i,a){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=i,this._converter=a}get id(){return this._key.path.lastSegment()}get ref(){return new Vn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new D6(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Xx("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class D6 extends Jg{data(){return super.data()}}function Xx(n,e){return typeof e=="string"?IN(n,e):e instanceof Au?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wD(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Ue(we.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class TN{}class CN extends TN{}function pt(n,e,...t){let s=[];e instanceof TN&&s.push(e),s=s.concat(t),function(a){const o=a.filter(c=>c instanceof AN).length,l=a.filter(c=>c instanceof Jx).length;if(o>1||o>0&&l>0)throw new Ue(we.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const i of s)n=i._apply(n);return n}class Jx extends CN{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new Jx(e,t,s)}_apply(e){const t=this._parse(e);return vD(e._query,t),new Ya(e.firestore,e.converter,W0(e._query,t))}_parse(e){const t=Du(e.firestore);return function(a,o,l,c,d,h,f){let p;if(d.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new Ue(we.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){KS(f,h);const I=[];for(const D of f)I.push(WS(c,a,D));p={arrayValue:{values:I}}}else p=WS(c,a,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||KS(f,h),p=C6(l,o,f,h==="in"||h==="not-in");return Ct.create(d,h,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function qt(n,e,t){const s=e,i=Xx("where",n);return Jx._create(i,s,t)}class AN extends TN{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new AN(e,t)}_parse(e){const t=this._queryConstraints.map(s=>s._parse(e)).filter(s=>s.getFilters().length>0);return t.length===1?t[0]:sn.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(i,a){let o=i;const l=a.getFlattenedFilters();for(const c of l)vD(o,c),o=W0(o,c)}(e._query,t),new Ya(e.firestore,e.converter,W0(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class DN extends CN{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new DN(e,t)}_apply(e){const t=function(i,a,o){if(i.startAt!==null)throw new Ue(we.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new Ue(we.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Om(a,o)}(e._query,this._field,this._direction);return new Ya(e.firestore,e.converter,function(i,a){const o=i.explicitOrderBy.concat([a]);return new ju(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}function $n(n,e="asc"){const t=e,s=Xx("orderBy",n);return DN._create(s,t)}class RN extends CN{constructor(e,t,s){super(),this.type=e,this._limit=t,this._limitType=s}static _create(e,t,s){return new RN(e,t,s)}_apply(e){return new Ya(e.firestore,e.converter,zg(e._query,this._limit,this._limitType))}}function R6(n){return w4("limit",n),RN._create("limit",n,"F")}function WS(n,e,t){if(typeof(t=mn(t))=="string"){if(t==="")throw new Ue(we.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!YA(e)&&t.indexOf("/")!==-1)throw new Ue(we.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const s=e.path.child(Vt.fromString(t));if(!Ge.isDocumentKey(s))throw new Ue(we.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Pm(n,new Ge(s))}if(t instanceof Vn)return Pm(n,t._key);throw new Ue(we.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Dx(t)}.`)}function KS(n,e){if(!Array.isArray(n)||n.length===0)throw new Ue(we.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function vD(n,e){const t=function(i,a){for(const o of i)for(const l of o.getFlattenedFilters())if(a.indexOf(l.op)>=0)return l.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Ue(we.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Ue(we.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class ND{convertValue(e,t="none"){switch(el(e)){case 0:return null;case 1:return e.booleanValue;case 2:return An(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes($a(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Je(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return ll(e,(i,a)=>{s[i]=this.convertValue(a,t)}),s}convertVectorValue(e){var s,i,a;const t=(a=(i=(s=e.fields)==null?void 0:s[Jd].arrayValue)==null?void 0:i.values)==null?void 0:a.map(o=>An(o.doubleValue));return new Hi(t)}convertGeoPoint(e){return new qi(An(e.latitude),An(e.longitude))}convertArray(e,t){return(e.values||[]).map(s=>this.convertValue(s,t))}convertServerTimestamp(e,t){switch(t){case"previous":const s=Mx(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(Am(e));default:return null}}convertTimestamp(e){const t=za(e);return new Gt(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=Vt.fromString(e);nt(E2(s),9688,{name:e});const i=new hc(s.get(1),s.get(3)),a=new Ge(s.popFirst(5));return i.isEqual(t)||rs(`Document ${a} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zx(n,e,t){let s;return s=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,s}class P6 extends ND{constructor(e){super(),this.firestore=e}convertBytes(e){return new Pr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Vn(this.firestore,null,t)}}class xd{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Wo extends Jg{constructor(e,t,s,i,a,o){super(e,t,s,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=a}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Yp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(Xx("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Ue(we.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Wo._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Wo._jsonSchemaVersion="firestore/documentSnapshot/1.0",Wo._jsonSchema={type:ls("string",Wo._jsonSchemaVersion),bundleSource:ls("string","DocumentSnapshot"),bundleName:ls("string"),bundle:ls("string")};class Yp extends Wo{data(e={}){return super.data(e)}}class rc{constructor(e,t,s,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new xd(i.hasPendingWrites,i.fromCache),this.query=s}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(s=>{e.call(t,new Yp(this._firestore,this._userDataWriter,s.key,s,new xd(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Ue(we.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,a){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(l=>{const c=new Yp(i._firestore,i._userDataWriter,l.doc.key,l.doc,new xd(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(l=>a||l.type!==3).map(l=>{const c=new Yp(i._firestore,i._userDataWriter,l.doc.key,l.doc,new xd(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);let d=-1,h=-1;return l.type!==0&&(d=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),h=o.indexOf(l.doc.key)),{type:k6(l.type),doc:c,oldIndex:d,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Ue(we.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=rc._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Av.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],i=[];return this.docs.forEach(a=>{a._document!==null&&(t.push(a._document),s.push(this._userDataWriter.convertObjectMap(a._document.data.value.mapValue.fields,"previous")),i.push(a.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function k6(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Je(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Un(n){n=Ws(n,Vn);const e=Ws(n.firestore,bi);return w6(Cu(e),n._key).then(t=>jD(e,n,t))}rc._jsonSchemaVersion="firestore/querySnapshot/1.0",rc._jsonSchema={type:ls("string",rc._jsonSchemaVersion),bundleSource:ls("string","QuerySnapshot"),bundleName:ls("string"),bundle:ls("string")};class ey extends ND{constructor(e){super(),this.firestore=e}convertBytes(e){return new Pr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Vn(this.firestore,null,t)}}function lt(n){n=Ws(n,Ya);const e=Ws(n.firestore,bi),t=Cu(e),s=new ey(e);return wD(n._query),v6(t,n._query).then(i=>new rc(e,s,n,i))}function uu(n,e,t){n=Ws(n,Vn);const s=Ws(n.firestore,bi),i=Zx(n.converter,e,t);return Nf(s,[Kx(Du(s),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Rn.none())])}function gs(n,e,t,...s){n=Ws(n,Vn);const i=Ws(n.firestore,bi),a=Du(i);let o;return o=typeof(e=mn(e))=="string"||e instanceof Au?EN(a,"updateDoc",n._key,e,t,s):_N(a,"updateDoc",n._key,e),Nf(i,[o.toMutation(n._key,Rn.exists(!0))])}function xs(n){return Nf(Ws(n.firestore,bi),[new Eu(n._key,Rn.none())])}function Ys(n,e){const t=Ws(n.firestore,bi),s=Ye(n),i=Zx(n.converter,e);return Nf(t,[Kx(Du(n.firestore),"addDoc",s._key,i,n.converter!==null,{}).toMutation(s._key,Rn.exists(!1))]).then(()=>s)}function Vm(n,...e){var c,d,h;n=mn(n);let t={includeMetadataChanges:!1,source:"default"},s=0;typeof e[s]!="object"||QS(e[s])||(t=e[s++]);const i={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(QS(e[s])){const f=e[s];e[s]=(c=f.next)==null?void 0:c.bind(f),e[s+1]=(d=f.error)==null?void 0:d.bind(f),e[s+2]=(h=f.complete)==null?void 0:h.bind(f)}let a,o,l;if(n instanceof Vn)o=Ws(n.firestore,bi),l=pf(n._key.path),a={next:f=>{e[s]&&e[s](jD(o,n,f))},error:e[s+1],complete:e[s+2]};else{const f=Ws(n,Ya);o=Ws(f.firestore,bi),l=f._query;const p=new ey(o);a={next:x=>{e[s]&&e[s](new rc(o,p,f,x))},error:e[s+1],complete:e[s+2]},wD(n._query)}return function(p,x,I,D){const A=new bN(D),g=new mN(x,A,I);return p.asyncQueue.enqueueAndForget(async()=>dN(await Yg(p),g)),()=>{A.Nu(),p.asyncQueue.enqueueAndForget(async()=>uN(await Yg(p),g))}}(Cu(o),l,i,a)}function Nf(n,e){return function(s,i){const a=new yi;return s.asyncQueue.enqueueAndForget(async()=>JU(await y6(s),i,a)),a.promise}(Cu(n),e)}function jD(n,e,t){const s=t.docs.get(e._key),i=new ey(n);return new Wo(n,i,e._key,s,new xd(t.hasPendingWrites,t.fromCache),e.converter)}class O6{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=U6(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}function M6(n){return new O6(n)}class L6{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Um.provider,this._offlineComponentProvider={build:t=>new hD(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class F6{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Um.provider,this._offlineComponentProvider={build:t=>new m6(t,e==null?void 0:e.cacheSizeBytes)}}}function U6(n){return new L6(n==null?void 0:n.forceOwnership)}function V6(){return new F6}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z6={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $6{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Du(e)}set(e,t,s){this._verifyNotCommitted();const i=ko(e,this._firestore),a=Zx(i.converter,t,s),o=Kx(this._dataReader,"WriteBatch.set",i._key,a,i.converter!==null,s);return this._mutations.push(o.toMutation(i._key,Rn.none())),this}update(e,t,s,...i){this._verifyNotCommitted();const a=ko(e,this._firestore);let o;return o=typeof(t=mn(t))=="string"||t instanceof Au?EN(this._dataReader,"WriteBatch.update",a._key,t,s,i):_N(this._dataReader,"WriteBatch.update",a._key,t),this._mutations.push(o.toMutation(a._key,Rn.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ko(e,this._firestore);return this._mutations=this._mutations.concat(new Eu(t._key,Rn.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Ue(we.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ko(n,e){if((n=mn(n)).firestore!==e)throw new Ue(we.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B6{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Du(e)}get(e){const t=ko(e,this._firestore),s=new P6(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return Je(24041);const a=i[0];if(a.isFoundDocument())return new Jg(this._firestore,s,a.key,a,t.converter);if(a.isNoDocument())return new Jg(this._firestore,s,t._key,null,t.converter);throw Je(18433,{doc:a})})}set(e,t,s){const i=ko(e,this._firestore),a=Zx(i.converter,t,s),o=Kx(this._dataReader,"Transaction.set",i._key,a,i.converter!==null,s);return this._transaction.set(i._key,o),this}update(e,t,s,...i){const a=ko(e,this._firestore);let o;return o=typeof(t=mn(t))=="string"||t instanceof Au?EN(this._dataReader,"Transaction.update",a._key,t,s,i):_N(this._dataReader,"Transaction.update",a._key,t),this._transaction.update(a._key,o),this}delete(e){const t=ko(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q6 extends B6{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ko(e,this._firestore),s=new ey(this._firestore);return super.get(e).then(i=>new Wo(this._firestore,s,t._key,i._document,new xd(!1,!1),t.converter))}}function cw(n,e,t){n=Ws(n,bi);const s={...z6,...t};return function(a){if(a.maxAttempts<1)throw new Ue(we.INVALID_ARGUMENT,"Max attempts must be at least 1")}(s),function(a,o,l){const c=new yi;return a.asyncQueue.enqueueAndForget(async()=>{const d=await b6(a);new p6(a.asyncQueue,d,l,o,c).ju()}),c.promise}(Cu(n),i=>e(new q6(n,i)),s)}function it(){return new NN("serverTimestamp")}function _D(n){return new jN("increment",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ka(n){return Cu(n=Ws(n,bi)),new $6(n,e=>Nf(n,e))}(function(e,t=!0){(function(i){Nu=i})(_c),dc(new Zo("firestore",(s,{instanceIdentifier:i,options:a})=>{const o=s.getProvider("app").getImmediate(),l=new bi(new u4(s.getProvider("auth-internal")),new f4(o,s.getProvider("app-check-internal")),function(d,h){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new Ue(we.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new hc(d.options.projectId,h)}(o,i),o);return a={useFetchStreams:t,...a},l._setSettings(a),l},"PUBLIC").setMultipleInstances(!0)),Bi(TE,CE,e),Bi(TE,CE,"esm2020")})();var H6="firebase",G6="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Bi(H6,G6,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ED="firebasestorage.googleapis.com",SD="storageBucket",Q6=2*60*1e3,W6=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zn extends na{constructor(e,t,s=0){super(_b(e),`Firebase Storage: ${t} (${_b(e)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Zn.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return _b(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Jn;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Jn||(Jn={}));function _b(n){return"storage/"+n}function PN(){const n="An unknown error occurred, please check the error payload for server response.";return new Zn(Jn.UNKNOWN,n)}function K6(n){return new Zn(Jn.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function Y6(n){return new Zn(Jn.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function X6(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Zn(Jn.UNAUTHENTICATED,n)}function J6(){return new Zn(Jn.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Z6(n){return new Zn(Jn.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function eV(){return new Zn(Jn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function tV(){return new Zn(Jn.CANCELED,"User canceled the upload/download.")}function nV(n){return new Zn(Jn.INVALID_URL,"Invalid URL '"+n+"'.")}function sV(n){return new Zn(Jn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function rV(){return new Zn(Jn.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+SD+"' property when initializing the app?")}function iV(){return new Zn(Jn.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function aV(){return new Zn(Jn.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function oV(n){return new Zn(Jn.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function dw(n){return new Zn(Jn.INVALID_ARGUMENT,n)}function ID(){return new Zn(Jn.APP_DELETED,"The Firebase app was deleted.")}function lV(n){return new Zn(Jn.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function sm(n,e){return new Zn(Jn.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function wh(n){throw new Zn(Jn.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Or{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let s;try{s=Or.makeFromUrl(e,t)}catch{return new Or(e,"")}if(s.path==="")return s;throw sV(e)}static makeFromUrl(e,t){let s=null;const i="([A-Za-z0-9.\\-_]+)";function a(V){V.path.charAt(V.path.length-1)==="/"&&(V.path_=V.path_.slice(0,-1))}const o="(/(.*))?$",l=new RegExp("^gs://"+i+o,"i"),c={bucket:1,path:3};function d(V){V.path_=decodeURIComponent(V.path)}const h="v[A-Za-z0-9_]+",f=t.replace(/[.]/g,"\\."),p="(/([^?#]*).*)?$",x=new RegExp(`^https?://${f}/${h}/b/${i}/o${p}`,"i"),I={bucket:1,path:3},D=t===ED?"(?:storage.googleapis.com|storage.cloud.google.com)":t,A="([^?#]*)",g=new RegExp(`^https?://${D}/${i}/${A}`,"i"),j=[{regex:l,indices:c,postModify:a},{regex:x,indices:I,postModify:d},{regex:g,indices:{bucket:1,path:2},postModify:d}];for(let V=0;V<j.length;V++){const $=j[V],Z=$.regex.exec(e);if(Z){const O=Z[$.indices.bucket];let M=Z[$.indices.path];M||(M=""),s=new Or(O,M),$.postModify(s);break}}if(s==null)throw nV(e);return s}}class cV{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dV(n,e,t){let s=1,i=null,a=null,o=!1,l=0;function c(){return l===2}let d=!1;function h(...A){d||(d=!0,e.apply(null,A))}function f(A){i=setTimeout(()=>{i=null,n(x,c())},A)}function p(){a&&clearTimeout(a)}function x(A,...g){if(d){p();return}if(A){p(),h.call(null,A,...g);return}if(c()||o){p(),h.call(null,A,...g);return}s<64&&(s*=2);let j;l===1?(l=2,j=0):j=(s+Math.random())*1e3,f(j)}let I=!1;function D(A){I||(I=!0,p(),!d&&(i!==null?(A||(l=2),clearTimeout(i),f(0)):A||(l=1)))}return f(0),a=setTimeout(()=>{o=!0,D(!0)},t),D}function uV(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hV(n){return n!==void 0}function mV(n){return typeof n=="object"&&!Array.isArray(n)}function kN(n){return typeof n=="string"||n instanceof String}function YS(n){return ON()&&n instanceof Blob}function ON(){return typeof Blob<"u"}function XS(n,e,t,s){if(s<e)throw dw(`Invalid value for '${n}'. Expected ${e} or greater.`);if(s>t)throw dw(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ty(n,e,t){let s=e;return t==null&&(s=`https://${e}`),`${t}://${s}/v0${n}`}function TD(n){const e=encodeURIComponent;let t="?";for(const s in n)if(n.hasOwnProperty(s)){const i=e(s)+"="+e(n[s]);t=t+i+"&"}return t=t.slice(0,-1),t}var ic;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(ic||(ic={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fV(n,e){const t=n>=500&&n<600,i=[408,429].indexOf(n)!==-1,a=e.indexOf(n)!==-1;return t||i||a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pV{constructor(e,t,s,i,a,o,l,c,d,h,f,p=!0,x=!1){this.url_=e,this.method_=t,this.headers_=s,this.body_=i,this.successCodes_=a,this.additionalRetryCodes_=o,this.callback_=l,this.errorCallback_=c,this.timeout_=d,this.progressCallback_=h,this.connectionFactory_=f,this.retry=p,this.isUsingEmulator=x,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((I,D)=>{this.resolve_=I,this.reject_=D,this.start_()})}start_(){const e=(s,i)=>{if(i){s(!1,new vp(!1,null,!0));return}const a=this.connectionFactory_();this.pendingConnection_=a;const o=l=>{const c=l.loaded,d=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,d)};this.progressCallback_!==null&&a.addUploadProgressListener(o),a.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&a.removeUploadProgressListener(o),this.pendingConnection_=null;const l=a.getErrorCode()===ic.NO_ERROR,c=a.getStatus();if(!l||fV(c,this.additionalRetryCodes_)&&this.retry){const h=a.getErrorCode()===ic.ABORT;s(!1,new vp(!1,null,h));return}const d=this.successCodes_.indexOf(c)!==-1;s(!0,new vp(d,a))})},t=(s,i)=>{const a=this.resolve_,o=this.reject_,l=i.connection;if(i.wasSuccessCode)try{const c=this.callback_(l,l.getResponse());hV(c)?a(c):a()}catch(c){o(c)}else if(l!==null){const c=PN();c.serverResponse=l.getErrorText(),this.errorCallback_?o(this.errorCallback_(l,c)):o(c)}else if(i.canceled){const c=this.appDelete_?ID():tV();o(c)}else{const c=eV();o(c)}};this.canceled_?t(!1,new vp(!1,null,!0)):this.backoffId_=dV(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&uV(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class vp{constructor(e,t,s){this.wasSuccessCode=e,this.connection=t,this.canceled=!!s}}function gV(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function xV(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function yV(n,e){e&&(n["X-Firebase-GMPID"]=e)}function bV(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function wV(n,e,t,s,i,a,o=!0,l=!1){const c=TD(n.urlParams),d=n.url+c,h=Object.assign({},n.headers);return yV(h,e),gV(h,t),xV(h,a),bV(h,s),new pV(d,n.method,h,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,i,o,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vV(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function NV(...n){const e=vV();if(e!==void 0){const t=new e;for(let s=0;s<n.length;s++)t.append(n[s]);return t.getBlob()}else{if(ON())return new Blob(n);throw new Zn(Jn.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function jV(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _V(n){if(typeof atob>"u")throw oV("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ui={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Eb{constructor(e,t){this.data=e,this.contentType=t||null}}function EV(n,e){switch(n){case Ui.RAW:return new Eb(CD(e));case Ui.BASE64:case Ui.BASE64URL:return new Eb(AD(n,e));case Ui.DATA_URL:return new Eb(IV(e),TV(e))}throw PN()}function CD(n){const e=[];for(let t=0;t<n.length;t++){let s=n.charCodeAt(t);if(s<=127)e.push(s);else if(s<=2047)e.push(192|s>>6,128|s&63);else if((s&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const a=s,o=n.charCodeAt(++t);s=65536|(a&1023)<<10|o&1023,e.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|s&63)}else(s&64512)===56320?e.push(239,191,189):e.push(224|s>>12,128|s>>6&63,128|s&63)}return new Uint8Array(e)}function SV(n){let e;try{e=decodeURIComponent(n)}catch{throw sm(Ui.DATA_URL,"Malformed data URL.")}return CD(e)}function AD(n,e){switch(n){case Ui.BASE64:{const i=e.indexOf("-")!==-1,a=e.indexOf("_")!==-1;if(i||a)throw sm(n,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case Ui.BASE64URL:{const i=e.indexOf("+")!==-1,a=e.indexOf("/")!==-1;if(i||a)throw sm(n,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=_V(e)}catch(i){throw i.message.includes("polyfill")?i:sm(n,"Invalid character found")}const s=new Uint8Array(t.length);for(let i=0;i<t.length;i++)s[i]=t.charCodeAt(i);return s}class DD{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw sm(Ui.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const s=t[1]||null;s!=null&&(this.base64=CV(s,";base64"),this.contentType=this.base64?s.substring(0,s.length-7):s),this.rest=e.substring(e.indexOf(",")+1)}}function IV(n){const e=new DD(n);return e.base64?AD(Ui.BASE64,e.rest):SV(e.rest)}function TV(n){return new DD(n).contentType}function CV(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _o{constructor(e,t){let s=0,i="";YS(e)?(this.data_=e,s=e.size,i=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),s=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),s=e.length),this.size_=s,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,t){if(YS(this.data_)){const s=this.data_,i=jV(s,e,t);return i===null?null:new _o(i)}else{const s=new Uint8Array(this.data_.buffer,e,t-e);return new _o(s,!0)}}static getBlob(...e){if(ON()){const t=e.map(s=>s instanceof _o?s.data_:s);return new _o(NV.apply(null,t))}else{const t=e.map(o=>kN(o)?EV(Ui.RAW,o).data:o.data_);let s=0;t.forEach(o=>{s+=o.byteLength});const i=new Uint8Array(s);let a=0;return t.forEach(o=>{for(let l=0;l<o.length;l++)i[a++]=o[l]}),new _o(i,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RD(n){let e;try{e=JSON.parse(n)}catch{return null}return mV(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AV(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function DV(n,e){const t=e.split("/").filter(s=>s.length>0).join("/");return n.length===0?t:n+"/"+t}function PD(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RV(n,e){return e}class ir{constructor(e,t,s,i){this.server=e,this.local=t||e,this.writable=!!s,this.xform=i||RV}}let Np=null;function PV(n){return!kN(n)||n.length<2?n:PD(n)}function kD(){if(Np)return Np;const n=[];n.push(new ir("bucket")),n.push(new ir("generation")),n.push(new ir("metageneration")),n.push(new ir("name","fullPath",!0));function e(a,o){return PV(o)}const t=new ir("name");t.xform=e,n.push(t);function s(a,o){return o!==void 0?Number(o):o}const i=new ir("size");return i.xform=s,n.push(i),n.push(new ir("timeCreated")),n.push(new ir("updated")),n.push(new ir("md5Hash",null,!0)),n.push(new ir("cacheControl",null,!0)),n.push(new ir("contentDisposition",null,!0)),n.push(new ir("contentEncoding",null,!0)),n.push(new ir("contentLanguage",null,!0)),n.push(new ir("contentType",null,!0)),n.push(new ir("metadata","customMetadata",!0)),Np=n,Np}function kV(n,e){function t(){const s=n.bucket,i=n.fullPath,a=new Or(s,i);return e._makeStorageReference(a)}Object.defineProperty(n,"ref",{get:t})}function OV(n,e,t){const s={};s.type="file";const i=t.length;for(let a=0;a<i;a++){const o=t[a];s[o.local]=o.xform(s,e[o.server])}return kV(s,n),s}function OD(n,e,t){const s=RD(e);return s===null?null:OV(n,s,t)}function MV(n,e,t,s){const i=RD(e);if(i===null||!kN(i.downloadTokens))return null;const a=i.downloadTokens;if(a.length===0)return null;const o=encodeURIComponent;return a.split(",").map(d=>{const h=n.bucket,f=n.fullPath,p="/b/"+o(h)+"/o/"+o(f),x=ty(p,t,s),I=TD({alt:"media",token:d});return x+I})[0]}function LV(n,e){const t={},s=e.length;for(let i=0;i<s;i++){const a=e[i];a.writable&&(t[a.server]=n[a.local])}return JSON.stringify(t)}class MN{constructor(e,t,s,i){this.url=e,this.method=t,this.handler=s,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MD(n){if(!n)throw PN()}function FV(n,e){function t(s,i){const a=OD(n,i,e);return MD(a!==null),a}return t}function UV(n,e){function t(s,i){const a=OD(n,i,e);return MD(a!==null),MV(a,i,n.host,n._protocol)}return t}function LD(n){function e(t,s){let i;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?i=J6():i=X6():t.getStatus()===402?i=Y6(n.bucket):t.getStatus()===403?i=Z6(n.path):i=s,i.status=t.getStatus(),i.serverResponse=s.serverResponse,i}return e}function FD(n){const e=LD(n);function t(s,i){let a=e(s,i);return s.getStatus()===404&&(a=K6(n.path)),a.serverResponse=i.serverResponse,a}return t}function VV(n,e,t){const s=e.fullServerUrl(),i=ty(s,n.host,n._protocol),a="GET",o=n.maxOperationRetryTime,l=new MN(i,a,UV(n,t),o);return l.errorHandler=FD(e),l}function zV(n,e){const t=e.fullServerUrl(),s=ty(t,n.host,n._protocol),i="DELETE",a=n.maxOperationRetryTime;function o(c,d){}const l=new MN(s,i,o,a);return l.successCodes=[200,204],l.errorHandler=FD(e),l}function $V(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function BV(n,e,t){const s=Object.assign({},t);return s.fullPath=n.path,s.size=e.size(),s.contentType||(s.contentType=$V(null,e)),s}function qV(n,e,t,s,i){const a=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function l(){let j="";for(let V=0;V<2;V++)j=j+Math.random().toString().slice(2);return j}const c=l();o["Content-Type"]="multipart/related; boundary="+c;const d=BV(e,s,i),h=LV(d,t),f="--"+c+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+c+`\r
Content-Type: `+d.contentType+`\r
\r
`,p=`\r
--`+c+"--",x=_o.getBlob(f,s,p);if(x===null)throw iV();const I={name:d.fullPath},D=ty(a,n.host,n._protocol),A="POST",g=n.maxUploadRetryTime,N=new MN(D,A,FV(n,t),g);return N.urlParams=I,N.headers=o,N.body=x.uploadData(),N.errorHandler=LD(e),N}class HV{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=ic.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=ic.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=ic.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,s,i,a){if(this.sent_)throw wh("cannot .send() more than once");if(Qa(e)&&s&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),a!==void 0)for(const o in a)a.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,a[o].toString());return i!==void 0?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw wh("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw wh("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw wh("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw wh("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class GV extends HV{initXhr(){this.xhr_.responseType="text"}}function LN(){return new GV}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yc{constructor(e,t){this._service=e,t instanceof Or?this._location=t:this._location=Or.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new yc(e,t)}get root(){const e=new Or(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return PD(this._location.path)}get storage(){return this._service}get parent(){const e=AV(this._location.path);if(e===null)return null;const t=new Or(this._location.bucket,e);return new yc(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw lV(e)}}function QV(n,e,t){n._throwIfRoot("uploadBytes");const s=qV(n.storage,n._location,kD(),new _o(e,!0),t);return n.storage.makeRequestWithTokens(s,LN).then(i=>({metadata:i,ref:n}))}function WV(n){n._throwIfRoot("getDownloadURL");const e=VV(n.storage,n._location,kD());return n.storage.makeRequestWithTokens(e,LN).then(t=>{if(t===null)throw aV();return t})}function KV(n){n._throwIfRoot("deleteObject");const e=zV(n.storage,n._location);return n.storage.makeRequestWithTokens(e,LN)}function YV(n,e){const t=DV(n._location.path,e),s=new Or(n._location.bucket,t);return new yc(n.storage,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XV(n){return/^[A-Za-z]+:\/\//.test(n)}function JV(n,e){return new yc(n,e)}function UD(n,e){if(n instanceof FN){const t=n;if(t._bucket==null)throw rV();const s=new yc(t,t._bucket);return e!=null?UD(s,e):s}else return e!==void 0?YV(n,e):n}function ZV(n,e){if(e&&XV(e)){if(n instanceof FN)return JV(n,e);throw dw("To use ref(service, url), the first argument must be a Storage instance.")}else return UD(n,e)}function JS(n,e){const t=e==null?void 0:e[SD];return t==null?null:Or.makeFromBucketSpec(t,n)}function ez(n,e,t,s={}){n.host=`${e}:${t}`;const i=Qa(e);i&&(Ax(`https://${n.host}/b`),_v("Storage",!0)),n._isUsingEmulator=!0,n._protocol=i?"https":"http";const{mockUserToken:a}=s;a&&(n._overrideAuthToken=typeof a=="string"?a:YC(a,n.app.options.projectId))}class FN{constructor(e,t,s,i,a,o=!1){this.app=e,this._authProvider=t,this._appCheckProvider=s,this._url=i,this._firebaseVersion=a,this._isUsingEmulator=o,this._bucket=null,this._host=ED,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Q6,this._maxUploadRetryTime=W6,this._requests=new Set,i!=null?this._bucket=Or.makeFromBucketSpec(i,this._host):this._bucket=JS(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Or.makeFromBucketSpec(this._url,e):this._bucket=JS(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){XS("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){XS("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(gr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new yc(this,e)}_makeRequest(e,t,s,i,a=!0){if(this._deleted)return new cV(ID());{const o=wV(e,this._appId,s,i,t,this._firebaseVersion,a,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[s,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,s,i).getPromise()}}const ZS="@firebase/storage",eI="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VD="storage";function Zg(n,e,t){return n=mn(n),QV(n,e,t)}function rm(n){return n=mn(n),WV(n)}function ny(n){return n=mn(n),KV(n)}function Ea(n,e){return n=mn(n),ZV(n,e)}function zD(n=Tv(),e){n=mn(n);const s=df(n,VD).getImmediate({identifier:e}),i=QC("storage");return i&&tz(s,...i),s}function tz(n,e,t,s={}){ez(n,e,t,s)}function nz(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),s=n.getProvider("auth-internal"),i=n.getProvider("app-check-internal");return new FN(t,s,i,e,_c)}function sz(){dc(new Zo(VD,nz,"PUBLIC").setMultipleInstances(!0)),Bi(ZS,eI,""),Bi(ZS,eI,"esm2020")}sz();function $D(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const rz=$D,BD=new lf("auth","Firebase",$D());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ex=new Ev("@firebase/auth");function iz(n,...e){ex.logLevel<=Tt.WARN&&ex.warn(`Auth (${_c}): ${n}`,...e)}function Xp(n,...e){ex.logLevel<=Tt.ERROR&&ex.error(`Auth (${_c}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wi(n,...e){throw UN(n,...e)}function Gi(n,...e){return UN(n,...e)}function qD(n,e,t){const s={...rz(),[e]:t};return new lf("auth","Firebase",s).create(e,{appName:n.name})}function Qi(n){return qD(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function UN(n,...e){if(typeof n!="string"){const t=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(t,...s)}return BD.create(n,...e)}function ut(n,e,...t){if(!n)throw UN(e,...t)}function Sa(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Xp(e),new Error(e)}function Ba(n,e){n||Sa(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uw(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function az(){return tI()==="http:"||tI()==="https:"}function tI(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oz(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(az()||q3()||"connection"in navigator)?navigator.onLine:!0}function lz(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jf{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ba(t>e,"Short delay should be less than long delay!"),this.isMobile=$3()||H3()}get(){return oz()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VN(n,e){Ba(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HD{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Sa("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Sa("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Sa("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cz={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dz=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],uz=new jf(3e4,6e4);function dl(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Xa(n,e,t,s,i={}){return GD(n,i,async()=>{let a={},o={};s&&(e==="GET"?o=s:a={body:JSON.stringify(s)});const l=cf({key:n.config.apiKey,...o}).slice(1),c=await n._getAdditionalHeaders();c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode);const d={method:e,headers:c,...a};return B3()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&Qa(n.emulatorConfig.host)&&(d.credentials="include"),HD.fetch()(await QD(n,n.config.apiHost,t,l),d)})}async function GD(n,e,t){n._canInitEmulator=!1;const s={...cz,...e};try{const i=new mz(n),a=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const o=await a.json();if("needConfirmation"in o)throw jp(n,"account-exists-with-different-credential",o);if(a.ok&&!("errorMessage"in o))return o;{const l=a.ok?o.errorMessage:o.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw jp(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw jp(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw jp(n,"user-disabled",o);const h=s[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw qD(n,h,d);wi(n,h)}}catch(i){if(i instanceof na)throw i;wi(n,"network-request-failed",{message:String(i)})}}async function _f(n,e,t,s,i={}){const a=await Xa(n,e,t,s,i);return"mfaPendingCredential"in a&&wi(n,"multi-factor-auth-required",{_serverResponse:a}),a}async function QD(n,e,t,s){const i=`${e}${t}?${s}`,a=n,o=a.config.emulator?VN(n.config,i):`${n.config.apiScheme}://${i}`;return dz.includes(t)&&(await a._persistenceManagerAvailable,a._getPersistenceType()==="COOKIE")?a._getPersistence()._getFinalTarget(o).toString():o}function hz(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class mz{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,s)=>{this.timer=setTimeout(()=>s(Gi(this.auth,"network-request-failed")),uz.get())})}}function jp(n,e,t){const s={appName:n.name};t.email&&(s.email=t.email),t.phoneNumber&&(s.phoneNumber=t.phoneNumber);const i=Gi(n,e,s);return i.customData._tokenResponse=t,i}function nI(n){return n!==void 0&&n.enterprise!==void 0}class fz{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return hz(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function pz(n,e){return Xa(n,"GET","/v2/recaptchaConfig",dl(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gz(n,e){return Xa(n,"POST","/v1/accounts:delete",e)}async function tx(n,e){return Xa(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function im(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function xz(n,e=!1){const t=mn(n),s=await t.getIdToken(e),i=zN(s);ut(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const a=typeof i.firebase=="object"?i.firebase:void 0,o=a==null?void 0:a.sign_in_provider;return{claims:i,token:s,authTime:im(Sb(i.auth_time)),issuedAtTime:im(Sb(i.iat)),expirationTime:im(Sb(i.exp)),signInProvider:o||null,signInSecondFactor:(a==null?void 0:a.sign_in_second_factor)||null}}function Sb(n){return Number(n)*1e3}function zN(n){const[e,t,s]=n.split(".");if(e===void 0||t===void 0||s===void 0)return Xp("JWT malformed, contained fewer than 3 sections"),null;try{const i=qC(t);return i?JSON.parse(i):(Xp("Failed to decode base64 JWT payload"),null)}catch(i){return Xp("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function sI(n){const e=zN(n);return ut(e,"internal-error"),ut(typeof e.exp<"u","internal-error"),ut(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hu(n,e,t=!1){if(t)return e;try{return await e}catch(s){throw s instanceof na&&yz(s)&&n.auth.currentUser===n&&await n.auth.signOut(),s}}function yz({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bz{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hw{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=im(this.lastLoginAt),this.creationTime=im(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nx(n){var f;const e=n.auth,t=await n.getIdToken(),s=await hu(n,tx(e,{idToken:t}));ut(s==null?void 0:s.users.length,e,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const a=(f=i.providerUserInfo)!=null&&f.length?WD(i.providerUserInfo):[],o=vz(n.providerData,a),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(o!=null&&o.length),d=l?c:!1,h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new hw(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,h)}async function wz(n){const e=mn(n);await nx(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function vz(n,e){return[...n.filter(s=>!e.some(i=>i.providerId===s.providerId)),...e]}function WD(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nz(n,e){const t=await GD(n,{},async()=>{const s=cf({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:a}=n.config,o=await QD(n,i,"/v1/token",`key=${a}`),l=await n._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:s};return n.emulatorConfig&&Qa(n.emulatorConfig.host)&&(c.credentials="include"),HD.fetch()(o,c)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function jz(n,e){return Xa(n,"POST","/v2/accounts:revokeToken",dl(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Td{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ut(e.idToken,"internal-error"),ut(typeof e.idToken<"u","internal-error"),ut(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):sI(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ut(e.length!==0,"internal-error");const t=sI(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ut(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:s,refreshToken:i,expiresIn:a}=await Nz(e,t);this.updateTokensAndExpiration(s,i,Number(a))}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,t){const{refreshToken:s,accessToken:i,expirationTime:a}=t,o=new Td;return s&&(ut(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),i&&(ut(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),a&&(ut(typeof a=="number","internal-error",{appName:e}),o.expirationTime=a),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Td,this.toJSON())}_performRefresh(){return Sa("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fo(n,e){ut(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class gi{constructor({uid:e,auth:t,stsTokenManager:s,...i}){this.providerId="firebase",this.proactiveRefresh=new bz(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new hw(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await hu(this,this.stsTokenManager.getToken(this.auth,e));return ut(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return xz(this,e)}reload(){return wz(this)}_assign(e){this!==e&&(ut(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new gi({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){ut(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&await nx(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(gr(this.auth.app))return Promise.reject(Qi(this.auth));const e=await this.getIdToken();return await hu(this,gz(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const s=t.displayName??void 0,i=t.email??void 0,a=t.phoneNumber??void 0,o=t.photoURL??void 0,l=t.tenantId??void 0,c=t._redirectEventId??void 0,d=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:f,emailVerified:p,isAnonymous:x,providerData:I,stsTokenManager:D}=t;ut(f&&D,e,"internal-error");const A=Td.fromJSON(this.name,D);ut(typeof f=="string",e,"internal-error"),fo(s,e.name),fo(i,e.name),ut(typeof p=="boolean",e,"internal-error"),ut(typeof x=="boolean",e,"internal-error"),fo(a,e.name),fo(o,e.name),fo(l,e.name),fo(c,e.name),fo(d,e.name),fo(h,e.name);const g=new gi({uid:f,auth:e,email:i,emailVerified:p,displayName:s,isAnonymous:x,photoURL:o,phoneNumber:a,tenantId:l,stsTokenManager:A,createdAt:d,lastLoginAt:h});return I&&Array.isArray(I)&&(g.providerData=I.map(N=>({...N}))),c&&(g._redirectEventId=c),g}static async _fromIdTokenResponse(e,t,s=!1){const i=new Td;i.updateFromServerResponse(t);const a=new gi({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:s});return await nx(a),a}static async _fromGetAccountInfoResponse(e,t,s){const i=t.users[0];ut(i.localId!==void 0,"internal-error");const a=i.providerUserInfo!==void 0?WD(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(a!=null&&a.length),l=new Td;l.updateFromIdToken(s);const c=new gi({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:o}),d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new hw(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(a!=null&&a.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rI=new Map;function Ia(n){Ba(n instanceof Function,"Expected a class definition");let e=rI.get(n);return e?(Ba(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,rI.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KD{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}KD.type="NONE";const iI=KD;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jp(n,e,t){return`firebase:${n}:${e}:${t}`}class Cd{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:i,name:a}=this.auth;this.fullUserKey=Jp(this.userKey,i.apiKey,a),this.fullPersistenceKey=Jp("persistence",i.apiKey,a),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await tx(this.auth,{idToken:e}).catch(()=>{});return t?gi._fromGetAccountInfoResponse(this.auth,t,e):null}return gi._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,s="authUser"){if(!t.length)return new Cd(Ia(iI),e,s);const i=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let a=i[0]||Ia(iI);const o=Jp(s,e.config.apiKey,e.name);let l=null;for(const d of t)try{const h=await d._get(o);if(h){let f;if(typeof h=="string"){const p=await tx(e,{idToken:h}).catch(()=>{});if(!p)break;f=await gi._fromGetAccountInfoResponse(e,p,h)}else f=gi._fromJSON(e,h);d!==a&&(l=f),a=d;break}}catch{}const c=i.filter(d=>d._shouldAllowMigration);return!a._shouldAllowMigration||!c.length?new Cd(a,e,s):(a=c[0],l&&await a._set(o,l.toJSON()),await Promise.all(t.map(async d=>{if(d!==a)try{await d._remove(o)}catch{}})),new Cd(a,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aI(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(ZD(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(YD(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(tR(e))return"Blackberry";if(nR(e))return"Webos";if(XD(e))return"Safari";if((e.includes("chrome/")||JD(e))&&!e.includes("edge/"))return"Chrome";if(eR(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(t);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function YD(n=ps()){return/firefox\//i.test(n)}function XD(n=ps()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function JD(n=ps()){return/crios\//i.test(n)}function ZD(n=ps()){return/iemobile/i.test(n)}function eR(n=ps()){return/android/i.test(n)}function tR(n=ps()){return/blackberry/i.test(n)}function nR(n=ps()){return/webos/i.test(n)}function $N(n=ps()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function _z(n=ps()){var e;return $N(n)&&!!((e=window.navigator)!=null&&e.standalone)}function Ez(){return G3()&&document.documentMode===10}function sR(n=ps()){return $N(n)||eR(n)||nR(n)||tR(n)||/windows phone/i.test(n)||ZD(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rR(n,e=[]){let t;switch(n){case"Browser":t=aI(ps());break;case"Worker":t=`${aI(ps())}-${n}`;break;default:t=n}const s=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${_c}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sz{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=a=>new Promise((o,l)=>{try{const c=e(a);o(c)}catch(c){l(c)}});s.onAbort=t,this.queue.push(s);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)await s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Iz(n,e={}){return Xa(n,"GET","/v2/passwordPolicy",dl(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tz=6;class Cz{constructor(e){var s;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Tz,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((s=e.allowedNonAlphanumericCharacters)==null?void 0:s.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let s;for(let i=0;i<e.length;i++)s=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,i,a){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Az{constructor(e,t,s,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new oI(this),this.idTokenSubscription=new oI(this),this.beforeStateQueue=new Sz(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=BD,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(a=>this._resolvePersistenceManagerAvailable=a)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ia(t)),this._initializationPromise=this.queue(async()=>{var s,i,a;if(!this._deleted&&(this.persistenceManager=await Cd.create(this,e),(s=this._resolvePersistenceManagerAvailable)==null||s.call(this),!this._deleted)){if((i=this._popupRedirectResolver)!=null&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((a=this.currentUser)==null?void 0:a.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await tx(this,{idToken:e}),s=await gi._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var a;if(gr(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let s=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(a=this.redirectUser)==null?void 0:a._redirectEventId,l=s==null?void 0:s._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(s=c.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return ut(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await nx(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=lz()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(gr(this.app))return Promise.reject(Qi(this));const t=e?mn(e):null;return t&&ut(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ut(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return gr(this.app)?Promise.reject(Qi(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return gr(this.app)?Promise.reject(Qi(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ia(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Iz(this),t=new Cz(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new lf("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(s.tenantId=this.tenantId),await jz(this,s)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const s=await this.getOrInitRedirectPersistenceManager(t);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ia(e)||this._popupRedirectResolver;ut(t,this,"argument-error"),this.redirectPersistenceManager=await Cd.create(this,[Ia(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,s;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((s=this.redirectUser)==null?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,i){if(this._deleted)return()=>{};const a=typeof t=="function"?t:t.next.bind(t);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(ut(l,this,"internal-error"),l.then(()=>{o||a(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,s,i);return()=>{o=!0,c()}}else{const c=e.addObserver(t);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ut(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=rR(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var i;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((i=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:i.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const s=await this._getAppCheckToken();return s&&(e["X-Firebase-AppCheck"]=s),e}async _getAppCheckToken(){var t;if(gr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&iz(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function ul(n){return mn(n)}class oI{constructor(e){this.auth=e,this.observer=null,this.addObserver=J3(t=>this.observer=t)}get next(){return ut(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sy={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Dz(n){sy=n}function iR(n){return sy.loadJS(n)}function Rz(){return sy.recaptchaEnterpriseScript}function Pz(){return sy.gapiScript}function kz(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class Oz{constructor(){this.enterprise=new Mz}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Mz{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const Lz="recaptcha-enterprise",aR="NO_RECAPTCHA";class Fz{constructor(e){this.type=Lz,this.auth=ul(e)}async verify(e="verify",t=!1){async function s(a){if(!t){if(a.tenantId==null&&a._agentRecaptchaConfig!=null)return a._agentRecaptchaConfig.siteKey;if(a.tenantId!=null&&a._tenantRecaptchaConfigs[a.tenantId]!==void 0)return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(async(o,l)=>{pz(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new fz(c);return a.tenantId==null?a._agentRecaptchaConfig=d:a._tenantRecaptchaConfigs[a.tenantId]=d,o(d.siteKey)}}).catch(c=>{l(c)})})}function i(a,o,l){const c=window.grecaptcha;nI(c)?c.enterprise.ready(()=>{c.enterprise.execute(a,{action:e}).then(d=>{o(d)}).catch(()=>{o(aR)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Oz().execute("siteKey",{action:"verify"}):new Promise((a,o)=>{s(this.auth).then(l=>{if(!t&&nI(window.grecaptcha))i(l,a,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=Rz();c.length!==0&&(c+=l),iR(c).then(()=>{i(l,a,o)}).catch(d=>{o(d)})}}).catch(l=>{o(l)})})}}async function lI(n,e,t,s=!1,i=!1){const a=new Fz(n);let o;if(i)o=aR;else try{o=await a.verify(t)}catch{o=await a.verify(t,!0)}const l={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:d,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return s?Object.assign(l,{captchaResp:o}):Object.assign(l,{captchaResponse:o}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function mw(n,e,t,s,i){var a;if((a=n._getRecaptchaConfig())!=null&&a.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await lI(n,e,t,t==="getOobCode");return s(n,o)}else return s(n,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await lI(n,e,t,t==="getOobCode");return s(n,l)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uz(n,e){const t=df(n,"auth");if(t.isInitialized()){const i=t.getImmediate(),a=t.getOptions();if(Jo(a,e??{}))return i;wi(i,"already-initialized")}return t.initialize({options:e})}function Vz(n,e){const t=(e==null?void 0:e.persistence)||[],s=(Array.isArray(t)?t:[t]).map(Ia);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function zz(n,e,t){const s=ul(n);ut(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const i=!1,a=oR(e),{host:o,port:l}=$z(e),c=l===null?"":`:${l}`,d={url:`${a}//${o}${c}/`},h=Object.freeze({host:o,port:l,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!s._canInitEmulator){ut(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),ut(Jo(d,s.config.emulator)&&Jo(h,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=d,s.emulatorConfig=h,s.settings.appVerificationDisabledForTesting=!0,Qa(o)?(Ax(`${a}//${o}${c}`),_v("Auth",!0)):Bz()}function oR(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function $z(n){const e=oR(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const s=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(s);if(i){const a=i[1];return{host:a,port:cI(s.substr(a.length+1))}}else{const[a,o]=s.split(":");return{host:a,port:cI(o)}}}function cI(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Bz(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BN{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Sa("not implemented")}_getIdTokenResponse(e){return Sa("not implemented")}_linkToIdToken(e,t){return Sa("not implemented")}_getReauthenticationResolver(e){return Sa("not implemented")}}async function qz(n,e){return Xa(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hz(n,e){return _f(n,"POST","/v1/accounts:signInWithPassword",dl(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gz(n,e){return _f(n,"POST","/v1/accounts:signInWithEmailLink",dl(n,e))}async function Qz(n,e){return _f(n,"POST","/v1/accounts:signInWithEmailLink",dl(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zm extends BN{constructor(e,t,s,i=null){super("password",s),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new zm(e,t,"password")}static _fromEmailAndCode(e,t,s=null){return new zm(e,t,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return mw(e,t,"signInWithPassword",Hz);case"emailLink":return Gz(e,{email:this._email,oobCode:this._password});default:wi(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const s={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return mw(e,s,"signUpPassword",qz);case"emailLink":return Qz(e,{idToken:t,email:this._email,oobCode:this._password});default:wi(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ad(n,e){return _f(n,"POST","/v1/accounts:signInWithIdp",dl(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wz="http://localhost";class bc extends BN{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new bc(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):wi("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:i,...a}=t;if(!s||!i)return null;const o=new bc(s,i);return o.idToken=a.idToken||void 0,o.accessToken=a.accessToken||void 0,o.secret=a.secret,o.nonce=a.nonce,o.pendingToken=a.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Ad(e,t)}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,Ad(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ad(e,t)}buildRequest(){const e={requestUri:Wz,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=cf(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kz(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Yz(n){const e=Eh(Sh(n)).link,t=e?Eh(Sh(e)).deep_link_id:null,s=Eh(Sh(n)).deep_link_id;return(s?Eh(Sh(s)).link:null)||s||t||e||n}class qN{constructor(e){const t=Eh(Sh(e)),s=t.apiKey??null,i=t.oobCode??null,a=Kz(t.mode??null);ut(s&&i&&a,"argument-error"),this.apiKey=s,this.operation=a,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=Yz(e);try{return new qN(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ru{constructor(){this.providerId=Ru.PROVIDER_ID}static credential(e,t){return zm._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const s=qN.parseLink(t);return ut(s,"argument-error"),zm._fromEmailAndCode(e,s.code,s.tenantId)}}Ru.PROVIDER_ID="password";Ru.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ru.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lR{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ef extends lR{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eo extends Ef{constructor(){super("facebook.com")}static credential(e){return bc._fromParams({providerId:Eo.PROVIDER_ID,signInMethod:Eo.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Eo.credentialFromTaggedObject(e)}static credentialFromError(e){return Eo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Eo.credential(e.oauthAccessToken)}catch{return null}}}Eo.FACEBOOK_SIGN_IN_METHOD="facebook.com";Eo.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class So extends Ef{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return bc._fromParams({providerId:So.PROVIDER_ID,signInMethod:So.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return So.credentialFromTaggedObject(e)}static credentialFromError(e){return So.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return So.credential(t,s)}catch{return null}}}So.GOOGLE_SIGN_IN_METHOD="google.com";So.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Io extends Ef{constructor(){super("github.com")}static credential(e){return bc._fromParams({providerId:Io.PROVIDER_ID,signInMethod:Io.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Io.credentialFromTaggedObject(e)}static credentialFromError(e){return Io.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Io.credential(e.oauthAccessToken)}catch{return null}}}Io.GITHUB_SIGN_IN_METHOD="github.com";Io.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class To extends Ef{constructor(){super("twitter.com")}static credential(e,t){return bc._fromParams({providerId:To.PROVIDER_ID,signInMethod:To.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return To.credentialFromTaggedObject(e)}static credentialFromError(e){return To.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return To.credential(t,s)}catch{return null}}}To.TWITTER_SIGN_IN_METHOD="twitter.com";To.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cR(n,e){return _f(n,"POST","/v1/accounts:signUp",dl(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,s,i=!1){const a=await gi._fromIdTokenResponse(e,s,i),o=dI(s);return new qa({user:a,providerId:o,_tokenResponse:s,operationType:t})}static async _forOperation(e,t,s){await e._updateTokensIfNecessary(s,!0);const i=dI(s);return new qa({user:e,providerId:i,_tokenResponse:s,operationType:t})}}function dI(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xz(n){var i;if(gr(n.app))return Promise.reject(Qi(n));const e=ul(n);if(await e._initializationPromise,(i=e.currentUser)!=null&&i.isAnonymous)return new qa({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await cR(e,{returnSecureToken:!0}),s=await qa._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sx extends na{constructor(e,t,s,i){super(t.code,t.message),this.operationType=s,this.user=i,Object.setPrototypeOf(this,sx.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,i){return new sx(e,t,s,i)}}function dR(n,e,t,s){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(a=>{throw a.code==="auth/multi-factor-auth-required"?sx._fromErrorAndOperation(n,a,e,s):a})}async function Jz(n,e,t=!1){const s=await hu(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return qa._forOperation(n,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zz(n,e,t=!1){const{auth:s}=n;if(gr(s.app))return Promise.reject(Qi(s));const i="reauthenticate";try{const a=await hu(n,dR(s,i,e,n),t);ut(a.idToken,s,"internal-error");const o=zN(a.idToken);ut(o,s,"internal-error");const{sub:l}=o;return ut(n.uid===l,s,"user-mismatch"),qa._forOperation(n,i,a)}catch(a){throw(a==null?void 0:a.code)==="auth/user-not-found"&&wi(s,"user-mismatch"),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uR(n,e,t=!1){if(gr(n.app))return Promise.reject(Qi(n));const s="signIn",i=await dR(n,s,e),a=await qa._fromIdTokenResponse(n,s,i);return t||await n._updateCurrentUser(a.user),a}async function e$(n,e){return uR(ul(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hR(n){const e=ul(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function t$(n,e,t){if(gr(n.app))return Promise.reject(Qi(n));const s=ul(n),o=await mw(s,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",cR).catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&hR(n),c}),l=await qa._fromIdTokenResponse(s,"signIn",o);return await s._updateCurrentUser(l.user),l}function n$(n,e,t){return gr(n.app)?Promise.reject(Qi(n)):e$(mn(n),Ru.credential(e,t)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&hR(n),s})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s$(n,e){return Xa(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function r$(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const s=mn(n),a={idToken:await s.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await hu(s,s$(s.auth,a));s.displayName=o.displayName||null,s.photoURL=o.photoUrl||null;const l=s.providerData.find(({providerId:c})=>c==="password");l&&(l.displayName=s.displayName,l.photoURL=s.photoURL),await s._updateTokensIfNecessary(o)}function i$(n,e,t,s){return mn(n).onIdTokenChanged(e,t,s)}function a$(n,e,t){return mn(n).beforeAuthStateChanged(e,t)}function HN(n,e,t,s){return mn(n).onAuthStateChanged(e,t,s)}function o$(n){return mn(n).signOut()}const rx="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mR{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(rx,"1"),this.storage.removeItem(rx),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l$=1e3,c$=10;class fR extends mR{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=sR(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),i=this.localCache[t];s!==i&&e(t,i,s)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const s=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(s);!t&&this.localCache[s]===o||this.notifyListeners(s,o)},a=this.storage.getItem(s);Ez()&&a!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,c$):i()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},l$)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}fR.type="LOCAL";const d$=fR;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pR extends mR{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}pR.type="SESSION";const gR=pR;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u$(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ry{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const s=new ry(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:s,eventType:i,data:a}=t.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:i});const l=Array.from(o).map(async d=>d(t.origin,a)),c=await u$(l);t.ports[0].postMessage({status:"done",eventId:s,eventType:i,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ry.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GN(n="",e=10){let t="";for(let s=0;s<e;s++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h${constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,s=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let a,o;return new Promise((l,c)=>{const d=GN("",20);i.port1.start();const h=setTimeout(()=>{c(new Error("unsupported_event"))},s);o={messageChannel:i,onMessage(f){const p=f;if(p.data.eventId===d)switch(p.data.status){case"ack":clearTimeout(h),a=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(a),l(p.data.response);break;default:clearTimeout(h),clearTimeout(a),c(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wi(){return window}function m$(n){Wi().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xR(){return typeof Wi().WorkerGlobalScope<"u"&&typeof Wi().importScripts=="function"}async function f$(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function p$(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function g$(){return xR()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yR="firebaseLocalStorageDb",x$=1,ix="firebaseLocalStorage",bR="fbase_key";class Sf{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function iy(n,e){return n.transaction([ix],e?"readwrite":"readonly").objectStore(ix)}function y$(){const n=indexedDB.deleteDatabase(yR);return new Sf(n).toPromise()}function fw(){const n=indexedDB.open(yR,x$);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(ix,{keyPath:bR})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const s=n.result;s.objectStoreNames.contains(ix)?e(s):(s.close(),await y$(),e(await fw()))})})}async function uI(n,e,t){const s=iy(n,!0).put({[bR]:e,value:t});return new Sf(s).toPromise()}async function b$(n,e){const t=iy(n,!1).get(e),s=await new Sf(t).toPromise();return s===void 0?null:s.value}function hI(n,e){const t=iy(n,!0).delete(e);return new Sf(t).toPromise()}const w$=800,v$=3;class wR{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await fw(),this.db)}async _withRetries(e){let t=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(t++>v$)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return xR()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ry._getInstance(g$()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,s;if(this.activeServiceWorker=await f$(),!this.activeServiceWorker)return;this.sender=new h$(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(s=e[0])!=null&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||p$()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await fw();return await uI(e,rx,"1"),await hI(e,rx),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(s=>uI(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(s=>b$(s,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>hI(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const a=iy(i,!1).getAll();return new Sf(a).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],s=new Set;if(e.length!==0)for(const{fbase_key:i,value:a}of e)s.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(a)&&(this.notifyListeners(i,a),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!s.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),w$)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}wR.type="LOCAL";const N$=wR;new jf(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j$(n,e){return e?Ia(e):(ut(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QN extends BN{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ad(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ad(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ad(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function _$(n){return uR(n.auth,new QN(n),n.bypassAuthState)}function E$(n){const{auth:e,user:t}=n;return ut(t,e,"internal-error"),Zz(t,new QN(n),n.bypassAuthState)}async function S$(n){const{auth:e,user:t}=n;return ut(t,e,"internal-error"),Jz(t,new QN(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vR{constructor(e,t,s,i,a=!1){this.auth=e,this.resolver=s,this.user=i,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:s,postBody:i,tenantId:a,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:s,tenantId:a||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return _$;case"linkViaPopup":case"linkViaRedirect":return S$;case"reauthViaPopup":case"reauthViaRedirect":return E$;default:wi(this.auth,"internal-error")}}resolve(e){Ba(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ba(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I$=new jf(2e3,1e4);class yd extends vR{constructor(e,t,s,i,a){super(e,t,i,a),this.provider=s,this.authWindow=null,this.pollId=null,yd.currentPopupAction&&yd.currentPopupAction.cancel(),yd.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ut(e,this.auth,"internal-error"),e}async onExecution(){Ba(this.filter.length===1,"Popup operations only handle one event");const e=GN();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Gi(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Gi(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,yd.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,s;if((s=(t=this.authWindow)==null?void 0:t.window)!=null&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Gi(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,I$.get())};e()}}yd.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T$="pendingRedirect",Zp=new Map;class C$ extends vR{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}async execute(){let e=Zp.get(this.auth._key());if(!e){try{const s=await A$(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(t){e=()=>Promise.reject(t)}Zp.set(this.auth._key(),e)}return this.bypassAuthState||Zp.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function A$(n,e){const t=P$(e),s=R$(n);if(!await s._isAvailable())return!1;const i=await s._get(t)==="true";return await s._remove(t),i}function D$(n,e){Zp.set(n._key(),e)}function R$(n){return Ia(n._redirectPersistence)}function P$(n){return Jp(T$,n.config.apiKey,n.name)}async function k$(n,e,t=!1){if(gr(n.app))return Promise.reject(Qi(n));const s=ul(n),i=j$(s,e),o=await new C$(s,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O$=10*60*1e3;class M${constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!L$(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var s;if(e.error&&!NR(e)){const i=((s=e.error.code)==null?void 0:s.split("auth/")[1])||"internal-error";t.onError(Gi(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=O$&&this.cachedEventUids.clear(),this.cachedEventUids.has(mI(e))}saveEventToCache(e){this.cachedEventUids.add(mI(e)),this.lastProcessedEventTime=Date.now()}}function mI(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function NR({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function L$(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return NR(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function F$(n,e={}){return Xa(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U$=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,V$=/^https?/;async function z$(n){if(n.config.emulator)return;const{authorizedDomains:e}=await F$(n);for(const t of e)try{if($$(t))return}catch{}wi(n,"unauthorized-domain")}function $$(n){const e=uw(),{protocol:t,hostname:s}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&s===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===s}if(!V$.test(t))return!1;if(U$.test(n))return s===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B$=new jf(3e4,6e4);function fI(){const n=Wi().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function q$(n){return new Promise((e,t)=>{var i,a,o;function s(){fI(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{fI(),t(Gi(n,"network-request-failed"))},timeout:B$.get()})}if((a=(i=Wi().gapi)==null?void 0:i.iframes)!=null&&a.Iframe)e(gapi.iframes.getContext());else if((o=Wi().gapi)!=null&&o.load)s();else{const l=kz("iframefcb");return Wi()[l]=()=>{gapi.load?s():t(Gi(n,"network-request-failed"))},iR(`${Pz()}?onload=${l}`).catch(c=>t(c))}}).catch(e=>{throw eg=null,e})}let eg=null;function H$(n){return eg=eg||q$(n),eg}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G$=new jf(5e3,15e3),Q$="__/auth/iframe",W$="emulator/auth/iframe",K$={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Y$=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function X$(n){const e=n.config;ut(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?VN(e,W$):`https://${n.config.authDomain}/${Q$}`,s={apiKey:e.apiKey,appName:n.name,v:_c},i=Y$.get(n.config.apiHost);i&&(s.eid=i);const a=n._getFrameworks();return a.length&&(s.fw=a.join(",")),`${t}?${cf(s).slice(1)}`}async function J$(n){const e=await H$(n),t=Wi().gapi;return ut(t,n,"internal-error"),e.open({where:document.body,url:X$(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:K$,dontclear:!0},s=>new Promise(async(i,a)=>{await s.restyle({setHideOnLeave:!1});const o=Gi(n,"network-request-failed"),l=Wi().setTimeout(()=>{a(o)},G$.get());function c(){Wi().clearTimeout(l),i(s)}s.ping(c).then(c,()=>{a(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z$={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},e8=500,t8=600,n8="_blank",s8="http://localhost";class pI{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function r8(n,e,t,s=e8,i=t8){const a=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let l="";const c={...Z$,width:s.toString(),height:i.toString(),top:a,left:o},d=ps().toLowerCase();t&&(l=JD(d)?n8:t),YD(d)&&(e=e||s8,c.scrollbars="yes");const h=Object.entries(c).reduce((p,[x,I])=>`${p}${x}=${I},`,"");if(_z(d)&&l!=="_self")return i8(e||"",l),new pI(null);const f=window.open(e||"",l,h);ut(f,n,"popup-blocked");try{f.focus()}catch{}return new pI(f)}function i8(n,e){const t=document.createElement("a");t.href=n,t.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a8="__/auth/handler",o8="emulator/auth/handler",l8=encodeURIComponent("fac");async function gI(n,e,t,s,i,a){ut(n.config.authDomain,n,"auth-domain-config-required"),ut(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:s,v:_c,eventId:i};if(e instanceof lR){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",X3(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries({}))o[h]=f}if(e instanceof Ef){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const l=o;for(const h of Object.keys(l))l[h]===void 0&&delete l[h];const c=await n._getAppCheckToken(),d=c?`#${l8}=${encodeURIComponent(c)}`:"";return`${c8(n)}?${cf(l).slice(1)}${d}`}function c8({config:n}){return n.emulator?VN(n,o8):`https://${n.authDomain}/${a8}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ib="webStorageSupport";class d8{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=gR,this._completeRedirectFn=k$,this._overrideRedirectResult=D$}async _openPopup(e,t,s,i){var o;Ba((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const a=await gI(e,t,s,uw(),i);return r8(e,a,GN())}async _openRedirect(e,t,s,i){await this._originValidation(e);const a=await gI(e,t,s,uw(),i);return m$(a),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:a}=this.eventManagers[t];return i?Promise.resolve(i):(Ba(a,"If manager is not set, promise should be"),a)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){const t=await J$(e),s=new M$(e);return t.register("authEvent",i=>(ut(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:s.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ib,{type:Ib},i=>{var o;const a=(o=i==null?void 0:i[0])==null?void 0:o[Ib];a!==void 0&&t(!!a),wi(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=z$(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return sR()||XD()||$N()}}const u8=d8;var xI="@firebase/auth",yI="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h8{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ut(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m8(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function f8(n){dc(new Zo("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=s.options;ut(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const c={apiKey:o,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:rR(n)},d=new Az(s,i,a,c);return Vz(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),dc(new Zo("auth-internal",e=>{const t=ul(e.getProvider("auth").getImmediate());return(s=>new h8(s))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Bi(xI,yI,m8(n)),Bi(xI,yI,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p8=5*60,g8=KC("authIdTokenMaxAge")||p8;let bI=null;const x8=n=>async e=>{const t=e&&await e.getIdTokenResult(),s=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>g8)return;const i=t==null?void 0:t.token;bI!==i&&(bI=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function jR(n=Tv()){const e=df(n,"auth");if(e.isInitialized())return e.getImmediate();const t=Uz(n,{popupRedirectResolver:u8,persistence:[N$,d$,gR]}),s=KC("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const a=new URL(s,location.origin);if(location.origin===a.origin){const o=x8(a.toString());a$(t,o,()=>o(t.currentUser)),i$(t,l=>o(l))}}const i=GC("auth");return i&&zz(t,`http://${i}`),t}function y8(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}Dz({loadJS(n){return new Promise((e,t)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=e,s.onerror=i=>{const a=Gi("internal-error");a.customData=i,t(a)},s.type="text/javascript",s.charset="UTF-8",y8().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});f8("Browser");let pw;try{pw={apiKey:"AIzaSyCF4OZxfGELDmooid5mAL51l0t7Cxx6W3k",authDomain:"tender-74a2b.firebaseapp.com",projectId:"tender-74a2b",storageBucket:"tender-74a2b.firebasestorage.app",messagingSenderId:"300993197682",appId:"1:300993197682:web:e75fab78c4d6afc91ff4eb",measurementId:"G-D2CYMMNSB8"}}catch(n){console.error("Error loading Firebase config:",n),pw={}}let sd,pe,xr,It;try{console.log("Initializing Firebase..."),sd=Iv(pw);try{pe=_6(sd),console.log(" Firestore initialized")}catch(n){console.error("Firestore initialization error:",n),pe=null}try{xr=zD(sd),console.log(" Storage initialized")}catch(n){console.error("Storage initialization error:",n),xr=null}try{It=jR(sd),console.log(" Auth initialized")}catch(n){console.error("Auth initialization error:",n),It=null}console.log(" Firebase initialization completed")}catch(n){console.error(" Critical Firebase initialization error:",n),sd=null,pe=null,xr=null,It=null}window.addEventListener("unhandledrejection",n=>{n.reason&&n.reason.message&&(n.reason.message.includes("_getRecaptchaConfig")||n.reason.message.includes("client is offline")||n.reason.message.includes("auth/network-request-failed"))&&(console.log(" Suppressed Firebase error:",n.reason.message),n.preventDefault())});console.log(" Firebase services status:",{app:!!sd,database:!!pe,storage:!!xr,auth:!!It});class WN{constructor(e){this.collectionName=e,this.collectionRef=Qe(pe,e)}getCurrentUserId(){const e=It.currentUser;if(!e)throw new Error("User not authenticated");return e.uid}addOwnershipFields(e,t=!1){const i={ownerId:this.getCurrentUserId(),updatedAt:it(),version:t?_D(1):1};return t||(i.createdAt=it()),{...e,...i}}async create(e,t={}){try{console.log(` Creating document in ${this.collectionName}:`,e);const s=this.addOwnershipFields(e,!1),i={id:crypto.randomUUID(),...s,createdAt:new Date,updatedAt:new Date,version:1,_optimistic:!0};t.onOptimisticUpdate&&t.onOptimisticUpdate(i);try{const a=await Ys(this.collectionRef,s);console.log(` Document created in Firestore: ${a.id}`);const o=await this.getById(a.id);return t.updateCache&&this.updateCache(o),t.onSuccess&&t.onSuccess(o),o}catch(a){throw console.error(` Firestore create failed for ${this.collectionName}:`,a),t.onRollback&&t.onRollback(i),a}}catch(s){throw console.error("Error in create operation:",s),new Error(`   ${this.collectionName}: ${s.message}`)}}async update(e,t,s={}){try{console.log(` Updating document ${e} in ${this.collectionName}:`,t);const i=Ye(pe,this.collectionName,e),a=await Un(i);if(!a.exists())throw new Error("Document not found");const o=a.data(),l=this.getCurrentUserId();if(o.ownerId!==l)throw new Error("Unauthorized to update this document");const c=this.addOwnershipFields(t,!0),d={id:e,...o,...t,updatedAt:new Date,version:(o.version||1)+1,_optimistic:!0};s.onOptimisticUpdate&&s.onOptimisticUpdate(d);try{await gs(i,c),console.log(` Document updated in Firestore: ${e}`);const h=await this.getById(e);return s.updateCache&&this.updateCache(h),s.onSuccess&&s.onSuccess(h),h}catch(h){throw console.error(` Firestore update failed for ${this.collectionName}:`,h),s.onRollback&&s.onRollback(o),h}}catch(i){throw i.message==="Document not found"?console.log(` Document not found in ${this.collectionName} - will be handled by caller`):console.error("Error in update operation:",i),new Error(`   ${this.collectionName}: ${i.message}`)}}async delete(e,t={}){try{console.log(` Deleting document ${e} from ${this.collectionName}`);const s=Ye(pe,this.collectionName,e),i=await Un(s);if(!i.exists())throw new Error("Document not found");const a=i.data(),o=this.getCurrentUserId();if(a.ownerId!==o)throw new Error("Unauthorized to delete this document");t.onOptimisticUpdate&&t.onOptimisticUpdate(null);try{return await xs(s),console.log(` Document deleted from Firestore: ${e}`),t.updateCache&&this.removeFromCache(e),t.onSuccess&&t.onSuccess(),!0}catch(l){throw console.error(` Firestore delete failed for ${this.collectionName}:`,l),t.onRollback&&t.onRollback(a),l}}catch(s){throw console.error("Error in delete operation:",s),new Error(`   ${this.collectionName}: ${s.message}`)}}async getById(e){var t,s;try{const i=Ye(pe,this.collectionName,e),a=await Un(i);if(a.exists()){const o=a.data(),l=this.getCurrentUserId();if(o.ownerId!==l)throw new Error("Unauthorized to access this document");return{id:a.id,...o,createdAt:(t=o.createdAt)==null?void 0:t.toDate(),updatedAt:(s=o.updatedAt)==null?void 0:s.toDate()}}else return null}catch(i){throw console.error("Error fetching document by ID:",i),new Error(`   ${this.collectionName}: ${i.message}`)}}async getAll(e={}){try{const t=this.getCurrentUserId();let s=pt(this.collectionRef,qt("ownerId","==",t));e.limit&&(s=pt(s,R6(e.limit)));const a=(await lt(s)).docs.map(o=>{var c,d;const l=o.data();return{id:o.id,...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}});return console.log(` Retrieved ${a.length} documents from ${this.collectionName}`),e.updateCache&&this.setCacheAll(a),a}catch(t){throw console.error("Error fetching all documents:",t),new Error(`   ${this.collectionName}: ${t.message}`)}}async search(e,t=[],s={}){try{const i=this.getCurrentUserId(),a=pt(this.collectionRef,qt("ownerId","==",i)),c=(await lt(a)).docs.map(d=>{var f,p;const h=d.data();return{id:d.id,...h,createdAt:(f=h.createdAt)==null?void 0:f.toDate(),updatedAt:(p=h.updatedAt)==null?void 0:p.toDate()}}).filter(d=>t.some(h=>{const f=d[h];return typeof f=="string"?f.toLowerCase().includes(e.toLowerCase()):!1}));return console.log(` Found ${c.length} matching documents in ${this.collectionName}`),c}catch(i){throw console.error("Error searching documents:",i),new Error(`    ${this.collectionName}: ${i.message}`)}}async batchOperation(e){try{const t=ka(pe),s=this.getCurrentUserId();for(const i of e){const{type:a,id:o,data:l}=i;if(a==="create"){const c=Ye(this.collectionRef),d=this.addOwnershipFields(l,!1);t.set(c,d)}else if(a==="update"){const c=Ye(pe,this.collectionName,o),d=await Un(c);if(d.exists()&&d.data().ownerId!==s)throw new Error(`Unauthorized to update document ${o}`);const h=this.addOwnershipFields(l,!0);t.update(c,h)}else if(a==="delete"){const c=Ye(pe,this.collectionName,o),d=await Un(c);if(d.exists()&&d.data().ownerId!==s)throw new Error(`Unauthorized to delete document ${o}`);t.delete(c)}}return await t.commit(),console.log(` Batch operation completed for ${this.collectionName}`),!0}catch(t){throw console.error("Error in batch operation:",t),new Error(`     ${this.collectionName}: ${t.message}`)}}getCacheKey(){return`firestore_cache_${this.collectionName}`}updateCache(e){try{const t=this.getCacheKey(),s=JSON.parse(localStorage.getItem(t)||"[]"),i=s.findIndex(a=>a.id===e.id);i>=0?s[i]={...e,_cached:!0,_cachedAt:Date.now(),_checksum:this.generateChecksum(e)}:s.push({...e,_cached:!0,_cachedAt:Date.now(),_checksum:this.generateChecksum(e)}),localStorage.setItem(t,JSON.stringify(s))}catch(t){console.warn("Cache update failed:",t)}}setCacheAll(e){try{const t=this.getCacheKey(),s=e.map(i=>({...i,_cached:!0,_cachedAt:Date.now(),_checksum:this.generateChecksum(i)}));localStorage.setItem(t,JSON.stringify(s))}catch(t){console.warn("Cache set all failed:",t)}}removeFromCache(e){try{const t=this.getCacheKey(),i=JSON.parse(localStorage.getItem(t)||"[]").filter(a=>a.id!==e);localStorage.setItem(t,JSON.stringify(i))}catch(t){console.warn("Cache remove failed:",t)}}getFromCache(){try{const e=this.getCacheKey(),t=localStorage.getItem(e);return t?JSON.parse(t):[]}catch(e){return console.warn("Cache read failed:",e),[]}}generateChecksum(e){const t=JSON.stringify(e);let s=0;for(let i=0;i<t.length;i++){const a=t.charCodeAt(i);s=(s<<5)-s+a,s=s&s}return s.toString()}validateCacheIntegrity(e,t){const s=e._checksum,i=this.generateChecksum(t);return s===i}}const b8="modulepreload",w8=function(n){return"/"+n},wI={},ns=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(t.map(c=>{if(c=w8(c),c in wI)return;wI[c]=!0;const d=c.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":b8,d||(f.as="script"),f.crossOrigin="",f.href=c,l&&f.setAttribute("nonce",l),document.head.appendChild(f),d)return new Promise((p,x)=>{f.addEventListener("load",p),f.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${c}`)))})}))}function a(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&a(l.reason);return e().catch(a)})};let gw;try{gw={apiKey:"AIzaSyCF4OZxfGELDmooid5mAL51l0t7Cxx6W3k",authDomain:"tender-74a2b.firebaseapp.com",projectId:"tender-74a2b",storageBucket:"tender-74a2b.firebasestorage.app",messagingSenderId:"300993197682",appId:"1:300993197682:web:e75fab78c4d6afc91ff4eb",measurementId:"G-D2CYMMNSB8"}}catch(n){console.error("Error loading Firebase config:",n),gw={}}let rd,am,tg,Ki;try{console.log(" Initializing Firebase with offline persistence..."),rd=Iv(gw);try{am=j6(rd,{localCache:M6({tabManager:V6()}),ignoreUndefinedProperties:!0}),console.log(" Firestore initialized with offline persistence")}catch(n){console.error(" Firestore initialization error:",n),am=null}try{tg=zD(rd),console.log(" Storage initialized")}catch(n){console.error(" Storage initialization error:",n),tg=null}try{Ki=jR(rd),console.log(" Auth initialized")}catch(n){console.error(" Auth initialization error:",n),Ki=null}console.log(" Firebase initialization completed with offline persistence")}catch(n){console.error(" Critical Firebase initialization error:",n),rd=null,am=null,tg=null,Ki=null}window.addEventListener("unhandledrejection",n=>{if(n.reason&&n.reason.message){const e=n.reason.message.toLowerCase();(e.includes("_getrecaptchaconfig")||e.includes("client is offline")||e.includes("auth/network-request-failed")||e.includes("failed to get document because the client is offline")||e.includes("the operation was aborted"))&&(console.log(" Suppressed Firebase error:",n.reason.message),n.preventDefault())}});console.log(" Firebase services status:",{app:!!rd,database:!!am,storage:!!tg,auth:!!Ki,offlinePersistence:!!am});class v8 extends WN{constructor(){super("usersettings"),this.currentUserId=null,this.settings={},this.listeners=new Set}async initialize(){try{if(!Ki.currentUser)throw new Error("User not authenticated");return this.currentUserId=Ki.currentUser.uid,await this.loadSettings(),this.settings}catch(e){return console.error("Error initializing user settings:",e),{}}}async loadSettings(){try{if(!this.currentUserId)throw new Error("User not initialized");const e=await this.getById(this.currentUserId);return e?this.settings=e.settings||{}:await this.createDefaultSettings(),this.notifyListeners(),this.settings}catch(e){return console.error("Error loading settings:",e),{}}}async createDefaultSettings(){try{const e={activityTimelineVisible:!1,sidebarCollapsed:!1,theme:"light",language:"ar",tablePageSize:10,defaultOrderBy:"createdAt",defaultSortDirection:"desc",showNotifications:!0,notificationSound:!0,autoSaveForms:!0,confirmBeforeDelete:!0,showHelpTips:!0,compactMode:!1},t={userId:this.currentUserId,settings:e,version:1};return await this.create(t),this.settings=e,e}catch(e){return console.error("Error creating default settings:",e),{}}}getSetting(e,t=null){return this.settings[e]!==void 0?this.settings[e]:t}async setSetting(e,t){try{this.currentUserId||await this.initialize(),this.settings[e]=t,this.notifyListeners();const s={...this.settings,[e]:t};try{await this.update(this.currentUserId,{settings:s,lastUpdated:new Date})}catch(i){if(i.message.includes("Document not found"))console.log(" Creating new user settings document for:",this.currentUserId),await this.create({id:this.currentUserId,ownerId:this.currentUserId,settings:s,createdAt:new Date,lastUpdated:new Date}),console.log(" User settings document created successfully");else throw i}return console.log(` Setting updated: ${e} = ${t}`),!0}catch(s){return console.error(`Error setting ${e}:`,s),delete this.settings[e],this.notifyListeners(),!1}}async setSettings(e){try{this.currentUserId||await this.initialize();const t={...this.settings};Object.assign(this.settings,e),this.notifyListeners();const s={...this.settings,...e};return await this.update(this.currentUserId,{settings:s,lastUpdated:new Date}),console.log(" Multiple settings updated:",Object.keys(e)),!0}catch(t){return console.error("Error setting multiple settings:",t),this.settings=oldSettings,this.notifyListeners(),!1}}async resetSettings(){try{return await this.createDefaultSettings(),await this.update(this.currentUserId,{settings:this.settings,lastUpdated:new Date}),console.log(" Settings reset to defaults"),!0}catch(e){return console.error("Error resetting settings:",e),!1}}addListener(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(){this.listeners.forEach(e=>{try{e(this.settings)}catch(t){console.error("Error in settings listener:",t)}})}exportSettings(){return{userId:this.currentUserId,settings:this.settings,exportedAt:new Date().toISOString()}}async importSettings(e){try{return e.settings?(await this.setSettings(e.settings),console.log(" Settings imported successfully"),!0):!1}catch(t){return console.error("Error importing settings:",t),!1}}async setActivityTimelineVisible(e){return await this.setSetting("activityTimelineVisible",e)}getActivityTimelineVisible(){return this.getSetting("activityTimelineVisible",!1)}async setSidebarCollapsed(e){return await this.setSetting("sidebarCollapsed",e)}getSidebarCollapsed(){return this.getSetting("sidebarCollapsed",!1)}async setTheme(e){return await this.setSetting("theme",e)}getTheme(){return this.getSetting("theme","light")}async setTablePageSize(e){return await this.setSetting("tablePageSize",e)}getTablePageSize(){return this.getSetting("tablePageSize",10)}}const wr=new v8;Ki.onAuthStateChanged(async n=>{if(n)try{await wr.initialize(),console.log(" User settings initialized")}catch(e){console.error("Error initializing user settings:",e)}else wr.currentUserId=null,wr.settings={}});const _R=b.createContext(),gn=()=>{const n=b.useContext(_R);if(!n)throw new Error("useActivityTimeline must be used within an ActivityTimelineProvider");return n},N8=({children:n})=>{const[e,t]=b.useState(!1),[s,i]=b.useState(!0);b.useEffect(()=>{(async()=>{try{await wr.initialize();const c=wr.getActivityTimelineVisible();t(c),console.log(" Activity timeline visibility loaded from Firestore:",c)}catch(c){console.warn(" Firestore initialization failed, using fallback strategies:",c.message);try{const h=localStorage.getItem("activityTimelineVisible")==="true";t(h),console.log(" Fallback: Timeline state loaded from localStorage:",h)}catch(d){console.warn(" localStorage fallback failed, using defaults:",d.message),t(!1),console.log(" Using default timeline state: false")}}finally{i(!1),console.log(" Timeline initialization completed")}})()},[]),b.useEffect(()=>{const c=setTimeout(async()=>{if(!s)try{await wr.setActivityTimelineVisible(e),console.log(" Activity timeline visibility saved to Firestore:",e)}catch(d){console.warn(" Failed to save timeline state to Firestore (non-critical):",d.message);try{localStorage.setItem("activityTimelineVisible",e.toString()),console.log(" Fallback: Timeline state saved to localStorage")}catch(h){console.warn(" localStorage fallback also failed:",h.message)}}},500);return()=>clearTimeout(c)},[e,s]);const o={isTimelineVisible:e,setIsTimelineVisible:t,toggleTimeline:async()=>{const l=!e;t(l);try{await wr.setActivityTimelineVisible(l),console.log(" Timeline toggle saved to Firestore:",l)}catch(c){console.warn(" Failed to save timeline toggle to Firestore (non-critical):",c.message);try{localStorage.setItem("activityTimelineVisible",l.toString()),console.log(" Fallback: Timeline toggle saved to localStorage")}catch(d){console.warn(" localStorage fallback failed:",d.message)}}},loading:s};return r.jsx(_R.Provider,{value:o,children:n})};class pr{static async getAllCategories(){try{const e=pt(Qe(pe,this.CATEGORIES_COLLECTION),$n("name","asc")),t=await lt(e),s=[];return t.forEach(i=>{s.push({id:i.id,...i.data()})}),console.log(" Loaded categories:",s.length),s}catch(e){throw console.error(" Error loading categories:",e),new Error("   ")}}static async createCategory(e){try{const t={...e,createdAt:it(),updatedAt:it()},s=await Ys(Qe(pe,this.CATEGORIES_COLLECTION),t);return console.log(" Category created:",s.id),s.id}catch(t){throw console.error(" Error creating category:",t),new Error("   ")}}static async updateCategory(e,t){try{const s={...t,updatedAt:it()};return await gs(Ye(pe,this.CATEGORIES_COLLECTION,e),s),console.log(" Category updated:",e),!0}catch(s){throw console.error(" Error updating category:",s),new Error("   ")}}static async deleteCategory(e){try{return await xs(Ye(pe,this.CATEGORIES_COLLECTION,e)),console.log(" Category deleted:",e),!0}catch(t){throw console.error(" Error deleting category:",t),new Error("   ")}}static async getAllUnits(){try{const e=pt(Qe(pe,this.UNITS_COLLECTION),$n("name","asc")),t=await lt(e),s=[];return t.forEach(i=>{s.push({id:i.id,...i.data()})}),console.log(" Loaded units:",s.length),s}catch(e){throw console.error(" Error loading units:",e),new Error("   ")}}static async createUnit(e){try{const t={...e,createdAt:it(),updatedAt:it()},s=await Ys(Qe(pe,this.UNITS_COLLECTION),t);return console.log(" Unit created:",s.id),s.id}catch(t){throw console.error(" Error creating unit:",t),new Error("   ")}}static async updateUnit(e,t){try{const s={...t,updatedAt:it()};return await gs(Ye(pe,this.UNITS_COLLECTION,e),s),console.log(" Unit updated:",e),!0}catch(s){throw console.error(" Error updating unit:",s),new Error("   ")}}static async deleteUnit(e){try{return await xs(Ye(pe,this.UNITS_COLLECTION,e)),console.log(" Unit deleted:",e),!0}catch(t){throw console.error(" Error deleting unit:",t),new Error("   ")}}static async getCategoryNames(){try{return(await this.getAllCategories()).map(t=>t.name)}catch(e){return console.error(" Error loading category names:",e),[]}}static async getUnitNames(){try{return(await this.getAllUnits()).map(t=>t.name)}catch(e){return console.error(" Error loading unit names:",e),[]}}static async initializeDefaultSettings(){try{if(console.log(" Initializing default settings..."),(await this.getAllCategories()).length===0){console.log(" Creating default categories...");const s=[{name:" ",description:"  ",isDefault:!0},{name:" ",description:"  ",isDefault:!0},{name:" ",description:"  ",isDefault:!0},{name:" ",description:"  ",isDefault:!0},{name:" ",description:"  ",isDefault:!0}];for(const i of s)await this.createCategory(i);console.log(" Default categories created")}if((await this.getAllUnits()).length===0){console.log(" Creating default units...");const s=[{name:"",description:" ",isDefault:!0},{name:"",description:" ",isDefault:!0},{name:" ",description:" ",isDefault:!0},{name:" ",description:" ",isDefault:!0},{name:" ",description:" ",isDefault:!0},{name:"",description:" ",isDefault:!0},{name:"",description:"  ",isDefault:!0},{name:"",description:" ",isDefault:!0}];for(const i of s)await this.createUnit(i);console.log(" Default units created")}return console.log(" Settings initialization completed"),!0}catch(e){throw console.error(" Error initializing default settings:",e),new Error("    ")}}}ur(pr,"CATEGORIES_COLLECTION","global_categories"),ur(pr,"UNITS_COLLECTION","global_units");const Kn={SET_LOADING:"SET_LOADING",SET_ERROR:"SET_ERROR",SET_CATEGORIES:"SET_CATEGORIES",SET_UNITS:"SET_UNITS",ADD_CATEGORY:"ADD_CATEGORY",UPDATE_CATEGORY:"UPDATE_CATEGORY",REMOVE_CATEGORY:"REMOVE_CATEGORY",ADD_UNIT:"ADD_UNIT",UPDATE_UNIT:"UPDATE_UNIT",REMOVE_UNIT:"REMOVE_UNIT",SET_INITIALIZED:"SET_INITIALIZED"},j8={categories:[],units:[],loading:{categories:!0,units:!0,initializing:!0},error:{categories:null,units:null},initialized:!1,lastUpdated:{categories:null,units:null}},_8=(n,e)=>{switch(e.type){case Kn.SET_LOADING:return{...n,loading:{...n.loading,[e.payload.type]:e.payload.loading}};case Kn.SET_ERROR:return{...n,error:{...n.error,[e.payload.type]:e.payload.error}};case Kn.SET_CATEGORIES:return{...n,categories:e.payload,loading:{...n.loading,categories:!1},error:{...n.error,categories:null},lastUpdated:{...n.lastUpdated,categories:new Date().toISOString()}};case Kn.SET_UNITS:return{...n,units:e.payload,loading:{...n.loading,units:!1},error:{...n.error,units:null},lastUpdated:{...n.lastUpdated,units:new Date().toISOString()}};case Kn.ADD_CATEGORY:return{...n,categories:[...n.categories,e.payload].sort((t,s)=>t.name.localeCompare(s.name)),lastUpdated:{...n.lastUpdated,categories:new Date().toISOString()}};case Kn.UPDATE_CATEGORY:return{...n,categories:n.categories.map(t=>t.id===e.payload.id?{...t,...e.payload.data}:t).sort((t,s)=>t.name.localeCompare(s.name)),lastUpdated:{...n.lastUpdated,categories:new Date().toISOString()}};case Kn.REMOVE_CATEGORY:return{...n,categories:n.categories.filter(t=>t.id!==e.payload),lastUpdated:{...n.lastUpdated,categories:new Date().toISOString()}};case Kn.ADD_UNIT:return{...n,units:[...n.units,e.payload].sort((t,s)=>t.name.localeCompare(s.name)),lastUpdated:{...n.lastUpdated,units:new Date().toISOString()}};case Kn.UPDATE_UNIT:return{...n,units:n.units.map(t=>t.id===e.payload.id?{...t,...e.payload.data}:t).sort((t,s)=>t.name.localeCompare(s.name)),lastUpdated:{...n.lastUpdated,units:new Date().toISOString()}};case Kn.REMOVE_UNIT:return{...n,units:n.units.filter(t=>t.id!==e.payload),lastUpdated:{...n.lastUpdated,units:new Date().toISOString()}};case Kn.SET_INITIALIZED:return{...n,initialized:!0,loading:{...n.loading,initializing:!1}};default:return n}},ER=b.createContext(),E8=({children:n})=>{const[e,t]=b.useReducer(_8,j8);b.useEffect(()=>{console.log(" Setting up real-time Firebase listeners for global settings...");let c,d;return(async()=>{try{await pr.initializeDefaultSettings();const f=pt(Qe(pe,pr.CATEGORIES_COLLECTION),$n("name","asc"));c=Vm(f,x=>{console.log(" Categories updated from Firebase:",x.docs.length);const I=x.docs.map(D=>({id:D.id,...D.data()}));t({type:Kn.SET_CATEGORIES,payload:I})},x=>{console.error(" Categories listener error:",x),t({type:Kn.SET_ERROR,payload:{type:"categories",error:x.message}})});const p=pt(Qe(pe,pr.UNITS_COLLECTION),$n("name","asc"));d=Vm(p,x=>{console.log(" Units updated from Firebase:",x.docs.length);const I=x.docs.map(D=>({id:D.id,...D.data()}));t({type:Kn.SET_UNITS,payload:I})},x=>{console.error(" Units listener error:",x),t({type:Kn.SET_ERROR,payload:{type:"units",error:x.message}})}),t({type:Kn.SET_INITIALIZED}),console.log(" Real-time listeners initialized successfully")}catch(f){console.error(" Failed to setup Firebase listeners:",f),t({type:Kn.SET_ERROR,payload:{type:"categories",error:"Failed to initialize settings"}}),t({type:Kn.SET_ERROR,payload:{type:"units",error:"Failed to initialize settings"}})}})(),()=>{console.log(" Cleaning up Firebase listeners..."),c&&c(),d&&d()}},[]),b.useEffect(()=>{const c=d=>{d.key==="settings_force_refresh"&&console.log(" Cross-tab settings refresh triggered")};return window.addEventListener("storage",c),()=>window.removeEventListener("storage",c)},[]);const s=b.useCallback((c,d)=>{t({type:Kn.UPDATE_CATEGORY,payload:{id:c,data:d}})},[]),i=b.useCallback((c,d)=>{t({type:Kn.UPDATE_UNIT,payload:{id:c,data:d}})},[]),a=b.useMemo(()=>({getCategoryNames:()=>e.categories.map(c=>c.name),getUnitNames:()=>e.units.map(c=>c.name),getCategoriesWithDetails:()=>e.categories.map(c=>({value:c.name,label:c.name,description:c.description,isDefault:c.isDefault})),getUnitsWithDetails:()=>e.units.map(c=>({value:c.name,label:c.name,name:c.name,description:c.description,isDefault:c.isDefault})),findCategoryByName:c=>e.categories.find(d=>d.name===c),findUnitByName:c=>e.units.find(d=>d.name===c),isReady:()=>e.initialized&&!e.loading.categories&&!e.loading.units,isLoading:()=>e.loading.categories||e.loading.units||e.loading.initializing}),[e.categories,e.units,e.initialized,e.loading]),o=b.useCallback(()=>{console.log(" Force refreshing settings...");const c=new CustomEvent("settings_force_refresh",{detail:{timestamp:Date.now()}});window.dispatchEvent(c)},[]),l=b.useMemo(()=>({categories:e.categories,units:e.units,loading:e.loading,error:e.error,initialized:e.initialized,lastUpdated:e.lastUpdated,...a,dispatch:t,optimisticCategoryUpdate:s,optimisticUnitUpdate:i,forceRefresh:o,ACTIONS:Kn}),[e,a,s,i,o]);return r.jsx(ER.Provider,{value:l,children:n})},If=()=>{const n=b.useContext(ER);return n||(console.warn("useSettings must be used within a SettingsProvider - returning default values"),{categories:[],units:[],loading:{categories:!0,units:!0,initializing:!0},error:{categories:null,units:null},initialized:!1,lastUpdated:{categories:null,units:null},getCategoryNames:()=>[],getUnitNames:()=>[],getCategoriesWithDetails:()=>[],getUnitsWithDetails:()=>[],findCategoryByName:()=>null,findUnitByName:()=>null,isReady:()=>!1,isLoading:()=>!0,dispatch:()=>{},optimisticCategoryUpdate:()=>{},optimisticUnitUpdate:()=>{},forceRefresh:()=>{},ACTIONS:Kn})},S8=()=>{const n=If(),{categories:e=[],getCategoryNames:t=()=>[],getCategoriesWithDetails:s=()=>[],findCategoryByName:i=()=>null,loading:a={categories:!0},error:o={categories:null},isReady:l=()=>!1}=n||{};return b.useMemo(()=>({categories:e,categoryNames:t(),categoriesWithDetails:s(),findByName:i,loading:a.categories||!1,error:o.categories,isReady:l()&&e.length>0}),[e,t,s,i,a.categories,o.categories,l])},I8=()=>{const n=If(),{units:e=[],getUnitNames:t=()=>[],getUnitsWithDetails:s=()=>[],findUnitByName:i=()=>null,loading:a={units:!0},error:o={units:null},isReady:l=()=>!1}=n||{};return b.useMemo(()=>({units:e,unitNames:t(),unitsWithDetails:s(),findByName:i,loading:a.units||!1,error:o.units,isReady:l()&&e.length>0}),[e,t,s,i,a.units,o.units,l])},an=({show:n=!0,size:e="medium",overlay:t=!0,message:s=" ..."})=>{if(!n)return null;const i=()=>{switch(e){case"small":return"spinner-small";case"large":return"spinner-large";default:return"spinner-medium"}},a=r.jsxs("div",{className:`modern-spinner-container ${i()}`,children:[r.jsxs("div",{className:"modern-spinner",children:[r.jsx("div",{className:"spinner-ring"}),r.jsx("div",{className:"spinner-ring"}),r.jsx("div",{className:"spinner-ring"}),r.jsx("div",{className:"spinner-ring"})]}),s&&r.jsx("div",{className:"spinner-message",children:s})]});return t?r.jsx("div",{className:"modern-spinner-overlay",children:a}):a},SR=b.createContext(),KN=()=>{const n=b.useContext(SR);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n},T8=({children:n})=>{const[e,t]=b.useState(null),[s,i]=b.useState(null),[a,o]=b.useState(!0),[l,c]=b.useState(null),d=async p=>{try{if(!p)return i(null),null;const x=Ye(pe,"employees",p.uid),I=await Un(x);if(console.log(" Employee doc exists:",I.exists()),!I.exists())return console.warn(" No employee record found for user:",p.uid),console.warn(" This usually means the employee document was not created with the Auth UID"),console.log(' To fix: Run window.createEmployeeForUser("'+p.uid+'") in console'),c("       -      "),null;const D=I.data();return console.log(" Employee data:",D),D.status!=="active"?(console.warn(" Employee account is not active:",D.status),c("  .    "),null):(console.log(" Employee access granted:",{uid:p.uid,name:D.fullName,email:D.email,role:D.role||"employee"}),i(D),c(null),D)}catch(x){return console.error(" Employee access check failed:",x),console.error(" Error details:",x),c(`     : ${x.message}`),i(null),null}},h=async()=>{try{await o$(It),t(null),i(null),c(null),console.log(" Sign out successful")}catch(p){console.error(" Sign out error:",p)}};if(b.useEffect(()=>{console.log(" Setting up auth state listener...");let p;try{p=HN(It,async x=>{console.log(" Auth state changed:",x?`User: ${x.uid}`:"No user"),o(!0);try{x?(console.log(" User authenticated, checking employee access..."),t(x),await d(x)):(console.log(" User signed out, showing login page"),t(null),i(null),c(null))}catch(I){if(I.message&&I.message.includes("_getRecaptchaConfig")){console.log(" [AuthContext] Ignored reCAPTCHA error:",I.message);return}console.error(" Auth state change error:",I),c("    ")}finally{o(!1)}})}catch(x){x.message&&x.message.includes("_getRecaptchaConfig")?console.log(" [AuthContext] Ignored reCAPTCHA setup error:",x.message):(console.error(" Auth listener setup error:",x),c("    ")),o(!1)}return()=>{if(console.log(" Cleaning up auth listener"),p)try{p()}catch(x){x.message&&x.message.includes("_getRecaptchaConfig")?console.log(" [AuthContext] Ignored reCAPTCHA cleanup error:",x.message):console.error(" Auth cleanup error:",x)}}},[]),b.useEffect(()=>{if(a){const p=setTimeout(()=>{console.log(" Authentication timeout - proceeding with demo mode"),o(!1),t({uid:"demo-user",email:"demo@demo.com"}),i({fullName:"Demo User",email:"demo@demo.com",status:"active",role:"admin"})},2e3);return()=>clearTimeout(p)}},[a]),a)return r.jsx("div",{className:"min-vh-100 d-flex align-items-center justify-content-center bg-light",children:r.jsxs("div",{className:"text-center",children:[r.jsx(an,{size:"large"}),r.jsxs("div",{className:"mt-3",children:[r.jsx("h5",{className:"text-muted",children:"  ..."}),r.jsx("p",{className:"text-muted small",children:" "}),r.jsx("p",{className:"text-muted small",children:"    5 ..."})]})]})});const f={currentUser:e,employeeData:s,authError:l,signOut:h,isAuthenticated:!!(e&&s&&s.status==="active"),isLoading:a,checkEmployeeAccess:d};return r.jsx(SR.Provider,{value:f,children:n})},Wt=({show:n,onClose:e,title:t,message:s,type:i="info",onConfirm:a,confirmText:o="",cancelText:l="",showCancel:c=!1})=>{if(!n)return null;const d=()=>{switch(i){case"success":return{icon:"bi-check-circle-fill",color:"text-success",bgColor:"bg-success"};case"error":return{icon:"bi-exclamation-triangle-fill",color:"text-danger",bgColor:"bg-danger"};case"warning":return{icon:"bi-exclamation-triangle",color:"text-warning",bgColor:"bg-warning"};case"confirm":return{icon:"bi-question-circle-fill",color:"text-primary",bgColor:"bg-primary"};default:return{icon:"bi-info-circle-fill",color:"text-info",bgColor:"bg-info"}}},{icon:h,color:f,bgColor:p}=d(),x=()=>{console.log("CustomAlert handleConfirm called"),console.log("onConfirm:",a),console.log("onClose:",e),a&&(console.log("Calling onConfirm"),a()),console.log("Calling onClose"),e()},I=()=>{e()};return r.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},children:r.jsx("div",{className:"modal-dialog modal-dialog-centered modal-sm",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",overflow:"hidden"},children:[r.jsx("div",{className:"modal-header border-0 text-white p-3",style:{background:i==="error"?"linear-gradient(135deg, #dc3545 0%, #b02a37 100%)":i==="success"?"linear-gradient(135deg, #28a745 0%, #1e7e34 100%)":i==="warning"?"linear-gradient(135deg, #ffc107 0%, #e0a800 100%)":i==="confirm"?"linear-gradient(135deg, #007bff 0%, #0056b3 100%)":"linear-gradient(135deg, #17a2b8 0%, #138496 100%)"},children:r.jsxs("div",{className:"d-flex align-items-center w-100 justify-content-center",children:[r.jsx("i",{className:`${h} me-2`,style:{fontSize:"20px"}}),r.jsx("h6",{className:"modal-title mb-0 fw-bold",children:t})]})}),r.jsx("div",{className:"modal-body py-4 px-4",children:r.jsx("div",{className:"text-center",children:r.jsx("p",{className:"mb-0",style:{fontSize:"14px",lineHeight:"1.5",color:"#333"},children:s})})}),r.jsx("div",{className:"modal-footer border-0 pt-0 pb-4 d-flex justify-content-center",children:r.jsxs("div",{className:"d-flex gap-3",children:[c&&r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:I,autoFocus:!0,tabIndex:"1",style:{borderRadius:"8px",height:"36px",fontSize:"13px",fontWeight:"600",width:"80px",background:"linear-gradient(135deg, #6c757d 0%, #495057 100%)",border:"none",color:"white"},children:l}),r.jsx("button",{type:"button",className:"btn btn-sm",onClick:x,autoFocus:!1,tabIndex:c?"2":"1",style:{borderRadius:"8px",height:"36px",fontSize:"13px",fontWeight:"600",width:c?"80px":"100px",background:i==="error"?"linear-gradient(135deg, #dc3545 0%, #b02a37 100%)":i==="success"?"linear-gradient(135deg, #28a745 0%, #1e7e34 100%)":i==="warning"?"linear-gradient(135deg, #ffc107 0%, #e0a800 100%)":"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none",color:i==="warning"?"#000":"#fff"},children:o})]})})]})})})},Kt=()=>{const[n,e]=b.useState({show:!1,title:null,message:null,type:"info",onConfirm:null,confirmText:"",cancelText:"",showCancel:!1}),[t,s]=b.useState(!1);b.useEffect(()=>{console.log("alertConfig changed:",n)},[n]);const i=()=>{if(t){console.log("closeAlert already in progress, ignoring");return}console.log("closeAlert called"),console.log("Current alertConfig before close:",n),s(!0),e(p=>(console.log("Setting show to false"),{...p,show:!1})),setTimeout(()=>{s(!1)},100)},a=p=>{console.log("showAlert called with config:",p);const x={show:!0,title:p.title||"",message:p.message||"",type:p.type||"info",onConfirm:p.onConfirm||null,confirmText:p.confirmText||"",cancelText:p.cancelText||"",showCancel:p.showCancel||!1};console.log("Setting alertConfig to:",x),e(x)};return{alertConfig:n,closeAlert:i,showAlert:a,showSuccess:(p,x=" ")=>{console.log("showSuccess called:",p,x),a({title:x,message:p,type:"success",confirmText:"",onConfirm:null})},showError:(p,x="")=>{a({title:x,message:p,type:"error",confirmText:""})},showWarning:(p,x="")=>{a({title:x,message:p,type:"warning",confirmText:""})},showInfo:(p,x="")=>{a({title:x,message:p,type:"info",confirmText:""})},showConfirm:(p,x,I=" ")=>{a({title:I,message:p,type:"confirm",onConfirm:x,confirmText:"",cancelText:"",showCancel:!0})},showDeleteConfirm:(p,x,I=" ")=>{a({title:I,message:p,type:"confirm",onConfirm:x,confirmText:"",cancelText:"",showCancel:!0})}}},C8=({onSignIn:n})=>{const[e,t]=b.useState({email:"",password:"",rememberMe:!1}),[s,i]=b.useState(!1),[a,o]=b.useState({}),[l,c]=b.useState(!1),{alertConfig:d,closeAlert:h,showError:f,showSuccess:p}=Kt(),[x,I]=b.useState("");b.useEffect(()=>{I("animate-in"),(async()=>{try{await wr.initialize();const V=wr.getSetting("rememberedEmail");V&&t($=>({...$,email:V,rememberMe:!0}))}catch(V){console.error("Error loading remembered email:",V)}})()},[]);const D=j=>{const{name:V,value:$,type:Z,checked:O}=j.target;t(M=>({...M,[V]:Z==="checkbox"?O:$})),a[V]&&o(M=>({...M,[V]:""}))},A=()=>{const j={};return e.email.trim()?/\S+@\S+\.\S+/.test(e.email)||(j.email="   "):j.email="  ",e.password.trim()?e.password.length<6&&(j.password="     6   "):j.password="  ",o(j),Object.keys(j).length===0},g=async j=>{try{const V=Ye(pe,"employees",j),$=await Un(V);if(!$.exists())throw new Error("       ");const Z=$.data();if(Z.status!=="active")throw new Error("  .    ");try{await gs(Ye(pe,"employees",j),{lastLoginAt:it(),loginCount:_D(1),updatedAt:it()})}catch(O){console.log("Login tracking update failed:",O)}return Z}catch(V){throw console.error("Employee status check failed:",V),V}},N=async j=>{if(j.preventDefault(),!!A()){i(!0);try{const V=await n$(It,e.email.trim(),e.password),$=await g(V.user.uid);e.rememberMe?await wr.setSetting("rememberedEmail",e.email.trim()):await wr.removeSetting("rememberedEmail"),console.log(" Sign-in successful:",{uid:V.user.uid,email:V.user.email,employeeName:$.fullName,role:$.role||"employee"}),p(`  ${$.fullName}`,"   "),n&&n({user:V.user,employee:$})}catch(V){console.error("Sign-in error:",V);let $="   ";switch(V.code){case"auth/user-not-found":case"auth/wrong-password":case"auth/invalid-credential":$="      ";break;case"auth/user-disabled":$="   .    ";break;case"auth/too-many-requests":$="  .   ";break;case"auth/network-request-failed":$="  .    ";break;default:$=V.message||"  ";break}f($,"   ")}finally{i(!1)}}};return r.jsxs("div",{className:`login-page ${x}`,children:[r.jsx("div",{className:"login-background",children:r.jsx("div",{className:"login-container",children:r.jsxs("div",{className:"row min-vh-100 g-0",children:[r.jsx("div",{className:"col-lg-6",children:r.jsxs("div",{className:"login-form-panel",children:[r.jsxs("div",{className:"login-form-container",children:[r.jsxs("div",{className:"mobile-logo d-lg-none text-center mb-4",children:[r.jsx("div",{className:"logo-circle-small",children:r.jsx("i",{className:"bi bi-building-fill"})}),r.jsx("h4",{className:"mt-3 mb-0",children:"  "}),r.jsx("p",{className:"text-muted small",children:"  "})]}),r.jsxs("div",{className:"login-form",children:[r.jsxs("div",{className:"form-header text-center mb-4",children:[r.jsx("h3",{className:"login-title",children:" "}),r.jsx("p",{className:"login-subtitle text-muted",children:"    "})]}),r.jsxs("form",{onSubmit:N,className:"needs-validation",noValidate:!0,children:[r.jsxs("div",{className:"form-group mb-3",children:[r.jsx("label",{className:"form-label",children:" "}),r.jsxs("div",{className:"input-group input-group-modern",children:[r.jsx("span",{className:"input-group-text",children:r.jsx("i",{className:"bi bi-envelope"})}),r.jsx("input",{type:"email",className:`form-control ${a.email?"is-invalid":""}`,name:"email",value:e.email,onChange:D,placeholder:"  ",disabled:s,autoComplete:"email"}),a.email&&r.jsx("div",{className:"invalid-feedback",children:a.email})]})]}),r.jsxs("div",{className:"form-group mb-3",children:[r.jsx("label",{className:"form-label",children:" "}),r.jsxs("div",{className:"input-group input-group-modern",children:[r.jsx("span",{className:"input-group-text",children:r.jsx("i",{className:"bi bi-lock"})}),r.jsx("input",{type:l?"text":"password",className:`form-control ${a.password?"is-invalid":""}`,name:"password",value:e.password,onChange:D,placeholder:"  ",disabled:s,autoComplete:"current-password"}),r.jsx("button",{type:"button",className:"input-group-text btn-show-password",onClick:()=>c(!l),disabled:s,children:r.jsx("i",{className:`bi ${l?"bi-eye-slash":"bi-eye"}`})}),a.password&&r.jsx("div",{className:"invalid-feedback",children:a.password})]})]}),r.jsx("div",{className:"form-group mb-4",children:r.jsxs("div",{className:"form-check",children:[r.jsx("input",{className:"form-check-input",type:"checkbox",name:"rememberMe",checked:e.rememberMe,onChange:D,id:"rememberMe",disabled:s}),r.jsx("label",{className:"form-check-label",htmlFor:"rememberMe",children:"   "})]})}),r.jsx("button",{type:"submit",className:"btn btn-login w-100",disabled:s,children:s?r.jsxs(r.Fragment,{children:[r.jsx(an,{size:"small"}),r.jsx("span",{className:"ms-2",children:"  ..."})]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"bi bi-box-arrow-in-right me-2"})," "]})})]}),r.jsx("div",{className:"security-notice mt-4",children:r.jsxs("div",{className:"notice-card",children:[r.jsx("div",{className:"notice-icon",children:r.jsx("i",{className:"bi bi-shield-fill-check text-success"})}),r.jsxs("div",{className:"notice-content",children:[r.jsx("h6",{className:"mb-1",children:"  "}),r.jsx("p",{className:"mb-0 small text-muted",children:"     .      ."})]})]})})]})]}),r.jsx("div",{className:"login-footer",children:r.jsx("p",{className:"text-center text-muted small mb-0",children:" 2024   .   ."})})]})}),r.jsx("div",{className:"col-lg-6 d-none d-lg-flex",children:r.jsxs("div",{className:"login-brand-panel",children:[r.jsxs("div",{className:"brand-content",children:[r.jsx("div",{className:"company-logo mb-4",children:r.jsx("div",{className:"logo-circle",children:r.jsx("i",{className:"bi bi-building-fill"})})}),r.jsxs("div",{className:"company-info text-center mb-5",children:[r.jsx("h2",{className:"company-name",children:"  "}),r.jsx("p",{className:"company-subtitle",children:"    "}),r.jsxs("div",{className:"company-features mt-4",children:[r.jsxs("div",{className:"feature-item",children:[r.jsx("i",{className:"bi bi-check-circle-fill feature-icon"}),r.jsx("span",{children:"  "})]}),r.jsxs("div",{className:"feature-item",children:[r.jsx("i",{className:"bi bi-check-circle-fill feature-icon"}),r.jsx("span",{children:"  "})]}),r.jsxs("div",{className:"feature-item",children:[r.jsx("i",{className:"bi bi-check-circle-fill feature-icon"}),r.jsx("span",{children:"  "})]})]})]})]}),r.jsxs("div",{className:"decorative-elements",children:[r.jsx("div",{className:"floating-card floating-1",children:r.jsx("i",{className:"bi bi-graph-up text-primary"})}),r.jsx("div",{className:"floating-card floating-2",children:r.jsx("i",{className:"bi bi-people text-info"})}),r.jsx("div",{className:"floating-card floating-3",children:r.jsx("i",{className:"bi bi-award text-warning"})})]})]})})]})})}),r.jsx(Wt,{show:d.show,onClose:h,title:d.title,message:d.message,type:d.type,onConfirm:d.onConfirm,confirmText:d.confirmText,cancelText:d.cancelText,showCancel:d.showCancel})]})},A8=({onSignIn:n})=>r.jsx(C8,{onSignIn:n}),D8=({children:n})=>{const{currentUser:e,employeeData:t,authError:s,isAuthenticated:i,isLoading:a}=KN(),{alertConfig:o,closeAlert:l,showError:c}=Kt();return FI.useEffect(()=>{s&&c(s,"  ")},[s,c]),a?null:(console.log(" ProtectedRoute Debug:",{isAuthenticated:i,hasCurrentUser:!!e,currentUserUid:e==null?void 0:e.uid,hasEmployeeData:!!t,employeeDataStatus:t==null?void 0:t.status,isLoading:a}),!i||!e||!t?r.jsxs(r.Fragment,{children:[r.jsx(A8,{onSignIn:d=>{console.log(" User signed in successfully:",d)}}),r.jsx(Wt,{show:o.show,onClose:l,title:o.title,message:o.message,type:o.type,onConfirm:o.onConfirm,confirmText:o.confirmText,cancelText:o.cancelText,showCancel:o.showCancel})]}):(console.log(" SUCCESS! Rendering dashboard for authenticated user:",t.fullName),console.log(" Navigation successful - user will see dashboard now"),r.jsx("div",{className:"app-wrapper",children:n})))},R8=({children:n})=>r.jsx(T8,{children:r.jsx(D8,{children:n})}),IR="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNTguNDMgMTUxLjI4Ij4KICA8ZGVmcz4KICAgIDxzdHlsZT4KICAgICAgLmNscy0xIHsKICAgICAgICBmaWxsOiAjMTBhMGMxOwogICAgICB9CgogICAgICAuY2xzLTIgewogICAgICAgIGZvbnQtZmFtaWx5OiBDYWlyby1Cb2xkLCBDYWlybzsKICAgICAgICBmb250LXNpemU6IDY1cHg7CiAgICAgICAgZm9udC13ZWlnaHQ6IDcwMDsKICAgICAgfQoKICAgICAgLmNscy0zIHsKICAgICAgICBmaWxsOiAjMTg2MmE0OwogICAgICB9CgogICAgICAuY2xzLTQgewogICAgICAgIGZpbGw6IG5vbmU7CiAgICAgICAgc3Ryb2tlOiAjMTg2MmE0OwogICAgICAgIHN0cm9rZS1taXRlcmxpbWl0OiAxMDsKICAgICAgICBzdHJva2Utd2lkdGg6IDRweDsKICAgICAgfQogICAgPC9zdHlsZT4KICA8L2RlZnM+CiAgPGc+CiAgICA8bGluZSBjbGFzcz0iY2xzLTQiIHgxPSIzLjQzIiB5MT0iMTQ1LjIzIiB4Mj0iMzU4LjQzIiB5Mj0iMTQ1LjIzIi8+CiAgICA8bGluZSBjbGFzcz0iY2xzLTMiIHgxPSIzLjQzIiB5MT0iMTQ1LjIzIiB4Mj0iMzU4LjQzIiB5Mj0iMTQ1LjIzIi8+CiAgPC9nPgogIDxwb2x5bGluZSBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMS4xMiA2My44NCA4NC42MSA3LjY0IDk4LjcyIDE0Ljk3IDk4LjcyIDIgMTA4Ljk4IDIgMTA4Ljk4IDE5LjE3IDIwMi43IDY0Ljk4IDM1Mi4yNyA2Mi45NiIvPgogIDx0ZXh0IGNsYXNzPSJjbHMtMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTUuMzQgMTIzLjMzKSI+PHRzcGFuIGNsYXNzPSJjbHMtMSIgeD0iMCIgeT0iMCI+TW9kZXJuIDwvdHNwYW4+PHRzcGFuIGNsYXNzPSJjbHMtMyIgeD0iMjMyLjUiIHk9IjAiPkJpbjwvdHNwYW4+PC90ZXh0Pgo8L3N2Zz4=",TR="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='176.459'%20height='110.288'%20viewBox='0%200%20176.459%20110.288'%3e%3cg%20id='Group_1'%20data-name='Group%201'%20transform='translate(-824.544%20-530.958)'%3e%3crect%20id='Rectangle_4'%20data-name='Rectangle%204'%20width='31.194'%20height='31.194'%20transform='translate(868.659%20553.016)%20rotate(45)'%20fill='%230073d8'%20opacity='0.6'/%3e%3cpath%20id='Rectangle_11'%20data-name='Rectangle%2011'%20d='M0,0H31.194V31.194H4a4,4,0,0,1-4-4Z'%20transform='translate(846.602%20575.073)%20rotate(45)'%20fill='%230073d8'%20opacity='0.8'/%3e%3crect%20id='Rectangle_7'%20data-name='Rectangle%207'%20width='31.194'%20height='31.194'%20transform='translate(912.774%20553.016)%20rotate(45)'%20fill='%230073d8'%20opacity='0.6'/%3e%3crect%20id='Rectangle_9'%20data-name='Rectangle%209'%20width='31.194'%20height='31.194'%20transform='translate(890.716%20575.073)%20rotate(45)'%20fill='%230073d8'%20opacity='0.8'/%3e%3cpath%20id='Rectangle_13'%20data-name='Rectangle%2013'%20d='M0,0H31.194V27.194a4,4,0,0,1-4,4H0Z'%20transform='translate(912.774%20597.131)%20rotate(45)'%20fill='%230073d8'/%3e%3cpath%20id='Rectangle_14'%20data-name='Rectangle%2014'%20d='M0,0H31.194V27.194a4,4,0,0,1-4,4H0Z'%20transform='translate(868.659%20597.131)%20rotate(45)'%20fill='%230073d8'/%3e%3cpath%20id='Rectangle_15'%20data-name='Rectangle%2015'%20d='M0,0H31.194V27.194a4,4,0,0,1-4,4H0Z'%20transform='translate(956.889%20597.131)%20rotate(45)'%20fill='%230073d8'/%3e%3crect%20id='Rectangle_10'%20data-name='Rectangle%2010'%20width='31.194'%20height='31.194'%20transform='translate(934.831%20575.073)%20rotate(45)'%20fill='%230073d8'%20opacity='0.8'/%3e%3cpath%20id='Rectangle_12'%20data-name='Rectangle%2012'%20d='M0,0H27.194a4,4,0,0,1,4,4V31.194H0Z'%20transform='translate(978.946%20575.073)%20rotate(45)'%20fill='%230073d8'%20opacity='0.8'/%3e%3crect%20id='Rectangle_8'%20data-name='Rectangle%208'%20width='31.194'%20height='31.194'%20transform='translate(956.889%20553.016)%20rotate(45)'%20fill='%230073d8'%20opacity='0.6'/%3e%3cpath%20id='Rectangle_5'%20data-name='Rectangle%205'%20d='M3,0H31.194V31.194H0V3A3,3,0,0,1,3,0Z'%20transform='translate(890.716%20530.958)%20rotate(45)'%20fill='%230073d8'%20opacity='0.4'/%3e%3cpath%20id='Rectangle_6'%20data-name='Rectangle%206'%20d='M3,0H31.194V31.194H0V3A3,3,0,0,1,3,0Z'%20transform='translate(934.831%20530.958)%20rotate(45)'%20fill='%230073d8'%20opacity='0.4'/%3e%3c/g%3e%3c/svg%3e",CR="/images/user.png",AR="/images/pdf-icon.png",DR="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='14'%20height='32'%20viewBox='0%200%2014%2032'%3e%3cpath%20id='Path_2'%20data-name='Path%202'%20d='M968.1,368.23v32l-14-15.835Z'%20transform='translate(-954.096%20-368.23)'%20fill='%23ffffff'/%3e%3c/svg%3e",P8="/images/pattern.jpg",k8="/images/pattern2.jpg",O8="/images/pattern3.jpg",M8="/images/pattern4.jpg",L8="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='6.697'%20height='28.873'%20viewBox='0%200%206.697%2028.873'%3e%3cg%20id='Group_1'%20data-name='Group%201'%20transform='translate(-984.438%20-402.547)'%3e%3cpath%20id='Path_1'%20data-name='Path%201'%20d='M965.5,414l-5.137,6.779,4.861,7.062-4.861,7.041,5.1,7.1'%20transform='translate(25%20-11)'%20fill='none'%20stroke='%23e2dfdc'%20stroke-width='1.5'/%3e%3c/g%3e%3c/svg%3e",F8="/images/dots.svg";class U8{constructor(){this.imageCache=new Map,this.initializeImages()}initializeImages(){this.images={"logo.svg":IR,"logo-sm.svg":TR,"user.png":CR,"pdf-icon.png":AR,"menu-arrow.svg":DR,"pattern.jpg":P8,"pattern2.jpg":k8,"pattern3.jpg":O8,"pattern4.jpg":M8,"curve-line.svg":L8,"dots.svg":F8}}getImage(e){return this.images[e]?this.images[e]:`/images/${e}`}getAllImages(){return this.images}injectImageCSS(){if(typeof document>"u")return;const e=document.createElement("style");e.id="senior-react-images";const t=document.getElementById("senior-react-images");t&&t.remove();const s=[":root {",`  --image-logo: url("${this.getImage("logo.svg")}");`,`  --image-logo-sm: url("${this.getImage("logo-sm.svg")}");`,`  --image-user: url("${this.getImage("user.png")}");`,`  --image-pdf-icon: url("${this.getImage("pdf-icon.png")}");`,`  --image-menu-arrow: url("${this.getImage("menu-arrow.svg")}");`,`  --image-pattern: url("${this.getImage("pattern.jpg")}");`,`  --image-pattern2: url("${this.getImage("pattern2.jpg")}");`,`  --image-pattern3: url("${this.getImage("pattern3.jpg")}");`,`  --image-pattern4: url("${this.getImage("pattern4.jpg")}");`,`  --image-curve-line: url("${this.getImage("curve-line.svg")}");`,`  --image-dots: url("${this.getImage("dots.svg")}");`,"}","","/* Fix main.scss background images */",".pattern-bg:nth-child(1) { background: var(--image-pattern) !important; }",".pattern-bg:nth-child(2) { background: var(--image-pattern2) !important; }",".pattern-bg:nth-child(3) { background: var(--image-pattern3) !important; }",".pattern-bg:nth-child(4) { background: var(--image-pattern4) !important; }","","/* Fix menu arrow in CSS */",".sidebar-menu > li.active > a::after,",".menu-arrow::before { background: var(--image-menu-arrow) !important; }","","/* Fix curve line */",".curve-line { background: var(--image-curve-line) repeat-y !important; }","","/* Fix dots */",".dots-bg { background: var(--image-dots) no-repeat !important; }"];e.textContent=s.join(`
`),document.head.appendChild(e)}}const xw=new U8,V8=n=>xw.getImage(n);typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>xw.injectImageCSS(),100)}):setTimeout(()=>xw.injectImageCSS(),100));function vn({isCollapsed:n}){const e=Ga(),[t,s]=b.useState("dashboard"),[i,a]=b.useState(!1),[o,l]=b.useState(!1),[c,d]=b.useState(!1),[h,f]=b.useState(!1);b.useEffect(()=>{const fe=e.pathname;fe==="/"||fe==="/tender"?(s("dashboard"),l(!1)):fe==="/raw-materials"?(s("raw-materials"),l(!0)):fe==="/local-products"?(s("local-product"),l(!0)):fe==="/foreign-products"?(s("imported-product"),l(!0)):fe==="/suppliers/local"?(s("local-suppliers"),d(!0),l(!1)):fe==="/suppliers/foreign"?(s("foreign-suppliers"),d(!0),l(!1)):fe==="/clients"?(s("clients"),l(!1)):fe==="/companies"?(s("companies"),l(!1)):fe==="/tenders/list"?(s("list"),a(!0),l(!1)):fe==="/tenders/add"||fe.startsWith("/tenders/edit/")?(s("add"),a(!0),l(!1)):fe==="/tenders/tracking"?(s("tracking"),a(!0),l(!1)):fe==="/employees"?(s("employees"),f(!0),l(!1)):(s("dashboard"),l(!1))},[e.pathname]);const p=[{id:"dashboard",type:"main",component:"dashboard"},{id:"tenders",type:"treeview",component:"tenders"},{id:"tender-details",type:"treeview",component:"tender-details"},{id:"suppliers",type:"treeview",component:"suppliers"},{id:"clients",type:"main",component:"clients"},{id:"companies",type:"main",component:"companies"},{id:"hr",type:"treeview",component:"hr"}],x=[{id:"list",type:"sub",component:"list"},{id:"add",type:"sub",component:"add"},{id:"tracking",type:"sub",component:"tracking"}],I=[{id:"raw-materials",type:"sub",component:"raw-materials"},{id:"local-product",type:"sub",component:"local-product"},{id:"imported-product",type:"sub",component:"imported-product"},{id:"manufactured-product",type:"sub",component:"manufactured-product"}],D=[{id:"local-suppliers",type:"sub",component:"local-suppliers"},{id:"foreign-suppliers",type:"sub",component:"foreign-suppliers"}],A=[{id:"employees",type:"sub",component:"employees"}],g=(fe,Ce)=>{try{const Ne=localStorage.getItem(fe);if(Ne){const He=JSON.parse(Ne);if(Array.isArray(He)&&He.length===Ce.length)return He}}catch(Ne){console.error("Error loading saved order:",Ne)}return Ce},[N,j]=b.useState(()=>g("sidebar-menu-items",p)),[V,$]=b.useState(()=>g("sidebar-tender-sub-items",x)),[Z,O]=b.useState(()=>g("sidebar-tender-detail-sub-items",I)),[M,T]=b.useState(()=>g("sidebar-supplier-sub-items",D)),[L,G]=b.useState(()=>g("sidebar-hr-sub-items",A));b.useEffect(()=>{localStorage.setItem("sidebar-menu-items",JSON.stringify(N))},[N]),b.useEffect(()=>{localStorage.setItem("sidebar-tender-sub-items",JSON.stringify(V))},[V]),b.useEffect(()=>{localStorage.setItem("sidebar-tender-detail-sub-items",JSON.stringify(Z))},[Z]),b.useEffect(()=>{localStorage.setItem("sidebar-supplier-sub-items",JSON.stringify(M))},[M]),b.useEffect(()=>{localStorage.setItem("sidebar-hr-sub-items",JSON.stringify(L))},[L]);const[U,k]=b.useState(()=>{try{const fe=localStorage.getItem("sidebar-sort-enabled");return fe!==null?JSON.parse(fe):!1}catch{return!1}});b.useEffect(()=>{localStorage.setItem("sidebar-sort-enabled",JSON.stringify(U))},[U]);const re=()=>{k(!U)},[xe,H]=b.useState(null),[ee,se]=b.useState(null),Y=(fe,Ce,Ne)=>{H(Ce),se(Ne),fe.dataTransfer.effectAllowed="move"},R=fe=>{fe.preventDefault(),fe.dataTransfer.dropEffect="move"},_=(fe,Ce,Ne)=>{if(fe.preventDefault(),!(!xe||xe.id===Ce.id||ee!==Ne)){if(Ne==="main"){const He=[...N],Xe=He.findIndex(Fe=>Fe.id===xe.id),ot=He.findIndex(Fe=>Fe.id===Ce.id);He.splice(Xe,1),He.splice(ot,0,xe),j(He)}else if(Ne==="tender-sub"){const He=[...V],Xe=He.findIndex(Fe=>Fe.id===xe.id),ot=He.findIndex(Fe=>Fe.id===Ce.id);He.splice(Xe,1),He.splice(ot,0,xe),$(He)}else if(Ne==="tender-detail-sub"){const He=[...Z],Xe=He.findIndex(Fe=>Fe.id===xe.id),ot=He.findIndex(Fe=>Fe.id===Ce.id);He.splice(Xe,1),He.splice(ot,0,xe),O(He)}else if(Ne==="supplier-sub"){const He=[...M],Xe=He.findIndex(Fe=>Fe.id===xe.id),ot=He.findIndex(Fe=>Fe.id===Ce.id);He.splice(Xe,1),He.splice(ot,0,xe),T(He)}else if(Ne==="hr-sub"){const He=[...L],Xe=He.findIndex(Fe=>Fe.id===xe.id),ot=He.findIndex(Fe=>Fe.id===Ce.id);He.splice(Xe,1),He.splice(ot,0,xe),G(He)}H(null),se(null)}},C=()=>{H(null),se(null)},z=fe=>r.jsx("li",{className:t==="dashboard"?"active current-page":"",style:n?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:xe&&xe.id===fe.id?.5:1,transition:"opacity 0.2s ease"},draggable:!n&&U,onDragStart:U?Ce=>Y(Ce,fe,"main"):void 0,onDragOver:U?R:void 0,onDrop:U?Ce=>_(Ce,fe,"main"):void 0,onDragEnd:U?C:void 0,children:r.jsxs(ga,{to:"/tender",onClick:Ce=>{if(Ce.target.closest(".drag-handle")){Ce.preventDefault();return}s("dashboard")},style:n?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",width:"100%"},children:[!n&&U&&r.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),r.jsx("i",{className:"bi bi-pie-chart",style:n?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:t==="dashboard"?"#0073d8 !important":"transparent !important",color:t==="dashboard"?"white !important":"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!n&&r.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:" "})]})},fe.id),K=fe=>r.jsxs("li",{className:`treeview ${i?"open":""}`,style:n?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:xe&&xe.id===fe.id?.5:1,transition:"opacity 0.2s ease"},"data-collapsed":n,draggable:!n&&U,onDragStart:U?Ce=>Y(Ce,fe,"main"):void 0,onDragOver:U?R:void 0,onDrop:U?Ce=>_(Ce,fe,"main"):void 0,onDragEnd:U?C:void 0,children:[r.jsxs("a",{href:"#!",onClick:Ce=>{if(Ce.target.closest(".drag-handle")){Ce.preventDefault();return}a(!i)},style:n?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",color:"#4d4d4d !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",color:"#4d4d4d",width:"100%"},children:[!n&&U&&r.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),r.jsx("i",{className:"bi bi-box-seam",style:n?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:"transparent !important",color:"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!n&&r.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:""})]}),i&&!n&&r.jsx("ul",{className:"treeview-menu",children:V.map(Ce=>Q(Ce))})]},fe.id),F=fe=>r.jsxs("li",{className:`treeview ${o?"open":""}`,style:n?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:xe&&xe.id===fe.id?.5:1,transition:"opacity 0.2s ease"},"data-collapsed":n,draggable:!n&&U,onDragStart:U?Ce=>Y(Ce,fe,"main"):void 0,onDragOver:U?R:void 0,onDrop:U?Ce=>_(Ce,fe,"main"):void 0,onDragEnd:U?C:void 0,children:[r.jsxs("a",{href:"#!",onClick:Ce=>{if(Ce.target.closest(".drag-handle")){Ce.preventDefault();return}l(!o)},style:n?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",color:"#4d4d4d !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",color:"#4d4d4d",width:"100%"},children:[!n&&U&&r.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),r.jsx("i",{className:"bi bi-clipboard-data",style:n?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:"transparent !important",color:"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!n&&r.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:" "})]}),o&&!n&&r.jsx("ul",{className:"treeview-menu",children:Z.map(Ce=>oe(Ce))})]},fe.id),Q=fe=>{const Ne={list:{to:"/tenders/list",icon:"bi-list-ul",text:" "},add:{to:"/tenders/add",icon:"bi-plus-circle",text:" "},tracking:{to:"/tenders/tracking",icon:"bi-kanban",text:" "}}[fe.id];if(!Ne)return null;const He=Fe=>{Fe.stopPropagation(),Y(Fe,fe,"tender-sub")},Xe=Fe=>{Fe.stopPropagation(),R(Fe)},ot=Fe=>{Fe.stopPropagation(),_(Fe,fe,"tender-sub")};return r.jsx("li",{className:t===fe.id?"active":"",style:{opacity:xe&&xe.id===fe.id?.5:1,transition:"opacity 0.2s ease"},draggable:U,onDragStart:U?He:void 0,onDragOver:U?Xe:void 0,onDrop:U?ot:void 0,onDragEnd:U?C:void 0,children:Ne.to?r.jsxs(ga,{to:Ne.to,onClick:Fe=>{if(Fe.target.closest(".drag-handle")){Fe.preventDefault();return}s(fe.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[U&&r.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:Fe=>Fe.stopPropagation()}),r.jsx("i",{className:Ne.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),r.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:Ne.text})]}):r.jsxs("a",{href:"#!",onClick:Fe=>{if(Fe.target.closest(".drag-handle")){Fe.preventDefault();return}Fe.preventDefault(),s(fe.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[U&&r.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:Fe=>Fe.stopPropagation()}),r.jsx("i",{className:Ne.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),r.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:Ne.text})]})},fe.id)},oe=fe=>{const Ne={"raw-materials":{to:"/raw-materials",icon:"bi-gear",text:" "},"local-product":{to:"/local-products",icon:"bi-house",text:" "},"imported-product":{to:"/foreign-products",icon:"bi-globe",text:" "},"manufactured-product":{icon:"bi-tools",text:" "}}[fe.id];if(!Ne)return null;const He=gt=>{gt.stopPropagation(),Y(gt,fe,"tender-detail-sub")},Xe=gt=>{gt.stopPropagation(),R(gt)},ot=gt=>{gt.stopPropagation(),_(gt,fe,"tender-detail-sub")},Fe=fe.id==="raw-materials"||fe.id==="local-product"||fe.id==="imported-product";return r.jsx("li",{className:t===fe.id?"active":"",style:{opacity:xe&&xe.id===fe.id?.5:1,transition:"opacity 0.2s ease"},draggable:U,onDragStart:U?He:void 0,onDragOver:U?Xe:void 0,onDrop:U?ot:void 0,onDragEnd:U?C:void 0,children:Fe?r.jsxs(ga,{to:Ne.to,onClick:gt=>{if(gt.target.closest(".drag-handle")){gt.preventDefault();return}s(fe.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[U&&r.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:gt=>gt.stopPropagation()}),r.jsx("i",{className:Ne.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),r.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:Ne.text})]}):r.jsxs("a",{href:"#!",onClick:gt=>{if(gt.target.closest(".drag-handle")){gt.preventDefault();return}gt.preventDefault(),s(fe.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[U&&r.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:gt=>gt.stopPropagation()}),r.jsx("i",{className:Ne.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),r.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:Ne.text})]})},fe.id)},E=fe=>{const Ne={"local-suppliers":{to:"/suppliers/local",icon:"bi-house-fill",text:" "},"foreign-suppliers":{to:"/suppliers/foreign",icon:"bi-globe",text:" "}}[fe.id];if(!Ne)return null;const He=Fe=>{Fe.stopPropagation(),Y(Fe,fe,"supplier-sub")},Xe=Fe=>{Fe.stopPropagation(),R(Fe)},ot=Fe=>{Fe.stopPropagation(),_(Fe,fe,"supplier-sub")};return r.jsx("li",{className:t===fe.id?"active":"",style:{opacity:xe&&xe.id===fe.id?.5:1,transition:"opacity 0.2s ease"},draggable:U,onDragStart:U?He:void 0,onDragOver:U?Xe:void 0,onDrop:U?ot:void 0,onDragEnd:U?C:void 0,children:r.jsxs(ga,{to:Ne.to,onClick:Fe=>{if(Fe.target.closest(".drag-handle")){Fe.preventDefault();return}s(fe.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[U&&r.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:Fe=>Fe.stopPropagation()}),r.jsx("i",{className:Ne.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),r.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:Ne.text})]})},fe.id)},te=fe=>r.jsxs("li",{className:`treeview ${c?"open":""}`,style:n?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:xe&&xe.id===fe.id?.5:1,transition:"opacity 0.2s ease"},"data-collapsed":n,draggable:!n&&U,onDragStart:U?Ce=>Y(Ce,fe,"main"):void 0,onDragOver:U?R:void 0,onDrop:U?Ce=>_(Ce,fe,"main"):void 0,onDragEnd:U?C:void 0,children:[r.jsxs("a",{href:"#!",onClick:Ce=>{if(Ce.target.closest(".drag-handle")){Ce.preventDefault();return}d(!c)},style:n?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",color:"#4d4d4d !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",color:"#4d4d4d",width:"100%"},children:[!n&&U&&r.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),r.jsx("i",{className:"bi bi-people-fill",style:n?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:"transparent !important",color:"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!n&&r.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:""})]}),c&&!n&&r.jsx("ul",{className:"treeview-menu",children:M.map(Ce=>E(Ce))})]},fe.id),Te=fe=>r.jsx("li",{className:t==="clients"?"active current-page":"",style:n?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:xe&&xe.id===fe.id?.5:1,transition:"opacity 0.2s ease"},draggable:!n&&U,onDragStart:U?Ce=>Y(Ce,fe,"main"):void 0,onDragOver:U?R:void 0,onDrop:U?Ce=>_(Ce,fe,"main"):void 0,onDragEnd:U?C:void 0,children:r.jsxs(ga,{to:"/clients",onClick:Ce=>{if(Ce.target.closest(".drag-handle")){Ce.preventDefault();return}s("clients")},style:n?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",width:"100%"},children:[!n&&U&&r.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),r.jsx("i",{className:"bi bi-person-vcard-fill",style:n?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:t==="clients"?"#0073d8 !important":"transparent !important",color:t==="clients"?"white !important":"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!n&&r.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:""})]})},fe.id),ze=fe=>r.jsx("li",{className:t==="companies"?"active current-page":"",style:n?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:xe&&xe.id===fe.id?.5:1,transition:"opacity 0.2s ease"},draggable:!n&&U,onDragStart:U?Ce=>Y(Ce,fe,"main"):void 0,onDragOver:U?R:void 0,onDrop:U?Ce=>_(Ce,fe,"main"):void 0,onDragEnd:U?C:void 0,children:r.jsxs(ga,{to:"/companies",onClick:Ce=>{if(Ce.target.closest(".drag-handle")){Ce.preventDefault();return}s("companies")},style:n?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",width:"100%"},children:[!n&&U&&r.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),r.jsx("i",{className:"bi bi-building",style:n?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:t==="companies"?"#0073d8 !important":"transparent !important",color:t==="companies"?"white !important":"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!n&&r.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:""})]})},fe.id),We=fe=>{const Ne={employees:{to:"/employees",icon:"bi-person-badge-fill",text:""}}[fe.id];if(!Ne)return null;const He=Fe=>{Fe.stopPropagation(),Y(Fe,fe,"hr-sub")},Xe=Fe=>{Fe.stopPropagation(),R(Fe)},ot=Fe=>{Fe.stopPropagation(),_(Fe,fe,"hr-sub")};return r.jsx("li",{className:t===fe.id?"active":"",style:{opacity:xe&&xe.id===fe.id?.5:1,transition:"opacity 0.2s ease"},draggable:U,onDragStart:U?He:void 0,onDragOver:U?Xe:void 0,onDrop:U?ot:void 0,onDragEnd:U?C:void 0,children:r.jsxs(ga,{to:Ne.to,onClick:Fe=>{if(Fe.target.closest(".drag-handle")){Fe.preventDefault();return}s(fe.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[U&&r.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:Fe=>Fe.stopPropagation()}),r.jsx("i",{className:Ne.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),r.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:Ne.text})]})},fe.id)},at=fe=>r.jsxs("li",{className:`treeview ${h?"open":""}`,style:n?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:xe&&xe.id===fe.id?.5:1,transition:"opacity 0.2s ease"},"data-collapsed":n,draggable:!n&&U,onDragStart:U?Ce=>Y(Ce,fe,"main"):void 0,onDragOver:U?R:void 0,onDrop:U?Ce=>_(Ce,fe,"main"):void 0,onDragEnd:U?C:void 0,children:[r.jsxs("a",{href:"#!",onClick:Ce=>{if(Ce.target.closest(".drag-handle")){Ce.preventDefault();return}f(!h)},style:n?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",color:"#4d4d4d !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",color:"#4d4d4d",width:"100%"},children:[!n&&U&&r.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),r.jsx("i",{className:"bi bi-person-workspace",style:n?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:"transparent !important",color:"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!n&&r.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:" "})]}),h&&!n&&r.jsx("ul",{className:"treeview-menu",children:L.map(Ce=>We(Ce))})]},fe.id),zt=fe=>{switch(fe.component){case"dashboard":return z(fe);case"tenders":return K(fe);case"tender-details":return F(fe);case"suppliers":return te(fe);case"clients":return Te(fe);case"companies":return ze(fe);case"hr":return at(fe);default:return null}};return r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"shop-profile",style:{padding:n?"0.5rem":"1rem",textAlign:n?"center":"right",display:"flex",alignItems:"center",justifyContent:n?"center":"flex-end"},children:n?r.jsx("img",{src:V8("logo.svg"),alt:"Modern Bin",style:{width:"40px",height:"40px",objectFit:"contain"}}):r.jsxs(r.Fragment,{children:[r.jsx("p",{className:"mb-1 fw-bold text-primary",style:{opacity:n?0:1,transition:"opacity 0.3s ease"},children:"  "}),r.jsx("p",{className:"m-0",style:{opacity:n?0:1,transition:"opacity 0.3s ease"},children:""})]})}),r.jsxs("div",{className:"sidebarMenuScroll",style:{position:"relative"},children:[r.jsx("ul",{className:"sidebar-menu",children:N.map(fe=>zt(fe))}),r.jsx("div",{className:"sidebar-sort-toggle",style:{position:"fixed",right:n?"15px":"20px",bottom:"20px",zIndex:1050,background:U?"#28a745":"#0d6efd",color:"white",width:n?"46px":"52px",height:n?"46px":"52px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",transition:"all 0.3s ease",transform:"scale(1)"},onClick:re,onMouseEnter:fe=>{fe.target.style.transform="scale(1.1)",fe.target.style.boxShadow="0 6px 16px rgba(0,0,0,0.2)"},onMouseLeave:fe=>{fe.target.style.transform="scale(1)",fe.target.style.boxShadow="0 4px 12px rgba(0,0,0,0.15)"},title:U?" ":" ",children:r.jsx("i",{className:`bi ${U?"bi-arrows-move":"bi-lock"}`,style:{fontSize:n?"18px":"20px",transition:"transform 0.2s ease"}})})]})]})}function Nn({onToggle:n}){const e=On(),{isTimelineVisible:t,toggleTimeline:s}=gn(),{signOut:i,employeeData:a}=KN(),{alertConfig:o,closeAlert:l,showConfirm:c}=Kt(),d=()=>{c("     ",async()=>{try{await i(),console.log("    ")}catch(h){console.error("    :",h)}},"  ")};return r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"app-header-wrapper",children:r.jsxs("div",{className:"app-header d-flex align-items-center justify-content-between px-3",children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("button",{onClick:n,type:"button",style:{border:"0",borderRight:"1px solid #e8ebf4",background:"transparent",marginLeft:"10px",padding:"1.35rem 1.5rem",cursor:"pointer",marginBottom:"-11px"},children:r.jsx("i",{className:"bi bi-list lh-1",style:{color:"#0073d8",fontSize:"1.8rem"}})}),r.jsxs("div",{className:"app-brand py-2",style:{marginTop:"-8px",marginRight:"-20px"},children:[r.jsx("a",{href:"/",className:"d-sm-block d-none",children:r.jsx("img",{src:"/images/logo.svg",className:"logo",alt:"Modern Bin",style:{height:"40px",width:"auto"}})}),r.jsx("a",{href:"/",className:"d-sm-none d-block",children:r.jsx("img",{src:"/images/logo-sm.svg",className:"logo",alt:"Modern Bin",style:{height:"40px",width:"auto"}})})]})]}),r.jsxs("div",{className:"header-actions d-lg-flex d-none",children:[r.jsx("div",{className:"settings-icon-container d-flex align-items-center me-3",children:r.jsx("button",{onClick:()=>e("/settings"),className:"d-flex align-items-center justify-content-center position-relative",style:{width:"48px",height:"48px",background:"linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",borderRadius:"12px",color:"#6c757d",border:"none",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},onMouseOver:h=>{const f=h.currentTarget,p=f.querySelector("i");f.style.background="linear-gradient(135deg, #007bff 0%, #0056b3 100%)",f.style.color="white",f.style.transform="translateY(-2px)",f.style.boxShadow="0 4px 15px rgba(0, 123, 255, 0.4)",p&&p.style.setProperty("color","white","important")},onMouseOut:h=>{const f=h.currentTarget,p=f.querySelector("i");f.style.background="linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",f.style.color="#6c757d",f.style.transform="translateY(0)",f.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)",p&&p.style.setProperty("color","#6c757d","important")},title:"",children:r.jsx("i",{className:"bi bi-gear fs-5 lh-1",style:{color:"inherit"}})})}),r.jsx("div",{className:"activity-toggle-container d-flex align-items-center me-3",children:r.jsx("button",{onClick:s,className:"d-flex align-items-center justify-content-center position-relative",style:{width:"48px",height:"48px",background:t?"linear-gradient(135deg, #007bff 0%, #0056b3 100%)":"linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",borderRadius:"12px",color:t?"white":"#6c757d",border:"none",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},onMouseOver:h=>{h.target.style.transform="translateY(-2px)",h.target.style.boxShadow="0 4px 15px rgba(0, 0, 0, 0.15)"},onMouseOut:h=>{h.target.style.transform="translateY(0)",h.target.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)"},title:t?" ":" ",children:r.jsx("i",{className:`bi ${t?"bi-clock-history":"bi-clock"} fs-5 lh-1`})})}),r.jsx("div",{className:"logout-button-container d-flex align-items-center me-3",children:r.jsx("button",{onClick:d,className:"d-flex align-items-center justify-content-center position-relative",style:{width:"48px",height:"48px",background:"linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",borderRadius:"12px",color:"#6c757d",border:"none",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},onMouseOver:h=>{const f=h.currentTarget,p=f.querySelector("i");f.style.background="linear-gradient(135deg, #dc3545 0%, #c82333 100%)",f.style.color="white",f.style.transform="translateY(-2px)",f.style.boxShadow="0 4px 15px rgba(220, 53, 69, 0.4)",p&&p.style.setProperty("color","white","important")},onMouseOut:h=>{const f=h.currentTarget,p=f.querySelector("i");f.style.background="linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",f.style.color="#6c757d",f.style.transform="translateY(0)",f.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)",p&&p.style.setProperty("color","#6c757d","important")},title:" ",children:r.jsx("i",{className:"bi bi-box-arrow-right fs-5 lh-1",style:{color:"inherit"}})})}),r.jsx("div",{className:"trash-icon-container d-flex align-items-center me-3",children:r.jsx("button",{onClick:()=>e("/trash"),className:"d-flex align-items-center justify-content-center position-relative",style:{width:"48px",height:"48px",background:"linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",borderRadius:"12px",color:"#6c757d",border:"none",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},onMouseOver:h=>{const f=h.currentTarget,p=f.querySelector("i");f.style.background="linear-gradient(135deg, #dc3545 0%, #c82333 100%)",f.style.color="white",f.style.transform="translateY(-2px)",f.style.boxShadow="0 4px 15px rgba(220, 53, 69, 0.4)",p&&p.style.setProperty("color","white","important")},onMouseOut:h=>{const f=h.currentTarget,p=f.querySelector("i");f.style.background="linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",f.style.color="#6c757d",f.style.transform="translateY(0)",f.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)",p&&p.style.setProperty("color","#6c757d","important")},title:" ",children:r.jsx("i",{className:"bi bi-trash fs-5 lh-1",style:{color:"inherit"}})})})]}),r.jsx("div",{className:"d-flex align-items-center",children:r.jsxs("div",{className:"dropdown ms-2",children:[r.jsxs("a",{className:"dropdown-toggle d-flex py-2 align-items-center text-decoration-none",href:"#!",role:"button","data-bs-toggle":"dropdown",children:[r.jsx("img",{src:"/images/user.png",className:"rounded-2 img-3x",alt:"User"}),r.jsx("span",{className:"ms-2 text-truncate d-lg-block d-none",children:(a==null?void 0:a.fullName)||""})]}),r.jsxs("div",{className:"dropdown-menu dropdown-menu-end shadow-lg",children:[r.jsxs("div",{className:"header-action-links mx-3 gap-2",children:[r.jsxs("a",{className:"dropdown-item",href:"profile.html",children:[r.jsx("i",{className:"bi bi-person text-primary"}),"  "]}),r.jsxs("a",{className:"dropdown-item",href:"settings.html",children:[r.jsx("i",{className:"bi bi-gear text-danger"})," "]}),r.jsxs("a",{className:"dropdown-item",href:"widgets.html",children:[r.jsx("i",{className:"bi bi-box text-success"})," "]})]}),r.jsx("div",{className:"mx-3 mt-2 d-grid",children:r.jsxs("button",{onClick:d,className:"btn btn-danger btn-sm",children:[r.jsx("i",{className:"bi bi-box-arrow-right me-1"})," "]})})]})]})})]})}),r.jsx(Wt,{show:o.show,onClose:l,title:o.title,message:o.message,type:o.type,onConfirm:o.onConfirm,confirmText:o.confirmText,cancelText:o.cancelText,showCancel:o.showCancel})]})}function jn(){const[n,e]=b.useState([""]),[t,s]=b.useState(!0),i=["","","","",""];b.useEffect(()=>{(async()=>{try{await wr.initialize();const l=wr.getSetting("sidebar-active-button");l&&e([l])}catch(l){console.error("Error loading active button:",l)}finally{s(!1)}})()},[]),b.useEffect(()=>{!t&&n.length>0&&wr.setSetting("sidebar-active-button",n[0])},[n,t]);const a=o=>{i.includes(o)&&(n.includes(o)||e([o]))};return r.jsx("div",{className:"rectangle-buttons-row px-3 py-2",style:{backgroundColor:"#e6f3ff",borderBottom:"1px solid #b3d9ff"},children:r.jsx("div",{className:"d-flex align-items-center gap-3",children:i.map((o,l)=>{const c=n.includes(o);return r.jsx("div",{className:"rectangle-button d-flex align-items-center justify-content-center",onClick:()=>a(o),style:{background:c?"linear-gradient(135deg, #007bff 0%, #0056b3 100%)":"#e9ecef",border:`1px solid ${c?"#0056b3":"#dee2e6"}`,borderRadius:"6px",padding:"4px 8px",fontSize:"12px",color:c?"white":"#212529",transition:"all 0.2s ease",cursor:"pointer",minHeight:"24px",width:"80px",textAlign:"center"},onMouseEnter:d=>{c?(d.currentTarget.style.background="linear-gradient(135deg, #0056b3 0%, #004085 100%)",d.currentTarget.style.borderColor="#004085"):(d.currentTarget.style.background="#dee2e6",d.currentTarget.style.borderColor="#ced4da")},onMouseLeave:d=>{c?(d.currentTarget.style.background="linear-gradient(135deg, #007bff 0%, #0056b3 100%)",d.currentTarget.style.borderColor="#0056b3"):(d.currentTarget.style.background="#e9ecef",d.currentTarget.style.borderColor="#dee2e6")},children:r.jsx("span",{children:o})},l)})})})}const Tb={RAW_MATERIAL:"rm",LOCAL_PRODUCT:"lp",FOREIGN_PRODUCT:"fp",MANUFACTURED_PRODUCT:"mp",TENDER:"tdr",CUSTOMER:"cst",LOCAL_SUPPLIER:"ls",FOREIGN_SUPPLIER:"fs",COMPANY:"comp",EMPLOYEE:"emp",PRICE_QUOTE:"pq",TENDER_ITEM:"ti",ORDER:"ord",INVOICE:"inv",ACTIVITY:"act",TRASH_ITEM:"trs"},ct=(n,e=null)=>{if(!Tb[n])throw new Error(`Invalid entity type: ${n}. Valid types: ${Object.keys(Tb).join(", ")}`);const t=Tb[n],s=Date.now().toString(36),i=Math.random().toString(36).substring(2,8);return e?`${t}_${e}_${s}${i}`:`${t}_${s}${i}`},yo=class yo extends WN{constructor(){super("activitylogs"),this.currentUserId=null,this.activities=[],this.listeners=new Set,this.maxActivities=1e3}async initialize(){try{if(!Ki.currentUser)throw new Error("User not authenticated");return this.currentUserId=Ki.currentUser.uid,await this.loadActivities(),this.activities}catch(e){return console.error("Error initializing activity log:",e),[]}}async loadActivities(){try{if(!this.currentUserId)throw new Error("User not initialized");const t=(await this.getAll({limit:this.maxActivities*2})||[]).sort((s,i)=>{const a=new Date(s.createdAt);return new Date(i.createdAt)-a}).slice(0,this.maxActivities);return this.activities=t,this.notifyListeners(),console.log(` Loaded ${this.activities.length} activities from Firestore (sorted client-side)`),this.activities}catch(e){return console.error("Error loading activities:",e),[]}}async logActivity(e,t,s={}){try{this.currentUserId||await this.initialize();const i={internalId:ct("ACTIVITY"),type:e,description:t,details:s,timestamp:new Date,userId:this.currentUserId,userAgent:navigator.userAgent,url:window.location.pathname};this.activities.unshift(i),this.notifyListeners();try{const a=await this.create(i),o=this.activities.findIndex(l=>l.internalId===i.internalId);return o>=0&&(this.activities[o]=a,this.notifyListeners()),this.activities.length>this.maxActivities&&await this.cleanupOldActivities(),console.log(` Activity logged: ${e} - ${t}`),a}catch(a){throw console.error("Error saving activity to Firestore:",a),this.activities=this.activities.filter(o=>o.internalId!==i.internalId),this.notifyListeners(),a}}catch(i){return console.error("Error logging activity:",i),null}}getActivitiesByType(e){return this.activities.filter(t=>t.type===e)}getActivitiesByDateRange(e,t){return this.activities.filter(s=>{const i=new Date(s.timestamp);return i>=e&&i<=t})}getRecentActivities(e=50){return this.activities.slice(0,e)}searchActivities(e){const t=e.toLowerCase();return this.activities.filter(s=>s.description.toLowerCase().includes(t)||s.type.toLowerCase().includes(t)||s.details&&JSON.stringify(s.details).toLowerCase().includes(t))}async deleteActivity(e){try{return await this.delete(e),this.activities=this.activities.filter(t=>t.id!==e),this.notifyListeners(),console.log(` Activity deleted: ${e}`),!0}catch(t){return console.error("Error deleting activity:",t),!1}}async clearAllActivities(){try{const e=this.activities.map(t=>this.delete(t.id).catch(s=>console.error(`Error deleting activity ${t.id}:`,s)));return await Promise.allSettled(e),this.activities=[],this.notifyListeners(),console.log(" All activities cleared"),!0}catch(e){return console.error("Error clearing activities:",e),!1}}async cleanupOldActivities(){try{if(this.activities.length<=this.maxActivities)return;const e=[...this.activities].sort((a,o)=>new Date(o.timestamp)-new Date(a.timestamp)),t=e.slice(0,this.maxActivities),s=e.slice(this.maxActivities),i=s.map(a=>this.delete(a.id).catch(o=>console.error(`Error deleting old activity ${a.id}:`,o)));await Promise.allSettled(i),this.activities=t,this.notifyListeners(),console.log(` Cleaned up ${s.length} old activities`)}catch(e){console.error("Error cleaning up old activities:",e)}}addListener(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(){this.listeners.forEach(e=>{try{e(this.activities)}catch(t){console.error("Error in activity listener:",t)}})}getActivityStats(){const e={total:this.activities.length,byType:{},byDate:{},recentActivity:null};this.activities.forEach(s=>{e.byType[s.type]=(e.byType[s.type]||0)+1});const t=new Date(Date.now()-30*24*60*60*1e3);return this.activities.forEach(s=>{const i=new Date(s.timestamp);if(i>=t){const a=i.toDateString();e.byDate[a]=(e.byDate[a]||0)+1}}),this.activities.length>0&&(e.recentActivity=this.activities[0]),e}exportActivities(){return{userId:this.currentUserId,activities:this.activities,exportedAt:new Date().toISOString(),count:this.activities.length}}async logTenderCreate(e,t){return await this.logActivity(yo.ActivityTypes.TENDER_CREATE,`   : ${e}`,{tenderInternalId:t,tenderTitle:e})}async logTenderUpdate(e,t){return await this.logActivity(yo.ActivityTypes.TENDER_UPDATE,`  : ${e}`,{tenderInternalId:t,tenderTitle:e})}async logItemAdd(e,t){return await this.logActivity(yo.ActivityTypes.ITEM_ADD,`  : ${e}   ${t}`,{itemName:e,tenderTitle:t})}async logDocumentUpload(e,t){return await this.logActivity(yo.ActivityTypes.DOCUMENT_UPLOAD,`  : ${e}  ${t}`,{fileName:e,tenderTitle:t})}async logUserLogin(){return await this.logActivity(yo.ActivityTypes.USER_LOGIN,"  ",{loginTime:new Date().toISOString()})}};ur(yo,"ActivityTypes",{TENDER_CREATE:"tender_create",TENDER_UPDATE:"tender_update",TENDER_DELETE:"tender_delete",TENDER_SUBMIT:"tender_submit",ITEM_ADD:"item_add",ITEM_UPDATE:"item_update",ITEM_DELETE:"item_delete",DOCUMENT_UPLOAD:"document_upload",DOCUMENT_DELETE:"document_delete",MATERIAL_CREATE:"material_create",MATERIAL_UPDATE:"material_update",MATERIAL_DELETE:"material_delete",SUPPLIER_CREATE:"supplier_create",SUPPLIER_UPDATE:"supplier_update",USER_LOGIN:"user_login",USER_LOGOUT:"user_logout",SETTINGS_UPDATE:"settings_update",DATA_IMPORT:"data_import",DATA_EXPORT:"data_export"});let yw=yo;const Cr=new yw;Ki.onAuthStateChanged(async n=>{if(n)try{await Cr.initialize(),await Cr.logUserLogin(),console.log(" Activity logging initialized")}catch(e){console.error("Error initializing activity logging:",e)}else Cr.currentUserId=null,Cr.activities=[]});const RR=b.createContext(),$t=()=>{const n=b.useContext(RR);if(!n)throw new Error("useActivity must be used within ActivityProvider");return n},At=({children:n})=>{const[e,t]=b.useState([]),[s,i]=b.useState(!0),[a,o]=b.useState(null);b.useEffect(()=>{const N=async()=>{try{i(!0),o(null),await Cr.initialize();const V=(Cr.activities||[]).map($=>({...$,status:$.status==="open"?"done":$.status}));t(V),console.log(` Loaded ${V.length} activities from Firestore`)}catch(j){console.error("Error initializing activities:",j),o("    "),t([])}finally{i(!1)}};if(It.currentUser)N();else return It.onAuthStateChanged(V=>{V?N():(t([]),i(!1))})},[]),b.useEffect(()=>Cr.addListener(j=>{if(j){const V=j.map($=>({...$,status:$.status==="open"?"done":$.status}));t(V)}}),[]);const[l]=b.useState([{id:"user1",name:" ",avatarUrl:null},{id:"user2",name:" ",avatarUrl:null},{id:"user3",name:" ",avatarUrl:null},{id:"user4",name:" ",avatarUrl:null}]),c=()=>l[0],d=async(N,j,V,$=!1)=>{try{const Z=await Cr.logActivity(N,V,{title:j,isManual:$,status:"done",user:c(),at:Date.now(),createdAt:new Date().toISOString()});return Z?(console.log(" Activity logged:",V),Z):(console.error("Failed to log activity:",V),null)}catch(Z){return console.error("Error logging activity:",Z),null}},g={activities:e,users:l,loading:s,error:a,addActivity:d,logActivity:async(N,j,V)=>await d(N,j,V,!1),createManualActivity:async N=>await d(N.type,N.title,N.description,!0),updateActivityStatus:async(N,j)=>{try{await Cr.updateActivity(N,{status:j})?console.log(" Activity status updated:",N,j):console.error("Failed to update activity status:",N)}catch(V){console.error("Error updating activity status:",V)}},deleteActivity:async N=>{try{await Cr.deleteActivity(N)?console.log(" Activity deleted:",N):console.error("Failed to delete activity:",N)}catch(j){console.error("Error deleting activity:",j)}},clearAllActivities:async()=>{try{const N=await Cr.clearAllActivities();return N&&console.log(" All activities cleared"),N}catch(N){return console.error("Error clearing activities:",N),!1}},getActivityStats:()=>Cr.getActivityStats(),searchActivities:N=>Cr.searchActivities(N),getCurrentUser:c};return r.jsx(RR.Provider,{value:g,children:n})},Dt=({children:n})=>n;function _n({rtl:n=!0}){const{activities:e,users:t}=$t(),[s,i]=b.useState(!1),[a,o]=b.useState(!1),[l,c]=b.useState(new Date),[d,h]=b.useState(null),[f,p]=b.useState(null),x=T=>{const L=["#e74c3c","#3498db","#2ecc71","#f39c12","#9b59b6","#1abc9c","#34495e","#e67e22","#95a5a6","#fd79a8"];if(!T)return L[0];let G=0;for(let k=0;k<T.length;k++)G=T.charCodeAt(k)+((G<<5)-G);const U=Math.abs(G)%L.length;return L[U]},I=["","","","","","","","","","","",""],D=["","","","","","",""],A=T=>{const L=T.getFullYear(),G=T.getMonth(),U=new Date(L,G,1),re=new Date(L,G+1,0).getDate(),xe=U.getDay(),H=[],ee=new Date(L,G-1,0);for(let Y=xe-1;Y>=0;Y--)H.push({day:ee.getDate()-Y,isCurrentMonth:!1,isNextMonth:!1});for(let Y=1;Y<=re;Y++)H.push({day:Y,isCurrentMonth:!0,isNextMonth:!1});const se=42-H.length;for(let Y=1;Y<=se;Y++)H.push({day:Y,isCurrentMonth:!1,isNextMonth:!0});return H},g=()=>{c(new Date(l.getFullYear(),l.getMonth()-1))},N=()=>{c(new Date(l.getFullYear(),l.getMonth()+1))},j=(T,L,G)=>{if(!L)return;const U=new Date(l.getFullYear(),l.getMonth(),T);h(U)},V=()=>{console.log("Filter applied:",{selectedDate:d}),i(!1)},$=()=>{i(!1),h(null)},Z=T=>{p(T===f?null:T)},O=()=>{console.log("User filter applied:",f),o(!1)},M=()=>{o(!1),p(null)};return r.jsxs("div",{className:"card shadow-lg",style:{position:"fixed",left:"20px",top:"145px",width:"360px",height:"calc(100vh - 185px)",zIndex:10,border:"none",borderRadius:"12px",display:"flex",flexDirection:"column"},children:[r.jsx("div",{style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",padding:"20px",color:"white",height:"80px",display:"flex",flexDirection:"column",justifyContent:"center",flexShrink:0,borderTopLeftRadius:"12px",borderTopRightRadius:"12px"},children:r.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-clock-history me-2",style:{fontSize:"20px"}}),r.jsx("h6",{className:"mb-0 fw-semibold",children:" "})]}),r.jsxs("div",{className:"d-flex gap-2",children:[r.jsxs("button",{className:`btn btn-sm ${a?"btn-light":"btn-outline-light"} border-0`,onClick:()=>o(!a),style:{fontSize:"12px",borderRadius:"8px",padding:"6px 12px",transition:"all 0.2s ease",backgroundColor:a?"rgba(255,255,255,0.2)":"transparent",color:"white",border:a?"1px solid rgba(255,255,255,0.3)":"1px solid transparent"},onMouseEnter:T=>{a||(T.target.style.backgroundColor="rgba(255,255,255,0.1)",T.target.style.borderColor="rgba(255,255,255,0.2)")},onMouseLeave:T=>{a||(T.target.style.backgroundColor="transparent",T.target.style.borderColor="transparent")},children:[r.jsx("i",{className:`bi ${a?"bi-person-fill":"bi-person"} me-2`}),"Users"]}),r.jsxs("button",{className:`btn btn-sm ${s?"btn-light":"btn-outline-light"} border-0`,onClick:()=>i(!s),style:{fontSize:"12px",borderRadius:"8px",padding:"6px 12px",transition:"all 0.2s ease",backgroundColor:s?"rgba(255,255,255,0.2)":"transparent",color:"white",border:s?"1px solid rgba(255,255,255,0.3)":"1px solid transparent"},onMouseEnter:T=>{s||(T.target.style.backgroundColor="rgba(255,255,255,0.1)",T.target.style.borderColor="rgba(255,255,255,0.2)")},onMouseLeave:T=>{s||(T.target.style.backgroundColor="transparent",T.target.style.borderColor="transparent")},children:[r.jsx("i",{className:`bi ${s?"bi-funnel-fill":"bi-funnel"} me-2`}),"Filter"]})]})]})}),r.jsxs("div",{style:{flex:1,overflow:"auto",display:"flex",flexDirection:"column"},children:[s&&r.jsx("div",{style:{background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)",borderTop:"1px solid rgba(0,0,0,0.08)"},children:r.jsxs("div",{className:"p-4",children:[r.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[r.jsx("button",{className:"btn btn-sm shadow-sm",onClick:g,style:{backgroundColor:"#ffffff",border:"1px solid #dee2e6",borderRadius:"12px",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",color:"#495057"},onMouseEnter:T=>{T.target.style.backgroundColor="#e9ecef",T.target.style.transform="translateY(-1px)",T.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:T=>{T.target.style.backgroundColor="#ffffff",T.target.style.transform="translateY(0)",T.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:r.jsx("i",{className:"bi bi-chevron-right"})}),r.jsx("div",{className:"text-center",children:r.jsxs("h6",{className:"mb-0 fw-semibold",style:{color:"#2c3e50",fontSize:"16px",letterSpacing:"0.5px"},children:[I[l.getMonth()]," ",l.getFullYear()]})}),r.jsx("button",{className:"btn btn-sm shadow-sm",onClick:N,style:{backgroundColor:"#ffffff",border:"1px solid #dee2e6",borderRadius:"12px",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",color:"#495057"},onMouseEnter:T=>{T.target.style.backgroundColor="#e9ecef",T.target.style.transform="translateY(-1px)",T.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:T=>{T.target.style.backgroundColor="#ffffff",T.target.style.transform="translateY(0)",T.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:r.jsx("i",{className:"bi bi-chevron-left"})})]}),r.jsxs("div",{className:"calendar-grid mb-3",children:[r.jsx("div",{className:"row g-1 mb-3",children:D.map((T,L)=>r.jsx("div",{className:"col text-center",children:r.jsx("small",{className:"fw-bold",style:{color:"#6c757d",fontSize:"11px",letterSpacing:"0.5px"},children:T})},L))}),Array.from({length:6}).map((T,L)=>r.jsx("div",{className:"row g-1 mb-1",children:A(l).slice(L*7,(L+1)*7).map((G,U)=>r.jsx("div",{className:"col",children:r.jsx("button",{className:"btn btn-sm w-100 shadow-sm",style:{fontSize:"12px",height:"32px",borderRadius:"8px",border:"1px solid #dee2e6",backgroundColor:G.isCurrentMonth?d&&d.getDate()===G.day?"#0d6efd":G.day===new Date().getDate()&&l.getMonth()===new Date().getMonth()&&l.getFullYear()===new Date().getFullYear()?"#e7f3ff":"#ffffff":"#f8f9fa",color:G.isCurrentMonth?d&&d.getDate()===G.day?"#ffffff":G.day===new Date().getDate()&&l.getMonth()===new Date().getMonth()&&l.getFullYear()===new Date().getFullYear()?"#0d6efd":"#495057":"#adb5bd",opacity:G.isCurrentMonth?1:.6,transition:"all 0.2s ease",fontWeight:d&&d.getDate()===G.day?"600":"400"},onClick:()=>j(G.day,G.isCurrentMonth,G.isNextMonth),disabled:!G.isCurrentMonth,onMouseEnter:k=>{G.isCurrentMonth&&!(d&&d.getDate()===G.day)&&(k.target.style.backgroundColor="#e9ecef",k.target.style.transform="translateY(-1px)")},onMouseLeave:k=>{G.isCurrentMonth&&!(d&&d.getDate()===G.day)&&(k.target.style.backgroundColor=G.day===new Date().getDate()&&l.getMonth()===new Date().getMonth()&&l.getFullYear()===new Date().getFullYear()?"#e7f3ff":"#ffffff",k.target.style.transform="translateY(0)")},children:G.day})},U))},L))]}),r.jsxs("div",{className:"row g-3 mx-2 justify-content-center align-items-center",style:{marginTop:"22px"},children:[r.jsx("div",{className:"col-6",children:r.jsx("button",{className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:$,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#ffffff",border:"1px solid #dee2e6",color:"#6c757d",transition:"all 0.2s ease"},onMouseEnter:T=>{T.target.style.backgroundColor="#f8f9fa",T.target.style.transform="translateY(-1px)",T.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:T=>{T.target.style.backgroundColor="#ffffff",T.target.style.transform="translateY(0)",T.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:""})}),r.jsx("div",{className:"col-6",children:r.jsx("button",{className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:V,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#0d6efd",border:"1px solid #0d6efd",color:"#ffffff",transition:"all 0.2s ease"},onMouseEnter:T=>{T.target.style.backgroundColor="#0b5ed7",T.target.style.transform="translateY(-1px)",T.target.style.boxShadow="0 4px 12px rgba(13,110,253,0.3)"},onMouseLeave:T=>{T.target.style.backgroundColor="#0d6efd",T.target.style.transform="translateY(0)",T.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:""})})]})]})}),a&&r.jsx("div",{style:{background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)",borderTop:"1px solid rgba(0,0,0,0.08)"},children:r.jsxs("div",{className:"p-4",children:[r.jsx("div",{className:"text-center mb-3",children:r.jsx("h6",{className:"mb-0 fw-semibold",style:{color:"#2c3e50",fontSize:"16px",letterSpacing:"0.5px"},children:"  "})}),r.jsx("div",{className:"mb-4",style:{background:"#ffffff",border:"1px solid #dee2e6",borderRadius:"8px",padding:"16px"},children:t.length>0?r.jsx("div",{className:"d-flex flex-column gap-1",children:t.map((T,L)=>r.jsx("div",{className:"d-flex align-items-center p-2",style:{borderBottom:L!==t.length-1?"1px solid #f8f9fa":"none"},children:r.jsxs("div",{className:"d-flex align-items-center w-100 justify-content-between",children:[r.jsx("input",{className:"form-check-input",type:"radio",name:"userFilter",id:`user-${T.id}`,checked:f===T.id,onChange:()=>Z(T.id),style:{cursor:"pointer",margin:"0",transform:"scale(0.7)",width:"14px",height:"14px",minWidth:"14px"}}),r.jsx("label",{className:"form-check-label flex-grow-1 text-end",htmlFor:`user-${T.id}`,style:{cursor:"pointer",fontSize:"14px",fontWeight:"500",color:f===T.id?"#0d6efd":"#495057",marginRight:"8px"},children:T.name})]})},T.id))}):r.jsxs("div",{className:"text-center py-3",children:[r.jsx("i",{className:"bi bi-people text-muted",style:{fontSize:"2rem"}}),r.jsx("p",{className:"text-muted mt-2 mb-0",children:"   "})]})}),r.jsxs("div",{className:"row g-3 mx-2 justify-content-center align-items-center",children:[r.jsx("div",{className:"col-6",children:r.jsx("button",{className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:M,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#ffffff",border:"1px solid #dee2e6",color:"#6c757d",transition:"all 0.2s ease"},onMouseEnter:T=>{T.target.style.backgroundColor="#f8f9fa",T.target.style.transform="translateY(-1px)",T.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:T=>{T.target.style.backgroundColor="#ffffff",T.target.style.transform="translateY(0)",T.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:""})}),r.jsx("div",{className:"col-6",children:r.jsx("button",{className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:O,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#0d6efd",border:"1px solid #0d6efd",color:"#ffffff",transition:"all 0.2s ease"},onMouseEnter:T=>{T.target.style.backgroundColor="#0b5ed7",T.target.style.transform="translateY(-1px)",T.target.style.boxShadow="0 4px 12px rgba(13,110,253,0.3)"},onMouseLeave:T=>{T.target.style.backgroundColor="#0d6efd",T.target.style.transform="translateY(0)",T.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:""})})]})]})}),r.jsx("div",{className:"card-body p-0",style:{flex:1},children:e.length>0?r.jsx("div",{className:"list-group list-group-flush",children:e.map((T,L)=>{var G,U;return r.jsxs("div",{className:`list-group-item border-0 py-3 ${L!==e.length-1?"border-bottom":""}`,style:{borderBottomColor:"#e9ecef !important",borderBottomWidth:"1px !important"},children:[r.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[r.jsxs("div",{className:"d-flex align-items-center gap-2",children:[r.jsx("h6",{className:"mb-1 text-dark",children:T.title}),T.isManual&&r.jsx("span",{className:"badge bg-info",style:{fontSize:"10px"},children:""})]}),r.jsx("span",{className:`badge ${T.status==="done"?"bg-success":T.status==="open"?"bg-warning":"bg-danger"}`,children:T.status==="done"?"":T.status==="open"?"":""})]}),T.description&&r.jsx("p",{className:"mb-2 text-muted small",children:T.description}),r.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[r.jsxs("div",{className:"d-flex align-items-center text-muted small",children:[r.jsx("i",{className:"bi bi-person me-1"}),r.jsx("span",{className:"me-3 fw-semibold",style:{color:x((G=T.user)==null?void 0:G.name),fontSize:"13px"},children:(U=T.user)==null?void 0:U.name})]}),r.jsx("small",{className:"text-muted",children:new Date(T.at).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})})]}),T.type&&r.jsxs("div",{className:"mt-2",children:[r.jsx("i",{className:`bi ${T.type==="task"?"bi-list-task":T.type==="call"?"bi-telephone":T.type==="email"?"bi-envelope":T.type==="meeting"?"bi-people":"bi-sticky"} me-1 text-primary`}),r.jsx("small",{className:"text-primary",children:T.type==="task"?"":T.type==="call"?"":T.type==="email"?" ":T.type==="meeting"?"":""})]})]},T.id||L)})}):r.jsxs("div",{className:"text-center py-5",children:[r.jsx("i",{className:"bi bi-clock-history text-muted",style:{fontSize:"3rem"}}),r.jsx("p",{className:"text-muted mt-3 mb-0",children:"   "})]})})]})]})}function En(){const[n,e]=b.useState(!1),[t,s]=b.useState({type:"task",title:"",description:""}),{createManualActivity:i}=$t(),a=[{value:"task",label:"",icon:"bi-list-task"},{value:"call",label:"",icon:"bi-telephone"},{value:"email",label:" ",icon:"bi-envelope"},{value:"meeting",label:"",icon:"bi-people"},{value:"note",label:"",icon:"bi-sticky"}],o=c=>{c.preventDefault(),t.title.trim()&&(i(t),s({type:"task",title:"",description:""}),e(!1))},l=()=>{s({type:"task",title:"",description:""}),e(!1)};return r.jsx("div",{style:{position:"fixed",left:"20px",bottom:"20px",zIndex:1e3},children:n?r.jsxs("div",{className:"card shadow-lg",style:{width:"360px",maxHeight:"500px",border:"none",borderRadius:"12px",overflow:"hidden"},children:[r.jsx("div",{style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",padding:"20px",color:"white"},children:r.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[r.jsx("div",{className:"d-flex align-items-center",children:r.jsx("h6",{className:"mb-0 fw-semibold",children:"  "})}),r.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:l,style:{fontSize:"12px",opacity:.8},onMouseEnter:c=>c.target.style.opacity="1",onMouseLeave:c=>c.target.style.opacity="0.8"})]})}),r.jsx("div",{style:{background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)",padding:"24px"},children:r.jsxs("form",{onSubmit:o,children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"form-label fw-semibold",style:{color:"#2c3e50",fontSize:"14px",letterSpacing:"0.3px"},children:" "}),r.jsx("select",{className:"form-select shadow-sm",value:t.type,onChange:c=>s(d=>({...d,type:c.target.value})),style:{fontSize:"14px",borderRadius:"8px",border:"1px solid #dee2e6",backgroundColor:"#ffffff",padding:"10px 12px",transition:"all 0.2s ease",backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"left 12px center",backgroundSize:"12px",paddingLeft:"36px",paddingRight:"12px",textAlign:"right",direction:"rtl"},onFocus:c=>{c.target.style.borderColor="#0d6efd",c.target.style.boxShadow="0 0 0 0.2rem rgba(13,110,253,.25)"},onBlur:c=>{c.target.style.borderColor="#dee2e6",c.target.style.boxShadow="none"},children:a.map(c=>r.jsx("option",{value:c.value,children:c.label},c.value))})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"form-label fw-semibold",style:{color:"#2c3e50",fontSize:"14px",letterSpacing:"0.3px"},children:" *"}),r.jsx("input",{type:"text",className:"form-control shadow-sm",value:t.title,onChange:c=>s(d=>({...d,title:c.target.value})),placeholder:"  ",required:!0,style:{fontSize:"14px",borderRadius:"8px",border:"1px solid #dee2e6",backgroundColor:"#ffffff",padding:"10px 12px",transition:"all 0.2s ease"},onFocus:c=>{c.target.style.borderColor="#0d6efd",c.target.style.boxShadow="0 0 0 0.2rem rgba(13,110,253,.25)"},onBlur:c=>{c.target.style.borderColor="#dee2e6",c.target.style.boxShadow="none"}})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"form-label fw-semibold",style:{color:"#2c3e50",fontSize:"14px",letterSpacing:"0.3px"},children:""}),r.jsx("textarea",{className:"form-control shadow-sm",rows:"3",value:t.description,onChange:c=>s(d=>({...d,description:c.target.value})),placeholder:"   ()",style:{fontSize:"14px",borderRadius:"8px",border:"1px solid #dee2e6",backgroundColor:"#ffffff",padding:"10px 12px",resize:"none",transition:"all 0.2s ease"},onFocus:c=>{c.target.style.borderColor="#0d6efd",c.target.style.boxShadow="0 0 0 0.2rem rgba(13,110,253,.25)"},onBlur:c=>{c.target.style.borderColor="#dee2e6",c.target.style.boxShadow="none"}})]}),r.jsxs("div",{className:"row g-3 mx-2 justify-content-center align-items-center",style:{marginTop:"22px"},children:[r.jsx("div",{className:"col-6",children:r.jsx("button",{type:"button",className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:l,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#ffffff",border:"1px solid #dee2e6",color:"#6c757d",transition:"all 0.2s ease"},onMouseEnter:c=>{c.target.style.backgroundColor="#f8f9fa",c.target.style.transform="translateY(-1px)",c.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:c=>{c.target.style.backgroundColor="#ffffff",c.target.style.transform="translateY(0)",c.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:""})}),r.jsx("div",{className:"col-6",children:r.jsx("button",{type:"submit",className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#0d6efd",border:"1px solid #0d6efd",color:"#ffffff",transition:"all 0.2s ease"},onMouseEnter:c=>{c.target.style.backgroundColor="#0b5ed7",c.target.style.transform="translateY(-1px)",c.target.style.boxShadow="0 4px 12px rgba(13,110,253,0.3)"},onMouseLeave:c=>{c.target.style.backgroundColor="#0d6efd",c.target.style.transform="translateY(0)",c.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:""})})]})]})})]}):r.jsx("button",{onClick:()=>e(!0),className:"btn btn-primary rounded-circle shadow-lg",style:{width:"56px",height:"56px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",border:"none"},title:"  ",children:r.jsx("i",{className:"bi bi-chat-left-text"})})})}function z8(){const[n,e]=b.useState(!1),{isTimelineVisible:t}=gn(),s=()=>{e(!n)};return r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[r.jsx(Nn,{onToggle:s}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),r.jsx(jn,{}),r.jsx("div",{className:"app-content-area p-3",children:r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"mb-4",children:r.jsx("i",{className:"bi bi-speedometer2",style:{fontSize:"80px",color:"#007bff"}})}),r.jsx("h4",{className:"text-muted mb-3",children:" "}),r.jsx("p",{className:"text-muted",children:"     "})]})}),r.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:r.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&t&&r.jsx(_n,{rtl:!0}),!n&&t&&r.jsx(En,{})]})}function vI(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(z8,{})})})}class PR extends WN{constructor(){super("tenders")}validateTenderData(e){var s,i,a;const t={};return(s=e.title)!=null&&s.trim()||(t.title="  "),(i=e.referenceNumber)!=null&&i.trim()||(t.referenceNumber="  "),(a=e.entity)!=null&&a.trim()||(t.entity="  "),e.submissionDeadline||(t.submissionDeadline="   "),t}async checkDuplicateReferenceNumber(e,t=null){try{return(await this.search(e,["referenceNumber"])).some(i=>i.referenceNumber===e&&i.id!==t)}catch(s){return console.error("Error checking duplicate reference number:",s),!1}}async createTender(e,t={}){try{const s=this.validateTenderData(e);if(Object.keys(s).length>0)throw new Error(`  : ${Object.values(s).join(", ")}`);if(await this.checkDuplicateReferenceNumber(e.referenceNumber))throw new Error("     -    ");const i={...e,internalId:ct("TENDER"),status:"draft",items:e.items||[],documents:e.documents||[],submissionDeadline:e.submissionDeadline?new Date(e.submissionDeadline):null};return await this.create(i,{...t,updateCache:!0})}catch(s){throw console.error("Error creating tender:",s),s}}async updateTender(e,t,s={}){try{const i=this.validateTenderData(t);if(Object.keys(i).length>0)throw new Error(`  : ${Object.values(i).join(", ")}`);if(t.referenceNumber&&await this.checkDuplicateReferenceNumber(t.referenceNumber,e))throw new Error("     -    ");const a={...t,submissionDeadline:t.submissionDeadline?new Date(t.submissionDeadline):null};return await this.update(e,a,{...s,updateCache:!0})}catch(i){throw console.error("Error updating tender:",i),i}}async getTenderByInternalId(e){try{return(await this.search(e,["internalId"])).find(s=>s.internalId===e)||null}catch(t){throw console.error("Error fetching tender by internal ID:",t),t}}async getAllTenders(e={}){return await this.getAll({updateCache:!0,...e})}async searchTenders(e){return await this.search(e,["title","referenceNumber","entity","description","internalId"])}async addTenderItem(e,t){try{const s=await this.getById(e);if(!s)throw new Error("Tender not found");const i={...t,internalId:ct("TENDER_ITEM"),addedAt:new Date,materialInternalId:t.materialInternalId||t.materialId},a=s.items||[];if(a.some(c=>c.materialInternalId===i.materialInternalId))throw new Error(` ${t.materialName||" "}    `);const l=[...a,i];return await this.updateTender(e,{...s,items:l,estimatedValue:this.calculateEstimatedValue(l)}),i.internalId}catch(s){throw console.error("Error adding tender item:",s),s}}async updateTenderItem(e,t,s){try{const i=await this.getById(e);if(!i)throw new Error("Tender not found");const a=i.items||[],o=a.findIndex(l=>l.internalId===t);if(o===-1)throw new Error("Tender item not found");return a[o]={...a[o],...s,updatedAt:new Date},await this.updateTender(e,{...i,items:a,estimatedValue:this.calculateEstimatedValue(a)}),!0}catch(i){throw console.error("Error updating tender item:",i),i}}async removeTenderItem(e,t){try{const s=await this.getById(e);if(!s)throw new Error("Tender not found");const a=(s.items||[]).filter(o=>o.internalId!==t);return await this.updateTender(e,{...s,items:a,estimatedValue:this.calculateEstimatedValue(a)}),!0}catch(s){throw console.error("Error removing tender item:",s),s}}calculateEstimatedValue(e){return!e||!Array.isArray(e)?0:e.reduce((t,s)=>{const i=parseFloat(s.unitPrice||0),a=parseFloat(s.quantity||1);return t+i*a},0)}async addTenderDocument(e,t){try{const s=await this.getById(e);if(!s)throw new Error("Tender not found");const i={...t,internalId:ct("DOCUMENT"),uploadedAt:new Date},o=[...s.documents||[],i];return await this.updateTender(e,{...s,documents:o}),i.internalId}catch(s){throw console.error("Error adding tender document:",s),s}}async removeTenderDocument(e,t){try{const s=await this.getById(e);if(!s)throw new Error("Tender not found");const a=(s.documents||[]).filter(o=>o.internalId!==t);return await this.updateTender(e,{...s,documents:a}),!0}catch(s){throw console.error("Error removing tender document:",s),s}}async updateTenderStatus(e,t){try{if(!["draft","submitted","in_review","awarded","rejected","cancelled"].includes(t))throw new Error(`  : ${t}`);const i=await this.getById(e);if(!i)throw new Error("Tender not found");return await this.updateTender(e,{...i,status:t,statusUpdatedAt:new Date}),!0}catch(s){throw console.error("Error updating tender status:",s),s}}}const ya=new PR,YN=Object.freeze(Object.defineProperty({__proto__:null,TenderServiceNew:PR,tenderServiceNew:ya},Symbol.toStringTag,{value:"Module"}));class om{static async getAllTenders(){try{console.log(" Fetching tenders from Firestore...");const e=await ya.getAllTenders();return console.log(" Loaded tenders from Firestore:",e.length),e}catch(e){throw console.error(" Error fetching tenders:",e),new Error("    : "+e.message)}}static async getTenderById(e){try{console.log(" Fetching tender by ID:",e);const t=await ya.getById(e);if(!t)throw new Error("  ");return t}catch(t){throw console.error(" Error fetching tender:",t),new Error("    : "+t.message)}}static async createTender(e){try{console.log(" Creating tender in Firestore...");const t={...e,internalId:e.internalId||ct("TENDER")},s=await ya.create(t);return console.log(" Tender created in Firestore with ID:",s.id),s.id}catch(t){throw console.error(" Error creating tender:",t),new Error("   : "+t.message)}}static async updateTender(e,t){try{console.log(" Updating tender in Firestore:",e);const s={...t},i=await ya.update(e,s);return console.log(" Tender updated in Firestore"),!0}catch(s){throw console.error(" Error updating tender:",s),new Error("    : "+s.message)}}static async deleteTender(e){try{return console.log(" Deleting tender from Firestore:",e),await ya.delete(e),console.log(" Tender deleted from Firestore"),!0}catch(t){throw console.error(" Error deleting tender:",t),new Error("   : "+t.message)}}static validateTenderData(e){var s,i,a;const t={};if((s=e.title)!=null&&s.trim()||(t.title="  "),(i=e.referenceNumber)!=null&&i.trim()||(t.referenceNumber="  "),(a=e.entity)!=null&&a.trim()||(t.entity=" "),e.submissionDeadline){const o=new Date(e.submissionDeadline),l=new Date;l.setHours(0,0,0,0),o<l&&(t.submissionDeadline="      ")}if(e.estimatedValue!==void 0&&e.estimatedValue!==""){const o=parseFloat(e.estimatedValue);(isNaN(o)||o<0)&&(t.estimatedValue="      ")}return e.contactEmail&&e.contactEmail.trim()&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.contactEmail.trim())||(t.contactEmail="    ")),t}static async searchTenders(e){try{return(await this.getAllTenders()).filter(s=>{var i,a,o;return((i=s.title)==null?void 0:i.toLowerCase().includes(e.toLowerCase()))||((a=s.referenceNumber)==null?void 0:a.toLowerCase().includes(e.toLowerCase()))||((o=s.entity)==null?void 0:o.toLowerCase().includes(e.toLowerCase()))})}catch(t){throw console.error(" Error searching tenders:",t),new Error("    : "+t.message)}}static async getTendersByStatus(e){try{return(await this.getAllTenders()).filter(s=>s.status===e)}catch(t){throw console.error(" Error fetching tenders by status:",t),new Error("     : "+t.message)}}}class qe{static getCurrentUserId(){if(!It.currentUser)throw new Error("User not authenticated");return It.currentUser.uid}static createExpiryTimestamp(e=this.DEFAULT_EXPIRY_HOURS){const t=new Date;return t.setHours(t.getHours()+e),Gt.fromDate(t)}static async setPendingData(e,t,s=this.DEFAULT_EXPIRY_HOURS){try{const i=this.getCurrentUserId();console.log(" [FIRESTORE] Setting pending data:",e);const a=Ye(pe,this.COLLECTION_NAME,`${i}_${e}`),o={ownerId:i,key:e,data:t,expiresAt:this.createExpiryTimestamp(s),createdAt:it(),updatedAt:it()};return await uu(a,o),console.log(" [FIRESTORE] Pending data set:",e),!0}catch(i){throw console.error(" [FIRESTORE] Error setting pending data:",i),new Error("Failed to set pending data: "+i.message)}}static async getPendingData(e){try{const t=this.getCurrentUserId();console.log(" [FIRESTORE] Getting pending data:",e);const s=Ye(pe,this.COLLECTION_NAME,`${t}_${e}`),i=await Un(s);if(!i.exists())return console.log(" [FIRESTORE] No pending data found for key:",e),null;const a=i.data();return a.expiresAt&&a.expiresAt.toDate()<new Date?(console.log(" [FIRESTORE] Pending data expired, cleaning up:",e),await this.clearPendingData(e),null):(console.log(" [FIRESTORE] Retrieved pending data:",e),a.data)}catch(t){return console.error(" [FIRESTORE] Error getting pending data:",t),null}}static async clearPendingData(e){try{const t=this.getCurrentUserId();console.log(" [FIRESTORE] Clearing pending data:",e);const s=Ye(pe,this.COLLECTION_NAME,`${t}_${e}`);return await xs(s),console.log(" [FIRESTORE] Pending data cleared:",e),!0}catch(t){return console.error(" [FIRESTORE] Error clearing pending data:",t),!1}}static async getAllPendingData(){try{const e=this.getCurrentUserId();console.log(" [FIRESTORE] Getting all pending data");const t=Qe(pe,this.COLLECTION_NAME),s=pt(t,qt("ownerId","==",e),$n("createdAt","desc")),i=await lt(s),a={},o=[];return i.docs.forEach(l=>{const c=l.data();c.expiresAt&&c.expiresAt.toDate()<new Date?o.push(c.key):a[c.key]=c.data}),o.length>0&&await this.clearMultiplePendingData(o),console.log(" [FIRESTORE] Retrieved all pending data, keys:",Object.keys(a)),a}catch(e){return console.error(" [FIRESTORE] Error getting all pending data:",e),{}}}static async clearMultiplePendingData(e){try{const t=this.getCurrentUserId();console.log(" [FIRESTORE] Clearing multiple pending data:",e.length);const s=ka(pe);return e.forEach(i=>{const a=Ye(pe,this.COLLECTION_NAME,`${t}_${i}`);s.delete(a)}),await s.commit(),console.log(" [FIRESTORE] Multiple pending data cleared"),!0}catch(t){return console.error(" [FIRESTORE] Error clearing multiple pending data:",t),!1}}static async clearAllPendingData(){try{const e=this.getCurrentUserId();console.log(" [FIRESTORE] Clearing all pending data");const t=Qe(pe,this.COLLECTION_NAME),s=pt(t,qt("ownerId","==",e)),i=await lt(s),a=ka(pe);return i.docs.forEach(o=>{a.delete(o.ref)}),await a.commit(),console.log(" [FIRESTORE] All pending data cleared:",i.docs.length),i.docs.length}catch(e){return console.error(" [FIRESTORE] Error clearing all pending data:",e),0}}static async cleanupExpiredData(){try{const e=this.getCurrentUserId();console.log(" [FIRESTORE] Cleaning up expired data");const t=Qe(pe,this.COLLECTION_NAME),s=pt(t,qt("ownerId","==",e),qt("expiresAt","<",Gt.now())),i=await lt(s),a=ka(pe);return i.docs.forEach(o=>{a.delete(o.ref)}),await a.commit(),console.log(" [FIRESTORE] Expired data cleaned up:",i.docs.length),i.docs.length}catch(e){return console.error(" [FIRESTORE] Error cleaning up expired data:",e),0}}static async setPendingTenderItems(e){return this.setPendingData("pendingTenderItems",e,48)}static async getPendingTenderItems(){return this.getPendingData("pendingTenderItems")}static async clearPendingTenderItems(){return this.clearPendingData("pendingTenderItems")}static async mergePendingTenderItems(e){try{console.log(" [FIRESTORE] Merging pending tender items:",e.length);const t=await this.getPendingTenderItems()||[],s=[...t,...e];return await this.setPendingTenderItems(s),console.log(" [FIRESTORE] Pending tender items merged:",{existing:t.length,new:e.length,total:s.length}),!0}catch(t){throw console.error(" [FIRESTORE] Error merging pending tender items:",t),new Error("Failed to merge pending tender items: "+t.message)}}static async setPendingProductItems(e){return this.setPendingData("pendingProductItems",e,48)}static async getPendingProductItems(){return this.getPendingData("pendingProductItems")}static async clearPendingProductItems(){return this.clearPendingData("pendingProductItems")}static async mergePendingProductItems(e){try{console.log(" [FIRESTORE] Merging pending product items:",e.length);const t=await this.getPendingProductItems()||[],s=[...t,...e];return await this.setPendingProductItems(s),console.log(" [FIRESTORE] Pending product items merged:",{existing:t.length,new:e.length,total:s.length}),!0}catch(t){throw console.error(" [FIRESTORE] Error merging pending product items:",t),new Error("Failed to merge pending product items: "+t.message)}}static async setSessionData(e,t,s=24){return this.setPendingData(e,t,s)}static async getSessionData(e){return this.getPendingData(e)}static async clearSessionData(e){return this.clearPendingData(e)}}ur(qe,"COLLECTION_NAME","pendingData"),ur(qe,"DEFAULT_EXPIRY_HOURS",24);class un{static sanitizeData(e){const t={};for(const[s,i]of Object.entries(e))i!=null&&(i instanceof Date?t[s]=i.toISOString():typeof i=="object"&&i!==null&&!Array.isArray(i)?t[s]=this.sanitizeData(i):t[s]=i);return t}static async moveToTrash(e,t){try{const s=e.title||e.name||e.fileName||e.supplierName||"  ";console.log("Moving to trash:",s,"from",t);let{id:i,...a}=e;if((!i||i===void 0||i===null)&&(i=`generated_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,console.log(" Missing document ID, generated new one:",i)),(await this.getAllTrashItems()).some(f=>f.originalId===i&&f.originalCollection===t&&(f.name===e.name||f.title===e.title||f.fileName===e.fileName||f.supplierName===e.supplierName)))return console.log("Item already exists in trash, skipping"),null;const d={...this.sanitizeData(a),originalId:i,originalCollection:t,deletedAt:it(),deletedBy:" "};console.log(" Adding to trash collection:",{displayName:s,originalCollection:t,originalId:i,hasRequiredFields:!!(d.originalId&&d.originalCollection)});const h=await Ys(Qe(pe,this.COLLECTION_NAME),d);return console.log(" Successfully moved to trash with ID:",h.id),h.id}catch(s){throw console.error(" Error moving to trash:",s),console.error("Error details:",{name:s.name,message:s.message,code:s.code,stack:s.stack,itemData:{id:e.id,displayName:e.name||e.fileName||e.supplierName,originalCollection:t,hasId:!!e.id}}),new Error(`      : ${s.message}`)}}static async getAllTrashItems(){try{const e=pt(Qe(pe,this.COLLECTION_NAME),$n("deletedAt","desc")),t=await lt(e),s=[],i=new Map;return t.forEach(a=>{var d,h;const o=a.data(),l={id:a.id,...o,deletedAt:((h=(d=o.deletedAt)==null?void 0:d.toDate)==null?void 0:h.call(d))||new Date};o.originalCollection==="price_quotes"&&(console.log("=== TRASH RECORD DEBUG ==="),console.log("Document ID:",a.id),console.log("Original Collection:",o.originalCollection),console.log("Item keys:",Object.keys(o)),console.log("Context data:",{rawMaterialId:o.rawMaterialId,rawMaterialName:o.rawMaterialName,localProductId:o.localProductId,localProductName:o.localProductName,foreignProductId:o.foreignProductId,foreignProductName:o.foreignProductName,supplierName:o.supplierName,price:o.price,date:o.date}),console.log("Full item data:",o));const c=`${o.originalId||o.id}-${o.originalCollection}-${o.name||o.title}`;i.has(c)?(console.log("Found duplicate item:",c,"marking for deletion"),this.permanentlyDelete(a.id).catch(console.error)):(i.set(c,l),s.push(l))}),console.log("Found",s.length,"unique items in trash (removed duplicates)"),s}catch(e){throw console.error("Error getting trash items:",e),new Error("     ")}}static async permanentlyDelete(e){try{if(console.log("Permanently deleting item:",e),!(await this.getAllTrashItems()).some(o=>o.id===e))return console.log("Item already deleted or does not exist:",e),!0;if(await xs(Ye(pe,this.COLLECTION_NAME,e)),(await this.getAllTrashItems()).some(o=>o.id===e))throw new Error("    -    ");return console.log("Successfully deleted from trash:",e),!0}catch(t){throw console.error("Error deleting from trash:",t),new Error("      : "+t.message)}}static async restoreItem(e){var s;let t=null;try{console.log("=== STARTING RESTORATION PROCESS ==="),console.log("Trash ID to restore:",e);const i=await this.getAllTrashItems();if(console.log("Total trash items found:",i.length),t=i.find(f=>f.id===e),!t)throw console.error("RESTORATION FAILED: Item not found in trash"),console.log("Available trash IDs:",i.map(f=>f.id)),new Error("     ");console.log("=== TRASH ITEM FOUND ==="),console.log("Item to restore:",{id:t.id,originalCollection:t.originalCollection,name:t.name||t.supplierName,hasRawMaterialId:!!t.rawMaterialId,hasLocalProductId:!!t.localProductId,hasForeignProductId:!!t.foreignProductId});const{id:a,originalId:o,originalCollection:l,deletedAt:c,deletedBy:d,...h}=t;if(l==="suppliers"){const{SupplierService:f}=await ns(async()=>{const{SupplierService:p}=await Promise.resolve().then(()=>h9);return{SupplierService:p}},[]);await f.createSupplier(h)}else if(l==="foreignSuppliers"){const{ForeignSupplierService:f}=await ns(async()=>{const{ForeignSupplierService:p}=await Promise.resolve().then(()=>m9);return{ForeignSupplierService:p}},void 0);await f.createSupplier(h)}else if(l==="customers"){const{CustomerService:f}=await ns(async()=>{const{CustomerService:p}=await Promise.resolve().then(()=>Q9);return{CustomerService:p}},void 0);await f.createCustomer(h)}else if(l==="employees"){const{EmployeeService:f}=await ns(async()=>{const{EmployeeService:p}=await Promise.resolve().then(()=>rB);return{EmployeeService:p}},void 0);await f.createEmployee(h)}else if(l==="rawmaterials"){const{RawMaterialService:f}=await ns(async()=>{const{RawMaterialService:p}=await Promise.resolve().then(()=>ax);return{RawMaterialService:p}},void 0);await f.createRawMaterial(h)}else if(l==="localproducts"){const{LocalProductService:f}=await ns(async()=>{const{LocalProductService:p}=await Promise.resolve().then(()=>ox);return{LocalProductService:p}},void 0);await f.createLocalProduct(h)}else if(l==="foreignproducts"){const{ForeignProductService:f}=await ns(async()=>{const{ForeignProductService:p}=await Promise.resolve().then(()=>lx);return{ForeignProductService:p}},void 0);await f.createForeignProduct(h)}else if(l==="price_quotes")if(console.log("=== RESTORING PRICE QUOTE ==="),console.log("Trash item keys:",Object.keys(t)),console.log("Has rawMaterialId:",!!t.rawMaterialId,t.rawMaterialId),console.log("Has localProductId:",!!t.localProductId,t.localProductId),console.log("Has foreignProductId:",!!t.foreignProductId,t.foreignProductId),t.rawMaterialId)console.log("Restoring to raw material..."),await this.restorePriceQuoteToRawMaterial(t,h);else if(t.localProductId)console.log("Restoring to local product..."),await this.restorePriceQuoteToLocalProduct(t,h);else if(t.foreignProductId)console.log("Restoring to foreign product..."),await this.restorePriceQuoteToForeignProduct(t,h);else throw console.error("No valid product ID found in trash item:",{rawMaterialId:t.rawMaterialId,localProductId:t.localProductId,foreignProductId:t.foreignProductId,allKeys:Object.keys(t)}),new Error("     -      ");else if(l==="tenderItems"){console.log("=== RESTORING TENDER ITEM ==="),console.log("Tender context:",t.tenderContext);const f=((s=t.tenderContext)==null?void 0:s.tenderId)||"new",p=`tenderItems_${f}`;let x=[];try{const D=await qe.getPendingData(p);x=D?JSON.parse(D):[]}catch(D){console.warn("Error parsing existing tender items:",D),x=[]}if(x.some(D=>D.internalId===h.internalId||D.materialInternalId===h.materialInternalId&&D.materialName===h.materialName))throw console.warn("Tender item already exists, not restoring to prevent duplicate"),new Error("     ");x.push({...h,restoredAt:new Date().toISOString(),restoredFrom:"trash"}),await qe.setPendingData(p,x),await qe.setPendingData("tenderItems_restored",Date.now().toString()),window.dispatchEvent(new CustomEvent("tenderItemRestored",{detail:{tenderId:f,restoredItem:h}})),console.log("Successfully restored tender item to Firestore session:",{tenderId:f,storageKey:p,itemCount:x.length,restoredItem:h.materialName||h.name})}else if(l==="tender_documents"){console.log("=== RESTORING TENDER DOCUMENT ==="),console.log("Document data:",h);const f=h.tenderId||"new",p=`tenderDocuments_${f}`;console.log("Restoring document to:",{tenderId:f,storageKey:p});let x=[];try{x=await qe.getPendingData(p)||[],console.log("Existing documents in Firestore session:",x.length)}catch(A){console.warn("Error parsing existing tender documents:",A),x=[]}if(x.some(A=>A.id===h.id&&A.storagePath===h.storagePath)){console.warn("Exact same document already exists, generating new ID for restoration");const A=Date.now(),g=Math.random().toString(36).substr(2,9);h.id=`${A}_${g}_restored`,console.log("Generated new document ID for restoration:",h.id)}const D={...h,restoredAt:new Date().toISOString(),restoredFrom:"trash"};x.push(D),console.log(" Adding restored document:",{documentId:D.id,fileName:D.fileName,tenderId:f,totalDocuments:x.length});try{await qe.setPendingData(p,x),console.log(" Successfully saved to Firestore session:",p)}catch(A){throw console.error(" Failed to save to Firestore session:",A),new Error("    ")}try{await qe.setPendingData("tenderDocuments_restored",Date.now().toString());const A=new CustomEvent("tenderDocumentRestored",{detail:{tenderId:f,restoredDocument:D,allDocuments:x}});window.dispatchEvent(A),window.dispatchEvent(new StorageEvent("storage",{key:p,newValue:JSON.stringify(x),url:window.location.href})),console.log(" Events dispatched successfully")}catch(A){console.warn(" Event dispatch failed (non-critical):",A)}console.log(" Successfully restored tender document:",{tenderId:f,storageKey:p,documentCount:x.length,restoredDocument:D.fileName||D.originalFileName})}else if(l==="manufacturedProducts"){const{ManufacturedProductService:f}=await ns(async()=>{const{ManufacturedProductService:p}=await Promise.resolve().then(()=>BR);return{ManufacturedProductService:p}},void 0);await f.createManufacturedProduct(h),console.log("Successfully restored manufactured product")}else throw new Error("    ");return await this.permanentlyDelete(e),console.log("Successfully restored item"),!0}catch(i){console.error("=== RESTORATION ERROR ==="),console.error("Error type:",i.constructor.name),console.error("Error message:",i.message),console.error("Error stack:",i.stack),console.error("Error details:",{trashId:e,itemType:t==null?void 0:t.originalCollection,itemName:(t==null?void 0:t.name)||(t==null?void 0:t.supplierName),hasValidItem:!!t,contextIds:{rawMaterialId:t==null?void 0:t.rawMaterialId,localProductId:t==null?void 0:t.localProductId,foreignProductId:t==null?void 0:t.foreignProductId}});let a="   ";throw i.message.includes("    ")?a="  :        ":i.message.includes("    ")?a="  :        ":i.message.includes("    ")?a="  :        ":i.message.includes("     ")?a="  :       ":i.message.includes("   ")?a="  :     ":a=`  : ${i.message}`,new Error(a)}}static async restorePriceQuoteToRawMaterial(e,t){try{console.log("Restoring price quote to raw material:",e.rawMaterialId),console.log("Original trash item:",e);const{RawMaterialService:s}=await ns(async()=>{const{RawMaterialService:A}=await Promise.resolve().then(()=>ax);return{RawMaterialService:A}},void 0),i=await s.getRawMaterialById(e.rawMaterialId);if(!i)throw new Error("    ");console.log("Found raw material for restore:",{id:i.id,name:i.name,currentQuotesCount:(i.priceQuotes||[]).length});const{rawMaterialId:a,rawMaterialName:o,...l}=t;l.id||(console.warn("Quote missing ID, generating new one:",l),l.id=Date.now().toString()+"_recovered");const c=Date.now(),d=Math.random().toString(36).substr(2,9);l.id=`${c}_${d}_restored`,l.supplierName=l.supplierName||"  ",l.price=l.price||"0",l.date=l.date||"",l.supplierType=l.supplierType||"local",l.id=String(l.id),console.log("Restoring quote data with normalized structure:",l);const h=i.priceQuotes||[];if(console.log("Checking for duplicates in raw material:",{existingQuotesCount:h.length,newQuoteId:l.id,newQuoteSupplier:l.supplierName,newQuotePrice:l.price,newQuoteDate:l.date,existingQuotes:h.map(A=>({id:A.id,supplier:A.supplierName,price:A.price,date:A.date}))}),h.some(A=>A.id===l.id)){console.warn("Quote with same ID already exists, generating new ID");const A=Date.now()+Math.random()*1e3,g=Math.random().toString(36).substr(2,12);l.id=`${A}_${g}_restored_v2`,console.log("Generated new unique ID:",l.id)}const p=[...h,l];console.log("Updated price quotes after restore:",p.length,"total quotes");let x=null,I=null;if(p.length>0){const A=p.reduce((g,N)=>{const j=parseFloat(g.price)||0;return(parseFloat(N.price)||0)<j?N:g});x=A.price,I=A.supplierName}const D={...i,priceQuotes:p};x&&(D.price=x,D.supplier=I,D.lowestPriceSupplier=I),await s.updateRawMaterial(e.rawMaterialId,D),console.log("Price quote successfully restored to raw material")}catch(s){throw console.error("=== RAW MATERIAL RESTORATION ERROR ==="),console.error("Error message:",s.message),console.error("Error stack:",s.stack),console.error("Error details:",{rawMaterialId:e.rawMaterialId,quoteName:t.supplierName,step:"Raw Material Restoration",originalDataKeys:Object.keys(t),trashItemKeys:Object.keys(e)}),s.message.includes("    ")?s:new Error(`      : ${s.message}`)}}static async restorePriceQuoteToLocalProduct(e,t){try{console.log("Restoring price quote to local product:",e.localProductId),console.log("Original trash item:",e);const{LocalProductService:s}=await ns(async()=>{const{LocalProductService:g}=await Promise.resolve().then(()=>ox);return{LocalProductService:g}},void 0),a=(await s.getAllLocalProducts()).find(g=>g.id===e.localProductId);if(!a)throw new Error("    ");console.log("Found local product for restore:",{id:a.id,name:a.name,currentQuotesCount:(a.priceQuotes||[]).length});const{localProductId:o,localProductName:l,...c}=t,d=Date.now(),h=Math.random().toString(36).substr(2,9);c.id=`${d}_${h}_restored`,c.supplierName=c.supplierName||"  ",c.price=c.price||"0",c.date=c.date||"",c.supplierType=c.supplierType||"local",c.id=String(c.id),console.log("Restoring quote data with normalized structure:",c);const f=a.priceQuotes||[];if(console.log("Checking for duplicates in local product:",{existingQuotesCount:f.length,newQuoteId:c.id,newQuoteSupplier:c.supplierName,newQuotePrice:c.price,newQuoteDate:c.date,existingQuotes:f.map(g=>({id:g.id,supplier:g.supplierName,price:g.price,date:g.date}))}),f.some(g=>g.id===c.id)){console.warn("Quote with same ID already exists, generating new ID");const g=Date.now()+Math.random()*1e3,N=Math.random().toString(36).substr(2,12);c.id=`${g}_${N}_restored_v2`,console.log("Generated new unique ID:",c.id)}const x=[...f,c];console.log("Updated price quotes after restore:",x.length,"total quotes");let I=null,D=null;if(x.length>0){const g=x.reduce((N,j)=>{const V=parseFloat(N.price)||0;return(parseFloat(j.price)||0)<V?j:N});I=g.price,D=g.supplierName}const A={...a,priceQuotes:x};I&&(A.price=I,A.supplier=D),await s.updateLocalProduct(e.localProductId,A),console.log("Price quote successfully restored to local product")}catch(s){throw console.error("=== LOCAL PRODUCT RESTORATION ERROR ==="),console.error("Error message:",s.message),console.error("Error stack:",s.stack),console.error("Error details:",{localProductId:e.localProductId,quoteName:t.supplierName,step:"Local Product Restoration",originalDataKeys:Object.keys(t),trashItemKeys:Object.keys(e)}),s.message.includes("    ")?s:new Error(`      : ${s.message}`)}}static async restorePriceQuoteToForeignProduct(e,t){try{console.log("Restoring price quote to foreign product:",e.foreignProductId),console.log("Original trash item:",e);const{ForeignProductService:s}=await ns(async()=>{const{ForeignProductService:g}=await Promise.resolve().then(()=>lx);return{ForeignProductService:g}},void 0),a=(await s.getAllForeignProducts()).find(g=>g.id===e.foreignProductId);if(!a)throw new Error("    ");console.log("Found foreign product for restore:",{id:a.id,name:a.name,currentQuotesCount:(a.priceQuotes||[]).length});const{foreignProductId:o,foreignProductName:l,...c}=t,d=Date.now(),h=Math.random().toString(36).substr(2,9);c.id=`${d}_${h}_restored`,c.supplierName=c.supplierName||"  ",c.price=c.price||"0",c.date=c.date||"",c.supplierType=c.supplierType||"foreign",c.id=String(c.id),console.log("Restoring quote data with normalized structure:",c);const f=a.priceQuotes||[];if(console.log("Checking for duplicates in foreign product:",{existingQuotesCount:f.length,newQuoteId:c.id,newQuoteSupplier:c.supplierName,newQuotePrice:c.price,newQuoteDate:c.date,existingQuotes:f.map(g=>({id:g.id,supplier:g.supplierName,price:g.price,date:g.date}))}),f.some(g=>g.id===c.id)){console.warn("Quote with same ID already exists, generating new ID");const g=Date.now()+Math.random()*1e3,N=Math.random().toString(36).substr(2,12);c.id=`${g}_${N}_restored_v2`,console.log("Generated new unique ID:",c.id)}const x=[...f,c];console.log("Updated price quotes after restore:",x.length,"total quotes");let I=null,D=null;if(x.length>0){const g=x.reduce((N,j)=>{const V=parseFloat(N.price)||0;return(parseFloat(j.price)||0)<V?j:N});I=g.price,D=g.supplierName}const A={...a,priceQuotes:x};I&&(A.price=I,A.supplier=D),await s.updateForeignProduct(e.foreignProductId,A),console.log("Price quote successfully restored to foreign product")}catch(s){throw console.error("=== FOREIGN PRODUCT RESTORATION ERROR ==="),console.error("Error message:",s.message),console.error("Error stack:",s.stack),console.error("Error details:",{foreignProductId:e.foreignProductId,quoteName:t.supplierName,step:"Foreign Product Restoration",originalDataKeys:Object.keys(t),trashItemKeys:Object.keys(e)}),s.message.includes("    ")?s:new Error(`      : ${s.message}`)}}static async emptyTrash(){try{console.log("Emptying trash...");const e=await this.getAllTrashItems();console.log("Found",e.length,"items to delete");for(const t of e)await this.permanentlyDelete(t.id);return console.log("Successfully emptied trash"),!0}catch(e){throw console.error("Error emptying trash:",e),new Error("    ")}}static getItemDisplayInfo(e){var a;const s={suppliers:{name:" ",icon:"bi-building",color:"primary"},foreignSuppliers:{name:" ",icon:"bi-globe",color:"info"},customers:{name:"",icon:"bi-person-check",color:"success"},rawmaterials:{name:" ",icon:"bi-box-seam",color:"warning"},localproducts:{name:" ",icon:"bi-box-seam",color:"success"},foreignproducts:{name:" ",icon:"bi-box-seam",color:"info"},manufacturedProducts:{name:" ",icon:"bi-boxes",color:"info"},manufactured_product_documents:{name:"  ",icon:"bi-file-earmark-text",color:"info"},price_quotes:{name:" ",icon:"bi-currency-dollar",color:"dark"},tenderItems:{name:" ",icon:"bi-list-task",color:"secondary"},tender_documents:{name:" ",icon:"bi-file-earmark",color:"warning"}}[e.originalCollection]||{name:"  ",icon:"bi-question-circle",color:"secondary"};let i={};if(e.originalCollection==="rawmaterials")i={displayName:e.name||" ",category:e.category||" ",minimumStock:e.minimumStock||0,supplier:e.lowestPriceSupplier||" "};else if(e.originalCollection==="localproducts")i={displayName:e.name||" ",category:e.category||" ",unit:e.unit||" ",price:e.price?`${e.price} `:" ",supplier:e.supplier||" "};else if(e.originalCollection==="foreignproducts")i={displayName:e.name||" ",category:e.category||" ",unit:e.unit||" ",price:e.price?`${e.price} `:" ",supplier:e.supplier||" "};else if(e.originalCollection==="price_quotes"){let o=" ",l="";e.rawMaterialId&&e.rawMaterialName?(o=e.rawMaterialName,l=" "):e.localProductId&&e.localProductName?(o=e.localProductName,l=" "):e.foreignProductId&&e.foreignProductName?(o=e.foreignProductName,l=" "):e.rawMaterialName?(o=e.rawMaterialName,l=" "):e.localProductName?(o=e.localProductName,l=" "):e.foreignProductName&&(o=e.foreignProductName,l=" "),console.log("Price quote context detection:",{rawMaterialId:e.rawMaterialId,rawMaterialName:e.rawMaterialName,localProductId:e.localProductId,localProductName:e.localProductName,foreignProductId:e.foreignProductId,foreignProductName:e.foreignProductName,finalContextName:o,finalContextLabel:l}),i={displayName:`  - ${e.supplierName||"  "}`,price:e.price?`${e.price} `:" ",supplierName:e.supplierName||" ",date:e.date||" ",contextName:o,contextLabel:l}}else e.originalCollection==="tenderItems"?i={displayName:e.materialName||e.name||" ",quantity:e.quantity||1,price:e.totalPrice?`${Math.round(e.totalPrice)} `:" ",contextName:((a=e.tenderContext)==null?void 0:a.tenderTitle)||"  ",contextLabel:"",itemType:e.type==="localProduct"?" ":e.type==="foreignProduct"?" ":" "}:i={displayName:e.name||" ",email:e.email||" ",phone:e.phone||" "};return{...s,...i}}static getTimeSinceDeleted(e){const t=new Date,s=new Date(e),i=t.getTime()-s.getTime(),a=Math.floor(i/(1e3*60*60*24)),o=Math.floor(i/(1e3*60*60)),l=Math.floor(i/(1e3*60));return a>0?` ${a} ${a>1,""}`:o>0?` ${o} ${o>1,""}`:l>0?` ${l} ${l>1,""}`:" "}static async clearAllTrashRecords(){try{console.log(" Clearing all trash records...");const e=pt(Qe(pe,this.COLLECTION_NAME)),t=await lt(e);console.log(`Found ${t.docs.length} records to delete`);const s=[];return t.forEach(i=>{s.push(xs(i.ref))}),await Promise.all(s),console.log(" Successfully cleared all trash records"),!0}catch(e){throw console.error(" Error clearing trash records:",e),new Error("    : "+e.message)}}static getItemDisplayInfo(e){var l;const s={suppliers:{name:" ",icon:"bi-building",color:"primary"},foreignSuppliers:{name:" ",icon:"bi-globe",color:"info"},customers:{name:"",icon:"bi-person-check",color:"success"},employees:{name:"",icon:"bi-person-badge",color:"primary"},rawmaterials:{name:" ",icon:"bi-box-seam",color:"warning"},localproducts:{name:" ",icon:"bi-box-seam",color:"success"},foreignproducts:{name:" ",icon:"bi-box-seam",color:"info"},manufacturedProducts:{name:" ",icon:"bi-boxes",color:"info"},manufactured_product_documents:{name:"  ",icon:"bi-file-earmark-text",color:"info"},price_quotes:{name:" ",icon:"bi-currency-dollar",color:"dark"},tenderItems:{name:" ",icon:"bi-list-task",color:"secondary"},tender_documents:{name:" ",icon:"bi-file-earmark",color:"warning"},employee_documents:{name:" ",icon:"bi-file-earmark-person",color:"success"},manufacturedProducts:{name:" ",icon:"bi-boxes",color:"info"}}[e.originalCollection]||{name:"  ",icon:"bi-question-circle",color:"secondary"};let i={},a=e.name||" ",o="";switch(e.originalCollection){case"suppliers":case"foreignSuppliers":i={email:e.email,phone:e.phone,address:e.address,taxNumber:e.taxNumber};break;case"customers":i={email:e.email,phone:e.phone,address:e.address,taxNumber:e.taxNumber};break;case"employees":a=e.fullName||e.name||"  ",i={email:e.email,phone:e.phone,department:e.department,jobTitle:e.jobTitle,status:e.status,autoCreated:e.autoCreated};break;case"rawmaterials":case"localproducts":case"foreignproducts":i={category:e.category,unit:e.unit,price:e.price?`${e.price} .`:" ",supplier:e.supplier||e.manufacturer};break;case"price_quotes":a=`   ${e.supplierName||" "}`,o=e.rawMaterialName||e.localProductName||e.foreignProductName||" ",i={supplierName:e.supplierName,price:e.price?`${e.price} .`:" ",contextName:o,date:e.date};break;case"tenderItems":a=e.materialName||e.name||" ",o=((l=e.tenderContext)==null?void 0:l.tenderTitle)||"  ",i={materialName:e.materialName,quantity:e.quantity,unitPrice:e.unitPrice?`${e.unitPrice} .`:" ",totalPrice:e.totalPrice?`${e.totalPrice} .`:" ",contextName:o,materialCategory:e.materialCategory,materialUnit:e.materialUnit};break;case"tender_documents":a=e.fileName||e.originalFileName||"  ",o=e.tenderTitle||"  ",i={fileName:e.fileName,originalFileName:e.originalFileName,fileSize:e.fileSize?`${(e.fileSize/1024/1024).toFixed(2)} .`:" ",fileType:e.fileType||"  ",contextName:o,uploadedAt:e.uploadedAt||e.createdAt};break;case"employee_documents":a=e.fileName||e.originalFileName||"  ",o=e.employeeName||"  ",i={fileName:e.fileName,originalFileName:e.originalFileName,fileSize:e.fileSize?`${(e.fileSize/1024/1024).toFixed(2)} .`:" ",fileType:e.fileType||"  ",contextName:o,uploadedAt:e.uploadedAt||e.createdAt};break;case"manufacturedProducts":a=e.title||e.productName||e.name||"  ",i={productCode:e.productCode,category:e.category,manufacturer:e.manufacturer,unitPrice:e.unitPrice?`${parseFloat(e.unitPrice).toLocaleString("en-US")} `:" ",stockQuantity:e.stockQuantity||" ",unit:e.unit,status:e.status==="active"?"":" ",batchNumber:e.batchNumber,referenceNumber:e.referenceNumber,estimatedValue:e.estimatedValue,description:e.description,submissionDeadline:e.submissionDeadline};break;default:i={}}return{...s,displayName:a,contextName:o,...i}}}ur(un,"COLLECTION_NAME","trash");const Ni=(n,e=30)=>{const[t,s]=b.useState(1),i=Math.ceil(n.length/e),a=b.useMemo(()=>{const h=(t-1)*e,f=h+e;return n.slice(h,f)},[n,t,e]);return{currentPage:t,totalPages:i,paginatedItems:a,handlePageChange:h=>{h>=1&&h<=i&&(s(h),window.scrollTo({top:0,behavior:"smooth"}))},resetPage:()=>{s(1)},goToFirstPage:()=>{s(1)},goToLastPage:()=>{s(i)},totalItems:n.length,itemsPerPage:e,hasNextPage:t<i,hasPreviousPage:t>1}},kR=n=>{if(!n)return"";const e=n instanceof Date?n:new Date(n);if(isNaN(e.getTime()))return"";const t=e.getDate().toString().padStart(2,"0"),s=(e.getMonth()+1).toString().padStart(2,"0"),i=e.getFullYear();return`${t}/${s}/${i}`},OR=n=>{if(!n)return"";const e=n instanceof Date?n:new Date(n);if(isNaN(e.getTime()))return"";const t=e.getDate().toString().padStart(2,"0"),s=(e.getMonth()+1).toString().padStart(2,"0"),i=e.getFullYear(),a=e.getHours().toString().padStart(2,"0"),o=e.getMinutes().toString().padStart(2,"0");return`${t}/${s}/${i} ${a}:${o}`},Dd=n=>{if(!n)return"";const e=n instanceof Date?n:new Date(n);if(isNaN(e.getTime()))return"";const t=e.getFullYear(),s=(e.getMonth()+1).toString().padStart(2,"0"),i=e.getDate().toString().padStart(2,"0");return`${t}-${s}-${i}`},$8=n=>{if(!n||typeof n!="string")return null;const e=n.split("/");if(e.length===3){const t=parseInt(e[0],10),s=parseInt(e[1],10)-1,i=parseInt(e[2],10);if(!isNaN(t)&&!isNaN(s)&&!isNaN(i))return new Date(i,s,t)}return new Date(n)},B8=()=>kR(new Date),q8=()=>OR(new Date),Pu=()=>({formatDate:n=>{if(!n)return"-";try{return kR(n)}catch(e){return console.error("Date formatting error:",e),"-"}},formatDateTime:n=>{if(!n)return"-";try{return OR(n)}catch(e){return console.error("DateTime formatting error:",e),"-"}},formatDateForInput:n=>{if(!n)return"";try{return Dd(n)}catch(e){return console.error("Date input formatting error:",e),""}},parseDate:n=>{try{return $8(n)}catch(e){return console.error("Date parsing error:",e),null}},getToday:()=>{try{return B8()}catch(n){return console.error("Today date error:",n),"-"}},getCurrentDateTime:()=>{try{return q8()}catch(n){return console.error("Current datetime error:",n),"-"}},isExpired:n=>{if(!n)return!1;try{return(n instanceof Date?n:new Date(n))<new Date}catch{return!1}},getDaysRemaining:n=>{if(!n)return 0;try{const s=(n instanceof Date?n:new Date(n))-new Date;return Math.ceil(s/(1e3*60*60*24))}catch{return 0}}}),ji=({currentPage:n,totalPages:e,onPageChange:t,totalItems:s,itemsPerPage:i=30,showItemsInfo:a=!0})=>{const o=()=>{const f=[],p=[];for(let x=Math.max(2,n-2);x<=Math.min(e-1,n+2);x++)f.push(x);return n-2>2?p.push(1,"..."):p.push(1),p.push(...f),n+2<e-1?p.push("...",e):p.push(e),p},l=h=>{h!=="..."&&h!==n&&h>=1&&h<=e&&t(h)},c=(n-1)*i+1,d=Math.min(n*i,s);return e<=1?null:r.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-4 px-3 py-3 border-top bg-light",children:[a&&r.jsx("div",{className:"text-muted",children:r.jsxs("small",{children:[" ",c.toLocaleString("en-US")," - ",d.toLocaleString("en-US"),"  ",s.toLocaleString("en-US")," "]})}),r.jsx("nav",{"aria-label":"  ",children:r.jsxs("ul",{className:"pagination pagination-sm mb-0",style:{direction:"ltr"},children:[r.jsx("li",{className:`page-item ${n===1?"disabled":""}`,children:r.jsxs("button",{className:"page-link",onClick:()=>l(n-1),disabled:n===1,style:{borderRadius:"6px 0 0 6px",border:"1px solid #dee2e6",color:n===1?"#6c757d":"#007bff"},children:[r.jsx("i",{className:"bi bi-chevron-right",style:{fontSize:"12px"}}),r.jsx("span",{className:"me-1",children:""})]})}),o().map((h,f)=>r.jsx("li",{className:`page-item ${h===n?"active":""}`,children:h==="..."?r.jsx("span",{className:"page-link",style:{border:"1px solid #dee2e6",color:"#6c757d",cursor:"default"},children:"..."}):r.jsx("button",{className:"page-link",onClick:()=>l(h),style:{border:"1px solid #dee2e6",minWidth:"40px",backgroundColor:h===n?"#007bff":"white",color:h===n?"white":"#007bff",fontWeight:h===n?"600":"400"},children:h})},f)),r.jsx("li",{className:`page-item ${n===e?"disabled":""}`,children:r.jsxs("button",{className:"page-link",onClick:()=>l(n+1),disabled:n===e,style:{borderRadius:"0 6px 6px 0",border:"1px solid #dee2e6",color:n===e?"#6c757d":"#007bff"},children:[r.jsx("span",{className:"ms-1",children:""}),r.jsx("i",{className:"bi bi-chevron-left",style:{fontSize:"12px"}})]})})]})}),!a&&r.jsx("div",{})]})},H8=({refreshTrigger:n})=>{const e=On();console.log("TendersListFixed is rendering");const[t,s]=b.useState([]),[i,a]=b.useState(!0),[o,l]=b.useState(null),[c,d]=b.useState(""),[h,f]=b.useState([]),[p,x]=b.useState(!1),{logActivity:I,getCurrentUser:D}=$t(),{alertConfig:A,closeAlert:g,showSuccess:N,showError:j,showConfirm:V}=Kt(),{formatDate:$}=Pu(),{currentPage:Z,totalPages:O,paginatedItems:M,handlePageChange:T,resetPage:L,totalItems:G,itemsPerPage:U}=Ni(h,30);console.log("TendersListFixed state:",{tendersCount:t.length,loading:i,error:o});const k=async()=>{try{a(!0),l(null),console.log("Loading tenders...");const ee=await om.getAllTenders();console.log("Tenders loaded:",ee.length),s(ee)}catch(ee){console.error("Error loading tenders:",ee),l(ee.message||"   ")}finally{a(!1)}};b.useEffect(()=>{k()},[n]),b.useEffect(()=>{if(c.trim()){const ee=t.filter(se=>{var Y,R,_,C;return((Y=se.title)==null?void 0:Y.toLowerCase().includes(c.toLowerCase()))||((R=se.referenceNumber)==null?void 0:R.toLowerCase().includes(c.toLowerCase()))||((_=se.entity)==null?void 0:_.toLowerCase().includes(c.toLowerCase()))||((C=se.description)==null?void 0:C.toLowerCase().includes(c.toLowerCase()))});f(ee)}else f(t);L()},[c,t,L]);const re=ee=>{V(`      

${ee.title}`,()=>xe(ee),"  ")},xe=async ee=>{try{x(!0),await un.moveToTrash(ee,"tenders"),await om.deleteTender(ee.id);const se=D();I("task",`${se.name}  `,`  : ${ee.title}`),k(),N(`   : ${ee.title}`,"  ")}catch(se){console.error("Error deleting tender:",se),j(`    : ${se.message}`,"  ")}finally{x(!1)}},H=ee=>{const se=new Date,Y=new Date(ee.submissionDeadline);return se>Y?r.jsx("span",{className:"badge bg-danger text-white",children:" "}):r.jsx("span",{className:"badge bg-success",children:""})};return i?(console.log("TendersListFixed: Showing loading state"),r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"spinner-border text-primary",role:"status",children:r.jsx("span",{className:"visually-hidden",children:" ..."})}),r.jsx("p",{className:"mt-3 text-muted",children:"   ..."})]})})):o?(console.log("TendersListFixed: Showing error state:",o),r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"text-danger mb-3",children:r.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),r.jsx("h5",{className:"text-danger",children:" "}),r.jsx("p",{className:"text-muted",children:o}),r.jsx("div",{className:"d-flex gap-2 justify-content-center",children:r.jsxs("button",{className:"btn btn-primary",onClick:k,children:[r.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"  "]})})]})})):(console.log("TendersListFixed: Showing main content with",h.length,"tenders"),r.jsxs("div",{className:"card shadow-sm","data-list":"tenders",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"row align-items-center justify-content-between",children:[r.jsx("div",{className:"col-lg-4",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-clipboard-check-fill text-primary me-2"}),"   (",h.length,")"]})}),r.jsx("div",{className:"col-lg-8",children:r.jsx("div",{className:"d-flex justify-content-end align-items-center gap-3",children:r.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[r.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:c,onChange:ee=>d(ee.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),r.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:r.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]})})})]})}),r.jsxs("div",{className:"card-body p-0",children:[h.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-clipboard-check fs-1"})}),r.jsx("h5",{className:"text-muted",children:"  "}),r.jsx("p",{className:"text-muted",children:c?"    ":"     "}),!c&&r.jsxs("button",{className:"btn btn-primary",onClick:()=>e("/tenders/add"),children:[r.jsx("i",{className:"bi bi-plus-lg me-1"}),"  "]})]}):r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:"  "}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",style:{width:"120px",paddingLeft:"40px"},children:""})]})}),r.jsx("tbody",{children:M.map((ee,se)=>r.jsxs("tr",{children:[r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(Z-1)*U+se+1})}),r.jsx("td",{className:"text-center",children:r.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary tender-title-btn",onClick:()=>{ee.id?e(`/tenders/edit/${ee.id}`):j("     ","  ")},style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0"},title:`  | Firebase ID: ${ee.id||"Missing"}`,children:ee.title})}),r.jsx("td",{className:"text-center",children:r.jsxs("span",{className:"badge bg-success text-white",children:[(ee.estimatedValue||0).toLocaleString("en-US")," ."]})}),r.jsx("td",{className:"text-center",children:ee.entity}),r.jsx("td",{className:"text-center",children:$(ee.submissionDeadline)}),r.jsx("td",{className:"text-center",children:H(ee)}),r.jsx("td",{className:"text-center",style:{paddingLeft:"40px"},children:r.jsxs("div",{className:"btn-group btn-group-sm",children:[r.jsx("button",{className:"btn btn-outline-primary",onClick:()=>{if(!ee||!ee.id){j("     ","  ");return}e(`/tenders/edit/${ee.id}`)},title:"",children:r.jsx("i",{className:"bi bi-pencil"})}),r.jsx("button",{className:"btn btn-outline-danger",onClick:()=>re(ee),title:"",children:r.jsx("i",{className:"bi bi-trash"})})]})})]},ee.internalId||ee.id||`tender-${se}`))})]})}),h.length>0&&r.jsx(ji,{currentPage:Z,totalPages:O,onPageChange:T,totalItems:G,itemsPerPage:U})]}),r.jsx(Wt,{show:A.show,onClose:g,title:A.title,message:A.message,type:A.type,onConfirm:A.onConfirm,showConfirm:A.showConfirm})]}))},G8=({refreshTrigger:n})=>(console.log("TendersList wrapper is rendering - delegating to TendersListFixed"),r.jsx(H8,{refreshTrigger:n}));function Q8(){const[n,e]=b.useState(!1),[t,s]=b.useState(0),{isTimelineVisible:i}=gn(),a=On(),o=()=>{e(!n)},l=async()=>{try{await qe.clearPendingData("tenderFormData_new"),await qe.clearPendingData("tenderDocuments_new"),await qe.clearPendingTenderItems(),console.log(" All pending data cleared - navigating to fresh Add Tender form"),a("/tenders/add")}catch(c){console.error(" Error clearing pending data:",c),a("/tenders/add")}};return r.jsx(At,{children:r.jsx(Dt,{children:r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[r.jsx(Nn,{onToggle:o}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!i?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),r.jsx(jn,{}),r.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:r.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[r.jsx("div",{className:"d-flex align-items-center",children:r.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[r.jsx("i",{className:"bi bi-file-earmark-text text-primary me-2"})," "]})}),r.jsx("button",{onClick:l,className:"btn btn-primary",style:{height:"32px",width:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center"},children:" "})]})}),r.jsx("div",{className:"card-body p-0",children:r.jsx(G8,{refreshTrigger:t})})]})})})]}),!n&&i&&r.jsx(_n,{rtl:!0}),!n&&i&&r.jsx(En,{})]})]})})})}function W8(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(Q8,{})})})}class _i{static async isFieldUnique(e,t,s=null,i=null){var o;if(!t||t.trim()==="")return!0;const a=t.trim().toLowerCase();console.log(` Checking uniqueness for ${e}: "${a}"`);for(const[l,c]of Object.entries(this.COLLECTIONS))try{console.log(` Checking collection: ${l} (exclude: ${i})`);const d=await lt(Qe(pe,c));console.log(` Found ${d.docs.length} documents in ${l}`);for(const h of d.docs){const f=h.data();if(s&&h.id===s&&i===l){console.log(` Skipping same document: ${h.id} in ${l}`);continue}const p=(o=f[e])==null?void 0:o.toString().trim().toLowerCase();if(p&&p!==""&&(console.log(` Comparing "${a}" with "${p}" from ${l}`),p===a)){const x=` ${this.getFieldDisplayName(e)}    ${this.getCollectionDisplayName(l)}`;throw console.log(` Duplicate found: ${x}`),new Error(x)}}}catch(d){if(d.message.includes(" "))throw d;console.error(`Error checking uniqueness in ${l}:`,d)}return console.log(` ${e} is unique: "${a}"`),!0}static async validateUniqueFields(e,t=null,s=null){const i={},a=["phone","email","taxNumber"];for(const o of a)if(e[o]&&e[o].trim()!=="")try{await this.isFieldUnique(o,e[o],t,s)}catch(l){i[o]=l.message}return i}static getFieldDisplayName(e){return{name:"",phone:" ",email:" ",taxNumber:" "}[e]||e}static getCollectionDisplayName(e){return{customers:"",suppliers:" ",foreignSuppliers:" ",rawmaterials:" "}[e]||e}static async isNameUnique(e,t=null,s=null){return!0}static async isPhoneUnique(e,t=null,s=null){return await this.isFieldUnique("phone",e,t,s)}static async isEmailUnique(e,t=null,s=null){return await this.isFieldUnique("email",e,t,s)}static async isTaxNumberUnique(e,t=null,s=null){return await this.isFieldUnique("taxNumber",e,t,s)}static async validateFieldRealTime(e,t,s=null,i=null){if(!t||t.trim()==="")return null;try{return await this.isFieldUnique(e,t,s,i),null}catch(a){return a.message}}}ur(_i,"COLLECTIONS",{customers:"customers",suppliers:"suppliers",foreignSuppliers:"foreignSuppliers",rawmaterials:"rawmaterials"});const MR=({show:n,onClose:e,onItemSelect:t,selectedItemType:s,setSelectedItemType:i})=>{if(!n)return null;const a=o=>{try{const l=o.target.value;console.log("Selected item type:",l),i(l),setTimeout(()=>{try{e(),t&&t(l)}catch(c){console.error("Navigation error:",c)}},300)}catch(l){console.error("Error handling item type change:",l)}};return r.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:r.jsx("div",{className:"modal-dialog modal-dialog-centered",style:{maxWidth:"500px"},children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[r.jsxs("div",{className:"modal-header border-bottom-0 pb-0",children:[r.jsx("h5",{className:"modal-title fw-bold text-primary",children:"  "}),r.jsx("button",{type:"button",className:"btn-close",onClick:e,"aria-label":"Close"})]}),r.jsx("div",{className:"modal-body py-4",children:r.jsxs("div",{className:"row g-3",children:[r.jsx("div",{className:"col-6",children:r.jsxs("div",{className:"form-check p-0",children:[r.jsx("input",{className:"form-check-input d-none",type:"radio",name:"itemType",id:"raw-materials",value:"raw-materials",checked:s==="raw-materials",onChange:a}),r.jsxs("label",{className:`form-check-label w-100 p-3 border rounded-3 text-center cursor-pointer transition-all ${s==="raw-materials"?"border-primary text-primary":"border-light hover-border-primary"}`,htmlFor:"raw-materials",style:{cursor:"pointer",backgroundColor:s==="raw-materials"?"#f8f9fa":"#f5f5f5"},children:[r.jsx("i",{className:"bi bi-gear fs-1 d-block mb-2",style:{color:"#dc3545"}}),r.jsx("span",{className:"fw-medium",children:" "})]})]})}),r.jsx("div",{className:"col-6",children:r.jsxs("div",{className:"form-check p-0",children:[r.jsx("input",{className:"form-check-input d-none",type:"radio",name:"itemType",id:"local-product",value:"local-product",checked:s==="local-product",onChange:a}),r.jsxs("label",{className:`form-check-label w-100 p-3 border rounded-3 text-center cursor-pointer transition-all ${s==="local-product"?"border-primary text-primary":"border-light hover-border-primary"}`,htmlFor:"local-product",style:{cursor:"pointer",backgroundColor:s==="local-product"?"#f8f9fa":"#f5f5f5"},children:[r.jsx("i",{className:"bi bi-house fs-1 d-block mb-2",style:{color:"#198754"}}),r.jsx("span",{className:"fw-medium",children:" "})]})]})}),r.jsx("div",{className:"col-6",children:r.jsxs("div",{className:"form-check p-0",children:[r.jsx("input",{className:"form-check-input d-none",type:"radio",name:"itemType",id:"imported-product",value:"imported-product",checked:s==="imported-product",onChange:a}),r.jsxs("label",{className:`form-check-label w-100 p-3 border rounded-3 text-center cursor-pointer transition-all ${s==="imported-product"?"border-primary text-primary":"border-light hover-border-primary"}`,htmlFor:"imported-product",style:{cursor:"pointer",backgroundColor:s==="imported-product"?"#f8f9fa":"#f5f5f5"},children:[r.jsx("i",{className:"bi bi-globe fs-1 d-block mb-2",style:{color:"#0dcaf0"}}),r.jsx("span",{className:"fw-medium",children:" "})]})]})}),r.jsx("div",{className:"col-6",children:r.jsxs("div",{className:"form-check p-0",children:[r.jsx("input",{className:"form-check-input d-none",type:"radio",name:"itemType",id:"manufactured-product",value:"manufactured-product",checked:s==="manufactured-product",onChange:a}),r.jsxs("label",{className:`form-check-label w-100 p-3 border rounded-3 text-center cursor-pointer transition-all ${s==="manufactured-product"?"border-primary text-primary":"border-light hover-border-primary"}`,htmlFor:"manufactured-product",style:{cursor:"pointer",backgroundColor:s==="manufactured-product"?"#f8f9fa":"#f5f5f5"},children:[r.jsx("i",{className:"bi bi-tools fs-1 d-block mb-2",style:{color:"#fd7e14"}}),r.jsx("span",{className:"fw-medium",children:" "})]})]})})]})})]})})})},Al="rawmaterials",Cb=()=>{window.dispatchEvent(new CustomEvent("rawMaterialsUpdated"))};class Os{static async getAllRawMaterials(){try{const e=Qe(pe,Al),t=pt(e,$n("createdAt","desc"));return(await lt(t)).docs.map(i=>{var o,l;const a=i.data();return{id:i.id,internalId:a.internalId||ct("RAW_MATERIAL"),...a,createdAt:(o=a.createdAt)==null?void 0:o.toDate(),updatedAt:(l=a.updatedAt)==null?void 0:l.toDate()}})}catch(e){throw console.error("Error fetching raw materials:",e),new Error("     ")}}static async getRawMaterialById(e){var t,s;try{const i=Ye(pe,Al,e),a=await Un(i);if(a.exists()){const o=a.data();return{id:a.id,internalId:o.internalId||ct("RAW_MATERIAL"),...o,createdAt:(t=o.createdAt)==null?void 0:t.toDate(),updatedAt:(s=o.updatedAt)==null?void 0:s.toDate()}}else return null}catch(i){throw console.error("Error fetching raw material by ID:",i),new Error("     ")}}static async getRawMaterialByInternalId(e){var t,s;try{const i=Qe(pe,Al),a=pt(i,qt("internalId","==",e)),o=await lt(a);if(o.empty)return null;{const l=o.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:(t=c.createdAt)==null?void 0:t.toDate(),updatedAt:(s=c.updatedAt)==null?void 0:s.toDate()}}}catch(i){throw console.error("Error fetching raw material by internal ID:",i),new Error("     ")}}static async updateRawMaterialByInternalId(e,t){try{const s=await this.getRawMaterialByInternalId(e);if(!s)throw new Error("Raw material not found");return await this.updateRawMaterial(s.id,t)}catch(s){throw console.error("Error updating raw material by internal ID:",s),new Error("     ")}}static async deleteRawMaterialByInternalId(e){try{const t=await this.getRawMaterialByInternalId(e);if(!t)throw new Error("Raw material not found");return await this.deleteRawMaterial(t.id)}catch(t){throw console.error("Error deleting raw material by internal ID:",t),new Error("    ")}}static async createRawMaterial(e){try{const t=ct("RAW_MATERIAL"),s={...e,internalId:t,createdAt:it(),updatedAt:it()},i=await Ys(Qe(pe,Al),s);return Cb(),i.id}catch(t){throw console.error("Error creating raw material:",t),new Error("    ")}}static async updateRawMaterial(e,t){try{const s=Ye(pe,Al,e),i={...t,updatedAt:it()};return await gs(s,i),Cb(),!0}catch(s){throw console.error("Error updating raw material:",s),new Error("     ")}}static async deleteRawMaterial(e){try{const t=Ye(pe,Al,e);return await xs(t),Cb(),!0}catch(t){throw console.error("Error deleting raw material:",t),new Error("    ")}}static async searchRawMaterials(e){try{const t=Qe(pe,Al);return(await lt(t)).docs.map(o=>{var c,d;const l=o.data();return{id:o.id,internalId:l.internalId||ct("RAW_MATERIAL"),...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}}).filter(o=>{var l,c,d,h;return((l=o.name)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))||((c=o.category)==null?void 0:c.toLowerCase().includes(e.toLowerCase()))||((d=o.description)==null?void 0:d.toLowerCase().includes(e.toLowerCase()))||((h=o.supplier)==null?void 0:h.toLowerCase().includes(e.toLowerCase()))})}catch(t){throw console.error("Error searching raw materials:",t),new Error("     ")}}static async migrateExistingData(){try{console.log("Starting raw materials migration...");const e=await this.getAllRawMaterials();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("rm_")){const i=ct("RAW_MATERIAL");await this.updateRawMaterial(s.id,{...s,internalId:i}),t++,console.log(`Migrated raw material: ${s.name} -> ${i}`)}return console.log(`Migration completed. ${t} raw materials migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("   ")}}static async getRawMaterialsByInternalIds(e){try{const t=e.map(i=>this.getRawMaterialByInternalId(i));return(await Promise.all(t)).filter(i=>i!==null)}catch(t){throw console.error("Error fetching raw materials by internal IDs:",t),new Error("     ")}}static validateRawMaterialData(e){var s,i,a;const t={};return(s=e.name)!=null&&s.trim()||(t.name="   "),(i=e.category)!=null&&i.trim()||(t.category="   "),(a=e.unit)!=null&&a.trim()||(t.unit=" "),(!e.price||parseFloat(e.price)<=0)&&(t.price="      "),t}}const ax=Object.freeze(Object.defineProperty({__proto__:null,RawMaterialService:Os},Symbol.toStringTag,{value:"Module"})),Dl="localproducts",Ab=()=>{window.dispatchEvent(new CustomEvent("localProductsUpdated"))};class Ms{static async getAllLocalProducts(){try{const e=Qe(pe,Dl);let t;try{t=pt(e,$n("createdAt","desc"))}catch{console.log("Using query without orderBy for empty collection"),t=pt(e)}const i=(await lt(t)).docs.map(a=>{var l,c;const o=a.data();return{id:a.id,internalId:o.internalId||ct("LOCAL_PRODUCT"),...o,createdAt:(l=o.createdAt)==null?void 0:l.toDate(),updatedAt:(c=o.updatedAt)==null?void 0:c.toDate()}});return i.length>0&&i[0].createdAt&&i.sort((a,o)=>(o.createdAt||new Date(0))-(a.createdAt||new Date(0))),i}catch(e){if(console.error("Error fetching local products:",e),console.error("Error details:",e.code,e.message),e.code==="failed-precondition"||e.message.includes("index"))return console.log("Collection appears to be empty or missing index, returning empty array"),[];throw new Error("     : "+e.message)}}static async getLocalProductById(e){var t,s;try{const i=Ye(pe,Dl,e),a=await Un(i);if(a.exists()){const o=a.data();return{id:a.id,internalId:o.internalId||ct("LOCAL_PRODUCT"),...o,createdAt:(t=o.createdAt)==null?void 0:t.toDate(),updatedAt:(s=o.updatedAt)==null?void 0:s.toDate()}}else return null}catch(i){throw console.error("Error fetching local product by ID:",i),new Error("     ")}}static async createLocalProduct(e){try{const t=ct("LOCAL_PRODUCT"),s={...e,internalId:t,createdAt:it(),updatedAt:it()},i=await Ys(Qe(pe,Dl),s);return Ab(),i.id}catch(t){throw console.error("Error creating local product:",t),new Error("    ")}}static async updateLocalProduct(e,t){try{const s=Ye(pe,Dl,e),i={...t,updatedAt:it()};return await gs(s,i),Ab(),!0}catch(s){throw console.error("Error updating local product:",s),new Error("     ")}}static async getLocalProductByInternalId(e){var t,s;try{const i=Qe(pe,Dl),a=pt(i,qt("internalId","==",e)),o=await lt(a);if(o.empty)return null;{const l=o.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:(t=c.createdAt)==null?void 0:t.toDate(),updatedAt:(s=c.updatedAt)==null?void 0:s.toDate()}}}catch(i){throw console.error("Error fetching local product by internal ID:",i),new Error("     ")}}static async updateLocalProductByInternalId(e,t){try{const s=await this.getLocalProductByInternalId(e);if(!s)throw new Error("Local product not found");return await this.updateLocalProduct(s.id,t)}catch(s){throw console.error("Error updating local product by internal ID:",s),new Error("     ")}}static async deleteLocalProduct(e){try{const t=Ye(pe,Dl,e);return await xs(t),Ab(),!0}catch(t){throw console.error("Error deleting local product:",t),new Error("    ")}}static async deleteLocalProductByInternalId(e){try{const t=await this.getLocalProductByInternalId(e);if(!t)throw new Error("Local product not found");return await this.deleteLocalProduct(t.id)}catch(t){throw console.error("Error deleting local product by internal ID:",t),new Error("    ")}}static async searchLocalProducts(e){try{const t=Qe(pe,Dl);return(await lt(t)).docs.map(o=>{var c,d;const l=o.data();return{id:o.id,internalId:l.internalId||ct("LOCAL_PRODUCT"),...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}}).filter(o=>{var l,c,d,h;return((l=o.name)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))||((c=o.category)==null?void 0:c.toLowerCase().includes(e.toLowerCase()))||((d=o.description)==null?void 0:d.toLowerCase().includes(e.toLowerCase()))||((h=o.supplier)==null?void 0:h.toLowerCase().includes(e.toLowerCase()))})}catch(t){if(console.error("Error searching local products:",t),console.error("Error details:",t.code,t.message),t.code==="failed-precondition"||t.message.includes("index")||t.code==="not-found")return console.log("Collection appears to be empty or missing, returning empty array"),[];throw new Error("     : "+t.message)}}static async migrateExistingData(){try{console.log("Starting local products migration...");const e=await this.getAllLocalProducts();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("lp_")){const i=ct("LOCAL_PRODUCT");await this.updateLocalProduct(s.id,{...s,internalId:i}),t++,console.log(`Migrated local product: ${s.name} -> ${i}`)}return console.log(`Migration completed. ${t} local products migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("   ")}}static validateLocalProductData(e){var s,i,a;const t={};return(s=e.name)!=null&&s.trim()||(t.name="   "),(i=e.category)!=null&&i.trim()||(t.category="   "),(a=e.unit)!=null&&a.trim()||(t.unit=" "),(!e.price||parseFloat(e.price)<=0)&&(t.price="      "),t}}const ox=Object.freeze(Object.defineProperty({__proto__:null,LocalProductService:Ms},Symbol.toStringTag,{value:"Module"}));async function LR(n,e){const t=await Ys(Qe(pe,n),{...e,_createdAt:new Date});return await uu(t,{...e,id:t.id,_createdAt:new Date},{merge:!0}),t.id}async function FR(n,e){const t=await Un(Ye(pe,n,e));return t.exists()?{id:t.id,...t.data()}:null}const Rl="foreignproducts",Db=()=>{window.dispatchEvent(new CustomEvent("foreignProductsUpdated"))};class Ls{static async getAllForeignProducts(){try{const e=Qe(pe,Rl);let t;try{const i=pt(e,$n("createdAt","desc"));t=await lt(i,"getAllForeignProducts")}catch(i){console.log("OrderBy failed, using simple query:",i.message),t=await lt(e,"getAllForeignProducts-simple")}const s=t.docs.map(i=>{var o,l;const a=i.data();return{id:i.id,internalId:a.internalId||ct("FOREIGN_PRODUCT"),...a,createdAt:(o=a.createdAt)==null?void 0:o.toDate(),updatedAt:(l=a.updatedAt)==null?void 0:l.toDate()}});return s.length>0&&s[0].createdAt&&s.sort((i,a)=>(a.createdAt||new Date(0))-(i.createdAt||new Date(0))),s}catch(e){if(console.error("Error fetching foreign products:",e),console.error("Error details:",e.code,e.message),e.code==="failed-precondition"||e.message.includes("index"))return console.log("Collection appears to be empty or missing index, returning empty array"),[];throw new Error("     : "+e.message)}}static async getForeignProductById(e){var t,s;try{const i=await FR(Rl,e);return i?{...i,internalId:i.internalId||ct("FOREIGN_PRODUCT"),createdAt:(t=i.createdAt)==null?void 0:t.toDate(),updatedAt:(s=i.updatedAt)==null?void 0:s.toDate()}:null}catch(i){throw console.error("Error fetching foreign product by ID:",i),new Error("     ")}}static async addForeignProduct(e){try{const t=ct("FOREIGN_PRODUCT");let s=null;if(e.priceQuotes&&e.priceQuotes.length>0){const o=e.priceQuotes.map(l=>parseFloat(l.price)).filter(l=>!isNaN(l));o.length>0&&(s=Math.min(...o))}const i={...e,internalId:t,price:s!==null?s.toString():e.price||"",createdAt:it(),updatedAt:it()},a=await LR(Rl,i);return Db(),a}catch(t){throw console.error("Error adding foreign product:",t),new Error("    ")}}static async createForeignProduct(e){return this.addForeignProduct(e)}static async updateForeignProduct(e,t){try{let s=null;if(t.priceQuotes&&t.priceQuotes.length>0){const o=t.priceQuotes.map(l=>parseFloat(l.price)).filter(l=>!isNaN(l));o.length>0&&(s=Math.min(...o))}const i=Ye(pe,Rl,e),a={...t,price:s!==null?s.toString():t.price||"",updatedAt:it()};return await gs(i,a,"updateForeignProduct"),Db(),!0}catch(s){throw console.error("Error updating foreign product:",s),new Error("     ")}}static async getForeignProductByInternalId(e){var t,s;try{const i=Qe(pe,Rl),a=pt(i,qt("internalId","==",e)),o=await lt(a,"getForeignProductByInternalId");if(o.empty)return null;{const l=o.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:(t=c.createdAt)==null?void 0:t.toDate(),updatedAt:(s=c.updatedAt)==null?void 0:s.toDate()}}}catch(i){throw console.error("Error fetching foreign product by internal ID:",i),new Error("     ")}}static async updateForeignProductByInternalId(e,t){try{const s=await this.getForeignProductByInternalId(e);if(!s)throw new Error("Foreign product not found");return await this.updateForeignProduct(s.id,t)}catch(s){throw console.error("Error updating foreign product by internal ID:",s),new Error("     ")}}static async deleteForeignProduct(e){try{const t=Ye(pe,Rl,e);return await xs(t,"deleteForeignProduct"),Db(),!0}catch(t){throw console.error("Error deleting foreign product:",t),new Error("    ")}}static async deleteForeignProductByInternalId(e){try{const t=await this.getForeignProductByInternalId(e);if(!t)throw new Error("Foreign product not found");return await this.deleteForeignProduct(t.id)}catch(t){throw console.error("Error deleting foreign product by internal ID:",t),new Error("    ")}}static async searchForeignProducts(e){try{const t=Qe(pe,Rl);return(await lt(t,"searchForeignProducts")).docs.map(o=>{var c,d;const l=o.data();return{id:o.id,internalId:l.internalId||ct("FOREIGN_PRODUCT"),...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}}).filter(o=>{var l,c,d,h;return((l=o.name)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))||((c=o.category)==null?void 0:c.toLowerCase().includes(e.toLowerCase()))||((d=o.description)==null?void 0:d.toLowerCase().includes(e.toLowerCase()))||((h=o.supplier)==null?void 0:h.toLowerCase().includes(e.toLowerCase()))})}catch(t){if(console.error("Error searching foreign products:",t),console.error("Error details:",t.code,t.message),t.code==="failed-precondition"||t.message.includes("index")||t.code==="not-found")return console.log("Collection appears to be empty or missing, returning empty array"),[];throw new Error("     : "+t.message)}}static async migrateExistingData(){try{console.log("Starting foreign products migration...");const e=await this.getAllForeignProducts();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("fp_")){const i=ct("FOREIGN_PRODUCT");await this.updateForeignProduct(s.id,{...s,internalId:i}),t++,console.log(`Migrated foreign product: ${s.name} -> ${i}`)}return console.log(`Migration completed. ${t} foreign products migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("   ")}}static validateForeignProductData(e){var s,i,a;const t={};return(s=e.name)!=null&&s.trim()||(t.name="   "),(i=e.category)!=null&&i.trim()||(t.category="   "),(a=e.unit)!=null&&a.trim()||(t.unit=" "),(!e.price||parseFloat(e.price)<=0)&&(t.price="      "),t}}const lx=Object.freeze(Object.defineProperty({__proto__:null,ForeignProductService:Ls},Symbol.toStringTag,{value:"Module"})),mi="tenderItems",Pl=()=>{window.dispatchEvent(new CustomEvent("tenderItemsUpdated",{detail:{timestamp:Date.now()}}))};class XN{static async getTenderItems(e){try{console.log(" Fetching tender items for tender:",e);const t=Qe(pe,mi),s=pt(t,qt("tenderId","==",e),$n("createdAt","desc")),a=(await lt(s)).docs.map(o=>{var c,d;const l=o.data();return{id:o.id,internalId:l.internalId||ct("TENDER_ITEM"),...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}});return console.log(" Fetched tender items:",a.length),a}catch(t){if(console.error(" Error fetching tender items:",t),t.code==="failed-precondition"){console.log(" OrderBy failed, trying simple query...");try{const s=Qe(pe,mi),i=pt(s,qt("tenderId","==",e)),o=(await lt(i)).docs.map(l=>{var d,h;const c=l.data();return{id:l.id,internalId:c.internalId||ct("TENDER_ITEM"),...c,createdAt:(d=c.createdAt)==null?void 0:d.toDate(),updatedAt:(h=c.updatedAt)==null?void 0:h.toDate()}});return o.sort((l,c)=>(c.createdAt||new Date(0))-(l.createdAt||new Date(0))),o}catch(s){return console.error(" Fallback query failed:",s),[]}}throw new Error("    ")}}static async addMaterialToTender(e,t,s,i=1){try{console.log(" Adding material to tender:",{tenderId:e,materialInternalId:t,materialType:s,quantity:i});const o=(await this.getTenderItems(e)).find(x=>x.materialInternalId===t&&x.materialType===s);if(o){console.log(" Duplicate material found, updating quantity instead");const x=(o.quantity||1)+i;return await this.updateTenderItemQuantity(o.id,x)}let l=null;switch(s){case"rawMaterial":l=await Os.getRawMaterialByInternalId(t);break;case"localProduct":l=await Ms.getLocalProductByInternalId(t);break;case"foreignProduct":l=await Ls.getForeignProductByInternalId(t);break;default:throw new Error(`   : ${s}`)}if(!l)throw new Error(`    : ${t}`);const c=parseFloat(i)||1,d=parseFloat(l.price)||0,h=c*d,f={internalId:ct("TENDER_ITEM"),tenderId:e,materialInternalId:t,materialType:s,materialName:l.name,materialCategory:l.category,materialUnit:l.unit,quantity:c,unitPrice:d,totalPrice:h,supplierInfo:{name:l.supplier||"",id:l.supplierId||""},createdAt:it(),updatedAt:it()},p=await Ys(Qe(pe,mi),f);return console.log(" Added tender item with ID:",p.id),Pl(),{id:p.id,...f,createdAt:new Date,updatedAt:new Date}}catch(a){throw console.error(" Error adding material to tender:",a),new Error(`    : ${a.message}`)}}static async updateTenderItemQuantity(e,t){try{console.log(" Updating tender item quantity:",{itemId:e,newQuantity:t});const s=await this.getTenderItemById(e);if(!s)throw new Error("  ");const i=parseFloat(t)||1,a=i*(s.unitPrice||0),o=Ye(pe,mi,e);return await gs(o,{quantity:i,totalPrice:a,updatedAt:it()}),console.log(" Updated tender item quantity"),Pl(),{...s,quantity:i,totalPrice:a,updatedAt:new Date}}catch(s){throw console.error(" Error updating tender item quantity:",s),new Error("    ")}}static async getTenderItemById(e){var t,s;try{const i=Ye(pe,mi,e),a=await Un(i);if(a.exists()){const o=a.data();return{id:a.id,internalId:o.internalId||ct("TENDER_ITEM"),...o,createdAt:(t=o.createdAt)==null?void 0:t.toDate(),updatedAt:(s=o.updatedAt)==null?void 0:s.toDate()}}else return null}catch(i){throw console.error(" Error fetching tender item by ID:",i),new Error("    ")}}static async updateTenderItem(e,t){try{const s=Ye(pe,mi,e);return await gs(s,{...t,updatedAt:it()}),Pl(),!0}catch(s){throw console.error(" Error updating tender item:",s),new Error("   ")}}static async deleteTenderItem(e){try{const t=Ye(pe,mi,e);return await xs(t),Pl(),!0}catch(t){throw console.error(" Error deleting tender item:",t),new Error("   ")}}static async deleteAllTenderItems(e){try{console.log(" Deleting all items for tender:",e);const t=await this.getTenderItems(e);if(t.length===0)return!0;const s=ka(pe);return t.forEach(i=>{const a=Ye(pe,mi,i.id);s.delete(a)}),await s.commit(),console.log(" Deleted all tender items:",t.length),Pl(),!0}catch(t){throw console.error(" Error deleting all tender items:",t),new Error("     ")}}static async refreshTenderItemsPricing(e){try{console.log(" Refreshing prices for tender:",e);let t;if(Array.isArray(e)?(console.log(" Input is array of items, using directly"),t=e):(console.log(" Input is tender ID, fetching items from database"),t=await this.getTenderItems(e)),!t||t.length===0)return console.log(" No items to refresh pricing for"),[];const s=[],i=ka(pe);let a=0;const o=Array.isArray(e);for(const l of t)try{let c=null;switch(l.materialType){case"rawMaterial":c=await Os.getRawMaterialByInternalId(l.materialInternalId);break;case"localProduct":c=await Ms.getLocalProductByInternalId(l.materialInternalId);break;case"foreignProduct":c=await Ls.getForeignProductByInternalId(l.materialInternalId);break}if(c){const d=parseFloat(c.price)||0,h=(l.quantity||1)*d;if(!o&&l.id&&d!==l.unitPrice){console.log(" Updating database item price:",l.materialName);const p=Ye(pe,mi,l.id);i.update(p,{unitPrice:d,totalPrice:h,supplierInfo:{name:c.supplier||"",id:c.supplierId||""},updatedAt:it()}),a++}s.push({...l,unitPrice:d,totalPrice:h,supplierInfo:c.supplier||l.supplierInfo||"",materialUnit:c.unit||l.materialUnit||""})}else console.warn(" Material not found for item:",l.materialInternalId),s.push(l)}catch(c){console.error(" Error refreshing item:",l.materialName,c),s.push(l)}return a>0&&(await i.commit(),console.log(" Batch updated",a,"items")),Pl(),s}catch(t){throw console.error(" Error refreshing tender items pricing:",t),new Error("    ")}}static async addMultipleMaterialsToTender(e,t){try{console.log(" Bulk adding materials to tender:",{tenderId:e,count:t.length});const s=ka(pe),i=[],a=await this.getTenderItems(e),o=new Set(a.map(l=>`${l.materialInternalId}_${l.materialType}`));for(const l of t){const c=`${l.materialInternalId}_${l.materialType}`;if(o.has(c)){console.log(" Skipping duplicate material:",l.materialInternalId);continue}let d=null;switch(l.materialType){case"rawMaterial":d=await Os.getRawMaterialByInternalId(l.materialInternalId);break;case"localProduct":d=await Ms.getLocalProductByInternalId(l.materialInternalId);break;case"foreignProduct":d=await Ls.getForeignProductByInternalId(l.materialInternalId);break}if(d){const h=parseFloat(l.quantity)||1,f=parseFloat(d.price)||0,p=h*f,x={internalId:ct("TENDER_ITEM"),tenderId:e,materialInternalId:l.materialInternalId,materialType:l.materialType,materialName:d.name,materialCategory:d.category,materialUnit:d.unit,quantity:h,unitPrice:f,totalPrice:p,supplierInfo:{name:d.supplier||"",id:d.supplierId||""},createdAt:it(),updatedAt:it()},I=Ye(Qe(pe,mi));s.set(I,x),i.push({id:I.id,...x,createdAt:new Date,updatedAt:new Date})}}return i.length>0&&(await s.commit(),console.log(" Bulk added items:",i.length)),Pl(),i}catch(s){throw console.error(" Error bulk adding materials:",s),new Error("    ")}}static async materialExistsInTender(e,t,s){try{return(await this.getTenderItems(e)).some(a=>a.materialInternalId===t&&a.materialType===s)}catch(i){return console.error(" Error checking material existence:",i),!1}}static async getTenderTotals(e){try{const t=await this.getTenderItems(e),s=t.reduce((o,l)=>o+(l.totalPrice||0),0),i=t.reduce((o,l)=>o+(l.quantity||0),0),a=t.length;return{totalPrice:s,totalQuantity:i,itemsCount:a,items:t}}catch(t){throw console.error(" Error calculating tender totals:",t),new Error("    ")}}static async getTenderItemsByType(e,t){try{const s=Qe(pe,mi),i=pt(s,qt("tenderId","==",e),qt("materialType","==",t),$n("createdAt","desc"));return(await lt(i)).docs.map(o=>{var c,d;const l=o.data();return{id:o.id,internalId:l.internalId||ct("TENDER_ITEM"),...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}})}catch(s){return console.error(" Error fetching items by type:",s),(await this.getTenderItems(e)).filter(a=>a.materialType===t)}}static async migrateLocalStorageItems(e,t){try{if(console.log(" Migrating localStorage items to Firebase:",t.length),!Array.isArray(t)||t.length===0)return[];const s=[];for(const i of t)try{if(!await this.materialExistsInTender(e,i.materialInternalId,i.materialType||"rawMaterial")){const o=await this.addMaterialToTender(e,i.materialInternalId,i.materialType||"rawMaterial",i.quantity||1);s.push(o)}}catch(a){console.error(" Failed to migrate item:",i.materialName,a)}return console.log(" Migration completed:",s.length,"items migrated"),s}catch(s){throw console.error(" Error migrating localStorage items:",s),new Error("   ")}}static async searchTenderItems(e,t){try{const s=await this.getTenderItems(e);if(!t.trim())return s;const i=t.toLowerCase();return s.filter(a=>{var o;return(a.materialName||"").toLowerCase().includes(i)||(a.materialCategory||"").toLowerCase().includes(i)||(((o=a.supplierInfo)==null?void 0:o.name)||"").toLowerCase().includes(i)||(a.materialType||"").toLowerCase().includes(i)})}catch(s){throw console.error(" Error searching tender items:",s),new Error("    ")}}static async getMaterialsSummary(e){try{const t=await this.getTenderItems(e),s={rawMaterial:{count:0,totalPrice:0},localProduct:{count:0,totalPrice:0},foreignProduct:{count:0,totalPrice:0}};return t.forEach(i=>{const a=i.materialType||"rawMaterial";s[a]&&(s[a].count++,s[a].totalPrice+=i.totalPrice||0)}),s}catch(t){throw console.error(" Error getting materials summary:",t),new Error("    ")}}static validateTenderItemData(e){var s,i,a;const t={};return(s=e.tenderId)!=null&&s.trim()||(t.tenderId="  "),(i=e.materialInternalId)!=null&&i.trim()||(t.materialInternalId="  "),(a=e.materialType)!=null&&a.trim()||(t.materialType="  "),(!e.quantity||parseFloat(e.quantity)<=0)&&(t.quantity="      "),t}static async getTenderStatistics(e){try{const t=await this.getTenderItems(e),s=await this.getMaterialsSummary(e);return{totalItems:t.length,totalValue:t.reduce((a,o)=>a+(o.totalPrice||0),0),totalQuantity:t.reduce((a,o)=>a+(o.quantity||0),0),materialTypes:s,averageItemValue:t.length>0?t.reduce((a,o)=>a+(o.totalPrice||0),0)/t.length:0,highestValueItem:t.reduce((a,o)=>(o.totalPrice||0)>(a.totalPrice||0)?o:a,{}),lowestValueItem:t.reduce((a,o)=>(o.totalPrice||0)<(a.totalPrice||Number.MAX_VALUE)?o:a,{})}}catch(t){throw console.error(" Error getting tender statistics:",t),new Error("    ")}}}class bw{static async ensureEmployeeDocument(e=null){try{const t=e||It.currentUser;if(!t)throw new Error("No authenticated user");const s=t.uid;if(this.cache.has(s)){const a=this.cache.get(s);if(Date.now()-a.timestamp<6e4)return a.employee}if(this.creationPromises.has(s))return await this.creationPromises.get(s);const i=this.createOrGetEmployee(t);this.creationPromises.set(s,i);try{const a=await i;return this.creationPromises.delete(s),a}catch(a){throw this.creationPromises.delete(s),a}}catch(t){throw console.error(" Employee document validation failed:",t),new Error(`     : ${t.message}`)}}static async createOrGetEmployee(e){const t=e.uid;console.log(" Checking employee document for user:",t);const s=Ye(pe,"employees",t),i=await Un(s);if(i.exists()){const a=i.data();return console.log(" Employee document found:",{uid:t,name:a.fullName||a.name,status:a.status,email:a.email}),this.cache.set(t,{employee:a,timestamp:Date.now()}),a}return console.log(" Employee document not found, creating automatically..."),await this.createEmployeeDocument(e)}static async createEmployeeDocument(e){const t=e.uid,s=e.email||"",i=e.displayName||"",a=s.split("@")[0]||"",o={fullName:i||a,name:i||a,email:s,status:"active",role:"employee",department:"",jobTitle:"",phone:"",nationalId:"",hireDate:new Date().toISOString(),salary:0,createdAt:it(),updatedAt:it(),createdBy:"auto-system",autoCreated:!0,uid:t};console.log(" Creating employee document:",o);const l=Ye(pe,"employees",t);return await uu(l,o),console.log(" Employee document created successfully for:",t),this.cache.set(t,{employee:o,timestamp:Date.now()}),this.logAutoCreation(t,s),o}static logAutoCreation(e,t){console.log(" Auto-Creation Event:",{type:"EMPLOYEE_AUTO_CREATED",uid:e,email:t,timestamp:new Date().toISOString(),reason:"Missing employee document for authenticated user"})}static clearCache(e=null){e?this.cache.delete(e):this.cache.clear()}static async validateEmployee(e=null){try{const t=await this.ensureEmployeeDocument(e);return{isValid:t.status==="active"||t.autoCreated,employee:t,autoCreated:t.autoCreated||!1}}catch(t){return console.error(" Employee validation failed:",t),{isValid:!1,employee:null,error:t.message}}}}ur(bw,"cache",new Map),ur(bw,"creationPromises",new Map);typeof window<"u"&&(window.EmployeeAutoCreator=bw);class K8{async uploadFile(e,t="uploads"){var s,i;try{if(console.log(" Starting file upload...",{fileName:e.name,fileSize:e.size,folder:t,fileType:e.type}),!It.currentUser)throw console.log(" No authenticated user found - cannot upload to Storage"),new Error("     ");const a=It.currentUser.uid;if(console.log(" Current user:",a),!e)throw new Error("    ");const o=10*1024*1024;if(e.size>o)throw new Error("   .   10 ");const l=Date.now(),c=`${t}/${l}_${e.name}`;console.log(" Upload path:",c);const d=Ea(xr,c);console.log(" Storage reference created for bucket:",xr.app.options.storageBucket),console.log(" Uploading to Firebase Storage folder:",t);const h=await Zg(d,e),f=await rm(d);return console.log(" File upload successful:",f),{url:f,path:c,originalName:e.name,size:e.size,type:e.type,uploadedBy:a,uploadedAt:new Date().toISOString()}}catch(a){throw console.error(" File upload error:",a),console.error(" Error code:",a.code),console.error(" Error message:",a.message),console.error(" Full error object:",a),console.error(" Auth state during error:",{hasUser:!!It.currentUser,uid:(s=It.currentUser)==null?void 0:s.uid,email:(i=It.currentUser)==null?void 0:i.email}),a.code==="storage/unauthorized"?new Error("   .    Firebase"):a.code==="storage/canceled"?new Error("   "):a.code==="storage/unknown"?new Error("      "):new Error(a.message||"   ")}}async uploadFileWithCustomName(e,t="uploads",s){var i,a;try{if(!e)throw new Error("    ");const o=10*1024*1024;if(e.size>o)throw new Error("   .   10 ");const l=Date.now(),c=s?`${t}/${l}_${s}`:`${t}/${l}_${e.name}`,d=Ea(xr,c),h=await Zg(d,e);return{url:await rm(d),path:c,originalName:s||e.name,size:e.size,type:e.type,uploadedAt:new Date().toISOString()}}catch(o){throw console.error(" File upload error:",o),console.error(" Error code:",o.code),console.error(" Error message:",o.message),console.error(" Full error object:",o),console.error(" Auth state during error:",{hasUser:!!It.currentUser,uid:(i=It.currentUser)==null?void 0:i.uid,email:(a=It.currentUser)==null?void 0:a.email}),o.code==="storage/unauthorized"?new Error("   .    Firebase"):o.code==="storage/canceled"?new Error("   "):o.code==="storage/unknown"?new Error("      "):new Error(o.message||"   ")}}async deleteFile(e){try{if(!e)throw new Error("   ");const t=Ea(xr,e);await ny(t),console.log("File deleted successfully:",e)}catch(t){if(console.error("File deletion error:",t),t.code==="storage/object-not-found"){console.warn("File not found for deletion:",e);return}throw new Error(`   : ${t.message}`)}}async getFileURL(e){try{if(!e)throw new Error("   ");const t=Ea(xr,e);return await rm(t)}catch(t){throw console.error("Get file URL error:",t),new Error(`     : ${t.message}`)}}async saveDocumentsToFirestore(e,t){if(!e||!Array.isArray(t))return;const s=t.map(i=>{const a=Ye(Qe(pe,`tenders/${e}/tenderDocuments`),i.id||Date.now().toString());return uu(a,i)});await Promise.all(s)}async loadDocumentsFromFirestore(e){try{if(!e)return[];const t=Qe(pe,`tenders/${e}/tenderDocuments`),s=await lt(t),i=[];return s.forEach(a=>{i.push({...a.data(),id:a.id})}),console.log(`Loaded ${i.length} documents from Firestore for tender: ${e}`),i}catch(t){return console.error("Error loading documents from Firestore:",t),[]}}validateFile(e,t={}){const{maxSize:s=10*1024*1024,allowedTypes:i=["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}=t;if(!e)throw new Error("   ");if(e.size>s)throw new Error(`   .   ${Math.round(s/(1024*1024))} `);if(!i.includes(e.type))throw new Error("   .  : PDF, Word, ");return!0}}const zs=new K8,JN=({show:n,onClose:e,documents:t,setDocuments:s,tenderId:i,uploadingDocument:a,setUploadingDocument:o,handleDocumentUpload:l,handleDeleteClick:c,deleting:d,title:h=" "})=>{const{alertConfig:f,closeAlert:p,showSuccess:x,showError:I}=Kt(),{formatDate:D}=Pu();return n?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},tabIndex:"-1",dir:"rtl",children:r.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[r.jsxs("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"12px 12px 0 0"},children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-file-earmark-text me-2"}),h]}),r.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:e,"aria-label":"Close"})]}),r.jsx("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"},children:r.jsxs("div",{className:"mb-4",children:[r.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("div",{className:"bg-primary bg-opacity-10 p-2 rounded-circle me-3",children:r.jsx("i",{className:"bi bi-files text-primary"})}),r.jsxs("div",{children:[r.jsx("h6",{className:"mb-0 fw-bold text-primary",children:" "}),r.jsxs("small",{className:"text-muted",children:[" : ",t.length]})]})]}),r.jsxs("div",{style:{marginTop:"10px",marginBottom:"10px"},children:[r.jsx("input",{type:"file",id:"documentUpload",onChange:l,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",style:{display:"none"}}),r.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{console.log(" Upload button clicked");const A=document.getElementById("documentUpload");A?(A.click(),console.log(" File input triggered")):console.error(" File input not found")},disabled:a,style:{height:"32px",minWidth:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",fontWeight:"500"},children:a?r.jsxs(r.Fragment,{children:[r.jsx(an,{size:"small"}),r.jsx("span",{className:"ms-2",children:"..."})]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"bi bi-cloud-upload me-1"})," "]})})]})]}),(console.log(" MODAL RENDER CHECK:",new Date().toLocaleTimeString()),console.log(" Documents state:",{length:t.length,docs:t.map(A=>({name:A.fileName,url:!!A.fileURL,id:A.id}))}),null),t.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-folder2-open",style:{fontSize:"3rem"}})}),r.jsx("h5",{className:"text-muted",children:"   "}),r.jsx("p",{className:"text-muted",children:'  " "  '})]}):r.jsx("div",{className:"table-responsive",style:{maxHeight:"400px",overflowY:"auto"},children:r.jsxs("table",{className:"table table-hover",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",children:"#"}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:""})]})}),r.jsx("tbody",{children:t.map((A,g)=>{if(!A||typeof A!="object")return null;const j=(Z=>!Z||typeof Z!="string"?{icon:"bi-file-earmark",color:"#6c757d"}:Z.includes("pdf")?{icon:"bi-file-earmark-pdf",color:"#dc3545"}:Z.includes("word")||Z.includes("document")?{icon:"bi-file-earmark-word",color:"#2b579a"}:Z.includes("image")?{icon:"bi-file-earmark-image",color:"#198754"}:{icon:"bi-file-earmark",color:"#6c757d"})(A.fileType||""),V=A.fileName||A.originalFileName||"  ",$=A.fileSize||0;return A.uploadDate,r.jsxs("tr",{children:[r.jsx("td",{className:"text-center fw-bold text-muted",children:g+1}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("i",{className:`${j.icon} me-2`,style:{color:j.color}}),r.jsx("span",{className:"fw-bold text-primary",title:V,children:V.length>25?V.substring(0,25)+"...":V})]})}),r.jsx("td",{className:"text-center",children:r.jsxs("span",{className:"badge bg-light text-dark",children:[($/1024/1024).toFixed(2)," ."]})}),r.jsx("td",{className:"text-center",children:r.jsx("small",{className:"text-muted",children:D(A.uploadedAt||A.uploadDate||new Date)})}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"btn-group btn-group-sm",children:[r.jsx("a",{href:A.fileURL||"#",target:"_blank",rel:"noopener noreferrer",className:"btn btn-success",title:" ",style:{width:"32px",height:"32px",padding:"0",borderRadius:"6px 0 0 6px",fontSize:"12px"},onClick:Z=>{A.fileURL||(Z.preventDefault(),I("   ",""))},children:r.jsx("i",{className:"bi bi-eye"})}),r.jsx("button",{className:"btn btn-outline-danger",onClick:()=>c(A),title:"",disabled:d,style:{width:"32px",height:"32px",padding:"0",borderRadius:"0 6px 6px 0",fontSize:"12px"},children:r.jsx("i",{className:"bi bi-trash"})})]})})]},A.id||`doc-${g}`)})})]})})]})}),r.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:r.jsxs("div",{className:"d-flex",style:{gap:"10px"},children:[r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:e,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},children:""}),r.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>x("    "," "),style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},children:""})]})})]})})}),r.jsx(Wt,{show:f.show,onClose:p,title:f.title,message:f.message,type:f.type,onConfirm:f.onConfirm,showConfirm:f.showConfirm})]}):null};function Y8(){const n=On(),{id:e}=li(),{logActivity:t,getCurrentUser:s}=$t(),{alertConfig:i,closeAlert:a,showSuccess:o,showError:l,showConfirm:c}=Kt(),{isTimelineVisible:d}=gn(),h=!!e,[f,p]=b.useState(!1),[x,I]=b.useState({title:"",referenceNumber:"",entity:"",description:"",submissionDeadline:"",estimatedValue:"",location:"",contactPerson:"",contactPhone:"",contactEmail:""}),[D,A]=b.useState({}),[g,N]=b.useState(!1),[j,V]=b.useState(!1),[$,Z]=b.useState(!1),[O,M]=b.useState(""),[T,L]=b.useState(!1),[G,U]=b.useState([]),[k,re]=b.useState(!1),[xe,H]=b.useState(!1),[ee,se]=b.useState(null),[Y,R]=b.useState(""),[_,C]=b.useState(!1),[z,K]=b.useState([]),[F,Q]=b.useState([]),[oe,E]=b.useState(!1),[te,Te]=b.useState(null),[ze,We]=b.useState(null),[at,zt]=b.useState(!1),[fe,Ce]=b.useState(!1);b.useEffect(()=>{(async()=>{try{if(V(!0),console.log(" SENIOR REACT: Starting unified data initialization..."),e)console.log(" EDIT MODE: Skipping pending items check - will load from saved tender");else{console.log(" NEW TENDER: Loading pending tender items...");const ae=await qe.getPendingTenderItems();if(ae&&Array.isArray(ae)&&ae.length>0){console.log(" NEW TENDER: Found",ae.length,"pending items - SETTING STATE IMMEDIATELY"),console.log(" PENDING ITEMS DATA:",ae.map(Se=>({id:Se.internalId||Se.materialInternalId,name:Se.materialName||Se.name||"UNNAMED"}))),K(ae);const je=ae.map(Se=>Se.internalId||Se.materialInternalId||Se.id).filter(Se=>Se);Q(je),console.log(" Loaded item IDs for new tender mode:",je),console.log(" NEW TENDER STATE SET: Items initialized with pending data")}else console.log(" NEW TENDER: No pending items found")}if(e){console.log(" EDIT MODE: Starting - IDENTICAL to creation mode logic");const ae=await ya.getById(e);if(!ae){console.error(" EDIT MODE: Tender not found");return}console.log(" EDIT MODE: Tender loaded:",ae.title);const je=await qe.getPendingData(`tenderFormData_${e}`);if(je&&Object.keys(je).some(Re=>je[Re])){console.log(" EDIT MODE: Found saved form changes, using them");const Re={...ae,...je};I(Re)}else{console.log(" EDIT MODE: Using original tender data");const Re={...ae};if(Re.submissionDeadline){let ue=Re.submissionDeadline;ue&&typeof ue=="object"&&ue.seconds?ue=new Date(ue.seconds*1e3):ue&&typeof ue=="object"&&ue.toDate&&(ue=ue.toDate()),Re.submissionDeadline=Dd(ue)}if(Re.deadline){let ue=Re.deadline;ue&&typeof ue=="object"&&ue.seconds?ue=new Date(ue.seconds*1e3):ue&&typeof ue=="object"&&ue.toDate&&(ue=ue.toDate()),Re.submissionDeadline=Dd(ue),delete Re.deadline}if(Re.submissionDate){let ue=Re.submissionDate;ue&&typeof ue=="object"&&ue.seconds?ue=new Date(ue.seconds*1e3):ue&&typeof ue=="object"&&ue.toDate&&(ue=ue.toDate()),Re.submissionDeadline=Dd(ue),delete Re.submissionDate}const ye=await qe.getPendingData(`tenderFormData_${e}`);ye&&(console.log(" EDIT MODE: Found pending form changes, merging with tender data"),Object.assign(Re,ye)),I(Re)}ae.documents&&Array.isArray(ae.documents)&&U(ae.documents);const Se=await qe.getPendingTenderItems();let Ie=[];if(ae.items&&Array.isArray(ae.items)&&(console.log(" EDIT MODE: Found existing saved items:",ae.items.length),Ie=[...ae.items]),Se&&Se.length>0){console.log(" EDIT MODE: Found pending items from material pages:",Se.length);const Re=Ie.map(ue=>ue.internalId||ue.materialInternalId||ue.id).filter(ue=>ue),ye=Se.filter(ue=>{const Me=ue.internalId||ue.materialInternalId||ue.id;return Me&&!Re.includes(Me)});ye.length>0?(console.log(" Adding new items to tender:",ye.length),Ie=[...Ie,...ye]):console.log(" All pending items were duplicates, skipping"),await qe.clearPendingTenderItems(),console.log(" EDIT MODE: Cleared pending items after merging")}if(Ie.length>0){console.log(" FINAL ITEMS LIST:",Ie.map(ue=>({internalId:ue.internalId||ue.materialInternalId,materialName:ue.materialName||ue.name,supplierInfo:ue.supplierInfo,unitPrice:ue.unitPrice,quantity:ue.quantity,totalPrice:ue.totalPrice}))),K(Ie);const Re=Ie.map(ue=>ue.internalId||ue.materialInternalId||ue.id).filter(ue=>ue);Q(Re),console.log(" Loaded all item IDs for edit mode:",Re);const ye=Ie.reduce((ue,Me)=>ue+(Me.unitPrice||Me.price||0)*(Me.quantity||1),0);I(ue=>({...ue,estimatedValue:ye.toString()})),console.log(" EDIT MODE STATE SET: Final items count:",Ie.length)}else console.log(" EDIT MODE: No items to load")}else{console.log(" NEW TENDER MODE: Checking for saved form data...");const ae=await qe.getPendingData("tenderFormData_new");ae?(console.log(" NEW TENDER: Restoring saved form data from previous session"),I(ae)):(console.log(" NEW TENDER: Starting with fresh empty form"),I({title:"",referenceNumber:"",entity:"",description:"",submissionDeadline:"",estimatedValue:"",category:"",location:"",contactPerson:"",contactPhone:"",contactEmail:""}));const je=await qe.getPendingData("tenderDocuments_new");je&&Array.isArray(je)?(console.log(" NEW TENDER: Restoring saved documents"),U(je)):U([]);const Se=await qe.getPendingTenderItems();if(Se&&Se.length>0){console.log(" NEW TENDER: Found pending items, adding to form");const Ie="tender_success_shown_new",Re=localStorage.getItem(Ie)==="true",ye=z.length===0&&!fe&&!Re;K(Se);const ue=Se.reduce((Me,Pe)=>Me+(Pe.unitPrice||0)*(Pe.quantity||1),0);if(ue>0){console.log(` Updating estimated value from items: ${ue}`);const Me={...ae||x,estimatedValue:ue.toString()};I(Me),await qe.setPendingData("tenderFormData_new",Me)}ye?(Ce(!0),localStorage.setItem(Ie,"true"),c(`  ${Se.length}   .

       .`,()=>{},"  ","","",!1)):console.log(" Success message skipped (items already exist or already shown)")}else K([]);console.log(" NEW TENDER: Form initialized with persistence")}console.log(" Data initialization completed")}catch(ae){console.error("Error initializing data:",ae),l("   ","")}finally{V(!1)}})()},[e]),b.useEffect(()=>()=>{console.log(" COMPONENT UNMOUNT: Keeping pending items for next navigation")},[]);const Ne=b.useRef(!1),He=b.useRef(Date.now()),Xe=async()=>{if(Ne.current){console.log(" loadPendingItems already running, skipping...");return}if(e&&z.length>0){console.log(" EDIT MODE: Skipping pending items load - already have saved tender items");return}try{Ne.current=!0,console.log(" Loading pending tender items from Firestore...");const J=await qe.getPendingTenderItems();if(J){const ae=Array.isArray(J)?J:JSON.parse(J);console.log(" Found pending tender items:",ae.length,"items"),console.log(" STORAGE CONTENT:",ae.map(je=>({id:je.internalId||je.materialInternalId,name:je.materialName||je.name}))),K(je=>{console.log(" PROCESSING NEW ITEMS WITH ID-BASED DUPLICATE PREVENTION");const Se=ae.filter(ye=>{const ue=ye.internalId||ye.materialInternalId||ye.id,Me=ue&&F.includes(ue);return Me&&console.log(" DUPLICATE DETECTED (ID-based):",{itemName:ye.materialName||ye.name,itemId:ue,action:"FILTERED_OUT"}),!Me});if(console.log(" DUPLICATE PREVENTION RESULTS:",{totalNewItems:ae.length,duplicatesFiltered:ae.length-Se.length,itemsToAdd:Se.length,existingItems:je.length}),Se.length===0)return console.log(" No new items to add after duplicate filtering"),je;const Ie=[...je,...Se];if(Se.length>0){const ye=Se.map(ue=>ue.internalId||ue.materialInternalId||ue.id).filter(ue=>ue);Q(ue=>{const Me=[...ue,...ye];return console.log(" Updated selectedItemIds:",Me),Me})}const Re=Ie.reduce((ye,ue)=>ye+(ue.unitPrice||0)*(ue.quantity||1),0);return Re>0&&I(ye=>({...ye,estimatedValue:Re.toString()})),console.log(" SENIOR REACT STORAGE REPLACEMENT COMPLETED:",{prevItemsCount:je.length,storageItemsCount:ae.length,finalCount:Ie.length,replacementSuccess:"COMPLETE_REPLACEMENT_FROM_STORAGE"}),Ie}),setTimeout(()=>{K(je=>(console.log(" FORCE RE-RENDER: Ensuring UI reflects current items count:",je.length),[...je]))},100),console.log(" Items loaded and ready - keeping in storage until tender is saved")}else{console.log(" No pending tender items found in Firestore");const ae=await qe.getPendingData(`tenderItems_${e||"new"}`);if(ae&&z.length===0)try{Array.isArray(ae)&&ae.length>0&&(console.log(" Loading existing tender items from Firestore:",ae.length),K(ae))}catch(je){console.error("Error loading Firestore items:",je)}}}catch(J){console.error("Error loading pending items:",J)}finally{setTimeout(()=>{Ne.current=!1,console.log(" Released loadPendingItems lock after 3-second cooldown")},3e3)}};b.useEffect(()=>{const J=()=>{console.log(" Custom event received - reloading items..."),Xe()},ae=je=>{console.log(" TRASH RESTORE: Tender item restored from trash, reloading items...");const{tenderId:Se,restoredItem:Ie}=je.detail||{};Se===(e||"new")?(console.log(" RESTORE FOR THIS TENDER: Reloading items for tender",Se),Xe()):console.log(" RESTORE FOR OTHER TENDER: Ignoring restoration for tender",Se)};return window.addEventListener("tenderItemsAdded",J),window.addEventListener("tenderItemRestored",ae),()=>{window.removeEventListener("tenderItemsAdded",J),window.removeEventListener("tenderItemRestored",ae)}},[]);const ot=b.useRef(!1);b.useEffect(()=>{const ae=setTimeout(async()=>{const je=Date.now()-He.current,Se=je<5e3,Ie=ot.current;if(console.log(" AUTO-SAVE TRIGGERED:",{itemsCount:z.length,isLoadingLocked:Ne.current,timeSinceMount:je,isRecentMount:Se,isDeletingOperation:Ie,willSave:z.length>0&&!Ne.current&&!Se&&!Ie}),z.length>0&&!Ne.current&&!Se&&!Ie)try{await qe.setPendingTenderItems(z),console.log(" SMART AUTO-SAVE: Saved tender items to Firestore:",z.length,"items"),console.log(" AUTO-SAVE CONTENT:",z.map(Re=>({id:Re.internalId||Re.materialInternalId,name:Re.materialName||Re.name})))}catch(Re){console.error("Error saving tender items:",Re)}else Ne.current?console.log(" SMART AUTO-SAVE: Skipping save during item loading to prevent race condition"):Se?console.log(" SMART AUTO-SAVE: Skipping save - component recently mounted, allowing time for item loading"):Ie?console.log(" SMART AUTO-SAVE: Skipping save during deletion operation to prevent restoring deleted items"):z.length===0&&console.log(" SMART AUTO-SAVE: Skipping save for empty items array")},2e3);return()=>clearTimeout(ae)},[z]),b.useEffect(()=>{const ae=setTimeout(async()=>{if(G.length>0)try{await qe.setPendingData(`tenderDocuments_${e||"new"}`,G),console.log("Saved tender documents to Firestore:",G.length,"documents")}catch(je){console.error("Error saving tender documents:",je)}},1e3);return()=>clearTimeout(ae)},[G,e]),b.useEffect(()=>{const J=e||"new",ae=Se=>{const Ie=`tenderDocuments_${J}`;if(console.log(" Storage event detected:",{key:Se.key,expectedKey:Ie,isMatch:Se.key===Ie}),Se.key===Ie&&Se.newValue)try{const Re=JSON.parse(Se.newValue);console.log(" Restoring documents from storage event:",Re.length),U(Re);const ye=Re.filter(ue=>ue.restoredFrom==="trash").sort((ue,Me)=>new Date(Me.restoredAt||0)-new Date(ue.restoredAt||0))[0];if(ye){const ue=s();t("file",`${ue.name}    `,` : ${ye.fileName}`)}}catch(Re){console.error("Error parsing restored documents:",Re)}},je=Se=>{const{tenderId:Ie,restoredDocument:Re,allDocuments:ye}=Se.detail;if(console.log(" Custom restore event detected:",{eventTenderId:Ie,currentTenderId:J,isMatch:Ie===J,documentName:Re==null?void 0:Re.fileName}),Ie===J){console.log(" Updating documents from custom event:",ye.length),U([...ye]);const ue=s();t("file",`${ue.name}    `,` : ${Re.fileName}`)}};return window.addEventListener("storage",ae),window.addEventListener("tenderDocumentRestored",je),()=>{window.removeEventListener("storage",ae),window.removeEventListener("tenderDocumentRestored",je)}},[e,o,s,t]);const Fe=b.useCallback(()=>{if(!z||z.length===0)return 0;const J=z.reduce((ae,je)=>ae+(je.totalPrice||0),0);return console.log(" INSTANT: Reflecting pre-calculated total from items:",J),J},[z]);b.useCallback(()=>{const J=z.reduce((ae,je)=>ae+(je.totalPrice||0),0);return I(ae=>({...ae,estimatedValue:J.toString()})),console.log(" CONTROLLED: Updated estimated value explicitly:",J),J},[z]),b.useEffect(()=>{const ae=setTimeout(async()=>{if(Object.keys(x).some(je=>x[je]))try{await qe.setPendingData(`tenderFormData_${e||"new"}`,x),console.log(" Saved tender form data for navigation persistence:",x.title||"New Tender")}catch(je){console.error("Error saving form data:",je)}},1e3);return()=>clearTimeout(ae)},[x,e]);const gt=()=>{p(!f)},Pt=async J=>{const{name:ae,value:je,type:Se,checked:Ie}=J.target,Re={...x,[ae]:Se==="checkbox"?Ie:je};I(Re);try{const ye=e?`tenderFormData_${e}`:"tenderFormData_new";await qe.setPendingData(ye,Re),console.log(` Form data saved for field: ${ae}`)}catch(ye){console.error("Error saving form data:",ye)}D[ae]&&A(ye=>({...ye,[ae]:""}))},Yt=async J=>{J.preventDefault();const ae=om.validateTenderData({...x,submissionDeadline:x.submissionDeadline?new Date(x.submissionDeadline):null});if(Object.keys(ae).length>0){A(ae);return}N(!0),A({});try{const je=await _i.validateUniqueFields({referenceNumber:x.referenceNumber},h?e:null,"tenders");if(Object.keys(je).length>0){A(je),N(!1);return}const Se=z.reduce((ye,ue)=>ye+(ue.totalPrice||0),0),Ie={...x,submissionDeadline:x.submissionDeadline?new Date(x.submissionDeadline):null,estimatedValue:Se,documents:G,items:z||[]};console.log(" Saving complete tender data to Firebase with calculated total:",{title:Ie.title,estimatedValue:Se,documentsCount:(Ie.documents||[]).length,itemsCount:(Ie.items||[]).length});let Re;if(h){Re=await ya.updateTender(e,Ie);const ye=s();await t("task",`${ye.name}  `,`  : ${Ie.title}`),await qe.clearPendingData(`tenderFormData_${e}`),await qe.clearPendingData(`tenderDocuments_${e}`),await qe.clearPendingTenderItems(),o("   "," ")}else{Re=await ya.createTender(Ie);const ye=s();await t("task",`${ye.name}  `,`  : ${Ie.title}`),await qe.clearPendingData("tenderFormData_new"),await qe.clearPendingData("tenderDocuments_new"),await qe.clearPendingTenderItems(),localStorage.removeItem("tender_success_shown_new"),o("   "," ")}setTimeout(()=>{n("/tenders/list")},1500)}catch(je){A({submit:je.message}),l("   ","  ")}finally{N(!1)}},Xt=async()=>{try{h||(console.log(" CANCEL: Clearing all pending data for cancelled new tender"),await qe.clearPendingData("tenderFormData_new"),await qe.clearPendingData("tenderDocuments_new"),await qe.clearPendingTenderItems(),localStorage.removeItem("tender_success_shown_new"),console.log(" CANCEL: All pending data cleared successfully"))}catch(J){console.error("Error clearing pending data on cancel:",J)}n("/tenders/list")},Lt=()=>{Z(!0)},on=()=>{Z(!1),M("")},Bn=J=>{try{switch(console.log("Selected item type:",J),J){case"raw-materials":const ae=`/tenders/raw-materials/${e||"new"}`;console.log("Navigating to:",ae),n(ae);break;case"local-product":const je=`/tenders/local-products/${e||"new"}`;console.log("Navigating to local products:",je),n(je);break;case"imported-product":const Se=`/tenders/foreign-products/${e||"new"}`;console.log("Navigating to foreign products:",Se),n(Se);break;case"manufactured-product":const Ie=`/tenders/manufactured-products/${e||"new"}`;console.log("Navigating to manufactured products:",Ie),n(Ie);break;default:console.log("Unknown item type:",J),l("   ","")}}catch(ae){console.error("Error handling item type selection:",ae),l("    ","")}},In=(J,ae)=>{const je=J.materialName||J.name||"  ";c(`      

${je}`,()=>qn(J,ae),"  ")},qn=async(J,ae)=>{try{C(!0),ot.current=!0,console.log(" Starting deletion process:",{itemName:J.materialName||J.name,itemId:J.internalId||J.materialInternalId,isDeletingFlag:ot.current});const je={...J,tenderContext:{tenderId:e||"new",tenderTitle:x.title||" ",addedAt:new Date().toISOString()}};await un.moveToTrash(je,"tenderItems"),console.log(" Successfully moved to trash"),K(Re=>{const ye=Re.filter((Pe,Le)=>Le!==ae),ue=(J==null?void 0:J.internalId)||(J==null?void 0:J.materialInternalId)||(J==null?void 0:J.id);ue&&Q(Pe=>Pe.filter(Le=>Le!==ue));const Me=ye.reduce((Pe,Le)=>Pe+(Le.totalPrice||0),0);return I(Pe=>({...Pe,estimatedValue:Me.toString()})),console.log(" Item removed from list, new count:",ye.length),ye}),setTimeout(()=>{ot.current=!1,console.log(" Deletion flag cleared, auto-save can resume")},5e3);const Se=s(),Ie=J.materialName||J.name||"  ";t("task",`${Se.name}   `,`  : ${Ie}`),o(`   : ${Ie}`,"  ")}catch(je){console.error(" Error moving tender item to trash:",je),l(`    : ${je.message}`,"  "),ot.current=!1}finally{C(!1)}},Hn=(J,ae)=>{Te({...J}),We(ae),E(!0)},w=(J,ae)=>{const je=Math.max(0,parseFloat(ae)||0);Te(Se=>({...Se,quantity:Number(je.toFixed(1)),totalPrice:(Se.unitPrice||0)*Number(je.toFixed(1))}))},X=()=>{ze!==null&&te&&(K(J=>J.map((ae,je)=>je===ze?te:ae)),E(!1),Te(null),We(null),o("    "," "))},ne=()=>{E(!1),Te(null),We(null)},W=()=>Math.round((te==null?void 0:te.totalPrice)||0),ie=async J=>{const ae=J.target.files[0];if(ae){re(!0);try{try{zs.validateFile(ae,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]})}catch(Se){throw new Error(Se.message)}console.log(" Uploading document:",ae.name);const je=await zs.uploadFile(ae,"tender-documents");se({...je,originalFileName:ae.name,fileSize:ae.size,fileType:ae.type}),R(ae.name.split(".")[0]),H(!0),J.target.value=""}catch(je){console.error("Error uploading document:",je),l(je.message||"   ","  "),J.target&&(J.target.value="")}finally{re(!1)}}},Ee=async()=>{if(!Y.trim()){l("   ","  ");return}if(!ee){l("   ","");return}try{re(!0),console.log(" Creating document with Firebase database storage:",Y);const J={id:Date.now().toString(),fileName:Y.trim(),originalFileName:ee.originalFileName,fileURL:ee.url,storagePath:ee.path,fileSize:ee.fileSize,fileType:ee.fileType,uploadedAt:new Date().toISOString(),uploadDate:new Date().toISOString(),tenderId:e||"new",tenderTitle:x.title||" ",tenderReferenceNumber:x.referenceNumber||" "};if(U(je=>[...je,J]),e&&e!=="new")try{console.log(" Saving document to Firebase database for existing tender:",e);const je=await om.getTenderById(e);if(je){const Se=[...je.documents||[],J];await om.updateTender(e,{...je,documents:Se}),console.log(" Document saved to Firebase database successfully")}}catch(je){console.warn(" Firebase database save failed, document stored locally only:",je.message)}else console.log(" Document stored locally for new tender, will be saved to Firebase when tender is created");o(`   : ${Y}`," ");const ae=s();t("file",`${ae.name}  `,`  : ${Y}`),H(!1),se(null),R("")}catch(J){console.error("Error saving document:",J),l(`   : ${J.message}`,"  ")}finally{re(!1)}},le=()=>{console.log("User cancelled file upload"),H(!1),se(null),R("")},ge=J=>{c(`      

${J.fileName}`,()=>_e(J),"  ")},_e=async J=>{try{C(!0),await un.moveToTrash(J,"tender_documents"),U(je=>je.filter(Se=>Se.id!==J.id));const ae=s();t("task",`${ae.name}  `,`  : ${J.fileName}`),o(`   : ${J.fileName}`,"  ")}catch(ae){l(`    : ${ae.message}`,"  ")}finally{C(!1)}};return r.jsx(r.Fragment,{children:r.jsxs("div",{className:`page-wrapper ${f?"sidebar-collapsed":""}`,dir:"rtl",children:[r.jsx(Nn,{onToggle:gt}),r.jsxs("div",{className:"main-container",style:{paddingRight:f?"72px":"250px",paddingLeft:f||!d?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:f?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:f})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item",children:r.jsx("a",{href:"/tenders/list",className:"text-decoration-none text-primary",children:""})}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:h?" ":"  "})]})}),r.jsx(jn,{}),r.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:r.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[r.jsx("div",{className:"d-flex align-items-center",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:`bi ${h?"bi-pencil-square":"bi-plus-circle-fill"} text-primary me-2`}),h?" ":"  "]})}),r.jsxs("div",{className:"d-flex gap-2",children:[r.jsx("button",{type:"button",className:"btn btn-primary",onClick:Lt,style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:" "}),r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>L(!0),style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:" "})]})]})}),r.jsx("div",{className:"card-body",children:j?r.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:r.jsx(an,{size:"large"})}):r.jsxs("form",{onSubmit:Yt,children:[D.submit&&r.jsxs("div",{className:"alert alert-danger",children:[r.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),D.submit]}),r.jsxs("div",{className:"row",children:[r.jsxs("div",{className:"col-md-8 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"text",className:`form-control ${D.title?"is-invalid":""}`,name:"title",value:x.title,onChange:Pt,placeholder:"  ",disabled:g}),D.title&&r.jsx("div",{className:"invalid-feedback",children:D.title})]}),r.jsxs("div",{className:"col-md-4 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"text",className:`form-control ${D.referenceNumber?"is-invalid":""}`,name:"referenceNumber",value:x.referenceNumber,onChange:Pt,placeholder:" ",disabled:g}),D.referenceNumber&&r.jsx("div",{className:"invalid-feedback",children:D.referenceNumber})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"text",className:`form-control ${D.entity?"is-invalid":""}`,name:"entity",value:x.entity,onChange:Pt,placeholder:"  ",disabled:g}),D.entity&&r.jsx("div",{className:"invalid-feedback",children:D.entity})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"   *"}),r.jsx("input",{type:"date",className:`form-control ${D.submissionDeadline?"is-invalid":""}`,name:"submissionDeadline",value:x.submissionDeadline,onChange:Pt,disabled:g,required:!0}),D.submissionDeadline&&r.jsx("div",{className:"invalid-feedback",children:D.submissionDeadline})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsxs("label",{className:"form-label",children:[" ",r.jsx("small",{className:"text-muted ms-2",children:"(   )"})]}),r.jsxs("div",{className:"input-group",children:[r.jsx("input",{type:"text",className:"form-control bg-light",name:"estimatedValue",value:(()=>{const J=parseFloat(x.estimatedValue)||0;return J>0?`${J.toLocaleString("en-US")} `:"0 "})(),readOnly:!0,placeholder:"    ",style:{backgroundColor:"#f8f9fa",fontWeight:"bold",color:"#198754"}}),r.jsx("span",{className:"input-group-text bg-light text-success",children:r.jsx("i",{className:"bi bi-calculator"})})]})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:""}),r.jsx("input",{type:"text",className:"form-control",name:"location",value:x.location,onChange:Pt,placeholder:"  ",disabled:g})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:" "}),r.jsx("input",{type:"text",className:"form-control",name:"contactPerson",value:x.contactPerson,onChange:Pt,placeholder:"  ",disabled:g})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:" "}),r.jsx("input",{type:"tel",className:"form-control",name:"contactPhone",value:x.contactPhone,onChange:Pt,placeholder:" ",disabled:g})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:" "}),r.jsx("input",{type:"email",className:"form-control",name:"contactEmail",value:x.contactEmail,onChange:Pt,placeholder:" ",disabled:g})]}),r.jsxs("div",{className:"col-md-12 mb-3",children:[r.jsx("label",{className:"form-label",children:" "}),r.jsx("textarea",{className:"form-control",name:"description",value:x.description,onChange:Pt,rows:"4",placeholder:"   ...",disabled:g})]}),r.jsx("div",{className:"col-md-12 mb-4",children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsx("div",{className:"card-header bg-light",children:r.jsx("div",{className:"d-flex justify-content-between align-items-center",children:r.jsxs("h6",{className:"mb-0 fw-bold text-primary",children:[r.jsx("i",{className:"bi bi-list-task me-2"}),"  (",z.length,")",z.length===0&&r.jsx("span",{className:"text-danger",children:"-   "})]})})}),r.jsx("div",{className:"card-body p-0",children:r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",style:{width:"60px"},children:""})]})}),r.jsx("tbody",{children:z&&z.length>0?z.map((J,ae)=>{let je=J.materialName||J.name||"  ";je&&je.toString().startsWith("rm_")&&(je="  ");const Se=J.materialUnit||J.unit||"",Ie=J.totalPrice||0,Re=J.internalId;return r.jsxs("tr",{style:{backgroundColor:ae%2===0?"#ffffff":"#f8f9fa"},children:[r.jsx("td",{className:"text-center fw-bold text-muted",children:ae+1}),r.jsx("td",{className:"text-center fw-medium",children:r.jsx("div",{children:r.jsx("button",{className:"btn btn-link p-0 fw-medium text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:async ye=>{ye.preventDefault(),ye.stopPropagation();try{console.log("=== DETAILED DEBUGGING ==="),console.log("Full item object:",JSON.stringify(J,null,2)),console.log("All item keys:",Object.keys(J));const ue=J.materialInternalId,Me=J.materialType||"rawMaterial";console.log("Searching for:"),console.log("- materialInternalId:",ue),console.log("- materialType:",Me);let Pe=null,Le=[];if(Me==="rawMaterial"){console.log("Loading raw materials...");const{RawMaterialService:st}=await ns(async()=>{const{RawMaterialService:Ve}=await Promise.resolve().then(()=>ax);return{RawMaterialService:Ve}},void 0);Le=await st.getAllRawMaterials(),console.log("Total raw materials loaded:",Le.length),console.log("Sample raw material IDs:",Le.slice(0,3).map(Ve=>({id:Ve.id,internalId:Ve.internalId,name:Ve.name})));let ke=Le.find(Ve=>Ve.internalId===ue);if(ke||(ke=Le.find(Ve=>Ve.id===ue)),!ke){const Ve=J.materialName||J.name;ke=Le.find(Tn=>Tn.name===Ve)}console.log("Found raw material:",ke?"YES":"NO"),ke&&(console.log("Material details:",{id:ke.id,internalId:ke.internalId,name:ke.name}),Pe=ke.id,n(`/raw-materials/edit/${Pe}`))}else if(Me==="localProduct"){console.log("Loading local products...");const{LocalProductService:st}=await ns(async()=>{const{LocalProductService:Ve}=await Promise.resolve().then(()=>ox);return{LocalProductService:Ve}},void 0);Le=await st.getAllLocalProducts(),console.log("Total local products loaded:",Le.length),console.log("Sample local product IDs:",Le.slice(0,3).map(Ve=>({id:Ve.id,internalId:Ve.internalId,name:Ve.name})));let ke=Le.find(Ve=>Ve.internalId===ue);if(ke||(ke=Le.find(Ve=>Ve.id===ue)),!ke){const Ve=J.materialName||J.name;ke=Le.find(Tn=>Tn.name===Ve)}console.log("Found local product:",ke?"YES":"NO"),ke&&(console.log("Product details:",{id:ke.id,internalId:ke.internalId,name:ke.name}),Pe=ke.id,n(`/local-products/edit/${Pe}`))}else if(Me==="foreignProduct"){console.log("Loading foreign products...");const{ForeignProductService:st}=await ns(async()=>{const{ForeignProductService:Ve}=await Promise.resolve().then(()=>lx);return{ForeignProductService:Ve}},void 0);Le=await st.getAllForeignProducts(),console.log("Total foreign products loaded:",Le.length),console.log("Sample foreign product IDs:",Le.slice(0,3).map(Ve=>({id:Ve.id,internalId:Ve.internalId,name:Ve.name})));let ke=Le.find(Ve=>Ve.internalId===ue);if(ke||(ke=Le.find(Ve=>Ve.id===ue)),!ke){const Ve=J.materialName||J.name;ke=Le.find(Tn=>Tn.name===Ve)}console.log("Found foreign product:",ke?"YES":"NO"),ke&&(console.log("Product details:",{id:ke.id,internalId:ke.internalId,name:ke.name}),Pe=ke.id,n(`/foreign-products/edit/${Pe}`))}else if(Me==="manufacturedProduct"){console.log("Loading manufactured products...");const{ManufacturedProductService:st}=await ns(async()=>{const{ManufacturedProductService:Ve}=await Promise.resolve().then(()=>BR);return{ManufacturedProductService:Ve}},void 0);Le=await st.getAllManufacturedProducts(),console.log("Total manufactured products loaded:",Le.length),console.log("Sample manufactured product IDs:",Le.slice(0,3).map(Ve=>({id:Ve.id,internalId:Ve.internalId,title:Ve.title})));let ke=Le.find(Ve=>Ve.internalId===ue);ke||(ke=Le.find(Ve=>Ve.id===ue)),ke||(ke=Le.find(Ve=>Ve.title===J.materialName)),console.log("Found manufactured product:",ke?"YES":"NO"),ke&&(console.log("Product details:",{id:ke.id,internalId:ke.internalId,title:ke.title}),Pe=ke.id,n(`/manufactured-products/edit/${Pe}`))}Pe||(console.error("=== SEARCH FAILED ==="),console.error("Could not find Firebase ID for:",ue),console.error("Available items in this category:",Le.map(st=>({id:st.id,internalId:st.internalId,name:st.name}))),alert(`     
ID: ${ue}
Type: ${Me}`))}catch(ue){console.error("=== NAVIGATION ERROR ===",ue),alert("     ")}},title:`: ${je}`,children:je})})}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"badge bg-primary",children:J.quantity||1})}),r.jsx("td",{className:"text-center",children:Se}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{children:[r.jsxs("span",{className:"text-success fw-bold",children:[Ie.toLocaleString("en-US")," ."]}),J.unitPrice&&r.jsx("div",{children:r.jsxs("small",{className:"text-muted",children:[J.unitPrice.toLocaleString("en-US"),"  ",J.quantity]})})]})}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"btn-group btn-group-sm",style:{marginLeft:"20px"},children:[r.jsx("button",{className:"btn btn-outline-primary",type:"button",onClick:ye=>{ye.preventDefault(),ye.stopPropagation(),Hn(J,ae)},title:"",children:r.jsx("i",{className:"bi bi-pencil"})}),r.jsx("button",{className:"btn btn-outline-danger",type:"button",onClick:ye=>{ye.preventDefault(),ye.stopPropagation(),In(J,ae)},title:"",disabled:_,children:r.jsx("i",{className:"bi bi-trash"})})]})})]},Re||`item-${ae}`)}):r.jsx("tr",{children:r.jsx("td",{colSpan:"6",className:"text-center py-4 text-muted",children:"    "})})}),r.jsx("tfoot",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{colSpan:"4",className:"text-end",children:" :"}),r.jsxs("th",{className:"text-center text-primary fw-bold",children:[Fe().toLocaleString("en-US")," ."]}),r.jsx("th",{})]})})]})})})]})})]}),r.jsx("div",{className:"row",children:r.jsxs("div",{className:"col-12 d-flex justify-content-center gap-3 mt-4",children:[r.jsx("button",{type:"button",className:"btn btn-secondary",style:{height:"32px",minWidth:"80px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},onClick:Xt,disabled:g,children:""}),r.jsx("button",{type:"submit",className:"btn btn-primary",style:{height:"32px",minWidth:"80px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},disabled:g,children:g?r.jsxs(r.Fragment,{children:[r.jsx(an,{size:"small"}),r.jsx("span",{className:"ms-2",children:h?"...":"..."})]}):h?"":""})]})})]})})]})})}),!f&&d&&r.jsx(_n,{rtl:!0}),!f&&d&&r.jsx(En,{})]})]}),oe&&te&&r.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:r.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[r.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),r.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:ne,"aria-label":"Close"})]}),r.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"30%"},children:""}),r.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),r.jsx("th",{className:"text-center",style:{width:"15%"},children:""}),r.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),r.jsx("tbody",{children:r.jsxs("tr",{style:{height:"60px"},children:[r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("i",{className:"bi bi-layers text-danger me-2"}),r.jsxs("div",{children:[r.jsx("div",{className:"fw-bold text-primary",children:te.materialName||te.name}),r.jsx("small",{className:"text-muted",children:te.materialCategory||te.category})]})]})}),r.jsxs("td",{className:"text-center",children:[r.jsxs("span",{className:"fw-bold text-success",children:[Math.round(te.unitPrice)," "]}),r.jsx("div",{children:r.jsxs("small",{className:"text-muted",children:["/",te.materialUnit||te.unit||""]})})]}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:J=>{J.preventDefault(),J.stopPropagation(),w(te.internalId,Math.max(0,Number((te.quantity-.1).toFixed(1))))},disabled:te.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:r.jsx("i",{className:"bi bi-dash"})}),r.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:te.quantity,min:"0",step:"any",onChange:J=>{J.preventDefault(),J.stopPropagation(),w(te.internalId,J.target.value)},onBlur:J=>{J.preventDefault(),J.stopPropagation();const ae=Number(J.target.value||0).toFixed(1);w(te.internalId,ae)}}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:J=>{J.preventDefault(),J.stopPropagation(),w(te.internalId,Number((te.quantity+.1).toFixed(1)))},style:{width:"32px",height:"32px",borderRadius:"6px"},children:r.jsx("i",{className:"bi bi-plus"})})]})}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"text-muted",children:te.displaySupplier||te.supplierInfo||"-"})}),r.jsxs("td",{className:"text-center",children:[r.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(te.totalPrice)," "]}),r.jsxs("small",{className:"text-success",children:["(",te.quantity.toFixed(1),"  ",Math.round(te.unitPrice),")"]})]})]},te.internalId)})]})})}),r.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:r.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("span",{className:"text-muted me-3",children:" :"}),r.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[W()," "]}),r.jsxs("span",{className:"badge bg-info ms-2",children:[te.quantity.toFixed(1)," "]})]}),r.jsxs("div",{className:"d-flex gap-2",children:[r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:ne,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),r.jsx("button",{type:"button",className:"btn btn-primary",onClick:J=>{J.preventDefault(),J.stopPropagation(),X()},style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})]})})]})})}),r.jsx(Wt,{show:i.show,onClose:a,title:i.title,message:i.message,type:i.type,onConfirm:i.onConfirm,confirmText:i.confirmText,cancelText:i.cancelText,showCancel:i.showCancel}),r.jsx(MR,{show:$,onClose:on,onItemSelect:Bn,selectedItemType:O,setSelectedItemType:M}),r.jsx(JN,{show:T,onClose:()=>L(!1),documents:G,setDocuments:U,tenderId:e||"new",uploadingDocument:k,setUploadingDocument:re,handleDocumentUpload:ie,handleDeleteClick:ge,deleting:_}),xe&&r.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.7)",zIndex:1060},tabIndex:"-1",dir:"rtl",children:r.jsx("div",{className:"modal-dialog modal-dialog-centered",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[r.jsx("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"12px 12px 0 0"},children:r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-pencil-square me-2"})," "]})}),r.jsx("div",{className:"modal-body",style:{padding:"25px"},children:r.jsxs("div",{className:"mb-4",children:[r.jsxs("div",{className:"d-flex align-items-center mb-3",children:[r.jsx("div",{className:"bg-success bg-opacity-10 p-2 rounded-circle me-3",children:r.jsx("i",{className:"bi bi-file-earmark-check text-success"})}),r.jsxs("div",{children:[r.jsx("h6",{className:"mb-0 fw-bold text-success",children:"   "}),r.jsx("small",{className:"text-muted",children:ee==null?void 0:ee.originalFileName})]})]}),r.jsxs("div",{className:"mb-3",children:[r.jsxs("label",{className:"form-label fw-bold text-primary",children:[r.jsx("i",{className:"bi bi-tag me-1"}),"   *"]}),r.jsx("input",{type:"text",className:"form-control",value:Y,onChange:J=>R(J.target.value),placeholder:"   ",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:J=>{J.target.style.borderColor="#28a745",J.target.style.boxShadow="0 0 0 0.2rem rgba(40, 167, 69, 0.25)"},onBlur:J=>{J.target.style.borderColor="#e9ecef",J.target.style.boxShadow="none"},autoFocus:!0}),r.jsxs("small",{className:"text-muted",children:[r.jsx("i",{className:"bi bi-info-circle me-1"}),"        "]})]})]})}),r.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:r.jsxs("div",{className:"d-flex justify-content-end",style:{gap:"12px"},children:[r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:le,style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500"},children:""}),r.jsxs("button",{type:"button",className:"btn btn-success",onClick:Ee,disabled:!Y.trim(),style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500",opacity:Y.trim()?1:.6},children:[r.jsx("i",{className:"bi bi-check-lg me-1"}),""]})]})})]})})})]})})}function NI(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(Y8,{})})})}const X8=()=>{const[n,e]=b.useState({isDragging:!1,draggedItem:null,draggedFrom:null,dragOverTarget:null}),t=b.useRef(null);b.useRef(null);const s=b.useCallback(()=>{e({isDragging:!1,draggedItem:null,draggedFrom:null,dragOverTarget:null})},[]),i=b.useCallback((d,h,f)=>{try{console.log(" [DRAG START] Item:",(h==null?void 0:h.title)||(h==null?void 0:h.id),"Source:",f),d.dataTransfer.effectAllowed="move",d.dataTransfer.setData("text/plain",JSON.stringify({item:h,source:f})),e({isDragging:!0,draggedItem:h,draggedFrom:f,dragOverTarget:null}),t.current=d.currentTarget}catch(p){console.error(" [DRAG START ERROR]:",p),s()}},[s]),a=b.useCallback(d=>{console.log(" [DRAG END]"),t.current=null,s()},[s]),o=b.useCallback((d,h)=>{d.preventDefault(),d.dataTransfer.dropEffect="move",e(f=>({...f,dragOverTarget:h}))},[]),l=b.useCallback(d=>{const h=d.relatedTarget;d.currentTarget.contains(h)||e(p=>({...p,dragOverTarget:null}))},[]),c=b.useCallback((d,h,f)=>{d.preventDefault(),console.log(" [DROP] Target:",h);try{const p=d.dataTransfer.getData("text/plain");let x=null;try{x=JSON.parse(p)}catch{x={item:n.draggedItem,source:n.draggedFrom}}if(!x||!x.item){console.error(" [DROP ERROR] No drag data available");return}const{item:I,source:D}=x;if(D===h){console.log(" [DROP CANCELLED] Same source and target");return}console.log(" [DROP SUCCESS] Moving:",(I==null?void 0:I.title)||(I==null?void 0:I.id),"from",D,"to",h),typeof f=="function"&&f(I,D,h)}catch(p){console.error(" [DROP ERROR]:",p)}finally{e(p=>({...p,dragOverTarget:null}))}},[n]);return{dragState:n,handleDragStart:i,handleDragEnd:a,handleDragOver:o,handleDragLeave:l,handleDrop:c,resetDragState:s}},si={PENDING:"pending",IN_PROGRESS:"inProgress",REVIEW:"review",COMPLETED:"completed"},UR={[si.PENDING]:{title:" ",icon:"bi-hourglass-split",bgColor:"linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%)",progress:0},[si.IN_PROGRESS]:{title:" ",icon:"bi-gear-fill",bgColor:"linear-gradient(135deg, #4834d4 0%, #686de0 100%)",progress:50},[si.REVIEW]:{title:" ",icon:"bi-clipboard-check",bgColor:"linear-gradient(135deg, #f39c12 0%, #e67e22 100%)",progress:90},[si.COMPLETED]:{title:"",icon:"bi-check-circle-fill",bgColor:"linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)",progress:100}},J8={[si.PENDING]:[{id:1,title:"   ",client:"  ",deadline:"2024-01-15",value:"2,500,000",priority:"high",progress:0},{id:2,title:"   ",client:"  ",deadline:"2024-01-20",value:"850,000",priority:"medium",progress:0}],[si.IN_PROGRESS]:[{id:3,title:"  ",client:" ",deadline:"2024-02-01",value:"1,200,000",priority:"high",progress:65},{id:4,title:"  ",client:" ",deadline:"2024-01-25",value:"450,000",priority:"low",progress:30}],[si.REVIEW]:[{id:5,title:"  ",client:"  ",deadline:"2024-02-10",value:"3,800,000",priority:"high",progress:90}],[si.COMPLETED]:[{id:6,title:"  ",client:" ",deadline:"2023-12-30",value:"680,000",priority:"medium",progress:100},{id:7,title:"  ",client:" ",deadline:"2023-12-15",value:"1,950,000",priority:"high",progress:100}]},Z8=n=>{switch(n){case"high":return"#dc3545";case"medium":return"#ffc107";case"low":return"#28a745";default:return"#6c757d"}},jI=n=>{switch(n){case"high":return"";case"medium":return"";case"low":return"";default:return" "}},e9=n=>new Intl.NumberFormat("ar-SA",{style:"currency",currency:"SAR",minimumFractionDigits:0,maximumFractionDigits:0}).format(n),VR=b.memo(({tender:n,stage:e,onDragStart:t,onDragEnd:s,isDragging:i})=>{const a=`kanban-card ${i?"kanban-card--dragging":""}`;return r.jsxs("div",{className:a,draggable:!0,onDragStart:o=>t(o,n,e),onDragEnd:s,"data-testid":`kanban-card-${n.id}`,role:"button",tabIndex:0,"aria-label":`${n.title} - ${jI(n.priority)} priority`,children:[r.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[r.jsx("h6",{className:"card-title mb-0",children:n.title}),r.jsx("span",{className:`badge priority-badge priority-badge--${n.priority}`,style:{backgroundColor:Z8(n.priority)},children:jI(n.priority)})]}),r.jsxs("div",{className:"card-info mb-2",children:[r.jsx("i",{className:"bi bi-building me-1"}),n.client]}),r.jsxs("div",{className:"card-info mb-2",children:[r.jsx("i",{className:"bi bi-calendar-event me-1"}),new Date(n.deadline).toLocaleDateString("ar-SA")]}),r.jsxs("div",{className:"card-value mb-3",children:[r.jsx("i",{className:"bi bi-currency-dollar me-1"}),e9(n.value)]}),n.progress>0&&r.jsxs("div",{className:"mb-2",children:[r.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[r.jsx("small",{className:"text-muted",children:""}),r.jsxs("small",{className:"fw-bold text-primary",children:[n.progress,"%"]})]}),r.jsx("div",{className:"progress-custom",children:r.jsx("div",{className:"progress-bar-custom",style:{width:`${n.progress}%`}})})]}),r.jsxs("div",{className:"card-timestamp",children:[r.jsx("i",{className:"bi bi-clock me-1"})," "]})]})});VR.displayName="KanbanCard";const zR=b.memo(({stage:n,tenders:e,onDragOver:t,onDragLeave:s,onDrop:i,onCardDragStart:a,onCardDragEnd:o,dragState:l})=>{const c=UR[n],d=e.length,h=l.dragOverTarget===n,f=l.isDragging&&l.draggedFrom!==n,p=`kanban-column ${h?"kanban-column--drag-over":""} ${f?"kanban-column--drag-active":""}`;return r.jsxs("div",{className:p,onDragOver:x=>t(x,n),onDragLeave:s,onDrop:x=>i(x,n),"data-testid":`kanban-column-${n}`,role:"region","aria-label":`${c.title} - ${d} items`,children:[r.jsx("div",{className:"kanban-header",style:{background:c.bgColor},children:r.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("i",{className:`bi ${c.icon} me-2`,style:{fontSize:"18px"}}),r.jsx("h6",{className:"fw-bold mb-0",children:c.title})]}),r.jsx("span",{className:"badge bg-white text-dark",children:d})]})}),r.jsx("div",{className:"kanban-content",children:e.length>0?e.map(x=>{var I;return r.jsx(VR,{tender:x,stage:n,onDragStart:a,onDragEnd:o,isDragging:((I=l.draggedItem)==null?void 0:I.id)===x.id},x.id)}):r.jsxs("div",{className:"kanban-empty",children:[r.jsx("div",{className:"kanban-empty-icon",children:r.jsx("i",{className:"bi bi-inbox"})}),r.jsx("p",{className:"mb-1",children:"  "}),r.jsx("small",{children:"  "})]})})]})});zR.displayName="KanbanColumn";const $R=b.memo(({kanbanData:n,onMoveCard:e})=>{const{dragState:t,handleDragStart:s,handleDragEnd:i,handleDragOver:a,handleDragLeave:o,handleDrop:l}=X8(),c=b.useCallback((f,p,x)=>{if(p===x)return;console.log(" [KANBAN] Moving card:",f.title,"from",p,"to",x);const I={...f,progress:UR[x].progress};e(I,p,x)},[e]),d=b.useCallback((f,p)=>{l(f,p,c)},[l,c]),h=[si.COMPLETED,si.REVIEW,si.IN_PROGRESS,si.PENDING];return r.jsx("div",{className:"kanban-board",style:{minHeight:"calc(100vh - 400px)",marginTop:"15px"},children:h.map(f=>r.jsx(zR,{stage:f,tenders:n[f],onDragOver:a,onDragLeave:o,onDrop:d,onCardDragStart:s,onCardDragEnd:i,dragState:t},f))})});$R.displayName="KanbanBoard";function t9(){const[n,e]=b.useState(!1),{isTimelineVisible:t}=gn(),[s,i]=b.useState(J8),a=On(),o=b.useCallback(()=>{e(f=>!f)},[]),l=async()=>{try{await qe.clearPendingData("tenderFormData_new"),await qe.clearPendingData("tenderDocuments_new"),await qe.clearPendingTenderItems(),console.log(" [TRACKING] All pending data cleared - navigating to fresh Add Tender form"),a("/tenders/add")}catch(f){console.error(" [TRACKING] Error clearing pending data:",f),a("/tenders/add")}},c=b.useCallback((f,p,x)=>{i(I=>{const D={};return Object.keys(I).forEach(A=>{A===p?D[A]=I[A].filter(g=>g.id!==f.id):A===x?D[A]=[f,...I[A]]:D[A]=[...I[A]]}),console.log(" [STATE UPDATE] Card moved to top of target column successfully"),D})},[]),d=b.useMemo(()=>({paddingRight:n?"72px":"250px",paddingLeft:n||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"}),[n,t]),h=b.useMemo(()=>({width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"}),[n]);return r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[r.jsx(Nn,{onToggle:o}),r.jsxs("div",{className:"main-container",style:d,children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:h,children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),r.jsx(jn,{}),r.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:r.jsxs("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:[r.jsx("div",{className:"card shadow-sm mb-4",children:r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[r.jsx("i",{className:"bi bi-kanban text-primary me-2"})," "]}),r.jsx("span",{className:"text-muted",children:"   "})]}),r.jsxs("div",{className:"d-flex gap-2",children:[r.jsxs("button",{className:"btn btn-outline-primary",style:{height:"32px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px"},children:[r.jsx("i",{className:"bi bi-filter me-1"}),""]}),r.jsxs("button",{className:"btn btn-primary",onClick:l,style:{height:"32px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px"},children:[r.jsx("i",{className:"bi bi-plus-circle me-1"})," "]})]})]})})}),r.jsx("div",{className:"card shadow-sm",children:r.jsx("div",{className:"card-body p-0",children:r.jsx($R,{kanbanData:s,onMoveCard:c})})})]})})]}),!n&&t&&r.jsx(_n,{rtl:!0}),!n&&t&&r.jsx(En,{})]})]})}function n9(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(t9,{})})})}function s9(){const[n,e]=b.useState(!1),{isTimelineVisible:t}=gn(),[s,i]=b.useState([]),[a,o]=b.useState([]),[l,c]=b.useState(!1),[d,h]=b.useState(null),[f,p]=b.useState(""),[x,I]=b.useState([]),[D,A]=b.useState(!1),[g,N]=b.useState([]),[j,V]=b.useState(null),$=On(),{tenderId:Z}=li(),{logActivity:O,getCurrentUser:M}=$t(),{alertConfig:T,closeAlert:L,showSuccess:G,showError:U}=Kt(),k=()=>{e(!n)};b.useEffect(()=>{re();const _=K=>{K.type==="rawMaterialsUpdated"&&re()},C=()=>{re()};window.addEventListener("storage",_),window.addEventListener("rawMaterialsUpdated",C);const z=()=>{re()};return window.addEventListener("focus",z),()=>{window.removeEventListener("storage",_),window.removeEventListener("rawMaterialsUpdated",C),window.removeEventListener("focus",z)}},[]),b.useEffect(()=>{if(f.trim()){const _=s.filter(C=>{var z,K,F,Q;return((z=C.name)==null?void 0:z.toLowerCase().includes(f.toLowerCase()))||((K=C.category)==null?void 0:K.toLowerCase().includes(f.toLowerCase()))||((F=C.description)==null?void 0:F.toLowerCase().includes(f.toLowerCase()))||((Q=C.supplier)==null?void 0:Q.toLowerCase().includes(f.toLowerCase()))});I(_)}else I(s)},[f,s]);const re=async()=>{try{c(!0);const C=(await Os.getAllRawMaterials()).filter(z=>z.active!==!1);i(C),h(null)}catch(_){h(_.message)}finally{c(!1)}},xe=_=>{if(a.some(z=>z.internalId===_.internalId))o(z=>z.filter(K=>K.internalId!==_.internalId));else{const z={..._,type:"rawMaterials",quantity:1};o(K=>[...K,z])}},H=async()=>{if(a.length===0){U("      ","   ");return}const _=a.map(C=>{let z=C.price||0,K=C.supplier;if(C.priceQuotes&&Array.isArray(C.priceQuotes)&&C.priceQuotes.length>0){const F=C.priceQuotes.reduce((Q,oe)=>{const E=parseFloat(Q.price)||0;return(parseFloat(oe.price)||0)<E?oe:Q});z=parseFloat(F.price)||0,K=F.supplierName}return{...C,quantity:1,unitPrice:z,totalPrice:z,displaySupplier:K}});N(_),V(null),A(!0)},ee=(_,C)=>{const z=Math.max(0,parseFloat(C)||0);N(K=>K.map(F=>F.id===_?{...F,quantity:Number(z.toFixed(1)),totalPrice:F.unitPrice*Number(z.toFixed(1))}:F))},se=async()=>{console.log(" FUNCTION START: handleConfirmQuantities called");try{if(!Array.isArray(g)||g.length===0){console.log(" EARLY EXIT: No modal items to process"),U("    ","  ");return}console.log(" STEP 1: Starting duplicate check process..."),console.log(" Modal items to check:",g.map(E=>({name:E.name,internalId:E.internalId,id:E.id})));let _=await qe.getPendingTenderItems()||[];if(Z&&Z!=="new")try{console.log(" EDIT MODE: Loading existing tender items for duplicate check, tender ID:",Z);const{tenderServiceNew:E}=await ns(async()=>{const{tenderServiceNew:Te}=await Promise.resolve().then(()=>YN);return{tenderServiceNew:Te}},void 0),te=await E.getById(Z);te&&te.items&&Array.isArray(te.items)&&(console.log(" EDIT MODE: Found existing tender items:",te.items.length),_=[..._,...te.items])}catch(E){console.error(" Error loading existing tender items for duplicate check:",E)}console.log(" STEP 2: Retrieved existing items from storage:",{count:_.length,items:_.map(E=>({name:E.materialName||E.name,materialInternalId:E.materialInternalId,internalId:E.internalId,id:E.id}))});const C=_.map(E=>E.materialInternalId||E.internalId||E.id).filter(Boolean);console.log(" STEP 3: Extracted existing material IDs:",C);const z=[];for(const E of g){const te=[E.internalId,E.id,E.materialInternalId,E.materialId].filter(Boolean),Te=te.some(ze=>C.includes(ze));console.log(` STEP 4: Duplicate check for "${E.name}":`),console.log(`  - Possible IDs: [${te.join(", ")}]`),console.log(`  - Existing IDs: [${C.join(", ")}]`),console.log(`  - Is Duplicate: ${Te}`),Te&&(z.push(E.name),console.log(` DUPLICATE FOUND: "${E.name}" with IDs [${te.join(", ")}] matches existing items!`))}if(console.log(" STEP 5: Duplicate prevention analysis complete:",{totalModalItems:g.length,duplicatesFound:z.length,duplicateNames:z,existingIds:C}),z.length>0){console.log(" CRITICAL: DUPLICATE PREVENTION ACTIVATED "),console.log(" STEP 6: Execution will be FORCEFULLY STOPPED"),console.log(" Duplicate items blocking execution:",z),console.log(" Function will return immediately after showing warnings");const E=z.join(" ");U(`       :

${E}

      .

        .`," :  "),V(`  : ${E}`),console.log(" STEP 7: About to return and stop execution completely"),console.log(" If you see any code execution after this point, there is a bug!");return}console.log(" STEP 8: NO DUPLICATES DETECTED - Safe to proceed"),console.log(" Continuing with item creation process...");const K=g,F=[];for(const E of K)try{const te={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:E.internalId,materialType:"rawMaterial",materialName:E.name,materialCategory:E.category||"",materialUnit:E.unit||"",quantity:E.quantity||1,unitPrice:E.unitPrice||E.price||0,totalPrice:(E.quantity||1)*(E.unitPrice||E.price||0),supplierInfo:E.displaySupplier||E.supplier||"",tenderId:Z==="new"?"new":Z,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};F.push(te),console.log("Created tender item with ID relationship:",{tenderItemId:te.internalId,linkedMaterialId:te.materialInternalId,materialName:te.materialName,currentPrice:te.unitPrice,totalPrice:te.totalPrice})}catch(te){console.error("Error creating tender item for material:",E.name,te),U(`   : ${E.name}`,"  ");return}const Q=await qe.getPendingTenderItems()||[];let oe=[...F];if(Q.length>0)try{if(Array.isArray(Q)){const E=await XN.refreshTenderItemsPricing(Q);console.log(" SAFE MERGE: Our enhanced duplicate prevention handled conflicts, merging safely"),oe=[...E,...F],console.log(" SAFE MERGE completed:",{existingItemsCount:E.length,newItemsCount:F.length,finalItemsCount:oe.length,note:"No conflicts - duplicates were prevented above"})}}catch(E){console.error("Error parsing existing items:",E)}console.log("Storing ID-based tender items:",{totalItems:oe.length,newItems:F.length,items:oe.map(E=>({id:E.internalId,materialId:E.materialInternalId,name:E.materialName,price:E.unitPrice,total:E.totalPrice}))}),await qe.setPendingTenderItems(oe);try{const E=M();E&&E.name&&O("task",`${E.name}    `,`  ${F.length}     `)}catch(E){console.error("Failed to log activity:",E)}window.dispatchEvent(new CustomEvent("tenderItemsAdded",{detail:{count:F.length,type:"rawMaterial",items:F}})),G(`  ${F.length}      `," "),A(!1),N([]),V(null),setTimeout(()=>{$(Z==="new"?"/tenders/add":`/tenders/edit/${Z}`)},2e3)}catch(_){console.error("Error in handleConfirmQuantities:",_),U("      -   ","  ")}},Y=()=>{A(!1),N([]),V(null)},R=()=>Math.round(g.reduce((_,C)=>_+C.totalPrice,0));return l?r.jsx(an,{show:!0,message:"    ...",overlay:!1}):d?r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"text-danger mb-3",children:r.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),r.jsx("h5",{className:"text-danger",children:" "}),r.jsx("p",{className:"text-muted",children:d}),r.jsxs("button",{className:"btn btn-primary",onClick:re,children:[r.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[r.jsx(Nn,{onToggle:k}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),r.jsx(jn,{}),r.jsx("div",{className:"app-content-area p-3",children:r.jsx("div",{className:"raw-materials-table",children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"row align-items-center justify-content-between",children:[r.jsx("div",{className:"col-lg-4",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-gear text-danger me-2"}),"   (",x.length,")"]})}),r.jsx("div",{className:"col-lg-8",children:r.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[r.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[r.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:f,onChange:_=>p(_.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),r.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:r.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),r.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:H,disabled:a.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["  (",a.length,")"]}),r.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const _=Z!=="new"?`/tenders/edit/${Z}`:"/tenders/add";$(_)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:" "})]})})]})}),r.jsx("div",{className:"card-body p-0",children:x.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-gear fs-1"})}),r.jsx("h5",{className:"text-muted",children:"   "}),r.jsx("p",{className:"text-muted",children:f?"    ":"      "})]}):r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""})]})}),r.jsx("tbody",{children:x.map(_=>{let C=_.price,z=_.supplier,K=!1,F=null;return _.priceQuotes&&Array.isArray(_.priceQuotes)&&_.priceQuotes.length>0&&(K=!0,F=_.priceQuotes.reduce((Q,oe)=>{const E=parseFloat(Q.price)||0;return(parseFloat(oe.price)||0)<E?oe:Q}),C=F.price,z=F.supplierName),r.jsxs("tr",{children:[r.jsx("td",{className:"text-center",children:r.jsx("div",{className:"form-check d-flex justify-content-center",children:r.jsx("input",{className:"form-check-input",type:"checkbox",checked:a.some(Q=>Q.internalId===_.internalId),onChange:()=>xe(_),style:{transform:"scale(1.2)"}})})}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"fw-bold text-primary",children:_.name})}),r.jsx("td",{className:"text-center",children:_.category||"-"}),r.jsx("td",{className:"text-center",children:_.unit||"-"}),r.jsx("td",{className:"text-center",children:C?r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsxs("span",{children:[C," "]}),K&&r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),r.jsx("td",{className:"text-center",children:z?r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("span",{children:z}),K&&r.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:" "})]}):"-"})]},_.id)})})]})})})]})})}),r.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:r.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&t&&r.jsx(_n,{rtl:!0}),!n&&t&&r.jsx(En,{})]}),D&&r.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:r.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[r.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),r.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:Y,"aria-label":"Close"})]}),r.jsxs("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:[j&&r.jsxs("div",{className:"alert alert-warning alert-dismissible m-3 mb-2",role:"alert",style:{background:"linear-gradient(45deg, #fff3cd, #ffeaa7)",border:"2px solid #f39c12",borderRadius:"8px",boxShadow:"0 4px 12px rgba(243, 156, 18, 0.3)"},children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-exclamation-triangle-fill text-warning me-2",style:{fontSize:"20px"}}),r.jsxs("div",{className:"flex-grow-1",children:[r.jsx("strong",{children:":  !"}),r.jsx("div",{className:"mt-1 text-dark",children:j}),r.jsx("small",{className:"text-muted",children:"      "})]})]}),r.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>V(null)})]}),r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"30%"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),r.jsx("th",{className:"text-center",style:{width:"15%"},children:""}),r.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),r.jsx("tbody",{children:g.map((_,C)=>r.jsxs("tr",{style:{height:"60px"},children:[r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("i",{className:"bi bi-gear text-danger me-2"}),r.jsxs("div",{children:[r.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:z=>{z.preventDefault(),z.stopPropagation(),$(`/raw-materials/edit/${_.id}`)},title:`  : ${_.name}`,children:_.name}),r.jsx("small",{className:"text-muted",children:_.category})]})]})}),r.jsxs("td",{className:"text-center",children:[r.jsxs("span",{className:"fw-bold text-success",children:[Math.round(_.unitPrice)," "]}),r.jsx("div",{children:r.jsxs("small",{className:"text-muted",children:["/",_.unit||""]})})]}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>ee(_.id,Math.max(0,Number((_.quantity-.1).toFixed(1)))),disabled:_.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:r.jsx("i",{className:"bi bi-dash"})}),r.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:_.quantity,min:"0",step:"any",onChange:z=>ee(_.id,z.target.value),onBlur:z=>{const K=Number(z.target.value||0).toFixed(1);ee(_.id,K)}}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>ee(_.id,Number((_.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:r.jsx("i",{className:"bi bi-plus"})})]})}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"text-muted",children:_.displaySupplier||"-"})}),r.jsxs("td",{className:"text-center",children:[r.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(_.totalPrice)," "]}),r.jsxs("small",{className:"text-success",children:["(",_.quantity.toFixed(1),"  ",Math.round(_.unitPrice),")"]})]})]},_.id))})]})})]}),r.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:r.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("span",{className:"text-muted me-3",children:" :"}),r.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[R()," "]}),r.jsxs("span",{className:"badge bg-info ms-2",children:[g.reduce((_,C)=>_+C.quantity,0).toFixed(1)," "]})]}),r.jsxs("div",{className:"d-flex gap-2",children:[r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:Y,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),r.jsx("button",{type:"button",className:"btn btn-primary",onClick:se,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})]})})]})})}),r.jsx(Wt,{show:T.show,onClose:L,title:T.title,message:T.message,type:T.type,onConfirm:T.onConfirm,showConfirm:T.showConfirm})]})}function r9(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(s9,{})})})}function i9(){const[n,e]=b.useState(!1),{isTimelineVisible:t}=gn(),[s,i]=b.useState([]),[a,o]=b.useState([]),[l,c]=b.useState(!1),[d,h]=b.useState(null),[f,p]=b.useState(""),[x,I]=b.useState([]),[D,A]=b.useState(!1),[g,N]=b.useState([]),[j,V]=b.useState(null),$=On(),{tenderId:Z}=li(),{logActivity:O,getCurrentUser:M}=$t(),{alertConfig:T,closeAlert:L,showSuccess:G,showError:U}=Kt(),k=()=>{e(!n)};b.useEffect(()=>{re();const _=K=>{K.type==="localProductsUpdated"&&re()},C=()=>{re()};window.addEventListener("storage",_),window.addEventListener("localProductsUpdated",C);const z=()=>{re()};return window.addEventListener("focus",z),()=>{window.removeEventListener("storage",_),window.removeEventListener("localProductsUpdated",C),window.removeEventListener("focus",z)}},[]),b.useEffect(()=>{if(f.trim()){const _=s.filter(C=>{var z,K,F,Q;return((z=C.name)==null?void 0:z.toLowerCase().includes(f.toLowerCase()))||((K=C.category)==null?void 0:K.toLowerCase().includes(f.toLowerCase()))||((F=C.description)==null?void 0:F.toLowerCase().includes(f.toLowerCase()))||((Q=C.manufacturer)==null?void 0:Q.toLowerCase().includes(f.toLowerCase()))});I(_)}else I(s)},[f,s]);const re=async()=>{try{c(!0);const C=(await Ms.getAllLocalProducts()).filter(z=>z.active!==!1);i(C),h(null)}catch(_){h(_.message)}finally{c(!1)}},xe=_=>{if(a.some(z=>z.internalId===_.internalId))o(z=>z.filter(K=>K.internalId!==_.internalId));else{const z={..._,type:"localProducts",quantity:1};o(K=>[...K,z])}},H=async()=>{if(l){console.log(" PREVENTING DUPLICATE CLICK: Operation already in progress");return}if(a.length===0){U("      ","   ");return}c(!0);const _=await qe.getPendingTenderItems()||[];let C=[];if(_.length>0)try{Array.isArray(_)&&(C=_.map(Q=>Q.materialInternalId||Q.internalId||Q.id).filter(Boolean))}catch(Q){console.error("Error parsing existing items:",Q)}const z=[],K=a.filter(Q=>{const E=[Q.internalId,Q.id,Q.materialInternalId,Q.materialId].filter(Boolean).some(te=>C.includes(te));return E&&z.push(Q.name),!E});if(z.length>0){const Q=z.join(" ");if(U(`     : ${Q}`," "),K.length===0)return;console.log(`Found ${z.length} duplicate items, proceeding with ${K.length} unique items`)}const F=K.map(Q=>{let oe=Q.price||0,E=Q.manufacturer;if(Q.priceQuotes&&Array.isArray(Q.priceQuotes)&&Q.priceQuotes.length>0){const te=Q.priceQuotes.reduce((Te,ze)=>{const We=parseFloat(Te.price)||0;return(parseFloat(ze.price)||0)<We?ze:Te});oe=parseFloat(te.price)||0,E=te.supplierName}return{...Q,quantity:1,unitPrice:oe,totalPrice:oe,displaySupplier:E}});N(F),V(null),A(!0)},ee=(_,C)=>{const z=Math.max(0,parseFloat(C)||0);N(K=>K.map(F=>F.id===_?{...F,quantity:Number(z.toFixed(1)),totalPrice:F.unitPrice*Number(z.toFixed(1))}:F))},se=async()=>{try{if(!Array.isArray(g)||g.length===0){U("    ","  ");return}console.log(" STARTING DUPLICATE PREVENTION FOR LOCAL PRODUCTS...");let _=await qe.getPendingTenderItems()||[];if(Z&&Z!=="new")try{console.log(" EDIT MODE: Loading existing tender items for duplicate check, tender ID:",Z);const{tenderServiceNew:E}=await ns(async()=>{const{tenderServiceNew:Te}=await Promise.resolve().then(()=>YN);return{tenderServiceNew:Te}},void 0),te=await E.getById(Z);te&&te.items&&Array.isArray(te.items)&&(console.log(" EDIT MODE: Found existing tender items:",te.items.length),_=[..._,...te.items])}catch(E){console.error(" Error loading existing tender items for duplicate check:",E)}let C=[];if(_.length>0)try{Array.isArray(_)&&(C=_.map(E=>E.materialInternalId||E.internalId||E.id).filter(Boolean))}catch(E){console.error("Error parsing existing items:",E)}console.log(" Existing material IDs:",C),console.log(" Modal items to check:",g.map(E=>({name:E.name,internalId:E.internalId,id:E.id})));const z=[];for(const E of g){const te=[E.internalId,E.id,E.materialInternalId,E.materialId].filter(Boolean),Te=te.some(ze=>C.includes(ze));console.log(` DUPLICATE CHECK: "${E.name}":`),console.log(`  - Possible IDs: [${te.join(", ")}]`),console.log(`  - Existing IDs: [${C.join(", ")}]`),console.log(`  - Is Duplicate: ${Te}`),Te&&(z.push(E.name),console.log(` DUPLICATE FOUND: "${E.name}" with IDs [${te.join(", ")}] matches existing items!`))}if(console.log(" DUPLICATE PREVENTION RESULT:",{totalItems:g.length,duplicatesFound:z.length,duplicateNames:z}),z.length>0){const E=z.join(" ");console.log(" DUPLICATE PREVENTION ACTIVATED: Blocking duplicates:",E),U(`       :

${E}

      .

        .`," :  "),V(`  : ${E}`);return}console.log(" No duplicates found, proceeding with creation...");const K=g,F=[];for(const E of K)try{const te={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:E.internalId,materialType:"localProduct",materialName:E.name,materialCategory:E.category||"",materialUnit:E.unit||"",quantity:E.quantity||1,unitPrice:E.unitPrice||E.price||0,totalPrice:(E.quantity||1)*(E.unitPrice||E.price||0),supplierInfo:E.displaySupplier||E.supplier||"",tenderId:Z==="new"?"new":Z,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};F.push(te),console.log("Created tender item with ID relationship:",{tenderItemId:te.internalId,linkedProductId:te.materialInternalId,productName:te.materialName,currentPrice:te.unitPrice,totalPrice:te.totalPrice})}catch(te){console.error("Error creating tender item for product:",E.name,te),U(`   : ${E.name}`,"  ");return}const Q=await qe.getPendingTenderItems()||[];let oe=[...F];if(Q.length>0)try{if(Array.isArray(Q)){const E=await XN.refreshTenderItemsPricing(Q);console.log(" SAFE MERGE: Our enhanced duplicate prevention handled conflicts, merging safely"),oe=[...E,...F],console.log("Duplicate prevention results:",{existingItemsCount:E.length,newItemsCount:F.length,finalItemsCount:oe.length})}}catch(E){console.error("Error parsing existing items:",E)}console.log("Storing ID-based tender items:",{totalItems:oe.length,newItems:F.length,items:oe.map(E=>({id:E.internalId,materialId:E.materialInternalId,name:E.materialName,price:E.unitPrice,total:E.totalPrice}))}),await qe.setPendingTenderItems(oe);try{const E=M();E&&E.name&&O("task",`${E.name}    `,`  ${F.length}     `)}catch(E){console.error("Failed to log activity:",E)}G(`  ${F.length}      `," "),window.dispatchEvent(new CustomEvent("tenderItemsAdded",{detail:{count:F.length,type:"localProduct",items:F}})),A(!1),N([]),V(null),setTimeout(()=>{$(Z==="new"?"/tenders/add":`/tenders/edit/${Z}`)},2e3)}catch(_){console.error("Error in handleConfirmQuantities:",_),U("      -   ","  "),c(!1)}finally{setTimeout(()=>c(!1),2100)}},Y=()=>{A(!1),N([]),V(null)},R=()=>Math.round(g.reduce((_,C)=>_+C.totalPrice,0));return l?r.jsx(an,{show:!0,message:"    ...",overlay:!1}):d?r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"text-danger mb-3",children:r.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),r.jsx("h5",{className:"text-danger",children:" "}),r.jsx("p",{className:"text-muted",children:d}),r.jsxs("button",{className:"btn btn-primary",onClick:re,children:[r.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[r.jsx(Nn,{onToggle:k}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),r.jsx(jn,{}),r.jsx("div",{className:"app-content-area p-3",children:r.jsx("div",{className:"raw-materials-table",children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"row align-items-center justify-content-between",children:[r.jsx("div",{className:"col-lg-4",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-house text-success me-2"}),"   (",x.length,")"]})}),r.jsx("div",{className:"col-lg-8",children:r.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[r.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[r.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:f,onChange:_=>p(_.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),r.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:r.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),r.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:H,disabled:a.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["  (",a.length,")"]}),r.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const _=Z!=="new"?`/tenders/edit/${Z}`:"/tenders/add";$(_)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:" "})]})})]})}),r.jsx("div",{className:"card-body p-0",children:x.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-house fs-1"})}),r.jsx("h5",{className:"text-muted",children:"   "}),r.jsx("p",{className:"text-muted",children:f?"    ":"      "})]}):r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:" "})]})}),r.jsx("tbody",{children:x.map(_=>{let C=_.price,z=_.manufacturer,K=!1,F=null;return _.priceQuotes&&Array.isArray(_.priceQuotes)&&_.priceQuotes.length>0&&(K=!0,F=_.priceQuotes.reduce((Q,oe)=>{const E=parseFloat(Q.price)||0;return(parseFloat(oe.price)||0)<E?oe:Q}),C=F.price,z=F.supplierName),r.jsxs("tr",{children:[r.jsx("td",{className:"text-center",children:r.jsx("div",{className:"form-check d-flex justify-content-center",children:r.jsx("input",{className:"form-check-input",type:"checkbox",checked:a.some(Q=>Q.internalId===_.internalId),onChange:()=>xe(_),style:{transform:"scale(1.2)"}})})}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"fw-bold text-primary",children:_.name})}),r.jsx("td",{className:"text-center",children:_.category||"-"}),r.jsx("td",{className:"text-center",children:_.unit||"-"}),r.jsx("td",{className:"text-center",children:C?r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsxs("span",{children:[C," "]}),K&&r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),r.jsx("td",{className:"text-center",children:z?r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("span",{children:z}),K&&r.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:" "})]}):"-"})]},_.id)})})]})})})]})})}),r.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:r.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&t&&r.jsx(_n,{rtl:!0}),!n&&t&&r.jsx(En,{})]}),D&&r.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:r.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[r.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),r.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:Y,"aria-label":"Close"})]}),r.jsxs("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:[j&&r.jsxs("div",{className:"alert alert-warning alert-dismissible m-3 mb-2",role:"alert",style:{background:"linear-gradient(45deg, #fff3cd, #ffeaa7)",border:"2px solid #f39c12",borderRadius:"8px",boxShadow:"0 4px 12px rgba(243, 156, 18, 0.3)"},children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-exclamation-triangle-fill text-warning me-2",style:{fontSize:"20px"}}),r.jsxs("div",{className:"flex-grow-1",children:[r.jsx("strong",{children:":  !"}),r.jsx("div",{className:"mt-1 text-dark",children:j}),r.jsx("small",{className:"text-muted",children:"      "})]})]}),r.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>V(null)})]}),r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"30%"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),r.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),r.jsx("tbody",{children:g.map((_,C)=>r.jsxs("tr",{style:{height:"60px"},children:[r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("i",{className:"bi bi-house text-success me-2"}),r.jsxs("div",{children:[r.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:z=>{z.preventDefault(),z.stopPropagation(),$(`/local-products/edit/${_.id}`)},title:`  : ${_.name}`,children:_.name}),r.jsx("small",{className:"text-muted",children:_.category})]})]})}),r.jsxs("td",{className:"text-center",children:[r.jsxs("span",{className:"fw-bold text-success",children:[Math.round(_.unitPrice)," "]}),r.jsx("div",{children:r.jsxs("small",{className:"text-muted",children:["/",_.unit||""]})})]}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>ee(_.id,Math.max(0,Number((_.quantity-.1).toFixed(1)))),disabled:_.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:r.jsx("i",{className:"bi bi-dash"})}),r.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:_.quantity,min:"0",step:"any",onChange:z=>ee(_.id,z.target.value),onBlur:z=>{const K=Number(z.target.value||0).toFixed(1);ee(_.id,K)}}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>ee(_.id,Number((_.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:r.jsx("i",{className:"bi bi-plus"})})]})}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"text-muted",children:_.displaySupplier||"-"})}),r.jsxs("td",{className:"text-center",children:[r.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(_.totalPrice)," "]}),r.jsxs("small",{className:"text-success",children:["(",_.quantity.toFixed(1),"  ",Math.round(_.unitPrice),")"]})]})]},_.id))})]})})]}),r.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:r.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("span",{className:"text-muted me-3",children:" :"}),r.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[R()," "]}),r.jsxs("span",{className:"badge bg-info ms-2",children:[g.reduce((_,C)=>_+C.quantity,0).toFixed(1)," "]})]}),r.jsxs("div",{className:"d-flex gap-2",children:[r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:Y,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),r.jsx("button",{type:"button",className:"btn btn-primary",onClick:se,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})]})})]})})}),r.jsx(Wt,{show:T.show,onClose:L,title:T.title,message:T.message,type:T.type,onConfirm:T.onConfirm,showConfirm:T.showConfirm})]})}function a9(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(i9,{})})})}function o9(){const[n,e]=b.useState(!1),{isTimelineVisible:t}=gn(),[s,i]=b.useState([]),[a,o]=b.useState([]),[l,c]=b.useState(!1),[d,h]=b.useState(null),[f,p]=b.useState(""),[x,I]=b.useState([]),[D,A]=b.useState(!1),[g,N]=b.useState([]),[j,V]=b.useState(null),$=On(),{tenderId:Z}=li(),{logActivity:O,getCurrentUser:M}=$t(),{alertConfig:T,closeAlert:L,showSuccess:G,showError:U}=Kt(),k=()=>{e(!n)};b.useEffect(()=>{re();const _=K=>{K.type==="foreignProductsUpdated"&&re()},C=()=>{re()};window.addEventListener("storage",_),window.addEventListener("foreignProductsUpdated",C);const z=()=>{re()};return window.addEventListener("focus",z),()=>{window.removeEventListener("storage",_),window.removeEventListener("foreignProductsUpdated",C),window.removeEventListener("focus",z)}},[]),b.useEffect(()=>{if(f.trim()){const _=s.filter(C=>{var z,K,F,Q,oe;return((z=C.name)==null?void 0:z.toLowerCase().includes(f.toLowerCase()))||((K=C.category)==null?void 0:K.toLowerCase().includes(f.toLowerCase()))||((F=C.description)==null?void 0:F.toLowerCase().includes(f.toLowerCase()))||((Q=C.supplier)==null?void 0:Q.toLowerCase().includes(f.toLowerCase()))||((oe=C.countryOfOrigin)==null?void 0:oe.toLowerCase().includes(f.toLowerCase()))});I(_)}else I(s)},[f,s]);const re=async()=>{try{c(!0);const C=(await Ls.getAllForeignProducts()).filter(z=>z.active!==!1);i(C),h(null)}catch(_){h(_.message)}finally{c(!1)}},xe=_=>{if(a.some(z=>z.internalId===_.internalId))o(z=>z.filter(K=>K.internalId!==_.internalId));else{const z={..._,type:"foreignProduct",quantity:1};o(K=>[...K,z])}},H=async()=>{if(a.length===0){U("      ","   ");return}console.log(" FOREIGN PRODUCTS: Fetching existing items for duplicate check...");const _=await qe.getPendingTenderItems()||[];console.log(" FOREIGN PRODUCTS: Existing items found:",_.length);let C=[];_&&Array.isArray(_)&&(C=_.map(Q=>Q.materialInternalId),console.log(" FOREIGN PRODUCTS: Existing material IDs:",C));const z=[],K=a.filter(Q=>{const E=[Q.internalId,Q.id,Q.materialInternalId,Q.materialId].filter(Boolean).some(te=>C.includes(te));return E&&z.push(Q.name),!E});if(z.length>0){const Q=z.join(" ");if(U(`     : ${Q}`," "),K.length===0)return;console.log(`Found ${z.length} duplicate items, proceeding with ${K.length} unique items`)}const F=K.map(Q=>{let oe=Q.price||0,E=Q.supplier;if(Q.priceQuotes&&Array.isArray(Q.priceQuotes)&&Q.priceQuotes.length>0){const te=Q.priceQuotes.reduce((Te,ze)=>{const We=parseFloat(Te.price)||0;return(parseFloat(ze.price)||0)<We?ze:Te});oe=parseFloat(te.price)||0,E=te.supplierName}return{...Q,quantity:1,unitPrice:oe,totalPrice:oe,displaySupplier:E}});N(F),V(null),A(!0)},ee=(_,C)=>{const z=Math.max(0,parseFloat(C)||0);N(K=>K.map(F=>F.id===_?{...F,quantity:Number(z.toFixed(1)),totalPrice:F.unitPrice*Number(z.toFixed(1))}:F))},se=async()=>{try{if(!Array.isArray(g)||g.length===0){U("    ","  ");return}console.log(" STARTING DUPLICATE PREVENTION FOR FOREIGN PRODUCTS...");let _=await qe.getPendingTenderItems()||[];if(Z&&Z!=="new")try{console.log(" EDIT MODE: Loading existing tender items for duplicate check, tender ID:",Z);const{tenderServiceNew:E}=await ns(async()=>{const{tenderServiceNew:Te}=await Promise.resolve().then(()=>YN);return{tenderServiceNew:Te}},void 0),te=await E.getById(Z);te&&te.items&&Array.isArray(te.items)&&(console.log(" EDIT MODE: Found existing tender items:",te.items.length),_=[..._,...te.items])}catch(E){console.error(" Error loading existing tender items for duplicate check:",E)}let C=[];_&&Array.isArray(_)&&(C=_.map(E=>E.materialInternalId||E.internalId||E.id).filter(Boolean)),console.log(" Existing material IDs:",C),console.log(" Modal items to check:",g.map(E=>({name:E.name,internalId:E.internalId,id:E.id})));const z=[];for(const E of g){const te=[E.internalId,E.id,E.materialInternalId,E.materialId].filter(Boolean),Te=te.some(ze=>C.includes(ze));console.log(` DUPLICATE CHECK: "${E.name}":`),console.log(`  - Possible IDs: [${te.join(", ")}]`),console.log(`  - Existing IDs: [${C.join(", ")}]`),console.log(`  - Is Duplicate: ${Te}`),Te&&(z.push(E.name),console.log(` DUPLICATE FOUND: "${E.name}" with IDs [${te.join(", ")}] matches existing items!`))}if(console.log(" DUPLICATE PREVENTION RESULT:",{totalItems:g.length,duplicatesFound:z.length,duplicateNames:z}),z.length>0){const E=z.join(" ");console.log(" DUPLICATE PREVENTION ACTIVATED: Blocking duplicates:",E),U(`       :

${E}

      .

        .`," :  "),V(`  : ${E}`);return}console.log(" No duplicates found, proceeding with creation...");const K=g,F=[];for(const E of K)try{console.log(" Creating tender item directly:",E.name);const te={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:E.internalId,materialType:"foreignProduct",materialName:E.name,materialCategory:E.category||"",materialUnit:E.unit||"",quantity:E.quantity||1,unitPrice:E.unitPrice||E.price||0,totalPrice:(E.quantity||1)*(E.unitPrice||E.price||0),supplierInfo:E.displaySupplier||E.supplier||"",tenderId:Z==="new"?"new":Z,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};F.push(te),console.log(" Created tender item directly:",{internalId:te.internalId,materialName:te.materialName,quantity:te.quantity,unitPrice:te.unitPrice,totalPrice:te.totalPrice})}catch(te){console.error(" Error creating tender item for product:",E.name,te),U(`    "${E.name}": ${te.message||"  "}`,"  ");return}console.log(" MERGE PHASE: Fetching existing items for merge...");const Q=await qe.getPendingTenderItems()||[];console.log(" MERGE PHASE: Existing items fetched:",{count:Q.length,items:Q.map(E=>({id:E.materialInternalId,name:E.materialName,type:E.materialType}))});let oe=[...F];if(console.log(" MERGE PHASE: Starting with new items:",F.length),Q.length>0)try{if(Array.isArray(Q)){console.log(" MERGE PHASE: Refreshing pricing for existing items...");const E=await XN.refreshTenderItemsPricing(Q);console.log(" MERGE PHASE: Price refresh completed:",{originalCount:Q.length,refreshedCount:E.length,refreshedItems:E.map(te=>({id:te.materialInternalId,name:te.materialName,price:te.unitPrice}))}),console.log(" MERGE PHASE: Performing safe merge..."),console.log(" Before merge - Existing items:",E.length),console.log(" Before merge - New items:",F.length),oe=[...E,...F],console.log(" MERGE PHASE: Safe merge completed:",{existingItemsCount:E.length,newItemsCount:F.length,finalItemsCount:oe.length,finalItems:oe.map(te=>({id:te.materialInternalId,name:te.materialName,type:te.materialType}))})}}catch(E){console.error(" MERGE PHASE: Error in merge operation:",E)}else console.log(" MERGE PHASE: No existing items found, using only new items");console.log("Storing ID-based tender items:",{totalItems:oe.length,newItems:F.length,items:oe.map(E=>({id:E.internalId,materialId:E.materialInternalId,name:E.materialName,price:E.unitPrice,total:E.totalPrice}))}),await qe.setPendingTenderItems(oe),console.log(" STORAGE COMPLETE - Stored items to FirestorePendingDataService:",oe.length),setTimeout(async()=>{const E=await qe.getPendingTenderItems();console.log(" VERIFICATION: Items in storage after save:",{count:(E==null?void 0:E.length)||0,items:E})},100),console.log(" DISPATCHING CUSTOM EVENT: tenderItemsAdded"),window.dispatchEvent(new CustomEvent("tenderItemsAdded",{detail:{count:F.length,type:"foreignProduct",items:oe}}));try{const E=M();E&&E.name&&O("task",`${E.name}    `,`  ${F.length}     `)}catch(E){console.error("Failed to log activity:",E)}G(`  ${F.length}      `," "),A(!1),N([]),V(null),setTimeout(()=>{$(Z==="new"?"/tenders/add":`/tenders/edit/${Z}`)},2e3)}catch(_){console.error("Error in handleConfirmQuantities:",_),U("      -   ","  ")}},Y=()=>{A(!1),N([]),V(null)},R=()=>Math.round(g.reduce((_,C)=>_+C.totalPrice,0));return l?r.jsx(an,{show:!0,message:"    ...",overlay:!1}):d?r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"text-danger mb-3",children:r.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),r.jsx("h5",{className:"text-danger",children:" "}),r.jsx("p",{className:"text-muted",children:d}),r.jsxs("button",{className:"btn btn-primary",onClick:re,children:[r.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[r.jsx(Nn,{onToggle:k}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),r.jsx(jn,{}),r.jsx("div",{className:"app-content-area p-3",children:r.jsx("div",{className:"raw-materials-table",children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"row align-items-center justify-content-between",children:[r.jsx("div",{className:"col-lg-4",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-globe text-warning me-2"}),"   (",x.length,")"]})}),r.jsx("div",{className:"col-lg-8",children:r.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[r.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[r.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:f,onChange:_=>p(_.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),r.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:r.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),r.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:H,disabled:a.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["  (",a.length,")"]}),r.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const _=Z!=="new"?`/tenders/edit/${Z}`:"/tenders/add";$(_)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:" "})]})})]})}),r.jsx("div",{className:"card-body p-0",children:x.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-globe fs-1"})}),r.jsx("h5",{className:"text-muted",children:"   "}),r.jsx("p",{className:"text-muted",children:f?"    ":"      "})]}):r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:" "})]})}),r.jsx("tbody",{children:x.map(_=>{let C=_.price,z=_.supplier,K=!1,F=null;return _.priceQuotes&&Array.isArray(_.priceQuotes)&&_.priceQuotes.length>0&&(K=!0,F=_.priceQuotes.reduce((Q,oe)=>{const E=parseFloat(Q.price)||0;return(parseFloat(oe.price)||0)<E?oe:Q}),C=F.price,z=F.supplierName),r.jsxs("tr",{children:[r.jsx("td",{className:"text-center",children:r.jsx("div",{className:"form-check d-flex justify-content-center",children:r.jsx("input",{className:"form-check-input",type:"checkbox",checked:a.some(Q=>Q.internalId===_.internalId),onChange:()=>xe(_),style:{transform:"scale(1.2)"}})})}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"fw-bold text-primary",children:_.name})}),r.jsx("td",{className:"text-center",children:_.category||"-"}),r.jsx("td",{className:"text-center",children:_.unit||"-"}),r.jsx("td",{className:"text-center",children:C?r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsxs("span",{children:[C," "]}),K&&r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),r.jsx("td",{className:"text-center",children:z?r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("span",{children:z}),K&&r.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"badge bg-warning text-dark",children:_.countryOfOrigin||" "})})]},_.id)})})]})})})]})})}),r.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:r.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&t&&r.jsx(_n,{rtl:!0}),!n&&t&&r.jsx(En,{})]}),D&&r.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:r.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[r.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),r.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:Y,"aria-label":"Close"})]}),r.jsxs("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:[j&&r.jsxs("div",{className:"alert alert-warning alert-dismissible m-3 mb-2",role:"alert",style:{background:"linear-gradient(45deg, #fff3cd, #ffeaa7)",border:"2px solid #f39c12",borderRadius:"8px",boxShadow:"0 4px 12px rgba(243, 156, 18, 0.3)"},children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-exclamation-triangle-fill text-warning me-2",style:{fontSize:"20px"}}),r.jsxs("div",{className:"flex-grow-1",children:[r.jsx("strong",{children:":  !"}),r.jsx("div",{className:"mt-1 text-dark",children:j}),r.jsx("small",{className:"text-muted",children:"      "})]})]}),r.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>V(null)})]}),r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"30%"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),r.jsx("th",{className:"text-center",style:{width:"15%"},children:""}),r.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),r.jsx("tbody",{children:g.map((_,C)=>r.jsxs("tr",{style:{height:"60px"},children:[r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("i",{className:"bi bi-globe text-warning me-2"}),r.jsxs("div",{children:[r.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:z=>{z.preventDefault(),z.stopPropagation(),$(`/foreign-products/edit/${_.id}`)},title:`  : ${_.name}`,children:_.name}),r.jsx("small",{className:"text-muted",children:_.category}),r.jsx("div",{children:r.jsx("span",{className:"badge bg-warning text-dark",style:{fontSize:"10px"},children:_.countryOfOrigin||" "})})]})]})}),r.jsxs("td",{className:"text-center",children:[r.jsxs("span",{className:"fw-bold text-success",children:[Math.round(_.unitPrice)," "]}),r.jsx("div",{children:r.jsxs("small",{className:"text-muted",children:["/",_.unit||""]})})]}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>ee(_.id,Math.max(0,Number((_.quantity-.1).toFixed(1)))),disabled:_.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:r.jsx("i",{className:"bi bi-dash"})}),r.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:_.quantity,min:"0",step:"any",onChange:z=>ee(_.id,z.target.value),onBlur:z=>{const K=Number(z.target.value||0).toFixed(1);ee(_.id,K)}}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>ee(_.id,Number((_.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:r.jsx("i",{className:"bi bi-plus"})})]})}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"text-muted",children:_.displaySupplier||"-"})}),r.jsxs("td",{className:"text-center",children:[r.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(_.totalPrice)," "]}),r.jsxs("small",{className:"text-success",children:["(",_.quantity.toFixed(1),"  ",Math.round(_.unitPrice),")"]})]})]},_.id))})]})})]}),r.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:r.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("span",{className:"text-muted me-3",children:" :"}),r.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[R()," "]}),r.jsxs("span",{className:"badge bg-info ms-2",children:[g.reduce((_,C)=>_+C.quantity,0).toFixed(1)," "]})]}),r.jsxs("div",{className:"d-flex gap-2",children:[r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:Y,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),r.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{console.log(" CONFIRM BUTTON CLICKED! Modal items:",g),se()},style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})]})})]})})}),r.jsx(Wt,{show:T.show,onClose:L,title:T.title,message:T.message,type:T.type,onConfirm:T.onConfirm,showConfirm:T.showConfirm})]})}function l9(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(o9,{})})})}const c9=()=>{window.dispatchEvent(new CustomEvent("manufacturedProductsUpdated"))};class Ta{static async createManufacturedProduct(e){try{console.log(" Creating manufactured product:",e.title);const t=ct("MANUFACTURED_PRODUCT"),s={...e,internalId:t,createdAt:it(),updatedAt:it(),status:e.status||"active"},i=await Ys(Qe(pe,this.COLLECTION_NAME),s);return console.log(" Manufactured product created with ID:",i.id),{id:i.id,internalId:t,...s,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}catch(t){throw console.error(" Error creating manufactured product:",t),new Error(`    : ${t.message}`)}}static async getAllManufacturedProducts(){try{console.log(" Loading all manufactured products...");const e=pt(Qe(pe,this.COLLECTION_NAME),$n("createdAt","desc")),t=await lt(e),s=[];return t.forEach(i=>{var o,l,c,d,h,f;const a=i.data();s.push({id:i.id,internalId:a.internalId||ct("MANUFACTURED_PRODUCT"),...a,createdAt:((c=(l=(o=a.createdAt)==null?void 0:o.toDate)==null?void 0:l.call(o))==null?void 0:c.toISOString())||new Date().toISOString(),updatedAt:((f=(h=(d=a.updatedAt)==null?void 0:d.toDate)==null?void 0:h.call(d))==null?void 0:f.toISOString())||new Date().toISOString()})}),console.log(" Loaded manufactured products:",s.length),s}catch(e){throw console.error(" Error loading manufactured products:",e),new Error(`    : ${e.message}`)}}static async getManufacturedProductById(e){var t,s,i,a,o,l;try{console.log(" Loading manufactured product:",e);const c=Ye(pe,this.COLLECTION_NAME,e),d=await Un(c);if(!d.exists())throw new Error("   ");const h=d.data(),f={id:d.id,internalId:h.internalId||ct("MANUFACTURED_PRODUCT"),...h,createdAt:((i=(s=(t=h.createdAt)==null?void 0:t.toDate)==null?void 0:s.call(t))==null?void 0:i.toISOString())||new Date().toISOString(),updatedAt:((l=(o=(a=h.updatedAt)==null?void 0:a.toDate)==null?void 0:o.call(a))==null?void 0:l.toISOString())||new Date().toISOString()};return console.log(" Loaded manufactured product:",f.title),f}catch(c){throw console.error(" Error loading manufactured product:",c),new Error(`    : ${c.message}`)}}static async getManufacturedProductByInternalId(e){var t,s,i,a,o,l;try{console.log(" Loading manufactured product by internal ID:",e);const c=pt(Qe(pe,this.COLLECTION_NAME),qt("internalId","==",e)),d=await lt(c);if(d.empty)throw new Error(`   : ${e}`);const h=d.docs[0],f=h.data(),p={id:h.id,internalId:f.internalId||e,...f,createdAt:((i=(s=(t=f.createdAt)==null?void 0:t.toDate)==null?void 0:s.call(t))==null?void 0:i.toISOString())||new Date().toISOString(),updatedAt:((l=(o=(a=f.updatedAt)==null?void 0:a.toDate)==null?void 0:o.call(a))==null?void 0:l.toISOString())||new Date().toISOString()};if(p.items&&Array.isArray(p.items)&&p.items.length>0){const x=p.items.reduce((I,D)=>I+(D.totalPrice||0),0);p.price=x}else p.price=p.estimatedValue||0;return p.name=p.title,p.category=" ",p.unit="",p.supplier=" ",console.log(" Loaded manufactured product by internal ID:",p.title),p}catch(c){throw console.error(" Error loading manufactured product by internal ID:",c),new Error(`    : ${c.message}`)}}static async updateManufacturedProduct(e,t){try{console.log(" Updating manufactured product:",e);const s=Ye(pe,this.COLLECTION_NAME,e),i={...t,updatedAt:it()};return await gs(s,i),c9(),console.log(" Manufactured product updated successfully"),!0}catch(s){throw console.error(" Error updating manufactured product:",s),new Error(`    : ${s.message}`)}}static async deleteManufacturedProduct(e){try{console.log(" Deleting manufactured product:",e);const t=Ye(pe,this.COLLECTION_NAME,e);return await xs(t),console.log(" Manufactured product deleted successfully"),!0}catch(t){throw console.error(" Error deleting manufactured product:",t),new Error(`    : ${t.message}`)}}static async searchManufacturedProducts(e){try{console.log(" Searching manufactured products:",e);const t=await this.getAllManufacturedProducts();if(!e.trim())return t;const s=e.toLowerCase(),i=t.filter(a=>{var o,l,c,d,h;return((o=a.title)==null?void 0:o.toLowerCase().includes(s))||((l=a.referenceNumber)==null?void 0:l.toLowerCase().includes(s))||((c=a.description)==null?void 0:c.toLowerCase().includes(s))||((d=a.category)==null?void 0:d.toLowerCase().includes(s))||((h=a.entity)==null?void 0:h.toLowerCase().includes(s))});return console.log(" Search results:",i.length),i}catch(t){throw console.error(" Error searching manufactured products:",t),new Error(`     : ${t.message}`)}}static async getManufacturedProductsByStatus(e){try{console.log(" Loading manufactured products by status:",e);const t=pt(Qe(pe,this.COLLECTION_NAME),qt("status","==",e),$n("createdAt","desc")),s=await lt(t),i=[];return s.forEach(a=>{var l,c,d,h,f,p;const o=a.data();i.push({id:a.id,internalId:o.internalId||ct("MANUFACTURED_PRODUCT"),...o,createdAt:((d=(c=(l=o.createdAt)==null?void 0:l.toDate)==null?void 0:c.call(l))==null?void 0:d.toISOString())||new Date().toISOString(),updatedAt:((p=(f=(h=o.updatedAt)==null?void 0:h.toDate)==null?void 0:f.call(h))==null?void 0:p.toISOString())||new Date().toISOString()})}),console.log(" Loaded manufactured products by status:",i.length),i}catch(t){throw console.error(" Error loading manufactured products by status:",t),new Error(`    : ${t.message}`)}}static validateManufacturedProductData(e){const t={};return(!e.title||!e.title.trim())&&(t.title="  "),(!e.referenceNumber||!e.referenceNumber.trim())&&(t.referenceNumber="  "),(!e.entity||!e.entity.trim())&&(t.entity="  "),e.submissionDeadline||(t.submissionDeadline="   "),e.estimatedValue&&isNaN(parseFloat(e.estimatedValue))&&(t.estimatedValue="      "),t}}ur(Ta,"COLLECTION_NAME","manufacturedProducts");const BR=Object.freeze(Object.defineProperty({__proto__:null,ManufacturedProductService:Ta},Symbol.toStringTag,{value:"Module"}));function d9(){const[n,e]=b.useState(!1),{isTimelineVisible:t}=gn(),[s,i]=b.useState([]),[a,o]=b.useState([]),[l,c]=b.useState(!1),[d,h]=b.useState(null),[f,p]=b.useState(""),[x,I]=b.useState([]),[D,A]=b.useState(!1),[g,N]=b.useState([]),j=On(),{tenderId:V}=li(),{logActivity:$,getCurrentUser:Z}=$t(),{alertConfig:O,closeAlert:M,showSuccess:T,showError:L}=Kt(),{formatDate:G}=Pu(),U=()=>{e(!n)},k=(_,C)=>{console.log(" SENIOR REACT: Starting advanced duplicate prevention analysis...");const z=[],K=[],F=new Map,Q=new Map;return _.forEach((oe,E)=>{const te=oe.materialInternalId||oe.internalId||oe.id;te&&F.set(te,{item:oe,index:E});const Te=(oe.materialName||oe.name||oe.title||"").trim();if(Te){const ze=Te.toLowerCase();Q.set(ze,{item:oe,index:E})}}),console.log(" DUPLICATE PREVENTION MAPS:",{existingIdsCount:F.size,existingNamesCount:Q.size}),C.forEach(oe=>{const E=oe.materialInternalId||oe.internalId||oe.id,te=(oe.materialName||oe.name||oe.title||"").trim(),Te=te.toLowerCase();let ze=!1,We="",at=null;E&&F.has(E)&&(ze=!0,We="ID",at=F.get(E).item,console.log(` ID DUPLICATE: ${te} matches existing ID: ${E}`)),!ze&&te&&Q.has(Te)&&(ze=!0,We="NAME",at=Q.get(Te).item,console.log(` NAME DUPLICATE: "${te}" matches existing name (case-insensitive)`)),ze?z.push({newItem:oe,existingItem:at,type:We,displayName:te||"  "}):(K.push(oe),console.log(` UNIQUE ITEM: ${te} - Adding to list`),E&&F.set(E,{item:oe,index:-1}),te&&Q.set(Te,{item:oe,index:-1}))}),console.log(" DUPLICATE ANALYSIS COMPLETE:",{totalNewItems:C.length,uniqueItemsFound:K.length,duplicatesFound:z.length,duplicateDetails:z.map(oe=>({name:oe.displayName,type:oe.type}))}),{duplicates:z,uniqueItems:K}};b.useEffect(()=>{re();const _=C=>{C.type==="manufacturedProductsUpdated"&&re()};return window.addEventListener("storage",_),window.addEventListener("focus",re),()=>{window.removeEventListener("storage",_),window.removeEventListener("focus",re)}},[]),b.useEffect(()=>{if(f.trim()){const _=s.filter(C=>{var z,K,F;return((z=C.title)==null?void 0:z.toLowerCase().includes(f.toLowerCase()))||((K=C.referenceNumber)==null?void 0:K.toLowerCase().includes(f.toLowerCase()))||((F=C.description)==null?void 0:F.toLowerCase().includes(f.toLowerCase()))});I(_)}else I(s)},[f,s]);const re=async()=>{try{c(!0);const C=(await Ta.getAllManufacturedProducts()).filter(z=>z.status!=="inactive");i(C),h(null)}catch(_){h(_.message)}finally{c(!1)}},xe=_=>{if(a.some(z=>z.internalId===_.internalId))o(z=>z.filter(K=>K.internalId!==_.internalId));else{const z={..._,type:"manufacturedProduct",quantity:1};o(K=>[...K,z])}},H=async()=>{if(a.length===0){L("      ","   ");return}const _=a.map(C=>{let z=0;return C.items&&Array.isArray(C.items)&&C.items.length>0?z=C.items.reduce((K,F)=>K+(F.totalPrice||0),0):z=C.estimatedValue||0,{...C,quantity:1,unitPrice:z,totalPrice:z,displaySupplier:" "}});N(_),A(!0)},ee=(_,C)=>{const z=Math.max(0,parseFloat(C)||0);N(K=>K.map(F=>F.id===_?{...F,quantity:Number(z.toFixed(1)),totalPrice:F.unitPrice*Number(z.toFixed(1))}:F))},se=async()=>{try{if(!Array.isArray(g)||g.length===0){L("    ","  ");return}const _=await qe.getPendingTenderItems()||[],C=g.map(E=>({...E,materialName:E.title,materialInternalId:E.internalId})),z=k(_,C),{duplicates:K,uniqueItems:F}=z;if(K.length>0){const E=K.map(te=>{const Te=te.type==="ID"?" ":" ";return` "${te.displayName}" (${Te})`});L(`   ${K.length}  .     .

${E.join(`
`)}`," "),console.log(" DUPLICATES BLOCKED:",{count:K.length,names:K.map(te=>te.displayName)});return}const Q=[];for(const E of F)try{const te={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:E.internalId,materialType:"manufacturedProduct",materialName:E.title,materialCategory:" ",materialUnit:"",quantity:E.quantity||1,unitPrice:E.unitPrice||0,totalPrice:(E.quantity||1)*(E.unitPrice||0),supplierInfo:" ",tenderId:V==="new"?"new":V,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};Q.push(te)}catch(te){console.error("Error creating tender item:",te),L(`   : ${E.title}`,"  ");return}const oe=[..._,...Q];await qe.setPendingTenderItems(oe);try{const E=Z();E&&E.name&&$("task",`${E.name}    `,`  ${Q.length}  `)}catch(E){console.error("Failed to log activity:",E)}T(`  ${Q.length}   `," "),window.dispatchEvent(new CustomEvent("tenderItemsAdded",{detail:{count:Q.length,type:"manufacturedProduct",items:Q}})),A(!1),N([]),setTimeout(()=>{j(V==="new"?"/tenders/add":`/tenders/edit/${V}`)},100)}catch(_){console.error("Error in handleConfirmQuantities:",_),L("     ","  ")}},Y=()=>{A(!1),N([])},R=()=>Math.round(g.reduce((_,C)=>_+C.totalPrice,0));return l?r.jsx(an,{show:!0,message:"    ...",overlay:!1}):d?r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"text-danger mb-3",children:r.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),r.jsx("h5",{className:"text-danger",children:" "}),r.jsx("p",{className:"text-muted",children:d}),r.jsxs("button",{className:"btn btn-primary",onClick:re,children:[r.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[r.jsx(Nn,{onToggle:U}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),r.jsx(jn,{}),r.jsx("div",{className:"app-content-area p-3",children:r.jsx("div",{className:"manufactured-products-table",children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"row align-items-center justify-content-between",children:[r.jsx("div",{className:"col-lg-4",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-tools text-warning me-2"}),"   (",x.length,")"]})}),r.jsx("div",{className:"col-lg-8",children:r.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[r.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[r.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:f,onChange:_=>p(_.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),r.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:r.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),r.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:H,disabled:a.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["  (",a.length,")"]}),r.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const _=V!=="new"?`/tenders/edit/${V}`:"/tenders/add";j(_)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:" "})]})})]})}),r.jsx("div",{className:"card-body p-0",children:x.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-tools fs-1"})}),r.jsx("h5",{className:"text-muted",children:"   "}),r.jsx("p",{className:"text-muted",children:f?"    ":"      "})]}):r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:" "})]})}),r.jsx("tbody",{children:x.map(_=>{let C=0;return _.items&&Array.isArray(_.items)&&_.items.length>0?C=_.items.reduce((z,K)=>z+(K.totalPrice||0),0):C=_.estimatedValue||0,r.jsxs("tr",{children:[r.jsx("td",{className:"text-center",children:r.jsx("div",{className:"form-check d-flex justify-content-center",children:r.jsx("input",{className:"form-check-input",type:"checkbox",checked:a.some(z=>z.internalId===_.internalId),onChange:()=>xe(_),style:{transform:"scale(1.2)"}})})}),r.jsx("td",{className:"text-center",children:r.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:z=>{z.preventDefault(),z.stopPropagation(),j(`/manufactured-products/edit/${_.id}`)},title:`  : ${_.title}`,children:_.title})}),r.jsx("td",{className:"text-center",children:_.referenceNumber||"-"}),r.jsx("td",{className:"text-center",children:C?r.jsxs("span",{className:"badge bg-success text-white",children:[C.toLocaleString("en-US")," ."]}):"-"}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"text-muted",children:G(_.submissionDeadline)})})]},_.id)})})]})})})]})})}),r.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:r.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&t&&r.jsx(_n,{rtl:!0}),!n&&t&&r.jsx(En,{})]}),D&&r.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:r.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[r.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),r.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:Y,"aria-label":"Close"})]}),r.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"30%"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),r.jsx("th",{className:"text-center",style:{width:"15%"},children:""}),r.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),r.jsx("tbody",{children:g.map((_,C)=>r.jsxs("tr",{style:{height:"60px"},children:[r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("i",{className:"bi bi-tools text-warning me-2"}),r.jsxs("div",{children:[r.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:z=>{z.preventDefault(),z.stopPropagation(),j(`/manufactured-products/edit/${_.id}`)},title:`  : ${_.title}`,children:_.title}),r.jsx("small",{className:"text-muted",children:_.referenceNumber})]})]})}),r.jsxs("td",{className:"text-center",children:[r.jsxs("span",{className:"fw-bold text-success",children:[Math.round(_.unitPrice)," "]}),r.jsx("div",{children:r.jsx("small",{className:"text-muted",children:"/"})})]}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>ee(_.id,Math.max(0,Number((_.quantity-.1).toFixed(1)))),disabled:_.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:r.jsx("i",{className:"bi bi-dash"})}),r.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:_.quantity,min:"0",step:"any",onChange:z=>ee(_.id,z.target.value),onBlur:z=>{const K=Number(z.target.value||0).toFixed(1);ee(_.id,K)}}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>ee(_.id,Number((_.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:r.jsx("i",{className:"bi bi-plus"})})]})}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"badge bg-warning text-dark",children:" "})}),r.jsxs("td",{className:"text-center",children:[r.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(_.totalPrice)," "]}),r.jsxs("small",{className:"text-success",children:["(",_.quantity.toFixed(1),"  ",Math.round(_.unitPrice),")"]})]})]},_.id))})]})})}),r.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:r.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("span",{className:"text-muted me-3",children:" :"}),r.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[R()," "]}),r.jsxs("span",{className:"badge bg-info ms-2",children:[g.reduce((_,C)=>_+C.quantity,0).toFixed(1)," "]})]}),r.jsxs("div",{className:"d-flex gap-2",children:[r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:Y,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),r.jsx("button",{type:"button",className:"btn btn-primary",onClick:se,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})]})})]})})}),r.jsx(Wt,{show:O.show,onClose:M,title:O.title,message:O.message,type:O.type,onConfirm:O.onConfirm,showConfirm:O.showConfirm})]})}function u9(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(d9,{})})})}const kl="suppliers";class ri{static async getAllSuppliers(){try{const e=Qe(pe,kl);let t;try{t=pt(e,$n("createdAt","desc"))}catch{console.log("Using query without orderBy for empty collection"),t=pt(e)}const i=(await lt(t)).docs.map(a=>{var l,c;const o=a.data();return{id:a.id,internalId:o.internalId||ct("LOCAL_SUPPLIER"),...o,createdAt:(l=o.createdAt)==null?void 0:l.toDate(),updatedAt:(c=o.updatedAt)==null?void 0:c.toDate()}});return i.length>0&&i[0].createdAt&&i.sort((a,o)=>(o.createdAt||new Date(0))-(a.createdAt||new Date(0))),i}catch(e){if(console.error("Error fetching suppliers:",e),e.code==="failed-precondition"||e.code==="not-found")return console.log("Suppliers collection not found, returning empty array"),[];throw new Error("   ")}}static async createSupplier(e){try{const t=ct("LOCAL_SUPPLIER"),s={...e,internalId:t,createdAt:it(),updatedAt:it()};return(await Ys(Qe(pe,kl),s)).id}catch(t){throw console.error("Error creating supplier:",t),new Error("   ")}}static async updateSupplier(e,t){try{const s=Ye(pe,kl,e),i={...t,updatedAt:it()};return await gs(s,i),!0}catch(s){throw console.error("Error updating supplier:",s),new Error("    ")}}static async getSupplierById(e){var t,s;try{const i=Ye(pe,kl,e),a=await Un(i);if(a.exists()){const o=a.data();return{id:a.id,internalId:o.internalId||ct("LOCAL_SUPPLIER"),...o,createdAt:(t=o.createdAt)==null?void 0:t.toDate(),updatedAt:(s=o.updatedAt)==null?void 0:s.toDate()}}else return null}catch(i){throw console.error("Error fetching supplier by ID:",i),new Error("    ")}}static async getSupplierByInternalId(e){var t,s;try{const i=Qe(pe,kl),a=pt(i,qt("internalId","==",e)),o=await lt(a);if(o.empty)return null;{const l=o.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:(t=c.createdAt)==null?void 0:t.toDate(),updatedAt:(s=c.updatedAt)==null?void 0:s.toDate()}}}catch(i){throw console.error("Error fetching supplier by internal ID:",i),new Error("    ")}}static async updateSupplierByInternalId(e,t){try{const s=await this.getSupplierByInternalId(e);if(!s)throw new Error("Supplier not found");return await this.updateSupplier(s.id,t)}catch(s){throw console.error("Error updating supplier by internal ID:",s),new Error("    ")}}static async deleteSupplier(e){try{const t=Ye(pe,kl,e);return await xs(t),!0}catch(t){throw console.error("Error deleting supplier:",t),new Error("   ")}}static async deleteSupplierByInternalId(e){try{const t=await this.getSupplierByInternalId(e);if(!t)throw new Error("Supplier not found");return await this.deleteSupplier(t.id)}catch(t){throw console.error("Error deleting supplier by internal ID:",t),new Error("   ")}}static async searchSuppliers(e){try{const t=Qe(pe,kl);return(await lt(t)).docs.map(o=>{var c,d;const l=o.data();return{id:o.id,internalId:l.internalId||ct("LOCAL_SUPPLIER"),...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}}).filter(o=>{var l,c,d;return((l=o.name)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))||((c=o.email)==null?void 0:c.toLowerCase().includes(e.toLowerCase()))||((d=o.phone)==null?void 0:d.includes(e))})}catch(t){throw console.error("Error searching suppliers:",t),new Error("    ")}}static async migrateExistingData(){try{console.log("Starting local suppliers migration...");const e=await this.getAllSuppliers();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("ls_")){const i=ct("LOCAL_SUPPLIER");await this.updateSupplier(s.id,{...s,internalId:i}),t++,console.log(`Migrated local supplier: ${s.name} -> ${i}`)}return console.log(`Migration completed. ${t} local suppliers migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("   ")}}static validateSupplierData(e){var s,i,a;const t={};return(s=e.name)!=null&&s.trim()||(t.name="  "),(i=e.email)!=null&&i.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(t.email="    "):t.email="  ",(a=e.phone)!=null&&a.trim()||(t.phone="  "),t}}const h9=Object.freeze(Object.defineProperty({__proto__:null,SupplierService:ri},Symbol.toStringTag,{value:"Module"})),Di="foreignSuppliers";class ii{static async getAllForeignSuppliers(){return this.getAllSuppliers()}static async getAllSuppliers(){try{const e=Qe(pe,Di);let t;try{const i=pt(e,$n("createdAt","desc"));t=await lt(i,"getAllForeignSuppliers")}catch(i){console.log("OrderBy failed, using simple query:",i.message),t=await lt(e,"getAllForeignSuppliers-simple")}const s=t.docs.map(i=>{var o,l,c,d;const a=i.data();return{id:i.id,internalId:a.internalId||ct("FOREIGN_SUPPLIER"),...a,createdAt:((l=(o=a.createdAt)==null?void 0:o.toDate)==null?void 0:l.call(o))||new Date,updatedAt:((d=(c=a.updatedAt)==null?void 0:c.toDate)==null?void 0:d.call(c))||new Date}});return s.length>0&&s[0].createdAt&&s.sort((i,a)=>(a.createdAt||new Date(0))-(i.createdAt||new Date(0))),s}catch(e){if(console.error("Error fetching foreign suppliers:",e),e.code==="failed-precondition"||e.code==="not-found")return console.log("Foreign suppliers collection not found, returning empty array"),[];throw new Error("    : "+e.message)}}static async getSupplierById(e){var t,s,i,a;try{const o=await FR(Di,e);if(!o)throw new Error("Foreign supplier not found");return{...o,internalId:o.internalId||ct("FOREIGN_SUPPLIER"),createdAt:((s=(t=o.createdAt)==null?void 0:t.toDate)==null?void 0:s.call(t))||new Date,updatedAt:((a=(i=o.updatedAt)==null?void 0:i.toDate)==null?void 0:a.call(i))||new Date}}catch(o){throw console.error("Error fetching foreign supplier:",o),new Error("Failed to fetch foreign supplier: "+o.message)}}static async createSupplier(e){try{const t=this.validateSupplierData(e);if(Object.keys(t).length>0)throw new Error("Validation failed: "+Object.values(t).join(", "));const s=Qe(pe,Di),i=ct("FOREIGN_SUPPLIER"),a={...e,internalId:i,createdAt:it(),updatedAt:it(),status:e.status||"active"};return{id:await LR(Di,a),...a,createdAt:new Date,updatedAt:new Date}}catch(t){throw console.error("Error creating foreign supplier:",t),new Error("Failed to create foreign supplier: "+t.message)}}static async updateSupplier(e,t){try{const s=this.validateSupplierData(t);if(Object.keys(s).length>0)throw new Error("Validation failed: "+Object.values(s).join(", "));const i=Ye(pe,Di,e),a={...t,updatedAt:it()};return await gs(i,a,"updateForeignSupplier"),{id:e,...a,updatedAt:new Date}}catch(s){throw console.error("Error updating foreign supplier:",s),new Error("Failed to update foreign supplier: "+s.message)}}static async getSupplierByInternalId(e){var t,s,i,a;try{const o=Qe(pe,Di),l=pt(o,qt("internalId","==",e)),c=await lt(l,"getForeignSupplierByInternalId");if(c.empty)return null;{const d=c.docs[0],h=d.data();return{id:d.id,internalId:h.internalId,...h,createdAt:((s=(t=h.createdAt)==null?void 0:t.toDate)==null?void 0:s.call(t))||new Date,updatedAt:((a=(i=h.updatedAt)==null?void 0:i.toDate)==null?void 0:a.call(i))||new Date}}}catch(o){throw console.error("Error fetching foreign supplier by internal ID:",o),new Error("Failed to fetch foreign supplier by internal ID: "+o.message)}}static async updateSupplierByInternalId(e,t){try{const s=await this.getSupplierByInternalId(e);if(!s)throw new Error("Foreign supplier not found");return await this.updateSupplier(s.id,t)}catch(s){throw console.error("Error updating foreign supplier by internal ID:",s),new Error("Failed to update foreign supplier by internal ID: "+s.message)}}static async deleteSupplier(e){try{const t=Ye(pe,Di,e);return await xs(t,"deleteForeignSupplier"),{success:!0,message:"Foreign supplier deleted successfully"}}catch(t){throw console.error("Error deleting foreign supplier:",t),new Error("Failed to delete foreign supplier: "+t.message)}}static async deleteSupplierByInternalId(e){try{const t=await this.getSupplierByInternalId(e);if(!t)throw new Error("Foreign supplier not found");return await this.deleteSupplier(t.id)}catch(t){throw console.error("Error deleting foreign supplier by internal ID:",t),new Error("Failed to delete foreign supplier by internal ID: "+t.message)}}static async getSuppliersByStatus(e){try{const t=Qe(pe,Di),s=pt(t,qt("status","==",e),$n("createdAt","desc"));return(await lt(s,"getForeignSuppliersByStatus")).docs.map(a=>{var l,c,d,h;const o=a.data();return{id:a.id,internalId:o.internalId||ct("FOREIGN_SUPPLIER"),...o,createdAt:((c=(l=o.createdAt)==null?void 0:l.toDate)==null?void 0:c.call(l))||new Date,updatedAt:((h=(d=o.updatedAt)==null?void 0:d.toDate)==null?void 0:h.call(d))||new Date}})}catch(t){throw console.error("Error fetching foreign suppliers by status:",t),new Error("Failed to fetch foreign suppliers by status: "+t.message)}}static async searchSuppliers(e){try{const t=Qe(pe,Di),i=(await lt(t,"searchForeignSuppliers")).docs.map(o=>{var c,d,h,f;const l=o.data();return{id:o.id,internalId:l.internalId||ct("FOREIGN_SUPPLIER"),...l,createdAt:((d=(c=l.createdAt)==null?void 0:c.toDate)==null?void 0:d.call(c))||new Date,updatedAt:((f=(h=l.updatedAt)==null?void 0:h.toDate)==null?void 0:f.call(h))||new Date}});if(!e||e.trim()==="")return i;const a=e.toLowerCase();return i.filter(o=>{var l,c,d,h,f;return((l=o.name)==null?void 0:l.toLowerCase().includes(a))||((c=o.email)==null?void 0:c.toLowerCase().includes(a))||((d=o.phone)==null?void 0:d.includes(e))||((h=o.city)==null?void 0:h.toLowerCase().includes(a))||((f=o.address)==null?void 0:f.toLowerCase().includes(a))})}catch(t){throw console.error("Error searching foreign suppliers:",t),new Error("Failed to search foreign suppliers: "+t.message)}}static validateSupplierData(e){const t={};return(!e.name||e.name.trim()==="")&&(t.name="Company name is required"),!e.email||e.email.trim()===""?t.email="Email is required":this.validateEmail(e.email)||(t.email="Please enter a valid email address"),(!e.phone||e.phone.trim()==="")&&(t.phone="Phone number is required"),e.email&&!this.validateEmail(e.email)&&(t.email="Please enter a valid email address"),e.name&&e.name.length<2&&(t.name="Company name must be at least 2 characters long"),e.phone&&e.phone.length<10&&(t.phone="Phone number must be at least 10 digits long"),t}static validateEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static async uploadDocument(e,t,s="general"){try{if(!t)throw new Error("No file provided");const i=`${Date.now()}_${t.name}`,a=Ea(xr,`foreign-suppliers/${e}/documents/${s}/${i}`),o=await Zg(a,t),l=await rm(o.ref);return{fileName:t.name,url:l,type:s,uploadedAt:new Date,size:t.size}}catch(i){throw console.error("Error uploading document:",i),new Error("Failed to upload document: "+i.message)}}static async deleteDocument(e){try{const t=Ea(xr,e);return await ny(t),{success:!0,message:"Document deleted successfully"}}catch(t){throw console.error("Error deleting document:",t),new Error("Failed to delete document: "+t.message)}}static async migrateExistingData(){try{console.log("Starting foreign suppliers migration...");const e=await this.getAllSuppliers();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("fs_")){const i=ct("FOREIGN_SUPPLIER");await this.updateSupplier(s.id,{...s,internalId:i}),t++,console.log(`Migrated foreign supplier: ${s.name} -> ${i}`)}return console.log(`Migration completed. ${t} foreign suppliers migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("Failed to migrate foreign suppliers: "+e.message)}}static async getSupplierStats(){try{const e=Qe(pe,Di),s=(await lt(e,"getForeignSupplierStats")).docs.map(i=>i.data());return{total:s.length,active:s.filter(i=>i.status==="active").length,inactive:s.filter(i=>i.status==="inactive").length,pending:s.filter(i=>i.status==="pending").length,byCity:s.reduce((i,a)=>{const o=a.city||"Unknown";return i[o]=(i[o]||0)+1,i},{})}}catch(e){throw console.error("Error fetching foreign supplier stats:",e),new Error("Failed to fetch foreign supplier statistics: "+e.message)}}}const m9=Object.freeze(Object.defineProperty({__proto__:null,ForeignSupplierService:ii},Symbol.toStringTag,{value:"Module"})),f9=({refreshTrigger:n})=>{var fe,Ce;const[e,t]=b.useState([]),[s,i]=b.useState(!0),[a,o]=b.useState(null),[l,c]=b.useState(""),[d,h]=b.useState([]),[f,p]=b.useState(!1),[x,I]=b.useState(!1),[D,A]=b.useState(!1),[g,N]=b.useState(null),[j,V]=b.useState([]),[$,Z]=b.useState([]),[O,M]=b.useState([]),T=On(),L=Ga(),{logActivity:G,getCurrentUser:U}=$t(),{alertConfig:k,closeAlert:re,showSuccess:xe,showError:H,showConfirm:ee}=Kt(),se=((fe=L.state)==null?void 0:fe.fromTender)||!1,Y=((Ce=L.state)==null?void 0:Ce.tenderData)||null,{currentPage:R,totalPages:_,paginatedItems:C,handlePageChange:z,resetPage:K,totalItems:F,itemsPerPage:Q}=Ni(d,30);b.useEffect(()=>{oe(),E();const Ne=ot=>{ot.key==="rawMaterials_updated"&&oe()},He=()=>{oe()};window.addEventListener("storage",Ne),window.addEventListener("rawMaterialsUpdated",He);const Xe=()=>{oe()};return window.addEventListener("focus",Xe),()=>{window.removeEventListener("storage",Ne),window.removeEventListener("rawMaterialsUpdated",He),window.removeEventListener("focus",Xe)}},[]),b.useEffect(()=>{n&&oe()},[n]),b.useEffect(()=>{if(l.trim()){console.log("Searching for:",l),console.log("Total materials before filter:",e.length);const Ne=e.filter(He=>{var Xe,ot,Fe,gt;return((Xe=He.name)==null?void 0:Xe.toLowerCase().includes(l.toLowerCase()))||((ot=He.category)==null?void 0:ot.toLowerCase().includes(l.toLowerCase()))||((Fe=He.description)==null?void 0:Fe.toLowerCase().includes(l.toLowerCase()))||((gt=He.supplier)==null?void 0:gt.toLowerCase().includes(l.toLowerCase()))});console.log("Filtered materials:",Ne.length),console.log("First filtered material:",Ne[0]),h(Ne)}else console.log("No search term, showing all materials:",e.length),h(e);K()},[l,e,K]);const oe=async()=>{try{i(!0);const Ne=await Os.getAllRawMaterials();t(Ne),o(null)}catch(Ne){o(Ne.message)}finally{i(!1)}},E=async()=>{try{const[Ne,He]=await Promise.all([ri.getAllSuppliers(),ii.getAllSuppliers()]);V(Ne),Z(He)}catch(Ne){console.error("Error loading suppliers:",Ne)}},te=async(Ne,He)=>{try{if(He==="local"){const Xe=j.find(ot=>ot.name===Ne);Xe&&(N(Xe),I(!0))}else if(He==="foreign"){const Xe=$.find(ot=>ot.name===Ne);Xe&&(N(Xe),A(!0))}}catch(Xe){console.error("Error opening supplier modal:",Xe)}},Te=()=>{I(!1),A(!1),N(null)},ze=Ne=>{ee(`       

${Ne.name}`,()=>We(Ne),"   ")},We=async Ne=>{try{p(!0),await un.moveToTrash(Ne,"rawmaterials"),await Os.deleteRawMaterial(Ne.id);const He=U();G("task",`${He.name}   `,`   : ${Ne.name}`),await oe(),xe(`    : ${Ne.name}`,"  ")}catch(He){o(He.message),H(`     : ${He.message}`,"  ")}finally{p(!1)}},at=Ne=>{if(O.some(Xe=>Xe.internalId===Ne.internalId))M(Xe=>Xe.filter(ot=>ot.internalId!==Ne.internalId));else{const Xe={...Ne,type:"rawMaterials",quantity:1};M(ot=>[...ot,Xe])}},zt=async()=>{const Ne=O.map(Xe=>({internalId:Xe.internalId,type:"rawMaterials",quantity:Xe.quantity||1,addedAt:new Date().toISOString()}));await qe.setPendingTenderItems(Ne);const He=Y!=null&&Y.id?`/tenders/edit/${Y.id}`:"/tenders/add";T(He,{state:{selectedItems:Ne,fromSelection:!0}})};return s?r.jsx(an,{show:!0,message:"    ...",overlay:!1}):a?r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"text-danger mb-3",children:r.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),r.jsx("h5",{className:"text-danger",children:" "}),r.jsx("p",{className:"text-muted",children:a}),r.jsxs("button",{className:"btn btn-primary",onClick:oe,children:[r.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):r.jsxs("div",{className:"card shadow-sm","data-list":"raw-materials",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"row align-items-center justify-content-between",children:[r.jsx("div",{className:"col-lg-4",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),"   (",d.length,")"]})}),r.jsx("div",{className:"col-lg-8",children:r.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[r.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[r.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:l,onChange:Ne=>c(Ne.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),r.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:r.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),se?r.jsxs(r.Fragment,{children:[r.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:zt,disabled:O.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[r.jsx("i",{className:"bi bi-check-circle-fill me-2"}),"  (",O.length,")"]}),r.jsxs("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const Ne=Y!=null&&Y.id?`/tenders/edit/${Y.id}`:"/tenders/add";T(Ne)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[r.jsx("i",{className:"bi bi-arrow-left me-2"})," "]})]}):r.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:()=>T("/raw-materials/add"),style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[r.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"   "]})]})})]})}),r.jsxs("div",{className:"card-body p-0",children:[d.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-box-seam fs-1"})}),r.jsx("h5",{className:"text-muted",children:"   "}),r.jsx("p",{className:"text-muted",children:l?"    ":"      "}),!l&&r.jsxs("button",{className:"btn btn-primary",onClick:()=>T("/raw-materials/add"),children:[r.jsx("i",{className:"bi bi-plus-lg me-1"}),"   "]})]}):r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",style:{width:"120px"},children:""})]})}),r.jsx("tbody",{children:C.map((Ne,He)=>{let Xe=Ne.price,ot=Ne.supplier,Fe=!1,gt=null,Pt=null;return Ne.priceQuotes&&Array.isArray(Ne.priceQuotes)&&Ne.priceQuotes.length>0&&(Fe=!0,Pt=Ne.priceQuotes.reduce((Yt,Xt)=>{const Lt=parseFloat(Yt.price)||0;return(parseFloat(Xt.price)||0)<Lt?Xt:Yt}),Xe=Pt.price,ot=Pt.supplierName,gt=Pt.supplierType),r.jsxs("tr",{children:[r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(R-1)*Q+He+1})}),r.jsx("td",{className:"text-center",children:r.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary material-name-btn",onClick:Yt=>{if(Yt.preventDefault(),Yt.stopPropagation(),console.log("=== MATERIAL BUTTON CLICKED ==="),console.log("Material Name:",Ne.name),console.log("Material ID:",Ne.id),console.log("Material Object:",Ne),console.log("Navigate function:",typeof T),Ne.id){const Xt=`/raw-materials/edit/${Ne.id}`;console.log("Target URL:",Xt),console.log("Attempting navigation..."),console.log(" FORCING NAVIGATION TO:",Xt),console.log(" Method 1: Direct window.location"),window.location.href=Xt;try{console.log(" Method 2: React Router navigate"),T(Xt)}catch(Lt){console.log(" React Router failed:",Lt)}console.log(" NAVIGATION FORCED - Should redirect immediately!")}else console.error("Material ID is missing:",Ne),H("     ","  ");console.log("=== END CLICK HANDLER ===")},onMouseDown:Yt=>Yt.preventDefault(),style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0",userSelect:"none",pointerEvents:"auto",zIndex:"1"},title:`  | Internal ID: ${Ne.internalId||"Not Set"} | Firebase ID: ${Ne.id||"Missing"}`,children:Ne.name})}),r.jsx("td",{className:"text-center",children:Ne.category||"-"}),r.jsx("td",{className:"text-center",children:Ne.unit||"-"}),r.jsx("td",{className:"text-center",children:Xe?r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsxs("span",{children:[Xe," "]}),Fe&&r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),r.jsx("td",{className:"text-center",children:ot?r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[Fe&&gt?r.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",onClick:()=>te(ot,gt),style:{textDecoration:"none"},title:`  ${gt==="local"?" ":" "}`,children:ot}):r.jsx("span",{children:ot}),Fe&&r.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),r.jsx("td",{className:"text-center",children:se?r.jsx("div",{className:"form-check d-flex justify-content-center",children:r.jsx("input",{className:"form-check-input",type:"checkbox",checked:O.some(Yt=>Yt.internalId===Ne.internalId),onChange:()=>at(Ne),style:{transform:"scale(1.2)"}})}):r.jsxs("div",{className:"btn-group btn-group-sm",children:[r.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>T(`/raw-materials/edit/${Ne.id}`),title:"",children:r.jsx("i",{className:"bi bi-pencil"})}),r.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>ze(Ne),title:"",children:r.jsx("i",{className:"bi bi-trash"})})]})})]},Ne.internalId||Ne.id)})})]})}),d.length>0&&r.jsx(ji,{currentPage:R,totalPages:_,onPageChange:z,totalItems:F,itemsPerPage:Q})]}),x&&g&&r.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:Ne=>{Ne.target===Ne.currentTarget&&Te()},children:r.jsx("div",{className:"modal-dialog modal-lg",onClick:Ne=>Ne.stopPropagation(),children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[r.jsxs("div",{className:"modal-header border-0",children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"  - ",g.name,r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:""})]}),r.jsx("button",{type:"button",className:"btn-close",onClick:Te})]}),r.jsx("div",{className:"modal-body",children:r.jsxs("div",{className:"row g-3",children:[r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.name})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.email||""})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:g.phone||""})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.city||""})]}),r.jsxs("div",{className:"col-12",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.address||""})]}),g.taxNumber&&r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.taxNumber})]}),g.bankAccount&&r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:"  "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.bankAccount})]}),g.notes&&r.jsxs("div",{className:"col-12",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.notes})]})]})}),r.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:Te,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""})})]})})}),D&&g&&r.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:Ne=>{Ne.target===Ne.currentTarget&&Te()},children:r.jsx("div",{className:"modal-dialog modal-lg",onClick:Ne=>Ne.stopPropagation(),children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[r.jsxs("div",{className:"modal-header border-0",children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"  - ",g.name,r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:""})]}),r.jsx("button",{type:"button",className:"btn-close",onClick:Te})]}),r.jsx("div",{className:"modal-body",children:r.jsxs("div",{className:"row g-3",children:[r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.name})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.email||""})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:g.phone||""})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.country||""})]}),r.jsxs("div",{className:"col-12",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.address||""})]}),g.taxNumber&&r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.taxNumber})]}),g.bankAccount&&r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:"  "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.bankAccount})]}),g.notes&&r.jsxs("div",{className:"col-12",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.notes})]})]})}),r.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:Te,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""})})]})})}),r.jsx(Wt,{show:k.show,onClose:re,title:k.title,message:k.message,type:k.type,onConfirm:k.onConfirm,confirmText:k.confirmText,cancelText:k.cancelText,showCancel:k.showCancel})]})};function p9(){const[n,e]=b.useState(!1),[t,s]=b.useState(0),{isTimelineVisible:i}=gn(),a=()=>{e(!n)};return r.jsx(At,{children:r.jsx(Dt,{children:r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[r.jsx(Nn,{onToggle:a}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!i?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),r.jsx(jn,{}),r.jsx("div",{className:"app-content-area p-3",children:r.jsx("div",{className:"raw-materials-table",children:r.jsx(f9,{refreshTrigger:t})})}),r.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:r.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&i&&r.jsx(_n,{rtl:!0}),!n&&i&&r.jsx(En,{})]})})})}function g9(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(p9,{})})})}const x9={logo:()=>IR,logoSm:()=>TR,user:()=>CR,pdfIcon:()=>AR,menuArrow:()=>DR},ay=({size:n=32,clickable:e=!1,onClick:t=null,title:s="PDF",className:i="",style:a={}})=>{const o={width:`${n}px`,height:`${n}px`,objectFit:"contain",...e&&{cursor:"pointer"},...a},l=c=>{e&&t&&(c.preventDefault(),t(c))};return r.jsx("img",{src:x9.pdfIcon(),alt:"PDF",title:s,className:i,style:o,onClick:l})},oy=b.memo(({value:n="",onChange:e,onBlur:t,name:s="category",required:i=!1,disabled:a=!1,placeholder:o=" ",className:l="form-select",style:c={},showDescription:d=!1,"data-testid":h,...f})=>{const{categoriesWithDetails:p,loading:x,error:I,isReady:D}=S8(),A=b.useMemo(()=>D?p.map(g=>({value:g.value,label:g.label,description:g.description,isDefault:g.isDefault})):[],[p,D]);return x?r.jsx("select",{className:l,style:c,disabled:!0,...f,children:r.jsx("option",{value:"",children:"  ..."})}):I?r.jsxs("div",{children:[r.jsx("select",{className:`${l} is-invalid`,style:c,disabled:!0,...f,children:r.jsx("option",{value:"",children:"   "})}),r.jsx("div",{className:"invalid-feedback",children:I})]}):!D||A.length===0?r.jsxs("div",{children:[r.jsx("select",{className:l,style:c,disabled:!0,...f,children:r.jsx("option",{value:"",children:"   "})}),r.jsx("small",{className:"form-text text-muted",children:"     "})]}):r.jsxs("div",{children:[r.jsxs("select",{name:s,value:n,onChange:e,onBlur:t,required:i,disabled:a,className:l,style:c,"data-testid":h,"aria-label":" ",...f,children:[r.jsx("option",{value:"",children:o}),A.map(g=>r.jsx("option",{value:g.value,title:d&&g.description?g.description:void 0,children:g.label},g.value))]}),D&&r.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-1",children:[r.jsxs("small",{className:"form-text text-muted",children:[A.length,"  "]}),r.jsxs("small",{className:"form-text text-success",style:{fontSize:"10px"},children:[r.jsx("i",{className:"bi bi-wifi me-1"}),""]})]})]})});oy.displayName="GlobalCategorySelect";const ly=b.memo(({value:n="",onChange:e,onBlur:t,name:s="unit",required:i=!1,disabled:a=!1,placeholder:o=" ",className:l="form-select",style:c={},showDescription:d=!1,"data-testid":h,...f})=>{const{unitsWithDetails:p,loading:x,error:I,isReady:D}=I8(),A=b.useMemo(()=>D?p.map(g=>({value:g.name,label:g.name,description:g.description,isDefault:g.isDefault})):[],[p,D]);return x?r.jsx("select",{className:l,style:c,disabled:!0,...f,children:r.jsx("option",{value:"",children:"  ..."})}):I?r.jsxs("div",{children:[r.jsx("select",{className:`${l} is-invalid`,style:c,disabled:!0,...f,children:r.jsx("option",{value:"",children:"   "})}),r.jsx("div",{className:"invalid-feedback",children:I})]}):!D||A.length===0?r.jsxs("div",{children:[r.jsx("select",{className:l,style:c,disabled:!0,...f,children:r.jsx("option",{value:"",children:"   "})}),r.jsx("small",{className:"form-text text-muted",children:"     "})]}):r.jsxs("div",{children:[r.jsxs("select",{name:s,value:n,onChange:e,onBlur:t,required:i,disabled:a,className:l,style:c,"data-testid":h,"aria-label":" ",...f,children:[r.jsx("option",{value:"",children:o}),A.map(g=>r.jsx("option",{value:g.value,title:d&&g.description?g.description:void 0,children:g.label},g.value))]}),D&&r.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-1",children:[r.jsxs("small",{className:"form-text text-muted",children:[A.length,"  "]}),r.jsxs("small",{className:"form-text text-success",style:{fontSize:"10px"},children:[r.jsx("i",{className:"bi bi-wifi me-1"}),""]})]})]})});ly.displayName="GlobalUnitSelect";const cy=b.memo(({position:n="bottom-right",showDetails:e=!1,className:t="",style:s={}})=>{const{isReady:i,loading:a,lastUpdated:o}=If(),l=(a==null?void 0:a.categories)||(a==null?void 0:a.units)||!1,d=n?{"top-right":{position:"fixed",top:"80px",right:"20px",zIndex:1040},"bottom-right":{position:"fixed",bottom:"20px",right:"20px",zIndex:1040},"top-left":{position:"fixed",top:"80px",left:"20px",zIndex:1040},"bottom-left":{position:"fixed",bottom:"20px",left:"20px",zIndex:1040}}[n]:{},h=typeof i=="function"?i():i;return r.jsxs("div",{className:`badge ${h?"bg-success":l?"bg-warning":"bg-danger"} ${t}`,style:{...d,...s},children:[r.jsx("i",{className:`bi ${h?"bi-wifi":l?"bi-arrow-clockwise":"bi-wifi-off"} me-1`}),h?" ":l?" ...":" ",e&&(o==null?void 0:o.categories)&&r.jsxs("div",{className:"mt-1",style:{fontSize:"10px"},children:[" : ",new Date(o.categories).toLocaleTimeString("ar")]})]})});cy.displayName="SettingsSyncStatus";const y9=b.memo(({showSettingsLink:n=!0,showRefreshButton:e=!0,size:t="sm",className:s="d-flex gap-2",style:i={}})=>{const{forceRefresh:a,isReady:o}=If(),l=()=>{a&&a()};return r.jsxs("div",{className:s,style:i,children:[e&&r.jsx("button",{type:"button",className:`btn btn-outline-primary btn-${t}`,onClick:l,disabled:!(typeof o=="function"?o():o),title:" ",children:r.jsx("i",{className:"bi bi-arrow-clockwise"})}),n&&r.jsx("a",{href:"/settings",className:`btn btn-outline-secondary btn-${t}`,title:" ",children:r.jsx("i",{className:"bi bi-gear"})})]})});y9.displayName="SettingsQuickActions";const b9=b.memo(()=>{const{categories:n,units:e,loading:t,error:s,initialized:i,lastUpdated:a,isReady:o}=If();return null});b9.displayName="SettingsStatusPanel";function w9(){var In,qn,Hn;const[n,e]=b.useState(!1),{isTimelineVisible:t}=gn(),[s,i]=b.useState({name:"",category:"",description:"",unit:"",price:"",supplier:"",stockQuantity:"",minimumStock:"",storageConditions:"",expiryDate:"",batchNumber:"",origin:"",notes:"",active:!0}),[a,o]=b.useState({}),[l,c]=b.useState(!1),[d,h]=b.useState(!1),[f,p]=b.useState(!1),[x,I]=b.useState(!1),[D,A]=b.useState(null),[g,N]=b.useState(!1),[j,V]=b.useState(null),[$,Z]=b.useState({supplierType:"local",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),[O,M]=b.useState(null),[T,L]=b.useState([]),[G,U]=b.useState([]),[k,re]=b.useState([]),[xe,H]=b.useState(!1),{alertConfig:ee,closeAlert:se,showSuccess:Y,showError:R,showConfirm:_}=Kt(),C=w=>{if(w.length===0)return;const X=w.reduce((ne,W)=>{const ie=parseFloat(ne.price)||0;return(parseFloat(W.price)||0)<ie?W:ne});i(ne=>({...ne,price:X.price,supplier:X.supplierName}))},z=On(),{id:K}=li(),F=!!K,{logActivity:Q,getCurrentUser:oe}=$t();b.useMemo(()=>k.map(w=>({...w,formattedPrice:`${w.price} `,formattedDate:new Date(w.date).toLocaleDateString("ar-SA")})),[k]),b.useMemo(()=>k.length===0?null:k.reduce((w,X)=>{const ne=parseFloat(w.price)||0;return(parseFloat(X.price)||0)<ne?X:w}),[k]);const E=()=>{e(!n)};b.useEffect(()=>{F&&Te(),te();const w=()=>{F&&K&&(console.log("Window focused - refreshing raw material data..."),Te())};return window.addEventListener("focus",w),()=>{window.removeEventListener("focus",w)}},[K]),b.useEffect(()=>{var w;console.log("PriceQuoteData changed:",{hasFile:!!$.quotationFile,fileName:(w=$.quotationFile)==null?void 0:w.name,supplierName:$.supplierName,price:$.price})},[$]);const te=async()=>{try{const[w,X]=await Promise.all([ri.getAllSuppliers(),ii.getAllSuppliers()]);L(w),U(X)}catch(w){console.error("Error loading suppliers:",w)}},Te=async()=>{try{h(!0),console.log("Loading raw material data for ID:",K);const w=await Os.getAllRawMaterials(),X=w.find(ne=>ne.id===K);X?(console.log("Raw material found:",X.name),i({name:X.name||"",category:X.category||"",description:X.description||"",unit:X.unit||"",price:X.price||"",supplier:X.supplier||"",stockQuantity:X.stockQuantity||"",minimumStock:X.minimumStock||"",storageConditions:X.storageConditions||"",expiryDate:X.expiryDate||"",batchNumber:X.batchNumber||"",origin:X.origin||"",notes:X.notes||"",active:X.active!==void 0?X.active:!0}),X.priceQuotes&&Array.isArray(X.priceQuotes)?(console.log("Loading price quotes for raw material:",X.name,X.priceQuotes),console.log("Price quotes analysis:"),X.priceQuotes.forEach((ne,W)=>{console.log(`Quote ${W}:`,{id:ne.id,supplierName:ne.supplierName,price:ne.price,hasId:!!ne.id,keys:Object.keys(ne)})}),re(X.priceQuotes),setTimeout(()=>{C(X.priceQuotes)},200)):console.log("No price quotes found for raw material:",X.name)):(console.error("Raw material not found with ID:",K),console.log("Available raw materials:",w.map(ne=>({id:ne.id,name:ne.name}))),o({submit:"      "}))}catch(w){console.error("Error loading raw material:",w),o({submit:"     : "+w.message})}finally{h(!1)}},ze=w=>{const{name:X,value:ne,type:W,checked:ie}=w.target;i(Ee=>({...Ee,[X]:W==="checkbox"?ie:ne})),a[X]&&o(Ee=>({...Ee,[X]:""}))},We=async w=>{w.preventDefault();const X=Os.validateRawMaterialData(s);if(k.length===0&&(X.priceQuotes="      "),Object.keys(X).length>0){o(X);return}c(!0),o({});try{const ne=await _i.validateUniqueFields({name:s.name},F?K:null,F?"rawmaterials":null);if(Object.keys(ne).length>0){o(ne),c(!1);return}const W={...s,price:parseFloat(s.price)||0,stockQuantity:parseFloat(s.stockQuantity)||0,minimumStock:parseFloat(s.minimumStock)||0,priceQuotes:k,status:"active"};if(console.log("Saving raw material with price quotes:",{name:W.name,priceQuotes:W.priceQuotes,priceQuotesCount:W.priceQuotes.length}),F){await Os.updateRawMaterial(K,W);const ie=oe();Q("task",`${ie.name}   `,`   : ${W.name}`)}else{await Os.createRawMaterial(W);const ie=oe();Q("task",`${ie.name}   `,`   : ${W.name}`)}z("/raw-materials")}catch(ne){o({submit:ne.message})}finally{c(!1)}},at=()=>{z("/raw-materials")},zt=()=>{p(!0)},fe=()=>{p(!1),M(null),Z({supplierType:"local",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),o(w=>({...w,fileUpload:""})),console.log("Modal closed and state reset")},Ce=()=>{I(!0)},Ne=()=>{I(!1),A(null)},He=b.useCallback((w,X)=>{try{let ne=null,W=[];if(X==="local")W=T,ne=W.find(ie=>ie.name===w);else if(X==="foreign")W=G,ne=W.find(ie=>ie.name===w);else{console.error("Invalid supplier type:",X),R(`   : ${X}`,"");return}if(ne){console.log("SUCCESS: Supplier found:",ne.name),console.log("Supplier data:",ne);const ie={...ne,supplierType:X};console.log("Setting supplier to edit:",ie),V(ie),N(!0),console.log("Modal state should be true now")}else W.length===0?(loadSuppliersData(),R("   .   ...","  ")):R(`    : ${w}`,"  ")}catch(ne){R(`    : ${ne.message}`,"  ")}},[T,G,R]),Xe=()=>{N(!1),V(null)},ot=w=>{A(w)},Fe=()=>{D&&Z(w=>{var ne,W;console.log("Before supplier selection - preserving file:",(ne=w.quotationFile)==null?void 0:ne.name);const X={...w,supplier:D.id,supplierName:D.name};return console.log("After supplier selection - file preserved:",(W=X.quotationFile)==null?void 0:W.name),X}),I(!1),A(null)},gt=w=>{console.log("File details:",{name:w==null?void 0:w.name,size:w==null?void 0:w.size,type:w==null?void 0:w.type,lastModified:w==null?void 0:w.lastModified}),a.fileUpload&&o(X=>({...X,fileUpload:""})),Z(X=>{var W;const ne={...X,quotationFile:w};return console.log("Updated priceQuoteData with file:",{hasFile:!!ne.quotationFile,fileName:(W=ne.quotationFile)==null?void 0:W.name}),ne})},Pt=w=>{const{name:X,value:ne,type:W}=w.target;W!=="file"&&Z(X==="supplierType"?ie=>({...ie,[X]:ne,supplier:"",supplierName:""}):ie=>({...ie,[X]:ne}))},Yt=async w=>{if(w.preventDefault(),console.log("Form element:",w.target),console.log("Current priceQuoteData:",$),console.log("Editing quote ID:",O),!$.supplierName){o(ie=>({...ie,fileUpload:"   "}));return}if(!$.date){o(ie=>({...ie,fileUpload:"   "}));return}if(!$.price){o(ie=>({...ie,fileUpload:"  "}));return}const X=new FormData(w.target),ne=X.get("quotationFile");console.log("File from form directly:",ne),console.log("File from state:",$.quotationFile);const W=$.quotationFile||ne;console.log("File to upload:",W),console.log("File upload details:",{exists:!!W,isFile:W instanceof File,name:W==null?void 0:W.name,size:W==null?void 0:W.size,type:W==null?void 0:W.type,lastModified:W==null?void 0:W.lastModified});try{if(c(!0),!O&&(!W||W.size===0))throw new Error("    ");let ie=null;if(console.log("File upload analysis:",{hasFileInState:!!$.quotationFile,hasFileInForm:!!ne,hasFileToUpload:!!W,fileType:typeof W,fileName:W==null?void 0:W.name,fileSize:W==null?void 0:W.size}),W&&typeof W!="string"&&W.size>0){console.log("Starting file upload:",W.name);try{zs.validateFile(W,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}),console.log("File validation passed")}catch(Ee){throw console.error("File validation failed:",Ee),new Error(Ee.message)}console.log("Attempting file upload to Firebase...");try{const Ee=W.name.split(".").pop()||"pdf",le=$.supplierName?`  ${$.supplierName}.${Ee}`:W.name;console.log("Uploading with custom name:",le),ie=await zs.uploadFileWithCustomName(W,"quotations",le),console.log("File uploaded successfully:",ie)}catch(Ee){throw console.error("Firebase upload failed:",Ee),new Error(`   : ${Ee.message}`)}}else console.log("No valid file to upload:",{fileExists:!!W,isString:typeof W=="string",hasSize:(W==null?void 0:W.size)>0});if(O)console.log("Updating existing price quote with ID:",O),re(Ee=>{const le=Ee.map(ge=>ge.id===O?{...ge,supplierType:$.supplierType,supplier:$.supplier,supplierName:$.supplierName,date:$.date,price:$.price,quotationFile:ie?ie.path:ge.quotationFile,quotationFileURL:ie?ie.url:ge.quotationFileURL,quotationFileName:ie?ie.originalName:ge.quotationFileName,quotationFileSize:ie?ie.size:ge.quotationFileSize,quotationFileType:ie?ie.type:ge.quotationFileType,updatedAt:new Date}:ge);return console.log("Updated price quotes:",le),setTimeout(()=>{C(le)},100),le});else{const Ee={id:Date.now().toString(),supplierType:$.supplierType,supplier:$.supplier,supplierName:$.supplierName,date:$.date,price:$.price,quotationFile:ie?ie.path:null,quotationFileURL:ie?ie.url:null,quotationFileName:ie?ie.originalName:null,quotationFileSize:ie?ie.size:null,quotationFileType:ie?ie.type:null,createdAt:new Date};console.log("Adding new price quote:",Ee),re(le=>{const ge=[...le,Ee];return console.log("Updated price quotes:",ge),setTimeout(()=>{C(ge)},100),ge})}a.priceQuotes&&o(Ee=>({...Ee,priceQuotes:""})),fe(),F&&K&&setTimeout(async()=>{try{console.log("Auto-saving raw material after price quote change..."),re(Ee=>{const le={...X,priceQuotes:Ee};return Os.updateRawMaterial(K,le).then(()=>{console.log("Auto-save successful")}).catch(ge=>{console.error("Auto-save failed:",ge),R("   ","  ")}),Ee})}catch(Ee){console.error("Auto-save setup error:",Ee)}},200)}catch(ie){console.error("Error uploading file:",ie),o(Ee=>({...Ee,fileUpload:ie.message||"   .   ."}))}finally{c(!1)}},Xt=w=>{console.log("Starting edit for quote:",w),M(w.id),Z({supplierType:w.supplierType||"local",supplier:w.supplier||"",supplierName:w.supplierName||"",date:w.date||"",price:w.price||"",quotationFile:w.quotationFile||null}),p(!0)},Lt=w=>{if(console.log("Price quote delete button clicked:",w),console.log("Quote ID:",w==null?void 0:w.id),console.log("Quote keys:",w?Object.keys(w):"quote is null/undefined"),!w||!w.id){console.error("Invalid quote object - missing quote or ID:",{quote:w,hasId:!!(w!=null&&w.id),quoteId:w==null?void 0:w.id,quoteType:typeof w}),R("    ","");return}_(`      

${w.supplierName} - ${w.price} `,()=>on(w),"   ")},on=async w=>{if(console.log("Delete confirmation called for quote:",w),console.log("Confirmation - Quote ID:",w==null?void 0:w.id),console.log("Confirmation - Quote keys:",w?Object.keys(w):"quote is null/undefined"),console.log("Is editing mode:",F),console.log("Raw material ID:",K),console.log("Form data name:",s.name),!w||!w.id){console.error("Invalid quote in confirmation - missing quote or ID:",{quote:w,hasId:!!(w!=null&&w.id),quoteId:w==null?void 0:w.id,quoteType:typeof w}),R("    ",""),H(!1);return}try{if(H(!0),console.log("Starting delete process..."),console.log("Moving to trash..."),F&&K){const ne={...w,rawMaterialId:K,rawMaterialName:s.name};console.log("Quote with context for trash:",ne),console.log("Calling SimpleTrashService.moveToTrash...");const W=await un.moveToTrash(ne,"price_quotes");console.log("Trash service result:",W),console.log("Moved to trash successfully")}else console.log("Skipping trash - raw material not saved yet (isEditing:",F,", id:",K,")");const X=oe();console.log("Logging activity with current user:",X),Q("task",`${X.name}   `,`   : ${w.supplierName} - ${w.price} `),console.log("Updating local state..."),console.log("Current price quotes before deletion:",k),re(ne=>{const W=ne.filter(ie=>ie.id!==w.id);return console.log("Filtered quotes:",W.length,"from",ne.length),console.log("Removed quote with ID:",w.id),console.log("Remaining quotes:",W.map(ie=>({id:ie.id,supplierName:ie.supplierName}))),setTimeout(()=>{C(W)},100),W}),console.log("Showing success message..."),F&&K?Y(`    : ${w.supplierName}`,"  "):Y(`   : ${w.supplierName}`," "),console.log("Delete process completed successfully"),F&&K&&setTimeout(async()=>{try{console.log("Auto-saving raw material after price quote deletion..."),re(ne=>{const W={...s,priceQuotes:ne};return Os.updateRawMaterial(K,W).then(()=>{console.log("Auto-save after deletion successful")}).catch(ie=>{console.error("Auto-save after deletion failed:",ie)}),ne})}catch(ne){console.error("Auto-save after deletion setup error:",ne)}},200)}catch(X){console.error("Error deleting price quote:",X),console.error("Error stack:",X.stack),R(`    : ${X.message||"  "}`,"  ")}finally{console.log("Setting deleting to false"),H(!1)}},Bn=()=>($.supplierType==="local"?T:G).filter(ne=>{const W=ne.hasOwnProperty("active"),ie=ne.hasOwnProperty("status");return W?ne.active===!0:ie?ne.status==="active":!0});return d?r.jsx(an,{show:!0,message:"    ..."}):r.jsxs(Dt,{children:[r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[r.jsx(Nn,{onToggle:E}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsxs("div",{style:{position:"sticky",top:0,zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item",children:r.jsx("a",{href:"/raw-materials",className:"text-decoration-none text-primary",children:" "})}),r.jsx("li",{className:"breadcrumb-item",children:r.jsx("a",{href:"/raw-materials",className:"text-decoration-none text-primary",children:" "})}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:F?"  ":"   "})]})}),r.jsx(jn,{})]}),r.jsxs("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:[r.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"60px"},children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsxs("div",{className:"card-header bg-white border-bottom py-4 d-flex align-items-center",children:[r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),F?"  ":"   "]}),r.jsx("div",{style:{flex:1}}),r.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:zt,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:"1",paddingTop:"2px"},children:" "})]}),r.jsxs("form",{onSubmit:We,children:[r.jsxs("div",{className:"card-body p-4",children:[a.submit&&r.jsxs("div",{className:"alert alert-danger",children:[r.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.submit]}),r.jsxs("div",{className:"row mb-4",children:[r.jsx("div",{className:"col-12",children:r.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[r.jsx("i",{className:"bi bi-info-circle me-2"})," "]})}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:"   *"}),r.jsx("input",{type:"text",className:`form-control ${a.name?"is-invalid":""}`,name:"name",value:s.name,onChange:ze,placeholder:"   "}),a.name&&r.jsx("div",{className:"invalid-feedback",children:a.name})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:" *"}),r.jsx(oy,{name:"category",value:s.category,onChange:ze,required:!0,className:`form-select ${a.category?"is-invalid":""}`,placeholder:" ",showDescription:!0}),a.category&&r.jsx("div",{className:"invalid-feedback",children:a.category})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:" *"}),r.jsx(ly,{name:"unit",value:s.unit,onChange:ze,required:!0,className:`form-select ${a.unit?"is-invalid":""}`,placeholder:" ",showDescription:!0}),a.unit&&r.jsx("div",{className:"invalid-feedback",children:a.unit})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsxs("label",{className:"form-label fw-bold",children:[" () *",r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:k.length>0?"  ":" "})]}),r.jsx("input",{type:"number",step:"0.01",min:"0",className:`form-control ${a.price?"is-invalid":""}`,name:"price",value:s.price,onChange:null,onKeyPress:null,placeholder:"0.00",readOnly:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"}}),a.price&&r.jsx("div",{className:"invalid-feedback",children:a.price}),r.jsx("div",{className:"mt-1",children:r.jsxs("small",{className:"text-muted",children:[r.jsx("i",{className:"bi bi-info-circle me-1"}),k.length>0?"        ":"       "]})})]}),r.jsxs("div",{className:"col-md-12 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:""}),r.jsx("textarea",{className:"form-control",name:"description",value:s.description,onChange:ze,rows:"3",placeholder:"  "})]}),r.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:r.jsxs("div",{className:"d-flex align-items-center gap-2",children:[r.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"":" "}),r.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"rawMaterialActiveSwitch",name:"active",checked:s.active,onChange:ze,style:{width:"48px",height:"24px",marginRight:"8px"}})]})})]}),r.jsxs("div",{className:"row mb-4",children:[r.jsxs("div",{className:"col-12",children:[r.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[r.jsx("i",{className:"bi bi-receipt me-2"})," "]}),a.priceQuotes&&r.jsxs("div",{className:"alert alert-danger",children:[r.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.priceQuotes]})]}),k.length>0&&r.jsx("div",{className:"col-12",children:r.jsxs("div",{className:"card mb-3 border-0 shadow-lg",style:{background:"linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%)",borderRadius:"16px"},children:[r.jsx("div",{className:"card-header border-0",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"16px 16px 0 0",padding:"20px"},children:r.jsxs("h5",{className:"card-title text-white mb-0 d-flex align-items-center",children:[r.jsx("div",{className:"me-3",style:{background:"rgba(255,255,255,0.2)",borderRadius:"12px",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsx("i",{className:"bi bi-bar-chart-fill fs-5"})}),r.jsx("span",{className:"fw-bold",children:"  "}),r.jsxs("span",{className:"badge bg-light text-primary ms-3",style:{borderRadius:"20px",fontSize:"12px",padding:"6px 12px"},children:[k.length," "]})]})}),r.jsx("div",{className:"card-body",style:{padding:"30px"},children:r.jsx("div",{style:{minHeight:"625px",direction:"ltr"},children:r.jsx("div",{style:{width:"100%",height:"605px",position:"relative"},children:(()=>{k.map(Ee=>parseFloat(Ee.price)||0);const w=640,W=k.length*150,ie=Math.max(w,W);return r.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${ie+160} 605`,style:{direction:"ltr"},children:[r.jsxs("defs",{children:[r.jsxs("linearGradient",{id:"chartBg",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#ffffff",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#f8f9ff",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"bestPriceGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#00f5a0",stopOpacity:1}}),r.jsx("stop",{offset:"30%",style:{stopColor:"#00d9f5",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#0066cc",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"regularPriceGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),r.jsx("stop",{offset:"50%",style:{stopColor:"#764ba2",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#f093fb",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient0",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#764ba2",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient1",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#f093fb",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#f5576c",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient2",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#4facfe",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#00f2fe",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient3",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#a8edea",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#fed6e3",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient4",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#ffecd2",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#fcb69f",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient5",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#a18cd1",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#fbc2eb",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient6",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#fad0c4",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#ffd1ff",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient7",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#a1c4fd",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#c2e9fb",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"metallicShine",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),r.jsx("stop",{offset:"45%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),r.jsx("stop",{offset:"50%",style:{stopColor:"rgba(255,255,255,0.8)",stopOpacity:1}}),r.jsx("stop",{offset:"55%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),r.jsx("stop",{offset:"100%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}})]}),r.jsx("filter",{id:"dropShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:r.jsx("feDropShadow",{dx:"0",dy:"6",stdDeviation:"8",floodColor:"rgba(0,0,0,0.15)"})}),r.jsxs("filter",{id:"premiumGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[r.jsx("feGaussianBlur",{stdDeviation:"5",result:"coloredBlur"}),r.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0 0 0  0 1 1 0 0  0 0 1 0 0  0 0 0 1 0"}),r.jsxs("feMerge",{children:[r.jsx("feMergeNode",{in:"coloredBlur"}),r.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),r.jsxs("filter",{id:"bevelEffect",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[r.jsx("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2",result:"blur"}),r.jsx("feSpecularLighting",{in:"blur",result:"specOut",surfaceScale:"5",specularConstant:"0.8",specularExponent:"20","lighting-color":"white",children:r.jsx("fePointLight",{x:"-50",y:"-50",z:"200"})}),r.jsx("feComposite",{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut2"}),r.jsx("feComposite",{in:"SourceGraphic",in2:"specOut2",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"})]}),r.jsxs("filter",{id:"pulseGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[r.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),r.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0.8 0 0  0 1 1 0 0  0 0 1 0.2 0  0 0 0 1 0"}),r.jsxs("feMerge",{children:[r.jsx("feMergeNode",{in:"coloredBlur"}),r.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),r.jsx("rect",{width:ie+160,height:"605",fill:"url(#chartBg)",rx:"12",style:{filter:"drop-shadow(0 4px 20px rgba(0,0,0,0.1))"}}),r.jsx("g",{transform:"translate(80, 40)",children:(()=>{const Ee=k.map(Me=>parseFloat(Me.price)||0),le=Math.max(...Ee),ge=Math.min(...Ee),_e=le-ge||1,J=300,ae=640,Ie=k.length*150,Re=Math.max(ae,Ie),ye=Math.min(Re/k.length*.6,80),ue=Re/k.length;return r.jsxs(r.Fragment,{children:[[0,1,2,3,4,5].map(Me=>{const Le=130+(J-130)/5*Me,ke=(1-Me/5)*Math.max(...Ee);return r.jsxs("g",{children:[r.jsx("line",{x1:"0",y1:Le,x2:Re,y2:Le,stroke:Me===5?"#007bff":"rgba(123, 140, 252, 0.2)",strokeWidth:Me===5?"2":"1",strokeDasharray:Me===5?"0":"5,5"}),r.jsx("text",{x:"-15",y:Le+5,textAnchor:"end",fontSize:"12",fill:"#4f46e5",fontWeight:"600",children:Math.round(ke).toLocaleString()})]},Me)}),k.map((Me,Pe)=>{const Le=parseFloat(Me.price)||0;let st;if(_e>0){const Mn=J-130,bs=Le/Math.max(...Ee);st=Math.max(bs*Mn,15)}else st=(J-130)*.8;const ke=ue*Pe+(ue-ye)/2,Ve=J-st,Tn=Le===ge;let Gn;return Tn?Gn="bestPriceGradient":Gn=`gradient${Pe%8}`,r.jsxs("g",{children:[r.jsx("rect",{x:ke+4,y:Ve+8,width:ye,height:st,fill:"rgba(0,0,0,0.05)",rx:"10"}),r.jsx("rect",{x:ke+2,y:Ve+4,width:ye,height:st,fill:"rgba(0,0,0,0.08)",rx:"9"}),r.jsxs("rect",{x:ke,y:Ve,width:ye,height:st,fill:`url(#${Gn})`,rx:"10",filter:Tn?"url(#premiumGlow)":"url(#bevelEffect)",style:{transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer"},children:[r.jsx("animate",{attributeName:"height",from:"0",to:st,dur:"2s",begin:`${Pe*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),r.jsx("animate",{attributeName:"y",from:J,to:Ve,dur:"2s",begin:`${Pe*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),Tn&&r.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;1.05;1",dur:"3s",repeatCount:"indefinite",begin:`${Pe*.3+2}s`})]}),r.jsx("rect",{x:ke+2,y:Ve+2,width:ye-4,height:Math.max(st/2.5,30),fill:"url(#metallicShine)",rx:"8",opacity:"0.6",children:r.jsx("animateTransform",{attributeName:"transform",type:"translate",values:`-${ye};${ye}`,dur:"4s",repeatCount:"indefinite",begin:`${Pe*.5+3}s`})}),r.jsx("rect",{x:ke+3,y:Ve+3,width:Math.max(ye/4,8),height:Math.max(st-6,20),fill:"rgba(255,255,255,0.4)",rx:"6"}),r.jsx("rect",{x:ke+ye-6,y:Ve+6,width:"3",height:Math.max(st-12,15),fill:"rgba(255,255,255,0.2)",rx:"1.5"}),r.jsxs("g",{children:[r.jsx("rect",{x:ke+ye/2-30,y:Ve-28,width:"60",height:"20",fill:"rgba(0,0,0,0.8)",rx:"10",opacity:"0.9"}),r.jsxs("text",{x:ke+ye/2,y:Ve-15,textAnchor:"middle",fontSize:"12",fill:"white",fontWeight:"bold",children:[". ",Le.toLocaleString()]})]}),r.jsx("g",{children:(()=>{const Mn=Me.supplierName,bs=Mn.length*7,Xs=Math.max(bs+20,ye+10);return r.jsxs(r.Fragment,{children:[r.jsx("rect",{x:ke+ye/2-Xs/2,y:J+30,width:Xs,height:22,fill:"rgba(255,255,255,0.96)",rx:"11",stroke:"rgba(0,123,255,0.5)",strokeWidth:"1.5",filter:"url(#dropShadow)"}),r.jsx("text",{x:ke+ye/2,y:J+41,textAnchor:"middle",fontSize:"11",fill:"#1e40af",fontWeight:"700",style:{fontFamily:"system-ui, -apple-system, sans-serif",letterSpacing:"0.2px"},dominantBaseline:"middle",children:Mn})]})})()}),Tn&&r.jsxs("g",{children:[r.jsx("circle",{cx:ke+ye/2,cy:Ve-100,r:"18",fill:"linear-gradient(135deg, #ffd700 0%, #ffb300 100%)",stroke:"#fff",strokeWidth:"3",filter:"url(#dropShadow)"}),r.jsx("text",{x:ke+ye/2,y:Ve-95,textAnchor:"middle",fontSize:"16",fill:"#fff",children:""}),r.jsx("rect",{x:ke-5,y:Ve-70,width:ye+10,height:"20",fill:"#28a745",rx:"10",opacity:"0.9"}),r.jsx("text",{x:ke+ye/2,y:Ve-57,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:" "})]})]},Me.id)}),r.jsx("text",{x:Re/2,y:30,textAnchor:"middle",fontSize:"16",fill:"url(#bestPriceGradient)",fontWeight:"bold",direction:"rtl",children:"   "}),r.jsxs("g",{transform:`translate(${Re/2}, ${J+110})`,children:[r.jsx("rect",{x:"-200",y:"-25",width:"400",height:"145",fill:"rgba(255,255,255,0.98)",rx:"20",stroke:"url(#bestPriceGradient)",strokeWidth:"2",filter:"url(#dropShadow)"}),r.jsx("text",{x:"0",y:"-5",textAnchor:"middle",fontSize:"16",fill:"#1f2937",fontWeight:"800",letterSpacing:"0.5px",children:" "}),r.jsxs("g",{transform:"translate(0, 15)",children:[r.jsxs("g",{transform:"translate(-125, 0)",children:[r.jsxs("g",{transform:"translate(0, 0)",children:[r.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#bestPriceGradient)",rx:"7",filter:"url(#premiumGlow)"}),r.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#059669",fontWeight:"700",children:" "}),r.jsx("text",{x:"80",y:"13",fontSize:"18",children:""})]}),r.jsx("line",{x1:"110",y1:"-5",x2:"110",y2:"19",stroke:"rgba(0,0,0,0.15)",strokeWidth:"2"}),r.jsxs("g",{transform:"translate(125, 0)",children:[r.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#regularPriceGradient)",rx:"7"}),r.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#6366f1",fontWeight:"700",children:" "}),r.jsx("text",{x:"90",y:"13",fontSize:"16",children:""})]})]}),r.jsxs("g",{transform:"translate(0, 40)",children:[r.jsx("rect",{x:"-170",y:"-8",width:"340",height:"22",fill:"rgba(59, 130, 246, 0.08)",rx:"11"}),r.jsxs("text",{x:"0",y:"5",textAnchor:"middle",fontSize:"14",fill:"#1e40af",fontWeight:"700",children:["   : ",(Math.max(...Ee)-Math.min(...Ee)).toLocaleString()," ."]})]}),r.jsx("g",{transform:"translate(0, 90)",children:r.jsxs("text",{x:"0",y:"0",textAnchor:"middle",fontSize:"12",fill:"#6b7280",fontWeight:"600",children:["  : ",Math.max(...Ee).toLocaleString()," .      : ",Math.min(...Ee).toLocaleString()," ."]})})]})]})]})})()})]})})()})})})]})}),r.jsx("div",{className:"col-12",children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsx("div",{className:"d-flex justify-content-between align-items-center",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-list-ul text-primary me-2"}),"   (",k.length,")"]})})}),r.jsx("div",{className:"card-body p-0",children:k.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-receipt fs-1"})}),r.jsx("h5",{className:"text-muted",children:"   "}),r.jsx("p",{className:"text-muted",children:"      "})]}):r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"60px"},children:"#"}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:" ()"}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",style:{width:"120px"},children:""})]})}),r.jsx("tbody",{children:k.map((w,X)=>{const ne=k.length>=1&&k.reduce((W,ie)=>{const Ee=parseFloat(W.price)||0;return(parseFloat(ie.price)||0)<Ee?ie:W}).id===w.id;return r.jsxs("tr",{className:ne?"table-success":"",children:[r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:X+1})}),r.jsxs("td",{className:"text-center",children:[r.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},onClick:W=>{W.preventDefault(),W.stopPropagation(),console.log("Button clicked, calling handleSupplierEdit..."),He(w.supplierName,w.supplierType)},title:` : ${w.supplierName}`,type:"button",children:w.supplierName}),ne&&r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:`badge ${w.supplierType==="local"?"bg-success":"bg-info"}`,children:w.supplierType==="local"?"":""})}),r.jsx("td",{className:"text-center",children:w.date}),r.jsxs("td",{className:"text-center",children:[w.price," ",ne&&r.jsx("i",{className:"bi bi-arrow-down-circle-fill text-success ms-2",title:" "})]}),r.jsx("td",{className:"text-center",children:w.quotationFile&&r.jsx(ay,{size:25,clickable:!0,onClick:()=>{w.quotationFileURL?window.open(w.quotationFileURL,"_blank"):(console.log("No file URL available for:",w.quotationFile),alert("   "))},title:` : ${w.quotationFileName||w.quotationFile}`})}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"btn-group btn-group-sm",children:[r.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>Xt(w),title:"",children:r.jsx("i",{className:"bi bi-pencil"})}),r.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>Lt(w),title:"",children:r.jsx("i",{className:"bi bi-trash"})})]})})]},w.id)})})]})})})]})})]})]}),r.jsx("div",{className:"card-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:r.jsxs("div",{className:"d-flex gap-3",style:{marginBottom:"15px"},children:[r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:at,disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""}),r.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:l?" ...":r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"bi bi-check-lg me-1"}),F?"":""]})})]})})]})]})}),r.jsx("div",{className:"app-footer",style:{textAlign:"center",padding:"20px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",marginTop:"20px"},children:r.jsx("span",{children:" Modern Bin 2025"})})]})]})]}),!n&&t&&r.jsx(_n,{rtl:!0}),!n&&t&&r.jsx(En,{}),f&&r.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:r.jsx("div",{className:"modal-dialog modal-lg",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[r.jsxs("div",{className:"modal-header border-0 pb-2",children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-receipt text-primary me-2"}),"  "]}),r.jsx("button",{type:"button",className:"btn-close",onClick:fe,style:{fontSize:"12px"}})]}),r.jsxs("form",{onSubmit:Yt,onReset:w=>w.preventDefault(),children:[r.jsxs("div",{className:"modal-body px-4",children:[a.fileUpload&&r.jsxs("div",{className:"alert alert-danger mb-3",children:[r.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.fileUpload]}),r.jsxs("div",{className:"row",children:[r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:"  *"}),r.jsxs("select",{className:"form-select",name:"supplierType",value:$.supplierType,onChange:Pt,required:!0,children:[r.jsx("option",{value:"local",children:" "}),r.jsx("option",{value:"foreign",children:" "})]})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:" *"}),r.jsxs("div",{className:"form-control d-flex align-items-center justify-content-between",onClick:Ce,style:{cursor:"pointer",backgroundColor:"#f8f9fa"},children:[r.jsx("span",{className:$.supplierName?"text-dark":"text-muted",children:$.supplierName||" "}),r.jsx("i",{className:"bi bi-chevron-down"})]})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:"  *"}),r.jsx("input",{type:"date",className:"form-control",name:"date",value:$.date,onChange:Pt,required:!0})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:" () *"}),r.jsx("input",{type:"number",step:"0.01",min:"0",className:"form-control",name:"price",value:$.price,onChange:Pt,onKeyPress:w=>{(w.key==="-"||w.key!=="."&&w.key!=="Backspace"&&(w.key<"0"||w.key>"9"))&&w.preventDefault()},placeholder:"0.00",required:!0})]}),r.jsxs("div",{className:"col-md-12 mb-3",children:[r.jsxs("label",{className:"form-label fw-bold",children:["   ",O?"()":"*"]}),r.jsxs("div",{className:"mb-2",children:[r.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.jpg,.png,.jpeg",style:{display:"none"},ref:w=>{w&&(w.onclick=()=>{w.value=""},w.onchange=X=>{var W;const ne=(W=X.target.files)==null?void 0:W[0];ne&&gt(ne)})},id:`fileInput_${f}_${Date.now()}`}),r.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>{const w=document.querySelector(`#fileInput_${f}_${Date.now()}`);if(w)w.click();else{const X=document.createElement("input");X.type="file",X.accept=".pdf,.doc,.docx,.jpg,.png,.jpeg",X.style.display="none",X.onchange=ne=>{var ie;const W=(ie=ne.target.files)==null?void 0:ie[0];W&&gt(W),document.body.removeChild(X)},document.body.appendChild(X),X.click()}},style:{borderRadius:"6px",height:"38px",minWidth:"150px"},children:[r.jsx("i",{className:"bi bi-upload me-2"})," "]})]}),$.quotationFile&&r.jsxs("div",{className:"alert alert-success py-2 mb-2",style:{position:"relative"},children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-check-circle me-2 text-success"}),r.jsxs("div",{className:"flex-grow-1",children:[r.jsx("strong",{children:$.quotationFile.name?$.supplierName?`  ${$.supplierName}.${$.quotationFile.name.split(".").pop()}`:$.quotationFile.name:O?$.supplierName?`  ${$.supplierName}.pdf`:((In=k.find(w=>w.id===O))==null?void 0:In.quotationFileName)||" ":" "}),r.jsxs("small",{className:"text-muted ms-2",children:["(",$.quotationFile.size?Math.round($.quotationFile.size/1024):O?Math.round((((qn=k.find(w=>w.id===O))==null?void 0:qn.quotationFileSize)||0)/1024):0," KB)"]})]})]}),r.jsx("button",{type:"button",className:"btn-close btn-close-sm",onClick:()=>{Z(w=>({...w,quotationFile:null}))},title:" ",style:{position:"absolute",top:"8px",left:"8px",width:"20px",height:"20px",fontSize:"10px",opacity:.7},onMouseEnter:w=>w.target.style.opacity=1,onMouseLeave:w=>w.target.style.opacity=.7})]}),O&&!$.quotationFile&&r.jsxs("div",{className:"alert alert-info py-2 mb-2",children:[r.jsx("i",{className:"bi bi-info-circle me-2"}),r.jsxs("small",{children:[" : ",((Hn=k.find(w=>w.id===O))==null?void 0:Hn.quotationFileName)||" "]})]}),!$.quotationFile&&!O&&r.jsx("div",{className:"mt-1",children:r.jsxs("small",{className:"text-muted",children:[r.jsx("i",{className:"bi bi-info-circle me-1"}),"   PDF  Word  "]})})]})]})]}),r.jsx("div",{className:"modal-footer border-0 pt-0 d-flex justify-content-center",style:{marginBottom:"10px"},children:r.jsxs("div",{className:"d-flex gap-3",children:[r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:fe,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""}),r.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:l?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"10px",height:"10px"}}),"..."]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"bi bi-check-lg me-1"}),""]})})]})})]})]})})}),x&&r.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:r.jsx("div",{className:"modal-dialog modal-xl",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[r.jsxs("div",{className:"modal-header border-0 pb-2",style:{marginBottom:"5px"},children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-people-fill text-primary me-2"}),$.supplierType==="local"?"  ":"  ",r.jsxs("span",{className:"text-muted ms-2",children:["(",Bn().length,")"]})]}),r.jsx("button",{type:"button",className:"btn-close",onClick:Ne,style:{fontSize:"12px"}})]}),r.jsx("div",{className:"modal-body p-0",children:Bn().length>0?r.jsx("div",{className:"table-responsive suppliers-table",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"50px"}}),r.jsx("th",{children:" "}),r.jsx("th",{children:" "}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsx("tbody",{children:Bn().map(w=>r.jsxs("tr",{onClick:()=>ot(w),style:{cursor:"pointer"},children:[r.jsx("td",{className:"text-center",children:r.jsx("div",{className:"form-check d-flex justify-content-center",children:r.jsx("input",{className:"form-check-input custom-radio",type:"radio",name:"selectedSupplier",checked:(D==null?void 0:D.id)===w.id,onChange:()=>{},style:{pointerEvents:"none",width:"18px",height:"18px",borderWidth:"2px",borderColor:(D==null?void 0:D.id)===w.id?"#007bff":"#dee2e6"}})})}),r.jsx("td",{children:r.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},children:w.name})}),r.jsx("td",{children:r.jsx("a",{href:`mailto:${w.email}`,className:"text-decoration-none",children:w.email})}),r.jsx("td",{children:w.phone}),r.jsx("td",{children:w.city||"-"})]},w.id))})]})}):r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-people fs-1"})}),r.jsx("h5",{className:"text-muted",children:"  "}),r.jsxs("p",{className:"text-muted",children:["  ",$.supplierType==="local"?" ":" "," "]})]})}),r.jsx("div",{className:"modal-footer border-0 d-flex justify-content-center",style:{marginTop:"15px"},children:r.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:Fe,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",margin:"20px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:""})})]})})}),g&&j&&r.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:w=>{w.target===w.currentTarget&&Xe()},children:r.jsx("div",{className:"modal-dialog modal-lg",onClick:w=>w.stopPropagation(),children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[r.jsxs("div",{className:"modal-header border-0",children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"  - ",j.name,r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:j.supplierType==="local"?"":""})]}),r.jsx("button",{type:"button",className:"btn-close",onClick:Xe})]}),r.jsx("div",{className:"modal-body",children:r.jsxs("div",{className:"row g-3",children:[r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:j.name})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:j.email||""})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:j.phone||""})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:j.city||""})]}),r.jsxs("div",{className:"col-12",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:j.address||""})]}),j.taxNumber&&r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:j.taxNumber})]}),j.bankAccount&&r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:"  "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:j.bankAccount})]}),j.notes&&r.jsxs("div",{className:"col-12",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:j.notes})]})]})}),r.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:Xe,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""})})]})})})]}),r.jsx(an,{show:l,message:F?"   ...":"   ..."}),r.jsx(Wt,{show:ee.show,onClose:se,title:ee.title,message:ee.message,type:ee.type,onConfirm:ee.onConfirm,confirmText:ee.confirmText,cancelText:ee.cancelText,showCancel:ee.showCancel}),r.jsx(cy,{position:"bottom-right",showDetails:!0})]})}function _I(){return r.jsx(At,{children:r.jsx(w9,{})})}const v9=({refreshTrigger:n})=>{const[e,t]=b.useState([]),[s,i]=b.useState(!0),[a,o]=b.useState(null),[l,c]=b.useState(""),[d,h]=b.useState([]),[f,p]=b.useState(!1),[x,I]=b.useState(!1),[D,A]=b.useState(!1),[g,N]=b.useState(null),[j,V]=b.useState([]),[$,Z]=b.useState([]),O=On(),{logActivity:M,getCurrentUser:T}=$t(),{alertConfig:L,closeAlert:G,showSuccess:U,showError:k,showConfirm:re}=Kt(),{currentPage:xe,totalPages:H,paginatedItems:ee,handlePageChange:se,resetPage:Y,totalItems:R,itemsPerPage:_}=Ni(d,30);b.useEffect(()=>{C(),z()},[]),b.useEffect(()=>{n&&C()},[n]),b.useEffect(()=>{if(l.trim()){const E=e.filter(te=>{var Te,ze,We,at;return((Te=te.name)==null?void 0:Te.toLowerCase().includes(l.toLowerCase()))||((ze=te.category)==null?void 0:ze.toLowerCase().includes(l.toLowerCase()))||((We=te.description)==null?void 0:We.toLowerCase().includes(l.toLowerCase()))||((at=te.supplier)==null?void 0:at.toLowerCase().includes(l.toLowerCase()))});h(E)}else h(e);Y()},[l,e,Y]);const C=async()=>{try{i(!0);const E=await Ms.getAllLocalProducts();t(E),o(null)}catch(E){o(E.message)}finally{i(!1)}},z=async()=>{try{const[E,te]=await Promise.all([ri.getAllSuppliers(),ii.getAllSuppliers()]);V(E),Z(te)}catch(E){console.error("Error loading suppliers:",E)}},K=async(E,te)=>{try{if(te==="local"){const Te=j.find(ze=>ze.name===E);Te&&(N(Te),I(!0))}else if(te==="foreign"){const Te=$.find(ze=>ze.name===E);Te&&(N(Te),A(!0))}}catch(Te){console.error("Error opening supplier modal:",Te)}},F=()=>{I(!1),A(!1),N(null)},Q=E=>{re(`       

${E.name}`,()=>oe(E),"   ")},oe=async E=>{try{p(!0),await un.moveToTrash(E,"localproducts"),await Ms.deleteLocalProduct(E.id);const te=T();M("task",`${te.name}   `,`   : ${E.name}`),await C(),U(`    : ${E.name}`,"  ")}catch(te){o(te.message),k(`     : ${te.message}`,"  ")}finally{p(!1)}};return s?r.jsx(an,{show:!0,message:"    ...",overlay:!1}):a?r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"text-danger mb-3",children:r.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),r.jsx("h5",{className:"text-danger",children:" "}),r.jsx("p",{className:"text-muted",children:a}),r.jsxs("button",{className:"btn btn-primary",onClick:C,children:[r.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):r.jsxs("div",{className:"card shadow-sm","data-list":"local-products",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"row align-items-center justify-content-between",children:[r.jsx("div",{className:"col-lg-4",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),"   (",d.length,")"]})}),r.jsx("div",{className:"col-lg-8",children:r.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[r.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[r.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:l,onChange:E=>c(E.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),r.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:r.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),r.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:()=>O("/local-products/add"),style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[r.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"   "]})]})})]})}),r.jsxs("div",{className:"card-body p-0",children:[d.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-box-seam fs-1"})}),r.jsx("h5",{className:"text-muted",children:"   "}),r.jsx("p",{className:"text-muted",children:l?"    ":"      "}),!l&&r.jsxs("button",{className:"btn btn-primary",onClick:()=>O("/local-products/add"),children:[r.jsx("i",{className:"bi bi-plus-lg me-1"}),"   "]})]}):r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",style:{width:"120px"},children:""})]})}),r.jsx("tbody",{children:ee.map((E,te)=>{let Te=E.price,ze=E.supplier,We=!1,at=null,zt=null;return E.priceQuotes&&Array.isArray(E.priceQuotes)&&E.priceQuotes.length>0&&(We=!0,zt=E.priceQuotes.reduce((fe,Ce)=>{const Ne=parseFloat(fe.price)||0;return(parseFloat(Ce.price)||0)<Ne?Ce:fe}),Te=zt.price,ze=zt.supplierName,at=zt.supplierType),r.jsxs("tr",{children:[r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(xe-1)*_+te+1})}),r.jsx("td",{className:"text-center",children:r.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary product-name-btn",onClick:fe=>{if(fe.preventDefault(),fe.stopPropagation(),console.log("=== LOCAL PRODUCT BUTTON CLICKED ==="),console.log("Product Name:",E.name),console.log("Product ID:",E.id),E.id){const Ce=`/local-products/edit/${E.id}`;console.log("Target URL:",Ce),console.log(" FORCING NAVIGATION TO:",Ce),window.location.href=Ce}else console.error("Product ID is missing:",E),k("     ","  ")},onMouseDown:fe=>fe.preventDefault(),style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0",userSelect:"none",pointerEvents:"auto",zIndex:"1"},title:`  | Internal ID: ${E.internalId||"Not Set"} | Firebase ID: ${E.id||"Missing"}`,children:E.name})}),r.jsx("td",{className:"text-center",children:E.category||"-"}),r.jsx("td",{className:"text-center",children:E.unit||"-"}),r.jsx("td",{className:"text-center",children:Te?r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsxs("span",{children:[Te," "]}),We&&r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),r.jsx("td",{className:"text-center",children:ze?r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[We&&at?r.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",onClick:()=>K(ze,at),style:{textDecoration:"none"},title:`  ${at==="local"?" ":" "}`,children:ze}):r.jsx("span",{children:ze}),We&&r.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"btn-group btn-group-sm",children:[r.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>O(`/local-products/edit/${E.id}`),title:"",children:r.jsx("i",{className:"bi bi-pencil"})}),r.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>Q(E),title:"",children:r.jsx("i",{className:"bi bi-trash"})})]})})]},E.internalId||E.id)})})]})}),d.length>0&&r.jsx(ji,{currentPage:xe,totalPages:H,onPageChange:se,totalItems:R,itemsPerPage:_})]}),x&&g&&r.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:E=>{E.target===E.currentTarget&&F()},children:r.jsx("div",{className:"modal-dialog modal-lg",onClick:E=>E.stopPropagation(),children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[r.jsxs("div",{className:"modal-header border-0",children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"  - ",g.name,r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:""})]}),r.jsx("button",{type:"button",className:"btn-close",onClick:F})]}),r.jsx("div",{className:"modal-body",children:r.jsxs("div",{className:"row g-3",children:[r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.name})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.email||""})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:g.phone||""})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.city||""})]}),r.jsxs("div",{className:"col-12",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.address||""})]}),g.taxNumber&&r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.taxNumber})]}),g.bankAccount&&r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:"  "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.bankAccount})]}),g.notes&&r.jsxs("div",{className:"col-12",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.notes})]})]})}),r.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:F,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""})})]})})}),D&&g&&r.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:E=>{E.target===E.currentTarget&&F()},children:r.jsx("div",{className:"modal-dialog modal-lg",onClick:E=>E.stopPropagation(),children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[r.jsxs("div",{className:"modal-header border-0",children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"  - ",g.name,r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:""})]}),r.jsx("button",{type:"button",className:"btn-close",onClick:F})]}),r.jsx("div",{className:"modal-body",children:r.jsxs("div",{className:"row g-3",children:[r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.name})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.email||""})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:g.phone||""})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.country||""})]}),r.jsxs("div",{className:"col-12",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.address||""})]}),g.taxNumber&&r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.taxNumber})]}),g.bankAccount&&r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:"  "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.bankAccount})]}),g.notes&&r.jsxs("div",{className:"col-12",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.notes})]})]})}),r.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:F,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""})})]})})}),r.jsx(Wt,{show:L.show,onClose:G,title:L.title,message:L.message,type:L.type,onConfirm:L.onConfirm,confirmText:L.confirmText,cancelText:L.cancelText,showCancel:L.showCancel})]})};function N9(){const[n,e]=b.useState(!1),[t,s]=b.useState(0),{isTimelineVisible:i}=gn(),a=()=>{e(!n)};return r.jsx(At,{children:r.jsx(Dt,{children:r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[r.jsx(Nn,{onToggle:a}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!i?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),r.jsx(jn,{}),r.jsx("div",{className:"app-content-area p-3",children:r.jsx("div",{className:"local-products-table",children:r.jsx(v9,{refreshTrigger:t})})}),r.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:r.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&i&&r.jsx(_n,{rtl:!0}),!n&&i&&r.jsx(En,{})]})})})}function j9(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(N9,{})})})}function _9(){var In,qn,Hn;const[n,e]=b.useState(!1),{isTimelineVisible:t}=gn(),[s,i]=b.useState({name:"",category:"",description:"",unit:"",price:"",supplier:"",stockQuantity:"",minimumStock:"",storageConditions:"",expiryDate:"",batchNumber:"",origin:"",notes:"",active:!0}),[a,o]=b.useState({}),[l,c]=b.useState(!1),[d,h]=b.useState(!1),[f,p]=b.useState(!1),[x,I]=b.useState(!1),[D,A]=b.useState(null),[g,N]=b.useState(!1),[j,V]=b.useState(null),[$,Z]=b.useState({supplierType:"local",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),[O,M]=b.useState(null),[T,L]=b.useState([]),[G,U]=b.useState([]),[k,re]=b.useState([]),[xe,H]=b.useState(!1),{alertConfig:ee,closeAlert:se,showSuccess:Y,showError:R,showConfirm:_}=Kt(),C=w=>{if(w.length===0)return;const X=w.reduce((ne,W)=>{const ie=parseFloat(ne.price)||0;return(parseFloat(W.price)||0)<ie?W:ne});console.log("Lowest price quote found:",X),i(ne=>({...ne,price:X.price,supplier:X.supplierName}))},z=On(),{id:K}=li(),F=!!K,{logActivity:Q,getCurrentUser:oe}=$t(),E=()=>{e(!n)};b.useEffect(()=>{F&&Te(),te();const w=()=>{F&&K&&(console.log("Window focused - refreshing local product data..."),Te())};return window.addEventListener("focus",w),()=>{window.removeEventListener("focus",w)}},[K]),b.useEffect(()=>{var w;console.log("PriceQuoteData changed:",{hasFile:!!$.quotationFile,fileName:(w=$.quotationFile)==null?void 0:w.name,supplierName:$.supplierName,price:$.price})},[$]);const te=async()=>{try{const[w,X]=await Promise.all([ri.getAllSuppliers(),ii.getAllSuppliers()]);L(w),U(X)}catch(w){console.error("Error loading suppliers:",w)}},Te=async()=>{try{h(!0),console.log("Loading local product data for ID:",K);const w=await Ms.getAllLocalProducts(),X=w.find(ne=>ne.id===K);X?(console.log("Local product found:",X.name),i({name:X.name||"",category:X.category||"",description:X.description||"",unit:X.unit||"",price:X.price||"",supplier:X.supplier||"",stockQuantity:X.stockQuantity||"",minimumStock:X.minimumStock||"",storageConditions:X.storageConditions||"",expiryDate:X.expiryDate||"",batchNumber:X.batchNumber||"",origin:X.origin||"",notes:X.notes||"",active:X.active!==void 0?X.active:!0}),X.priceQuotes&&Array.isArray(X.priceQuotes)?(console.log("Loading price quotes for local product:",X.name,X.priceQuotes),re(X.priceQuotes),setTimeout(()=>{C(X.priceQuotes)},200)):console.log("No price quotes found for local product:",X.name)):(console.error("Local product not found with ID:",K),console.log("Available local products:",w.map(ne=>({id:ne.id,name:ne.name}))),o({submit:"      "}))}catch(w){console.error("Error loading local product:",w),o({submit:"     : "+w.message})}finally{h(!1)}},ze=w=>{const{name:X,value:ne,type:W,checked:ie}=w.target;i(Ee=>({...Ee,[X]:W==="checkbox"?ie:ne})),a[X]&&o(Ee=>({...Ee,[X]:""}))},We=async w=>{w.preventDefault();const X=Ms.validateLocalProductData(s);if(k.length===0&&(X.priceQuotes="      "),Object.keys(X).length>0){o(X);return}c(!0),o({});try{const ne=await _i.validateUniqueFields({name:s.name},F?K:null,F?"localproducts":null);if(Object.keys(ne).length>0){o(ne),c(!1);return}const W={...s,price:parseFloat(s.price)||0,stockQuantity:parseFloat(s.stockQuantity)||0,minimumStock:parseFloat(s.minimumStock)||0,priceQuotes:k,status:"active"};if(console.log("Saving local product with price quotes:",{name:W.name,priceQuotes:W.priceQuotes,priceQuotesCount:W.priceQuotes.length}),F){await Ms.updateLocalProduct(K,W);const ie=oe();Q("task",`${ie.name}   `,`   : ${W.name}`)}else{await Ms.createLocalProduct(W);const ie=oe();Q("task",`${ie.name}   `,`   : ${W.name}`)}z("/local-products")}catch(ne){o({submit:ne.message})}finally{c(!1)}},at=()=>{z("/local-products")},zt=()=>{p(!0)},fe=()=>{p(!1),M(null),Z({supplierType:"local",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),o(w=>({...w,fileUpload:""})),console.log("Modal closed and state reset")},Ce=()=>{I(!0)},Ne=()=>{I(!1),A(null)},He=w=>{console.log("Supplier Name:",w);try{console.log("Using already loaded local supplier data...");const X=T;console.log("Available local suppliers:",X.length),console.log("Local suppliers list:",X.map(W=>({id:W.id,name:W.name})));const ne=X.find(W=>W.name===w);console.log("Found supplier:",ne?"YES":"NO"),ne?(console.log("SUCCESS: Local supplier found:",ne.name),console.log("Supplier data:",ne),V(ne),N(!0),console.log("Modal state should be true now"),setTimeout(()=>{console.log("Modal state check - showSupplierEditModal:",g),console.log("Modal state check - selectedSupplierToEdit:",j==null?void 0:j.name)},100)):(console.error("LOCAL SUPPLIER NOT FOUND"),console.error("Looking for supplier name:",w),console.error("Available suppliers:",X.map(W=>W.name)),X.length===0?(console.log("No suppliers loaded, triggering data reload..."),loadSuppliersData(),R("    .   ...","  ")):R(`     : ${w}`,"  "))}catch(X){console.error("=== LOCAL SUPPLIER SEARCH ERROR ==="),console.error("Error details:",X),console.error("Error message:",X.message),R(`     : ${X.message}`,"  ")}},Xe=()=>{console.log("Called by:",new Error().stack),N(!1),V(null)},ot=w=>{A(w)},Fe=()=>{D&&Z(w=>{var ne,W;console.log("Before supplier selection - preserving file:",(ne=w.quotationFile)==null?void 0:ne.name);const X={...w,supplier:D.id,supplierName:D.name};return console.log("After supplier selection - file preserved:",(W=X.quotationFile)==null?void 0:W.name),X}),I(!1),A(null)},gt=w=>{console.log("File details:",{name:w==null?void 0:w.name,size:w==null?void 0:w.size,type:w==null?void 0:w.type,lastModified:w==null?void 0:w.lastModified}),a.fileUpload&&o(X=>({...X,fileUpload:""})),Z(X=>{var W;const ne={...X,quotationFile:w};return console.log("Updated priceQuoteData with file:",{hasFile:!!ne.quotationFile,fileName:(W=ne.quotationFile)==null?void 0:W.name}),ne})},Pt=w=>{const{name:X,value:ne,type:W}=w.target;W!=="file"&&Z(X==="supplierType"?ie=>({...ie,[X]:ne,supplier:"",supplierName:""}):ie=>({...ie,[X]:ne}))},Yt=async w=>{if(w.preventDefault(),console.log("Form element:",w.target),console.log("Current priceQuoteData:",$),console.log("Editing quote ID:",O),!$.supplierName){o(ie=>({...ie,fileUpload:"   "}));return}if(!$.date){o(ie=>({...ie,fileUpload:"   "}));return}if(!$.price){o(ie=>({...ie,fileUpload:"  "}));return}const X=new FormData(w.target),ne=X.get("quotationFile");console.log("File from form directly:",ne),console.log("File from state:",$.quotationFile);const W=$.quotationFile||ne;console.log("File to upload:",W),console.log("File upload details:",{exists:!!W,isFile:W instanceof File,name:W==null?void 0:W.name,size:W==null?void 0:W.size,type:W==null?void 0:W.type,lastModified:W==null?void 0:W.lastModified});try{if(c(!0),!O&&(!W||W.size===0))throw new Error("    ");let ie=null;if(W&&typeof W!="string"&&W.size>0){console.log("Starting file upload:",W.name);try{zs.validateFile(W,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}),console.log("File validation passed")}catch(Ee){throw console.error("File validation failed:",Ee),new Error(Ee.message)}console.log("Attempting file upload to Firebase...");try{const Ee=W.name.split(".").pop()||"pdf",le=$.supplierName?`  ${$.supplierName}.${Ee}`:W.name;console.log("Uploading with custom name:",le),ie=await zs.uploadFileWithCustomName(W,"quotations",le),console.log("File uploaded successfully:",ie)}catch(Ee){throw console.error("Firebase upload failed:",Ee),new Error(`   : ${Ee.message}`)}}if(O)console.log("Updating existing price quote with ID:",O),re(Ee=>{const le=Ee.map(ge=>ge.id===O?{...ge,supplierType:$.supplierType,supplier:$.supplier,supplierName:$.supplierName,date:$.date,price:$.price,quotationFile:ie?ie.path:ge.quotationFile,quotationFileURL:ie?ie.url:ge.quotationFileURL,quotationFileName:ie?ie.originalName:ge.quotationFileName,quotationFileSize:ie?ie.size:ge.quotationFileSize,quotationFileType:ie?ie.type:ge.quotationFileType,updatedAt:new Date}:ge);return console.log("Updated price quotes:",le),setTimeout(()=>{C(le)},100),le});else{const Ee={id:Date.now().toString(),supplierType:$.supplierType,supplier:$.supplier,supplierName:$.supplierName,date:$.date,price:$.price,quotationFile:ie?ie.path:null,quotationFileURL:ie?ie.url:null,quotationFileName:ie?ie.originalName:null,quotationFileSize:ie?ie.size:null,quotationFileType:ie?ie.type:null,createdAt:new Date};console.log("Adding new price quote:",Ee),re(le=>{const ge=[...le,Ee];return console.log("Updated price quotes:",ge),setTimeout(()=>{C(ge)},100),ge})}a.priceQuotes&&o(Ee=>({...Ee,priceQuotes:""})),fe(),F&&K&&setTimeout(async()=>{try{console.log("Auto-saving local product after price quote change..."),re(Ee=>{const le={...X,priceQuotes:Ee};return Ms.updateLocalProduct(K,le).then(()=>{console.log("Auto-save successful")}).catch(ge=>{console.error("Auto-save failed:",ge),R("   ","  ")}),Ee})}catch(Ee){console.error("Auto-save setup error:",Ee)}},200)}catch(ie){console.error("Error uploading file:",ie),o(Ee=>({...Ee,fileUpload:ie.message||"   .   ."}))}finally{c(!1)}},Xt=w=>{console.log("Starting edit for quote:",w),M(w.id),Z({supplierType:w.supplierType||"local",supplier:w.supplier||"",supplierName:w.supplierName||"",date:w.date||"",price:w.price||"",quotationFile:w.quotationFile||null}),p(!0)},Lt=w=>{if(console.log("Price quote delete button clicked:",w),console.log("Quote ID:",w==null?void 0:w.id),console.log("Quote keys:",w?Object.keys(w):"quote is null/undefined"),!w||!w.id){console.error("Invalid quote object - missing quote or ID:",{quote:w,hasId:!!(w!=null&&w.id),quoteId:w==null?void 0:w.id,quoteType:typeof w}),R("    ","");return}_(`      

${w.supplierName} - ${w.price} `,()=>on(w),"   ")},on=async w=>{if(console.log("Delete confirmation called for quote:",w),console.log("Confirmation - Quote ID:",w==null?void 0:w.id),console.log("Confirmation - Quote keys:",w?Object.keys(w):"quote is null/undefined"),console.log("Is editing mode:",F),console.log("Local product ID:",K),console.log("Form data name:",s.name),!w||!w.id){console.error("Invalid quote in confirmation - missing quote or ID:",{quote:w,hasId:!!(w!=null&&w.id),quoteId:w==null?void 0:w.id,quoteType:typeof w}),R("    ",""),H(!1);return}try{if(H(!0),console.log("Starting delete process..."),console.log("Moving to trash..."),F&&K){const ne={...w,localProductId:K,localProductName:s.name};console.log("Quote with context for trash:",ne),console.log("Calling SimpleTrashService.moveToTrash...");const W=await un.moveToTrash(ne,"price_quotes");console.log("Trash service result:",W),console.log("Moved to trash successfully")}else console.log("Skipping trash - local product not saved yet (isEditing:",F,", id:",K,")");const X=oe();console.log("Logging activity with current user:",X),Q("task",`${X.name}   `,`   : ${w.supplierName} - ${w.price} `),console.log("Updating local state..."),console.log("Current price quotes before deletion:",k),re(ne=>{const W=ne.filter(ie=>ie.id!==w.id);return console.log("Filtered quotes:",W.length,"from",ne.length),console.log("Removed quote with ID:",w.id),console.log("Remaining quotes:",W.map(ie=>({id:ie.id,supplierName:ie.supplierName}))),setTimeout(()=>{C(W)},100),W}),console.log("Showing success message..."),F&&K?Y(`    : ${w.supplierName}`,"  "):Y(`   : ${w.supplierName}`," "),console.log("Delete process completed successfully"),F&&K&&setTimeout(async()=>{try{console.log("Auto-saving local product after price quote deletion..."),re(ne=>{const W={...s,priceQuotes:ne};return Ms.updateLocalProduct(K,W).then(()=>{console.log("Auto-save after deletion successful")}).catch(ie=>{console.error("Auto-save after deletion failed:",ie)}),ne})}catch(ne){console.error("Auto-save after deletion setup error:",ne)}},200)}catch(X){console.error("Error deleting price quote:",X),console.error("Error stack:",X.stack),R(`    : ${X.message||"  "}`,"  ")}finally{console.log("Setting deleting to false"),H(!1)}},Bn=()=>T.filter(ne=>{const W=ne.hasOwnProperty("active"),ie=ne.hasOwnProperty("status");return W?ne.active===!0:ie?ne.status==="active":!0});return d?r.jsx(an,{show:!0,message:"    ..."}):r.jsxs(Dt,{children:[r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[r.jsx(Nn,{onToggle:E}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsxs("div",{style:{position:"sticky",top:0,zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item",children:r.jsx("a",{href:"/local-products",className:"text-decoration-none text-primary",children:" "})}),r.jsx("li",{className:"breadcrumb-item",children:r.jsx("a",{href:"/local-products",className:"text-decoration-none text-primary",children:" "})}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:F?"  ":"   "})]})}),r.jsx(jn,{})]}),r.jsxs("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:[r.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"60px"},children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsxs("div",{className:"card-header bg-white border-bottom py-4 d-flex align-items-center",children:[r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),F?"  ":"   "]}),r.jsx("div",{style:{flex:1}}),r.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:zt,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:"1",paddingTop:"2px"},children:" "})]}),r.jsxs("form",{onSubmit:We,children:[r.jsxs("div",{className:"card-body p-4",children:[a.submit&&r.jsxs("div",{className:"alert alert-danger",children:[r.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.submit]}),r.jsxs("div",{className:"row mb-4",children:[r.jsx("div",{className:"col-12",children:r.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[r.jsx("i",{className:"bi bi-info-circle me-2"})," "]})}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:"   *"}),r.jsx("input",{type:"text",className:`form-control ${a.name?"is-invalid":""}`,name:"name",value:s.name,onChange:ze,placeholder:"   "}),a.name&&r.jsx("div",{className:"invalid-feedback",children:a.name})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:" *"}),r.jsx(oy,{name:"category",value:s.category,onChange:ze,required:!0,className:`form-select ${a.category?"is-invalid":""}`,placeholder:" ",showDescription:!0}),a.category&&r.jsx("div",{className:"invalid-feedback",children:a.category})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:" *"}),r.jsx(ly,{name:"unit",value:s.unit,onChange:ze,required:!0,className:`form-select ${a.unit?"is-invalid":""}`,placeholder:" ",showDescription:!0}),a.unit&&r.jsx("div",{className:"invalid-feedback",children:a.unit})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsxs("label",{className:"form-label fw-bold",children:[" () *",r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:k.length>0?"  ":" "})]}),r.jsx("input",{type:"number",step:"0.01",min:"0",className:`form-control ${a.price?"is-invalid":""}`,name:"price",value:s.price,onChange:null,onKeyPress:null,placeholder:"0.00",readOnly:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"}}),a.price&&r.jsx("div",{className:"invalid-feedback",children:a.price}),r.jsx("div",{className:"mt-1",children:r.jsxs("small",{className:"text-muted",children:[r.jsx("i",{className:"bi bi-info-circle me-1"}),k.length>0?"        ":"       "]})})]}),r.jsxs("div",{className:"col-md-12 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:""}),r.jsx("textarea",{className:"form-control",name:"description",value:s.description,onChange:ze,rows:"3",placeholder:"  "})]}),r.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:r.jsxs("div",{className:"d-flex align-items-center gap-2",children:[r.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"":" "}),r.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"localProductActiveSwitch",name:"active",checked:s.active,onChange:ze,style:{width:"48px",height:"24px",marginRight:"8px"}})]})})]}),r.jsxs("div",{className:"row mb-4",children:[r.jsxs("div",{className:"col-12",children:[r.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[r.jsx("i",{className:"bi bi-receipt me-2"})," "]}),a.priceQuotes&&r.jsxs("div",{className:"alert alert-danger",children:[r.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.priceQuotes]})]}),k.length>0&&r.jsx("div",{className:"col-12",children:r.jsxs("div",{className:"card mb-3 border-0 shadow-lg",style:{background:"linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%)",borderRadius:"16px"},children:[r.jsx("div",{className:"card-header border-0",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"16px 16px 0 0",padding:"20px"},children:r.jsxs("h5",{className:"card-title text-white mb-0 d-flex align-items-center",children:[r.jsx("div",{className:"me-3",style:{background:"rgba(255,255,255,0.2)",borderRadius:"12px",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsx("i",{className:"bi bi-bar-chart-fill fs-5"})}),r.jsx("span",{className:"fw-bold",children:"  "}),r.jsxs("span",{className:"badge bg-light text-primary ms-3",style:{borderRadius:"20px",fontSize:"12px",padding:"6px 12px"},children:[k.length," "]})]})}),r.jsx("div",{className:"card-body",style:{padding:"30px"},children:r.jsx("div",{style:{minHeight:"625px",direction:"ltr"},children:r.jsx("div",{style:{width:"100%",height:"605px",position:"relative"},children:(()=>{k.map(Ee=>parseFloat(Ee.price)||0);const w=640,W=k.length*150,ie=Math.max(w,W);return r.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${ie+160} 605`,style:{direction:"ltr"},children:[r.jsxs("defs",{children:[r.jsxs("linearGradient",{id:"chartBgLocal",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#ffffff",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#f8f9ff",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"bestPriceGradientLocal",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#00f5a0",stopOpacity:1}}),r.jsx("stop",{offset:"30%",style:{stopColor:"#00d9f5",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#0066cc",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"regularPriceGradientLocal",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),r.jsx("stop",{offset:"50%",style:{stopColor:"#764ba2",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#f093fb",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient0Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#764ba2",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient1Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#f093fb",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#f5576c",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient2Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#4facfe",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#00f2fe",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient3Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#a8edea",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#fed6e3",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient4Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#ffecd2",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#fcb69f",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient5Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#a18cd1",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#fbc2eb",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient6Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#fad0c4",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#ffd1ff",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient7Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#a1c4fd",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#c2e9fb",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"metallicShineLocal",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),r.jsx("stop",{offset:"45%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),r.jsx("stop",{offset:"50%",style:{stopColor:"rgba(255,255,255,0.8)",stopOpacity:1}}),r.jsx("stop",{offset:"55%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),r.jsx("stop",{offset:"100%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}})]}),r.jsx("filter",{id:"dropShadowLocal",x:"-50%",y:"-50%",width:"200%",height:"200%",children:r.jsx("feDropShadow",{dx:"0",dy:"6",stdDeviation:"8",floodColor:"rgba(0,0,0,0.15)"})}),r.jsxs("filter",{id:"premiumGlowLocal",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[r.jsx("feGaussianBlur",{stdDeviation:"5",result:"coloredBlur"}),r.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0 0 0  0 1 1 0 0  0 0 1 0 0  0 0 0 1 0"}),r.jsxs("feMerge",{children:[r.jsx("feMergeNode",{in:"coloredBlur"}),r.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),r.jsxs("filter",{id:"bevelEffectLocal",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[r.jsx("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2",result:"blur"}),r.jsx("feSpecularLighting",{in:"blur",result:"specOut",surfaceScale:"5",specularConstant:"0.8",specularExponent:"20","lighting-color":"white",children:r.jsx("fePointLight",{x:"-50",y:"-50",z:"200"})}),r.jsx("feComposite",{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut2"}),r.jsx("feComposite",{in:"SourceGraphic",in2:"specOut2",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"})]}),r.jsxs("filter",{id:"pulseGlowLocal",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[r.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),r.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0.8 0 0  0 1 1 0 0  0 0 1 0.2 0  0 0 0 1 0"}),r.jsxs("feMerge",{children:[r.jsx("feMergeNode",{in:"coloredBlur"}),r.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),r.jsx("rect",{width:ie+160,height:"605",fill:"url(#chartBgLocal)",rx:"12",style:{filter:"drop-shadow(0 4px 20px rgba(0,0,0,0.1))"}}),r.jsx("g",{transform:"translate(80, 40)",children:(()=>{const Ee=k.map(Me=>parseFloat(Me.price)||0),le=Math.max(...Ee),ge=Math.min(...Ee),_e=le-ge||1,J=300,ae=640,Ie=k.length*150,Re=Math.max(ae,Ie),ye=Math.min(Re/k.length*.6,80),ue=Re/k.length;return r.jsxs(r.Fragment,{children:[[0,1,2,3,4,5].map(Me=>{const Le=130+(J-130)/5*Me,ke=(1-Me/5)*Math.max(...Ee);return r.jsxs("g",{children:[r.jsx("line",{x1:"0",y1:Le,x2:Re,y2:Le,stroke:Me===5?"#007bff":"rgba(123, 140, 252, 0.2)",strokeWidth:Me===5?"2":"1",strokeDasharray:Me===5?"0":"5,5"}),r.jsx("text",{x:"-15",y:Le+5,textAnchor:"end",fontSize:"12",fill:"#4f46e5",fontWeight:"600",children:Math.round(ke).toLocaleString()})]},Me)}),k.map((Me,Pe)=>{const Le=parseFloat(Me.price)||0;let st;if(_e>0){const Mn=J-130,bs=Le/Math.max(...Ee);st=Math.max(bs*Mn,15)}else st=(J-130)*.8;const ke=ue*Pe+(ue-ye)/2,Ve=J-st,Tn=Le===ge;let Gn;return Tn?Gn="bestPriceGradientLocal":Gn=`gradient${Pe%8}Local`,r.jsxs("g",{children:[r.jsx("rect",{x:ke+4,y:Ve+8,width:ye,height:st,fill:"rgba(0,0,0,0.05)",rx:"10"}),r.jsx("rect",{x:ke+2,y:Ve+4,width:ye,height:st,fill:"rgba(0,0,0,0.08)",rx:"9"}),r.jsxs("rect",{x:ke,y:Ve,width:ye,height:st,fill:`url(#${Gn})`,rx:"10",filter:Tn?"url(#premiumGlowLocal)":"url(#bevelEffectLocal)",style:{transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer"},children:[r.jsx("animate",{attributeName:"height",from:"0",to:st,dur:"2s",begin:`${Pe*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),r.jsx("animate",{attributeName:"y",from:J,to:Ve,dur:"2s",begin:`${Pe*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),Tn&&r.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;1.05;1",dur:"3s",repeatCount:"indefinite",begin:`${Pe*.3+2}s`})]}),r.jsx("rect",{x:ke+2,y:Ve+2,width:ye-4,height:Math.max(st/2.5,30),fill:"url(#metallicShineLocal)",rx:"8",opacity:"0.6",children:r.jsx("animateTransform",{attributeName:"transform",type:"translate",values:`-${ye};${ye}`,dur:"4s",repeatCount:"indefinite",begin:`${Pe*.5+3}s`})}),r.jsx("rect",{x:ke+3,y:Ve+3,width:Math.max(ye/4,8),height:Math.max(st-6,20),fill:"rgba(255,255,255,0.4)",rx:"6"}),r.jsx("rect",{x:ke+ye-6,y:Ve+6,width:"3",height:Math.max(st-12,15),fill:"rgba(255,255,255,0.2)",rx:"1.5"}),r.jsxs("g",{children:[r.jsx("rect",{x:ke+ye/2-30,y:Ve-28,width:"60",height:"20",fill:"rgba(0,0,0,0.8)",rx:"10",opacity:"0.9"}),r.jsxs("text",{x:ke+ye/2,y:Ve-15,textAnchor:"middle",fontSize:"12",fill:"white",fontWeight:"bold",children:[". ",Le.toLocaleString()]})]}),r.jsx("g",{children:(()=>{const Mn=Me.supplierName,bs=Mn.length*7,Xs=Math.max(bs+20,ye+10);return r.jsxs(r.Fragment,{children:[r.jsx("rect",{x:ke+ye/2-Xs/2,y:J+30,width:Xs,height:22,fill:"rgba(255,255,255,0.96)",rx:"11",stroke:"rgba(0,123,255,0.5)",strokeWidth:"1.5",filter:"url(#dropShadowLocal)"}),r.jsx("text",{x:ke+ye/2,y:J+41,textAnchor:"middle",fontSize:"11",fill:"#1e40af",fontWeight:"700",style:{fontFamily:"system-ui, -apple-system, sans-serif",letterSpacing:"0.2px"},dominantBaseline:"middle",children:Mn})]})})()}),Tn&&r.jsxs("g",{children:[r.jsx("circle",{cx:ke+ye/2,cy:Ve-100,r:"18",fill:"linear-gradient(135deg, #ffd700 0%, #ffb300 100%)",stroke:"#fff",strokeWidth:"3",filter:"url(#dropShadowLocal)"}),r.jsx("text",{x:ke+ye/2,y:Ve-95,textAnchor:"middle",fontSize:"16",fill:"#fff",children:""}),r.jsx("rect",{x:ke-5,y:Ve-70,width:ye+10,height:"20",fill:"#28a745",rx:"10",opacity:"0.9"}),r.jsx("text",{x:ke+ye/2,y:Ve-57,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:" "})]})]},Me.id)}),r.jsx("text",{x:Re/2,y:30,textAnchor:"middle",fontSize:"16",fill:"url(#bestPriceGradientLocal)",fontWeight:"bold",direction:"rtl",children:"   "}),r.jsxs("g",{transform:`translate(${Re/2}, ${J+110})`,children:[r.jsx("rect",{x:"-200",y:"-25",width:"400",height:"145",fill:"rgba(255,255,255,0.98)",rx:"20",stroke:"url(#bestPriceGradientLocal)",strokeWidth:"2",filter:"url(#dropShadowLocal)"}),r.jsx("text",{x:"0",y:"-5",textAnchor:"middle",fontSize:"16",fill:"#1f2937",fontWeight:"800",letterSpacing:"0.5px",children:" "}),r.jsxs("g",{transform:"translate(0, 15)",children:[r.jsxs("g",{transform:"translate(-125, 0)",children:[r.jsxs("g",{transform:"translate(0, 0)",children:[r.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#bestPriceGradientLocal)",rx:"7",filter:"url(#premiumGlowLocal)"}),r.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#059669",fontWeight:"700",children:" "}),r.jsx("text",{x:"80",y:"13",fontSize:"18",children:""})]}),r.jsx("line",{x1:"110",y1:"-5",x2:"110",y2:"19",stroke:"rgba(0,0,0,0.15)",strokeWidth:"2"}),r.jsxs("g",{transform:"translate(125, 0)",children:[r.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#regularPriceGradientLocal)",rx:"7"}),r.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#6366f1",fontWeight:"700",children:" "}),r.jsx("text",{x:"90",y:"13",fontSize:"16",children:""})]})]}),r.jsxs("g",{transform:"translate(0, 40)",children:[r.jsx("rect",{x:"-170",y:"-8",width:"340",height:"22",fill:"rgba(59, 130, 246, 0.08)",rx:"11"}),r.jsxs("text",{x:"0",y:"5",textAnchor:"middle",fontSize:"14",fill:"#1e40af",fontWeight:"700",children:["   : ",(Math.max(...Ee)-Math.min(...Ee)).toLocaleString()," ."]})]}),r.jsx("g",{transform:"translate(0, 90)",children:r.jsxs("text",{x:"0",y:"0",textAnchor:"middle",fontSize:"12",fill:"#6b7280",fontWeight:"600",children:["  : ",Math.max(...Ee).toLocaleString()," .      : ",Math.min(...Ee).toLocaleString()," ."]})})]})]})]})})()})]})})()})})})]})}),r.jsx("div",{className:"col-12",children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsx("div",{className:"d-flex justify-content-between align-items-center",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-list-ul text-primary me-2"}),"   (",k.length,")"]})})}),r.jsx("div",{className:"card-body p-0",children:k.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-receipt fs-1"})}),r.jsx("h5",{className:"text-muted",children:"   "}),r.jsx("p",{className:"text-muted",children:"      "})]}):r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"60px"},children:"#"}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:" ()"}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",style:{width:"120px"},children:""})]})}),r.jsx("tbody",{children:k.map((w,X)=>{const ne=k.length>=1&&k.reduce((W,ie)=>{const Ee=parseFloat(W.price)||0;return(parseFloat(ie.price)||0)<Ee?ie:W}).id===w.id;return r.jsxs("tr",{className:ne?"table-success":"",children:[r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:X+1})}),r.jsxs("td",{className:"text-center",children:[r.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},onClick:W=>{W.preventDefault(),W.stopPropagation(),console.log("Button clicked, calling handleSupplierEdit..."),He(w.supplierName)},title:` : ${w.supplierName}`,type:"button",children:w.supplierName}),ne&&r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:`badge ${w.supplierType==="local"?"bg-success":"bg-info"}`,children:w.supplierType==="local"?"":""})}),r.jsx("td",{className:"text-center",children:w.date}),r.jsxs("td",{className:"text-center",children:[w.price," ",ne&&r.jsx("i",{className:"bi bi-arrow-down-circle-fill text-success ms-2",title:" "})]}),r.jsx("td",{className:"text-center",children:w.quotationFile&&r.jsx(ay,{size:25,clickable:!0,onClick:()=>{w.quotationFileURL?window.open(w.quotationFileURL,"_blank"):(console.log("No file URL available for:",w.quotationFile),alert("   "))},title:` : ${w.quotationFileName||w.quotationFile}`})}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"btn-group btn-group-sm",children:[r.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>Xt(w),title:"",children:r.jsx("i",{className:"bi bi-pencil"})}),r.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>Lt(w),title:"",children:r.jsx("i",{className:"bi bi-trash"})})]})})]},w.id)})})]})})})]})})]})]}),r.jsx("div",{className:"card-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:r.jsxs("div",{className:"d-flex gap-3",style:{marginBottom:"15px"},children:[r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:at,disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""}),r.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:l?" ...":r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"bi bi-check-lg me-1"}),F?"":""]})})]})})]})]})}),r.jsx("div",{className:"app-footer",style:{textAlign:"center",padding:"20px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",marginTop:"20px"},children:r.jsx("span",{children:" Modern Bin 2025"})})]})]})]}),!n&&t&&r.jsx(_n,{rtl:!0}),!n&&t&&r.jsx(En,{}),f&&r.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:r.jsx("div",{className:"modal-dialog modal-lg",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[r.jsxs("div",{className:"modal-header border-0 pb-2",children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-receipt text-primary me-2"}),"  "]}),r.jsx("button",{type:"button",className:"btn-close",onClick:fe,style:{fontSize:"12px"}})]}),r.jsxs("form",{onSubmit:Yt,onReset:w=>w.preventDefault(),children:[r.jsxs("div",{className:"modal-body px-4",children:[a.fileUpload&&r.jsxs("div",{className:"alert alert-danger mb-3",children:[r.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.fileUpload]}),r.jsxs("div",{className:"row",children:[r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:"  *"}),r.jsx("select",{className:"form-select",name:"supplierType",value:"local",onChange:Pt,required:!0,disabled:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"},children:r.jsx("option",{value:"local",children:" "})})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:" *"}),r.jsxs("div",{className:"form-control d-flex align-items-center justify-content-between",onClick:Ce,style:{cursor:"pointer",backgroundColor:"#f8f9fa"},children:[r.jsx("span",{className:$.supplierName?"text-dark":"text-muted",children:$.supplierName||" "}),r.jsx("i",{className:"bi bi-chevron-down"})]})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:"  *"}),r.jsx("input",{type:"date",className:"form-control",name:"date",value:$.date,onChange:Pt,required:!0})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:" () *"}),r.jsx("input",{type:"number",step:"0.01",min:"0",className:"form-control",name:"price",value:$.price,onChange:Pt,onKeyPress:w=>{(w.key==="-"||w.key!=="."&&w.key!=="Backspace"&&(w.key<"0"||w.key>"9"))&&w.preventDefault()},placeholder:"0.00",required:!0})]}),r.jsxs("div",{className:"col-md-12 mb-3",children:[r.jsxs("label",{className:"form-label fw-bold",children:["   ",O?"()":"*"]}),r.jsxs("div",{className:"mb-2",children:[r.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.jpg,.png,.jpeg",style:{display:"none"},ref:w=>{w&&(w.onclick=()=>{w.value=""},w.onchange=X=>{var W;const ne=(W=X.target.files)==null?void 0:W[0];ne&&gt(ne)})},id:`fileInput_${f}_${Date.now()}`}),r.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>{const w=document.querySelector(`#fileInput_${f}_${Date.now()}`);if(w)w.click();else{const X=document.createElement("input");X.type="file",X.accept=".pdf,.doc,.docx,.jpg,.png,.jpeg",X.style.display="none",X.onchange=ne=>{var ie;const W=(ie=ne.target.files)==null?void 0:ie[0];W&&gt(W),document.body.removeChild(X)},document.body.appendChild(X),X.click()}},style:{borderRadius:"6px",height:"38px",minWidth:"150px"},children:[r.jsx("i",{className:"bi bi-upload me-2"})," "]})]}),$.quotationFile&&r.jsxs("div",{className:"alert alert-success py-2 mb-2",style:{position:"relative"},children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-check-circle me-2 text-success"}),r.jsxs("div",{className:"flex-grow-1",children:[r.jsx("strong",{children:$.quotationFile.name?$.supplierName?`  ${$.supplierName}.${$.quotationFile.name.split(".").pop()}`:$.quotationFile.name:O?$.supplierName?`  ${$.supplierName}.pdf`:((In=k.find(w=>w.id===O))==null?void 0:In.quotationFileName)||" ":" "}),r.jsxs("small",{className:"text-muted ms-2",children:["(",$.quotationFile.size?Math.round($.quotationFile.size/1024):O?Math.round((((qn=k.find(w=>w.id===O))==null?void 0:qn.quotationFileSize)||0)/1024):0," KB)"]})]})]}),r.jsx("button",{type:"button",className:"btn-close btn-close-sm",onClick:()=>{Z(w=>({...w,quotationFile:null}))},title:" ",style:{position:"absolute",top:"8px",left:"8px",width:"20px",height:"20px",fontSize:"10px",opacity:.7},onMouseEnter:w=>w.target.style.opacity=1,onMouseLeave:w=>w.target.style.opacity=.7})]}),O&&!$.quotationFile&&r.jsxs("div",{className:"alert alert-info py-2 mb-2",children:[r.jsx("i",{className:"bi bi-info-circle me-2"}),r.jsxs("small",{children:[" : ",((Hn=k.find(w=>w.id===O))==null?void 0:Hn.quotationFileName)||" "]})]}),!$.quotationFile&&!O&&r.jsx("div",{className:"mt-1",children:r.jsxs("small",{className:"text-muted",children:[r.jsx("i",{className:"bi bi-info-circle me-1"}),"   PDF  Word  "]})})]})]})]}),r.jsx("div",{className:"modal-footer border-0 pt-0 d-flex justify-content-center",style:{marginBottom:"10px"},children:r.jsxs("div",{className:"d-flex gap-3",children:[r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:fe,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""}),r.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:l?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"10px",height:"10px"}}),"..."]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"bi bi-check-lg me-1"}),""]})})]})})]})]})})}),x&&r.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:r.jsx("div",{className:"modal-dialog modal-xl",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[r.jsxs("div",{className:"modal-header border-0 pb-2",style:{marginBottom:"5px"},children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-people-fill text-primary me-2"}),"  ",r.jsxs("span",{className:"text-muted ms-2",children:["(",Bn().length,")"]})]}),r.jsx("button",{type:"button",className:"btn-close",onClick:Ne,style:{fontSize:"12px"}})]}),r.jsx("div",{className:"modal-body p-0",children:Bn().length>0?r.jsx("div",{className:"table-responsive suppliers-table",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"50px"}}),r.jsx("th",{children:" "}),r.jsx("th",{children:" "}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsx("tbody",{children:Bn().map(w=>r.jsxs("tr",{onClick:()=>ot(w),style:{cursor:"pointer"},children:[r.jsx("td",{className:"text-center",children:r.jsx("div",{className:"form-check d-flex justify-content-center",children:r.jsx("input",{className:"form-check-input custom-radio",type:"radio",name:"selectedSupplier",checked:(D==null?void 0:D.id)===w.id,onChange:()=>{},style:{pointerEvents:"none",width:"18px",height:"18px",borderWidth:"2px",borderColor:(D==null?void 0:D.id)===w.id?"#007bff":"#dee2e6"}})})}),r.jsx("td",{children:r.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},children:w.name})}),r.jsx("td",{children:r.jsx("a",{href:`mailto:${w.email}`,className:"text-decoration-none",children:w.email})}),r.jsx("td",{children:w.phone}),r.jsx("td",{children:w.city||"-"})]},w.id))})]})}):r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-people fs-1"})}),r.jsx("h5",{className:"text-muted",children:"  "}),r.jsx("p",{className:"text-muted",children:"    "})]})}),r.jsx("div",{className:"modal-footer border-0 d-flex justify-content-center",style:{marginTop:"15px"},children:r.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:Fe,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",margin:"20px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:""})})]})})}),g&&j&&r.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:w=>{w.target===w.currentTarget&&Xe()},children:r.jsx("div",{className:"modal-dialog modal-lg",onClick:w=>w.stopPropagation(),children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[r.jsxs("div",{className:"modal-header border-0",children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"  - ",j==null?void 0:j.name,r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:""})]}),r.jsx("button",{type:"button",className:"btn-close",onClick:Xe})]}),r.jsx("div",{className:"modal-body",children:r.jsxs("div",{className:"row g-3",children:[r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:j==null?void 0:j.name})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:(j==null?void 0:j.email)||""})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:(j==null?void 0:j.phone)||""})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:(j==null?void 0:j.city)||""})]}),r.jsxs("div",{className:"col-12",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:(j==null?void 0:j.address)||""})]}),(j==null?void 0:j.taxNumber)&&r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:j.taxNumber})]}),(j==null?void 0:j.bankAccount)&&r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:"  "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:j.bankAccount})]}),(j==null?void 0:j.notes)&&r.jsxs("div",{className:"col-12",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:j.notes})]})]})}),r.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:r.jsx("div",{className:"d-flex gap-3",children:r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:Xe,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""})})})]})})})]}),r.jsx(an,{show:l,message:F?"   ...":"   ..."}),r.jsx(Wt,{show:ee.show,onClose:se,title:ee.title,message:ee.message,type:ee.type,onConfirm:ee.onConfirm,confirmText:ee.confirmText,cancelText:ee.cancelText,showCancel:ee.showCancel}),r.jsx(cy,{position:"bottom-right",showDetails:!0})]})}function EI(){return r.jsx(At,{children:r.jsx(_9,{})})}const E9=({refreshTrigger:n})=>{const[e,t]=b.useState([]),[s,i]=b.useState(!0),[a,o]=b.useState(null),[l,c]=b.useState(""),[d,h]=b.useState([]),[f,p]=b.useState(!1),[x,I]=b.useState(!1),[D,A]=b.useState(!1),[g,N]=b.useState(null),[j,V]=b.useState([]),[$,Z]=b.useState([]),O=On(),{logActivity:M,getCurrentUser:T}=$t(),{alertConfig:L,closeAlert:G,showSuccess:U,showError:k,showConfirm:re}=Kt(),{currentPage:xe,totalPages:H,paginatedItems:ee,handlePageChange:se,resetPage:Y,totalItems:R,itemsPerPage:_}=Ni(d,30);b.useEffect(()=>{C(),z()},[]),b.useEffect(()=>{n&&C()},[n]),b.useEffect(()=>{if(l.trim()){const E=e.filter(te=>{var Te,ze,We,at;return((Te=te.name)==null?void 0:Te.toLowerCase().includes(l.toLowerCase()))||((ze=te.category)==null?void 0:ze.toLowerCase().includes(l.toLowerCase()))||((We=te.description)==null?void 0:We.toLowerCase().includes(l.toLowerCase()))||((at=te.supplier)==null?void 0:at.toLowerCase().includes(l.toLowerCase()))});h(E)}else h(e);Y()},[l,e,Y]);const C=async()=>{try{i(!0);const E=await Ls.getAllForeignProducts();t(E),o(null)}catch(E){o(E.message)}finally{i(!1)}},z=async()=>{try{const[E,te]=await Promise.all([ri.getAllSuppliers(),ii.getAllSuppliers()]);V(E),Z(te)}catch(E){console.error("Error loading suppliers:",E)}},K=async(E,te)=>{try{if(te==="local"){const Te=j.find(ze=>ze.name===E);Te&&(N(Te),I(!0))}else if(te==="foreign"){const Te=$.find(ze=>ze.name===E);Te&&(N(Te),A(!0))}}catch(Te){console.error("Error opening supplier modal:",Te)}},F=()=>{I(!1),A(!1),N(null)},Q=E=>{re(`       

${E.name}`,()=>oe(E),"   ")},oe=async E=>{try{p(!0),await un.moveToTrash(E,"foreignproducts"),await Ls.deleteForeignProduct(E.id);const te=T();M("task",`${te.name}   `,`   : ${E.name}`),await C(),U(`    : ${E.name}`,"  ")}catch(te){o(te.message),k(`     : ${te.message}`,"  ")}finally{p(!1)}};return s?r.jsx(an,{show:!0,message:"    ...",overlay:!1}):a?r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"text-danger mb-3",children:r.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),r.jsx("h5",{className:"text-danger",children:" "}),r.jsx("p",{className:"text-muted",children:a}),r.jsxs("button",{className:"btn btn-primary",onClick:C,children:[r.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):r.jsxs("div",{className:"card shadow-sm","data-list":"foreign-products",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"row align-items-center justify-content-between",children:[r.jsx("div",{className:"col-lg-4",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),"   (",d.length,")"]})}),r.jsx("div",{className:"col-lg-8",children:r.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[r.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[r.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:l,onChange:E=>c(E.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),r.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:r.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),r.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:()=>O("/foreign-products/add"),style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[r.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"   "]})]})})]})}),r.jsxs("div",{className:"card-body p-0",children:[d.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-box-seam fs-1"})}),r.jsx("h5",{className:"text-muted",children:"   "}),r.jsx("p",{className:"text-muted",children:l?"    ":"      "}),!l&&r.jsxs("button",{className:"btn btn-primary",onClick:()=>O("/foreign-products/add"),children:[r.jsx("i",{className:"bi bi-plus-lg me-1"}),"   "]})]}):r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",style:{width:"120px"},children:""})]})}),r.jsx("tbody",{children:ee.map((E,te)=>{let Te=E.price,ze=E.supplier,We=!1,at=null,zt=null;return E.priceQuotes&&Array.isArray(E.priceQuotes)&&E.priceQuotes.length>0&&(We=!0,zt=E.priceQuotes.reduce((fe,Ce)=>{const Ne=parseFloat(fe.price)||0;return(parseFloat(Ce.price)||0)<Ne?Ce:fe}),Te=zt.price,ze=zt.supplierName,at=zt.supplierType),r.jsxs("tr",{children:[r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(xe-1)*_+te+1})}),r.jsx("td",{className:"text-center",children:r.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary product-name-btn",onClick:fe=>{if(fe.preventDefault(),fe.stopPropagation(),console.log("=== FOREIGN PRODUCT BUTTON CLICKED ==="),console.log("Product Name:",E.name),console.log("Product ID:",E.id),E.id){const Ce=`/foreign-products/edit/${E.id}`;console.log("Target URL:",Ce),console.log(" FORCING NAVIGATION TO:",Ce),window.location.href=Ce}else console.error("Product ID is missing:",E),k("     ","  ")},onMouseDown:fe=>fe.preventDefault(),style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0",userSelect:"none",pointerEvents:"auto",zIndex:"1"},title:`  | Internal ID: ${E.internalId||"Not Set"} | Firebase ID: ${E.id||"Missing"}`,children:E.name})}),r.jsx("td",{className:"text-center",children:E.category||"-"}),r.jsx("td",{className:"text-center",children:E.unit||"-"}),r.jsx("td",{className:"text-center",children:Te?r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsxs("span",{children:[Te," "]}),We&&r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),r.jsx("td",{className:"text-center",children:ze?r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[We&&at?r.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",onClick:()=>K(ze,at),style:{textDecoration:"none"},title:`  ${at==="local"?" ":" "}`,children:ze}):r.jsx("span",{children:ze}),We&&r.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"btn-group btn-group-sm",children:[r.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>O(`/foreign-products/edit/${E.id}`),title:"",children:r.jsx("i",{className:"bi bi-pencil"})}),r.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>Q(E),title:"",children:r.jsx("i",{className:"bi bi-trash"})})]})})]},E.internalId||E.id)})})]})}),d.length>0&&r.jsx(ji,{currentPage:xe,totalPages:H,onPageChange:se,totalItems:R,itemsPerPage:_})]}),x&&g&&r.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:E=>{E.target===E.currentTarget&&F()},children:r.jsx("div",{className:"modal-dialog modal-lg",onClick:E=>E.stopPropagation(),children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[r.jsxs("div",{className:"modal-header border-0",children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"  - ",g.name,r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:""})]}),r.jsx("button",{type:"button",className:"btn-close",onClick:F})]}),r.jsx("div",{className:"modal-body",children:r.jsxs("div",{className:"row g-3",children:[r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.name})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.email||""})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:g.phone||""})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.city||""})]}),r.jsxs("div",{className:"col-12",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.address||""})]}),g.taxNumber&&r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.taxNumber})]}),g.bankAccount&&r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:"  "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.bankAccount})]}),g.notes&&r.jsxs("div",{className:"col-12",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.notes})]})]})}),r.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:F,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""})})]})})}),D&&g&&r.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:E=>{E.target===E.currentTarget&&F()},children:r.jsx("div",{className:"modal-dialog modal-lg",onClick:E=>E.stopPropagation(),children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[r.jsxs("div",{className:"modal-header border-0",children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"  - ",g.name,r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:""})]}),r.jsx("button",{type:"button",className:"btn-close",onClick:F})]}),r.jsx("div",{className:"modal-body",children:r.jsxs("div",{className:"row g-3",children:[r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.name})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.email||""})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:g.phone||""})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.country||""})]}),r.jsxs("div",{className:"col-12",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.address||""})]}),g.taxNumber&&r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.taxNumber})]}),g.bankAccount&&r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:"  "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.bankAccount})]}),g.notes&&r.jsxs("div",{className:"col-12",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:g.notes})]})]})}),r.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:F,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""})})]})})}),r.jsx(Wt,{show:L.show,onClose:G,title:L.title,message:L.message,type:L.type,onConfirm:L.onConfirm,confirmText:L.confirmText,cancelText:L.cancelText,showCancel:L.showCancel})]})};function S9(){const[n,e]=b.useState(!1),[t,s]=b.useState(0),{isTimelineVisible:i}=gn(),a=()=>{e(!n)};return r.jsx(At,{children:r.jsx(Dt,{children:r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[r.jsx(Nn,{onToggle:a}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!i?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),r.jsx(jn,{}),r.jsx("div",{className:"app-content-area p-3",children:r.jsx("div",{className:"foreign-products-table",children:r.jsx(E9,{refreshTrigger:t})})}),r.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:r.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&i&&r.jsx(_n,{rtl:!0}),!n&&i&&r.jsx(En,{})]})})})}function I9(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(S9,{})})})}function T9(){var In,qn,Hn;const[n,e]=b.useState(!1),{isTimelineVisible:t}=gn(),[s,i]=b.useState({name:"",category:"",description:"",unit:"",price:"",supplier:"",stockQuantity:"",minimumStock:"",importLicense:"",customsCode:"",origin:"",notes:"",active:!0}),[a,o]=b.useState({}),[l,c]=b.useState(!1),[d,h]=b.useState(!1),[f,p]=b.useState(!1),[x,I]=b.useState(!1),[D,A]=b.useState(null),[g,N]=b.useState(!1),[j,V]=b.useState(null),[$,Z]=b.useState({supplierType:"foreign",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),[O,M]=b.useState(null),[T,L]=b.useState([]),[G,U]=b.useState([]),[k,re]=b.useState([]),[xe,H]=b.useState(!1),{alertConfig:ee,closeAlert:se,showSuccess:Y,showError:R,showConfirm:_}=Kt(),C=w=>{if(w.length===0)return;const X=w.reduce((ne,W)=>{const ie=parseFloat(ne.price)||0;return(parseFloat(W.price)||0)<ie?W:ne});console.log("Lowest price quote found:",X),i(ne=>({...ne,price:X.price,supplier:X.supplierName}))},z=On(),{id:K}=li(),F=!!K,{logActivity:Q,getCurrentUser:oe}=$t(),E=()=>{e(!n)};b.useEffect(()=>{F&&Te(),te();const w=()=>{F&&K&&(console.log("Window focused - refreshing foreign product data..."),Te())};return window.addEventListener("focus",w),()=>{window.removeEventListener("focus",w)}},[K]),b.useEffect(()=>{var w;console.log("PriceQuoteData changed:",{hasFile:!!$.quotationFile,fileName:(w=$.quotationFile)==null?void 0:w.name,supplierName:$.supplierName,price:$.price})},[$]);const te=async()=>{try{const[w,X]=await Promise.all([ri.getAllSuppliers(),ii.getAllSuppliers()]);L(w),U(X)}catch(w){console.error("Error loading suppliers:",w)}},Te=async()=>{try{h(!0),console.log("Loading foreign product data for ID:",K);const w=await Ls.getAllForeignProducts(),X=w.find(ne=>ne.id===K);X?(console.log("Foreign product found:",X.name),i({name:X.name||"",category:X.category||"",description:X.description||"",unit:X.unit||"",price:X.price||"",supplier:X.supplier||"",stockQuantity:X.stockQuantity||"",minimumStock:X.minimumStock||"",importLicense:X.importLicense||"",customsCode:X.customsCode||"",origin:X.origin||"",notes:X.notes||"",active:X.active!==void 0?X.active:!0}),X.priceQuotes&&Array.isArray(X.priceQuotes)?(console.log("Loading price quotes for foreign product:",X.name,X.priceQuotes),console.log("Price quotes analysis:"),X.priceQuotes.forEach((ne,W)=>{console.log(`Quote ${W}:`,{id:ne.id,supplierName:ne.supplierName,price:ne.price,hasId:!!ne.id,keys:Object.keys(ne)})}),re(X.priceQuotes),setTimeout(()=>{C(X.priceQuotes)},200)):console.log("No price quotes found for foreign product:",X.name)):(console.error("Foreign product not found with ID:",K),console.log("Available foreign products:",w.map(ne=>({id:ne.id,name:ne.name}))),o({submit:"      "}))}catch(w){console.error("Error loading foreign product:",w),o({submit:"     : "+w.message})}finally{h(!1)}},ze=w=>{const{name:X,value:ne,type:W,checked:ie}=w.target;i(Ee=>({...Ee,[X]:W==="checkbox"?ie:ne})),a[X]&&o(Ee=>({...Ee,[X]:""}))},We=async w=>{w.preventDefault();const X=Ls.validateForeignProductData(s);if(k.length===0&&(X.priceQuotes="      "),Object.keys(X).length>0){o(X);return}c(!0),o({});try{const ne=await _i.validateUniqueFields({name:s.name},F?K:null,F?"foreignproducts":null);if(Object.keys(ne).length>0){o(ne),c(!1);return}const W={...s,price:parseFloat(s.price)||0,stockQuantity:parseFloat(s.stockQuantity)||0,minimumStock:parseFloat(s.minimumStock)||0,priceQuotes:k,status:"active"};if(console.log("Saving foreign product with price quotes:",{name:W.name,priceQuotes:W.priceQuotes,priceQuotesCount:W.priceQuotes.length}),F){await Ls.updateForeignProduct(K,W);const ie=oe();Q("task",`${ie.name}   `,`   : ${W.name}`)}else{await Ls.addForeignProduct(W);const ie=oe();Q("task",`${ie.name}   `,`   : ${W.name}`)}z("/foreign-products")}catch(ne){o({submit:ne.message})}finally{c(!1)}},at=()=>{z("/foreign-products")},zt=()=>{p(!0)},fe=()=>{p(!1),M(null),Z({supplierType:"foreign",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),o(w=>({...w,fileUpload:""})),console.log("Modal closed and state reset")},Ce=()=>{I(!0)},Ne=()=>{I(!1),A(null)},He=w=>{console.log("Supplier Name:",w);try{console.log("Using already loaded foreign supplier data...");const X=G;console.log("Available foreign suppliers:",X.length),console.log("Foreign suppliers list:",X.map(W=>({id:W.id,name:W.name})));const ne=X.find(W=>W.name===w);console.log("Found supplier:",ne?"YES":"NO"),ne?(console.log("SUCCESS: Foreign supplier found:",ne.name),console.log("Supplier data:",ne),V(ne),N(!0),console.log("Modal state should be true now"),setTimeout(()=>{console.log("Modal state check - showSupplierEditModal:",g),console.log("Modal state check - selectedSupplierToEdit:",j==null?void 0:j.name)},100)):(console.error("FOREIGN SUPPLIER NOT FOUND"),console.error("Looking for supplier name:",w),console.error("Available suppliers:",X.map(W=>W.name)),X.length===0?(console.log("No suppliers loaded, triggering data reload..."),loadSuppliersData(),R("    .   ...","  ")):R(`     : ${w}`,"  "))}catch(X){console.error("=== FOREIGN SUPPLIER SEARCH ERROR ==="),console.error("Error details:",X),console.error("Error message:",X.message),R(`     : ${X.message}`,"  ")}},Xe=()=>{console.log("Called by:",new Error().stack),N(!1),V(null)},ot=w=>{A(w)},Fe=()=>{D&&Z(w=>{var ne,W;console.log("Before supplier selection - preserving file:",(ne=w.quotationFile)==null?void 0:ne.name);const X={...w,supplier:D.id,supplierName:D.name};return console.log("After supplier selection - file preserved:",(W=X.quotationFile)==null?void 0:W.name),X}),I(!1),A(null)},gt=w=>{console.log("File details:",{name:w==null?void 0:w.name,size:w==null?void 0:w.size,type:w==null?void 0:w.type,lastModified:w==null?void 0:w.lastModified}),a.fileUpload&&o(X=>({...X,fileUpload:""})),Z(X=>{var W;const ne={...X,quotationFile:w};return console.log("Updated priceQuoteData with file:",{hasFile:!!ne.quotationFile,fileName:(W=ne.quotationFile)==null?void 0:W.name}),ne})},Pt=w=>{const{name:X,value:ne,type:W}=w.target;W!=="file"&&Z(X==="supplierType"?ie=>({...ie,[X]:ne,supplier:"",supplierName:""}):ie=>({...ie,[X]:ne}))},Yt=async w=>{if(w.preventDefault(),console.log("Form element:",w.target),console.log("Current priceQuoteData:",$),console.log("Editing quote ID:",O),!$.supplierName){o(ie=>({...ie,fileUpload:"   "}));return}if(!$.date){o(ie=>({...ie,fileUpload:"   "}));return}if(!$.price){o(ie=>({...ie,fileUpload:"  "}));return}const X=new FormData(w.target),ne=X.get("quotationFile");console.log("File from form directly:",ne),console.log("File from state:",$.quotationFile);const W=$.quotationFile||ne;console.log("File to upload:",W),console.log("File upload details:",{exists:!!W,isFile:W instanceof File,name:W==null?void 0:W.name,size:W==null?void 0:W.size,type:W==null?void 0:W.type,lastModified:W==null?void 0:W.lastModified});try{if(c(!0),!O&&(!W||W.size===0))throw new Error("    ");let ie=null;if(console.log("File upload analysis:",{hasFileInState:!!$.quotationFile,hasFileInForm:!!ne,hasFileToUpload:!!W,fileType:typeof W,fileName:W==null?void 0:W.name,fileSize:W==null?void 0:W.size}),W&&typeof W!="string"&&W.size>0){console.log("Starting file upload:",W.name);try{zs.validateFile(W,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}),console.log("File validation passed")}catch(Ee){throw console.error("File validation failed:",Ee),new Error(Ee.message)}console.log("Attempting file upload to Firebase...");try{const Ee=W.name.split(".").pop()||"pdf",le=$.supplierName?`  ${$.supplierName}.${Ee}`:W.name;console.log("Uploading with custom name:",le),ie=await zs.uploadFileWithCustomName(W,"quotations",le),console.log("File uploaded successfully:",ie)}catch(Ee){throw console.error("Firebase upload failed:",Ee),new Error(`   : ${Ee.message}`)}}else console.log("No valid file to upload:",{fileExists:!!W,isString:typeof W=="string",hasSize:(W==null?void 0:W.size)>0});if(O)console.log("Updating existing price quote with ID:",O),re(Ee=>{const le=Ee.map(ge=>ge.id===O?{...ge,supplierType:$.supplierType,supplier:$.supplier,supplierName:$.supplierName,date:$.date,price:$.price,quotationFile:ie?ie.path:ge.quotationFile,quotationFileURL:ie?ie.url:ge.quotationFileURL,quotationFileName:ie?ie.originalName:ge.quotationFileName,quotationFileSize:ie?ie.size:ge.quotationFileSize,quotationFileType:ie?ie.type:ge.quotationFileType,updatedAt:new Date}:ge);return console.log("Updated price quotes:",le),setTimeout(()=>{C(le)},100),le});else{const Ee={id:Date.now().toString(),supplierType:$.supplierType,supplier:$.supplier,supplierName:$.supplierName,date:$.date,price:$.price,quotationFile:ie?ie.path:null,quotationFileURL:ie?ie.url:null,quotationFileName:ie?ie.originalName:null,quotationFileSize:ie?ie.size:null,quotationFileType:ie?ie.type:null,createdAt:new Date};console.log("Adding new price quote:",Ee),re(le=>{const ge=[...le,Ee];return console.log("Updated price quotes:",ge),setTimeout(()=>{C(ge)},100),ge})}a.priceQuotes&&o(Ee=>({...Ee,priceQuotes:""})),fe(),F&&K&&setTimeout(async()=>{try{console.log("Auto-saving foreign product after price quote change..."),re(Ee=>{const le={...X,priceQuotes:Ee};return Ls.updateForeignProduct(K,le).then(()=>{console.log("Auto-save successful")}).catch(ge=>{console.error("Auto-save failed:",ge),R("   ","  ")}),Ee})}catch(Ee){console.error("Auto-save setup error:",Ee)}},200)}catch(ie){console.error("Error uploading file:",ie),o(Ee=>({...Ee,fileUpload:ie.message||"   .   ."}))}finally{c(!1)}},Xt=w=>{console.log("Starting edit for quote:",w),M(w.id),Z({supplierType:w.supplierType||"local",supplier:w.supplier||"",supplierName:w.supplierName||"",date:w.date||"",price:w.price||"",quotationFile:w.quotationFile||null}),p(!0)},Lt=w=>{if(console.log("Price quote delete button clicked:",w),console.log("Quote ID:",w==null?void 0:w.id),console.log("Quote keys:",w?Object.keys(w):"quote is null/undefined"),!w||!w.id){console.error("Invalid quote object - missing quote or ID:",{quote:w,hasId:!!(w!=null&&w.id),quoteId:w==null?void 0:w.id,quoteType:typeof w}),R("    ","");return}_(`      

${w.supplierName} - ${w.price} `,()=>on(w),"   ")},on=async w=>{if(console.log("Delete confirmation called for quote:",w),console.log("Confirmation - Quote ID:",w==null?void 0:w.id),console.log("Confirmation - Quote keys:",w?Object.keys(w):"quote is null/undefined"),console.log("Is editing mode:",F),console.log("Foreign product ID:",K),console.log("Form data name:",s.name),!w||!w.id){console.error("Invalid quote in confirmation - missing quote or ID:",{quote:w,hasId:!!(w!=null&&w.id),quoteId:w==null?void 0:w.id,quoteType:typeof w}),R("    ",""),H(!1);return}try{if(H(!0),console.log("Starting delete process..."),console.log("Moving to trash..."),F&&K){const ne={...w,foreignProductId:K,foreignProductName:s.name};console.log("Quote with context for trash:",ne),console.log("Calling SimpleTrashService.moveToTrash...");const W=await un.moveToTrash(ne,"price_quotes");console.log("Trash service result:",W),console.log("Moved to trash successfully")}else console.log("Skipping trash - foreign product not saved yet (isEditing:",F,", id:",K,")");const X=oe();console.log("Logging activity with current user:",X),Q("task",`${X.name}   `,`   : ${w.supplierName} - ${w.price} `),console.log("Updating local state..."),console.log("Current price quotes before deletion:",k),re(ne=>{const W=ne.filter(ie=>ie.id!==w.id);return console.log("Filtered quotes:",W.length,"from",ne.length),console.log("Removed quote with ID:",w.id),console.log("Remaining quotes:",W.map(ie=>({id:ie.id,supplierName:ie.supplierName}))),setTimeout(()=>{C(W)},100),W}),console.log("Showing success message..."),F&&K?Y(`    : ${w.supplierName}`,"  "):Y(`   : ${w.supplierName}`," "),console.log("Delete process completed successfully"),F&&K&&setTimeout(async()=>{try{console.log("Auto-saving foreign product after price quote deletion..."),re(ne=>{const W={...s,priceQuotes:ne};return Ls.updateForeignProduct(K,W).then(()=>{console.log("Auto-save after deletion successful")}).catch(ie=>{console.error("Auto-save after deletion failed:",ie)}),ne})}catch(ne){console.error("Auto-save after deletion setup error:",ne)}},200)}catch(X){console.error("Error deleting price quote:",X),console.error("Error stack:",X.stack),R(`    : ${X.message||"  "}`,"  ")}finally{console.log("Setting deleting to false"),H(!1)}},Bn=()=>($.supplierType==="local"?T:G).filter(ne=>{const W=ne.hasOwnProperty("active"),ie=ne.hasOwnProperty("status");return W?ne.active===!0:ie?ne.status==="active":!0});return d?r.jsx(an,{show:!0,message:"    ..."}):r.jsxs(Dt,{children:[r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[r.jsx(Nn,{onToggle:E}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsxs("div",{style:{position:"sticky",top:0,zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item",children:r.jsx("a",{href:"/foreign-products",className:"text-decoration-none text-primary",children:" "})}),r.jsx("li",{className:"breadcrumb-item",children:r.jsx("a",{href:"/foreign-products",className:"text-decoration-none text-primary",children:" "})}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:F?"  ":"   "})]})}),r.jsx(jn,{})]}),r.jsxs("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:[r.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"60px"},children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsxs("div",{className:"card-header bg-white border-bottom py-4 d-flex align-items-center",children:[r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),F?"  ":"   "]}),r.jsx("div",{style:{flex:1}}),r.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:zt,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:"1",paddingTop:"2px"},children:" "})]}),r.jsxs("form",{onSubmit:We,children:[r.jsxs("div",{className:"card-body p-4",children:[a.submit&&r.jsxs("div",{className:"alert alert-danger",children:[r.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.submit]}),r.jsxs("div",{className:"row mb-4",children:[r.jsx("div",{className:"col-12",children:r.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[r.jsx("i",{className:"bi bi-info-circle me-2"})," "]})}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:"   *"}),r.jsx("input",{type:"text",className:`form-control ${a.name?"is-invalid":""}`,name:"name",value:s.name,onChange:ze,placeholder:"   "}),a.name&&r.jsx("div",{className:"invalid-feedback",children:a.name})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:" *"}),r.jsx(oy,{name:"category",value:s.category,onChange:ze,required:!0,className:`form-select ${a.category?"is-invalid":""}`,placeholder:" ",showDescription:!0}),a.category&&r.jsx("div",{className:"invalid-feedback",children:a.category})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:" *"}),r.jsx(ly,{name:"unit",value:s.unit,onChange:ze,required:!0,className:`form-select ${a.unit?"is-invalid":""}`,placeholder:" ",showDescription:!0}),a.unit&&r.jsx("div",{className:"invalid-feedback",children:a.unit})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsxs("label",{className:"form-label fw-bold",children:[" () *",r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:k.length>0?"  ":" "})]}),r.jsx("input",{type:"number",step:"0.01",min:"0",className:`form-control ${a.price?"is-invalid":""}`,name:"price",value:s.price,onChange:null,onKeyPress:null,placeholder:"0.00",readOnly:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"}}),a.price&&r.jsx("div",{className:"invalid-feedback",children:a.price}),r.jsx("div",{className:"mt-1",children:r.jsxs("small",{className:"text-muted",children:[r.jsx("i",{className:"bi bi-info-circle me-1"}),k.length>0?"        ":"       "]})})]}),r.jsxs("div",{className:"col-md-12 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:""}),r.jsx("textarea",{className:"form-control",name:"description",value:s.description,onChange:ze,rows:"3",placeholder:"  "})]}),r.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:r.jsxs("div",{className:"d-flex align-items-center gap-2",children:[r.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"":" "}),r.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"foreignProductActiveSwitch",name:"active",checked:s.active,onChange:ze,style:{width:"48px",height:"24px",marginRight:"8px"}})]})})]}),r.jsxs("div",{className:"row mb-4",children:[r.jsxs("div",{className:"col-12",children:[r.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[r.jsx("i",{className:"bi bi-receipt me-2"})," "]}),a.priceQuotes&&r.jsxs("div",{className:"alert alert-danger",children:[r.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.priceQuotes]})]}),k.length>0&&r.jsx("div",{className:"col-12",children:r.jsxs("div",{className:"card mb-3 border-0 shadow-lg",style:{background:"linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%)",borderRadius:"16px"},children:[r.jsx("div",{className:"card-header border-0",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"16px 16px 0 0",padding:"20px"},children:r.jsxs("h5",{className:"card-title text-white mb-0 d-flex align-items-center",children:[r.jsx("div",{className:"me-3",style:{background:"rgba(255,255,255,0.2)",borderRadius:"12px",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsx("i",{className:"bi bi-bar-chart-fill fs-5"})}),r.jsx("span",{className:"fw-bold",children:"  "}),r.jsxs("span",{className:"badge bg-light text-primary ms-3",style:{borderRadius:"20px",fontSize:"12px",padding:"6px 12px"},children:[k.length," "]})]})}),r.jsx("div",{className:"card-body",style:{padding:"30px"},children:r.jsx("div",{style:{minHeight:"625px",direction:"ltr"},children:r.jsx("div",{style:{width:"100%",height:"605px",position:"relative"},children:(()=>{k.map(Ee=>parseFloat(Ee.price)||0);const w=640,W=k.length*150,ie=Math.max(w,W);return r.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${ie+160} 605`,style:{direction:"ltr"},children:[r.jsxs("defs",{children:[r.jsxs("linearGradient",{id:"chartBgForeign",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#ffffff",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#f8f9ff",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"bestPriceGradientForeign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#00f5a0",stopOpacity:1}}),r.jsx("stop",{offset:"30%",style:{stopColor:"#00d9f5",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#0066cc",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"regularPriceGradientForeign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),r.jsx("stop",{offset:"50%",style:{stopColor:"#764ba2",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#f093fb",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient0Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#764ba2",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient1Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#f093fb",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#f5576c",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient2Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#4facfe",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#00f2fe",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient3Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#a8edea",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#fed6e3",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient4Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#ffecd2",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#fcb69f",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient5Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#a18cd1",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#fbc2eb",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient6Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#fad0c4",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#ffd1ff",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"gradient7Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"#a1c4fd",stopOpacity:1}}),r.jsx("stop",{offset:"100%",style:{stopColor:"#c2e9fb",stopOpacity:1}})]}),r.jsxs("linearGradient",{id:"metallicShineForeign",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),r.jsx("stop",{offset:"45%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),r.jsx("stop",{offset:"50%",style:{stopColor:"rgba(255,255,255,0.8)",stopOpacity:1}}),r.jsx("stop",{offset:"55%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),r.jsx("stop",{offset:"100%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}})]}),r.jsx("filter",{id:"dropShadowForeign",x:"-50%",y:"-50%",width:"200%",height:"200%",children:r.jsx("feDropShadow",{dx:"0",dy:"6",stdDeviation:"8",floodColor:"rgba(0,0,0,0.15)"})}),r.jsxs("filter",{id:"premiumGlowForeign",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[r.jsx("feGaussianBlur",{stdDeviation:"5",result:"coloredBlur"}),r.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0 0 0  0 1 1 0 0  0 0 1 0 0  0 0 0 1 0"}),r.jsxs("feMerge",{children:[r.jsx("feMergeNode",{in:"coloredBlur"}),r.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),r.jsxs("filter",{id:"bevelEffectForeign",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[r.jsx("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2",result:"blur"}),r.jsx("feSpecularLighting",{in:"blur",result:"specOut",surfaceScale:"5",specularConstant:"0.8",specularExponent:"20","lighting-color":"white",children:r.jsx("fePointLight",{x:"-50",y:"-50",z:"200"})}),r.jsx("feComposite",{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut2"}),r.jsx("feComposite",{in:"SourceGraphic",in2:"specOut2",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"})]}),r.jsxs("filter",{id:"pulseGlowForeign",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[r.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),r.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0.8 0 0  0 1 1 0 0  0 0 1 0.2 0  0 0 0 1 0"}),r.jsxs("feMerge",{children:[r.jsx("feMergeNode",{in:"coloredBlur"}),r.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),r.jsx("rect",{width:ie+160,height:"605",fill:"url(#chartBgForeign)",rx:"12",style:{filter:"drop-shadow(0 4px 20px rgba(0,0,0,0.1))"}}),r.jsx("g",{transform:"translate(80, 40)",children:(()=>{const Ee=k.map(Me=>parseFloat(Me.price)||0),le=Math.max(...Ee),ge=Math.min(...Ee),_e=le-ge||1,J=300,ae=640,Ie=k.length*150,Re=Math.max(ae,Ie),ye=Math.min(Re/k.length*.6,80),ue=Re/k.length;return r.jsxs(r.Fragment,{children:[[0,1,2,3,4,5].map(Me=>{const Le=130+(J-130)/5*Me,ke=(1-Me/5)*Math.max(...Ee);return r.jsxs("g",{children:[r.jsx("line",{x1:"0",y1:Le,x2:Re,y2:Le,stroke:Me===5?"#007bff":"rgba(123, 140, 252, 0.2)",strokeWidth:Me===5?"2":"1",strokeDasharray:Me===5?"0":"5,5"}),r.jsx("text",{x:"-15",y:Le+5,textAnchor:"end",fontSize:"12",fill:"#4f46e5",fontWeight:"600",children:Math.round(ke).toLocaleString()})]},Me)}),k.map((Me,Pe)=>{const Le=parseFloat(Me.price)||0;let st;if(_e>0){const Mn=J-130,bs=Le/Math.max(...Ee);st=Math.max(bs*Mn,15)}else st=(J-130)*.8;const ke=ue*Pe+(ue-ye)/2,Ve=J-st,Tn=Le===ge;let Gn;return Tn?Gn="bestPriceGradientForeign":Gn=`gradient${Pe%8}Foreign`,r.jsxs("g",{children:[r.jsx("rect",{x:ke+4,y:Ve+8,width:ye,height:st,fill:"rgba(0,0,0,0.05)",rx:"10"}),r.jsx("rect",{x:ke+2,y:Ve+4,width:ye,height:st,fill:"rgba(0,0,0,0.08)",rx:"9"}),r.jsxs("rect",{x:ke,y:Ve,width:ye,height:st,fill:`url(#${Gn})`,rx:"10",filter:Tn?"url(#premiumGlowForeign)":"url(#bevelEffectForeign)",style:{transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer"},children:[r.jsx("animate",{attributeName:"height",from:"0",to:st,dur:"2s",begin:`${Pe*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),r.jsx("animate",{attributeName:"y",from:J,to:Ve,dur:"2s",begin:`${Pe*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),Tn&&r.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;1.05;1",dur:"3s",repeatCount:"indefinite",begin:`${Pe*.3+2}s`})]}),r.jsx("rect",{x:ke+2,y:Ve+2,width:ye-4,height:Math.max(st/2.5,30),fill:"url(#metallicShineForeign)",rx:"8",opacity:"0.6",children:r.jsx("animateTransform",{attributeName:"transform",type:"translate",values:`-${ye};${ye}`,dur:"4s",repeatCount:"indefinite",begin:`${Pe*.5+3}s`})}),r.jsx("rect",{x:ke+3,y:Ve+3,width:Math.max(ye/4,8),height:Math.max(st-6,20),fill:"rgba(255,255,255,0.4)",rx:"6"}),r.jsx("rect",{x:ke+ye-6,y:Ve+6,width:"3",height:Math.max(st-12,15),fill:"rgba(255,255,255,0.2)",rx:"1.5"}),r.jsxs("g",{children:[r.jsx("rect",{x:ke+ye/2-30,y:Ve-28,width:"60",height:"20",fill:"rgba(0,0,0,0.8)",rx:"10",opacity:"0.9"}),r.jsxs("text",{x:ke+ye/2,y:Ve-15,textAnchor:"middle",fontSize:"12",fill:"white",fontWeight:"bold",children:[". ",Le.toLocaleString()]})]}),r.jsx("g",{children:(()=>{const Mn=Me.supplierName,bs=Mn.length*7,Xs=Math.max(bs+20,ye+10);return r.jsxs(r.Fragment,{children:[r.jsx("rect",{x:ke+ye/2-Xs/2,y:J+30,width:Xs,height:22,fill:"rgba(255,255,255,0.96)",rx:"11",stroke:"rgba(0,123,255,0.5)",strokeWidth:"1.5",filter:"url(#dropShadowForeign)"}),r.jsx("text",{x:ke+ye/2,y:J+41,textAnchor:"middle",fontSize:"11",fill:"#1e40af",fontWeight:"700",style:{fontFamily:"system-ui, -apple-system, sans-serif",letterSpacing:"0.2px"},dominantBaseline:"middle",children:Mn})]})})()}),Tn&&r.jsxs("g",{children:[r.jsx("circle",{cx:ke+ye/2,cy:Ve-100,r:"18",fill:"linear-gradient(135deg, #ffd700 0%, #ffb300 100%)",stroke:"#fff",strokeWidth:"3",filter:"url(#dropShadowForeign)"}),r.jsx("text",{x:ke+ye/2,y:Ve-95,textAnchor:"middle",fontSize:"16",fill:"#fff",children:""}),r.jsx("rect",{x:ke-5,y:Ve-70,width:ye+10,height:"20",fill:"#28a745",rx:"10",opacity:"0.9"}),r.jsx("text",{x:ke+ye/2,y:Ve-57,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:" "})]})]},Me.id)}),r.jsx("text",{x:Re/2,y:30,textAnchor:"middle",fontSize:"16",fill:"url(#bestPriceGradientForeign)",fontWeight:"bold",direction:"rtl",children:"   "}),r.jsxs("g",{transform:`translate(${Re/2}, ${J+110})`,children:[r.jsx("rect",{x:"-200",y:"-25",width:"400",height:"145",fill:"rgba(255,255,255,0.98)",rx:"20",stroke:"url(#bestPriceGradientForeign)",strokeWidth:"2",filter:"url(#dropShadowForeign)"}),r.jsx("text",{x:"0",y:"-5",textAnchor:"middle",fontSize:"16",fill:"#1f2937",fontWeight:"800",letterSpacing:"0.5px",children:" "}),r.jsxs("g",{transform:"translate(0, 15)",children:[r.jsxs("g",{transform:"translate(-125, 0)",children:[r.jsxs("g",{transform:"translate(0, 0)",children:[r.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#bestPriceGradientForeign)",rx:"7",filter:"url(#premiumGlowForeign)"}),r.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#059669",fontWeight:"700",children:" "}),r.jsx("text",{x:"80",y:"13",fontSize:"18",children:""})]}),r.jsx("line",{x1:"110",y1:"-5",x2:"110",y2:"19",stroke:"rgba(0,0,0,0.15)",strokeWidth:"2"}),r.jsxs("g",{transform:"translate(125, 0)",children:[r.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#regularPriceGradientForeign)",rx:"7"}),r.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#6366f1",fontWeight:"700",children:" "}),r.jsx("text",{x:"90",y:"13",fontSize:"16",children:""})]})]}),r.jsxs("g",{transform:"translate(0, 40)",children:[r.jsx("rect",{x:"-170",y:"-8",width:"340",height:"22",fill:"rgba(59, 130, 246, 0.08)",rx:"11"}),r.jsxs("text",{x:"0",y:"5",textAnchor:"middle",fontSize:"14",fill:"#1e40af",fontWeight:"700",children:["   : ",(Math.max(...Ee)-Math.min(...Ee)).toLocaleString()," ."]})]}),r.jsx("g",{transform:"translate(0, 90)",children:r.jsxs("text",{x:"0",y:"0",textAnchor:"middle",fontSize:"12",fill:"#6b7280",fontWeight:"600",children:["  : ",Math.max(...Ee).toLocaleString()," .      : ",Math.min(...Ee).toLocaleString()," ."]})})]})]})]})})()})]})})()})})})]})}),r.jsx("div",{className:"col-12",children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsx("div",{className:"d-flex justify-content-between align-items-center",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-list-ul text-primary me-2"}),"   (",k.length,")"]})})}),r.jsx("div",{className:"card-body p-0",children:k.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-receipt fs-1"})}),r.jsx("h5",{className:"text-muted",children:"   "}),r.jsx("p",{className:"text-muted",children:"      "})]}):r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"60px"},children:"#"}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:" ()"}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",style:{width:"120px"},children:""})]})}),r.jsx("tbody",{children:k.map((w,X)=>{const ne=k.length>=1&&k.reduce((W,ie)=>{const Ee=parseFloat(W.price)||0;return(parseFloat(ie.price)||0)<Ee?ie:W}).id===w.id;return r.jsxs("tr",{className:ne?"table-success":"",children:[r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:X+1})}),r.jsxs("td",{className:"text-center",children:[r.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},onClick:W=>{W.preventDefault(),W.stopPropagation(),console.log("Button clicked, calling handleSupplierEdit..."),He(w.supplierName)},title:` : ${w.supplierName}`,type:"button",children:w.supplierName}),ne&&r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:`badge ${w.supplierType==="local"?"bg-success":"bg-info"}`,children:w.supplierType==="local"?"":""})}),r.jsx("td",{className:"text-center",children:w.date}),r.jsxs("td",{className:"text-center",children:[w.price," ",ne&&r.jsx("i",{className:"bi bi-arrow-down-circle-fill text-success ms-2",title:" "})]}),r.jsx("td",{className:"text-center",children:w.quotationFile&&r.jsx(ay,{size:25,clickable:!0,onClick:()=>{w.quotationFileURL?window.open(w.quotationFileURL,"_blank"):(console.log("No file URL available for:",w.quotationFile),alert("   "))},title:` : ${w.quotationFileName||w.quotationFile}`})}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"btn-group btn-group-sm",children:[r.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>Xt(w),title:"",children:r.jsx("i",{className:"bi bi-pencil"})}),r.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>Lt(w),title:"",children:r.jsx("i",{className:"bi bi-trash"})})]})})]},w.id)})})]})})})]})})]})]}),r.jsx("div",{className:"card-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:r.jsxs("div",{className:"d-flex gap-3",style:{marginBottom:"15px"},children:[r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:at,disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""}),r.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:l?" ...":r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"bi bi-check-lg me-1"}),F?"":""]})})]})})]})]})}),r.jsx("div",{className:"app-footer",style:{textAlign:"center",padding:"20px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",marginTop:"20px"},children:r.jsx("span",{children:" Modern Bin 2025"})})]})]})]}),!n&&t&&r.jsx(_n,{rtl:!0}),!n&&t&&r.jsx(En,{}),f&&r.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:r.jsx("div",{className:"modal-dialog modal-lg",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[r.jsxs("div",{className:"modal-header border-0 pb-2",children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-receipt text-primary me-2"}),"  "]}),r.jsx("button",{type:"button",className:"btn-close",onClick:fe,style:{fontSize:"12px"}})]}),r.jsxs("form",{onSubmit:Yt,onReset:w=>w.preventDefault(),children:[r.jsxs("div",{className:"modal-body px-4",children:[a.fileUpload&&r.jsxs("div",{className:"alert alert-danger mb-3",children:[r.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.fileUpload]}),r.jsxs("div",{className:"row",children:[r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:"  *"}),r.jsx("select",{className:"form-select",name:"supplierType",value:$.supplierType,onChange:Pt,required:!0,disabled:!0,children:r.jsx("option",{value:"foreign",children:" "})})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:" *"}),r.jsxs("div",{className:"form-control d-flex align-items-center justify-content-between",onClick:Ce,style:{cursor:"pointer",backgroundColor:"#f8f9fa"},children:[r.jsx("span",{className:$.supplierName?"text-dark":"text-muted",children:$.supplierName||" "}),r.jsx("i",{className:"bi bi-chevron-down"})]})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:"  *"}),r.jsx("input",{type:"date",className:"form-control",name:"date",value:$.date,onChange:Pt,required:!0})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:" () *"}),r.jsx("input",{type:"number",step:"0.01",min:"0",className:"form-control",name:"price",value:$.price,onChange:Pt,onKeyPress:w=>{(w.key==="-"||w.key!=="."&&w.key!=="Backspace"&&(w.key<"0"||w.key>"9"))&&w.preventDefault()},placeholder:"0.00",required:!0})]}),r.jsxs("div",{className:"col-md-12 mb-3",children:[r.jsxs("label",{className:"form-label fw-bold",children:["   ",O?"()":"*"]}),r.jsxs("div",{className:"mb-2",children:[r.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.jpg,.png,.jpeg",style:{display:"none"},ref:w=>{w&&(w.onclick=()=>{w.value=""},w.onchange=X=>{var W;const ne=(W=X.target.files)==null?void 0:W[0];ne&&gt(ne)})},id:`fileInput_${f}_${Date.now()}`}),r.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>{const w=document.querySelector(`#fileInput_${f}_${Date.now()}`);if(w)w.click();else{const X=document.createElement("input");X.type="file",X.accept=".pdf,.doc,.docx,.jpg,.png,.jpeg",X.style.display="none",X.onchange=ne=>{var ie;const W=(ie=ne.target.files)==null?void 0:ie[0];W&&gt(W),document.body.removeChild(X)},document.body.appendChild(X),X.click()}},style:{borderRadius:"6px",height:"38px",minWidth:"150px"},children:[r.jsx("i",{className:"bi bi-upload me-2"})," "]})]}),$.quotationFile&&r.jsxs("div",{className:"alert alert-success py-2 mb-2",style:{position:"relative"},children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-check-circle me-2 text-success"}),r.jsxs("div",{className:"flex-grow-1",children:[r.jsx("strong",{children:$.quotationFile.name?$.supplierName?`  ${$.supplierName}.${$.quotationFile.name.split(".").pop()}`:$.quotationFile.name:O?$.supplierName?`  ${$.supplierName}.pdf`:((In=k.find(w=>w.id===O))==null?void 0:In.quotationFileName)||" ":" "}),r.jsxs("small",{className:"text-muted ms-2",children:["(",$.quotationFile.size?Math.round($.quotationFile.size/1024):O?Math.round((((qn=k.find(w=>w.id===O))==null?void 0:qn.quotationFileSize)||0)/1024):0," KB)"]})]})]}),r.jsx("button",{type:"button",className:"btn-close btn-close-sm",onClick:()=>{Z(w=>({...w,quotationFile:null}))},title:" ",style:{position:"absolute",top:"8px",left:"8px",width:"20px",height:"20px",fontSize:"10px",opacity:.7},onMouseEnter:w=>w.target.style.opacity=1,onMouseLeave:w=>w.target.style.opacity=.7})]}),O&&!$.quotationFile&&r.jsxs("div",{className:"alert alert-info py-2 mb-2",children:[r.jsx("i",{className:"bi bi-info-circle me-2"}),r.jsxs("small",{children:[" : ",((Hn=k.find(w=>w.id===O))==null?void 0:Hn.quotationFileName)||" "]})]}),!$.quotationFile&&!O&&r.jsx("div",{className:"mt-1",children:r.jsxs("small",{className:"text-muted",children:[r.jsx("i",{className:"bi bi-info-circle me-1"}),"   PDF  Word  "]})})]})]})]}),r.jsx("div",{className:"modal-footer border-0 pt-0 d-flex justify-content-center",style:{marginBottom:"10px"},children:r.jsxs("div",{className:"d-flex gap-3",children:[r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:fe,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""}),r.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:l?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"10px",height:"10px"}}),"..."]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"bi bi-check-lg me-1"}),""]})})]})})]})]})})}),x&&r.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:r.jsx("div",{className:"modal-dialog modal-xl",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[r.jsxs("div",{className:"modal-header border-0 pb-2",style:{marginBottom:"5px"},children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-people-fill text-primary me-2"}),$.supplierType==="local"?"  ":"  ",r.jsxs("span",{className:"text-muted ms-2",children:["(",Bn().length,")"]})]}),r.jsx("button",{type:"button",className:"btn-close",onClick:Ne,style:{fontSize:"12px"}})]}),r.jsx("div",{className:"modal-body p-0",children:Bn().length>0?r.jsx("div",{className:"table-responsive suppliers-table",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"50px"}}),r.jsx("th",{children:" "}),r.jsx("th",{children:" "}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsx("tbody",{children:Bn().map(w=>r.jsxs("tr",{onClick:()=>ot(w),style:{cursor:"pointer"},children:[r.jsx("td",{className:"text-center",children:r.jsx("div",{className:"form-check d-flex justify-content-center",children:r.jsx("input",{className:"form-check-input custom-radio",type:"radio",name:"selectedSupplier",checked:(D==null?void 0:D.id)===w.id,onChange:()=>{},style:{pointerEvents:"none",width:"18px",height:"18px",borderWidth:"2px",borderColor:(D==null?void 0:D.id)===w.id?"#007bff":"#dee2e6"}})})}),r.jsx("td",{children:r.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},children:w.name})}),r.jsx("td",{children:r.jsx("a",{href:`mailto:${w.email}`,className:"text-decoration-none",children:w.email})}),r.jsx("td",{children:w.phone}),r.jsx("td",{children:w.city||"-"})]},w.id))})]})}):r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-people fs-1"})}),r.jsx("h5",{className:"text-muted",children:"  "}),r.jsxs("p",{className:"text-muted",children:["  ",$.supplierType==="local"?" ":" "," "]})]})}),r.jsx("div",{className:"modal-footer border-0 d-flex justify-content-center",style:{marginTop:"15px"},children:r.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:Fe,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",margin:"20px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:""})})]})})}),g&&j&&r.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:w=>{w.target===w.currentTarget&&Xe()},children:r.jsx("div",{className:"modal-dialog modal-lg",onClick:w=>w.stopPropagation(),children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[r.jsxs("div",{className:"modal-header border-0",children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"  - ",j==null?void 0:j.name,r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:""})]}),r.jsx("button",{type:"button",className:"btn-close",onClick:Xe})]}),r.jsx("div",{className:"modal-body",children:r.jsxs("div",{className:"row g-3",children:[r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:j==null?void 0:j.name})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:(j==null?void 0:j.email)||""})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:(j==null?void 0:j.phone)||""})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:(j==null?void 0:j.country)||""})]}),r.jsxs("div",{className:"col-12",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:(j==null?void 0:j.address)||""})]}),(j==null?void 0:j.taxNumber)&&r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:j.taxNumber})]}),(j==null?void 0:j.bankAccount)&&r.jsxs("div",{className:"col-md-6",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:"  "}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:j.bankAccount})]}),(j==null?void 0:j.notes)&&r.jsxs("div",{className:"col-12",children:[r.jsx("label",{className:"form-label fw-bold text-muted",children:""}),r.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:j.notes})]})]})}),r.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:r.jsx("div",{className:"d-flex gap-3",children:r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:Xe,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""})})})]})})})]}),r.jsx(an,{show:l,message:F?"   ...":"   ..."}),r.jsx(Wt,{show:ee.show,onClose:se,title:ee.title,message:ee.message,type:ee.type,onConfirm:ee.onConfirm,confirmText:ee.confirmText,cancelText:ee.cancelText,showCancel:ee.showCancel}),r.jsx(cy,{position:"bottom-right",showDetails:!0})]})}function SI(){return r.jsx(At,{children:r.jsx(T9,{})})}const C9=({refreshTrigger:n})=>{const e=On();console.log("ManufacturedProductsListFixed is rendering");const[t,s]=b.useState([]),[i,a]=b.useState(!0),[o,l]=b.useState(null),[c,d]=b.useState(""),[h,f]=b.useState([]),[p,x]=b.useState(!1),[I,D]=b.useState(!1),{logActivity:A,getCurrentUser:g}=$t(),{alertConfig:N,closeAlert:j,showSuccess:V,showError:$,showConfirm:Z}=Kt(),{formatDate:O}=Pu(),{currentPage:M,totalPages:T,paginatedItems:L,handlePageChange:G,resetPage:U,totalItems:k,itemsPerPage:re}=Ni(h,30);console.log("ManufacturedProductsListFixed state:",{productsCount:t.length,loading:i,error:o});const xe=async()=>{try{a(!0),l(null),console.log("Loading manufactured products...");const se=await Ta.getAllManufacturedProducts();console.log("Manufactured products loaded:",se.length),s(se)}catch(se){console.error("Error loading manufactured products:",se),l(se.message||"    ")}finally{a(!1)}};b.useEffect(()=>{(async()=>{try{if(console.log(" [List] Initializing Firebase authentication..."),It.currentUser){console.log(" [List] User already authenticated:",It.currentUser.uid),D(!0);return}return HN(It,async R=>{if(R)console.log(" [List] User authenticated:",R.uid),D(!0);else{console.log(" [List] No user found, attempting anonymous sign-in...");try{await Xz(It),console.log(" [List] Anonymous sign-in successful"),D(!0)}catch(_){console.error(" [List] Anonymous sign-in failed:",_),D(!1)}}})}catch(Y){console.error(" [List] Auth initialization error:",Y),l("   ")}})()},[]),b.useEffect(()=>{I&&xe()},[n,I]),b.useEffect(()=>{if(c.trim()){const se=t.filter(Y=>{var R,_,C;return((R=Y.title)==null?void 0:R.toLowerCase().includes(c.toLowerCase()))||((_=Y.referenceNumber)==null?void 0:_.toLowerCase().includes(c.toLowerCase()))||((C=Y.description)==null?void 0:C.toLowerCase().includes(c.toLowerCase()))});f(se)}else f(t);U()},[c,t,U]);const H=se=>{Z(`       

${se.title}`,()=>ee(se),"   ")},ee=async se=>{try{x(!0),await un.moveToTrash(se,"manufacturedProducts"),await Ta.deleteManufacturedProduct(se.id);const Y=g();A("task",`${Y.name}   `,`   : ${se.title}`),xe(),V(`    : ${se.title}`,"  ")}catch(Y){console.error("Error deleting manufactured product:",Y),$(`     : ${Y.message}`,"  ")}finally{x(!1)}};return i?(console.log("ManufacturedProductsListFixed: Showing loading state"),r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"spinner-border text-primary",role:"status",children:r.jsx("span",{className:"visually-hidden",children:" ..."})}),r.jsx("p",{className:"mt-3 text-muted",children:"    ..."})]})})):o?(console.log("ManufacturedProductsListFixed: Showing error state:",o),r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"text-danger mb-3",children:r.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),r.jsx("h5",{className:"text-danger",children:" "}),r.jsx("p",{className:"text-muted",children:o}),r.jsx("div",{className:"d-flex gap-2 justify-content-center",children:r.jsxs("button",{className:"btn btn-primary",onClick:xe,children:[r.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"  "]})})]})})):(console.log("ManufacturedProductsListFixed: Showing main content with",h.length,"products"),r.jsxs("div",{className:"card shadow-sm","data-list":"manufactured-products",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"row align-items-center justify-content-between",children:[r.jsx("div",{className:"col-lg-4",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-gear-wide-connected text-primary me-2"}),"   (",h.length,")"]})}),r.jsx("div",{className:"col-lg-8",children:r.jsx("div",{className:"d-flex justify-content-end align-items-center gap-3",children:r.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[r.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:c,onChange:se=>d(se.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),r.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:r.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]})})})]})}),r.jsxs("div",{className:"card-body p-0",children:[h.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-gear-wide-connected fs-1"})}),r.jsx("h5",{className:"text-muted",children:"   "}),r.jsx("p",{className:"text-muted",children:c?"    ":"      "}),!c&&r.jsxs("button",{className:"btn btn-primary",onClick:()=>e("/manufactured-products/add"),children:[r.jsx("i",{className:"bi bi-plus-lg me-1"}),"   "]})]}):r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),r.jsx("th",{className:"text-center",children:"  "}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",style:{width:"120px",paddingLeft:"40px"},children:""})]})}),r.jsx("tbody",{children:L.map((se,Y)=>r.jsxs("tr",{children:[r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(M-1)*re+Y+1})}),r.jsx("td",{className:"text-center",children:r.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary product-title-btn",onClick:()=>{se.id?e(`/manufactured-products/edit/${se.id}`):$("     ","  ")},style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0"},title:`  | Firebase ID: ${se.id||"Missing"}`,children:se.title})}),r.jsx("td",{className:"text-center",children:r.jsxs("span",{className:"badge bg-success text-white",children:[(()=>{let R=0;return se.items&&Array.isArray(se.items)&&se.items.length>0?R=se.items.reduce((_,C)=>_+(C.totalPrice||0),0):R=se.estimatedValue||0,R.toLocaleString("en-US")})()," ."]})}),r.jsx("td",{className:"text-center",children:O(se.submissionDeadline)}),r.jsx("td",{className:"text-center",style:{paddingLeft:"40px"},children:r.jsxs("div",{className:"btn-group btn-group-sm",children:[r.jsx("button",{className:"btn btn-outline-primary",onClick:()=>{if(!se||!se.id){$("     ","  ");return}e(`/manufactured-products/edit/${se.id}`)},title:"",children:r.jsx("i",{className:"bi bi-pencil"})}),r.jsx("button",{className:"btn btn-outline-danger",onClick:()=>H(se),title:"",children:r.jsx("i",{className:"bi bi-trash"})})]})})]},se.internalId||se.id||`product-${Y}`))})]})}),h.length>0&&r.jsx(ji,{currentPage:M,totalPages:T,onPageChange:G,totalItems:k,itemsPerPage:re})]}),r.jsx(Wt,{show:N.show,onClose:j,title:N.title,message:N.message,type:N.type,onConfirm:N.onConfirm,showConfirm:N.showConfirm})]}))};function A9(){const[n,e]=b.useState(!1),[t,s]=b.useState(0),{isTimelineVisible:i}=gn(),a=On(),o=()=>{e(!n)};return r.jsx(At,{children:r.jsx(Dt,{children:r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[r.jsx(Nn,{onToggle:o}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!i?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"  "})]})}),r.jsx(jn,{}),r.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:r.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[r.jsx("div",{className:"d-flex align-items-center",children:r.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[r.jsx("i",{className:"bi bi-gear-wide-connected text-primary me-2"}),"  "]})}),r.jsx("button",{onClick:()=>a("/manufactured-products/add"),className:"btn btn-primary",style:{height:"32px",width:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:" "})]})}),r.jsx("div",{className:"card-body p-0",children:r.jsx(C9,{refreshTrigger:t})})]})})})]}),!n&&i&&r.jsx(_n,{rtl:!0}),!n&&i&&r.jsx(En,{})]})]})})})}function D9(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(A9,{})})})}function R9(){const n=On(),{id:e}=li(),{logActivity:t,getCurrentUser:s}=$t(),{alertConfig:i,closeAlert:a,showSuccess:o,showError:l,showConfirm:c}=Kt(),{isTimelineVisible:d}=gn(),{formatDate:h}=Pu(),f=!!e,[p,x]=b.useState(!1),[I,D]=b.useState(!1),[A,g]=b.useState(()=>(console.log(" Initializing form data, will load from Firebase..."),{title:"",referenceNumber:"",description:"",submissionDeadline:"",estimatedValue:""})),[N,j]=b.useState({}),[V,$]=b.useState(!1),[Z,O]=b.useState(!1),[M,T]=b.useState(!1),[L,G]=b.useState(""),[U,k]=b.useState(!1),[re,xe]=b.useState([]),[H,ee]=b.useState(!1),[se,Y]=b.useState(!1),[R,_]=b.useState(null),[C,z]=b.useState(""),[K,F]=b.useState(!1),[Q,oe]=b.useState(!1),[E,te]=b.useState(null),[Te,ze]=b.useState(-1),[We,at]=b.useState([]),zt=()=>{x(!p)},[fe,Ce]=b.useState(!1),Ne=async()=>{if(We.length===0){l("   "," ");return}Ce(!0);try{console.log(" PRODUCTITEMS RAW DATA:",JSON.stringify(We,null,2)),console.log(" Starting direct price refresh for",We.length,"items");let le=0;const ge=[];for(const _e of We){console.log(" Refreshing item:",{name:_e.materialName,type:_e.materialType,id:_e.materialInternalId,currentPrice:_e.unitPrice});try{let J=null;if(_e.materialType==="rawMaterial"){console.log(" Looking up raw material with ID:",_e.materialInternalId);let ae=await Os.getRawMaterialByInternalId(_e.materialInternalId);if(!ae){console.log(" InternalId lookup failed, trying Firebase document ID...");try{ae=await Os.getRawMaterial(_e.id)}catch{console.log(" Firebase ID lookup also failed")}}if(!ae){console.log(" All lookups failed, trying to find by name...");try{ae=(await Os.getAllRawMaterials()).find(Se=>Se.name===_e.materialName),console.log(" Found by name:",ae?"YES":"NO")}catch{console.log(" Name lookup also failed")}}J=parseFloat(ae==null?void 0:ae.price)||null,console.log(" Final raw material result:",{found:!!ae,price:ae==null?void 0:ae.price,newPrice:J})}else if(_e.materialType==="localProduct"){console.log(" Looking up local product with ID:",_e.materialInternalId);let ae=await Ms.getLocalProductByInternalId(_e.materialInternalId);if(!ae){console.log(" InternalId lookup failed, trying Firebase document ID...");try{ae=await Ms.getLocalProduct(_e.id)}catch{console.log(" Firebase ID lookup also failed")}}if(!ae){console.log(" All lookups failed, trying to find by name...");try{ae=(await Ms.getAllLocalProducts()).find(Se=>Se.name===_e.materialName),console.log(" Found by name:",ae?"YES":"NO")}catch{console.log(" Name lookup also failed")}}J=parseFloat(ae==null?void 0:ae.price)||null,console.log(" Final local product result:",{found:!!ae,price:ae==null?void 0:ae.price,newPrice:J})}else if(_e.materialType==="foreignProduct"){console.log(" Looking up foreign product with ID:",_e.materialInternalId);let ae=await Ls.getForeignProductByInternalId(_e.materialInternalId);if(!ae){console.log(" InternalId lookup failed, trying Firebase document ID...");try{ae=await Ls.getForeignProduct(_e.id)}catch{console.log(" Firebase ID lookup also failed")}}if(!ae){console.log(" All lookups failed, trying to find by name...");try{ae=(await Ls.getAllForeignProducts()).find(Se=>Se.name===_e.materialName),console.log(" Found by name:",ae?"YES":"NO")}catch{console.log(" Name lookup also failed")}}J=parseFloat(ae==null?void 0:ae.price)||null,console.log(" Final foreign product result:",{found:!!ae,price:ae==null?void 0:ae.price,newPrice:J})}if(console.log(" EXACT VALUES:",{itemName:_e.materialName,currentUnitPrice:_e.unitPrice,currentUnitPriceType:typeof _e.unitPrice,sourcePrice:J,sourcePriceType:typeof J,areEqual:J===_e.unitPrice,willUpdate:J!==null&&J!==_e.unitPrice}),J!==null&&J!==_e.unitPrice){console.log(" UPDATING PRICE for",_e.materialName,":",_e.unitPrice,"",J);const ae={..._e,unitPrice:J,totalPrice:J*(_e.quantity||1)};ge.push(ae),le++}else console.log(" NO UPDATE for",_e.materialName,"- Current:",_e.unitPrice,"Source:",J),ge.push(_e)}catch(J){console.error(" Failed to refresh item:",_e.materialName,J),ge.push(_e)}}if(at(ge),f&&le>0)try{console.log(" Saving manufactured product with updated prices to database...");const _e=ge.reduce((je,Se)=>je+(Se.unitPrice||0)*(Se.quantity||1),0);g(je=>({...je,estimatedValue:_e.toString()}));const J={...A,estimatedValue:_e.toString(),items:ge,updatedAt:new Date,lastPriceRefresh:new Date};await Ta.updateManufacturedProduct(e,J);const ae=s();t("task",`${ae.name}    `,`  ${le}   : ${A.title||" "}`),console.log(" Manufactured product saved successfully with updated prices"),setTimeout(()=>{console.log(" Navigating to manufactured products list..."),n("/manufactured-products")},1500)}catch(_e){console.error(" Failed to save manufactured product:",_e),l(`      : ${(_e==null?void 0:_e.message)||_e}`,"")}else le>0}catch(le){console.error(" Refresh failed:",le),l(`   : ${(le==null?void 0:le.message)||le}`,"  ")}finally{Ce(!1)}};b.useEffect(()=>{(async()=>{try{if(console.log(" Initializing Firebase authentication..."),It.currentUser){console.log(" User already authenticated:",It.currentUser.uid),D(!0);return}return HN(It,async _e=>{_e?(console.log(" User authenticated:",_e.uid),D(!0)):(console.log(" No user found - authentication required through login page"),D(!1))})}catch(ge){console.error(" Auth initialization error:",ge),l("   .    .","  ")}})()},[]),b.useEffect(()=>{const le=async()=>{if(f)await ot();else{console.log(" NEW MANUFACTURED PRODUCT MODE: Checking for pending items before clearing");const _e=await qe.getPendingProductItems(),J=await qe.getPendingData(`productDocuments_${e||"new"}`);console.log(" NEW MANUFACTURED PRODUCT: Checking for saved form data..."),console.log(" AUTH STATE: authReady =",I,"currentUser =",It.currentUser?"EXISTS":"NULL");let ae=null;try{ae=await qe.getPendingData("productFormData_new"),console.log(" NEW MANUFACTURED PRODUCT: Saved form data result:",ae)}catch(je){console.error(" NEW MANUFACTURED PRODUCT: Error loading saved form data:",je),console.error(" Error details:",je.message)}if(ae?(console.log(" NEW MANUFACTURED PRODUCT: Restoring saved form data from previous session:",ae),g(ae)):(console.log(" NEW MANUFACTURED PRODUCT: Starting with fresh empty form"),g({title:"",referenceNumber:"",description:"",submissionDeadline:"",estimatedValue:""})),_e&&_e.length>0){console.log(" NEW MANUFACTURED PRODUCT: Found pending items, loading them first"),at(_e);const je=_e.reduce((Se,Ie)=>Se+(Ie.unitPrice||0)*(Ie.quantity||1),0);je>0&&(console.log(` Setting estimated value from items: ${je}`),g(Se=>({...Se,estimatedValue:je.toString()}))),c(`  ${_e.length}    .

      .`,()=>{},"  ","","",!1)}J&&J.length>0&&(console.log(" NEW MANUFACTURED PRODUCT: Found pending documents, loading them"),xe(J)),ae&&(console.log(" NEW MANUFACTURED PRODUCT: Found pending form data, loading it"),g(je=>({...je,...ae}))),console.log(" NEW MANUFACTURED PRODUCT: Initialization completed (form data preserved)"),console.log(" NEW MANUFACTURED PRODUCT: Initialization completed")}const ge=setInterval(async()=>{const _e=await qe.getPendingProductItems();_e&&_e.length>0&&(console.log(" Periodic check found pending items, loading..."),await Xe())},1e3);return setTimeout(()=>clearInterval(ge),1e4),()=>clearInterval(ge)};I?(console.log(" AUTH READY: Starting to load data for manufactured products"),le()):console.log(" AUTH NOT READY: Waiting for authentication...")},[e,I]);const He=(le,ge)=>{console.log(" SENIOR REACT: Starting advanced duplicate prevention analysis..."),console.log(" EXISTING ITEMS:",le.map(Ie=>({id:Ie.internalId||Ie.materialInternalId,name:Ie.materialName||Ie.name}))),console.log(" NEW ITEMS:",ge.map(Ie=>({id:Ie.internalId||Ie.materialInternalId,name:Ie.materialName||Ie.name})));const _e=[],J=[],ae=new Map,je=new Map,Se=new Map;return le.forEach((Ie,Re)=>{const ye=Ie.internalId||Ie.materialInternalId,ue=Ie.materialInternalId||Ie.internalId,Me=(Ie.materialName||Ie.name||"").toLowerCase().trim();console.log(" EXISTING ITEM:",{internalId:ye,materialId:ue,itemName:Me}),ye&&ae.set(ye,{item:Ie,index:Re}),ue&&je.set(ue,{item:Ie,index:Re}),Me&&Se.set(Me,{item:Ie,index:Re})}),ge.forEach(Ie=>{const Re=Ie.internalId||Ie.materialInternalId,ye=Ie.materialInternalId||Ie.internalId,ue=(Ie.materialName||Ie.name||"").toLowerCase().trim();console.log(" CHECKING NEW ITEM:",{newInternalId:Re,newMaterialId:ye,newItemName:ue});let Me=!1,Pe=null;Re&&ae.has(Re)?(console.log(" DUPLICATE BY INTERNAL ID:",Re),Me=!0,Pe={type:"ID",displayName:Ie.materialName||Ie.name,matchedItem:ae.get(Re).item}):ye&&je.has(ye)?(console.log(" DUPLICATE BY MATERIAL ID:",ye),Me=!0,Pe={type:"ID",displayName:Ie.materialName||Ie.name,matchedItem:je.get(ye).item}):ue&&Se.has(ue)&&(console.log(" DUPLICATE BY NAME:",ue),Me=!0,Pe={type:"NAME",displayName:Ie.materialName||Ie.name,matchedItem:Se.get(ue).item}),Me?(_e.push(Pe),console.log(" DUPLICATE DETECTED:",{newItem:Ie.materialName||Ie.name,type:Pe.type,matchedWith:Pe.matchedItem.materialName||Pe.matchedItem.name})):(J.push(Ie),console.log(" UNIQUE ITEM ADDED:",Ie.materialName||Ie.name))}),console.log(" DUPLICATE PREVENTION SUMMARY:",{totalNewItems:ge.length,duplicatesFound:_e.length,uniqueItemsToAdd:J.length}),{duplicates:_e,uniqueItems:J}},Xe=async()=>{try{console.log(" Loading pending product items from Firestore...");const le=await qe.getPendingProductItems();if(le){const ge=Array.isArray(le)?le:JSON.parse(le);console.log(" Found pending product items:",ge.length,"items"),at(_e=>{if(_e.length===ge.length&&_e.length>0){const Ie=_e.map(ue=>ue.internalId||ue.materialInternalId).sort(),Re=ge.map(ue=>ue.internalId||ue.materialInternalId).sort();if(Ie.length===Re.length&&Ie.every((ue,Me)=>ue===Re[Me]))return console.log(" ITEMS UNCHANGED: Same length and same IDs, skipping update"),_e}console.log(" ITEMS CHANGED: Different length or different IDs, processing update..."),console.log(" Prev items:",_e.length,"Parsed items:",ge.length),console.log(" SENIOR REACT: Processing new/changed items...");let J=[],ae=[];if(_e.length===0)console.log(" EMPTY STATE: Loading initial pending items"),J=[],ae=ge;else{console.log(" EXISTING STATE: Checking for duplicates");const Ie=He(_e,ge);if(J=Ie.duplicates,ae=Ie.uniqueItems,J.length>0){const Re=J.map(ye=>{const ue=ye.type==="ID"?" ":" ";return` "${ye.displayName}" (${ue})`});l(`   ${J.length}  .   ${ae.length}   .

${Re.join(`
`)}`," ")}console.log(" DUPLICATES BLOCKED:",{count:J.length,names:J.map(Re=>Re.displayName)})}const je=[..._e,...ae],Se=je.reduce((Ie,Re)=>Ie+(Re.unitPrice||0)*(Re.quantity||1),0);return g(Ie=>({...Ie,estimatedValue:Se.toString()})),console.log(" SENIOR REACT DUPLICATE PREVENTION RESULT:",{existingCount:_e.length,newUniqueItems:ae.length,duplicatesBlocked:J.length,finalCount:je.length,preventionSuccess:J.length===0?"ALL_UNIQUE":"DUPLICATES_FILTERED"}),je}),console.log(" Items loaded and ready - keeping in storage until product is saved")}else{console.log(" No pending product items found in Firestore");const ge=await qe.getPendingData(`productItems_${e||"new"}`);if(ge&&We.length===0)try{Array.isArray(ge)&&ge.length>0&&(console.log(" Loading existing product items from Firestore:",ge.length),at(ge))}catch(_e){console.error("Error loading Firestore items:",_e)}}}catch(le){console.error("Error loading pending items:",le)}};b.useEffect(()=>{let le=null,ge=null;const _e=()=>{le&&clearTimeout(le),le=setTimeout(()=>{console.log(" WINDOW FOCUS: Checking for pending product items..."),Xe()},500)},J=je=>{console.log(" CUSTOM EVENT: productItemsAdded detected"),le&&clearTimeout(le),le=setTimeout(()=>{Xe()},300)},ae=()=>{document.hidden||(console.log(" PAGE VISIBLE: Checking for pending product items..."),le&&clearTimeout(le),le=setTimeout(()=>{Xe()},500))};return I&&(console.log(" ADDING EVENT LISTENERS for product item detection"),ge=setTimeout(()=>{console.log(" INITIAL CHECK: Looking for pending product items..."),Xe()},1e3)),window.addEventListener("focus",_e),document.addEventListener("visibilitychange",ae),window.addEventListener("productItemsAdded",J),()=>{window.removeEventListener("focus",_e),document.removeEventListener("visibilitychange",ae),window.removeEventListener("productItemsAdded",J),le&&clearTimeout(le),ge&&clearTimeout(ge)}},[I]);const ot=async()=>{if(e)try{O(!0),console.log(" Loading manufactured product:",e);const le=await Ta.getManufacturedProductById(e),ge={...le,submissionDeadline:le.submissionDeadline?Dd(le.submissionDeadline):""};if(g(ge),le.documents&&Array.isArray(le.documents)){const _e=le.documents.filter(J=>J&&typeof J=="object"&&J.fileName&&J.fileURL);xe(_e),console.log(" Loaded product documents from Firebase database:",_e.length)}le.items&&Array.isArray(le.items)&&at(le.items),console.log(" Loaded manufactured product successfully:",le.title)}catch(le){console.error(" Error loading manufactured product:",le),l(`    : ${le.message}`,"  ")}finally{O(!1)}},Fe=async le=>{const{name:ge,value:_e,type:J,checked:ae}=le.target,je={...A,[ge]:J==="checkbox"?ae:_e};g(je);try{const Se=e?`productFormData_${e}`:"productFormData_new";await qe.setPendingData(Se,je),console.log(` Form data saved for field: ${ge}`)}catch(Se){console.error("Error saving form data:",Se)}N[ge]&&j(Se=>({...Se,[ge]:void 0}))},gt=async()=>{var ge,_e,J;const le={};if((ge=A.title)!=null&&ge.trim()||(le.title="  "),(_e=A.referenceNumber)!=null&&_e.trim()||(le.referenceNumber="  "),A.submissionDeadline||(le.submissionDeadline="  "),(J=A.referenceNumber)!=null&&J.trim())try{await _i.checkUnique("manufacturedProducts","referenceNumber",A.referenceNumber.trim(),f?e:null)&&(le.referenceNumber="   ")}catch(ae){console.warn("Could not validate reference number uniqueness:",ae)}return j(le),Object.keys(le).length===0},Pt=async le=>{if(le.preventDefault(),V)return;if(!I){l("      ","  ");return}if(!await gt()){l("    ","  ");return}try{$(!0),console.log(" Saving manufactured product...");const _e={...A,documents:re||[],items:We||[]};let J;if(f){J=await Ta.updateManufacturedProduct(e,_e);const ae=s();t("task",`${ae.name}   `,` : ${A.title}`),o("    !"," "),await qe.clearPendingData(`productFormData_${e}`),await qe.clearPendingData(`productDocuments_${e}`),await qe.clearPendingProductItems(),setTimeout(()=>{n("/manufactured-products")},2e3)}else{J=await Ta.createManufacturedProduct(_e);const ae=s();t("task",`${ae.name}    `,` : ${A.title}`),o("    !"," "),await qe.clearPendingData("productFormData_new"),await qe.clearPendingData("productDocuments_new"),await qe.clearPendingProductItems(),setTimeout(()=>{n("/manufactured-products")},2e3)}console.log(" Manufactured product saved successfully:",(J==null?void 0:J.id)||"unknown")}catch(_e){console.error(" Error saving manufactured product:",_e),l(`   : ${_e.message}`,"  "),j(J=>({...J,submit:`   : ${_e.message}`}))}finally{$(!1)}},Yt=b.useCallback(()=>{if(!We||We.length===0)return 0;const le=We.reduce((ge,_e)=>ge+(_e.totalPrice||0),0);return console.log(" INSTANT: Reflecting pre-calculated total from items:",le),le},[We]),Xt=()=>{T(!0)},Lt=le=>{console.log(" Manufacturing Item Selected:",le),G(le);const _e={"raw-materials":`/manufactured-products/raw-materials/${e||"new"}`,"local-product":`/manufactured-products/local-products/${e||"new"}`,"imported-product":`/manufactured-products/foreign-products/${e||"new"}`,"manufactured-product":`/manufactured-products/edit/${e||"new"}`}[le];_e&&le!=="manufactured-product"&&n(_e)},on=async le=>{at(ge=>{const _e=ge.filter((J,ae)=>ae!==le);return qe.setPendingData(`productItems_${e||"new"}`,_e),_e})},Bn=(le,ge)=>{console.log(" handleEditItem called with:",{item:le,index:ge}),console.log(" Opening edit modal for item:",le),te({...le,quantity:le.quantity||1}),ze(ge),oe(!0),console.log(" Edit modal state should be open now")},In=le=>{const ge=Math.max(0,parseFloat(le)||0);te(_e=>({..._e,quantity:Number(ge.toFixed(1)),totalPrice:(_e.unitPrice||0)*Number(ge.toFixed(1))}))},qn=()=>{if(console.log(" handleSaveEditedItem called"),!E||Te===-1){l("   ","  ");return}at(le=>{const ge=[...le];return ge[Te]=E,qe.setPendingData(`productItems_${e||"new"}`,ge),console.log(" Item updated successfully:",E),ge}),oe(!1),te(null),ze(-1),console.log(" Item updated and modal closed")},Hn=()=>{console.log(" handleCloseEditModal called"),oe(!1),te(null),ze(-1)},w=async()=>{try{f||(console.log(" CANCEL: Clearing all pending data for cancelled new manufactured product"),await qe.clearPendingData(`productFormData_${e||"new"}`),await qe.clearPendingData(`productDocuments_${e||"new"}`),await qe.clearPendingProductItems(),console.log(" CANCEL: All pending data cleared successfully"))}catch(le){console.error("Error clearing pending data on cancel:",le)}n("/manufactured-products")},X=async le=>{const ge=le.target.files[0];if(ge){ee(!0);try{try{zs.validateFile(ge,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]})}catch(_e){throw new Error(_e.message)}_({file:ge,originalFileName:ge.name,fileSize:ge.size,fileType:ge.type}),Y(!0)}catch(_e){console.error("File upload error:",_e),l(`   : ${_e.message}`,"  ")}finally{ee(!1),le.target&&(le.target.value="")}}},ne=async()=>{if(!C.trim()){l("   ","  ");return}if(!R){l("     ","  ");return}ee(!0);try{console.log(" Starting file upload with custom name:",C);const le=await zs.uploadFile(R.file,"product-documents");if(console.log(" File uploaded successfully:",le),console.log(" Download URL for access:",le.url),!le.url||!le.url.startsWith("https://"))throw new Error("        Firebase Storage");const ge={id:`doc_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,fileName:C.trim(),originalFileName:R.originalFileName,fileSize:R.fileSize,fileType:R.fileType,fileURL:le.url,uploadedAt:new Date().toISOString(),storagePath:le.path};xe(ae=>[...ae,ge]);const _e=[...re,ge];await qe.setPendingData(`productDocuments_${e||"new"}`,_e),console.log(" Document added to list:",ge),o(`   : ${C}`," ");const J=s();t("file",`${J.name}    `,`: ${C}`)}catch(le){console.error(" Error in handleFileNameSave:",le),l(`   : ${le.message}`,"  ")}finally{ee(!1),Y(!1),_(null),z("")}},W=()=>{Y(!1),_(null),z("")},ie=le=>{c(`      

${le.fileName}`,()=>Ee(le),"  ")},Ee=async le=>{try{F(!0),await un.moveToTrash(le,"product_documents"),xe(J=>J.filter(ae=>ae.id!==le.id));const ge=re.filter(J=>J.id!==le.id);await qe.setPendingData(`productDocuments_${e||"new"}`,ge);const _e=s();t("file",`${_e.name}     `,`: ${le.fileName}`),o(`   : ${le.fileName}`,"  ")}catch(ge){console.error("Error deleting document:",ge),l(`    : ${ge.message}`,"  ")}finally{F(!1)}};return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:`page-wrapper ${p?"sidebar-collapsed":""}`,dir:"rtl",children:[r.jsx(Nn,{onToggle:zt}),r.jsxs("div",{className:"main-container",style:{paddingRight:p?"72px":"250px",paddingLeft:p||!d?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:p?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:p})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item",children:r.jsx("a",{href:"/manufactured-products",className:"text-decoration-none text-primary",children:" "})}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:f?"  ":"   "})]})}),r.jsx(jn,{}),r.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:r.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[r.jsx("div",{className:"d-flex align-items-center",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:`bi ${f?"bi-pencil-square":"bi-plus-circle-fill"} text-primary me-2`}),f?"  ":"   "]})}),r.jsxs("div",{className:"d-flex gap-2",children:[r.jsx("button",{type:"button",className:"btn btn-primary",onClick:Xt,style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:" "}),r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>k(!0),style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:" "})]})]})}),r.jsx("div",{className:"card-body",children:Z?r.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:r.jsx(an,{size:"large"})}):r.jsxs("form",{onSubmit:Pt,children:[N.submit&&r.jsxs("div",{className:"alert alert-danger",children:[r.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),N.submit]}),r.jsxs("div",{className:"row",children:[r.jsxs("div",{className:"col-md-8 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"text",className:`form-control ${N.title?"is-invalid":""}`,name:"title",value:A.title,onChange:Fe,placeholder:"   ",disabled:V}),N.title&&r.jsx("div",{className:"invalid-feedback",children:N.title})]}),r.jsxs("div",{className:"col-md-4 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"text",className:`form-control ${N.referenceNumber?"is-invalid":""}`,name:"referenceNumber",value:A.referenceNumber,onChange:Fe,placeholder:" ",disabled:V}),N.referenceNumber&&r.jsx("div",{className:"invalid-feedback",children:N.referenceNumber})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsxs("label",{className:"form-label",children:[" ",r.jsx("small",{className:"text-muted ms-2",children:"(   )"})]}),r.jsxs("div",{className:"input-group",children:[r.jsx("input",{type:"text",className:"form-control bg-light",name:"estimatedValue",value:(()=>{const le=Yt();return le>0?`${le.toLocaleString("en-US")} `:"0 "})(),readOnly:!0,placeholder:"    ",style:{backgroundColor:"#f8f9fa",fontWeight:"bold",color:"#198754"}}),r.jsx("span",{className:"input-group-text bg-light text-success",children:r.jsx("i",{className:"bi bi-calculator"})})]})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsxs("div",{className:"input-group",children:[r.jsx("input",{type:"date",className:`form-control ${N.submissionDeadline?"is-invalid":""}`,name:"submissionDeadline",value:A.submissionDeadline||"",onChange:Fe,disabled:V,required:!0,style:{backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23212529'%3e%3cpath d='M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v1h14V3a1 1 0 0 0-1-1H2zm13 3H1v9a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V5z'/%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"left 12px center",backgroundSize:"16px 16px",paddingLeft:"40px"}}),r.jsx("span",{className:"input-group-text bg-light",children:r.jsx("i",{className:"bi bi-calendar-event text-primary"})})]}),A.submissionDeadline&&r.jsxs("small",{className:"text-muted d-block mt-1",children:[" : ",h(A.submissionDeadline)]}),N.submissionDeadline&&r.jsx("div",{className:"invalid-feedback",children:N.submissionDeadline})]}),r.jsxs("div",{className:"col-md-12 mb-3",children:[r.jsx("label",{className:"form-label",children:" "}),r.jsx("textarea",{className:"form-control",name:"description",value:A.description,onChange:Fe,rows:"4",placeholder:"    ...",disabled:V})]}),We.length>0&&r.jsx("div",{className:"col-md-12 mb-4",children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsx("div",{className:"card-header bg-light",children:r.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[r.jsxs("h6",{className:"mb-0 fw-bold text-primary",children:[r.jsx("i",{className:"bi bi-list-task me-2"}),"  (",We.length,")"]}),r.jsx("button",{type:"button",className:"btn btn-success btn-sm",onClick:Ne,disabled:fe||We.length===0,style:{fontSize:"12px",padding:"4px 12px",borderRadius:"4px"},children:fe?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status"})," ..."]}):r.jsx(r.Fragment,{children:"  "})})]})}),r.jsx("div",{className:"card-body p-0",children:r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",style:{paddingRight:"20px"},children:""}),r.jsx("th",{className:"text-center",style:{paddingRight:"20px"},children:""}),r.jsx("th",{className:"text-center",style:{paddingRight:"20px"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"60px",paddingRight:"20px",paddingLeft:"40px"},children:""})]})}),r.jsx("tbody",{children:We.map((le,ge)=>{let _e=le.materialName||le.name||"  ";_e&&_e.toString().startsWith("rm_")&&(_e="  ");const J=le.materialUnit||le.unit||"",ae=le.totalPrice||0,je=le.internalId;return r.jsxs("tr",{className:"",style:{backgroundColor:ge%2===0?"#ffffff":"#f8f9fa"},children:[r.jsx("td",{className:"text-center fw-bold text-muted",children:ge+1}),r.jsx("td",{className:"text-center fw-medium",children:r.jsx("div",{children:r.jsx("button",{className:"btn btn-link p-0 fw-medium text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:async Se=>{Se.preventDefault(),Se.stopPropagation();try{console.log("=== DETAILED DEBUGGING ==="),console.log("Full item object:",JSON.stringify(le,null,2)),console.log("All item keys:",Object.keys(le));const Ie=le.materialInternalId,Re=le.materialType||"rawMaterial";console.log("Searching for:"),console.log("- materialInternalId:",Ie),console.log("- materialType:",Re);let ye=null,ue=[];if(Re==="rawMaterial"){console.log("Loading raw materials...");const{RawMaterialService:Me}=await ns(async()=>{const{RawMaterialService:Le}=await Promise.resolve().then(()=>ax);return{RawMaterialService:Le}},void 0);ue=await Me.getAllRawMaterials(),console.log("Total raw materials loaded:",ue.length),console.log("Sample raw material IDs:",ue.slice(0,3).map(Le=>({id:Le.id,internalId:Le.internalId,name:Le.name})));let Pe=ue.find(Le=>Le.internalId===Ie);if(Pe||(Pe=ue.find(Le=>Le.id===Ie)),!Pe){const Le=le.materialName||le.name;Pe=ue.find(st=>st.name===Le)}console.log("Found raw material:",Pe?"YES":"NO"),Pe&&(console.log("Material details:",{id:Pe.id,internalId:Pe.internalId,name:Pe.name}),ye=Pe.id,n(`/raw-materials/edit/${ye}`))}else if(Re==="localProduct"){console.log("Loading local products...");const{LocalProductService:Me}=await ns(async()=>{const{LocalProductService:Le}=await Promise.resolve().then(()=>ox);return{LocalProductService:Le}},void 0);ue=await Me.getAllLocalProducts(),console.log("Total local products loaded:",ue.length),console.log("Sample local product IDs:",ue.slice(0,3).map(Le=>({id:Le.id,internalId:Le.internalId,name:Le.name})));let Pe=ue.find(Le=>Le.internalId===Ie);if(Pe||(Pe=ue.find(Le=>Le.id===Ie)),!Pe){const Le=le.materialName||le.name;Pe=ue.find(st=>st.name===Le)}console.log("Found local product:",Pe?"YES":"NO"),Pe&&(console.log("Product details:",{id:Pe.id,internalId:Pe.internalId,name:Pe.name}),ye=Pe.id,n(`/local-products/edit/${ye}`))}else if(Re==="foreignProduct"){console.log("Loading foreign products...");const{ForeignProductService:Me}=await ns(async()=>{const{ForeignProductService:Le}=await Promise.resolve().then(()=>lx);return{ForeignProductService:Le}},void 0);ue=await Me.getAllForeignProducts(),console.log("Total foreign products loaded:",ue.length),console.log("Sample foreign product IDs:",ue.slice(0,3).map(Le=>({id:Le.id,internalId:Le.internalId,name:Le.name})));let Pe=ue.find(Le=>Le.internalId===Ie);if(Pe||(Pe=ue.find(Le=>Le.id===Ie)),!Pe){const Le=le.materialName||le.name;Pe=ue.find(st=>st.name===Le)}console.log("Found foreign product:",Pe?"YES":"NO"),Pe&&(console.log("Product details:",{id:Pe.id,internalId:Pe.internalId,name:Pe.name}),ye=Pe.id,n(`/foreign-products/edit/${ye}`))}ye||(console.error("=== SEARCH FAILED ==="),console.error("Could not find Firebase ID for:",Ie),console.error("Available items in this category:",ue.map(Me=>({id:Me.id,internalId:Me.internalId,name:Me.name}))),alert(`     
ID: ${Ie}
Type: ${Re}`))}catch(Ie){console.error("=== NAVIGATION ERROR ===",Ie),alert("     ")}},title:`: ${_e}`,children:_e})})}),r.jsx("td",{className:"text-center",style:{paddingRight:"20px"},children:r.jsx("span",{className:"badge bg-primary",children:le.quantity||1})}),r.jsx("td",{className:"text-center",style:{paddingRight:"20px"},children:J}),r.jsx("td",{className:"text-center",style:{paddingRight:"20px"},children:r.jsxs("div",{children:[r.jsxs("span",{className:"text-success fw-bold",children:[ae.toLocaleString("en-US")," ."]}),le.unitPrice&&r.jsx("div",{children:r.jsxs("small",{className:"text-muted",children:[le.unitPrice.toLocaleString("en-US"),"  ",le.quantity]})})]})}),r.jsx("td",{className:"text-center",style:{paddingRight:"20px",paddingLeft:"40px"},children:r.jsxs("div",{className:"d-flex justify-content-center gap-1",children:[r.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:Se=>{Se.preventDefault(),Se.stopPropagation(),Bn(le,ge)},title:" ",style:{width:"27px",height:"27px",padding:"0",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #007bff",color:"#007bff",backgroundColor:"transparent",transition:"all 0.2s ease"},onMouseEnter:Se=>{Se.target.style.backgroundColor="#007bff",Se.target.style.color="white"},onMouseLeave:Se=>{Se.target.style.backgroundColor="transparent",Se.target.style.color="#007bff"},children:r.jsx("i",{className:"bi bi-pencil"})}),r.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:Se=>{Se.preventDefault(),Se.stopPropagation(),on(ge)},title:"",style:{width:"27px",height:"27px",padding:"0",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #dc3545",color:"#dc3545",backgroundColor:"transparent",transition:"all 0.2s ease"},onMouseEnter:Se=>{Se.target.style.backgroundColor="#dc3545",Se.target.style.color="white"},onMouseLeave:Se=>{Se.target.style.backgroundColor="transparent",Se.target.style.color="#dc3545"},children:r.jsx("i",{className:"bi bi-trash"})})]})})]},je||`item-${ge}`)})}),r.jsx("tfoot",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{colSpan:"4",className:"text-end",children:" :"}),r.jsxs("th",{className:"text-center text-primary fw-bold",children:[Yt().toLocaleString("en-US")," ."]}),r.jsx("th",{})]})})]})})})]})})]}),r.jsx("div",{className:"row",children:r.jsxs("div",{className:"col-12 d-flex justify-content-center gap-3 mt-4",children:[r.jsx("button",{type:"button",className:"btn btn-secondary",style:{height:"32px",minWidth:"80px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},onClick:w,disabled:V,children:""}),r.jsx("button",{type:"submit",className:"btn btn-primary",style:{height:"32px",minWidth:"80px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},disabled:V,children:V?r.jsxs(r.Fragment,{children:[r.jsx(an,{size:"small"}),r.jsx("span",{className:"ms-2",children:f?"...":"..."})]}):f?"":""})]})})]})})]})})})]}),d&&r.jsxs("div",{style:{position:"fixed",left:"20px",top:"70px",width:"350px",height:"calc(100vh - 90px)",zIndex:10,background:"white",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",display:"flex",flexDirection:"column"},children:[r.jsx("div",{style:{flex:1,overflow:"hidden"},children:r.jsx(_n,{})}),r.jsx("div",{style:{borderTop:"1px solid #e9ecef",padding:"10px",background:"#f8f9fa",borderRadius:"0 0 8px 8px"},children:r.jsx(En,{})})]})]})]}),r.jsx(MR,{show:M,onClose:()=>T(!1),onItemSelect:Lt,selectedItemType:L,setSelectedItemType:G}),r.jsx(JN,{show:U,onClose:()=>k(!1),documents:re,setDocuments:xe,tenderId:e||"new",tenderTitle:A.title||" ",uploadingDocument:H,setUploadingDocument:ee,handleDocumentUpload:X,handleDeleteClick:ie,deleting:K}),r.jsx(Wt,{show:i.show,onClose:a,title:i.title,message:i.message,type:i.type,onConfirm:i.onConfirm,confirmText:i.confirmText,cancelText:i.cancelText,showCancel:i.showCancel}),se&&r.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.7)",zIndex:1060},tabIndex:"-1",dir:"rtl",children:r.jsx("div",{className:"modal-dialog modal-dialog-centered",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[r.jsx("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"12px 12px 0 0"},children:r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-pencil-square me-2"})," "]})}),r.jsx("div",{className:"modal-body",style:{padding:"25px"},children:r.jsxs("div",{className:"mb-4",children:[r.jsxs("div",{className:"d-flex align-items-center mb-3",children:[r.jsx("div",{className:"bg-success bg-opacity-10 p-2 rounded-circle me-3",children:r.jsx("i",{className:"bi bi-file-earmark-check text-success"})}),r.jsxs("div",{children:[r.jsx("h6",{className:"mb-0 fw-bold text-success",children:"   "}),r.jsx("small",{className:"text-muted",children:R==null?void 0:R.originalFileName})]})]}),r.jsxs("div",{className:"mb-3",children:[r.jsxs("label",{className:"form-label fw-bold text-primary",children:[r.jsx("i",{className:"bi bi-tag me-1"}),"   *"]}),r.jsx("input",{type:"text",className:"form-control",value:C,onChange:le=>z(le.target.value),placeholder:"   ",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:le=>{le.target.style.borderColor="#28a745",le.target.style.boxShadow="0 0 0 0.2rem rgba(40, 167, 69, 0.25)"},onBlur:le=>{le.target.style.borderColor="#e9ecef",le.target.style.boxShadow="none"},autoFocus:!0}),r.jsxs("small",{className:"text-muted",children:[r.jsx("i",{className:"bi bi-info-circle me-1"}),"        "]})]})]})}),r.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:r.jsxs("div",{className:"d-flex justify-content-end",style:{gap:"12px"},children:[r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:W,style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500"},children:""}),r.jsx("button",{type:"button",className:"btn btn-success",onClick:ne,disabled:!C.trim()||H,style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500",opacity:C.trim()&&!H?1:.6},children:H?r.jsxs(r.Fragment,{children:[r.jsx(an,{size:"small"}),r.jsx("span",{className:"ms-1",children:"..."})]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"bi bi-check-lg me-1"}),""]})})]})})]})})}),Q&&E&&r.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:r.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[r.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),r.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:Hn,"aria-label":"Close"})]}),r.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"30%"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),r.jsx("th",{className:"text-center",style:{width:"15%"},children:""}),r.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),r.jsx("tbody",{children:r.jsxs("tr",{style:{height:"60px"},children:[r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("i",{className:"bi bi-layers text-danger me-2"}),r.jsxs("div",{children:[r.jsx("div",{className:"fw-bold text-primary",children:E.materialName||E.name||"  "}),r.jsx("small",{className:"text-muted",children:E.materialCategory||E.category||""})]})]})}),r.jsxs("td",{className:"text-center",children:[r.jsxs("span",{className:"fw-bold text-success",children:[Math.round(E.unitPrice||0)," "]}),r.jsx("div",{children:r.jsxs("small",{className:"text-muted",children:["/",E.materialUnit||E.unit||""]})})]}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>In(Math.max(0,Number((E.quantity-.1).toFixed(1)))),disabled:E.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:r.jsx("i",{className:"bi bi-dash"})}),r.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:E.quantity||0,min:"0",step:"any",onChange:le=>In(le.target.value),onBlur:le=>{const ge=Number(le.target.value||0).toFixed(1);In(ge)}}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>In(Number((E.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:r.jsx("i",{className:"bi bi-plus"})})]})}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"text-muted",children:E.displaySupplier||E.supplier||"-"})}),r.jsxs("td",{className:"text-center",children:[r.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(E.totalPrice||0)," "]}),r.jsxs("small",{className:"text-success",children:["(",(E.quantity||.1).toFixed(1),"  ",Math.round(E.unitPrice||0),")"]})]})]})})]})})}),r.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:r.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("span",{className:"text-muted me-3",children:" :"}),r.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[Math.round(E.totalPrice||0)," "]}),r.jsxs("span",{className:"badge bg-info ms-2",children:[(E.quantity||.1).toFixed(1)," ",E.materialUnit||E.unit||""]})]}),r.jsxs("div",{className:"d-flex gap-2",children:[r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:Hn,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),r.jsx("button",{type:"button",className:"btn btn-primary",onClick:qn,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})]})})]})})})]})}function II(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(R9,{})})})}function P9(){const[n,e]=b.useState(!1),{isTimelineVisible:t}=gn(),[s,i]=b.useState([]),[a,o]=b.useState([]),[l,c]=b.useState(!1),[d,h]=b.useState(null),[f,p]=b.useState(""),[x,I]=b.useState([]),[D,A]=b.useState(!1),[g,N]=b.useState([]),j=On(),{productId:V}=li(),{logActivity:$,getCurrentUser:Z}=$t(),{alertConfig:O,closeAlert:M,showSuccess:T,showError:L}=Kt(),G=async(R,_={})=>{try{console.log(" DUPLICATE CHECK: Checking",R.length,"items against existing product items");const C=await qe.getPendingProductItems()||[];if(console.log(" DUPLICATE CHECK: Found",C.length,"existing items"),C.length===0)return console.log(" DUPLICATE CHECK: No existing items, all items are unique"),{success:!0,uniqueItems:R||[]};const z=[],K=[];for(const F of R){const Q=F.materialInternalId||F.internalId||F.id,oe=(F.materialName||F.name||"").trim().toLowerCase();C.some(te=>{const Te=te.materialInternalId||te.internalId||te.id,ze=(te.materialName||te.name||"").trim().toLowerCase();return Q&&Te&&Q===Te||oe&&ze&&oe===ze})?(z.push(F),console.log(" DUPLICATE FOUND:",F.materialName||F.name)):(K.push(F),console.log(" UNIQUE ITEM:",F.materialName||F.name))}if(z.length>0&&_.showError){const F=z.map(Q=>Q.materialName||Q.name).join(" ");if(_.showError(`   ${z.length}  : ${F}.     .`,_.errorTitle||" "),_.stopOnDuplicates&&K.length===0)return{success:!1,uniqueItems:[]}}return console.log(" DUPLICATE CHECK RESULT:",{totalItems:R.length,duplicates:z.length,uniqueItems:K.length}),{success:!0,uniqueItems:K}}catch(C){return console.error(" Error in duplicate prevention:",C),{success:!0,uniqueItems:R||[]}}},U=()=>{e(!n)};b.useEffect(()=>{k();const R=z=>{z.type==="rawMaterialsUpdated"&&k()},_=()=>{k()};window.addEventListener("storage",R),window.addEventListener("rawMaterialsUpdated",_);const C=()=>{k()};return window.addEventListener("focus",C),()=>{window.removeEventListener("storage",R),window.removeEventListener("rawMaterialsUpdated",_),window.removeEventListener("focus",C)}},[]),b.useEffect(()=>{if(f.trim()){const R=s.filter(_=>{var C,z,K,F;return((C=_.name)==null?void 0:C.toLowerCase().includes(f.toLowerCase()))||((z=_.category)==null?void 0:z.toLowerCase().includes(f.toLowerCase()))||((K=_.description)==null?void 0:K.toLowerCase().includes(f.toLowerCase()))||((F=_.supplier)==null?void 0:F.toLowerCase().includes(f.toLowerCase()))});I(R)}else I(s)},[f,s]);const k=async()=>{try{c(!0);const _=(await Os.getAllRawMaterials()).filter(C=>C.active!==!1);i(_),h(null)}catch(R){h(R.message)}finally{c(!1)}},re=R=>{if(a.some(C=>C.internalId===R.internalId))o(C=>C.filter(z=>z.internalId!==R.internalId));else{const C={...R,type:"rawMaterials",quantity:1};o(z=>[...z,C])}},xe=()=>{if(a.length===0){L("      ","   ");return}const R=a.map(_=>{let C=_.price||0,z=_.supplier;if(_.priceQuotes&&Array.isArray(_.priceQuotes)&&_.priceQuotes.length>0){const K=_.priceQuotes.reduce((F,Q)=>{const oe=parseFloat(F.price)||0;return(parseFloat(Q.price)||0)<oe?Q:F});C=parseFloat(K.price)||0,z=K.supplierName}return{..._,quantity:1,unitPrice:C,totalPrice:C,displaySupplier:z}});N(R),A(!0)},H=(R,_)=>{const C=Math.max(0,parseFloat(_)||0);N(z=>z.map(K=>K.id===R?{...K,quantity:Number(C.toFixed(1)),totalPrice:K.unitPrice*Number(C.toFixed(1))}:K))},ee=async()=>{try{if(!Array.isArray(g)||g.length===0){L("    ","  ");return}console.log(" SENIOR REACT: Using advanced duplicate prevention hook...");const R=await G(g,{showError:L,errorTitle:" ",stopOnDuplicates:!0});if(console.log(" SENIOR REACT: Duplicate check result:",R),!R.success){console.log(" SENIOR REACT: Execution stopped due to duplicates");return}const _=R.uniqueItems;console.log(" SENIOR REACT: Proceeding with unique items:",_.length),console.log("No duplicates found, proceeding with item creation...");const C=[];for(const F of _)try{console.log(" SENIOR REACT: Creating tender item directly for:",F.name);const Q={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:F.internalId,materialType:"rawMaterial",materialName:F.name,materialCategory:F.category||"",materialUnit:F.unit||"",quantity:F.quantity||1,unitPrice:F.unitPrice||0,totalPrice:(F.quantity||1)*(F.unitPrice||0),supplierInfo:F.displaySupplier||"",tenderId:V==="new"?"new":V,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};C.push(Q),console.log(" SENIOR REACT: Created tender item directly:",{id:Q.internalId,materialId:Q.materialInternalId,name:Q.materialName,quantity:Q.quantity,unitPrice:Q.unitPrice,totalPrice:Q.totalPrice})}catch(Q){console.error("Error creating manufactured product item for material:",F.name,Q),L(`   : ${F.name}`,"  ");return}const z=await qe.getPendingProductItems()||[],K=[...z,...C];console.log(" SENIOR REACT: Merging manufactured product items:",{existingCount:z.length,newCount:C.length,totalCount:K.length,items:C.map(F=>({id:F.internalId,materialId:F.materialInternalId,name:F.materialName,price:F.unitPrice,total:F.totalPrice}))}),await qe.setPendingProductItems(K),console.log(" SENIOR REACT: Dispatching product items added event"),window.dispatchEvent(new CustomEvent("productItemsAdded",{detail:{source:"ManufacturedRawMaterials",itemsCount:C.length,items:C.map(F=>({id:F.internalId,name:F.materialName,type:F.materialType}))}}));try{const F=Z();F&&F.name&&$("task",`${F.name}     `,`  ${C.length}  `)}catch(F){console.error("Failed to log activity:",F)}T(`  ${C.length}     `," "),A(!1),N([]),setTimeout(()=>{j(V==="new"?"/manufactured-products/add":`/manufactured-products/edit/${V}`)},100)}catch(R){console.error("Error in handleConfirmQuantities:",R),L("       -   ","  ")}},se=()=>{A(!1),N([])},Y=()=>Math.round(g.reduce((R,_)=>R+_.totalPrice,0));return l?r.jsx(an,{show:!0,message:"    ...",overlay:!1}):d?r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"text-danger mb-3",children:r.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),r.jsx("h5",{className:"text-danger",children:" "}),r.jsx("p",{className:"text-muted",children:d}),r.jsxs("button",{className:"btn btn-primary",onClick:k,children:[r.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[r.jsx(Nn,{onToggle:U}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-primary",children:"  "}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),r.jsx(jn,{}),r.jsx("div",{className:"app-content-area p-3",children:r.jsx("div",{className:"raw-materials-table",children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"row align-items-center justify-content-between",children:[r.jsx("div",{className:"col-lg-4",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-layers text-danger me-2"}),"   (",x.length,")"]})}),r.jsx("div",{className:"col-lg-8",children:r.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[r.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[r.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:f,onChange:R=>p(R.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),r.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:r.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),r.jsxs("button",{className:"btn btn-danger shadow-sm px-4",onClick:xe,disabled:a.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["  (",a.length,")"]}),r.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const R=V!=="new"?`/manufactured-products/edit/${V}`:"/manufactured-products/add";j(R)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:"  "})]})})]})}),r.jsx("div",{className:"card-body p-0",children:x.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-layers fs-1"})}),r.jsx("h5",{className:"text-muted",children:"   "}),r.jsx("p",{className:"text-muted",children:f?"    ":"      "})]}):r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""})]})}),r.jsx("tbody",{children:x.map(R=>{let _=R.price,C=R.supplier,z=!1,K=null;return R.priceQuotes&&Array.isArray(R.priceQuotes)&&R.priceQuotes.length>0&&(z=!0,K=R.priceQuotes.reduce((F,Q)=>{const oe=parseFloat(F.price)||0;return(parseFloat(Q.price)||0)<oe?Q:F}),_=K.price,C=K.supplierName),r.jsxs("tr",{children:[r.jsx("td",{className:"text-center",children:r.jsx("div",{className:"form-check d-flex justify-content-center",children:r.jsx("input",{className:"form-check-input",type:"checkbox",checked:a.some(F=>F.internalId===R.internalId),onChange:()=>re(R),style:{transform:"scale(1.2)"}})})}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"fw-bold text-primary",children:R.name})}),r.jsx("td",{className:"text-center",children:R.category||"-"}),r.jsx("td",{className:"text-center",children:R.unit||"-"}),r.jsx("td",{className:"text-center",children:_?r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsxs("span",{children:[_," "]}),z&&r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),r.jsx("td",{className:"text-center",children:C?r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("span",{children:C}),z&&r.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:" "})]}):"-"})]},R.id)})})]})})})]})})}),r.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:r.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&t&&r.jsx(_n,{rtl:!0}),!n&&t&&r.jsx(En,{})]}),D&&r.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:r.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[r.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),r.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:se,"aria-label":"Close"})]}),r.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"30%"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),r.jsx("th",{className:"text-center",style:{width:"15%"},children:""}),r.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),r.jsx("tbody",{children:g.map((R,_)=>r.jsxs("tr",{style:{height:"60px"},children:[r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("i",{className:"bi bi-layers text-danger me-2"}),r.jsxs("div",{children:[r.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:C=>{C.preventDefault(),C.stopPropagation(),j(`/raw-materials/edit/${R.id}`)},title:`  : ${R.name}`,children:R.name}),r.jsx("small",{className:"text-muted",children:R.category})]})]})}),r.jsxs("td",{className:"text-center",children:[r.jsxs("span",{className:"fw-bold text-success",children:[Math.round(R.unitPrice)," "]}),r.jsx("div",{children:r.jsxs("small",{className:"text-muted",children:["/",R.unit||""]})})]}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>H(R.id,Math.max(0,Number((R.quantity-.1).toFixed(1)))),disabled:R.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:r.jsx("i",{className:"bi bi-dash"})}),r.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:R.quantity,min:"0",step:"any",onChange:C=>H(R.id,C.target.value),onBlur:C=>{const z=Number(C.target.value||0).toFixed(1);H(R.id,z)}}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>H(R.id,Number((R.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:r.jsx("i",{className:"bi bi-plus"})})]})}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"text-muted",children:R.displaySupplier||"-"})}),r.jsxs("td",{className:"text-center",children:[r.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(R.totalPrice)," "]}),r.jsxs("small",{className:"text-success",children:["(",R.quantity.toFixed(1),"  ",Math.round(R.unitPrice),")"]})]})]},R.id))})]})})}),r.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:r.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("span",{className:"text-muted me-3",children:" :"}),r.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[Y()," "]}),r.jsxs("span",{className:"badge bg-info ms-2",children:[g.reduce((R,_)=>R+_.quantity,0).toFixed(1)," "]})]}),r.jsxs("div",{className:"d-flex gap-2",children:[r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:se,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),r.jsx("button",{type:"button",className:"btn btn-primary",onClick:ee,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})]})})]})})}),r.jsx(Wt,{show:O.show,onClose:M,title:O.title,message:O.message,type:O.type,onConfirm:O.onConfirm,showConfirm:O.showConfirm})]})}function k9(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(P9,{})})})}function O9(){const[n,e]=b.useState(!1),{isTimelineVisible:t}=gn(),[s,i]=b.useState([]),[a,o]=b.useState([]),[l,c]=b.useState(!1),[d,h]=b.useState(null),[f,p]=b.useState(""),[x,I]=b.useState([]),[D,A]=b.useState(!1),[g,N]=b.useState([]),j=On(),{productId:V}=li(),{logActivity:$,getCurrentUser:Z}=$t(),{alertConfig:O,closeAlert:M,showSuccess:T,showError:L}=Kt(),G=async(R,_={})=>{try{console.log(" DUPLICATE CHECK: Checking",R.length,"items against existing product items");const C=await qe.getPendingProductItems()||[];if(console.log(" DUPLICATE CHECK: Found",C.length,"existing items"),C.length===0)return console.log(" DUPLICATE CHECK: No existing items, all items are unique"),{success:!0,uniqueItems:R||[]};const z=[],K=[];for(const F of R){const Q=F.materialInternalId||F.internalId||F.id,oe=(F.materialName||F.name||"").trim().toLowerCase();C.some(te=>{const Te=te.materialInternalId||te.internalId||te.id,ze=(te.materialName||te.name||"").trim().toLowerCase();return Q&&Te&&Q===Te||oe&&ze&&oe===ze})?(z.push(F),console.log(" DUPLICATE FOUND:",F.materialName||F.name)):(K.push(F),console.log(" UNIQUE ITEM:",F.materialName||F.name))}if(z.length>0&&_.showError){const F=z.map(Q=>Q.materialName||Q.name).join(" ");if(_.showError(`   ${z.length}  : ${F}.     .`,_.errorTitle||" "),_.stopOnDuplicates&&K.length===0)return{success:!1,uniqueItems:[]}}return console.log(" DUPLICATE CHECK RESULT:",{totalItems:R.length,duplicates:z.length,uniqueItems:K.length}),{success:!0,uniqueItems:K}}catch(C){return console.error(" Error in duplicate prevention:",C),{success:!0,uniqueItems:R||[]}}},U=()=>{e(!n)};b.useEffect(()=>{k();const R=z=>{z.type==="localProductsUpdated"&&k()},_=()=>{k()};window.addEventListener("storage",R),window.addEventListener("localProductsUpdated",_);const C=()=>{k()};return window.addEventListener("focus",C),()=>{window.removeEventListener("storage",R),window.removeEventListener("localProductsUpdated",_),window.removeEventListener("focus",C)}},[]),b.useEffect(()=>{if(f.trim()){const R=s.filter(_=>{var C,z,K,F;return((C=_.name)==null?void 0:C.toLowerCase().includes(f.toLowerCase()))||((z=_.category)==null?void 0:z.toLowerCase().includes(f.toLowerCase()))||((K=_.description)==null?void 0:K.toLowerCase().includes(f.toLowerCase()))||((F=_.manufacturer)==null?void 0:F.toLowerCase().includes(f.toLowerCase()))});I(R)}else I(s)},[f,s]);const k=async()=>{try{c(!0);const _=(await Ms.getAllLocalProducts()).filter(C=>C.active!==!1);i(_),h(null)}catch(R){h(R.message)}finally{c(!1)}},re=R=>{if(a.some(C=>C.internalId===R.internalId))o(C=>C.filter(z=>z.internalId!==R.internalId));else{const C={...R,type:"localProducts",quantity:1};o(z=>[...z,C])}},xe=()=>{if(a.length===0){L("      ","   ");return}const R=a.map(_=>{let C=_.price||0,z=_.manufacturer;if(_.priceQuotes&&Array.isArray(_.priceQuotes)&&_.priceQuotes.length>0){const K=_.priceQuotes.reduce((F,Q)=>{const oe=parseFloat(F.price)||0;return(parseFloat(Q.price)||0)<oe?Q:F});C=parseFloat(K.price)||0,z=K.supplierName}return{..._,quantity:1,unitPrice:C,totalPrice:C,displaySupplier:z}});N(R),A(!0)},H=(R,_)=>{const C=Math.max(0,parseFloat(_)||0);N(z=>z.map(K=>K.id===R?{...K,quantity:Number(C.toFixed(1)),totalPrice:K.unitPrice*Number(C.toFixed(1))}:K))},ee=async()=>{try{if(!Array.isArray(g)||g.length===0){L("    ","  ");return}console.log(" SENIOR REACT: Using advanced duplicate prevention hook...");const R=await G(g,{showError:L,errorTitle:" ",stopOnDuplicates:!0});if(console.log(" SENIOR REACT: Duplicate check result:",R),!R.success){console.log(" SENIOR REACT: Execution stopped due to duplicates");return}const _=R.uniqueItems;console.log(" SENIOR REACT: Proceeding with unique items:",_.length),console.log("No duplicates found, proceeding with item creation...");const C=[];for(const F of _)try{console.log(" SENIOR REACT: Creating tender item directly for:",F.name);const Q={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:F.internalId,materialType:"localProduct",materialName:F.name,materialCategory:F.category||"",materialUnit:F.unit||"",quantity:F.quantity||1,unitPrice:F.unitPrice||0,totalPrice:(F.quantity||1)*(F.unitPrice||0),supplierInfo:F.displaySupplier||"",tenderId:V==="new"?"new":V,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};C.push(Q),console.log(" SENIOR REACT: Created tender item directly:",{id:Q.internalId,materialId:Q.materialInternalId,name:Q.materialName,quantity:Q.quantity,unitPrice:Q.unitPrice,totalPrice:Q.totalPrice})}catch(Q){console.error("Error creating manufactured product item for product:",F.name,Q),L(`   : ${F.name}`,"  ");return}const z=await qe.getPendingProductItems()||[],K=[...z,...C];console.log(" SENIOR REACT: Merging manufactured product items:",{existingCount:z.length,newCount:C.length,totalCount:K.length,items:C.map(F=>({id:F.internalId,materialId:F.materialInternalId,name:F.materialName,price:F.unitPrice,total:F.totalPrice}))}),await qe.setPendingProductItems(K),console.log(" SENIOR REACT: Dispatching product items added event"),window.dispatchEvent(new CustomEvent("productItemsAdded",{detail:{source:"ManufacturedLocalProducts",itemsCount:C.length,items:C.map(F=>({id:F.internalId,name:F.materialName,type:F.materialType}))}}));try{const F=Z();F&&F.name&&$("task",`${F.name}     `,`  ${C.length}  `)}catch(F){console.error("Failed to log activity:",F)}T(`  ${C.length}     `," "),A(!1),N([]),setTimeout(()=>{j(V==="new"?"/manufactured-products/add":`/manufactured-products/edit/${V}`)},100)}catch(R){console.error("Error in handleConfirmQuantities:",R),L("       -   ","  ")}},se=()=>{A(!1),N([])},Y=()=>Math.round(g.reduce((R,_)=>R+_.totalPrice,0));return l?r.jsx(an,{show:!0,message:"    ...",overlay:!1}):d?r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"text-danger mb-3",children:r.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),r.jsx("h5",{className:"text-danger",children:" "}),r.jsx("p",{className:"text-muted",children:d}),r.jsxs("button",{className:"btn btn-primary",onClick:k,children:[r.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[r.jsx(Nn,{onToggle:U}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-primary",children:"  "}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),r.jsx(jn,{}),r.jsx("div",{className:"app-content-area p-3",children:r.jsx("div",{className:"raw-materials-table",children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"row align-items-center justify-content-between",children:[r.jsx("div",{className:"col-lg-4",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-house text-success me-2"}),"   (",x.length,")"]})}),r.jsx("div",{className:"col-lg-8",children:r.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[r.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[r.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:f,onChange:R=>p(R.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),r.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:r.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),r.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:xe,disabled:a.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["  (",a.length,")"]}),r.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const R=V!=="new"?`/manufactured-products/edit/${V}`:"/manufactured-products/add";j(R)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:"  "})]})})]})}),r.jsx("div",{className:"card-body p-0",children:x.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-house fs-1"})}),r.jsx("h5",{className:"text-muted",children:"   "}),r.jsx("p",{className:"text-muted",children:f?"    ":"      "})]}):r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:" "})]})}),r.jsx("tbody",{children:x.map(R=>{let _=R.price,C=R.manufacturer,z=!1,K=null;return R.priceQuotes&&Array.isArray(R.priceQuotes)&&R.priceQuotes.length>0&&(z=!0,K=R.priceQuotes.reduce((F,Q)=>{const oe=parseFloat(F.price)||0;return(parseFloat(Q.price)||0)<oe?Q:F}),_=K.price,C=K.supplierName),r.jsxs("tr",{children:[r.jsx("td",{className:"text-center",children:r.jsx("div",{className:"form-check d-flex justify-content-center",children:r.jsx("input",{className:"form-check-input",type:"checkbox",checked:a.some(F=>F.internalId===R.internalId),onChange:()=>re(R),style:{transform:"scale(1.2)"}})})}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"fw-bold text-primary",children:R.name})}),r.jsx("td",{className:"text-center",children:R.category||"-"}),r.jsx("td",{className:"text-center",children:R.unit||"-"}),r.jsx("td",{className:"text-center",children:_?r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsxs("span",{children:[_," "]}),z&&r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),r.jsx("td",{className:"text-center",children:C?r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("span",{children:C}),z&&r.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:" "})]}):"-"})]},R.id)})})]})})})]})})}),r.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:r.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&t&&r.jsx(_n,{rtl:!0}),!n&&t&&r.jsx(En,{})]}),D&&r.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:r.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[r.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),r.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:se,"aria-label":"Close"})]}),r.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"30%"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),r.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),r.jsx("tbody",{children:g.map((R,_)=>r.jsxs("tr",{style:{height:"60px"},children:[r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("i",{className:"bi bi-house text-success me-2"}),r.jsxs("div",{children:[r.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:C=>{C.preventDefault(),C.stopPropagation(),j(`/local-products/edit/${R.id}`)},title:`  : ${R.name}`,children:R.name}),r.jsx("small",{className:"text-muted",children:R.category})]})]})}),r.jsxs("td",{className:"text-center",children:[r.jsxs("span",{className:"fw-bold text-success",children:[Math.round(R.unitPrice)," "]}),r.jsx("div",{children:r.jsxs("small",{className:"text-muted",children:["/",R.unit||""]})})]}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>H(R.id,Math.max(0,Number((R.quantity-.1).toFixed(1)))),disabled:R.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:r.jsx("i",{className:"bi bi-dash"})}),r.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:R.quantity,min:"0",step:"any",onChange:C=>H(R.id,C.target.value),onBlur:C=>{const z=Number(C.target.value||0).toFixed(1);H(R.id,z)}}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>H(R.id,Number((R.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:r.jsx("i",{className:"bi bi-plus"})})]})}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"text-muted",children:R.displaySupplier||"-"})}),r.jsxs("td",{className:"text-center",children:[r.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(R.totalPrice)," "]}),r.jsxs("small",{className:"text-success",children:["(",R.quantity.toFixed(1),"  ",Math.round(R.unitPrice),")"]})]})]},R.id))})]})})}),r.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:r.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("span",{className:"text-muted me-3",children:" :"}),r.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[Y()," "]}),r.jsxs("span",{className:"badge bg-info ms-2",children:[g.reduce((R,_)=>R+_.quantity,0).toFixed(1)," "]})]}),r.jsxs("div",{className:"d-flex gap-2",children:[r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:se,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),r.jsx("button",{type:"button",className:"btn btn-primary",onClick:ee,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})]})})]})})}),r.jsx(Wt,{show:O.show,onClose:M,title:O.title,message:O.message,type:O.type,onConfirm:O.onConfirm,showConfirm:O.showConfirm})]})}function M9(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(O9,{})})})}function L9(){const[n,e]=b.useState(!1),{isTimelineVisible:t}=gn(),[s,i]=b.useState([]),[a,o]=b.useState([]),[l,c]=b.useState(!1),[d,h]=b.useState(null),[f,p]=b.useState(""),[x,I]=b.useState([]),[D,A]=b.useState(!1),[g,N]=b.useState([]),j=On(),{productId:V}=li(),{logActivity:$,getCurrentUser:Z}=$t(),{alertConfig:O,closeAlert:M,showSuccess:T,showError:L}=Kt(),G=()=>{e(!n)};b.useEffect(()=>{U();const Y=C=>{C.type==="foreignProductsUpdated"&&U()},R=()=>{U()};window.addEventListener("storage",Y),window.addEventListener("foreignProductsUpdated",R);const _=()=>{U()};return window.addEventListener("focus",_),()=>{window.removeEventListener("storage",Y),window.removeEventListener("foreignProductsUpdated",R),window.removeEventListener("focus",_)}},[]),b.useEffect(()=>{if(f.trim()){const Y=s.filter(R=>{var _,C,z,K,F;return((_=R.name)==null?void 0:_.toLowerCase().includes(f.toLowerCase()))||((C=R.category)==null?void 0:C.toLowerCase().includes(f.toLowerCase()))||((z=R.description)==null?void 0:z.toLowerCase().includes(f.toLowerCase()))||((K=R.supplier)==null?void 0:K.toLowerCase().includes(f.toLowerCase()))||((F=R.countryOfOrigin)==null?void 0:F.toLowerCase().includes(f.toLowerCase()))});I(Y)}else I(s)},[f,s]);const U=async()=>{try{c(!0);const R=(await Ls.getAllForeignProducts()).filter(_=>_.active!==!1);i(R),h(null)}catch(Y){h(Y.message)}finally{c(!1)}},k=Y=>{if(a.some(_=>_.internalId===Y.internalId))o(_=>_.filter(C=>C.internalId!==Y.internalId));else{const _={...Y,type:"foreignProduct",quantity:1};o(C=>[...C,_])}},re=async()=>{if(a.length===0){L("      ","   ");return}const Y=await qe.getPendingProductItems()||[];let R=[];Y&&Array.isArray(Y)&&(R=Y.map(K=>K.materialInternalId));const _=[],C=a.filter(K=>{const F=R.includes(K.internalId);return F&&_.push(K.name),!F});if(_.length>0){const K=_.join(" ");if(L(`     : ${K}`," "),C.length===0)return;console.log(`Found ${_.length} duplicate items, proceeding with ${C.length} unique items`)}const z=C.map(K=>{let F=K.price||0,Q=K.supplier;if(K.priceQuotes&&Array.isArray(K.priceQuotes)&&K.priceQuotes.length>0){const oe=K.priceQuotes.reduce((E,te)=>{const Te=parseFloat(E.price)||0;return(parseFloat(te.price)||0)<Te?te:E});F=parseFloat(oe.price)||0,Q=oe.supplierName}return{...K,quantity:1,unitPrice:F,totalPrice:F,displaySupplier:Q}});N(z),A(!0)},xe=(Y,R)=>{const _=Math.max(0,parseFloat(R)||0);N(C=>C.map(z=>z.id===Y?{...z,quantity:Number(_.toFixed(1)),totalPrice:z.unitPrice*Number(_.toFixed(1))}:z))},H=async()=>{try{if(!Array.isArray(g)||g.length===0){L("    ","  ");return}const Y=[];for(const C of g)try{console.log(" SENIOR REACT: Creating tender item directly for:",C.name);const z={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:C.internalId,materialType:"foreignProduct",materialName:C.name,materialCategory:C.category||"",materialUnit:C.unit||"",quantity:C.quantity||1,unitPrice:C.unitPrice||0,totalPrice:(C.quantity||1)*(C.unitPrice||0),supplierInfo:C.displaySupplier||"",tenderId:V==="new"?"new":V,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};Y.push(z),console.log(" SENIOR REACT: Created tender item directly:",{id:z.internalId,materialId:z.materialInternalId,name:z.materialName,quantity:z.quantity,unitPrice:z.unitPrice,totalPrice:z.totalPrice})}catch(z){console.error("Error creating manufactured product item for product:",C.name,z),L(`   : ${C.name}`,"  ");return}const R=await qe.getPendingProductItems()||[],_=[...R,...Y];console.log(" SENIOR REACT: Merging manufactured product items:",{existingCount:R.length,newCount:Y.length,totalCount:_.length,items:Y.map(C=>({id:C.internalId,materialId:C.materialInternalId,name:C.materialName,price:C.unitPrice,total:C.totalPrice}))}),await qe.setPendingProductItems(_),console.log(" SENIOR REACT: Dispatching product items added event"),window.dispatchEvent(new CustomEvent("productItemsAdded",{detail:{source:"ManufacturedForeignProducts",itemsCount:Y.length,items:Y.map(C=>({id:C.internalId,name:C.materialName,type:C.materialType}))}}));try{const C=Z();C&&C.name&&$("task",`${C.name}     `,`  ${Y.length}  `)}catch(C){console.error("Failed to log activity:",C)}T(`  ${Y.length}     `," "),A(!1),N([]),setTimeout(()=>{j(V==="new"?"/manufactured-products/add":`/manufactured-products/edit/${V}`)},100)}catch(Y){console.error("Error in handleConfirmQuantities:",Y),L("       -   ","  ")}},ee=()=>{A(!1),N([])},se=()=>Math.round(g.reduce((Y,R)=>Y+R.totalPrice,0));return l?r.jsx(an,{show:!0,message:"    ...",overlay:!1}):d?r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"text-danger mb-3",children:r.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),r.jsx("h5",{className:"text-danger",children:" "}),r.jsx("p",{className:"text-muted",children:d}),r.jsxs("button",{className:"btn btn-primary",onClick:U,children:[r.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[r.jsx(Nn,{onToggle:G}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-primary",children:"  "}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),r.jsx(jn,{}),r.jsx("div",{className:"app-content-area p-3",children:r.jsx("div",{className:"raw-materials-table",children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"row align-items-center justify-content-between",children:[r.jsx("div",{className:"col-lg-4",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-globe text-info me-2"}),"   (",x.length,")"]})}),r.jsx("div",{className:"col-lg-8",children:r.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[r.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[r.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:f,onChange:Y=>p(Y.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),r.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:r.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),r.jsxs("button",{className:"btn btn-info shadow-sm px-4",onClick:re,disabled:a.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["  (",a.length,")"]}),r.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const Y=V!=="new"?`/manufactured-products/edit/${V}`:"/manufactured-products/add";j(Y)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:"  "})]})})]})}),r.jsx("div",{className:"card-body p-0",children:x.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-globe fs-1"})}),r.jsx("h5",{className:"text-muted",children:"   "}),r.jsx("p",{className:"text-muted",children:f?"    ":"      "})]}):r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:" "})]})}),r.jsx("tbody",{children:x.map(Y=>{let R=Y.price,_=Y.supplier,C=!1,z=null;return Y.priceQuotes&&Array.isArray(Y.priceQuotes)&&Y.priceQuotes.length>0&&(C=!0,z=Y.priceQuotes.reduce((K,F)=>{const Q=parseFloat(K.price)||0;return(parseFloat(F.price)||0)<Q?F:K}),R=z.price,_=z.supplierName),r.jsxs("tr",{children:[r.jsx("td",{className:"text-center",children:r.jsx("div",{className:"form-check d-flex justify-content-center",children:r.jsx("input",{className:"form-check-input",type:"checkbox",checked:a.some(K=>K.internalId===Y.internalId),onChange:()=>k(Y),style:{transform:"scale(1.2)"}})})}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"fw-bold text-primary",children:Y.name})}),r.jsx("td",{className:"text-center",children:Y.category||"-"}),r.jsx("td",{className:"text-center",children:Y.unit||"-"}),r.jsx("td",{className:"text-center",children:R?r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsxs("span",{children:[R," "]}),C&&r.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),r.jsx("td",{className:"text-center",children:_?r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("span",{children:_}),C&&r.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"badge bg-warning text-dark",children:Y.countryOfOrigin||" "})})]},Y.id)})})]})})})]})})}),r.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:r.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&t&&r.jsx(_n,{rtl:!0}),!n&&t&&r.jsx(En,{})]}),D&&r.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:r.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[r.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),r.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:ee,"aria-label":"Close"})]}),r.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"30%"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),r.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),r.jsx("th",{className:"text-center",style:{width:"15%"},children:""}),r.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),r.jsx("tbody",{children:g.map((Y,R)=>r.jsxs("tr",{style:{height:"60px"},children:[r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("i",{className:"bi bi-globe text-info me-2"}),r.jsxs("div",{children:[r.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:_=>{_.preventDefault(),_.stopPropagation(),j(`/foreign-products/edit/${Y.id}`)},title:`  : ${Y.name}`,children:Y.name}),r.jsx("small",{className:"text-muted",children:Y.category}),r.jsx("div",{children:r.jsx("span",{className:"badge bg-warning text-dark",style:{fontSize:"10px"},children:Y.countryOfOrigin||" "})})]})]})}),r.jsxs("td",{className:"text-center",children:[r.jsxs("span",{className:"fw-bold text-success",children:[Math.round(Y.unitPrice)," "]}),r.jsx("div",{children:r.jsxs("small",{className:"text-muted",children:["/",Y.unit||""]})})]}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>xe(Y.id,Math.max(0,Number((Y.quantity-.1).toFixed(1)))),disabled:Y.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:r.jsx("i",{className:"bi bi-dash"})}),r.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:Y.quantity,min:"0",step:"any",onChange:_=>xe(Y.id,_.target.value),onBlur:_=>{const C=Number(_.target.value||0).toFixed(1);xe(Y.id,C)}}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>xe(Y.id,Number((Y.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:r.jsx("i",{className:"bi bi-plus"})})]})}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"text-muted",children:Y.displaySupplier||"-"})}),r.jsxs("td",{className:"text-center",children:[r.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(Y.totalPrice)," "]}),r.jsxs("small",{className:"text-success",children:["(",Y.quantity.toFixed(1),"  ",Math.round(Y.unitPrice),")"]})]})]},Y.id))})]})})}),r.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:r.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("span",{className:"text-muted me-3",children:" :"}),r.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[se()," "]}),r.jsxs("span",{className:"badge bg-info ms-2",children:[g.reduce((Y,R)=>Y+R.quantity,0).toFixed(1)," "]})]}),r.jsxs("div",{className:"d-flex gap-2",children:[r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:ee,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),r.jsx("button",{type:"button",className:"btn btn-primary",onClick:H,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})]})})]})})}),r.jsx(Wt,{show:O.show,onClose:M,title:O.title,message:O.message,type:O.type,onConfirm:O.onConfirm,showConfirm:O.showConfirm})]})}function F9(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(L9,{})})})}const U9=({onEdit:n,onAdd:e,refreshTrigger:t})=>{const[s,i]=b.useState([]),[a,o]=b.useState(!0),[l,c]=b.useState(null),[d,h]=b.useState(""),[f,p]=b.useState([]),[x,I]=b.useState(!1),{logActivity:D,getCurrentUser:A}=$t(),{alertConfig:g,closeAlert:N,showSuccess:j,showError:V,showConfirm:$}=Kt(),{currentPage:Z,totalPages:O,paginatedItems:M,handlePageChange:T,resetPage:L,totalItems:G,itemsPerPage:U}=Ni(f,30);b.useEffect(()=>{k()},[]),b.useEffect(()=>{t&&k()},[t]),b.useEffect(()=>{if(d.trim()){const H=s.filter(ee=>{var se,Y,R;return((se=ee.name)==null?void 0:se.toLowerCase().includes(d.toLowerCase()))||((Y=ee.email)==null?void 0:Y.toLowerCase().includes(d.toLowerCase()))||((R=ee.phone)==null?void 0:R.includes(d))});p(H)}else p(s);L()},[d,s,L]);const k=async()=>{try{o(!0);const H=await ri.getAllSuppliers();i(H),c(null)}catch(H){c(H.message)}finally{o(!1)}},re=H=>{$(`      

${H.name}`,()=>xe(H),"  ")},xe=async H=>{try{I(!0),await un.moveToTrash(H,"suppliers"),await ri.deleteSupplier(H.id);const ee=A();D("task",`${ee.name}   `,`  : ${H.name}`),await k(),j(`   : ${H.name}`,"  ")}catch(ee){c(ee.message),V(`    : ${ee.message}`,"  ")}finally{I(!1)}};return a?r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"spinner-border text-primary",role:"status",children:r.jsx("span",{className:"visually-hidden",children:" ..."})}),r.jsx("p",{className:"mt-3 text-muted",children:"   ..."})]})}):l?r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"text-danger mb-3",children:r.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),r.jsx("h5",{className:"text-danger",children:" "}),r.jsx("p",{className:"text-muted",children:l}),r.jsxs("button",{className:"btn btn-primary",onClick:k,children:[r.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):r.jsxs("div",{className:"card shadow-sm","data-list":"suppliers",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"row align-items-center justify-content-between",children:[r.jsx("div",{className:"col-lg-4",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-people-fill text-primary me-2"}),"  (",f.length,")"]})}),r.jsx("div",{className:"col-lg-8",children:r.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[r.jsxs("div",{className:"input-group suppliers-search",style:{maxWidth:"350px"},children:[r.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:d,onChange:H=>h(H.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),r.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:r.jsx("i",{className:"bi bi-search text-muted"})})]}),r.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:e,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[r.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"  "]})]})})]})}),r.jsxs("div",{className:"card-body p-0",children:[f.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-people fs-1"})}),r.jsx("h5",{className:"text-muted",children:"  "}),r.jsx("p",{className:"text-muted",children:d?"    ":"     "}),!d&&r.jsxs("button",{className:"btn btn-primary",onClick:e,children:[r.jsx("i",{className:"bi bi-plus-lg me-1"}),"  "]})]}):r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"60px"},children:"#"}),r.jsx("th",{children:" "}),r.jsx("th",{children:" "}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{style:{width:"120px"},children:""})]})}),r.jsx("tbody",{children:M.map((H,ee)=>r.jsxs("tr",{children:[r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(Z-1)*U+ee+1})}),r.jsx("td",{children:r.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",onClick:()=>n(H),style:{textDecoration:"none"},title:`Internal ID: ${H.internalId||"Not Set"}`,children:H.name})}),r.jsx("td",{children:r.jsx("a",{href:`mailto:${H.email}`,className:"text-decoration-none",children:H.email})}),r.jsx("td",{style:{direction:"ltr",textAlign:"left"},children:H.phone}),r.jsx("td",{children:H.city||"-"}),r.jsx("td",{children:r.jsxs("div",{className:"btn-group btn-group-sm",children:[r.jsx("button",{className:"btn btn-outline-primary",onClick:()=>n(H),title:"",children:r.jsx("i",{className:"bi bi-pencil"})}),r.jsx("button",{className:"btn btn-outline-danger",onClick:()=>re(H),title:"",children:r.jsx("i",{className:"bi bi-trash"})})]})})]},H.internalId||H.id))})]})}),f.length>0&&r.jsx(ji,{currentPage:Z,totalPages:O,onPageChange:T,totalItems:G,itemsPerPage:U})]}),r.jsx(Wt,{show:g.show,onClose:N,title:g.title,message:g.message,type:g.type,onConfirm:g.onConfirm,confirmText:g.confirmText,cancelText:g.cancelText,showCancel:g.showCancel})]})},V9=({supplier:n,onSave:e,onCancel:t})=>{const[s,i]=b.useState({name:"",email:"",phone:"",address:"",city:"",taxNumber:"",bankAccount:"",notes:"",active:!0}),[a,o]=b.useState({}),[l,c]=b.useState(!1),d=!!n,{logActivity:h,getCurrentUser:f}=$t();b.useEffect(()=>{n&&i({name:n.name||"",email:n.email||"",phone:n.phone||"",address:n.address||"",city:n.city||"",taxNumber:n.taxNumber||"",bankAccount:n.bankAccount||"",notes:n.notes||"",active:n.active!==void 0?n.active:!0})},[n]);const p=I=>{const{name:D,value:A,type:g,checked:N}=I.target;i(j=>({...j,[D]:g==="checkbox"?N:A})),a[D]&&o(j=>({...j,[D]:""}))},x=async I=>{I.preventDefault();const D=ri.validateSupplierData(s);if(Object.keys(D).length>0){o(D);return}c(!0),o({});try{const A=await _i.validateUniqueFields(s,d?n.id:null,d?"suppliers":null);if(Object.keys(A).length>0){o(A),c(!1);return}const g={...s,status:d&&n.status||"active"};if(d){await ri.updateSupplier(n.id,g);const N=f();h("task",`${N.name}   `,`  : ${g.name}`)}else{await ri.createSupplier(g);const N=f();h("task",`${N.name}   `,`  : ${g.name}`)}e()}catch(A){o({submit:A.message})}finally{c(!1)}};return r.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:r.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:r.jsxs("div",{className:"modal-content",children:[r.jsxs("div",{className:"modal-header",children:[r.jsxs("h5",{className:"modal-title",children:[r.jsx("i",{className:"bi bi-person-plus-fill text-primary me-2"}),d?" ":"  "]}),r.jsx("button",{type:"button",className:"btn-close",onClick:t})]}),r.jsxs("form",{onSubmit:x,children:[r.jsxs("div",{className:"modal-body",children:[a.submit&&r.jsxs("div",{className:"alert alert-danger",children:[r.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.submit]}),r.jsxs("div",{className:"row",children:[r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"text",className:`form-control ${a.name?"is-invalid":""}`,name:"name",value:s.name,onChange:p,placeholder:"  "}),a.name&&r.jsx("div",{className:"invalid-feedback",children:a.name})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"email",className:`form-control ${a.email?"is-invalid":""}`,name:"email",value:s.email,onChange:p,placeholder:"example@company.com"}),a.email&&r.jsx("div",{className:"invalid-feedback",children:a.email})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"tel",className:`form-control ${a.phone?"is-invalid":""}`,name:"phone",value:s.phone,onKeyPress:I=>{/[0-9+]/.test(I.key)||I.preventDefault()},onChange:I=>{const D=I.target.value.replace(/[^0-9+]/g,"");p({target:{name:"phone",value:D}})},placeholder:"+966 50 123 4567"}),a.phone&&r.jsx("div",{className:"invalid-feedback",children:a.phone})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:""}),r.jsx("input",{type:"text",className:"form-control",name:"city",value:s.city,onChange:p,placeholder:""})]}),r.jsxs("div",{className:"col-md-12 mb-3",children:[r.jsx("label",{className:"form-label",children:""}),r.jsx("textarea",{className:"form-control",name:"address",value:s.address,onChange:p,rows:"2",placeholder:"  "})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:" "}),r.jsx("input",{type:"text",className:"form-control",name:"taxNumber",value:s.taxNumber,onChange:p,placeholder:" "})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  "}),r.jsx("input",{type:"text",className:"form-control",name:"bankAccount",value:s.bankAccount,onChange:p,placeholder:"  "})]}),r.jsxs("div",{className:"col-md-12 mb-3",children:[r.jsx("label",{className:"form-label",children:""}),r.jsx("textarea",{className:"form-control",name:"notes",value:s.notes,onChange:p,rows:"3",placeholder:"  ..."})]}),r.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:r.jsxs("div",{className:"d-flex align-items-center gap-2",children:[r.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"":" "}),r.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"supplierActiveSwitch",name:"active",checked:s.active,onChange:p,style:{width:"50px",height:"25px",cursor:"pointer"}})]})})]})]}),r.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:r.jsxs("div",{className:"d-flex gap-3",children:[r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:t,disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""}),r.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:l?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"12px",height:"12px"}}),"..."]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"bi bi-check-lg me-1"}),d?"":""]})})]})})]})]})})})};function z9(){const[n,e]=b.useState(!1),[t,s]=b.useState(!1),[i,a]=b.useState(null),[o,l]=b.useState(0),{isTimelineVisible:c}=gn(),d=()=>{e(!n)},h=()=>{a(null),s(!0)},f=I=>{a(I),s(!0)},p=()=>{s(!1),a(null),l(I=>I+1)},x=()=>{s(!1),a(null)};return r.jsx(At,{children:r.jsx(Dt,{children:r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[r.jsx(Nn,{onToggle:d}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!c?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-primary",children:""}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),r.jsx(jn,{}),r.jsx("div",{className:"app-content-area p-3",children:r.jsx("div",{className:"suppliers-table",children:r.jsx(U9,{onAdd:h,onEdit:f,refreshTrigger:o})})})]}),r.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:r.jsx("span",{children:" Modern Bin 2025"})})]}),!n&&c&&r.jsx(_n,{rtl:!0}),!n&&c&&r.jsx(En,{}),t&&r.jsx("div",{className:"supplier-form",children:r.jsx(V9,{supplier:i,onSave:p,onCancel:x})})]})})})}function $9(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(z9,{})})})}const B9=({onEdit:n,onAdd:e,refreshTrigger:t})=>{const[s,i]=b.useState([]),[a,o]=b.useState(!0),[l,c]=b.useState(null),[d,h]=b.useState(""),[f,p]=b.useState([]),[x,I]=b.useState(!1),{logActivity:D,getCurrentUser:A}=$t(),{alertConfig:g,closeAlert:N,showSuccess:j,showError:V,showConfirm:$}=Kt(),{currentPage:Z,totalPages:O,paginatedItems:M,handlePageChange:T,resetPage:L,totalItems:G,itemsPerPage:U}=Ni(f,30);b.useEffect(()=>{k()},[]),b.useEffect(()=>{t&&k()},[t]),b.useEffect(()=>{if(d.trim()){const H=s.filter(ee=>{var se,Y,R;return((se=ee.name)==null?void 0:se.toLowerCase().includes(d.toLowerCase()))||((Y=ee.email)==null?void 0:Y.toLowerCase().includes(d.toLowerCase()))||((R=ee.phone)==null?void 0:R.includes(d))});p(H)}else p(s);L()},[d,s,L]);const k=async()=>{try{o(!0);const H=await ii.getAllSuppliers();i(H),c(null)}catch(H){c(H.message)}finally{o(!1)}},re=H=>{$(`      

${H.name}`,()=>xe(H),"  ")},xe=async H=>{try{I(!0),await un.moveToTrash(H,"foreignSuppliers"),await ii.deleteSupplier(H.id);const ee=A();D("task",`${ee.name}   `,`  : ${H.name}`),await k(),j(`     : ${H.name}`,"  ")}catch(ee){c(ee.message),V(`    : ${ee.message}`,"  ")}finally{I(!1)}};return a?r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"spinner-border text-primary",role:"status",children:r.jsx("span",{className:"visually-hidden",children:" ..."})}),r.jsx("p",{className:"mt-3 text-muted",children:"   ..."})]})}):l?r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"text-danger mb-3",children:r.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),r.jsx("h5",{className:"text-danger",children:" "}),r.jsx("p",{className:"text-muted",children:l}),r.jsxs("button",{className:"btn btn-primary",onClick:k,children:[r.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):r.jsxs("div",{className:"card shadow-sm","data-list":"foreign-suppliers",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"row align-items-center justify-content-between",children:[r.jsx("div",{className:"col-lg-4",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-people-fill text-primary me-2"}),"  (",f.length,")"]})}),r.jsx("div",{className:"col-lg-8",children:r.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[r.jsxs("div",{className:"input-group suppliers-search",style:{maxWidth:"350px"},children:[r.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:d,onChange:H=>h(H.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),r.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:r.jsx("i",{className:"bi bi-search text-muted"})})]}),r.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:e,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[r.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"  "]})]})})]})}),r.jsxs("div",{className:"card-body p-0",children:[f.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-people fs-1"})}),r.jsx("h5",{className:"text-muted",children:"  "}),r.jsx("p",{className:"text-muted",children:d?"    ":"     "}),!d&&r.jsxs("button",{className:"btn btn-primary",onClick:e,children:[r.jsx("i",{className:"bi bi-plus-lg me-1"}),"  "]})]}):r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"60px"},children:"#"}),r.jsx("th",{children:" "}),r.jsx("th",{children:" "}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{style:{width:"120px"},children:""})]})}),r.jsx("tbody",{children:M.map((H,ee)=>r.jsxs("tr",{children:[r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(Z-1)*U+ee+1})}),r.jsx("td",{children:r.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",onClick:()=>n(H),style:{textDecoration:"none"},title:`Internal ID: ${H.internalId||"Not Set"}`,children:H.name})}),r.jsx("td",{children:r.jsx("a",{href:`mailto:${H.email}`,className:"text-decoration-none",children:H.email})}),r.jsx("td",{style:{direction:"ltr",textAlign:"left"},children:H.phone}),r.jsx("td",{children:H.city||"-"}),r.jsx("td",{children:r.jsxs("div",{className:"btn-group btn-group-sm",children:[r.jsx("button",{className:"btn btn-outline-primary",onClick:()=>n(H),title:"",children:r.jsx("i",{className:"bi bi-pencil"})}),r.jsx("button",{className:"btn btn-outline-danger",onClick:()=>re(H),title:"",children:r.jsx("i",{className:"bi bi-trash"})})]})})]},H.internalId||H.id))})]})}),f.length>0&&r.jsx(ji,{currentPage:Z,totalPages:O,onPageChange:T,totalItems:G,itemsPerPage:U})]}),r.jsx(Wt,{show:g.show,onClose:N,title:g.title,message:g.message,type:g.type,onConfirm:g.onConfirm,confirmText:g.confirmText,cancelText:g.cancelText,showCancel:g.showCancel})]})},q9=({supplier:n,onSave:e,onCancel:t})=>{const[s,i]=b.useState({name:"",email:"",phone:"",address:"",city:"",website:"",bankAccount:"",notes:"",active:!0}),[a,o]=b.useState({}),[l,c]=b.useState(!1),d=!!n,{logActivity:h,getCurrentUser:f}=$t();b.useEffect(()=>{n&&i({name:n.name||"",email:n.email||"",phone:n.phone||"",address:n.address||"",city:n.city||"",website:n.website||"",bankAccount:n.bankAccount||"",notes:n.notes||"",active:n.active!==void 0?n.active:!0})},[n]);const p=I=>{const{name:D,value:A,type:g,checked:N}=I.target;i(j=>({...j,[D]:g==="checkbox"?N:A})),a[D]&&o(j=>({...j,[D]:""}))},x=async I=>{I.preventDefault();const D=ii.validateSupplierData(s);if(Object.keys(D).length>0){o(D);return}c(!0),o({});try{const A=await _i.validateUniqueFields(s,d?n.id:null,d?"foreignSuppliers":null);if(Object.keys(A).length>0){o(A),c(!1);return}const g={...s,status:d&&n.status||"active"};if(d){await ii.updateSupplier(n.id,g);const N=f();h("task",`${N.name}   `,`  : ${g.name}`)}else{await ii.createSupplier(g);const N=f();h("task",`${N.name}   `,`  : ${g.name}`)}e()}catch(A){o({submit:A.message})}finally{c(!1)}};return r.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:r.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:r.jsxs("div",{className:"modal-content",children:[r.jsxs("div",{className:"modal-header",children:[r.jsxs("h5",{className:"modal-title",children:[r.jsx("i",{className:"bi bi-person-plus-fill text-primary me-2"}),d?" ":"  "]}),r.jsx("button",{type:"button",className:"btn-close",onClick:t})]}),r.jsxs("form",{onSubmit:x,children:[r.jsxs("div",{className:"modal-body",children:[a.submit&&r.jsxs("div",{className:"alert alert-danger",children:[r.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.submit]}),r.jsxs("div",{className:"row",children:[r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"text",className:`form-control ${a.name?"is-invalid":""}`,name:"name",value:s.name,onChange:p,placeholder:"  "}),a.name&&r.jsx("div",{className:"invalid-feedback",children:a.name})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"email",className:`form-control ${a.email?"is-invalid":""}`,name:"email",value:s.email,onChange:p,placeholder:"example@company.com"}),a.email&&r.jsx("div",{className:"invalid-feedback",children:a.email})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"tel",className:`form-control ${a.phone?"is-invalid":""}`,name:"phone",value:s.phone,onKeyPress:I=>{/[0-9+]/.test(I.key)||I.preventDefault()},onChange:I=>{const D=I.target.value.replace(/[^0-9+]/g,"");p({target:{name:"phone",value:D}})},placeholder:"+966 50 123 4567"}),a.phone&&r.jsx("div",{className:"invalid-feedback",children:a.phone})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:""}),r.jsx("input",{type:"text",className:"form-control",name:"city",value:s.city,onChange:p,placeholder:""})]}),r.jsxs("div",{className:"col-md-12 mb-3",children:[r.jsx("label",{className:"form-label",children:""}),r.jsx("textarea",{className:"form-control",name:"address",value:s.address,onChange:p,rows:"2",placeholder:"  "})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:" "}),r.jsx("input",{type:"url",className:"form-control",name:"website",value:s.website,onChange:p,placeholder:"https://www.company.com"})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  "}),r.jsx("input",{type:"text",className:"form-control",name:"bankAccount",value:s.bankAccount,onChange:p,placeholder:"  "})]}),r.jsxs("div",{className:"col-md-12 mb-3",children:[r.jsx("label",{className:"form-label",children:""}),r.jsx("textarea",{className:"form-control",name:"notes",value:s.notes,onChange:p,rows:"3",placeholder:"  ..."})]}),r.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:r.jsxs("div",{className:"d-flex align-items-center gap-2",children:[r.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"":" "}),r.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"foreignSupplierActiveSwitch",name:"active",checked:s.active,onChange:p,style:{width:"50px",height:"25px",cursor:"pointer"}})]})})]})]}),r.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:r.jsxs("div",{className:"d-flex gap-3",children:[r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:t,disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""}),r.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:l?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"12px",height:"12px"}}),"..."]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"bi bi-check-lg me-1"}),d?"":""]})})]})})]})]})})})};function H9(){const[n,e]=b.useState(!1),[t,s]=b.useState(!1),[i,a]=b.useState(null),[o,l]=b.useState(0),{isTimelineVisible:c}=gn(),d=()=>{e(!n)},h=()=>{a(null),s(!0)},f=I=>{a(I),s(!0)},p=()=>{s(!1),a(null),l(I=>I+1)},x=()=>{s(!1),a(null)};return r.jsx(At,{children:r.jsx(Dt,{children:r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[r.jsx(Nn,{onToggle:d}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!c?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-primary",children:""}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),r.jsx(jn,{}),r.jsx("div",{className:"app-content-area p-3",children:r.jsx("div",{className:"suppliers-table",children:r.jsx(B9,{onAdd:h,onEdit:f,refreshTrigger:o})})})]}),r.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:r.jsx("span",{children:" Modern Bin 2025"})})]}),!n&&c&&r.jsx(_n,{rtl:!0}),!n&&c&&r.jsx(En,{}),t&&r.jsx("div",{className:"supplier-form",children:r.jsx(q9,{supplier:i,onSave:p,onCancel:x})})]})})})}function G9(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(H9,{})})})}const Ol="customers";class Rd{static async getAllCustomers(){try{const e=Qe(pe,Ol),t=pt(e,$n("createdAt","desc"));return(await lt(t)).docs.map(i=>{var o,l;const a=i.data();return{id:i.id,internalId:a.internalId||ct("CUSTOMER"),...a,createdAt:(o=a.createdAt)==null?void 0:o.toDate(),updatedAt:(l=a.updatedAt)==null?void 0:l.toDate()}})}catch(e){throw console.error("Error fetching customers:",e),new Error("    ")}}static async createCustomer(e){try{const t=ct("CUSTOMER"),s={...e,internalId:t,createdAt:it(),updatedAt:it()};return(await Ys(Qe(pe,Ol),s)).id}catch(t){throw console.error("Error creating customer:",t),new Error("   ")}}static async updateCustomer(e,t){try{const s=Ye(pe,Ol,e),i={...t,updatedAt:it()};return await gs(s,i),!0}catch(s){throw console.error("Error updating customer:",s),new Error("    ")}}static async getCustomerById(e){var t,s;try{const i=Ye(pe,Ol,e),a=await Un(i);if(a.exists()){const o=a.data();return{id:a.id,internalId:o.internalId||ct("CUSTOMER"),...o,createdAt:(t=o.createdAt)==null?void 0:t.toDate(),updatedAt:(s=o.updatedAt)==null?void 0:s.toDate()}}else return null}catch(i){throw console.error("Error fetching customer by ID:",i),new Error("    ")}}static async getCustomerByInternalId(e){var t,s;try{const i=Qe(pe,Ol),a=pt(i,qt("internalId","==",e)),o=await lt(a);if(o.empty)return null;{const l=o.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:(t=c.createdAt)==null?void 0:t.toDate(),updatedAt:(s=c.updatedAt)==null?void 0:s.toDate()}}}catch(i){throw console.error("Error fetching customer by internal ID:",i),new Error("    ")}}static async updateCustomerByInternalId(e,t){try{const s=await this.getCustomerByInternalId(e);if(!s)throw new Error("Customer not found");return await this.updateCustomer(s.id,t)}catch(s){throw console.error("Error updating customer by internal ID:",s),new Error("    ")}}static async deleteCustomer(e){try{const t=Ye(pe,Ol,e);return await xs(t),!0}catch(t){throw console.error("Error deleting customer:",t),new Error("   ")}}static async deleteCustomerByInternalId(e){try{const t=await this.getCustomerByInternalId(e);if(!t)throw new Error("Customer not found");return await this.deleteCustomer(t.id)}catch(t){throw console.error("Error deleting customer by internal ID:",t),new Error("   ")}}static async searchCustomers(e){try{const t=Qe(pe,Ol);return(await lt(t)).docs.map(o=>{var c,d;const l=o.data();return{id:o.id,internalId:l.internalId||ct("CUSTOMER"),...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}}).filter(o=>{var l,c,d;return((l=o.name)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))||((c=o.email)==null?void 0:c.toLowerCase().includes(e.toLowerCase()))||((d=o.phone)==null?void 0:d.includes(e))})}catch(t){throw console.error("Error searching customers:",t),new Error("    ")}}static async migrateExistingData(){try{console.log("Starting customers migration...");const e=await this.getAllCustomers();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("cst_")){const i=ct("CUSTOMER");await this.updateCustomer(s.id,{...s,internalId:i}),t++,console.log(`Migrated customer: ${s.name} -> ${i}`)}return console.log(`Migration completed. ${t} customers migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("   ")}}static validateCustomerData(e){var s,i,a;const t={};return(s=e.name)!=null&&s.trim()||(t.name="  "),(i=e.email)!=null&&i.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(t.email="    "):t.email="  ",(a=e.phone)!=null&&a.trim()||(t.phone="  "),t}}const Q9=Object.freeze(Object.defineProperty({__proto__:null,CustomerService:Rd},Symbol.toStringTag,{value:"Module"})),W9=({onEdit:n,onAdd:e,refreshTrigger:t})=>{const[s,i]=b.useState([]),[a,o]=b.useState(!0),[l,c]=b.useState(null),[d,h]=b.useState(""),[f,p]=b.useState([]),[x,I]=b.useState(!1),{logActivity:D,getCurrentUser:A}=$t(),{alertConfig:g,closeAlert:N,showSuccess:j,showError:V,showConfirm:$}=Kt(),{currentPage:Z,totalPages:O,paginatedItems:M,handlePageChange:T,resetPage:L,totalItems:G,itemsPerPage:U}=Ni(f,30);b.useEffect(()=>{k()},[]),b.useEffect(()=>{t&&k()},[t]),b.useEffect(()=>{if(d.trim()){const H=s.filter(ee=>{var se,Y,R;return((se=ee.name)==null?void 0:se.toLowerCase().includes(d.toLowerCase()))||((Y=ee.email)==null?void 0:Y.toLowerCase().includes(d.toLowerCase()))||((R=ee.phone)==null?void 0:R.includes(d))});p(H)}else p(s);L()},[d,s,L]);const k=async()=>{try{o(!0);const H=await Rd.getAllCustomers();i(H),c(null)}catch(H){c(H.message)}finally{o(!1)}},re=H=>{$(`      

${H.name}`,()=>xe(H),"  ")},xe=async H=>{try{I(!0),await un.moveToTrash(H,"customers"),await Rd.deleteCustomer(H.id);const ee=A();D("task",`${ee.name}  `,`  : ${H.name}`),await k(),j(`   : ${H.name}`,"  ")}catch(ee){c(ee.message),V(`    : ${ee.message}`,"  ")}finally{I(!1)}};return a?r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"spinner-border text-primary",role:"status",children:r.jsx("span",{className:"visually-hidden",children:" ..."})}),r.jsx("p",{className:"mt-3 text-muted",children:"   ..."})]})}):l?r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"text-danger mb-3",children:r.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),r.jsx("h5",{className:"text-danger",children:" "}),r.jsx("p",{className:"text-muted",children:l}),r.jsxs("button",{className:"btn btn-primary",onClick:k,children:[r.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):r.jsxs("div",{className:"card shadow-sm","data-list":"customers",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"row align-items-center justify-content-between",children:[r.jsx("div",{className:"col-lg-4",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-person-lines-fill text-primary me-2"}),"  (",f.length,")"]})}),r.jsx("div",{className:"col-lg-8",children:r.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[r.jsxs("div",{className:"input-group customers-search",style:{maxWidth:"350px"},children:[r.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:d,onChange:H=>h(H.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),r.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:r.jsx("i",{className:"bi bi-search text-muted"})})]}),r.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:e,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[r.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"  "]})]})})]})}),r.jsxs("div",{className:"card-body p-0",children:[f.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-person-lines-fill fs-1"})}),r.jsx("h5",{className:"text-muted",children:"  "}),r.jsx("p",{className:"text-muted",children:d?"    ":"     "}),!d&&r.jsxs("button",{className:"btn btn-primary",onClick:e,children:[r.jsx("i",{className:"bi bi-plus-lg me-1"}),"  "]})]}):r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"60px"},children:"#"}),r.jsx("th",{children:" "}),r.jsx("th",{children:" "}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{style:{width:"120px"},children:""})]})}),r.jsx("tbody",{children:M.map((H,ee)=>r.jsxs("tr",{children:[r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(Z-1)*U+ee+1})}),r.jsx("td",{children:r.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",onClick:()=>n(H),style:{textDecoration:"none"},title:`Internal ID: ${H.internalId||"Not Set"}`,children:H.name})}),r.jsx("td",{children:r.jsx("a",{href:`mailto:${H.email}`,className:"text-decoration-none",children:H.email})}),r.jsx("td",{children:H.phone}),r.jsx("td",{children:H.city||"-"}),r.jsx("td",{children:r.jsxs("div",{className:"btn-group btn-group-sm",children:[r.jsx("button",{className:"btn btn-outline-primary",onClick:()=>n(H),title:"",children:r.jsx("i",{className:"bi bi-pencil"})}),r.jsx("button",{className:"btn btn-outline-danger",onClick:()=>re(H),title:"",children:r.jsx("i",{className:"bi bi-trash"})})]})})]},H.internalId||H.id))})]})}),f.length>0&&r.jsx(ji,{currentPage:Z,totalPages:O,onPageChange:T,totalItems:G,itemsPerPage:U})]}),r.jsx(Wt,{show:g.show,onClose:N,title:g.title,message:g.message,type:g.type,onConfirm:g.onConfirm,confirmText:g.confirmText,cancelText:g.cancelText,showCancel:g.showCancel})]})},K9=({customer:n,onSave:e,onCancel:t})=>{const[s,i]=b.useState({name:"",email:"",phone:"",address:"",city:"",taxNumber:"",bankAccount:"",notes:"",active:!0}),[a,o]=b.useState({}),[l,c]=b.useState(!1),d=!!n,{logActivity:h,getCurrentUser:f}=$t();b.useEffect(()=>{n&&i({name:n.name||"",email:n.email||"",phone:n.phone||"",address:n.address||"",city:n.city||"",taxNumber:n.taxNumber||"",bankAccount:n.bankAccount||"",notes:n.notes||"",active:n.active!==void 0?n.active:!0})},[n]);const p=I=>{const{name:D,value:A,type:g,checked:N}=I.target;i(j=>({...j,[D]:g==="checkbox"?N:A})),a[D]&&o(j=>({...j,[D]:""}))},x=async I=>{I.preventDefault();const D=Rd.validateCustomerData(s);if(Object.keys(D).length>0){o(D);return}c(!0),o({});try{const A=await _i.validateUniqueFields(s,d?n.id:null,d?"customers":null);if(Object.keys(A).length>0){o(A),c(!1);return}const g={...s,status:d&&n.status||"active"};if(d){await Rd.updateCustomer(n.id,g);const N=f();h("task",`${N.name}  `,`  : ${g.name}`)}else{await Rd.createCustomer(g);const N=f();h("task",`${N.name}  `,`  : ${g.name}`)}e()}catch(A){o({submit:A.message})}finally{c(!1)}};return r.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:r.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:r.jsxs("div",{className:"modal-content",children:[r.jsxs("div",{className:"modal-header",children:[r.jsxs("h5",{className:"modal-title",children:[r.jsx("i",{className:"bi bi-person-plus-fill text-primary me-2"}),d?" ":"  "]}),r.jsx("button",{type:"button",className:"btn-close",onClick:t})]}),r.jsxs("form",{onSubmit:x,children:[r.jsxs("div",{className:"modal-body",children:[a.submit&&r.jsxs("div",{className:"alert alert-danger",children:[r.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.submit]}),r.jsxs("div",{className:"row",children:[r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"text",className:`form-control ${a.name?"is-invalid":""}`,name:"name",value:s.name,onChange:p,placeholder:"  "}),a.name&&r.jsx("div",{className:"invalid-feedback",children:a.name})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"email",className:`form-control ${a.email?"is-invalid":""}`,name:"email",value:s.email,onChange:p,placeholder:"example@company.com"}),a.email&&r.jsx("div",{className:"invalid-feedback",children:a.email})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"tel",className:`form-control ${a.phone?"is-invalid":""}`,name:"phone",value:s.phone,onKeyPress:I=>{/[0-9+]/.test(I.key)||I.preventDefault()},onChange:I=>{const D=I.target.value.replace(/[^0-9+]/g,"");p({target:{name:"phone",value:D}})},placeholder:"+966 50 123 4567"}),a.phone&&r.jsx("div",{className:"invalid-feedback",children:a.phone})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:""}),r.jsx("input",{type:"text",className:"form-control",name:"city",value:s.city,onChange:p,placeholder:""})]}),r.jsxs("div",{className:"col-md-12 mb-3",children:[r.jsx("label",{className:"form-label",children:""}),r.jsx("textarea",{className:"form-control",name:"address",value:s.address,onChange:p,rows:"2",placeholder:"  "})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:" "}),r.jsx("input",{type:"text",className:"form-control",name:"taxNumber",value:s.taxNumber,onChange:p,placeholder:" "})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  "}),r.jsx("input",{type:"text",className:"form-control",name:"bankAccount",value:s.bankAccount,onChange:p,placeholder:"  "})]}),r.jsxs("div",{className:"col-md-12 mb-3",children:[r.jsx("label",{className:"form-label",children:""}),r.jsx("textarea",{className:"form-control",name:"notes",value:s.notes,onChange:p,rows:"3",placeholder:"  ..."})]}),r.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:r.jsxs("div",{className:"d-flex align-items-center gap-2",children:[r.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"":" "}),r.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"customerActiveSwitch",name:"active",checked:s.active,onChange:p,style:{width:"50px",height:"25px",cursor:"pointer"}})]})})]})]}),r.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:r.jsxs("div",{className:"d-flex gap-3",children:[r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:t,disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""}),r.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:l?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"12px",height:"12px"}}),"..."]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"bi bi-check-lg me-1"}),d?"":""]})})]})})]})]})})})};function Y9(){const[n,e]=b.useState(!1),[t,s]=b.useState(!1),[i,a]=b.useState(null),[o,l]=b.useState(0),{isTimelineVisible:c}=gn(),d=()=>{e(!n)},h=()=>{a(null),s(!0)},f=I=>{a(I),s(!0)},p=()=>{s(!1),a(null),l(I=>I+1)},x=()=>{s(!1),a(null)};return r.jsx(At,{children:r.jsx(Dt,{children:r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[r.jsx(Nn,{onToggle:d}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!c?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:""})]})}),r.jsx(jn,{}),r.jsx("div",{className:"app-content-area p-3",children:r.jsx("div",{className:"customers-table",children:r.jsx(W9,{onAdd:h,onEdit:f,refreshTrigger:o})})}),r.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:r.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&c&&r.jsx(_n,{rtl:!0}),!n&&c&&r.jsx(En,{}),t&&r.jsx("div",{className:"customer-form",children:r.jsx(K9,{customer:i,onSave:p,onCancel:x})})]})})})}function X9(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(Y9,{})})})}class pa{static getCurrentUserUID(){if(!It.currentUser)throw new Error("     ");return It.currentUser.uid}static async validateActiveEmployee(){const e=this.getCurrentUserUID();try{const t=await Un(Ye(pe,"employees",e));if(!t.exists())throw new Error("     ");const s=t.data();if(s.status!=="active")throw new Error("   ");return{uid:e,employeeData:s}}catch(t){throw new Error(`    : ${t.message}`)}}static async secureCollection(e){return await this.validateActiveEmployee(),Qe(pe,e)}static async secureDoc(e,t){return await this.validateActiveEmployee(),Ye(pe,e,t)}static async secureAddDoc(e,t,s={}){const{uid:i}=await this.validateActiveEmployee(),a={...t,createdBy:i,createdAt:new Date().toISOString(),updatedBy:i,updatedAt:new Date().toISOString(),...s.additionalFields},o=Qe(pe,e);return await Ys(o,a)}static async secureSetDoc(e,t,s,i={}){const{uid:a}=await this.validateActiveEmployee(),o={...s,createdBy:a,createdAt:new Date().toISOString(),updatedBy:a,updatedAt:new Date().toISOString(),...i.additionalFields},l=Ye(pe,e,t);return await uu(l,o,i.merge?{merge:!0}:{})}static async secureGetDoc(e,t){await this.validateActiveEmployee();const s=Ye(pe,e,t);return await Un(s)}static async secureGetDocs(e,t=[]){await this.validateActiveEmployee();const s=Qe(pe,e);let i=s;return t.length>0&&(i=pt(s,...t)),await lt(i)}static async secureUpdateDoc(e,t,s,i={}){const{uid:a}=await this.validateActiveEmployee(),o={...s,updatedBy:a,updatedAt:new Date().toISOString(),...i.additionalFields},l=Ye(pe,e,t);return await gs(l,o)}static async secureDeleteDoc(e,t,s={}){const{uid:i}=await this.validateActiveEmployee();if(s.hardDelete){const a=Ye(pe,e,t);return await xs(a)}else return await this.secureUpdateDoc(e,t,{isDeleted:!0,deletedBy:i,deletedAt:new Date().toISOString()})}static async secureOnSnapshot(e,t,s=[]){await this.validateActiveEmployee();const i=Qe(pe,e);let a=i;return s.length>0&&(a=pt(i,...s)),Vm(a,t)}static async secureBatchWrite(e){const{uid:t}=await this.validateActiveEmployee(),s=ka(pe);return e.forEach(i=>{const a=Ye(pe,i.collection,i.id);if(i.type==="set"){const o={...i.data,createdBy:t,createdAt:new Date().toISOString(),updatedBy:t,updatedAt:new Date().toISOString()};s.set(a,o)}else if(i.type==="update"){const o={...i.data,updatedBy:t,updatedAt:new Date().toISOString()};s.update(a,o)}else i.type==="delete"&&s.delete(a)}),await s.commit()}static async secureTransaction(e){const{uid:t}=await this.validateActiveEmployee();return await cw(pe,s=>e(s,t))}static async createEmployeeDoc(e,t=null){const s=this.getCurrentUserUID(),i=t||s;t&&t!==s&&await this.validateActiveEmployee();const a={...e,createdBy:s,createdAt:new Date().toISOString(),updatedBy:s,updatedAt:new Date().toISOString()},o=Ye(pe,"employees",i);return await uu(o,a)}static async updateOwnEmployeeDoc(e){const t=this.getCurrentUserUID(),s={...e,updatedBy:t,updatedAt:new Date().toISOString()},i=Ye(pe,"employees",t);return await gs(i,s)}static async getOwnEmployeeDoc(){const e=this.getCurrentUserUID(),t=Ye(pe,"employees",e);return await Un(t)}}const Ml="companies";class lm{static async getAllCompanies(){try{let e=[];try{e.push($n("createdAt","desc"))}catch{console.log("Using query without orderBy for empty collection"),e=[]}const s=(await pa.secureGetDocs(Ml,e)).docs.map(i=>{var o,l;const a=i.data();return{id:i.id,internalId:a.internalId||ct("COMPANY"),...a,createdAt:(o=a.createdAt)==null?void 0:o.toDate(),updatedAt:(l=a.updatedAt)==null?void 0:l.toDate()}});return s.length>0&&s[0].createdAt&&s.sort((i,a)=>(a.createdAt||new Date(0))-(i.createdAt||new Date(0))),s}catch(e){if(console.error("Error fetching companies:",e),e.code==="failed-precondition"||e.code==="not-found")return console.log("Companies collection not found, returning empty array"),[];throw new Error("   ")}}static async createCompany(e){try{const t=ct("COMPANY"),s={...e,internalId:t,createdAt:it(),updatedAt:it()};return(await Ys(Qe(pe,Ml),s)).id}catch(t){throw console.error("Error creating company:",t),new Error("   ")}}static async updateCompany(e,t){try{const s=Ye(pe,Ml,e),i={...t,updatedAt:it()};return await gs(s,i),!0}catch(s){throw console.error("Error updating company:",s),new Error("    ")}}static async getCompanyById(e){var t,s;try{const i=Ye(pe,Ml,e),a=await Un(i);if(a.exists()){const o=a.data();return{id:a.id,internalId:o.internalId||ct("COMPANY"),...o,createdAt:(t=o.createdAt)==null?void 0:t.toDate(),updatedAt:(s=o.updatedAt)==null?void 0:s.toDate()}}else return null}catch(i){throw console.error("Error fetching company by ID:",i),new Error("    ")}}static async getCompanyByInternalId(e){var t,s;try{const i=Qe(pe,Ml),a=pt(i,qt("internalId","==",e)),o=await lt(a);if(o.empty)return null;{const l=o.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:(t=c.createdAt)==null?void 0:t.toDate(),updatedAt:(s=c.updatedAt)==null?void 0:s.toDate()}}}catch(i){throw console.error("Error fetching company by internal ID:",i),new Error("    ")}}static async updateCompanyByInternalId(e,t){try{const s=await this.getCompanyByInternalId(e);if(!s)throw new Error("Company not found");return await this.updateCompany(s.id,t)}catch(s){throw console.error("Error updating company by internal ID:",s),new Error("    ")}}static async deleteCompany(e){try{const t=Ye(pe,Ml,e);return await xs(t),!0}catch(t){throw console.error("Error deleting company:",t),new Error("   ")}}static async deleteCompanyByInternalId(e){try{const t=await this.getCompanyByInternalId(e);if(!t)throw new Error("Company not found");return await this.deleteCompany(t.id)}catch(t){throw console.error("Error deleting company by internal ID:",t),new Error("   ")}}static async searchCompanies(e){try{const t=Qe(pe,Ml);return(await lt(t)).docs.map(o=>{var c,d;const l=o.data();return{id:o.id,internalId:l.internalId||ct("COMPANY"),...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}}).filter(o=>{var l,c,d;return((l=o.name)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))||((c=o.email)==null?void 0:c.toLowerCase().includes(e.toLowerCase()))||((d=o.phone)==null?void 0:d.includes(e))})}catch(t){throw console.error("Error searching companies:",t),new Error("    ")}}static async migrateExistingData(){try{console.log("Starting companies migration...");const e=await this.getAllCompanies();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("comp_")){const i=ct("COMPANY");await this.updateCompany(s.id,{...s,internalId:i}),t++,console.log(`Migrated company: ${s.name} -> ${i}`)}return console.log(`Migration completed. ${t} companies migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("   ")}}static validateCompanyData(e){var s,i,a;const t={};return(s=e.name)!=null&&s.trim()||(t.name="  "),(i=e.email)!=null&&i.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(t.email="    "):t.email="  ",(a=e.phone)!=null&&a.trim()||(t.phone="  "),t}}const J9=({onEdit:n,onAdd:e,refreshTrigger:t})=>{const[s,i]=b.useState([]),[a,o]=b.useState(!0),[l,c]=b.useState(null),[d,h]=b.useState(""),[f,p]=b.useState([]),[x,I]=b.useState(!1),{logActivity:D,getCurrentUser:A}=$t(),{alertConfig:g,closeAlert:N,showSuccess:j,showError:V,showConfirm:$}=Kt(),{currentPage:Z,totalPages:O,paginatedItems:M,handlePageChange:T,resetPage:L,totalItems:G,itemsPerPage:U}=Ni(f,30);b.useEffect(()=>{k()},[]),b.useEffect(()=>{t&&k()},[t]),b.useEffect(()=>{if(d.trim()){const H=s.filter(ee=>{var se,Y,R;return((se=ee.name)==null?void 0:se.toLowerCase().includes(d.toLowerCase()))||((Y=ee.email)==null?void 0:Y.toLowerCase().includes(d.toLowerCase()))||((R=ee.phone)==null?void 0:R.includes(d))});p(H)}else p(s);L()},[d,s,L]);const k=async()=>{try{o(!0);const H=await lm.getAllCompanies();i(H),c(null)}catch(H){c(H.message)}finally{o(!1)}},re=H=>{$(`      

${H.name}`,()=>xe(H),"  ")},xe=async H=>{try{I(!0),await un.moveToTrash(H,"companies"),await lm.deleteCompany(H.id);const ee=A();D("task",`${ee.name}  `,`  : ${H.name}`),await k(),j(`   : ${H.name}`,"  ")}catch(ee){c(ee.message),V(`    : ${ee.message}`,"  ")}finally{I(!1)}};return a?r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"spinner-border text-primary",role:"status",children:r.jsx("span",{className:"visually-hidden",children:" ..."})}),r.jsx("p",{className:"mt-3 text-muted",children:"   ..."})]})}):l?r.jsx("div",{className:"card shadow-sm",children:r.jsxs("div",{className:"card-body text-center py-5",children:[r.jsx("div",{className:"text-danger mb-3",children:r.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),r.jsx("h5",{className:"text-danger",children:" "}),r.jsx("p",{className:"text-muted",children:l}),r.jsxs("button",{className:"btn btn-primary",onClick:k,children:[r.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):r.jsxs("div",{className:"card shadow-sm","data-list":"companies",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"row align-items-center justify-content-between",children:[r.jsx("div",{className:"col-lg-4",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-building-fill text-primary me-2"}),"  (",f.length,")"]})}),r.jsx("div",{className:"col-lg-8",children:r.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[r.jsxs("div",{className:"input-group suppliers-search",style:{maxWidth:"350px"},children:[r.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:d,onChange:H=>h(H.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),r.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:r.jsx("i",{className:"bi bi-search text-muted"})})]}),r.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:e,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[r.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"  "]})]})})]})}),r.jsxs("div",{className:"card-body p-0",children:[f.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-building fs-1"})}),r.jsx("h5",{className:"text-muted",children:"  "}),r.jsx("p",{className:"text-muted",children:d?"    ":"     "}),!d&&r.jsxs("button",{className:"btn btn-primary",onClick:e,children:[r.jsx("i",{className:"bi bi-plus-lg me-1"}),"  "]})]}):r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"60px"},children:"#"}),r.jsx("th",{children:" "}),r.jsx("th",{children:" "}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{style:{width:"120px"},children:""})]})}),r.jsx("tbody",{children:M.map((H,ee)=>r.jsxs("tr",{children:[r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(Z-1)*U+ee+1})}),r.jsx("td",{children:r.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",onClick:()=>n(H),style:{textDecoration:"none"},title:`Internal ID: ${H.internalId||"Not Set"}`,children:H.name})}),r.jsx("td",{children:r.jsx("a",{href:`mailto:${H.email}`,className:"text-decoration-none",children:H.email})}),r.jsx("td",{style:{direction:"ltr",textAlign:"left"},children:H.phone}),r.jsx("td",{children:H.city||"-"}),r.jsx("td",{children:r.jsxs("div",{className:"btn-group btn-group-sm",children:[r.jsx("button",{className:"btn btn-outline-primary",onClick:()=>n(H),title:"",children:r.jsx("i",{className:"bi bi-pencil"})}),r.jsx("button",{className:"btn btn-outline-danger",onClick:()=>re(H),title:"",children:r.jsx("i",{className:"bi bi-trash"})})]})})]},H.internalId||H.id))})]})}),f.length>0&&r.jsx(ji,{currentPage:Z,totalPages:O,onPageChange:T,totalItems:G,itemsPerPage:U})]}),r.jsx(Wt,{show:g.show,onClose:N,title:g.title,message:g.message,type:g.type,onConfirm:g.onConfirm,confirmText:g.confirmText,cancelText:g.cancelText,showCancel:g.showCancel})]})};class Ca{static async withRetry(e,{retries:t=5,base:s=150}={}){let i=0;for(;;)try{return await e()}catch(a){if(i++,i>t)throw a;const o=Math.floor(s*Math.pow(2,i-1)+Math.random()*s);await new Promise(l=>setTimeout(l,o))}}static async uploadDocument(e,{companyId:t,companyName:s="",companyEmail:i="",customFileName:a,expiryDate:o,userId:l}={}){console.log(" Starting company document upload:",e.name);try{if(!It.currentUser)throw new Error("    ");const c=l||It.currentUser.uid,d=await Ys(Qe(pe,this.collectionName),{fileName:a||e.name,originalFileName:e.name,size:e.size,fileSize:e.size,contentType:e.type||"application/octet-stream",fileType:e.type||"application/octet-stream",status:"uploading",isTrashed:!1,companyId:t||"new",companyName:s,companyEmail:i,expiryDate:o||null,createdAt:it(),updatedAt:it(),trashedAt:null,trashedBy:null,uploadedBy:c,url:null,fileURL:null,storagePath:null});console.log(" Company document shell created:",d.id),console.log(" About to call fileStorageService.uploadFile with:",{fileName:e.name,fileSize:e.size,folder:"company-documents"});const h=await zs.uploadFile(e,"company-documents");return console.log(" File uploaded to storage:",h.path),await gs(Ye(pe,this.collectionName,d.id),{url:h.url,fileURL:h.url,storagePath:h.path,status:"ready",updatedAt:it()}),console.log(" Company document upload completed:",d.id),{id:d.id,fileName:a||e.name,originalFileName:e.name,url:h.url,fileURL:h.url,storagePath:h.path,size:e.size,fileSize:e.size,contentType:e.type||"application/octet-stream",fileType:e.type||"application/octet-stream"}}catch(c){throw console.error(" Company document upload failed:",c),new Error(`    : ${c.message}`)}}static async moveDocumentToTrash(e,{userId:t}={}){var i;const s=t||((i=It.currentUser)==null?void 0:i.uid)||"system";console.log(" Moving company document to trash:",{documentId:e,userId:s,collection:this.collectionName});try{await this.withRetry(async()=>{await cw(pe,async a=>{const o=Ye(pe,this.collectionName,e),l=await a.get(o);if(console.log(" Document lookup result:",{documentId:e,exists:l.exists(),collection:this.collectionName}),!l.exists())throw console.error(" Document not found in Firebase:",{documentId:e,collection:this.collectionName,attemptedPath:`${this.collectionName}/${e}`}),new Error(`       (ID: ${e})`);const c=l.data();if(console.log(" Document data:",{fileName:c.fileName,isTrashed:c.isTrashed,status:c.status}),c.isTrashed===!0){console.log("Company document already trashed - idempotent operation");return}a.update(o,{isTrashed:!0,trashedAt:it(),trashedBy:s,updatedAt:it()})})}),console.log(" Company document moved to trash successfully")}catch(a){throw console.error(" Error moving company document to trash:",{documentId:e,error:a.message,stack:a.stack}),a.message.includes("   ")?a:new Error(`     : ${a.message}`)}}static async restoreDocumentFromTrash(e){console.log(" Restoring company document from trash:",e),await this.withRetry(async()=>{await cw(pe,async t=>{const s=Ye(pe,this.collectionName,e),i=await t.get(s);if(!i.exists())throw new Error("   ");if(i.data().isTrashed===!1){console.log("Company document already active - idempotent operation");return}t.update(s,{isTrashed:!1,trashedAt:null,trashedBy:null,updatedAt:it()})})}),console.log(" Company document restored from trash successfully")}static subscribeToCompanyDocuments(e,t){console.log(" Setting up Firebase subscription for companyId:",e);const s=pt(Qe(pe,this.collectionName),qt("companyId","==",e),qt("isTrashed","==",!1));return console.log(" Firebase query created for company documents:",{collection:this.collectionName,companyId:e,filters:["companyId ==",e,"isTrashed ==",!1]}),Vm(s,i=>{console.log(" Firebase snapshot received for company documents:"),console.log("- Snapshot size:",i.size),console.log("- Snapshot empty:",i.empty);const a=[];i.forEach(o=>{const l=o.data(),c={id:o.id,...l,fileURL:l.fileURL||l.url,fileType:l.fileType||l.contentType,fileSize:l.fileSize||l.size};console.log("- Company document found:",{id:o.id,fileName:c.fileName,companyId:c.companyId,isTrashed:c.isTrashed,status:c.status,hasURL:!!c.fileURL,hasExpiryDate:!!c.expiryDate}),a.push(c)}),a.sort((o,l)=>{var h,f;const c=((h=o.updatedAt)==null?void 0:h.seconds)||0;return(((f=l.updatedAt)==null?void 0:f.seconds)||0)-c}),console.log(" Calling callback with",a.length,"company documents (sorted manually)"),t(a)},i=>{console.error(" Company document subscription error:",i),console.error("Error details:",{code:i.code,message:i.message,companyId:e,collection:this.collectionName}),t([])})}static subscribeToTrashedDocuments(e){const t=pt(Qe(pe,this.collectionName),qt("isTrashed","==",!0));return Vm(t,s=>{const i=[];s.forEach(a=>{i.push({id:a.id,...a.data()})}),i.sort((a,o)=>{var d,h;const l=((d=a.updatedAt)==null?void 0:d.seconds)||0;return(((h=o.updatedAt)==null?void 0:h.seconds)||0)-l}),e(i)},s=>{console.error("Company trashed documents subscription error:",s),e([])})}static async getCompanyDocuments(e){try{console.log(" Getting company documents for ID:",e);const t=pt(Qe(pe,this.collectionName),qt("companyId","==",e),qt("isTrashed","==",!1)),s=await lt(t),i=[];return s.forEach(a=>{const o=a.data(),l={id:a.id,...o,fileURL:o.fileURL||o.url,fileType:o.fileType||o.contentType,fileSize:o.fileSize||o.size};console.log(" Found document:",l.fileName,"for company:",l.companyId),i.push(l)}),console.log(` Total documents found for company ${e}: ${i.length}`),i.sort((a,o)=>{var d,h;const l=((d=a.updatedAt)==null?void 0:d.seconds)||0;return(((h=o.updatedAt)==null?void 0:h.seconds)||0)-l}),i}catch(t){throw console.error("Error getting company documents:",t),new Error(`    : ${t.message}`)}}static async getAllDocuments(){try{const e=await lt(Qe(pe,this.collectionName)),t=[];return e.forEach(s=>{t.push({id:s.id,...s.data()})}),t.sort((s,i)=>{var l,c;const a=((l=s.updatedAt)==null?void 0:l.seconds)||0;return(((c=i.updatedAt)==null?void 0:c.seconds)||0)-a}),t}catch(e){throw console.error("Error getting all company documents:",e),new Error(`     : ${e.message}`)}}static async getTrashedDocuments(){try{const e=pt(Qe(pe,this.collectionName),qt("isTrashed","==",!0)),t=await lt(e),s=[];return t.forEach(i=>{s.push({id:i.id,...i.data()})}),s.sort((i,a)=>{var c,d;const o=((c=i.updatedAt)==null?void 0:c.seconds)||0;return(((d=a.updatedAt)==null?void 0:d.seconds)||0)-o}),s}catch(e){throw console.error("Error getting trashed company documents:",e),new Error(`     : ${e.message}`)}}static async permanentlyDeleteDocuments(e=[]){if(!e.length)return;console.log(" Permanently deleting company documents:",e);const t=ka(pe),s=e.map(o=>Ye(pe,this.collectionName,o)),i=await Promise.all(s.map(o=>Un(o))),a=[];i.forEach(o=>{if(!o.exists())return;const l=o.data();if(l.isTrashed===!0&&(t.delete(Ye(pe,this.collectionName,o.id)),l.storagePath)){const c=Ea(xr,l.storagePath);a.push(ny(c).catch(d=>{console.warn("Storage delete failed (continuing):",d)}))}}),await t.commit(),await Promise.allSettled(a),console.log(" Company documents permanently deleted")}static async updateDocumentCompanyId(e,t,s={}){console.log(" Updating company documents from temp ID to real ID:",{oldCompanyId:e,newCompanyId:t,companyName:s.name});try{const i=pt(Qe(pe,this.collectionName),qt("companyId","==",e),qt("isTrashed","==",!1)),a=await lt(i);if(a.empty)return console.log("No documents found with old company ID:",e),0;console.log(`Found ${a.size} documents to update company ID`);const o=[];return a.forEach(l=>{const c={companyId:t,companyName:s.name||"",companyEmail:s.email||"",updatedAt:it()};o.push(gs(Ye(pe,this.collectionName,l.id),c))}),await Promise.all(o),console.log(` Updated ${a.size} documents with new company ID:`,t),a.size}catch(i){throw console.error(" Error updating document company IDs:",i),new Error(`    : ${i.message}`)}}static async deleteDocument(e){return await this.moveDocumentToTrash(e)}}ur(Ca,"collectionName","companydocuments"),ur(Ca,"storagePath","company-documents");const Z9=({expiryDate:n,className:e="",style:t={}})=>{const[s,i]=b.useState("00"),[a,o]=b.useState(!1);return b.useEffect(()=>{if(!n){i("00"),o(!1);return}const l=()=>{try{const d=new Date,[h,f,p]=n.split("-").map(Number),I=new Date(h,f-1,p,23,59,59).getTime()-d.getTime();if(I<=0){i("00"),o(!0);return}const D=Math.floor(I/1e3),A=Math.floor(D/(24*60*60)),N=(j=>j.toString().padStart(2,"0"))(A);i(N),o(!1)}catch(d){console.error("CountdownTimer error:",d),i("--"),o(!1)}};l();const c=setInterval(l,1e3);return()=>clearInterval(c)},[n]),a?r.jsx("div",{className:`countdown-timer expired ${e}`,style:t,children:r.jsx("div",{className:"digital-display text-danger",children:r.jsx("small",{className:"fw-bold",children:" "})})}):r.jsx("div",{className:`countdown-timer ${e}`,style:t,children:r.jsx("div",{className:"digital-display",children:r.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{fontSize:"14px",fontFamily:"monospace"},children:r.jsx("span",{className:"text-danger fw-bold",children:s})})})})},eB=({show:n,onClose:e,title:t=" ",documents:s=[],setDocuments:i,companyId:a="new",companyName:o="",companyEmail:l=""})=>{const[c,d]=b.useState(!1),[h,f]=b.useState(null),[p,x]=b.useState(""),[I,D]=b.useState(""),[A,g]=b.useState(!1),[N,j]=b.useState(null),[V,$]=b.useState(null),[Z,O]=b.useState(null),{alertConfig:M,closeAlert:T,showSuccess:L,showError:G,showConfirm:U}=Kt(),{logActivity:k,getCurrentUser:re}=$t(),{currentUser:xe}=KN(),{formatDate:H}=Pu();b.useEffect(()=>{if(n&&a){console.log(" Modal opened - setting up Firebase subscription for company documents:",a);const Q=Ca.subscribeToCompanyDocuments(a,oe=>{console.log(" Received company documents from Firebase:",oe.length),i&&i(oe)});return O(()=>Q),()=>{Q&&(console.log(" Cleaning up Firebase subscription for company documents"),Q())}}},[n,a,i]),b.useEffect(()=>{!n&&Z&&(console.log(" Modal closed - cleaning up Firebase subscription"),Z(),O(null))},[n,Z]);const ee=Q=>{console.log(" Document file selected:",{name:Q.name,size:Q.size,type:Q.type}),g(!0);try{zs.validateFile(Q,{maxSize:10*1024*1024,allowedTypes:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png","image/jpg"]}),console.log(" Preparing company document for upload:",Q.name),f({file:Q,originalFileName:Q.name,fileSize:Q.size,fileType:Q.type}),x(Q.name.split(".")[0]),d(!0),console.log(" Document file validated and ready for naming")}catch(oe){console.error(" File validation failed:",oe),G(oe.message,"  ")}finally{g(!1)}},se=()=>{try{const Q=document.createElement("input");Q.type="file",Q.accept=".pdf,.doc,.docx,.jpg,.png,.jpeg",Q.style.display="none",Q.onchange=oe=>{var te;const E=(te=oe.target.files)==null?void 0:te[0];E&&ee(E),document.body.contains(Q)&&document.body.removeChild(Q)},Q.onclick=()=>{Q.value=""},document.body.appendChild(Q),Q.click()}catch(Q){console.error(" File input creation failed:",Q),G("    ","  ")}},Y=Q=>{try{$(Q.id);const oe=document.createElement("input");oe.type="file",oe.accept=".pdf,.doc,.docx,.jpg,.png,.jpeg",oe.style.display="none",oe.onchange=E=>{var Te;const te=(Te=E.target.files)==null?void 0:Te[0];te&&ee(te),document.body.contains(oe)&&document.body.removeChild(oe)},oe.onclick=()=>{oe.value=""},document.body.appendChild(oe),oe.click()}catch(oe){console.error(" File replacement failed:",oe),G("    ","  "),$(null)}},R=async()=>{if(!p.trim()){G("   ","  ");return}if(!h){G("   ","");return}d(!1);const Q=h.file,oe=p.trim(),E=V;f(null),x(""),D(""),$(null);try{g(!0),console.log(" Uploading company document to Firebase via service:",oe);const te=re();E&&(console.log(" Deleting old expired document before uploading replacement:",E),s.find(We=>We.id===E)&&(await Ca.deleteDocument(E),console.log(" Old expired document deleted successfully"))),console.log(" About to upload document with authUser:",{uid:xe==null?void 0:xe.uid,email:xe==null?void 0:xe.email,hasUser:!!xe});const Te=await Ca.uploadDocument(Q,{companyId:a,companyName:o,companyEmail:l,customFileName:oe,uploadDate:new Date().toISOString().split("T")[0],expiryDate:I||null,userId:xe==null?void 0:xe.uid});console.log(" Document uploaded successfully via Firebase service:",Te),E?(L(`   : ${oe}`," "),k("file",`${te.name}     `,`  : ${oe}`)):(L(`   : ${oe}`," "),k("file",`${te.name}   `,`  : ${oe}`))}catch(te){console.error(" Error uploading company document via Firebase:",te),G(`   : ${te.message}`,"  ")}finally{g(!1)}},_=()=>{console.log("User cancelled company document upload"),d(!1),f(null),x(""),D("")},C=Q=>{const oe=Q.documentFileURL||Q.fileURL||Q.url;oe?window.open(oe,"_blank"):G("   ","  ")},z=Q=>{U(`      

${Q.fileName}`,async()=>{try{g(!0);const oe=re();await Ca.moveDocumentToTrash(Q.id,{userId:xe==null?void 0:xe.uid}),k("task",`${oe.name}   `,`  : ${Q.fileName}`),L(`   : ${Q.fileName}`,"  ")}catch(oe){console.error(" Error deleting company document:",oe),G(`   : ${oe.message}`,"  ")}finally{g(!1)}},"  ")},K=()=>{d(!1),f(null),x(""),D(""),e()},F=Q=>Q?Q.includes("pdf")?{icon:"bi-file-earmark-pdf",color:"#dc3545"}:Q.includes("word")||Q.includes("document")?{icon:"bi-file-earmark-word",color:"#2b579a"}:Q.includes("image")?{icon:"bi-file-earmark-image",color:"#198754"}:{icon:"bi-file-earmark",color:"#6c757d"}:{icon:"bi-file-earmark",color:"#6c757d"};return n?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},tabIndex:"-1",dir:"rtl",children:r.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[r.jsxs("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"12px 12px 0 0"},children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-building-fill me-2"}),t]}),r.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:K,"aria-label":"Close"})]}),r.jsxs("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"},children:[r.jsx("div",{className:"mb-4",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[r.jsxs("div",{children:[r.jsx("h6",{className:"mb-0 fw-bold text-primary",children:"  "}),r.jsx("div",{className:"d-flex align-items-center gap-3",children:r.jsxs("small",{className:"text-muted",children:[" : ",s.length]})})]}),r.jsx("div",{style:{marginLeft:"20px"},children:r.jsx("button",{type:"button",className:"btn btn-primary",onClick:se,disabled:A,style:{height:"32px",minWidth:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",fontWeight:"500"},children:A?r.jsxs(r.Fragment,{children:[r.jsx(an,{size:"small"}),r.jsx("span",{className:"ms-2",children:"..."})]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"bi bi-cloud-upload me-1"})," "]})})})]})}),s.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-building fs-1"})}),r.jsx("h5",{className:"text-muted",children:"  "}),r.jsx("p",{className:"text-muted",children:"    "})]}):r.jsx("div",{className:"table-responsive company-documents-table",children:r.jsxs("table",{className:"table table-hover custom-striped",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:""})]})}),r.jsx("tbody",{children:s.map((Q,oe)=>{const E=Q.fileName||"  ",te=F(Q.documentFileType),Te=Q.expiryDate&&new Date(Q.expiryDate)<new Date;return r.jsxs("tr",{children:[r.jsx("td",{className:"text-center",children:Q.documentFileURL||Q.fileURL||Q.url?r.jsx(ay,{size:25,clickable:!0,onClick:()=>C(Q),title:` : ${Q.documentFileName||Q.fileName}`}):r.jsx("i",{className:te.icon,style:{color:te.color,fontSize:"24px"}})}),r.jsxs("td",{className:"text-center",children:[r.jsx("div",{className:"fw-bold",children:E}),Q.description&&r.jsx("small",{className:"text-muted",children:Q.description})]}),r.jsx("td",{className:"text-center",children:Q.expiryDate?r.jsx("small",{className:"text-muted",children:H(Q.expiryDate)}):r.jsx("small",{className:"text-muted",children:" "})}),r.jsx("td",{className:"text-center",children:Q.expiryDate?r.jsx(Z9,{expiryDate:Q.expiryDate,style:{minWidth:"80px"}},`countdown-${Q.id}-${Q.expiryDate}`):r.jsx("small",{className:"text-muted",children:"-"})}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"btn-group btn-group-sm",children:[!Te&&r.jsx("button",{className:"btn btn-outline-primary",onClick:()=>C(Q),disabled:!Q.documentFileURL&&!Q.fileURL&&!Q.url,title:Q.documentFileURL||Q.fileURL||Q.url?` : ${Q.documentFileName||Q.fileName}`:"  ",style:{width:"28px",height:"32px"},children:r.jsx("i",{className:"bi bi-eye"})}),Te?r.jsx("button",{className:"btn btn-warning",onClick:()=>Y(Q),title:"  ",style:{width:"28px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsx("i",{className:"bi bi-folder2-open",style:{color:"black",fontSize:"12px"}})}):r.jsx("button",{className:"btn btn-outline-danger",onClick:()=>z(Q),title:"",style:{width:"28px",height:"32px"},children:r.jsx("i",{className:"bi bi-trash"})})]})})]},Q.id||oe)})})]})})]}),r.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:r.jsxs("div",{className:"d-flex gap-2",children:[r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:e,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px"},children:""}),r.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{L("   "," "),setTimeout(()=>e(),1500)},style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px"},children:""})]})})]})})}),c&&r.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.7)",zIndex:1060},tabIndex:"-1",dir:"rtl",children:r.jsx("div",{className:"modal-dialog modal-dialog-centered",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[r.jsxs("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"12px 12px 0 0"},children:[r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-pencil-square me-2"})," "]}),r.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:_,"aria-label":"Close"})]}),r.jsx("div",{className:"modal-body",style:{padding:"25px"},children:r.jsxs("div",{className:"mb-4",children:[r.jsxs("div",{className:"d-flex align-items-center mb-3",children:[r.jsx("div",{className:"bg-success bg-opacity-10 p-2 rounded-circle me-3",children:r.jsx("i",{className:"bi bi-file-earmark-check text-success"})}),r.jsxs("div",{children:[r.jsx("h6",{className:"mb-0 fw-bold text-success",children:"   "}),r.jsx("small",{className:"text-muted",children:h==null?void 0:h.originalFileName})]})]}),r.jsxs("div",{className:"mb-3",children:[r.jsxs("label",{className:"form-label fw-bold text-primary",children:[r.jsx("i",{className:"bi bi-tag me-1"}),"   *"]}),r.jsx("input",{type:"text",className:"form-control",value:p,onChange:Q=>x(Q.target.value),placeholder:"   ",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:Q=>{Q.target.style.borderColor="#28a745",Q.target.style.boxShadow="0 0 0 0.2rem rgba(40, 167, 69, 0.25)"},onBlur:Q=>{Q.target.style.borderColor="#e9ecef",Q.target.style.boxShadow="none"},autoFocus:!0}),r.jsxs("small",{className:"text-muted",children:[r.jsx("i",{className:"bi bi-info-circle me-1"}),"         "]})]}),r.jsxs("div",{className:"mb-3",children:[r.jsxs("label",{className:"form-label fw-bold text-warning",children:[r.jsx("i",{className:"bi bi-calendar-event me-1"}),"  "]}),r.jsx("input",{type:"date",className:"form-control",value:I,onChange:Q=>D(Q.target.value),placeholder:"   ",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:Q=>{Q.target.style.borderColor="#ffc107",Q.target.style.boxShadow="0 0 0 0.2rem rgba(255, 193, 7, 0.25)"},onBlur:Q=>{Q.target.style.borderColor="#e9ecef",Q.target.style.boxShadow="none"}}),r.jsxs("small",{className:"text-muted",children:[r.jsx("i",{className:"bi bi-info-circle me-1"}),"       "]})]})]})}),r.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:r.jsxs("div",{className:"d-flex justify-content-end",style:{gap:"12px"},children:[r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:_,style:{height:"32px",fontSize:"13px",borderRadius:"6px",padding:"0 12px",width:"80px"},children:""}),r.jsxs("button",{type:"button",className:"btn btn-primary",onClick:R,disabled:!p.trim(),style:{height:"32px",fontSize:"13px",borderRadius:"6px",padding:"0 12px",width:"80px"},children:[r.jsx("i",{className:"bi bi-check-lg me-1"}),""]})]})})]})})}),r.jsx(Wt,{show:M.show,onClose:T,title:M.title,message:M.message,type:M.type,onConfirm:M.onConfirm,showConfirm:M.showConfirm})]}):null},tB=({company:n,onSave:e,onCancel:t})=>{const[s,i]=b.useState({name:"",email:"",phone:"",address:"",city:"",taxNumber:"",bankAccount:"",notes:"",active:!0}),[a,o]=b.useState({}),[l,c]=b.useState(!1),[d,h]=b.useState(!1),[f,p]=b.useState([]),[x,I]=b.useState(!1),[D,A]=b.useState(null),[g,N]=b.useState(null),j=!!n,{logActivity:V,getCurrentUser:$}=$t();b.useEffect(()=>{n&&i({name:n.name||"",email:n.email||"",phone:n.phone||"",address:n.address||"",city:n.city||"",taxNumber:n.taxNumber||"",bankAccount:n.bankAccount||"",notes:n.notes||"",active:n.active!==void 0?n.active:!0})},[n]),b.useEffect(()=>{(()=>{j&&(n!=null&&n.id)?Z():(async()=>{I(!0);try{const U=await Ca.getCompanyDocuments("new");console.log(" Loaded temp company documents from Firebase:",U.length),p(U)}catch(U){console.error("Error loading temp company documents from Firebase:",U),p([])}finally{I(!1)}})()})()},[j,n==null?void 0:n.id]),b.useEffect(()=>()=>{g&&(console.log(" Cleaning up Firebase subscription for company documents"),g())},[g]);const Z=()=>{if(!(n!=null&&n.id))return;I(!0),g&&g();const L=Ca.subscribeToCompanyDocuments(n.id,G=>{console.log(" Received company documents from Firebase:",G.length),p(G),I(!1),A(null)});N(()=>L)},O=()=>{console.log("Opening document modal..."),h(!0)},M=L=>{const{name:G,value:U,type:k,checked:re}=L.target;i(xe=>({...xe,[G]:k==="checkbox"?re:U})),a[G]&&o(xe=>({...xe,[G]:""}))},T=async L=>{L.preventDefault();const G=lm.validateCompanyData(s);if(Object.keys(G).length>0){o(G);return}c(!0),o({});try{const U=await _i.validateUniqueFields(s,j?n.id:null,j?"companies":null);if(Object.keys(U).length>0){o(U),c(!1);return}const k={...s,status:j&&n.status||"active"};if(j){await lm.updateCompany(n.id,k);const re=$();V("task",`${re.name}  `,`  : ${k.name}`)}else{const re=await lm.createCompany(k);try{const H=await Ca.updateDocumentCompanyId("new",re,k);H>0&&console.log(` Linked ${H} documents to new company:`,re)}catch(H){console.warn(" Failed to link documents to new company:",H)}const xe=$();V("task",`${xe.name}  `,`  : ${k.name}`)}e()}catch(U){o({submit:U.message})}finally{c(!1)}};return r.jsxs("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:[r.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:r.jsxs("div",{className:"modal-content",children:[r.jsx("div",{className:"modal-header",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-between w-100",children:[r.jsxs("h5",{className:"modal-title mb-0",children:[r.jsx("i",{className:"bi bi-building-plus-fill text-primary me-2"}),j?" ":"  "]}),r.jsxs("div",{className:"d-flex align-items-center",style:{gap:"15px"},children:[j&&r.jsx("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:O,disabled:x,style:{height:"32px",fontSize:"13px",borderRadius:"6px",padding:"0 12px",whiteSpace:"nowrap",marginLeft:"20px"},children:x?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"spinner-border spinner-border-sm me-1",role:"status",style:{width:"12px",height:"12px"}}),"..."]}):D?r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"bi bi-exclamation-triangle me-1 text-warning"})," "]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"bi bi-file-earmark-text me-1"}),"  (",f.length,")"]})}),r.jsx("button",{type:"button",className:"btn-close",onClick:t})]})]})}),r.jsxs("form",{onSubmit:T,children:[r.jsxs("div",{className:"modal-body",children:[a.submit&&r.jsxs("div",{className:"alert alert-danger",children:[r.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.submit]}),D&&r.jsxs("div",{className:"alert alert-warning d-flex align-items-center justify-content-between",children:[r.jsxs("div",{children:[r.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"    : ",D]}),r.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:Z,style:{borderRadius:"4px"},children:[r.jsx("i",{className:"bi bi-arrow-clockwise me-1"})," "]})]}),r.jsxs("div",{className:"row",children:[r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"text",className:`form-control ${a.name?"is-invalid":""}`,name:"name",value:s.name,onChange:M,placeholder:"  "}),a.name&&r.jsx("div",{className:"invalid-feedback",children:a.name})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"email",className:`form-control ${a.email?"is-invalid":""}`,name:"email",value:s.email,onChange:M,placeholder:"example@company.com"}),a.email&&r.jsx("div",{className:"invalid-feedback",children:a.email})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"tel",className:`form-control ${a.phone?"is-invalid":""}`,name:"phone",value:s.phone,onKeyPress:L=>{/[0-9+]/.test(L.key)||L.preventDefault()},onChange:L=>{const G=L.target.value.replace(/[^0-9+]/g,"");M({target:{name:"phone",value:G}})},placeholder:"+966 50 123 4567"}),a.phone&&r.jsx("div",{className:"invalid-feedback",children:a.phone})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:""}),r.jsx("input",{type:"text",className:"form-control",name:"city",value:s.city,onChange:M,placeholder:""})]}),r.jsxs("div",{className:"col-md-12 mb-3",children:[r.jsx("label",{className:"form-label",children:""}),r.jsx("textarea",{className:"form-control",name:"address",value:s.address,onChange:M,rows:"2",placeholder:"  "})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:" "}),r.jsx("input",{type:"text",className:"form-control",name:"taxNumber",value:s.taxNumber,onChange:M,placeholder:" "})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  "}),r.jsx("input",{type:"text",className:"form-control",name:"bankAccount",value:s.bankAccount,onChange:M,placeholder:"  "})]}),r.jsxs("div",{className:"col-md-12 mb-3",children:[r.jsx("label",{className:"form-label",children:""}),r.jsx("textarea",{className:"form-control",name:"notes",value:s.notes,onChange:M,rows:"3",placeholder:"  ..."})]}),r.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:r.jsxs("div",{className:"d-flex align-items-center gap-2",children:[r.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"":" "}),r.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"companyActiveSwitch",name:"active",checked:s.active,onChange:M,style:{width:"50px",height:"25px",cursor:"pointer"}})]})})]})]}),r.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:r.jsxs("div",{className:"d-flex gap-3",children:[r.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:t,disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""}),r.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:l?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"12px",height:"12px"}}),"..."]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"bi bi-check-lg me-1"}),j?"":""]})})]})})]})]})}),d&&r.jsx(eB,{show:d,onClose:()=>h(!1),title:" ",documents:f,setDocuments:p,companyId:(n==null?void 0:n.id)||"new",companyName:(n==null?void 0:n.name)||" ",companyEmail:(n==null?void 0:n.email)||""})]})};function nB(){const[n,e]=b.useState(!1),[t,s]=b.useState(!1),[i,a]=b.useState(null),[o,l]=b.useState(0),{isTimelineVisible:c}=gn(),d=()=>{e(!n)},h=()=>{a(null),s(!0)},f=I=>{a(I),s(!0)},p=()=>{s(!1),a(null),l(I=>I+1)},x=()=>{s(!1),a(null)};return r.jsx(At,{children:r.jsx(Dt,{children:r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[r.jsx(Nn,{onToggle:d}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!c?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:""})]})}),r.jsx(jn,{}),r.jsx("div",{className:"app-content-area p-3",children:r.jsx("div",{className:"suppliers-table",children:r.jsx(J9,{onAdd:h,onEdit:f,refreshTrigger:o})})})]}),r.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:r.jsx("span",{children:" Modern Bin 2025"})})]}),!n&&c&&r.jsx(_n,{rtl:!0}),!n&&c&&r.jsx(En,{}),t&&r.jsx("div",{className:"company-form",children:r.jsx(tB,{company:i,onSave:p,onCancel:x})})]})})})}function sB(){return r.jsx(nB,{})}const Ri="employees",Rb="documents",Bl=()=>{const n=new Date,e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0"),i=Math.floor(Math.random()*9999).toString().padStart(4,"0");return`EMP-${e}${t}${s}-${i}`};class Pd{static async getAllEmployees(e={}){try{console.log(" Fetching all employees from Firestore...");const{search:t,filters:s={},sort:i="updatedAt",page:a=1,limit:o=30}=e;let l=[];try{i==="name"?l.push($n("fullName","asc")):i==="hireDate"?l.push($n("hireDate","desc")):l.push($n("createdAt","desc"))}catch(x){console.warn(" Sorting failed, using basic query:",x.message),l=[]}const c=await pa.secureGetDocs(Ri,l);console.log(" Firestore query results:",c.size,"documents");let d=c.docs.map(x=>{var D,A,g;const I=x.data();return console.log(" Processing employee document:",x.id,I.fullName||"Unknown"),{id:x.id,internalId:I.internalId||Bl(),...I,createdAt:(D=I.createdAt)==null?void 0:D.toDate(),updatedAt:(A=I.updatedAt)==null?void 0:A.toDate(),hireDate:(g=I.hireDate)==null?void 0:g.toDate()}});if(console.log(" Processed employees:",d.length,"total"),t&&t.trim()){const x=t.toLowerCase();d=d.filter(I=>{var D,A,g,N,j,V;return((D=I.fullName)==null?void 0:D.toLowerCase().includes(x))||((A=I.department)==null?void 0:A.toLowerCase().includes(x))||((g=I.jobTitle)==null?void 0:g.toLowerCase().includes(x))||((N=I.email)==null?void 0:N.toLowerCase().includes(x))||((j=I.phone)==null?void 0:j.includes(t))||((V=I.nationalId)==null?void 0:V.includes(t))})}s.department&&s.department!=="all"&&(d=d.filter(x=>x.department===s.department)),s.status&&s.status!=="all"&&(d=d.filter(x=>x.status===s.status));const h=(a-1)*o,f=h+o;return{employees:d.slice(h,f),totalCount:d.length,totalPages:Math.ceil(d.length/o),currentPage:a}}catch(t){throw console.error("Error fetching employees:",t),new Error("    ")}}static async createEmployee(e){try{if(!e.email||!e.email.trim())throw new Error("     ");if(!e.nationalId||!e.nationalId.trim())throw new Error("     ");let t=Bl(),s=0;for(;s<5&&await this.getEmployeeByInternalId(t);)t=Bl(),s++;if(s===5)throw new Error("     ");console.log(" Creating Firebase Auth user for employee...");const i=await t$(It,e.email.trim(),e.nationalId),a=i.user.uid;console.log(" Firebase Auth user created:",a),await r$(i.user,{displayName:e.fullName});const o={...e,internalId:t,status:e.status||"active",role:e.role||"employee",hireDate:e.hireDate?new Date(e.hireDate):new Date,createdAt:it(),updatedAt:it()};return await pa.createEmployeeDoc(o,a),console.log(" Employee document created with UID:",a),{id:a,internalId:t,uid:a}}catch(t){throw console.error("Error creating employee:",t),t.code==="auth/email-already-in-use"?new Error("   "):t.code==="auth/invalid-email"?new Error("    "):t.code==="auth/weak-password"?new Error("    -    6   "):new Error(t.message||"   ")}}static async updateEmployee(e,t){var s;try{const i={...t};t.hireDate&&(i.hireDate=new Date(t.hireDate));const a=(s=It.currentUser)==null?void 0:s.uid;return e===a?await pa.updateOwnEmployeeDoc(i):await pa.secureUpdateDoc(Ri,e,i),!0}catch(i){throw console.error("Error updating employee:",i),new Error("    ")}}static async getEmployeeById(e){var t,s,i,a;try{const o=(t=It.currentUser)==null?void 0:t.uid;let l;if(e===o?l=await pa.getOwnEmployeeDoc():l=await pa.secureGetDoc(Ri,e),l.exists()){const c=l.data();return{id:l.id,internalId:c.internalId||Bl(),...c,createdAt:(s=c.createdAt)==null?void 0:s.toDate(),updatedAt:(i=c.updatedAt)==null?void 0:i.toDate(),hireDate:(a=c.hireDate)==null?void 0:a.toDate()}}else return null}catch(o){throw console.error("Error fetching employee by ID:",o),new Error("    ")}}static async getEmployeeByInternalId(e){var t,s,i;try{const a=Qe(pe,Ri),o=pt(a,qt("internalId","==",e)),l=await lt(o);if(l.empty)return null;{const c=l.docs[0],d=c.data();return{id:c.id,internalId:d.internalId,...d,createdAt:(t=d.createdAt)==null?void 0:t.toDate(),updatedAt:(s=d.updatedAt)==null?void 0:s.toDate(),hireDate:(i=d.hireDate)==null?void 0:i.toDate()}}}catch(a){throw console.error("Error fetching employee by internal ID:",a),new Error("    ")}}static async updateEmployeeByInternalId(e,t){try{const s=await this.getEmployeeByInternalId(e);if(!s)throw new Error("  ");return await this.updateEmployee(s.id,t)}catch(s){throw console.error("Error updating employee by internal ID:",s),new Error("    ")}}static async deleteEmployee(e){try{const t=Ye(pe,Ri,e);return await xs(t),!0}catch(t){throw console.error("Error deleting employee:",t),new Error("   ")}}static async deleteEmployeeByInternalId(e){try{const t=await this.getEmployeeByInternalId(e);if(!t)throw new Error("  ");return await this.deleteEmployee(t.id)}catch(t){throw console.error("Error deleting employee by internal ID:",t),new Error("   ")}}static async searchEmployees(e){try{const t=Qe(pe,Ri);return(await lt(t)).docs.map(o=>{var c,d,h;const l=o.data();return{id:o.id,internalId:l.internalId||Bl(),...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate(),hireDate:(h=l.hireDate)==null?void 0:h.toDate()}}).filter(o=>{var l,c,d,h,f,p;return((l=o.fullName)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))||((c=o.department)==null?void 0:c.toLowerCase().includes(e.toLowerCase()))||((d=o.jobTitle)==null?void 0:d.toLowerCase().includes(e.toLowerCase()))||((h=o.email)==null?void 0:h.toLowerCase().includes(e.toLowerCase()))||((f=o.phone)==null?void 0:f.includes(e))||((p=o.nationalId)==null?void 0:p.includes(e))})}catch(t){throw console.error("Error searching employees:",t),new Error("    ")}}static async uploadEmployeeFile(e,t,s=null){try{const i=pa.getCurrentUserUID(),a=s||t.name,o=Date.now(),l=`uploads/employee_${e}_${o}_${a}`,c=Ea(xr,l),d=await Zg(c,t),h=await rm(d.ref),f=await this.getEmployeeByInternalId(e);if(!f)throw new Error("  ");const p={name:a,originalName:t.name,path:l,url:h,type:t.type,size:t.size,uploadedBy:i,uploadedAt:new Date().toISOString()};await pa.validateActiveEmployee();const x=Qe(pe,Ri,f.id,Rb);return{id:(await Ys(x,p)).id,url:h,path:l,...p}}catch(i){throw console.error("Error uploading employee file:",i),new Error("   ")}}static async listEmployeeFiles(e){try{const t=await this.getEmployeeByInternalId(e);if(!t)throw new Error("  ");const s=Qe(pe,Ri,t.id,Rb);return(await lt(s)).docs.map(a=>{var l;const o=a.data();return{id:a.id,...o,uploadedAt:(l=o.uploadedAt)==null?void 0:l.toDate()}})}catch(t){throw console.error("Error listing employee files:",t),new Error("    ")}}static async deleteEmployeeFile(e,t){try{const s=await this.getEmployeeByInternalId(e);if(!s)throw new Error("  ");const i=Ye(pe,Ri,s.id,Rb,t),a=await Un(i);if(!a.exists())throw new Error("  ");const o=a.data(),l=Ea(xr,o.path);return await ny(l),await xs(i),!0}catch(s){throw console.error("Error deleting employee file:",s),new Error("   ")}}static async getDepartments(){try{const e=Qe(pe,Ri),t=await lt(e),s=new Set;return t.docs.forEach(i=>{const a=i.data();a.department&&s.add(a.department)}),Array.from(s).sort()}catch(e){throw console.error("Error fetching departments:",e),new Error("   ")}}static validateEmployeeData(e){var s;const t={};if((s=e.fullName)!=null&&s.trim()||(t.fullName="  "),e.email&&e.email.trim()&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(t.email="    ")),e.phone&&e.phone.trim()&&(/^[\+\d\-\s\(\)]+$/.test(e.phone)||(t.phone="    ")),e.salary&&e.salary!==""){const i=parseFloat(e.salary);(isNaN(i)||i<0)&&(t.salary="     ")}return t}static async migrateExistingData(){try{console.log("Starting employees migration...");const t=(await this.getAllEmployees({limit:1e3})).employees;let s=0;for(const i of t)if(!i.internalId||!i.internalId.startsWith("EMP-")){const a=Bl();await this.updateEmployee(i.id,{...i,internalId:a}),s++,console.log(`Migrated employee: ${i.fullName} -> ${a}`)}return console.log(`Migration completed. ${s} employees migrated.`),{success:!0,migratedCount:s}}catch(e){throw console.error("Error during migration:",e),new Error("   ")}}}const rB=Object.freeze(Object.defineProperty({__proto__:null,EmployeeService:Pd,generateEmployeeId:Bl},Symbol.toStringTag,{value:"Module"})),iB=({onEdit:n,onAdd:e,onView:t,refreshTrigger:s})=>{const[i,a]=b.useState([]),[o,l]=b.useState(!0),[c,d]=b.useState(null),[h,f]=b.useState(""),[p,x]=b.useState([]),[I,D]=b.useState(!1),{logActivity:A,getCurrentUser:g}=$t(),{alertConfig:N,closeAlert:j,showSuccess:V,showError:$,showConfirm:Z}=Kt(),{currentPage:O,totalPages:M,paginatedItems:T,handlePageChange:L,resetPage:G,totalItems:U,itemsPerPage:k}=Ni(p,30);b.useEffect(()=>{re()},[]),b.useEffect(()=>{s&&re()},[s]),b.useEffect(()=>{xe()},[i,h]);const re=async()=>{try{l(!0),d(null);const _=await Pd.getAllEmployees({limit:1e3});a(_.employees||[])}catch(_){console.error("Error loading employees:",_),d(_.message),$(_.message,"  ")}finally{l(!1)}},xe=()=>{let _=[...i];if(h.trim()){const C=h.toLowerCase();_=_.filter(z=>{var K,F,Q,oe,E,te;return((K=z.fullName)==null?void 0:K.toLowerCase().includes(C))||((F=z.department)==null?void 0:F.toLowerCase().includes(C))||((Q=z.jobTitle)==null?void 0:Q.toLowerCase().includes(C))||((oe=z.email)==null?void 0:oe.toLowerCase().includes(C))||((E=z.phone)==null?void 0:E.includes(h))||((te=z.nationalId)==null?void 0:te.includes(h))})}x(_),G()},H=_=>{Z(`     

${_.fullName}

       .`,()=>ee(_),"  ")},ee=async _=>{try{D(!0),await un.moveToTrash(_,"employees"),await Pd.deleteEmployee(_.id);const C=g();A("task",`${C.name}  `,`  : ${_.fullName}`),await re(),V(`   : ${_.fullName}`,"  ")}catch(C){d(C.message),$(`    : ${C.message}`,"  ")}finally{D(!1)}},se=_=>_?`${parseFloat(_).toLocaleString("en-US")} `:" ",Y=_=>{if(!_)return" ";const C=new Date(_),z=String(C.getDate()).padStart(2,"0"),K=String(C.getMonth()+1).padStart(2,"0"),F=C.getFullYear();return`${z}/${K}/${F}`},R=_=>{const C={active:{class:"bg-light text-dark",text:""},inactive:{class:"bg-light text-dark",text:" "}},z=C[_]||C.active;return r.jsx("span",{className:`badge ${z.class}`,children:z.text})};return o?r.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"400px"},children:r.jsx(an,{size:"large"})}):r.jsxs("div",{className:"card shadow-sm","data-list":"employees",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"row align-items-center justify-content-between",children:[r.jsx("div",{className:"col-lg-4",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-person-badge-fill text-primary me-2"}),"  (",p.length,")"]})}),r.jsx("div",{className:"col-lg-8",children:r.jsxs("div",{className:"d-flex justify-content-end align-items-center",style:{gap:"25px"},children:[r.jsxs("div",{className:"input-group employees-search",style:{maxWidth:"350px"},children:[r.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:h,onChange:_=>f(_.target.value),style:{borderRadius:"0 8px 8px 0",fontSize:"14px",height:"44px"}}),r.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"8px 0 0 8px",borderRight:"1px solid #dee2e6"},children:r.jsx("i",{className:"bi bi-search text-muted"})})]}),r.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:e,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[r.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"  "]})]})})]})}),r.jsxs("div",{className:"card-body p-0",children:[c&&r.jsxs("div",{className:"alert alert-danger m-4",children:[r.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),c]}),!c&&p.length===0?r.jsxs("div",{className:"text-center py-5",children:[r.jsx("div",{className:"text-muted mb-3",children:r.jsx("i",{className:"bi bi-person-x",style:{fontSize:"3rem"}})}),r.jsx("h5",{className:"text-muted",children:"  "}),r.jsx("p",{className:"text-muted",children:h?"     ":"     "}),!h&&r.jsxs("button",{className:"btn btn-primary",onClick:e,children:[r.jsx("i",{className:"bi bi-plus-circle me-1"}),"  "]})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:""}),r.jsx("th",{className:"text-center",children:" "}),r.jsx("th",{className:"text-center",style:{width:"120px"},children:""})]})}),r.jsx("tbody",{children:T.map((_,C)=>r.jsxs("tr",{style:{backgroundColor:((O-1)*k+C)%2===0?"#ffffff":"#f8f9fa"},children:[r.jsx("td",{className:"text-center fw-bold text-muted",children:(O-1)*k+C+1}),r.jsx("td",{className:"text-center",children:r.jsx("div",{className:"d-flex align-items-center justify-content-center",children:r.jsx("div",{children:r.jsx("div",{className:"fw-bold text-primary",style:{cursor:"pointer",textDecoration:"underline"},onClick:()=>t&&t(_),title:"  ",children:_.fullName})})})}),r.jsx("td",{className:"text-center",children:_.phone||" "}),r.jsx("td",{className:"text-center",children:_.email||" "}),r.jsx("td",{className:"text-center",children:r.jsx("span",{className:"fw-bold text-success",children:se(_.salary)})}),r.jsx("td",{className:"text-center",children:R(_.status)}),r.jsx("td",{className:"text-center",children:r.jsx("small",{className:"text-muted",children:Y(_.hireDate)})}),r.jsx("td",{className:"text-center",children:r.jsxs("div",{className:"btn-group btn-group-sm",children:[r.jsx("button",{className:"btn btn-outline-primary",onClick:()=>t&&t(_),title:" ",style:{width:"32px",height:"32px",padding:"0",borderRadius:"6px 0 0 6px"},children:r.jsx("i",{className:"bi bi-eye"})}),r.jsx("button",{className:"btn btn-outline-danger",onClick:()=>H(_),title:"",disabled:I,style:{width:"32px",height:"32px",padding:"0",borderRadius:"0 6px 6px 0"},children:r.jsx("i",{className:"bi bi-trash"})})]})})]},_.id))})]})}),M>1&&r.jsx("div",{className:"d-flex justify-content-center p-4",children:r.jsx(ji,{currentPage:O,totalPages:M,onPageChange:L,totalItems:U,itemsPerPage:k})})]})]}),r.jsx(Wt,{show:N.show,onClose:j,title:N.title,message:N.message,type:N.type,onConfirm:N.onConfirm,confirmText:N.confirmText,cancelText:N.cancelText,showCancel:N.showCancel})]})};class Dh{static async uploadDocument(e,t,s){try{console.log(" Uploading employee document:",e.name,"for employee:",t),zs.validateFile(e,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]});const i=await zs.uploadFile(e,"employee-documents"),a={fileName:s.trim(),originalFileName:e.name,fileURL:i.url,storagePath:i.path,fileSize:e.size,fileType:e.type,employeeId:t||"new",ownerId:i.uploadedBy||"unknown",uploadedAt:it(),createdAt:it(),updatedAt:it()},o=await Ys(Qe(pe,this.COLLECTION_NAME),a);return console.log(" Employee document uploaded successfully:",o.id),{id:o.id,...a,uploadedAt:new Date().toISOString(),createdAt:new Date().toISOString()}}catch(i){throw console.error(" Error uploading employee document:",i),new Error(`   : ${i.message}`)}}static async getEmployeeDocuments(e){try{if(console.log(" Loading documents for employee:",e),!e||e==="new")return console.log(" No employee ID provided, returning empty array"),[];let t;try{const i=pt(Qe(pe,this.COLLECTION_NAME),qt("employeeId","==",e),$n("uploadedAt","desc"));t=await lt(i)}catch(i){console.warn(" OrderBy query failed (missing index), trying simple where query:",i.message);const a=pt(Qe(pe,this.COLLECTION_NAME),qt("employeeId","==",e));t=await lt(a)}const s=[];return t.forEach(i=>{var o,l,c,d;const a=i.data();s.push({id:i.id,...a,uploadedAt:((l=(o=a.uploadedAt)==null?void 0:o.toDate)==null?void 0:l.call(o))||new Date,createdAt:((d=(c=a.createdAt)==null?void 0:c.toDate)==null?void 0:d.call(c))||new Date})}),s.sort((i,a)=>new Date(a.uploadedAt)-new Date(i.uploadedAt)),console.log(" Loaded employee documents:",s.length),s}catch(t){if(console.error(" Error loading employee documents:",t),t.code==="permission-denied"||t.code==="not-found")return console.log(" Collection not accessible or doesn't exist, returning empty array"),[];throw new Error(`   : ${t.message}`)}}static async deleteDocument(e){try{console.log(" Deleting employee document:",e);const t=Ye(pe,this.COLLECTION_NAME,e),s=await Un(t);if(!s.exists())throw new Error("  ");const i=s.data();if(i.storagePath)try{await zs.deleteFile(i.storagePath),console.log(" File deleted from storage:",i.storagePath)}catch(a){console.warn(" Error deleting from storage (non-critical):",a.message)}return await xs(t),console.log(" Employee document deleted successfully"),!0}catch(t){throw console.error(" Error deleting employee document:",t),new Error(`   : ${t.message}`)}}static async updateDocument(e,t){try{console.log(" Updating employee document:",e);const s=Ye(pe,this.COLLECTION_NAME,e),i={...t,updatedAt:it()};return await gs(s,i),console.log(" Employee document updated successfully"),!0}catch(s){throw console.error(" Error updating employee document:",s),new Error(`   : ${s.message}`)}}static async transferDocuments(e,t){try{console.log(" Transferring documents from:",e,"to:",t);const s=await this.getEmployeeDocuments(e);if(s.length===0)return console.log(" No documents to transfer"),[];const i=s.map(a=>this.updateDocument(a.id,{employeeId:t}));return await Promise.all(i),console.log(" Documents transferred successfully:",s.length),s}catch(s){throw console.error(" Error transferring documents:",s),new Error(`   : ${s.message}`)}}static async getAllDocuments(){try{console.log(" Loading all employee documents");const e=pt(Qe(pe,this.COLLECTION_NAME),$n("uploadedAt","desc")),t=await lt(e),s=[];return t.forEach(i=>{var o,l,c,d;const a=i.data();s.push({id:i.id,...a,uploadedAt:((l=(o=a.uploadedAt)==null?void 0:o.toDate)==null?void 0:l.call(o))||new Date,createdAt:((d=(c=a.createdAt)==null?void 0:c.toDate)==null?void 0:d.call(c))||new Date})}),console.log(" Loaded all employee documents:",s.length),s}catch(e){throw console.error(" Error loading all employee documents:",e),new Error(`    : ${e.message}`)}}static validateDocumentData(e){const t={};return(!e.fileName||!e.fileName.trim())&&(t.fileName="  "),e.fileURL||(t.fileURL="  "),e.employeeId||(t.employeeId="  "),t}}ur(Dh,"COLLECTION_NAME","employee_documents");const Pb=({employee:n,onSave:e,onCancel:t})=>{const[s,i]=b.useState({fullName:"",jobTitle:"",department:"",phone:"",email:"",nationalId:"",status:"active",salary:"",hireDate:"",notes:""}),[a,o]=b.useState({}),[l,c]=b.useState(!1),[d,h]=b.useState(!1),[f,p]=b.useState([]),[x,I]=b.useState(!1),[D,A]=b.useState(!1),[g,N]=b.useState(null),[j,V]=b.useState(""),[$,Z]=b.useState(!1),{logActivity:O,getCurrentUser:M}=$t(),{alertConfig:T,closeAlert:L,showSuccess:G,showError:U,showConfirm:k}=Kt(),re=!!n;b.useEffect(()=>{n?(i({fullName:n.fullName||"",jobTitle:n.jobTitle||"",department:n.department||"",phone:n.phone||"",email:n.email||"",nationalId:n.nationalId||"",status:n.status||"active",salary:n.salary?n.salary.toString():"",hireDate:n.hireDate?Dd(n.hireDate):"",notes:n.notes||""}),xe()):p([])},[n]);const xe=async()=>{if(!(n!=null&&n.id)||n.id==="new"){p([]);return}try{console.log(" Loading documents for employee:",n.id);const F=await Dh.getEmployeeDocuments(n.id);p(F),console.log(" Loaded employee documents:",F.length)}catch(F){console.error(" Error loading employee documents:",F),p([])}},H=F=>{const{name:Q,value:oe}=F.target;i(E=>({...E,[Q]:oe})),a[Q]&&o(E=>({...E,[Q]:""}))},ee=async()=>{const F=Pd.validateEmployeeData(s),Q={};s.email&&s.email.trim()&&(Q.email=s.email.trim());try{const oe=await _i.validateUniqueFields(Q,re?n.id:null,"employees"),E={...F,...oe};return o(E),Object.keys(E).length===0}catch(oe){return console.error("Validation error:",oe),o(F),Object.keys(F).length===0}},se=async F=>{if(F.preventDefault(),!(l||!await ee())){c(!0);try{const oe={...s,salary:s.salary?parseFloat(s.salary):null,hireDate:s.hireDate?new Date(s.hireDate):new Date};let E;const te=M();if(re)await Pd.updateEmployee(n.id,oe),E={...n,...oe},O("task",`${te.name}  `,`   : ${s.fullName}`),G("    "," ");else{const Te=await Pd.createEmployee(oe);if(E={...oe,id:Te.id,internalId:Te.internalId},f.length>0)try{console.log(" Transferring documents to new employee:",Te.id);const ze=f.map(We=>({...We,employeeId:Te.id,employeeName:s.fullName,employeeEmail:s.email}));for(const We of ze)try{const at=new File([""],We.originalFileName,{type:We.fileType});Object.defineProperty(at,"name",{value:We.originalFileName}),Object.defineProperty(at,"size",{value:We.fileSize}),Object.defineProperty(at,"type",{value:We.fileType});const zt=await Dh.uploadDocument(at,Te.id,We.fileName);zt.fileURL=We.fileURL,zt.storagePath=We.storagePath,console.log(" Document transferred to Firebase:",We.fileName)}catch(at){console.warn(" Failed to save document to Firebase:",We.fileName,at.message)}console.log(" All documents transferred successfully")}catch(ze){console.warn(" Document transfer failed:",ze.message)}O("task",`${te.name}  `,`   : ${s.fullName}`),G("   "," ")}e&&e(E)}catch(oe){console.error("Error saving employee:",oe),U(oe.message||"    ","  ")}finally{c(!1)}}},Y=()=>{t&&t()},R=async F=>{const Q=F.target.files[0];if(Q){I(!0);try{try{zs.validateFile(Q,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]})}catch(E){throw new Error(E.message)}console.log(" Uploading employee document:",Q.name);const oe=await zs.uploadFile(Q,"employee-documents");N({...oe,originalFileName:Q.name,fileSize:Q.size,fileType:Q.type}),V(Q.name.split(".")[0]),A(!0),F.target.value=""}catch(oe){console.error("Error uploading employee document:",oe),U(oe.message||"   ","  "),F.target&&(F.target.value="")}finally{I(!1)}}},_=async()=>{if(!j.trim()){U("   ","  ");return}if(!g){U("   ","");return}try{I(!0),console.log(" Saving employee document via EmployeeDocumentService:",j);const F=new File([""],g.originalFileName,{type:g.fileType});Object.defineProperty(F,"name",{value:g.originalFileName}),Object.defineProperty(F,"size",{value:g.fileSize}),Object.defineProperty(F,"type",{value:g.fileType});const Q={fileName:j.trim(),originalFileName:g.originalFileName,fileURL:g.url,storagePath:g.path,fileSize:g.fileSize,fileType:g.fileType,employeeId:(n==null?void 0:n.id)||"new",employeeName:s.fullName||" ",employeeEmail:s.email||" ",uploadedAt:new Date().toISOString(),createdAt:new Date().toISOString(),id:Date.now().toString()};if(n!=null&&n.id&&n.id!=="new")try{const E=await Dh.uploadDocument(F,n.id,j.trim());E.fileURL=g.url,E.storagePath=g.path,p(te=>[...te,E]),console.log(" Document saved to Firebase successfully")}catch(E){console.warn(" Firebase save failed, storing locally for now:",E.message),p(te=>[...te,Q])}else console.log(" New employee - storing document locally until employee is saved"),p(E=>[...E,Q]);G(`   : ${j}`," ");const oe=M();O("file",`${oe.name}   `,`  : ${j} : ${s.fullName||" "}`),A(!1),N(null),V("")}catch(F){console.error("Error saving employee document:",F),U(`   : ${F.message}`,"  ")}finally{I(!1)}},C=()=>{console.log("User cancelled employee file upload"),A(!1),N(null),V("")},z=F=>{k(`      

${F.fileName}`,()=>K(F),"  ")},K=async F=>{try{if(Z(!0),n!=null&&n.id&&n.id!=="new"&&!F.id.toString().startsWith("temp_"))try{await Dh.deleteDocument(F.id),console.log(" Document deleted from Firebase")}catch(oe){console.warn(" Firebase delete failed, removing locally:",oe.message)}else try{await un.moveToTrash(F,"employee_documents"),console.log(" Document moved to trash")}catch(oe){console.warn(" Trash service failed, removing locally only:",oe.message)}p(oe=>oe.filter(E=>E.id!==F.id));const Q=M();O("task",`${Q.name}   `,`  : ${F.fileName} : ${s.fullName||""}`),G(`  : ${F.fileName}`," ")}catch(Q){U(`   : ${Q.message}`,"  ")}finally{Z(!1)}};return r.jsxs("div",{className:"card shadow-sm",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[r.jsx("div",{className:"d-flex align-items-center",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:`bi ${re?"bi-pencil-square":"bi-person-plus-fill"} text-primary me-2`}),re?"  ":"  "]})}),r.jsx("div",{className:"d-flex gap-2",children:r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>h(!0),style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:" "})})]})}),r.jsx("div",{className:"card-body",children:r.jsxs("form",{onSubmit:se,children:[r.jsxs("div",{className:"row",children:[r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"text",className:`form-control ${a.fullName?"is-invalid":""}`,name:"fullName",value:s.fullName,onChange:H,placeholder:"  ",disabled:l,required:!0}),a.fullName&&r.jsx("div",{className:"invalid-feedback",children:a.fullName})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:" "}),r.jsx("input",{type:"text",className:`form-control ${a.jobTitle?"is-invalid":""}`,name:"jobTitle",value:s.jobTitle,onChange:H,placeholder:"  ",disabled:l}),a.jobTitle&&r.jsx("div",{className:"invalid-feedback",children:a.jobTitle})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:""}),r.jsx("input",{type:"text",className:`form-control ${a.department?"is-invalid":""}`,name:"department",value:s.department,onChange:H,placeholder:"  ",disabled:l}),a.department&&r.jsx("div",{className:"invalid-feedback",children:a.department})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"tel",className:`form-control ${a.phone?"is-invalid":""}`,name:"phone",value:s.phone,onChange:H,placeholder:"  ",disabled:l,required:!0}),a.phone&&r.jsx("div",{className:"invalid-feedback",children:a.phone})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"email",className:`form-control ${a.email?"is-invalid":""}`,name:"email",value:s.email,onChange:H,placeholder:"  ",disabled:l,required:!0}),a.email&&r.jsx("div",{className:"invalid-feedback",children:a.email})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"password",className:`form-control ${a.nationalId?"is-invalid":""}`,name:"nationalId",value:s.nationalId,onChange:H,placeholder:"  ",disabled:l,required:!0}),a.nationalId&&r.jsx("div",{className:"invalid-feedback",children:a.nationalId})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:" ()"}),r.jsx("input",{type:"number",className:`form-control ${a.salary?"is-invalid":""}`,name:"salary",value:s.salary,onChange:H,placeholder:" ",min:"0",step:"0.01",disabled:l}),a.salary&&r.jsx("div",{className:"invalid-feedback",children:a.salary})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"date",className:`form-control ${a.hireDate?"is-invalid":""}`,name:"hireDate",value:s.hireDate,onChange:H,disabled:l,required:!0}),a.hireDate&&r.jsx("div",{className:"invalid-feedback",children:a.hireDate})]}),r.jsxs("div",{className:"col-md-6 mb-3",children:[r.jsx("label",{className:"form-label fw-bold",children:""}),r.jsxs("div",{className:"d-flex gap-2 mt-2",children:[r.jsxs("button",{type:"button",className:`btn ${s.status==="active"?"btn-primary":"btn-outline-secondary"}`,onClick:()=>H({target:{name:"status",value:"active"}}),disabled:l,style:{minWidth:"80px",height:"38px",fontSize:"14px",borderRadius:"6px"},children:[s.status==="active"&&r.jsx("i",{className:"bi bi-check me-1"}),""]}),r.jsxs("button",{type:"button",className:`btn ${s.status==="inactive"?"btn-success":"btn-outline-secondary"}`,onClick:()=>H({target:{name:"status",value:"inactive"}}),disabled:l,style:{minWidth:"80px",height:"38px",fontSize:"14px",borderRadius:"6px"},children:[s.status==="inactive"&&r.jsx("i",{className:"bi bi-check me-1"})," "]})]}),a.status&&r.jsx("div",{className:"invalid-feedback d-block",children:a.status})]}),r.jsxs("div",{className:"col-12 mb-3",children:[r.jsx("label",{className:"form-label",children:""}),r.jsx("textarea",{className:`form-control ${a.notes?"is-invalid":""}`,name:"notes",value:s.notes,onChange:H,rows:"4",placeholder:"  ...",disabled:l}),a.notes&&r.jsx("div",{className:"invalid-feedback",children:a.notes})]})]}),r.jsx("div",{className:"row",children:r.jsxs("div",{className:"col-12 d-flex justify-content-center gap-3 mt-4 mb-2",children:[r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:Y,disabled:l,style:{height:"32px",width:"80px",fontSize:"14px",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),r.jsx("button",{type:"submit",className:"btn btn-primary",disabled:l,style:{height:"32px",width:"80px",fontSize:"14px",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center"},children:l?r.jsxs(r.Fragment,{children:[r.jsx(an,{size:"small"}),r.jsx("span",{className:"ms-2",children:re?"...":"..."})]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:`bi ${re?"bi-check-lg":"bi-plus-circle"} me-1`}),re?"":""]})})]})})]})}),r.jsx(Wt,{show:T.show,onClose:L,title:T.title,message:T.message,type:T.type,onConfirm:T.onConfirm,confirmText:T.confirmText,cancelText:T.cancelText,showCancel:T.showCancel}),r.jsx(JN,{show:d,onClose:()=>h(!1),documents:f,setDocuments:p,tenderId:(n==null?void 0:n.id)||"new",uploadingDocument:x,setUploadingDocument:I,handleDocumentUpload:R,handleDeleteClick:z,deleting:$,title:" "}),D&&r.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.7)",zIndex:1060},tabIndex:"-1",dir:"rtl",children:r.jsx("div",{className:"modal-dialog modal-dialog-centered",children:r.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[r.jsx("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"12px 12px 0 0"},children:r.jsxs("h5",{className:"modal-title fw-bold",children:[r.jsx("i",{className:"bi bi-pencil-square me-2"})," "]})}),r.jsx("div",{className:"modal-body",style:{padding:"25px"},children:r.jsxs("div",{className:"mb-4",children:[r.jsxs("div",{className:"d-flex align-items-center mb-3",children:[r.jsx("div",{className:"bg-success bg-opacity-10 p-2 rounded-circle me-3",children:r.jsx("i",{className:"bi bi-file-earmark-check text-success"})}),r.jsxs("div",{children:[r.jsx("h6",{className:"mb-0 fw-bold text-success",children:"   "}),r.jsx("small",{className:"text-muted",children:g==null?void 0:g.originalFileName})]})]}),r.jsxs("div",{className:"mb-3",children:[r.jsxs("label",{className:"form-label fw-bold text-primary",children:[r.jsx("i",{className:"bi bi-tag me-1"}),"   *"]}),r.jsx("input",{type:"text",className:"form-control",value:j,onChange:F=>V(F.target.value),placeholder:"   ",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:F=>{F.target.style.borderColor="#28a745",F.target.style.boxShadow="0 0 0 0.2rem rgba(40, 167, 69, 0.25)"},onBlur:F=>{F.target.style.borderColor="#e9ecef",F.target.style.boxShadow="none"},autoFocus:!0}),r.jsxs("small",{className:"text-muted",children:[r.jsx("i",{className:"bi bi-info-circle me-1"}),"        "]})]})]})}),r.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:r.jsxs("div",{className:"d-flex justify-content-end",style:{gap:"12px"},children:[r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:C,style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500"},children:""}),r.jsxs("button",{type:"button",className:"btn btn-success",onClick:_,disabled:!j.trim(),style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500",opacity:j.trim()?1:.6},children:[r.jsx("i",{className:"bi bi-check-lg me-1"}),""]})]})})]})})})]})};function aB(){On();const[n,e]=b.useState(!1),[t,s]=b.useState("list"),[i,a]=b.useState(null),[o,l]=b.useState(0),{isTimelineVisible:c}=gn(),d=()=>{e(!n)},h=()=>{a(null),s("add")},f=g=>{a(g),s("edit")},p=g=>{a(g),s("view")},x=()=>{s("list"),a(null),l(g=>g+1)},I=()=>{x()},D=()=>{switch(t){case"add":return r.jsx(Pb,{onSave:I,onCancel:x});case"edit":return r.jsx(Pb,{employee:i,onSave:I,onCancel:x});case"view":return r.jsx(Pb,{employee:i,onSave:I,onCancel:x});case"list":default:return r.jsx(iB,{onEdit:f,onAdd:h,onView:p,refreshTrigger:o})}},A=()=>{const g=[{text:"",href:"/"},{text:" ",href:"/employees"}];switch(t){case"add":g.push({text:"  ",active:!0});break;case"edit":g.push({text:" ",active:!0});break;case"view":g.push({text:"  ",active:!0});break;default:g.push({text:"",active:!0});break}return g};return r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[r.jsx(Nn,{onToggle:d}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!c?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsx("ol",{className:"breadcrumb m-0",children:A().map((g,N)=>r.jsx("li",{className:`breadcrumb-item ${g.active?"text-secondary":""}`,...g.active&&{"aria-current":"page"},children:g.active?g.text:r.jsxs("a",{href:g.href,className:"text-decoration-none d-flex align-items-center",children:[N===0&&r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:g.text})]})},N))})}),r.jsx(jn,{}),r.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:r.jsxs("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:[t!=="list"&&r.jsx("div",{className:"mb-3 d-flex justify-content-end",children:r.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:x,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[r.jsx("i",{className:"bi bi-arrow-right",style:{marginRight:"5px"}})," "]})}),D()]})}),!n&&c&&r.jsx(_n,{rtl:!0}),!n&&c&&r.jsx(En,{})]})]})]})}function oB(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(aB,{})})})}const lB=()=>{const[n,e]=b.useState([]),[t,s]=b.useState([]),[i,a]=b.useState(!0),[o,l]=b.useState(""),[c,d]=b.useState(""),[h,f]=b.useState(""),{logActivity:p,getCurrentUser:x}=$t(),{alertConfig:I,closeAlert:D,showSuccess:A,showError:g,showConfirm:N}=Kt(),{currentPage:j,totalPages:V,paginatedItems:$,handlePageChange:Z,resetPage:O,totalItems:M,itemsPerPage:T}=Ni(t,30);b.useEffect(()=>{L()},[]),b.useEffect(()=>{if(h.trim()){const re=n.filter(xe=>{var se,Y,R,_,C,z,K,F,Q;const H=un.getItemDisplayInfo(xe),ee=h.toLowerCase();return((se=H.displayName)==null?void 0:se.toLowerCase().includes(ee))||((Y=H.email)==null?void 0:Y.toLowerCase().includes(ee))||((R=H.phone)==null?void 0:R.includes(h))||((_=H.supplierName)==null?void 0:_.toLowerCase().includes(ee))||((C=H.category)==null?void 0:C.toLowerCase().includes(ee))||((z=H.contextName)==null?void 0:z.toLowerCase().includes(ee))||((K=H.price)==null?void 0:K.toLowerCase().includes(ee))||((F=H.name)==null?void 0:F.toLowerCase().includes(ee))||((Q=xe.originalCollection)==null?void 0:Q.toLowerCase().includes(ee))});s(re)}else s(n);O()},[h,n,O]);const L=async()=>{try{a(!0),l("");const re=await un.getAllTrashItems();e(re),s(re)}catch(re){l(re.message)}finally{a(!1)}},G=async(re,xe)=>{var H,ee;try{d(re),l("");const se=n.find(_=>_.id===re);if(se&&se.originalCollection==="tenderItems"){const _=((H=se.tenderContext)==null?void 0:H.tenderTitle)||"  ",C=((ee=se.tenderContext)==null?void 0:ee.tenderId)||"new";N(`      

: ${xe}
  : ${_}`,async()=>{try{e(K=>K.filter(F=>F.id!==re)),await un.restoreItem(re);const z=x();p("task",`${z.name}     `,`  : ${xe} : ${_}`),A(`     : ${_}`," "),setTimeout(L,1e3)}catch(z){console.error("Error restoring tender item:",z),e(K=>[...K,se]),g(`   : ${z.message}`,"  ")}finally{d("")}},"   "),d("");return}e(_=>_.filter(C=>C.id!==re)),await un.restoreItem(re);const Y=x(),R=un.getItemDisplayInfo(se).name;p("task",`${Y.name}  ${R}  `,`  ${R}: ${xe}`),setTimeout(async()=>{await L()},500),A(`   : ${xe}`,"  ")}catch(se){console.error("Restore error:",se),l(se.message),g(`  : ${se.message}`,"  "),await L()}finally{d("")}},U=(re,xe)=>{N(`   "${xe}" 
     !`,async()=>{try{d(re),l(""),e(Y=>Y.filter(R=>R.id!==re)),await un.permanentlyDelete(re);const H=x(),ee=n.find(Y=>Y.id===re),se=un.getItemDisplayInfo(ee).name;p("task",`${H.name}  ${se}   `,`  ${se} : ${xe}`),setTimeout(async()=>{await L()},500),A(`   : ${xe}`,"  ")}catch(H){console.error("Permanent delete error:",H),l(H.message),g(`  : ${H.message}`,"  "),await L()}finally{d("")}},"  ")},k=()=>{N(` :       
         .
     !`,async()=>{try{a(!0),e([]),await un.clearAllTrashRecords();const re=x();p("task",`${re.name}    `,"      "),await L(),A("     ","  ")}catch(re){l(re.message),g(`   : ${re.message}`,"  "),await L()}finally{a(!1)}}," -   ")};return r.jsxs("div",{className:"trash-list",children:[r.jsxs("div",{className:"card shadow-sm",children:[r.jsxs("div",{className:"card-header bg-white border-bottom py-4",children:[r.jsxs("div",{className:"row align-items-center justify-content-between",children:[r.jsx("div",{className:"col-lg-4",children:r.jsxs("h5",{className:"mb-0 fw-bold",children:[r.jsx("i",{className:"bi bi-trash text-danger me-2"}),"  (",t.length,")"]})}),r.jsx("div",{className:"col-lg-8",children:r.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[r.jsxs("div",{className:"input-group trash-search",style:{maxWidth:"350px"},children:[r.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:h,onChange:re=>f(re.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),r.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:r.jsx("i",{className:"bi bi-search text-muted"})})]}),n.length>0&&r.jsxs("button",{className:"btn btn-danger shadow-sm px-4",onClick:k,disabled:i,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500",background:"linear-gradient(135deg, #dc3545 0%, #b02a37 100%)",border:"none",color:"white"},children:[r.jsx("i",{className:"bi bi-trash3 me-2"}),"  "]})]})})]}),o&&r.jsxs("div",{className:"alert alert-danger mt-3 mb-0",children:[r.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),o]})]}),r.jsx("div",{className:"card-body p-0",children:i?r.jsx(an,{show:!0,message:"  ...",overlay:!1}):t.length===0?r.jsx("div",{className:"text-center py-5",children:r.jsxs("div",{className:"empty-state",children:[r.jsx("i",{className:"bi bi-trash3 text-muted mb-3",style:{fontSize:"4rem"}}),r.jsx("h5",{className:"text-muted",children:n.length===0?"  ":"   "}),r.jsx("p",{className:"text-muted",children:n.length===0?"   ":"     "})]})}):r.jsxs("div",{className:"p-4",children:[r.jsx("div",{className:"row g-3",children:$.map((re,xe)=>{const H=un.getItemDisplayInfo(re),ee=un.getTimeSinceDeleted(re.deletedAt),se={fontSize:"12px",fontWeight:"600",color:"#6c757d",marginLeft:"8px"},Y={fontSize:"13px",color:"#495057",fontWeight:"500"};return r.jsx("div",{className:"col-lg-4 col-md-6",children:r.jsxs("div",{className:"card h-100 shadow-sm",style:{borderRadius:"10px",border:"1px solid #e3e6f0",transition:"all 0.3s ease",overflow:"hidden"},children:[r.jsxs("div",{className:"card-body p-4",children:[r.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-3",children:[r.jsxs("span",{className:`badge bg-${H.color} px-3 py-2`,style:{borderRadius:"20px",fontSize:"11px",fontWeight:"600"},children:[r.jsx("i",{className:`bi ${H.icon} me-1`}),H.name]}),r.jsx("small",{className:"text-muted fw-medium",style:{fontSize:"11px"},children:ee})]}),r.jsx("h6",{className:"card-title mb-3",style:{color:"#2c3e50",fontSize:"16px",fontWeight:"600",lineHeight:"1.3"},children:H.displayName}),r.jsxs("div",{className:"card-text",children:[re.originalCollection==="rawmaterials"&&r.jsxs("div",{className:"info-grid",children:[r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value",style:Y,children:H.category})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:" :"}),r.jsx("span",{className:"info-value",style:Y,children:H.minimumStock})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value",style:Y,children:H.supplier})]})]}),re.originalCollection==="employees"&&r.jsxs("div",{className:"info-grid",children:[r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:" :"}),r.jsx("span",{className:"info-value",style:Y,children:re.email||" "})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:" :"}),r.jsx("span",{className:"info-value",style:Y,children:re.phone||" "})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value",style:Y,children:re.department||" "})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value",style:Y,children:re.jobTitle||" "})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:`badge ${re.status==="active"?"bg-success":"bg-secondary"}`,style:{fontSize:"10px"},children:re.status==="active"?"":" "})]}),re.autoCreated&&r.jsx("div",{className:"info-item mb-2",children:r.jsxs("span",{className:"badge bg-warning text-dark",style:{fontSize:"10px"},children:[r.jsx("i",{className:"bi bi-robot me-1"}),"  "]})})]}),re.originalCollection==="price_quotes"&&r.jsxs("div",{className:"info-grid",children:[r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value text-success fw-bold",style:{...Y,color:"#28a745"},children:H.price})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value",style:Y,children:H.supplierName})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value",style:Y,children:H.date})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsxs("span",{className:"info-label",style:se,children:[H.contextLabel,":"]}),r.jsx("span",{className:"info-value",style:{...Y,color:"#007bff"},children:H.contextName})]})]}),(re.originalCollection==="localproducts"||re.originalCollection==="foreignproducts")&&r.jsxs("div",{className:"info-grid",children:[r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value",style:Y,children:H.category})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value",style:Y,children:H.unit})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value text-success fw-bold",style:{...Y,color:"#28a745"},children:H.price})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value",style:Y,children:H.supplier})]})]}),re.originalCollection==="tenderItems"&&r.jsxs("div",{className:"info-grid",children:[r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value",style:Y,children:H.quantity})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value text-success fw-bold",style:{...Y,color:"#28a745"},children:H.price})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value",style:Y,children:H.itemType})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsxs("span",{className:"info-label",style:se,children:[H.contextLabel,":"]}),r.jsx("span",{className:"info-value",style:{...Y,color:"#007bff"},children:H.contextName})]})]}),re.originalCollection==="tender_documents"&&r.jsxs("div",{className:"info-grid",children:[r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value",style:Y,children:H.fileSize})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value",style:Y,children:H.fileType})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value fw-bold",style:{...Y,color:"#007bff"},children:H.contextName})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:" :"}),r.jsx("span",{className:"info-value",style:{...Y,color:"#6c757d",fontFamily:"monospace"},children:re.tenderReferenceNumber||" "})]})]}),re.originalCollection==="employee_documents"&&r.jsxs("div",{className:"info-grid",children:[r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:" :"}),r.jsx("span",{className:"info-value",style:{...Y,fontSize:"12px",color:"#6c757d"},children:re.originalFileName||" "})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value",style:Y,children:re.fileSize?`${(re.fileSize/1024/1024).toFixed(2)} .`:" "})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:" :"}),r.jsx("span",{className:"info-value",style:Y,children:(()=>{var _;const R=re.fileType||"";return R.includes("pdf")?"PDF":R.includes("word")||R.includes("document")?"Word":R.includes("image")?"":((_=R.split("/")[1])==null?void 0:_.toUpperCase())||" "})()})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value fw-bold",style:{...Y,color:"#28a745"},children:re.employeeName||H.contextName})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:" :"}),r.jsx("span",{className:"info-value",style:{...Y,color:"#6c757d",fontFamily:"monospace",fontSize:"12px"},children:re.employeeId||" "})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:" :"}),r.jsx("span",{className:"info-value",style:{...Y,color:"#6c757d",fontSize:"12px"},children:(()=>{const R=re.uploadedAt||re.uploadDate;if(!R)return" ";try{return new Date(R).toLocaleDateString("ar-SA",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return" "}})()})]}),re.fileURL&&r.jsx("div",{className:"info-item mb-2",children:r.jsxs("span",{className:"badge bg-success bg-opacity-10 text-success",style:{fontSize:"10px"},children:[r.jsx("i",{className:"bi bi-link-45deg me-1"}),"  "]})})]}),re.originalCollection==="manufacturedProducts"&&r.jsxs("div",{className:"info-grid",children:[re.referenceNumber&&r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:" :"}),r.jsx("span",{className:"info-value",style:{...Y,fontFamily:"monospace",color:"#007bff"},children:re.referenceNumber})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:" :"}),r.jsx("span",{className:"info-value text-success fw-bold",style:{...Y,color:"#28a745"},children:re.estimatedValue?`${parseFloat(re.estimatedValue).toLocaleString("en-US")} `:"  "})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:" :"}),r.jsx("span",{className:"info-value",style:Y,children:(()=>{const R=re.submissionDeadline;if(!R)return" ";try{return new Date(R).toLocaleDateString("ar-SA",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return R}})()})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:`badge ${re.status==="active"?"bg-success":"bg-secondary"}`,style:{fontSize:"10px"},children:re.status==="active"?"":" "})]}),re.description&&r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value",style:{...Y,fontSize:"12px",color:"#6c757d",lineHeight:"1.4"},children:re.description.length>80?`${re.description.substring(0,80)}...`:re.description})]}),re.internalId&&r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:" :"}),r.jsx("span",{className:"info-value",style:{...Y,color:"#6c757d",fontFamily:"monospace",fontSize:"11px"},children:re.internalId})]}),re.createdAt&&r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:" :"}),r.jsx("span",{className:"info-value",style:{...Y,color:"#6c757d",fontSize:"12px"},children:(()=>{var R;try{let _;if((R=re.createdAt)!=null&&R.toDate)_=re.createdAt.toDate();else if(re.createdAt)_=new Date(re.createdAt);else return" ";return _.toLocaleDateString("ar-SA",{year:"numeric",month:"short",day:"numeric"})}catch{return" "}})()})]})]}),(re.originalCollection==="suppliers"||re.originalCollection==="foreignSuppliers"||re.originalCollection==="customers")&&r.jsxs("div",{className:"info-grid",children:[r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value",style:Y,children:H.email})]}),r.jsxs("div",{className:"info-item mb-2",children:[r.jsx("span",{className:"info-label",style:se,children:":"}),r.jsx("span",{className:"info-value",style:{...Y,direction:"ltr"},children:H.phone})]})]})]})]}),r.jsx("div",{className:"card-footer bg-white border-top",children:r.jsxs("div",{className:"d-flex justify-content-center gap-3",children:[r.jsx("button",{className:"btn btn-success",onClick:()=>G(re.id,H.displayName),disabled:c===re.id,title:"",style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",border:"none",color:"white"},children:c===re.id?r.jsx("span",{className:"spinner-border spinner-border-sm",style:{width:"12px",height:"12px"}}):""}),r.jsx("button",{className:"btn btn-danger",onClick:()=>U(re.id,H.displayName),disabled:c===re.id,title:" ",style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",border:"none",color:"white"},children:c===re.id?r.jsx("span",{className:"spinner-border spinner-border-sm",style:{width:"12px",height:"12px"}}):""})]})})]})},re.id)})}),t.length>0&&r.jsx(ji,{currentPage:j,totalPages:V,onPageChange:Z,totalItems:M,itemsPerPage:T})]})})]}),r.jsx(Wt,{show:I.show,onClose:D,title:I.title,message:I.message,type:I.type,onConfirm:I.onConfirm,confirmText:I.confirmText,cancelText:I.cancelText,showCancel:I.showCancel})]})};function cB(){const[n,e]=b.useState(!1),{isTimelineVisible:t}=gn(),s=()=>{e(!n)};return r.jsx(At,{children:r.jsx(Dt,{children:r.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[r.jsx(Nn,{onToggle:s}),r.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:n})}),r.jsxs("div",{className:"app-container",children:[r.jsxs("div",{style:{position:"sticky",top:0,zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),r.jsx(jn,{})]}),r.jsxs("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:[r.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"60px"},children:r.jsx(lB,{})}),r.jsx("div",{className:"app-footer",style:{textAlign:"center",padding:"20px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",marginTop:"20px"},children:r.jsx("span",{children:" Modern Bin 2025"})})]})]})]}),!n&&t&&r.jsx(_n,{rtl:!0}),!n&&t&&r.jsx(En,{})]})})})}function dB(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(cB,{})})})}function uB(){On();const{logActivity:n,getCurrentUser:e}=$t(),{alertConfig:t,closeAlert:s,showSuccess:i,showError:a,showConfirm:o}=Kt(),{isTimelineVisible:l}=gn(),[c,d]=b.useState(!1),[h,f]=b.useState(!0),[p,x]=b.useState([]),[I,D]=b.useState([]),[A,g]=b.useState("categories"),[N,j]=b.useState({name:"",description:""}),[V,$]=b.useState(null),[Z,O]=b.useState({name:"",description:""}),[M,T]=b.useState(null),[L,G]=b.useState(!1);b.useEffect(()=>{U()},[]);const U=async()=>{try{f(!0),await pr.initializeDefaultSettings();const[C,z]=await Promise.all([pr.getAllCategories(),pr.getAllUnits()]);x(C),D(z)}catch(C){console.error("Error loading settings:",C),a("   ","  ")}finally{f(!1)}},k=()=>{d(!c)},re=async C=>{if(C.preventDefault(),!N.name.trim()){a("  "," ");return}try{G(!0);const z=e();V?(await pr.updateCategory(V,N),n("task",`${z.name}  `,`  : ${N.name}`),i("   "," "),$(null)):(await pr.createCategory(N),n("task",`${z.name}   `,`  : ${N.name}`),i("   "," ")),j({name:"",description:""}),U()}catch(z){a(z.message,"")}finally{G(!1)}},xe=C=>{j({name:C.name,description:C.description||""}),$(C.id)},H=C=>{o(`      "${C.name}"
     !`,async()=>{try{G(!0),await pr.deleteCategory(C.id);const z=e();n("task",`${z.name}  `,`  : ${C.name}`),i("   "," "),U()}catch(z){a(z.message,"  ")}finally{G(!1)}}," ")},ee=()=>{j({name:"",description:""}),$(null)},se=async C=>{if(C.preventDefault(),!Z.name.trim()){a("  "," ");return}try{G(!0);const z=e();M?(await pr.updateUnit(M,Z),n("task",`${z.name}  `,`  : ${Z.name}`),i("   "," "),T(null)):(await pr.createUnit(Z),n("task",`${z.name}   `,`  : ${Z.name}`),i("   "," ")),O({name:"",description:""}),U()}catch(z){a(z.message,"")}finally{G(!1)}},Y=C=>{O({name:C.name,description:C.description||""}),T(C.id)},R=C=>{o(`      "${C.name}"
     !`,async()=>{try{G(!0),await pr.deleteUnit(C.id);const z=e();n("task",`${z.name}  `,`  : ${C.name}`),i("   "," "),U()}catch(z){a(z.message,"  ")}finally{G(!1)}}," ")},_=()=>{O({name:"",description:""}),T(null)};return h?r.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"100vh"},children:r.jsx(an,{show:!0,message:"  ..."})}):r.jsx(At,{children:r.jsxs(Dt,{children:[r.jsxs("div",{className:`page-wrapper ${c?"sidebar-collapsed":""}`,dir:"rtl",children:[r.jsx(Nn,{onToggle:k}),r.jsxs("div",{className:"main-container",style:{paddingRight:c?"72px":"250px",paddingLeft:c||!l?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[r.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:c?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:r.jsx(vn,{isCollapsed:c})}),r.jsxs("div",{className:"app-container",children:[r.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:r.jsxs("ol",{className:"breadcrumb m-0",children:[r.jsx("li",{className:"breadcrumb-item",children:r.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[r.jsx("i",{className:"bi bi-house lh-1 me-2"}),r.jsx("span",{className:"text-primary",children:""})]})}),r.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),r.jsx(jn,{}),r.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:r.jsx("div",{className:"app-content-area p-4",children:r.jsxs("div",{className:"card shadow-sm",children:[r.jsx("div",{className:"card-header bg-white border-bottom py-4",children:r.jsx("div",{className:"d-flex justify-content-between align-items-center",children:r.jsx("div",{className:"d-flex align-items-center",children:r.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[r.jsx("i",{className:"bi bi-gear-wide-connected text-primary me-2"})," "]})})})}),r.jsxs("div",{className:"card-body p-0",children:[r.jsxs("ul",{className:"nav nav-tabs border-bottom-0",id:"settingsTabs",role:"tablist",children:[r.jsx("li",{className:"nav-item",role:"presentation",children:r.jsxs("button",{className:`nav-link ${A==="categories"?"active":""}`,onClick:()=>g("categories"),type:"button",style:{borderRadius:"0",borderBottom:A==="categories"?"3px solid #007bff":"1px solid #dee2e6",fontWeight:"500"},children:[r.jsx("i",{className:"bi bi-tags me-2"})," "]})}),r.jsx("li",{className:"nav-item",role:"presentation",children:r.jsxs("button",{className:`nav-link ${A==="units"?"active":""}`,onClick:()=>g("units"),type:"button",style:{borderRadius:"0",borderBottom:A==="units"?"3px solid #007bff":"1px solid #dee2e6",fontWeight:"500"},children:[r.jsx("i",{className:"bi bi-rulers me-2"})," "]})})]}),r.jsxs("div",{className:"tab-content p-4",children:[A==="categories"&&r.jsx("div",{className:"tab-pane fade show active",children:r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-md-4",children:r.jsxs("div",{className:"card bg-light",children:[r.jsx("div",{className:"card-header",children:r.jsxs("h6",{className:"mb-0",children:[r.jsx("i",{className:"bi bi-plus-circle me-2"}),V?" ":"  "]})}),r.jsx("div",{className:"card-body",children:r.jsxs("form",{onSubmit:re,children:[r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"text",className:"form-control",value:N.name,onChange:C=>j({...N,name:C.target.value}),placeholder:"  ",required:!0})]}),r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:""}),r.jsx("textarea",{className:"form-control",rows:"2",value:N.description,onChange:C=>j({...N,description:C.target.value}),placeholder:"  "})]}),r.jsxs("div",{className:"d-flex gap-2",children:[r.jsxs("button",{type:"submit",className:"btn btn-primary flex-fill",disabled:L,style:{height:"32px",fontSize:"14px"},children:[L?r.jsx("span",{className:"spinner-border spinner-border-sm me-2"}):r.jsx("i",{className:`bi ${V?"bi-check-lg":"bi-plus-lg"} me-2`}),V?"":""]}),V&&r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:ee,style:{height:"32px",fontSize:"14px"},children:""})]})]})})]})}),r.jsx("div",{className:"col-md-8",children:r.jsxs("div",{className:"card",children:[r.jsx("div",{className:"card-header",children:r.jsxs("h6",{className:"mb-0",children:[r.jsx("i",{className:"bi bi-list me-2"}),"  (",p.length,")"]})}),r.jsx("div",{className:"card-body p-0",children:r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{children:" "}),r.jsx("th",{children:""}),r.jsx("th",{style:{width:"100px"},children:""})]})}),r.jsx("tbody",{children:p.length===0?r.jsx("tr",{children:r.jsxs("td",{colSpan:"3",className:"text-center py-4 text-muted",children:[r.jsx("i",{className:"bi bi-inbox fs-1 d-block mb-2"}),"   "]})}):p.map(C=>r.jsxs("tr",{children:[r.jsx("td",{children:r.jsx("strong",{children:C.name})}),r.jsx("td",{children:r.jsx("small",{className:"text-muted",children:C.description||"  "})}),r.jsx("td",{children:r.jsxs("div",{className:"btn-group",style:{gap:"4px"},children:[r.jsx("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>xe(C),title:"",style:{width:"32px",height:"28px"},children:r.jsx("i",{className:"bi bi-pencil"})}),r.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>H(C),title:"",style:{width:"32px",height:"28px"},children:r.jsx("i",{className:"bi bi-trash"})})]})})]},C.id))})]})})})]})})]})}),A==="units"&&r.jsx("div",{className:"tab-pane fade show active",children:r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-md-4",children:r.jsxs("div",{className:"card bg-light",children:[r.jsx("div",{className:"card-header",children:r.jsxs("h6",{className:"mb-0",children:[r.jsx("i",{className:"bi bi-plus-circle me-2"}),M?" ":"  "]})}),r.jsx("div",{className:"card-body",children:r.jsxs("form",{onSubmit:se,children:[r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"  *"}),r.jsx("input",{type:"text",className:"form-control",value:Z.name,onChange:C=>O({...Z,name:C.target.value}),placeholder:":   ",required:!0})]}),r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:""}),r.jsx("textarea",{className:"form-control",rows:"2",value:Z.description,onChange:C=>O({...Z,description:C.target.value}),placeholder:"  "})]}),r.jsxs("div",{className:"d-flex gap-2",children:[r.jsxs("button",{type:"submit",className:"btn btn-primary flex-fill",disabled:L,style:{height:"32px",fontSize:"14px"},children:[L?r.jsx("span",{className:"spinner-border spinner-border-sm me-2"}):r.jsx("i",{className:`bi ${M?"bi-check-lg":"bi-plus-lg"} me-2`}),M?"":""]}),M&&r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:_,style:{height:"32px",fontSize:"14px"},children:""})]})]})})]})}),r.jsx("div",{className:"col-md-8",children:r.jsxs("div",{className:"card",children:[r.jsx("div",{className:"card-header",children:r.jsxs("h6",{className:"mb-0",children:[r.jsx("i",{className:"bi bi-list me-2"}),"  (",I.length,")"]})}),r.jsx("div",{className:"card-body p-0",children:r.jsx("div",{className:"table-responsive",children:r.jsxs("table",{className:"table table-hover mb-0",children:[r.jsx("thead",{className:"table-light",children:r.jsxs("tr",{children:[r.jsx("th",{children:" "}),r.jsx("th",{children:""}),r.jsx("th",{style:{width:"100px"},children:""})]})}),r.jsx("tbody",{children:I.length===0?r.jsx("tr",{children:r.jsxs("td",{colSpan:"3",className:"text-center py-4 text-muted",children:[r.jsx("i",{className:"bi bi-inbox fs-1 d-block mb-2"}),"   "]})}):I.map(C=>r.jsxs("tr",{children:[r.jsx("td",{children:r.jsx("strong",{children:C.name})}),r.jsx("td",{children:r.jsx("small",{className:"text-muted",children:C.description||"  "})}),r.jsx("td",{children:r.jsxs("div",{className:"btn-group",style:{gap:"4px"},children:[r.jsx("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>Y(C),title:"",style:{width:"32px",height:"28px"},children:r.jsx("i",{className:"bi bi-pencil"})}),r.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>R(C),title:"",style:{width:"32px",height:"28px"},children:r.jsx("i",{className:"bi bi-trash"})})]})})]},C.id))})]})})})]})})]})})]})]})]})})})]}),!c&&l&&r.jsx(_n,{rtl:!0}),!c&&l&&r.jsx(En,{})]})]}),r.jsx(Wt,{show:t.show,onClose:s,title:t.title,message:t.message,type:t.type,onConfirm:t.onConfirm,confirmText:t.confirmText,cancelText:t.cancelText,showCancel:t.showCancel})]})})}function hB(){return r.jsx(At,{children:r.jsx(Dt,{children:r.jsx(uB,{})})})}const mB=()=>r.jsx(E8,{children:r.jsx(N8,{children:r.jsx(N3,{basename:"/",children:r.jsxs(ZL,{children:[r.jsx(Ut,{path:"/",element:r.jsx(vI,{})}),r.jsx(Ut,{path:"/tender",element:r.jsx(vI,{})}),r.jsx(Ut,{path:"/tenders/list",element:r.jsx(W8,{})}),r.jsx(Ut,{path:"/tenders/add",element:r.jsx(NI,{})}),r.jsx(Ut,{path:"/tenders/edit/:id",element:r.jsx(NI,{})}),r.jsx(Ut,{path:"/tenders/tracking",element:r.jsx(n9,{})}),r.jsx(Ut,{path:"/tenders/raw-materials/:tenderId",element:r.jsx(r9,{})}),r.jsx(Ut,{path:"/tenders/local-products/:tenderId",element:r.jsx(a9,{})}),r.jsx(Ut,{path:"/tenders/foreign-products/:tenderId",element:r.jsx(l9,{})}),r.jsx(Ut,{path:"/tenders/manufactured-products/:tenderId",element:r.jsx(u9,{})}),r.jsx(Ut,{path:"/raw-materials",element:r.jsx(g9,{})}),r.jsx(Ut,{path:"/raw-materials/add",element:r.jsx(_I,{})}),r.jsx(Ut,{path:"/raw-materials/edit/:id",element:r.jsx(_I,{})}),r.jsx(Ut,{path:"/local-products",element:r.jsx(j9,{})}),r.jsx(Ut,{path:"/local-products/add",element:r.jsx(EI,{})}),r.jsx(Ut,{path:"/local-products/edit/:id",element:r.jsx(EI,{})}),r.jsx(Ut,{path:"/foreign-products",element:r.jsx(I9,{})}),r.jsx(Ut,{path:"/foreign-products/add",element:r.jsx(SI,{})}),r.jsx(Ut,{path:"/foreign-products/edit/:id",element:r.jsx(SI,{})}),r.jsx(Ut,{path:"/manufactured-products",element:r.jsx(D9,{})}),r.jsx(Ut,{path:"/manufactured-products/add",element:r.jsx(II,{})}),r.jsx(Ut,{path:"/manufactured-products/edit/:id",element:r.jsx(II,{})}),r.jsx(Ut,{path:"/manufactured-products/raw-materials/:productId",element:r.jsx(k9,{})}),r.jsx(Ut,{path:"/manufactured-products/local-products/:productId",element:r.jsx(M9,{})}),r.jsx(Ut,{path:"/manufactured-products/foreign-products/:productId",element:r.jsx(F9,{})}),r.jsx(Ut,{path:"/suppliers/local",element:r.jsx($9,{})}),r.jsx(Ut,{path:"/suppliers/foreign",element:r.jsx(G9,{})}),r.jsx(Ut,{path:"/clients",element:r.jsx(X9,{})}),r.jsx(Ut,{path:"/companies",element:r.jsx(sB,{})}),r.jsx(Ut,{path:"/employees",element:r.jsx(oB,{})}),r.jsx(Ut,{path:"/trash",element:r.jsx(dB,{})}),r.jsx(Ut,{path:"/settings",element:r.jsx(hB,{})})]})})})});function fB(){return r.jsx(R8,{children:r.jsx(mB,{})})}var pB={exports:{}};/*!
  * Bootstrap v5.3.7 (https://getbootstrap.com/)
  * Copyright 2011-2025 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */(function(n,e){(function(t,s){n.exports=s()})(hk,function(){const t=new Map,s={set(P,m,v){t.has(P)||t.set(P,new Map);const B=t.get(P);B.has(m)||B.size===0?B.set(m,v):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(B.keys())[0]}.`)},get:(P,m)=>t.has(P)&&t.get(P).get(m)||null,remove(P,m){if(!t.has(P))return;const v=t.get(P);v.delete(m),v.size===0&&t.delete(P)}},i="transitionend",a=P=>(P&&window.CSS&&window.CSS.escape&&(P=P.replace(/#([^\s"#']+)/g,(m,v)=>`#${CSS.escape(v)}`)),P),o=P=>{P.dispatchEvent(new Event(i))},l=P=>!(!P||typeof P!="object")&&(P.jquery!==void 0&&(P=P[0]),P.nodeType!==void 0),c=P=>l(P)?P.jquery?P[0]:P:typeof P=="string"&&P.length>0?document.querySelector(a(P)):null,d=P=>{if(!l(P)||P.getClientRects().length===0)return!1;const m=getComputedStyle(P).getPropertyValue("visibility")==="visible",v=P.closest("details:not([open])");if(!v)return m;if(v!==P){const B=P.closest("summary");if(B&&B.parentNode!==v||B===null)return!1}return m},h=P=>!P||P.nodeType!==Node.ELEMENT_NODE||!!P.classList.contains("disabled")||(P.disabled!==void 0?P.disabled:P.hasAttribute("disabled")&&P.getAttribute("disabled")!=="false"),f=P=>{if(!document.documentElement.attachShadow)return null;if(typeof P.getRootNode=="function"){const m=P.getRootNode();return m instanceof ShadowRoot?m:null}return P instanceof ShadowRoot?P:P.parentNode?f(P.parentNode):null},p=()=>{},x=P=>{P.offsetHeight},I=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,D=[],A=()=>document.documentElement.dir==="rtl",g=P=>{var m;m=()=>{const v=I();if(v){const B=P.NAME,ce=v.fn[B];v.fn[B]=P.jQueryInterface,v.fn[B].Constructor=P,v.fn[B].noConflict=()=>(v.fn[B]=ce,P.jQueryInterface)}},document.readyState==="loading"?(D.length||document.addEventListener("DOMContentLoaded",()=>{for(const v of D)v()}),D.push(m)):m()},N=(P,m=[],v=P)=>typeof P=="function"?P.call(...m):v,j=(P,m,v=!0)=>{if(!v)return void N(P);const B=(ve=>{if(!ve)return 0;let{transitionDuration:De,transitionDelay:Be}=window.getComputedStyle(ve);const Ze=Number.parseFloat(De),et=Number.parseFloat(Be);return Ze||et?(De=De.split(",")[0],Be=Be.split(",")[0],1e3*(Number.parseFloat(De)+Number.parseFloat(Be))):0})(m)+5;let ce=!1;const de=({target:ve})=>{ve===m&&(ce=!0,m.removeEventListener(i,de),N(P))};m.addEventListener(i,de),setTimeout(()=>{ce||o(m)},B)},V=(P,m,v,B)=>{const ce=P.length;let de=P.indexOf(m);return de===-1?!v&&B?P[ce-1]:P[0]:(de+=v?1:-1,B&&(de=(de+ce)%ce),P[Math.max(0,Math.min(de,ce-1))])},$=/[^.]*(?=\..*)\.|.*/,Z=/\..*/,O=/::\d+$/,M={};let T=1;const L={mouseenter:"mouseover",mouseleave:"mouseout"},G=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function U(P,m){return m&&`${m}::${T++}`||P.uidEvent||T++}function k(P){const m=U(P);return P.uidEvent=m,M[m]=M[m]||{},M[m]}function re(P,m,v=null){return Object.values(P).find(B=>B.callable===m&&B.delegationSelector===v)}function xe(P,m,v){const B=typeof m=="string",ce=B?v:m||v;let de=Y(P);return G.has(de)||(de=P),[B,ce,de]}function H(P,m,v,B,ce){if(typeof m!="string"||!P)return;let[de,ve,De]=xe(m,v,B);m in L&&(ve=(xt=>function(mt){if(!mt.relatedTarget||mt.relatedTarget!==mt.delegateTarget&&!mt.delegateTarget.contains(mt.relatedTarget))return xt.call(this,mt)})(ve));const Be=k(P),Ze=Be[De]||(Be[De]={}),et=re(Ze,ve,de?v:null);if(et)return void(et.oneOff=et.oneOff&&ce);const Ke=U(ve,m.replace($,"")),bt=de?function(dt,xt,mt){return function yt(ln){const yn=dt.querySelectorAll(xt);for(let{target:_t}=ln;_t&&_t!==this;_t=_t.parentNode)for(const Bt of yn)if(Bt===_t)return _(ln,{delegateTarget:_t}),yt.oneOff&&R.off(dt,ln.type,xt,mt),mt.apply(_t,[ln])}}(P,v,ve):function(dt,xt){return function mt(yt){return _(yt,{delegateTarget:dt}),mt.oneOff&&R.off(dt,yt.type,xt),xt.apply(dt,[yt])}}(P,ve);bt.delegationSelector=de?v:null,bt.callable=ve,bt.oneOff=ce,bt.uidEvent=Ke,Ze[Ke]=bt,P.addEventListener(De,bt,de)}function ee(P,m,v,B,ce){const de=re(m[v],B,ce);de&&(P.removeEventListener(v,de,!!ce),delete m[v][de.uidEvent])}function se(P,m,v,B){const ce=m[v]||{};for(const[de,ve]of Object.entries(ce))de.includes(B)&&ee(P,m,v,ve.callable,ve.delegationSelector)}function Y(P){return P=P.replace(Z,""),L[P]||P}const R={on(P,m,v,B){H(P,m,v,B,!1)},one(P,m,v,B){H(P,m,v,B,!0)},off(P,m,v,B){if(typeof m!="string"||!P)return;const[ce,de,ve]=xe(m,v,B),De=ve!==m,Be=k(P),Ze=Be[ve]||{},et=m.startsWith(".");if(de===void 0){if(et)for(const Ke of Object.keys(Be))se(P,Be,Ke,m.slice(1));for(const[Ke,bt]of Object.entries(Ze)){const dt=Ke.replace(O,"");De&&!m.includes(dt)||ee(P,Be,ve,bt.callable,bt.delegationSelector)}}else{if(!Object.keys(Ze).length)return;ee(P,Be,ve,de,ce?v:null)}},trigger(P,m,v){if(typeof m!="string"||!P)return null;const B=I();let ce=null,de=!0,ve=!0,De=!1;m!==Y(m)&&B&&(ce=B.Event(m,v),B(P).trigger(ce),de=!ce.isPropagationStopped(),ve=!ce.isImmediatePropagationStopped(),De=ce.isDefaultPrevented());const Be=_(new Event(m,{bubbles:de,cancelable:!0}),v);return De&&Be.preventDefault(),ve&&P.dispatchEvent(Be),Be.defaultPrevented&&ce&&ce.preventDefault(),Be}};function _(P,m={}){for(const[v,B]of Object.entries(m))try{P[v]=B}catch{Object.defineProperty(P,v,{configurable:!0,get:()=>B})}return P}function C(P){if(P==="true")return!0;if(P==="false")return!1;if(P===Number(P).toString())return Number(P);if(P===""||P==="null")return null;if(typeof P!="string")return P;try{return JSON.parse(decodeURIComponent(P))}catch{return P}}function z(P){return P.replace(/[A-Z]/g,m=>`-${m.toLowerCase()}`)}const K={setDataAttribute(P,m,v){P.setAttribute(`data-bs-${z(m)}`,v)},removeDataAttribute(P,m){P.removeAttribute(`data-bs-${z(m)}`)},getDataAttributes(P){if(!P)return{};const m={},v=Object.keys(P.dataset).filter(B=>B.startsWith("bs")&&!B.startsWith("bsConfig"));for(const B of v){let ce=B.replace(/^bs/,"");ce=ce.charAt(0).toLowerCase()+ce.slice(1),m[ce]=C(P.dataset[B])}return m},getDataAttribute:(P,m)=>C(P.getAttribute(`data-bs-${z(m)}`))};class F{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(m){return m=this._mergeConfigObj(m),m=this._configAfterMerge(m),this._typeCheckConfig(m),m}_configAfterMerge(m){return m}_mergeConfigObj(m,v){const B=l(v)?K.getDataAttribute(v,"config"):{};return{...this.constructor.Default,...typeof B=="object"?B:{},...l(v)?K.getDataAttributes(v):{},...typeof m=="object"?m:{}}}_typeCheckConfig(m,v=this.constructor.DefaultType){for(const[ce,de]of Object.entries(v)){const ve=m[ce],De=l(ve)?"element":(B=ve)==null?`${B}`:Object.prototype.toString.call(B).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(de).test(De))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${ce}" provided type "${De}" but expected type "${de}".`)}var B}}class Q extends F{constructor(m,v){super(),(m=c(m))&&(this._element=m,this._config=this._getConfig(v),s.set(this._element,this.constructor.DATA_KEY,this))}dispose(){s.remove(this._element,this.constructor.DATA_KEY),R.off(this._element,this.constructor.EVENT_KEY);for(const m of Object.getOwnPropertyNames(this))this[m]=null}_queueCallback(m,v,B=!0){j(m,v,B)}_getConfig(m){return m=this._mergeConfigObj(m,this._element),m=this._configAfterMerge(m),this._typeCheckConfig(m),m}static getInstance(m){return s.get(c(m),this.DATA_KEY)}static getOrCreateInstance(m,v={}){return this.getInstance(m)||new this(m,typeof v=="object"?v:null)}static get VERSION(){return"5.3.7"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(m){return`${m}${this.EVENT_KEY}`}}const oe=P=>{let m=P.getAttribute("data-bs-target");if(!m||m==="#"){let v=P.getAttribute("href");if(!v||!v.includes("#")&&!v.startsWith("."))return null;v.includes("#")&&!v.startsWith("#")&&(v=`#${v.split("#")[1]}`),m=v&&v!=="#"?v.trim():null}return m?m.split(",").map(v=>a(v)).join(","):null},E={find:(P,m=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(m,P)),findOne:(P,m=document.documentElement)=>Element.prototype.querySelector.call(m,P),children:(P,m)=>[].concat(...P.children).filter(v=>v.matches(m)),parents(P,m){const v=[];let B=P.parentNode.closest(m);for(;B;)v.push(B),B=B.parentNode.closest(m);return v},prev(P,m){let v=P.previousElementSibling;for(;v;){if(v.matches(m))return[v];v=v.previousElementSibling}return[]},next(P,m){let v=P.nextElementSibling;for(;v;){if(v.matches(m))return[v];v=v.nextElementSibling}return[]},focusableChildren(P){const m=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(v=>`${v}:not([tabindex^="-"])`).join(",");return this.find(m,P).filter(v=>!h(v)&&d(v))},getSelectorFromElement(P){const m=oe(P);return m&&E.findOne(m)?m:null},getElementFromSelector(P){const m=oe(P);return m?E.findOne(m):null},getMultipleElementsFromSelector(P){const m=oe(P);return m?E.find(m):[]}},te=(P,m="hide")=>{const v=`click.dismiss${P.EVENT_KEY}`,B=P.NAME;R.on(document,v,`[data-bs-dismiss="${B}"]`,function(ce){if(["A","AREA"].includes(this.tagName)&&ce.preventDefault(),h(this))return;const de=E.getElementFromSelector(this)||this.closest(`.${B}`);P.getOrCreateInstance(de)[m]()})},Te=".bs.alert",ze=`close${Te}`,We=`closed${Te}`;class at extends Q{static get NAME(){return"alert"}close(){if(R.trigger(this._element,ze).defaultPrevented)return;this._element.classList.remove("show");const m=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,m)}_destroyElement(){this._element.remove(),R.trigger(this._element,We),this.dispose()}static jQueryInterface(m){return this.each(function(){const v=at.getOrCreateInstance(this);if(typeof m=="string"){if(v[m]===void 0||m.startsWith("_")||m==="constructor")throw new TypeError(`No method named "${m}"`);v[m](this)}})}}te(at,"close"),g(at);const zt='[data-bs-toggle="button"]';class fe extends Q{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(m){return this.each(function(){const v=fe.getOrCreateInstance(this);m==="toggle"&&v[m]()})}}R.on(document,"click.bs.button.data-api",zt,P=>{P.preventDefault();const m=P.target.closest(zt);fe.getOrCreateInstance(m).toggle()}),g(fe);const Ce=".bs.swipe",Ne=`touchstart${Ce}`,He=`touchmove${Ce}`,Xe=`touchend${Ce}`,ot=`pointerdown${Ce}`,Fe=`pointerup${Ce}`,gt={endCallback:null,leftCallback:null,rightCallback:null},Pt={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class Yt extends F{constructor(m,v){super(),this._element=m,m&&Yt.isSupported()&&(this._config=this._getConfig(v),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return gt}static get DefaultType(){return Pt}static get NAME(){return"swipe"}dispose(){R.off(this._element,Ce)}_start(m){this._supportPointerEvents?this._eventIsPointerPenTouch(m)&&(this._deltaX=m.clientX):this._deltaX=m.touches[0].clientX}_end(m){this._eventIsPointerPenTouch(m)&&(this._deltaX=m.clientX-this._deltaX),this._handleSwipe(),N(this._config.endCallback)}_move(m){this._deltaX=m.touches&&m.touches.length>1?0:m.touches[0].clientX-this._deltaX}_handleSwipe(){const m=Math.abs(this._deltaX);if(m<=40)return;const v=m/this._deltaX;this._deltaX=0,v&&N(v>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(R.on(this._element,ot,m=>this._start(m)),R.on(this._element,Fe,m=>this._end(m)),this._element.classList.add("pointer-event")):(R.on(this._element,Ne,m=>this._start(m)),R.on(this._element,He,m=>this._move(m)),R.on(this._element,Xe,m=>this._end(m)))}_eventIsPointerPenTouch(m){return this._supportPointerEvents&&(m.pointerType==="pen"||m.pointerType==="touch")}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const Xt=".bs.carousel",Lt=".data-api",on="ArrowLeft",Bn="ArrowRight",In="next",qn="prev",Hn="left",w="right",X=`slide${Xt}`,ne=`slid${Xt}`,W=`keydown${Xt}`,ie=`mouseenter${Xt}`,Ee=`mouseleave${Xt}`,le=`dragstart${Xt}`,ge=`load${Xt}${Lt}`,_e=`click${Xt}${Lt}`,J="carousel",ae="active",je=".active",Se=".carousel-item",Ie=je+Se,Re={[on]:w,[Bn]:Hn},ye={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},ue={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class Me extends Q{constructor(m,v){super(m,v),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=E.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===J&&this.cycle()}static get Default(){return ye}static get DefaultType(){return ue}static get NAME(){return"carousel"}next(){this._slide(In)}nextWhenVisible(){!document.hidden&&d(this._element)&&this.next()}prev(){this._slide(qn)}pause(){this._isSliding&&o(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?R.one(this._element,ne,()=>this.cycle()):this.cycle())}to(m){const v=this._getItems();if(m>v.length-1||m<0)return;if(this._isSliding)return void R.one(this._element,ne,()=>this.to(m));const B=this._getItemIndex(this._getActive());if(B===m)return;const ce=m>B?In:qn;this._slide(ce,v[m])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(m){return m.defaultInterval=m.interval,m}_addEventListeners(){this._config.keyboard&&R.on(this._element,W,m=>this._keydown(m)),this._config.pause==="hover"&&(R.on(this._element,ie,()=>this.pause()),R.on(this._element,Ee,()=>this._maybeEnableCycle())),this._config.touch&&Yt.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const v of E.find(".carousel-item img",this._element))R.on(v,le,B=>B.preventDefault());const m={leftCallback:()=>this._slide(this._directionToOrder(Hn)),rightCallback:()=>this._slide(this._directionToOrder(w)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}};this._swipeHelper=new Yt(this._element,m)}_keydown(m){if(/input|textarea/i.test(m.target.tagName))return;const v=Re[m.key];v&&(m.preventDefault(),this._slide(this._directionToOrder(v)))}_getItemIndex(m){return this._getItems().indexOf(m)}_setActiveIndicatorElement(m){if(!this._indicatorsElement)return;const v=E.findOne(je,this._indicatorsElement);v.classList.remove(ae),v.removeAttribute("aria-current");const B=E.findOne(`[data-bs-slide-to="${m}"]`,this._indicatorsElement);B&&(B.classList.add(ae),B.setAttribute("aria-current","true"))}_updateInterval(){const m=this._activeElement||this._getActive();if(!m)return;const v=Number.parseInt(m.getAttribute("data-bs-interval"),10);this._config.interval=v||this._config.defaultInterval}_slide(m,v=null){if(this._isSliding)return;const B=this._getActive(),ce=m===In,de=v||V(this._getItems(),B,ce,this._config.wrap);if(de===B)return;const ve=this._getItemIndex(de),De=Ke=>R.trigger(this._element,Ke,{relatedTarget:de,direction:this._orderToDirection(m),from:this._getItemIndex(B),to:ve});if(De(X).defaultPrevented||!B||!de)return;const Be=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(ve),this._activeElement=de;const Ze=ce?"carousel-item-start":"carousel-item-end",et=ce?"carousel-item-next":"carousel-item-prev";de.classList.add(et),x(de),B.classList.add(Ze),de.classList.add(Ze),this._queueCallback(()=>{de.classList.remove(Ze,et),de.classList.add(ae),B.classList.remove(ae,et,Ze),this._isSliding=!1,De(ne)},B,this._isAnimated()),Be&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return E.findOne(Ie,this._element)}_getItems(){return E.find(Se,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(m){return A()?m===Hn?qn:In:m===Hn?In:qn}_orderToDirection(m){return A()?m===qn?Hn:w:m===qn?w:Hn}static jQueryInterface(m){return this.each(function(){const v=Me.getOrCreateInstance(this,m);if(typeof m!="number"){if(typeof m=="string"){if(v[m]===void 0||m.startsWith("_")||m==="constructor")throw new TypeError(`No method named "${m}"`);v[m]()}}else v.to(m)})}}R.on(document,_e,"[data-bs-slide], [data-bs-slide-to]",function(P){const m=E.getElementFromSelector(this);if(!m||!m.classList.contains(J))return;P.preventDefault();const v=Me.getOrCreateInstance(m),B=this.getAttribute("data-bs-slide-to");return B?(v.to(B),void v._maybeEnableCycle()):K.getDataAttribute(this,"slide")==="next"?(v.next(),void v._maybeEnableCycle()):(v.prev(),void v._maybeEnableCycle())}),R.on(window,ge,()=>{const P=E.find('[data-bs-ride="carousel"]');for(const m of P)Me.getOrCreateInstance(m)}),g(Me);const Pe=".bs.collapse",Le=`show${Pe}`,st=`shown${Pe}`,ke=`hide${Pe}`,Ve=`hidden${Pe}`,Tn=`click${Pe}.data-api`,Gn="show",Mn="collapse",bs="collapsing",Xs=`:scope .${Mn} .${Mn}`,sa='[data-bs-toggle="collapse"]',ku={parent:null,toggle:!0},Sc={parent:"(null|element)",toggle:"boolean"};class Js extends Q{constructor(m,v){super(m,v),this._isTransitioning=!1,this._triggerArray=[];const B=E.find(sa);for(const ce of B){const de=E.getSelectorFromElement(ce),ve=E.find(de).filter(De=>De===this._element);de!==null&&ve.length&&this._triggerArray.push(ce)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return ku}static get DefaultType(){return Sc}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let m=[];if(this._config.parent&&(m=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(ce=>ce!==this._element).map(ce=>Js.getOrCreateInstance(ce,{toggle:!1}))),m.length&&m[0]._isTransitioning||R.trigger(this._element,Le).defaultPrevented)return;for(const ce of m)ce.hide();const v=this._getDimension();this._element.classList.remove(Mn),this._element.classList.add(bs),this._element.style[v]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const B=`scroll${v[0].toUpperCase()+v.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(bs),this._element.classList.add(Mn,Gn),this._element.style[v]="",R.trigger(this._element,st)},this._element,!0),this._element.style[v]=`${this._element[B]}px`}hide(){if(this._isTransitioning||!this._isShown()||R.trigger(this._element,ke).defaultPrevented)return;const m=this._getDimension();this._element.style[m]=`${this._element.getBoundingClientRect()[m]}px`,x(this._element),this._element.classList.add(bs),this._element.classList.remove(Mn,Gn);for(const v of this._triggerArray){const B=E.getElementFromSelector(v);B&&!this._isShown(B)&&this._addAriaAndCollapsedClass([v],!1)}this._isTransitioning=!0,this._element.style[m]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(bs),this._element.classList.add(Mn),R.trigger(this._element,Ve)},this._element,!0)}_isShown(m=this._element){return m.classList.contains(Gn)}_configAfterMerge(m){return m.toggle=!!m.toggle,m.parent=c(m.parent),m}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const m=this._getFirstLevelChildren(sa);for(const v of m){const B=E.getElementFromSelector(v);B&&this._addAriaAndCollapsedClass([v],this._isShown(B))}}_getFirstLevelChildren(m){const v=E.find(Xs,this._config.parent);return E.find(m,this._config.parent).filter(B=>!v.includes(B))}_addAriaAndCollapsedClass(m,v){if(m.length)for(const B of m)B.classList.toggle("collapsed",!v),B.setAttribute("aria-expanded",v)}static jQueryInterface(m){const v={};return typeof m=="string"&&/show|hide/.test(m)&&(v.toggle=!1),this.each(function(){const B=Js.getOrCreateInstance(this,v);if(typeof m=="string"){if(B[m]===void 0)throw new TypeError(`No method named "${m}"`);B[m]()}})}}R.on(document,Tn,sa,function(P){(P.target.tagName==="A"||P.delegateTarget&&P.delegateTarget.tagName==="A")&&P.preventDefault();for(const m of E.getMultipleElementsFromSelector(this))Js.getOrCreateInstance(m,{toggle:!1}).toggle()}),g(Js);var ws="top",$s="bottom",Rs="right",ds="left",hl="auto",ra=[ws,$s,Rs,ds],ia="start",ci="end",Ou="clippingParents",ml="viewport",Br="popper",Ei="reference",fl=ra.reduce(function(P,m){return P.concat([m+"-"+ia,m+"-"+ci])},[]),Mu=[].concat(ra,[hl]).reduce(function(P,m){return P.concat([m,m+"-"+ia,m+"-"+ci])},[]),Lu="beforeRead",Fu="read",Uu="afterRead",Ic="beforeMain",Tc="main",Vu="afterMain",zu="beforeWrite",Tf="write",Cf="afterWrite",$u=[Lu,Fu,Uu,Ic,Tc,Vu,zu,Tf,Cf];function jr(P){return P?(P.nodeName||"").toLowerCase():null}function Zs(P){if(P==null)return window;if(P.toString()!=="[object Window]"){var m=P.ownerDocument;return m&&m.defaultView||window}return P}function er(P){return P instanceof Zs(P).Element||P instanceof Element}function Qn(P){return P instanceof Zs(P).HTMLElement||P instanceof HTMLElement}function Ja(P){return typeof ShadowRoot<"u"&&(P instanceof Zs(P).ShadowRoot||P instanceof ShadowRoot)}const Za={name:"applyStyles",enabled:!0,phase:"write",fn:function(P){var m=P.state;Object.keys(m.elements).forEach(function(v){var B=m.styles[v]||{},ce=m.attributes[v]||{},de=m.elements[v];Qn(de)&&jr(de)&&(Object.assign(de.style,B),Object.keys(ce).forEach(function(ve){var De=ce[ve];De===!1?de.removeAttribute(ve):de.setAttribute(ve,De===!0?"":De)}))})},effect:function(P){var m=P.state,v={popper:{position:m.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(m.elements.popper.style,v.popper),m.styles=v,m.elements.arrow&&Object.assign(m.elements.arrow.style,v.arrow),function(){Object.keys(m.elements).forEach(function(B){var ce=m.elements[B],de=m.attributes[B]||{},ve=Object.keys(m.styles.hasOwnProperty(B)?m.styles[B]:v[B]).reduce(function(De,Be){return De[Be]="",De},{});Qn(ce)&&jr(ce)&&(Object.assign(ce.style,ve),Object.keys(de).forEach(function(De){ce.removeAttribute(De)}))})}},requires:["computeStyles"]};function _r(P){return P.split("-")[0]}var Ft=Math.max,aa=Math.min,qr=Math.round;function oa(){var P=navigator.userAgentData;return P!=null&&P.brands&&Array.isArray(P.brands)?P.brands.map(function(m){return m.brand+"/"+m.version}).join(" "):navigator.userAgent}function Af(){return!/^((?!chrome|android).)*safari/i.test(oa())}function la(P,m,v){m===void 0&&(m=!1),v===void 0&&(v=!1);var B=P.getBoundingClientRect(),ce=1,de=1;m&&Qn(P)&&(ce=P.offsetWidth>0&&qr(B.width)/P.offsetWidth||1,de=P.offsetHeight>0&&qr(B.height)/P.offsetHeight||1);var ve=(er(P)?Zs(P):window).visualViewport,De=!Af()&&v,Be=(B.left+(De&&ve?ve.offsetLeft:0))/ce,Ze=(B.top+(De&&ve?ve.offsetTop:0))/de,et=B.width/ce,Ke=B.height/de;return{width:et,height:Ke,top:Ze,right:Be+et,bottom:Ze+Ke,left:Be,x:Be,y:Ze}}function Bu(P){var m=la(P),v=P.offsetWidth,B=P.offsetHeight;return Math.abs(m.width-v)<=1&&(v=m.width),Math.abs(m.height-B)<=1&&(B=m.height),{x:P.offsetLeft,y:P.offsetTop,width:v,height:B}}function Df(P,m){var v=m.getRootNode&&m.getRootNode();if(P.contains(m))return!0;if(v&&Ja(v)){var B=m;do{if(B&&P.isSameNode(B))return!0;B=B.parentNode||B.host}while(B)}return!1}function di(P){return Zs(P).getComputedStyle(P)}function dy(P){return["table","td","th"].indexOf(jr(P))>=0}function cr(P){return((er(P)?P.ownerDocument:P.document)||window.document).documentElement}function Er(P){return jr(P)==="html"?P:P.assignedSlot||P.parentNode||(Ja(P)?P.host:null)||cr(P)}function qu(P){return Qn(P)&&di(P).position!=="fixed"?P.offsetParent:null}function eo(P){for(var m=Zs(P),v=qu(P);v&&dy(v)&&di(v).position==="static";)v=qu(v);return v&&(jr(v)==="html"||jr(v)==="body"&&di(v).position==="static")?m:v||function(B){var ce=/firefox/i.test(oa());if(/Trident/i.test(oa())&&Qn(B)&&di(B).position==="fixed")return null;var de=Er(B);for(Ja(de)&&(de=de.host);Qn(de)&&["html","body"].indexOf(jr(de))<0;){var ve=di(de);if(ve.transform!=="none"||ve.perspective!=="none"||ve.contain==="paint"||["transform","perspective"].indexOf(ve.willChange)!==-1||ce&&ve.willChange==="filter"||ce&&ve.filter&&ve.filter!=="none")return de;de=de.parentNode}return null}(P)||m}function Cc(P){return["top","bottom"].indexOf(P)>=0?"x":"y"}function Hr(P,m,v){return Ft(P,aa(m,v))}function Rf(P){return Object.assign({},{top:0,right:0,bottom:0,left:0},P)}function Pf(P,m){return m.reduce(function(v,B){return v[B]=P,v},{})}const kf={name:"arrow",enabled:!0,phase:"main",fn:function(P){var m,v=P.state,B=P.name,ce=P.options,de=v.elements.arrow,ve=v.modifiersData.popperOffsets,De=_r(v.placement),Be=Cc(De),Ze=[ds,Rs].indexOf(De)>=0?"height":"width";if(de&&ve){var et=function(cn,en){return Rf(typeof(cn=typeof cn=="function"?cn(Object.assign({},en.rects,{placement:en.placement})):cn)!="number"?cn:Pf(cn,ra))}(ce.padding,v),Ke=Bu(de),bt=Be==="y"?ws:ds,dt=Be==="y"?$s:Rs,xt=v.rects.reference[Ze]+v.rects.reference[Be]-ve[Be]-v.rects.popper[Ze],mt=ve[Be]-v.rects.reference[Be],yt=eo(de),ln=yt?Be==="y"?yt.clientHeight||0:yt.clientWidth||0:0,yn=xt/2-mt/2,_t=et[bt],Bt=ln-Ke[Ze]-et[dt],wt=ln/2-Ke[Ze]/2+yn,Rt=Hr(_t,wt,Bt),Zt=Be;v.modifiersData[B]=((m={})[Zt]=Rt,m.centerOffset=Rt-wt,m)}},effect:function(P){var m=P.state,v=P.options.element,B=v===void 0?"[data-popper-arrow]":v;B!=null&&(typeof B!="string"||(B=m.elements.popper.querySelector(B)))&&Df(m.elements.popper,B)&&(m.elements.arrow=B)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function tr(P){return P.split("-")[1]}var uy={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Of(P){var m,v=P.popper,B=P.popperRect,ce=P.placement,de=P.variation,ve=P.offsets,De=P.position,Be=P.gpuAcceleration,Ze=P.adaptive,et=P.roundOffsets,Ke=P.isFixed,bt=ve.x,dt=bt===void 0?0:bt,xt=ve.y,mt=xt===void 0?0:xt,yt=typeof et=="function"?et({x:dt,y:mt}):{x:dt,y:mt};dt=yt.x,mt=yt.y;var ln=ve.hasOwnProperty("x"),yn=ve.hasOwnProperty("y"),_t=ds,Bt=ws,wt=window;if(Ze){var Rt=eo(v),Zt="clientHeight",cn="clientWidth";Rt===Zs(v)&&di(Rt=cr(v)).position!=="static"&&De==="absolute"&&(Zt="scrollHeight",cn="scrollWidth"),(ce===ws||(ce===ds||ce===Rs)&&de===ci)&&(Bt=$s,mt-=(Ke&&Rt===wt&&wt.visualViewport?wt.visualViewport.height:Rt[Zt])-B.height,mt*=Be?1:-1),ce!==ds&&(ce!==ws&&ce!==$s||de!==ci)||(_t=Rs,dt-=(Ke&&Rt===wt&&wt.visualViewport?wt.visualViewport.width:Rt[cn])-B.width,dt*=Be?1:-1)}var en,es=Object.assign({position:De},Ze&&uy),Sr=et===!0?function(hi,sr){var Qr=hi.x,Wr=hi.y,Wn=sr.devicePixelRatio||1;return{x:qr(Qr*Wn)/Wn||0,y:qr(Wr*Wn)/Wn||0}}({x:dt,y:mt},Zs(v)):{x:dt,y:mt};return dt=Sr.x,mt=Sr.y,Be?Object.assign({},es,((en={})[Bt]=yn?"0":"",en[_t]=ln?"0":"",en.transform=(wt.devicePixelRatio||1)<=1?"translate("+dt+"px, "+mt+"px)":"translate3d("+dt+"px, "+mt+"px, 0)",en)):Object.assign({},es,((m={})[Bt]=yn?mt+"px":"",m[_t]=ln?dt+"px":"",m.transform="",m))}const to={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(P){var m=P.state,v=P.options,B=v.gpuAcceleration,ce=B===void 0||B,de=v.adaptive,ve=de===void 0||de,De=v.roundOffsets,Be=De===void 0||De,Ze={placement:_r(m.placement),variation:tr(m.placement),popper:m.elements.popper,popperRect:m.rects.popper,gpuAcceleration:ce,isFixed:m.options.strategy==="fixed"};m.modifiersData.popperOffsets!=null&&(m.styles.popper=Object.assign({},m.styles.popper,Of(Object.assign({},Ze,{offsets:m.modifiersData.popperOffsets,position:m.options.strategy,adaptive:ve,roundOffsets:Be})))),m.modifiersData.arrow!=null&&(m.styles.arrow=Object.assign({},m.styles.arrow,Of(Object.assign({},Ze,{offsets:m.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:Be})))),m.attributes.popper=Object.assign({},m.attributes.popper,{"data-popper-placement":m.placement})},data:{}};var ca={passive:!0};const Ac={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(P){var m=P.state,v=P.instance,B=P.options,ce=B.scroll,de=ce===void 0||ce,ve=B.resize,De=ve===void 0||ve,Be=Zs(m.elements.popper),Ze=[].concat(m.scrollParents.reference,m.scrollParents.popper);return de&&Ze.forEach(function(et){et.addEventListener("scroll",v.update,ca)}),De&&Be.addEventListener("resize",v.update,ca),function(){de&&Ze.forEach(function(et){et.removeEventListener("scroll",v.update,ca)}),De&&Be.removeEventListener("resize",v.update,ca)}},data:{}};var pl={left:"right",right:"left",bottom:"top",top:"bottom"};function Si(P){return P.replace(/left|right|bottom|top/g,function(m){return pl[m]})}var Mf={start:"end",end:"start"};function Dc(P){return P.replace(/start|end/g,function(m){return Mf[m]})}function xn(P){var m=Zs(P);return{scrollLeft:m.pageXOffset,scrollTop:m.pageYOffset}}function Hu(P){return la(cr(P)).left+xn(P).scrollLeft}function Gu(P){var m=di(P),v=m.overflow,B=m.overflowX,ce=m.overflowY;return/auto|scroll|overlay|hidden/.test(v+ce+B)}function Qu(P){return["html","body","#document"].indexOf(jr(P))>=0?P.ownerDocument.body:Qn(P)&&Gu(P)?P:Qu(Er(P))}function no(P,m){var v;m===void 0&&(m=[]);var B=Qu(P),ce=B===((v=P.ownerDocument)==null?void 0:v.body),de=Zs(B),ve=ce?[de].concat(de.visualViewport||[],Gu(B)?B:[]):B,De=m.concat(ve);return ce?De:De.concat(no(Er(ve)))}function Rc(P){return Object.assign({},P,{left:P.x,top:P.y,right:P.x+P.width,bottom:P.y+P.height})}function gl(P,m,v){return m===ml?Rc(function(B,ce){var de=Zs(B),ve=cr(B),De=de.visualViewport,Be=ve.clientWidth,Ze=ve.clientHeight,et=0,Ke=0;if(De){Be=De.width,Ze=De.height;var bt=Af();(bt||!bt&&ce==="fixed")&&(et=De.offsetLeft,Ke=De.offsetTop)}return{width:Be,height:Ze,x:et+Hu(B),y:Ke}}(P,v)):er(m)?function(B,ce){var de=la(B,!1,ce==="fixed");return de.top=de.top+B.clientTop,de.left=de.left+B.clientLeft,de.bottom=de.top+B.clientHeight,de.right=de.left+B.clientWidth,de.width=B.clientWidth,de.height=B.clientHeight,de.x=de.left,de.y=de.top,de}(m,v):Rc(function(B){var ce,de=cr(B),ve=xn(B),De=(ce=B.ownerDocument)==null?void 0:ce.body,Be=Ft(de.scrollWidth,de.clientWidth,De?De.scrollWidth:0,De?De.clientWidth:0),Ze=Ft(de.scrollHeight,de.clientHeight,De?De.scrollHeight:0,De?De.clientHeight:0),et=-ve.scrollLeft+Hu(B),Ke=-ve.scrollTop;return di(De||de).direction==="rtl"&&(et+=Ft(de.clientWidth,De?De.clientWidth:0)-Be),{width:Be,height:Ze,x:et,y:Ke}}(cr(P)))}function Wu(P){var m,v=P.reference,B=P.element,ce=P.placement,de=ce?_r(ce):null,ve=ce?tr(ce):null,De=v.x+v.width/2-B.width/2,Be=v.y+v.height/2-B.height/2;switch(de){case ws:m={x:De,y:v.y-B.height};break;case $s:m={x:De,y:v.y+v.height};break;case Rs:m={x:v.x+v.width,y:Be};break;case ds:m={x:v.x-B.width,y:Be};break;default:m={x:v.x,y:v.y}}var Ze=de?Cc(de):null;if(Ze!=null){var et=Ze==="y"?"height":"width";switch(ve){case ia:m[Ze]=m[Ze]-(v[et]/2-B[et]/2);break;case ci:m[Ze]=m[Ze]+(v[et]/2-B[et]/2)}}return m}function Bs(P,m){m===void 0&&(m={});var v=m,B=v.placement,ce=B===void 0?P.placement:B,de=v.strategy,ve=de===void 0?P.strategy:de,De=v.boundary,Be=De===void 0?Ou:De,Ze=v.rootBoundary,et=Ze===void 0?ml:Ze,Ke=v.elementContext,bt=Ke===void 0?Br:Ke,dt=v.altBoundary,xt=dt!==void 0&&dt,mt=v.padding,yt=mt===void 0?0:mt,ln=Rf(typeof yt!="number"?yt:Pf(yt,ra)),yn=bt===Br?Ei:Br,_t=P.rects.popper,Bt=P.elements[xt?yn:bt],wt=function(sr,Qr,Wr,Wn){var Ti=Qr==="clippingParents"?function(fn){var rr=no(Er(fn)),Kr=["absolute","fixed"].indexOf(di(fn).position)>=0&&Qn(fn)?eo(fn):fn;return er(Kr)?rr.filter(function(oo){return er(oo)&&Df(oo,Kr)&&jr(oo)!=="body"}):[]}(sr):[].concat(Qr),Ci=[].concat(Ti,[Wr]),Uc=Ci[0],_s=Ci.reduce(function(fn,rr){var Kr=gl(sr,rr,Wn);return fn.top=Ft(Kr.top,fn.top),fn.right=aa(Kr.right,fn.right),fn.bottom=aa(Kr.bottom,fn.bottom),fn.left=Ft(Kr.left,fn.left),fn},gl(sr,Uc,Wn));return _s.width=_s.right-_s.left,_s.height=_s.bottom-_s.top,_s.x=_s.left,_s.y=_s.top,_s}(er(Bt)?Bt:Bt.contextElement||cr(P.elements.popper),Be,et,ve),Rt=la(P.elements.reference),Zt=Wu({reference:Rt,element:_t,placement:ce}),cn=Rc(Object.assign({},_t,Zt)),en=bt===Br?cn:Rt,es={top:wt.top-en.top+ln.top,bottom:en.bottom-wt.bottom+ln.bottom,left:wt.left-en.left+ln.left,right:en.right-wt.right+ln.right},Sr=P.modifiersData.offset;if(bt===Br&&Sr){var hi=Sr[ce];Object.keys(es).forEach(function(sr){var Qr=[Rs,$s].indexOf(sr)>=0?1:-1,Wr=[ws,$s].indexOf(sr)>=0?"y":"x";es[sr]+=hi[Wr]*Qr})}return es}function Lf(P,m){m===void 0&&(m={});var v=m,B=v.placement,ce=v.boundary,de=v.rootBoundary,ve=v.padding,De=v.flipVariations,Be=v.allowedAutoPlacements,Ze=Be===void 0?Mu:Be,et=tr(B),Ke=et?De?fl:fl.filter(function(xt){return tr(xt)===et}):ra,bt=Ke.filter(function(xt){return Ze.indexOf(xt)>=0});bt.length===0&&(bt=Ke);var dt=bt.reduce(function(xt,mt){return xt[mt]=Bs(P,{placement:mt,boundary:ce,rootBoundary:de,padding:ve})[_r(mt)],xt},{});return Object.keys(dt).sort(function(xt,mt){return dt[xt]-dt[mt]})}const Ff={name:"flip",enabled:!0,phase:"main",fn:function(P){var m=P.state,v=P.options,B=P.name;if(!m.modifiersData[B]._skip){for(var ce=v.mainAxis,de=ce===void 0||ce,ve=v.altAxis,De=ve===void 0||ve,Be=v.fallbackPlacements,Ze=v.padding,et=v.boundary,Ke=v.rootBoundary,bt=v.altBoundary,dt=v.flipVariations,xt=dt===void 0||dt,mt=v.allowedAutoPlacements,yt=m.options.placement,ln=_r(yt),yn=Be||(ln!==yt&&xt?function(fn){if(_r(fn)===hl)return[];var rr=Si(fn);return[Dc(fn),rr,Dc(rr)]}(yt):[Si(yt)]),_t=[yt].concat(yn).reduce(function(fn,rr){return fn.concat(_r(rr)===hl?Lf(m,{placement:rr,boundary:et,rootBoundary:Ke,padding:Ze,flipVariations:xt,allowedAutoPlacements:mt}):rr)},[]),Bt=m.rects.reference,wt=m.rects.popper,Rt=new Map,Zt=!0,cn=_t[0],en=0;en<_t.length;en++){var es=_t[en],Sr=_r(es),hi=tr(es)===ia,sr=[ws,$s].indexOf(Sr)>=0,Qr=sr?"width":"height",Wr=Bs(m,{placement:es,boundary:et,rootBoundary:Ke,altBoundary:bt,padding:Ze}),Wn=sr?hi?Rs:ds:hi?$s:ws;Bt[Qr]>wt[Qr]&&(Wn=Si(Wn));var Ti=Si(Wn),Ci=[];if(de&&Ci.push(Wr[Sr]<=0),De&&Ci.push(Wr[Wn]<=0,Wr[Ti]<=0),Ci.every(function(fn){return fn})){cn=es,Zt=!1;break}Rt.set(es,Ci)}if(Zt)for(var Uc=function(fn){var rr=_t.find(function(Kr){var oo=Rt.get(Kr);if(oo)return oo.slice(0,fn).every(function(Kf){return Kf})});if(rr)return cn=rr,"break"},_s=xt?3:1;_s>0&&Uc(_s)!=="break";_s--);m.placement!==cn&&(m.modifiersData[B]._skip=!0,m.placement=cn,m.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function so(P,m,v){return v===void 0&&(v={x:0,y:0}),{top:P.top-m.height-v.y,right:P.right-m.width+v.x,bottom:P.bottom-m.height+v.y,left:P.left-m.width-v.x}}function Ku(P){return[ws,Rs,$s,ds].some(function(m){return P[m]>=0})}const Pc={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(P){var m=P.state,v=P.name,B=m.rects.reference,ce=m.rects.popper,de=m.modifiersData.preventOverflow,ve=Bs(m,{elementContext:"reference"}),De=Bs(m,{altBoundary:!0}),Be=so(ve,B),Ze=so(De,ce,de),et=Ku(Be),Ke=Ku(Ze);m.modifiersData[v]={referenceClippingOffsets:Be,popperEscapeOffsets:Ze,isReferenceHidden:et,hasPopperEscaped:Ke},m.attributes.popper=Object.assign({},m.attributes.popper,{"data-popper-reference-hidden":et,"data-popper-escaped":Ke})}},xl={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(P){var m=P.state,v=P.options,B=P.name,ce=v.offset,de=ce===void 0?[0,0]:ce,ve=Mu.reduce(function(et,Ke){return et[Ke]=function(bt,dt,xt){var mt=_r(bt),yt=[ds,ws].indexOf(mt)>=0?-1:1,ln=typeof xt=="function"?xt(Object.assign({},dt,{placement:bt})):xt,yn=ln[0],_t=ln[1];return yn=yn||0,_t=(_t||0)*yt,[ds,Rs].indexOf(mt)>=0?{x:_t,y:yn}:{x:yn,y:_t}}(Ke,m.rects,de),et},{}),De=ve[m.placement],Be=De.x,Ze=De.y;m.modifiersData.popperOffsets!=null&&(m.modifiersData.popperOffsets.x+=Be,m.modifiersData.popperOffsets.y+=Ze),m.modifiersData[B]=ve}},kc={name:"popperOffsets",enabled:!0,phase:"read",fn:function(P){var m=P.state,v=P.name;m.modifiersData[v]=Wu({reference:m.rects.reference,element:m.rects.popper,placement:m.placement})},data:{}},yl={name:"preventOverflow",enabled:!0,phase:"main",fn:function(P){var m=P.state,v=P.options,B=P.name,ce=v.mainAxis,de=ce===void 0||ce,ve=v.altAxis,De=ve!==void 0&&ve,Be=v.boundary,Ze=v.rootBoundary,et=v.altBoundary,Ke=v.padding,bt=v.tether,dt=bt===void 0||bt,xt=v.tetherOffset,mt=xt===void 0?0:xt,yt=Bs(m,{boundary:Be,rootBoundary:Ze,padding:Ke,altBoundary:et}),ln=_r(m.placement),yn=tr(m.placement),_t=!yn,Bt=Cc(ln),wt=Bt==="x"?"y":"x",Rt=m.modifiersData.popperOffsets,Zt=m.rects.reference,cn=m.rects.popper,en=typeof mt=="function"?mt(Object.assign({},m.rects,{placement:m.placement})):mt,es=typeof en=="number"?{mainAxis:en,altAxis:en}:Object.assign({mainAxis:0,altAxis:0},en),Sr=m.modifiersData.offset?m.modifiersData.offset[m.placement]:null,hi={x:0,y:0};if(Rt){if(de){var sr,Qr=Bt==="y"?ws:ds,Wr=Bt==="y"?$s:Rs,Wn=Bt==="y"?"height":"width",Ti=Rt[Bt],Ci=Ti+yt[Qr],Uc=Ti-yt[Wr],_s=dt?-cn[Wn]/2:0,fn=yn===ia?Zt[Wn]:cn[Wn],rr=yn===ia?-cn[Wn]:-Zt[Wn],Kr=m.elements.arrow,oo=dt&&Kr?Bu(Kr):{width:0,height:0},Kf=m.modifiersData["arrow#persistent"]?m.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},Tj=Kf[Qr],Cj=Kf[Wr],Yf=Hr(0,Zt[Wn],oo[Wn]),nk=_t?Zt[Wn]/2-_s-Yf-Tj-es.mainAxis:fn-Yf-Tj-es.mainAxis,sk=_t?-Zt[Wn]/2+_s+Yf+Cj+es.mainAxis:rr+Yf+Cj+es.mainAxis,_y=m.elements.arrow&&eo(m.elements.arrow),rk=_y?Bt==="y"?_y.clientTop||0:_y.clientLeft||0:0,Aj=(sr=Sr==null?void 0:Sr[Bt])!=null?sr:0,ik=Ti+sk-Aj,Dj=Hr(dt?aa(Ci,Ti+nk-Aj-rk):Ci,Ti,dt?Ft(Uc,ik):Uc);Rt[Bt]=Dj,hi[Bt]=Dj-Ti}if(De){var Rj,ak=Bt==="x"?ws:ds,ok=Bt==="x"?$s:Rs,Il=Rt[wt],Xf=wt==="y"?"height":"width",Pj=Il+yt[ak],kj=Il-yt[ok],Ey=[ws,ds].indexOf(ln)!==-1,Oj=(Rj=Sr==null?void 0:Sr[wt])!=null?Rj:0,Mj=Ey?Pj:Il-Zt[Xf]-cn[Xf]-Oj+es.altAxis,Lj=Ey?Il+Zt[Xf]+cn[Xf]-Oj-es.altAxis:kj,Fj=dt&&Ey?function(lk,ck,Sy){var Uj=Hr(lk,ck,Sy);return Uj>Sy?Sy:Uj}(Mj,Il,Lj):Hr(dt?Mj:Pj,Il,dt?Lj:kj);Rt[wt]=Fj,hi[wt]=Fj-Il}m.modifiersData[B]=hi}},requiresIfExists:["offset"]};function hy(P,m,v){v===void 0&&(v=!1);var B,ce,de=Qn(m),ve=Qn(m)&&function(Ke){var bt=Ke.getBoundingClientRect(),dt=qr(bt.width)/Ke.offsetWidth||1,xt=qr(bt.height)/Ke.offsetHeight||1;return dt!==1||xt!==1}(m),De=cr(m),Be=la(P,ve,v),Ze={scrollLeft:0,scrollTop:0},et={x:0,y:0};return(de||!de&&!v)&&((jr(m)!=="body"||Gu(De))&&(Ze=(B=m)!==Zs(B)&&Qn(B)?{scrollLeft:(ce=B).scrollLeft,scrollTop:ce.scrollTop}:xn(B)),Qn(m)?((et=la(m,!0)).x+=m.clientLeft,et.y+=m.clientTop):De&&(et.x=Hu(De))),{x:Be.left+Ze.scrollLeft-et.x,y:Be.top+Ze.scrollTop-et.y,width:Be.width,height:Be.height}}function Uf(P){var m=new Map,v=new Set,B=[];function ce(de){v.add(de.name),[].concat(de.requires||[],de.requiresIfExists||[]).forEach(function(ve){if(!v.has(ve)){var De=m.get(ve);De&&ce(De)}}),B.push(de)}return P.forEach(function(de){m.set(de.name,de)}),P.forEach(function(de){v.has(de.name)||ce(de)}),B}var ro={placement:"bottom",modifiers:[],strategy:"absolute"};function Yu(){for(var P=arguments.length,m=new Array(P),v=0;v<P;v++)m[v]=arguments[v];return!m.some(function(B){return!(B&&typeof B.getBoundingClientRect=="function")})}function bl(P){P===void 0&&(P={});var m=P,v=m.defaultModifiers,B=v===void 0?[]:v,ce=m.defaultOptions,de=ce===void 0?ro:ce;return function(ve,De,Be){Be===void 0&&(Be=de);var Ze,et,Ke={placement:"bottom",orderedModifiers:[],options:Object.assign({},ro,de),modifiersData:{},elements:{reference:ve,popper:De},attributes:{},styles:{}},bt=[],dt=!1,xt={state:Ke,setOptions:function(yt){var ln=typeof yt=="function"?yt(Ke.options):yt;mt(),Ke.options=Object.assign({},de,Ke.options,ln),Ke.scrollParents={reference:er(ve)?no(ve):ve.contextElement?no(ve.contextElement):[],popper:no(De)};var yn,_t,Bt=function(wt){var Rt=Uf(wt);return $u.reduce(function(Zt,cn){return Zt.concat(Rt.filter(function(en){return en.phase===cn}))},[])}((yn=[].concat(B,Ke.options.modifiers),_t=yn.reduce(function(wt,Rt){var Zt=wt[Rt.name];return wt[Rt.name]=Zt?Object.assign({},Zt,Rt,{options:Object.assign({},Zt.options,Rt.options),data:Object.assign({},Zt.data,Rt.data)}):Rt,wt},{}),Object.keys(_t).map(function(wt){return _t[wt]})));return Ke.orderedModifiers=Bt.filter(function(wt){return wt.enabled}),Ke.orderedModifiers.forEach(function(wt){var Rt=wt.name,Zt=wt.options,cn=Zt===void 0?{}:Zt,en=wt.effect;if(typeof en=="function"){var es=en({state:Ke,name:Rt,instance:xt,options:cn});bt.push(es||function(){})}}),xt.update()},forceUpdate:function(){if(!dt){var yt=Ke.elements,ln=yt.reference,yn=yt.popper;if(Yu(ln,yn)){Ke.rects={reference:hy(ln,eo(yn),Ke.options.strategy==="fixed"),popper:Bu(yn)},Ke.reset=!1,Ke.placement=Ke.options.placement,Ke.orderedModifiers.forEach(function(en){return Ke.modifiersData[en.name]=Object.assign({},en.data)});for(var _t=0;_t<Ke.orderedModifiers.length;_t++)if(Ke.reset!==!0){var Bt=Ke.orderedModifiers[_t],wt=Bt.fn,Rt=Bt.options,Zt=Rt===void 0?{}:Rt,cn=Bt.name;typeof wt=="function"&&(Ke=wt({state:Ke,options:Zt,name:cn,instance:xt})||Ke)}else Ke.reset=!1,_t=-1}}},update:(Ze=function(){return new Promise(function(yt){xt.forceUpdate(),yt(Ke)})},function(){return et||(et=new Promise(function(yt){Promise.resolve().then(function(){et=void 0,yt(Ze())})})),et}),destroy:function(){mt(),dt=!0}};if(!Yu(ve,De))return xt;function mt(){bt.forEach(function(yt){return yt()}),bt=[]}return xt.setOptions(Be).then(function(yt){!dt&&Be.onFirstUpdate&&Be.onFirstUpdate(yt)}),xt}}var Xu=bl(),Ju=bl({defaultModifiers:[Ac,kc,to,Za]}),Oc=bl({defaultModifiers:[Ac,kc,to,Za,xl,Ff,yl,kf,Pc]});const wl=Object.freeze(Object.defineProperty({__proto__:null,afterMain:Vu,afterRead:Uu,afterWrite:Cf,applyStyles:Za,arrow:kf,auto:hl,basePlacements:ra,beforeMain:Ic,beforeRead:Lu,beforeWrite:zu,bottom:$s,clippingParents:Ou,computeStyles:to,createPopper:Oc,createPopperBase:Xu,createPopperLite:Ju,detectOverflow:Bs,end:ci,eventListeners:Ac,flip:Ff,hide:Pc,left:ds,main:Tc,modifierPhases:$u,offset:xl,placements:Mu,popper:Br,popperGenerator:bl,popperOffsets:kc,preventOverflow:yl,read:Fu,reference:Ei,right:Rs,start:ia,top:ws,variationPlacements:fl,viewport:ml,write:Tf},Symbol.toStringTag,{value:"Module"})),Zu="dropdown",Ii=".bs.dropdown",ui=".data-api",Vf="ArrowUp",eh="ArrowDown",zf=`hide${Ii}`,$f=`hidden${Ii}`,Mc=`show${Ii}`,nr=`shown${Ii}`,th=`click${Ii}${ui}`,nh=`keydown${Ii}${ui}`,io=`keyup${Ii}${ui}`,u="show",y='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',S=`${y}.${u}`,q=".dropdown-menu",me=A()?"top-end":"top-start",be=A()?"top-start":"top-end",$e=A()?"bottom-end":"bottom-start",Jt=A()?"bottom-start":"bottom-end",us=A()?"left-start":"right-start",kt=A()?"right-start":"left-start",vs={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Ns={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class js extends Q{constructor(m,v){super(m,v),this._popper=null,this._parent=this._element.parentNode,this._menu=E.next(this._element,q)[0]||E.prev(this._element,q)[0]||E.findOne(q,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return vs}static get DefaultType(){return Ns}static get NAME(){return Zu}toggle(){return this._isShown()?this.hide():this.show()}show(){if(h(this._element)||this._isShown())return;const m={relatedTarget:this._element};if(!R.trigger(this._element,Mc,m).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const v of[].concat(...document.body.children))R.on(v,"mouseover",p);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(u),this._element.classList.add(u),R.trigger(this._element,nr,m)}}hide(){if(h(this._element)||!this._isShown())return;const m={relatedTarget:this._element};this._completeHide(m)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(m){if(!R.trigger(this._element,zf,m).defaultPrevented){if("ontouchstart"in document.documentElement)for(const v of[].concat(...document.body.children))R.off(v,"mouseover",p);this._popper&&this._popper.destroy(),this._menu.classList.remove(u),this._element.classList.remove(u),this._element.setAttribute("aria-expanded","false"),K.removeDataAttribute(this._menu,"popper"),R.trigger(this._element,$f,m),this._element.focus()}}_getConfig(m){if(typeof(m=super._getConfig(m)).reference=="object"&&!l(m.reference)&&typeof m.reference.getBoundingClientRect!="function")throw new TypeError(`${Zu.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return m}_createPopper(){if(wl===void 0)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org/docs/v2/)");let m=this._element;this._config.reference==="parent"?m=this._parent:l(this._config.reference)?m=c(this._config.reference):typeof this._config.reference=="object"&&(m=this._config.reference);const v=this._getPopperConfig();this._popper=Oc(m,this._menu,v)}_isShown(){return this._menu.classList.contains(u)}_getPlacement(){const m=this._parent;if(m.classList.contains("dropend"))return us;if(m.classList.contains("dropstart"))return kt;if(m.classList.contains("dropup-center"))return"top";if(m.classList.contains("dropdown-center"))return"bottom";const v=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return m.classList.contains("dropup")?v?be:me:v?Jt:$e}_detectNavbar(){return this._element.closest(".navbar")!==null}_getOffset(){const{offset:m}=this._config;return typeof m=="string"?m.split(",").map(v=>Number.parseInt(v,10)):typeof m=="function"?v=>m(v,this._element):m}_getPopperConfig(){const m={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(K.setDataAttribute(this._menu,"popper","static"),m.modifiers=[{name:"applyStyles",enabled:!1}]),{...m,...N(this._config.popperConfig,[void 0,m])}}_selectMenuItem({key:m,target:v}){const B=E.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(ce=>d(ce));B.length&&V(B,v,m===eh,!B.includes(v)).focus()}static jQueryInterface(m){return this.each(function(){const v=js.getOrCreateInstance(this,m);if(typeof m=="string"){if(v[m]===void 0)throw new TypeError(`No method named "${m}"`);v[m]()}})}static clearMenus(m){if(m.button===2||m.type==="keyup"&&m.key!=="Tab")return;const v=E.find(S);for(const B of v){const ce=js.getInstance(B);if(!ce||ce._config.autoClose===!1)continue;const de=m.composedPath(),ve=de.includes(ce._menu);if(de.includes(ce._element)||ce._config.autoClose==="inside"&&!ve||ce._config.autoClose==="outside"&&ve||ce._menu.contains(m.target)&&(m.type==="keyup"&&m.key==="Tab"||/input|select|option|textarea|form/i.test(m.target.tagName)))continue;const De={relatedTarget:ce._element};m.type==="click"&&(De.clickEvent=m),ce._completeHide(De)}}static dataApiKeydownHandler(m){const v=/input|textarea/i.test(m.target.tagName),B=m.key==="Escape",ce=[Vf,eh].includes(m.key);if(!ce&&!B||v&&!B)return;m.preventDefault();const de=this.matches(y)?this:E.prev(this,y)[0]||E.next(this,y)[0]||E.findOne(y,m.delegateTarget.parentNode),ve=js.getOrCreateInstance(de);if(ce)return m.stopPropagation(),ve.show(),void ve._selectMenuItem(m);ve._isShown()&&(m.stopPropagation(),ve.hide(),de.focus())}}R.on(document,nh,y,js.dataApiKeydownHandler),R.on(document,nh,q,js.dataApiKeydownHandler),R.on(document,th,js.clearMenus),R.on(document,io,js.clearMenus),R.on(document,th,y,function(P){P.preventDefault(),js.getOrCreateInstance(this).toggle()}),g(js);const dr="backdrop",vl="show",Lc=`mousedown.bs.${dr}`,qR={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},HR={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class ZN extends F{constructor(m){super(),this._config=this._getConfig(m),this._isAppended=!1,this._element=null}static get Default(){return qR}static get DefaultType(){return HR}static get NAME(){return dr}show(m){if(!this._config.isVisible)return void N(m);this._append();const v=this._getElement();this._config.isAnimated&&x(v),v.classList.add(vl),this._emulateAnimation(()=>{N(m)})}hide(m){this._config.isVisible?(this._getElement().classList.remove(vl),this._emulateAnimation(()=>{this.dispose(),N(m)})):N(m)}dispose(){this._isAppended&&(R.off(this._element,Lc),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const m=document.createElement("div");m.className=this._config.className,this._config.isAnimated&&m.classList.add("fade"),this._element=m}return this._element}_configAfterMerge(m){return m.rootElement=c(m.rootElement),m}_append(){if(this._isAppended)return;const m=this._getElement();this._config.rootElement.append(m),R.on(m,Lc,()=>{N(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(m){j(m,this._getElement(),this._config.isAnimated)}}const Bf=".bs.focustrap",GR=`focusin${Bf}`,QR=`keydown.tab${Bf}`,ej="backward",WR={autofocus:!0,trapElement:null},KR={autofocus:"boolean",trapElement:"element"};class tj extends F{constructor(m){super(),this._config=this._getConfig(m),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return WR}static get DefaultType(){return KR}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),R.off(document,Bf),R.on(document,GR,m=>this._handleFocusin(m)),R.on(document,QR,m=>this._handleKeydown(m)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,R.off(document,Bf))}_handleFocusin(m){const{trapElement:v}=this._config;if(m.target===document||m.target===v||v.contains(m.target))return;const B=E.focusableChildren(v);B.length===0?v.focus():this._lastTabNavDirection===ej?B[B.length-1].focus():B[0].focus()}_handleKeydown(m){m.key==="Tab"&&(this._lastTabNavDirection=m.shiftKey?ej:"forward")}}const nj=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",sj=".sticky-top",qf="padding-right",rj="margin-right";class my{constructor(){this._element=document.body}getWidth(){const m=document.documentElement.clientWidth;return Math.abs(window.innerWidth-m)}hide(){const m=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,qf,v=>v+m),this._setElementAttributes(nj,qf,v=>v+m),this._setElementAttributes(sj,rj,v=>v-m)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,qf),this._resetElementAttributes(nj,qf),this._resetElementAttributes(sj,rj)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(m,v,B){const ce=this.getWidth();this._applyManipulationCallback(m,de=>{if(de!==this._element&&window.innerWidth>de.clientWidth+ce)return;this._saveInitialAttribute(de,v);const ve=window.getComputedStyle(de).getPropertyValue(v);de.style.setProperty(v,`${B(Number.parseFloat(ve))}px`)})}_saveInitialAttribute(m,v){const B=m.style.getPropertyValue(v);B&&K.setDataAttribute(m,v,B)}_resetElementAttributes(m,v){this._applyManipulationCallback(m,B=>{const ce=K.getDataAttribute(B,v);ce!==null?(K.removeDataAttribute(B,v),B.style.setProperty(v,ce)):B.style.removeProperty(v)})}_applyManipulationCallback(m,v){if(l(m))v(m);else for(const B of E.find(m,this._element))v(B)}}const Gr=".bs.modal",YR=`hide${Gr}`,XR=`hidePrevented${Gr}`,ij=`hidden${Gr}`,aj=`show${Gr}`,JR=`shown${Gr}`,ZR=`resize${Gr}`,eP=`click.dismiss${Gr}`,tP=`mousedown.dismiss${Gr}`,nP=`keydown.dismiss${Gr}`,sP=`click${Gr}.data-api`,oj="modal-open",lj="show",fy="modal-static",rP={backdrop:!0,focus:!0,keyboard:!0},iP={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Nl extends Q{constructor(m,v){super(m,v),this._dialog=E.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new my,this._addEventListeners()}static get Default(){return rP}static get DefaultType(){return iP}static get NAME(){return"modal"}toggle(m){return this._isShown?this.hide():this.show(m)}show(m){this._isShown||this._isTransitioning||R.trigger(this._element,aj,{relatedTarget:m}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(oj),this._adjustDialog(),this._backdrop.show(()=>this._showElement(m)))}hide(){this._isShown&&!this._isTransitioning&&(R.trigger(this._element,YR).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(lj),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){R.off(window,Gr),R.off(this._dialog,Gr),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new ZN({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new tj({trapElement:this._element})}_showElement(m){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const v=E.findOne(".modal-body",this._dialog);v&&(v.scrollTop=0),x(this._element),this._element.classList.add(lj),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,R.trigger(this._element,JR,{relatedTarget:m})},this._dialog,this._isAnimated())}_addEventListeners(){R.on(this._element,nP,m=>{m.key==="Escape"&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())}),R.on(window,ZR,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),R.on(this._element,tP,m=>{R.one(this._element,eP,v=>{this._element===m.target&&this._element===v.target&&(this._config.backdrop!=="static"?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(oj),this._resetAdjustments(),this._scrollBar.reset(),R.trigger(this._element,ij)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(R.trigger(this._element,XR).defaultPrevented)return;const m=this._element.scrollHeight>document.documentElement.clientHeight,v=this._element.style.overflowY;v==="hidden"||this._element.classList.contains(fy)||(m||(this._element.style.overflowY="hidden"),this._element.classList.add(fy),this._queueCallback(()=>{this._element.classList.remove(fy),this._queueCallback(()=>{this._element.style.overflowY=v},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const m=this._element.scrollHeight>document.documentElement.clientHeight,v=this._scrollBar.getWidth(),B=v>0;if(B&&!m){const ce=A()?"paddingLeft":"paddingRight";this._element.style[ce]=`${v}px`}if(!B&&m){const ce=A()?"paddingRight":"paddingLeft";this._element.style[ce]=`${v}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(m,v){return this.each(function(){const B=Nl.getOrCreateInstance(this,m);if(typeof m=="string"){if(B[m]===void 0)throw new TypeError(`No method named "${m}"`);B[m](v)}})}}R.on(document,sP,'[data-bs-toggle="modal"]',function(P){const m=E.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&P.preventDefault(),R.one(m,aj,B=>{B.defaultPrevented||R.one(m,ij,()=>{d(this)&&this.focus()})});const v=E.findOne(".modal.show");v&&Nl.getInstance(v).hide(),Nl.getOrCreateInstance(m).toggle(this)}),te(Nl),g(Nl);const da=".bs.offcanvas",cj=".data-api",aP=`load${da}${cj}`,dj="show",uj="showing",hj="hiding",mj=".offcanvas.show",oP=`show${da}`,lP=`shown${da}`,cP=`hide${da}`,fj=`hidePrevented${da}`,pj=`hidden${da}`,dP=`resize${da}`,uP=`click${da}${cj}`,hP=`keydown.dismiss${da}`,mP={backdrop:!0,keyboard:!0,scroll:!1},fP={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class ua extends Q{constructor(m,v){super(m,v),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return mP}static get DefaultType(){return fP}static get NAME(){return"offcanvas"}toggle(m){return this._isShown?this.hide():this.show(m)}show(m){this._isShown||R.trigger(this._element,oP,{relatedTarget:m}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||new my().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(uj),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(dj),this._element.classList.remove(uj),R.trigger(this._element,lP,{relatedTarget:m})},this._element,!0))}hide(){this._isShown&&(R.trigger(this._element,cP).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(hj),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(dj,hj),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new my().reset(),R.trigger(this._element,pj)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const m=!!this._config.backdrop;return new ZN({className:"offcanvas-backdrop",isVisible:m,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:m?()=>{this._config.backdrop!=="static"?this.hide():R.trigger(this._element,fj)}:null})}_initializeFocusTrap(){return new tj({trapElement:this._element})}_addEventListeners(){R.on(this._element,hP,m=>{m.key==="Escape"&&(this._config.keyboard?this.hide():R.trigger(this._element,fj))})}static jQueryInterface(m){return this.each(function(){const v=ua.getOrCreateInstance(this,m);if(typeof m=="string"){if(v[m]===void 0||m.startsWith("_")||m==="constructor")throw new TypeError(`No method named "${m}"`);v[m](this)}})}}R.on(document,uP,'[data-bs-toggle="offcanvas"]',function(P){const m=E.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&P.preventDefault(),h(this))return;R.one(m,pj,()=>{d(this)&&this.focus()});const v=E.findOne(mj);v&&v!==m&&ua.getInstance(v).hide(),ua.getOrCreateInstance(m).toggle(this)}),R.on(window,aP,()=>{for(const P of E.find(mj))ua.getOrCreateInstance(P).show()}),R.on(window,dP,()=>{for(const P of E.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(P).position!=="fixed"&&ua.getOrCreateInstance(P).hide()}),te(ua),g(ua);const gj={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},pP=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),gP=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,xP=(P,m)=>{const v=P.nodeName.toLowerCase();return m.includes(v)?!pP.has(v)||!!gP.test(P.nodeValue):m.filter(B=>B instanceof RegExp).some(B=>B.test(v))},yP={allowList:gj,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},bP={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},wP={entry:"(string|element|function|null)",selector:"(string|element)"};class vP extends F{constructor(m){super(),this._config=this._getConfig(m)}static get Default(){return yP}static get DefaultType(){return bP}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(m=>this._resolvePossibleFunction(m)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(m){return this._checkContent(m),this._config.content={...this._config.content,...m},this}toHtml(){const m=document.createElement("div");m.innerHTML=this._maybeSanitize(this._config.template);for(const[ce,de]of Object.entries(this._config.content))this._setContent(m,de,ce);const v=m.children[0],B=this._resolvePossibleFunction(this._config.extraClass);return B&&v.classList.add(...B.split(" ")),v}_typeCheckConfig(m){super._typeCheckConfig(m),this._checkContent(m.content)}_checkContent(m){for(const[v,B]of Object.entries(m))super._typeCheckConfig({selector:v,entry:B},wP)}_setContent(m,v,B){const ce=E.findOne(B,m);ce&&((v=this._resolvePossibleFunction(v))?l(v)?this._putElementInTemplate(c(v),ce):this._config.html?ce.innerHTML=this._maybeSanitize(v):ce.textContent=v:ce.remove())}_maybeSanitize(m){return this._config.sanitize?function(v,B,ce){if(!v.length)return v;if(ce&&typeof ce=="function")return ce(v);const de=new window.DOMParser().parseFromString(v,"text/html"),ve=[].concat(...de.body.querySelectorAll("*"));for(const De of ve){const Be=De.nodeName.toLowerCase();if(!Object.keys(B).includes(Be)){De.remove();continue}const Ze=[].concat(...De.attributes),et=[].concat(B["*"]||[],B[Be]||[]);for(const Ke of Ze)xP(Ke,et)||De.removeAttribute(Ke.nodeName)}return de.body.innerHTML}(m,this._config.allowList,this._config.sanitizeFn):m}_resolvePossibleFunction(m){return N(m,[void 0,this])}_putElementInTemplate(m,v){if(this._config.html)return v.innerHTML="",void v.append(m);v.textContent=m.textContent}}const NP=new Set(["sanitize","allowList","sanitizeFn"]),py="fade",Hf="show",jP=".tooltip-inner",xj=".modal",yj="hide.bs.modal",sh="hover",gy="focus",xy="click",_P={AUTO:"auto",TOP:"top",RIGHT:A()?"left":"right",BOTTOM:"bottom",LEFT:A()?"right":"left"},EP={allowList:gj,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},SP={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class jl extends Q{constructor(m,v){if(wl===void 0)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org/docs/v2/)");super(m,v),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return EP}static get DefaultType(){return SP}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),R.off(this._element.closest(xj),yj,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const m=R.trigger(this._element,this.constructor.eventName("show")),v=(f(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(m.defaultPrevented||!v)return;this._disposePopper();const B=this._getTipElement();this._element.setAttribute("aria-describedby",B.getAttribute("id"));const{container:ce}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(ce.append(B),R.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(B),B.classList.add(Hf),"ontouchstart"in document.documentElement)for(const de of[].concat(...document.body.children))R.on(de,"mouseover",p);this._queueCallback(()=>{R.trigger(this._element,this.constructor.eventName("shown")),this._isHovered===!1&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!R.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(Hf),"ontouchstart"in document.documentElement)for(const m of[].concat(...document.body.children))R.off(m,"mouseover",p);this._activeTrigger[xy]=!1,this._activeTrigger[gy]=!1,this._activeTrigger[sh]=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),R.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(m){const v=this._getTemplateFactory(m).toHtml();if(!v)return null;v.classList.remove(py,Hf),v.classList.add(`bs-${this.constructor.NAME}-auto`);const B=(ce=>{do ce+=Math.floor(1e6*Math.random());while(document.getElementById(ce));return ce})(this.constructor.NAME).toString();return v.setAttribute("id",B),this._isAnimated()&&v.classList.add(py),v}setContent(m){this._newContent=m,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(m){return this._templateFactory?this._templateFactory.changeContent(m):this._templateFactory=new vP({...this._config,content:m,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[jP]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(m){return this.constructor.getOrCreateInstance(m.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(py)}_isShown(){return this.tip&&this.tip.classList.contains(Hf)}_createPopper(m){const v=N(this._config.placement,[this,m,this._element]),B=_P[v.toUpperCase()];return Oc(this._element,m,this._getPopperConfig(B))}_getOffset(){const{offset:m}=this._config;return typeof m=="string"?m.split(",").map(v=>Number.parseInt(v,10)):typeof m=="function"?v=>m(v,this._element):m}_resolvePossibleFunction(m){return N(m,[this._element,this._element])}_getPopperConfig(m){const v={placement:m,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:B=>{this._getTipElement().setAttribute("data-popper-placement",B.state.placement)}}]};return{...v,...N(this._config.popperConfig,[void 0,v])}}_setListeners(){const m=this._config.trigger.split(" ");for(const v of m)if(v==="click")R.on(this._element,this.constructor.eventName("click"),this._config.selector,B=>{const ce=this._initializeOnDelegatedTarget(B);ce._activeTrigger[xy]=!(ce._isShown()&&ce._activeTrigger[xy]),ce.toggle()});else if(v!=="manual"){const B=v===sh?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),ce=v===sh?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");R.on(this._element,B,this._config.selector,de=>{const ve=this._initializeOnDelegatedTarget(de);ve._activeTrigger[de.type==="focusin"?gy:sh]=!0,ve._enter()}),R.on(this._element,ce,this._config.selector,de=>{const ve=this._initializeOnDelegatedTarget(de);ve._activeTrigger[de.type==="focusout"?gy:sh]=ve._element.contains(de.relatedTarget),ve._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},R.on(this._element.closest(xj),yj,this._hideModalHandler)}_fixTitle(){const m=this._element.getAttribute("title");m&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",m),this._element.setAttribute("data-bs-original-title",m),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(m,v){clearTimeout(this._timeout),this._timeout=setTimeout(m,v)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(m){const v=K.getDataAttributes(this._element);for(const B of Object.keys(v))NP.has(B)&&delete v[B];return m={...v,...typeof m=="object"&&m?m:{}},m=this._mergeConfigObj(m),m=this._configAfterMerge(m),this._typeCheckConfig(m),m}_configAfterMerge(m){return m.container=m.container===!1?document.body:c(m.container),typeof m.delay=="number"&&(m.delay={show:m.delay,hide:m.delay}),typeof m.title=="number"&&(m.title=m.title.toString()),typeof m.content=="number"&&(m.content=m.content.toString()),m}_getDelegateConfig(){const m={};for(const[v,B]of Object.entries(this._config))this.constructor.Default[v]!==B&&(m[v]=B);return m.selector=!1,m.trigger="manual",m}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(m){return this.each(function(){const v=jl.getOrCreateInstance(this,m);if(typeof m=="string"){if(v[m]===void 0)throw new TypeError(`No method named "${m}"`);v[m]()}})}}g(jl);const IP=".popover-header",TP=".popover-body",CP={...jl.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},AP={...jl.DefaultType,content:"(null|string|element|function)"};class Gf extends jl{static get Default(){return CP}static get DefaultType(){return AP}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[IP]:this._getTitle(),[TP]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(m){return this.each(function(){const v=Gf.getOrCreateInstance(this,m);if(typeof m=="string"){if(v[m]===void 0)throw new TypeError(`No method named "${m}"`);v[m]()}})}}g(Gf);const yy=".bs.scrollspy",DP=`activate${yy}`,bj=`click${yy}`,RP=`load${yy}.data-api`,Fc="active",by="[href]",wj=".nav-link",PP=`${wj}, .nav-item > ${wj}, .list-group-item`,kP={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},OP={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class rh extends Q{constructor(m,v){super(m,v),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return kP}static get DefaultType(){return OP}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const m of this._observableSections.values())this._observer.observe(m)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(m){return m.target=c(m.target)||document.body,m.rootMargin=m.offset?`${m.offset}px 0px -30%`:m.rootMargin,typeof m.threshold=="string"&&(m.threshold=m.threshold.split(",").map(v=>Number.parseFloat(v))),m}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(R.off(this._config.target,bj),R.on(this._config.target,bj,by,m=>{const v=this._observableSections.get(m.target.hash);if(v){m.preventDefault();const B=this._rootElement||window,ce=v.offsetTop-this._element.offsetTop;if(B.scrollTo)return void B.scrollTo({top:ce,behavior:"smooth"});B.scrollTop=ce}}))}_getNewObserver(){const m={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(v=>this._observerCallback(v),m)}_observerCallback(m){const v=ve=>this._targetLinks.get(`#${ve.target.id}`),B=ve=>{this._previousScrollData.visibleEntryTop=ve.target.offsetTop,this._process(v(ve))},ce=(this._rootElement||document.documentElement).scrollTop,de=ce>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=ce;for(const ve of m){if(!ve.isIntersecting){this._activeTarget=null,this._clearActiveClass(v(ve));continue}const De=ve.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(de&&De){if(B(ve),!ce)return}else de||De||B(ve)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const m=E.find(by,this._config.target);for(const v of m){if(!v.hash||h(v))continue;const B=E.findOne(decodeURI(v.hash),this._element);d(B)&&(this._targetLinks.set(decodeURI(v.hash),v),this._observableSections.set(v.hash,B))}}_process(m){this._activeTarget!==m&&(this._clearActiveClass(this._config.target),this._activeTarget=m,m.classList.add(Fc),this._activateParents(m),R.trigger(this._element,DP,{relatedTarget:m}))}_activateParents(m){if(m.classList.contains("dropdown-item"))E.findOne(".dropdown-toggle",m.closest(".dropdown")).classList.add(Fc);else for(const v of E.parents(m,".nav, .list-group"))for(const B of E.prev(v,PP))B.classList.add(Fc)}_clearActiveClass(m){m.classList.remove(Fc);const v=E.find(`${by}.${Fc}`,m);for(const B of v)B.classList.remove(Fc)}static jQueryInterface(m){return this.each(function(){const v=rh.getOrCreateInstance(this,m);if(typeof m=="string"){if(v[m]===void 0||m.startsWith("_")||m==="constructor")throw new TypeError(`No method named "${m}"`);v[m]()}})}}R.on(window,RP,()=>{for(const P of E.find('[data-bs-spy="scroll"]'))rh.getOrCreateInstance(P)}),g(rh);const _l=".bs.tab",MP=`hide${_l}`,LP=`hidden${_l}`,FP=`show${_l}`,UP=`shown${_l}`,VP=`click${_l}`,zP=`keydown${_l}`,$P=`load${_l}`,BP="ArrowLeft",vj="ArrowRight",qP="ArrowUp",Nj="ArrowDown",wy="Home",jj="End",El="active",_j="fade",vy="show",Ej=".dropdown-toggle",Ny=`:not(${Ej})`,Sj='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',jy=`.nav-link${Ny}, .list-group-item${Ny}, [role="tab"]${Ny}, ${Sj}`,HP=`.${El}[data-bs-toggle="tab"], .${El}[data-bs-toggle="pill"], .${El}[data-bs-toggle="list"]`;class Sl extends Q{constructor(m){super(m),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),R.on(this._element,zP,v=>this._keydown(v)))}static get NAME(){return"tab"}show(){const m=this._element;if(this._elemIsActive(m))return;const v=this._getActiveElem(),B=v?R.trigger(v,MP,{relatedTarget:m}):null;R.trigger(m,FP,{relatedTarget:v}).defaultPrevented||B&&B.defaultPrevented||(this._deactivate(v,m),this._activate(m,v))}_activate(m,v){m&&(m.classList.add(El),this._activate(E.getElementFromSelector(m)),this._queueCallback(()=>{m.getAttribute("role")==="tab"?(m.removeAttribute("tabindex"),m.setAttribute("aria-selected",!0),this._toggleDropDown(m,!0),R.trigger(m,UP,{relatedTarget:v})):m.classList.add(vy)},m,m.classList.contains(_j)))}_deactivate(m,v){m&&(m.classList.remove(El),m.blur(),this._deactivate(E.getElementFromSelector(m)),this._queueCallback(()=>{m.getAttribute("role")==="tab"?(m.setAttribute("aria-selected",!1),m.setAttribute("tabindex","-1"),this._toggleDropDown(m,!1),R.trigger(m,LP,{relatedTarget:v})):m.classList.remove(vy)},m,m.classList.contains(_j)))}_keydown(m){if(![BP,vj,qP,Nj,wy,jj].includes(m.key))return;m.stopPropagation(),m.preventDefault();const v=this._getChildren().filter(ce=>!h(ce));let B;if([wy,jj].includes(m.key))B=v[m.key===wy?0:v.length-1];else{const ce=[vj,Nj].includes(m.key);B=V(v,m.target,ce,!0)}B&&(B.focus({preventScroll:!0}),Sl.getOrCreateInstance(B).show())}_getChildren(){return E.find(jy,this._parent)}_getActiveElem(){return this._getChildren().find(m=>this._elemIsActive(m))||null}_setInitialAttributes(m,v){this._setAttributeIfNotExists(m,"role","tablist");for(const B of v)this._setInitialAttributesOnChild(B)}_setInitialAttributesOnChild(m){m=this._getInnerElement(m);const v=this._elemIsActive(m),B=this._getOuterElement(m);m.setAttribute("aria-selected",v),B!==m&&this._setAttributeIfNotExists(B,"role","presentation"),v||m.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(m,"role","tab"),this._setInitialAttributesOnTargetPanel(m)}_setInitialAttributesOnTargetPanel(m){const v=E.getElementFromSelector(m);v&&(this._setAttributeIfNotExists(v,"role","tabpanel"),m.id&&this._setAttributeIfNotExists(v,"aria-labelledby",`${m.id}`))}_toggleDropDown(m,v){const B=this._getOuterElement(m);if(!B.classList.contains("dropdown"))return;const ce=(de,ve)=>{const De=E.findOne(de,B);De&&De.classList.toggle(ve,v)};ce(Ej,El),ce(".dropdown-menu",vy),B.setAttribute("aria-expanded",v)}_setAttributeIfNotExists(m,v,B){m.hasAttribute(v)||m.setAttribute(v,B)}_elemIsActive(m){return m.classList.contains(El)}_getInnerElement(m){return m.matches(jy)?m:E.findOne(jy,m)}_getOuterElement(m){return m.closest(".nav-item, .list-group-item")||m}static jQueryInterface(m){return this.each(function(){const v=Sl.getOrCreateInstance(this);if(typeof m=="string"){if(v[m]===void 0||m.startsWith("_")||m==="constructor")throw new TypeError(`No method named "${m}"`);v[m]()}})}}R.on(document,VP,Sj,function(P){["A","AREA"].includes(this.tagName)&&P.preventDefault(),h(this)||Sl.getOrCreateInstance(this).show()}),R.on(window,$P,()=>{for(const P of E.find(HP))Sl.getOrCreateInstance(P)}),g(Sl);const ao=".bs.toast",GP=`mouseover${ao}`,QP=`mouseout${ao}`,WP=`focusin${ao}`,KP=`focusout${ao}`,YP=`hide${ao}`,XP=`hidden${ao}`,JP=`show${ao}`,ZP=`shown${ao}`,Ij="hide",Qf="show",Wf="showing",ek={animation:"boolean",autohide:"boolean",delay:"number"},tk={animation:!0,autohide:!0,delay:5e3};class ih extends Q{constructor(m,v){super(m,v),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return tk}static get DefaultType(){return ek}static get NAME(){return"toast"}show(){R.trigger(this._element,JP).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(Ij),x(this._element),this._element.classList.add(Qf,Wf),this._queueCallback(()=>{this._element.classList.remove(Wf),R.trigger(this._element,ZP),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(R.trigger(this._element,YP).defaultPrevented||(this._element.classList.add(Wf),this._queueCallback(()=>{this._element.classList.add(Ij),this._element.classList.remove(Wf,Qf),R.trigger(this._element,XP)},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(Qf),super.dispose()}isShown(){return this._element.classList.contains(Qf)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(m,v){switch(m.type){case"mouseover":case"mouseout":this._hasMouseInteraction=v;break;case"focusin":case"focusout":this._hasKeyboardInteraction=v}if(v)return void this._clearTimeout();const B=m.relatedTarget;this._element===B||this._element.contains(B)||this._maybeScheduleHide()}_setListeners(){R.on(this._element,GP,m=>this._onInteraction(m,!0)),R.on(this._element,QP,m=>this._onInteraction(m,!1)),R.on(this._element,WP,m=>this._onInteraction(m,!0)),R.on(this._element,KP,m=>this._onInteraction(m,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(m){return this.each(function(){const v=ih.getOrCreateInstance(this,m);if(typeof m=="string"){if(v[m]===void 0)throw new TypeError(`No method named "${m}"`);v[m](this)}})}}return te(ih),g(ih),{Alert:at,Button:fe,Carousel:Me,Collapse:Js,Dropdown:js,Modal:Nl,Offcanvas:ua,Popover:Gf,ScrollSpy:rh,Tab:Sl,Toast:ih,Tooltip:jl}})})(pB);console.log(" Starting application...");window.addEventListener("error",n=>{console.error("Global error:",n.error)});window.addEventListener("unhandledrejection",n=>{if(n.reason&&n.reason.message){const e=n.reason.message;if(e.includes("Document not found")||e.includes("   usersettings")||e.includes("UserSettingsService")||e.includes("_getRecaptchaConfig")||e.includes("client is offline")||e.includes("auth/network-request-failed")){console.log(" Suppressed non-critical Firebase error:",e),n.preventDefault();return}}console.error("Unhandled promise rejection:",n.reason)});console.log(" React imported");class gB extends FI.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Error boundary caught:",e,t)}render(){var e;return this.state.hasError?r.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",fontFamily:"Arial",background:"#f8f9fa"},children:r.jsxs("div",{style:{textAlign:"center",padding:"40px",background:"white",borderRadius:"8px",boxShadow:"0 2px 10px rgba(0,0,0,0.1)",maxWidth:"500px"},children:[r.jsx("h2",{style:{color:"#dc3545"},children:"  "}),r.jsx("p",{style:{color:"#666",margin:"20px 0"},children:"   .    ."}),r.jsx("button",{onClick:()=>window.location.reload(),style:{padding:"12px 24px",background:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"16px"},children:" "}),r.jsxs("details",{style:{marginTop:"20px",textAlign:"left"},children:[r.jsx("summary",{style:{cursor:"pointer",color:"#666"},children:" "}),r.jsx("pre",{style:{background:"#f8f9fa",padding:"10px",borderRadius:"4px",fontSize:"12px",overflow:"auto",maxHeight:"200px"},children:(e=this.state.error)==null?void 0:e.toString()})]})]})}):this.props.children}}try{console.log("Loading core modules...")}catch(n){console.error("Import error:",n)}console.log(" All modules loaded");console.log(" Skipping dev utilities for stability");try{console.log("Creating React root...");const n=document.getElementById("root");if(!n)throw new Error("Root element not found");const e=cL.createRoot(n);console.log(" React root created"),console.log("Rendering application..."),e.render(r.jsx(gB,{children:r.jsx(fB,{})})),console.log(" Application rendered successfully")}catch(n){console.error("Critical rendering error:",n),document.body.innerHTML=`
    <div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-family: Arial;">
      <div style="text-align: center; padding: 40px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <h2 style="color: #dc3545;">   </h2>
        <p style="color: #666;">   : ${n.message}</p>
        <button onclick="window.location.reload()" style="padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
           
        </button>
      </div>
    </div>
  `}
