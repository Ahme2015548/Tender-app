var w_=Object.defineProperty;var v_=(n,e,s)=>e in n?w_(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s;var Ys=(n,e,s)=>v_(n,typeof e!="symbol"?e+"":e,s);function N_(n,e){for(var s=0;s<e.length;s++){const r=e[s];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const a=Object.getOwnPropertyDescriptor(r,i);a&&Object.defineProperty(n,i,a.get?a:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=s(i);fetch(i.href,a)}})();var j_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function S_(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var sS={exports:{}},tf={},nS={exports:{}},ms={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bh=Symbol.for("react.element"),E_=Symbol.for("react.portal"),C_=Symbol.for("react.fragment"),I_=Symbol.for("react.strict_mode"),T_=Symbol.for("react.profiler"),A_=Symbol.for("react.provider"),__=Symbol.for("react.context"),R_=Symbol.for("react.forward_ref"),D_=Symbol.for("react.suspense"),P_=Symbol.for("react.memo"),k_=Symbol.for("react.lazy"),_w=Symbol.iterator;function L_(n){return n===null||typeof n!="object"?null:(n=_w&&n[_w]||n["@@iterator"],typeof n=="function"?n:null)}var rS={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},iS=Object.assign,aS={};function pd(n,e,s){this.props=n,this.context=e,this.refs=aS,this.updater=s||rS}pd.prototype.isReactComponent={};pd.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};pd.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function oS(){}oS.prototype=pd.prototype;function Fy(n,e,s){this.props=n,this.context=e,this.refs=aS,this.updater=s||rS}var Oy=Fy.prototype=new oS;Oy.constructor=Fy;iS(Oy,pd.prototype);Oy.isPureReactComponent=!0;var Rw=Array.isArray,lS=Object.prototype.hasOwnProperty,My={current:null},cS={key:!0,ref:!0,__self:!0,__source:!0};function dS(n,e,s){var r,i={},a=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(a=""+e.key),e)lS.call(e,r)&&!cS.hasOwnProperty(r)&&(i[r]=e[r]);var l=arguments.length-2;if(l===1)i.children=s;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];i.children=c}if(n&&n.defaultProps)for(r in l=n.defaultProps,l)i[r]===void 0&&(i[r]=l[r]);return{$$typeof:bh,type:n,key:a,ref:o,props:i,_owner:My.current}}function F_(n,e){return{$$typeof:bh,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Uy(n){return typeof n=="object"&&n!==null&&n.$$typeof===bh}function O_(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(s){return e[s]})}var Dw=/\/+/g;function pg(n,e){return typeof n=="object"&&n!==null&&n.key!=null?O_(""+n.key):e.toString(36)}function Um(n,e,s,r,i){var a=typeof n;(a==="undefined"||a==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case bh:case E_:o=!0}}if(o)return o=n,i=i(o),n=r===""?"."+pg(o,0):r,Rw(i)?(s="",n!=null&&(s=n.replace(Dw,"$&/")+"/"),Um(i,e,s,"",function(d){return d})):i!=null&&(Uy(i)&&(i=F_(i,s+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Dw,"$&/")+"/")+n)),e.push(i)),1;if(o=0,r=r===""?".":r+":",Rw(n))for(var l=0;l<n.length;l++){a=n[l];var c=r+pg(a,l);o+=Um(a,e,s,c,i)}else if(c=L_(n),typeof c=="function")for(n=c.call(n),l=0;!(a=n.next()).done;)a=a.value,c=r+pg(a,l++),o+=Um(a,e,s,c,i);else if(a==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function mm(n,e,s){if(n==null)return n;var r=[],i=0;return Um(n,r,"","",function(a){return e.call(s,a,i++)}),r}function M_(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(s){(n._status===0||n._status===-1)&&(n._status=1,n._result=s)},function(s){(n._status===0||n._status===-1)&&(n._status=2,n._result=s)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Nr={current:null},$m={transition:null},U_={ReactCurrentDispatcher:Nr,ReactCurrentBatchConfig:$m,ReactCurrentOwner:My};function uS(){throw Error("act(...) is not supported in production builds of React.")}ms.Children={map:mm,forEach:function(n,e,s){mm(n,function(){e.apply(this,arguments)},s)},count:function(n){var e=0;return mm(n,function(){e++}),e},toArray:function(n){return mm(n,function(e){return e})||[]},only:function(n){if(!Uy(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};ms.Component=pd;ms.Fragment=C_;ms.Profiler=T_;ms.PureComponent=Fy;ms.StrictMode=I_;ms.Suspense=D_;ms.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=U_;ms.act=uS;ms.cloneElement=function(n,e,s){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=iS({},n.props),i=n.key,a=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,o=My.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var l=n.type.defaultProps;for(c in e)lS.call(e,c)&&!cS.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=s;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:bh,type:n.type,key:i,ref:a,props:r,_owner:o}};ms.createContext=function(n){return n={$$typeof:__,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:A_,_context:n},n.Consumer=n};ms.createElement=dS;ms.createFactory=function(n){var e=dS.bind(null,n);return e.type=n,e};ms.createRef=function(){return{current:null}};ms.forwardRef=function(n){return{$$typeof:R_,render:n}};ms.isValidElement=Uy;ms.lazy=function(n){return{$$typeof:k_,_payload:{_status:-1,_result:n},_init:M_}};ms.memo=function(n,e){return{$$typeof:P_,type:n,compare:e===void 0?null:e}};ms.startTransition=function(n){var e=$m.transition;$m.transition={};try{n()}finally{$m.transition=e}};ms.unstable_act=uS;ms.useCallback=function(n,e){return Nr.current.useCallback(n,e)};ms.useContext=function(n){return Nr.current.useContext(n)};ms.useDebugValue=function(){};ms.useDeferredValue=function(n){return Nr.current.useDeferredValue(n)};ms.useEffect=function(n,e){return Nr.current.useEffect(n,e)};ms.useId=function(){return Nr.current.useId()};ms.useImperativeHandle=function(n,e,s){return Nr.current.useImperativeHandle(n,e,s)};ms.useInsertionEffect=function(n,e){return Nr.current.useInsertionEffect(n,e)};ms.useLayoutEffect=function(n,e){return Nr.current.useLayoutEffect(n,e)};ms.useMemo=function(n,e){return Nr.current.useMemo(n,e)};ms.useReducer=function(n,e,s){return Nr.current.useReducer(n,e,s)};ms.useRef=function(n){return Nr.current.useRef(n)};ms.useState=function(n){return Nr.current.useState(n)};ms.useSyncExternalStore=function(n,e,s){return Nr.current.useSyncExternalStore(n,e,s)};ms.useTransition=function(){return Nr.current.useTransition()};ms.version="18.3.1";nS.exports=ms;var h=nS.exports;const wa=S_(h),$_=N_({__proto__:null,default:wa},[h]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z_=h,V_=Symbol.for("react.element"),B_=Symbol.for("react.fragment"),G_=Object.prototype.hasOwnProperty,W_=z_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,q_={key:!0,ref:!0,__self:!0,__source:!0};function hS(n,e,s){var r,i={},a=null,o=null;s!==void 0&&(a=""+s),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)G_.call(e,r)&&!q_.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:V_,type:n,key:a,ref:o,props:i,_owner:W_.current}}tf.Fragment=B_;tf.jsx=hS;tf.jsxs=hS;sS.exports=tf;var t=sS.exports,lx={},mS={exports:{}},Yr={},pS={exports:{}},fS={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(O,E){var k=O.length;O.push(E);e:for(;0<k;){var b=k-1>>>1,N=O[b];if(0<i(N,E))O[b]=E,O[k]=N,k=b;else break e}}function s(O){return O.length===0?null:O[0]}function r(O){if(O.length===0)return null;var E=O[0],k=O.pop();if(k!==E){O[0]=k;e:for(var b=0,N=O.length,I=N>>>1;b<I;){var P=2*(b+1)-1,_=O[P],C=P+1,U=O[C];if(0>i(_,k))C<N&&0>i(U,_)?(O[b]=U,O[C]=k,b=C):(O[b]=_,O[P]=k,b=P);else if(C<N&&0>i(U,k))O[b]=U,O[C]=k,b=C;else break e}}return E}function i(O,E){var k=O.sortIndex-E.sortIndex;return k!==0?k:O.id-E.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();n.unstable_now=function(){return o.now()-l}}var c=[],d=[],u=1,f=null,p=3,j=!1,L=!1,R=!1,D=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(O){for(var E=s(d);E!==null;){if(E.callback===null)r(d);else if(E.startTime<=O)r(d),E.sortIndex=E.expirationTime,e(c,E);else break;E=s(d)}}function S(O){if(R=!1,x(O),!L)if(s(c)!==null)L=!0,Y(A);else{var E=s(d);E!==null&&z(S,E.startTime-O)}}function A(O,E){L=!1,R&&(R=!1,y(B),B=-1),j=!0;var k=p;try{for(x(E),f=s(c);f!==null&&(!(f.expirationTime>E)||O&&!te());){var b=f.callback;if(typeof b=="function"){f.callback=null,p=f.priorityLevel;var N=b(f.expirationTime<=E);E=n.unstable_now(),typeof N=="function"?f.callback=N:f===s(c)&&r(c),x(E)}else r(c);f=s(c)}if(f!==null)var I=!0;else{var P=s(d);P!==null&&z(S,P.startTime-E),I=!1}return I}finally{f=null,p=k,j=!1}}var Q=!1,q=null,B=-1,$=5,H=-1;function te(){return!(n.unstable_now()-H<$)}function G(){if(q!==null){var O=n.unstable_now();H=O;var E=!0;try{E=q(!0,O)}finally{E?F():(Q=!1,q=null)}}else Q=!1}var F;if(typeof T=="function")F=function(){T(G)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,ue=X.port2;X.port1.onmessage=G,F=function(){ue.postMessage(null)}}else F=function(){D(G,0)};function Y(O){q=O,Q||(Q=!0,F())}function z(O,E){B=D(function(){O(n.unstable_now())},E)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(O){O.callback=null},n.unstable_continueExecution=function(){L||j||(L=!0,Y(A))},n.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$=0<O?Math.floor(1e3/O):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return s(c)},n.unstable_next=function(O){switch(p){case 1:case 2:case 3:var E=3;break;default:E=p}var k=p;p=E;try{return O()}finally{p=k}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(O,E){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var k=p;p=O;try{return E()}finally{p=k}},n.unstable_scheduleCallback=function(O,E,k){var b=n.unstable_now();switch(typeof k=="object"&&k!==null?(k=k.delay,k=typeof k=="number"&&0<k?b+k:b):k=b,O){case 1:var N=-1;break;case 2:N=250;break;case 5:N=1073741823;break;case 4:N=1e4;break;default:N=5e3}return N=k+N,O={id:u++,callback:E,priorityLevel:O,startTime:k,expirationTime:N,sortIndex:-1},k>b?(O.sortIndex=k,e(d,O),s(c)===null&&O===s(d)&&(R?(y(B),B=-1):R=!0,z(S,k-b))):(O.sortIndex=N,e(c,O),L||j||(L=!0,Y(A))),O},n.unstable_shouldYield=te,n.unstable_wrapCallback=function(O){var E=p;return function(){var k=p;p=E;try{return O.apply(this,arguments)}finally{p=k}}}})(fS);pS.exports=fS;var H_=pS.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q_=h,Qr=H_;function nt(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,s=1;s<arguments.length;s++)e+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var gS=new Set,$u={};function Ql(n,e){Yc(n,e),Yc(n+"Capture",e)}function Yc(n,e){for($u[n]=e,n=0;n<e.length;n++)gS.add(e[n])}var Ea=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),cx=Object.prototype.hasOwnProperty,K_=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Pw={},kw={};function Y_(n){return cx.call(kw,n)?!0:cx.call(Pw,n)?!1:K_.test(n)?kw[n]=!0:(Pw[n]=!0,!1)}function J_(n,e,s,r){if(s!==null&&s.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:s!==null?!s.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function X_(n,e,s,r){if(e===null||typeof e>"u"||J_(n,e,s,r))return!0;if(r)return!1;if(s!==null)switch(s.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function jr(n,e,s,r,i,a,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=s,this.propertyName=n,this.type=e,this.sanitizeURL=a,this.removeEmptyString=o}var Kn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Kn[n]=new jr(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Kn[e]=new jr(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Kn[n]=new jr(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Kn[n]=new jr(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Kn[n]=new jr(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Kn[n]=new jr(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Kn[n]=new jr(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Kn[n]=new jr(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Kn[n]=new jr(n,5,!1,n.toLowerCase(),null,!1,!1)});var $y=/[\-:]([a-z])/g;function zy(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace($y,zy);Kn[e]=new jr(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace($y,zy);Kn[e]=new jr(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace($y,zy);Kn[e]=new jr(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Kn[n]=new jr(n,1,!1,n.toLowerCase(),null,!1,!1)});Kn.xlinkHref=new jr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Kn[n]=new jr(n,1,!1,n.toLowerCase(),null,!0,!0)});function Vy(n,e,s,r){var i=Kn.hasOwnProperty(e)?Kn[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(X_(e,s,i,r)&&(s=null),r||i===null?Y_(e)&&(s===null?n.removeAttribute(e):n.setAttribute(e,""+s)):i.mustUseProperty?n[i.propertyName]=s===null?i.type===3?!1:"":s:(e=i.attributeName,r=i.attributeNamespace,s===null?n.removeAttribute(e):(i=i.type,s=i===3||i===4&&s===!0?"":""+s,r?n.setAttributeNS(r,e,s):n.setAttribute(e,s))))}var ka=Q_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,pm=Symbol.for("react.element"),Cc=Symbol.for("react.portal"),Ic=Symbol.for("react.fragment"),By=Symbol.for("react.strict_mode"),dx=Symbol.for("react.profiler"),xS=Symbol.for("react.provider"),yS=Symbol.for("react.context"),Gy=Symbol.for("react.forward_ref"),ux=Symbol.for("react.suspense"),hx=Symbol.for("react.suspense_list"),Wy=Symbol.for("react.memo"),Qa=Symbol.for("react.lazy"),bS=Symbol.for("react.offscreen"),Lw=Symbol.iterator;function eu(n){return n===null||typeof n!="object"?null:(n=Lw&&n[Lw]||n["@@iterator"],typeof n=="function"?n:null)}var an=Object.assign,fg;function du(n){if(fg===void 0)try{throw Error()}catch(s){var e=s.stack.trim().match(/\n( *(at )?)/);fg=e&&e[1]||""}return`
`+fg+n}var gg=!1;function xg(n,e){if(!n||gg)return"";gg=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(n,[],e)}else{try{e.call()}catch(d){r=d}n.call(e.prototype)}else{try{throw Error()}catch(d){r=d}n()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var i=d.stack.split(`
`),a=r.stack.split(`
`),o=i.length-1,l=a.length-1;1<=o&&0<=l&&i[o]!==a[l];)l--;for(;1<=o&&0<=l;o--,l--)if(i[o]!==a[l]){if(o!==1||l!==1)do if(o--,l--,0>l||i[o]!==a[l]){var c=`
`+i[o].replace(" at new "," at ");return n.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",n.displayName)),c}while(1<=o&&0<=l);break}}}finally{gg=!1,Error.prepareStackTrace=s}return(n=n?n.displayName||n.name:"")?du(n):""}function Z_(n){switch(n.tag){case 5:return du(n.type);case 16:return du("Lazy");case 13:return du("Suspense");case 19:return du("SuspenseList");case 0:case 2:case 15:return n=xg(n.type,!1),n;case 11:return n=xg(n.type.render,!1),n;case 1:return n=xg(n.type,!0),n;default:return""}}function mx(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Ic:return"Fragment";case Cc:return"Portal";case dx:return"Profiler";case By:return"StrictMode";case ux:return"Suspense";case hx:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case yS:return(n.displayName||"Context")+".Consumer";case xS:return(n._context.displayName||"Context")+".Provider";case Gy:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Wy:return e=n.displayName||null,e!==null?e:mx(n.type)||"Memo";case Qa:e=n._payload,n=n._init;try{return mx(n(e))}catch{}}return null}function e2(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return mx(e);case 8:return e===By?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function So(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function wS(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function t2(n){var e=wS(n)?"checked":"value",s=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var i=s.get,a=s.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,a.call(this,o)}}),Object.defineProperty(n,e,{enumerable:s.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function fm(n){n._valueTracker||(n._valueTracker=t2(n))}function vS(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var s=e.getValue(),r="";return n&&(r=wS(n)?n.checked?"true":"false":n.value),n=r,n!==s?(e.setValue(n),!0):!1}function ap(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function px(n,e){var s=e.checked;return an({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??n._wrapperState.initialChecked})}function Fw(n,e){var s=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;s=So(e.value!=null?e.value:s),n._wrapperState={initialChecked:r,initialValue:s,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function NS(n,e){e=e.checked,e!=null&&Vy(n,"checked",e,!1)}function fx(n,e){NS(n,e);var s=So(e.value),r=e.type;if(s!=null)r==="number"?(s===0&&n.value===""||n.value!=s)&&(n.value=""+s):n.value!==""+s&&(n.value=""+s);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?gx(n,e.type,s):e.hasOwnProperty("defaultValue")&&gx(n,e.type,So(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Ow(n,e,s){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,s||e===n.value||(n.value=e),n.defaultValue=e}s=n.name,s!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,s!==""&&(n.name=s)}function gx(n,e,s){(e!=="number"||ap(n.ownerDocument)!==n)&&(s==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+s&&(n.defaultValue=""+s))}var uu=Array.isArray;function $c(n,e,s,r){if(n=n.options,e){e={};for(var i=0;i<s.length;i++)e["$"+s[i]]=!0;for(s=0;s<n.length;s++)i=e.hasOwnProperty("$"+n[s].value),n[s].selected!==i&&(n[s].selected=i),i&&r&&(n[s].defaultSelected=!0)}else{for(s=""+So(s),e=null,i=0;i<n.length;i++){if(n[i].value===s){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function xx(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(nt(91));return an({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Mw(n,e){var s=e.value;if(s==null){if(s=e.children,e=e.defaultValue,s!=null){if(e!=null)throw Error(nt(92));if(uu(s)){if(1<s.length)throw Error(nt(93));s=s[0]}e=s}e==null&&(e=""),s=e}n._wrapperState={initialValue:So(s)}}function jS(n,e){var s=So(e.value),r=So(e.defaultValue);s!=null&&(s=""+s,s!==n.value&&(n.value=s),e.defaultValue==null&&n.defaultValue!==s&&(n.defaultValue=s)),r!=null&&(n.defaultValue=""+r)}function Uw(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function SS(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function yx(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?SS(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var gm,ES=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,s,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,s,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(gm=gm||document.createElement("div"),gm.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=gm.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function zu(n,e){if(e){var s=n.firstChild;if(s&&s===n.lastChild&&s.nodeType===3){s.nodeValue=e;return}}n.textContent=e}var bu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},s2=["Webkit","ms","Moz","O"];Object.keys(bu).forEach(function(n){s2.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),bu[e]=bu[n]})});function CS(n,e,s){return e==null||typeof e=="boolean"||e===""?"":s||typeof e!="number"||e===0||bu.hasOwnProperty(n)&&bu[n]?(""+e).trim():e+"px"}function IS(n,e){n=n.style;for(var s in e)if(e.hasOwnProperty(s)){var r=s.indexOf("--")===0,i=CS(s,e[s],r);s==="float"&&(s="cssFloat"),r?n.setProperty(s,i):n[s]=i}}var n2=an({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function bx(n,e){if(e){if(n2[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(nt(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(nt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(nt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(nt(62))}}function wx(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var vx=null;function qy(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Nx=null,zc=null,Vc=null;function $w(n){if(n=Nh(n)){if(typeof Nx!="function")throw Error(nt(280));var e=n.stateNode;e&&(e=of(e),Nx(n.stateNode,n.type,e))}}function TS(n){zc?Vc?Vc.push(n):Vc=[n]:zc=n}function AS(){if(zc){var n=zc,e=Vc;if(Vc=zc=null,$w(n),e)for(n=0;n<e.length;n++)$w(e[n])}}function _S(n,e){return n(e)}function RS(){}var yg=!1;function DS(n,e,s){if(yg)return n(e,s);yg=!0;try{return _S(n,e,s)}finally{yg=!1,(zc!==null||Vc!==null)&&(RS(),AS())}}function Vu(n,e){var s=n.stateNode;if(s===null)return null;var r=of(s);if(r===null)return null;s=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(s&&typeof s!="function")throw Error(nt(231,e,typeof s));return s}var jx=!1;if(Ea)try{var tu={};Object.defineProperty(tu,"passive",{get:function(){jx=!0}}),window.addEventListener("test",tu,tu),window.removeEventListener("test",tu,tu)}catch{jx=!1}function r2(n,e,s,r,i,a,o,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(s,d)}catch(u){this.onError(u)}}var wu=!1,op=null,lp=!1,Sx=null,i2={onError:function(n){wu=!0,op=n}};function a2(n,e,s,r,i,a,o,l,c){wu=!1,op=null,r2.apply(i2,arguments)}function o2(n,e,s,r,i,a,o,l,c){if(a2.apply(this,arguments),wu){if(wu){var d=op;wu=!1,op=null}else throw Error(nt(198));lp||(lp=!0,Sx=d)}}function Kl(n){var e=n,s=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(s=e.return),n=e.return;while(n)}return e.tag===3?s:null}function PS(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function zw(n){if(Kl(n)!==n)throw Error(nt(188))}function l2(n){var e=n.alternate;if(!e){if(e=Kl(n),e===null)throw Error(nt(188));return e!==n?null:n}for(var s=n,r=e;;){var i=s.return;if(i===null)break;var a=i.alternate;if(a===null){if(r=i.return,r!==null){s=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===s)return zw(i),n;if(a===r)return zw(i),e;a=a.sibling}throw Error(nt(188))}if(s.return!==r.return)s=i,r=a;else{for(var o=!1,l=i.child;l;){if(l===s){o=!0,s=i,r=a;break}if(l===r){o=!0,r=i,s=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===s){o=!0,s=a,r=i;break}if(l===r){o=!0,r=a,s=i;break}l=l.sibling}if(!o)throw Error(nt(189))}}if(s.alternate!==r)throw Error(nt(190))}if(s.tag!==3)throw Error(nt(188));return s.stateNode.current===s?n:e}function kS(n){return n=l2(n),n!==null?LS(n):null}function LS(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=LS(n);if(e!==null)return e;n=n.sibling}return null}var FS=Qr.unstable_scheduleCallback,Vw=Qr.unstable_cancelCallback,c2=Qr.unstable_shouldYield,d2=Qr.unstable_requestPaint,xn=Qr.unstable_now,u2=Qr.unstable_getCurrentPriorityLevel,Hy=Qr.unstable_ImmediatePriority,OS=Qr.unstable_UserBlockingPriority,cp=Qr.unstable_NormalPriority,h2=Qr.unstable_LowPriority,MS=Qr.unstable_IdlePriority,sf=null,Qi=null;function m2(n){if(Qi&&typeof Qi.onCommitFiberRoot=="function")try{Qi.onCommitFiberRoot(sf,n,void 0,(n.current.flags&128)===128)}catch{}}var Ti=Math.clz32?Math.clz32:g2,p2=Math.log,f2=Math.LN2;function g2(n){return n>>>=0,n===0?32:31-(p2(n)/f2|0)|0}var xm=64,ym=4194304;function hu(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function dp(n,e){var s=n.pendingLanes;if(s===0)return 0;var r=0,i=n.suspendedLanes,a=n.pingedLanes,o=s&268435455;if(o!==0){var l=o&~i;l!==0?r=hu(l):(a&=o,a!==0&&(r=hu(a)))}else o=s&~i,o!==0?r=hu(o):a!==0&&(r=hu(a));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,a=e&-e,i>=a||i===16&&(a&4194240)!==0))return e;if(r&4&&(r|=s&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)s=31-Ti(e),i=1<<s,r|=n[s],e&=~i;return r}function x2(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function y2(n,e){for(var s=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,a=n.pendingLanes;0<a;){var o=31-Ti(a),l=1<<o,c=i[o];c===-1?(!(l&s)||l&r)&&(i[o]=x2(l,e)):c<=e&&(n.expiredLanes|=l),a&=~l}}function Ex(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function US(){var n=xm;return xm<<=1,!(xm&4194240)&&(xm=64),n}function bg(n){for(var e=[],s=0;31>s;s++)e.push(n);return e}function wh(n,e,s){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Ti(e),n[e]=s}function b2(n,e){var s=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<s;){var i=31-Ti(s),a=1<<i;e[i]=0,r[i]=-1,n[i]=-1,s&=~a}}function Qy(n,e){var s=n.entangledLanes|=e;for(n=n.entanglements;s;){var r=31-Ti(s),i=1<<r;i&e|n[r]&e&&(n[r]|=e),s&=~i}}var Ls=0;function $S(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var zS,Ky,VS,BS,GS,Cx=!1,bm=[],co=null,uo=null,ho=null,Bu=new Map,Gu=new Map,Ja=[],w2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Bw(n,e){switch(n){case"focusin":case"focusout":co=null;break;case"dragenter":case"dragleave":uo=null;break;case"mouseover":case"mouseout":ho=null;break;case"pointerover":case"pointerout":Bu.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Gu.delete(e.pointerId)}}function su(n,e,s,r,i,a){return n===null||n.nativeEvent!==a?(n={blockedOn:e,domEventName:s,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},e!==null&&(e=Nh(e),e!==null&&Ky(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function v2(n,e,s,r,i){switch(e){case"focusin":return co=su(co,n,e,s,r,i),!0;case"dragenter":return uo=su(uo,n,e,s,r,i),!0;case"mouseover":return ho=su(ho,n,e,s,r,i),!0;case"pointerover":var a=i.pointerId;return Bu.set(a,su(Bu.get(a)||null,n,e,s,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Gu.set(a,su(Gu.get(a)||null,n,e,s,r,i)),!0}return!1}function WS(n){var e=vl(n.target);if(e!==null){var s=Kl(e);if(s!==null){if(e=s.tag,e===13){if(e=PS(s),e!==null){n.blockedOn=e,GS(n.priority,function(){VS(s)});return}}else if(e===3&&s.stateNode.current.memoizedState.isDehydrated){n.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}n.blockedOn=null}function zm(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var s=Ix(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(s===null){s=n.nativeEvent;var r=new s.constructor(s.type,s);vx=r,s.target.dispatchEvent(r),vx=null}else return e=Nh(s),e!==null&&Ky(e),n.blockedOn=s,!1;e.shift()}return!0}function Gw(n,e,s){zm(n)&&s.delete(e)}function N2(){Cx=!1,co!==null&&zm(co)&&(co=null),uo!==null&&zm(uo)&&(uo=null),ho!==null&&zm(ho)&&(ho=null),Bu.forEach(Gw),Gu.forEach(Gw)}function nu(n,e){n.blockedOn===e&&(n.blockedOn=null,Cx||(Cx=!0,Qr.unstable_scheduleCallback(Qr.unstable_NormalPriority,N2)))}function Wu(n){function e(i){return nu(i,n)}if(0<bm.length){nu(bm[0],n);for(var s=1;s<bm.length;s++){var r=bm[s];r.blockedOn===n&&(r.blockedOn=null)}}for(co!==null&&nu(co,n),uo!==null&&nu(uo,n),ho!==null&&nu(ho,n),Bu.forEach(e),Gu.forEach(e),s=0;s<Ja.length;s++)r=Ja[s],r.blockedOn===n&&(r.blockedOn=null);for(;0<Ja.length&&(s=Ja[0],s.blockedOn===null);)WS(s),s.blockedOn===null&&Ja.shift()}var Bc=ka.ReactCurrentBatchConfig,up=!0;function j2(n,e,s,r){var i=Ls,a=Bc.transition;Bc.transition=null;try{Ls=1,Yy(n,e,s,r)}finally{Ls=i,Bc.transition=a}}function S2(n,e,s,r){var i=Ls,a=Bc.transition;Bc.transition=null;try{Ls=4,Yy(n,e,s,r)}finally{Ls=i,Bc.transition=a}}function Yy(n,e,s,r){if(up){var i=Ix(n,e,s,r);if(i===null)Ag(n,e,r,hp,s),Bw(n,r);else if(v2(i,n,e,s,r))r.stopPropagation();else if(Bw(n,r),e&4&&-1<w2.indexOf(n)){for(;i!==null;){var a=Nh(i);if(a!==null&&zS(a),a=Ix(n,e,s,r),a===null&&Ag(n,e,r,hp,s),a===i)break;i=a}i!==null&&r.stopPropagation()}else Ag(n,e,r,null,s)}}var hp=null;function Ix(n,e,s,r){if(hp=null,n=qy(r),n=vl(n),n!==null)if(e=Kl(n),e===null)n=null;else if(s=e.tag,s===13){if(n=PS(e),n!==null)return n;n=null}else if(s===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return hp=n,null}function qS(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(u2()){case Hy:return 1;case OS:return 4;case cp:case h2:return 16;case MS:return 536870912;default:return 16}default:return 16}}var ro=null,Jy=null,Vm=null;function HS(){if(Vm)return Vm;var n,e=Jy,s=e.length,r,i="value"in ro?ro.value:ro.textContent,a=i.length;for(n=0;n<s&&e[n]===i[n];n++);var o=s-n;for(r=1;r<=o&&e[s-r]===i[a-r];r++);return Vm=i.slice(n,1<r?1-r:void 0)}function Bm(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function wm(){return!0}function Ww(){return!1}function Jr(n){function e(s,r,i,a,o){this._reactName=s,this._targetInst=i,this.type=r,this.nativeEvent=a,this.target=o,this.currentTarget=null;for(var l in n)n.hasOwnProperty(l)&&(s=n[l],this[l]=s?s(a):a[l]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?wm:Ww,this.isPropagationStopped=Ww,this}return an(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=wm)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=wm)},persist:function(){},isPersistent:wm}),e}var fd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Xy=Jr(fd),vh=an({},fd,{view:0,detail:0}),E2=Jr(vh),wg,vg,ru,nf=an({},vh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Zy,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==ru&&(ru&&n.type==="mousemove"?(wg=n.screenX-ru.screenX,vg=n.screenY-ru.screenY):vg=wg=0,ru=n),wg)},movementY:function(n){return"movementY"in n?n.movementY:vg}}),qw=Jr(nf),C2=an({},nf,{dataTransfer:0}),I2=Jr(C2),T2=an({},vh,{relatedTarget:0}),Ng=Jr(T2),A2=an({},fd,{animationName:0,elapsedTime:0,pseudoElement:0}),_2=Jr(A2),R2=an({},fd,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),D2=Jr(R2),P2=an({},fd,{data:0}),Hw=Jr(P2),k2={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},L2={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},F2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function O2(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=F2[n])?!!e[n]:!1}function Zy(){return O2}var M2=an({},vh,{key:function(n){if(n.key){var e=k2[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Bm(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?L2[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Zy,charCode:function(n){return n.type==="keypress"?Bm(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Bm(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),U2=Jr(M2),$2=an({},nf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Qw=Jr($2),z2=an({},vh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Zy}),V2=Jr(z2),B2=an({},fd,{propertyName:0,elapsedTime:0,pseudoElement:0}),G2=Jr(B2),W2=an({},nf,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),q2=Jr(W2),H2=[9,13,27,32],eb=Ea&&"CompositionEvent"in window,vu=null;Ea&&"documentMode"in document&&(vu=document.documentMode);var Q2=Ea&&"TextEvent"in window&&!vu,QS=Ea&&(!eb||vu&&8<vu&&11>=vu),Kw=" ",Yw=!1;function KS(n,e){switch(n){case"keyup":return H2.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function YS(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Tc=!1;function K2(n,e){switch(n){case"compositionend":return YS(e);case"keypress":return e.which!==32?null:(Yw=!0,Kw);case"textInput":return n=e.data,n===Kw&&Yw?null:n;default:return null}}function Y2(n,e){if(Tc)return n==="compositionend"||!eb&&KS(n,e)?(n=HS(),Vm=Jy=ro=null,Tc=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return QS&&e.locale!=="ko"?null:e.data;default:return null}}var J2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Jw(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!J2[n.type]:e==="textarea"}function JS(n,e,s,r){TS(r),e=mp(e,"onChange"),0<e.length&&(s=new Xy("onChange","change",null,s,r),n.push({event:s,listeners:e}))}var Nu=null,qu=null;function X2(n){lE(n,0)}function rf(n){var e=Rc(n);if(vS(e))return n}function Z2(n,e){if(n==="change")return e}var XS=!1;if(Ea){var jg;if(Ea){var Sg="oninput"in document;if(!Sg){var Xw=document.createElement("div");Xw.setAttribute("oninput","return;"),Sg=typeof Xw.oninput=="function"}jg=Sg}else jg=!1;XS=jg&&(!document.documentMode||9<document.documentMode)}function Zw(){Nu&&(Nu.detachEvent("onpropertychange",ZS),qu=Nu=null)}function ZS(n){if(n.propertyName==="value"&&rf(qu)){var e=[];JS(e,qu,n,qy(n)),DS(X2,e)}}function eR(n,e,s){n==="focusin"?(Zw(),Nu=e,qu=s,Nu.attachEvent("onpropertychange",ZS)):n==="focusout"&&Zw()}function tR(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return rf(qu)}function sR(n,e){if(n==="click")return rf(e)}function nR(n,e){if(n==="input"||n==="change")return rf(e)}function rR(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Di=typeof Object.is=="function"?Object.is:rR;function Hu(n,e){if(Di(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var s=Object.keys(n),r=Object.keys(e);if(s.length!==r.length)return!1;for(r=0;r<s.length;r++){var i=s[r];if(!cx.call(e,i)||!Di(n[i],e[i]))return!1}return!0}function ev(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function tv(n,e){var s=ev(n);n=0;for(var r;s;){if(s.nodeType===3){if(r=n+s.textContent.length,n<=e&&r>=e)return{node:s,offset:e-n};n=r}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=ev(s)}}function eE(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?eE(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function tE(){for(var n=window,e=ap();e instanceof n.HTMLIFrameElement;){try{var s=typeof e.contentWindow.location.href=="string"}catch{s=!1}if(s)n=e.contentWindow;else break;e=ap(n.document)}return e}function tb(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function iR(n){var e=tE(),s=n.focusedElem,r=n.selectionRange;if(e!==s&&s&&s.ownerDocument&&eE(s.ownerDocument.documentElement,s)){if(r!==null&&tb(s)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in s)s.selectionStart=e,s.selectionEnd=Math.min(n,s.value.length);else if(n=(e=s.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=s.textContent.length,a=Math.min(r.start,i);r=r.end===void 0?a:Math.min(r.end,i),!n.extend&&a>r&&(i=r,r=a,a=i),i=tv(s,a);var o=tv(s,r);i&&o&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),a>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=s;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<e.length;s++)n=e[s],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var aR=Ea&&"documentMode"in document&&11>=document.documentMode,Ac=null,Tx=null,ju=null,Ax=!1;function sv(n,e,s){var r=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;Ax||Ac==null||Ac!==ap(r)||(r=Ac,"selectionStart"in r&&tb(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ju&&Hu(ju,r)||(ju=r,r=mp(Tx,"onSelect"),0<r.length&&(e=new Xy("onSelect","select",null,e,s),n.push({event:e,listeners:r}),e.target=Ac)))}function vm(n,e){var s={};return s[n.toLowerCase()]=e.toLowerCase(),s["Webkit"+n]="webkit"+e,s["Moz"+n]="moz"+e,s}var _c={animationend:vm("Animation","AnimationEnd"),animationiteration:vm("Animation","AnimationIteration"),animationstart:vm("Animation","AnimationStart"),transitionend:vm("Transition","TransitionEnd")},Eg={},sE={};Ea&&(sE=document.createElement("div").style,"AnimationEvent"in window||(delete _c.animationend.animation,delete _c.animationiteration.animation,delete _c.animationstart.animation),"TransitionEvent"in window||delete _c.transitionend.transition);function af(n){if(Eg[n])return Eg[n];if(!_c[n])return n;var e=_c[n],s;for(s in e)if(e.hasOwnProperty(s)&&s in sE)return Eg[n]=e[s];return n}var nE=af("animationend"),rE=af("animationiteration"),iE=af("animationstart"),aE=af("transitionend"),oE=new Map,nv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ko(n,e){oE.set(n,e),Ql(e,[n])}for(var Cg=0;Cg<nv.length;Cg++){var Ig=nv[Cg],oR=Ig.toLowerCase(),lR=Ig[0].toUpperCase()+Ig.slice(1);ko(oR,"on"+lR)}ko(nE,"onAnimationEnd");ko(rE,"onAnimationIteration");ko(iE,"onAnimationStart");ko("dblclick","onDoubleClick");ko("focusin","onFocus");ko("focusout","onBlur");ko(aE,"onTransitionEnd");Yc("onMouseEnter",["mouseout","mouseover"]);Yc("onMouseLeave",["mouseout","mouseover"]);Yc("onPointerEnter",["pointerout","pointerover"]);Yc("onPointerLeave",["pointerout","pointerover"]);Ql("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ql("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ql("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ql("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ql("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ql("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),cR=new Set("cancel close invalid load scroll toggle".split(" ").concat(mu));function rv(n,e,s){var r=n.type||"unknown-event";n.currentTarget=s,o2(r,e,void 0,n),n.currentTarget=null}function lE(n,e){e=(e&4)!==0;for(var s=0;s<n.length;s++){var r=n[s],i=r.event;r=r.listeners;e:{var a=void 0;if(e)for(var o=r.length-1;0<=o;o--){var l=r[o],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==a&&i.isPropagationStopped())break e;rv(i,l,d),a=c}else for(o=0;o<r.length;o++){if(l=r[o],c=l.instance,d=l.currentTarget,l=l.listener,c!==a&&i.isPropagationStopped())break e;rv(i,l,d),a=c}}}if(lp)throw n=Sx,lp=!1,Sx=null,n}function Qs(n,e){var s=e[kx];s===void 0&&(s=e[kx]=new Set);var r=n+"__bubble";s.has(r)||(cE(e,n,2,!1),s.add(r))}function Tg(n,e,s){var r=0;e&&(r|=4),cE(s,n,r,e)}var Nm="_reactListening"+Math.random().toString(36).slice(2);function Qu(n){if(!n[Nm]){n[Nm]=!0,gS.forEach(function(s){s!=="selectionchange"&&(cR.has(s)||Tg(s,!1,n),Tg(s,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Nm]||(e[Nm]=!0,Tg("selectionchange",!1,e))}}function cE(n,e,s,r){switch(qS(e)){case 1:var i=j2;break;case 4:i=S2;break;default:i=Yy}s=i.bind(null,e,s,n),i=void 0,!jx||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,s,{capture:!0,passive:i}):n.addEventListener(e,s,!0):i!==void 0?n.addEventListener(e,s,{passive:i}):n.addEventListener(e,s,!1)}function Ag(n,e,s,r,i){var a=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===i||l.nodeType===8&&l.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;o=o.return}for(;l!==null;){if(o=vl(l),o===null)return;if(c=o.tag,c===5||c===6){r=a=o;continue e}l=l.parentNode}}r=r.return}DS(function(){var d=a,u=qy(s),f=[];e:{var p=oE.get(n);if(p!==void 0){var j=Xy,L=n;switch(n){case"keypress":if(Bm(s)===0)break e;case"keydown":case"keyup":j=U2;break;case"focusin":L="focus",j=Ng;break;case"focusout":L="blur",j=Ng;break;case"beforeblur":case"afterblur":j=Ng;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":j=qw;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":j=I2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":j=V2;break;case nE:case rE:case iE:j=_2;break;case aE:j=G2;break;case"scroll":j=E2;break;case"wheel":j=q2;break;case"copy":case"cut":case"paste":j=D2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":j=Qw}var R=(e&4)!==0,D=!R&&n==="scroll",y=R?p!==null?p+"Capture":null:p;R=[];for(var T=d,x;T!==null;){x=T;var S=x.stateNode;if(x.tag===5&&S!==null&&(x=S,y!==null&&(S=Vu(T,y),S!=null&&R.push(Ku(T,S,x)))),D)break;T=T.return}0<R.length&&(p=new j(p,L,null,s,u),f.push({event:p,listeners:R}))}}if(!(e&7)){e:{if(p=n==="mouseover"||n==="pointerover",j=n==="mouseout"||n==="pointerout",p&&s!==vx&&(L=s.relatedTarget||s.fromElement)&&(vl(L)||L[Ca]))break e;if((j||p)&&(p=u.window===u?u:(p=u.ownerDocument)?p.defaultView||p.parentWindow:window,j?(L=s.relatedTarget||s.toElement,j=d,L=L?vl(L):null,L!==null&&(D=Kl(L),L!==D||L.tag!==5&&L.tag!==6)&&(L=null)):(j=null,L=d),j!==L)){if(R=qw,S="onMouseLeave",y="onMouseEnter",T="mouse",(n==="pointerout"||n==="pointerover")&&(R=Qw,S="onPointerLeave",y="onPointerEnter",T="pointer"),D=j==null?p:Rc(j),x=L==null?p:Rc(L),p=new R(S,T+"leave",j,s,u),p.target=D,p.relatedTarget=x,S=null,vl(u)===d&&(R=new R(y,T+"enter",L,s,u),R.target=x,R.relatedTarget=D,S=R),D=S,j&&L)t:{for(R=j,y=L,T=0,x=R;x;x=bc(x))T++;for(x=0,S=y;S;S=bc(S))x++;for(;0<T-x;)R=bc(R),T--;for(;0<x-T;)y=bc(y),x--;for(;T--;){if(R===y||y!==null&&R===y.alternate)break t;R=bc(R),y=bc(y)}R=null}else R=null;j!==null&&iv(f,p,j,R,!1),L!==null&&D!==null&&iv(f,D,L,R,!0)}}e:{if(p=d?Rc(d):window,j=p.nodeName&&p.nodeName.toLowerCase(),j==="select"||j==="input"&&p.type==="file")var A=Z2;else if(Jw(p))if(XS)A=nR;else{A=tR;var Q=eR}else(j=p.nodeName)&&j.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(A=sR);if(A&&(A=A(n,d))){JS(f,A,s,u);break e}Q&&Q(n,p,d),n==="focusout"&&(Q=p._wrapperState)&&Q.controlled&&p.type==="number"&&gx(p,"number",p.value)}switch(Q=d?Rc(d):window,n){case"focusin":(Jw(Q)||Q.contentEditable==="true")&&(Ac=Q,Tx=d,ju=null);break;case"focusout":ju=Tx=Ac=null;break;case"mousedown":Ax=!0;break;case"contextmenu":case"mouseup":case"dragend":Ax=!1,sv(f,s,u);break;case"selectionchange":if(aR)break;case"keydown":case"keyup":sv(f,s,u)}var q;if(eb)e:{switch(n){case"compositionstart":var B="onCompositionStart";break e;case"compositionend":B="onCompositionEnd";break e;case"compositionupdate":B="onCompositionUpdate";break e}B=void 0}else Tc?KS(n,s)&&(B="onCompositionEnd"):n==="keydown"&&s.keyCode===229&&(B="onCompositionStart");B&&(QS&&s.locale!=="ko"&&(Tc||B!=="onCompositionStart"?B==="onCompositionEnd"&&Tc&&(q=HS()):(ro=u,Jy="value"in ro?ro.value:ro.textContent,Tc=!0)),Q=mp(d,B),0<Q.length&&(B=new Hw(B,n,null,s,u),f.push({event:B,listeners:Q}),q?B.data=q:(q=YS(s),q!==null&&(B.data=q)))),(q=Q2?K2(n,s):Y2(n,s))&&(d=mp(d,"onBeforeInput"),0<d.length&&(u=new Hw("onBeforeInput","beforeinput",null,s,u),f.push({event:u,listeners:d}),u.data=q))}lE(f,e)})}function Ku(n,e,s){return{instance:n,listener:e,currentTarget:s}}function mp(n,e){for(var s=e+"Capture",r=[];n!==null;){var i=n,a=i.stateNode;i.tag===5&&a!==null&&(i=a,a=Vu(n,s),a!=null&&r.unshift(Ku(n,a,i)),a=Vu(n,e),a!=null&&r.push(Ku(n,a,i))),n=n.return}return r}function bc(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function iv(n,e,s,r,i){for(var a=e._reactName,o=[];s!==null&&s!==r;){var l=s,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,i?(c=Vu(s,a),c!=null&&o.unshift(Ku(s,c,l))):i||(c=Vu(s,a),c!=null&&o.push(Ku(s,c,l)))),s=s.return}o.length!==0&&n.push({event:e,listeners:o})}var dR=/\r\n?/g,uR=/\u0000|\uFFFD/g;function av(n){return(typeof n=="string"?n:""+n).replace(dR,`
`).replace(uR,"")}function jm(n,e,s){if(e=av(e),av(n)!==e&&s)throw Error(nt(425))}function pp(){}var _x=null,Rx=null;function Dx(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Px=typeof setTimeout=="function"?setTimeout:void 0,hR=typeof clearTimeout=="function"?clearTimeout:void 0,ov=typeof Promise=="function"?Promise:void 0,mR=typeof queueMicrotask=="function"?queueMicrotask:typeof ov<"u"?function(n){return ov.resolve(null).then(n).catch(pR)}:Px;function pR(n){setTimeout(function(){throw n})}function _g(n,e){var s=e,r=0;do{var i=s.nextSibling;if(n.removeChild(s),i&&i.nodeType===8)if(s=i.data,s==="/$"){if(r===0){n.removeChild(i),Wu(e);return}r--}else s!=="$"&&s!=="$?"&&s!=="$!"||r++;s=i}while(s);Wu(e)}function mo(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function lv(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var s=n.data;if(s==="$"||s==="$!"||s==="$?"){if(e===0)return n;e--}else s==="/$"&&e++}n=n.previousSibling}return null}var gd=Math.random().toString(36).slice(2),Wi="__reactFiber$"+gd,Yu="__reactProps$"+gd,Ca="__reactContainer$"+gd,kx="__reactEvents$"+gd,fR="__reactListeners$"+gd,gR="__reactHandles$"+gd;function vl(n){var e=n[Wi];if(e)return e;for(var s=n.parentNode;s;){if(e=s[Ca]||s[Wi]){if(s=e.alternate,e.child!==null||s!==null&&s.child!==null)for(n=lv(n);n!==null;){if(s=n[Wi])return s;n=lv(n)}return e}n=s,s=n.parentNode}return null}function Nh(n){return n=n[Wi]||n[Ca],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Rc(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(nt(33))}function of(n){return n[Yu]||null}var Lx=[],Dc=-1;function Lo(n){return{current:n}}function Ks(n){0>Dc||(n.current=Lx[Dc],Lx[Dc]=null,Dc--)}function Hs(n,e){Dc++,Lx[Dc]=n.current,n.current=e}var Eo={},or=Lo(Eo),Pr=Lo(!1),Pl=Eo;function Jc(n,e){var s=n.type.contextTypes;if(!s)return Eo;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},a;for(a in s)i[a]=e[a];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function kr(n){return n=n.childContextTypes,n!=null}function fp(){Ks(Pr),Ks(or)}function cv(n,e,s){if(or.current!==Eo)throw Error(nt(168));Hs(or,e),Hs(Pr,s)}function dE(n,e,s){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return s;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(nt(108,e2(n)||"Unknown",i));return an({},s,r)}function gp(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Eo,Pl=or.current,Hs(or,n),Hs(Pr,Pr.current),!0}function dv(n,e,s){var r=n.stateNode;if(!r)throw Error(nt(169));s?(n=dE(n,e,Pl),r.__reactInternalMemoizedMergedChildContext=n,Ks(Pr),Ks(or),Hs(or,n)):Ks(Pr),Hs(Pr,s)}var pa=null,lf=!1,Rg=!1;function uE(n){pa===null?pa=[n]:pa.push(n)}function xR(n){lf=!0,uE(n)}function Fo(){if(!Rg&&pa!==null){Rg=!0;var n=0,e=Ls;try{var s=pa;for(Ls=1;n<s.length;n++){var r=s[n];do r=r(!0);while(r!==null)}pa=null,lf=!1}catch(i){throw pa!==null&&(pa=pa.slice(n+1)),FS(Hy,Fo),i}finally{Ls=e,Rg=!1}}return null}var Pc=[],kc=0,xp=null,yp=0,oi=[],li=0,kl=null,fa=1,ga="";function fl(n,e){Pc[kc++]=yp,Pc[kc++]=xp,xp=n,yp=e}function hE(n,e,s){oi[li++]=fa,oi[li++]=ga,oi[li++]=kl,kl=n;var r=fa;n=ga;var i=32-Ti(r)-1;r&=~(1<<i),s+=1;var a=32-Ti(e)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,fa=1<<32-Ti(e)+i|s<<i|r,ga=a+n}else fa=1<<a|s<<i|r,ga=n}function sb(n){n.return!==null&&(fl(n,1),hE(n,1,0))}function nb(n){for(;n===xp;)xp=Pc[--kc],Pc[kc]=null,yp=Pc[--kc],Pc[kc]=null;for(;n===kl;)kl=oi[--li],oi[li]=null,ga=oi[--li],oi[li]=null,fa=oi[--li],oi[li]=null}var qr=null,Br=null,Zs=!1,Ci=null;function mE(n,e){var s=di(5,null,null,0);s.elementType="DELETED",s.stateNode=e,s.return=n,e=n.deletions,e===null?(n.deletions=[s],n.flags|=16):e.push(s)}function uv(n,e){switch(n.tag){case 5:var s=n.type;return e=e.nodeType!==1||s.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,qr=n,Br=mo(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,qr=n,Br=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(s=kl!==null?{id:fa,overflow:ga}:null,n.memoizedState={dehydrated:e,treeContext:s,retryLane:1073741824},s=di(18,null,null,0),s.stateNode=e,s.return=n,n.child=s,qr=n,Br=null,!0):!1;default:return!1}}function Fx(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Ox(n){if(Zs){var e=Br;if(e){var s=e;if(!uv(n,e)){if(Fx(n))throw Error(nt(418));e=mo(s.nextSibling);var r=qr;e&&uv(n,e)?mE(r,s):(n.flags=n.flags&-4097|2,Zs=!1,qr=n)}}else{if(Fx(n))throw Error(nt(418));n.flags=n.flags&-4097|2,Zs=!1,qr=n}}}function hv(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;qr=n}function Sm(n){if(n!==qr)return!1;if(!Zs)return hv(n),Zs=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!Dx(n.type,n.memoizedProps)),e&&(e=Br)){if(Fx(n))throw pE(),Error(nt(418));for(;e;)mE(n,e),e=mo(e.nextSibling)}if(hv(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(nt(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var s=n.data;if(s==="/$"){if(e===0){Br=mo(n.nextSibling);break e}e--}else s!=="$"&&s!=="$!"&&s!=="$?"||e++}n=n.nextSibling}Br=null}}else Br=qr?mo(n.stateNode.nextSibling):null;return!0}function pE(){for(var n=Br;n;)n=mo(n.nextSibling)}function Xc(){Br=qr=null,Zs=!1}function rb(n){Ci===null?Ci=[n]:Ci.push(n)}var yR=ka.ReactCurrentBatchConfig;function iu(n,e,s){if(n=s.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(nt(309));var r=s.stateNode}if(!r)throw Error(nt(147,n));var i=r,a=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===a?e.ref:(e=function(o){var l=i.refs;o===null?delete l[a]:l[a]=o},e._stringRef=a,e)}if(typeof n!="string")throw Error(nt(284));if(!s._owner)throw Error(nt(290,n))}return n}function Em(n,e){throw n=Object.prototype.toString.call(e),Error(nt(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function mv(n){var e=n._init;return e(n._payload)}function fE(n){function e(y,T){if(n){var x=y.deletions;x===null?(y.deletions=[T],y.flags|=16):x.push(T)}}function s(y,T){if(!n)return null;for(;T!==null;)e(y,T),T=T.sibling;return null}function r(y,T){for(y=new Map;T!==null;)T.key!==null?y.set(T.key,T):y.set(T.index,T),T=T.sibling;return y}function i(y,T){return y=xo(y,T),y.index=0,y.sibling=null,y}function a(y,T,x){return y.index=x,n?(x=y.alternate,x!==null?(x=x.index,x<T?(y.flags|=2,T):x):(y.flags|=2,T)):(y.flags|=1048576,T)}function o(y){return n&&y.alternate===null&&(y.flags|=2),y}function l(y,T,x,S){return T===null||T.tag!==6?(T=Mg(x,y.mode,S),T.return=y,T):(T=i(T,x),T.return=y,T)}function c(y,T,x,S){var A=x.type;return A===Ic?u(y,T,x.props.children,S,x.key):T!==null&&(T.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===Qa&&mv(A)===T.type)?(S=i(T,x.props),S.ref=iu(y,T,x),S.return=y,S):(S=Ym(x.type,x.key,x.props,null,y.mode,S),S.ref=iu(y,T,x),S.return=y,S)}function d(y,T,x,S){return T===null||T.tag!==4||T.stateNode.containerInfo!==x.containerInfo||T.stateNode.implementation!==x.implementation?(T=Ug(x,y.mode,S),T.return=y,T):(T=i(T,x.children||[]),T.return=y,T)}function u(y,T,x,S,A){return T===null||T.tag!==7?(T=Il(x,y.mode,S,A),T.return=y,T):(T=i(T,x),T.return=y,T)}function f(y,T,x){if(typeof T=="string"&&T!==""||typeof T=="number")return T=Mg(""+T,y.mode,x),T.return=y,T;if(typeof T=="object"&&T!==null){switch(T.$$typeof){case pm:return x=Ym(T.type,T.key,T.props,null,y.mode,x),x.ref=iu(y,null,T),x.return=y,x;case Cc:return T=Ug(T,y.mode,x),T.return=y,T;case Qa:var S=T._init;return f(y,S(T._payload),x)}if(uu(T)||eu(T))return T=Il(T,y.mode,x,null),T.return=y,T;Em(y,T)}return null}function p(y,T,x,S){var A=T!==null?T.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return A!==null?null:l(y,T,""+x,S);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case pm:return x.key===A?c(y,T,x,S):null;case Cc:return x.key===A?d(y,T,x,S):null;case Qa:return A=x._init,p(y,T,A(x._payload),S)}if(uu(x)||eu(x))return A!==null?null:u(y,T,x,S,null);Em(y,x)}return null}function j(y,T,x,S,A){if(typeof S=="string"&&S!==""||typeof S=="number")return y=y.get(x)||null,l(T,y,""+S,A);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case pm:return y=y.get(S.key===null?x:S.key)||null,c(T,y,S,A);case Cc:return y=y.get(S.key===null?x:S.key)||null,d(T,y,S,A);case Qa:var Q=S._init;return j(y,T,x,Q(S._payload),A)}if(uu(S)||eu(S))return y=y.get(x)||null,u(T,y,S,A,null);Em(T,S)}return null}function L(y,T,x,S){for(var A=null,Q=null,q=T,B=T=0,$=null;q!==null&&B<x.length;B++){q.index>B?($=q,q=null):$=q.sibling;var H=p(y,q,x[B],S);if(H===null){q===null&&(q=$);break}n&&q&&H.alternate===null&&e(y,q),T=a(H,T,B),Q===null?A=H:Q.sibling=H,Q=H,q=$}if(B===x.length)return s(y,q),Zs&&fl(y,B),A;if(q===null){for(;B<x.length;B++)q=f(y,x[B],S),q!==null&&(T=a(q,T,B),Q===null?A=q:Q.sibling=q,Q=q);return Zs&&fl(y,B),A}for(q=r(y,q);B<x.length;B++)$=j(q,y,B,x[B],S),$!==null&&(n&&$.alternate!==null&&q.delete($.key===null?B:$.key),T=a($,T,B),Q===null?A=$:Q.sibling=$,Q=$);return n&&q.forEach(function(te){return e(y,te)}),Zs&&fl(y,B),A}function R(y,T,x,S){var A=eu(x);if(typeof A!="function")throw Error(nt(150));if(x=A.call(x),x==null)throw Error(nt(151));for(var Q=A=null,q=T,B=T=0,$=null,H=x.next();q!==null&&!H.done;B++,H=x.next()){q.index>B?($=q,q=null):$=q.sibling;var te=p(y,q,H.value,S);if(te===null){q===null&&(q=$);break}n&&q&&te.alternate===null&&e(y,q),T=a(te,T,B),Q===null?A=te:Q.sibling=te,Q=te,q=$}if(H.done)return s(y,q),Zs&&fl(y,B),A;if(q===null){for(;!H.done;B++,H=x.next())H=f(y,H.value,S),H!==null&&(T=a(H,T,B),Q===null?A=H:Q.sibling=H,Q=H);return Zs&&fl(y,B),A}for(q=r(y,q);!H.done;B++,H=x.next())H=j(q,y,B,H.value,S),H!==null&&(n&&H.alternate!==null&&q.delete(H.key===null?B:H.key),T=a(H,T,B),Q===null?A=H:Q.sibling=H,Q=H);return n&&q.forEach(function(G){return e(y,G)}),Zs&&fl(y,B),A}function D(y,T,x,S){if(typeof x=="object"&&x!==null&&x.type===Ic&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case pm:e:{for(var A=x.key,Q=T;Q!==null;){if(Q.key===A){if(A=x.type,A===Ic){if(Q.tag===7){s(y,Q.sibling),T=i(Q,x.props.children),T.return=y,y=T;break e}}else if(Q.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===Qa&&mv(A)===Q.type){s(y,Q.sibling),T=i(Q,x.props),T.ref=iu(y,Q,x),T.return=y,y=T;break e}s(y,Q);break}else e(y,Q);Q=Q.sibling}x.type===Ic?(T=Il(x.props.children,y.mode,S,x.key),T.return=y,y=T):(S=Ym(x.type,x.key,x.props,null,y.mode,S),S.ref=iu(y,T,x),S.return=y,y=S)}return o(y);case Cc:e:{for(Q=x.key;T!==null;){if(T.key===Q)if(T.tag===4&&T.stateNode.containerInfo===x.containerInfo&&T.stateNode.implementation===x.implementation){s(y,T.sibling),T=i(T,x.children||[]),T.return=y,y=T;break e}else{s(y,T);break}else e(y,T);T=T.sibling}T=Ug(x,y.mode,S),T.return=y,y=T}return o(y);case Qa:return Q=x._init,D(y,T,Q(x._payload),S)}if(uu(x))return L(y,T,x,S);if(eu(x))return R(y,T,x,S);Em(y,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,T!==null&&T.tag===6?(s(y,T.sibling),T=i(T,x),T.return=y,y=T):(s(y,T),T=Mg(x,y.mode,S),T.return=y,y=T),o(y)):s(y,T)}return D}var Zc=fE(!0),gE=fE(!1),bp=Lo(null),wp=null,Lc=null,ib=null;function ab(){ib=Lc=wp=null}function ob(n){var e=bp.current;Ks(bp),n._currentValue=e}function Mx(n,e,s){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===s)break;n=n.return}}function Gc(n,e){wp=n,ib=Lc=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Rr=!0),n.firstContext=null)}function hi(n){var e=n._currentValue;if(ib!==n)if(n={context:n,memoizedValue:e,next:null},Lc===null){if(wp===null)throw Error(nt(308));Lc=n,wp.dependencies={lanes:0,firstContext:n}}else Lc=Lc.next=n;return e}var Nl=null;function lb(n){Nl===null?Nl=[n]:Nl.push(n)}function xE(n,e,s,r){var i=e.interleaved;return i===null?(s.next=s,lb(e)):(s.next=i.next,i.next=s),e.interleaved=s,Ia(n,r)}function Ia(n,e){n.lanes|=e;var s=n.alternate;for(s!==null&&(s.lanes|=e),s=n,n=n.return;n!==null;)n.childLanes|=e,s=n.alternate,s!==null&&(s.childLanes|=e),s=n,n=n.return;return s.tag===3?s.stateNode:null}var Ka=!1;function cb(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function yE(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function va(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function po(n,e,s){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Is&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Ia(n,s)}return i=r.interleaved,i===null?(e.next=e,lb(r)):(e.next=i.next,i.next=e),r.interleaved=e,Ia(n,s)}function Gm(n,e,s){if(e=e.updateQueue,e!==null&&(e=e.shared,(s&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,s|=r,e.lanes=s,Qy(n,s)}}function pv(n,e){var s=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,s===r)){var i=null,a=null;if(s=s.firstBaseUpdate,s!==null){do{var o={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};a===null?i=a=o:a=a.next=o,s=s.next}while(s!==null);a===null?i=a=e:a=a.next=e}else i=a=e;s={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},n.updateQueue=s;return}n=s.lastBaseUpdate,n===null?s.firstBaseUpdate=e:n.next=e,s.lastBaseUpdate=e}function vp(n,e,s,r){var i=n.updateQueue;Ka=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,l=i.shared.pending;if(l!==null){i.shared.pending=null;var c=l,d=c.next;c.next=null,o===null?a=d:o.next=d,o=c;var u=n.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==o&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(a!==null){var f=i.baseState;o=0,u=d=c=null,l=a;do{var p=l.lane,j=l.eventTime;if((r&p)===p){u!==null&&(u=u.next={eventTime:j,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var L=n,R=l;switch(p=e,j=s,R.tag){case 1:if(L=R.payload,typeof L=="function"){f=L.call(j,f,p);break e}f=L;break e;case 3:L.flags=L.flags&-65537|128;case 0:if(L=R.payload,p=typeof L=="function"?L.call(j,f,p):L,p==null)break e;f=an({},f,p);break e;case 2:Ka=!0}}l.callback!==null&&l.lane!==0&&(n.flags|=64,p=i.effects,p===null?i.effects=[l]:p.push(l))}else j={eventTime:j,lane:p,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=j,c=f):u=u.next=j,o|=p;if(l=l.next,l===null){if(l=i.shared.pending,l===null)break;p=l,l=p.next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}while(!0);if(u===null&&(c=f),i.baseState=c,i.firstBaseUpdate=d,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else a===null&&(i.shared.lanes=0);Fl|=o,n.lanes=o,n.memoizedState=f}}function fv(n,e,s){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=s,typeof i!="function")throw Error(nt(191,i));i.call(r)}}}var jh={},Ki=Lo(jh),Ju=Lo(jh),Xu=Lo(jh);function jl(n){if(n===jh)throw Error(nt(174));return n}function db(n,e){switch(Hs(Xu,e),Hs(Ju,n),Hs(Ki,jh),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:yx(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=yx(e,n)}Ks(Ki),Hs(Ki,e)}function ed(){Ks(Ki),Ks(Ju),Ks(Xu)}function bE(n){jl(Xu.current);var e=jl(Ki.current),s=yx(e,n.type);e!==s&&(Hs(Ju,n),Hs(Ki,s))}function ub(n){Ju.current===n&&(Ks(Ki),Ks(Ju))}var sn=Lo(0);function Np(n){for(var e=n;e!==null;){if(e.tag===13){var s=e.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Dg=[];function hb(){for(var n=0;n<Dg.length;n++)Dg[n]._workInProgressVersionPrimary=null;Dg.length=0}var Wm=ka.ReactCurrentDispatcher,Pg=ka.ReactCurrentBatchConfig,Ll=0,rn=null,Cn=null,Un=null,jp=!1,Su=!1,Zu=0,bR=0;function Zn(){throw Error(nt(321))}function mb(n,e){if(e===null)return!1;for(var s=0;s<e.length&&s<n.length;s++)if(!Di(n[s],e[s]))return!1;return!0}function pb(n,e,s,r,i,a){if(Ll=a,rn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Wm.current=n===null||n.memoizedState===null?jR:SR,n=s(r,i),Su){a=0;do{if(Su=!1,Zu=0,25<=a)throw Error(nt(301));a+=1,Un=Cn=null,e.updateQueue=null,Wm.current=ER,n=s(r,i)}while(Su)}if(Wm.current=Sp,e=Cn!==null&&Cn.next!==null,Ll=0,Un=Cn=rn=null,jp=!1,e)throw Error(nt(300));return n}function fb(){var n=Zu!==0;return Zu=0,n}function Bi(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Un===null?rn.memoizedState=Un=n:Un=Un.next=n,Un}function mi(){if(Cn===null){var n=rn.alternate;n=n!==null?n.memoizedState:null}else n=Cn.next;var e=Un===null?rn.memoizedState:Un.next;if(e!==null)Un=e,Cn=n;else{if(n===null)throw Error(nt(310));Cn=n,n={memoizedState:Cn.memoizedState,baseState:Cn.baseState,baseQueue:Cn.baseQueue,queue:Cn.queue,next:null},Un===null?rn.memoizedState=Un=n:Un=Un.next=n}return Un}function eh(n,e){return typeof e=="function"?e(n):e}function kg(n){var e=mi(),s=e.queue;if(s===null)throw Error(nt(311));s.lastRenderedReducer=n;var r=Cn,i=r.baseQueue,a=s.pending;if(a!==null){if(i!==null){var o=i.next;i.next=a.next,a.next=o}r.baseQueue=i=a,s.pending=null}if(i!==null){a=i.next,r=r.baseState;var l=o=null,c=null,d=a;do{var u=d.lane;if((Ll&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:n(r,d.action);else{var f={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=f,o=r):c=c.next=f,rn.lanes|=u,Fl|=u}d=d.next}while(d!==null&&d!==a);c===null?o=r:c.next=l,Di(r,e.memoizedState)||(Rr=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,s.lastRenderedState=r}if(n=s.interleaved,n!==null){i=n;do a=i.lane,rn.lanes|=a,Fl|=a,i=i.next;while(i!==n)}else i===null&&(s.lanes=0);return[e.memoizedState,s.dispatch]}function Lg(n){var e=mi(),s=e.queue;if(s===null)throw Error(nt(311));s.lastRenderedReducer=n;var r=s.dispatch,i=s.pending,a=e.memoizedState;if(i!==null){s.pending=null;var o=i=i.next;do a=n(a,o.action),o=o.next;while(o!==i);Di(a,e.memoizedState)||(Rr=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),s.lastRenderedState=a}return[a,r]}function wE(){}function vE(n,e){var s=rn,r=mi(),i=e(),a=!Di(r.memoizedState,i);if(a&&(r.memoizedState=i,Rr=!0),r=r.queue,gb(SE.bind(null,s,r,n),[n]),r.getSnapshot!==e||a||Un!==null&&Un.memoizedState.tag&1){if(s.flags|=2048,th(9,jE.bind(null,s,r,i,e),void 0,null),Vn===null)throw Error(nt(349));Ll&30||NE(s,e,i)}return i}function NE(n,e,s){n.flags|=16384,n={getSnapshot:e,value:s},e=rn.updateQueue,e===null?(e={lastEffect:null,stores:null},rn.updateQueue=e,e.stores=[n]):(s=e.stores,s===null?e.stores=[n]:s.push(n))}function jE(n,e,s,r){e.value=s,e.getSnapshot=r,EE(e)&&CE(n)}function SE(n,e,s){return s(function(){EE(e)&&CE(n)})}function EE(n){var e=n.getSnapshot;n=n.value;try{var s=e();return!Di(n,s)}catch{return!0}}function CE(n){var e=Ia(n,1);e!==null&&Ai(e,n,1,-1)}function gv(n){var e=Bi();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:eh,lastRenderedState:n},e.queue=n,n=n.dispatch=NR.bind(null,rn,n),[e.memoizedState,n]}function th(n,e,s,r){return n={tag:n,create:e,destroy:s,deps:r,next:null},e=rn.updateQueue,e===null?(e={lastEffect:null,stores:null},rn.updateQueue=e,e.lastEffect=n.next=n):(s=e.lastEffect,s===null?e.lastEffect=n.next=n:(r=s.next,s.next=n,n.next=r,e.lastEffect=n)),n}function IE(){return mi().memoizedState}function qm(n,e,s,r){var i=Bi();rn.flags|=n,i.memoizedState=th(1|e,s,void 0,r===void 0?null:r)}function cf(n,e,s,r){var i=mi();r=r===void 0?null:r;var a=void 0;if(Cn!==null){var o=Cn.memoizedState;if(a=o.destroy,r!==null&&mb(r,o.deps)){i.memoizedState=th(e,s,a,r);return}}rn.flags|=n,i.memoizedState=th(1|e,s,a,r)}function xv(n,e){return qm(8390656,8,n,e)}function gb(n,e){return cf(2048,8,n,e)}function TE(n,e){return cf(4,2,n,e)}function AE(n,e){return cf(4,4,n,e)}function _E(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function RE(n,e,s){return s=s!=null?s.concat([n]):null,cf(4,4,_E.bind(null,e,n),s)}function xb(){}function DE(n,e){var s=mi();e=e===void 0?null:e;var r=s.memoizedState;return r!==null&&e!==null&&mb(e,r[1])?r[0]:(s.memoizedState=[n,e],n)}function PE(n,e){var s=mi();e=e===void 0?null:e;var r=s.memoizedState;return r!==null&&e!==null&&mb(e,r[1])?r[0]:(n=n(),s.memoizedState=[n,e],n)}function kE(n,e,s){return Ll&21?(Di(s,e)||(s=US(),rn.lanes|=s,Fl|=s,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Rr=!0),n.memoizedState=s)}function wR(n,e){var s=Ls;Ls=s!==0&&4>s?s:4,n(!0);var r=Pg.transition;Pg.transition={};try{n(!1),e()}finally{Ls=s,Pg.transition=r}}function LE(){return mi().memoizedState}function vR(n,e,s){var r=go(n);if(s={lane:r,action:s,hasEagerState:!1,eagerState:null,next:null},FE(n))OE(e,s);else if(s=xE(n,e,s,r),s!==null){var i=vr();Ai(s,n,r,i),ME(s,e,r)}}function NR(n,e,s){var r=go(n),i={lane:r,action:s,hasEagerState:!1,eagerState:null,next:null};if(FE(n))OE(e,i);else{var a=n.alternate;if(n.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var o=e.lastRenderedState,l=a(o,s);if(i.hasEagerState=!0,i.eagerState=l,Di(l,o)){var c=e.interleaved;c===null?(i.next=i,lb(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}finally{}s=xE(n,e,i,r),s!==null&&(i=vr(),Ai(s,n,r,i),ME(s,e,r))}}function FE(n){var e=n.alternate;return n===rn||e!==null&&e===rn}function OE(n,e){Su=jp=!0;var s=n.pending;s===null?e.next=e:(e.next=s.next,s.next=e),n.pending=e}function ME(n,e,s){if(s&4194240){var r=e.lanes;r&=n.pendingLanes,s|=r,e.lanes=s,Qy(n,s)}}var Sp={readContext:hi,useCallback:Zn,useContext:Zn,useEffect:Zn,useImperativeHandle:Zn,useInsertionEffect:Zn,useLayoutEffect:Zn,useMemo:Zn,useReducer:Zn,useRef:Zn,useState:Zn,useDebugValue:Zn,useDeferredValue:Zn,useTransition:Zn,useMutableSource:Zn,useSyncExternalStore:Zn,useId:Zn,unstable_isNewReconciler:!1},jR={readContext:hi,useCallback:function(n,e){return Bi().memoizedState=[n,e===void 0?null:e],n},useContext:hi,useEffect:xv,useImperativeHandle:function(n,e,s){return s=s!=null?s.concat([n]):null,qm(4194308,4,_E.bind(null,e,n),s)},useLayoutEffect:function(n,e){return qm(4194308,4,n,e)},useInsertionEffect:function(n,e){return qm(4,2,n,e)},useMemo:function(n,e){var s=Bi();return e=e===void 0?null:e,n=n(),s.memoizedState=[n,e],n},useReducer:function(n,e,s){var r=Bi();return e=s!==void 0?s(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=vR.bind(null,rn,n),[r.memoizedState,n]},useRef:function(n){var e=Bi();return n={current:n},e.memoizedState=n},useState:gv,useDebugValue:xb,useDeferredValue:function(n){return Bi().memoizedState=n},useTransition:function(){var n=gv(!1),e=n[0];return n=wR.bind(null,n[1]),Bi().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,s){var r=rn,i=Bi();if(Zs){if(s===void 0)throw Error(nt(407));s=s()}else{if(s=e(),Vn===null)throw Error(nt(349));Ll&30||NE(r,e,s)}i.memoizedState=s;var a={value:s,getSnapshot:e};return i.queue=a,xv(SE.bind(null,r,a,n),[n]),r.flags|=2048,th(9,jE.bind(null,r,a,s,e),void 0,null),s},useId:function(){var n=Bi(),e=Vn.identifierPrefix;if(Zs){var s=ga,r=fa;s=(r&~(1<<32-Ti(r)-1)).toString(32)+s,e=":"+e+"R"+s,s=Zu++,0<s&&(e+="H"+s.toString(32)),e+=":"}else s=bR++,e=":"+e+"r"+s.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},SR={readContext:hi,useCallback:DE,useContext:hi,useEffect:gb,useImperativeHandle:RE,useInsertionEffect:TE,useLayoutEffect:AE,useMemo:PE,useReducer:kg,useRef:IE,useState:function(){return kg(eh)},useDebugValue:xb,useDeferredValue:function(n){var e=mi();return kE(e,Cn.memoizedState,n)},useTransition:function(){var n=kg(eh)[0],e=mi().memoizedState;return[n,e]},useMutableSource:wE,useSyncExternalStore:vE,useId:LE,unstable_isNewReconciler:!1},ER={readContext:hi,useCallback:DE,useContext:hi,useEffect:gb,useImperativeHandle:RE,useInsertionEffect:TE,useLayoutEffect:AE,useMemo:PE,useReducer:Lg,useRef:IE,useState:function(){return Lg(eh)},useDebugValue:xb,useDeferredValue:function(n){var e=mi();return Cn===null?e.memoizedState=n:kE(e,Cn.memoizedState,n)},useTransition:function(){var n=Lg(eh)[0],e=mi().memoizedState;return[n,e]},useMutableSource:wE,useSyncExternalStore:vE,useId:LE,unstable_isNewReconciler:!1};function Ni(n,e){if(n&&n.defaultProps){e=an({},e),n=n.defaultProps;for(var s in n)e[s]===void 0&&(e[s]=n[s]);return e}return e}function Ux(n,e,s,r){e=n.memoizedState,s=s(r,e),s=s==null?e:an({},e,s),n.memoizedState=s,n.lanes===0&&(n.updateQueue.baseState=s)}var df={isMounted:function(n){return(n=n._reactInternals)?Kl(n)===n:!1},enqueueSetState:function(n,e,s){n=n._reactInternals;var r=vr(),i=go(n),a=va(r,i);a.payload=e,s!=null&&(a.callback=s),e=po(n,a,i),e!==null&&(Ai(e,n,i,r),Gm(e,n,i))},enqueueReplaceState:function(n,e,s){n=n._reactInternals;var r=vr(),i=go(n),a=va(r,i);a.tag=1,a.payload=e,s!=null&&(a.callback=s),e=po(n,a,i),e!==null&&(Ai(e,n,i,r),Gm(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var s=vr(),r=go(n),i=va(s,r);i.tag=2,e!=null&&(i.callback=e),e=po(n,i,r),e!==null&&(Ai(e,n,r,s),Gm(e,n,r))}};function yv(n,e,s,r,i,a,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,a,o):e.prototype&&e.prototype.isPureReactComponent?!Hu(s,r)||!Hu(i,a):!0}function UE(n,e,s){var r=!1,i=Eo,a=e.contextType;return typeof a=="object"&&a!==null?a=hi(a):(i=kr(e)?Pl:or.current,r=e.contextTypes,a=(r=r!=null)?Jc(n,i):Eo),e=new e(s,a),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=df,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=a),e}function bv(n,e,s,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(s,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(s,r),e.state!==n&&df.enqueueReplaceState(e,e.state,null)}function $x(n,e,s,r){var i=n.stateNode;i.props=s,i.state=n.memoizedState,i.refs={},cb(n);var a=e.contextType;typeof a=="object"&&a!==null?i.context=hi(a):(a=kr(e)?Pl:or.current,i.context=Jc(n,a)),i.state=n.memoizedState,a=e.getDerivedStateFromProps,typeof a=="function"&&(Ux(n,e,a,s),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&df.enqueueReplaceState(i,i.state,null),vp(n,s,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function td(n,e){try{var s="",r=e;do s+=Z_(r),r=r.return;while(r);var i=s}catch(a){i=`
Error generating stack: `+a.message+`
`+a.stack}return{value:n,source:e,stack:i,digest:null}}function Fg(n,e,s){return{value:n,source:null,stack:s??null,digest:e??null}}function zx(n,e){try{console.error(e.value)}catch(s){setTimeout(function(){throw s})}}var CR=typeof WeakMap=="function"?WeakMap:Map;function $E(n,e,s){s=va(-1,s),s.tag=3,s.payload={element:null};var r=e.value;return s.callback=function(){Cp||(Cp=!0,Jx=r),zx(n,e)},s}function zE(n,e,s){s=va(-1,s),s.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;s.payload=function(){return r(i)},s.callback=function(){zx(n,e)}}var a=n.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(s.callback=function(){zx(n,e),typeof r!="function"&&(fo===null?fo=new Set([this]):fo.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),s}function wv(n,e,s){var r=n.pingCache;if(r===null){r=n.pingCache=new CR;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(s)||(i.add(s),n=$R.bind(null,n,e,s),e.then(n,n))}function vv(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function Nv(n,e,s,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(e=va(-1,1),e.tag=2,po(s,e,1))),s.lanes|=1),n)}var IR=ka.ReactCurrentOwner,Rr=!1;function yr(n,e,s,r){e.child=n===null?gE(e,null,s,r):Zc(e,n.child,s,r)}function jv(n,e,s,r,i){s=s.render;var a=e.ref;return Gc(e,i),r=pb(n,e,s,r,a,i),s=fb(),n!==null&&!Rr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Ta(n,e,i)):(Zs&&s&&sb(e),e.flags|=1,yr(n,e,r,i),e.child)}function Sv(n,e,s,r,i){if(n===null){var a=s.type;return typeof a=="function"&&!Eb(a)&&a.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(e.tag=15,e.type=a,VE(n,e,a,r,i)):(n=Ym(s.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(a=n.child,!(n.lanes&i)){var o=a.memoizedProps;if(s=s.compare,s=s!==null?s:Hu,s(o,r)&&n.ref===e.ref)return Ta(n,e,i)}return e.flags|=1,n=xo(a,r),n.ref=e.ref,n.return=e,e.child=n}function VE(n,e,s,r,i){if(n!==null){var a=n.memoizedProps;if(Hu(a,r)&&n.ref===e.ref)if(Rr=!1,e.pendingProps=r=a,(n.lanes&i)!==0)n.flags&131072&&(Rr=!0);else return e.lanes=n.lanes,Ta(n,e,i)}return Vx(n,e,s,r,i)}function BE(n,e,s){var r=e.pendingProps,i=r.children,a=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Hs(Oc,zr),zr|=s;else{if(!(s&1073741824))return n=a!==null?a.baseLanes|s:s,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Hs(Oc,zr),zr|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a!==null?a.baseLanes:s,Hs(Oc,zr),zr|=r}else a!==null?(r=a.baseLanes|s,e.memoizedState=null):r=s,Hs(Oc,zr),zr|=r;return yr(n,e,i,s),e.child}function GE(n,e){var s=e.ref;(n===null&&s!==null||n!==null&&n.ref!==s)&&(e.flags|=512,e.flags|=2097152)}function Vx(n,e,s,r,i){var a=kr(s)?Pl:or.current;return a=Jc(e,a),Gc(e,i),s=pb(n,e,s,r,a,i),r=fb(),n!==null&&!Rr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Ta(n,e,i)):(Zs&&r&&sb(e),e.flags|=1,yr(n,e,s,i),e.child)}function Ev(n,e,s,r,i){if(kr(s)){var a=!0;gp(e)}else a=!1;if(Gc(e,i),e.stateNode===null)Hm(n,e),UE(e,s,r),$x(e,s,r,i),r=!0;else if(n===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,d=s.contextType;typeof d=="object"&&d!==null?d=hi(d):(d=kr(s)?Pl:or.current,d=Jc(e,d));var u=s.getDerivedStateFromProps,f=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||c!==d)&&bv(e,o,r,d),Ka=!1;var p=e.memoizedState;o.state=p,vp(e,r,o,i),c=e.memoizedState,l!==r||p!==c||Pr.current||Ka?(typeof u=="function"&&(Ux(e,s,u,r),c=e.memoizedState),(l=Ka||yv(e,s,l,r,p,c,d))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=d,r=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,yE(n,e),l=e.memoizedProps,d=e.type===e.elementType?l:Ni(e.type,l),o.props=d,f=e.pendingProps,p=o.context,c=s.contextType,typeof c=="object"&&c!==null?c=hi(c):(c=kr(s)?Pl:or.current,c=Jc(e,c));var j=s.getDerivedStateFromProps;(u=typeof j=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==f||p!==c)&&bv(e,o,r,c),Ka=!1,p=e.memoizedState,o.state=p,vp(e,r,o,i);var L=e.memoizedState;l!==f||p!==L||Pr.current||Ka?(typeof j=="function"&&(Ux(e,s,j,r),L=e.memoizedState),(d=Ka||yv(e,s,d,r,p,L,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,L,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,L,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=L),o.props=r,o.state=L,o.context=c,r=d):(typeof o.componentDidUpdate!="function"||l===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),r=!1)}return Bx(n,e,s,r,a,i)}function Bx(n,e,s,r,i,a){GE(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&dv(e,s,!1),Ta(n,e,a);r=e.stateNode,IR.current=e;var l=o&&typeof s.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=Zc(e,n.child,null,a),e.child=Zc(e,null,l,a)):yr(n,e,l,a),e.memoizedState=r.state,i&&dv(e,s,!0),e.child}function WE(n){var e=n.stateNode;e.pendingContext?cv(n,e.pendingContext,e.pendingContext!==e.context):e.context&&cv(n,e.context,!1),db(n,e.containerInfo)}function Cv(n,e,s,r,i){return Xc(),rb(i),e.flags|=256,yr(n,e,s,r),e.child}var Gx={dehydrated:null,treeContext:null,retryLane:0};function Wx(n){return{baseLanes:n,cachePool:null,transitions:null}}function qE(n,e,s){var r=e.pendingProps,i=sn.current,a=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=n!==null&&n.memoizedState===null?!1:(i&2)!==0),l?(a=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),Hs(sn,i&1),n===null)return Ox(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,a?(r=e.mode,a=e.child,o={mode:"hidden",children:o},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=o):a=mf(o,r,0,null),n=Il(n,r,s,null),a.return=e,n.return=e,a.sibling=n,e.child=a,e.child.memoizedState=Wx(s),e.memoizedState=Gx,n):yb(e,o));if(i=n.memoizedState,i!==null&&(l=i.dehydrated,l!==null))return TR(n,e,o,r,l,i,s);if(a){a=r.fallback,o=e.mode,i=n.child,l=i.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=xo(i,c),r.subtreeFlags=i.subtreeFlags&14680064),l!==null?a=xo(l,a):(a=Il(a,o,s,null),a.flags|=2),a.return=e,r.return=e,r.sibling=a,e.child=r,r=a,a=e.child,o=n.child.memoizedState,o=o===null?Wx(s):{baseLanes:o.baseLanes|s,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=n.childLanes&~s,e.memoizedState=Gx,r}return a=n.child,n=a.sibling,r=xo(a,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=s),r.return=e,r.sibling=null,n!==null&&(s=e.deletions,s===null?(e.deletions=[n],e.flags|=16):s.push(n)),e.child=r,e.memoizedState=null,r}function yb(n,e){return e=mf({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Cm(n,e,s,r){return r!==null&&rb(r),Zc(e,n.child,null,s),n=yb(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function TR(n,e,s,r,i,a,o){if(s)return e.flags&256?(e.flags&=-257,r=Fg(Error(nt(422))),Cm(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(a=r.fallback,i=e.mode,r=mf({mode:"visible",children:r.children},i,0,null),a=Il(a,i,o,null),a.flags|=2,r.return=e,a.return=e,r.sibling=a,e.child=r,e.mode&1&&Zc(e,n.child,null,o),e.child.memoizedState=Wx(o),e.memoizedState=Gx,a);if(!(e.mode&1))return Cm(n,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var l=r.dgst;return r=l,a=Error(nt(419)),r=Fg(a,r,void 0),Cm(n,e,o,r)}if(l=(o&n.childLanes)!==0,Rr||l){if(r=Vn,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==a.retryLane&&(a.retryLane=i,Ia(n,i),Ai(r,n,i,-1))}return Sb(),r=Fg(Error(nt(421))),Cm(n,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=zR.bind(null,n),i._reactRetry=e,null):(n=a.treeContext,Br=mo(i.nextSibling),qr=e,Zs=!0,Ci=null,n!==null&&(oi[li++]=fa,oi[li++]=ga,oi[li++]=kl,fa=n.id,ga=n.overflow,kl=e),e=yb(e,r.children),e.flags|=4096,e)}function Iv(n,e,s){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),Mx(n.return,e,s)}function Og(n,e,s,r,i){var a=n.memoizedState;a===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:s,tailMode:i}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=s,a.tailMode=i)}function HE(n,e,s){var r=e.pendingProps,i=r.revealOrder,a=r.tail;if(yr(n,e,r.children,s),r=sn.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Iv(n,s,e);else if(n.tag===19)Iv(n,s,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Hs(sn,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(s=e.child,i=null;s!==null;)n=s.alternate,n!==null&&Np(n)===null&&(i=s),s=s.sibling;s=i,s===null?(i=e.child,e.child=null):(i=s.sibling,s.sibling=null),Og(e,!1,i,s,a);break;case"backwards":for(s=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&Np(n)===null){e.child=i;break}n=i.sibling,i.sibling=s,s=i,i=n}Og(e,!0,s,null,a);break;case"together":Og(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Hm(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Ta(n,e,s){if(n!==null&&(e.dependencies=n.dependencies),Fl|=e.lanes,!(s&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(nt(153));if(e.child!==null){for(n=e.child,s=xo(n,n.pendingProps),e.child=s,s.return=e;n.sibling!==null;)n=n.sibling,s=s.sibling=xo(n,n.pendingProps),s.return=e;s.sibling=null}return e.child}function AR(n,e,s){switch(e.tag){case 3:WE(e),Xc();break;case 5:bE(e);break;case 1:kr(e.type)&&gp(e);break;case 4:db(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;Hs(bp,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Hs(sn,sn.current&1),e.flags|=128,null):s&e.child.childLanes?qE(n,e,s):(Hs(sn,sn.current&1),n=Ta(n,e,s),n!==null?n.sibling:null);Hs(sn,sn.current&1);break;case 19:if(r=(s&e.childLanes)!==0,n.flags&128){if(r)return HE(n,e,s);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Hs(sn,sn.current),r)break;return null;case 22:case 23:return e.lanes=0,BE(n,e,s)}return Ta(n,e,s)}var QE,qx,KE,YE;QE=function(n,e){for(var s=e.child;s!==null;){if(s.tag===5||s.tag===6)n.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};qx=function(){};KE=function(n,e,s,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,jl(Ki.current);var a=null;switch(s){case"input":i=px(n,i),r=px(n,r),a=[];break;case"select":i=an({},i,{value:void 0}),r=an({},r,{value:void 0}),a=[];break;case"textarea":i=xx(n,i),r=xx(n,r),a=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=pp)}bx(s,r);var o;s=null;for(d in i)if(!r.hasOwnProperty(d)&&i.hasOwnProperty(d)&&i[d]!=null)if(d==="style"){var l=i[d];for(o in l)l.hasOwnProperty(o)&&(s||(s={}),s[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&($u.hasOwnProperty(d)?a||(a=[]):(a=a||[]).push(d,null));for(d in r){var c=r[d];if(l=i!=null?i[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(s||(s={}),s[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(s||(s={}),s[o]=c[o])}else s||(a||(a=[]),a.push(d,s)),s=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(a=a||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(a=a||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&($u.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Qs("scroll",n),a||l===c||(a=[])):(a=a||[]).push(d,c))}s&&(a=a||[]).push("style",s);var d=a;(e.updateQueue=d)&&(e.flags|=4)}};YE=function(n,e,s,r){s!==r&&(e.flags|=4)};function au(n,e){if(!Zs)switch(n.tailMode){case"hidden":e=n.tail;for(var s=null;e!==null;)e.alternate!==null&&(s=e),e=e.sibling;s===null?n.tail=null:s.sibling=null;break;case"collapsed":s=n.tail;for(var r=null;s!==null;)s.alternate!==null&&(r=s),s=s.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function er(n){var e=n.alternate!==null&&n.alternate.child===n.child,s=0,r=0;if(e)for(var i=n.child;i!==null;)s|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)s|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=s,e}function _R(n,e,s){var r=e.pendingProps;switch(nb(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return er(e),null;case 1:return kr(e.type)&&fp(),er(e),null;case 3:return r=e.stateNode,ed(),Ks(Pr),Ks(or),hb(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(Sm(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ci!==null&&(ey(Ci),Ci=null))),qx(n,e),er(e),null;case 5:ub(e);var i=jl(Xu.current);if(s=e.type,n!==null&&e.stateNode!=null)KE(n,e,s,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(nt(166));return er(e),null}if(n=jl(Ki.current),Sm(e)){r=e.stateNode,s=e.type;var a=e.memoizedProps;switch(r[Wi]=e,r[Yu]=a,n=(e.mode&1)!==0,s){case"dialog":Qs("cancel",r),Qs("close",r);break;case"iframe":case"object":case"embed":Qs("load",r);break;case"video":case"audio":for(i=0;i<mu.length;i++)Qs(mu[i],r);break;case"source":Qs("error",r);break;case"img":case"image":case"link":Qs("error",r),Qs("load",r);break;case"details":Qs("toggle",r);break;case"input":Fw(r,a),Qs("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},Qs("invalid",r);break;case"textarea":Mw(r,a),Qs("invalid",r)}bx(s,a),i=null;for(var o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="children"?typeof l=="string"?r.textContent!==l&&(a.suppressHydrationWarning!==!0&&jm(r.textContent,l,n),i=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(a.suppressHydrationWarning!==!0&&jm(r.textContent,l,n),i=["children",""+l]):$u.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&Qs("scroll",r)}switch(s){case"input":fm(r),Ow(r,a,!0);break;case"textarea":fm(r),Uw(r);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(r.onclick=pp)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=SS(s)),n==="http://www.w3.org/1999/xhtml"?s==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(s,{is:r.is}):(n=o.createElement(s),s==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,s),n[Wi]=e,n[Yu]=r,QE(n,e,!1,!1),e.stateNode=n;e:{switch(o=wx(s,r),s){case"dialog":Qs("cancel",n),Qs("close",n),i=r;break;case"iframe":case"object":case"embed":Qs("load",n),i=r;break;case"video":case"audio":for(i=0;i<mu.length;i++)Qs(mu[i],n);i=r;break;case"source":Qs("error",n),i=r;break;case"img":case"image":case"link":Qs("error",n),Qs("load",n),i=r;break;case"details":Qs("toggle",n),i=r;break;case"input":Fw(n,r),i=px(n,r),Qs("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=an({},r,{value:void 0}),Qs("invalid",n);break;case"textarea":Mw(n,r),i=xx(n,r),Qs("invalid",n);break;default:i=r}bx(s,i),l=i;for(a in l)if(l.hasOwnProperty(a)){var c=l[a];a==="style"?IS(n,c):a==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&ES(n,c)):a==="children"?typeof c=="string"?(s!=="textarea"||c!=="")&&zu(n,c):typeof c=="number"&&zu(n,""+c):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&($u.hasOwnProperty(a)?c!=null&&a==="onScroll"&&Qs("scroll",n):c!=null&&Vy(n,a,c,o))}switch(s){case"input":fm(n),Ow(n,r,!1);break;case"textarea":fm(n),Uw(n);break;case"option":r.value!=null&&n.setAttribute("value",""+So(r.value));break;case"select":n.multiple=!!r.multiple,a=r.value,a!=null?$c(n,!!r.multiple,a,!1):r.defaultValue!=null&&$c(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=pp)}switch(s){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return er(e),null;case 6:if(n&&e.stateNode!=null)YE(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(nt(166));if(s=jl(Xu.current),jl(Ki.current),Sm(e)){if(r=e.stateNode,s=e.memoizedProps,r[Wi]=e,(a=r.nodeValue!==s)&&(n=qr,n!==null))switch(n.tag){case 3:jm(r.nodeValue,s,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&jm(r.nodeValue,s,(n.mode&1)!==0)}a&&(e.flags|=4)}else r=(s.nodeType===9?s:s.ownerDocument).createTextNode(r),r[Wi]=e,e.stateNode=r}return er(e),null;case 13:if(Ks(sn),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Zs&&Br!==null&&e.mode&1&&!(e.flags&128))pE(),Xc(),e.flags|=98560,a=!1;else if(a=Sm(e),r!==null&&r.dehydrated!==null){if(n===null){if(!a)throw Error(nt(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(nt(317));a[Wi]=e}else Xc(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;er(e),a=!1}else Ci!==null&&(ey(Ci),Ci=null),a=!0;if(!a)return e.flags&65536?e:null}return e.flags&128?(e.lanes=s,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||sn.current&1?_n===0&&(_n=3):Sb())),e.updateQueue!==null&&(e.flags|=4),er(e),null);case 4:return ed(),qx(n,e),n===null&&Qu(e.stateNode.containerInfo),er(e),null;case 10:return ob(e.type._context),er(e),null;case 17:return kr(e.type)&&fp(),er(e),null;case 19:if(Ks(sn),a=e.memoizedState,a===null)return er(e),null;if(r=(e.flags&128)!==0,o=a.rendering,o===null)if(r)au(a,!1);else{if(_n!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Np(n),o!==null){for(e.flags|=128,au(a,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=s,s=e.child;s!==null;)a=s,n=r,a.flags&=14680066,o=a.alternate,o===null?(a.childLanes=0,a.lanes=n,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,n=o.dependencies,a.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),s=s.sibling;return Hs(sn,sn.current&1|2),e.child}n=n.sibling}a.tail!==null&&xn()>sd&&(e.flags|=128,r=!0,au(a,!1),e.lanes=4194304)}else{if(!r)if(n=Np(o),n!==null){if(e.flags|=128,r=!0,s=n.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),au(a,!0),a.tail===null&&a.tailMode==="hidden"&&!o.alternate&&!Zs)return er(e),null}else 2*xn()-a.renderingStartTime>sd&&s!==1073741824&&(e.flags|=128,r=!0,au(a,!1),e.lanes=4194304);a.isBackwards?(o.sibling=e.child,e.child=o):(s=a.last,s!==null?s.sibling=o:e.child=o,a.last=o)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=xn(),e.sibling=null,s=sn.current,Hs(sn,r?s&1|2:s&1),e):(er(e),null);case 22:case 23:return jb(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?zr&1073741824&&(er(e),e.subtreeFlags&6&&(e.flags|=8192)):er(e),null;case 24:return null;case 25:return null}throw Error(nt(156,e.tag))}function RR(n,e){switch(nb(e),e.tag){case 1:return kr(e.type)&&fp(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return ed(),Ks(Pr),Ks(or),hb(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return ub(e),null;case 13:if(Ks(sn),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(nt(340));Xc()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Ks(sn),null;case 4:return ed(),null;case 10:return ob(e.type._context),null;case 22:case 23:return jb(),null;case 24:return null;default:return null}}var Im=!1,nr=!1,DR=typeof WeakSet=="function"?WeakSet:Set,Nt=null;function Fc(n,e){var s=n.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(r){un(n,e,r)}else s.current=null}function Hx(n,e,s){try{s()}catch(r){un(n,e,r)}}var Tv=!1;function PR(n,e){if(_x=up,n=tE(),tb(n)){if("selectionStart"in n)var s={start:n.selectionStart,end:n.selectionEnd};else e:{s=(s=n.ownerDocument)&&s.defaultView||window;var r=s.getSelection&&s.getSelection();if(r&&r.rangeCount!==0){s=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{s.nodeType,a.nodeType}catch{s=null;break e}var o=0,l=-1,c=-1,d=0,u=0,f=n,p=null;t:for(;;){for(var j;f!==s||i!==0&&f.nodeType!==3||(l=o+i),f!==a||r!==0&&f.nodeType!==3||(c=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(j=f.firstChild)!==null;)p=f,f=j;for(;;){if(f===n)break t;if(p===s&&++d===i&&(l=o),p===a&&++u===r&&(c=o),(j=f.nextSibling)!==null)break;f=p,p=f.parentNode}f=j}s=l===-1||c===-1?null:{start:l,end:c}}else s=null}s=s||{start:0,end:0}}else s=null;for(Rx={focusedElem:n,selectionRange:s},up=!1,Nt=e;Nt!==null;)if(e=Nt,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,Nt=n;else for(;Nt!==null;){e=Nt;try{var L=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(L!==null){var R=L.memoizedProps,D=L.memoizedState,y=e.stateNode,T=y.getSnapshotBeforeUpdate(e.elementType===e.type?R:Ni(e.type,R),D);y.__reactInternalSnapshotBeforeUpdate=T}break;case 3:var x=e.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(nt(163))}}catch(S){un(e,e.return,S)}if(n=e.sibling,n!==null){n.return=e.return,Nt=n;break}Nt=e.return}return L=Tv,Tv=!1,L}function Eu(n,e,s){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var a=i.destroy;i.destroy=void 0,a!==void 0&&Hx(e,s,a)}i=i.next}while(i!==r)}}function uf(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var s=e=e.next;do{if((s.tag&n)===n){var r=s.create;s.destroy=r()}s=s.next}while(s!==e)}}function Qx(n){var e=n.ref;if(e!==null){var s=n.stateNode;switch(n.tag){case 5:n=s;break;default:n=s}typeof e=="function"?e(n):e.current=n}}function JE(n){var e=n.alternate;e!==null&&(n.alternate=null,JE(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Wi],delete e[Yu],delete e[kx],delete e[fR],delete e[gR])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function XE(n){return n.tag===5||n.tag===3||n.tag===4}function Av(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||XE(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Kx(n,e,s){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?s.nodeType===8?s.parentNode.insertBefore(n,e):s.insertBefore(n,e):(s.nodeType===8?(e=s.parentNode,e.insertBefore(n,s)):(e=s,e.appendChild(n)),s=s._reactRootContainer,s!=null||e.onclick!==null||(e.onclick=pp));else if(r!==4&&(n=n.child,n!==null))for(Kx(n,e,s),n=n.sibling;n!==null;)Kx(n,e,s),n=n.sibling}function Yx(n,e,s){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?s.insertBefore(n,e):s.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Yx(n,e,s),n=n.sibling;n!==null;)Yx(n,e,s),n=n.sibling}var Wn=null,ji=!1;function Wa(n,e,s){for(s=s.child;s!==null;)ZE(n,e,s),s=s.sibling}function ZE(n,e,s){if(Qi&&typeof Qi.onCommitFiberUnmount=="function")try{Qi.onCommitFiberUnmount(sf,s)}catch{}switch(s.tag){case 5:nr||Fc(s,e);case 6:var r=Wn,i=ji;Wn=null,Wa(n,e,s),Wn=r,ji=i,Wn!==null&&(ji?(n=Wn,s=s.stateNode,n.nodeType===8?n.parentNode.removeChild(s):n.removeChild(s)):Wn.removeChild(s.stateNode));break;case 18:Wn!==null&&(ji?(n=Wn,s=s.stateNode,n.nodeType===8?_g(n.parentNode,s):n.nodeType===1&&_g(n,s),Wu(n)):_g(Wn,s.stateNode));break;case 4:r=Wn,i=ji,Wn=s.stateNode.containerInfo,ji=!0,Wa(n,e,s),Wn=r,ji=i;break;case 0:case 11:case 14:case 15:if(!nr&&(r=s.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var a=i,o=a.destroy;a=a.tag,o!==void 0&&(a&2||a&4)&&Hx(s,e,o),i=i.next}while(i!==r)}Wa(n,e,s);break;case 1:if(!nr&&(Fc(s,e),r=s.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=s.memoizedProps,r.state=s.memoizedState,r.componentWillUnmount()}catch(l){un(s,e,l)}Wa(n,e,s);break;case 21:Wa(n,e,s);break;case 22:s.mode&1?(nr=(r=nr)||s.memoizedState!==null,Wa(n,e,s),nr=r):Wa(n,e,s);break;default:Wa(n,e,s)}}function _v(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var s=n.stateNode;s===null&&(s=n.stateNode=new DR),e.forEach(function(r){var i=VR.bind(null,n,r);s.has(r)||(s.add(r),r.then(i,i))})}}function bi(n,e){var s=e.deletions;if(s!==null)for(var r=0;r<s.length;r++){var i=s[r];try{var a=n,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:Wn=l.stateNode,ji=!1;break e;case 3:Wn=l.stateNode.containerInfo,ji=!0;break e;case 4:Wn=l.stateNode.containerInfo,ji=!0;break e}l=l.return}if(Wn===null)throw Error(nt(160));ZE(a,o,i),Wn=null,ji=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(d){un(i,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)eC(e,n),e=e.sibling}function eC(n,e){var s=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(bi(e,n),$i(n),r&4){try{Eu(3,n,n.return),uf(3,n)}catch(R){un(n,n.return,R)}try{Eu(5,n,n.return)}catch(R){un(n,n.return,R)}}break;case 1:bi(e,n),$i(n),r&512&&s!==null&&Fc(s,s.return);break;case 5:if(bi(e,n),$i(n),r&512&&s!==null&&Fc(s,s.return),n.flags&32){var i=n.stateNode;try{zu(i,"")}catch(R){un(n,n.return,R)}}if(r&4&&(i=n.stateNode,i!=null)){var a=n.memoizedProps,o=s!==null?s.memoizedProps:a,l=n.type,c=n.updateQueue;if(n.updateQueue=null,c!==null)try{l==="input"&&a.type==="radio"&&a.name!=null&&NS(i,a),wx(l,o);var d=wx(l,a);for(o=0;o<c.length;o+=2){var u=c[o],f=c[o+1];u==="style"?IS(i,f):u==="dangerouslySetInnerHTML"?ES(i,f):u==="children"?zu(i,f):Vy(i,u,f,d)}switch(l){case"input":fx(i,a);break;case"textarea":jS(i,a);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var j=a.value;j!=null?$c(i,!!a.multiple,j,!1):p!==!!a.multiple&&(a.defaultValue!=null?$c(i,!!a.multiple,a.defaultValue,!0):$c(i,!!a.multiple,a.multiple?[]:"",!1))}i[Yu]=a}catch(R){un(n,n.return,R)}}break;case 6:if(bi(e,n),$i(n),r&4){if(n.stateNode===null)throw Error(nt(162));i=n.stateNode,a=n.memoizedProps;try{i.nodeValue=a}catch(R){un(n,n.return,R)}}break;case 3:if(bi(e,n),$i(n),r&4&&s!==null&&s.memoizedState.isDehydrated)try{Wu(e.containerInfo)}catch(R){un(n,n.return,R)}break;case 4:bi(e,n),$i(n);break;case 13:bi(e,n),$i(n),i=n.child,i.flags&8192&&(a=i.memoizedState!==null,i.stateNode.isHidden=a,!a||i.alternate!==null&&i.alternate.memoizedState!==null||(vb=xn())),r&4&&_v(n);break;case 22:if(u=s!==null&&s.memoizedState!==null,n.mode&1?(nr=(d=nr)||u,bi(e,n),nr=d):bi(e,n),$i(n),r&8192){if(d=n.memoizedState!==null,(n.stateNode.isHidden=d)&&!u&&n.mode&1)for(Nt=n,u=n.child;u!==null;){for(f=Nt=u;Nt!==null;){switch(p=Nt,j=p.child,p.tag){case 0:case 11:case 14:case 15:Eu(4,p,p.return);break;case 1:Fc(p,p.return);var L=p.stateNode;if(typeof L.componentWillUnmount=="function"){r=p,s=p.return;try{e=r,L.props=e.memoizedProps,L.state=e.memoizedState,L.componentWillUnmount()}catch(R){un(r,s,R)}}break;case 5:Fc(p,p.return);break;case 22:if(p.memoizedState!==null){Dv(f);continue}}j!==null?(j.return=p,Nt=j):Dv(f)}u=u.sibling}e:for(u=null,f=n;;){if(f.tag===5){if(u===null){u=f;try{i=f.stateNode,d?(a=i.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(l=f.stateNode,c=f.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=CS("display",o))}catch(R){un(n,n.return,R)}}}else if(f.tag===6){if(u===null)try{f.stateNode.nodeValue=d?"":f.memoizedProps}catch(R){un(n,n.return,R)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===n)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===n)break e;for(;f.sibling===null;){if(f.return===null||f.return===n)break e;u===f&&(u=null),f=f.return}u===f&&(u=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:bi(e,n),$i(n),r&4&&_v(n);break;case 21:break;default:bi(e,n),$i(n)}}function $i(n){var e=n.flags;if(e&2){try{e:{for(var s=n.return;s!==null;){if(XE(s)){var r=s;break e}s=s.return}throw Error(nt(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(zu(i,""),r.flags&=-33);var a=Av(n);Yx(n,a,i);break;case 3:case 4:var o=r.stateNode.containerInfo,l=Av(n);Kx(n,l,o);break;default:throw Error(nt(161))}}catch(c){un(n,n.return,c)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function kR(n,e,s){Nt=n,tC(n)}function tC(n,e,s){for(var r=(n.mode&1)!==0;Nt!==null;){var i=Nt,a=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||Im;if(!o){var l=i.alternate,c=l!==null&&l.memoizedState!==null||nr;l=Im;var d=nr;if(Im=o,(nr=c)&&!d)for(Nt=i;Nt!==null;)o=Nt,c=o.child,o.tag===22&&o.memoizedState!==null?Pv(i):c!==null?(c.return=o,Nt=c):Pv(i);for(;a!==null;)Nt=a,tC(a),a=a.sibling;Nt=i,Im=l,nr=d}Rv(n)}else i.subtreeFlags&8772&&a!==null?(a.return=i,Nt=a):Rv(n)}}function Rv(n){for(;Nt!==null;){var e=Nt;if(e.flags&8772){var s=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:nr||uf(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!nr)if(s===null)r.componentDidMount();else{var i=e.elementType===e.type?s.memoizedProps:Ni(e.type,s.memoizedProps);r.componentDidUpdate(i,s.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;a!==null&&fv(e,a,r);break;case 3:var o=e.updateQueue;if(o!==null){if(s=null,e.child!==null)switch(e.child.tag){case 5:s=e.child.stateNode;break;case 1:s=e.child.stateNode}fv(e,o,s)}break;case 5:var l=e.stateNode;if(s===null&&e.flags&4){s=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&s.focus();break;case"img":c.src&&(s.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var f=u.dehydrated;f!==null&&Wu(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(nt(163))}nr||e.flags&512&&Qx(e)}catch(p){un(e,e.return,p)}}if(e===n){Nt=null;break}if(s=e.sibling,s!==null){s.return=e.return,Nt=s;break}Nt=e.return}}function Dv(n){for(;Nt!==null;){var e=Nt;if(e===n){Nt=null;break}var s=e.sibling;if(s!==null){s.return=e.return,Nt=s;break}Nt=e.return}}function Pv(n){for(;Nt!==null;){var e=Nt;try{switch(e.tag){case 0:case 11:case 15:var s=e.return;try{uf(4,e)}catch(c){un(e,s,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(c){un(e,i,c)}}var a=e.return;try{Qx(e)}catch(c){un(e,a,c)}break;case 5:var o=e.return;try{Qx(e)}catch(c){un(e,o,c)}}}catch(c){un(e,e.return,c)}if(e===n){Nt=null;break}var l=e.sibling;if(l!==null){l.return=e.return,Nt=l;break}Nt=e.return}}var LR=Math.ceil,Ep=ka.ReactCurrentDispatcher,bb=ka.ReactCurrentOwner,ui=ka.ReactCurrentBatchConfig,Is=0,Vn=null,wn=null,Hn=0,zr=0,Oc=Lo(0),_n=0,sh=null,Fl=0,hf=0,wb=0,Cu=null,Ir=null,vb=0,sd=1/0,ma=null,Cp=!1,Jx=null,fo=null,Tm=!1,io=null,Ip=0,Iu=0,Xx=null,Qm=-1,Km=0;function vr(){return Is&6?xn():Qm!==-1?Qm:Qm=xn()}function go(n){return n.mode&1?Is&2&&Hn!==0?Hn&-Hn:yR.transition!==null?(Km===0&&(Km=US()),Km):(n=Ls,n!==0||(n=window.event,n=n===void 0?16:qS(n.type)),n):1}function Ai(n,e,s,r){if(50<Iu)throw Iu=0,Xx=null,Error(nt(185));wh(n,s,r),(!(Is&2)||n!==Vn)&&(n===Vn&&(!(Is&2)&&(hf|=s),_n===4&&Xa(n,Hn)),Lr(n,r),s===1&&Is===0&&!(e.mode&1)&&(sd=xn()+500,lf&&Fo()))}function Lr(n,e){var s=n.callbackNode;y2(n,e);var r=dp(n,n===Vn?Hn:0);if(r===0)s!==null&&Vw(s),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(s!=null&&Vw(s),e===1)n.tag===0?xR(kv.bind(null,n)):uE(kv.bind(null,n)),mR(function(){!(Is&6)&&Fo()}),s=null;else{switch($S(r)){case 1:s=Hy;break;case 4:s=OS;break;case 16:s=cp;break;case 536870912:s=MS;break;default:s=cp}s=cC(s,sC.bind(null,n))}n.callbackPriority=e,n.callbackNode=s}}function sC(n,e){if(Qm=-1,Km=0,Is&6)throw Error(nt(327));var s=n.callbackNode;if(Wc()&&n.callbackNode!==s)return null;var r=dp(n,n===Vn?Hn:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Tp(n,r);else{e=r;var i=Is;Is|=2;var a=rC();(Vn!==n||Hn!==e)&&(ma=null,sd=xn()+500,Cl(n,e));do try{MR();break}catch(l){nC(n,l)}while(!0);ab(),Ep.current=a,Is=i,wn!==null?e=0:(Vn=null,Hn=0,e=_n)}if(e!==0){if(e===2&&(i=Ex(n),i!==0&&(r=i,e=Zx(n,i))),e===1)throw s=sh,Cl(n,0),Xa(n,r),Lr(n,xn()),s;if(e===6)Xa(n,r);else{if(i=n.current.alternate,!(r&30)&&!FR(i)&&(e=Tp(n,r),e===2&&(a=Ex(n),a!==0&&(r=a,e=Zx(n,a))),e===1))throw s=sh,Cl(n,0),Xa(n,r),Lr(n,xn()),s;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(nt(345));case 2:gl(n,Ir,ma);break;case 3:if(Xa(n,r),(r&130023424)===r&&(e=vb+500-xn(),10<e)){if(dp(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){vr(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=Px(gl.bind(null,n,Ir,ma),e);break}gl(n,Ir,ma);break;case 4:if(Xa(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var o=31-Ti(r);a=1<<o,o=e[o],o>i&&(i=o),r&=~a}if(r=i,r=xn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*LR(r/1960))-r,10<r){n.timeoutHandle=Px(gl.bind(null,n,Ir,ma),r);break}gl(n,Ir,ma);break;case 5:gl(n,Ir,ma);break;default:throw Error(nt(329))}}}return Lr(n,xn()),n.callbackNode===s?sC.bind(null,n):null}function Zx(n,e){var s=Cu;return n.current.memoizedState.isDehydrated&&(Cl(n,e).flags|=256),n=Tp(n,e),n!==2&&(e=Ir,Ir=s,e!==null&&ey(e)),n}function ey(n){Ir===null?Ir=n:Ir.push.apply(Ir,n)}function FR(n){for(var e=n;;){if(e.flags&16384){var s=e.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var r=0;r<s.length;r++){var i=s[r],a=i.getSnapshot;i=i.value;try{if(!Di(a(),i))return!1}catch{return!1}}}if(s=e.child,e.subtreeFlags&16384&&s!==null)s.return=e,e=s;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Xa(n,e){for(e&=~wb,e&=~hf,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var s=31-Ti(e),r=1<<s;n[s]=-1,e&=~r}}function kv(n){if(Is&6)throw Error(nt(327));Wc();var e=dp(n,0);if(!(e&1))return Lr(n,xn()),null;var s=Tp(n,e);if(n.tag!==0&&s===2){var r=Ex(n);r!==0&&(e=r,s=Zx(n,r))}if(s===1)throw s=sh,Cl(n,0),Xa(n,e),Lr(n,xn()),s;if(s===6)throw Error(nt(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,gl(n,Ir,ma),Lr(n,xn()),null}function Nb(n,e){var s=Is;Is|=1;try{return n(e)}finally{Is=s,Is===0&&(sd=xn()+500,lf&&Fo())}}function Ol(n){io!==null&&io.tag===0&&!(Is&6)&&Wc();var e=Is;Is|=1;var s=ui.transition,r=Ls;try{if(ui.transition=null,Ls=1,n)return n()}finally{Ls=r,ui.transition=s,Is=e,!(Is&6)&&Fo()}}function jb(){zr=Oc.current,Ks(Oc)}function Cl(n,e){n.finishedWork=null,n.finishedLanes=0;var s=n.timeoutHandle;if(s!==-1&&(n.timeoutHandle=-1,hR(s)),wn!==null)for(s=wn.return;s!==null;){var r=s;switch(nb(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&fp();break;case 3:ed(),Ks(Pr),Ks(or),hb();break;case 5:ub(r);break;case 4:ed();break;case 13:Ks(sn);break;case 19:Ks(sn);break;case 10:ob(r.type._context);break;case 22:case 23:jb()}s=s.return}if(Vn=n,wn=n=xo(n.current,null),Hn=zr=e,_n=0,sh=null,wb=hf=Fl=0,Ir=Cu=null,Nl!==null){for(e=0;e<Nl.length;e++)if(s=Nl[e],r=s.interleaved,r!==null){s.interleaved=null;var i=r.next,a=s.pending;if(a!==null){var o=a.next;a.next=i,r.next=o}s.pending=r}Nl=null}return n}function nC(n,e){do{var s=wn;try{if(ab(),Wm.current=Sp,jp){for(var r=rn.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}jp=!1}if(Ll=0,Un=Cn=rn=null,Su=!1,Zu=0,bb.current=null,s===null||s.return===null){_n=1,sh=e,wn=null;break}e:{var a=n,o=s.return,l=s,c=e;if(e=Hn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,f=u.tag;if(!(u.mode&1)&&(f===0||f===11||f===15)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var j=vv(o);if(j!==null){j.flags&=-257,Nv(j,o,l,a,e),j.mode&1&&wv(a,d,e),e=j,c=d;var L=e.updateQueue;if(L===null){var R=new Set;R.add(c),e.updateQueue=R}else L.add(c);break e}else{if(!(e&1)){wv(a,d,e),Sb();break e}c=Error(nt(426))}}else if(Zs&&l.mode&1){var D=vv(o);if(D!==null){!(D.flags&65536)&&(D.flags|=256),Nv(D,o,l,a,e),rb(td(c,l));break e}}a=c=td(c,l),_n!==4&&(_n=2),Cu===null?Cu=[a]:Cu.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e;var y=$E(a,c,e);pv(a,y);break e;case 1:l=c;var T=a.type,x=a.stateNode;if(!(a.flags&128)&&(typeof T.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(fo===null||!fo.has(x)))){a.flags|=65536,e&=-e,a.lanes|=e;var S=zE(a,l,e);pv(a,S);break e}}a=a.return}while(a!==null)}aC(s)}catch(A){e=A,wn===s&&s!==null&&(wn=s=s.return);continue}break}while(!0)}function rC(){var n=Ep.current;return Ep.current=Sp,n===null?Sp:n}function Sb(){(_n===0||_n===3||_n===2)&&(_n=4),Vn===null||!(Fl&268435455)&&!(hf&268435455)||Xa(Vn,Hn)}function Tp(n,e){var s=Is;Is|=2;var r=rC();(Vn!==n||Hn!==e)&&(ma=null,Cl(n,e));do try{OR();break}catch(i){nC(n,i)}while(!0);if(ab(),Is=s,Ep.current=r,wn!==null)throw Error(nt(261));return Vn=null,Hn=0,_n}function OR(){for(;wn!==null;)iC(wn)}function MR(){for(;wn!==null&&!c2();)iC(wn)}function iC(n){var e=lC(n.alternate,n,zr);n.memoizedProps=n.pendingProps,e===null?aC(n):wn=e,bb.current=null}function aC(n){var e=n;do{var s=e.alternate;if(n=e.return,e.flags&32768){if(s=RR(s,e),s!==null){s.flags&=32767,wn=s;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{_n=6,wn=null;return}}else if(s=_R(s,e,zr),s!==null){wn=s;return}if(e=e.sibling,e!==null){wn=e;return}wn=e=n}while(e!==null);_n===0&&(_n=5)}function gl(n,e,s){var r=Ls,i=ui.transition;try{ui.transition=null,Ls=1,UR(n,e,s,r)}finally{ui.transition=i,Ls=r}return null}function UR(n,e,s,r){do Wc();while(io!==null);if(Is&6)throw Error(nt(327));s=n.finishedWork;var i=n.finishedLanes;if(s===null)return null;if(n.finishedWork=null,n.finishedLanes=0,s===n.current)throw Error(nt(177));n.callbackNode=null,n.callbackPriority=0;var a=s.lanes|s.childLanes;if(b2(n,a),n===Vn&&(wn=Vn=null,Hn=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||Tm||(Tm=!0,cC(cp,function(){return Wc(),null})),a=(s.flags&15990)!==0,s.subtreeFlags&15990||a){a=ui.transition,ui.transition=null;var o=Ls;Ls=1;var l=Is;Is|=4,bb.current=null,PR(n,s),eC(s,n),iR(Rx),up=!!_x,Rx=_x=null,n.current=s,kR(s),d2(),Is=l,Ls=o,ui.transition=a}else n.current=s;if(Tm&&(Tm=!1,io=n,Ip=i),a=n.pendingLanes,a===0&&(fo=null),m2(s.stateNode),Lr(n,xn()),e!==null)for(r=n.onRecoverableError,s=0;s<e.length;s++)i=e[s],r(i.value,{componentStack:i.stack,digest:i.digest});if(Cp)throw Cp=!1,n=Jx,Jx=null,n;return Ip&1&&n.tag!==0&&Wc(),a=n.pendingLanes,a&1?n===Xx?Iu++:(Iu=0,Xx=n):Iu=0,Fo(),null}function Wc(){if(io!==null){var n=$S(Ip),e=ui.transition,s=Ls;try{if(ui.transition=null,Ls=16>n?16:n,io===null)var r=!1;else{if(n=io,io=null,Ip=0,Is&6)throw Error(nt(331));var i=Is;for(Is|=4,Nt=n.current;Nt!==null;){var a=Nt,o=a.child;if(Nt.flags&16){var l=a.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(Nt=d;Nt!==null;){var u=Nt;switch(u.tag){case 0:case 11:case 15:Eu(8,u,a)}var f=u.child;if(f!==null)f.return=u,Nt=f;else for(;Nt!==null;){u=Nt;var p=u.sibling,j=u.return;if(JE(u),u===d){Nt=null;break}if(p!==null){p.return=j,Nt=p;break}Nt=j}}}var L=a.alternate;if(L!==null){var R=L.child;if(R!==null){L.child=null;do{var D=R.sibling;R.sibling=null,R=D}while(R!==null)}}Nt=a}}if(a.subtreeFlags&2064&&o!==null)o.return=a,Nt=o;else e:for(;Nt!==null;){if(a=Nt,a.flags&2048)switch(a.tag){case 0:case 11:case 15:Eu(9,a,a.return)}var y=a.sibling;if(y!==null){y.return=a.return,Nt=y;break e}Nt=a.return}}var T=n.current;for(Nt=T;Nt!==null;){o=Nt;var x=o.child;if(o.subtreeFlags&2064&&x!==null)x.return=o,Nt=x;else e:for(o=T;Nt!==null;){if(l=Nt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:uf(9,l)}}catch(A){un(l,l.return,A)}if(l===o){Nt=null;break e}var S=l.sibling;if(S!==null){S.return=l.return,Nt=S;break e}Nt=l.return}}if(Is=i,Fo(),Qi&&typeof Qi.onPostCommitFiberRoot=="function")try{Qi.onPostCommitFiberRoot(sf,n)}catch{}r=!0}return r}finally{Ls=s,ui.transition=e}}return!1}function Lv(n,e,s){e=td(s,e),e=$E(n,e,1),n=po(n,e,1),e=vr(),n!==null&&(wh(n,1,e),Lr(n,e))}function un(n,e,s){if(n.tag===3)Lv(n,n,s);else for(;e!==null;){if(e.tag===3){Lv(e,n,s);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(fo===null||!fo.has(r))){n=td(s,n),n=zE(e,n,1),e=po(e,n,1),n=vr(),e!==null&&(wh(e,1,n),Lr(e,n));break}}e=e.return}}function $R(n,e,s){var r=n.pingCache;r!==null&&r.delete(e),e=vr(),n.pingedLanes|=n.suspendedLanes&s,Vn===n&&(Hn&s)===s&&(_n===4||_n===3&&(Hn&130023424)===Hn&&500>xn()-vb?Cl(n,0):wb|=s),Lr(n,e)}function oC(n,e){e===0&&(n.mode&1?(e=ym,ym<<=1,!(ym&130023424)&&(ym=4194304)):e=1);var s=vr();n=Ia(n,e),n!==null&&(wh(n,e,s),Lr(n,s))}function zR(n){var e=n.memoizedState,s=0;e!==null&&(s=e.retryLane),oC(n,s)}function VR(n,e){var s=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(s=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(nt(314))}r!==null&&r.delete(e),oC(n,s)}var lC;lC=function(n,e,s){if(n!==null)if(n.memoizedProps!==e.pendingProps||Pr.current)Rr=!0;else{if(!(n.lanes&s)&&!(e.flags&128))return Rr=!1,AR(n,e,s);Rr=!!(n.flags&131072)}else Rr=!1,Zs&&e.flags&1048576&&hE(e,yp,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Hm(n,e),n=e.pendingProps;var i=Jc(e,or.current);Gc(e,s),i=pb(null,e,r,n,i,s);var a=fb();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,kr(r)?(a=!0,gp(e)):a=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,cb(e),i.updater=df,e.stateNode=i,i._reactInternals=e,$x(e,r,n,s),e=Bx(null,e,r,!0,a,s)):(e.tag=0,Zs&&a&&sb(e),yr(null,e,i,s),e=e.child),e;case 16:r=e.elementType;e:{switch(Hm(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=GR(r),n=Ni(r,n),i){case 0:e=Vx(null,e,r,n,s);break e;case 1:e=Ev(null,e,r,n,s);break e;case 11:e=jv(null,e,r,n,s);break e;case 14:e=Sv(null,e,r,Ni(r.type,n),s);break e}throw Error(nt(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Ni(r,i),Vx(n,e,r,i,s);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Ni(r,i),Ev(n,e,r,i,s);case 3:e:{if(WE(e),n===null)throw Error(nt(387));r=e.pendingProps,a=e.memoizedState,i=a.element,yE(n,e),vp(e,r,null,s);var o=e.memoizedState;if(r=o.element,a.isDehydrated)if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){i=td(Error(nt(423)),e),e=Cv(n,e,r,s,i);break e}else if(r!==i){i=td(Error(nt(424)),e),e=Cv(n,e,r,s,i);break e}else for(Br=mo(e.stateNode.containerInfo.firstChild),qr=e,Zs=!0,Ci=null,s=gE(e,null,r,s),e.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(Xc(),r===i){e=Ta(n,e,s);break e}yr(n,e,r,s)}e=e.child}return e;case 5:return bE(e),n===null&&Ox(e),r=e.type,i=e.pendingProps,a=n!==null?n.memoizedProps:null,o=i.children,Dx(r,i)?o=null:a!==null&&Dx(r,a)&&(e.flags|=32),GE(n,e),yr(n,e,o,s),e.child;case 6:return n===null&&Ox(e),null;case 13:return qE(n,e,s);case 4:return db(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Zc(e,null,r,s):yr(n,e,r,s),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Ni(r,i),jv(n,e,r,i,s);case 7:return yr(n,e,e.pendingProps,s),e.child;case 8:return yr(n,e,e.pendingProps.children,s),e.child;case 12:return yr(n,e,e.pendingProps.children,s),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,a=e.memoizedProps,o=i.value,Hs(bp,r._currentValue),r._currentValue=o,a!==null)if(Di(a.value,o)){if(a.children===i.children&&!Pr.current){e=Ta(n,e,s);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var l=a.dependencies;if(l!==null){o=a.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(a.tag===1){c=va(-1,s&-s),c.tag=2;var d=a.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}a.lanes|=s,c=a.alternate,c!==null&&(c.lanes|=s),Mx(a.return,s,e),l.lanes|=s;break}c=c.next}}else if(a.tag===10)o=a.type===e.type?null:a.child;else if(a.tag===18){if(o=a.return,o===null)throw Error(nt(341));o.lanes|=s,l=o.alternate,l!==null&&(l.lanes|=s),Mx(o,s,e),o=a.sibling}else o=a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===e){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}yr(n,e,i.children,s),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Gc(e,s),i=hi(i),r=r(i),e.flags|=1,yr(n,e,r,s),e.child;case 14:return r=e.type,i=Ni(r,e.pendingProps),i=Ni(r.type,i),Sv(n,e,r,i,s);case 15:return VE(n,e,e.type,e.pendingProps,s);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Ni(r,i),Hm(n,e),e.tag=1,kr(r)?(n=!0,gp(e)):n=!1,Gc(e,s),UE(e,r,i),$x(e,r,i,s),Bx(null,e,r,!0,n,s);case 19:return HE(n,e,s);case 22:return BE(n,e,s)}throw Error(nt(156,e.tag))};function cC(n,e){return FS(n,e)}function BR(n,e,s,r){this.tag=n,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function di(n,e,s,r){return new BR(n,e,s,r)}function Eb(n){return n=n.prototype,!(!n||!n.isReactComponent)}function GR(n){if(typeof n=="function")return Eb(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Gy)return 11;if(n===Wy)return 14}return 2}function xo(n,e){var s=n.alternate;return s===null?(s=di(n.tag,e,n.key,n.mode),s.elementType=n.elementType,s.type=n.type,s.stateNode=n.stateNode,s.alternate=n,n.alternate=s):(s.pendingProps=e,s.type=n.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=n.flags&14680064,s.childLanes=n.childLanes,s.lanes=n.lanes,s.child=n.child,s.memoizedProps=n.memoizedProps,s.memoizedState=n.memoizedState,s.updateQueue=n.updateQueue,e=n.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},s.sibling=n.sibling,s.index=n.index,s.ref=n.ref,s}function Ym(n,e,s,r,i,a){var o=2;if(r=n,typeof n=="function")Eb(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case Ic:return Il(s.children,i,a,e);case By:o=8,i|=8;break;case dx:return n=di(12,s,e,i|2),n.elementType=dx,n.lanes=a,n;case ux:return n=di(13,s,e,i),n.elementType=ux,n.lanes=a,n;case hx:return n=di(19,s,e,i),n.elementType=hx,n.lanes=a,n;case bS:return mf(s,i,a,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case xS:o=10;break e;case yS:o=9;break e;case Gy:o=11;break e;case Wy:o=14;break e;case Qa:o=16,r=null;break e}throw Error(nt(130,n==null?n:typeof n,""))}return e=di(o,s,e,i),e.elementType=n,e.type=r,e.lanes=a,e}function Il(n,e,s,r){return n=di(7,n,r,e),n.lanes=s,n}function mf(n,e,s,r){return n=di(22,n,r,e),n.elementType=bS,n.lanes=s,n.stateNode={isHidden:!1},n}function Mg(n,e,s){return n=di(6,n,null,e),n.lanes=s,n}function Ug(n,e,s){return e=di(4,n.children!==null?n.children:[],n.key,e),e.lanes=s,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function WR(n,e,s,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=bg(0),this.expirationTimes=bg(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=bg(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Cb(n,e,s,r,i,a,o,l,c){return n=new WR(n,e,s,l,c),e===1?(e=1,a===!0&&(e|=8)):e=0,a=di(3,null,null,e),n.current=a,a.stateNode=n,a.memoizedState={element:r,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},cb(a),n}function qR(n,e,s){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Cc,key:r==null?null:""+r,children:n,containerInfo:e,implementation:s}}function dC(n){if(!n)return Eo;n=n._reactInternals;e:{if(Kl(n)!==n||n.tag!==1)throw Error(nt(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(kr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(nt(171))}if(n.tag===1){var s=n.type;if(kr(s))return dE(n,s,e)}return e}function uC(n,e,s,r,i,a,o,l,c){return n=Cb(s,r,!0,n,i,a,o,l,c),n.context=dC(null),s=n.current,r=vr(),i=go(s),a=va(r,i),a.callback=e??null,po(s,a,i),n.current.lanes=i,wh(n,i,r),Lr(n,r),n}function pf(n,e,s,r){var i=e.current,a=vr(),o=go(i);return s=dC(s),e.context===null?e.context=s:e.pendingContext=s,e=va(a,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=po(i,e,o),n!==null&&(Ai(n,i,o,a),Gm(n,i,o)),o}function Ap(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Fv(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var s=n.retryLane;n.retryLane=s!==0&&s<e?s:e}}function Ib(n,e){Fv(n,e),(n=n.alternate)&&Fv(n,e)}function HR(){return null}var hC=typeof reportError=="function"?reportError:function(n){console.error(n)};function Tb(n){this._internalRoot=n}ff.prototype.render=Tb.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(nt(409));pf(n,e,null,null)};ff.prototype.unmount=Tb.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Ol(function(){pf(null,n,null,null)}),e[Ca]=null}};function ff(n){this._internalRoot=n}ff.prototype.unstable_scheduleHydration=function(n){if(n){var e=BS();n={blockedOn:null,target:n,priority:e};for(var s=0;s<Ja.length&&e!==0&&e<Ja[s].priority;s++);Ja.splice(s,0,n),s===0&&WS(n)}};function Ab(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function gf(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Ov(){}function QR(n,e,s,r,i){if(i){if(typeof r=="function"){var a=r;r=function(){var d=Ap(o);a.call(d)}}var o=uC(e,r,n,0,null,!1,!1,"",Ov);return n._reactRootContainer=o,n[Ca]=o.current,Qu(n.nodeType===8?n.parentNode:n),Ol(),o}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var l=r;r=function(){var d=Ap(c);l.call(d)}}var c=Cb(n,0,!1,null,null,!1,!1,"",Ov);return n._reactRootContainer=c,n[Ca]=c.current,Qu(n.nodeType===8?n.parentNode:n),Ol(function(){pf(e,c,s,r)}),c}function xf(n,e,s,r,i){var a=s._reactRootContainer;if(a){var o=a;if(typeof i=="function"){var l=i;i=function(){var c=Ap(o);l.call(c)}}pf(e,o,n,i)}else o=QR(s,e,n,i,r);return Ap(o)}zS=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var s=hu(e.pendingLanes);s!==0&&(Qy(e,s|1),Lr(e,xn()),!(Is&6)&&(sd=xn()+500,Fo()))}break;case 13:Ol(function(){var r=Ia(n,1);if(r!==null){var i=vr();Ai(r,n,1,i)}}),Ib(n,1)}};Ky=function(n){if(n.tag===13){var e=Ia(n,134217728);if(e!==null){var s=vr();Ai(e,n,134217728,s)}Ib(n,134217728)}};VS=function(n){if(n.tag===13){var e=go(n),s=Ia(n,e);if(s!==null){var r=vr();Ai(s,n,e,r)}Ib(n,e)}};BS=function(){return Ls};GS=function(n,e){var s=Ls;try{return Ls=n,e()}finally{Ls=s}};Nx=function(n,e,s){switch(e){case"input":if(fx(n,s),e=s.name,s.type==="radio"&&e!=null){for(s=n;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<s.length;e++){var r=s[e];if(r!==n&&r.form===n.form){var i=of(r);if(!i)throw Error(nt(90));vS(r),fx(r,i)}}}break;case"textarea":jS(n,s);break;case"select":e=s.value,e!=null&&$c(n,!!s.multiple,e,!1)}};_S=Nb;RS=Ol;var KR={usingClientEntryPoint:!1,Events:[Nh,Rc,of,TS,AS,Nb]},ou={findFiberByHostInstance:vl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},YR={bundleType:ou.bundleType,version:ou.version,rendererPackageName:ou.rendererPackageName,rendererConfig:ou.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ka.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=kS(n),n===null?null:n.stateNode},findFiberByHostInstance:ou.findFiberByHostInstance||HR,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Am=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Am.isDisabled&&Am.supportsFiber)try{sf=Am.inject(YR),Qi=Am}catch{}}Yr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=KR;Yr.createPortal=function(n,e){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ab(e))throw Error(nt(200));return qR(n,e,null,s)};Yr.createRoot=function(n,e){if(!Ab(n))throw Error(nt(299));var s=!1,r="",i=hC;return e!=null&&(e.unstable_strictMode===!0&&(s=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=Cb(n,1,!1,null,null,s,!1,r,i),n[Ca]=e.current,Qu(n.nodeType===8?n.parentNode:n),new Tb(e)};Yr.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(nt(188)):(n=Object.keys(n).join(","),Error(nt(268,n)));return n=kS(e),n=n===null?null:n.stateNode,n};Yr.flushSync=function(n){return Ol(n)};Yr.hydrate=function(n,e,s){if(!gf(e))throw Error(nt(200));return xf(null,n,e,!0,s)};Yr.hydrateRoot=function(n,e,s){if(!Ab(n))throw Error(nt(405));var r=s!=null&&s.hydratedSources||null,i=!1,a="",o=hC;if(s!=null&&(s.unstable_strictMode===!0&&(i=!0),s.identifierPrefix!==void 0&&(a=s.identifierPrefix),s.onRecoverableError!==void 0&&(o=s.onRecoverableError)),e=uC(e,null,n,1,s??null,i,!1,a,o),n[Ca]=e.current,Qu(n),r)for(n=0;n<r.length;n++)s=r[n],i=s._getVersion,i=i(s._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[s,i]:e.mutableSourceEagerHydrationData.push(s,i);return new ff(e)};Yr.render=function(n,e,s){if(!gf(e))throw Error(nt(200));return xf(null,n,e,!1,s)};Yr.unmountComponentAtNode=function(n){if(!gf(n))throw Error(nt(40));return n._reactRootContainer?(Ol(function(){xf(null,null,n,!1,function(){n._reactRootContainer=null,n[Ca]=null})}),!0):!1};Yr.unstable_batchedUpdates=Nb;Yr.unstable_renderSubtreeIntoContainer=function(n,e,s,r){if(!gf(s))throw Error(nt(200));if(n==null||n._reactInternals===void 0)throw Error(nt(38));return xf(n,e,s,!1,r)};Yr.version="18.3.1-next-f1338f8080-20240426";function mC(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(mC)}catch(n){console.error(n)}}mC(),mS.exports=Yr;var ty=mS.exports,Mv=ty;lx.createRoot=Mv.createRoot,lx.hydrateRoot=Mv.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function nh(){return nh=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(n[r]=s[r])}return n},nh.apply(this,arguments)}var ao;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(ao||(ao={}));const Uv="popstate";function JR(n){n===void 0&&(n={});function e(r,i){let{pathname:a,search:o,hash:l}=r.location;return sy("",{pathname:a,search:o,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function s(r,i){return typeof i=="string"?i:_p(i)}return ZR(e,s,null,n)}function Sn(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function pC(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function XR(){return Math.random().toString(36).substr(2,8)}function $v(n,e){return{usr:n.state,key:n.key,idx:e}}function sy(n,e,s,r){return s===void 0&&(s=null),nh({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?xd(e):e,{state:s,key:e&&e.key||r||XR()})}function _p(n){let{pathname:e="/",search:s="",hash:r=""}=n;return s&&s!=="?"&&(e+=s.charAt(0)==="?"?s:"?"+s),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function xd(n){let e={};if(n){let s=n.indexOf("#");s>=0&&(e.hash=n.substr(s),n=n.substr(0,s));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function ZR(n,e,s,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:a=!1}=r,o=i.history,l=ao.Pop,c=null,d=u();d==null&&(d=0,o.replaceState(nh({},o.state,{idx:d}),""));function u(){return(o.state||{idx:null}).idx}function f(){l=ao.Pop;let D=u(),y=D==null?null:D-d;d=D,c&&c({action:l,location:R.location,delta:y})}function p(D,y){l=ao.Push;let T=sy(R.location,D,y);d=u()+1;let x=$v(T,d),S=R.createHref(T);try{o.pushState(x,"",S)}catch(A){if(A instanceof DOMException&&A.name==="DataCloneError")throw A;i.location.assign(S)}a&&c&&c({action:l,location:R.location,delta:1})}function j(D,y){l=ao.Replace;let T=sy(R.location,D,y);d=u();let x=$v(T,d),S=R.createHref(T);o.replaceState(x,"",S),a&&c&&c({action:l,location:R.location,delta:0})}function L(D){let y=i.location.origin!=="null"?i.location.origin:i.location.href,T=typeof D=="string"?D:_p(D);return T=T.replace(/ $/,"%20"),Sn(y,"No window.location.(origin|href) available to create URL for href: "+T),new URL(T,y)}let R={get action(){return l},get location(){return n(i,o)},listen(D){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(Uv,f),c=D,()=>{i.removeEventListener(Uv,f),c=null}},createHref(D){return e(i,D)},createURL:L,encodeLocation(D){let y=L(D);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:p,replace:j,go(D){return o.go(D)}};return R}var zv;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(zv||(zv={}));function eD(n,e,s){return s===void 0&&(s="/"),tD(n,e,s)}function tD(n,e,s,r){let i=typeof e=="string"?xd(e):e,a=_b(i.pathname||"/",s);if(a==null)return null;let o=fC(n);sD(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let d=pD(a);l=uD(o[c],d)}return l}function fC(n,e,s,r){e===void 0&&(e=[]),s===void 0&&(s=[]),r===void 0&&(r="");let i=(a,o,l)=>{let c={relativePath:l===void 0?a.path||"":l,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};c.relativePath.startsWith("/")&&(Sn(c.relativePath.startsWith(r),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(r.length));let d=yo([r,c.relativePath]),u=s.concat(c);a.children&&a.children.length>0&&(Sn(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),fC(a.children,e,u,d)),!(a.path==null&&!a.index)&&e.push({path:d,score:cD(d,a.index),routesMeta:u})};return n.forEach((a,o)=>{var l;if(a.path===""||!((l=a.path)!=null&&l.includes("?")))i(a,o);else for(let c of gC(a.path))i(a,o,c)}),e}function gC(n){let e=n.split("/");if(e.length===0)return[];let[s,...r]=e,i=s.endsWith("?"),a=s.replace(/\?$/,"");if(r.length===0)return i?[a,""]:[a];let o=gC(r.join("/")),l=[];return l.push(...o.map(c=>c===""?a:[a,c].join("/"))),i&&l.push(...o),l.map(c=>n.startsWith("/")&&c===""?"/":c)}function sD(n){n.sort((e,s)=>e.score!==s.score?s.score-e.score:dD(e.routesMeta.map(r=>r.childrenIndex),s.routesMeta.map(r=>r.childrenIndex)))}const nD=/^:[\w-]+$/,rD=3,iD=2,aD=1,oD=10,lD=-2,Vv=n=>n==="*";function cD(n,e){let s=n.split("/"),r=s.length;return s.some(Vv)&&(r+=lD),e&&(r+=iD),s.filter(i=>!Vv(i)).reduce((i,a)=>i+(nD.test(a)?rD:a===""?aD:oD),r)}function dD(n,e){return n.length===e.length&&n.slice(0,-1).every((r,i)=>r===e[i])?n[n.length-1]-e[e.length-1]:0}function uD(n,e,s){let{routesMeta:r}=n,i={},a="/",o=[];for(let l=0;l<r.length;++l){let c=r[l],d=l===r.length-1,u=a==="/"?e:e.slice(a.length)||"/",f=hD({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},u),p=c.route;if(!f)return null;Object.assign(i,f.params),o.push({params:i,pathname:yo([a,f.pathname]),pathnameBase:yD(yo([a,f.pathnameBase])),route:p}),f.pathnameBase!=="/"&&(a=yo([a,f.pathnameBase]))}return o}function hD(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[s,r]=mD(n.path,n.caseSensitive,n.end),i=e.match(s);if(!i)return null;let a=i[0],o=a.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:r.reduce((d,u,f)=>{let{paramName:p,isOptional:j}=u;if(p==="*"){let R=l[f]||"";o=a.slice(0,a.length-R.length).replace(/(.)\/+$/,"$1")}const L=l[f];return j&&!L?d[p]=void 0:d[p]=(L||"").replace(/%2F/g,"/"),d},{}),pathname:a,pathnameBase:o,pattern:n}}function mD(n,e,s){e===void 0&&(e=!1),s===void 0&&(s=!0),pC(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(r.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function pD(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return pC(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function _b(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let s=e.endsWith("/")?e.length-1:e.length,r=n.charAt(s);return r&&r!=="/"?null:n.slice(s)||"/"}function fD(n,e){e===void 0&&(e="/");let{pathname:s,search:r="",hash:i=""}=typeof n=="string"?xd(n):n;return{pathname:s?s.startsWith("/")?s:gD(s,e):e,search:bD(r),hash:wD(i)}}function gD(n,e){let s=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?s.length>1&&s.pop():i!=="."&&s.push(i)}),s.length>1?s.join("/"):"/"}function $g(n,e,s,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+s+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function xD(n){return n.filter((e,s)=>s===0||e.route.path&&e.route.path.length>0)}function xC(n,e){let s=xD(n);return e?s.map((r,i)=>i===s.length-1?r.pathname:r.pathnameBase):s.map(r=>r.pathnameBase)}function yC(n,e,s,r){r===void 0&&(r=!1);let i;typeof n=="string"?i=xd(n):(i=nh({},n),Sn(!i.pathname||!i.pathname.includes("?"),$g("?","pathname","search",i)),Sn(!i.pathname||!i.pathname.includes("#"),$g("#","pathname","hash",i)),Sn(!i.search||!i.search.includes("#"),$g("#","search","hash",i)));let a=n===""||i.pathname==="",o=a?"/":i.pathname,l;if(o==null)l=s;else{let f=e.length-1;if(!r&&o.startsWith("..")){let p=o.split("/");for(;p[0]==="..";)p.shift(),f-=1;i.pathname=p.join("/")}l=f>=0?e[f]:"/"}let c=fD(i,l),d=o&&o!=="/"&&o.endsWith("/"),u=(a||o===".")&&s.endsWith("/");return!c.pathname.endsWith("/")&&(d||u)&&(c.pathname+="/"),c}const yo=n=>n.join("/").replace(/\/\/+/g,"/"),yD=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),bD=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,wD=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function vD(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const bC=["post","put","patch","delete"];new Set(bC);const ND=["get",...bC];new Set(ND);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function rh(){return rh=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(n[r]=s[r])}return n},rh.apply(this,arguments)}const Rb=h.createContext(null),jD=h.createContext(null),Yl=h.createContext(null),yf=h.createContext(null),Oo=h.createContext({outlet:null,matches:[],isDataRoute:!1}),wC=h.createContext(null);function SD(n,e){let{relative:s}=e===void 0?{}:e;Sh()||Sn(!1);let{basename:r,navigator:i}=h.useContext(Yl),{hash:a,pathname:o,search:l}=NC(n,{relative:s}),c=o;return r!=="/"&&(c=o==="/"?r:yo([r,o])),i.createHref({pathname:c,search:l,hash:a})}function Sh(){return h.useContext(yf)!=null}function Xr(){return Sh()||Sn(!1),h.useContext(yf).location}function vC(n){h.useContext(Yl).static||h.useLayoutEffect(n)}function kt(){let{isDataRoute:n}=h.useContext(Oo);return n?OD():ED()}function ED(){Sh()||Sn(!1);let n=h.useContext(Rb),{basename:e,future:s,navigator:r}=h.useContext(Yl),{matches:i}=h.useContext(Oo),{pathname:a}=Xr(),o=JSON.stringify(xC(i,s.v7_relativeSplatPath)),l=h.useRef(!1);return vC(()=>{l.current=!0}),h.useCallback(function(d,u){if(u===void 0&&(u={}),!l.current)return;if(typeof d=="number"){r.go(d);return}let f=yC(d,JSON.parse(o),a,u.relative==="path");n==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:yo([e,f.pathname])),(u.replace?r.replace:r.push)(f,u.state,u)},[e,r,o,a,n])}function Dn(){let{matches:n}=h.useContext(Oo),e=n[n.length-1];return e?e.params:{}}function NC(n,e){let{relative:s}=e===void 0?{}:e,{future:r}=h.useContext(Yl),{matches:i}=h.useContext(Oo),{pathname:a}=Xr(),o=JSON.stringify(xC(i,r.v7_relativeSplatPath));return h.useMemo(()=>yC(n,JSON.parse(o),a,s==="path"),[n,o,a,s])}function CD(n,e){return ID(n,e)}function ID(n,e,s,r){Sh()||Sn(!1);let{navigator:i}=h.useContext(Yl),{matches:a}=h.useContext(Oo),o=a[a.length-1],l=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let d=Xr(),u;if(e){var f;let D=typeof e=="string"?xd(e):e;c==="/"||(f=D.pathname)!=null&&f.startsWith(c)||Sn(!1),u=D}else u=d;let p=u.pathname||"/",j=p;if(c!=="/"){let D=c.replace(/^\//,"").split("/");j="/"+p.replace(/^\//,"").split("/").slice(D.length).join("/")}let L=eD(n,{pathname:j}),R=DD(L&&L.map(D=>Object.assign({},D,{params:Object.assign({},l,D.params),pathname:yo([c,i.encodeLocation?i.encodeLocation(D.pathname).pathname:D.pathname]),pathnameBase:D.pathnameBase==="/"?c:yo([c,i.encodeLocation?i.encodeLocation(D.pathnameBase).pathname:D.pathnameBase])})),a,s,r);return e&&R?h.createElement(yf.Provider,{value:{location:rh({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:ao.Pop}},R):R}function TD(){let n=FD(),e=vD(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),s=n instanceof Error?n.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return h.createElement(h.Fragment,null,h.createElement("h2",null,"Unexpected Application Error!"),h.createElement("h3",{style:{fontStyle:"italic"}},e),s?h.createElement("pre",{style:i},s):null,null)}const AD=h.createElement(TD,null);class _D extends h.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,s){return s.location!==e.location||s.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:s.error,location:s.location,revalidation:e.revalidation||s.revalidation}}componentDidCatch(e,s){console.error("React Router caught the following error during render",e,s)}render(){return this.state.error!==void 0?h.createElement(Oo.Provider,{value:this.props.routeContext},h.createElement(wC.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function RD(n){let{routeContext:e,match:s,children:r}=n,i=h.useContext(Rb);return i&&i.static&&i.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=s.route.id),h.createElement(Oo.Provider,{value:e},r)}function DD(n,e,s,r){var i;if(e===void 0&&(e=[]),s===void 0&&(s=null),r===void 0&&(r=null),n==null){var a;if(!s)return null;if(s.errors)n=s.matches;else if((a=r)!=null&&a.v7_partialHydration&&e.length===0&&!s.initialized&&s.matches.length>0)n=s.matches;else return null}let o=n,l=(i=s)==null?void 0:i.errors;if(l!=null){let u=o.findIndex(f=>f.route.id&&(l==null?void 0:l[f.route.id])!==void 0);u>=0||Sn(!1),o=o.slice(0,Math.min(o.length,u+1))}let c=!1,d=-1;if(s&&r&&r.v7_partialHydration)for(let u=0;u<o.length;u++){let f=o[u];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(d=u),f.route.id){let{loaderData:p,errors:j}=s,L=f.route.loader&&p[f.route.id]===void 0&&(!j||j[f.route.id]===void 0);if(f.route.lazy||L){c=!0,d>=0?o=o.slice(0,d+1):o=[o[0]];break}}}return o.reduceRight((u,f,p)=>{let j,L=!1,R=null,D=null;s&&(j=l&&f.route.id?l[f.route.id]:void 0,R=f.route.errorElement||AD,c&&(d<0&&p===0?(MD("route-fallback"),L=!0,D=null):d===p&&(L=!0,D=f.route.hydrateFallbackElement||null)));let y=e.concat(o.slice(0,p+1)),T=()=>{let x;return j?x=R:L?x=D:f.route.Component?x=h.createElement(f.route.Component,null):f.route.element?x=f.route.element:x=u,h.createElement(RD,{match:f,routeContext:{outlet:u,matches:y,isDataRoute:s!=null},children:x})};return s&&(f.route.ErrorBoundary||f.route.errorElement||p===0)?h.createElement(_D,{location:s.location,revalidation:s.revalidation,component:R,error:j,children:T(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):T()},null)}var jC=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(jC||{}),SC=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(SC||{});function PD(n){let e=h.useContext(Rb);return e||Sn(!1),e}function kD(n){let e=h.useContext(jD);return e||Sn(!1),e}function LD(n){let e=h.useContext(Oo);return e||Sn(!1),e}function EC(n){let e=LD(),s=e.matches[e.matches.length-1];return s.route.id||Sn(!1),s.route.id}function FD(){var n;let e=h.useContext(wC),s=kD(),r=EC();return e!==void 0?e:(n=s.errors)==null?void 0:n[r]}function OD(){let{router:n}=PD(jC.UseNavigateStable),e=EC(SC.UseNavigateStable),s=h.useRef(!1);return vC(()=>{s.current=!0}),h.useCallback(function(i,a){a===void 0&&(a={}),s.current&&(typeof i=="number"?n.navigate(i):n.navigate(i,rh({fromRouteId:e},a)))},[n,e])}const Bv={};function MD(n,e,s){Bv[n]||(Bv[n]=!0)}function UD(n,e){n==null||n.v7_startTransition,n==null||n.v7_relativeSplatPath}function Et(n){Sn(!1)}function $D(n){let{basename:e="/",children:s=null,location:r,navigationType:i=ao.Pop,navigator:a,static:o=!1,future:l}=n;Sh()&&Sn(!1);let c=e.replace(/^\/*/,"/"),d=h.useMemo(()=>({basename:c,navigator:a,static:o,future:rh({v7_relativeSplatPath:!1},l)}),[c,l,a,o]);typeof r=="string"&&(r=xd(r));let{pathname:u="/",search:f="",hash:p="",state:j=null,key:L="default"}=r,R=h.useMemo(()=>{let D=_b(u,c);return D==null?null:{location:{pathname:D,search:f,hash:p,state:j,key:L},navigationType:i}},[c,u,f,p,j,L,i]);return R==null?null:h.createElement(Yl.Provider,{value:d},h.createElement(yf.Provider,{children:s,value:R}))}function zD(n){let{children:e,location:s}=n;return CD(ny(e),s)}new Promise(()=>{});function ny(n,e){e===void 0&&(e=[]);let s=[];return h.Children.forEach(n,(r,i)=>{if(!h.isValidElement(r))return;let a=[...e,i];if(r.type===h.Fragment){s.push.apply(s,ny(r.props.children,a));return}r.type!==Et&&Sn(!1),!r.props.index||!r.props.children||Sn(!1);let o={id:r.props.id||a.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=ny(r.props.children,a)),s.push(o)}),s}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ry(){return ry=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(n[r]=s[r])}return n},ry.apply(this,arguments)}function VD(n,e){if(n==null)return{};var s={},r=Object.keys(n),i,a;for(a=0;a<r.length;a++)i=r[a],!(e.indexOf(i)>=0)&&(s[i]=n[i]);return s}function BD(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function GD(n,e){return n.button===0&&(!e||e==="_self")&&!BD(n)}function iy(n){return n===void 0&&(n=""),new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((e,s)=>{let r=n[s];return e.concat(Array.isArray(r)?r.map(i=>[s,i]):[[s,r]])},[]))}function WD(n,e){let s=iy(n);return e&&e.forEach((r,i)=>{s.has(i)||e.getAll(i).forEach(a=>{s.append(i,a)})}),s}const qD=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],HD="6";try{window.__reactRouterVersion=HD}catch{}const QD="startTransition",Gv=$_[QD];function KD(n){let{basename:e,children:s,future:r,window:i}=n,a=h.useRef();a.current==null&&(a.current=JR({window:i,v5Compat:!0}));let o=a.current,[l,c]=h.useState({action:o.action,location:o.location}),{v7_startTransition:d}=r||{},u=h.useCallback(f=>{d&&Gv?Gv(()=>c(f)):c(f)},[c,d]);return h.useLayoutEffect(()=>o.listen(u),[o,u]),h.useEffect(()=>UD(r),[r]),h.createElement($D,{basename:e,children:s,location:l.location,navigationType:l.action,navigator:o,future:r})}const YD=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",JD=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,zi=h.forwardRef(function(e,s){let{onClick:r,relative:i,reloadDocument:a,replace:o,state:l,target:c,to:d,preventScrollReset:u,viewTransition:f}=e,p=VD(e,qD),{basename:j}=h.useContext(Yl),L,R=!1;if(typeof d=="string"&&JD.test(d)&&(L=d,YD))try{let x=new URL(window.location.href),S=d.startsWith("//")?new URL(x.protocol+d):new URL(d),A=_b(S.pathname,j);S.origin===x.origin&&A!=null?d=A+S.search+S.hash:R=!0}catch{}let D=SD(d,{relative:i}),y=XD(d,{replace:o,state:l,target:c,preventScrollReset:u,relative:i,viewTransition:f});function T(x){r&&r(x),x.defaultPrevented||y(x)}return h.createElement("a",ry({},p,{href:L||D,onClick:R||a?r:T,ref:s,target:c}))});var Wv;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(Wv||(Wv={}));var qv;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(qv||(qv={}));function XD(n,e){let{target:s,replace:r,state:i,preventScrollReset:a,relative:o,viewTransition:l}=e===void 0?{}:e,c=kt(),d=Xr(),u=NC(n,{relative:o});return h.useCallback(f=>{if(GD(f,s)){f.preventDefault();let p=r!==void 0?r:_p(d)===_p(u);c(n,{replace:p,state:i,preventScrollReset:a,relative:o,viewTransition:l})}},[d,c,u,r,i,s,n,a,o,l])}function Eh(n){let e=h.useRef(iy(n)),s=h.useRef(!1),r=Xr(),i=h.useMemo(()=>WD(r.search,s.current?null:e.current),[r.search]),a=kt(),o=h.useCallback((l,c)=>{const d=iy(typeof l=="function"?l(i):l);s.current=!0,a("?"+d,c)},[a,i]);return[i,o]}const ZD=()=>{};var Hv={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CC=function(n){const e=[];let s=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[s++]=i:i<2048?(e[s++]=i>>6|192,e[s++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[s++]=i>>18|240,e[s++]=i>>12&63|128,e[s++]=i>>6&63|128,e[s++]=i&63|128):(e[s++]=i>>12|224,e[s++]=i>>6&63|128,e[s++]=i&63|128)}return e},eP=function(n){const e=[];let s=0,r=0;for(;s<n.length;){const i=n[s++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const a=n[s++];e[r++]=String.fromCharCode((i&31)<<6|a&63)}else if(i>239&&i<365){const a=n[s++],o=n[s++],l=n[s++],c=((i&7)<<18|(a&63)<<12|(o&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const a=n[s++],o=n[s++];e[r++]=String.fromCharCode((i&15)<<12|(a&63)<<6|o&63)}}return e.join("")},IC={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const a=n[i],o=i+1<n.length,l=o?n[i+1]:0,c=i+2<n.length,d=c?n[i+2]:0,u=a>>2,f=(a&3)<<4|l>>4;let p=(l&15)<<2|d>>6,j=d&63;c||(j=64,o||(p=64)),r.push(s[u],s[f],s[p],s[j])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(CC(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):eP(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const s=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const a=s[n.charAt(i++)],l=i<n.length?s[n.charAt(i)]:0;++i;const d=i<n.length?s[n.charAt(i)]:64;++i;const f=i<n.length?s[n.charAt(i)]:64;if(++i,a==null||l==null||d==null||f==null)throw new tP;const p=a<<2|l>>4;if(r.push(p),d!==64){const j=l<<4&240|d>>2;if(r.push(j),f!==64){const L=d<<6&192|f;r.push(L)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class tP extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const sP=function(n){const e=CC(n);return IC.encodeByteArray(e,!0)},Rp=function(n){return sP(n).replace(/\./g,"")},TC=function(n){try{return IC.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nP(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rP=()=>nP().__FIREBASE_DEFAULTS__,iP=()=>{if(typeof process>"u"||typeof Hv>"u")return;const n=Hv.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},aP=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&TC(n[1]);return e&&JSON.parse(e)},bf=()=>{try{return ZD()||rP()||iP()||aP()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},AC=n=>{var e,s;return(s=(e=bf())==null?void 0:e.emulatorHosts)==null?void 0:s[n]},_C=n=>{const e=AC(n);if(!e)return;const s=e.lastIndexOf(":");if(s<=0||s+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(s+1),10);return e[0]==="["?[e.substring(1,s-1),r]:[e.substring(0,s),r]},RC=()=>{var n;return(n=bf())==null?void 0:n.config},DC=n=>{var e;return(e=bf())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oP{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,s)=>{this.resolve=e,this.reject=s})}wrapCallback(e){return(s,r)=>{s?this.reject(s):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(s):e(s,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mo(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Db(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PC(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,a=n.sub||n.user_id;if(!a)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:a,user_id:a,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Rp(JSON.stringify(s)),Rp(JSON.stringify(o)),""].join(".")}const Tu={};function lP(){const n={prod:[],emulator:[]};for(const e of Object.keys(Tu))Tu[e]?n.emulator.push(e):n.prod.push(e);return n}function cP(n){let e=document.getElementById(n),s=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),s=!0),{created:s,element:e}}let Qv=!1;function Pb(n,e){if(typeof window>"u"||typeof document>"u"||!Mo(window.location.host)||Tu[n]===e||Tu[n]||Qv)return;Tu[n]=e;function s(p){return`__firebase__banner__${p}`}const r="__firebase__banner",a=lP().prod.length>0;function o(){const p=document.getElementById(r);p&&p.remove()}function l(p){p.style.display="flex",p.style.background="#7faaf0",p.style.position="fixed",p.style.bottom="5px",p.style.left="5px",p.style.padding=".5em",p.style.borderRadius="5px",p.style.alignItems="center"}function c(p,j){p.setAttribute("width","24"),p.setAttribute("id",j),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),p.style.marginLeft="-6px"}function d(){const p=document.createElement("span");return p.style.cursor="pointer",p.style.marginLeft="16px",p.style.fontSize="24px",p.innerHTML=" &times;",p.onclick=()=>{Qv=!0,o()},p}function u(p,j){p.setAttribute("id",j),p.innerText="Learn more",p.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",p.setAttribute("target","__blank"),p.style.paddingLeft="5px",p.style.textDecoration="underline"}function f(){const p=cP(r),j=s("text"),L=document.getElementById(j)||document.createElement("span"),R=s("learnmore"),D=document.getElementById(R)||document.createElement("a"),y=s("preprendIcon"),T=document.getElementById(y)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.created){const x=p.element;l(x),u(D,R);const S=d();c(T,y),x.append(T,L,D,S),document.body.appendChild(x)}a?(L.innerText="Preview backend disconnected.",T.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(T.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,L.innerText="Preview backend running in this workspace."),L.setAttribute("id",j)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lr(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function dP(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(lr())}function uP(){var e;const n=(e=bf())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function hP(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function mP(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function pP(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function fP(){const n=lr();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function gP(){return!uP()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function xP(){try{return typeof indexedDB=="object"}catch{return!1}}function yP(){return new Promise((n,e)=>{try{let s=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),s||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{s=!1},i.onerror=()=>{var a;e(((a=i.error)==null?void 0:a.message)||"")}}catch(s){e(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bP="FirebaseError";class na extends Error{constructor(e,s,r){super(s),this.code=e,this.customData=r,this.name=bP,Object.setPrototypeOf(this,na.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ch.prototype.create)}}class Ch{constructor(e,s,r){this.service=e,this.serviceName=s,this.errors=r}create(e,...s){const r=s[0]||{},i=`${this.service}/${e}`,a=this.errors[e],o=a?wP(a,r):"Error",l=`${this.serviceName}: ${o} (${i}).`;return new na(i,l,r)}}function wP(n,e){return n.replace(vP,(s,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const vP=/\{\$([^}]+)}/g;function NP(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ml(n,e){if(n===e)return!0;const s=Object.keys(n),r=Object.keys(e);for(const i of s){if(!r.includes(i))return!1;const a=n[i],o=e[i];if(Kv(a)&&Kv(o)){if(!Ml(a,o))return!1}else if(a!==o)return!1}for(const i of r)if(!s.includes(i))return!1;return!0}function Kv(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ih(n){const e=[];for(const[s,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(s)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(s)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function pu(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,a]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(a)}}),e}function fu(n){const e=n.indexOf("?");if(!e)return"";const s=n.indexOf("#",e);return n.substring(e,s>0?s:void 0)}function jP(n,e){const s=new SP(n,e);return s.subscribe.bind(s)}class SP{constructor(e,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(s=>{s.next(e)})}error(e){this.forEachObserver(s=>{s.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,s,r){let i;if(e===void 0&&s===void 0&&r===void 0)throw new Error("Missing Observer.");EP(e,["next","error","complete"])?i=e:i={next:e,error:s,complete:r},i.next===void 0&&(i.next=zg),i.error===void 0&&(i.error=zg),i.complete===void 0&&(i.complete=zg);const a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),a}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,e)}sendOne(e,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{s(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function EP(n,e){if(typeof n!="object"||n===null)return!1;for(const s of e)if(s in n&&typeof n[s]=="function")return!0;return!1}function zg(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fs(n){return n&&n._delegate?n._delegate:n}class Co{constructor(e,s,r){this.name=e,this.instanceFactory=s,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xl="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CP{constructor(e,s){this.name=e,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const s=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(s)){const r=new oP;if(this.instancesDeferred.set(s,r),this.isInitialized(s)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:s});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(e){const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(TP(e))try{this.getOrInitializeService({instanceIdentifier:xl})}catch{}for(const[s,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(s);try{const a=this.getOrInitializeService({instanceIdentifier:i});r.resolve(a)}catch{}}}}clearInstance(e=xl){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...e.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=xl){return this.instances.has(e)}getOptions(e=xl){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:s={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:s});for(const[a,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(a);r===l&&o.resolve(i)}return i}onInit(e,s){const r=this.normalizeInstanceIdentifier(s),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const a=this.instances.get(r);return a&&e(a,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,s){const r=this.onInitCallbacks.get(s);if(r)for(const i of r)try{i(e,s)}catch{}}getOrInitializeService({instanceIdentifier:e,options:s={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:IP(e),options:s}),this.instances.set(e,r),this.instancesOptions.set(e,s),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=xl){return this.component?this.component.multipleInstances?e:xl:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function IP(n){return n===xl?void 0:n}function TP(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AP{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const s=this.getProvider(e.name);if(s.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);s.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const s=new CP(e,this);return this.providers.set(e,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ps;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ps||(ps={}));const _P={debug:ps.DEBUG,verbose:ps.VERBOSE,info:ps.INFO,warn:ps.WARN,error:ps.ERROR,silent:ps.SILENT},RP=ps.INFO,DP={[ps.DEBUG]:"log",[ps.VERBOSE]:"log",[ps.INFO]:"info",[ps.WARN]:"warn",[ps.ERROR]:"error"},PP=(n,e,...s)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=DP[e];if(i)console[i](`[${r}]  ${n.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class kb{constructor(e){this.name=e,this._logLevel=RP,this._logHandler=PP,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ps))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?_P[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ps.DEBUG,...e),this._logHandler(this,ps.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ps.VERBOSE,...e),this._logHandler(this,ps.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ps.INFO,...e),this._logHandler(this,ps.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ps.WARN,...e),this._logHandler(this,ps.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ps.ERROR,...e),this._logHandler(this,ps.ERROR,...e)}}const kP=(n,e)=>e.some(s=>n instanceof s);let Yv,Jv;function LP(){return Yv||(Yv=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function FP(){return Jv||(Jv=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const kC=new WeakMap,ay=new WeakMap,LC=new WeakMap,Vg=new WeakMap,Lb=new WeakMap;function OP(n){const e=new Promise((s,r)=>{const i=()=>{n.removeEventListener("success",a),n.removeEventListener("error",o)},a=()=>{s(bo(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",a),n.addEventListener("error",o)});return e.then(s=>{s instanceof IDBCursor&&kC.set(s,n)}).catch(()=>{}),Lb.set(e,n),e}function MP(n){if(ay.has(n))return;const e=new Promise((s,r)=>{const i=()=>{n.removeEventListener("complete",a),n.removeEventListener("error",o),n.removeEventListener("abort",o)},a=()=>{s(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",a),n.addEventListener("error",o),n.addEventListener("abort",o)});ay.set(n,e)}let oy={get(n,e,s){if(n instanceof IDBTransaction){if(e==="done")return ay.get(n);if(e==="objectStoreNames")return n.objectStoreNames||LC.get(n);if(e==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return bo(n[e])},set(n,e,s){return n[e]=s,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function UP(n){oy=n(oy)}function $P(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...s){const r=n.call(Bg(this),e,...s);return LC.set(r,e.sort?e.sort():[e]),bo(r)}:FP().includes(n)?function(...e){return n.apply(Bg(this),e),bo(kC.get(this))}:function(...e){return bo(n.apply(Bg(this),e))}}function zP(n){return typeof n=="function"?$P(n):(n instanceof IDBTransaction&&MP(n),kP(n,LP())?new Proxy(n,oy):n)}function bo(n){if(n instanceof IDBRequest)return OP(n);if(Vg.has(n))return Vg.get(n);const e=zP(n);return e!==n&&(Vg.set(n,e),Lb.set(e,n)),e}const Bg=n=>Lb.get(n);function VP(n,e,{blocked:s,upgrade:r,blocking:i,terminated:a}={}){const o=indexedDB.open(n,e),l=bo(o);return r&&o.addEventListener("upgradeneeded",c=>{r(bo(o.result),c.oldVersion,c.newVersion,bo(o.transaction),c)}),s&&o.addEventListener("blocked",c=>s(c.oldVersion,c.newVersion,c)),l.then(c=>{a&&c.addEventListener("close",()=>a()),i&&c.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const BP=["get","getKey","getAll","getAllKeys","count"],GP=["put","add","delete","clear"],Gg=new Map;function Xv(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Gg.get(e))return Gg.get(e);const s=e.replace(/FromIndex$/,""),r=e!==s,i=GP.includes(s);if(!(s in(r?IDBIndex:IDBObjectStore).prototype)||!(i||BP.includes(s)))return;const a=async function(o,...l){const c=this.transaction(o,i?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[s](...l),i&&c.done]))[0]};return Gg.set(e,a),a}UP(n=>({...n,get:(e,s,r)=>Xv(e,s)||n.get(e,s,r),has:(e,s)=>!!Xv(e,s)||n.has(e,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WP{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(qP(s)){const r=s.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(s=>s).join(" ")}}function qP(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const ly="@firebase/app",Zv="0.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Aa=new kb("@firebase/app"),HP="@firebase/app-compat",QP="@firebase/analytics-compat",KP="@firebase/analytics",YP="@firebase/app-check-compat",JP="@firebase/app-check",XP="@firebase/auth",ZP="@firebase/auth-compat",ek="@firebase/database",tk="@firebase/data-connect",sk="@firebase/database-compat",nk="@firebase/functions",rk="@firebase/functions-compat",ik="@firebase/installations",ak="@firebase/installations-compat",ok="@firebase/messaging",lk="@firebase/messaging-compat",ck="@firebase/performance",dk="@firebase/performance-compat",uk="@firebase/remote-config",hk="@firebase/remote-config-compat",mk="@firebase/storage",pk="@firebase/storage-compat",fk="@firebase/firestore",gk="@firebase/ai",xk="@firebase/firestore-compat",yk="firebase",bk="12.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cy="[DEFAULT]",wk={[ly]:"fire-core",[HP]:"fire-core-compat",[KP]:"fire-analytics",[QP]:"fire-analytics-compat",[JP]:"fire-app-check",[YP]:"fire-app-check-compat",[XP]:"fire-auth",[ZP]:"fire-auth-compat",[ek]:"fire-rtdb",[tk]:"fire-data-connect",[sk]:"fire-rtdb-compat",[nk]:"fire-fn",[rk]:"fire-fn-compat",[ik]:"fire-iid",[ak]:"fire-iid-compat",[ok]:"fire-fcm",[lk]:"fire-fcm-compat",[ck]:"fire-perf",[dk]:"fire-perf-compat",[uk]:"fire-rc",[hk]:"fire-rc-compat",[mk]:"fire-gcs",[pk]:"fire-gcs-compat",[fk]:"fire-fst",[xk]:"fire-fst-compat",[gk]:"fire-vertex","fire-js":"fire-js",[yk]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ih=new Map,vk=new Map,dy=new Map;function eN(n,e){try{n.container.addComponent(e)}catch(s){Aa.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,s)}}function Ul(n){const e=n.name;if(dy.has(e))return Aa.debug(`There were multiple attempts to register component ${e}.`),!1;dy.set(e,n);for(const s of ih.values())eN(s,n);for(const s of vk.values())eN(s,n);return!0}function wf(n,e){const s=n.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),n.container.getProvider(e)}function Tr(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nk={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},wo=new Ch("app","Firebase",Nk);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jk{constructor(e,s,r){this._isDeleted=!1,this._options={...e},this._config={...s},this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Co("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw wo.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jl=bk;function FC(n,e={}){let s=n;typeof e!="object"&&(e={name:e});const r={name:cy,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw wo.create("bad-app-name",{appName:String(i)});if(s||(s=RC()),!s)throw wo.create("no-options");const a=ih.get(i);if(a){if(Ml(s,a.options)&&Ml(r,a.config))return a;throw wo.create("duplicate-app",{appName:i})}const o=new AP(i);for(const c of dy.values())o.addComponent(c);const l=new jk(s,r,o);return ih.set(i,l),l}function Fb(n=cy){const e=ih.get(n);if(!e&&n===cy&&RC())return FC();if(!e)throw wo.create("no-app",{appName:n});return e}function tN(){return Array.from(ih.values())}function Yi(n,e,s){let r=wk[n]??n;s&&(r+=`-${s}`);const i=r.match(/\s|\//),a=e.match(/\s|\//);if(i||a){const o=[`Unable to register library "${r}" with version "${e}":`];i&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&a&&o.push("and"),a&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Aa.warn(o.join(" "));return}Ul(new Co(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sk="firebase-heartbeat-database",Ek=1,ah="firebase-heartbeat-store";let Wg=null;function OC(){return Wg||(Wg=VP(Sk,Ek,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(ah)}catch(s){console.warn(s)}}}}).catch(n=>{throw wo.create("idb-open",{originalErrorMessage:n.message})})),Wg}async function Ck(n){try{const s=(await OC()).transaction(ah),r=await s.objectStore(ah).get(MC(n));return await s.done,r}catch(e){if(e instanceof na)Aa.warn(e.message);else{const s=wo.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Aa.warn(s.message)}}}async function sN(n,e){try{const r=(await OC()).transaction(ah,"readwrite");await r.objectStore(ah).put(e,MC(n)),await r.done}catch(s){if(s instanceof na)Aa.warn(s.message);else{const r=wo.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});Aa.warn(r.message)}}}function MC(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ik=1024,Tk=30;class Ak{constructor(e){this.container=e,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new Rk(s),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,s;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),a=nN();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)==null?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(o=>o.date===a))return;if(this._heartbeatsCache.heartbeats.push({date:a,agent:i}),this._heartbeatsCache.heartbeats.length>Tk){const o=Dk(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Aa.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=nN(),{heartbeatsToSend:r,unsentEntries:i}=_k(this._heartbeatsCache.heartbeats),a=Rp(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=s,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(s){return Aa.warn(s),""}}}function nN(){return new Date().toISOString().substring(0,10)}function _k(n,e=Ik){const s=[];let r=n.slice();for(const i of n){const a=s.find(o=>o.agent===i.agent);if(a){if(a.dates.push(i.date),rN(s)>e){a.dates.pop();break}}else if(s.push({agent:i.agent,dates:[i.date]}),rN(s)>e){s.pop();break}r=r.slice(1)}return{heartbeatsToSend:s,unsentEntries:r}}class Rk{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return xP()?yP().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await Ck(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return sN(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return sN(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function rN(n){return Rp(JSON.stringify({version:2,heartbeats:n})).length}function Dk(n){if(n.length===0)return-1;let e=0,s=n[0].date;for(let r=1;r<n.length;r++)n[r].date<s&&(s=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pk(n){Ul(new Co("platform-logger",e=>new WP(e),"PRIVATE")),Ul(new Co("heartbeat",e=>new Ak(e),"PRIVATE")),Yi(ly,Zv,n),Yi(ly,Zv,"esm2020"),Yi("fire-js","")}Pk("");var iN=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var vo,UC;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(q,B){function $(){}$.prototype=B.prototype,q.D=B.prototype,q.prototype=new $,q.prototype.constructor=q,q.C=function(H,te,G){for(var F=Array(arguments.length-2),X=2;X<arguments.length;X++)F[X-2]=arguments[X];return B.prototype[te].apply(H,F)}}function s(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,s),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(q,B,$){$||($=0);var H=Array(16);if(typeof B=="string")for(var te=0;16>te;++te)H[te]=B.charCodeAt($++)|B.charCodeAt($++)<<8|B.charCodeAt($++)<<16|B.charCodeAt($++)<<24;else for(te=0;16>te;++te)H[te]=B[$++]|B[$++]<<8|B[$++]<<16|B[$++]<<24;B=q.g[0],$=q.g[1],te=q.g[2];var G=q.g[3],F=B+(G^$&(te^G))+H[0]+3614090360&4294967295;B=$+(F<<7&4294967295|F>>>25),F=G+(te^B&($^te))+H[1]+3905402710&4294967295,G=B+(F<<12&4294967295|F>>>20),F=te+($^G&(B^$))+H[2]+606105819&4294967295,te=G+(F<<17&4294967295|F>>>15),F=$+(B^te&(G^B))+H[3]+3250441966&4294967295,$=te+(F<<22&4294967295|F>>>10),F=B+(G^$&(te^G))+H[4]+4118548399&4294967295,B=$+(F<<7&4294967295|F>>>25),F=G+(te^B&($^te))+H[5]+1200080426&4294967295,G=B+(F<<12&4294967295|F>>>20),F=te+($^G&(B^$))+H[6]+2821735955&4294967295,te=G+(F<<17&4294967295|F>>>15),F=$+(B^te&(G^B))+H[7]+4249261313&4294967295,$=te+(F<<22&4294967295|F>>>10),F=B+(G^$&(te^G))+H[8]+1770035416&4294967295,B=$+(F<<7&4294967295|F>>>25),F=G+(te^B&($^te))+H[9]+2336552879&4294967295,G=B+(F<<12&4294967295|F>>>20),F=te+($^G&(B^$))+H[10]+4294925233&4294967295,te=G+(F<<17&4294967295|F>>>15),F=$+(B^te&(G^B))+H[11]+2304563134&4294967295,$=te+(F<<22&4294967295|F>>>10),F=B+(G^$&(te^G))+H[12]+1804603682&4294967295,B=$+(F<<7&4294967295|F>>>25),F=G+(te^B&($^te))+H[13]+4254626195&4294967295,G=B+(F<<12&4294967295|F>>>20),F=te+($^G&(B^$))+H[14]+2792965006&4294967295,te=G+(F<<17&4294967295|F>>>15),F=$+(B^te&(G^B))+H[15]+1236535329&4294967295,$=te+(F<<22&4294967295|F>>>10),F=B+(te^G&($^te))+H[1]+4129170786&4294967295,B=$+(F<<5&4294967295|F>>>27),F=G+($^te&(B^$))+H[6]+3225465664&4294967295,G=B+(F<<9&4294967295|F>>>23),F=te+(B^$&(G^B))+H[11]+643717713&4294967295,te=G+(F<<14&4294967295|F>>>18),F=$+(G^B&(te^G))+H[0]+3921069994&4294967295,$=te+(F<<20&4294967295|F>>>12),F=B+(te^G&($^te))+H[5]+3593408605&4294967295,B=$+(F<<5&4294967295|F>>>27),F=G+($^te&(B^$))+H[10]+38016083&4294967295,G=B+(F<<9&4294967295|F>>>23),F=te+(B^$&(G^B))+H[15]+3634488961&4294967295,te=G+(F<<14&4294967295|F>>>18),F=$+(G^B&(te^G))+H[4]+3889429448&4294967295,$=te+(F<<20&4294967295|F>>>12),F=B+(te^G&($^te))+H[9]+568446438&4294967295,B=$+(F<<5&4294967295|F>>>27),F=G+($^te&(B^$))+H[14]+3275163606&4294967295,G=B+(F<<9&4294967295|F>>>23),F=te+(B^$&(G^B))+H[3]+4107603335&4294967295,te=G+(F<<14&4294967295|F>>>18),F=$+(G^B&(te^G))+H[8]+1163531501&4294967295,$=te+(F<<20&4294967295|F>>>12),F=B+(te^G&($^te))+H[13]+2850285829&4294967295,B=$+(F<<5&4294967295|F>>>27),F=G+($^te&(B^$))+H[2]+4243563512&4294967295,G=B+(F<<9&4294967295|F>>>23),F=te+(B^$&(G^B))+H[7]+1735328473&4294967295,te=G+(F<<14&4294967295|F>>>18),F=$+(G^B&(te^G))+H[12]+2368359562&4294967295,$=te+(F<<20&4294967295|F>>>12),F=B+($^te^G)+H[5]+4294588738&4294967295,B=$+(F<<4&4294967295|F>>>28),F=G+(B^$^te)+H[8]+2272392833&4294967295,G=B+(F<<11&4294967295|F>>>21),F=te+(G^B^$)+H[11]+1839030562&4294967295,te=G+(F<<16&4294967295|F>>>16),F=$+(te^G^B)+H[14]+4259657740&4294967295,$=te+(F<<23&4294967295|F>>>9),F=B+($^te^G)+H[1]+2763975236&4294967295,B=$+(F<<4&4294967295|F>>>28),F=G+(B^$^te)+H[4]+1272893353&4294967295,G=B+(F<<11&4294967295|F>>>21),F=te+(G^B^$)+H[7]+4139469664&4294967295,te=G+(F<<16&4294967295|F>>>16),F=$+(te^G^B)+H[10]+3200236656&4294967295,$=te+(F<<23&4294967295|F>>>9),F=B+($^te^G)+H[13]+681279174&4294967295,B=$+(F<<4&4294967295|F>>>28),F=G+(B^$^te)+H[0]+3936430074&4294967295,G=B+(F<<11&4294967295|F>>>21),F=te+(G^B^$)+H[3]+3572445317&4294967295,te=G+(F<<16&4294967295|F>>>16),F=$+(te^G^B)+H[6]+76029189&4294967295,$=te+(F<<23&4294967295|F>>>9),F=B+($^te^G)+H[9]+3654602809&4294967295,B=$+(F<<4&4294967295|F>>>28),F=G+(B^$^te)+H[12]+3873151461&4294967295,G=B+(F<<11&4294967295|F>>>21),F=te+(G^B^$)+H[15]+530742520&4294967295,te=G+(F<<16&4294967295|F>>>16),F=$+(te^G^B)+H[2]+3299628645&4294967295,$=te+(F<<23&4294967295|F>>>9),F=B+(te^($|~G))+H[0]+4096336452&4294967295,B=$+(F<<6&4294967295|F>>>26),F=G+($^(B|~te))+H[7]+1126891415&4294967295,G=B+(F<<10&4294967295|F>>>22),F=te+(B^(G|~$))+H[14]+2878612391&4294967295,te=G+(F<<15&4294967295|F>>>17),F=$+(G^(te|~B))+H[5]+4237533241&4294967295,$=te+(F<<21&4294967295|F>>>11),F=B+(te^($|~G))+H[12]+1700485571&4294967295,B=$+(F<<6&4294967295|F>>>26),F=G+($^(B|~te))+H[3]+2399980690&4294967295,G=B+(F<<10&4294967295|F>>>22),F=te+(B^(G|~$))+H[10]+4293915773&4294967295,te=G+(F<<15&4294967295|F>>>17),F=$+(G^(te|~B))+H[1]+2240044497&4294967295,$=te+(F<<21&4294967295|F>>>11),F=B+(te^($|~G))+H[8]+1873313359&4294967295,B=$+(F<<6&4294967295|F>>>26),F=G+($^(B|~te))+H[15]+4264355552&4294967295,G=B+(F<<10&4294967295|F>>>22),F=te+(B^(G|~$))+H[6]+2734768916&4294967295,te=G+(F<<15&4294967295|F>>>17),F=$+(G^(te|~B))+H[13]+1309151649&4294967295,$=te+(F<<21&4294967295|F>>>11),F=B+(te^($|~G))+H[4]+4149444226&4294967295,B=$+(F<<6&4294967295|F>>>26),F=G+($^(B|~te))+H[11]+3174756917&4294967295,G=B+(F<<10&4294967295|F>>>22),F=te+(B^(G|~$))+H[2]+718787259&4294967295,te=G+(F<<15&4294967295|F>>>17),F=$+(G^(te|~B))+H[9]+3951481745&4294967295,q.g[0]=q.g[0]+B&4294967295,q.g[1]=q.g[1]+(te+(F<<21&4294967295|F>>>11))&4294967295,q.g[2]=q.g[2]+te&4294967295,q.g[3]=q.g[3]+G&4294967295}r.prototype.u=function(q,B){B===void 0&&(B=q.length);for(var $=B-this.blockSize,H=this.B,te=this.h,G=0;G<B;){if(te==0)for(;G<=$;)i(this,q,G),G+=this.blockSize;if(typeof q=="string"){for(;G<B;)if(H[te++]=q.charCodeAt(G++),te==this.blockSize){i(this,H),te=0;break}}else for(;G<B;)if(H[te++]=q[G++],te==this.blockSize){i(this,H),te=0;break}}this.h=te,this.o+=B},r.prototype.v=function(){var q=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);q[0]=128;for(var B=1;B<q.length-8;++B)q[B]=0;var $=8*this.o;for(B=q.length-8;B<q.length;++B)q[B]=$&255,$/=256;for(this.u(q),q=Array(16),B=$=0;4>B;++B)for(var H=0;32>H;H+=8)q[$++]=this.g[B]>>>H&255;return q};function a(q,B){var $=l;return Object.prototype.hasOwnProperty.call($,q)?$[q]:$[q]=B(q)}function o(q,B){this.h=B;for(var $=[],H=!0,te=q.length-1;0<=te;te--){var G=q[te]|0;H&&G==B||($[te]=G,H=!1)}this.g=$}var l={};function c(q){return-128<=q&&128>q?a(q,function(B){return new o([B|0],0>B?-1:0)}):new o([q|0],0>q?-1:0)}function d(q){if(isNaN(q)||!isFinite(q))return f;if(0>q)return D(d(-q));for(var B=[],$=1,H=0;q>=$;H++)B[H]=q/$|0,$*=4294967296;return new o(B,0)}function u(q,B){if(q.length==0)throw Error("number format error: empty string");if(B=B||10,2>B||36<B)throw Error("radix out of range: "+B);if(q.charAt(0)=="-")return D(u(q.substring(1),B));if(0<=q.indexOf("-"))throw Error('number format error: interior "-" character');for(var $=d(Math.pow(B,8)),H=f,te=0;te<q.length;te+=8){var G=Math.min(8,q.length-te),F=parseInt(q.substring(te,te+G),B);8>G?(G=d(Math.pow(B,G)),H=H.j(G).add(d(F))):(H=H.j($),H=H.add(d(F)))}return H}var f=c(0),p=c(1),j=c(16777216);n=o.prototype,n.m=function(){if(R(this))return-D(this).m();for(var q=0,B=1,$=0;$<this.g.length;$++){var H=this.i($);q+=(0<=H?H:4294967296+H)*B,B*=4294967296}return q},n.toString=function(q){if(q=q||10,2>q||36<q)throw Error("radix out of range: "+q);if(L(this))return"0";if(R(this))return"-"+D(this).toString(q);for(var B=d(Math.pow(q,6)),$=this,H="";;){var te=S($,B).g;$=y($,te.j(B));var G=((0<$.g.length?$.g[0]:$.h)>>>0).toString(q);if($=te,L($))return G+H;for(;6>G.length;)G="0"+G;H=G+H}},n.i=function(q){return 0>q?0:q<this.g.length?this.g[q]:this.h};function L(q){if(q.h!=0)return!1;for(var B=0;B<q.g.length;B++)if(q.g[B]!=0)return!1;return!0}function R(q){return q.h==-1}n.l=function(q){return q=y(this,q),R(q)?-1:L(q)?0:1};function D(q){for(var B=q.g.length,$=[],H=0;H<B;H++)$[H]=~q.g[H];return new o($,~q.h).add(p)}n.abs=function(){return R(this)?D(this):this},n.add=function(q){for(var B=Math.max(this.g.length,q.g.length),$=[],H=0,te=0;te<=B;te++){var G=H+(this.i(te)&65535)+(q.i(te)&65535),F=(G>>>16)+(this.i(te)>>>16)+(q.i(te)>>>16);H=F>>>16,G&=65535,F&=65535,$[te]=F<<16|G}return new o($,$[$.length-1]&-2147483648?-1:0)};function y(q,B){return q.add(D(B))}n.j=function(q){if(L(this)||L(q))return f;if(R(this))return R(q)?D(this).j(D(q)):D(D(this).j(q));if(R(q))return D(this.j(D(q)));if(0>this.l(j)&&0>q.l(j))return d(this.m()*q.m());for(var B=this.g.length+q.g.length,$=[],H=0;H<2*B;H++)$[H]=0;for(H=0;H<this.g.length;H++)for(var te=0;te<q.g.length;te++){var G=this.i(H)>>>16,F=this.i(H)&65535,X=q.i(te)>>>16,ue=q.i(te)&65535;$[2*H+2*te]+=F*ue,T($,2*H+2*te),$[2*H+2*te+1]+=G*ue,T($,2*H+2*te+1),$[2*H+2*te+1]+=F*X,T($,2*H+2*te+1),$[2*H+2*te+2]+=G*X,T($,2*H+2*te+2)}for(H=0;H<B;H++)$[H]=$[2*H+1]<<16|$[2*H];for(H=B;H<2*B;H++)$[H]=0;return new o($,0)};function T(q,B){for(;(q[B]&65535)!=q[B];)q[B+1]+=q[B]>>>16,q[B]&=65535,B++}function x(q,B){this.g=q,this.h=B}function S(q,B){if(L(B))throw Error("division by zero");if(L(q))return new x(f,f);if(R(q))return B=S(D(q),B),new x(D(B.g),D(B.h));if(R(B))return B=S(q,D(B)),new x(D(B.g),B.h);if(30<q.g.length){if(R(q)||R(B))throw Error("slowDivide_ only works with positive integers.");for(var $=p,H=B;0>=H.l(q);)$=A($),H=A(H);var te=Q($,1),G=Q(H,1);for(H=Q(H,2),$=Q($,2);!L(H);){var F=G.add(H);0>=F.l(q)&&(te=te.add($),G=F),H=Q(H,1),$=Q($,1)}return B=y(q,te.j(B)),new x(te,B)}for(te=f;0<=q.l(B);){for($=Math.max(1,Math.floor(q.m()/B.m())),H=Math.ceil(Math.log($)/Math.LN2),H=48>=H?1:Math.pow(2,H-48),G=d($),F=G.j(B);R(F)||0<F.l(q);)$-=H,G=d($),F=G.j(B);L(G)&&(G=p),te=te.add(G),q=y(q,F)}return new x(te,q)}n.A=function(q){return S(this,q).h},n.and=function(q){for(var B=Math.max(this.g.length,q.g.length),$=[],H=0;H<B;H++)$[H]=this.i(H)&q.i(H);return new o($,this.h&q.h)},n.or=function(q){for(var B=Math.max(this.g.length,q.g.length),$=[],H=0;H<B;H++)$[H]=this.i(H)|q.i(H);return new o($,this.h|q.h)},n.xor=function(q){for(var B=Math.max(this.g.length,q.g.length),$=[],H=0;H<B;H++)$[H]=this.i(H)^q.i(H);return new o($,this.h^q.h)};function A(q){for(var B=q.g.length+1,$=[],H=0;H<B;H++)$[H]=q.i(H)<<1|q.i(H-1)>>>31;return new o($,q.h)}function Q(q,B){var $=B>>5;B%=32;for(var H=q.g.length-$,te=[],G=0;G<H;G++)te[G]=0<B?q.i(G+$)>>>B|q.i(G+$+1)<<32-B:q.i(G+$);return new o(te,q.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,UC=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=d,o.fromString=u,vo=o}).apply(typeof iN<"u"?iN:typeof self<"u"?self:typeof window<"u"?window:{});var _m=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var $C,gu,zC,Jm,uy,VC,BC,GC;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(m,M,K){return m==Array.prototype||m==Object.prototype||(m[M]=K.value),m};function s(m){m=[typeof globalThis=="object"&&globalThis,m,typeof window=="object"&&window,typeof self=="object"&&self,typeof _m=="object"&&_m];for(var M=0;M<m.length;++M){var K=m[M];if(K&&K.Math==Math)return K}throw Error("Cannot find global object")}var r=s(this);function i(m,M){if(M)e:{var K=r;m=m.split(".");for(var ce=0;ce<m.length-1;ce++){var Ae=m[ce];if(!(Ae in K))break e;K=K[Ae]}m=m[m.length-1],ce=K[m],M=M(ce),M!=ce&&M!=null&&e(K,m,{configurable:!0,writable:!0,value:M})}}function a(m,M){m instanceof String&&(m+="");var K=0,ce=!1,Ae={next:function(){if(!ce&&K<m.length){var Me=K++;return{value:M(Me,m[Me]),done:!1}}return ce=!0,{done:!0,value:void 0}}};return Ae[Symbol.iterator]=function(){return Ae},Ae}i("Array.prototype.values",function(m){return m||function(){return a(this,function(M,K){return K})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},l=this||self;function c(m){var M=typeof m;return M=M!="object"?M:m?Array.isArray(m)?"array":M:"null",M=="array"||M=="object"&&typeof m.length=="number"}function d(m){var M=typeof m;return M=="object"&&m!=null||M=="function"}function u(m,M,K){return m.call.apply(m.bind,arguments)}function f(m,M,K){if(!m)throw Error();if(2<arguments.length){var ce=Array.prototype.slice.call(arguments,2);return function(){var Ae=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Ae,ce),m.apply(M,Ae)}}return function(){return m.apply(M,arguments)}}function p(m,M,K){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?u:f,p.apply(null,arguments)}function j(m,M){var K=Array.prototype.slice.call(arguments,1);return function(){var ce=K.slice();return ce.push.apply(ce,arguments),m.apply(this,ce)}}function L(m,M){function K(){}K.prototype=M.prototype,m.aa=M.prototype,m.prototype=new K,m.prototype.constructor=m,m.Qb=function(ce,Ae,Me){for(var lt=Array(arguments.length-2),_s=2;_s<arguments.length;_s++)lt[_s-2]=arguments[_s];return M.prototype[Ae].apply(ce,lt)}}function R(m){const M=m.length;if(0<M){const K=Array(M);for(let ce=0;ce<M;ce++)K[ce]=m[ce];return K}return[]}function D(m,M){for(let K=1;K<arguments.length;K++){const ce=arguments[K];if(c(ce)){const Ae=m.length||0,Me=ce.length||0;m.length=Ae+Me;for(let lt=0;lt<Me;lt++)m[Ae+lt]=ce[lt]}else m.push(ce)}}class y{constructor(M,K){this.i=M,this.j=K,this.h=0,this.g=null}get(){let M;return 0<this.h?(this.h--,M=this.g,this.g=M.next,M.next=null):M=this.i(),M}}function T(m){return/^[\s\xa0]*$/.test(m)}function x(){var m=l.navigator;return m&&(m=m.userAgent)?m:""}function S(m){return S[" "](m),m}S[" "]=function(){};var A=x().indexOf("Gecko")!=-1&&!(x().toLowerCase().indexOf("webkit")!=-1&&x().indexOf("Edge")==-1)&&!(x().indexOf("Trident")!=-1||x().indexOf("MSIE")!=-1)&&x().indexOf("Edge")==-1;function Q(m,M,K){for(const ce in m)M.call(K,m[ce],ce,m)}function q(m,M){for(const K in m)M.call(void 0,m[K],K,m)}function B(m){const M={};for(const K in m)M[K]=m[K];return M}const $="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function H(m,M){let K,ce;for(let Ae=1;Ae<arguments.length;Ae++){ce=arguments[Ae];for(K in ce)m[K]=ce[K];for(let Me=0;Me<$.length;Me++)K=$[Me],Object.prototype.hasOwnProperty.call(ce,K)&&(m[K]=ce[K])}}function te(m){var M=1;m=m.split(":");const K=[];for(;0<M&&m.length;)K.push(m.shift()),M--;return m.length&&K.push(m.join(":")),K}function G(m){l.setTimeout(()=>{throw m},0)}function F(){var m=E;let M=null;return m.g&&(M=m.g,m.g=m.g.next,m.g||(m.h=null),M.next=null),M}class X{constructor(){this.h=this.g=null}add(M,K){const ce=ue.get();ce.set(M,K),this.h?this.h.next=ce:this.g=ce,this.h=ce}}var ue=new y(()=>new Y,m=>m.reset());class Y{constructor(){this.next=this.g=this.h=null}set(M,K){this.h=M,this.g=K,this.next=null}reset(){this.next=this.g=this.h=null}}let z,O=!1,E=new X,k=()=>{const m=l.Promise.resolve(void 0);z=()=>{m.then(b)}};var b=()=>{for(var m;m=F();){try{m.h.call(m.g)}catch(K){G(K)}var M=ue;M.j(m),100>M.h&&(M.h++,m.next=M.g,M.g=m)}O=!1};function N(){this.s=this.s,this.C=this.C}N.prototype.s=!1,N.prototype.ma=function(){this.s||(this.s=!0,this.N())},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function I(m,M){this.type=m,this.g=this.target=M,this.defaultPrevented=!1}I.prototype.h=function(){this.defaultPrevented=!0};var P=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var m=!1,M=Object.defineProperty({},"passive",{get:function(){m=!0}});try{const K=()=>{};l.addEventListener("test",K,M),l.removeEventListener("test",K,M)}catch{}return m}();function _(m,M){if(I.call(this,m?m.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,m){var K=this.type=m.type,ce=m.changedTouches&&m.changedTouches.length?m.changedTouches[0]:null;if(this.target=m.target||m.srcElement,this.g=M,M=m.relatedTarget){if(A){e:{try{S(M.nodeName);var Ae=!0;break e}catch{}Ae=!1}Ae||(M=null)}}else K=="mouseover"?M=m.fromElement:K=="mouseout"&&(M=m.toElement);this.relatedTarget=M,ce?(this.clientX=ce.clientX!==void 0?ce.clientX:ce.pageX,this.clientY=ce.clientY!==void 0?ce.clientY:ce.pageY,this.screenX=ce.screenX||0,this.screenY=ce.screenY||0):(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0),this.button=m.button,this.key=m.key||"",this.ctrlKey=m.ctrlKey,this.altKey=m.altKey,this.shiftKey=m.shiftKey,this.metaKey=m.metaKey,this.pointerId=m.pointerId||0,this.pointerType=typeof m.pointerType=="string"?m.pointerType:C[m.pointerType]||"",this.state=m.state,this.i=m,m.defaultPrevented&&_.aa.h.call(this)}}L(_,I);var C={2:"touch",3:"pen",4:"mouse"};_.prototype.h=function(){_.aa.h.call(this);var m=this.i;m.preventDefault?m.preventDefault():m.returnValue=!1};var U="closure_listenable_"+(1e6*Math.random()|0),w=0;function W(m,M,K,ce,Ae){this.listener=m,this.proxy=null,this.src=M,this.type=K,this.capture=!!ce,this.ha=Ae,this.key=++w,this.da=this.fa=!1}function ie(m){m.da=!0,m.listener=null,m.proxy=null,m.src=null,m.ha=null}function de(m){this.src=m,this.g={},this.h=0}de.prototype.add=function(m,M,K,ce,Ae){var Me=m.toString();m=this.g[Me],m||(m=this.g[Me]=[],this.h++);var lt=ye(m,M,ce,Ae);return-1<lt?(M=m[lt],K||(M.fa=!1)):(M=new W(M,this.src,Me,!!ce,Ae),M.fa=K,m.push(M)),M};function ne(m,M){var K=M.type;if(K in m.g){var ce=m.g[K],Ae=Array.prototype.indexOf.call(ce,M,void 0),Me;(Me=0<=Ae)&&Array.prototype.splice.call(ce,Ae,1),Me&&(ie(M),m.g[K].length==0&&(delete m.g[K],m.h--))}}function ye(m,M,K,ce){for(var Ae=0;Ae<m.length;++Ae){var Me=m[Ae];if(!Me.da&&Me.listener==M&&Me.capture==!!K&&Me.ha==ce)return Ae}return-1}var pe="closure_lm_"+(1e6*Math.random()|0),be={};function xe(m,M,K,ce,Ae){if(Array.isArray(M)){for(var Me=0;Me<M.length;Me++)xe(m,M[Me],K,ce,Ae);return null}return K=rt(K),m&&m[U]?m.K(M,K,d(ce)?!!ce.capture:!1,Ae):Ee(m,M,K,!1,ce,Ae)}function Ee(m,M,K,ce,Ae,Me){if(!M)throw Error("Invalid event type");var lt=d(Ae)?!!Ae.capture:!!Ae,_s=ze(m);if(_s||(m[pe]=_s=new de(m)),K=_s.add(M,K,ce,lt,Me),K.proxy)return K;if(ce=Re(),K.proxy=ce,ce.src=m,ce.listener=K,m.addEventListener)P||(Ae=lt),Ae===void 0&&(Ae=!1),m.addEventListener(M.toString(),ce,Ae);else if(m.attachEvent)m.attachEvent($e(M.toString()),ce);else if(m.addListener&&m.removeListener)m.addListener(ce);else throw Error("addEventListener and attachEvent are unavailable.");return K}function Re(){function m(K){return M.call(m.src,m.listener,K)}const M=et;return m}function fe(m,M,K,ce,Ae){if(Array.isArray(M))for(var Me=0;Me<M.length;Me++)fe(m,M[Me],K,ce,Ae);else ce=d(ce)?!!ce.capture:!!ce,K=rt(K),m&&m[U]?(m=m.i,M=String(M).toString(),M in m.g&&(Me=m.g[M],K=ye(Me,K,ce,Ae),-1<K&&(ie(Me[K]),Array.prototype.splice.call(Me,K,1),Me.length==0&&(delete m.g[M],m.h--)))):m&&(m=ze(m))&&(M=m.g[M.toString()],m=-1,M&&(m=ye(M,K,ce,Ae)),(K=-1<m?M[m]:null)&&Ve(K))}function Ve(m){if(typeof m!="number"&&m&&!m.da){var M=m.src;if(M&&M[U])ne(M.i,m);else{var K=m.type,ce=m.proxy;M.removeEventListener?M.removeEventListener(K,ce,m.capture):M.detachEvent?M.detachEvent($e(K),ce):M.addListener&&M.removeListener&&M.removeListener(ce),(K=ze(M))?(ne(K,m),K.h==0&&(K.src=null,M[pe]=null)):ie(m)}}}function $e(m){return m in be?be[m]:be[m]="on"+m}function et(m,M){if(m.da)m=!0;else{M=new _(M,this);var K=m.listener,ce=m.ha||m.src;m.fa&&Ve(m),m=K.call(ce,M)}return m}function ze(m){return m=m[pe],m instanceof de?m:null}var tt="__closure_events_fn_"+(1e9*Math.random()>>>0);function rt(m){return typeof m=="function"?m:(m[tt]||(m[tt]=function(M){return m.handleEvent(M)}),m[tt])}function bt(){N.call(this),this.i=new de(this),this.M=this,this.F=null}L(bt,N),bt.prototype[U]=!0,bt.prototype.removeEventListener=function(m,M,K,ce){fe(this,m,M,K,ce)};function At(m,M){var K,ce=m.F;if(ce)for(K=[];ce;ce=ce.F)K.push(ce);if(m=m.M,ce=M.type||M,typeof M=="string")M=new I(M,m);else if(M instanceof I)M.target=M.target||m;else{var Ae=M;M=new I(ce,m),H(M,Ae)}if(Ae=!0,K)for(var Me=K.length-1;0<=Me;Me--){var lt=M.g=K[Me];Ae=ns(lt,ce,!0,M)&&Ae}if(lt=M.g=m,Ae=ns(lt,ce,!0,M)&&Ae,Ae=ns(lt,ce,!1,M)&&Ae,K)for(Me=0;Me<K.length;Me++)lt=M.g=K[Me],Ae=ns(lt,ce,!1,M)&&Ae}bt.prototype.N=function(){if(bt.aa.N.call(this),this.i){var m=this.i,M;for(M in m.g){for(var K=m.g[M],ce=0;ce<K.length;ce++)ie(K[ce]);delete m.g[M],m.h--}}this.F=null},bt.prototype.K=function(m,M,K,ce){return this.i.add(String(m),M,!1,K,ce)},bt.prototype.L=function(m,M,K,ce){return this.i.add(String(m),M,!0,K,ce)};function ns(m,M,K,ce){if(M=m.i.g[String(M)],!M)return!0;M=M.concat();for(var Ae=!0,Me=0;Me<M.length;++Me){var lt=M[Me];if(lt&&!lt.da&&lt.capture==K){var _s=lt.listener,En=lt.ha||lt.src;lt.fa&&ne(m.i,lt),Ae=_s.call(En,ce)!==!1&&Ae}}return Ae&&!ce.defaultPrevented}function Ht(m,M,K){if(typeof m=="function")K&&(m=p(m,K));else if(m&&typeof m.handleEvent=="function")m=p(m.handleEvent,m);else throw Error("Invalid listener argument");return 2147483647<Number(M)?-1:l.setTimeout(m,M||0)}function is(m){m.g=Ht(()=>{m.g=null,m.i&&(m.i=!1,is(m))},m.l);const M=m.h;m.h=null,m.m.apply(null,M)}class Oe extends N{constructor(M,K){super(),this.m=M,this.l=K,this.h=null,this.i=!1,this.g=null}j(M){this.h=arguments,this.g?this.i=!0:is(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function it(m){N.call(this),this.h=m,this.g={}}L(it,N);var Kt=[];function zs(m){Q(m.g,function(M,K){this.g.hasOwnProperty(K)&&Ve(M)},m),m.g={}}it.prototype.N=function(){it.aa.N.call(this),zs(this)},it.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var xs=l.JSON.stringify,cs=l.JSON.parse,Os=class{stringify(m){return l.JSON.stringify(m,void 0)}parse(m){return l.JSON.parse(m,void 0)}};function vs(){}vs.prototype.h=null;function Z(m){return m.h||(m.h=m.i())}function v(){}var se={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function re(){I.call(this,"d")}L(re,I);function J(){I.call(this,"c")}L(J,I);var he={},Se=null;function me(){return Se=Se||new bt}he.La="serverreachability";function ge(m){I.call(this,he.La,m)}L(ge,I);function ke(m){const M=me();At(M,new ge(M))}he.STAT_EVENT="statevent";function Ie(m,M){I.call(this,he.STAT_EVENT,m),this.stat=M}L(Ie,I);function oe(m){const M=me();At(M,new Ie(M,m))}he.Ma="timingevent";function Te(m,M){I.call(this,he.Ma,m),this.size=M}L(Te,I);function Ne(m,M){if(typeof m!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){m()},M)}function we(){this.g=!0}we.prototype.xa=function(){this.g=!1};function _e(m,M,K,ce,Ae,Me){m.info(function(){if(m.g)if(Me)for(var lt="",_s=Me.split("&"),En=0;En<_s.length;En++){var Ns=_s[En].split("=");if(1<Ns.length){var Pn=Ns[0];Ns=Ns[1];var kn=Pn.split("_");lt=2<=kn.length&&kn[1]=="type"?lt+(Pn+"="+Ns+"&"):lt+(Pn+"=redacted&")}}else lt=null;else lt=Me;return"XMLHTTP REQ ("+ce+") [attempt "+Ae+"]: "+M+`
`+K+`
`+lt})}function Ge(m,M,K,ce,Ae,Me,lt){m.info(function(){return"XMLHTTP RESP ("+ce+") [ attempt "+Ae+"]: "+M+`
`+K+`
`+Me+" "+lt})}function mt(m,M,K,ce){m.info(function(){return"XMLHTTP TEXT ("+M+"): "+Ye(m,K)+(ce?" "+ce:"")})}function pt(m,M){m.info(function(){return"TIMEOUT: "+M})}we.prototype.info=function(){};function Ye(m,M){if(!m.g)return M;if(!M)return null;try{var K=JSON.parse(M);if(K){for(m=0;m<K.length;m++)if(Array.isArray(K[m])){var ce=K[m];if(!(2>ce.length)){var Ae=ce[1];if(Array.isArray(Ae)&&!(1>Ae.length)){var Me=Ae[0];if(Me!="noop"&&Me!="stop"&&Me!="close")for(var lt=1;lt<Ae.length;lt++)Ae[lt]=""}}}}return xs(K)}catch{return M}}var Yt={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},je={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Fe;function De(){}L(De,vs),De.prototype.g=function(){return new XMLHttpRequest},De.prototype.i=function(){return{}},Fe=new De;function Ze(m,M,K,ce){this.j=m,this.i=M,this.l=K,this.R=ce||1,this.U=new it(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new at}function at(){this.i=null,this.g="",this.h=!1}var dt={},ot={};function Je(m,M,K){m.L=1,m.v=aa(ln(M)),m.m=K,m.P=!0,ft(m,null)}function ft(m,M){m.F=Date.now(),us(m),m.A=ln(m.v);var K=m.A,ce=m.R;Array.isArray(ce)||(ce=[String(ce)]),lc(K.i,"t",ce),m.C=0,K=m.j.J,m.h=new at,m.g=sm(m.j,K?M:null,!m.m),0<m.O&&(m.M=new Oe(p(m.Y,m,m.g),m.O)),M=m.U,K=m.g,ce=m.ca;var Ae="readystatechange";Array.isArray(Ae)||(Ae&&(Kt[0]=Ae.toString()),Ae=Kt);for(var Me=0;Me<Ae.length;Me++){var lt=xe(K,Ae[Me],ce||M.handleEvent,!1,M.h||M);if(!lt)break;M.g[lt.key]=lt}M=m.H?B(m.H):{},m.m?(m.u||(m.u="POST"),M["Content-Type"]="application/x-www-form-urlencoded",m.g.ea(m.A,m.u,m.m,M)):(m.u="GET",m.g.ea(m.A,m.u,null,M)),ke(),_e(m.i,m.u,m.A,m.l,m.R,m.m)}Ze.prototype.ca=function(m){m=m.target;const M=this.M;M&&Xn(m)==3?M.j():this.Y(m)},Ze.prototype.Y=function(m){try{if(m==this.g)e:{const kn=Xn(this.g);var M=this.g.Ba();const Ln=this.g.Z();if(!(3>kn)&&(kn!=3||this.g&&(this.h.h||this.g.oa()||Xh(this.g)))){this.J||kn!=4||M==7||(M==8||0>=Ln?ke(3):ke(2)),Gt(this);var K=this.g.Z();this.X=K;t:if(Dt(this)){var ce=Xh(this.g);m="";var Ae=ce.length,Me=Xn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Jn(this),pn(this);var lt="";break t}this.h.i=new l.TextDecoder}for(M=0;M<Ae;M++)this.h.h=!0,m+=this.h.i.decode(ce[M],{stream:!(Me&&M==Ae-1)});ce.length=0,this.h.g+=m,this.C=0,lt=this.h.g}else lt=this.g.oa();if(this.o=K==200,Ge(this.i,this.u,this.A,this.l,this.R,kn,K),this.o){if(this.T&&!this.K){t:{if(this.g){var _s,En=this.g;if((_s=En.g?En.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!T(_s)){var Ns=_s;break t}}Ns=null}if(K=Ns)mt(this.i,this.l,K,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,qo(this,K);else{this.o=!1,this.s=3,oe(12),Jn(this),pn(this);break e}}if(this.P){K=!0;let Er;for(;!this.J&&this.C<lt.length;)if(Er=gt(this,lt),Er==ot){kn==4&&(this.s=4,oe(14),K=!1),mt(this.i,this.l,null,"[Incomplete Response]");break}else if(Er==dt){this.s=4,oe(15),mt(this.i,this.l,lt,"[Invalid Chunk]"),K=!1;break}else mt(this.i,this.l,Er,null),qo(this,Er);if(Dt(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),kn!=4||lt.length!=0||this.h.h||(this.s=1,oe(16),K=!1),this.o=this.o&&K,!K)mt(this.i,this.l,lt,"[Invalid Chunked Response]"),Jn(this),pn(this);else if(0<lt.length&&!this.W){this.W=!0;var Pn=this.j;Pn.g==this&&Pn.ba&&!Pn.M&&(Pn.j.info("Great, no buffering proxy detected. Bytes received: "+lt.length),qd(Pn),Pn.M=!0,oe(11))}}else mt(this.i,this.l,lt,null),qo(this,lt);kn==4&&Jn(this),this.o&&!this.J&&(kn==4?Hd(this.j,this):(this.o=!1,us(this)))}else Zh(this.g),K==400&&0<lt.indexOf("Unknown SID")?(this.s=3,oe(12)):(this.s=0,oe(13)),Jn(this),pn(this)}}}catch{}finally{}};function Dt(m){return m.g?m.u=="GET"&&m.L!=2&&m.j.Ca:!1}function gt(m,M){var K=m.C,ce=M.indexOf(`
`,K);return ce==-1?ot:(K=Number(M.substring(K,ce)),isNaN(K)?dt:(ce+=1,ce+K>M.length?ot:(M=M.slice(ce,ce+K),m.C=ce+K,M)))}Ze.prototype.cancel=function(){this.J=!0,Jn(this)};function us(m){m.S=Date.now()+m.I,jt(m,m.I)}function jt(m,M){if(m.B!=null)throw Error("WatchDog timer not null");m.B=Ne(p(m.ba,m),M)}function Gt(m){m.B&&(l.clearTimeout(m.B),m.B=null)}Ze.prototype.ba=function(){this.B=null;const m=Date.now();0<=m-this.S?(pt(this.i,this.A),this.L!=2&&(ke(),oe(17)),Jn(this),this.s=2,pn(this)):jt(this,this.S-m)};function pn(m){m.j.G==0||m.J||Hd(m.j,m)}function Jn(m){Gt(m);var M=m.M;M&&typeof M.ma=="function"&&M.ma(),m.M=null,zs(m.U),m.g&&(M=m.g,m.g=null,M.abort(),M.ma())}function qo(m,M){try{var K=m.j;if(K.G!=0&&(K.g==m||ac(K.h,m))){if(!m.K&&ac(K.h,m)&&K.G==3){try{var ce=K.Da.g.parse(M)}catch{ce=null}if(Array.isArray(ce)&&ce.length==3){var Ae=ce;if(Ae[0]==0){e:if(!K.u){if(K.g)if(K.g.F+3e3<m.F)Xo(K),Ko(K);else break e;Wd(K),oe(18)}}else K.za=Ae[1],0<K.za-K.T&&37500>Ae[2]&&K.F&&K.v==0&&!K.C&&(K.C=Ne(p(K.Za,K),6e3));if(1>=Pd(K.h)&&K.ca){try{K.ca()}catch{}K.ca=void 0}}else xi(K,11)}else if((m.K||K.g==m)&&Xo(K),!T(M))for(Ae=K.Da.g.parse(M),M=0;M<Ae.length;M++){let Ns=Ae[M];if(K.T=Ns[0],Ns=Ns[1],K.G==2)if(Ns[0]=="c"){K.K=Ns[1],K.ia=Ns[2];const Pn=Ns[3];Pn!=null&&(K.la=Pn,K.j.info("VER="+K.la));const kn=Ns[4];kn!=null&&(K.Aa=kn,K.j.info("SVER="+K.Aa));const Ln=Ns[5];Ln!=null&&typeof Ln=="number"&&0<Ln&&(ce=1.5*Ln,K.L=ce,K.j.info("backChannelRequestTimeoutMs_="+ce)),ce=K;const Er=m.g;if(Er){const Zo=Er.g?Er.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Zo){var Me=ce.h;Me.g||Zo.indexOf("spdy")==-1&&Zo.indexOf("quic")==-1&&Zo.indexOf("h2")==-1||(Me.j=Me.l,Me.g=new Set,Me.h&&(oc(Me,Me.h),Me.h=null))}if(ce.D){const gc=Er.g?Er.g.getResponseHeader("X-HTTP-Session-Id"):null;gc&&(ce.ya=gc,Cs(ce.I,ce.D,gc))}}K.G=3,K.l&&K.l.ua(),K.ba&&(K.R=Date.now()-m.F,K.j.info("Handshake RTT: "+K.R+"ms")),ce=K;var lt=m;if(ce.qa=Qd(ce,ce.J?ce.ia:null,ce.W),lt.K){kd(ce.h,lt);var _s=lt,En=ce.L;En&&(_s.I=En),_s.B&&(Gt(_s),us(_s)),ce.g=lt}else Jo(ce);0<K.i.length&&Yo(K)}else Ns[0]!="stop"&&Ns[0]!="close"||xi(K,7);else K.G==3&&(Ns[0]=="stop"||Ns[0]=="close"?Ns[0]=="stop"?xi(K,7):hc(K):Ns[0]!="noop"&&K.l&&K.l.ta(Ns),K.v=0)}}ke(4)}catch{}}var _d=class{constructor(m,M){this.g=m,this.map=M}};function Rd(m){this.l=m||10,l.PerformanceNavigationTiming?(m=l.performance.getEntriesByType("navigation"),m=0<m.length&&(m[0].nextHopProtocol=="hq"||m[0].nextHopProtocol=="h2")):m=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=m?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Dd(m){return m.h?!0:m.g?m.g.size>=m.j:!1}function Pd(m){return m.h?1:m.g?m.g.size:0}function ac(m,M){return m.h?m.h==M:m.g?m.g.has(M):!1}function oc(m,M){m.g?m.g.add(M):m.h=M}function kd(m,M){m.h&&m.h==M?m.h=null:m.g&&m.g.has(M)&&m.g.delete(M)}Rd.prototype.cancel=function(){if(this.i=Ld(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const m of this.g.values())m.cancel();this.g.clear()}};function Ld(m){if(m.h!=null)return m.i.concat(m.h.D);if(m.g!=null&&m.g.size!==0){let M=m.i;for(const K of m.g.values())M=M.concat(K.D);return M}return R(m.i)}function Bh(m){if(m.V&&typeof m.V=="function")return m.V();if(typeof Map<"u"&&m instanceof Map||typeof Set<"u"&&m instanceof Set)return Array.from(m.values());if(typeof m=="string")return m.split("");if(c(m)){for(var M=[],K=m.length,ce=0;ce<K;ce++)M.push(m[ce]);return M}M=[],K=0;for(ce in m)M[K++]=m[ce];return M}function Gh(m){if(m.na&&typeof m.na=="function")return m.na();if(!m.V||typeof m.V!="function"){if(typeof Map<"u"&&m instanceof Map)return Array.from(m.keys());if(!(typeof Set<"u"&&m instanceof Set)){if(c(m)||typeof m=="string"){var M=[];m=m.length;for(var K=0;K<m;K++)M.push(K);return M}M=[],K=0;for(const ce in m)M[K++]=ce;return M}}}function Fd(m,M){if(m.forEach&&typeof m.forEach=="function")m.forEach(M,void 0);else if(c(m)||typeof m=="string")Array.prototype.forEach.call(m,M,void 0);else for(var K=Gh(m),ce=Bh(m),Ae=ce.length,Me=0;Me<Ae;Me++)M.call(void 0,ce[Me],K&&K[Me],m)}var Or=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ur(m,M){if(m){m=m.split("&");for(var K=0;K<m.length;K++){var ce=m[K].indexOf("="),Ae=null;if(0<=ce){var Me=m[K].substring(0,ce);Ae=m[K].substring(ce+1)}else Me=m[K];M(Me,Ae?decodeURIComponent(Ae.replace(/\+/g," ")):"")}}}function hr(m){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,m instanceof hr){this.h=m.h,La(this,m.j),this.o=m.o,this.g=m.g,Fa(this,m.s),this.l=m.l;var M=m.i,K=new Sr;K.i=M.i,M.g&&(K.g=new Map(M.g),K.h=M.h),Mr(this,K),this.m=m.m}else m&&(M=String(m).match(Or))?(this.h=!1,La(this,M[1]||"",!0),this.o=Zr(M[2]||""),this.g=Zr(M[3]||"",!0),Fa(this,M[4]),this.l=Zr(M[5]||"",!0),Mr(this,M[6]||"",!0),this.m=Zr(M[7]||"")):(this.h=!1,this.i=new Sr(null,this.h))}hr.prototype.toString=function(){var m=[],M=this.j;M&&m.push(oa(M,la,!0),":");var K=this.g;return(K||M=="file")&&(m.push("//"),(M=this.o)&&m.push(oa(M,la,!0),"@"),m.push(encodeURIComponent(String(K)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),K=this.s,K!=null&&m.push(":",String(K))),(K=this.l)&&(this.g&&K.charAt(0)!="/"&&m.push("/"),m.push(oa(K,K.charAt(0)=="/"?qh:Od,!0))),(K=this.i.toString())&&m.push("?",K),(K=this.m)&&m.push("#",oa(K,Jf)),m.join("")};function ln(m){return new hr(m)}function La(m,M,K){m.j=K?Zr(M,!0):M,m.j&&(m.j=m.j.replace(/:$/,""))}function Fa(m,M){if(M){if(M=Number(M),isNaN(M)||0>M)throw Error("Bad port number "+M);m.s=M}else m.s=null}function Mr(m,M,K){M instanceof Sr?(m.i=M,Hh(m.i,m.h)):(K||(M=oa(M,gi)),m.i=new Sr(M,m.h))}function Cs(m,M,K){m.i.set(M,K)}function aa(m){return Cs(m,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),m}function Zr(m,M){return m?M?decodeURI(m.replace(/%25/g,"%2525")):decodeURIComponent(m):""}function oa(m,M,K){return typeof m=="string"?(m=encodeURI(m).replace(M,Wh),K&&(m=m.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m):null}function Wh(m){return m=m.charCodeAt(0),"%"+(m>>4&15).toString(16)+(m&15).toString(16)}var la=/[#\/\?@]/g,Od=/[#\?:]/g,qh=/[#\?]/g,gi=/[#\?@]/g,Jf=/#/g;function Sr(m,M){this.h=this.g=null,this.i=m||null,this.j=!!M}function Ur(m){m.g||(m.g=new Map,m.h=0,m.i&&ur(m.i,function(M,K){m.add(decodeURIComponent(M.replace(/\+/g," ")),K)}))}n=Sr.prototype,n.add=function(m,M){Ur(this),this.i=null,m=ei(this,m);var K=this.g.get(m);return K||this.g.set(m,K=[]),K.push(M),this.h+=1,this};function Md(m,M){Ur(m),M=ei(m,M),m.g.has(M)&&(m.i=null,m.h-=m.g.get(M).length,m.g.delete(M))}function Oa(m,M){return Ur(m),M=ei(m,M),m.g.has(M)}n.forEach=function(m,M){Ur(this),this.g.forEach(function(K,ce){K.forEach(function(Ae){m.call(M,Ae,ce,this)},this)},this)},n.na=function(){Ur(this);const m=Array.from(this.g.values()),M=Array.from(this.g.keys()),K=[];for(let ce=0;ce<M.length;ce++){const Ae=m[ce];for(let Me=0;Me<Ae.length;Me++)K.push(M[ce])}return K},n.V=function(m){Ur(this);let M=[];if(typeof m=="string")Oa(this,m)&&(M=M.concat(this.g.get(ei(this,m))));else{m=Array.from(this.g.values());for(let K=0;K<m.length;K++)M=M.concat(m[K])}return M},n.set=function(m,M){return Ur(this),this.i=null,m=ei(this,m),Oa(this,m)&&(this.h-=this.g.get(m).length),this.g.set(m,[M]),this.h+=1,this},n.get=function(m,M){return m?(m=this.V(m),0<m.length?String(m[0]):M):M};function lc(m,M,K){Md(m,M),0<K.length&&(m.i=null,m.g.set(ei(m,M),R(K)),m.h+=K.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const m=[],M=Array.from(this.g.keys());for(var K=0;K<M.length;K++){var ce=M[K];const Me=encodeURIComponent(String(ce)),lt=this.V(ce);for(ce=0;ce<lt.length;ce++){var Ae=Me;lt[ce]!==""&&(Ae+="="+encodeURIComponent(String(lt[ce]))),m.push(Ae)}}return this.i=m.join("&")};function ei(m,M){return M=String(M),m.j&&(M=M.toLowerCase()),M}function Hh(m,M){M&&!m.j&&(Ur(m),m.i=null,m.g.forEach(function(K,ce){var Ae=ce.toLowerCase();ce!=Ae&&(Md(this,ce),lc(this,Ae,K))},m)),m.j=M}function Qh(m,M){const K=new we;if(l.Image){const ce=new Image;ce.onload=j(mr,K,"TestLoadImage: loaded",!0,M,ce),ce.onerror=j(mr,K,"TestLoadImage: error",!1,M,ce),ce.onabort=j(mr,K,"TestLoadImage: abort",!1,M,ce),ce.ontimeout=j(mr,K,"TestLoadImage: timeout",!1,M,ce),l.setTimeout(function(){ce.ontimeout&&ce.ontimeout()},1e4),ce.src=m}else M(!1)}function Kh(m,M){const K=new we,ce=new AbortController,Ae=setTimeout(()=>{ce.abort(),mr(K,"TestPingServer: timeout",!1,M)},1e4);fetch(m,{signal:ce.signal}).then(Me=>{clearTimeout(Ae),Me.ok?mr(K,"TestPingServer: ok",!0,M):mr(K,"TestPingServer: server error",!1,M)}).catch(()=>{clearTimeout(Ae),mr(K,"TestPingServer: error",!1,M)})}function mr(m,M,K,ce,Ae){try{Ae&&(Ae.onload=null,Ae.onerror=null,Ae.onabort=null,Ae.ontimeout=null),ce(K)}catch{}}function Xf(){this.g=new Os}function Yh(m,M,K){const ce=K||"";try{Fd(m,function(Ae,Me){let lt=Ae;d(Ae)&&(lt=xs(Ae)),M.push(ce+Me+"="+encodeURIComponent(lt))})}catch(Ae){throw M.push(ce+"type="+encodeURIComponent("_badmap")),Ae}}function Ma(m){this.l=m.Ub||null,this.j=m.eb||!1}L(Ma,vs),Ma.prototype.g=function(){return new ca(this.l,this.j)},Ma.prototype.i=function(m){return function(){return m}}({});function ca(m,M){bt.call(this),this.D=m,this.o=M,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}L(ca,bt),n=ca.prototype,n.open=function(m,M){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=m,this.A=M,this.readyState=1,Fi(this)},n.send=function(m){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const M={headers:this.u,method:this.B,credentials:this.m,cache:void 0};m&&(M.body=m),(this.D||l).fetch(new Request(this.A,M)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ho(this)),this.readyState=0},n.Sa=function(m){if(this.g&&(this.l=m,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=m.headers,this.readyState=2,Fi(this)),this.g&&(this.readyState=3,Fi(this),this.g)))if(this.responseType==="arraybuffer")m.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in m){if(this.j=m.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;cc(this)}else m.text().then(this.Ra.bind(this),this.ga.bind(this))};function cc(m){m.j.read().then(m.Pa.bind(m)).catch(m.ga.bind(m))}n.Pa=function(m){if(this.g){if(this.o&&m.value)this.response.push(m.value);else if(!this.o){var M=m.value?m.value:new Uint8Array(0);(M=this.v.decode(M,{stream:!m.done}))&&(this.response=this.responseText+=M)}m.done?Ho(this):Fi(this),this.readyState==3&&cc(this)}},n.Ra=function(m){this.g&&(this.response=this.responseText=m,Ho(this))},n.Qa=function(m){this.g&&(this.response=m,Ho(this))},n.ga=function(){this.g&&Ho(this)};function Ho(m){m.readyState=4,m.l=null,m.j=null,m.v=null,Fi(m)}n.setRequestHeader=function(m,M){this.u.append(m,M)},n.getResponseHeader=function(m){return this.h&&this.h.get(m.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const m=[],M=this.h.entries();for(var K=M.next();!K.done;)K=K.value,m.push(K[0]+": "+K[1]),K=M.next();return m.join(`\r
`)};function Fi(m){m.onreadystatechange&&m.onreadystatechange.call(m)}Object.defineProperty(ca.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(m){this.m=m?"include":"same-origin"}});function Jh(m){let M="";return Q(m,function(K,ce){M+=ce,M+=":",M+=K,M+=`\r
`}),M}function dc(m,M,K){e:{for(ce in K){var ce=!1;break e}ce=!0}ce||(K=Jh(K),typeof m=="string"?K!=null&&encodeURIComponent(String(K)):Cs(m,M,K))}function Bs(m){bt.call(this),this.headers=new Map,this.o=m||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}L(Bs,bt);var Ud=/^https?$/i,$d=["POST","PUT"];n=Bs.prototype,n.Ha=function(m){this.J=m},n.ea=function(m,M,K,ce){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+m);M=M?M.toUpperCase():"GET",this.D=m,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Fe.g(),this.v=this.o?Z(this.o):Z(Fe),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(M,String(m),!0),this.B=!1}catch(Me){zd(this,Me);return}if(m=K||"",K=new Map(this.headers),ce)if(Object.getPrototypeOf(ce)===Object.prototype)for(var Ae in ce)K.set(Ae,ce[Ae]);else if(typeof ce.keys=="function"&&typeof ce.get=="function")for(const Me of ce.keys())K.set(Me,ce.get(Me));else throw Error("Unknown input type for opt_headers: "+String(ce));ce=Array.from(K.keys()).find(Me=>Me.toLowerCase()=="content-type"),Ae=l.FormData&&m instanceof l.FormData,!(0<=Array.prototype.indexOf.call($d,M,void 0))||ce||Ae||K.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Me,lt]of K)this.g.setRequestHeader(Me,lt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Vd(this),this.u=!0,this.g.send(m),this.u=!1}catch(Me){zd(this,Me)}};function zd(m,M){m.h=!1,m.g&&(m.j=!0,m.g.abort(),m.j=!1),m.l=M,m.m=5,Ua(m),Qo(m)}function Ua(m){m.A||(m.A=!0,At(m,"complete"),At(m,"error"))}n.abort=function(m){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=m||7,At(this,"complete"),At(this,"abort"),Qo(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Qo(this,!0)),Bs.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?uc(this):this.bb())},n.bb=function(){uc(this)};function uc(m){if(m.h&&typeof o<"u"&&(!m.v[1]||Xn(m)!=4||m.Z()!=2)){if(m.u&&Xn(m)==4)Ht(m.Ea,0,m);else if(At(m,"readystatechange"),Xn(m)==4){m.h=!1;try{const lt=m.Z();e:switch(lt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var M=!0;break e;default:M=!1}var K;if(!(K=M)){var ce;if(ce=lt===0){var Ae=String(m.D).match(Or)[1]||null;!Ae&&l.self&&l.self.location&&(Ae=l.self.location.protocol.slice(0,-1)),ce=!Ud.test(Ae?Ae.toLowerCase():"")}K=ce}if(K)At(m,"complete"),At(m,"success");else{m.m=6;try{var Me=2<Xn(m)?m.g.statusText:""}catch{Me=""}m.l=Me+" ["+m.Z()+"]",Ua(m)}}finally{Qo(m)}}}}function Qo(m,M){if(m.g){Vd(m);const K=m.g,ce=m.v[0]?()=>{}:null;m.g=null,m.v=null,M||At(m,"ready");try{K.onreadystatechange=ce}catch{}}}function Vd(m){m.I&&(l.clearTimeout(m.I),m.I=null)}n.isActive=function(){return!!this.g};function Xn(m){return m.g?m.g.readyState:0}n.Z=function(){try{return 2<Xn(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(m){if(this.g){var M=this.g.responseText;return m&&M.indexOf(m)==0&&(M=M.substring(m.length)),cs(M)}};function Xh(m){try{if(!m.g)return null;if("response"in m.g)return m.g.response;switch(m.H){case"":case"text":return m.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in m.g)return m.g.mozResponseArrayBuffer}return null}catch{return null}}function Zh(m){const M={};m=(m.g&&2<=Xn(m)&&m.g.getAllResponseHeaders()||"").split(`\r
`);for(let ce=0;ce<m.length;ce++){if(T(m[ce]))continue;var K=te(m[ce]);const Ae=K[0];if(K=K[1],typeof K!="string")continue;K=K.trim();const Me=M[Ae]||[];M[Ae]=Me,Me.push(K)}q(M,function(ce){return ce.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function $a(m,M,K){return K&&K.internalChannelParams&&K.internalChannelParams[m]||M}function Bd(m){this.Aa=0,this.i=[],this.j=new we,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=$a("failFast",!1,m),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=$a("baseRetryDelayMs",5e3,m),this.cb=$a("retryDelaySeedMs",1e4,m),this.Wa=$a("forwardChannelMaxRetries",2,m),this.wa=$a("forwardChannelRequestTimeoutMs",2e4,m),this.pa=m&&m.xmlHttpFactory||void 0,this.Xa=m&&m.Tb||void 0,this.Ca=m&&m.useFetchStreams||!1,this.L=void 0,this.J=m&&m.supportsCrossDomainXhr||!1,this.K="",this.h=new Rd(m&&m.concurrentRequestLimit),this.Da=new Xf,this.P=m&&m.fastHandshake||!1,this.O=m&&m.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=m&&m.Rb||!1,m&&m.xa&&this.j.xa(),m&&m.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&m&&m.detectBufferingProxy||!1,this.ja=void 0,m&&m.longPollingTimeout&&0<m.longPollingTimeout&&(this.ja=m.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Bd.prototype,n.la=8,n.G=1,n.connect=function(m,M,K,ce){oe(0),this.W=m,this.H=M||{},K&&ce!==void 0&&(this.H.OSID=K,this.H.OAID=ce),this.F=this.X,this.I=Qd(this,null,this.W),Yo(this)};function hc(m){if(mc(m),m.G==3){var M=m.U++,K=ln(m.I);if(Cs(K,"SID",m.K),Cs(K,"RID",M),Cs(K,"TYPE","terminate"),za(m,K),M=new Ze(m,m.j,M),M.L=2,M.v=aa(ln(K)),K=!1,l.navigator&&l.navigator.sendBeacon)try{K=l.navigator.sendBeacon(M.v.toString(),"")}catch{}!K&&l.Image&&(new Image().src=M.v,K=!0),K||(M.g=sm(M.j,null),M.g.ea(M.v)),M.F=Date.now(),us(M)}tm(m)}function Ko(m){m.g&&(qd(m),m.g.cancel(),m.g=null)}function mc(m){Ko(m),m.u&&(l.clearTimeout(m.u),m.u=null),Xo(m),m.h.cancel(),m.s&&(typeof m.s=="number"&&l.clearTimeout(m.s),m.s=null)}function Yo(m){if(!Dd(m.h)&&!m.s){m.s=!0;var M=m.Ga;z||k(),O||(z(),O=!0),E.add(M,m),m.B=0}}function Zf(m,M){return Pd(m.h)>=m.h.j-(m.s?1:0)?!1:m.s?(m.i=M.D.concat(m.i),!0):m.G==1||m.G==2||m.B>=(m.Va?0:m.Wa)?!1:(m.s=Ne(p(m.Ga,m,M),Oi(m,m.B)),m.B++,!0)}n.Ga=function(m){if(this.s)if(this.s=null,this.G==1){if(!m){this.U=Math.floor(1e5*Math.random()),m=this.U++;const Ae=new Ze(this,this.j,m);let Me=this.o;if(this.S&&(Me?(Me=B(Me),H(Me,this.S)):Me=this.S),this.m!==null||this.O||(Ae.H=Me,Me=null),this.P)e:{for(var M=0,K=0;K<this.i.length;K++){t:{var ce=this.i[K];if("__data__"in ce.map&&(ce=ce.map.__data__,typeof ce=="string")){ce=ce.length;break t}ce=void 0}if(ce===void 0)break;if(M+=ce,4096<M){M=K;break e}if(M===4096||K===this.i.length-1){M=K+1;break e}}M=1e3}else M=1e3;M=Gd(this,Ae,M),K=ln(this.I),Cs(K,"RID",m),Cs(K,"CVER",22),this.D&&Cs(K,"X-HTTP-Session-Id",this.D),za(this,K),Me&&(this.O?M="headers="+encodeURIComponent(String(Jh(Me)))+"&"+M:this.m&&dc(K,this.m,Me)),oc(this.h,Ae),this.Ua&&Cs(K,"TYPE","init"),this.P?(Cs(K,"$req",M),Cs(K,"SID","null"),Ae.T=!0,Je(Ae,K,null)):Je(Ae,K,M),this.G=2}}else this.G==3&&(m?em(this,m):this.i.length==0||Dd(this.h)||em(this))};function em(m,M){var K;M?K=M.l:K=m.U++;const ce=ln(m.I);Cs(ce,"SID",m.K),Cs(ce,"RID",K),Cs(ce,"AID",m.T),za(m,ce),m.m&&m.o&&dc(ce,m.m,m.o),K=new Ze(m,m.j,K,m.B+1),m.m===null&&(K.H=m.o),M&&(m.i=M.D.concat(m.i)),M=Gd(m,K,1e3),K.I=Math.round(.5*m.wa)+Math.round(.5*m.wa*Math.random()),oc(m.h,K),Je(K,ce,M)}function za(m,M){m.H&&Q(m.H,function(K,ce){Cs(M,ce,K)}),m.l&&Fd({},function(K,ce){Cs(M,ce,K)})}function Gd(m,M,K){K=Math.min(m.i.length,K);var ce=m.l?p(m.l.Na,m.l,m):null;e:{var Ae=m.i;let Me=-1;for(;;){const lt=["count="+K];Me==-1?0<K?(Me=Ae[0].g,lt.push("ofs="+Me)):Me=0:lt.push("ofs="+Me);let _s=!0;for(let En=0;En<K;En++){let Ns=Ae[En].g;const Pn=Ae[En].map;if(Ns-=Me,0>Ns)Me=Math.max(0,Ae[En].g-100),_s=!1;else try{Yh(Pn,lt,"req"+Ns+"_")}catch{ce&&ce(Pn)}}if(_s){ce=lt.join("&");break e}}}return m=m.i.splice(0,K),M.D=m,ce}function Jo(m){if(!m.g&&!m.u){m.Y=1;var M=m.Fa;z||k(),O||(z(),O=!0),E.add(M,m),m.v=0}}function Wd(m){return m.g||m.u||3<=m.v?!1:(m.Y++,m.u=Ne(p(m.Fa,m),Oi(m,m.v)),m.v++,!0)}n.Fa=function(){if(this.u=null,pc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var m=2*this.R;this.j.info("BP detection timer enabled: "+m),this.A=Ne(p(this.ab,this),m)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,oe(10),Ko(this),pc(this))};function qd(m){m.A!=null&&(l.clearTimeout(m.A),m.A=null)}function pc(m){m.g=new Ze(m,m.j,"rpc",m.Y),m.m===null&&(m.g.H=m.o),m.g.O=0;var M=ln(m.qa);Cs(M,"RID","rpc"),Cs(M,"SID",m.K),Cs(M,"AID",m.T),Cs(M,"CI",m.F?"0":"1"),!m.F&&m.ja&&Cs(M,"TO",m.ja),Cs(M,"TYPE","xmlhttp"),za(m,M),m.m&&m.o&&dc(M,m.m,m.o),m.L&&(m.g.I=m.L);var K=m.g;m=m.ia,K.L=1,K.v=aa(ln(M)),K.m=null,K.P=!0,ft(K,m)}n.Za=function(){this.C!=null&&(this.C=null,Ko(this),Wd(this),oe(19))};function Xo(m){m.C!=null&&(l.clearTimeout(m.C),m.C=null)}function Hd(m,M){var K=null;if(m.g==M){Xo(m),qd(m),m.g=null;var ce=2}else if(ac(m.h,M))K=M.D,kd(m.h,M),ce=1;else return;if(m.G!=0){if(M.o)if(ce==1){K=M.m?M.m.length:0,M=Date.now()-M.F;var Ae=m.B;ce=me(),At(ce,new Te(ce,K)),Yo(m)}else Jo(m);else if(Ae=M.s,Ae==3||Ae==0&&0<M.X||!(ce==1&&Zf(m,M)||ce==2&&Wd(m)))switch(K&&0<K.length&&(M=m.h,M.i=M.i.concat(K)),Ae){case 1:xi(m,5);break;case 4:xi(m,10);break;case 3:xi(m,6);break;default:xi(m,2)}}}function Oi(m,M){let K=m.Ta+Math.floor(Math.random()*m.cb);return m.isActive()||(K*=2),K*M}function xi(m,M){if(m.j.info("Error code "+M),M==2){var K=p(m.fb,m),ce=m.Xa;const Ae=!ce;ce=new hr(ce||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||La(ce,"https"),aa(ce),Ae?Qh(ce.toString(),K):Kh(ce.toString(),K)}else oe(2);m.G=0,m.l&&m.l.sa(M),tm(m),mc(m)}n.fb=function(m){m?(this.j.info("Successfully pinged google.com"),oe(2)):(this.j.info("Failed to ping google.com"),oe(1))};function tm(m){if(m.G=0,m.ka=[],m.l){const M=Ld(m.h);(M.length!=0||m.i.length!=0)&&(D(m.ka,M),D(m.ka,m.i),m.h.i.length=0,R(m.i),m.i.length=0),m.l.ra()}}function Qd(m,M,K){var ce=K instanceof hr?ln(K):new hr(K);if(ce.g!="")M&&(ce.g=M+"."+ce.g),Fa(ce,ce.s);else{var Ae=l.location;ce=Ae.protocol,M=M?M+"."+Ae.hostname:Ae.hostname,Ae=+Ae.port;var Me=new hr(null);ce&&La(Me,ce),M&&(Me.g=M),Ae&&Fa(Me,Ae),K&&(Me.l=K),ce=Me}return K=m.D,M=m.ya,K&&M&&Cs(ce,K,M),Cs(ce,"VER",m.la),za(m,ce),ce}function sm(m,M,K){if(M&&!m.J)throw Error("Can't create secondary domain capable XhrIo object.");return M=m.Ca&&!m.pa?new Bs(new Ma({eb:K})):new Bs(m.pa),M.Ha(m.J),M}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function nm(){}n=nm.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function fc(){}fc.prototype.g=function(m,M){return new pr(m,M)};function pr(m,M){bt.call(this),this.g=new Bd(M),this.l=m,this.h=M&&M.messageUrlParams||null,m=M&&M.messageHeaders||null,M&&M.clientProtocolHeaderRequired&&(m?m["X-Client-Protocol"]="webchannel":m={"X-Client-Protocol":"webchannel"}),this.g.o=m,m=M&&M.initMessageHeaders||null,M&&M.messageContentType&&(m?m["X-WebChannel-Content-Type"]=M.messageContentType:m={"X-WebChannel-Content-Type":M.messageContentType}),M&&M.va&&(m?m["X-WebChannel-Client-Profile"]=M.va:m={"X-WebChannel-Client-Profile":M.va}),this.g.S=m,(m=M&&M.Sb)&&!T(m)&&(this.g.m=m),this.v=M&&M.supportsCrossDomainXhr||!1,this.u=M&&M.sendRawJson||!1,(M=M&&M.httpSessionIdParam)&&!T(M)&&(this.g.D=M,m=this.h,m!==null&&M in m&&(m=this.h,M in m&&delete m[M])),this.j=new Va(this)}L(pr,bt),pr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},pr.prototype.close=function(){hc(this.g)},pr.prototype.o=function(m){var M=this.g;if(typeof m=="string"){var K={};K.__data__=m,m=K}else this.u&&(K={},K.__data__=xs(m),m=K);M.i.push(new _d(M.Ya++,m)),M.G==3&&Yo(M)},pr.prototype.N=function(){this.g.l=null,delete this.j,hc(this.g),delete this.g,pr.aa.N.call(this)};function Kd(m){re.call(this),m.__headers__&&(this.headers=m.__headers__,this.statusCode=m.__status__,delete m.__headers__,delete m.__status__);var M=m.__sm__;if(M){e:{for(const K in M){m=K;break e}m=void 0}(this.i=m)&&(m=this.i,M=M!==null&&m in M?M[m]:void 0),this.data=M}else this.data=m}L(Kd,re);function Yd(){J.call(this),this.status=1}L(Yd,J);function Va(m){this.g=m}L(Va,nm),Va.prototype.ua=function(){At(this.g,"a")},Va.prototype.ta=function(m){At(this.g,new Kd(m))},Va.prototype.sa=function(m){At(this.g,new Yd)},Va.prototype.ra=function(){At(this.g,"b")},fc.prototype.createWebChannel=fc.prototype.g,pr.prototype.send=pr.prototype.o,pr.prototype.open=pr.prototype.m,pr.prototype.close=pr.prototype.close,GC=function(){return new fc},BC=function(){return me()},VC=he,uy={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Yt.NO_ERROR=0,Yt.TIMEOUT=8,Yt.HTTP_ERROR=6,Jm=Yt,je.COMPLETE="complete",zC=je,v.EventType=se,se.OPEN="a",se.CLOSE="b",se.ERROR="c",se.MESSAGE="d",bt.prototype.listen=bt.prototype.K,gu=v,Bs.prototype.listenOnce=Bs.prototype.L,Bs.prototype.getLastError=Bs.prototype.Ka,Bs.prototype.getLastErrorCode=Bs.prototype.Ba,Bs.prototype.getStatus=Bs.prototype.Z,Bs.prototype.getResponseJson=Bs.prototype.Oa,Bs.prototype.getResponseText=Bs.prototype.oa,Bs.prototype.send=Bs.prototype.ea,Bs.prototype.setWithCredentials=Bs.prototype.Ha,$C=Bs}).apply(typeof _m<"u"?_m:typeof self<"u"?self:typeof window<"u"?window:{});const aN="@firebase/firestore",oN="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sr{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}sr.UNAUTHENTICATED=new sr(null),sr.GOOGLE_CREDENTIALS=new sr("google-credentials-uid"),sr.FIRST_PARTY=new sr("first-party-uid"),sr.MOCK_USER=new sr("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yd="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $l=new kb("@firebase/firestore");function Nc(){return $l.logLevel}function wt(n,...e){if($l.logLevel<=ps.DEBUG){const s=e.map(Ob);$l.debug(`Firestore (${yd}): ${n}`,...s)}}function _a(n,...e){if($l.logLevel<=ps.ERROR){const s=e.map(Ob);$l.error(`Firestore (${yd}): ${n}`,...s)}}function zl(n,...e){if($l.logLevel<=ps.WARN){const s=e.map(Ob);$l.warn(`Firestore (${yd}): ${n}`,...s)}}function Ob(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(s){return JSON.stringify(s)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ot(n,e,s){let r="Unexpected state";typeof e=="string"?r=e:s=e,WC(n,r,s)}function WC(n,e,s){let r=`FIRESTORE (${yd}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(s!==void 0)try{r+=" CONTEXT: "+JSON.stringify(s)}catch{r+=" CONTEXT: "+s}throw _a(r),new Error(r)}function Es(n,e,s,r){let i="Unexpected state";typeof s=="string"?i=s:r=s,n||WC(e,i,r)}function qt(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Be={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ht extends na{constructor(e,s){super(e,s),this.code=e,this.message=s,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji{constructor(){this.promise=new Promise((e,s)=>{this.resolve=e,this.reject=s})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qC{constructor(e,s){this.user=s,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class HC{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,s){e.enqueueRetryable(()=>s(sr.UNAUTHENTICATED))}shutdown(){}}class kk{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,s){this.changeListener=s,e.enqueueRetryable(()=>s(this.token.user))}shutdown(){this.changeListener=null}}class Lk{constructor(e){this.t=e,this.currentUser=sr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,s){Es(this.o===void 0,42304);let r=this.i;const i=c=>this.i!==r?(r=this.i,s(c)):Promise.resolve();let a=new Ji;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Ji,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const c=a;e.enqueueRetryable(async()=>{await c.promise,await i(this.currentUser)})},l=c=>{wt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>l(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(wt("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Ji)}},0),o()}getToken(){const e=this.i,s=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(s).then(r=>this.i!==e?(wt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Es(typeof r.accessToken=="string",31837,{l:r}),new qC(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Es(e===null||typeof e=="string",2055,{h:e}),new sr(e)}}class Fk{constructor(e,s,r){this.P=e,this.T=s,this.I=r,this.type="FirstParty",this.user=sr.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Ok{constructor(e,s,r){this.P=e,this.T=s,this.I=r}getToken(){return Promise.resolve(new Fk(this.P,this.T,this.I))}start(e,s){e.enqueueRetryable(()=>s(sr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class lN{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Mk{constructor(e,s){this.V=s,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Tr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,s){Es(this.o===void 0,3512);const r=a=>{a.error!=null&&wt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);const o=a.token!==this.m;return this.m=a.token,wt("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?s(a.token):Promise.resolve()};this.o=a=>{e.enqueueRetryable(()=>r(a))};const i=a=>{wt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(a=>i(a)),setTimeout(()=>{if(!this.appCheck){const a=this.V.getImmediate({optional:!0});a?i(a):wt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new lN(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(s=>s?(Es(typeof s.token=="string",44558,{tokenResult:s}),this.m=s.token,new lN(s.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uk(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),s=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(s);else for(let r=0;r<n;r++)s[r]=Math.floor(256*Math.random());return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vf{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=Uk(40);for(let a=0;a<i.length;++a)r.length<20&&i[a]<s&&(r+=e.charAt(i[a]%62))}return r}}function fs(n,e){return n<e?-1:n>e?1:0}function hy(n,e){const s=Math.min(n.length,e.length);for(let r=0;r<s;r++){const i=n.charAt(r),a=e.charAt(r);if(i!==a)return qg(i)===qg(a)?fs(i,a):qg(i)?1:-1}return fs(n.length,e.length)}const $k=55296,zk=57343;function qg(n){const e=n.charCodeAt(0);return e>=$k&&e<=zk}function nd(n,e,s){return n.length===e.length&&n.every((r,i)=>s(r,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cN="__name__";class Gi{constructor(e,s,r){s===void 0?s=0:s>e.length&&Ot(637,{offset:s,range:e.length}),r===void 0?r=e.length-s:r>e.length-s&&Ot(1746,{length:r,range:e.length-s}),this.segments=e,this.offset=s,this.len=r}get length(){return this.len}isEqual(e){return Gi.comparator(this,e)===0}child(e){const s=this.segments.slice(this.offset,this.limit());return e instanceof Gi?e.forEach(r=>{s.push(r)}):s.push(e),this.construct(s)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==e.get(s))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==e.get(s))return!1;return!0}forEach(e){for(let s=this.offset,r=this.limit();s<r;s++)e(this.segments[s])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,s){const r=Math.min(e.length,s.length);for(let i=0;i<r;i++){const a=Gi.compareSegments(e.get(i),s.get(i));if(a!==0)return a}return fs(e.length,s.length)}static compareSegments(e,s){const r=Gi.isNumericId(e),i=Gi.isNumericId(s);return r&&!i?-1:!r&&i?1:r&&i?Gi.extractNumericId(e).compare(Gi.extractNumericId(s)):hy(e,s)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return vo.fromString(e.substring(4,e.length-2))}}class $s extends Gi{construct(e,s,r){return new $s(e,s,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const s=[];for(const r of e){if(r.indexOf("//")>=0)throw new ht(Be.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);s.push(...r.split("/").filter(i=>i.length>0))}return new $s(s)}static emptyPath(){return new $s([])}}const Vk=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class zn extends Gi{construct(e,s,r){return new zn(e,s,r)}static isValidIdentifier(e){return Vk.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),zn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===cN}static keyField(){return new zn([cN])}static fromServerFormat(e){const s=[];let r="",i=0;const a=()=>{if(r.length===0)throw new ht(Be.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);s.push(r),r=""};let o=!1;for(;i<e.length;){const l=e[i];if(l==="\\"){if(i+1===e.length)throw new ht(Be.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new ht(Be.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else l==="`"?(o=!o,i++):l!=="."||o?(r+=l,i++):(a(),i++)}if(a(),o)throw new ht(Be.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new zn(s)}static emptyPath(){return new zn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pt{constructor(e){this.path=e}static fromPath(e){return new Pt($s.fromString(e))}static fromName(e){return new Pt($s.fromString(e).popFirst(5))}static empty(){return new Pt($s.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&$s.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,s){return $s.comparator(e.path,s.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Pt(new $s(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QC(n,e,s){if(!s)throw new ht(Be.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function KC(n,e,s,r){if(e===!0&&r===!0)throw new ht(Be.INVALID_ARGUMENT,`${n} and ${s} cannot be used together.`)}function dN(n){if(!Pt.isDocumentKey(n))throw new ht(Be.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function uN(n){if(Pt.isDocumentKey(n))throw new ht(Be.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function YC(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Nf(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Ot(12329,{type:typeof n})}function Qn(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new ht(Be.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=Nf(n);throw new ht(Be.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${s}`)}}return n}function Bk(n,e){if(e<=0)throw new ht(Be.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jn(n,e){const s={typeString:n};return e&&(s.value=e),s}function Th(n,e){if(!YC(n))throw new ht(Be.INVALID_ARGUMENT,"JSON must be an object");let s;for(const r in e)if(e[r]){const i=e[r].typeString,a="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){s=`JSON missing required field: '${r}'`;break}const o=n[r];if(i&&typeof o!==i){s=`JSON field '${r}' must be a ${i}.`;break}if(a!==void 0&&o!==a.value){s=`Expected '${r}' field to equal '${a.value}'`;break}}if(s)throw new ht(Be.INVALID_ARGUMENT,s);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hN=-62135596800,mN=1e6;class hs{static now(){return hs.fromMillis(Date.now())}static fromDate(e){return hs.fromMillis(e.getTime())}static fromMillis(e){const s=Math.floor(e/1e3),r=Math.floor((e-1e3*s)*mN);return new hs(s,r)}constructor(e,s){if(this.seconds=e,this.nanoseconds=s,s<0)throw new ht(Be.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(s>=1e9)throw new ht(Be.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(e<hN)throw new ht(Be.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ht(Be.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/mN}_compareTo(e){return this.seconds===e.seconds?fs(this.nanoseconds,e.nanoseconds):fs(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:hs._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Th(e,hs._jsonSchema))return new hs(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-hN;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}hs._jsonSchemaVersion="firestore/timestamp/1.0",hs._jsonSchema={type:jn("string",hs._jsonSchemaVersion),seconds:jn("number"),nanoseconds:jn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zt{static fromTimestamp(e){return new zt(e)}static min(){return new zt(new hs(0,0))}static max(){return new zt(new hs(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oh=-1;function Gk(n,e){const s=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=zt.fromTimestamp(r===1e9?new hs(s+1,0):new hs(s,r));return new Io(i,Pt.empty(),e)}function Wk(n){return new Io(n.readTime,n.key,oh)}class Io{constructor(e,s,r){this.readTime=e,this.documentKey=s,this.largestBatchId=r}static min(){return new Io(zt.min(),Pt.empty(),oh)}static max(){return new Io(zt.max(),Pt.empty(),oh)}}function qk(n,e){let s=n.readTime.compareTo(e.readTime);return s!==0?s:(s=Pt.comparator(n.documentKey,e.documentKey),s!==0?s:fs(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hk="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Qk{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bd(n){if(n.code!==Be.FAILED_PRECONDITION||n.message!==Hk)throw n;wt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class He{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(s=>{this.isDone=!0,this.result=s,this.nextCallback&&this.nextCallback(s)},s=>{this.isDone=!0,this.error=s,this.catchCallback&&this.catchCallback(s)})}catch(e){return this.next(void 0,e)}next(e,s){return this.callbackAttached&&Ot(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(e,this.result):new He((r,i)=>{this.nextCallback=a=>{this.wrapSuccess(e,a).next(r,i)},this.catchCallback=a=>{this.wrapFailure(s,a).next(r,i)}})}toPromise(){return new Promise((e,s)=>{this.next(e,s)})}wrapUserFunction(e){try{const s=e();return s instanceof He?s:He.resolve(s)}catch(s){return He.reject(s)}}wrapSuccess(e,s){return e?this.wrapUserFunction(()=>e(s)):He.resolve(s)}wrapFailure(e,s){return e?this.wrapUserFunction(()=>e(s)):He.reject(s)}static resolve(e){return new He((s,r)=>{s(e)})}static reject(e){return new He((s,r)=>{r(e)})}static waitFor(e){return new He((s,r)=>{let i=0,a=0,o=!1;e.forEach(l=>{++i,l.next(()=>{++a,o&&a===i&&s()},c=>r(c))}),o=!0,a===i&&s()})}static or(e){let s=He.resolve(!1);for(const r of e)s=s.next(i=>i?He.resolve(i):r());return s}static forEach(e,s){const r=[];return e.forEach((i,a)=>{r.push(s.call(this,i,a))}),this.waitFor(r)}static mapArray(e,s){return new He((r,i)=>{const a=e.length,o=new Array(a);let l=0;for(let c=0;c<a;c++){const d=c;s(e[d]).next(u=>{o[d]=u,++l,l===a&&r(o)},u=>i(u))}})}static doWhile(e,s){return new He((r,i)=>{const a=()=>{e()===!0?s().next(()=>{a()},i):r()};a()})}}function Kk(n){const e=n.match(/Android ([\d.]+)/i),s=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(s)}function wd(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jf{constructor(e,s){this.previousValue=e,s&&(s.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>s.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}jf.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mb=-1;function Ah(n){return n==null}function Dp(n){return n===0&&1/n==-1/0}function Yk(n){return typeof n=="number"&&Number.isInteger(n)&&!Dp(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JC="";function Jk(n){let e="";for(let s=0;s<n.length;s++)e.length>0&&(e=pN(e)),e=Xk(n.get(s),e);return pN(e)}function Xk(n,e){let s=e;const r=n.length;for(let i=0;i<r;i++){const a=n.charAt(i);switch(a){case"\0":s+="";break;case JC:s+="";break;default:s+=a}}return s}function pN(n){return n+JC+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fN(n){let e=0;for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&e++;return e}function Uo(n,e){for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&e(s,n[s])}function XC(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class on{constructor(e,s){this.comparator=e,this.root=s||qn.EMPTY}insert(e,s){return new on(this.comparator,this.root.insert(e,s,this.comparator).copy(null,null,qn.BLACK,null,null))}remove(e){return new on(this.comparator,this.root.remove(e,this.comparator).copy(null,null,qn.BLACK,null,null))}get(e){let s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return s.value;r<0?s=s.left:r>0&&(s=s.right)}return null}indexOf(e){let s=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return s+r.left.size;i<0?r=r.left:(s+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((s,r)=>(e(s,r),!1))}toString(){const e=[];return this.inorderTraversal((s,r)=>(e.push(`${s}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Rm(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Rm(this.root,e,this.comparator,!1)}getReverseIterator(){return new Rm(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Rm(this.root,e,this.comparator,!0)}}class Rm{constructor(e,s,r,i){this.isReverse=i,this.nodeStack=[];let a=1;for(;!e.isEmpty();)if(a=s?r(e.key,s):1,s&&i&&(a*=-1),a<0)e=this.isReverse?e.left:e.right;else{if(a===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const s={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return s}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class qn{constructor(e,s,r,i,a){this.key=e,this.value=s,this.color=r??qn.RED,this.left=i??qn.EMPTY,this.right=a??qn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,s,r,i,a){return new qn(e??this.key,s??this.value,r??this.color,i??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,s,r){let i=this;const a=r(e,i.key);return i=a<0?i.copy(null,null,null,i.left.insert(e,s,r),null):a===0?i.copy(null,s,null,null,null):i.copy(null,null,null,null,i.right.insert(e,s,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return qn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,s){let r,i=this;if(s(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,s),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),s(e,i.key)===0){if(i.right.isEmpty())return qn.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,s))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,qn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,qn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,s)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ot(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ot(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ot(27949);return e+(this.isRed()?0:1)}}qn.EMPTY=null,qn.RED=!0,qn.BLACK=!1;qn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ot(57766)}get value(){throw Ot(16141)}get color(){throw Ot(16727)}get left(){throw Ot(29726)}get right(){throw Ot(36894)}copy(e,s,r,i,a){return this}insert(e,s,r){return new qn(e,s)}remove(e,s){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rn{constructor(e){this.comparator=e,this.data=new on(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((s,r)=>(e(s),!1))}forEachInRange(e,s){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;s(i.key)}}forEachWhile(e,s){let r;for(r=s!==void 0?this.data.getIteratorFrom(s):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const s=this.data.getIteratorFrom(e);return s.hasNext()?s.getNext().key:null}getIterator(){return new gN(this.data.getIterator())}getIteratorFrom(e){return new gN(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let s=this;return s.size<e.size&&(s=e,e=this),e.forEach(r=>{s=s.add(r)}),s}isEqual(e){if(!(e instanceof Rn)||this.size!==e.size)return!1;const s=this.data.getIterator(),r=e.data.getIterator();for(;s.hasNext();){const i=s.getNext().key,a=r.getNext().key;if(this.comparator(i,a)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(s=>{e.push(s)}),e}toString(){const e=[];return this.forEach(s=>e.push(s)),"SortedSet("+e.toString()+")"}copy(e){const s=new Rn(this.comparator);return s.data=e,s}}class gN{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gr{constructor(e){this.fields=e,e.sort(zn.comparator)}static empty(){return new Gr([])}unionWith(e){let s=new Rn(zn.comparator);for(const r of this.fields)s=s.add(r);for(const r of e)s=s.add(r);return new Gr(s.toArray())}covers(e){for(const s of this.fields)if(s.isPrefixOf(e))return!0;return!1}isEqual(e){return nd(this.fields,e.fields,(s,r)=>s.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZC extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gn{constructor(e){this.binaryString=e}static fromBase64String(e){const s=function(i){try{return atob(i)}catch(a){throw typeof DOMException<"u"&&a instanceof DOMException?new ZC("Invalid base64 string: "+a):a}}(e);return new Gn(s)}static fromUint8Array(e){const s=function(i){let a="";for(let o=0;o<i.length;++o)a+=String.fromCharCode(i[o]);return a}(e);return new Gn(s)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(s){return btoa(s)}(this.binaryString)}toUint8Array(){return function(s){const r=new Uint8Array(s.length);for(let i=0;i<s.length;i++)r[i]=s.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return fs(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Gn.EMPTY_BYTE_STRING=new Gn("");const Zk=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function To(n){if(Es(!!n,39018),typeof n=="string"){let e=0;const s=Zk.exec(n);if(Es(!!s,46558,{timestamp:n}),s[1]){let i=s[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:gn(n.seconds),nanos:gn(n.nanos)}}function gn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ao(n){return typeof n=="string"?Gn.fromBase64String(n):Gn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eI="server_timestamp",tI="__type__",sI="__previous_value__",nI="__local_write_time__";function Ub(n){var s,r;return((r=(((s=n==null?void 0:n.mapValue)==null?void 0:s.fields)||{})[tI])==null?void 0:r.stringValue)===eI}function Sf(n){const e=n.mapValue.fields[sI];return Ub(e)?Sf(e):e}function lh(n){const e=To(n.mapValue.fields[nI].timestampValue);return new hs(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eL{constructor(e,s,r,i,a,o,l,c,d,u){this.databaseId=e,this.appId=s,this.persistenceKey=r,this.host=i,this.ssl=a,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=d,this.isUsingEmulator=u}}const Pp="(default)";class rd{constructor(e,s){this.projectId=e,this.database=s||Pp}static empty(){return new rd("","")}get isDefaultDatabase(){return this.database===Pp}isEqual(e){return e instanceof rd&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rI="__type__",tL="__max__",Dm={mapValue:{}},iI="__vector__",kp="value";function _o(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Ub(n)?4:nL(n)?9007199254740991:sL(n)?10:11:Ot(28295,{value:n})}function sa(n,e){if(n===e)return!0;const s=_o(n);if(s!==_o(e))return!1;switch(s){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return lh(n).isEqual(lh(e));case 3:return function(i,a){if(typeof i.timestampValue=="string"&&typeof a.timestampValue=="string"&&i.timestampValue.length===a.timestampValue.length)return i.timestampValue===a.timestampValue;const o=To(i.timestampValue),l=To(a.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,a){return Ao(i.bytesValue).isEqual(Ao(a.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,a){return gn(i.geoPointValue.latitude)===gn(a.geoPointValue.latitude)&&gn(i.geoPointValue.longitude)===gn(a.geoPointValue.longitude)}(n,e);case 2:return function(i,a){if("integerValue"in i&&"integerValue"in a)return gn(i.integerValue)===gn(a.integerValue);if("doubleValue"in i&&"doubleValue"in a){const o=gn(i.doubleValue),l=gn(a.doubleValue);return o===l?Dp(o)===Dp(l):isNaN(o)&&isNaN(l)}return!1}(n,e);case 9:return nd(n.arrayValue.values||[],e.arrayValue.values||[],sa);case 10:case 11:return function(i,a){const o=i.mapValue.fields||{},l=a.mapValue.fields||{};if(fN(o)!==fN(l))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(l[c]===void 0||!sa(o[c],l[c])))return!1;return!0}(n,e);default:return Ot(52216,{left:n})}}function ch(n,e){return(n.values||[]).find(s=>sa(s,e))!==void 0}function id(n,e){if(n===e)return 0;const s=_o(n),r=_o(e);if(s!==r)return fs(s,r);switch(s){case 0:case 9007199254740991:return 0;case 1:return fs(n.booleanValue,e.booleanValue);case 2:return function(a,o){const l=gn(a.integerValue||a.doubleValue),c=gn(o.integerValue||o.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1}(n,e);case 3:return xN(n.timestampValue,e.timestampValue);case 4:return xN(lh(n),lh(e));case 5:return hy(n.stringValue,e.stringValue);case 6:return function(a,o){const l=Ao(a),c=Ao(o);return l.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(a,o){const l=a.split("/"),c=o.split("/");for(let d=0;d<l.length&&d<c.length;d++){const u=fs(l[d],c[d]);if(u!==0)return u}return fs(l.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(a,o){const l=fs(gn(a.latitude),gn(o.latitude));return l!==0?l:fs(gn(a.longitude),gn(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return yN(n.arrayValue,e.arrayValue);case 10:return function(a,o){var p,j,L,R;const l=a.fields||{},c=o.fields||{},d=(p=l[kp])==null?void 0:p.arrayValue,u=(j=c[kp])==null?void 0:j.arrayValue,f=fs(((L=d==null?void 0:d.values)==null?void 0:L.length)||0,((R=u==null?void 0:u.values)==null?void 0:R.length)||0);return f!==0?f:yN(d,u)}(n.mapValue,e.mapValue);case 11:return function(a,o){if(a===Dm.mapValue&&o===Dm.mapValue)return 0;if(a===Dm.mapValue)return 1;if(o===Dm.mapValue)return-1;const l=a.fields||{},c=Object.keys(l),d=o.fields||{},u=Object.keys(d);c.sort(),u.sort();for(let f=0;f<c.length&&f<u.length;++f){const p=hy(c[f],u[f]);if(p!==0)return p;const j=id(l[c[f]],d[u[f]]);if(j!==0)return j}return fs(c.length,u.length)}(n.mapValue,e.mapValue);default:throw Ot(23264,{he:s})}}function xN(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return fs(n,e);const s=To(n),r=To(e),i=fs(s.seconds,r.seconds);return i!==0?i:fs(s.nanos,r.nanos)}function yN(n,e){const s=n.values||[],r=e.values||[];for(let i=0;i<s.length&&i<r.length;++i){const a=id(s[i],r[i]);if(a)return a}return fs(s.length,r.length)}function ad(n){return my(n)}function my(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(s){const r=To(s);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(s){return Ao(s).toBase64()}(n.bytesValue):"referenceValue"in n?function(s){return Pt.fromName(s).toString()}(n.referenceValue):"geoPointValue"in n?function(s){return`geo(${s.latitude},${s.longitude})`}(n.geoPointValue):"arrayValue"in n?function(s){let r="[",i=!0;for(const a of s.values||[])i?i=!1:r+=",",r+=my(a);return r+"]"}(n.arrayValue):"mapValue"in n?function(s){const r=Object.keys(s.fields||{}).sort();let i="{",a=!0;for(const o of r)a?a=!1:i+=",",i+=`${o}:${my(s.fields[o])}`;return i+"}"}(n.mapValue):Ot(61005,{value:n})}function Xm(n){switch(_o(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Sf(n);return e?16+Xm(e):16;case 5:return 2*n.stringValue.length;case 6:return Ao(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,a)=>i+Xm(a),0)}(n.arrayValue);case 10:case 11:return function(r){let i=0;return Uo(r.fields,(a,o)=>{i+=a.length+Xm(o)}),i}(n.mapValue);default:throw Ot(13486,{value:n})}}function bN(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function py(n){return!!n&&"integerValue"in n}function $b(n){return!!n&&"arrayValue"in n}function wN(n){return!!n&&"nullValue"in n}function vN(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Zm(n){return!!n&&"mapValue"in n}function sL(n){var s,r;return((r=(((s=n==null?void 0:n.mapValue)==null?void 0:s.fields)||{})[rI])==null?void 0:r.stringValue)===iI}function Au(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Uo(n.mapValue.fields,(s,r)=>e.mapValue.fields[s]=Au(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let s=0;s<(n.arrayValue.values||[]).length;++s)e.arrayValue.values[s]=Au(n.arrayValue.values[s]);return e}return{...n}}function nL(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===tL}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wr{constructor(e){this.value=e}static empty(){return new wr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let s=this.value;for(let r=0;r<e.length-1;++r)if(s=(s.mapValue.fields||{})[e.get(r)],!Zm(s))return null;return s=(s.mapValue.fields||{})[e.lastSegment()],s||null}}set(e,s){this.getFieldsMap(e.popLast())[e.lastSegment()]=Au(s)}setAll(e){let s=zn.emptyPath(),r={},i=[];e.forEach((o,l)=>{if(!s.isImmediateParentOf(l)){const c=this.getFieldsMap(s);this.applyChanges(c,r,i),r={},i=[],s=l.popLast()}o?r[l.lastSegment()]=Au(o):i.push(l.lastSegment())});const a=this.getFieldsMap(s);this.applyChanges(a,r,i)}delete(e){const s=this.field(e.popLast());Zm(s)&&s.mapValue.fields&&delete s.mapValue.fields[e.lastSegment()]}isEqual(e){return sa(this.value,e.value)}getFieldsMap(e){let s=this.value;s.mapValue.fields||(s.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=s.mapValue.fields[e.get(r)];Zm(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},s.mapValue.fields[e.get(r)]=i),s=i}return s.mapValue.fields}applyChanges(e,s,r){Uo(s,(i,a)=>e[i]=a);for(const i of r)delete e[i]}clone(){return new wr(Au(this.value))}}function aI(n){const e=[];return Uo(n.fields,(s,r)=>{const i=new zn([s]);if(Zm(r)){const a=aI(r.mapValue).fields;if(a.length===0)e.push(i);else for(const o of a)e.push(i.child(o))}else e.push(i)}),new Gr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $n{constructor(e,s,r,i,a,o,l){this.key=e,this.documentType=s,this.version=r,this.readTime=i,this.createTime=a,this.data=o,this.documentState=l}static newInvalidDocument(e){return new $n(e,0,zt.min(),zt.min(),zt.min(),wr.empty(),0)}static newFoundDocument(e,s,r,i){return new $n(e,1,s,zt.min(),r,i,0)}static newNoDocument(e,s){return new $n(e,2,s,zt.min(),zt.min(),wr.empty(),0)}static newUnknownDocument(e,s){return new $n(e,3,s,zt.min(),zt.min(),wr.empty(),2)}convertToFoundDocument(e,s){return!this.createTime.isEqual(zt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=s,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=wr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=wr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=zt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof $n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new $n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lp{constructor(e,s){this.position=e,this.inclusive=s}}function NN(n,e,s){let r=0;for(let i=0;i<n.position.length;i++){const a=e[i],o=n.position[i];if(a.field.isKeyField()?r=Pt.comparator(Pt.fromName(o.referenceValue),s.key):r=id(o,s.data.field(a.field)),a.dir==="desc"&&(r*=-1),r!==0)break}return r}function jN(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let s=0;s<n.position.length;s++)if(!sa(n.position[s],e.position[s]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dh{constructor(e,s="asc"){this.field=e,this.dir=s}}function rL(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oI{}class vn extends oI{constructor(e,s,r){super(),this.field=e,this.op=s,this.value=r}static create(e,s,r){return e.isKeyField()?s==="in"||s==="not-in"?this.createKeyFieldInFilter(e,s,r):new aL(e,s,r):s==="array-contains"?new cL(e,r):s==="in"?new dL(e,r):s==="not-in"?new uL(e,r):s==="array-contains-any"?new hL(e,r):new vn(e,s,r)}static createKeyFieldInFilter(e,s,r){return s==="in"?new oL(e,r):new lL(e,r)}matches(e){const s=e.data.field(this.field);return this.op==="!="?s!==null&&s.nullValue===void 0&&this.matchesComparison(id(s,this.value)):s!==null&&_o(this.value)===_o(s)&&this.matchesComparison(id(s,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ot(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Pi extends oI{constructor(e,s){super(),this.filters=e,this.op=s,this.Pe=null}static create(e,s){return new Pi(e,s)}matches(e){return lI(this)?this.filters.find(s=>!s.matches(e))===void 0:this.filters.find(s=>s.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,s)=>e.concat(s.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function lI(n){return n.op==="and"}function cI(n){return iL(n)&&lI(n)}function iL(n){for(const e of n.filters)if(e instanceof Pi)return!1;return!0}function fy(n){if(n instanceof vn)return n.field.canonicalString()+n.op.toString()+ad(n.value);if(cI(n))return n.filters.map(e=>fy(e)).join(",");{const e=n.filters.map(s=>fy(s)).join(",");return`${n.op}(${e})`}}function dI(n,e){return n instanceof vn?function(r,i){return i instanceof vn&&r.op===i.op&&r.field.isEqual(i.field)&&sa(r.value,i.value)}(n,e):n instanceof Pi?function(r,i){return i instanceof Pi&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((a,o,l)=>a&&dI(o,i.filters[l]),!0):!1}(n,e):void Ot(19439)}function uI(n){return n instanceof vn?function(s){return`${s.field.canonicalString()} ${s.op} ${ad(s.value)}`}(n):n instanceof Pi?function(s){return s.op.toString()+" {"+s.getFilters().map(uI).join(" ,")+"}"}(n):"Filter"}class aL extends vn{constructor(e,s,r){super(e,s,r),this.key=Pt.fromName(r.referenceValue)}matches(e){const s=Pt.comparator(e.key,this.key);return this.matchesComparison(s)}}class oL extends vn{constructor(e,s){super(e,"in",s),this.keys=hI("in",s)}matches(e){return this.keys.some(s=>s.isEqual(e.key))}}class lL extends vn{constructor(e,s){super(e,"not-in",s),this.keys=hI("not-in",s)}matches(e){return!this.keys.some(s=>s.isEqual(e.key))}}function hI(n,e){var s;return(((s=e.arrayValue)==null?void 0:s.values)||[]).map(r=>Pt.fromName(r.referenceValue))}class cL extends vn{constructor(e,s){super(e,"array-contains",s)}matches(e){const s=e.data.field(this.field);return $b(s)&&ch(s.arrayValue,this.value)}}class dL extends vn{constructor(e,s){super(e,"in",s)}matches(e){const s=e.data.field(this.field);return s!==null&&ch(this.value.arrayValue,s)}}class uL extends vn{constructor(e,s){super(e,"not-in",s)}matches(e){if(ch(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const s=e.data.field(this.field);return s!==null&&s.nullValue===void 0&&!ch(this.value.arrayValue,s)}}class hL extends vn{constructor(e,s){super(e,"array-contains-any",s)}matches(e){const s=e.data.field(this.field);return!(!$b(s)||!s.arrayValue.values)&&s.arrayValue.values.some(r=>ch(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mL{constructor(e,s=null,r=[],i=[],a=null,o=null,l=null){this.path=e,this.collectionGroup=s,this.orderBy=r,this.filters=i,this.limit=a,this.startAt=o,this.endAt=l,this.Te=null}}function SN(n,e=null,s=[],r=[],i=null,a=null,o=null){return new mL(n,e,s,r,i,a,o)}function zb(n){const e=qt(n);if(e.Te===null){let s=e.path.canonicalString();e.collectionGroup!==null&&(s+="|cg:"+e.collectionGroup),s+="|f:",s+=e.filters.map(r=>fy(r)).join(","),s+="|ob:",s+=e.orderBy.map(r=>function(a){return a.field.canonicalString()+a.dir}(r)).join(","),Ah(e.limit)||(s+="|l:",s+=e.limit),e.startAt&&(s+="|lb:",s+=e.startAt.inclusive?"b:":"a:",s+=e.startAt.position.map(r=>ad(r)).join(",")),e.endAt&&(s+="|ub:",s+=e.endAt.inclusive?"a:":"b:",s+=e.endAt.position.map(r=>ad(r)).join(",")),e.Te=s}return e.Te}function Vb(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let s=0;s<n.orderBy.length;s++)if(!rL(n.orderBy[s],e.orderBy[s]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let s=0;s<n.filters.length;s++)if(!dI(n.filters[s],e.filters[s]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!jN(n.startAt,e.startAt)&&jN(n.endAt,e.endAt)}function gy(n){return Pt.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vd{constructor(e,s=null,r=[],i=[],a=null,o="F",l=null,c=null){this.path=e,this.collectionGroup=s,this.explicitOrderBy=r,this.filters=i,this.limit=a,this.limitType=o,this.startAt=l,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function pL(n,e,s,r,i,a,o,l){return new vd(n,e,s,r,i,a,o,l)}function Ef(n){return new vd(n)}function EN(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function mI(n){return n.collectionGroup!==null}function _u(n){const e=qt(n);if(e.Ie===null){e.Ie=[];const s=new Set;for(const a of e.explicitOrderBy)e.Ie.push(a),s.add(a.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new Rn(zn.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(l=l.add(d.field))})}),l})(e).forEach(a=>{s.has(a.canonicalString())||a.isKeyField()||e.Ie.push(new dh(a,r))}),s.has(zn.keyField().canonicalString())||e.Ie.push(new dh(zn.keyField(),r))}return e.Ie}function Xi(n){const e=qt(n);return e.Ee||(e.Ee=fL(e,_u(n))),e.Ee}function fL(n,e){if(n.limitType==="F")return SN(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{const a=i.dir==="desc"?"asc":"desc";return new dh(i.field,a)});const s=n.endAt?new Lp(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Lp(n.startAt.position,n.startAt.inclusive):null;return SN(n.path,n.collectionGroup,e,n.filters,n.limit,s,r)}}function xy(n,e){const s=n.filters.concat([e]);return new vd(n.path,n.collectionGroup,n.explicitOrderBy.slice(),s,n.limit,n.limitType,n.startAt,n.endAt)}function Fp(n,e,s){return new vd(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,s,n.startAt,n.endAt)}function Cf(n,e){return Vb(Xi(n),Xi(e))&&n.limitType===e.limitType}function pI(n){return`${zb(Xi(n))}|lt:${n.limitType}`}function jc(n){return`Query(target=${function(s){let r=s.path.canonicalString();return s.collectionGroup!==null&&(r+=" collectionGroup="+s.collectionGroup),s.filters.length>0&&(r+=`, filters: [${s.filters.map(i=>uI(i)).join(", ")}]`),Ah(s.limit)||(r+=", limit: "+s.limit),s.orderBy.length>0&&(r+=`, orderBy: [${s.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),s.startAt&&(r+=", startAt: ",r+=s.startAt.inclusive?"b:":"a:",r+=s.startAt.position.map(i=>ad(i)).join(",")),s.endAt&&(r+=", endAt: ",r+=s.endAt.inclusive?"a:":"b:",r+=s.endAt.position.map(i=>ad(i)).join(",")),`Target(${r})`}(Xi(n))}; limitType=${n.limitType})`}function If(n,e){return e.isFoundDocument()&&function(r,i){const a=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(a):Pt.isDocumentKey(r.path)?r.path.isEqual(a):r.path.isImmediateParentOf(a)}(n,e)&&function(r,i){for(const a of _u(r))if(!a.field.isKeyField()&&i.data.field(a.field)===null)return!1;return!0}(n,e)&&function(r,i){for(const a of r.filters)if(!a.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,l,c){const d=NN(o,l,c);return o.inclusive?d<=0:d<0}(r.startAt,_u(r),i)||r.endAt&&!function(o,l,c){const d=NN(o,l,c);return o.inclusive?d>=0:d>0}(r.endAt,_u(r),i))}(n,e)}function gL(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function fI(n){return(e,s)=>{let r=!1;for(const i of _u(n)){const a=xL(i,e,s);if(a!==0)return a;r=r||i.field.isKeyField()}return 0}}function xL(n,e,s){const r=n.field.isKeyField()?Pt.comparator(e.key,s.key):function(a,o,l){const c=o.data.field(a),d=l.data.field(a);return c!==null&&d!==null?id(c,d):Ot(42886)}(n.field,e,s);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Ot(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xl{constructor(e,s){this.mapKeyFn=e,this.equalsFn=s,this.inner={},this.innerSize=0}get(e){const s=this.mapKeyFn(e),r=this.inner[s];if(r!==void 0){for(const[i,a]of r)if(this.equalsFn(i,e))return a}}has(e){return this.get(e)!==void 0}set(e,s){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,s]],void this.innerSize++;for(let a=0;a<i.length;a++)if(this.equalsFn(i[a][0],e))return void(i[a]=[e,s]);i.push([e,s]),this.innerSize++}delete(e){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[s]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Uo(this.inner,(s,r)=>{for(const[i,a]of r)e(i,a)})}isEmpty(){return XC(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yL=new on(Pt.comparator);function Ra(){return yL}const gI=new on(Pt.comparator);function xu(...n){let e=gI;for(const s of n)e=e.insert(s.key,s);return e}function xI(n){let e=gI;return n.forEach((s,r)=>e=e.insert(s,r.overlayedDocument)),e}function Sl(){return Ru()}function yI(){return Ru()}function Ru(){return new Xl(n=>n.toString(),(n,e)=>n.isEqual(e))}const bL=new on(Pt.comparator),wL=new Rn(Pt.comparator);function gs(...n){let e=wL;for(const s of n)e=e.add(s);return e}const vL=new Rn(fs);function NL(){return vL}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bb(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Dp(e)?"-0":e}}function bI(n){return{integerValue:""+n}}function wI(n,e){return Yk(e)?bI(e):Bb(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tf{constructor(){this._=void 0}}function jL(n,e,s){return n instanceof uh?function(i,a){const o={fields:{[tI]:{stringValue:eI},[nI]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return a&&Ub(a)&&(a=Sf(a)),a&&(o.fields[sI]=a),{mapValue:o}}(s,e):n instanceof hh?NI(n,e):n instanceof mh?jI(n,e):function(i,a){const o=vI(i,a),l=CN(o)+CN(i.Ae);return py(o)&&py(i.Ae)?bI(l):Bb(i.serializer,l)}(n,e)}function SL(n,e,s){return n instanceof hh?NI(n,e):n instanceof mh?jI(n,e):s}function vI(n,e){return n instanceof ph?function(r){return py(r)||function(a){return!!a&&"doubleValue"in a}(r)}(e)?e:{integerValue:0}:null}class uh extends Tf{}class hh extends Tf{constructor(e){super(),this.elements=e}}function NI(n,e){const s=SI(e);for(const r of n.elements)s.some(i=>sa(i,r))||s.push(r);return{arrayValue:{values:s}}}class mh extends Tf{constructor(e){super(),this.elements=e}}function jI(n,e){let s=SI(e);for(const r of n.elements)s=s.filter(i=>!sa(i,r));return{arrayValue:{values:s}}}class ph extends Tf{constructor(e,s){super(),this.serializer=e,this.Ae=s}}function CN(n){return gn(n.integerValue||n.doubleValue)}function SI(n){return $b(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EI{constructor(e,s){this.field=e,this.transform=s}}function EL(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof hh&&i instanceof hh||r instanceof mh&&i instanceof mh?nd(r.elements,i.elements,sa):r instanceof ph&&i instanceof ph?sa(r.Ae,i.Ae):r instanceof uh&&i instanceof uh}(n.transform,e.transform)}class CL{constructor(e,s){this.version=e,this.transformResults=s}}class Nn{constructor(e,s){this.updateTime=e,this.exists=s}static none(){return new Nn}static exists(e){return new Nn(void 0,e)}static updateTime(e){return new Nn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ep(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Af{}function CI(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Rh(n.key,Nn.none()):new _h(n.key,n.data,Nn.none());{const s=n.data,r=wr.empty();let i=new Rn(zn.comparator);for(let a of e.fields)if(!i.has(a)){let o=s.field(a);o===null&&a.length>1&&(a=a.popLast(),o=s.field(a)),o===null?r.delete(a):r.set(a,o),i=i.add(a)}return new $o(n.key,r,new Gr(i.toArray()),Nn.none())}}function IL(n,e,s){n instanceof _h?function(i,a,o){const l=i.value.clone(),c=TN(i.fieldTransforms,a,o.transformResults);l.setAll(c),a.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,s):n instanceof $o?function(i,a,o){if(!ep(i.precondition,a))return void a.convertToUnknownDocument(o.version);const l=TN(i.fieldTransforms,a,o.transformResults),c=a.data;c.setAll(II(i)),c.setAll(l),a.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,s):function(i,a,o){a.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,s)}function Du(n,e,s,r){return n instanceof _h?function(a,o,l,c){if(!ep(a.precondition,o))return l;const d=a.value.clone(),u=AN(a.fieldTransforms,c,o);return d.setAll(u),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),null}(n,e,s,r):n instanceof $o?function(a,o,l,c){if(!ep(a.precondition,o))return l;const d=AN(a.fieldTransforms,c,o),u=o.data;return u.setAll(II(a)),u.setAll(d),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),l===null?null:l.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(f=>f.field))}(n,e,s,r):function(a,o,l){return ep(a.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l}(n,e,s)}function TL(n,e){let s=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),a=vI(r.transform,i||null);a!=null&&(s===null&&(s=wr.empty()),s.set(r.field,a))}return s||null}function IN(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&nd(r,i,(a,o)=>EL(a,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class _h extends Af{constructor(e,s,r,i=[]){super(),this.key=e,this.value=s,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class $o extends Af{constructor(e,s,r,i,a=[]){super(),this.key=e,this.data=s,this.fieldMask=r,this.precondition=i,this.fieldTransforms=a,this.type=1}getFieldMask(){return this.fieldMask}}function II(n){const e=new Map;return n.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const r=n.data.field(s);e.set(s,r)}}),e}function TN(n,e,s){const r=new Map;Es(n.length===s.length,32656,{Re:s.length,Ve:n.length});for(let i=0;i<s.length;i++){const a=n[i],o=a.transform,l=e.data.field(a.field);r.set(a.field,SL(o,l,s[i]))}return r}function AN(n,e,s){const r=new Map;for(const i of n){const a=i.transform,o=s.data.field(i.field);r.set(i.field,jL(a,o,e))}return r}class Rh extends Af{constructor(e,s){super(),this.key=e,this.precondition=s,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class TI extends Af{constructor(e,s){super(),this.key=e,this.precondition=s,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AL{constructor(e,s,r,i){this.batchId=e,this.localWriteTime=s,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,s){const r=s.mutationResults;for(let i=0;i<this.mutations.length;i++){const a=this.mutations[i];a.key.isEqual(e.key)&&IL(a,e,r[i])}}applyToLocalView(e,s){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(s=Du(r,e,s,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(s=Du(r,e,s,this.localWriteTime));return s}applyToLocalDocumentSet(e,s){const r=yI();return this.mutations.forEach(i=>{const a=e.get(i.key),o=a.overlayedDocument;let l=this.applyToLocalView(o,a.mutatedFields);l=s.has(i.key)?null:l;const c=CI(o,l);c!==null&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(zt.min())}),r}keys(){return this.mutations.reduce((e,s)=>e.add(s.key),gs())}isEqual(e){return this.batchId===e.batchId&&nd(this.mutations,e.mutations,(s,r)=>IN(s,r))&&nd(this.baseMutations,e.baseMutations,(s,r)=>IN(s,r))}}class Gb{constructor(e,s,r,i){this.batch=e,this.commitVersion=s,this.mutationResults=r,this.docVersions=i}static from(e,s,r){Es(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=function(){return bL}();const a=e.mutations;for(let o=0;o<a.length;o++)i=i.insert(a[o].key,r[o].version);return new Gb(e,s,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _L{constructor(e,s){this.largestBatchId=e,this.mutation=s}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RL{constructor(e,s){this.count=e,this.unchangedNames=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var bn,js;function AI(n){switch(n){case Be.OK:return Ot(64938);case Be.CANCELLED:case Be.UNKNOWN:case Be.DEADLINE_EXCEEDED:case Be.RESOURCE_EXHAUSTED:case Be.INTERNAL:case Be.UNAVAILABLE:case Be.UNAUTHENTICATED:return!1;case Be.INVALID_ARGUMENT:case Be.NOT_FOUND:case Be.ALREADY_EXISTS:case Be.PERMISSION_DENIED:case Be.FAILED_PRECONDITION:case Be.ABORTED:case Be.OUT_OF_RANGE:case Be.UNIMPLEMENTED:case Be.DATA_LOSS:return!0;default:return Ot(15467,{code:n})}}function _I(n){if(n===void 0)return _a("GRPC error has no .code"),Be.UNKNOWN;switch(n){case bn.OK:return Be.OK;case bn.CANCELLED:return Be.CANCELLED;case bn.UNKNOWN:return Be.UNKNOWN;case bn.DEADLINE_EXCEEDED:return Be.DEADLINE_EXCEEDED;case bn.RESOURCE_EXHAUSTED:return Be.RESOURCE_EXHAUSTED;case bn.INTERNAL:return Be.INTERNAL;case bn.UNAVAILABLE:return Be.UNAVAILABLE;case bn.UNAUTHENTICATED:return Be.UNAUTHENTICATED;case bn.INVALID_ARGUMENT:return Be.INVALID_ARGUMENT;case bn.NOT_FOUND:return Be.NOT_FOUND;case bn.ALREADY_EXISTS:return Be.ALREADY_EXISTS;case bn.PERMISSION_DENIED:return Be.PERMISSION_DENIED;case bn.FAILED_PRECONDITION:return Be.FAILED_PRECONDITION;case bn.ABORTED:return Be.ABORTED;case bn.OUT_OF_RANGE:return Be.OUT_OF_RANGE;case bn.UNIMPLEMENTED:return Be.UNIMPLEMENTED;case bn.DATA_LOSS:return Be.DATA_LOSS;default:return Ot(39323,{code:n})}}(js=bn||(bn={}))[js.OK=0]="OK",js[js.CANCELLED=1]="CANCELLED",js[js.UNKNOWN=2]="UNKNOWN",js[js.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",js[js.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",js[js.NOT_FOUND=5]="NOT_FOUND",js[js.ALREADY_EXISTS=6]="ALREADY_EXISTS",js[js.PERMISSION_DENIED=7]="PERMISSION_DENIED",js[js.UNAUTHENTICATED=16]="UNAUTHENTICATED",js[js.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",js[js.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",js[js.ABORTED=10]="ABORTED",js[js.OUT_OF_RANGE=11]="OUT_OF_RANGE",js[js.UNIMPLEMENTED=12]="UNIMPLEMENTED",js[js.INTERNAL=13]="INTERNAL",js[js.UNAVAILABLE=14]="UNAVAILABLE",js[js.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DL(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PL=new vo([4294967295,4294967295],0);function _N(n){const e=DL().encode(n),s=new UC;return s.update(e),new Uint8Array(s.digest())}function RN(n){const e=new DataView(n.buffer),s=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),a=e.getUint32(12,!0);return[new vo([s,r],0),new vo([i,a],0)]}class Wb{constructor(e,s,r){if(this.bitmap=e,this.padding=s,this.hashCount=r,s<0||s>=8)throw new yu(`Invalid padding: ${s}`);if(r<0)throw new yu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new yu(`Invalid hash count: ${r}`);if(e.length===0&&s!==0)throw new yu(`Invalid padding when bitmap length is 0: ${s}`);this.ge=8*e.length-s,this.pe=vo.fromNumber(this.ge)}ye(e,s,r){let i=e.add(s.multiply(vo.fromNumber(r)));return i.compare(PL)===1&&(i=new vo([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const s=_N(e),[r,i]=RN(s);for(let a=0;a<this.hashCount;a++){const o=this.ye(r,i,a);if(!this.we(o))return!1}return!0}static create(e,s,r){const i=e%8==0?0:8-e%8,a=new Uint8Array(Math.ceil(e/8)),o=new Wb(a,i,s);return r.forEach(l=>o.insert(l)),o}insert(e){if(this.ge===0)return;const s=_N(e),[r,i]=RN(s);for(let a=0;a<this.hashCount;a++){const o=this.ye(r,i,a);this.Se(o)}}Se(e){const s=Math.floor(e/8),r=e%8;this.bitmap[s]|=1<<r}}class yu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _f{constructor(e,s,r,i,a){this.snapshotVersion=e,this.targetChanges=s,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=a}static createSynthesizedRemoteEventForCurrentChange(e,s,r){const i=new Map;return i.set(e,Dh.createSynthesizedTargetChangeForCurrentChange(e,s,r)),new _f(zt.min(),i,new on(fs),Ra(),gs())}}class Dh{constructor(e,s,r,i,a){this.resumeToken=e,this.current=s,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=a}static createSynthesizedTargetChangeForCurrentChange(e,s,r){return new Dh(r,s,gs(),gs(),gs())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tp{constructor(e,s,r,i){this.be=e,this.removedTargetIds=s,this.key=r,this.De=i}}class RI{constructor(e,s){this.targetId=e,this.Ce=s}}class DI{constructor(e,s,r=Gn.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=s,this.resumeToken=r,this.cause=i}}class DN{constructor(){this.ve=0,this.Fe=PN(),this.Me=Gn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=gs(),s=gs(),r=gs();return this.Fe.forEach((i,a)=>{switch(a){case 0:e=e.add(i);break;case 2:s=s.add(i);break;case 1:r=r.add(i);break;default:Ot(38017,{changeType:a})}}),new Dh(this.Me,this.xe,e,s,r)}qe(){this.Oe=!1,this.Fe=PN()}Qe(e,s){this.Oe=!0,this.Fe=this.Fe.insert(e,s)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Es(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class kL{constructor(e){this.Ge=e,this.ze=new Map,this.je=Ra(),this.Je=Pm(),this.He=Pm(),this.Ye=new on(fs)}Ze(e){for(const s of e.be)e.De&&e.De.isFoundDocument()?this.Xe(s,e.De):this.et(s,e.key,e.De);for(const s of e.removedTargetIds)this.et(s,e.key,e.De)}tt(e){this.forEachTarget(e,s=>{const r=this.nt(s);switch(e.state){case 0:this.rt(s)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(s);break;case 3:this.rt(s)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(s)&&(this.it(s),r.Le(e.resumeToken));break;default:Ot(56790,{state:e.state})}})}forEachTarget(e,s){e.targetIds.length>0?e.targetIds.forEach(s):this.ze.forEach((r,i)=>{this.rt(i)&&s(i)})}st(e){const s=e.targetId,r=e.Ce.count,i=this.ot(s);if(i){const a=i.target;if(gy(a))if(r===0){const o=new Pt(a.path);this.et(s,o,$n.newNoDocument(o,zt.min()))}else Es(r===1,20013,{expectedCount:r});else{const o=this._t(s);if(o!==r){const l=this.ut(e),c=l?this.ct(l,e,o):1;if(c!==0){this.it(s);const d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(s,d)}}}}}ut(e){const s=e.Ce.unchangedNames;if(!s||!s.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:a=0}=s;let o,l;try{o=Ao(r).toUint8Array()}catch(c){if(c instanceof ZC)return zl("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new Wb(o,i,a)}catch(c){return zl(c instanceof yu?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.ge===0?null:l}ct(e,s,r){return s.Ce.count===r-this.Pt(e,s.targetId)?0:2}Pt(e,s){const r=this.Ge.getRemoteKeysForTarget(s);let i=0;return r.forEach(a=>{const o=this.Ge.ht(),l=`projects/${o.projectId}/databases/${o.database}/documents/${a.path.canonicalString()}`;e.mightContain(l)||(this.et(s,a,null),i++)}),i}Tt(e){const s=new Map;this.ze.forEach((a,o)=>{const l=this.ot(o);if(l){if(a.current&&gy(l.target)){const c=new Pt(l.target.path);this.It(c).has(o)||this.Et(o,c)||this.et(o,c,$n.newNoDocument(c,e))}a.Be&&(s.set(o,a.ke()),a.qe())}});let r=gs();this.He.forEach((a,o)=>{let l=!0;o.forEachWhile(c=>{const d=this.ot(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(a))}),this.je.forEach((a,o)=>o.setReadTime(e));const i=new _f(e,s,this.Ye,this.je,r);return this.je=Ra(),this.Je=Pm(),this.He=Pm(),this.Ye=new on(fs),i}Xe(e,s){if(!this.rt(e))return;const r=this.Et(e,s.key)?2:0;this.nt(e).Qe(s.key,r),this.je=this.je.insert(s.key,s),this.Je=this.Je.insert(s.key,this.It(s.key).add(e)),this.He=this.He.insert(s.key,this.dt(s.key).add(e))}et(e,s,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,s)?i.Qe(s,1):i.$e(s),this.He=this.He.insert(s,this.dt(s).delete(e)),this.He=this.He.insert(s,this.dt(s).add(e)),r&&(this.je=this.je.insert(s,r))}removeTarget(e){this.ze.delete(e)}_t(e){const s=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+s.addedDocuments.size-s.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let s=this.ze.get(e);return s||(s=new DN,this.ze.set(e,s)),s}dt(e){let s=this.He.get(e);return s||(s=new Rn(fs),this.He=this.He.insert(e,s)),s}It(e){let s=this.Je.get(e);return s||(s=new Rn(fs),this.Je=this.Je.insert(e,s)),s}rt(e){const s=this.ot(e)!==null;return s||wt("WatchChangeAggregator","Detected inactive target",e),s}ot(e){const s=this.ze.get(e);return s&&s.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new DN),this.Ge.getRemoteKeysForTarget(e).forEach(s=>{this.et(e,s,null)})}Et(e,s){return this.Ge.getRemoteKeysForTarget(e).has(s)}}function Pm(){return new on(Pt.comparator)}function PN(){return new on(Pt.comparator)}const LL={asc:"ASCENDING",desc:"DESCENDING"},FL={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},OL={and:"AND",or:"OR"};class ML{constructor(e,s){this.databaseId=e,this.useProto3Json=s}}function yy(n,e){return n.useProto3Json||Ah(e)?e:{value:e}}function Op(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function PI(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function UL(n,e){return Op(n,e.toTimestamp())}function Hr(n){return Es(!!n,49232),zt.fromTimestamp(function(s){const r=To(s);return new hs(r.seconds,r.nanos)}(n))}function qb(n,e){return by(n,e).canonicalString()}function by(n,e){const s=function(i){return new $s(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?s:s.child(e)}function kI(n){const e=$s.fromString(n);return Es($I(e),10190,{key:e.toString()}),e}function Mp(n,e){return qb(n.databaseId,e.path)}function Pu(n,e){const s=kI(e);if(s.get(1)!==n.databaseId.projectId)throw new ht(Be.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+n.databaseId.projectId);if(s.get(3)!==n.databaseId.database)throw new ht(Be.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+n.databaseId.database);return new Pt(FI(s))}function LI(n,e){return qb(n.databaseId,e)}function $L(n){const e=kI(n);return e.length===4?$s.emptyPath():FI(e)}function wy(n){return new $s(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function FI(n){return Es(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function kN(n,e,s){return{name:Mp(n,e),fields:s.value.mapValue.fields}}function zL(n,e){return"found"in e?function(r,i){Es(!!i.found,43571),i.found.name,i.found.updateTime;const a=Pu(r,i.found.name),o=Hr(i.found.updateTime),l=i.found.createTime?Hr(i.found.createTime):zt.min(),c=new wr({mapValue:{fields:i.found.fields}});return $n.newFoundDocument(a,o,l,c)}(n,e):"missing"in e?function(r,i){Es(!!i.missing,3894),Es(!!i.readTime,22933);const a=Pu(r,i.missing),o=Hr(i.readTime);return $n.newNoDocument(a,o)}(n,e):Ot(7234,{result:e})}function VL(n,e){let s;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:Ot(39313,{state:d})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],a=function(d,u){return d.useProto3Json?(Es(u===void 0||typeof u=="string",58123),Gn.fromBase64String(u||"")):(Es(u===void 0||u instanceof Buffer||u instanceof Uint8Array,16193),Gn.fromUint8Array(u||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&function(d){const u=d.code===void 0?Be.UNKNOWN:_I(d.code);return new ht(u,d.message||"")}(o);s=new DI(r,i,a,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Pu(n,r.document.name),a=Hr(r.document.updateTime),o=r.document.createTime?Hr(r.document.createTime):zt.min(),l=new wr({mapValue:{fields:r.document.fields}}),c=$n.newFoundDocument(i,a,o,l),d=r.targetIds||[],u=r.removedTargetIds||[];s=new tp(d,u,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Pu(n,r.document),a=r.readTime?Hr(r.readTime):zt.min(),o=$n.newNoDocument(i,a),l=r.removedTargetIds||[];s=new tp([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Pu(n,r.document),a=r.removedTargetIds||[];s=new tp([],a,i,null)}else{if(!("filter"in e))return Ot(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:a}=r,o=new RL(i,a),l=r.targetId;s=new RI(l,o)}}return s}function OI(n,e){let s;if(e instanceof _h)s={update:kN(n,e.key,e.value)};else if(e instanceof Rh)s={delete:Mp(n,e.key)};else if(e instanceof $o)s={update:kN(n,e.key,e.data),updateMask:JL(e.fieldMask)};else{if(!(e instanceof TI))return Ot(16599,{Vt:e.type});s={verify:Mp(n,e.key)}}return e.fieldTransforms.length>0&&(s.updateTransforms=e.fieldTransforms.map(r=>function(a,o){const l=o.transform;if(l instanceof uh)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof hh)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof mh)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof ph)return{fieldPath:o.field.canonicalString(),increment:l.Ae};throw Ot(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(s.currentDocument=function(i,a){return a.updateTime!==void 0?{updateTime:UL(i,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:Ot(27497)}(n,e.precondition)),s}function BL(n,e){return n&&n.length>0?(Es(e!==void 0,14353),n.map(s=>function(i,a){let o=i.updateTime?Hr(i.updateTime):Hr(a);return o.isEqual(zt.min())&&(o=Hr(a)),new CL(o,i.transformResults||[])}(s,e))):[]}function GL(n,e){return{documents:[LI(n,e.path)]}}function WL(n,e){const s={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,s.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),s.structuredQuery.from=[{collectionId:r.lastSegment()}]),s.parent=LI(n,i);const a=function(d){if(d.length!==0)return UI(Pi.create(d,"and"))}(e.filters);a&&(s.structuredQuery.where=a);const o=function(d){if(d.length!==0)return d.map(u=>function(p){return{field:Sc(p.field),direction:QL(p.dir)}}(u))}(e.orderBy);o&&(s.structuredQuery.orderBy=o);const l=yy(n,e.limit);return l!==null&&(s.structuredQuery.limit=l),e.startAt&&(s.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(s.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{ft:s,parent:i}}function qL(n){let e=$L(n.parent);const s=n.structuredQuery,r=s.from?s.from.length:0;let i=null;if(r>0){Es(r===1,65062);const u=s.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let a=[];s.where&&(a=function(f){const p=MI(f);return p instanceof Pi&&cI(p)?p.getFilters():[p]}(s.where));let o=[];s.orderBy&&(o=function(f){return f.map(p=>function(L){return new dh(Ec(L.field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(L.direction))}(p))}(s.orderBy));let l=null;s.limit&&(l=function(f){let p;return p=typeof f=="object"?f.value:f,Ah(p)?null:p}(s.limit));let c=null;s.startAt&&(c=function(f){const p=!!f.before,j=f.values||[];return new Lp(j,p)}(s.startAt));let d=null;return s.endAt&&(d=function(f){const p=!f.before,j=f.values||[];return new Lp(j,p)}(s.endAt)),pL(e,i,o,a,l,"F",c,d)}function HL(n,e){const s=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ot(28987,{purpose:i})}}(e.purpose);return s==null?null:{"goog-listen-tags":s}}function MI(n){return n.unaryFilter!==void 0?function(s){switch(s.unaryFilter.op){case"IS_NAN":const r=Ec(s.unaryFilter.field);return vn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Ec(s.unaryFilter.field);return vn.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const a=Ec(s.unaryFilter.field);return vn.create(a,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Ec(s.unaryFilter.field);return vn.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ot(61313);default:return Ot(60726)}}(n):n.fieldFilter!==void 0?function(s){return vn.create(Ec(s.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ot(58110);default:return Ot(50506)}}(s.fieldFilter.op),s.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(s){return Pi.create(s.compositeFilter.filters.map(r=>MI(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Ot(1026)}}(s.compositeFilter.op))}(n):Ot(30097,{filter:n})}function QL(n){return LL[n]}function KL(n){return FL[n]}function YL(n){return OL[n]}function Sc(n){return{fieldPath:n.canonicalString()}}function Ec(n){return zn.fromServerFormat(n.fieldPath)}function UI(n){return n instanceof vn?function(s){if(s.op==="=="){if(vN(s.value))return{unaryFilter:{field:Sc(s.field),op:"IS_NAN"}};if(wN(s.value))return{unaryFilter:{field:Sc(s.field),op:"IS_NULL"}}}else if(s.op==="!="){if(vN(s.value))return{unaryFilter:{field:Sc(s.field),op:"IS_NOT_NAN"}};if(wN(s.value))return{unaryFilter:{field:Sc(s.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Sc(s.field),op:KL(s.op),value:s.value}}}(n):n instanceof Pi?function(s){const r=s.getFilters().map(i=>UI(i));return r.length===1?r[0]:{compositeFilter:{op:YL(s.op),filters:r}}}(n):Ot(54877,{filter:n})}function JL(n){const e=[];return n.fields.forEach(s=>e.push(s.canonicalString())),{fieldPaths:e}}function $I(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oo{constructor(e,s,r,i,a=zt.min(),o=zt.min(),l=Gn.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=s,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new oo(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,s){return new oo(this.target,this.targetId,this.purpose,this.sequenceNumber,s,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new oo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new oo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XL{constructor(e){this.yt=e}}function ZL(n){const e=qL({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Fp(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eF{constructor(){this.Cn=new tF}addToCollectionParentIndex(e,s){return this.Cn.add(s),He.resolve()}getCollectionParents(e,s){return He.resolve(this.Cn.getEntries(s))}addFieldIndex(e,s){return He.resolve()}deleteFieldIndex(e,s){return He.resolve()}deleteAllFieldIndexes(e){return He.resolve()}createTargetIndexes(e,s){return He.resolve()}getDocumentsMatchingTarget(e,s){return He.resolve(null)}getIndexType(e,s){return He.resolve(0)}getFieldIndexes(e,s){return He.resolve([])}getNextCollectionGroupToUpdate(e){return He.resolve(null)}getMinOffset(e,s){return He.resolve(Io.min())}getMinOffsetFromCollectionGroup(e,s){return He.resolve(Io.min())}updateCollectionGroup(e,s,r){return He.resolve()}updateIndexEntries(e,s){return He.resolve()}}class tF{constructor(){this.index={}}add(e){const s=e.lastSegment(),r=e.popLast(),i=this.index[s]||new Rn($s.comparator),a=!i.has(r);return this.index[s]=i.add(r),a}has(e){const s=e.lastSegment(),r=e.popLast(),i=this.index[s];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Rn($s.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LN={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},zI=41943040;class Cr{static withCacheSize(e){return new Cr(e,Cr.DEFAULT_COLLECTION_PERCENTILE,Cr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,s,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=s,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Cr.DEFAULT_COLLECTION_PERCENTILE=10,Cr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Cr.DEFAULT=new Cr(zI,Cr.DEFAULT_COLLECTION_PERCENTILE,Cr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Cr.DISABLED=new Cr(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class od{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new od(0)}static cr(){return new od(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FN="LruGarbageCollector",sF=1048576;function ON([n,e],[s,r]){const i=fs(n,s);return i===0?fs(e,r):i}class nF{constructor(e){this.Ir=e,this.buffer=new Rn(ON),this.Er=0}dr(){return++this.Er}Ar(e){const s=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(s);else{const r=this.buffer.last();ON(s,r)<0&&(this.buffer=this.buffer.delete(r).add(s))}}get maxValue(){return this.buffer.last()[0]}}class rF{constructor(e,s,r){this.garbageCollector=e,this.asyncQueue=s,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){wt(FN,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(s){wd(s)?wt(FN,"Ignoring IndexedDB error during garbage collection: ",s):await bd(s)}await this.Vr(3e5)})}}class iF{constructor(e,s){this.mr=e,this.params=s}calculateTargetCount(e,s){return this.mr.gr(e).next(r=>Math.floor(s/100*r))}nthSequenceNumber(e,s){if(s===0)return He.resolve(jf.ce);const r=new nF(s);return this.mr.forEachTarget(e,i=>r.Ar(i.sequenceNumber)).next(()=>this.mr.pr(e,i=>r.Ar(i))).next(()=>r.maxValue)}removeTargets(e,s,r){return this.mr.removeTargets(e,s,r)}removeOrphanedDocuments(e,s){return this.mr.removeOrphanedDocuments(e,s)}collect(e,s){return this.params.cacheSizeCollectionThreshold===-1?(wt("LruGarbageCollector","Garbage collection skipped; disabled"),He.resolve(LN)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(wt("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),LN):this.yr(e,s))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,s){let r,i,a,o,l,c,d;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(wt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),i=this.params.maximumSequenceNumbersToCollect):i=f,o=Date.now(),this.nthSequenceNumber(e,i))).next(f=>(r=f,l=Date.now(),this.removeTargets(e,r,s))).next(f=>(a=f,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(d=Date.now(),Nc()<=ps.DEBUG&&wt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in `+(l-o)+`ms
	Removed ${a} targets in `+(c-l)+`ms
	Removed ${f} documents in `+(d-c)+`ms
Total Duration: ${d-u}ms`),He.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:a,documentsRemoved:f})))}}function aF(n,e){return new iF(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oF{constructor(){this.changes=new Xl(e=>e.toString(),(e,s)=>e.isEqual(s)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,s){this.assertNotApplied(),this.changes.set(e,$n.newInvalidDocument(e).setReadTime(s))}getEntry(e,s){this.assertNotApplied();const r=this.changes.get(s);return r!==void 0?He.resolve(r):this.getFromCache(e,s)}getEntries(e,s){return this.getAllFromCache(e,s)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lF{constructor(e,s){this.overlayedDocument=e,this.mutatedFields=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cF{constructor(e,s,r,i){this.remoteDocumentCache=e,this.mutationQueue=s,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,s){let r=null;return this.documentOverlayCache.getOverlay(e,s).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,s))).next(i=>(r!==null&&Du(r.mutation,i,Gr.empty(),hs.now()),i))}getDocuments(e,s){return this.remoteDocumentCache.getEntries(e,s).next(r=>this.getLocalViewOfDocuments(e,r,gs()).next(()=>r))}getLocalViewOfDocuments(e,s,r=gs()){const i=Sl();return this.populateOverlays(e,i,s).next(()=>this.computeViews(e,s,i,r).next(a=>{let o=xu();return a.forEach((l,c)=>{o=o.insert(l,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,s){const r=Sl();return this.populateOverlays(e,r,s).next(()=>this.computeViews(e,s,r,gs()))}populateOverlays(e,s,r){const i=[];return r.forEach(a=>{s.has(a)||i.push(a)}),this.documentOverlayCache.getOverlays(e,i).next(a=>{a.forEach((o,l)=>{s.set(o,l)})})}computeViews(e,s,r,i){let a=Ra();const o=Ru(),l=function(){return Ru()}();return s.forEach((c,d)=>{const u=r.get(d.key);i.has(d.key)&&(u===void 0||u.mutation instanceof $o)?a=a.insert(d.key,d):u!==void 0?(o.set(d.key,u.mutation.getFieldMask()),Du(u.mutation,d,u.mutation.getFieldMask(),hs.now())):o.set(d.key,Gr.empty())}),this.recalculateAndSaveOverlays(e,a).next(c=>(c.forEach((d,u)=>o.set(d,u)),s.forEach((d,u)=>l.set(d,new lF(u,o.get(d)??null))),l))}recalculateAndSaveOverlays(e,s){const r=Ru();let i=new on((o,l)=>o-l),a=gs();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,s).next(o=>{for(const l of o)l.keys().forEach(c=>{const d=s.get(c);if(d===null)return;let u=r.get(c)||Gr.empty();u=l.applyToLocalView(d,u),r.set(c,u);const f=(i.get(l.batchId)||gs()).add(c);i=i.insert(l.batchId,f)})}).next(()=>{const o=[],l=i.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),d=c.key,u=c.value,f=yI();u.forEach(p=>{if(!a.has(p)){const j=CI(s.get(p),r.get(p));j!==null&&f.set(p,j),a=a.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,d,f))}return He.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,s){return this.remoteDocumentCache.getEntries(e,s).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,s,r,i){return function(o){return Pt.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(s)?this.getDocumentsMatchingDocumentQuery(e,s.path):mI(s)?this.getDocumentsMatchingCollectionGroupQuery(e,s,r,i):this.getDocumentsMatchingCollectionQuery(e,s,r,i)}getNextDocuments(e,s,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,s,r,i).next(a=>{const o=i-a.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,s,r.largestBatchId,i-a.size):He.resolve(Sl());let l=oh,c=a;return o.next(d=>He.forEach(d,(u,f)=>(l<f.largestBatchId&&(l=f.largestBatchId),a.get(u)?He.resolve():this.remoteDocumentCache.getEntry(e,u).next(p=>{c=c.insert(u,p)}))).next(()=>this.populateOverlays(e,d,a)).next(()=>this.computeViews(e,c,d,gs())).next(u=>({batchId:l,changes:xI(u)})))})}getDocumentsMatchingDocumentQuery(e,s){return this.getDocument(e,new Pt(s)).next(r=>{let i=xu();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,s,r,i){const a=s.collectionGroup;let o=xu();return this.indexManager.getCollectionParents(e,a).next(l=>He.forEach(l,c=>{const d=function(f,p){return new vd(p,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(s,c.child(a));return this.getDocumentsMatchingCollectionQuery(e,d,r,i).next(u=>{u.forEach((f,p)=>{o=o.insert(f,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,s,r,i){let a;return this.documentOverlayCache.getOverlaysForCollection(e,s.path,r.largestBatchId).next(o=>(a=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,s,r,a,i))).next(o=>{a.forEach((c,d)=>{const u=d.getKey();o.get(u)===null&&(o=o.insert(u,$n.newInvalidDocument(u)))});let l=xu();return o.forEach((c,d)=>{const u=a.get(c);u!==void 0&&Du(u.mutation,d,Gr.empty(),hs.now()),If(s,d)&&(l=l.insert(c,d))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dF{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,s){return He.resolve(this.Lr.get(s))}saveBundleMetadata(e,s){return this.Lr.set(s.id,function(i){return{id:i.id,version:i.version,createTime:Hr(i.createTime)}}(s)),He.resolve()}getNamedQuery(e,s){return He.resolve(this.kr.get(s))}saveNamedQuery(e,s){return this.kr.set(s.name,function(i){return{name:i.name,query:ZL(i.bundledQuery),readTime:Hr(i.readTime)}}(s)),He.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uF{constructor(){this.overlays=new on(Pt.comparator),this.qr=new Map}getOverlay(e,s){return He.resolve(this.overlays.get(s))}getOverlays(e,s){const r=Sl();return He.forEach(s,i=>this.getOverlay(e,i).next(a=>{a!==null&&r.set(i,a)})).next(()=>r)}saveOverlays(e,s,r){return r.forEach((i,a)=>{this.St(e,s,a)}),He.resolve()}removeOverlaysForBatchId(e,s,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach(a=>this.overlays=this.overlays.remove(a)),this.qr.delete(r)),He.resolve()}getOverlaysForCollection(e,s,r){const i=Sl(),a=s.length+1,o=new Pt(s.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const c=l.getNext().value,d=c.getKey();if(!s.isPrefixOf(d.path))break;d.path.length===a&&c.largestBatchId>r&&i.set(c.getKey(),c)}return He.resolve(i)}getOverlaysForCollectionGroup(e,s,r,i){let a=new on((d,u)=>d-u);const o=this.overlays.getIterator();for(;o.hasNext();){const d=o.getNext().value;if(d.getKey().getCollectionGroup()===s&&d.largestBatchId>r){let u=a.get(d.largestBatchId);u===null&&(u=Sl(),a=a.insert(d.largestBatchId,u)),u.set(d.getKey(),d)}}const l=Sl(),c=a.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,u)=>l.set(d,u)),!(l.size()>=i)););return He.resolve(l)}St(e,s,r){const i=this.overlays.get(r.key);if(i!==null){const o=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new _L(s,r));let a=this.qr.get(s);a===void 0&&(a=gs(),this.qr.set(s,a)),this.qr.set(s,a.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hF{constructor(){this.sessionToken=Gn.EMPTY_BYTE_STRING}getSessionToken(e){return He.resolve(this.sessionToken)}setSessionToken(e,s){return this.sessionToken=s,He.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hb{constructor(){this.Qr=new Rn(Mn.$r),this.Ur=new Rn(Mn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,s){const r=new Mn(e,s);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,s){e.forEach(r=>this.addReference(r,s))}removeReference(e,s){this.Gr(new Mn(e,s))}zr(e,s){e.forEach(r=>this.removeReference(r,s))}jr(e){const s=new Pt(new $s([])),r=new Mn(s,e),i=new Mn(s,e+1),a=[];return this.Ur.forEachInRange([r,i],o=>{this.Gr(o),a.push(o.key)}),a}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const s=new Pt(new $s([])),r=new Mn(s,e),i=new Mn(s,e+1);let a=gs();return this.Ur.forEachInRange([r,i],o=>{a=a.add(o.key)}),a}containsKey(e){const s=new Mn(e,0),r=this.Qr.firstAfterOrEqual(s);return r!==null&&e.isEqual(r.key)}}class Mn{constructor(e,s){this.key=e,this.Yr=s}static $r(e,s){return Pt.comparator(e.key,s.key)||fs(e.Yr,s.Yr)}static Kr(e,s){return fs(e.Yr,s.Yr)||Pt.comparator(e.key,s.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mF{constructor(e,s){this.indexManager=e,this.referenceDelegate=s,this.mutationQueue=[],this.tr=1,this.Zr=new Rn(Mn.$r)}checkEmpty(e){return He.resolve(this.mutationQueue.length===0)}addMutationBatch(e,s,r,i){const a=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new AL(a,s,r,i);this.mutationQueue.push(o);for(const l of i)this.Zr=this.Zr.add(new Mn(l.key,a)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return He.resolve(o)}lookupMutationBatch(e,s){return He.resolve(this.Xr(s))}getNextMutationBatchAfterBatchId(e,s){const r=s+1,i=this.ei(r),a=i<0?0:i;return He.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}getHighestUnacknowledgedBatchId(){return He.resolve(this.mutationQueue.length===0?Mb:this.tr-1)}getAllMutationBatches(e){return He.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,s){const r=new Mn(s,0),i=new Mn(s,Number.POSITIVE_INFINITY),a=[];return this.Zr.forEachInRange([r,i],o=>{const l=this.Xr(o.Yr);a.push(l)}),He.resolve(a)}getAllMutationBatchesAffectingDocumentKeys(e,s){let r=new Rn(fs);return s.forEach(i=>{const a=new Mn(i,0),o=new Mn(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([a,o],l=>{r=r.add(l.Yr)})}),He.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,s){const r=s.path,i=r.length+1;let a=r;Pt.isDocumentKey(a)||(a=a.child(""));const o=new Mn(new Pt(a),0);let l=new Rn(fs);return this.Zr.forEachWhile(c=>{const d=c.key.path;return!!r.isPrefixOf(d)&&(d.length===i&&(l=l.add(c.Yr)),!0)},o),He.resolve(this.ti(l))}ti(e){const s=[];return e.forEach(r=>{const i=this.Xr(r);i!==null&&s.push(i)}),s}removeMutationBatch(e,s){Es(this.ni(s.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return He.forEach(s.mutations,i=>{const a=new Mn(i.key,s.batchId);return r=r.delete(a),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,s){const r=new Mn(s,0),i=this.Zr.firstAfterOrEqual(r);return He.resolve(s.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,He.resolve()}ni(e,s){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const s=this.ei(e);return s<0||s>=this.mutationQueue.length?null:this.mutationQueue[s]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pF{constructor(e){this.ri=e,this.docs=function(){return new on(Pt.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,s){const r=s.key,i=this.docs.get(r),a=i?i.size:0,o=this.ri(s);return this.docs=this.docs.insert(r,{document:s.mutableCopy(),size:o}),this.size+=o-a,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const s=this.docs.get(e);s&&(this.docs=this.docs.remove(e),this.size-=s.size)}getEntry(e,s){const r=this.docs.get(s);return He.resolve(r?r.document.mutableCopy():$n.newInvalidDocument(s))}getEntries(e,s){let r=Ra();return s.forEach(i=>{const a=this.docs.get(i);r=r.insert(i,a?a.document.mutableCopy():$n.newInvalidDocument(i))}),He.resolve(r)}getDocumentsMatchingQuery(e,s,r,i){let a=Ra();const o=s.path,l=new Pt(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:d,value:{document:u}}=c.getNext();if(!o.isPrefixOf(d.path))break;d.path.length>o.length+1||qk(Wk(u),r)<=0||(i.has(u.key)||If(s,u))&&(a=a.insert(u.key,u.mutableCopy()))}return He.resolve(a)}getAllFromCollectionGroup(e,s,r,i){Ot(9500)}ii(e,s){return He.forEach(this.docs,r=>s(r))}newChangeBuffer(e){return new fF(this)}getSize(e){return He.resolve(this.size)}}class fF extends oF{constructor(e){super(),this.Nr=e}applyChanges(e){const s=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?s.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)}),He.waitFor(s)}getFromCache(e,s){return this.Nr.getEntry(e,s)}getAllFromCache(e,s){return this.Nr.getEntries(e,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gF{constructor(e){this.persistence=e,this.si=new Xl(s=>zb(s),Vb),this.lastRemoteSnapshotVersion=zt.min(),this.highestTargetId=0,this.oi=0,this._i=new Hb,this.targetCount=0,this.ai=od.ur()}forEachTarget(e,s){return this.si.forEach((r,i)=>s(i)),He.resolve()}getLastRemoteSnapshotVersion(e){return He.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return He.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),He.resolve(this.highestTargetId)}setTargetsMetadata(e,s,r){return r&&(this.lastRemoteSnapshotVersion=r),s>this.oi&&(this.oi=s),He.resolve()}Pr(e){this.si.set(e.target,e);const s=e.targetId;s>this.highestTargetId&&(this.ai=new od(s),this.highestTargetId=s),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,s){return this.Pr(s),this.targetCount+=1,He.resolve()}updateTargetData(e,s){return this.Pr(s),He.resolve()}removeTargetData(e,s){return this.si.delete(s.target),this._i.jr(s.targetId),this.targetCount-=1,He.resolve()}removeTargets(e,s,r){let i=0;const a=[];return this.si.forEach((o,l)=>{l.sequenceNumber<=s&&r.get(l.targetId)===null&&(this.si.delete(o),a.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)}),He.waitFor(a).next(()=>i)}getTargetCount(e){return He.resolve(this.targetCount)}getTargetData(e,s){const r=this.si.get(s)||null;return He.resolve(r)}addMatchingKeys(e,s,r){return this._i.Wr(s,r),He.resolve()}removeMatchingKeys(e,s,r){this._i.zr(s,r);const i=this.persistence.referenceDelegate,a=[];return i&&s.forEach(o=>{a.push(i.markPotentiallyOrphaned(e,o))}),He.waitFor(a)}removeMatchingKeysForTargetId(e,s){return this._i.jr(s),He.resolve()}getMatchingKeysForTargetId(e,s){const r=this._i.Hr(s);return He.resolve(r)}containsKey(e,s){return He.resolve(this._i.containsKey(s))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VI{constructor(e,s){this.ui={},this.overlays={},this.ci=new jf(0),this.li=!1,this.li=!0,this.hi=new hF,this.referenceDelegate=e(this),this.Pi=new gF(this),this.indexManager=new eF,this.remoteDocumentCache=function(i){return new pF(i)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new XL(s),this.Ii=new dF(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let s=this.overlays[e.toKey()];return s||(s=new uF,this.overlays[e.toKey()]=s),s}getMutationQueue(e,s){let r=this.ui[e.toKey()];return r||(r=new mF(s,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,s,r){wt("MemoryPersistence","Starting transaction:",e);const i=new xF(this.ci.next());return this.referenceDelegate.Ei(),r(i).next(a=>this.referenceDelegate.di(i).next(()=>a)).toPromise().then(a=>(i.raiseOnCommittedEvent(),a))}Ai(e,s){return He.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,s)))}}class xF extends Qk{constructor(e){super(),this.currentSequenceNumber=e}}class Qb{constructor(e){this.persistence=e,this.Ri=new Hb,this.Vi=null}static mi(e){return new Qb(e)}get fi(){if(this.Vi)return this.Vi;throw Ot(60996)}addReference(e,s,r){return this.Ri.addReference(r,s),this.fi.delete(r.toString()),He.resolve()}removeReference(e,s,r){return this.Ri.removeReference(r,s),this.fi.add(r.toString()),He.resolve()}markPotentiallyOrphaned(e,s){return this.fi.add(s.toString()),He.resolve()}removeTarget(e,s){this.Ri.jr(s.targetId).forEach(i=>this.fi.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,s.targetId).next(i=>{i.forEach(a=>this.fi.add(a.toString()))}).next(()=>r.removeTargetData(e,s))}Ei(){this.Vi=new Set}di(e){const s=this.persistence.getRemoteDocumentCache().newChangeBuffer();return He.forEach(this.fi,r=>{const i=Pt.fromPath(r);return this.gi(e,i).next(a=>{a||s.removeEntry(i,zt.min())})}).next(()=>(this.Vi=null,s.apply(e)))}updateLimboDocument(e,s){return this.gi(e,s).next(r=>{r?this.fi.delete(s.toString()):this.fi.add(s.toString())})}Ti(e){return 0}gi(e,s){return He.or([()=>He.resolve(this.Ri.containsKey(s)),()=>this.persistence.getTargetCache().containsKey(e,s),()=>this.persistence.Ai(e,s)])}}class Up{constructor(e,s){this.persistence=e,this.pi=new Xl(r=>Jk(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=aF(this,s)}static mi(e,s){return new Up(e,s)}Ei(){}di(e){return He.resolve()}forEachTarget(e,s){return this.persistence.getTargetCache().forEachTarget(e,s)}gr(e){const s=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>s.next(i=>r+i))}wr(e){let s=0;return this.pr(e,r=>{s++}).next(()=>s)}pr(e,s){return He.forEach(this.pi,(r,i)=>this.br(e,r,i).next(a=>a?He.resolve():s(i)))}removeTargets(e,s,r){return this.persistence.getTargetCache().removeTargets(e,s,r)}removeOrphanedDocuments(e,s){let r=0;const i=this.persistence.getRemoteDocumentCache(),a=i.newChangeBuffer();return i.ii(e,o=>this.br(e,o,s).next(l=>{l||(r++,a.removeEntry(o,zt.min()))})).next(()=>a.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,s){return this.pi.set(s,e.currentSequenceNumber),He.resolve()}removeTarget(e,s){const r=s.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,s,r){return this.pi.set(r,e.currentSequenceNumber),He.resolve()}removeReference(e,s,r){return this.pi.set(r,e.currentSequenceNumber),He.resolve()}updateLimboDocument(e,s){return this.pi.set(s,e.currentSequenceNumber),He.resolve()}Ti(e){let s=e.key.toString().length;return e.isFoundDocument()&&(s+=Xm(e.data.value)),s}br(e,s,r){return He.or([()=>this.persistence.Ai(e,s),()=>this.persistence.getTargetCache().containsKey(e,s),()=>{const i=this.pi.get(s);return He.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kb{constructor(e,s,r,i){this.targetId=e,this.fromCache=s,this.Es=r,this.ds=i}static As(e,s){let r=gs(),i=gs();for(const a of s.docChanges)switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}return new Kb(e,s.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yF{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bF{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return gP()?8:Kk(lr())>0?6:4}()}initialize(e,s){this.ps=e,this.indexManager=s,this.Rs=!0}getDocumentsMatchingQuery(e,s,r,i){const a={result:null};return this.ys(e,s).next(o=>{a.result=o}).next(()=>{if(!a.result)return this.ws(e,s,i,r).next(o=>{a.result=o})}).next(()=>{if(a.result)return;const o=new yF;return this.Ss(e,s,o).next(l=>{if(a.result=l,this.Vs)return this.bs(e,s,o,l.size)})}).next(()=>a.result)}bs(e,s,r,i){return r.documentReadCount<this.fs?(Nc()<=ps.DEBUG&&wt("QueryEngine","SDK will not create cache indexes for query:",jc(s),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),He.resolve()):(Nc()<=ps.DEBUG&&wt("QueryEngine","Query:",jc(s),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(Nc()<=ps.DEBUG&&wt("QueryEngine","The SDK decides to create cache indexes for query:",jc(s),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Xi(s))):He.resolve())}ys(e,s){if(EN(s))return He.resolve(null);let r=Xi(s);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(s.limit!==null&&i===1&&(s=Fp(s,null,"F"),r=Xi(s)),this.indexManager.getDocumentsMatchingTarget(e,r).next(a=>{const o=gs(...a);return this.ps.getDocuments(e,o).next(l=>this.indexManager.getMinOffset(e,r).next(c=>{const d=this.Ds(s,l);return this.Cs(s,d,o,c.readTime)?this.ys(e,Fp(s,null,"F")):this.vs(e,d,s,c)}))})))}ws(e,s,r,i){return EN(s)||i.isEqual(zt.min())?He.resolve(null):this.ps.getDocuments(e,r).next(a=>{const o=this.Ds(s,a);return this.Cs(s,o,r,i)?He.resolve(null):(Nc()<=ps.DEBUG&&wt("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),jc(s)),this.vs(e,o,s,Gk(i,oh)).next(l=>l))})}Ds(e,s){let r=new Rn(fI(e));return s.forEach((i,a)=>{If(e,a)&&(r=r.add(a))}),r}Cs(e,s,r,i){if(e.limit===null)return!1;if(r.size!==s.size)return!0;const a=e.limitType==="F"?s.last():s.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(i)>0)}Ss(e,s,r){return Nc()<=ps.DEBUG&&wt("QueryEngine","Using full collection scan to execute query:",jc(s)),this.ps.getDocumentsMatchingQuery(e,s,Io.min(),r)}vs(e,s,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next(a=>(s.forEach(o=>{a=a.insert(o.key,o)}),a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yb="LocalStore",wF=3e8;class vF{constructor(e,s,r,i){this.persistence=e,this.Fs=s,this.serializer=i,this.Ms=new on(fs),this.xs=new Xl(a=>zb(a),Vb),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new cF(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",s=>e.collect(s,this.Ms))}}function NF(n,e,s,r){return new vF(n,e,s,r)}async function BI(n,e){const s=qt(n);return await s.persistence.runTransaction("Handle user change","readonly",r=>{let i;return s.mutationQueue.getAllMutationBatches(r).next(a=>(i=a,s.Bs(e),s.mutationQueue.getAllMutationBatches(r))).next(a=>{const o=[],l=[];let c=gs();for(const d of i){o.push(d.batchId);for(const u of d.mutations)c=c.add(u.key)}for(const d of a){l.push(d.batchId);for(const u of d.mutations)c=c.add(u.key)}return s.localDocuments.getDocuments(r,c).next(d=>({Ls:d,removedBatchIds:o,addedBatchIds:l}))})})}function jF(n,e){const s=qt(n);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),a=s.Ns.newChangeBuffer({trackRemovals:!0});return function(l,c,d,u){const f=d.batch,p=f.keys();let j=He.resolve();return p.forEach(L=>{j=j.next(()=>u.getEntry(c,L)).next(R=>{const D=d.docVersions.get(L);Es(D!==null,48541),R.version.compareTo(D)<0&&(f.applyToRemoteDocument(R,d),R.isValidDocument()&&(R.setReadTime(d.commitVersion),u.addEntry(R)))})}),j.next(()=>l.mutationQueue.removeMutationBatch(c,f))}(s,r,e,a).next(()=>a.apply(r)).next(()=>s.mutationQueue.performConsistencyCheck(r)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let c=gs();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(c=c.add(l.batch.mutations[d].key));return c}(e))).next(()=>s.localDocuments.getDocuments(r,i))})}function GI(n){const e=qt(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",s=>e.Pi.getLastRemoteSnapshotVersion(s))}function SF(n,e){const s=qt(n),r=e.snapshotVersion;let i=s.Ms;return s.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{const o=s.Ns.newChangeBuffer({trackRemovals:!0});i=s.Ms;const l=[];e.targetChanges.forEach((u,f)=>{const p=i.get(f);if(!p)return;l.push(s.Pi.removeMatchingKeys(a,u.removedDocuments,f).next(()=>s.Pi.addMatchingKeys(a,u.addedDocuments,f)));let j=p.withSequenceNumber(a.currentSequenceNumber);e.targetMismatches.get(f)!==null?j=j.withResumeToken(Gn.EMPTY_BYTE_STRING,zt.min()).withLastLimboFreeSnapshotVersion(zt.min()):u.resumeToken.approximateByteSize()>0&&(j=j.withResumeToken(u.resumeToken,r)),i=i.insert(f,j),function(R,D,y){return R.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-R.snapshotVersion.toMicroseconds()>=wF?!0:y.addedDocuments.size+y.modifiedDocuments.size+y.removedDocuments.size>0}(p,j,u)&&l.push(s.Pi.updateTargetData(a,j))});let c=Ra(),d=gs();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&l.push(s.persistence.referenceDelegate.updateLimboDocument(a,u))}),l.push(EF(a,o,e.documentUpdates).next(u=>{c=u.ks,d=u.qs})),!r.isEqual(zt.min())){const u=s.Pi.getLastRemoteSnapshotVersion(a).next(f=>s.Pi.setTargetsMetadata(a,a.currentSequenceNumber,r));l.push(u)}return He.waitFor(l).next(()=>o.apply(a)).next(()=>s.localDocuments.getLocalViewOfDocuments(a,c,d)).next(()=>c)}).then(a=>(s.Ms=i,a))}function EF(n,e,s){let r=gs(),i=gs();return s.forEach(a=>r=r.add(a)),e.getEntries(n,r).next(a=>{let o=Ra();return s.forEach((l,c)=>{const d=a.get(l);c.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(l)),c.isNoDocument()&&c.version.isEqual(zt.min())?(e.removeEntry(l,c.readTime),o=o.insert(l,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c),o=o.insert(l,c)):wt(Yb,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",c.version)}),{ks:o,qs:i}})}function CF(n,e){const s=qt(n);return s.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Mb),s.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function IF(n,e){const s=qt(n);return s.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return s.Pi.getTargetData(r,e).next(a=>a?(i=a,He.resolve(i)):s.Pi.allocateTargetId(r).next(o=>(i=new oo(e,o,"TargetPurposeListen",r.currentSequenceNumber),s.Pi.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=s.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(s.Ms=s.Ms.insert(r.targetId,r),s.xs.set(e,r.targetId)),r})}async function vy(n,e,s){const r=qt(n),i=r.Ms.get(e),a=s?"readwrite":"readwrite-primary";try{s||await r.persistence.runTransaction("Release target",a,o=>r.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!wd(o))throw o;wt(Yb,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function MN(n,e,s){const r=qt(n);let i=zt.min(),a=gs();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,d,u){const f=qt(c),p=f.xs.get(u);return p!==void 0?He.resolve(f.Ms.get(p)):f.Pi.getTargetData(d,u)}(r,o,Xi(e)).next(l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,l.targetId).next(c=>{a=c})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,s?i:zt.min(),s?a:gs())).next(l=>(TF(r,gL(e),l),{documents:l,Qs:a})))}function TF(n,e,s){let r=n.Os.get(e)||zt.min();s.forEach((i,a)=>{a.readTime.compareTo(r)>0&&(r=a.readTime)}),n.Os.set(e,r)}class UN{constructor(){this.activeTargetIds=NL()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class AF{constructor(){this.Mo=new UN,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,s,r){}addLocalQueryTarget(e,s=!0){return s&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,s,r){this.xo[e]=s}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new UN,Promise.resolve()}handleUserChange(e,s,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _F{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $N="ConnectivityMonitor";class zN{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){wt($N,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){wt($N,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let km=null;function Ny(){return km===null?km=function(){return 268435456+Math.round(2147483648*Math.random())}():km++,"0x"+km.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hg="RestConnection",RF={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class DF{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const s=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=s+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===Pp?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,s,r,i,a){const o=Ny(),l=this.zo(e,s.toUriEncodedString());wt(Hg,`Sending RPC '${e}' ${o}:`,l,r);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,i,a);const{host:d}=new URL(l),u=Mo(d);return this.Jo(e,l,c,r,u).then(f=>(wt(Hg,`Received RPC '${e}' ${o}: `,f),f),f=>{throw zl(Hg,`RPC '${e}' ${o} failed with error: `,f,"url: ",l,"request:",r),f})}Ho(e,s,r,i,a,o){return this.Go(e,s,r,i,a)}jo(e,s,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+yd}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((i,a)=>e[a]=i),r&&r.headers.forEach((i,a)=>e[a]=i)}zo(e,s){const r=RF[e];return`${this.Uo}/v1/${s}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PF{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tr="WebChannelConnection";class kF extends DF{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,s,r,i,a){const o=Ny();return new Promise((l,c)=>{const d=new $C;d.setWithCredentials(!0),d.listenOnce(zC.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Jm.NO_ERROR:const f=d.getResponseJson();wt(tr,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),l(f);break;case Jm.TIMEOUT:wt(tr,`RPC '${e}' ${o} timed out`),c(new ht(Be.DEADLINE_EXCEEDED,"Request time out"));break;case Jm.HTTP_ERROR:const p=d.getStatus();if(wt(tr,`RPC '${e}' ${o} failed with status:`,p,"response text:",d.getResponseText()),p>0){let j=d.getResponseJson();Array.isArray(j)&&(j=j[0]);const L=j==null?void 0:j.error;if(L&&L.status&&L.message){const R=function(y){const T=y.toLowerCase().replace(/_/g,"-");return Object.values(Be).indexOf(T)>=0?T:Be.UNKNOWN}(L.status);c(new ht(R,L.message))}else c(new ht(Be.UNKNOWN,"Server responded with status "+d.getStatus()))}else c(new ht(Be.UNAVAILABLE,"Connection failed."));break;default:Ot(9055,{l_:e,streamId:o,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{wt(tr,`RPC '${e}' ${o} completed.`)}});const u=JSON.stringify(i);wt(tr,`RPC '${e}' ${o} sending request:`,i),d.send(s,"POST",u,r,15)})}T_(e,s,r){const i=Ny(),a=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=GC(),l=BC(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,s,r),c.encodeInitMessageHeaders=!0;const u=a.join("");wt(tr,`Creating RPC '${e}' stream ${i}: ${u}`,c);const f=o.createWebChannel(u,c);this.I_(f);let p=!1,j=!1;const L=new PF({Yo:D=>{j?wt(tr,`Not sending because RPC '${e}' stream ${i} is closed:`,D):(p||(wt(tr,`Opening RPC '${e}' stream ${i} transport.`),f.open(),p=!0),wt(tr,`RPC '${e}' stream ${i} sending:`,D),f.send(D))},Zo:()=>f.close()}),R=(D,y,T)=>{D.listen(y,x=>{try{T(x)}catch(S){setTimeout(()=>{throw S},0)}})};return R(f,gu.EventType.OPEN,()=>{j||(wt(tr,`RPC '${e}' stream ${i} transport opened.`),L.o_())}),R(f,gu.EventType.CLOSE,()=>{j||(j=!0,wt(tr,`RPC '${e}' stream ${i} transport closed`),L.a_(),this.E_(f))}),R(f,gu.EventType.ERROR,D=>{j||(j=!0,zl(tr,`RPC '${e}' stream ${i} transport errored. Name:`,D.name,"Message:",D.message),L.a_(new ht(Be.UNAVAILABLE,"The operation could not be completed")))}),R(f,gu.EventType.MESSAGE,D=>{var y;if(!j){const T=D.data[0];Es(!!T,16349);const x=T,S=(x==null?void 0:x.error)||((y=x[0])==null?void 0:y.error);if(S){wt(tr,`RPC '${e}' stream ${i} received error:`,S);const A=S.status;let Q=function($){const H=bn[$];if(H!==void 0)return _I(H)}(A),q=S.message;Q===void 0&&(Q=Be.INTERNAL,q="Unknown error status: "+A+" with message "+S.message),j=!0,L.a_(new ht(Q,q)),f.close()}else wt(tr,`RPC '${e}' stream ${i} received:`,T),L.u_(T)}}),R(l,VC.STAT_EVENT,D=>{D.stat===uy.PROXY?wt(tr,`RPC '${e}' stream ${i} detected buffering proxy`):D.stat===uy.NOPROXY&&wt(tr,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{L.__()},0),L}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(s=>s===e)}}function Qg(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rf(n){return new ML(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jb{constructor(e,s,r=1e3,i=1.5,a=6e4){this.Mi=e,this.timerId=s,this.d_=r,this.A_=i,this.R_=a,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const s=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,s-r);i>0&&wt("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${s} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VN="PersistentStream";class WI{constructor(e,s,r,i,a,o,l,c){this.Mi=e,this.S_=r,this.b_=i,this.connection=a,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Jb(e,s)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,s){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():s&&s.code===Be.RESOURCE_EXHAUSTED?(_a(s.toString()),_a("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):s&&s.code===Be.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(s)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),s=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.D_===s&&this.G_(r,i)},r=>{e(()=>{const i=new ht(Be.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)})})}G_(e,s){const r=this.W_(this.D_);this.stream=this.j_(e,s),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(i=>{r(()=>this.z_(i))}),this.stream.onMessage(i=>{r(()=>++this.F_==1?this.J_(i):this.onNext(i))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return wt(VN,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return s=>{this.Mi.enqueueAndForget(()=>this.D_===e?s():(wt(VN,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class LF extends WI{constructor(e,s,r,i,a,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",s,r,i,o),this.serializer=a}j_(e,s){return this.connection.T_("Listen",e,s)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const s=VL(this.serializer,e),r=function(a){if(!("targetChange"in a))return zt.min();const o=a.targetChange;return o.targetIds&&o.targetIds.length?zt.min():o.readTime?Hr(o.readTime):zt.min()}(e);return this.listener.H_(s,r)}Y_(e){const s={};s.database=wy(this.serializer),s.addTarget=function(a,o){let l;const c=o.target;if(l=gy(c)?{documents:GL(a,c)}:{query:WL(a,c).ft},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=PI(a,o.resumeToken);const d=yy(a,o.expectedCount);d!==null&&(l.expectedCount=d)}else if(o.snapshotVersion.compareTo(zt.min())>0){l.readTime=Op(a,o.snapshotVersion.toTimestamp());const d=yy(a,o.expectedCount);d!==null&&(l.expectedCount=d)}return l}(this.serializer,e);const r=HL(this.serializer,e);r&&(s.labels=r),this.q_(s)}Z_(e){const s={};s.database=wy(this.serializer),s.removeTarget=e,this.q_(s)}}class FF extends WI{constructor(e,s,r,i,a,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",s,r,i,o),this.serializer=a}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,s){return this.connection.T_("Write",e,s)}J_(e){return Es(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Es(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Es(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const s=BL(e.writeResults,e.commitTime),r=Hr(e.commitTime);return this.listener.na(r,s)}ra(){const e={};e.database=wy(this.serializer),this.q_(e)}ea(e){const s={streamToken:this.lastStreamToken,writes:e.map(r=>OI(this.serializer,r))};this.q_(s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OF{}class MF extends OF{constructor(e,s,r,i){super(),this.authCredentials=e,this.appCheckCredentials=s,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new ht(Be.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,s,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.Go(e,by(s,r),i,a,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===Be.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new ht(Be.UNKNOWN,a.toString())})}Ho(e,s,r,i,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Ho(e,by(s,r),i,o,l,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Be.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new ht(Be.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class UF{constructor(e,s){this.asyncQueue=e,this.onlineStateHandler=s,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const s=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(_a(s),this.aa=!1):wt("OnlineStateTracker",s)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vl="RemoteStore";class $F{constructor(e,s,r,i,a){this.localStore=e,this.datastore=s,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=a,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{Zl(this)&&(wt(Vl,"Restarting streams for network reachability change."),await async function(c){const d=qt(c);d.Ea.add(4),await Ph(d),d.Ra.set("Unknown"),d.Ea.delete(4),await Df(d)}(this))})}),this.Ra=new UF(r,i)}}async function Df(n){if(Zl(n))for(const e of n.da)await e(!0)}async function Ph(n){for(const e of n.da)await e(!1)}function qI(n,e){const s=qt(n);s.Ia.has(e.targetId)||(s.Ia.set(e.targetId,e),t0(s)?e0(s):Nd(s).O_()&&Zb(s,e))}function Xb(n,e){const s=qt(n),r=Nd(s);s.Ia.delete(e),r.O_()&&HI(s,e),s.Ia.size===0&&(r.O_()?r.L_():Zl(s)&&s.Ra.set("Unknown"))}function Zb(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(zt.min())>0){const s=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(s)}Nd(n).Y_(e)}function HI(n,e){n.Va.Ue(e),Nd(n).Z_(e)}function e0(n){n.Va=new kL({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Nd(n).start(),n.Ra.ua()}function t0(n){return Zl(n)&&!Nd(n).x_()&&n.Ia.size>0}function Zl(n){return qt(n).Ea.size===0}function QI(n){n.Va=void 0}async function zF(n){n.Ra.set("Online")}async function VF(n){n.Ia.forEach((e,s)=>{Zb(n,e)})}async function BF(n,e){QI(n),t0(n)?(n.Ra.ha(e),e0(n)):n.Ra.set("Unknown")}async function GF(n,e,s){if(n.Ra.set("Online"),e instanceof DI&&e.state===2&&e.cause)try{await async function(i,a){const o=a.cause;for(const l of a.targetIds)i.Ia.has(l)&&(await i.remoteSyncer.rejectListen(l,o),i.Ia.delete(l),i.Va.removeTarget(l))}(n,e)}catch(r){wt(Vl,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await $p(n,r)}else if(e instanceof tp?n.Va.Ze(e):e instanceof RI?n.Va.st(e):n.Va.tt(e),!s.isEqual(zt.min()))try{const r=await GI(n.localStore);s.compareTo(r)>=0&&await function(a,o){const l=a.Va.Tt(o);return l.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){const u=a.Ia.get(d);u&&a.Ia.set(d,u.withResumeToken(c.resumeToken,o))}}),l.targetMismatches.forEach((c,d)=>{const u=a.Ia.get(c);if(!u)return;a.Ia.set(c,u.withResumeToken(Gn.EMPTY_BYTE_STRING,u.snapshotVersion)),HI(a,c);const f=new oo(u.target,c,d,u.sequenceNumber);Zb(a,f)}),a.remoteSyncer.applyRemoteEvent(l)}(n,s)}catch(r){wt(Vl,"Failed to raise snapshot:",r),await $p(n,r)}}async function $p(n,e,s){if(!wd(e))throw e;n.Ea.add(1),await Ph(n),n.Ra.set("Offline"),s||(s=()=>GI(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{wt(Vl,"Retrying IndexedDB access"),await s(),n.Ea.delete(1),await Df(n)})}function KI(n,e){return e().catch(s=>$p(n,s,e))}async function Pf(n){const e=qt(n),s=Ro(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Mb;for(;WF(e);)try{const i=await CF(e.localStore,r);if(i===null){e.Ta.length===0&&s.L_();break}r=i.batchId,qF(e,i)}catch(i){await $p(e,i)}YI(e)&&JI(e)}function WF(n){return Zl(n)&&n.Ta.length<10}function qF(n,e){n.Ta.push(e);const s=Ro(n);s.O_()&&s.X_&&s.ea(e.mutations)}function YI(n){return Zl(n)&&!Ro(n).x_()&&n.Ta.length>0}function JI(n){Ro(n).start()}async function HF(n){Ro(n).ra()}async function QF(n){const e=Ro(n);for(const s of n.Ta)e.ea(s.mutations)}async function KF(n,e,s){const r=n.Ta.shift(),i=Gb.from(r,e,s);await KI(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),await Pf(n)}async function YF(n,e){e&&Ro(n).X_&&await async function(r,i){if(function(o){return AI(o)&&o!==Be.ABORTED}(i.code)){const a=r.Ta.shift();Ro(r).B_(),await KI(r,()=>r.remoteSyncer.rejectFailedWrite(a.batchId,i)),await Pf(r)}}(n,e),YI(n)&&JI(n)}async function BN(n,e){const s=qt(n);s.asyncQueue.verifyOperationInProgress(),wt(Vl,"RemoteStore received new credentials");const r=Zl(s);s.Ea.add(3),await Ph(s),r&&s.Ra.set("Unknown"),await s.remoteSyncer.handleCredentialChange(e),s.Ea.delete(3),await Df(s)}async function JF(n,e){const s=qt(n);e?(s.Ea.delete(2),await Df(s)):e||(s.Ea.add(2),await Ph(s),s.Ra.set("Unknown"))}function Nd(n){return n.ma||(n.ma=function(s,r,i){const a=qt(s);return a.sa(),new LF(r,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,i)}(n.datastore,n.asyncQueue,{Xo:zF.bind(null,n),t_:VF.bind(null,n),r_:BF.bind(null,n),H_:GF.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),t0(n)?e0(n):n.Ra.set("Unknown")):(await n.ma.stop(),QI(n))})),n.ma}function Ro(n){return n.fa||(n.fa=function(s,r,i){const a=qt(s);return a.sa(),new FF(r,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,i)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:HF.bind(null,n),r_:YF.bind(null,n),ta:QF.bind(null,n),na:KF.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await Pf(n)):(await n.fa.stop(),n.Ta.length>0&&(wt(Vl,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s0{constructor(e,s,r,i,a){this.asyncQueue=e,this.timerId=s,this.targetTimeMs=r,this.op=i,this.removalCallback=a,this.deferred=new Ji,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,s,r,i,a){const o=Date.now()+r,l=new s0(e,s,o,i,a);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ht(Be.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function n0(n,e){if(_a("AsyncQueue",`${e}: ${n}`),wd(n))return new ht(Be.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qc{static emptySet(e){return new qc(e.comparator)}constructor(e){this.comparator=e?(s,r)=>e(s,r)||Pt.comparator(s.key,r.key):(s,r)=>Pt.comparator(s.key,r.key),this.keyedMap=xu(),this.sortedSet=new on(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const s=this.keyedMap.get(e);return s?this.sortedSet.indexOf(s):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((s,r)=>(e(s),!1))}add(e){const s=this.delete(e.key);return s.copy(s.keyedMap.insert(e.key,e),s.sortedSet.insert(e,null))}delete(e){const s=this.get(e);return s?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(s)):this}isEqual(e){if(!(e instanceof qc)||this.size!==e.size)return!1;const s=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;s.hasNext();){const i=s.getNext().key,a=r.getNext().key;if(!i.isEqual(a))return!1}return!0}toString(){const e=[];return this.forEach(s=>{e.push(s.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,s){const r=new qc;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=s,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GN{constructor(){this.ga=new on(Pt.comparator)}track(e){const s=e.doc.key,r=this.ga.get(s);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(s,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(s,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(s,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(s,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(s):e.type===1&&r.type===2?this.ga=this.ga.insert(s,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(s,{type:2,doc:e.doc}):Ot(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(s,e)}ya(){const e=[];return this.ga.inorderTraversal((s,r)=>{e.push(r)}),e}}class ld{constructor(e,s,r,i,a,o,l,c,d){this.query=e,this.docs=s,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=a,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(e,s,r,i,a){const o=[];return s.forEach(l=>{o.push({type:0,doc:l})}),new ld(e,s,qc.emptySet(s),o,r,i,!0,!1,a)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Cf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const s=this.docChanges,r=e.docChanges;if(s.length!==r.length)return!1;for(let i=0;i<s.length;i++)if(s[i].type!==r[i].type||!s[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XF{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class ZF{constructor(){this.queries=WN(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(s,r){const i=qt(s),a=i.queries;i.queries=WN(),a.forEach((o,l)=>{for(const c of l.Sa)c.onError(r)})})(this,new ht(Be.ABORTED,"Firestore shutting down"))}}function WN(){return new Xl(n=>pI(n),Cf)}async function r0(n,e){const s=qt(n);let r=3;const i=e.query;let a=s.queries.get(i);a?!a.ba()&&e.Da()&&(r=2):(a=new XF,r=e.Da()?0:1);try{switch(r){case 0:a.wa=await s.onListen(i,!0);break;case 1:a.wa=await s.onListen(i,!1);break;case 2:await s.onFirstRemoteStoreListen(i)}}catch(o){const l=n0(o,`Initialization of query '${jc(e.query)}' failed`);return void e.onError(l)}s.queries.set(i,a),a.Sa.push(e),e.va(s.onlineState),a.wa&&e.Fa(a.wa)&&a0(s)}async function i0(n,e){const s=qt(n),r=e.query;let i=3;const a=s.queries.get(r);if(a){const o=a.Sa.indexOf(e);o>=0&&(a.Sa.splice(o,1),a.Sa.length===0?i=e.Da()?0:1:!a.ba()&&e.Da()&&(i=2))}switch(i){case 0:return s.queries.delete(r),s.onUnlisten(r,!0);case 1:return s.queries.delete(r),s.onUnlisten(r,!1);case 2:return s.onLastRemoteStoreUnlisten(r);default:return}}function eO(n,e){const s=qt(n);let r=!1;for(const i of e){const a=i.query,o=s.queries.get(a);if(o){for(const l of o.Sa)l.Fa(i)&&(r=!0);o.wa=i}}r&&a0(s)}function tO(n,e,s){const r=qt(n),i=r.queries.get(e);if(i)for(const a of i.Sa)a.onError(s);r.queries.delete(e)}function a0(n){n.Ca.forEach(e=>{e.next()})}var jy,qN;(qN=jy||(jy={})).Ma="default",qN.Cache="cache";class o0{constructor(e,s,r){this.query=e,this.xa=s,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new ld(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let s=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),s=!0):this.La(e,this.onlineState)&&(this.ka(e),s=!0),this.Na=e,s}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let s=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),s=!0),s}La(e,s){if(!e.fromCache||!this.Da())return!0;const r=s!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||s==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const s=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!s)&&this.options.includeMetadataChanges===!0}ka(e){e=ld.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==jy.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XI{constructor(e){this.key=e}}class ZI{constructor(e){this.key=e}}class sO{constructor(e,s){this.query=e,this.Ya=s,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=gs(),this.mutatedKeys=gs(),this.eu=fI(e),this.tu=new qc(this.eu)}get nu(){return this.Ya}ru(e,s){const r=s?s.iu:new GN,i=s?s.tu:this.tu;let a=s?s.mutatedKeys:this.mutatedKeys,o=i,l=!1;const c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,f)=>{const p=i.get(u),j=If(this.query,f)?f:null,L=!!p&&this.mutatedKeys.has(p.key),R=!!j&&(j.hasLocalMutations||this.mutatedKeys.has(j.key)&&j.hasCommittedMutations);let D=!1;p&&j?p.data.isEqual(j.data)?L!==R&&(r.track({type:3,doc:j}),D=!0):this.su(p,j)||(r.track({type:2,doc:j}),D=!0,(c&&this.eu(j,c)>0||d&&this.eu(j,d)<0)&&(l=!0)):!p&&j?(r.track({type:0,doc:j}),D=!0):p&&!j&&(r.track({type:1,doc:p}),D=!0,(c||d)&&(l=!0)),D&&(j?(o=o.add(j),a=R?a.add(u):a.delete(u)):(o=o.delete(u),a=a.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),a=a.delete(u.key),r.track({type:1,doc:u})}return{tu:o,iu:r,Cs:l,mutatedKeys:a}}su(e,s){return e.hasLocalMutations&&s.hasCommittedMutations&&!s.hasLocalMutations}applyChanges(e,s,r,i){const a=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((u,f)=>function(j,L){const R=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ot(20277,{Rt:D})}};return R(j)-R(L)}(u.type,f.type)||this.eu(u.doc,f.doc)),this.ou(r),i=i??!1;const l=s&&!i?this._u():[],c=this.Xa.size===0&&this.current&&!i?1:0,d=c!==this.Za;return this.Za=c,o.length!==0||d?{snapshot:new ld(this.query,e.tu,a,o,e.mutatedKeys,c===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new GN,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(s=>this.Ya=this.Ya.add(s)),e.modifiedDocuments.forEach(s=>{}),e.removedDocuments.forEach(s=>this.Ya=this.Ya.delete(s)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=gs(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const s=[];return e.forEach(r=>{this.Xa.has(r)||s.push(new ZI(r))}),this.Xa.forEach(r=>{e.has(r)||s.push(new XI(r))}),s}cu(e){this.Ya=e.Qs,this.Xa=gs();const s=this.ru(e.documents);return this.applyChanges(s,!0)}lu(){return ld.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const l0="SyncEngine";class nO{constructor(e,s,r){this.query=e,this.targetId=s,this.view=r}}class rO{constructor(e){this.key=e,this.hu=!1}}class iO{constructor(e,s,r,i,a,o){this.localStore=e,this.remoteStore=s,this.eventManager=r,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Xl(l=>pI(l),Cf),this.Iu=new Map,this.Eu=new Set,this.du=new on(Pt.comparator),this.Au=new Map,this.Ru=new Hb,this.Vu={},this.mu=new Map,this.fu=od.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function aO(n,e,s=!0){const r=iT(n);let i;const a=r.Tu.get(e);return a?(r.sharedClientState.addLocalQueryTarget(a.targetId),i=a.view.lu()):i=await eT(r,e,s,!0),i}async function oO(n,e){const s=iT(n);await eT(s,e,!0,!1)}async function eT(n,e,s,r){const i=await IF(n.localStore,Xi(e)),a=i.targetId,o=n.sharedClientState.addLocalQueryTarget(a,s);let l;return r&&(l=await lO(n,e,a,o==="current",i.resumeToken)),n.isPrimaryClient&&s&&qI(n.remoteStore,i),l}async function lO(n,e,s,r,i){n.pu=(f,p,j)=>async function(R,D,y,T){let x=D.view.ru(y);x.Cs&&(x=await MN(R.localStore,D.query,!1).then(({documents:q})=>D.view.ru(q,x)));const S=T&&T.targetChanges.get(D.targetId),A=T&&T.targetMismatches.get(D.targetId)!=null,Q=D.view.applyChanges(x,R.isPrimaryClient,S,A);return QN(R,D.targetId,Q.au),Q.snapshot}(n,f,p,j);const a=await MN(n.localStore,e,!0),o=new sO(e,a.Qs),l=o.ru(a.documents),c=Dh.createSynthesizedTargetChangeForCurrentChange(s,r&&n.onlineState!=="Offline",i),d=o.applyChanges(l,n.isPrimaryClient,c);QN(n,s,d.au);const u=new nO(e,s,o);return n.Tu.set(e,u),n.Iu.has(s)?n.Iu.get(s).push(e):n.Iu.set(s,[e]),d.snapshot}async function cO(n,e,s){const r=qt(n),i=r.Tu.get(e),a=r.Iu.get(i.targetId);if(a.length>1)return r.Iu.set(i.targetId,a.filter(o=>!Cf(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await vy(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),s&&Xb(r.remoteStore,i.targetId),Sy(r,i.targetId)}).catch(bd)):(Sy(r,i.targetId),await vy(r.localStore,i.targetId,!0))}async function dO(n,e){const s=qt(n),r=s.Tu.get(e),i=s.Iu.get(r.targetId);s.isPrimaryClient&&i.length===1&&(s.sharedClientState.removeLocalQueryTarget(r.targetId),Xb(s.remoteStore,r.targetId))}async function uO(n,e,s){const r=yO(n);try{const i=await function(o,l){const c=qt(o),d=hs.now(),u=l.reduce((j,L)=>j.add(L.key),gs());let f,p;return c.persistence.runTransaction("Locally write mutations","readwrite",j=>{let L=Ra(),R=gs();return c.Ns.getEntries(j,u).next(D=>{L=D,L.forEach((y,T)=>{T.isValidDocument()||(R=R.add(y))})}).next(()=>c.localDocuments.getOverlayedDocuments(j,L)).next(D=>{f=D;const y=[];for(const T of l){const x=TL(T,f.get(T.key).overlayedDocument);x!=null&&y.push(new $o(T.key,x,aI(x.value.mapValue),Nn.exists(!0)))}return c.mutationQueue.addMutationBatch(j,d,y,l)}).next(D=>{p=D;const y=D.applyToLocalDocumentSet(f,R);return c.documentOverlayCache.saveOverlays(j,D.batchId,y)})}).then(()=>({batchId:p.batchId,changes:xI(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,l,c){let d=o.Vu[o.currentUser.toKey()];d||(d=new on(fs)),d=d.insert(l,c),o.Vu[o.currentUser.toKey()]=d}(r,i.batchId,s),await kh(r,i.changes),await Pf(r.remoteStore)}catch(i){const a=n0(i,"Failed to persist write");s.reject(a)}}async function tT(n,e){const s=qt(n);try{const r=await SF(s.localStore,e);e.targetChanges.forEach((i,a)=>{const o=s.Au.get(a);o&&(Es(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.hu=!0:i.modifiedDocuments.size>0?Es(o.hu,14607):i.removedDocuments.size>0&&(Es(o.hu,42227),o.hu=!1))}),await kh(s,r,e)}catch(r){await bd(r)}}function HN(n,e,s){const r=qt(n);if(r.isPrimaryClient&&s===0||!r.isPrimaryClient&&s===1){const i=[];r.Tu.forEach((a,o)=>{const l=o.view.va(e);l.snapshot&&i.push(l.snapshot)}),function(o,l){const c=qt(o);c.onlineState=l;let d=!1;c.queries.forEach((u,f)=>{for(const p of f.Sa)p.va(l)&&(d=!0)}),d&&a0(c)}(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function hO(n,e,s){const r=qt(n);r.sharedClientState.updateQueryState(e,"rejected",s);const i=r.Au.get(e),a=i&&i.key;if(a){let o=new on(Pt.comparator);o=o.insert(a,$n.newNoDocument(a,zt.min()));const l=gs().add(a),c=new _f(zt.min(),new Map,new on(fs),o,l);await tT(r,c),r.du=r.du.remove(a),r.Au.delete(e),c0(r)}else await vy(r.localStore,e,!1).then(()=>Sy(r,e,s)).catch(bd)}async function mO(n,e){const s=qt(n),r=e.batch.batchId;try{const i=await jF(s.localStore,e);nT(s,r,null),sT(s,r),s.sharedClientState.updateMutationState(r,"acknowledged"),await kh(s,i)}catch(i){await bd(i)}}async function pO(n,e,s){const r=qt(n);try{const i=await function(o,l){const c=qt(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let u;return c.mutationQueue.lookupMutationBatch(d,l).next(f=>(Es(f!==null,37113),u=f.keys(),c.mutationQueue.removeMutationBatch(d,f))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,u,l)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,u)).next(()=>c.localDocuments.getDocuments(d,u))})}(r.localStore,e);nT(r,e,s),sT(r,e),r.sharedClientState.updateMutationState(e,"rejected",s),await kh(r,i)}catch(i){await bd(i)}}function sT(n,e){(n.mu.get(e)||[]).forEach(s=>{s.resolve()}),n.mu.delete(e)}function nT(n,e,s){const r=qt(n);let i=r.Vu[r.currentUser.toKey()];if(i){const a=i.get(e);a&&(s?a.reject(s):a.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function Sy(n,e,s=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),s&&n.Pu.yu(r,s);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||rT(n,r)})}function rT(n,e){n.Eu.delete(e.path.canonicalString());const s=n.du.get(e);s!==null&&(Xb(n.remoteStore,s),n.du=n.du.remove(e),n.Au.delete(s),c0(n))}function QN(n,e,s){for(const r of s)r instanceof XI?(n.Ru.addReference(r.key,e),fO(n,r)):r instanceof ZI?(wt(l0,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||rT(n,r.key)):Ot(19791,{wu:r})}function fO(n,e){const s=e.key,r=s.path.canonicalString();n.du.get(s)||n.Eu.has(r)||(wt(l0,"New document in limbo: "+s),n.Eu.add(r),c0(n))}function c0(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const s=new Pt($s.fromString(e)),r=n.fu.next();n.Au.set(r,new rO(s)),n.du=n.du.insert(s,r),qI(n.remoteStore,new oo(Xi(Ef(s.path)),r,"TargetPurposeLimboResolution",jf.ce))}}async function kh(n,e,s){const r=qt(n),i=[],a=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((l,c)=>{o.push(r.pu(c,e,s).then(d=>{var u;if((d||s)&&r.isPrimaryClient){const f=d?!d.fromCache:(u=s==null?void 0:s.targetChanges.get(c.targetId))==null?void 0:u.current;r.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(d){i.push(d);const f=Kb.As(c.targetId,d);a.push(f)}}))}),await Promise.all(o),r.Pu.H_(i),await async function(c,d){const u=qt(c);try{await u.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>He.forEach(d,p=>He.forEach(p.Es,j=>u.persistence.referenceDelegate.addReference(f,p.targetId,j)).next(()=>He.forEach(p.ds,j=>u.persistence.referenceDelegate.removeReference(f,p.targetId,j)))))}catch(f){if(!wd(f))throw f;wt(Yb,"Failed to update sequence numbers: "+f)}for(const f of d){const p=f.targetId;if(!f.fromCache){const j=u.Ms.get(p),L=j.snapshotVersion,R=j.withLastLimboFreeSnapshotVersion(L);u.Ms=u.Ms.insert(p,R)}}}(r.localStore,a))}async function gO(n,e){const s=qt(n);if(!s.currentUser.isEqual(e)){wt(l0,"User change. New user:",e.toKey());const r=await BI(s.localStore,e);s.currentUser=e,function(a,o){a.mu.forEach(l=>{l.forEach(c=>{c.reject(new ht(Be.CANCELLED,o))})}),a.mu.clear()}(s,"'waitForPendingWrites' promise is rejected due to a user change."),s.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await kh(s,r.Ls)}}function xO(n,e){const s=qt(n),r=s.Au.get(e);if(r&&r.hu)return gs().add(r.key);{let i=gs();const a=s.Iu.get(e);if(!a)return i;for(const o of a){const l=s.Tu.get(o);i=i.unionWith(l.view.nu)}return i}}function iT(n){const e=qt(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=tT.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=xO.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=hO.bind(null,e),e.Pu.H_=eO.bind(null,e.eventManager),e.Pu.yu=tO.bind(null,e.eventManager),e}function yO(n){const e=qt(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=mO.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=pO.bind(null,e),e}class zp{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Rf(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,s){return null}Mu(e,s){return null}vu(e){return NF(this.persistence,new bF,e.initialUser,this.serializer)}Cu(e){return new VI(Qb.mi,this.serializer)}Du(e){return new AF}async terminate(){var e,s;(e=this.gcScheduler)==null||e.stop(),(s=this.indexBackfillerScheduler)==null||s.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}zp.provider={build:()=>new zp};class bO extends zp{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,s){Es(this.persistence.referenceDelegate instanceof Up,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new rF(r,e.asyncQueue,s)}Cu(e){const s=this.cacheSizeBytes!==void 0?Cr.withCacheSize(this.cacheSizeBytes):Cr.DEFAULT;return new VI(r=>Up.mi(r,s),this.serializer)}}class Ey{async initialize(e,s){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(s),this.remoteStore=this.createRemoteStore(s),this.eventManager=this.createEventManager(s),this.syncEngine=this.createSyncEngine(s,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>HN(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=gO.bind(null,this.syncEngine),await JF(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new ZF}()}createDatastore(e){const s=Rf(e.databaseInfo.databaseId),r=function(a){return new kF(a)}(e.databaseInfo);return function(a,o,l,c){return new MF(a,o,l,c)}(e.authCredentials,e.appCheckCredentials,r,s)}createRemoteStore(e){return function(r,i,a,o,l){return new $F(r,i,a,o,l)}(this.localStore,this.datastore,e.asyncQueue,s=>HN(this.syncEngine,s,0),function(){return zN.v()?new zN:new _F}())}createSyncEngine(e,s){return function(i,a,o,l,c,d,u){const f=new iO(i,a,o,l,c,d);return u&&(f.gu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,s)}async terminate(){var e,s;await async function(i){const a=qt(i);wt(Vl,"RemoteStore shutting down."),a.Ea.add(5),await Ph(a),a.Aa.shutdown(),a.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(s=this.eventManager)==null||s.terminate()}}Ey.provider={build:()=>new Ey};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d0{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):_a("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,s){setTimeout(()=>{this.muted||e(s)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wO{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new ht(Be.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const s=await async function(i,a){const o=qt(i),l={documents:a.map(f=>Mp(o.serializer,f))},c=await o.Ho("BatchGetDocuments",o.serializer.databaseId,$s.emptyPath(),l,a.length),d=new Map;c.forEach(f=>{const p=zL(o.serializer,f);d.set(p.key.toString(),p)});const u=[];return a.forEach(f=>{const p=d.get(f.toString());Es(!!p,55234,{key:f}),u.push(p)}),u}(this.datastore,e);return s.forEach(r=>this.recordVersion(r)),s}set(e,s){this.write(s.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,s){try{this.write(s.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Rh(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(s=>{e.delete(s.key.toString())}),e.forEach((s,r)=>{const i=Pt.fromPath(r);this.mutations.push(new TI(i,this.precondition(i)))}),await async function(r,i){const a=qt(r),o={writes:i.map(l=>OI(a.serializer,l))};await a.Go("Commit",a.serializer.databaseId,$s.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let s;if(e.isFoundDocument())s=e.version;else{if(!e.isNoDocument())throw Ot(50498,{Gu:e.constructor.name});s=zt.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!s.isEqual(r))throw new ht(Be.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),s)}precondition(e){const s=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&s?s.isEqual(zt.min())?Nn.exists(!1):Nn.updateTime(s):Nn.none()}preconditionForUpdate(e){const s=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&s){if(s.isEqual(zt.min()))throw new ht(Be.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Nn.updateTime(s)}return Nn.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vO{constructor(e,s,r,i,a){this.asyncQueue=e,this.datastore=s,this.options=r,this.updateFunction=i,this.deferred=a,this.zu=r.maxAttempts,this.M_=new Jb(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(async()=>{const e=new wO(this.datastore),s=this.Hu(e);s&&s.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.Yu(i)}))}).catch(r=>{this.Yu(r)})})}Hu(e){try{const s=this.updateFunction(e);return!Ah(s)&&s.catch&&s.then?s:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(s){return this.deferred.reject(s),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if(e.name==="FirebaseError"){const s=e.code;return s==="aborted"||s==="failed-precondition"||s==="already-exists"||!AI(s)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Do="FirestoreClient";class NO{constructor(e,s,r,i,a){this.authCredentials=e,this.appCheckCredentials=s,this.asyncQueue=r,this.databaseInfo=i,this.user=sr.UNAUTHENTICATED,this.clientId=vf.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=a,this.authCredentials.start(r,async o=>{wt(Do,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(wt(Do,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ji;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(s){const r=n0(s,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Kg(n,e){n.asyncQueue.verifyOperationInProgress(),wt(Do,"Initializing OfflineComponentProvider");const s=n.configuration;await e.initialize(s);let r=s.initialUser;n.setCredentialChangeListener(async i=>{r.isEqual(i)||(await BI(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function KN(n,e){n.asyncQueue.verifyOperationInProgress();const s=await jO(n);wt(Do,"Initializing OnlineComponentProvider"),await e.initialize(s,n.configuration),n.setCredentialChangeListener(r=>BN(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>BN(e.remoteStore,i)),n._onlineComponents=e}async function jO(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){wt(Do,"Using user provided OfflineComponentProvider");try{await Kg(n,n._uninitializedComponentsProvider._offline)}catch(e){const s=e;if(!function(i){return i.name==="FirebaseError"?i.code===Be.FAILED_PRECONDITION||i.code===Be.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(s))throw s;zl("Error using user provided cache. Falling back to memory cache: "+s),await Kg(n,new zp)}}else wt(Do,"Using default OfflineComponentProvider"),await Kg(n,new bO(void 0));return n._offlineComponents}async function u0(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(wt(Do,"Using user provided OnlineComponentProvider"),await KN(n,n._uninitializedComponentsProvider._online)):(wt(Do,"Using default OnlineComponentProvider"),await KN(n,new Ey))),n._onlineComponents}function SO(n){return u0(n).then(e=>e.syncEngine)}function EO(n){return u0(n).then(e=>e.datastore)}async function Vp(n){const e=await u0(n),s=e.eventManager;return s.onListen=aO.bind(null,e.syncEngine),s.onUnlisten=cO.bind(null,e.syncEngine),s.onFirstRemoteStoreListen=oO.bind(null,e.syncEngine),s.onLastRemoteStoreUnlisten=dO.bind(null,e.syncEngine),s}function CO(n,e,s={}){const r=new Ji;return n.asyncQueue.enqueueAndForget(async()=>function(a,o,l,c,d){const u=new d0({next:p=>{u.Nu(),o.enqueueAndForget(()=>i0(a,f));const j=p.docs.has(l);!j&&p.fromCache?d.reject(new ht(Be.UNAVAILABLE,"Failed to get document because the client is offline.")):j&&p.fromCache&&c&&c.source==="server"?d.reject(new ht(Be.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(p)},error:p=>d.reject(p)}),f=new o0(Ef(l.path),u,{includeMetadataChanges:!0,qa:!0});return r0(a,f)}(await Vp(n),n.asyncQueue,e,s,r)),r.promise}function IO(n,e,s={}){const r=new Ji;return n.asyncQueue.enqueueAndForget(async()=>function(a,o,l,c,d){const u=new d0({next:p=>{u.Nu(),o.enqueueAndForget(()=>i0(a,f)),p.fromCache&&c.source==="server"?d.reject(new ht(Be.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(p)},error:p=>d.reject(p)}),f=new o0(l,u,{includeMetadataChanges:!0,qa:!0});return r0(a,f)}(await Vp(n),n.asyncQueue,e,s,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aT(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YN=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oT="firestore.googleapis.com",JN=!0;class XN{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new ht(Be.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=oT,this.ssl=JN}else this.host=e.host,this.ssl=e.ssl??JN;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=zI;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<sF)throw new ht(Be.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}KC("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=aT(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new ht(Be.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new ht(Be.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new ht(Be.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class kf{constructor(e,s,r,i){this._authCredentials=e,this._appCheckCredentials=s,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new XN({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ht(Be.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ht(Be.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new XN(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new HC;switch(r.type){case"firstParty":return new Ok(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ht(Be.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(s){const r=YN.get(s);r&&(wt("ComponentProvider","Removing Datastore"),YN.delete(s),r.terminate())}(this),Promise.resolve()}}function lT(n,e,s,r={}){var d;n=Qn(n,kf);const i=Mo(e),a=n._getSettings(),o={...a,emulatorOptions:n._getEmulatorOptions()},l=`${e}:${s}`;i&&(Db(`https://${l}`),Pb("Firestore",!0)),a.host!==oT&&a.host!==l&&zl("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...a,host:l,ssl:i,emulatorOptions:r};if(!Ml(c,o)&&(n._setSettings(c),r.mockUserToken)){let u,f;if(typeof r.mockUserToken=="string")u=r.mockUserToken,f=sr.MOCK_USER;else{u=PC(r.mockUserToken,(d=n._app)==null?void 0:d.options.projectId);const p=r.mockUserToken.sub||r.mockUserToken.user_id;if(!p)throw new ht(Be.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new sr(p)}n._authCredentials=new kk(new qC(u,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ra{constructor(e,s,r){this.converter=s,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new ra(this.firestore,e,this._query)}}class en{constructor(e,s,r){this.converter=s,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Na(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new en(this.firestore,e,this._key)}toJSON(){return{type:en._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,s,r){if(Th(s,en._jsonSchema))return new en(e,r||null,new Pt($s.fromString(s.referencePath)))}}en._jsonSchemaVersion="firestore/documentReference/1.0",en._jsonSchema={type:jn("string",en._jsonSchemaVersion),referencePath:jn("string")};class Na extends ra{constructor(e,s,r){super(e,s,Ef(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new en(this.firestore,null,new Pt(e))}withConverter(e){return new Na(this.firestore,e,this._path)}}function Pe(n,e,...s){if(n=Fs(n),QC("collection","path",e),n instanceof kf){const r=$s.fromString(e,...s);return uN(r),new Na(n,null,r)}{if(!(n instanceof en||n instanceof Na))throw new ht(Be.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child($s.fromString(e,...s));return uN(r),new Na(n.firestore,null,r)}}function Le(n,e,...s){if(n=Fs(n),arguments.length===1&&(e=vf.newId()),QC("doc","path",e),n instanceof kf){const r=$s.fromString(e,...s);return dN(r),new en(n,null,new Pt(r))}{if(!(n instanceof en||n instanceof Na))throw new ht(Be.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child($s.fromString(e,...s));return dN(r),new en(n.firestore,n instanceof Na?n.converter:null,new Pt(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZN="AsyncQueue";class ej{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Jb(this,"async_queue_retry"),this._c=()=>{const r=Qg();r&&wt(ZN,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const s=Qg();s&&typeof s.addEventListener=="function"&&s.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const s=Qg();s&&typeof s.removeEventListener=="function"&&s.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const s=new Ji;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(s.resolve,s.reject),s.promise)).then(()=>s.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!wd(e))throw e;wt(ZN,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const s=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,_a("INTERNAL UNHANDLED ERROR: ",tj(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=s,s}enqueueAfterDelay(e,s,r){this.uc(),this.oc.indexOf(e)>-1&&(s=0);const i=s0.createAndSchedule(this,e,s,r,a=>this.hc(a));return this.tc.push(i),i}uc(){this.nc&&Ot(47125,{Pc:tj(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const s of this.tc)if(s.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((s,r)=>s.targetTimeMs-r.targetTimeMs);for(const s of this.tc)if(s.skipDelay(),e!=="all"&&s.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const s=this.tc.indexOf(e);this.tc.splice(s,1)}}function tj(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sj(n){return function(s,r){if(typeof s!="object"||s===null)return!1;const i=s;for(const a of r)if(a in i&&typeof i[a]=="function")return!0;return!1}(n,["next","error","complete"])}class pi extends kf{constructor(e,s,r,i){super(e,s,r,i),this.type="firestore",this._queue=new ej,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ej(e),this._firestoreClient=void 0,await e}}}function cT(n,e){const s=typeof n=="object"?n:Fb(),r=typeof n=="string"?n:Pp,i=wf(s,"firestore").getImmediate({identifier:r});if(!i._initialized){const a=_C("firestore");a&&lT(i,...a)}return i}function ec(n){if(n._terminated)throw new ht(Be.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||TO(n),n._firestoreClient}function TO(n){var r,i,a;const e=n._freezeSettings(),s=function(l,c,d,u){return new eL(l,c,d,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,aT(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)}(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(i=e.localCache)!=null&&i._offlineComponentProvider&&((a=e.localCache)!=null&&a._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new NO(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(l){const c=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(c),_online:c}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ar(Gn.fromBase64String(e))}catch(s){throw new ht(Be.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+s)}}static fromUint8Array(e){return new Ar(Gn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Ar._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Th(e,Ar._jsonSchema))return Ar.fromBase64String(e.bytes)}}Ar._jsonSchemaVersion="firestore/bytes/1.0",Ar._jsonSchema={type:jn("string",Ar._jsonSchemaVersion),bytes:jn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(...e){for(let s=0;s<e.length;++s)if(e[s].length===0)throw new ht(Be.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new zn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jd{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i{constructor(e,s){if(!isFinite(e)||e<-90||e>90)throw new ht(Be.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(s)||s<-180||s>180)throw new ht(Be.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+s);this._lat=e,this._long=s}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return fs(this._lat,e._lat)||fs(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:_i._jsonSchemaVersion}}static fromJSON(e){if(Th(e,_i._jsonSchema))return new _i(e.latitude,e.longitude)}}_i._jsonSchemaVersion="firestore/geoPoint/1.0",_i._jsonSchema={type:jn("string",_i._jsonSchemaVersion),latitude:jn("number"),longitude:jn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri{constructor(e){this._values=(e||[]).map(s=>s)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let a=0;a<r.length;++a)if(r[a]!==i[a])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Ri._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Th(e,Ri._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(s=>typeof s=="number"))return new Ri(e.vectorValues);throw new ht(Be.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ri._jsonSchemaVersion="firestore/vectorValue/1.0",Ri._jsonSchema={type:jn("string",Ri._jsonSchemaVersion),vectorValues:jn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AO=/^__.*__$/;class _O{constructor(e,s,r){this.data=e,this.fieldMask=s,this.fieldTransforms=r}toMutation(e,s){return this.fieldMask!==null?new $o(e,this.data,this.fieldMask,s,this.fieldTransforms):new _h(e,this.data,s,this.fieldTransforms)}}class dT{constructor(e,s,r){this.data=e,this.fieldMask=s,this.fieldTransforms=r}toMutation(e,s){return new $o(e,this.data,this.fieldMask,s,this.fieldTransforms)}}function uT(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ot(40011,{Ac:n})}}class h0{constructor(e,s,r,i,a,o){this.settings=e,this.databaseId=s,this.serializer=r,this.ignoreUndefinedProperties=i,a===void 0&&this.Rc(),this.fieldTransforms=a||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new h0({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var i;const s=(i=this.path)==null?void 0:i.child(e),r=this.Vc({path:s,fc:!1});return r.gc(e),r}yc(e){var i;const s=(i=this.path)==null?void 0:i.child(e),r=this.Vc({path:s,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Bp(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(s=>e.isPrefixOf(s))!==void 0||this.fieldTransforms.find(s=>e.isPrefixOf(s.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(uT(this.Ac)&&AO.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class RO{constructor(e,s,r){this.databaseId=e,this.ignoreUndefinedProperties=s,this.serializer=r||Rf(e)}Cc(e,s,r,i=!1){return new h0({Ac:e,methodName:s,Dc:r,path:zn.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Sd(n){const e=n._freezeSettings(),s=Rf(n._databaseId);return new RO(n._databaseId,!!e.ignoreUndefinedProperties,s)}function Lf(n,e,s,r,i,a={}){const o=n.Cc(a.merge||a.mergeFields?2:0,e,s,i);x0("Data must be an object, but it was:",o,r);const l=hT(r,o);let c,d;if(a.merge)c=new Gr(o.fieldMask),d=o.fieldTransforms;else if(a.mergeFields){const u=[];for(const f of a.mergeFields){const p=Cy(e,f,s);if(!o.contains(p))throw new ht(Be.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);pT(u,p)||u.push(p)}c=new Gr(u),d=o.fieldTransforms.filter(f=>c.covers(f.field))}else c=null,d=o.fieldTransforms;return new _O(new wr(l),c,d)}class Lh extends jd{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Lh}}class m0 extends jd{_toFieldTransform(e){return new EI(e.path,new uh)}isEqual(e){return e instanceof m0}}class p0 extends jd{constructor(e,s){super(e),this.Fc=s}_toFieldTransform(e){const s=new ph(e.serializer,wI(e.serializer,this.Fc));return new EI(e.path,s)}isEqual(e){return e instanceof p0&&this.Fc===e.Fc}}function f0(n,e,s,r){const i=n.Cc(1,e,s);x0("Data must be an object, but it was:",i,r);const a=[],o=wr.empty();Uo(r,(c,d)=>{const u=y0(e,c,s);d=Fs(d);const f=i.yc(u);if(d instanceof Lh)a.push(u);else{const p=Fh(d,f);p!=null&&(a.push(u),o.set(u,p))}});const l=new Gr(a);return new dT(o,l,i.fieldTransforms)}function g0(n,e,s,r,i,a){const o=n.Cc(1,e,s),l=[Cy(e,r,s)],c=[i];if(a.length%2!=0)throw new ht(Be.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<a.length;p+=2)l.push(Cy(e,a[p])),c.push(a[p+1]);const d=[],u=wr.empty();for(let p=l.length-1;p>=0;--p)if(!pT(d,l[p])){const j=l[p];let L=c[p];L=Fs(L);const R=o.yc(j);if(L instanceof Lh)d.push(j);else{const D=Fh(L,R);D!=null&&(d.push(j),u.set(j,D))}}const f=new Gr(d);return new dT(u,f,o.fieldTransforms)}function DO(n,e,s,r=!1){return Fh(s,n.Cc(r?4:3,e))}function Fh(n,e){if(mT(n=Fs(n)))return x0("Unsupported field value:",e,n),hT(n,e);if(n instanceof jd)return function(r,i){if(!uT(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const a=r._toFieldTransform(i);a&&i.fieldTransforms.push(a)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,i){const a=[];let o=0;for(const l of r){let c=Fh(l,i.wc(o));c==null&&(c={nullValue:"NULL_VALUE"}),a.push(c),o++}return{arrayValue:{values:a}}}(n,e)}return function(r,i){if((r=Fs(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return wI(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const a=hs.fromDate(r);return{timestampValue:Op(i.serializer,a)}}if(r instanceof hs){const a=new hs(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Op(i.serializer,a)}}if(r instanceof _i)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Ar)return{bytesValue:PI(i.serializer,r._byteString)};if(r instanceof en){const a=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(a))throw i.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${a.projectId}/${a.database}`);return{referenceValue:qb(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Ri)return function(o,l){return{mapValue:{fields:{[rI]:{stringValue:iI},[kp]:{arrayValue:{values:o.toArray().map(d=>{if(typeof d!="number")throw l.Sc("VectorValues must only contain numeric values.");return Bb(l.serializer,d)})}}}}}}(r,i);throw i.Sc(`Unsupported field value: ${Nf(r)}`)}(n,e)}function hT(n,e){const s={};return XC(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Uo(n,(r,i)=>{const a=Fh(i,e.mc(r));a!=null&&(s[r]=a)}),{mapValue:{fields:s}}}function mT(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof hs||n instanceof _i||n instanceof Ar||n instanceof en||n instanceof jd||n instanceof Ri)}function x0(n,e,s){if(!mT(s)||!YC(s)){const r=Nf(s);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function Cy(n,e,s){if((e=Fs(e))instanceof tc)return e._internalPath;if(typeof e=="string")return y0(n,e);throw Bp("Field path arguments must be of type string or ",n,!1,void 0,s)}const PO=new RegExp("[~\\*/\\[\\]]");function y0(n,e,s){if(e.search(PO)>=0)throw Bp(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,s);try{return new tc(...e.split("."))._internalPath}catch{throw Bp(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,s)}}function Bp(n,e,s,r,i){const a=r&&!r.isEmpty(),o=i!==void 0;let l=`Function ${e}() called with invalid data`;s&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(a||o)&&(c+=" (found",a&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new ht(Be.INVALID_ARGUMENT,l+n+c)}function pT(n,e){return n.some(s=>s.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gp{constructor(e,s,r,i,a){this._firestore=e,this._userDataWriter=s,this._key=r,this._document=i,this._converter=a}get id(){return this._key.path.lastSegment()}get ref(){return new en(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new kO(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const s=this._document.data.field(Ff("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s)}}}class kO extends Gp{data(){return super.data()}}function Ff(n,e){return typeof e=="string"?y0(n,e):e instanceof tc?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fT(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new ht(Be.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class b0{}class Of extends b0{}function st(n,e,...s){let r=[];e instanceof b0&&r.push(e),r=r.concat(s),function(a){const o=a.filter(c=>c instanceof Mf).length,l=a.filter(c=>c instanceof Oh).length;if(o>1||o>0&&l>0)throw new ht(Be.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class Oh extends Of{constructor(e,s,r){super(),this._field=e,this._op=s,this._value=r,this.type="where"}static _create(e,s,r){return new Oh(e,s,r)}_apply(e){const s=this._parse(e);return gT(e._query,s),new ra(e.firestore,e.converter,xy(e._query,s))}_parse(e){const s=Sd(e.firestore);return function(a,o,l,c,d,u,f){let p;if(d.isKeyField()){if(u==="array-contains"||u==="array-contains-any")throw new ht(Be.INVALID_ARGUMENT,`Invalid Query. You can't perform '${u}' queries on documentId().`);if(u==="in"||u==="not-in"){rj(f,u);const L=[];for(const R of f)L.push(nj(c,a,R));p={arrayValue:{values:L}}}else p=nj(c,a,f)}else u!=="in"&&u!=="not-in"&&u!=="array-contains-any"||rj(f,u),p=DO(l,o,f,u==="in"||u==="not-in");return vn.create(d,u,p)}(e._query,"where",s,e.firestore._databaseId,this._field,this._op,this._value)}}function xt(n,e,s){const r=e,i=Ff("where",n);return Oh._create(i,r,s)}class Mf extends b0{constructor(e,s){super(),this.type=e,this._queryConstraints=s}static _create(e,s){return new Mf(e,s)}_parse(e){const s=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return s.length===1?s[0]:Pi.create(s,this._getOperator())}_apply(e){const s=this._parse(e);return s.getFilters().length===0?e:(function(i,a){let o=i;const l=a.getFlattenedFilters();for(const c of l)gT(o,c),o=xy(o,c)}(e._query,s),new ra(e.firestore,e.converter,xy(e._query,s)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Uf extends Of{constructor(e,s){super(),this._field=e,this._direction=s,this.type="orderBy"}static _create(e,s){return new Uf(e,s)}_apply(e){const s=function(i,a,o){if(i.startAt!==null)throw new ht(Be.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new ht(Be.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new dh(a,o)}(e._query,this._field,this._direction);return new ra(e.firestore,e.converter,function(i,a){const o=i.explicitOrderBy.concat([a]);return new vd(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,s))}}function as(n,e="asc"){const s=e,r=Ff("orderBy",n);return Uf._create(r,s)}class $f extends Of{constructor(e,s,r){super(),this.type=e,this._limit=s,this._limitType=r}static _create(e,s,r){return new $f(e,s,r)}_apply(e){return new ra(e.firestore,e.converter,Fp(e._query,this._limit,this._limitType))}}function cd(n){return Bk("limit",n),$f._create("limit",n,"F")}function nj(n,e,s){if(typeof(s=Fs(s))=="string"){if(s==="")throw new ht(Be.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!mI(e)&&s.indexOf("/")!==-1)throw new ht(Be.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${s}' contains a '/' character.`);const r=e.path.child($s.fromString(s));if(!Pt.isDocumentKey(r))throw new ht(Be.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return bN(n,new Pt(r))}if(s instanceof en)return bN(n,s._key);throw new ht(Be.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Nf(s)}.`)}function rj(n,e){if(!Array.isArray(n)||n.length===0)throw new ht(Be.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function gT(n,e){const s=function(i,a){for(const o of i)for(const l of o.getFlattenedFilters())if(a.indexOf(l.op)>=0)return l.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(s!==null)throw s===e.op?new ht(Be.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ht(Be.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${s.toString()}' filters.`)}class w0{convertValue(e,s="none"){switch(_o(e)){case 0:return null;case 1:return e.booleanValue;case 2:return gn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,s);case 5:return e.stringValue;case 6:return this.convertBytes(Ao(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,s);case 11:return this.convertObject(e.mapValue,s);case 10:return this.convertVectorValue(e.mapValue);default:throw Ot(62114,{value:e})}}convertObject(e,s){return this.convertObjectMap(e.fields,s)}convertObjectMap(e,s="none"){const r={};return Uo(e,(i,a)=>{r[i]=this.convertValue(a,s)}),r}convertVectorValue(e){var r,i,a;const s=(a=(i=(r=e.fields)==null?void 0:r[kp].arrayValue)==null?void 0:i.values)==null?void 0:a.map(o=>gn(o.doubleValue));return new Ri(s)}convertGeoPoint(e){return new _i(gn(e.latitude),gn(e.longitude))}convertArray(e,s){return(e.values||[]).map(r=>this.convertValue(r,s))}convertServerTimestamp(e,s){switch(s){case"previous":const r=Sf(e);return r==null?null:this.convertValue(r,s);case"estimate":return this.convertTimestamp(lh(e));default:return null}}convertTimestamp(e){const s=To(e);return new hs(s.seconds,s.nanos)}convertDocumentKey(e,s){const r=$s.fromString(e);Es($I(r),9688,{name:e});const i=new rd(r.get(1),r.get(3)),a=new Pt(r.popFirst(5));return i.isEqual(s)||_a(`Document ${a} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${s.projectId}/${s.database}) instead.`),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zf(n,e,s){let r;return r=n?s&&(s.merge||s.mergeFields)?n.toFirestore(e,s):n.toFirestore(e):e,r}class LO extends w0{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ar(e)}convertReference(e){const s=this.convertDocumentKey(e,this.firestore._databaseId);return new en(this.firestore,null,s)}}class El{constructor(e,s){this.hasPendingWrites=e,this.fromCache=s}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ja extends Gp{constructor(e,s,r,i,a,o){super(e,s,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=a}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const s=new ku(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(s,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,s={}){if(this._document){const r=this._document.data.field(Ff("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,s.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new ht(Be.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,s={};return s.type=ja._jsonSchemaVersion,s.bundle="",s.bundleSource="DocumentSnapshot",s.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?s:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),s.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),s)}}ja._jsonSchemaVersion="firestore/documentSnapshot/1.0",ja._jsonSchema={type:jn("string",ja._jsonSchemaVersion),bundleSource:jn("string","DocumentSnapshot"),bundleName:jn("string"),bundle:jn("string")};class ku extends ja{data(e={}){return super.data(e)}}class No{constructor(e,s,r,i){this._firestore=e,this._userDataWriter=s,this._snapshot=i,this.metadata=new El(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(s=>e.push(s)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,s){this._snapshot.docs.forEach(r=>{e.call(s,new ku(this._firestore,this._userDataWriter,r.key,r,new El(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const s=!!e.includeMetadataChanges;if(s&&this._snapshot.excludesMetadataChanges)throw new ht(Be.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===s||(this._cachedChanges=function(i,a){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(l=>{const c=new ku(i._firestore,i._userDataWriter,l.doc.key,l.doc,new El(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(l=>a||l.type!==3).map(l=>{const c=new ku(i._firestore,i._userDataWriter,l.doc.key,l.doc,new El(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);let d=-1,u=-1;return l.type!==0&&(d=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),u=o.indexOf(l.doc.key)),{type:FO(l.type),doc:c,oldIndex:d,newIndex:u}})}}(this,s),this._cachedChangesIncludeMetadataChanges=s),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new ht(Be.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=No._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=vf.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const s=[],r=[],i=[];return this.docs.forEach(a=>{a._document!==null&&(s.push(a._document),r.push(this._userDataWriter.convertObjectMap(a._document.data.value.mapValue.fields,"previous")),i.push(a.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function FO(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ot(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ss(n){n=Qn(n,en);const e=Qn(n.firestore,pi);return CO(ec(e),n._key).then(s=>xT(e,n,s))}No._jsonSchemaVersion="firestore/querySnapshot/1.0",No._jsonSchema={type:jn("string",No._jsonSchemaVersion),bundleSource:jn("string","QuerySnapshot"),bundleName:jn("string"),bundle:jn("string")};class Vf extends w0{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ar(e)}convertReference(e){const s=this.convertDocumentKey(e,this.firestore._databaseId);return new en(this.firestore,null,s)}}function qe(n){n=Qn(n,ra);const e=Qn(n.firestore,pi),s=ec(e),r=new Vf(e);return fT(n._query),IO(s,n._query).then(i=>new No(e,r,n,i))}function yn(n,e,s){n=Qn(n,en);const r=Qn(n.firestore,pi),i=zf(n.converter,e,s);return Ed(r,[Lf(Sd(r),"setDoc",n._key,i,n.converter!==null,s).toMutation(n._key,Nn.none())])}function Qt(n,e,s,...r){n=Qn(n,en);const i=Qn(n.firestore,pi),a=Sd(i);let o;return o=typeof(e=Fs(e))=="string"||e instanceof tc?g0(a,"updateDoc",n._key,e,s,r):f0(a,"updateDoc",n._key,e),Ed(i,[o.toMutation(n._key,Nn.exists(!0))])}function es(n){return Ed(Qn(n.firestore,pi),[new Rh(n._key,Nn.none())])}function As(n,e){const s=Qn(n.firestore,pi),r=Le(n),i=zf(n.converter,e);return Ed(s,[Lf(Sd(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Nn.exists(!1))]).then(()=>r)}function ar(n,...e){var c,d,u;n=Fs(n);let s={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||sj(e[r])||(s=e[r++]);const i={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(sj(e[r])){const f=e[r];e[r]=(c=f.next)==null?void 0:c.bind(f),e[r+1]=(d=f.error)==null?void 0:d.bind(f),e[r+2]=(u=f.complete)==null?void 0:u.bind(f)}let a,o,l;if(n instanceof en)o=Qn(n.firestore,pi),l=Ef(n._key.path),a={next:f=>{e[r]&&e[r](xT(o,n,f))},error:e[r+1],complete:e[r+2]};else{const f=Qn(n,ra);o=Qn(f.firestore,pi),l=f._query;const p=new Vf(o);a={next:j=>{e[r]&&e[r](new No(o,p,f,j))},error:e[r+1],complete:e[r+2]},fT(n._query)}return function(p,j,L,R){const D=new d0(R),y=new o0(j,D,L);return p.asyncQueue.enqueueAndForget(async()=>r0(await Vp(p),y)),()=>{D.Nu(),p.asyncQueue.enqueueAndForget(async()=>i0(await Vp(p),y))}}(ec(o),l,i,a)}function Ed(n,e){return function(r,i){const a=new Ji;return r.asyncQueue.enqueueAndForget(async()=>uO(await SO(r),i,a)),a.promise}(ec(n),e)}function xT(n,e,s){const r=s.docs.get(e._key),i=new Vf(n);return new ja(n,i,e._key,r,new El(s.hasPendingWrites,s.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OO={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yT{constructor(e,s){this._firestore=e,this._commitHandler=s,this._mutations=[],this._committed=!1,this._dataReader=Sd(e)}set(e,s,r){this._verifyNotCommitted();const i=lo(e,this._firestore),a=zf(i.converter,s,r),o=Lf(this._dataReader,"WriteBatch.set",i._key,a,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,Nn.none())),this}update(e,s,r,...i){this._verifyNotCommitted();const a=lo(e,this._firestore);let o;return o=typeof(s=Fs(s))=="string"||s instanceof tc?g0(this._dataReader,"WriteBatch.update",a._key,s,r,i):f0(this._dataReader,"WriteBatch.update",a._key,s),this._mutations.push(o.toMutation(a._key,Nn.exists(!0))),this}delete(e){this._verifyNotCommitted();const s=lo(e,this._firestore);return this._mutations=this._mutations.concat(new Rh(s._key,Nn.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new ht(Be.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function lo(n,e){if((n=Fs(n)).firestore!==e)throw new ht(Be.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MO{constructor(e,s){this._firestore=e,this._transaction=s,this._dataReader=Sd(e)}get(e){const s=lo(e,this._firestore),r=new LO(this._firestore);return this._transaction.lookup([s._key]).then(i=>{if(!i||i.length!==1)return Ot(24041);const a=i[0];if(a.isFoundDocument())return new Gp(this._firestore,r,a.key,a,s.converter);if(a.isNoDocument())return new Gp(this._firestore,r,s._key,null,s.converter);throw Ot(18433,{doc:a})})}set(e,s,r){const i=lo(e,this._firestore),a=zf(i.converter,s,r),o=Lf(this._dataReader,"Transaction.set",i._key,a,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,s,r,...i){const a=lo(e,this._firestore);let o;return o=typeof(s=Fs(s))=="string"||s instanceof tc?g0(this._dataReader,"Transaction.update",a._key,s,r,i):f0(this._dataReader,"Transaction.update",a._key,s),this._transaction.update(a._key,o),this}delete(e){const s=lo(e,this._firestore);return this._transaction.delete(s._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bT extends MO{constructor(e,s){super(e,s),this._firestore=e}get(e){const s=lo(e,this._firestore),r=new Vf(this._firestore);return super.get(e).then(i=>new ja(this._firestore,r,s._key,i._document,new El(!1,!1),s.converter))}}function fh(n,e,s){n=Qn(n,pi);const r={...OO,...s};return function(a){if(a.maxAttempts<1)throw new ht(Be.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(a,o,l){const c=new Ji;return a.asyncQueue.enqueueAndForget(async()=>{const d=await EO(a);new vO(a.asyncQueue,d,l,o,c).ju()}),c.promise}(ec(n),i=>e(new bT(n,i)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wT(){return new Lh("deleteField")}function We(){return new m0("serverTimestamp")}function v0(n){return new p0("increment",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fr(n){return ec(n=Qn(n,pi)),new yT(n,e=>Ed(n,e))}(function(e,s=!0){(function(i){yd=i})(Jl),Ul(new Co("firestore",(r,{instanceIdentifier:i,options:a})=>{const o=r.getProvider("app").getImmediate(),l=new pi(new Lk(r.getProvider("auth-internal")),new Mk(o,r.getProvider("app-check-internal")),function(d,u){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new ht(Be.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rd(d.options.projectId,u)}(o,i),o);return a={useFetchStreams:s,...a},l._setSettings(a),l},"PUBLIC").setMultipleInstances(!0)),Yi(aN,oN,e),Yi(aN,oN,"esm2020")})();const Tl=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:w0,Bytes:Ar,CollectionReference:Na,DocumentReference:en,DocumentSnapshot:ja,FieldPath:tc,FieldValue:jd,Firestore:pi,FirestoreError:ht,GeoPoint:_i,Query:ra,QueryCompositeFilterConstraint:Mf,QueryConstraint:Of,QueryDocumentSnapshot:ku,QueryFieldFilterConstraint:Oh,QueryLimitConstraint:$f,QueryOrderByConstraint:Uf,QuerySnapshot:No,SnapshotMetadata:El,Timestamp:hs,Transaction:bT,VectorValue:Ri,WriteBatch:yT,_AutoId:vf,_ByteString:Gn,_DatabaseId:rd,_DocumentKey:Pt,_EmptyAuthCredentialsProvider:HC,_FieldPath:zn,_cast:Qn,_logWarn:zl,_validateIsNotUsedTogether:KC,addDoc:As,collection:Pe,connectFirestoreEmulator:lT,deleteDoc:es,deleteField:wT,doc:Le,ensureFirestoreConfigured:ec,executeWrite:Ed,getDoc:ss,getDocs:qe,getFirestore:cT,increment:v0,limit:cd,onSnapshot:ar,orderBy:as,query:st,runTransaction:fh,serverTimestamp:We,setDoc:yn,updateDoc:Qt,where:xt,writeBatch:Fr},Symbol.toStringTag,{value:"Module"}));function vT(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const UO=vT,NT=new Ch("auth","Firebase",vT());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wp=new kb("@firebase/auth");function $O(n,...e){Wp.logLevel<=ps.WARN&&Wp.warn(`Auth (${Jl}): ${n}`,...e)}function sp(n,...e){Wp.logLevel<=ps.ERROR&&Wp.error(`Auth (${Jl}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ki(n,...e){throw N0(n,...e)}function Zi(n,...e){return N0(n,...e)}function jT(n,e,s){const r={...UO(),[e]:s};return new Ch("auth","Firebase",r).create(e,{appName:n.name})}function ea(n){return jT(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function N0(n,...e){if(typeof n!="string"){const s=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(s,...r)}return NT.create(n,...e)}function Vt(n,e,...s){if(!n)throw N0(e,...s)}function xa(n){const e="INTERNAL ASSERTION FAILED: "+n;throw sp(e),new Error(e)}function Da(n,e){n||xa(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iy(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function zO(){return ij()==="http:"||ij()==="https:"}function ij(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VO(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(zO()||mP()||"connection"in navigator)?navigator.onLine:!0}function BO(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mh{constructor(e,s){this.shortDelay=e,this.longDelay=s,Da(s>e,"Short delay should be less than long delay!"),this.isMobile=dP()||pP()}get(){return VO()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j0(n,e){Da(n.emulator,"Emulator should always be set here");const{url:s}=n.emulator;return e?`${s}${e.startsWith("/")?e.slice(1):e}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ST{static initialize(e,s,r){this.fetchImpl=e,s&&(this.headersImpl=s),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;xa("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;xa("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;xa("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GO={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WO=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],qO=new Mh(3e4,6e4);function zo(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function ia(n,e,s,r,i={}){return ET(n,i,async()=>{let a={},o={};r&&(e==="GET"?o=r:a={body:JSON.stringify(r)});const l=Ih({key:n.config.apiKey,...o}).slice(1),c=await n._getAdditionalHeaders();c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode);const d={method:e,headers:c,...a};return hP()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&Mo(n.emulatorConfig.host)&&(d.credentials="include"),ST.fetch()(await CT(n,n.config.apiHost,s,l),d)})}async function ET(n,e,s){n._canInitEmulator=!1;const r={...GO,...e};try{const i=new QO(n),a=await Promise.race([s(),i.promise]);i.clearNetworkTimeout();const o=await a.json();if("needConfirmation"in o)throw Lm(n,"account-exists-with-different-credential",o);if(a.ok&&!("errorMessage"in o))return o;{const l=a.ok?o.errorMessage:o.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Lm(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Lm(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw Lm(n,"user-disabled",o);const u=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw jT(n,u,d);ki(n,u)}}catch(i){if(i instanceof na)throw i;ki(n,"network-request-failed",{message:String(i)})}}async function Uh(n,e,s,r,i={}){const a=await ia(n,e,s,r,i);return"mfaPendingCredential"in a&&ki(n,"multi-factor-auth-required",{_serverResponse:a}),a}async function CT(n,e,s,r){const i=`${e}${s}?${r}`,a=n,o=a.config.emulator?j0(n.config,i):`${n.config.apiScheme}://${i}`;return WO.includes(s)&&(await a._persistenceManagerAvailable,a._getPersistenceType()==="COOKIE")?a._getPersistence()._getFinalTarget(o).toString():o}function HO(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class QO{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((s,r)=>{this.timer=setTimeout(()=>r(Zi(this.auth,"network-request-failed")),qO.get())})}}function Lm(n,e,s){const r={appName:n.name};s.email&&(r.email=s.email),s.phoneNumber&&(r.phoneNumber=s.phoneNumber);const i=Zi(n,e,r);return i.customData._tokenResponse=s,i}function aj(n){return n!==void 0&&n.enterprise!==void 0}class KO{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===e)return HO(s.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function YO(n,e){return ia(n,"GET","/v2/recaptchaConfig",zo(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JO(n,e){return ia(n,"POST","/v1/accounts:delete",e)}async function qp(n,e){return ia(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lu(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function XO(n,e=!1){const s=Fs(n),r=await s.getIdToken(e),i=S0(r);Vt(i&&i.exp&&i.auth_time&&i.iat,s.auth,"internal-error");const a=typeof i.firebase=="object"?i.firebase:void 0,o=a==null?void 0:a.sign_in_provider;return{claims:i,token:r,authTime:Lu(Yg(i.auth_time)),issuedAtTime:Lu(Yg(i.iat)),expirationTime:Lu(Yg(i.exp)),signInProvider:o||null,signInSecondFactor:(a==null?void 0:a.sign_in_second_factor)||null}}function Yg(n){return Number(n)*1e3}function S0(n){const[e,s,r]=n.split(".");if(e===void 0||s===void 0||r===void 0)return sp("JWT malformed, contained fewer than 3 sections"),null;try{const i=TC(s);return i?JSON.parse(i):(sp("Failed to decode base64 JWT payload"),null)}catch(i){return sp("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function oj(n){const e=S0(n);return Vt(e,"internal-error"),Vt(typeof e.exp<"u","internal-error"),Vt(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bl(n,e,s=!1){if(s)return e;try{return await e}catch(r){throw r instanceof na&&ZO(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function ZO({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e5{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const s=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ty{constructor(e,s){this.createdAt=e,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=Lu(this.lastLoginAt),this.creationTime=Lu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hp(n){var f;const e=n.auth,s=await n.getIdToken(),r=await Bl(n,qp(e,{idToken:s}));Vt(r==null?void 0:r.users.length,e,"internal-error");const i=r.users[0];n._notifyReloadListener(i);const a=(f=i.providerUserInfo)!=null&&f.length?IT(i.providerUserInfo):[],o=s5(n.providerData,a),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(o!=null&&o.length),d=l?c:!1,u={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new Ty(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,u)}async function t5(n){const e=Fs(n);await Hp(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function s5(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function IT(n){return n.map(({providerId:e,...s})=>({providerId:e,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n5(n,e){const s=await ET(n,{},async()=>{const r=Ih({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:a}=n.config,o=await CT(n,i,"/v1/token",`key=${a}`),l=await n._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:r};return n.emulatorConfig&&Mo(n.emulatorConfig.host)&&(c.credentials="include"),ST.fetch()(o,c)});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function r5(n,e){return ia(n,"POST","/v2/accounts:revokeToken",zo(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hc{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Vt(e.idToken,"internal-error"),Vt(typeof e.idToken<"u","internal-error"),Vt(typeof e.refreshToken<"u","internal-error");const s="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):oj(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,s)}updateFromIdToken(e){Vt(e.length!==0,"internal-error");const s=oj(e);this.updateTokensAndExpiration(e,null,s)}async getToken(e,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(Vt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,s){const{accessToken:r,refreshToken:i,expiresIn:a}=await n5(e,s);this.updateTokensAndExpiration(r,i,Number(a))}updateTokensAndExpiration(e,s,r){this.refreshToken=s||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,s){const{refreshToken:r,accessToken:i,expirationTime:a}=s,o=new Hc;return r&&(Vt(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(Vt(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),a&&(Vt(typeof a=="number","internal-error",{appName:e}),o.expirationTime=a),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Hc,this.toJSON())}_performRefresh(){return xa("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qa(n,e){Vt(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Ii{constructor({uid:e,auth:s,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new e5(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=s,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Ty(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const s=await Bl(this,this.stsTokenManager.getToken(this.auth,e));return Vt(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(e){return XO(this,e)}reload(){return t5(this)}_assign(e){this!==e&&(Vt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(s=>({...s})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const s=new Ii({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return s.metadata._copy(this.metadata),s}_onReload(e){Vt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,s=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),s&&await Hp(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Tr(this.auth.app))return Promise.reject(ea(this.auth));const e=await this.getIdToken();return await Bl(this,JO(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,s){const r=s.displayName??void 0,i=s.email??void 0,a=s.phoneNumber??void 0,o=s.photoURL??void 0,l=s.tenantId??void 0,c=s._redirectEventId??void 0,d=s.createdAt??void 0,u=s.lastLoginAt??void 0,{uid:f,emailVerified:p,isAnonymous:j,providerData:L,stsTokenManager:R}=s;Vt(f&&R,e,"internal-error");const D=Hc.fromJSON(this.name,R);Vt(typeof f=="string",e,"internal-error"),qa(r,e.name),qa(i,e.name),Vt(typeof p=="boolean",e,"internal-error"),Vt(typeof j=="boolean",e,"internal-error"),qa(a,e.name),qa(o,e.name),qa(l,e.name),qa(c,e.name),qa(d,e.name),qa(u,e.name);const y=new Ii({uid:f,auth:e,email:i,emailVerified:p,displayName:r,isAnonymous:j,photoURL:o,phoneNumber:a,tenantId:l,stsTokenManager:D,createdAt:d,lastLoginAt:u});return L&&Array.isArray(L)&&(y.providerData=L.map(T=>({...T}))),c&&(y._redirectEventId=c),y}static async _fromIdTokenResponse(e,s,r=!1){const i=new Hc;i.updateFromServerResponse(s);const a=new Ii({uid:s.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await Hp(a),a}static async _fromGetAccountInfoResponse(e,s,r){const i=s.users[0];Vt(i.localId!==void 0,"internal-error");const a=i.providerUserInfo!==void 0?IT(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(a!=null&&a.length),l=new Hc;l.updateFromIdToken(r);const c=new Ii({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:o}),d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Ty(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(a!=null&&a.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lj=new Map;function ya(n){Da(n instanceof Function,"Expected a class definition");let e=lj.get(n);return e?(Da(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,lj.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TT{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,s){this.storage[e]=s}async _get(e){const s=this.storage[e];return s===void 0?null:s}async _remove(e){delete this.storage[e]}_addListener(e,s){}_removeListener(e,s){}}TT.type="NONE";const cj=TT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function np(n,e,s){return`firebase:${n}:${e}:${s}`}class Qc{constructor(e,s,r){this.persistence=e,this.auth=s,this.userKey=r;const{config:i,name:a}=this.auth;this.fullUserKey=np(this.userKey,i.apiKey,a),this.fullPersistenceKey=np("persistence",i.apiKey,a),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const s=await qp(this.auth,{idToken:e}).catch(()=>{});return s?Ii._fromGetAccountInfoResponse(this.auth,s,e):null}return Ii._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,s,r="authUser"){if(!s.length)return new Qc(ya(cj),e,r);const i=(await Promise.all(s.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let a=i[0]||ya(cj);const o=np(r,e.config.apiKey,e.name);let l=null;for(const d of s)try{const u=await d._get(o);if(u){let f;if(typeof u=="string"){const p=await qp(e,{idToken:u}).catch(()=>{});if(!p)break;f=await Ii._fromGetAccountInfoResponse(e,p,u)}else f=Ii._fromJSON(e,u);d!==a&&(l=f),a=d;break}}catch{}const c=i.filter(d=>d._shouldAllowMigration);return!a._shouldAllowMigration||!c.length?new Qc(a,e,r):(a=c[0],l&&await a._set(o,l.toJSON()),await Promise.all(s.map(async d=>{if(d!==a)try{await d._remove(o)}catch{}})),new Qc(a,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dj(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(DT(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(AT(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(kT(e))return"Blackberry";if(LT(e))return"Webos";if(_T(e))return"Safari";if((e.includes("chrome/")||RT(e))&&!e.includes("edge/"))return"Chrome";if(PT(e))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(s);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function AT(n=lr()){return/firefox\//i.test(n)}function _T(n=lr()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function RT(n=lr()){return/crios\//i.test(n)}function DT(n=lr()){return/iemobile/i.test(n)}function PT(n=lr()){return/android/i.test(n)}function kT(n=lr()){return/blackberry/i.test(n)}function LT(n=lr()){return/webos/i.test(n)}function E0(n=lr()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function i5(n=lr()){var e;return E0(n)&&!!((e=window.navigator)!=null&&e.standalone)}function a5(){return fP()&&document.documentMode===10}function FT(n=lr()){return E0(n)||PT(n)||LT(n)||kT(n)||/windows phone/i.test(n)||DT(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OT(n,e=[]){let s;switch(n){case"Browser":s=dj(lr());break;case"Worker":s=`${dj(lr())}-${n}`;break;default:s=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${s}/JsCore/${Jl}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o5{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,s){const r=a=>new Promise((o,l)=>{try{const c=e(a);o(c)}catch(c){l(c)}});r.onAbort=s,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const s=[];try{for(const r of this.queue)await r(e),r.onAbort&&s.push(r.onAbort)}catch(r){s.reverse();for(const i of s)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l5(n,e={}){return ia(n,"GET","/v2/passwordPolicy",zo(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c5=6;class d5{constructor(e){var r;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=s.minPasswordLength??c5,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),s.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),s.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),s.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),s.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const s={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,s),this.validatePasswordCharacterOptions(e,s),s.isValid&&(s.isValid=s.meetsMinPasswordLength??!0),s.isValid&&(s.isValid=s.meetsMaxPasswordLength??!0),s.isValid&&(s.isValid=s.containsLowercaseLetter??!0),s.isValid&&(s.isValid=s.containsUppercaseLetter??!0),s.isValid&&(s.isValid=s.containsNumericCharacter??!0),s.isValid&&(s.isValid=s.containsNonAlphanumericCharacter??!0),s}validatePasswordLengthOptions(e,s){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(s.meetsMinPasswordLength=e.length>=r),i&&(s.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(s,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,s,r,i,a){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u5{constructor(e,s,r,i){this.app=e,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new uj(this),this.idTokenSubscription=new uj(this),this.beforeStateQueue=new o5(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=NT,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(a=>this._resolvePersistenceManagerAvailable=a)}_initializeWithPersistence(e,s){return s&&(this._popupRedirectResolver=ya(s)),this._initializationPromise=this.queue(async()=>{var r,i,a;if(!this._deleted&&(this.persistenceManager=await Qc.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((i=this._popupRedirectResolver)!=null&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((a=this.currentUser)==null?void 0:a.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const s=await qp(this,{idToken:e}),r=await Ii._fromGetAccountInfoResponse(this,s,e);await this.directlySetCurrentUser(r)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var a;if(Tr(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let r=s,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(a=this.redirectUser)==null?void 0:a._redirectEventId,l=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(r=c.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Vt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(e){try{await Hp(e)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=BO()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Tr(this.app))return Promise.reject(ea(this));const s=e?Fs(e):null;return s&&Vt(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(e,s=!1){if(!this._deleted)return e&&Vt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Tr(this.app)?Promise.reject(ea(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Tr(this.app)?Promise.reject(ea(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ya(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await l5(this),s=new d5(e);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Ch("auth","Firebase",e())}onAuthStateChanged(e,s,r){return this.registerStateListener(this.authStateSubscription,e,s,r)}beforeAuthStateChanged(e,s){return this.beforeStateQueue.pushCallback(e,s)}onIdTokenChanged(e,s,r){return this.registerStateListener(this.idTokenSubscription,e,s,r)}authStateReady(){return new Promise((e,s)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},s)}})}async revokeAccessToken(e){if(this.currentUser){const s=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:s};this.tenantId!=null&&(r.tenantId=this.tenantId),await r5(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,s){const r=await this.getOrInitRedirectPersistenceManager(s);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const s=e&&ya(e)||this._popupRedirectResolver;Vt(s,this,"argument-error"),this.redirectPersistenceManager=await Qc.create(this,[ya(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var s,r;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)==null?void 0:s._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((s=this.currentUser)==null?void 0:s.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,s,r,i){if(this._deleted)return()=>{};const a=typeof s=="function"?s:s.next.bind(s);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Vt(l,this,"internal-error"),l.then(()=>{o||a(this.currentUser)}),typeof s=="function"){const c=e.addObserver(s,r,i);return()=>{o=!0,c()}}else{const c=e.addObserver(s);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Vt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=OT(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var i;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const s=await((i=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:i.getHeartbeatsHeader());s&&(e["X-Firebase-Client"]=s);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var s;if(Tr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((s=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getToken());return e!=null&&e.error&&$O(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Vo(n){return Fs(n)}class uj{constructor(e){this.auth=e,this.observer=null,this.addObserver=jP(s=>this.observer=s)}get next(){return Vt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function h5(n){Bf=n}function MT(n){return Bf.loadJS(n)}function m5(){return Bf.recaptchaEnterpriseScript}function p5(){return Bf.gapiScript}function f5(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class g5{constructor(){this.enterprise=new x5}ready(e){e()}execute(e,s){return Promise.resolve("token")}render(e,s){return""}}class x5{ready(e){e()}execute(e,s){return Promise.resolve("token")}render(e,s){return""}}const y5="recaptcha-enterprise",UT="NO_RECAPTCHA";class b5{constructor(e){this.type=y5,this.auth=Vo(e)}async verify(e="verify",s=!1){async function r(a){if(!s){if(a.tenantId==null&&a._agentRecaptchaConfig!=null)return a._agentRecaptchaConfig.siteKey;if(a.tenantId!=null&&a._tenantRecaptchaConfigs[a.tenantId]!==void 0)return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(async(o,l)=>{YO(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new KO(c);return a.tenantId==null?a._agentRecaptchaConfig=d:a._tenantRecaptchaConfigs[a.tenantId]=d,o(d.siteKey)}}).catch(c=>{l(c)})})}function i(a,o,l){const c=window.grecaptcha;aj(c)?c.enterprise.ready(()=>{c.enterprise.execute(a,{action:e}).then(d=>{o(d)}).catch(()=>{o(UT)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new g5().execute("siteKey",{action:"verify"}):new Promise((a,o)=>{r(this.auth).then(l=>{if(!s&&aj(window.grecaptcha))i(l,a,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=m5();c.length!==0&&(c+=l),MT(c).then(()=>{i(l,a,o)}).catch(d=>{o(d)})}}).catch(l=>{o(l)})})}}async function hj(n,e,s,r=!1,i=!1){const a=new b5(n);let o;if(i)o=UT;else try{o=await a.verify(s)}catch{o=await a.verify(s,!0)}const l={...e};if(s==="mfaSmsEnrollment"||s==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:d,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:o}):Object.assign(l,{captchaResponse:o}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function Ay(n,e,s,r,i){var a;if((a=n._getRecaptchaConfig())!=null&&a.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await hj(n,e,s,s==="getOobCode");return r(n,o)}else return r(n,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await hj(n,e,s,s==="getOobCode");return r(n,l)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w5(n,e){const s=wf(n,"auth");if(s.isInitialized()){const i=s.getImmediate(),a=s.getOptions();if(Ml(a,e??{}))return i;ki(i,"already-initialized")}return s.initialize({options:e})}function v5(n,e){const s=(e==null?void 0:e.persistence)||[],r=(Array.isArray(s)?s:[s]).map(ya);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function N5(n,e,s){const r=Vo(n);Vt(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,a=$T(e),{host:o,port:l}=j5(e),c=l===null?"":`:${l}`,d={url:`${a}//${o}${c}/`},u=Object.freeze({host:o,port:l,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){Vt(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Vt(Ml(d,r.config.emulator)&&Ml(u,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,Mo(o)?(Db(`${a}//${o}${c}`),Pb("Auth",!0)):S5()}function $T(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function j5(n){const e=$T(n),s=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!s)return{host:"",port:null};const r=s[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const a=i[1];return{host:a,port:mj(r.substr(a.length+1))}}else{const[a,o]=r.split(":");return{host:a,port:mj(o)}}}function mj(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function S5(){function n(){const e=document.createElement("p"),s=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C0{constructor(e,s){this.providerId=e,this.signInMethod=s}toJSON(){return xa("not implemented")}_getIdTokenResponse(e){return xa("not implemented")}_linkToIdToken(e,s){return xa("not implemented")}_getReauthenticationResolver(e){return xa("not implemented")}}async function E5(n,e){return ia(n,"POST","/v1/accounts:update",e)}async function C5(n,e){return ia(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I5(n,e){return Uh(n,"POST","/v1/accounts:signInWithPassword",zo(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T5(n,e){return Uh(n,"POST","/v1/accounts:signInWithEmailLink",zo(n,e))}async function A5(n,e){return Uh(n,"POST","/v1/accounts:signInWithEmailLink",zo(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gh extends C0{constructor(e,s,r,i=null){super("password",r),this._email=e,this._password=s,this._tenantId=i}static _fromEmailAndPassword(e,s){return new gh(e,s,"password")}static _fromEmailAndCode(e,s,r=null){return new gh(e,s,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const s=typeof e=="string"?JSON.parse(e):e;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ay(e,s,"signInWithPassword",I5);case"emailLink":return T5(e,{email:this._email,oobCode:this._password});default:ki(e,"internal-error")}}async _linkToIdToken(e,s){switch(this.signInMethod){case"password":const r={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ay(e,r,"signUpPassword",C5);case"emailLink":return A5(e,{idToken:s,email:this._email,oobCode:this._password});default:ki(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kc(n,e){return Uh(n,"POST","/v1/accounts:signInWithIdp",zo(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _5="http://localhost";class Gl extends C0{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const s=new Gl(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(s.idToken=e.idToken),e.accessToken&&(s.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(s.nonce=e.nonce),e.pendingToken&&(s.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(s.accessToken=e.oauthToken,s.secret=e.oauthTokenSecret):ki("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const s=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...a}=s;if(!r||!i)return null;const o=new Gl(r,i);return o.idToken=a.idToken||void 0,o.accessToken=a.accessToken||void 0,o.secret=a.secret,o.nonce=a.nonce,o.pendingToken=a.pendingToken||null,o}_getIdTokenResponse(e){const s=this.buildRequest();return Kc(e,s)}_linkToIdToken(e,s){const r=this.buildRequest();return r.idToken=s,Kc(e,r)}_getReauthenticationResolver(e){const s=this.buildRequest();return s.autoCreate=!1,Kc(e,s)}buildRequest(){const e={requestUri:_5,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),e.postBody=Ih(s)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R5(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function D5(n){const e=pu(fu(n)).link,s=e?pu(fu(e)).deep_link_id:null,r=pu(fu(n)).deep_link_id;return(r?pu(fu(r)).link:null)||r||s||e||n}class I0{constructor(e){const s=pu(fu(e)),r=s.apiKey??null,i=s.oobCode??null,a=R5(s.mode??null);Vt(r&&i&&a,"argument-error"),this.apiKey=r,this.operation=a,this.code=i,this.continueUrl=s.continueUrl??null,this.languageCode=s.lang??null,this.tenantId=s.tenantId??null}static parseLink(e){const s=D5(e);try{return new I0(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cd{constructor(){this.providerId=Cd.PROVIDER_ID}static credential(e,s){return gh._fromEmailAndPassword(e,s)}static credentialWithLink(e,s){const r=I0.parseLink(s);return Vt(r,"argument-error"),gh._fromEmailAndCode(e,r.code,r.tenantId)}}Cd.PROVIDER_ID="password";Cd.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Cd.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zT{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $h extends zT{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Za extends $h{constructor(){super("facebook.com")}static credential(e){return Gl._fromParams({providerId:Za.PROVIDER_ID,signInMethod:Za.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Za.credentialFromTaggedObject(e)}static credentialFromError(e){return Za.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Za.credential(e.oauthAccessToken)}catch{return null}}}Za.FACEBOOK_SIGN_IN_METHOD="facebook.com";Za.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eo extends $h{constructor(){super("google.com"),this.addScope("profile")}static credential(e,s){return Gl._fromParams({providerId:eo.PROVIDER_ID,signInMethod:eo.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:s})}static credentialFromResult(e){return eo.credentialFromTaggedObject(e)}static credentialFromError(e){return eo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:s,oauthAccessToken:r}=e;if(!s&&!r)return null;try{return eo.credential(s,r)}catch{return null}}}eo.GOOGLE_SIGN_IN_METHOD="google.com";eo.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class to extends $h{constructor(){super("github.com")}static credential(e){return Gl._fromParams({providerId:to.PROVIDER_ID,signInMethod:to.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return to.credentialFromTaggedObject(e)}static credentialFromError(e){return to.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return to.credential(e.oauthAccessToken)}catch{return null}}}to.GITHUB_SIGN_IN_METHOD="github.com";to.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class so extends $h{constructor(){super("twitter.com")}static credential(e,s){return Gl._fromParams({providerId:so.PROVIDER_ID,signInMethod:so.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:s})}static credentialFromResult(e){return so.credentialFromTaggedObject(e)}static credentialFromError(e){return so.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:s,oauthTokenSecret:r}=e;if(!s||!r)return null;try{return so.credential(s,r)}catch{return null}}}so.TWITTER_SIGN_IN_METHOD="twitter.com";so.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VT(n,e){return Uh(n,"POST","/v1/accounts:signUp",zo(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pa{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,s,r,i=!1){const a=await Ii._fromIdTokenResponse(e,r,i),o=pj(r);return new Pa({user:a,providerId:o,_tokenResponse:r,operationType:s})}static async _forOperation(e,s,r){await e._updateTokensIfNecessary(r,!0);const i=pj(r);return new Pa({user:e,providerId:i,_tokenResponse:r,operationType:s})}}function pj(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BT(n){var i;if(Tr(n.app))return Promise.reject(ea(n));const e=Vo(n);if(await e._initializationPromise,(i=e.currentUser)!=null&&i.isAnonymous)return new Pa({user:e.currentUser,providerId:null,operationType:"signIn"});const s=await VT(e,{returnSecureToken:!0}),r=await Pa._fromIdTokenResponse(e,"signIn",s,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qp extends na{constructor(e,s,r,i){super(s.code,s.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,Qp.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:s.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,s,r,i){return new Qp(e,s,r,i)}}function GT(n,e,s,r){return(e==="reauthenticate"?s._getReauthenticationResolver(n):s._getIdTokenResponse(n)).catch(a=>{throw a.code==="auth/multi-factor-auth-required"?Qp._fromErrorAndOperation(n,a,e,r):a})}async function P5(n,e,s=!1){const r=await Bl(n,e._linkToIdToken(n.auth,await n.getIdToken()),s);return Pa._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k5(n,e,s=!1){const{auth:r}=n;if(Tr(r.app))return Promise.reject(ea(r));const i="reauthenticate";try{const a=await Bl(n,GT(r,i,e,n),s);Vt(a.idToken,r,"internal-error");const o=S0(a.idToken);Vt(o,r,"internal-error");const{sub:l}=o;return Vt(n.uid===l,r,"user-mismatch"),Pa._forOperation(n,i,a)}catch(a){throw(a==null?void 0:a.code)==="auth/user-not-found"&&ki(r,"user-mismatch"),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WT(n,e,s=!1){if(Tr(n.app))return Promise.reject(ea(n));const r="signIn",i=await GT(n,r,e),a=await Pa._fromIdTokenResponse(n,r,i);return s||await n._updateCurrentUser(a.user),a}async function L5(n,e){return WT(Vo(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qT(n){const e=Vo(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function F5(n,e,s){if(Tr(n.app))return Promise.reject(ea(n));const r=Vo(n),o=await Ay(r,{returnSecureToken:!0,email:e,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",VT).catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&qT(n),c}),l=await Pa._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(l.user),l}function O5(n,e,s){return Tr(n.app)?Promise.reject(ea(n)):L5(Fs(n),Cd.credential(e,s)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&qT(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function M5(n,e){return ia(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function U5(n,{displayName:e,photoURL:s}){if(e===void 0&&s===void 0)return;const r=Fs(n),a={idToken:await r.getIdToken(),displayName:e,photoUrl:s,returnSecureToken:!0},o=await Bl(r,M5(r.auth,a));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const l=r.providerData.find(({providerId:c})=>c==="password");l&&(l.displayName=r.displayName,l.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function $5(n,e){return z5(Fs(n),null,e)}async function z5(n,e,s){const{auth:r}=n,a={idToken:await n.getIdToken(),returnSecureToken:!0};s&&(a.password=s);const o=await Bl(n,E5(r,a));await n._updateTokensIfNecessary(o,!0)}function V5(n,e,s,r){return Fs(n).onIdTokenChanged(e,s,r)}function B5(n,e,s){return Fs(n).beforeAuthStateChanged(e,s)}function T0(n,e,s,r){return Fs(n).onAuthStateChanged(e,s,r)}function Wl(n){return Fs(n).signOut()}const Kp="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HT{constructor(e,s){this.storageRetriever=e,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(Kp,"1"),this.storage.removeItem(Kp),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,s){return this.storage.setItem(e,JSON.stringify(s)),Promise.resolve()}_get(e){const s=this.storage.getItem(e);return Promise.resolve(s?JSON.parse(s):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G5=1e3,W5=10;class QT extends HT{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,s)=>this.onStorageEvent(e,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=FT(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const s of Object.keys(this.listeners)){const r=this.storage.getItem(s),i=this.localCache[s];r!==i&&e(s,i,r)}}onStorageEvent(e,s=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const r=e.key;s?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(r);!s&&this.localCache[r]===o||this.notifyListeners(r,o)},a=this.storage.getItem(r);a5()&&a!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,W5):i()}notifyListeners(e,s){this.localCache[e]=s;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,s,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:s,newValue:r}),!0)})},G5)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(s)}_removeListener(e,s){this.listeners[e]&&(this.listeners[e].delete(s),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,s){await super._set(e,s),this.localCache[e]=JSON.stringify(s)}async _get(e){const s=await super._get(e);return this.localCache[e]=JSON.stringify(s),s}async _remove(e){await super._remove(e),delete this.localCache[e]}}QT.type="LOCAL";const q5=QT;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KT extends HT{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,s){}_removeListener(e,s){}}KT.type="SESSION";const YT=KT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H5(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const s=this.receivers.find(i=>i.isListeningto(e));if(s)return s;const r=new Gf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const s=e,{eventId:r,eventType:i,data:a}=s.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;s.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const l=Array.from(o).map(async d=>d(s.origin,a)),c=await H5(l);s.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:c})}_subscribe(e,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(s)}_unsubscribe(e,s){this.handlersMap[e]&&s&&this.handlersMap[e].delete(s),(!s||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Gf.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A0(n="",e=10){let s="";for(let r=0;r<e;r++)s+=Math.floor(Math.random()*10);return n+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q5{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,s,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let a,o;return new Promise((l,c)=>{const d=A0("",20);i.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(f){const p=f;if(p.data.eventId===d)switch(p.data.status){case"ack":clearTimeout(u),a=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(a),l(p.data.response);break;default:clearTimeout(u),clearTimeout(a),c(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:s},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ta(){return window}function K5(n){ta().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JT(){return typeof ta().WorkerGlobalScope<"u"&&typeof ta().importScripts=="function"}async function Y5(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function J5(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function X5(){return JT()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XT="firebaseLocalStorageDb",Z5=1,Yp="firebaseLocalStorage",ZT="fbase_key";class zh{constructor(e){this.request=e}toPromise(){return new Promise((e,s)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function Wf(n,e){return n.transaction([Yp],e?"readwrite":"readonly").objectStore(Yp)}function e3(){const n=indexedDB.deleteDatabase(XT);return new zh(n).toPromise()}function _y(){const n=indexedDB.open(XT,Z5);return new Promise((e,s)=>{n.addEventListener("error",()=>{s(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Yp,{keyPath:ZT})}catch(i){s(i)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Yp)?e(r):(r.close(),await e3(),e(await _y()))})})}async function fj(n,e,s){const r=Wf(n,!0).put({[ZT]:e,value:s});return new zh(r).toPromise()}async function t3(n,e){const s=Wf(n,!1).get(e),r=await new zh(s).toPromise();return r===void 0?null:r.value}function gj(n,e){const s=Wf(n,!0).delete(e);return new zh(s).toPromise()}const s3=800,n3=3;class e1{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await _y(),this.db)}async _withRetries(e){let s=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(s++>n3)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return JT()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Gf._getInstance(X5()),this.receiver._subscribe("keyChanged",async(e,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(e,s)=>["keyChanged"])}async initializeSender(){var s,r;if(this.activeServiceWorker=await Y5(),!this.activeServiceWorker)return;this.sender=new Q5(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(s=e[0])!=null&&s.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||J5()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await _y();return await fj(e,Kp,"1"),await gj(e,Kp),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,s){return this._withPendingWrite(async()=>(await this._withRetries(r=>fj(r,e,s)),this.localCache[e]=s,this.notifyServiceWorker(e)))}async _get(e){const s=await this._withRetries(r=>t3(r,e));return this.localCache[e]=s,s}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(s=>gj(s,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const a=Wf(i,!1).getAll();return new zh(a).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const s=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:a}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(a)&&(this.notifyListeners(i,a),s.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),s.push(i));return s}notifyListeners(e,s){this.localCache[e]=s;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),s3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(s)}_removeListener(e,s){this.listeners[e]&&(this.listeners[e].delete(s),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}e1.type="LOCAL";const r3=e1;new Mh(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i3(n,e){return e?ya(e):(Vt(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _0 extends C0{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Kc(e,this._buildIdpRequest())}_linkToIdToken(e,s){return Kc(e,this._buildIdpRequest(s))}_getReauthenticationResolver(e){return Kc(e,this._buildIdpRequest())}_buildIdpRequest(e){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(s.idToken=e),s}}function a3(n){return WT(n.auth,new _0(n),n.bypassAuthState)}function o3(n){const{auth:e,user:s}=n;return Vt(s,e,"internal-error"),k5(s,new _0(n),n.bypassAuthState)}async function l3(n){const{auth:e,user:s}=n;return Vt(s,e,"internal-error"),P5(s,new _0(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t1{constructor(e,s,r,i,a=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(e,s)=>{this.pendingPromise={resolve:e,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:s,sessionId:r,postBody:i,tenantId:a,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:s,sessionId:r,tenantId:a||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return a3;case"linkViaPopup":case"linkViaRedirect":return l3;case"reauthViaPopup":case"reauthViaRedirect":return o3;default:ki(this.auth,"internal-error")}}resolve(e){Da(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Da(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c3=new Mh(2e3,1e4);class Mc extends t1{constructor(e,s,r,i,a){super(e,s,i,a),this.provider=r,this.authWindow=null,this.pollId=null,Mc.currentPopupAction&&Mc.currentPopupAction.cancel(),Mc.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Vt(e,this.auth,"internal-error"),e}async onExecution(){Da(this.filter.length===1,"Popup operations only handle one event");const e=A0();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(Zi(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Zi(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Mc.currentPopupAction=null}pollUserCancellation(){const e=()=>{var s,r;if((r=(s=this.authWindow)==null?void 0:s.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Zi(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,c3.get())};e()}}Mc.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d3="pendingRedirect",rp=new Map;class u3 extends t1{constructor(e,s,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,r),this.eventId=null}async execute(){let e=rp.get(this.auth._key());if(!e){try{const r=await h3(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(s){e=()=>Promise.reject(s)}rp.set(this.auth._key(),e)}return this.bypassAuthState||rp.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const s=await this.auth._redirectUserForId(e.eventId);if(s)return this.user=s,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function h3(n,e){const s=f3(e),r=p3(n);if(!await r._isAvailable())return!1;const i=await r._get(s)==="true";return await r._remove(s),i}function m3(n,e){rp.set(n._key(),e)}function p3(n){return ya(n._redirectPersistence)}function f3(n){return np(d3,n.config.apiKey,n.name)}async function g3(n,e,s=!1){if(Tr(n.app))return Promise.reject(ea(n));const r=Vo(n),i=i3(r,e),o=await new u3(r,i,s).execute();return o&&!s&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x3=10*60*1e3;class y3{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let s=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(s=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!b3(e)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=e,s=!0)),s}sendToConsumer(e,s){var r;if(e.error&&!s1(e)){const i=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";s.onError(Zi(this.auth,i))}else s.onAuthEvent(e)}isEventForConsumer(e,s){const r=s.eventId===null||!!e.eventId&&e.eventId===s.eventId;return s.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=x3&&this.cachedEventUids.clear(),this.cachedEventUids.has(xj(e))}saveEventToCache(e){this.cachedEventUids.add(xj(e)),this.lastProcessedEventTime=Date.now()}}function xj(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function s1({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function b3(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return s1(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w3(n,e={}){return ia(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v3=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,N3=/^https?/;async function j3(n){if(n.config.emulator)return;const{authorizedDomains:e}=await w3(n);for(const s of e)try{if(S3(s))return}catch{}ki(n,"unauthorized-domain")}function S3(n){const e=Iy(),{protocol:s,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?s==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):s==="chrome-extension:"&&o.hostname===r}if(!N3.test(s))return!1;if(v3.test(n))return r===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E3=new Mh(3e4,6e4);function yj(){const n=ta().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let s=0;s<n.CP.length;s++)n.CP[s]=null}}function C3(n){return new Promise((e,s)=>{var i,a,o;function r(){yj(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{yj(),s(Zi(n,"network-request-failed"))},timeout:E3.get()})}if((a=(i=ta().gapi)==null?void 0:i.iframes)!=null&&a.Iframe)e(gapi.iframes.getContext());else if((o=ta().gapi)!=null&&o.load)r();else{const l=f5("iframefcb");return ta()[l]=()=>{gapi.load?r():s(Zi(n,"network-request-failed"))},MT(`${p5()}?onload=${l}`).catch(c=>s(c))}}).catch(e=>{throw ip=null,e})}let ip=null;function I3(n){return ip=ip||C3(n),ip}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T3=new Mh(5e3,15e3),A3="__/auth/iframe",_3="emulator/auth/iframe",R3={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},D3=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function P3(n){const e=n.config;Vt(e.authDomain,n,"auth-domain-config-required");const s=e.emulator?j0(e,_3):`https://${n.config.authDomain}/${A3}`,r={apiKey:e.apiKey,appName:n.name,v:Jl},i=D3.get(n.config.apiHost);i&&(r.eid=i);const a=n._getFrameworks();return a.length&&(r.fw=a.join(",")),`${s}?${Ih(r).slice(1)}`}async function k3(n){const e=await I3(n),s=ta().gapi;return Vt(s,n,"internal-error"),e.open({where:document.body,url:P3(n),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:R3,dontclear:!0},r=>new Promise(async(i,a)=>{await r.restyle({setHideOnLeave:!1});const o=Zi(n,"network-request-failed"),l=ta().setTimeout(()=>{a(o)},T3.get());function c(){ta().clearTimeout(l),i(r)}r.ping(c).then(c,()=>{a(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L3={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},F3=500,O3=600,M3="_blank",U3="http://localhost";class bj{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function $3(n,e,s,r=F3,i=O3){const a=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c={...L3,width:r.toString(),height:i.toString(),top:a,left:o},d=lr().toLowerCase();s&&(l=RT(d)?M3:s),AT(d)&&(e=e||U3,c.scrollbars="yes");const u=Object.entries(c).reduce((p,[j,L])=>`${p}${j}=${L},`,"");if(i5(d)&&l!=="_self")return z3(e||"",l),new bj(null);const f=window.open(e||"",l,u);Vt(f,n,"popup-blocked");try{f.focus()}catch{}return new bj(f)}function z3(n,e){const s=document.createElement("a");s.href=n,s.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V3="__/auth/handler",B3="emulator/auth/handler",G3=encodeURIComponent("fac");async function wj(n,e,s,r,i,a){Vt(n.config.authDomain,n,"auth-domain-config-required"),Vt(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:s,redirectUrl:r,v:Jl,eventId:i};if(e instanceof zT){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",NP(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,f]of Object.entries({}))o[u]=f}if(e instanceof $h){const u=e.getScopes().filter(f=>f!=="");u.length>0&&(o.scopes=u.join(","))}n.tenantId&&(o.tid=n.tenantId);const l=o;for(const u of Object.keys(l))l[u]===void 0&&delete l[u];const c=await n._getAppCheckToken(),d=c?`#${G3}=${encodeURIComponent(c)}`:"";return`${W3(n)}?${Ih(l).slice(1)}${d}`}function W3({config:n}){return n.emulator?j0(n,B3):`https://${n.authDomain}/${V3}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jg="webStorageSupport";class q3{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=YT,this._completeRedirectFn=g3,this._overrideRedirectResult=m3}async _openPopup(e,s,r,i){var o;Da((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const a=await wj(e,s,r,Iy(),i);return $3(e,a,A0())}async _openRedirect(e,s,r,i){await this._originValidation(e);const a=await wj(e,s,r,Iy(),i);return K5(a),new Promise(()=>{})}_initialize(e){const s=e._key();if(this.eventManagers[s]){const{manager:i,promise:a}=this.eventManagers[s];return i?Promise.resolve(i):(Da(a,"If manager is not set, promise should be"),a)}const r=this.initAndGetManager(e);return this.eventManagers[s]={promise:r},r.catch(()=>{delete this.eventManagers[s]}),r}async initAndGetManager(e){const s=await k3(e),r=new y3(e);return s.register("authEvent",i=>(Vt(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=s,r}_isIframeWebStorageSupported(e,s){this.iframes[e._key()].send(Jg,{type:Jg},i=>{var o;const a=(o=i==null?void 0:i[0])==null?void 0:o[Jg];a!==void 0&&s(!!a),ki(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const s=e._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=j3(e)),this.originValidationPromises[s]}get _shouldInitProactively(){return FT()||_T()||E0()}}const H3=q3;var vj="@firebase/auth",Nj="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q3{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const s=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,s),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const s=this.internalListeners.get(e);s&&(this.internalListeners.delete(e),s(),this.updateProactiveRefresh())}assertAuthConfigured(){Vt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K3(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Y3(n){Ul(new Co("auth",(e,{options:s})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=r.options;Vt(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:OT(n)},d=new u5(r,i,a,c);return v5(d,s),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,s,r)=>{e.getProvider("auth-internal").initialize()})),Ul(new Co("auth-internal",e=>{const s=Vo(e.getProvider("auth").getImmediate());return(r=>new Q3(r))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),Yi(vj,Nj,K3(n)),Yi(vj,Nj,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J3=5*60,X3=DC("authIdTokenMaxAge")||J3;let jj=null;const Z3=n=>async e=>{const s=e&&await e.getIdTokenResult(),r=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(r&&r>X3)return;const i=s==null?void 0:s.token;jj!==i&&(jj=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function eM(n=Fb()){const e=wf(n,"auth");if(e.isInitialized())return e.getImmediate();const s=w5(n,{popupRedirectResolver:H3,persistence:[r3,q5,YT]}),r=DC("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const a=new URL(r,location.origin);if(location.origin===a.origin){const o=Z3(a.toString());B5(s,o,()=>o(s.currentUser)),V5(s,l=>o(l))}}const i=AC("auth");return i&&N5(s,`http://${i}`),s}function tM(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}h5({loadJS(n){return new Promise((e,s)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{const a=Zi("internal-error");a.customData=i,s(a)},r.type="text/javascript",r.charset="UTF-8",tM().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Y3("Browser");var sM="firebase",nM="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Yi(sM,nM,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n1="firebasestorage.googleapis.com",r1="storageBucket",rM=2*60*1e3,iM=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mn extends na{constructor(e,s,r=0){super(Xg(e),`Firebase Storage: ${s} (${Xg(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,mn.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Xg(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var hn;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(hn||(hn={}));function Xg(n){return"storage/"+n}function R0(){const n="An unknown error occurred, please check the error payload for server response.";return new mn(hn.UNKNOWN,n)}function aM(n){return new mn(hn.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function oM(n){return new mn(hn.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function lM(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new mn(hn.UNAUTHENTICATED,n)}function cM(){return new mn(hn.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function dM(n){return new mn(hn.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function uM(){return new mn(hn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function hM(){return new mn(hn.CANCELED,"User canceled the upload/download.")}function mM(n){return new mn(hn.INVALID_URL,"Invalid URL '"+n+"'.")}function pM(n){return new mn(hn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function fM(){return new mn(hn.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+r1+"' property when initializing the app?")}function gM(){return new mn(hn.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function xM(){return new mn(hn.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function yM(n){return new mn(hn.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Ry(n){return new mn(hn.INVALID_ARGUMENT,n)}function i1(){return new mn(hn.APP_DELETED,"The Firebase app was deleted.")}function bM(n){return new mn(hn.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Fu(n,e){return new mn(hn.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function lu(n){throw new mn(hn.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wr{constructor(e,s){this.bucket=e,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,s){let r;try{r=Wr.makeFromUrl(e,s)}catch{return new Wr(e,"")}if(r.path==="")return r;throw pM(e)}static makeFromUrl(e,s){let r=null;const i="([A-Za-z0-9.\\-_]+)";function a(S){S.path.charAt(S.path.length-1)==="/"&&(S.path_=S.path_.slice(0,-1))}const o="(/(.*))?$",l=new RegExp("^gs://"+i+o,"i"),c={bucket:1,path:3};function d(S){S.path_=decodeURIComponent(S.path)}const u="v[A-Za-z0-9_]+",f=s.replace(/[.]/g,"\\."),p="(/([^?#]*).*)?$",j=new RegExp(`^https?://${f}/${u}/b/${i}/o${p}`,"i"),L={bucket:1,path:3},R=s===n1?"(?:storage.googleapis.com|storage.cloud.google.com)":s,D="([^?#]*)",y=new RegExp(`^https?://${R}/${i}/${D}`,"i"),x=[{regex:l,indices:c,postModify:a},{regex:j,indices:L,postModify:d},{regex:y,indices:{bucket:1,path:2},postModify:d}];for(let S=0;S<x.length;S++){const A=x[S],Q=A.regex.exec(e);if(Q){const q=Q[A.indices.bucket];let B=Q[A.indices.path];B||(B=""),r=new Wr(q,B),A.postModify(r);break}}if(r==null)throw mM(e);return r}}class wM{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vM(n,e,s){let r=1,i=null,a=null,o=!1,l=0;function c(){return l===2}let d=!1;function u(...D){d||(d=!0,e.apply(null,D))}function f(D){i=setTimeout(()=>{i=null,n(j,c())},D)}function p(){a&&clearTimeout(a)}function j(D,...y){if(d){p();return}if(D){p(),u.call(null,D,...y);return}if(c()||o){p(),u.call(null,D,...y);return}r<64&&(r*=2);let x;l===1?(l=2,x=0):x=(r+Math.random())*1e3,f(x)}let L=!1;function R(D){L||(L=!0,p(),!d&&(i!==null?(D||(l=2),clearTimeout(i),f(0)):D||(l=1)))}return f(0),a=setTimeout(()=>{o=!0,R(!0)},s),R}function NM(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jM(n){return n!==void 0}function SM(n){return typeof n=="object"&&!Array.isArray(n)}function D0(n){return typeof n=="string"||n instanceof String}function Sj(n){return P0()&&n instanceof Blob}function P0(){return typeof Blob<"u"}function Ej(n,e,s,r){if(r<e)throw Ry(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>s)throw Ry(`Invalid value for '${n}'. Expected ${s} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qf(n,e,s){let r=e;return s==null&&(r=`https://${e}`),`${s}://${r}/v0${n}`}function a1(n){const e=encodeURIComponent;let s="?";for(const r in n)if(n.hasOwnProperty(r)){const i=e(r)+"="+e(n[r]);s=s+i+"&"}return s=s.slice(0,-1),s}var Al;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Al||(Al={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EM(n,e){const s=n>=500&&n<600,i=[408,429].indexOf(n)!==-1,a=e.indexOf(n)!==-1;return s||i||a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CM{constructor(e,s,r,i,a,o,l,c,d,u,f,p=!0,j=!1){this.url_=e,this.method_=s,this.headers_=r,this.body_=i,this.successCodes_=a,this.additionalRetryCodes_=o,this.callback_=l,this.errorCallback_=c,this.timeout_=d,this.progressCallback_=u,this.connectionFactory_=f,this.retry=p,this.isUsingEmulator=j,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((L,R)=>{this.resolve_=L,this.reject_=R,this.start_()})}start_(){const e=(r,i)=>{if(i){r(!1,new Fm(!1,null,!0));return}const a=this.connectionFactory_();this.pendingConnection_=a;const o=l=>{const c=l.loaded,d=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,d)};this.progressCallback_!==null&&a.addUploadProgressListener(o),a.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&a.removeUploadProgressListener(o),this.pendingConnection_=null;const l=a.getErrorCode()===Al.NO_ERROR,c=a.getStatus();if(!l||EM(c,this.additionalRetryCodes_)&&this.retry){const u=a.getErrorCode()===Al.ABORT;r(!1,new Fm(!1,null,u));return}const d=this.successCodes_.indexOf(c)!==-1;r(!0,new Fm(d,a))})},s=(r,i)=>{const a=this.resolve_,o=this.reject_,l=i.connection;if(i.wasSuccessCode)try{const c=this.callback_(l,l.getResponse());jM(c)?a(c):a()}catch(c){o(c)}else if(l!==null){const c=R0();c.serverResponse=l.getErrorText(),this.errorCallback_?o(this.errorCallback_(l,c)):o(c)}else if(i.canceled){const c=this.appDelete_?i1():hM();o(c)}else{const c=uM();o(c)}};this.canceled_?s(!1,new Fm(!1,null,!0)):this.backoffId_=vM(e,s,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&NM(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Fm{constructor(e,s,r){this.wasSuccessCode=e,this.connection=s,this.canceled=!!r}}function IM(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function TM(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function AM(n,e){e&&(n["X-Firebase-GMPID"]=e)}function _M(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function RM(n,e,s,r,i,a,o=!0,l=!1){const c=a1(n.urlParams),d=n.url+c,u=Object.assign({},n.headers);return AM(u,e),IM(u,s),TM(u,a),_M(u,r),new CM(d,n.method,u,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,i,o,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DM(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function PM(...n){const e=DM();if(e!==void 0){const s=new e;for(let r=0;r<n.length;r++)s.append(n[r]);return s.getBlob()}else{if(P0())return new Blob(n);throw new mn(hn.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function kM(n,e,s){return n.webkitSlice?n.webkitSlice(e,s):n.mozSlice?n.mozSlice(e,s):n.slice?n.slice(e,s):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LM(n){if(typeof atob>"u")throw yM("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hi={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Zg{constructor(e,s){this.data=e,this.contentType=s||null}}function FM(n,e){switch(n){case Hi.RAW:return new Zg(o1(e));case Hi.BASE64:case Hi.BASE64URL:return new Zg(l1(n,e));case Hi.DATA_URL:return new Zg(MM(e),UM(e))}throw R0()}function o1(n){const e=[];for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(s<n.length-1&&(n.charCodeAt(s+1)&64512)===56320))e.push(239,191,189);else{const a=r,o=n.charCodeAt(++s);r=65536|(a&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function OM(n){let e;try{e=decodeURIComponent(n)}catch{throw Fu(Hi.DATA_URL,"Malformed data URL.")}return o1(e)}function l1(n,e){switch(n){case Hi.BASE64:{const i=e.indexOf("-")!==-1,a=e.indexOf("_")!==-1;if(i||a)throw Fu(n,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case Hi.BASE64URL:{const i=e.indexOf("+")!==-1,a=e.indexOf("/")!==-1;if(i||a)throw Fu(n,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let s;try{s=LM(e)}catch(i){throw i.message.includes("polyfill")?i:Fu(n,"Invalid character found")}const r=new Uint8Array(s.length);for(let i=0;i<s.length;i++)r[i]=s.charCodeAt(i);return r}class c1{constructor(e){this.base64=!1,this.contentType=null;const s=e.match(/^data:([^,]+)?,/);if(s===null)throw Fu(Hi.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=s[1]||null;r!=null&&(this.base64=$M(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function MM(n){const e=new c1(n);return e.base64?l1(Hi.BASE64,e.rest):OM(e.rest)}function UM(n){return new c1(n).contentType}function $M(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class no{constructor(e,s){let r=0,i="";Sj(e)?(this.data_=e,r=e.size,i=e.type):e instanceof ArrayBuffer?(s?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(s?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,s){if(Sj(this.data_)){const r=this.data_,i=kM(r,e,s);return i===null?null:new no(i)}else{const r=new Uint8Array(this.data_.buffer,e,s-e);return new no(r,!0)}}static getBlob(...e){if(P0()){const s=e.map(r=>r instanceof no?r.data_:r);return new no(PM.apply(null,s))}else{const s=e.map(o=>D0(o)?FM(Hi.RAW,o).data:o.data_);let r=0;s.forEach(o=>{r+=o.byteLength});const i=new Uint8Array(r);let a=0;return s.forEach(o=>{for(let l=0;l<o.length;l++)i[a++]=o[l]}),new no(i,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d1(n){let e;try{e=JSON.parse(n)}catch{return null}return SM(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zM(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function VM(n,e){const s=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?s:n+"/"+s}function u1(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BM(n,e){return e}class xr{constructor(e,s,r,i){this.server=e,this.local=s||e,this.writable=!!r,this.xform=i||BM}}let Om=null;function GM(n){return!D0(n)||n.length<2?n:u1(n)}function h1(){if(Om)return Om;const n=[];n.push(new xr("bucket")),n.push(new xr("generation")),n.push(new xr("metageneration")),n.push(new xr("name","fullPath",!0));function e(a,o){return GM(o)}const s=new xr("name");s.xform=e,n.push(s);function r(a,o){return o!==void 0?Number(o):o}const i=new xr("size");return i.xform=r,n.push(i),n.push(new xr("timeCreated")),n.push(new xr("updated")),n.push(new xr("md5Hash",null,!0)),n.push(new xr("cacheControl",null,!0)),n.push(new xr("contentDisposition",null,!0)),n.push(new xr("contentEncoding",null,!0)),n.push(new xr("contentLanguage",null,!0)),n.push(new xr("contentType",null,!0)),n.push(new xr("metadata","customMetadata",!0)),Om=n,Om}function WM(n,e){function s(){const r=n.bucket,i=n.fullPath,a=new Wr(r,i);return e._makeStorageReference(a)}Object.defineProperty(n,"ref",{get:s})}function qM(n,e,s){const r={};r.type="file";const i=s.length;for(let a=0;a<i;a++){const o=s[a];r[o.local]=o.xform(r,e[o.server])}return WM(r,n),r}function m1(n,e,s){const r=d1(e);return r===null?null:qM(n,r,s)}function HM(n,e,s,r){const i=d1(e);if(i===null||!D0(i.downloadTokens))return null;const a=i.downloadTokens;if(a.length===0)return null;const o=encodeURIComponent;return a.split(",").map(d=>{const u=n.bucket,f=n.fullPath,p="/b/"+o(u)+"/o/"+o(f),j=qf(p,s,r),L=a1({alt:"media",token:d});return j+L})[0]}function QM(n,e){const s={},r=e.length;for(let i=0;i<r;i++){const a=e[i];a.writable&&(s[a.server]=n[a.local])}return JSON.stringify(s)}class k0{constructor(e,s,r,i){this.url=e,this.method=s,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p1(n){if(!n)throw R0()}function KM(n,e){function s(r,i){const a=m1(n,i,e);return p1(a!==null),a}return s}function YM(n,e){function s(r,i){const a=m1(n,i,e);return p1(a!==null),HM(a,i,n.host,n._protocol)}return s}function f1(n){function e(s,r){let i;return s.getStatus()===401?s.getErrorText().includes("Firebase App Check token is invalid")?i=cM():i=lM():s.getStatus()===402?i=oM(n.bucket):s.getStatus()===403?i=dM(n.path):i=r,i.status=s.getStatus(),i.serverResponse=r.serverResponse,i}return e}function g1(n){const e=f1(n);function s(r,i){let a=e(r,i);return r.getStatus()===404&&(a=aM(n.path)),a.serverResponse=i.serverResponse,a}return s}function JM(n,e,s){const r=e.fullServerUrl(),i=qf(r,n.host,n._protocol),a="GET",o=n.maxOperationRetryTime,l=new k0(i,a,YM(n,s),o);return l.errorHandler=g1(e),l}function XM(n,e){const s=e.fullServerUrl(),r=qf(s,n.host,n._protocol),i="DELETE",a=n.maxOperationRetryTime;function o(c,d){}const l=new k0(r,i,o,a);return l.successCodes=[200,204],l.errorHandler=g1(e),l}function ZM(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function e4(n,e,s){const r=Object.assign({},s);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=ZM(null,e)),r}function t4(n,e,s,r,i){const a=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function l(){let x="";for(let S=0;S<2;S++)x=x+Math.random().toString().slice(2);return x}const c=l();o["Content-Type"]="multipart/related; boundary="+c;const d=e4(e,r,i),u=QM(d,s),f="--"+c+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+u+`\r
--`+c+`\r
Content-Type: `+d.contentType+`\r
\r
`,p=`\r
--`+c+"--",j=no.getBlob(f,r,p);if(j===null)throw gM();const L={name:d.fullPath},R=qf(a,n.host,n._protocol),D="POST",y=n.maxUploadRetryTime,T=new k0(R,D,KM(n,s),y);return T.urlParams=L,T.headers=o,T.body=j.uploadData(),T.errorHandler=f1(e),T}class s4{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Al.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Al.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Al.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,s,r,i,a){if(this.sent_)throw lu("cannot .send() more than once");if(Mo(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(s,e,!0),a!==void 0)for(const o in a)a.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,a[o].toString());return i!==void 0?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw lu("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw lu("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw lu("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw lu("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class n4 extends s4{initXhr(){this.xhr_.responseType="text"}}function L0(){return new n4}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ql{constructor(e,s){this._service=e,s instanceof Wr?this._location=s:this._location=Wr.makeFromUrl(s,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,s){return new ql(e,s)}get root(){const e=new Wr(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return u1(this._location.path)}get storage(){return this._service}get parent(){const e=zM(this._location.path);if(e===null)return null;const s=new Wr(this._location.bucket,e);return new ql(this._service,s)}_throwIfRoot(e){if(this._location.path==="")throw bM(e)}}function r4(n,e,s){n._throwIfRoot("uploadBytes");const r=t4(n.storage,n._location,h1(),new no(e,!0),s);return n.storage.makeRequestWithTokens(r,L0).then(i=>({metadata:i,ref:n}))}function i4(n){n._throwIfRoot("getDownloadURL");const e=JM(n.storage,n._location,h1());return n.storage.makeRequestWithTokens(e,L0).then(s=>{if(s===null)throw xM();return s})}function a4(n){n._throwIfRoot("deleteObject");const e=XM(n.storage,n._location);return n.storage.makeRequestWithTokens(e,L0)}function o4(n,e){const s=VM(n._location.path,e),r=new Wr(n._location.bucket,s);return new ql(n.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l4(n){return/^[A-Za-z]+:\/\//.test(n)}function c4(n,e){return new ql(n,e)}function x1(n,e){if(n instanceof F0){const s=n;if(s._bucket==null)throw fM();const r=new ql(s,s._bucket);return e!=null?x1(r,e):r}else return e!==void 0?o4(n,e):n}function d4(n,e){if(e&&l4(e)){if(n instanceof F0)return c4(n,e);throw Ry("To use ref(service, url), the first argument must be a Storage instance.")}else return x1(n,e)}function Cj(n,e){const s=e==null?void 0:e[r1];return s==null?null:Wr.makeFromBucketSpec(s,n)}function u4(n,e,s,r={}){n.host=`${e}:${s}`;const i=Mo(e);i&&(Db(`https://${n.host}/b`),Pb("Storage",!0)),n._isUsingEmulator=!0,n._protocol=i?"https":"http";const{mockUserToken:a}=r;a&&(n._overrideAuthToken=typeof a=="string"?a:PC(a,n.app.options.projectId))}class F0{constructor(e,s,r,i,a,o=!1){this.app=e,this._authProvider=s,this._appCheckProvider=r,this._url=i,this._firebaseVersion=a,this._isUsingEmulator=o,this._bucket=null,this._host=n1,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=rM,this._maxUploadRetryTime=iM,this._requests=new Set,i!=null?this._bucket=Wr.makeFromBucketSpec(i,this._host):this._bucket=Cj(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Wr.makeFromBucketSpec(this._url,e):this._bucket=Cj(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Ej("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Ej("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const s=await e.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){if(Tr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ql(this,e)}_makeRequest(e,s,r,i,a=!0){if(this._deleted)return new wM(i1());{const o=RM(e,this._appId,r,i,s,this._firebaseVersion,a,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,s){const[r,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,s,r,i).getPromise()}}const Ij="@firebase/storage",Tj="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y1="storage";function Uc(n,e,s){return n=Fs(n),r4(n,e,s)}function wl(n){return n=Fs(n),i4(n)}function xh(n){return n=Fs(n),a4(n)}function ii(n,e){return n=Fs(n),d4(n,e)}function h4(n=Fb(),e){n=Fs(n);const r=wf(n,y1).getImmediate({identifier:e}),i=_C("storage");return i&&m4(r,...i),r}function m4(n,e,s,r={}){u4(n,e,s,r)}function p4(n,{instanceIdentifier:e}){const s=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),i=n.getProvider("app-check-internal");return new F0(s,r,i,e,Jl)}function f4(){Ul(new Co(y1,p4,"PUBLIC").setMultipleInstances(!0)),Yi(Ij,Tj,""),Yi(Ij,Tj,"esm2020")}f4();let Dy;try{Dy={apiKey:"AIzaSyCF4OZxfGELDmooid5mAL51l0t7Cxx6W3k",authDomain:"tender-74a2b.firebaseapp.com",projectId:"tender-74a2b",storageBucket:"tender-74a2b.firebasestorage.app",messagingSenderId:"300993197682",appId:"1:300993197682:web:e75fab78c4d6afc91ff4eb",measurementId:"G-D2CYMMNSB8"}}catch(n){console.error("Error loading Firebase config:",n),Dy={}}let yl,ae,In,ut;try{tN().length?(yl=tN()[0],console.log("Using existing Firebase app instance")):(console.log("Initializing Firebase..."),yl=FC(Dy));try{ae=cT(yl),console.log(" Firestore initialized")}catch(n){console.error("Firestore initialization error:",n),ae=null}try{In=h4(yl),console.log(" Storage initialized")}catch(n){console.error("Storage initialization error:",n),In=null}try{ut=eM(yl),console.log(" Auth initialized")}catch(n){console.error("Auth initialization error:",n),ut=null}console.log(" Firebase initialization completed")}catch(n){console.error(" Critical Firebase initialization error:",n),yl=null,ae=null,In=null,ut=null}const Py=async()=>{try{return!ae||!In||!ut?(console.log("Firebase services not available"),!1):!0}catch(n){return console.error("Firebase connection test failed:",n),!1}};window.addEventListener("unhandledrejection",n=>{n.reason&&n.reason.message&&(n.reason.message.includes("_getRecaptchaConfig")||n.reason.message.includes("client is offline")||n.reason.message.includes("auth/network-request-failed"))&&(console.log(" Suppressed Firebase error:",n.reason.message),n.preventDefault())});console.log(" Firebase services status:",{app:!!yl,database:!!ae,storage:!!In,auth:!!ut});const _l=Object.freeze(Object.defineProperty({__proto__:null,get auth(){return ut},get db(){return ae},get storage(){return In},testFirebaseConnection:Py},Symbol.toStringTag,{value:"Module"}));function wc(n){if(!n)return null;if(n instanceof Date)return n;if(n&&typeof n.toDate=="function")return n.toDate();if(n&&typeof n=="object"&&n.seconds)return new Date(n.seconds*1e3);if(typeof n=="string"){const e=new Date(n);return isNaN(e.getTime())?null:e}return typeof n=="number"?new Date(n):(n&&typeof n=="object"&&!(n instanceof Date)&&console.warn("Unknown timestamp format:",n),null)}class O0{constructor(e){this.collectionName=e,this.collectionRef=Pe(ae,e),this.memoryCache=[]}async ensureAuth(){try{return ut.currentUser||(console.log(" [Firebase] No authenticated user, signing in anonymously..."),await BT(ut),console.log(" [Firebase] Anonymous authentication successful")),console.log(" [Firebase] User authenticated:",ut.currentUser.uid),!0}catch(e){return console.error(" [Firebase] Authentication failed:",e),!1}}async getCurrentUserId(){await this.ensureAuth();const e=ut.currentUser;if(!e)throw new Error("User not authenticated");return e.uid}async addOwnershipFields(e,s=!1){const i={ownerId:await this.getCurrentUserId(),updatedAt:We(),version:s?v0(1):1};return s||(i.createdAt=We()),{...e,...i}}async create(e,s={}){try{console.log(` Creating document in ${this.collectionName}:`,e);const r=await this.addOwnershipFields(e,!1),i={id:crypto.randomUUID(),...r,createdAt:new Date,updatedAt:new Date,version:1,_optimistic:!0};s.onOptimisticUpdate&&s.onOptimisticUpdate(i);try{const a=await As(this.collectionRef,r);console.log(` Document created in Firestore: ${a.id}`);const o=await this.getById(a.id);return s.updateCache&&this.updateCache(o),s.onSuccess&&s.onSuccess(o),o}catch(a){throw console.error(` Firestore create failed for ${this.collectionName}:`,a),s.onRollback&&s.onRollback(i),a}}catch(r){throw console.error("Error in create operation:",r),new Error(`   ${this.collectionName}: ${r.message}`)}}async update(e,s,r={}){try{console.log(` Updating document ${e} in ${this.collectionName}:`,s);const i=Le(ae,this.collectionName,e),a=await ss(i);if(!a.exists())throw new Error("Document not found");const o=a.data(),l=await this.addOwnershipFields(s,!0),c={id:e,...o,...s,updatedAt:new Date,version:(o.version||1)+1,_optimistic:!0};r.onOptimisticUpdate&&r.onOptimisticUpdate(c);try{await Qt(i,l),console.log(` Document updated in Firestore: ${e}`);const d=await this.getById(e);return r.updateCache&&this.updateCache(d),r.onSuccess&&r.onSuccess(d),d}catch(d){throw console.error(` Firestore update failed for ${this.collectionName}:`,d),r.onRollback&&r.onRollback(o),d}}catch(i){throw i.message==="Document not found"?console.log(` Document not found in ${this.collectionName} - will be handled by caller`):console.error("Error in update operation:",i),new Error(`   ${this.collectionName}: ${i.message}`)}}async delete(e,s={}){try{console.log(` Deleting document ${e} from ${this.collectionName}`);const r=Le(ae,this.collectionName,e),i=await ss(r);if(!i.exists())throw new Error("Document not found");const a=i.data();s.onOptimisticUpdate&&s.onOptimisticUpdate(null);try{return await es(r),console.log(` Document deleted from Firestore: ${e}`),s.updateCache&&this.removeFromCache(e),s.onSuccess&&s.onSuccess(),!0}catch(o){throw console.error(` Firestore delete failed for ${this.collectionName}:`,o),s.onRollback&&s.onRollback(a),o}}catch(r){throw console.error("Error in delete operation:",r),new Error(`   ${this.collectionName}: ${r.message}`)}}async getById(e,s={}){try{const r=Le(ae,this.collectionName,e),i=await ss(r);if(i.exists()){const a=i.data();return{id:i.id,...a,createdAt:wc(a.createdAt),updatedAt:wc(a.updatedAt)}}else return null}catch(r){throw console.error("Error fetching document by ID:",r),new Error(`   ${this.collectionName}: ${r.message}`)}}async getAll(e={}){try{let s=st(this.collectionRef),r=!1;if(e.where&&Array.isArray(e.where)){for(const o of e.where)if(Array.isArray(o)&&o.length===3){const[l,c,d]=o;s=st(s,xt(l,c,d))}}if(e.orderBy&&Array.isArray(e.orderBy)){for(const o of e.orderBy)if(Array.isArray(o)&&o.length===2){const[l,c]=o;s=st(s,as(l,c))}}e.limit&&(s=st(s,cd(e.limit)));let i;try{i=await qe(s)}catch(o){if(o.message&&o.message.includes("index")){if(console.log(" Firebase index missing, falling back to client-side sorting"),r=!0,s=st(this.collectionRef),e.where&&Array.isArray(e.where)){for(const l of e.where)if(Array.isArray(l)&&l.length===3){const[c,d,u]=l;s=st(s,xt(c,d,u))}}i=await qe(s)}else throw o}let a=i.docs.map(o=>{const l=o.data();return{id:o.id,...l,createdAt:wc(l.createdAt),updatedAt:wc(l.updatedAt)}});if(r&&e.orderBy&&Array.isArray(e.orderBy)){for(const o of e.orderBy)if(Array.isArray(o)&&o.length===2){const[l,c]=o;a.sort((d,u)=>{let f=d[l],p=u[l];return f instanceof Date&&p instanceof Date&&(f=f.getTime(),p=p.getTime()),c==="desc"?p>f?1:p<f?-1:0:f>p?1:f<p?-1:0})}}return e.limit&&r&&(a=a.slice(0,e.limit)),console.log(` Retrieved ${a.length} documents from ${this.collectionName}`),e.updateCache&&this.setCacheAll(a),a}catch(s){throw console.error("Error fetching all documents:",s),new Error(`   ${this.collectionName}: ${s.message}`)}}async search(e,s=[],r={}){try{const i=await this.getCurrentUserId(),a=st(this.collectionRef,xt("ownerId","==",i)),c=(await qe(a)).docs.map(d=>{const u=d.data();return{id:d.id,...u,createdAt:wc(u.createdAt),updatedAt:wc(u.updatedAt)}}).filter(d=>s.some(u=>{const f=d[u];return typeof f=="string"?f.toLowerCase().includes(e.toLowerCase()):!1}));return console.log(` Found ${c.length} matching documents in ${this.collectionName}`),c}catch(i){throw console.error("Error searching documents:",i),new Error(`    ${this.collectionName}: ${i.message}`)}}async batchOperation(e){try{const s=Fr(ae),r=await this.getCurrentUserId();for(const i of e){const{type:a,id:o,data:l}=i;if(a==="create"){const c=Le(this.collectionRef),d=await this.addOwnershipFields(l,!1);s.set(c,d)}else if(a==="update"){const c=Le(ae,this.collectionName,o),d=await ss(c);if(d.exists()&&d.data().ownerId!==r)throw new Error(`Unauthorized to update document ${o}`);const u=await this.addOwnershipFields(l,!0);s.update(c,u)}else if(a==="delete"){const c=Le(ae,this.collectionName,o),d=await ss(c);if(d.exists()&&d.data().ownerId!==r)throw new Error(`Unauthorized to delete document ${o}`);s.delete(c)}}return await s.commit(),console.log(` Batch operation completed for ${this.collectionName}`),!0}catch(s){throw console.error("Error in batch operation:",s),new Error(`     ${this.collectionName}: ${s.message}`)}}getCacheKey(){return`firestore_cache_${this.collectionName}`}updateCache(e){try{const s=this.getCacheKey(),r=this.memoryCache||[],i=r.findIndex(a=>a.id===e.id);i>=0?r[i]={...e,_cached:!0,_cachedAt:Date.now(),_checksum:this.generateChecksum(e)}:r.push({...e,_cached:!0,_cachedAt:Date.now(),_checksum:this.generateChecksum(e)}),this.memoryCache=r}catch(s){console.warn("Cache update failed:",s)}}setCacheAll(e){try{const s=this.getCacheKey(),r=e.map(i=>({...i,_cached:!0,_cachedAt:Date.now(),_checksum:this.generateChecksum(i)}));this.memoryCache=r}catch(s){console.warn("Cache set all failed:",s)}}removeFromCache(e){try{const s=this.getCacheKey(),i=(this.memoryCache||[]).filter(a=>a.id!==e);this.memoryCache=i}catch(s){console.warn("Cache remove failed:",s)}}getFromCache(){try{return this.memoryCache||[]}catch(e){return console.warn("Cache read failed:",e),[]}}generateChecksum(e){const s=JSON.stringify(e);let r=0;for(let i=0;i<s.length;i++){const a=s.charCodeAt(i);r=(r<<5)-r+a,r=r&r}return r.toString()}validateCacheIntegrity(e,s){const r=e._checksum,i=this.generateChecksum(s);return r===i}}class g4 extends O0{constructor(){super("usersettings"),this.currentUserId=null,this.settings={},this.listeners=new Set}async initialize(){try{return ut.currentUser?ut.currentUser.uid==="demo-user"?(console.log(" UserSettingsService: Demo user detected - skipping initialization"),{}):(this.currentUserId=ut.currentUser.uid,await this.loadSettings(),this.settings):(console.log(" UserSettingsService: No authenticated user - skipping initialization"),{})}catch(e){return console.error("Error initializing user settings:",e),{}}}async loadSettings(){try{if(!this.currentUserId)throw new Error("User not initialized");const e=await this.getById(this.currentUserId);return e?this.settings=e.settings||{}:await this.createDefaultSettings(),this.notifyListeners(),this.settings}catch(e){return console.error("Error loading settings:",e),{}}}async createDefaultSettings(){try{const e={activityTimelineVisible:!1,sidebarCollapsed:!1,theme:"light",language:"ar",tablePageSize:10,defaultOrderBy:"createdAt",defaultSortDirection:"desc",showNotifications:!0,notificationSound:!0,autoSaveForms:!0,confirmBeforeDelete:!0,showHelpTips:!0,compactMode:!1},s={userId:this.currentUserId,settings:e,version:1};return await this.create(s),this.settings=e,e}catch(e){return console.error("Error creating default settings:",e),{}}}getSetting(e,s=null){return this.settings[e]!==void 0?this.settings[e]:s}async setSetting(e,s){try{this.currentUserId||await this.initialize(),this.settings[e]=s,this.notifyListeners();const r={...this.settings,[e]:s};try{await this.update(this.currentUserId,{settings:r,lastUpdated:new Date})}catch(i){if(i.message.includes("Document not found"))console.log(" Creating new user settings document for:",this.currentUserId),await this.create({id:this.currentUserId,ownerId:this.currentUserId,settings:r,createdAt:new Date,lastUpdated:new Date}),console.log(" User settings document created successfully");else throw i}return console.log(` Setting updated: ${e} = ${s}`),!0}catch(r){return console.error(`Error setting ${e}:`,r),delete this.settings[e],this.notifyListeners(),!1}}async setSettings(e){try{this.currentUserId||await this.initialize();const s={...this.settings};Object.assign(this.settings,e),this.notifyListeners();const r={...this.settings,...e};return await this.update(this.currentUserId,{settings:r,lastUpdated:new Date}),console.log(" Multiple settings updated:",Object.keys(e)),!0}catch(s){return console.error("Error setting multiple settings:",s),this.settings=oldSettings,this.notifyListeners(),!1}}async removeSetting(e){try{const s={...this.settings};return this.settings[e]!==void 0?(delete this.settings[e],this.notifyListeners(),await this.update(this.currentUserId,{settings:this.settings,lastUpdated:new Date}),console.log(` Setting removed: ${e}`),!0):(console.log(` Setting not found: ${e}`),!0)}catch(s){return console.error(`Error removing setting ${e}:`,s),this.settings=oldSettings,this.notifyListeners(),!1}}async resetSettings(){try{return await this.createDefaultSettings(),await this.update(this.currentUserId,{settings:this.settings,lastUpdated:new Date}),console.log(" Settings reset to defaults"),!0}catch(e){return console.error("Error resetting settings:",e),!1}}addListener(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(){this.listeners.forEach(e=>{try{e(this.settings)}catch(s){console.error("Error in settings listener:",s)}})}exportSettings(){return{userId:this.currentUserId,settings:this.settings,exportedAt:new Date().toISOString()}}async importSettings(e){try{return e.settings?(await this.setSettings(e.settings),console.log(" Settings imported successfully"),!0):!1}catch(s){return console.error("Error importing settings:",s),!1}}async setActivityTimelineVisible(e){return await this.setSetting("activityTimelineVisible",e)}getActivityTimelineVisible(){return this.getSetting("activityTimelineVisible",!1)}async setSidebarCollapsed(e){return await this.setSetting("sidebarCollapsed",e)}getSidebarCollapsed(){return this.getSetting("sidebarCollapsed",!1)}async setTheme(e){return await this.setSetting("theme",e)}getTheme(){return this.getSetting("theme","light")}async setTablePageSize(e){return await this.setSetting("tablePageSize",e)}getTablePageSize(){return this.getSetting("tablePageSize",10)}}const Dr=new g4;ut.onAuthStateChanged(async n=>{if(n)try{await Dr.initialize(),console.log(" User settings initialized")}catch(e){console.error("Error initializing user settings:",e)}else Dr.currentUserId=null,Dr.settings={}});const b1=h.createContext(),Ut=()=>{const n=h.useContext(b1);if(!n)throw new Error("useActivityTimeline must be used within an ActivityTimelineProvider");return n},x4=({children:n})=>{const[e,s]=h.useState(!1),[r,i]=h.useState(!0);h.useEffect(()=>{(async()=>{try{if(!ut.currentUser||ut.currentUser.uid==="demo-user"){console.log(" No authenticated user or demo user - using default timeline state"),s(!1),i(!1);return}await Dr.initialize();const c=Dr.getActivityTimelineVisible();s(c),console.log(" Activity timeline visibility loaded from Firestore:",c)}catch(c){console.warn(" Firestore initialization failed, using default state:",c.message),s(!1),console.log(" Using default timeline state: false")}finally{i(!1),console.log(" Timeline initialization completed")}})()},[]),h.useEffect(()=>{const c=setTimeout(async()=>{if(!r)try{await Dr.setActivityTimelineVisible(e),console.log(" Activity timeline visibility saved to Firestore:",e)}catch(d){console.warn(" Failed to save timeline state to Firestore (non-critical):",d.message)}},500);return()=>clearTimeout(c)},[e,r]);const o={isTimelineVisible:e,setIsTimelineVisible:s,toggleTimeline:async()=>{const l=!e;s(l);try{await Dr.setActivityTimelineVisible(l),console.log(" Timeline toggle saved to Firestore:",l)}catch(c){console.warn(" Failed to save timeline toggle to Firestore (non-critical):",c.message)}},loading:r};return t.jsx(b1.Provider,{value:o,children:n})},ex={RAW_MATERIAL:"rm",LOCAL_PRODUCT:"lp",FOREIGN_PRODUCT:"fp",MANUFACTURED_PRODUCT:"mp",SERVICE:"srv",TENDER:"tdr",CUSTOMER:"cst",LOCAL_SUPPLIER:"ls",FOREIGN_SUPPLIER:"fs",COMPANY:"comp",COMPETITOR:"cmpt",EMPLOYEE:"emp",CURRICULUM:"cur",PRICE_QUOTE:"pq",TENDER_ITEM:"ti",ORDER:"ord",INVOICE:"inv",JOURNAL:"jrn",ACCOUNT:"acc",JOURNAL_DOC:"jdoc",DOCUMENT:"doc",TENDER_DOC:"tdoc",PRODUCT_DOC:"pdoc",ACTIVITY:"act",TRASH_ITEM:"trs",TIMER:"tmr"},Ct=(n,e=null)=>{if(!ex[n])throw new Error(`Invalid entity type: ${n}. Valid types: ${Object.keys(ex).join(", ")}`);const s=ex[n],r=Date.now().toString(36),i=Math.random().toString(36).substring(2,8);return e?`${s}_${e}_${r}${i}`:`${s}_${r}${i}`},Ya=class Ya extends O0{constructor(){super("activitylogs"),this.currentUserId=null,this.activities=[],this.listeners=new Set,this.maxActivities=50,this.cleanupInProgress=!1,this.lastCleanupTime=0,this.lastLogTime=0,this.lastLogContent="",this.globalUnsubscribe=null,this.isGlobalListenerActive=!1}async initialize(){try{if(!ut.currentUser)throw new Error("User not authenticated");return this.currentUserId=ut.currentUser.uid,console.log(" GLOBAL ACTIVITY: Initializing global real-time activity sync for user:",this.currentUserId),await this.loadActivities(),this.setupGlobalRealTimeListener(),this.activities}catch(e){return console.error("Error initializing activity log:",e),[]}}setupGlobalRealTimeListener(){if(this.isGlobalListenerActive){console.log(" GLOBAL ACTIVITY: Real-time listener already active");return}try{const e=Pe(ae,"activitylogs"),s=st(e,as("createdAt","desc"),cd(this.maxActivities));console.log(" GLOBAL ACTIVITY: Setting up real-time listener for ALL users..."),this.globalUnsubscribe=ar(s,r=>{console.log(" GLOBAL ACTIVITY: Real-time update received, activities count:",r.docs.length);const i=[];r.forEach(a=>{var c,d,u;const o=a.data(),l={id:a.id,...o,createdAt:((c=o.createdAt)==null?void 0:c.toDate())||new Date(o.timestamp||Date.now()),timestamp:((d=o.createdAt)==null?void 0:d.toDate())||new Date(o.timestamp||Date.now()),updatedAt:((u=o.updatedAt)==null?void 0:u.toDate())||new Date};i.push(l)}),i.sort((a,o)=>new Date(o.timestamp)-new Date(a.timestamp)),this.activities=i,console.log(" GLOBAL ACTIVITY: Updated activities, notifying",this.listeners.size,"listeners"),this.notifyListeners()},r=>{console.error(" GLOBAL ACTIVITY: Real-time listener error:",r)}),this.isGlobalListenerActive=!0,console.log(" GLOBAL ACTIVITY: Global real-time listener activated")}catch(e){console.error(" Error setting up global real-time listener:",e)}}async loadActivities(){try{if(!this.currentUserId)throw new Error("User not initialized");console.log(" GLOBAL ACTIVITY: Loading all activities from ALL users...");const e=Pe(ae,"activitylogs"),s=st(e,as("createdAt","desc"),cd(this.maxActivities)),r=await qe(s),i=[];return r.forEach(a=>{var c,d,u;const o=a.data(),l={id:a.id,...o,createdAt:((c=o.createdAt)==null?void 0:c.toDate())||new Date(o.timestamp||Date.now()),timestamp:((d=o.createdAt)==null?void 0:d.toDate())||new Date(o.timestamp||Date.now()),updatedAt:((u=o.updatedAt)==null?void 0:u.toDate())||new Date};i.push(l)}),i.sort((a,o)=>new Date(o.timestamp)-new Date(a.timestamp)),this.activities=i,this.notifyListeners(),console.log(` GLOBAL ACTIVITY: Loaded ${this.activities.length} activities from ALL users`),this.activities}catch(e){return console.error(" Error loading global activities:",e),[]}}async logActivity(e,s,r={}){try{const i=Date.now(),a=`${e}-${s}`;if(i-this.lastLogTime<5e3&&this.lastLogContent===a)return console.log(` ACTIVITY: Rate limited duplicate - ${s}`),null;if(i-this.lastLogTime<1e3)return console.log(" ACTIVITY: Rate limited - too rapid"),null;this.lastLogTime=i,this.lastLogContent=a,this.currentUserId||await this.initialize();const o={internalId:Ct("ACTIVITY"),type:e,description:s,details:r,timestamp:new Date,userId:this.currentUserId,userAgent:navigator.userAgent,url:window.location.pathname,createdAt:We(),updatedAt:We()};console.log(" GLOBAL ACTIVITY: Logging activity for user:",this.currentUserId,"- Activity:",s),this.activities.unshift(o),this.notifyListeners();try{const l=Pe(ae,"activitylogs"),c=await As(l,o);console.log(" GLOBAL ACTIVITY: Saved to Firestore with ID:",c.id);const d={...o,id:c.id},u=this.activities.findIndex(f=>f.internalId===o.internalId);if(u>=0&&(this.activities[u]=d,this.notifyListeners()),this.activities.length>this.maxActivities&&!this.cleanupInProgress){const p=Date.now()-this.lastCleanupTime;p>1e4?await this.cleanupOldActivities():console.log(` CLEANUP: Rate limited, last cleanup was ${Math.floor(p/1e3)}s ago`)}return console.log(` Activity logged: ${e} - ${s}`),d}catch(l){throw console.error("Error saving activity to Firestore:",l),this.activities=this.activities.filter(c=>c.internalId!==o.internalId),this.notifyListeners(),l}}catch(i){return console.error("Error logging activity:",i),null}}getActivitiesByType(e){return this.activities.filter(s=>s.type===e)}getActivitiesByDateRange(e,s){return this.activities.filter(r=>{const i=new Date(r.timestamp);return i>=e&&i<=s})}getRecentActivities(e=50){return this.activities.slice(0,e)}searchActivities(e){const s=e.toLowerCase();return this.activities.filter(r=>r.description.toLowerCase().includes(s)||r.type.toLowerCase().includes(s)||r.details&&JSON.stringify(r.details).toLowerCase().includes(s))}async deleteActivity(e){try{return!e||e==="undefined"?(console.warn(" DELETE: Invalid activity ID provided:",e),!1):(await this.delete(e),this.activities=this.activities.filter(s=>s.id!==e&&s._id!==e&&s.docId!==e&&s.internalId!==e),this.notifyListeners(),console.log(` Activity deleted: ${e}`),!0)}catch(s){return console.error("Error deleting activity:",s),!1}}async clearAllActivities(){try{console.log(` CLEAR ALL: Will delete ${this.activities.length} activities`);const e=this.activities.filter(s=>s.id||s._id||s.docId?!0:(console.warn(" CLEAR: Activity has no valid document ID, skipping:",{internalId:s.internalId,description:s.description}),!1)).map(s=>{const r=s.id||s._id||s.docId;return this.delete(r).catch(i=>(console.error(` Error deleting activity ${r}:`,i),null))});return e.length>0?(await Promise.allSettled(e),console.log(` Deleted ${e.length} activities from Firestore`)):console.log(" No activities with valid IDs to delete"),this.activities=[],this.notifyListeners(),console.log(" All activities cleared locally"),!0}catch(e){return console.error("Error clearing activities:",e),!1}}async cleanupOldActivities(){if(this.cleanupInProgress){console.log(" CLEANUP: Already in progress, skipping");return}try{if(this.cleanupInProgress=!0,this.lastCleanupTime=Date.now(),this.activities.length<=this.maxActivities){console.log(" CLEANUP: Activity count within limit, no cleanup needed");return}console.log(` CLEANUP: Starting cleanup (${this.activities.length} activities, limit: ${this.maxActivities})`);const e=[...this.activities].sort((o,l)=>new Date(l.timestamp)-new Date(o.timestamp)),s=e.slice(0,this.maxActivities),r=e.slice(this.maxActivities);console.log(` CLEANUP: Will delete ${r.length} old activities`);const i=r.filter(o=>{var c;return o.id||o._id||o.docId?!0:(console.warn(" CLEANUP: Activity has no valid document ID, skipping:",{internalId:o.internalId,description:(c=o.description)==null?void 0:c.substring(0,50)}),!1)});if(i.length===0){console.log(" CLEANUP: No activities with valid IDs to delete"),this.activities=s,this.notifyListeners();return}const a=5;for(let o=0;o<i.length;o+=a){const c=i.slice(o,o+a).map(d=>{const u=d.id||d._id||d.docId;return this.delete(u).catch(f=>(console.error(` Error deleting old activity ${u}:`,f),null))});await Promise.allSettled(c),console.log(` Processed batch ${Math.floor(o/a)+1}/${Math.ceil(i.length/a)}`),o+a<i.length&&await new Promise(d=>setTimeout(d,500))}this.activities=s,this.notifyListeners(),console.log(` CLEANUP: Completed, kept ${s.length} activities`)}catch(e){console.error(" Error in cleanup old activities:",e)}finally{this.cleanupInProgress=!1}}addListener(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(){this.listeners.forEach(e=>{try{e(this.activities)}catch(s){console.error("Error in activity listener:",s)}})}cleanup(){this.globalUnsubscribe&&(console.log(" GLOBAL ACTIVITY: Cleaning up global real-time listener"),this.globalUnsubscribe(),this.globalUnsubscribe=null,this.isGlobalListenerActive=!1),this.listeners.clear(),console.log(" GLOBAL ACTIVITY: Cleanup completed")}getActivityStats(){const e={total:this.activities.length,byType:{},byDate:{},recentActivity:null};this.activities.forEach(r=>{e.byType[r.type]=(e.byType[r.type]||0)+1});const s=new Date(Date.now()-30*24*60*60*1e3);return this.activities.forEach(r=>{const i=new Date(r.timestamp);if(i>=s){const a=i.toDateString();e.byDate[a]=(e.byDate[a]||0)+1}}),this.activities.length>0&&(e.recentActivity=this.activities[0]),e}exportActivities(){return{userId:this.currentUserId,activities:this.activities,exportedAt:new Date().toISOString(),count:this.activities.length}}async logTenderCreate(e,s){return await this.logActivity(Ya.ActivityTypes.TENDER_CREATE,`  : ${e}`,{tenderInternalId:s,tenderEntity:e})}async logTenderUpdate(e,s){return await this.logActivity(Ya.ActivityTypes.TENDER_UPDATE,`  : ${e}`,{tenderInternalId:s,tenderEntity:e})}async logItemAdd(e,s,r=null){const i=window.location.pathname,a=this.detectItemContext(i,s,r),o=this.generateItemAddDescription(e,a);return await this.logActivity(Ya.ActivityTypes.ITEM_ADD,o,{itemName:e,contextTitle:a.title,contextType:a.type,detectedFrom:a.detectedFrom,originalContextTitle:s})}detectItemContext(e,s,r=null){if(r)return{type:r,title:s,detectedFrom:"explicit"};if(e.includes("/manufactured-products/")||e.includes("/manufactured-products/add")||e.includes("manufacture"))return{type:"manufactured_product",title:s||" ",detectedFrom:"url_pattern"};if(e.includes("/tenders/")||e.includes("/tenders/add")||e.includes("tender"))return{type:"tender",title:s||" ",detectedFrom:"url_pattern"};const i=(s||"").toLowerCase();return i.includes(" ")||i.includes("manufactured")||i.includes("manufacture")?{type:"manufactured_product",title:s,detectedFrom:"title_analysis"}:i.includes("")||i.includes("tender")?{type:"tender",title:s,detectedFrom:"title_analysis"}:{type:"tender",title:s||" ",detectedFrom:"default_assumption"}}generateItemAddDescription(e,s){switch(s.type){case"manufactured_product":return` : ${e}  ${s.title}`;case"tender":return` : ${e}  ${s.title}`;default:return`  : ${e}  ${s.title}`}}async logDocumentUpload(e,s){return await this.logActivity(Ya.ActivityTypes.DOCUMENT_UPLOAD,`  : ${e} : ${s}`,{fileName:e,tenderEntity:s})}async logUserLogin(){return await this.logActivity(Ya.ActivityTypes.USER_LOGIN,"  ",{loginTime:new Date().toISOString()})}};Ys(Ya,"ActivityTypes",{TENDER_CREATE:"tender_create",TENDER_UPDATE:"tender_update",TENDER_DELETE:"tender_delete",TENDER_SUBMIT:"tender_submit",ITEM_ADD:"item_add",ITEM_UPDATE:"item_update",ITEM_DELETE:"item_delete",DOCUMENT_UPLOAD:"document_upload",DOCUMENT_DELETE:"document_delete",MATERIAL_CREATE:"material_create",MATERIAL_UPDATE:"material_update",MATERIAL_DELETE:"material_delete",SUPPLIER_CREATE:"supplier_create",SUPPLIER_UPDATE:"supplier_update",USER_LOGIN:"user_login",USER_LOGOUT:"user_logout",SETTINGS_UPDATE:"settings_update",DATA_IMPORT:"data_import",DATA_EXPORT:"data_export"});let ky=Ya;const ws=new ky;typeof window<"u"&&(window.activityLogService=ws,console.log(" ActivityLogService added to window global object"));ut.onAuthStateChanged(async n=>{if(n)try{await ws.initialize(),console.log(" GLOBAL ACTIVITY: Activity logging initialized")}catch(e){console.error("Error initializing activity logging:",e)}else ws.currentUserId=null,ws.activities=[],ws.cleanup&&ws.cleanup()});class y4{constructor(){this.sessionListeners=new Map,this.currentUser=null,this.sessionVersion=null,this.periodicCheckInterval=null}async initializeSession(e){try{console.log(" Initializing session monitoring for user:",e.uid),this.currentUser=e;const s=Le(ae,"employees",e.uid),r=await ss(s);if(!r.exists()){console.warn(" No employee record found for session initialization");return}const i=r.data();this.sessionVersion=i.sessionVersion||1,i.sessionVersion||await this.createNewSession(e.uid),this.startSessionMonitoring(e.uid),this.startPeriodicValidation(),console.log(" Session monitoring initialized with version:",this.sessionVersion)}catch(s){console.error(" Error initializing session:",s)}}async createNewSession(e){try{console.log(" Creating new session for user:",e);const s=Date.now(),r=Le(ae,"employees",e);return await Qt(r,{sessionVersion:s,lastSessionUpdate:We(),updatedAt:We()}),this.sessionVersion=s,console.log(" New session created with version:",s),s}catch(s){throw console.error(" Error creating new session:",s),s}}async invalidateAllSessions(e){try{console.log(" Invalidating all sessions for user:",e);const s=await this.createNewSession(e);return console.log(" All sessions invalidated. New version:",s),s}catch(s){throw console.error(" Error invalidating sessions:",s),s}}startSessionMonitoring(e){try{console.log(" Starting session monitoring for user:",e),this.stopSessionMonitoring(e);const s=Le(ae,"employees",e),r=ar(s,i=>{var l,c;if(console.log(" Session monitoring snapshot received for user:",e),!i.exists()){console.warn(" Employee document no longer exists - forcing logout"),this.forceLogout("   ");return}const a=i.data();if(console.log(" Session monitoring data check:",{uid:e,status:a.status,currentSessionVersion:a.sessionVersion,mySessionVersion:this.sessionVersion}),a.status!=="active"){console.warn(" Employee account deactivated - forcing logout:",{uid:e,status:a.status,currentUser:(l=this.currentUser)==null?void 0:l.uid}),this.currentUser&&this.currentUser.uid===e&&this.forceLogout("   ");return}const o=a.sessionVersion;o&&this.sessionVersion&&o!==this.sessionVersion&&(console.log(" Session version changed - forcing logout:",{uid:e,old:this.sessionVersion,new:o,currentUser:(c=this.currentUser)==null?void 0:c.uid}),this.currentUser&&this.currentUser.uid===e&&this.forceLogout("    -     "))},i=>{console.error(" Session monitoring error:",i),i.code==="permission-denied"&&this.forceLogout("  ")});this.sessionListeners.set(e,r)}catch(s){console.error(" Error starting session monitoring:",s)}}stopSessionMonitoring(e){const s=this.sessionListeners.get(e);s&&(console.log(" Stopping session monitoring for user:",e),s(),this.sessionListeners.delete(e))}stopAllMonitoring(){console.log(" Stopping all session monitoring"),this.sessionListeners.forEach((e,s)=>{console.log(" Cleaning up listener for user:",s),e()}),this.sessionListeners.clear(),this.currentUser=null,this.sessionVersion=null,this.stopPeriodicValidation()}startPeriodicValidation(){this.stopPeriodicValidation(),console.log(" Starting periodic session validation (every 30 seconds)"),this.periodicCheckInterval=setInterval(async()=>{try{await this.validateCurrentSession()||(console.warn(" Periodic validation failed - forcing logout"),await this.forceLogout("  "))}catch(e){console.error(" Periodic validation error:",e)}},3e4)}stopPeriodicValidation(){this.periodicCheckInterval&&(console.log(" Stopping periodic session validation"),clearInterval(this.periodicCheckInterval),this.periodicCheckInterval=null)}async forceLogout(e="  "){try{console.log(" FORCE LOGOUT:",e),this.stopAllMonitoring(),window.confirm(`${e}

   .`)?await Wl(ut):await Wl(ut),window.location.pathname!=="/login"&&(window.location.href="/login")}catch(s){console.error(" Error during force logout:",s),window.location.href="/login"}}async validateCurrentSession(){try{if(!this.currentUser)return!1;const e=Le(ae,"employees",this.currentUser.uid),s=await ss(e);if(!s.exists())return console.warn(" Employee document not found during session validation"),!1;const r=s.data();return r.status!=="active"?(console.warn(" Employee inactive during session validation"),!1):r.sessionVersion&&this.sessionVersion&&r.sessionVersion!==this.sessionVersion?(console.warn(" Session version mismatch during validation"),!1):!0}catch(e){return console.error(" Error validating session:",e),!1}}getSessionInfo(){return{user:this.currentUser,sessionVersion:this.sessionVersion,isMonitoring:this.sessionListeners.size>0}}}const Si=new y4,wi="employees",tx="documents",bl=()=>{const n=new Date,e=n.getFullYear(),s=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0"),i=Math.floor(Math.random()*9999).toString().padStart(4,"0");return`EMP-${e}${s}${r}-${i}`};class jo{static async getAllEmployees(e={}){try{console.log(" Fetching all employees from Firestore...");const{search:s,filters:r={},sort:i="updatedAt",page:a=1,limit:o=30}=e;let l=[];try{i==="name"?l.push(as("fullName","asc")):i==="hireDate"?l.push(as("hireDate","desc")):l.push(as("createdAt","desc"))}catch(R){console.warn(" Sorting failed, using basic query:",R.message),l=[]}const c=Pe(ae,wi);let d=c;l.length>0&&(d=st(c,...l));const u=await qe(d);console.log(" Firestore query results:",u.size,"documents");let f=u.docs.map(R=>{var y,T,x;const D=R.data();return console.log(" Processing employee document:",R.id,D.fullName||"Unknown"),{id:R.id,internalId:D.internalId||bl(),...D,createdAt:(y=D.createdAt)!=null&&y.toDate?D.createdAt.toDate():D.createdAt,updatedAt:(T=D.updatedAt)!=null&&T.toDate?D.updatedAt.toDate():D.updatedAt,hireDate:(x=D.hireDate)!=null&&x.toDate?D.hireDate.toDate():D.hireDate}});if(console.log(" Processed employees:",f.length,"total"),s&&s.trim()){const R=s.toLowerCase();f=f.filter(D=>{var y,T,x,S,A,Q;return((y=D.fullName)==null?void 0:y.toLowerCase().includes(R))||((T=D.department)==null?void 0:T.toLowerCase().includes(R))||((x=D.jobTitle)==null?void 0:x.toLowerCase().includes(R))||((S=D.email)==null?void 0:S.toLowerCase().includes(R))||((A=D.phone)==null?void 0:A.includes(s))||((Q=D.nationalId)==null?void 0:Q.includes(s))})}r.department&&r.department!=="all"&&(f=f.filter(R=>R.department===r.department)),r.status&&r.status!=="all"&&(f=f.filter(R=>R.status===r.status));const p=(a-1)*o,j=p+o;return{employees:f.slice(p,j),totalCount:f.length,totalPages:Math.ceil(f.length/o),currentPage:a}}catch(s){throw console.error("Error fetching employees:",s),new Error("    ")}}static async createEmployee(e){try{if(!e.email||!e.email.trim())throw new Error("     ");if(!e.password||!e.password.trim())throw new Error("     ");if(!e.nationalId||!e.nationalId.trim())throw new Error("   ");const s=ut.currentUser;if(!s)throw new Error("      ");if(console.log(" Storing current admin user for restoration:",s.uid,s.email),!s.email)throw new Error("      ");let i=bl(),a=0;for(;a<5&&await this.getEmployeeByInternalId(i);)i=bl(),a++;if(a===5)throw new Error("     ");console.log(" Creating Firebase Auth user for employee...");const o=await F5(ut,e.email.trim(),e.password||e.nationalId),l=o.user.uid;console.log(" Firebase Auth user created:",l),await U5(o.user,{displayName:e.fullName});const c={...e,internalId:i,status:e.status||"active",role:e.role||"employee",hireDate:e.hireDate?new Date(e.hireDate):new Date,createdAt:We(),updatedAt:We()};c.password&&delete c.password;const d=Le(ae,wi,l);return await yn(d,c),console.log(" Employee document created with UID:",l),console.log(" Signing out new employee user to preserve admin session..."),await Wl(ut),console.log(" New employee signed out"),await new Promise(u=>setTimeout(u,500)),console.log(" Employee created successfully - admin will need to sign back in"),{id:l,internalId:i,uid:l}}catch(s){throw console.error("Error creating employee:",s),s.code==="auth/email-already-in-use"?new Error("   "):s.code==="auth/invalid-email"?new Error("    "):s.code==="auth/weak-password"?new Error("    -    6   "):new Error(s.message||"   ")}}static async updateEmployee(e,s){var r;try{const i={...s},a=i.password;delete i.password,i.password=wT(),s.hireDate&&(i.hireDate=new Date(s.hireDate));const o=(r=ut.currentUser)==null?void 0:r.uid,l=Le(ae,wi,e);if(await Qt(l,i),s.status&&s.status!=="active"&&(console.log(" Employee deactivated - invalidating all sessions"),await Si.invalidateAllSessions(e)),a&&a.trim())try{console.log(" Attempting Firebase Auth password update"),await this.updateEmployeePassword(e,a),console.log(" Password updated successfully"),console.log(" Invalidating all sessions due to password change"),await Si.invalidateAllSessions(e)}catch(c){if(console.warn("Password update failed:",c.message),c.message&&c.message.includes("recent"))console.log(" Password update requires recent login - employee data saved but password not changed");else throw new Error(`         : ${c.message}`)}return!0}catch(i){throw console.error("Error updating employee:",i),new Error("    ")}}static async updateEmployeePassword(e,s,r=null){try{console.log(" FIREBASE AUTH: Direct password update"),console.log(" Target employee ID:",e),console.log(" New password length:",s.length);const i=ut.currentUser;if(!i)throw new Error("   ");if(console.log(" Current user UID:",i.uid),e===i.uid){if(console.log(" Self password update - using direct Firebase Auth"),!s||s.length<6)throw new Error("     6   ");await $5(i,s),console.log(" Own password updated successfully"),console.log(" Invalidating all sessions due to password change"),await Si.invalidateAllSessions(e)}else throw console.log(" Admin password update - user updating another user"),new Error("       -          ");return console.log(" PASSWORD UPDATE COMPLETED!"),!0}catch(i){throw console.error(" Password update failed:",i),console.error(" Error type:",i.name),console.error(" Error message:",i.message),i.code==="auth/weak-password"?new Error("    -    6   "):i.code==="auth/requires-recent-login"?new Error(`        .

         .`):i}}static async getEmployeeById(e){var s,r,i,a;try{const o=(s=ut.currentUser)==null?void 0:s.uid,l=Le(ae,wi,e),c=await ss(l);if(c.exists()){const d=c.data();return{id:c.id,internalId:d.internalId||bl(),...d,createdAt:(r=d.createdAt)!=null&&r.toDate?d.createdAt.toDate():d.createdAt,updatedAt:(i=d.updatedAt)!=null&&i.toDate?d.updatedAt.toDate():d.updatedAt,hireDate:(a=d.hireDate)!=null&&a.toDate?d.hireDate.toDate():d.hireDate}}else return null}catch(o){throw console.error("Error fetching employee by ID:",o),new Error("    ")}}static async getEmployeeByInternalId(e){var s,r,i;try{const a=Pe(ae,wi),o=st(a,xt("internalId","==",e)),l=await qe(o);if(l.empty)return null;{const c=l.docs[0],d=c.data();return{id:c.id,internalId:d.internalId,...d,createdAt:(s=d.createdAt)!=null&&s.toDate?d.createdAt.toDate():d.createdAt,updatedAt:(r=d.updatedAt)!=null&&r.toDate?d.updatedAt.toDate():d.updatedAt,hireDate:(i=d.hireDate)!=null&&i.toDate?d.hireDate.toDate():d.hireDate}}}catch(a){throw console.error("Error fetching employee by internal ID:",a),new Error("    ")}}static async updateEmployeeByInternalId(e,s){try{const r=await this.getEmployeeByInternalId(e);if(!r)throw new Error("  ");return await this.updateEmployee(r.id,s)}catch(r){throw console.error("Error updating employee by internal ID:",r),new Error("    ")}}static async deleteEmployee(e){try{const s=Le(ae,wi,e);return await es(s),!0}catch(s){throw console.error("Error deleting employee:",s),new Error("   ")}}static async deleteEmployeeByInternalId(e){try{const s=await this.getEmployeeByInternalId(e);if(!s)throw new Error("  ");return await this.deleteEmployee(s.id)}catch(s){throw console.error("Error deleting employee by internal ID:",s),new Error("   ")}}static async searchEmployees(e){try{const s=Pe(ae,wi);return(await qe(s)).docs.map(o=>{var c,d,u;const l=o.data();return{id:o.id,internalId:l.internalId||bl(),...l,createdAt:(c=l.createdAt)!=null&&c.toDate?l.createdAt.toDate():l.createdAt,updatedAt:(d=l.updatedAt)!=null&&d.toDate?l.updatedAt.toDate():l.updatedAt,hireDate:(u=l.hireDate)!=null&&u.toDate?l.hireDate.toDate():l.hireDate}}).filter(o=>{var l,c,d,u,f,p;return((l=o.fullName)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))||((c=o.department)==null?void 0:c.toLowerCase().includes(e.toLowerCase()))||((d=o.jobTitle)==null?void 0:d.toLowerCase().includes(e.toLowerCase()))||((u=o.email)==null?void 0:u.toLowerCase().includes(e.toLowerCase()))||((f=o.phone)==null?void 0:f.includes(e))||((p=o.nationalId)==null?void 0:p.includes(e))})}catch(s){throw console.error("Error searching employees:",s),new Error("    ")}}static async uploadEmployeeFile(e,s,r=null){var i;try{const a=(i=ut.currentUser)==null?void 0:i.uid,o=r||s.name,l=Date.now(),c=`uploads/employee_${e}_${l}_${o}`,d=ii(In,c),u=await Uc(d,s),f=await wl(u.ref),p=await this.getEmployeeByInternalId(e);if(!p)throw new Error("  ");const j={name:o,originalName:s.name,path:c,url:f,type:s.type,size:s.size,uploadedBy:a,uploadedAt:new Date().toISOString()},L=Pe(ae,wi,p.id,tx);return{id:(await As(L,j)).id,url:f,path:c,...j}}catch(a){throw console.error("Error uploading employee file:",a),new Error("   ")}}static async listEmployeeFiles(e){try{const s=await this.getEmployeeByInternalId(e);if(!s)throw new Error("  ");const r=Pe(ae,wi,s.id,tx);return(await qe(r)).docs.map(a=>{var l;const o=a.data();return{id:a.id,...o,uploadedAt:(l=o.uploadedAt)!=null&&l.toDate?o.uploadedAt.toDate():o.uploadedAt}})}catch(s){throw console.error("Error listing employee files:",s),new Error("    ")}}static async deleteEmployeeFile(e,s){try{const r=await this.getEmployeeByInternalId(e);if(!r)throw new Error("  ");const i=Le(ae,wi,r.id,tx,s),a=await ss(i);if(!a.exists())throw new Error("  ");const o=a.data(),l=ii(In,o.path);return await xh(l),await es(i),!0}catch(r){throw console.error("Error deleting employee file:",r),new Error("   ")}}static async getDepartments(){try{const e=Pe(ae,wi),s=await qe(e),r=new Set;return s.docs.forEach(i=>{const a=i.data();a.department&&r.add(a.department)}),Array.from(r).sort()}catch(e){throw console.error("Error fetching departments:",e),new Error("   ")}}static validateEmployeeData(e){var r;const s={};if((r=e.fullName)!=null&&r.trim()||(s.fullName="  "),e.email&&e.email.trim()&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(s.email="    ")),e.phone&&e.phone.trim()&&(/^[\+\d\-\s\(\)]+$/.test(e.phone)||(s.phone="    ")),e.salary&&e.salary!==""){const i=parseFloat(e.salary);(isNaN(i)||i<0)&&(s.salary="     ")}return s}static async migrateExistingData(){try{console.log("Starting employees migration...");const s=(await this.getAllEmployees({limit:1e3})).employees;let r=0;for(const i of s)if(!i.internalId||!i.internalId.startsWith("EMP-")){const a=bl();await this.updateEmployee(i.id,{...i,internalId:a}),r++,console.log(`Migrated employee: ${i.fullName} -> ${a}`)}return console.log(`Migration completed. ${r} employees migrated.`),{success:!0,migratedCount:r}}catch(e){throw console.error("Error during migration:",e),new Error("   ")}}}const b4=Object.freeze(Object.defineProperty({__proto__:null,EmployeeService:jo,generateEmployeeId:bl},Symbol.toStringTag,{value:"Module"}));class w4{constructor(){this.currentUserId=null,this.activities=[],this.users=[],this.listeners=new Set,this.firestoreListener=null,this.maxActivities=100,this.isInitialized=!1}async initialize(){try{if(!ut.currentUser)throw new Error("User not authenticated");return this.currentUserId=ut.currentUser.uid,await this.loadRealUsers(),this.setupRealtimeListener(),await this.loadRecentActivities(),this.isInitialized=!0,console.log(" ActivityTimelineService initialized with real users and Firebase"),{activities:this.activities,users:this.users}}catch(e){return console.error("Error initializing ActivityTimelineService:",e),{activities:[],users:[]}}}async loadRealUsers(){try{const e=await jo.getAllEmployees({limit:50});this.users=e.employees.map(r=>({id:r.id,internalId:r.internalId,name:r.fullName,email:r.email,department:r.department,jobTitle:r.jobTitle,avatarUrl:r.profileImageUrl||null,status:r.status||"active",role:r.role||"employee",lastActivity:null})),!this.users.find(r=>r.id===this.currentUserId)&&ut.currentUser&&this.users.unshift({id:this.currentUserId,name:ut.currentUser.displayName||" ",email:ut.currentUser.email,department:"",jobTitle:" ",avatarUrl:ut.currentUser.photoURL||null,status:"active",role:"admin",lastActivity:new Date}),console.log(` Loaded ${this.users.length} real users for timeline`),this.notifyListeners()}catch(e){console.error("Error loading real users:",e),ut.currentUser&&(this.users=[{id:this.currentUserId,name:ut.currentUser.displayName||" ",email:ut.currentUser.email,department:"",jobTitle:"",avatarUrl:ut.currentUser.photoURL||null,status:"active",role:"user",lastActivity:new Date}])}}setupRealtimeListener(){try{const e=Pe(ae,"activitylogs"),s=st(e,as("createdAt","desc"),cd(this.maxActivities));this.firestoreListener=ar(s,r=>{const i=[];r.forEach(a=>{const o=a.data(),l=this.transformActivityData(a.id,o);l&&i.push(l)}),this.activities=i,this.updateUserLastActivity(),this.notifyListeners(),console.log(` Real-time update: ${i.length} activities`)}),console.log(" Real-time activity listener setup complete")}catch(e){console.error("Error setting up real-time listener:",e)}}transformActivityData(e,s){var r,i,a,o,l,c;try{const d=this.users.find(u=>u.id===s.userId)||{id:s.userId,name:"  ",email:"",department:"",jobTitle:""};return{id:e,internalId:s.internalId,title:s.description||((r=s.details)==null?void 0:r.title)||this.generateActivityTitle(s),description:s.description,type:s.type,status:((i=s.details)==null?void 0:i.status)||"done",isManual:((a=s.details)==null?void 0:a.isManual)||!1,user:d,userId:s.userId,at:(o=s.createdAt)!=null&&o.toDate?s.createdAt.toDate():new Date(s.createdAt),createdAt:(l=s.createdAt)!=null&&l.toDate?s.createdAt.toDate():new Date(s.createdAt),timestamp:(c=s.timestamp)!=null&&c.toDate?s.timestamp.toDate():new Date(s.timestamp),details:s.details||{},metadata:{userAgent:s.userAgent,url:s.url}}}catch(d){return console.error("Error transforming activity data:",d),null}}generateActivityTitle(e){return{tender_create:"  ",tender_update:" ",tender_delete:" ",item_add:" ",item_update:" ",item_delete:" ",document_upload:" ",document_delete:" ",material_create:" ",material_update:" ",supplier_create:" ",user_login:" ",user_logout:" ",settings_update:" "}[e.type]||e.description||" "}updateUserLastActivity(){this.activities.forEach(e=>{const s=this.users.find(r=>r.id===e.userId);s&&(!s.lastActivity||e.at>s.lastActivity)&&(s.lastActivity=e.at)})}getActivitiesByDateRange(e,s){if(!e||!s)return this.activities;const r=new Date(e);r.setHours(0,0,0,0);const i=new Date(s);return i.setHours(23,59,59,999),this.activities.filter(a=>{const o=a.at;return o>=r&&o<=i})}getActivitiesByDate(e){if(!e)return this.activities;const s=new Date(e),r=new Date(s);r.setHours(0,0,0,0);const i=new Date(s);return i.setHours(23,59,59,999),this.activities.filter(a=>{const o=a.at;return o>=r&&o<=i})}getActivitiesByUser(e){return e?this.activities.filter(s=>s.userId===e):this.activities}getFilteredActivities({userId:e=null,date:s=null,startDate:r=null,endDate:i=null,type:a=null,status:o=null}={}){let l=[...this.activities];return e&&(l=l.filter(c=>c.userId===e)),s?l=this.getActivitiesByDate(s).filter(c=>!e||c.userId===e):r&&i&&(l=this.getActivitiesByDateRange(r,i).filter(c=>!e||c.userId===e)),a&&(l=l.filter(c=>c.type===a)),o&&(l=l.filter(c=>c.status===o)),l}searchActivities(e){if(!e||!e.trim())return this.activities;const s=e.toLowerCase();return this.activities.filter(r=>{var i,a,o,l,c;return((i=r.title)==null?void 0:i.toLowerCase().includes(s))||((a=r.description)==null?void 0:a.toLowerCase().includes(s))||((l=(o=r.user)==null?void 0:o.name)==null?void 0:l.toLowerCase().includes(s))||((c=r.type)==null?void 0:c.toLowerCase().includes(s))})}async createManualActivity({title:e,description:s,type:r="manual",status:i="done"}){var a,o;try{const l=this.users.find(f=>f.id===this.currentUserId)||{id:this.currentUserId,name:((a=ut.currentUser)==null?void 0:a.displayName)||" ",email:((o=ut.currentUser)==null?void 0:o.email)||""},c={internalId:Ct("ACTIVITY"),type:r,description:s,details:{title:e,isManual:!0,status:i},timestamp:new Date,createdAt:We(),userId:this.currentUserId,userAgent:navigator.userAgent,url:window.location.pathname},d=Pe(ae,"activitylogs"),u=await As(d,c);return console.log(" Manual activity created:",e),{id:u.id,...c,user:l,at:new Date,createdAt:new Date}}catch(l){throw console.error("Error creating manual activity:",l),new Error("   ")}}async deleteActivity(e){try{const s=Le(ae,"activitylogs",e);return await es(s),console.log(" Activity deleted:",e),!0}catch(s){throw console.error("Error deleting activity:",s),new Error("   ")}}async updateActivity(e,s){try{const r=Le(ae,"activitylogs",e);return await Qt(r,{...s,updatedAt:We()}),console.log(" Activity updated:",e),!0}catch(r){throw console.error("Error updating activity:",r),new Error("   ")}}getActivityStats(e={}){const s=this.getFilteredActivities(e),r={total:s.length,byType:{},byStatus:{},byUser:{},byDate:{},recentActivity:s[0]||null};return s.forEach(i=>{var l;r.byType[i.type]=(r.byType[i.type]||0)+1,r.byStatus[i.status]=(r.byStatus[i.status]||0)+1;const a=((l=i.user)==null?void 0:l.name)||" ";r.byUser[a]=(r.byUser[a]||0)+1;const o=i.at.toDateString();r.byDate[o]=(r.byDate[o]||0)+1}),r}addListener(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notifyListeners(){this.listeners.forEach(e=>{try{e({activities:this.activities,users:this.users})}catch(s){console.error("Error in timeline listener:",s)}})}destroy(){this.firestoreListener&&(this.firestoreListener(),this.firestoreListener=null),this.listeners.clear(),this.activities=[],this.users=[],this.isInitialized=!1,console.log(" ActivityTimelineService destroyed")}async refresh(){try{await this.loadRealUsers(),await this.loadRecentActivities(),console.log(" Timeline data refreshed")}catch(e){console.error("Error refreshing timeline:",e)}}async loadRecentActivities(){try{const e=Pe(ae,"activitylogs"),s=st(e,as("createdAt","desc"),cd(this.maxActivities)),r=await qe(s),i=[];r.forEach(a=>{const o=a.data(),l=this.transformActivityData(a.id,o);l&&i.push(l)}),this.activities=i,this.updateUserLastActivity(),console.log(` Loaded ${i.length} recent activities`)}catch(e){console.error("Error loading recent activities:",e)}}}const ai=new w4;ut.onAuthStateChanged(async n=>{if(n)try{await ai.initialize(),console.log(" Activity timeline initialized for user:",n.uid)}catch(e){console.error("Error initializing activity timeline:",e)}else ai.destroy(),console.log(" Activity timeline destroyed - user signed out")});const w1=h.createContext(),Zt=()=>{const n=h.useContext(w1);if(!n)throw new Error("useActivity must be used within ActivityProvider");return n},Lt=({children:n})=>{const[e,s]=h.useState([]),[r,i]=h.useState(!0),[a,o]=h.useState(null);h.useEffect(()=>{const x=async()=>{try{i(!0),o(null),await ws.initialize();const A=(ws.activities||[]).map(Q=>({...Q,status:Q.status==="open"?"done":Q.status}));s(A),console.log(` Loaded ${A.length} activities from Firestore`)}catch(S){console.error("Error initializing activities:",S),o("    "),s([])}finally{i(!1)}};if(ut.currentUser)x();else return ut.onAuthStateChanged(A=>{A?x():(s([]),i(!1))})},[]),h.useEffect(()=>ws.addListener(S=>{if(S){const A=S.map(Q=>({...Q,status:Q.status==="open"?"done":Q.status}));s(A)}}),[]);const[l,c]=h.useState([]);h.useEffect(()=>{(async()=>{if(ai.isInitialized)c(ai.users||[]);else return ai.addListener(({users:A})=>{c(A||[])})})()},[]);const d=()=>{var S,A,Q;const x=(S=ut.currentUser)==null?void 0:S.uid;return l.find(q=>q.id===x)||{id:x,name:((A=ut.currentUser)==null?void 0:A.displayName)||" ",email:((Q=ut.currentUser)==null?void 0:Q.email)||""}},u=async(x,S,A,Q=!1)=>{try{const q=await ws.logActivity(x,A,{title:S,isManual:Q,status:"done",user:d(),at:Date.now(),createdAt:new Date().toISOString()});return q?(console.log(" Activity logged:",A),q):(console.error("Failed to log activity:",A),null)}catch(q){return console.error("Error logging activity:",q),null}},T={activities:e,users:l,loading:r,error:a,addActivity:u,logActivity:async(x,S,A)=>await u(x,S,A,!1),createManualActivity:async x=>await u(x.type,x.title,x.description,!0),updateActivityStatus:async(x,S)=>{try{await ws.updateActivity(x,{status:S})?console.log(" Activity status updated:",x,S):console.error("Failed to update activity status:",x)}catch(A){console.error("Error updating activity status:",A)}},deleteActivity:async x=>{try{await ws.deleteActivity(x)?console.log(" Activity deleted:",x):console.error("Failed to delete activity:",x)}catch(S){console.error("Error deleting activity:",S)}},clearAllActivities:async()=>{try{const x=await ws.clearAllActivities();return x&&console.log(" All activities cleared"),x}catch(x){return console.error("Error clearing activities:",x),!1}},getActivityStats:()=>ws.getActivityStats(),searchActivities:x=>ws.searchActivities(x),getCurrentUser:d};return t.jsx(w1.Provider,{value:T,children:n})},Ft=({children:n})=>n,fi=Object.freeze(Object.defineProperty({__proto__:null,ActivityProvider:Lt,AutoActivityTracker:Ft,useActivity:Zt},Symbol.toStringTag,{value:"Module"}));class Ws{static async getAllCategories(){try{const e=st(Pe(ae,this.CATEGORIES_COLLECTION),as("name","asc")),s=await qe(e),r=[];return s.forEach(i=>{r.push({id:i.id,...i.data()})}),console.log(" Loaded categories:",r.length),r}catch(e){throw console.error(" Error loading categories:",e),new Error("   ")}}static async createCategory(e){try{const s={...e,createdAt:We(),updatedAt:We()},r=await As(Pe(ae,this.CATEGORIES_COLLECTION),s);return console.log(" Category created:",r.id),r.id}catch(s){throw console.error(" Error creating category:",s),new Error("   ")}}static async updateCategory(e,s){try{const r={...s,updatedAt:We()};return await Qt(Le(ae,this.CATEGORIES_COLLECTION,e),r),console.log(" Category updated:",e),!0}catch(r){throw console.error(" Error updating category:",r),new Error("   ")}}static async deleteCategory(e){try{return await es(Le(ae,this.CATEGORIES_COLLECTION,e)),console.log(" Category deleted:",e),!0}catch(s){throw console.error(" Error deleting category:",s),new Error("   ")}}static async getAllUnits(){try{const e=st(Pe(ae,this.UNITS_COLLECTION),as("name","asc")),s=await qe(e),r=[];return s.forEach(i=>{r.push({id:i.id,...i.data()})}),console.log(" Loaded units:",r.length),r}catch(e){throw console.error(" Error loading units:",e),new Error("   ")}}static async createUnit(e){try{const s={...e,createdAt:We(),updatedAt:We()},r=await As(Pe(ae,this.UNITS_COLLECTION),s);return console.log(" Unit created:",r.id),r.id}catch(s){throw console.error(" Error creating unit:",s),new Error("   ")}}static async updateUnit(e,s){try{const r={...s,updatedAt:We()};return await Qt(Le(ae,this.UNITS_COLLECTION,e),r),console.log(" Unit updated:",e),!0}catch(r){throw console.error(" Error updating unit:",r),new Error("   ")}}static async deleteUnit(e){try{return await es(Le(ae,this.UNITS_COLLECTION,e)),console.log(" Unit deleted:",e),!0}catch(s){throw console.error(" Error deleting unit:",s),new Error("   ")}}static async getCategoryNames(){try{return(await this.getAllCategories()).map(s=>s.name)}catch(e){return console.error(" Error loading category names:",e),[]}}static async getUnitNames(){try{return(await this.getAllUnits()).map(s=>s.name)}catch(e){return console.error(" Error loading unit names:",e),[]}}static async initializeDefaultSettings(){try{if(console.log(" Initializing default settings..."),(await this.getAllCategories()).length===0){console.log(" Creating default categories...");const r=[{name:" ",description:"  ",isDefault:!0},{name:" ",description:"  ",isDefault:!0},{name:" ",description:"  ",isDefault:!0},{name:" ",description:"  ",isDefault:!0},{name:" ",description:"  ",isDefault:!0}];for(const i of r)await this.createCategory(i);console.log(" Default categories created")}if((await this.getAllUnits()).length===0){console.log(" Creating default units...");const r=[{name:"",description:" ",isDefault:!0},{name:"",description:" ",isDefault:!0},{name:" ",description:" ",isDefault:!0},{name:" ",description:" ",isDefault:!0},{name:" ",description:" ",isDefault:!0},{name:"",description:" ",isDefault:!0},{name:"",description:"  ",isDefault:!0},{name:"",description:" ",isDefault:!0}];for(const i of r)await this.createUnit(i);console.log(" Default units created")}return console.log(" Settings initialization completed"),!0}catch(e){throw console.error(" Error initializing default settings:",e),new Error("    ")}}static async getAllServiceTypes(){try{const e=st(Pe(ae,this.SERVICE_TYPES_COLLECTION),as("name","asc")),s=await qe(e),r=[];return s.forEach(i=>{r.push({id:i.id,...i.data()})}),console.log(" Loaded service types:",r.length),r}catch(e){throw console.error(" Error loading service types:",e),new Error("    ")}}static async createServiceType(e){try{const s={...e,createdAt:We(),updatedAt:We()},r=await As(Pe(ae,this.SERVICE_TYPES_COLLECTION),s);return console.log(" Service type created with ID:",r.id),r.id}catch(s){throw console.error(" Error creating service type:",s),new Error("    ")}}static async updateServiceType(e,s){try{const r=Le(ae,this.SERVICE_TYPES_COLLECTION,e),i={...s,updatedAt:We()};await Qt(r,i),console.log(" Service type updated:",e)}catch(r){throw console.error(" Error updating service type:",r),new Error("    ")}}static async deleteServiceType(e){try{const s=Le(ae,this.SERVICE_TYPES_COLLECTION,e);await es(s),console.log(" Service type deleted:",e)}catch(s){throw console.error(" Error deleting service type:",s),new Error("    ")}}static async getAllCities(){try{const e=st(Pe(ae,this.CITIES_COLLECTION),as("name","asc")),s=await qe(e),r=[];return s.forEach(i=>{r.push({id:i.id,...i.data()})}),console.log(" Loaded cities:",r.length),r}catch(e){throw console.error(" Error loading cities:",e),new Error("   ")}}static async createCity(e){try{const s={...e,createdAt:We(),updatedAt:We()},r=await As(Pe(ae,this.CITIES_COLLECTION),s);return console.log(" City created with ID:",r.id),r.id}catch(s){throw console.error(" Error creating city:",s),new Error("   ")}}static async updateCity(e,s){try{const r=Le(ae,this.CITIES_COLLECTION,e),i={...s,updatedAt:We()};await Qt(r,i),console.log(" City updated:",e)}catch(r){throw console.error(" Error updating city:",r),new Error("   ")}}static async deleteCity(e){try{const s=Le(ae,this.CITIES_COLLECTION,e);await es(s),console.log(" City deleted:",e)}catch(s){throw console.error(" Error deleting city:",s),new Error("   ")}}}Ys(Ws,"CATEGORIES_COLLECTION","global_categories"),Ys(Ws,"UNITS_COLLECTION","global_units"),Ys(Ws,"SERVICE_TYPES_COLLECTION","global_service_types"),Ys(Ws,"CITIES_COLLECTION","global_cities");const ks={SET_LOADING:"SET_LOADING",SET_ERROR:"SET_ERROR",SET_CATEGORIES:"SET_CATEGORIES",SET_UNITS:"SET_UNITS",SET_CITIES:"SET_CITIES",ADD_CATEGORY:"ADD_CATEGORY",UPDATE_CATEGORY:"UPDATE_CATEGORY",REMOVE_CATEGORY:"REMOVE_CATEGORY",ADD_UNIT:"ADD_UNIT",UPDATE_UNIT:"UPDATE_UNIT",REMOVE_UNIT:"REMOVE_UNIT",ADD_CITY:"ADD_CITY",UPDATE_CITY:"UPDATE_CITY",REMOVE_CITY:"REMOVE_CITY",SET_INITIALIZED:"SET_INITIALIZED"},v4={categories:[],units:[],cities:[],loading:{categories:!0,units:!0,cities:!0,initializing:!0},error:{categories:null,units:null,cities:null},initialized:!1,lastUpdated:{categories:null,units:null,cities:null}},N4=(n,e)=>{switch(e.type){case ks.SET_LOADING:return{...n,loading:{...n.loading,[e.payload.type]:e.payload.loading}};case ks.SET_ERROR:return{...n,error:{...n.error,[e.payload.type]:e.payload.error}};case ks.SET_CATEGORIES:return{...n,categories:e.payload,loading:{...n.loading,categories:!1},error:{...n.error,categories:null},lastUpdated:{...n.lastUpdated,categories:new Date().toISOString()}};case ks.SET_UNITS:return{...n,units:e.payload,loading:{...n.loading,units:!1},error:{...n.error,units:null},lastUpdated:{...n.lastUpdated,units:new Date().toISOString()}};case ks.SET_CITIES:return{...n,cities:e.payload,loading:{...n.loading,cities:!1},error:{...n.error,cities:null},lastUpdated:{...n.lastUpdated,cities:new Date().toISOString()}};case ks.ADD_CATEGORY:return{...n,categories:[...n.categories,e.payload].sort((s,r)=>s.name.localeCompare(r.name)),lastUpdated:{...n.lastUpdated,categories:new Date().toISOString()}};case ks.UPDATE_CATEGORY:return{...n,categories:n.categories.map(s=>s.id===e.payload.id?{...s,...e.payload.data}:s).sort((s,r)=>s.name.localeCompare(r.name)),lastUpdated:{...n.lastUpdated,categories:new Date().toISOString()}};case ks.REMOVE_CATEGORY:return{...n,categories:n.categories.filter(s=>s.id!==e.payload),lastUpdated:{...n.lastUpdated,categories:new Date().toISOString()}};case ks.ADD_UNIT:return{...n,units:[...n.units,e.payload].sort((s,r)=>s.name.localeCompare(r.name)),lastUpdated:{...n.lastUpdated,units:new Date().toISOString()}};case ks.UPDATE_UNIT:return{...n,units:n.units.map(s=>s.id===e.payload.id?{...s,...e.payload.data}:s).sort((s,r)=>s.name.localeCompare(r.name)),lastUpdated:{...n.lastUpdated,units:new Date().toISOString()}};case ks.REMOVE_UNIT:return{...n,units:n.units.filter(s=>s.id!==e.payload),lastUpdated:{...n.lastUpdated,units:new Date().toISOString()}};case ks.ADD_CITY:return{...n,cities:[...n.cities,e.payload].sort((s,r)=>s.name.localeCompare(r.name)),lastUpdated:{...n.lastUpdated,cities:new Date().toISOString()}};case ks.UPDATE_CITY:return{...n,cities:n.cities.map(s=>s.id===e.payload.id?{...s,...e.payload.data}:s).sort((s,r)=>s.name.localeCompare(r.name)),lastUpdated:{...n.lastUpdated,cities:new Date().toISOString()}};case ks.REMOVE_CITY:return{...n,cities:n.cities.filter(s=>s.id!==e.payload),lastUpdated:{...n.lastUpdated,cities:new Date().toISOString()}};case ks.SET_INITIALIZED:return{...n,initialized:!0,loading:{...n.loading,initializing:!1}};default:return n}},v1=h.createContext(),j4=({children:n})=>{const[e,s]=h.useReducer(N4,v4);h.useEffect(()=>{console.log(" Setting up real-time Firebase listeners for global settings...");let d,u,f;return(async()=>{try{await Ws.initializeDefaultSettings();const j=st(Pe(ae,Ws.CATEGORIES_COLLECTION),as("name","asc"));d=ar(j,D=>{console.log(" Categories updated from Firebase:",D.docs.length);const y=D.docs.map(T=>({id:T.id,...T.data()}));s({type:ks.SET_CATEGORIES,payload:y})},D=>{console.error(" Categories listener error:",D),s({type:ks.SET_ERROR,payload:{type:"categories",error:D.message}})});const L=st(Pe(ae,Ws.UNITS_COLLECTION),as("name","asc"));u=ar(L,D=>{console.log(" Units updated from Firebase:",D.docs.length);const y=D.docs.map(T=>({id:T.id,...T.data()}));s({type:ks.SET_UNITS,payload:y})},D=>{console.error(" Units listener error:",D),s({type:ks.SET_ERROR,payload:{type:"units",error:D.message}})});const R=st(Pe(ae,Ws.CITIES_COLLECTION),as("name","asc"));f=ar(R,D=>{const y=D.docs.map(T=>({id:T.id,...T.data()}));s({type:ks.SET_CITIES,payload:y})},D=>{console.error(" Cities listener error:",D),s({type:ks.SET_ERROR,payload:{type:"cities",error:D.message}})}),s({type:ks.SET_INITIALIZED}),console.log(" Real-time listeners initialized successfully")}catch(j){console.error(" Failed to setup Firebase listeners:",j),s({type:ks.SET_ERROR,payload:{type:"categories",error:"Failed to initialize settings"}}),s({type:ks.SET_ERROR,payload:{type:"units",error:"Failed to initialize settings"}})}})(),()=>{console.log(" Cleaning up Firebase listeners..."),d&&d(),u&&u(),f&&f()}},[]),h.useEffect(()=>{const d=u=>{u.key==="settings_force_refresh"&&console.log(" Cross-tab settings refresh triggered")};return window.addEventListener("storage",d),()=>window.removeEventListener("storage",d)},[]);const r=h.useCallback((d,u)=>{s({type:ks.UPDATE_CATEGORY,payload:{id:d,data:u}})},[]),i=h.useCallback((d,u)=>{s({type:ks.UPDATE_UNIT,payload:{id:d,data:u}})},[]),a=h.useCallback((d,u)=>{s({type:ks.UPDATE_CITY,payload:{id:d,data:u}})},[]),o=h.useMemo(()=>({getCategoryNames:()=>e.categories.map(d=>d.name),getUnitNames:()=>e.units.map(d=>d.name),getCityNames:()=>e.cities.map(d=>d.name),getCategoriesWithDetails:()=>e.categories.map(d=>({value:d.name,label:d.name,description:d.description,isDefault:d.isDefault})),getUnitsWithDetails:()=>e.units.map(d=>({value:d.name,label:d.name,name:d.name,description:d.description,isDefault:d.isDefault})),getCitiesWithDetails:()=>e.cities.map(d=>({value:d.name,label:d.name,name:d.name,description:d.description,isDefault:d.isDefault})),findCategoryByName:d=>e.categories.find(u=>u.name===d),findUnitByName:d=>e.units.find(u=>u.name===d),findCityByName:d=>e.cities.find(u=>u.name===d),isReady:()=>e.initialized&&!e.loading.categories&&!e.loading.units&&!e.loading.cities,isLoading:()=>e.loading.categories||e.loading.units||e.loading.cities||e.loading.initializing}),[e.categories,e.units,e.cities,e.initialized,e.loading]),l=h.useCallback(()=>{console.log(" Force refreshing settings...");const d=new CustomEvent("settings_force_refresh",{detail:{timestamp:Date.now()}});window.dispatchEvent(d)},[]),c=h.useMemo(()=>({categories:e.categories,units:e.units,cities:e.cities,loading:e.loading,error:e.error,initialized:e.initialized,lastUpdated:e.lastUpdated,...o,dispatch:s,optimisticCategoryUpdate:r,optimisticUnitUpdate:i,optimisticCityUpdate:a,forceRefresh:l,ACTIONS:ks}),[e,o,r,i,a,l]);return t.jsx(v1.Provider,{value:c,children:n})},Id=()=>{const n=h.useContext(v1);return n||(console.warn("useSettings must be used within a SettingsProvider - returning default values"),{categories:[],units:[],cities:[],loading:{categories:!0,units:!0,cities:!0,initializing:!0},error:{categories:null,units:null,cities:null},initialized:!1,lastUpdated:{categories:null,units:null,cities:null},getCategoryNames:()=>[],getUnitNames:()=>[],getCityNames:()=>[],getCategoriesWithDetails:()=>[],getUnitsWithDetails:()=>[],getCitiesWithDetails:()=>[],findCategoryByName:()=>null,findUnitByName:()=>null,findCityByName:()=>null,isReady:()=>!1,isLoading:()=>!0,dispatch:()=>{},optimisticCategoryUpdate:()=>{},optimisticUnitUpdate:()=>{},optimisticCityUpdate:()=>{},forceRefresh:()=>{},ACTIONS:ks})},S4=()=>{const n=Id(),{categories:e=[],getCategoryNames:s=()=>[],getCategoriesWithDetails:r=()=>[],findCategoryByName:i=()=>null,loading:a={categories:!0},error:o={categories:null},isReady:l=()=>!1}=n||{};return h.useMemo(()=>({categories:e,categoryNames:s(),categoriesWithDetails:r(),findByName:i,loading:a.categories||!1,error:o.categories,isReady:l()&&e.length>0}),[e,s,r,i,a.categories,o.categories,l])},E4=()=>{const n=Id(),{units:e=[],getUnitNames:s=()=>[],getUnitsWithDetails:r=()=>[],findUnitByName:i=()=>null,loading:a={units:!0},error:o={units:null},isReady:l=()=>!1}=n||{};return h.useMemo(()=>({units:e,unitNames:s(),unitsWithDetails:r(),findByName:i,loading:a.units||!1,error:o.units,isReady:l()&&e.length>0}),[e,s,r,i,a.units,o.units,l])},C4=()=>{const n=Id(),{cities:e=[],getCityNames:s=()=>[],getCitiesWithDetails:r=()=>[],findCityByName:i=()=>null,loading:a={cities:!0},error:o={cities:null},isReady:l=()=>!1}=n||{};return h.useMemo(()=>({cities:e,cityNames:s(),citiesWithDetails:r(),findByName:i,loading:a.cities||!1,error:o.cities,isReady:l()&&e.length>0}),[e,s,r,i,a.cities,o.cities,l])};class I4{constructor(){this.currentSessionId=null,this.currentUserId=null,this.unsubscribe=null,this.syncInterval=null,this.staleMonitoringInterval=null,this.isTracking=!1,this.lastSyncTime=0,this.lastSyncedStatus=null,this.retryCount=0,this.maxRetries=3,this.offlineQueue=[],this.isOnline=navigator.onLine,window.addEventListener("online",()=>{this.isOnline=!0,console.log(" LIVE TRACKING: Back online - processing queued updates"),this.processOfflineQueue()}),window.addEventListener("offline",()=>{this.isOnline=!1,console.log(" LIVE TRACKING: Offline - will queue updates")}),console.log(" LIVE TRACKING: Service initialized - MAXIMUM SYNC MODE (24/7)")}setUserSession(e){this.currentUserId=e,this.currentSessionId=`user_${e}`,console.log(" LIVE TRACKING: Set permanent session for user:",e)}getUserSpecificKey(e){const s=this.currentUserId||"anonymous";return`${e}_${s}`}async startTracking(e={}){try{const s=e.id;if(this.isTracking&&this.currentUserId&&this.currentUserId!==s&&(console.log(" LIVE TRACKING: User context changed, stopping previous tracking"),await this.stopTracking()),this.isTracking&&this.currentUserId===s)return console.log(" LIVE TRACKING: Already tracking for same user, skipping start"),!0;if(console.log(" LIVE TRACKING: Starting live tracking for user:",s),!ae)throw new Error("Firestore not available");if(e.id)this.setUserSession(e.id);else throw new Error("Employee ID required for permanent session");return this.isTracking=!0,this.retryCount=0,await this.createSessionDocument(e),this.startRealTimeSync(),this.startStaleSessionMonitoring(2),console.log(" LIVE TRACKING: Successfully started with stale monitoring for user:",s),!0}catch(s){return console.error(" LIVE TRACKING: Start error for user:",e.id,s),this.isTracking=!1,this.handleError(s),!1}}async createSessionDocument(e){const s=localStorage.getItem(this.getUserSpecificKey("PERSISTENT_TIMER_SESSION_START")),r=s?parseInt(s,10):Date.now();console.log(" LIVE TRACKING: Using timer session start:",new Date(r).toLocaleString());const i={sessionId:this.currentSessionId,employeeId:e.id||"anonymous",employeeName:e.fullName||"Unknown User",status:"active",sessionStart:new Date(r),lastUpdate:We(),totalSeconds:parseInt(localStorage.getItem(this.getUserSpecificKey("PERSISTENT_TIMER_SECONDS"))||"0"),isVisible:!0,date:new Date().toISOString().split("T")[0],createdAt:We(),platform:navigator.platform,userAgent:navigator.userAgent.substring(0,100),permanentSession:!0},a=Le(ae,"live_tracking",this.currentSessionId);await yn(a,i,{merge:!0}),console.log(" LIVE TRACKING: Permanent session document created/updated:",this.currentSessionId)}async cleanupOldSessions(e){console.log(` LIVE TRACKING: Cleanup disabled - using permanent sessions for ${e}`)}startRealTimeSync(){this.syncInterval&&clearInterval(this.syncInterval),this.syncInterval=setInterval(async()=>{try{await this.syncCurrentState()}catch(e){console.error(" LIVE TRACKING: Sync error:",e),this.handleSyncError(e)}},1e3),console.log(" LIVE TRACKING: Real-time sync started (1-second intervals)")}async syncCurrentState(){if(!(!this.isTracking||!ae))try{if(!this.currentUserId||!this.currentSessionId){console.warn(" LIVE TRACKING: No user context, skipping sync");return}const e=parseInt(localStorage.getItem(this.getUserSpecificKey("PERSISTENT_TIMER_SECONDS"))||"0"),s=parseInt(localStorage.getItem(this.getUserSpecificKey("PERSISTENT_TIMER_SESSION_START"))||Date.now()),r=document.visibilityState==="visible",i=r?"active":"paused",a=this.lastSyncedStatus!==i,o={employeeId:this.currentUserId,totalSeconds:e,isVisible:r,status:i,lastUpdate:We(),syncTimestamp:Date.now(),sessionDuration:Date.now()-s,userIsolationCheck:!0};if(this.isOnline&&ae)try{const l=Le(ae,"live_tracking",this.currentSessionId);await yn(l,o,{merge:!0}),this.lastSyncTime=Date.now(),this.lastSyncedStatus=i,this.retryCount=0,console.log(" LIVE TRACKING: Firestore updated for user!",this.currentUserId,i,e+"s",new Date().toLocaleTimeString())}catch{this.queueUpdate(o),console.log(" LIVE TRACKING: Queued update (Firestore error) for user:",this.currentUserId)}else this.queueUpdate(o),console.log(" LIVE TRACKING: Queued update (offline) for user:",this.currentUserId,e+"s")}catch(e){console.error(" LIVE TRACKING: Sync state error for user:",this.currentUserId,e),this.handleSyncError(e)}}handleSyncError(e){if(this.retryCount++,this.retryCount>=this.maxRetries){console.error(" LIVE TRACKING: Max retries reached, stopping sync"),this.stopTracking();return}console.log(` LIVE TRACKING: Sync error, retrying... (${this.retryCount}/${this.maxRetries})`),setTimeout(()=>{this.isTracking&&this.syncCurrentState()},1e3*this.retryCount)}async stopTracking(){try{if(console.log(" LIVE TRACKING: Stopping live tracking (permanent session remains)..."),this.isTracking=!1,this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null),this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null),ae&&this.currentSessionId){const e=Le(ae,"live_tracking",this.currentSessionId);await yn(e,{status:"inactive",lastUpdate:We(),isVisible:!1,signedOut:!0},{merge:!0})}console.log(" LIVE TRACKING: Successfully marked as inactive (permanent session preserved)")}catch(e){console.error(" LIVE TRACKING: Stop error:",e)}}async handleSignOut(){try{if(console.log(" LIVE TRACKING: Handling user sign-out cleanup..."),ae&&this.currentSessionId){const e=Le(ae,"live_tracking",this.currentSessionId);await yn(e,{status:"inactive",lastUpdate:We(),isVisible:!1,signedOut:!0,signOutTime:We()},{merge:!0}),console.log(" LIVE TRACKING: User marked as signed out and inactive")}await this.stopTracking()}catch(e){console.error(" LIVE TRACKING: Sign-out cleanup error:",e)}}async getCurrentSession(){try{if(!ae||!this.currentSessionId)return null;const e=Le(ae,"live_tracking",this.currentSessionId),s=await ss(e);return s.exists()?s.data():null}catch(e){return console.error(" LIVE TRACKING: Get session error:",e),null}}listenToSessionUpdates(e){try{if(!ae||!this.currentSessionId)return null;const s=Le(ae,"live_tracking",this.currentSessionId);return this.unsubscribe=ar(s,r=>{if(r.exists()){const i=r.data();(i.status==="stopped"||i.status==="error")&&console.log(" LIVE TRACKING: Important status change:",i.status),e&&e(i)}}),console.log(" LIVE TRACKING: Listening for session updates"),this.unsubscribe}catch(s){return console.error(" LIVE TRACKING: Listen error:",s),null}}async getActiveSessions(){try{if(!ae)return[];const e=await qe(st(Pe(ae,"live_tracking"),xt("status","==","active"),as("lastUpdate","desc"))),s=[];return e.forEach(r=>{s.push({id:r.id,...r.data()})}),s}catch(e){return console.error(" LIVE TRACKING: Get active sessions error:",e),[]}}async cleanupOldSessions(e=7){try{if(!ae)return;const s=new Date;s.setDate(s.getDate()-e);const r=await qe(st(Pe(ae,"live_tracking"),xt("createdAt","<",s))),i=Fr(ae);r.forEach(a=>{i.delete(a.ref)}),await i.commit(),console.log(` LIVE TRACKING: Cleaned up ${r.size} old sessions`)}catch(s){console.error(" LIVE TRACKING: Cleanup error:",s)}}handleError(e){console.error(" LIVE TRACKING: General error:",e),window.dispatchEvent(new CustomEvent("liveTrackingError",{detail:{error:e.message}}))}getStatus(){return{isTracking:this.isTracking,sessionId:this.currentSessionId,lastSyncTime:this.lastSyncTime,retryCount:this.retryCount}}async cleanupAllDuplicates(){try{console.log(" LIVE TRACKING: MANUAL cleanup - removing old-style duplicate sessions only");const e=Pe(ae,"live_tracking"),s=await qe(e);if(!s.empty){const r=Fr(ae);let i=0;return s.forEach(a=>{const o=a.id;o.startsWith("session_")?(r.delete(a.ref),i++,console.log(` Deleting old-style session: ${o}`)):o.startsWith("user_")&&console.log(` Preserving permanent session: ${o}`)}),i>0?(await r.commit(),console.log(` LIVE TRACKING: MANUAL cleanup complete - deleted ${i} old-style sessions`)):console.log(" No old-style sessions found - all sessions are permanent"),i}return 0}catch(e){return console.error(" LIVE TRACKING: Manual cleanup error:",e),0}}queueUpdate(e){this.offlineQueue.length>=100&&this.offlineQueue.shift(),this.offlineQueue.push({...e,queuedAt:Date.now()})}async processOfflineQueue(){if(this.offlineQueue.length!==0){console.log(` LIVE TRACKING: Processing ${this.offlineQueue.length} queued updates...`);try{const e=this.offlineQueue[this.offlineQueue.length-1],s=Le(ae,"live_tracking",this.currentSessionId);await yn(s,e,{merge:!0}),console.log(" LIVE TRACKING: Processed offline queue successfully"),this.offlineQueue=[]}catch(e){console.error(" LIVE TRACKING: Failed to process offline queue:",e)}}}async updateSessionStart(){if(!this.isTracking||!ae||!this.currentSessionId||!this.currentUserId){console.warn(" LIVE TRACKING: Cannot update session start - missing context");return}try{const e=localStorage.getItem(this.getUserSpecificKey("PERSISTENT_TIMER_SESSION_START")),s=e?parseInt(e,10):Date.now();console.log(" LIVE TRACKING: Updating session start after reset for user:",this.currentUserId,new Date(s).toLocaleString());const r=Le(ae,"live_tracking",this.currentSessionId);await yn(r,{employeeId:this.currentUserId,sessionStart:new Date(s),lastUpdate:We(),resetTimestamp:Date.now(),userIsolationVerified:!0},{merge:!0}),console.log(" LIVE TRACKING: Session start updated in Firestore for user:",this.currentUserId)}catch(e){console.error(" LIVE TRACKING: Update session start error for user:",this.currentUserId,e)}}async cleanupStaleActiveSessions(e=1){try{if(!ae)return 0;console.log(" LIVE TRACKING: Checking for stale active sessions...");const s=Date.now()-e*60*1e3,r=await qe(st(Pe(ae,"live_tracking"),xt("status","==","active"))),i=Fr(ae);let a=0;return r.forEach(o=>{const l=o.data();let c=null;l.lastUpdate&&(l.lastUpdate.toMillis?c=l.lastUpdate.toMillis():l.lastUpdate.seconds?c=l.lastUpdate.seconds*1e3:c=new Date(l.lastUpdate).getTime()),c&&c<s&&(i.update(o.ref,{status:"inactive",lastUpdate:We(),staleCleanup:!0,cleanedAt:We()}),a++,console.log(` Marking stale session as inactive: ${o.id} (last update: ${new Date(c).toLocaleString()})`))}),a>0?(await i.commit(),console.log(` LIVE TRACKING: Cleaned up ${a} stale active sessions`)):console.log(" LIVE TRACKING: No stale sessions found"),a}catch(s){return console.error(" LIVE TRACKING: Stale cleanup error:",s),0}}startStaleSessionMonitoring(e=2){this.staleMonitoringInterval&&clearInterval(this.staleMonitoringInterval),this.staleMonitoringInterval=setInterval(async()=>{await this.cleanupStaleActiveSessions()},e*60*1e3),console.log(` LIVE TRACKING: Started stale session monitoring (every ${e} minutes)`)}stopStaleSessionMonitoring(){this.staleMonitoringInterval&&(clearInterval(this.staleMonitoringInterval),this.staleMonitoringInterval=null,console.log(" LIVE TRACKING: Stopped stale session monitoring"))}}const Xs=new I4;typeof window<"u"&&(window.liveTrackingService=Xs,window.testStaleCleanup=()=>(console.log(" TESTING: Manual stale cleanup..."),Xs.cleanupStaleActiveSessions(.1)),window.forceSignOut=()=>(console.log(" TESTING: Manual sign-out cleanup..."),Xs.handleSignOut()));let sx=null;class T4{constructor(){if(sx)return console.log(" SNAPSHOT SERVICE: Returning existing instance (singleton)"),sx;this.isScheduled=!1,this.scheduledTimeout=null,this.snapshotTime=this.getConfigurableSnapshotTime(),this.isCreatingSnapshot=!1,sx=this,console.log(` SNAPSHOT SERVICE: Initialized - Configurable snapshots at ${this.snapshotTime.hour}:${this.snapshotTime.minute.toString().padStart(2,"0")}`),this.performAutoCleanup(),this.setupPeriodicCleanup(),this.setupSettingsListener()}getConfigurableSnapshotTime(){try{const e=localStorage.getItem("timer_scheduler_settings");if(e){const s=JSON.parse(e);if(s.snapshotTime&&s.enableSnapshot){const[r,i]=s.snapshotTime.split(":").map(a=>parseInt(a,10));return console.log(` CONFIGURABLE SNAPSHOT: Using settings time ${r}:${i.toString().padStart(2,"0")}`),{hour:r,minute:i}}}}catch(e){console.warn(" SNAPSHOT SETTINGS: Failed to load, using default",e)}return console.log(" SNAPSHOT SERVICE: Using default time 18:00"),{hour:18,minute:0}}setupSettingsListener(){const e=s=>{if(console.log(" SNAPSHOT SETTINGS UPDATE: Timer settings changed, updating snapshot time...",s.detail),s.detail.snapshotTime&&s.detail.enableSnapshot){const[r,i]=s.detail.snapshotTime.split(":").map(a=>parseInt(a,10));this.snapshotTime={hour:r,minute:i},console.log(` SNAPSHOT TIME UPDATED: New time ${r}:${i.toString().padStart(2,"0")}`),this.isScheduled&&(console.log(" RESCHEDULING: Updating snapshot schedule with new time"),this.scheduleNextSnapshot())}else s.detail.enableSnapshot?s.detail.enableSnapshot&&!this.isScheduled&&(console.log(" SNAPSHOT ENABLED: Starting scheduled snapshots"),this.startScheduledSnapshots()):(console.log(" SNAPSHOT DISABLED: Stopping scheduled snapshots"),this.stopScheduledSnapshots())};window.addEventListener("timerSettingsUpdated",e)}restartScheduler(){console.log(" RESTARTING SNAPSHOT SCHEDULER: Applying new settings..."),this.stopScheduledSnapshots(),this.snapshotTime=this.getConfigurableSnapshotTime(),this.getTimerSettings().enableSnapshot?(this.startScheduledSnapshots(),console.log(` SCHEDULER RESTARTED: Now scheduled for ${this.snapshotTime.hour}:${this.snapshotTime.minute.toString().padStart(2,"0")}`)):console.log(" SCHEDULER DISABLED: Snapshots turned off in settings")}startScheduledSnapshots(){if(this.isScheduled){console.log(" SNAPSHOT SERVICE: Already scheduled, skipping");return}if(!this.getTimerSettings().enableSnapshot){console.log(" SNAPSHOT SERVICE: Snapshots disabled in settings, not starting scheduler");return}this.snapshotTime=this.getConfigurableSnapshotTime(),console.log(` SNAPSHOT SERVICE: Starting scheduled snapshots at ${this.snapshotTime.hour}:${this.snapshotTime.minute.toString().padStart(2,"0")}...`),this.isScheduled=!0,this.scheduleNextSnapshot()}getTimerSettings(){try{const e=localStorage.getItem("timer_scheduler_settings");if(e){const s=JSON.parse(e);return{resetTime:s.resetTime||"09:00",snapshotTime:s.snapshotTime||"18:00",enableAutoReset:s.enableAutoReset!==!1,enableSnapshot:s.enableSnapshot!==!1}}}catch(e){console.warn(" SNAPSHOT SETTINGS: Failed to load timer settings",e)}return{resetTime:"09:00",snapshotTime:"18:00",enableAutoReset:!0,enableSnapshot:!0}}stopScheduledSnapshots(){this.scheduledTimeout&&(clearTimeout(this.scheduledTimeout),this.scheduledTimeout=null),this.isScheduled=!1,console.log(" SNAPSHOT SERVICE: Stopped scheduled snapshots")}getMillisecondsUntilNextSnapshot(){const e=new Date,s=new Date;s.setHours(this.snapshotTime.hour,this.snapshotTime.minute,0,0),e>=s&&(s.setDate(s.getDate()+1),s.setHours(this.snapshotTime.hour,this.snapshotTime.minute,0,0));const r=s.getTime()-e.getTime(),i=Math.floor(r/(1e3*60*60)),a=Math.floor(r%(1e3*60*60)/(1e3*60));return console.log(` CONFIGURABLE PRECISION: Next snapshot at ${s.toLocaleString()} (${i}h ${a}m away)`),console.log(` CONFIGURABLE TIMING: ${r}ms until ${this.snapshotTime.hour}:${this.snapshotTime.minute.toString().padStart(2,"0")} snapshot`),r}scheduleNextSnapshot(){this.scheduledTimeout&&(clearTimeout(this.scheduledTimeout),this.scheduledTimeout=null);const e=this.getMillisecondsUntilNextSnapshot(),s=new Date(Date.now()+e);console.log(` CONFIGURABLE SCHEDULER: Next snapshot scheduled for ${s.toLocaleString()}`),console.log(` CONFIGURABLE TIMING: ${e}ms until ${this.snapshotTime.hour}:${this.snapshotTime.minute.toString().padStart(2,"0")} snapshot`),this.scheduledTimeout=setTimeout(()=>{const r=new Date;console.log(` SNAPSHOT TRIGGERED: Scheduled for ${s.toLocaleString()}, actual: ${r.toLocaleString()}`);const i=Math.abs(r.getTime()-s.getTime());i>5e3?console.warn(` SNAPSHOT TIMING WARNING: Triggered ${i}ms off target time`):console.log(` CONFIGURABLE TIMING ACCURATE: Triggered within ${i}ms of ${this.snapshotTime.hour}:${this.snapshotTime.minute.toString().padStart(2,"0")}`),this.performScheduledSnapshot()},e),console.log(` SNAPSHOT ARMED: Next fetch in ${Math.floor(e/1e3/60/60)}h ${Math.floor(e%(1e3*60*60)/(1e3*60))}m ${Math.floor(e%(1e3*60)/1e3)}s`)}async performScheduledSnapshot(){try{console.log(` CONFIGURABLE SCHEDULED SNAPSHOT: Executing at ${this.snapshotTime.hour}:${this.snapshotTime.minute.toString().padStart(2,"0")}...`),console.log(" SCHEDULED DELAY: Waiting 2 seconds to avoid manual snapshot collision..."),await new Promise(s=>setTimeout(s,2e3)),await this.createManualSnapshot(null,!1)?(console.log(` CONFIGURABLE SCHEDULED SNAPSHOT: Successfully created at ${this.snapshotTime.hour}:${this.snapshotTime.minute.toString().padStart(2,"0")}`),console.log(" SNAPSHOT DATA: Time tracking data captured and stored to Firebase")):console.log(" CONFIGURABLE SCHEDULED SNAPSHOT: No active sessions found for snapshot"),this.scheduleNextSnapshot()}catch(e){console.error(" SCHEDULED SNAPSHOT FETCH ERROR:",e),setTimeout(()=>{console.log(" SNAPSHOT RETRY: Attempting snapshot fetch again..."),this.performScheduledSnapshot()},9e5)}}async getActiveSessions(){try{if(!ae)return console.error(" SNAPSHOT SERVICE: Firestore database not available"),[];console.log(" SNAPSHOT SERVICE: Fetching REAL-TIME data from Firebase live_tracking collection...");const e=Pe(ae,"live_tracking"),s=st(e,xt("permanentSession","==",!0)),r=await qe(s),i=[];return console.log(` SNAPSHOT SERVICE: Found ${r.size} documents in Firebase`),r.forEach(a=>{const o=a.data(),l=o.totalSeconds||0,c=o.sessionStart,d=o.lastUpdate,u=Date.now();let f=l;if(o.totalSeconds&&o.totalSeconds>0&&(f=o.totalSeconds,console.log(` Method 1 (Firebase totalSeconds): ${f}s for ${o.employeeName}`)),(!o.totalSeconds||o.totalSeconds===0)&&c){const j=c.toMillis?c.toMillis():new Date(c).getTime();f=Math.floor((u-j)/1e3),console.log(` Method 2 (Calculated from session start): ${f}s for ${o.employeeName}`),console.log(" OFFLINE-SAFE: Calculated using session start time - works regardless of PC/user status")}if((!f||f===0)&&o.sessionDuration&&(f=Math.floor(o.sessionDuration/1e3),console.log(` Method 3 (Session duration): ${f}s for ${o.employeeName}`)),!f||f===0){console.log(` FALLBACK MODE: Using daily reset calculation for ${o.employeeName}`);const j=new Date,L=new Date(j.getFullYear(),j.getMonth(),j.getDate(),6,52,0,0);if(u>=L.getTime())f=Math.floor((u-L.getTime())/1e3),console.log(` Method 4 (Daily reset fallback): ${f}s from 06:52 AM today`),console.log(" GUARANTEED ACCURACY: This method works under ANY condition!");else{const R=new Date(L.getTime()-864e5);f=Math.floor((u-R.getTime())/1e3),console.log(` Method 4 (Yesterday reset fallback): ${f}s from yesterday 06:52 AM`)}}const p={id:a.id,...o,employeeId:o.employeeId||a.id.split("_")[1]||"unknown",employeeName:o.employeeName||"Unknown User",employeeEmail:o.employeeEmail||"",totalSeconds:Math.max(0,f),status:o.status||"active",originalTotalSeconds:o.totalSeconds,sessionStart:o.sessionStart,lastUpdate:o.lastUpdate,syncTimestamp:o.syncTimestamp,sessionDuration:o.sessionDuration};console.log(` SNAPSHOT DATA for ${p.employeeName}:`),console.log(`   - Firebase totalSeconds: ${o.totalSeconds}`),console.log(`   - Calculated totalSeconds: ${f}`),console.log(`   - Session start: ${c?c.toDate?c.toDate().toLocaleString():new Date(c).toLocaleString():"Not available"}`),console.log(`   - Last update: ${d?d.toDate?d.toDate().toLocaleString():new Date(d).toLocaleString():"Not available"}`),console.log(`   - Status: ${o.status}`),i.push(p)}),i.sort((a,o)=>{var d,u,f,p;const l=((u=(d=a.lastUpdate)==null?void 0:d.toMillis)==null?void 0:u.call(d))||a.syncTimestamp||0;return(((p=(f=o.lastUpdate)==null?void 0:f.toMillis)==null?void 0:p.call(f))||o.syncTimestamp||0)-l}),console.log(` SNAPSHOT SERVICE: Processed ${i.length} sessions with REAL-TIME data`),i}catch(e){return console.error(" SNAPSHOT SERVICE: Get active sessions error:",e),console.error(" ERROR DETAILS:",e.message,e.code),[]}}async createSnapshot(e,s=!1){var r,i;try{const a=new Date,o=a.toISOString().split("T")[0];if(console.log(` REAL-TIME SNAPSHOT: Creating snapshot for ${e.employeeName}`),console.log(` SNAPSHOT DEBUG: Using ${e.totalSeconds}s (${Math.floor(e.totalSeconds/60)}min ${e.totalSeconds%60}s)`),s)console.log(` FORCE MODE: Allowing duplicate snapshot creation for ${e.employeeName} on ${o}`);else{const x=await this.getTodaySnapshot(e.employeeId,o);if(x)return console.log(` DUPLICATE PREVENTION: Snapshot already exists for ${e.employeeName} on ${o}`),console.log(` EXISTING SNAPSHOT: ID=${x.id}, Duration=${x.duration}`),!1}const l=e.totalSeconds||0;l===0&&(console.warn(` WARNING: ${e.employeeName} has 0 seconds - checking alternative data sources`),console.log(` Original Firebase totalSeconds: ${e.originalTotalSeconds}`),console.log(` Session duration: ${e.sessionDuration}`),console.log(` Session start: ${e.sessionStart?e.sessionStart.toDate?e.sessionStart.toDate().toLocaleString():"Invalid":"Missing"}`));const c=o.replace(/-/g,""),d=a.getTime(),u=`realtime_${e.employeeId}_${c}_${d}`,f=480,p=Math.floor(l/60),j=Math.min(100,Math.round(p/f*100)),L=this.formatDuration(l),R={snapshotId:u,employeeId:e.employeeId,employeeName:e.employeeName,employeeEmail:e.employeeEmail||"",date:a.toISOString().split("T")[0],percentage:j,duration:L,totalSeconds:l,status:e.status,snapshotTime:We(),snapshotType:"realtime",isManualSnapshot:!0,sessionStart:e.sessionStart,workStartTime:e.sessionStart,lastUpdate:e.lastUpdate,platform:e.platform||"",createdAt:We(),sessionId:e.sessionId||e.id,sessionDuration:e.sessionDuration||Date.now()-(((i=(r=e.sessionStart)==null?void 0:r.toMillis)==null?void 0:i.call(r))||Date.now()),originalFirebaseSeconds:e.originalTotalSeconds,calculationMethod:l===e.originalTotalSeconds?"firebase_direct":e.sessionStart?"calculated_from_start":"session_duration",snapshotTimestamp:Date.now(),realTimeCalculation:!0},D=Pe(ae,"time_tracking_snapshots"),y=await As(D,R);console.log(` REAL-TIME SNAPSHOT CREATED: ${e.employeeName} - ${L} (${j}%)`),console.log(` SNAPSHOT DETAILS: ${l}s total, Method: ${R.calculationMethod}`),console.log(` NEW RECORD CREATED: Document ID = ${y.id}`);let T="Not available";return e.sessionStart&&(e.sessionStart.toMillis?T=new Date(e.sessionStart.toMillis()).toLocaleString():e.sessionStart instanceof Date?T=e.sessionStart.toLocaleString():T=new Date(e.sessionStart).toLocaleString()),console.log(` SESSION START: ${T}`),console.log(` LAST UPDATE: ${e.lastUpdate?e.lastUpdate.toDate?e.lastUpdate.toDate().toLocaleString():"Invalid":"Not available"}`),console.log(` DATA SOURCE: Firebase totalSeconds=${e.originalTotalSeconds}, Calculated=${l}`),l>0?console.log(` SUCCESS: Captured ${l} seconds of real-time data!`):console.warn(" WARNING: Snapshot created but totalSeconds is 0 - check Firebase sync"),!0}catch(a){return console.error(" SNAPSHOT SERVICE: Create snapshot error:",a),!1}}formatDuration(e){const s=Math.floor(e/3600),r=Math.floor(e%3600/60),i=e%60;return`${s.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}async getTodaySnapshot(e,s){try{if(!ae)return null;const r=Pe(ae,"time_tracking_snapshots"),i=st(r,xt("employeeId","==",e),xt("date","==",s)),a=await qe(i);if(!a.empty){const o=a.docs[0],l=o.data();return console.log(` DUPLICATE CHECK: Found existing snapshot for ${e} on ${s}`),{id:o.id,...l}}return console.log(` DUPLICATE CHECK: No existing snapshot for ${e} on ${s}`),null}catch(r){return console.error(" DUPLICATE CHECK: Error checking existing snapshot:",r),null}}async getEmployeeSnapshots(e,s=30){try{if(!ae)return[];const r=Pe(ae,"time_tracking_snapshots"),i=st(r,xt("employeeId","==",e)),a=await qe(i),o=new Map;a.forEach(d=>{var j,L,R,D;const u=d.data(),f={id:d.id,...u,snapshotTime:((L=(j=u.snapshotTime)==null?void 0:j.toDate)==null?void 0:L.call(j))||new Date((D=(R=u.createdAt)==null?void 0:R.toDate)==null?void 0:D.call(R))||new Date},p=u.date;(!o.has(p)||f.snapshotTime>o.get(p).snapshotTime)&&o.set(p,f)});const l=Array.from(o.values());if(l.sort((d,u)=>u.snapshotTime.getTime()-d.snapshotTime.getTime()),a.size!==l.length){const d=a.size-l.length;console.log(` AUTO-DEDUP: Found ${d} duplicate snapshots for employee ${e}, showing ${l.length} unique snapshots`)}const c=l.slice(0,s);return console.log(` SNAPSHOT SERVICE: Returning ${c.length} unique snapshots for employee ${e}`),c}catch(r){return console.error(" SNAPSHOT SERVICE: Get employee snapshots error:",r),[]}}async getAllSnapshots(e=100){try{if(!ae)return[];const s=Pe(ae,"time_tracking_snapshots"),r=await qe(s),i=new Map;r.forEach(l=>{var f,p,j,L;const c=l.data(),d={id:l.id,...c,snapshotTime:((p=(f=c.snapshotTime)==null?void 0:f.toDate)==null?void 0:p.call(f))||new Date((L=(j=c.createdAt)==null?void 0:j.toDate)==null?void 0:L.call(j))||new Date},u=`${c.employeeId}_${c.date}`;(!i.has(u)||d.snapshotTime>i.get(u).snapshotTime)&&i.set(u,d)});const a=Array.from(i.values());if(a.sort((l,c)=>c.snapshotTime.getTime()-l.snapshotTime.getTime()),r.size!==a.length){const l=r.size-a.length;console.log(` AUTO-DEDUP (ALL): Found ${l} duplicate snapshots across all employees, showing ${a.length} unique snapshots`)}const o=a.slice(0,e);return console.log(` SNAPSHOT SERVICE: Found ${o.length} total snapshots`),o}catch(s){return console.error(" SNAPSHOT SERVICE: Get all snapshots error:",s),[]}}async createManualSnapshot(e=null,s=!1){try{console.log(" SNAPSHOT SERVICE: Creating manual snapshot...");const r=`snapshot_lock_${new Date().toISOString().split("T")[0]}`,i=Le(ae,"snapshot_locks",r);try{const u={timestamp:Date.now(),processId:`${Date.now()}_${Math.random().toString(36).substr(2,9)}`,status:"active"};if(await yn(i,u),console.log(" MUTEX ACQUIRED: Got snapshot creation lock"),await new Promise(p=>setTimeout(p,100)),(await qe(st(Pe(ae,"snapshot_locks"),xt("status","==","active")))).size>1)return console.warn(" RACE CONDITION DETECTED: Multiple active locks found, aborting"),await es(i),!1}catch{return console.warn(" SNAPSHOT SERVICE: Could not acquire mutex lock, snapshot may be in progress"),!1}if(this.isCreatingSnapshot)return console.warn(" SNAPSHOT SERVICE: Already creating snapshot, releasing lock and skipping"),await es(i),!1;this.isCreatingSnapshot=!0;const a=await this.getActiveSessions();if(a.length===0)return console.warn(" SNAPSHOT SERVICE: No active sessions found in Firestore"),this.isCreatingSnapshot=!1,!1;console.log(` SNAPSHOT SERVICE: Found ${a.length} total sessions before deduplication`);const o=new Map;a.forEach(u=>{var j,L,R,D;const f=u.employeeId,p=o.get(f);if(!p)o.set(f,u);else{const y=((L=(j=u.lastUpdate)==null?void 0:j.toMillis)==null?void 0:L.call(j))||u.syncTimestamp||0,T=((D=(R=p.lastUpdate)==null?void 0:R.toMillis)==null?void 0:D.call(R))||p.syncTimestamp||0;(y>T||u.totalSeconds>p.totalSeconds)&&o.set(f,u)}});const l=Array.from(o.values());console.log(` DEDUPLICATION: Reduced from ${a.length} to ${l.length} unique sessions`);let c=0;const d=e?l.filter(u=>u.employeeId===e):l;if(d.length===0)return console.warn(" SNAPSHOT SERVICE: No sessions found for processing"),this.isCreatingSnapshot=!1,!1;console.log(` SNAPSHOT SERVICE: Processing ${d.length} unique sessions`);for(const u of d)console.log(` Creating snapshot for: ${u.employeeName} (${u.employeeId})`),await this.createSnapshot(u,s)&&c++;console.log(` SNAPSHOT SERVICE: Manual snapshot complete - ${c} snapshots created`),c>0&&(console.log(" POST-CREATION CLEANUP: Checking for duplicates after snapshot creation..."),setTimeout(async()=>{const u=await this.removeDuplicateSnapshots();u.success&&u.duplicatesRemoved>0&&console.log(` POST-CREATION CLEANUP: Removed ${u.duplicatesRemoved} duplicates`)},1e3));try{await es(i),console.log(" MUTEX RELEASED: Snapshot creation lock released")}catch(u){console.warn(" Could not release mutex lock:",u)}return this.isCreatingSnapshot=!1,c>0}catch(r){console.error(" SNAPSHOT SERVICE: Manual snapshot error:",r);try{const i=`snapshot_lock_${new Date().toISOString().split("T")[0]}`,a=Le(ae,"snapshot_locks",i);await es(a),console.log(" MUTEX RELEASED ON ERROR: Snapshot creation lock released")}catch(i){console.warn(" Could not release mutex lock on error:",i)}return this.isCreatingSnapshot=!1,!1}}getStatus(){const e=this.isScheduled?new Date(Date.now()+this.getMillisecondsUntilNextSnapshot()):null;return{isScheduled:this.isScheduled,nextSnapshotTime:e,nextSnapshotTimeFormatted:e?e.toLocaleString():null,snapshotTime:this.snapshotTime,snapshotTimeFormatted:`${this.snapshotTime.hour}:${this.snapshotTime.minute.toString().padStart(2,"0")}`}}async deleteAllEmployeeSnapshots(e){try{if(!ae)return!1;console.log(" SNAPSHOT SERVICE: Deleting all snapshots for employee:",e);const s=Pe(ae,"time_tracking_snapshots"),r=st(s,xt("employeeId","==",e)),i=await qe(r),a=[];return i.forEach(o=>{a.push(es(o.ref))}),await Promise.all(a),console.log(` SNAPSHOT SERVICE: Deleted ${i.size} snapshots for employee ${e}`),!0}catch(s){return console.error(" SNAPSHOT SERVICE: Delete all snapshots error:",s),!1}}async performAutoCleanup(){try{setTimeout(async()=>{console.log(" AUTO-CLEANUP: Starting automatic duplicate removal...");const e=await this.removeDuplicateSnapshots();e.success&&e.duplicatesRemoved>0?console.log(` AUTO-CLEANUP: Removed ${e.duplicatesRemoved} duplicate snapshots`):e.success?console.log(" AUTO-CLEANUP: No duplicates found"):console.warn(" AUTO-CLEANUP: Failed to remove duplicates:",e.error)},2e3)}catch(e){console.warn(" AUTO-CLEANUP: Error during automatic cleanup:",e)}}setupPeriodicCleanup(){try{this.cleanupInterval&&clearInterval(this.cleanupInterval),this.cleanupInterval=setInterval(async()=>{console.log(" PERIODIC CLEANUP: Running scheduled duplicate removal...");try{const e=await this.removeDuplicateSnapshots();e.success&&e.duplicatesRemoved>0&&console.log(` PERIODIC CLEANUP: Removed ${e.duplicatesRemoved} duplicate snapshots`)}catch(e){console.warn(" PERIODIC CLEANUP: Error during scheduled cleanup:",e)}},18e5),console.log(" PERIODIC CLEANUP: Scheduled to run every 30 minutes")}catch(e){console.warn(" PERIODIC CLEANUP: Error setting up periodic cleanup:",e)}}destroy(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),console.log(" CLEANUP: Cleared periodic cleanup interval")),this.scheduledTimeout&&(clearTimeout(this.scheduledTimeout),console.log(" CLEANUP: Cleared scheduled timeout"))}async removeDuplicateSnapshots(){try{if(console.log(" SNAPSHOT SERVICE: Starting duplicate removal process..."),!ae)return console.error(" Firebase not initialized"),{success:!1,error:"Firebase not initialized"};const e=Pe(ae,"time_tracking_snapshots"),s=await qe(e);console.log(` TOTAL SNAPSHOTS FOUND: ${s.size}`);const r=new Map;s.forEach(l=>{const c=l.data(),d=`${c.employeeId}_${c.date}`;r.has(d)||r.set(d,[]),r.get(d).push({id:l.id,data:c,ref:l.ref})});let i=0,a=0;const o=[];for(const[l,c]of r)if(c.length>1){console.log(` FOUND DUPLICATES: ${l} has ${c.length} snapshots`),a++,c.sort((f,p)=>{var R,D,y,T;const j=((D=(R=f.data.timestamp)==null?void 0:R.toMillis)==null?void 0:D.call(R))||f.data.snapshotTimestamp||0;return(((T=(y=p.data.timestamp)==null?void 0:y.toMillis)==null?void 0:T.call(y))||p.data.snapshotTimestamp||0)-j});const[d,...u]=c;i+=u.length,console.log(` KEEPING: ${d.data.employeeName} - ${d.data.date} (${d.data.duration}) [ID: ${d.id}]`),u.forEach((f,p)=>{console.log(` DELETING DUPLICATE ${p+1}: ${f.data.employeeName} - ${f.data.date} (${f.data.duration}) [ID: ${f.id}]`),o.push(es(f.ref))})}return i===0?(console.log(" NO DUPLICATES FOUND: All snapshots are unique"),{success:!0,duplicatesRemoved:0,employeesAffected:0,totalSnapshots:s.size,message:"No duplicate snapshots found"}):(console.log(` EXECUTING DELETIONS: Removing ${i} duplicate snapshots...`),await Promise.all(o),console.log(" DUPLICATE CLEANUP COMPLETE:"),console.log(`   - Total snapshots processed: ${s.size}`),console.log(`   - Employees with duplicates: ${a}`),console.log(`   - Duplicate snapshots removed: ${i}`),console.log(`   - Remaining snapshots: ${s.size-i}`),{success:!0,duplicatesRemoved:i,employeesAffected:a,totalSnapshots:s.size,remainingSnapshots:s.size-i,message:`Successfully removed ${i} duplicate snapshots affecting ${a} employees`})}catch(e){return console.error(" SNAPSHOT SERVICE: Duplicate removal error:",e),{success:!1,error:e.message,message:"Failed to remove duplicate snapshots"}}}async analyzeDuplicates(){try{if(console.log(" SNAPSHOT SERVICE: Analyzing duplicates..."),!ae)return{success:!1,error:"Firebase not initialized"};const e=Pe(ae,"time_tracking_snapshots"),s=await qe(e),r=new Map,i=[];s.forEach(l=>{var u,f;const c=l.data(),d=`${c.employeeId}_${c.date}`;r.has(d)||r.set(d,[]),r.get(d).push({id:l.id,employeeName:c.employeeName,date:c.date,duration:c.duration,timestamp:((f=(u=c.timestamp)==null?void 0:u.toMillis)==null?void 0:f.call(u))||c.snapshotTimestamp||0})});let a=0,o=0;for(const[l,c]of r)c.length>1&&(o++,a+=c.length-1,i.push({employeeName:c[0].employeeName,date:c[0].date,duplicateCount:c.length,snapshots:c.map(d=>({id:d.id,duration:d.duration,timestamp:d.timestamp}))}));return{success:!0,totalSnapshots:s.size,duplicatesFound:a,employeesAffected:o,duplicateDetails:i,message:a>0?`Found ${a} duplicate snapshots affecting ${o} employees`:"No duplicate snapshots found"}}catch(e){return console.error(" SNAPSHOT SERVICE: Duplicate analysis error:",e),{success:!1,error:e.message}}}}const yh=new T4,It=({show:n=!0,size:e="medium",overlay:s=!0,message:r=" ..."})=>{if(!n)return null;const i=()=>{switch(e){case"small":return"spinner-small";case"large":return"spinner-large";default:return"spinner-medium"}},a=t.jsxs("div",{className:`modern-spinner-container ${i()}`,children:[t.jsxs("div",{className:"modern-spinner",children:[t.jsx("div",{className:"spinner-ring"}),t.jsx("div",{className:"spinner-ring"}),t.jsx("div",{className:"spinner-ring"}),t.jsx("div",{className:"spinner-ring"})]}),r&&t.jsx("div",{className:"spinner-message",children:r})]});return s?t.jsx("div",{className:"modern-spinner-overlay",children:a}):a};class A4{constructor(){this.isActive=!0,this.lastActivityTime=Date.now(),this.inactivityTimer=null,this.currentUserId=null,this.currentEmployeeRef=null,this.isInitialized=!1,this.activityEvents=["mousedown","mousemove","keypress","keydown","keyup","scroll","touchstart","touchmove","click","focus","blur"],this.handleActivity=this.handleActivity.bind(this),this.checkInactivity=this.checkInactivity.bind(this),console.log(" USER ACTIVITY: Service initialized - 20-second inactivity detection")}async initialize(e){try{if(this.isInitialized&&this.currentUserId===e){console.log(" USER ACTIVITY: Already initialized for this user, skipping");return}this.currentUserId&&this.currentUserId!==e&&(console.log(" USER ACTIVITY: Switching user, cleaning up previous monitoring"),await this.cleanup()),console.log(" USER ACTIVITY: Initializing for user:",e),this.currentUserId=e,this.currentEmployeeRef=Le(ae,"employees",e),this.isActive=!0,this.lastActivityTime=Date.now(),this.isInitialized=!0,await this.updateUserStatus("active"),this.startActivityMonitoring(),this.startInactivityTimer(),console.log(" USER ACTIVITY: Monitoring started for user:",e)}catch(s){console.error(" USER ACTIVITY: Initialization error:",s),this.isInitialized=!1}}startActivityMonitoring(){console.log(" USER ACTIVITY: Starting activity event listeners"),this.activityEvents.forEach(e=>{document.addEventListener(e,this.handleActivity,{passive:!0,capture:!1})}),window.addEventListener("focus",this.handleActivity,!1),window.addEventListener("blur",this.handleActivity,!1),document.addEventListener("visibilitychange",()=>{document.hidden?console.log(" USER ACTIVITY: Tab hidden, continuing inactivity monitoring"):this.handleActivity()})}handleActivity(){const e=Date.now();this.lastActivityTime=e,this.isActive||(console.log(" USER ACTIVITY: User became active again"),this.isActive=!0,this.updateUserStatus("active")),this.resetInactivityTimer()}startInactivityTimer(){this.clearInactivityTimer(),this.inactivityTimer=setInterval(()=>{this.checkInactivity()},1e3)}resetInactivityTimer(){this.startInactivityTimer()}clearInactivityTimer(){this.inactivityTimer&&(clearInterval(this.inactivityTimer),this.inactivityTimer=null)}checkInactivity(){if(!this.isInitialized||!this.currentUserId)return;const s=Date.now()-this.lastActivityTime,r=20*1e3;s>=r&&this.isActive&&(console.log(" USER ACTIVITY: User inactive for 20+ seconds, updating status"),this.isActive=!1,this.updateUserStatus("inactive"))}async updateUserStatus(e){try{if(!this.currentEmployeeRef||!this.currentUserId){console.warn(" USER ACTIVITY: Cannot update status - no user reference");return}if(console.log(` USER ACTIVITY: Updating Firebase status to "${e}" for user:`,this.currentUserId),await Qt(this.currentEmployeeRef,{activityStatus:e,lastActivityUpdate:We(),lastActivityTime:new Date,updatedAt:We()}),console.log(` USER ACTIVITY: Firebase status updated to "${e}"`),window.liveTrackingService&&window.liveTrackingService.currentSessionId)try{const s=Le(ae,"live_tracking",window.liveTrackingService.currentSessionId);await Qt(s,{userActivityStatus:e,lastActivityUpdate:We()}),console.log(" USER ACTIVITY: Live tracking status also updated")}catch(s){console.warn(" USER ACTIVITY: Could not update live tracking:",s)}}catch(s){console.error(" USER ACTIVITY: Firebase update error:",s)}}async forceInactive(){console.log(" USER ACTIVITY: Forcing user as inactive"),this.isActive=!1,await this.updateUserStatus("inactive")}async forceActive(){console.log(" USER ACTIVITY: Forcing user as active"),this.isActive=!0,this.lastActivityTime=Date.now(),await this.updateUserStatus("active"),this.resetInactivityTimer()}getStatus(){return{isActive:this.isActive,lastActivityTime:this.lastActivityTime,currentUserId:this.currentUserId,isInitialized:this.isInitialized,timeSinceLastActivity:Date.now()-this.lastActivityTime}}async cleanup(){try{console.log(" USER ACTIVITY: Cleaning up activity monitoring"),this.isInitialized=!1,this.clearInactivityTimer(),this.activityEvents.forEach(e=>{document.removeEventListener(e,this.handleActivity,{passive:!0,capture:!1})}),window.removeEventListener("focus",this.handleActivity,!1),window.removeEventListener("blur",this.handleActivity,!1),this.currentUserId&&await this.updateUserStatus("inactive"),this.currentUserId=null,this.currentEmployeeRef=null,this.isActive=!0,this.lastActivityTime=Date.now(),console.log(" USER ACTIVITY: Cleanup completed")}catch(e){console.error(" USER ACTIVITY: Cleanup error:",e)}}async handlePageUnload(){try{if(console.log(" USER ACTIVITY: Page unloading, marking user as inactive"),this.currentUserId&&this.currentEmployeeRef){const e=JSON.stringify({activityStatus:"inactive",lastActivityUpdate:new Date().toISOString(),pageUnload:!0});navigator.sendBeacon?await this.updateUserStatus("inactive"):await this.updateUserStatus("inactive")}}catch(e){console.error(" USER ACTIVITY: Page unload error:",e)}}}const Vr=new A4;window.addEventListener("beforeunload",()=>{Vr.handlePageUnload()});typeof window<"u"&&(window.userActivityService=Vr,window.checkUserActivity=()=>(console.log(" USER ACTIVITY DEBUG:",Vr.getStatus()),Vr.getStatus()),window.forceUserInactive=()=>(console.log(" TESTING: Forcing user inactive"),Vr.forceInactive()),window.forceUserActive=()=>(console.log(" TESTING: Forcing user active"),Vr.forceActive()));const N1=h.createContext(),Bo=()=>{const n=h.useContext(N1);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n},_4=({children:n})=>{const[e,s]=h.useState(null),[r,i]=h.useState(null),[a,o]=h.useState(!0),[l,c]=h.useState(null),d=async p=>{try{if(!p||p.uid==="demo-user")return console.warn(" No user or demo user detected - clearing data"),i(null),s(null),c("    "),Si.stopAllMonitoring(),null;const j=Le(ae,"employees",p.uid),L=await ss(j);if(console.log(" Employee doc exists:",L.exists()),!L.exists())return console.warn(" No employee record found for user:",p.uid),console.warn(" This usually means the employee document was not created with the Auth UID"),console.log(' To fix: Run window.createEmployeeForUser("'+p.uid+'") in console'),c("       -      "),Si.stopAllMonitoring(),await Vr.cleanup(),null;const R=L.data();if(console.log(" Employee data:",R),R.status!=="active"){console.warn(" Employee account is not active:",R.status),s(null),i(null),c("  .    "),Si.stopAllMonitoring(),await Vr.cleanup();try{await u()}catch(D){console.error("Error signing out inactive user:",D)}return null}return console.log(" Employee access granted:",{uid:p.uid,name:R.fullName,email:R.email,role:R.role||"employee"}),await Si.initializeSession(p),Xs.startStaleSessionMonitoring(2),await Vr.initialize(p.uid),i(R),c(null),R}catch(j){return console.error(" Employee access check failed:",j),console.error(" Error details:",j),c(`     : ${j.message}`),i(null),Si.stopAllMonitoring(),await Vr.cleanup(),null}},u=async()=>{try{Si.stopAllMonitoring(),console.log(" AUTH: Starting sign-out process with live tracking cleanup..."),await Xs.handleSignOut(),Xs.stopStaleSessionMonitoring(),await Vr.cleanup(),await Wl(ut),s(null),i(null),c(null),console.log(" Sign out successful with all tracking cleanup")}catch(p){console.error(" Sign out error:",p)}};if(h.useEffect(()=>{console.log(" Setting up auth state listener...");const p=async D=>{if(e){console.log(" PAGE UNLOAD: Cleaning up live tracking...");try{await Xs.handleSignOut()}catch(y){console.error(" Error during page unload cleanup:",y)}}},j=()=>{document.hidden&&e&&console.log(" PAGE HIDDEN: User may have closed tab/browser")};window.addEventListener("beforeunload",p),document.addEventListener("visibilitychange",j);const L=()=>{window.removeEventListener("beforeunload",p),document.removeEventListener("visibilitychange",j)};let R;try{R=T0(ut,async D=>{console.log(" Auth state changed:",D?`User: ${D.uid}`:"No user"),o(!0);try{if(D){console.log(" User authenticated, checking employee access..."),s(D);const y=await d(D);if(!y||y.status!=="active"){console.warn(" Inactive employee detected on auth state change - forcing logout"),s(null),i(null),c("  .    "),await Vr.cleanup();try{await u()}catch(T){console.error("Error during force logout:",T)}o(!1);return}}else console.log(" User signed out, showing login page"),s(null),i(null),c(null),Si.stopAllMonitoring(),await Vr.cleanup()}catch(y){if(y.message&&y.message.includes("_getRecaptchaConfig")){console.log(" [AuthContext] Ignored reCAPTCHA error:",y.message);return}console.error(" Auth state change error:",y),c("    ")}finally{o(!1)}})}catch(D){D.message&&D.message.includes("_getRecaptchaConfig")?console.log(" [AuthContext] Ignored reCAPTCHA setup error:",D.message):(console.error(" Auth listener setup error:",D),c("    ")),o(!1)}return()=>{if(console.log(" Cleaning up auth listener"),L(),R)try{R()}catch(D){D.message&&D.message.includes("_getRecaptchaConfig")?console.log(" [AuthContext] Ignored reCAPTCHA cleanup error:",D.message):console.error(" Auth cleanup error:",D)}}},[]),a)return t.jsx("div",{className:"min-vh-100 d-flex align-items-center justify-content-center bg-light",children:t.jsxs("div",{className:"text-center",children:[t.jsx(It,{size:"large"}),t.jsxs("div",{className:"mt-3",children:[t.jsx("h5",{className:"text-muted",children:"  ..."}),t.jsx("p",{className:"text-muted small",children:" "}),t.jsx("p",{className:"text-muted small",children:"    5 ..."})]})]})});const f={currentUser:e,employeeData:r,authError:l,signOut:u,isAuthenticated:!!(e&&r&&r.status==="active"&&e.uid!=="demo-user"),isLoading:a,checkEmployeeAccess:d};return t.jsx(N1.Provider,{value:f,children:n})},j1=h.createContext(),Js={getItem:(n,e=null)=>{try{if(typeof window>"u")return e;const s=localStorage.getItem(n);return s!==null?s:e}catch(s){return console.warn("localStorage getItem error:",s),e}},setItem:(n,e)=>{try{return typeof window>"u"?!1:(localStorage.setItem(n,e),!0)}catch(s){return console.warn("localStorage setItem error:",s),!1}}},R4=({children:n})=>{let e=null;try{e=Bo()}catch{console.log(" LIVE TRACKING: AuthContext not available, using fallback data")}const{employeeData:s,currentUser:r}=e||{},i=z=>{const O=(r==null?void 0:r.uid)||(s==null?void 0:s.id)||"anonymous";return`${z}_${O}`},[a,o]=h.useState(()=>{try{const z=(r==null?void 0:r.uid)||(s==null?void 0:s.id)||"anonymous",O=i("PERSISTENT_TIMER_SECONDS"),E=Js.getItem(O),k=E?parseInt(E,10):0;return console.log(" PERSISTENCE: Loaded seconds from storage for user",z,":",k),isNaN(k)?0:k}catch(z){return console.error("Error initializing seconds:",z),0}}),[l,c]=h.useState(!1),[d,u]=h.useState(()=>{try{const z=(r==null?void 0:r.uid)||(s==null?void 0:s.id)||"anonymous",O=i("PERSISTENT_TIMER_SESSION_START"),E=Js.getItem(O),k=E?parseInt(E,10):Date.now();return console.log(" PERSISTENCE: Loaded session start from storage for user",z,":",new Date(k)),isNaN(k)?Date.now():k}catch(z){return console.error("Error initializing session start:",z),Date.now()}}),[f,p]=h.useState(()=>{try{const z=(r==null?void 0:r.uid)||(s==null?void 0:s.id)||"anonymous",O=i("PERSISTENT_TIMER_LAST_RESET_DATE"),k=Js.getItem(O)||new Date().toDateString();return console.log(" PERSISTENCE: Loaded last reset date from storage for user",z,":",k),k}catch(z){return console.error("Error initializing last reset date:",z),new Date().toDateString()}}),j=h.useRef(null),L=h.useRef(null);h.useRef(0);const R=h.useRef(!1),D=(z,O,E)=>{try{Js.setItem(i("PERSISTENT_TIMER_SECONDS"),z.toString()),Js.setItem(i("PERSISTENT_TIMER_SESSION_START"),O.toString()),Js.setItem(i("PERSISTENT_TIMER_LAST_RESET_DATE"),E),console.log(" PERSISTENCE: Saved immediately - seconds:",z,"session:",new Date(O))}catch(k){console.error(" STORAGE ERROR:",k)}},y=()=>{try{const z=localStorage.getItem("timer_scheduler_settings");if(z){const O=JSON.parse(z);return{resetTime:O.resetTime||"09:00",snapshotTime:O.snapshotTime||"18:00",enableAutoReset:O.enableAutoReset!==!1,enableSnapshot:O.enableSnapshot!==!1}}}catch(z){console.warn(" TIMER SETTINGS: Failed to load, using defaults",z)}return{resetTime:"09:00",snapshotTime:"18:00",enableAutoReset:!0,enableSnapshot:!0}},T=()=>{const z=new Date,O=new Date,E=y(),[k,b]=E.resetTime.split(":").map(_=>parseInt(_,10));O.setHours(k,b,0,0),z>=O&&(O.setDate(O.getDate()+1),O.setHours(k,b,0,0));const N=O.getTime()-z.getTime(),I=Math.floor(N/(1e3*60*60)),P=Math.floor(N%(1e3*60*60)/(1e3*60));return console.log(` DEEP THINKING SCHEDULE: Next reset at ${O.toLocaleString()} (${I}h ${P}m away)`),console.log(` CONFIGURABLE TIMING: Reset time set to ${E.resetTime}, enabled: ${E.enableAutoReset}`),E.enableAutoReset?N:null},x=()=>{const z=new Date,O=z.getHours(),E=z.getMinutes(),k=z.toDateString(),b=y(),[N,I]=b.resetTime.split(":").map(C=>parseInt(C,10)),P=O*60+E,_=N*60+I;return console.log(` DEEP THINKING: Analyzing time context - Current: ${z.toLocaleTimeString()}, Reset time: ${b.resetTime}`),P<_?(console.log(` BEFORE RESET TIME (${b.resetTime}): Continuing yesterday's session - preserving session start`),d):!(f===k)&&b.enableAutoReset?(console.log(` FIRST LOGIN AFTER RESET TIME (${b.resetTime}): Starting new business day session`),Date.now()):(console.log(" SESSION CONTINUES: Preserving current session start"),d)},S=()=>{const z=y(),[O,E]=z.resetTime.split(":").map(w=>parseInt(w,10));console.log(` CONFIGURABLE SCHEDULED RESET: Business day reset at ${z.resetTime} - INTELLIGENT TIMER CONTROL`);const k=Date.now(),b=new Date().toDateString(),N=new Date().getHours(),I=new Date().getMinutes(),P=N*60+I,_=O*60+E;console.log(` RESET CONTEXT: Current=${new Date().toLocaleTimeString()}, Reset=${z.resetTime}, Date=${b}`),z.enableAutoReset&&P>=_?(o(0),u(k),p(b),console.log(` BUSINESS DAY STARTED: Timer reset for new work session at ${z.resetTime}`)):(p(b),console.log(` SESSION CONTINUES: Reset disabled or before ${z.resetTime}, session preserved`)),(()=>{try{Js.setItem(i("PERSISTENT_TIMER_SECONDS"),"0"),Js.setItem(i("PERSISTENT_TIMER_SESSION_START"),k.toString()),Js.setItem(i("PERSISTENT_TIMER_LAST_RESET_DATE"),b);const w=Js.getItem(i("PERSISTENT_TIMER_SECONDS")),W=Js.getItem(i("PERSISTENT_TIMER_SESSION_START")),ie=Js.getItem(i("PERSISTENT_TIMER_LAST_RESET_DATE"));w==="0"&&W===k.toString()&&ie===b?console.log(" RESET VERIFIED: Storage save successful and verified"):(console.error(" RESET VERIFICATION FAILED: Storage save may be corrupted"),Js.setItem(i("PERSISTENT_TIMER_SECONDS"),"0"),Js.setItem(i("PERSISTENT_TIMER_SESSION_START"),k.toString()),Js.setItem(i("PERSISTENT_TIMER_LAST_RESET_DATE"),b))}catch(w){console.error(" FORCE STORAGE SAVE ERROR:",w),setTimeout(()=>{try{Js.setItem(i("PERSISTENT_TIMER_SECONDS"),"0"),Js.setItem(i("PERSISTENT_TIMER_SESSION_START"),k.toString()),Js.setItem(i("PERSISTENT_TIMER_LAST_RESET_DATE"),b),console.log(" RETRY SAVE: Successful after error")}catch(W){console.error(" RETRY SAVE FAILED:",W)}},1e3)}})(),(async()=>{try{const w=(r==null?void 0:r.uid)||(s==null?void 0:s.id)||"anonymous";if(console.log(" FORCE FIREBASE: Updating for user:",w),Xs.currentUserId===w)await Xs.updateSessionStart(),console.log(" FORCE FIREBASE: Live tracking updated successfully for user:",w);else if(console.warn(" FORCE FIREBASE: User context mismatch detected!"),console.log("Expected user:",w,"Live tracking user:",Xs.currentUserId),s&&r){const W={id:r.uid,fullName:s.fullName||s.name||"Unknown User",email:s.email||r.email||"",role:s.role||"employee",uid:r.uid};await Xs.startTracking(W),console.log(" FORCE FIREBASE: Re-initialized tracking for correct user")}}catch(w){console.error(" FORCE FIREBASE ERROR:",w),setTimeout(async()=>{try{const W=(r==null?void 0:r.uid)||(s==null?void 0:s.id)||"anonymous";Xs.currentUserId===W&&(await Xs.updateSessionStart(),console.log(" RETRY FIREBASE: Live tracking updated successfully for user:",W))}catch(W){console.error(" RETRY FIREBASE FAILED:",W)}},3e3)}})(),A(),console.log(" RESET COMPLETE: Timer=0, Session=",new Date(k),"Date=",b)},A=()=>{L.current&&(clearTimeout(L.current),L.current=null);const z=T();if(z===null){console.log(" SCHEDULER DISABLED: Auto-reset is turned off in settings");return}const O=new Date(Date.now()+z),E=y();console.log(` CONFIGURABLE SCHEDULER: Scheduling reset for ${O.toLocaleString()}`),console.log(` CUSTOM TIMING: Reset time ${E.resetTime}, timeout: ${z}ms (${Math.round(z/1e3/60)} minutes)`),L.current=setTimeout(()=>{const k=new Date;console.log(` CONFIGURABLE RESET TRIGGERED: Scheduled for ${O.toLocaleString()}, actual: ${k.toLocaleString()}`);const b=Math.abs(k.getTime()-O.getTime());b>5e3?console.warn(` TIMING WARNING: Reset triggered ${b}ms off target time`):console.log(` TIMING ACCURATE: Reset triggered within ${b}ms of target`),S()},z),console.log(` CONFIGURABLE SCHEDULER ARMED: Next reset in ${Math.floor(z/1e3/60/60)}h ${Math.floor(z%(1e3*60*60)/(1e3*60))}m ${Math.floor(z%(1e3*60)/1e3)}s`)},Q=()=>{const z=new Date,O=z.toDateString(),E=z.getHours(),k=z.getMinutes(),b=y(),N=new Date,[I,P]=b.resetTime.split(":").map(ye=>parseInt(ye,10));N.setHours(I,P,0,0);const _=E*60+k,C=I*60+P;if(console.log(` CONFIGURABLE MISSED RESET CHECK: Current=${O}, Last reset=${f}`),console.log(` CONFIGURABLE TIME CHECK: Now=${z.toLocaleTimeString()}, Reset=${b.resetTime}, Enabled=${b.enableAutoReset}`),!b.enableAutoReset)return console.log(" AUTO-RESET DISABLED: Skipping missed reset check"),!1;const U=O===f,W=parseInt(Js.getItem(i("PERSISTENT_TIMER_SECONDS"))||"0")>0;if(U&&_>=C&&W)return console.log(` SINGLE RESET PROTECTION: Same day detected (${O}) and past ${b.resetTime} with timer used - preventing multiple resets`),!1;U&&_>=C&&!W&&console.log(" FORCE RESET ON LOGIN: Same day but timer hasn't been used since last reset - allowing reset");const ie=O!==f,de=_>=C;if(_<C)return console.log(` BEFORE RESET TIME (${b.resetTime}): Continue yesterday's session, no reset needed`),!1;if((ie&&!U||U&&!W)&&de&&b.enableAutoReset){const ye=Math.floor((z-N)/36e5),pe=Math.floor((z-N)%(1e3*60*60)/(1e3*60));return console.log(` CONFIGURABLE RESET DETECTED: ${ye}h ${pe}m after ${b.resetTime} start - performing intelligent reset`),console.log(` CONFIGURABLE LOGIC: New day=${ie}, After reset=${de}, Same day=${U}, Timer used=${W}, Enabled=${b.enableAutoReset}`),S(),!0}else{const ye=de?b.enableAutoReset?U&&W?"Same day with timer used - preventing multiple resets":!ie&&U?"Same day but timer unused - should reset above":"Already handled today":"Auto-reset disabled":`Before ${b.resetTime} - continue yesterday`;return console.log(` NO CONFIGURABLE RESET: ${ye} (Time: ${z.toLocaleTimeString()})`),!1}},q=()=>{try{const z=new Date().toDateString(),O=Js.getItem(i("PERSISTENT_TIMER_LAST_RESET_DATE")),E=parseInt(Js.getItem(i("PERSISTENT_TIMER_SECONDS"))||"0");console.log(` GLOBAL RESET CHECK: Current date=${z}, Last reset=${O}, Timer seconds=${E}`);const k=z===O,b=E===0,N=k&&b;return console.log(` GLOBAL ANALYSIS: Reset today=${k}, Timer reset=${b}, Global handled=${N}`),N}catch(z){return console.error(" GLOBAL RESET CHECK ERROR:",z),!1}};h.useEffect(()=>{const z=O=>{console.log(" SETTINGS UPDATE: Timer settings changed, rescheduling...",O.detail),A()};return window.addEventListener("timerSettingsUpdated",z),()=>{window.removeEventListener("timerSettingsUpdated",z)}},[]),h.useEffect(()=>{var z;try{const O=y();console.log(" CONFIGURABLE PERSISTENCE: Initializing timer system with configurable settings"),console.log(" TIMER CONTEXT: Current settings:",O);const E=((z=performance.navigation)==null?void 0:z.type)===1,k=new Date,b=k.toDateString(),N=new Date,[I,P]=O.resetTime.split(":").map(C=>parseInt(C,10));if(N.setHours(I,P,0,0),console.log(" DEV SERVER CHECK:",{isDevRestart:E,currentDate:b,lastResetDate:f,currentTime:k.toLocaleTimeString(),resetTime:N.toLocaleTimeString()}),q())console.log(" ABSOLUTE PERSISTENCE: Scheduled reset already handled today, just scheduling next"),A();else{const C=b!==f,U=k.getHours(),w=k>=N;if(C&&U>=9&&!(b===f))console.log(" DEEP THINKING: Business reset time detected (9 AM+ on new day) - applying intelligent reset"),Q()||A();else if(U<9&&C){console.log(" EARLY MORNING: Before 9 AM on new day - continuing yesterday's session");const de=x();de!==d&&u(de),A()}else console.log(" DEEP THINKING: Session continues - preserving timer data"),console.log(` Current: ${b}, Last reset: ${f}, Hour: ${U}`),console.log(` Time: ${k.toLocaleTimeString()}, Business reset: ${N.toLocaleTimeString()}`),A()}R.current||(setTimeout(()=>{H()},3e3),R.current=!0),setTimeout(()=>{yh.startScheduledSnapshots(),console.log(" SNAPSHOT SERVICE: Scheduled daily snapshots at 07:18 AM")},4e3)}catch(O){console.error(" INITIALIZATION ERROR:",O)}return()=>{try{L.current&&(clearTimeout(L.current),console.log(" CLEANUP: Cleared scheduled reset")),R.current&&(te(),console.log(" CLEANUP: Stopped live tracking"))}catch(O){console.error(" CLEANUP ERROR:",O)}}},[]),h.useEffect(()=>{s&&r&&R.current&&(Xs.getStatus().isTracking||(console.log(" LIVE TRACKING: Employee data available, restarting live tracking..."),setTimeout(()=>{H()},1e3)))},[s,r]),h.useEffect(()=>{const z=()=>{try{const O=document.visibilityState==="visible";console.log(` VISIBILITY: Tab ${O?"visible":"hidden"}`),c(O),console.log(O?" ABSOLUTE PERSISTENCE: Tab visible - resuming timer counting (NO RESET)":" ABSOLUTE PERSISTENCE: Tab hidden - pausing timer counting (DATA PRESERVED)")}catch(O){console.error(" VISIBILITY CHANGE ERROR:",O),c(!0)}};try{const O=document.visibilityState==="visible";c(O),console.log(" ABSOLUTE PERSISTENCE: Timer initialized with visibility:",O,"(DATA PRESERVED)"),document.addEventListener("visibilitychange",z)}catch(O){console.error(" VISIBILITY SETUP ERROR:",O),c(!0)}return()=>{try{document.removeEventListener("visibilitychange",z)}catch(O){console.error(" VISIBILITY CLEANUP ERROR:",O)}}},[]),h.useEffect(()=>{try{l?(j.current=setInterval(()=>{try{o(z=>{const O=z+1;return D(O,d,f),O})}catch(z){console.error(" TIMER INCREMENT ERROR:",z)}},1e3),console.log(" ABSOLUTE PERSISTENCE: Timer counting active - data continuously saved")):(j.current&&clearInterval(j.current),console.log(" ABSOLUTE PERSISTENCE: Timer paused - all data preserved in storage"))}catch(z){console.error(" TIMER SETUP ERROR:",z)}return()=>{try{j.current&&clearInterval(j.current)}catch(z){console.error(" TIMER CLEANUP ERROR:",z)}}},[l]);const B=z=>{try{const O=Math.max(0,Math.floor(z||0)),E=Math.floor(O/3600),k=Math.floor(O%3600/60),b=O%60;return`${E.toString().padStart(2,"0")}:${k.toString().padStart(2,"0")}:${b.toString().padStart(2,"0")}`}catch(O){return console.error(" FORMAT TIME ERROR:",O),"00:00:00"}},$=()=>{try{const z=(r==null?void 0:r.uid)||(s==null?void 0:s.id)||"anonymous";console.warn(" EMERGENCY RESET: Manual reset triggered for user:",z),console.warn(" WARNING: This should only be used for emergency/admin purposes!");const O=Date.now(),E=new Date().toDateString();o(0),u(O),p(E),Js.setItem(i("PERSISTENT_TIMER_SECONDS"),"0"),Js.setItem(i("PERSISTENT_TIMER_SESSION_START"),O.toString()),Js.setItem(i("PERSISTENT_TIMER_LAST_RESET_DATE"),E),Xs.currentUserId===z?(Xs.updateSessionStart(),console.log(" EMERGENCY RESET: Firebase updated for user:",z)):console.warn(" EMERGENCY RESET: Live tracking user mismatch, skipping Firebase update")}catch(z){console.error(" EMERGENCY RESET ERROR:",z)}},H=async()=>{try{const z=(r==null?void 0:r.uid)||(s==null?void 0:s.id)||"anonymous";console.log(" LIVE TRACKING: Initializing live tracking system for user:",z);let O={};if(s&&r)O={id:r.uid,fullName:s.fullName||s.name||"Unknown User",email:s.email||r.email||"",role:s.role||"employee",uid:r.uid},console.log(" LIVE TRACKING: Using AuthContext employee data for user:",z,O);else try{const k=localStorage.getItem("employeeData");if(k){const b=JSON.parse(k);O={id:b.id||"unknown",fullName:b.fullName||b.name||"Unknown User",email:b.email||"",role:b.role||"employee"}}console.warn(" LIVE TRACKING: Using localStorage fallback data for user:",z,O)}catch(k){console.warn("Could not load employee data for live tracking:",k),O={id:z,fullName:"Anonymous User",email:"",role:"unknown"}}Xs.currentUserId&&Xs.currentUserId!==O.id&&(console.warn(" LIVE TRACKING: User context change detected, stopping previous session"),await Xs.stopTracking()),await Xs.startTracking(O)?(console.log(" LIVE TRACKING: Successfully started live tracking for user:",z),Xs.listenToSessionUpdates(k=>{k.employeeId===z?k.status!=="active"&&console.log(" LIVE TRACKING: Session status changed for user:",z,k.status):console.warn(" LIVE TRACKING: Received session data for different user:",k.employeeId,"Expected:",z)})):console.error(" LIVE TRACKING: Failed to start live tracking for user:",z)}catch(z){console.error(" LIVE TRACKING: Initialization error:",z)}},te=async()=>{try{await Xs.stopTracking(),console.log(" LIVE TRACKING: Stopped live tracking")}catch(z){console.error(" LIVE TRACKING: Stop error:",z)}},G=()=>Xs.getStatus(),F=(z="Manual pause")=>{console.log(" TIMER PAUSE: Pausing timer -",z),c(!1)},X=(z="Manual resume")=>{console.log(" TIMER RESUME: Resuming timer -",z),c(!0)},ue=()=>l,Y={timeSpent:Math.max(0,a||0),dailyTime:Math.max(0,Math.floor((a||0)/60)),isActive:!!l,sessionStart:new Date(d||Date.now()),formatTime:B,resetTimer:$,startLiveTracking:H,stopLiveTracking:te,getLiveTrackingStatus:G,liveTrackingService:Xs,pauseTimer:F,resumeTimer:X,isTimerRunning:ue};return t.jsx(j1.Provider,{value:Y,children:n})},M0=()=>{try{const n=h.useContext(j1);return n===void 0?(console.error(" useTimer must be used within a TimerProvider"),{timeSpent:0,dailyTime:0,isActive:!1,sessionStart:new Date,formatTime:()=>"00:00:00",resetTimer:()=>{},startLiveTracking:()=>{},stopLiveTracking:()=>{},getLiveTrackingStatus:()=>({isTracking:!1}),liveTrackingService:null,pauseTimer:()=>{},resumeTimer:()=>{},isTimerRunning:()=>!1}):n}catch(n){return console.error(" useTimer ERROR:",n),{timeSpent:0,dailyTime:0,isActive:!1,sessionStart:new Date,formatTime:()=>"00:00:00",resetTimer:()=>{},startLiveTracking:()=>{},stopLiveTracking:()=>{},getLiveTrackingStatus:()=>({isTracking:!1}),liveTrackingService:null,pauseTimer:()=>{},resumeTimer:()=>{},isTimerRunning:()=>!1}}},S1=h.createContext(null),Yn=()=>{const n=h.useContext(S1);if(!n)throw new Error("usePermission must be used within a PermissionProvider");return n},D4=({children:n})=>{const[e,s]=h.useState(null),[r,i]=h.useState(null),[a,o]=h.useState({}),[l,c]=h.useState(!1),[d,u]=h.useState(!1),[f,p]=h.useState(!0);h.useEffect(()=>{const T=T0(ut,async x=>{if(console.log(" Auth state changed:",(x==null?void 0:x.email)||"No user"),x)try{const S=Le(ae,"employees",x.uid),A=await ss(S);if(A.exists()){const Q=A.data();console.log(" Employee data loaded:",Q.email,"Role:",Q.role),Q.status!=="active"?(console.warn(" User is not active:",Q.status),s(null),i(null),o({}),c(!0)):(s(x),i(Q.role||null),o(Q.permissions||{}),c(Q.readOnly||!1),u(Q.timerSettingsDisabled||!1))}else console.warn(" Employee document not found for:",x.email),s(x),i(null),o({}),c(!0),u(!1)}catch(S){console.error(" Error fetching employee data:",S),s(null),i(null),o({}),c(!0),u(!1)}else s(null),i(null),o({}),c(!1),u(!1);p(!1)});return()=>T()},[]);const j=T=>!e||!T?!1:a[T]===!0,y={user:e,role:r,permissions:a,readOnly:l,timerSettingsDisabled:d,loading:f,hasPerm:j,hasAny:T=>!e||!Array.isArray(T)?!1:T.some(x=>j(x)),hasAll:T=>!e||!Array.isArray(T)?!1:T.every(x=>j(x)),isReadOnly:()=>l};return t.jsx(S1.Provider,{value:y,children:n})},Mt=({show:n,onClose:e,title:s,message:r,type:i="info",onConfirm:a,confirmText:o="",cancelText:l="",showCancel:c=!1})=>{const[d,u]=wa.useState(!1),[f,p]=wa.useState(!1);if(wa.useEffect(()=>(n?document.body.classList.add("modal-active"):document.body.classList.remove("modal-active"),()=>{document.body.classList.remove("modal-active")}),[n]),!n)return null;const j=()=>{switch(i){case"success":return{icon:"bi-check-circle-fill",color:"text-success",bgColor:"bg-success"};case"error":return{icon:"bi-exclamation-triangle-fill",color:"text-danger",bgColor:"bg-danger"};case"warning":return{icon:"bi-exclamation-triangle",color:"text-warning",bgColor:"bg-warning"};case"confirm":return{icon:"bi-question-circle-fill",color:"text-primary",bgColor:"bg-primary"};default:return{icon:"bi-info-circle-fill",color:"text-info",bgColor:"bg-info"}}},{icon:L,color:R,bgColor:D}=j(),y=x=>{if(d||f){console.log(" EMERGENCY PROTECTION: Click already processed, ignoring"),x==null||x.preventDefault(),x==null||x.stopPropagation();return}console.log(" EMERGENCY FIX: Processing single click"),u(!0),p(!0),x==null||x.preventDefault(),x==null||x.stopPropagation();try{a?(console.log("Calling onConfirm - it should handle closing"),a()):(console.log("No onConfirm, calling onClose directly"),e())}catch(S){console.error("Error in handleConfirm:",S)}setTimeout(()=>{u(!1),p(!1)},1e3)},T=()=>{e()};return t.jsx("div",{className:"modal show d-block custom-alert-overlay",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.8)",position:"fixed",top:0,left:0,right:0,bottom:0,width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx("div",{className:"modal-dialog modal-dialog-centered modal-sm",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",overflow:"hidden"},children:[t.jsx("div",{className:"modal-header border-0 text-white p-3",style:{background:i==="error"?"linear-gradient(135deg, #dc3545 0%, #b02a37 100%)":i==="success"?"linear-gradient(135deg, #28a745 0%, #1e7e34 100%)":i==="warning"?"linear-gradient(135deg, #ffc107 0%, #e0a800 100%)":i==="confirm"?"linear-gradient(135deg, #007bff 0%, #0056b3 100%)":"linear-gradient(135deg, #17a2b8 0%, #138496 100%)"},children:t.jsxs("div",{className:"d-flex align-items-center w-100 justify-content-center",children:[t.jsx("i",{className:`${L} me-2`,style:{fontSize:"20px"}}),t.jsx("h6",{className:"modal-title mb-0 fw-bold",children:s})]})}),t.jsx("div",{className:"modal-body py-4 px-4",children:t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"mb-0",style:{fontSize:"14px",lineHeight:"1.5",color:"#333"},children:r})})}),t.jsx("div",{className:"modal-footer border-0 pt-0 pb-4 d-flex justify-content-center",children:t.jsxs("div",{className:"d-flex gap-3",children:[t.jsx("button",{type:"button",className:"btn btn-sm",onClick:y,disabled:d||f,tabIndex:"1",style:{borderRadius:"8px",height:"36px",fontSize:"13px",fontWeight:"600",width:c?"80px":"100px",background:d||f?"#6c757d":i==="error"?"linear-gradient(135deg, #dc3545 0%, #b02a37 100%)":i==="success"?"linear-gradient(135deg, #28a745 0%, #1e7e34 100%)":i==="warning"?"linear-gradient(135deg, #ffc107 0%, #e0a800 100%)":"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none",color:i==="warning"?"#000":"#fff",opacity:d||f?.6:1,cursor:d||f?"not-allowed":"pointer"},children:o}),c&&t.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:T,tabIndex:"2",style:{borderRadius:"8px",height:"36px",fontSize:"13px",fontWeight:"600",width:"80px",background:"linear-gradient(135deg, #6c757d 0%, #495057 100%)",border:"none",color:"white"},children:l})]})})]})})})},E1=Object.freeze(Object.defineProperty({__proto__:null,default:Mt},Symbol.toStringTag,{value:"Module"})),Bt=()=>{const[n,e]=h.useState({show:!1,title:null,message:null,type:"info",onConfirm:null,confirmText:"",cancelText:"",showCancel:!1}),[s,r]=h.useState(!1);h.useEffect(()=>{console.log("alertConfig changed:",n)},[n]);const i=()=>{if(s){console.log("closeAlert already in progress, ignoring");return}console.log("closeAlert called"),console.log("Current alertConfig before close:",n),r(!0),e(p=>(console.log("Setting show to false"),{...p,show:!1})),setTimeout(()=>{r(!1)},100)},a=p=>{console.log("showAlert called with config:",p);const j={show:!0,title:p.title||"",message:p.message||"",type:p.type||"info",onConfirm:p.onConfirm||null,confirmText:p.confirmText||"",cancelText:p.cancelText||"",showCancel:p.showCancel||!1};console.log("Setting alertConfig to:",j),e(j)};return{alertConfig:n,closeAlert:i,showAlert:a,showSuccess:(p,j=" ")=>{console.log("showSuccess called:",p,j),a({title:j,message:p,type:"success",confirmText:"",onConfirm:null})},showError:(p,j="")=>{a({title:j,message:p,type:"error",confirmText:""})},showWarning:(p,j="")=>{a({title:j,message:p,type:"warning",confirmText:""})},showInfo:(p,j="")=>{a({title:j,message:p,type:"info",confirmText:""})},showConfirm:(p,j,L=" ")=>{a({title:L,message:p,type:"confirm",onConfirm:j,confirmText:"",cancelText:"",showCancel:!0})},showDeleteConfirm:(p,j,L=" ")=>{a({title:L,message:p,type:"confirm",onConfirm:j,confirmText:"",cancelText:"",showCancel:!0})}}},P4=({onSignIn:n})=>{const[e,s]=h.useState({email:"",password:"",rememberMe:!1}),[r,i]=h.useState(!1),[a,o]=h.useState({}),[l,c]=h.useState(!1),{alertConfig:d,closeAlert:u,showError:f,showSuccess:p}=Bt(),[j,L]=h.useState("");h.useEffect(()=>{L("animate-in"),(async()=>{try{await Dr.initialize();const S=Dr.getSetting("rememberedEmail");S&&s(A=>({...A,email:S,rememberMe:!0}))}catch(S){console.error("Error loading remembered email:",S)}})()},[]);const R=x=>{const{name:S,value:A,type:Q,checked:q}=x.target;s(B=>({...B,[S]:Q==="checkbox"?q:A})),a[S]&&o(B=>({...B,[S]:""}))},D=()=>{const x={};return e.email.trim()?/\S+@\S+\.\S+/.test(e.email)||(x.email="   "):x.email="  ",e.password.trim()?e.password.length<6&&(x.password="     6   "):x.password="  ",o(x),Object.keys(x).length===0},y=async x=>{try{const S=Le(ae,"employees",x),A=await ss(S);if(!A.exists())throw new Error("       ");const Q=A.data();if(Q.status!=="active")throw new Error("  .    ");try{await Qt(Le(ae,"employees",x),{lastLoginAt:We(),loginCount:v0(1),updatedAt:We()})}catch(q){console.log("Login tracking update failed:",q)}return Q}catch(S){throw console.error("Employee status check failed:",S),S}},T=async x=>{if(x.preventDefault(),!!D()){i(!0);try{const S=await O5(ut,e.email.trim(),e.password),A=await y(S.user.uid);await Si.initializeSession(S.user),e.rememberMe?await Dr.setSetting("rememberedEmail",e.email.trim()):await Dr.removeSetting("rememberedEmail"),console.log(" Sign-in successful:",{uid:S.user.uid,email:S.user.email,employeeName:A.fullName,role:A.role||"employee"}),p(`  ${A.fullName}`,"   "),n&&n({user:S.user,employee:A})}catch(S){console.error("Sign-in error:",S);let A="   ";switch(S.code){case"auth/user-not-found":case"auth/wrong-password":case"auth/invalid-credential":A="      ";break;case"auth/user-disabled":A="   .    ";break;case"auth/too-many-requests":A="  .   ";break;case"auth/network-request-failed":A="  .    ";break;default:A=S.message||"  ";break}f(A,"   ")}finally{i(!1)}}};return t.jsxs("div",{className:`login-page ${j}`,children:[t.jsx("div",{className:"login-background",children:t.jsx("div",{className:"login-container",children:t.jsxs("div",{className:"row min-vh-100 g-0",children:[t.jsx("div",{className:"col-lg-6",children:t.jsxs("div",{className:"login-form-panel",children:[t.jsxs("div",{className:"login-form-container",children:[t.jsxs("div",{className:"mobile-logo d-lg-none text-center mb-4",children:[t.jsx("div",{className:"logo-circle-small",children:t.jsx("i",{className:"bi bi-building-fill"})}),t.jsx("h4",{className:"mt-3 mb-0",children:"  "}),t.jsx("p",{className:"text-muted small",children:"  "})]}),t.jsxs("div",{className:"login-form",children:[t.jsxs("div",{className:"form-header text-center mb-4",children:[t.jsx("h3",{className:"login-title",children:" "}),t.jsx("p",{className:"login-subtitle text-muted",children:"    "})]}),t.jsxs("form",{onSubmit:T,className:"needs-validation",noValidate:!0,children:[t.jsxs("div",{className:"form-group mb-3",children:[t.jsx("label",{className:"form-label",children:" "}),t.jsxs("div",{className:"input-group input-group-modern",children:[t.jsx("span",{className:"input-group-text",children:t.jsx("i",{className:"bi bi-envelope"})}),t.jsx("input",{type:"email",className:`form-control ${a.email?"is-invalid":""}`,name:"email",value:e.email,onChange:R,placeholder:"  ",disabled:r,autoComplete:"email"}),a.email&&t.jsx("div",{className:"invalid-feedback",children:a.email})]})]}),t.jsxs("div",{className:"form-group mb-3",children:[t.jsx("label",{className:"form-label",children:" "}),t.jsxs("div",{className:"input-group input-group-modern",children:[t.jsx("span",{className:"input-group-text",children:t.jsx("i",{className:"bi bi-lock"})}),t.jsx("input",{type:l?"text":"password",className:`form-control ${a.password?"is-invalid":""}`,name:"password",value:e.password,onChange:R,placeholder:"  ",disabled:r,autoComplete:"current-password"}),t.jsx("button",{type:"button",className:"input-group-text btn-show-password",onClick:()=>c(!l),disabled:r,children:t.jsx("i",{className:`bi ${l?"bi-eye-slash":"bi-eye"}`})}),a.password&&t.jsx("div",{className:"invalid-feedback",children:a.password})]})]}),t.jsx("div",{className:"form-group mb-4",children:t.jsxs("div",{className:"form-check",children:[t.jsx("input",{className:"form-check-input",type:"checkbox",name:"rememberMe",checked:e.rememberMe,onChange:R,id:"rememberMe",disabled:r}),t.jsx("label",{className:"form-check-label",htmlFor:"rememberMe",children:"   "})]})}),t.jsx("button",{type:"submit",className:"btn btn-login w-100",disabled:r,children:r?t.jsxs(t.Fragment,{children:[t.jsx(It,{size:"small"}),t.jsx("span",{className:"ms-2",children:"  ..."})]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-box-arrow-in-right me-2"})," "]})})]}),t.jsx("div",{className:"security-notice mt-4",children:t.jsxs("div",{className:"notice-card",children:[t.jsx("div",{className:"notice-icon",children:t.jsx("i",{className:"bi bi-shield-fill-check text-success"})}),t.jsxs("div",{className:"notice-content",children:[t.jsx("h6",{className:"mb-1",children:"  "}),t.jsx("p",{className:"mb-0 small text-muted",children:"     .      ."})]})]})})]})]}),t.jsx("div",{className:"login-footer",children:t.jsx("p",{className:"text-center text-muted small mb-0",children:" 2024   .   ."})})]})}),t.jsx("div",{className:"col-lg-6 d-none d-lg-flex",children:t.jsxs("div",{className:"login-brand-panel",children:[t.jsxs("div",{className:"brand-content",children:[t.jsx("div",{className:"company-logo mb-4",children:t.jsx("div",{className:"logo-circle",children:t.jsx("i",{className:"bi bi-building-fill"})})}),t.jsxs("div",{className:"company-info text-center mb-5",children:[t.jsx("h2",{className:"company-name",children:"  "}),t.jsx("p",{className:"company-subtitle",children:"    "}),t.jsxs("div",{className:"company-features mt-4",children:[t.jsxs("div",{className:"feature-item",children:[t.jsx("i",{className:"bi bi-check-circle-fill feature-icon"}),t.jsx("span",{children:"  "})]}),t.jsxs("div",{className:"feature-item",children:[t.jsx("i",{className:"bi bi-check-circle-fill feature-icon"}),t.jsx("span",{children:"  "})]}),t.jsxs("div",{className:"feature-item",children:[t.jsx("i",{className:"bi bi-check-circle-fill feature-icon"}),t.jsx("span",{children:"  "})]})]})]})]}),t.jsxs("div",{className:"decorative-elements",children:[t.jsx("div",{className:"floating-card floating-1",children:t.jsx("i",{className:"bi bi-graph-up text-primary"})}),t.jsx("div",{className:"floating-card floating-2",children:t.jsx("i",{className:"bi bi-people text-info"})}),t.jsx("div",{className:"floating-card floating-3",children:t.jsx("i",{className:"bi bi-award text-warning"})})]})]})})]})})}),t.jsx(Mt,{show:d.show,onClose:u,title:d.title,message:d.message,type:d.type,onConfirm:d.onConfirm,confirmText:d.confirmText,cancelText:d.cancelText,showCancel:d.showCancel})]})},Aj=({onSignIn:n})=>t.jsx(P4,{onSignIn:n}),k4=({children:n})=>{const{currentUser:e,employeeData:s,authError:r,isAuthenticated:i,isLoading:a}=Bo(),{alertConfig:o,closeAlert:l,showError:c}=Bt();return wa.useEffect(()=>{r&&c(r,"  ")},[r,c]),a?null:(console.log(" ProtectedRoute Debug:",{isAuthenticated:i,hasCurrentUser:!!e,currentUserUid:e==null?void 0:e.uid,hasEmployeeData:!!s,employeeDataStatus:s==null?void 0:s.status,isLoading:a}),(e==null?void 0:e.uid)==="demo-user"?(console.error(" DEMO USER DETECTED - BLOCKING ACCESS"),t.jsxs(t.Fragment,{children:[t.jsx(Aj,{onSignIn:d=>{console.log(" User signed in successfully:",d)}}),t.jsx(Mt,{show:!0,onClose:()=>window.location.reload(),title:"  ",message:"    ",type:"error",confirmText:" "})]})):(s&&s.status!=="active"&&console.warn(" Employee is inactive - showing login:",{uid:e==null?void 0:e.uid,status:s.status,name:s.fullName}),!i||!e||!s||s.status!=="active"?t.jsxs(t.Fragment,{children:[t.jsx(Aj,{onSignIn:d=>{console.log(" User signed in successfully:",d)}}),t.jsx(Mt,{show:o.show,onClose:l,title:o.title,message:o.message,type:o.type,onConfirm:o.onConfirm,confirmText:o.confirmText,cancelText:o.cancelText,showCancel:o.showCancel})]}):(console.log(" SUCCESS! Rendering dashboard for authenticated user:",s.fullName),console.log(" Navigation successful - user will see dashboard now"),t.jsx("div",{className:"app-wrapper",children:n}))))},L4=({children:n})=>t.jsx(_4,{children:t.jsx(k4,{children:n})});class F4{static async validateCurrentUser(){try{const e=ut.currentUser;if(!e)return console.log(" No current user to validate"),!1;console.log(" Validating current user:",e.uid);const s=Le(ae,"employees",e.uid),r=await ss(s);if(!r.exists())return console.warn(" Employee document not found for current user"),!1;const i=r.data();return i.status!=="active"?(console.warn(" Current user is inactive:",{uid:e.uid,status:i.status,name:i.fullName}),!1):(console.log(" Current user is active:",{uid:e.uid,name:i.fullName,status:i.status}),!0)}catch(e){return console.error(" Error validating current user:",e),!1}}static async enforceActiveUserOnly(){try{console.log(" ENFORCING ACTIVE USER POLICY");const e=await this.validateCurrentUser();if(!e){console.warn(" FORCING LOGOUT - User is not active");const s=confirm(`     .

   .`);return await Wl(ut),window.location.pathname!=="/login"&&(window.location.href="/login"),!1}return e}catch(e){return console.error(" Error enforcing active user policy:",e),!1}}static async clearDemoMode(){try{console.log(" CLEARING DEMO MODE"),await Wl(ut),localStorage.clear(),sessionStorage.clear(),console.log(" Demo mode cleared - page will reload"),window.location.reload()}catch(e){console.error(" Error clearing demo mode:",e),window.location.reload()}}static exposeGlobalMethods(){typeof window<"u"&&(window.checkUserStatus=()=>this.validateCurrentUser(),window.enforceActiveUser=()=>this.enforceActiveUserOnly(),window.clearDemoMode=()=>this.clearDemoMode(),console.log(" Session validator methods exposed:"),console.log("   - window.checkUserStatus() - Check if current user is active"),console.log("   - window.enforceActiveUser() - Force logout inactive users"),console.log("   - window.clearDemoMode() - Clear demo mode and force real auth"))}}F4.exposeGlobalMethods();class O4{static async clearEverything(){try{console.log(" EMERGENCY CACHE CLEAR - CLEARING EVERYTHING");try{await Wl(ut),console.log(" Firebase signout completed")}catch(e){console.log(" Firebase signout failed:",e.message)}localStorage.clear(),sessionStorage.clear(),document.cookie.split(";").forEach(function(e){document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+new Date().toUTCString()+";path=/")}),window.indexedDB&&(await indexedDB.databases()).forEach(s=>{indexedDB.deleteDatabase(s.name)}),console.log(" All caches cleared - reloading page"),window.location.href=window.location.href}catch(e){console.error(" Error during cache clear:",e),window.location.reload(!0)}}static exposeGlobalMethod(){typeof window<"u"&&(window.clearEverything=()=>this.clearEverything(),console.log(" Emergency cache clear exposed: window.clearEverything()"))}}O4.exposeGlobalMethod();const M4=({children:n})=>{const e=h.useRef(!1),s=()=>{try{console.log(" GLOBAL RESET MANAGER: Starting app-wide reset time check");const i=new Date,a=i.toDateString(),o=new Date;o.setHours(6,52,0,0);const l=localStorage.getItem("PERSISTENT_TIMER_LAST_RESET_DATE");console.log(` GLOBAL CHECK: Current time=${i.toLocaleString()}`),console.log(` GLOBAL CHECK: Reset time today=${o.toLocaleString()}`),console.log(` GLOBAL CHECK: Last reset date=${l}, Current date=${a}`);const c=a!==l,d=i>=o,u=c&&d;if(console.log(` GLOBAL ANALYSIS: New day=${c}, Past 06:52=${d}, Needs reset=${u}`),u){const f=Math.floor((i-o)/36e5),p=Math.floor((i-o)%(1e3*60*60)/(1e3*60));return console.log(` GLOBAL RESET REQUIRED: App started ${f}h ${p}m after reset time`),console.log(" GLOBAL RESET: Performing IMMEDIATE timer reset on app startup"),r(i,a),!0}else return console.log(" GLOBAL CHECK PASSED: No reset needed on app startup"),!1}catch(i){return console.error(" GLOBAL RESET CHECK ERROR:",i),!1}},r=(i,a)=>{try{console.log(" IMMEDIATE GLOBAL RESET: Forcing timer reset BEFORE TimerContext initializes"),localStorage.setItem("PERSISTENT_TIMER_SECONDS","0"),console.log(" RESET 1: Timer seconds forced to 0"),localStorage.setItem("PERSISTENT_TIMER_SESSION_START",i.toString()),console.log(" RESET 2: Session start forced to",new Date(i)),localStorage.setItem("PERSISTENT_TIMER_LAST_RESET_DATE",a),console.log(" RESET 3: Reset date forced to",a);const o=localStorage.getItem("PERSISTENT_TIMER_SECONDS"),l=localStorage.getItem("PERSISTENT_TIMER_SESSION_START"),c=localStorage.getItem("PERSISTENT_TIMER_LAST_RESET_DATE");o==="0"&&l===i.toString()&&c===a?(console.log(" GLOBAL RESET VERIFIED: All timer data successfully reset"),console.log(" VERIFICATION: Timer=0, Session=",new Date(parseInt(l)),"Date=",c)):(console.error(" GLOBAL RESET VERIFICATION FAILED: Some values may not have been set correctly"),console.error("Debug: seconds=",o,"session=",l,"date=",c))}catch(o){console.error(" IMMEDIATE GLOBAL RESET ERROR:",o);try{localStorage.setItem("PERSISTENT_TIMER_SECONDS","0"),localStorage.setItem("PERSISTENT_TIMER_SESSION_START",i.toString()),localStorage.setItem("PERSISTENT_TIMER_LAST_RESET_DATE",a),console.log(" GLOBAL RESET RETRY: Successful on second attempt")}catch(l){console.error(" GLOBAL RESET RETRY FAILED:",l)}}};return h.useEffect(()=>{if(e.current){console.log(" GLOBAL RESET: Already checked, skipping duplicate check");return}console.log(" APP STARTUP: Global Reset Manager initializing..."),e.current=!0;const i=s();console.log(i?" GLOBAL RESET COMPLETE: Timer data reset before TimerContext loads":" GLOBAL CHECK COMPLETE: Timer continues from previous state")},[]),n};let Jp=!1,Ou=null,Mu=null,Mm=!1,Ps=null;function U4(){return Jp}function _j(n){Ps=n,console.log(" TIMER INTEGRATION: Timer callbacks registered")}function C1(){if(Mm)return;console.log(" QUEUING FULLSCREEN: Will restore on next user interaction"),Mm=!0;const n=async e=>{if(!Mm)return;console.log(" USER INTERACTION: Attempting fullscreen restoration via",e.type),Mm=!1,document.removeEventListener("click",n,!0),document.removeEventListener("keydown",n,!0),document.removeEventListener("mousedown",n,!0),document.removeEventListener("touchstart",n,!0),await I1()?(console.log(" GESTURE RESTORE: Successfully restored fullscreen"),Ps!=null&&Ps.resumeTimer&&(Ps.resumeTimer("Fullscreen restored"),console.log(" TIMER INTEGRATION: Timer resumed after fullscreen restoration"))):console.log(" GESTURE RESTORE: Failed to restore fullscreen")};document.addEventListener("click",n,!0),document.addEventListener("keydown",n,!0),document.addEventListener("mousedown",n,!0),document.addEventListener("touchstart",n,!0)}async function I1(){if(document.fullscreenElement)return console.log(" FULLSCREEN CHECK: Already in fullscreen mode"),!0;const n=document.documentElement;try{return n.requestFullscreen?(await n.requestFullscreen(),console.log(" FULLSCREEN RESTORE: Success via requestFullscreen"),!0):n.webkitRequestFullscreen?(await n.webkitRequestFullscreen(),console.log(" FULLSCREEN RESTORE: Success via webkitRequestFullscreen"),!0):n.mozRequestFullScreen?(await n.mozRequestFullScreen(),console.log(" FULLSCREEN RESTORE: Success via mozRequestFullScreen"),!0):n.msRequestFullscreen?(await n.msRequestFullscreen(),console.log(" FULLSCREEN RESTORE: Success via msRequestFullscreen"),!0):(console.log(" FULLSCREEN RESTORE: No fullscreen API available"),!1)}catch(e){return console.log(" FULLSCREEN RESTORE: Error occurred:",e.message),!1}}async function $4(){console.log(" FORCE FULLSCREEN: Attempting immediate restoration");const n=await I1();return n||C1(),n}function Kr(n=15e3){clearTimeout(Ou),clearInterval(Mu),Jp=!0,console.log(" BYPASS ACTIVE: Starting fullscreen bypass for",n,"ms"),Ps!=null&&Ps.pauseTimer&&Ps.isTimerRunning&&Ps.isTimerRunning()&&(Ps.pauseTimer("Fullscreen bypass active - file picker open"),console.log(" TIMER INTEGRATION: Timer paused for fullscreen bypass")),Ou=setTimeout(()=>{console.log(" BYPASS TIMEOUT: Ending bypass after",n,"ms"),Rj()},n),Mu=setInterval(()=>{Jp&&(document.fullscreenElement?(console.log(" PERIODIC CHECK: Still in fullscreen mode"),Ps!=null&&Ps.resumeTimer&&(Ps!=null&&Ps.isTimerRunning)&&!Ps.isTimerRunning()&&(Ps.resumeTimer("Back in fullscreen during bypass"),console.log(" TIMER INTEGRATION: Timer resumed - fullscreen detected during bypass"))):(console.log(" PERIODIC CHECK: Not in fullscreen, queuing restoration"),C1()))},2e3);const e=async()=>{console.log(" WINDOW FOCUS: Ending bypass and attempting restoration"),await $4()&&(Ps!=null&&Ps.resumeTimer)&&(Ps.resumeTimer("Fullscreen restored on window focus"),console.log(" TIMER INTEGRATION: Timer resumed after focus restoration")),Rj(),window.removeEventListener("focus",e,!0)};window.addEventListener("focus",e,!0)}function Rj(){console.log(" ENDING BYPASS: Cleaning up bypass state"),Jp=!1,Ou&&(clearTimeout(Ou),Ou=null),Mu&&(clearInterval(Mu),Mu=null),document.fullscreenElement&&(Ps!=null&&Ps.resumeTimer)?Ps.isTimerRunning&&!Ps.isTimerRunning()&&(Ps.resumeTimer("Bypass ended - in fullscreen"),console.log(" TIMER INTEGRATION: Timer resumed when bypass ended")):document.fullscreenElement||console.log(" TIMER INTEGRATION: Bypass ended but not in fullscreen - timer remains paused")}const z4=()=>{const{pauseTimer:n,resumeTimer:e,isTimerRunning:s}=M0(),r=h.useRef(!1),i=h.useCallback(l=>{n&&n(l)},[n]),a=h.useCallback(l=>{e&&e(l)},[e]),o=h.useCallback(()=>s?s():!1,[s]);return h.useEffect(()=>(!r.current&&n&&e&&s&&(console.log(" FULLSCREEN-TIMER INTEGRATION: Setting up timer callbacks (one-time setup)"),_j({pauseTimer:i,resumeTimer:a,isTimerRunning:o}),console.log(" FULLSCREEN-TIMER INTEGRATION: Timer callbacks registered successfully"),r.current=!0),()=>{r.current&&(console.log(" FULLSCREEN-TIMER INTEGRATION: Cleaning up timer callbacks"),_j(null),r.current=!1)}),[i,a,o,n,e,s]),{pauseTimer:i,resumeTimer:a,isTimerRunning:o}},V4=({children:n})=>(z4(),t.jsx(t.Fragment,{children:n}));function B4(){var X,ue,Y;const[n,e]=h.useState(null),[s,r]=h.useState(!1),[i,a]=h.useState(null),[o,l]=h.useState(new Map),[c,d]=h.useState(new Set),[u,f]=h.useState(!1),[p,j]=h.useState(0),L="GLOBAL_TOAST_ACTIVE",R="GLOBAL_TOAST_TIMESTAMP",D=15e3,y=()=>{const z=window[L]===!0,O=window[R];return z&&O&&Date.now()-O>2e4?(console.log(" GLOBAL TOAST: Cleaning up stale toast"),window[L]=!1,window[R]=null,!1):z},T=z=>{window[L]=z,window[R]=z?Date.now():null,console.log(` GLOBAL TOAST: Global state set to ${z}`)},x="toast_shown_notifications",S="toast_session_id",A=()=>{let z=sessionStorage.getItem(S);return z||(z=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,sessionStorage.setItem(S,z)),z},Q=()=>{try{const z=localStorage.getItem(x);if(z){const O=JSON.parse(z),E=Date.now()-60*60*1e3,k=O.filter(b=>b.timestamp>E);return localStorage.setItem(x,JSON.stringify(k)),new Set(k.map(b=>b.id))}}catch(z){console.error(" Error loading shown notifications:",z)}return new Set},q=z=>{try{const O=localStorage.getItem(x),E=O?JSON.parse(O):[],k={id:z,timestamp:Date.now(),sessionId:A()};E.push(k);const b=E.slice(-100);localStorage.setItem(x,JSON.stringify(b)),console.log(" TOAST: Saved notification to persistent storage:",z)}catch(O){console.error(" Error saving shown notification:",O)}},{employeeData:B}=Bo(),$=async z=>{if(!z)return"  ";if(o.has(z))return o.get(z);try{const O=Le(ae,"employees",z),E=await ss(O);if(!E.exists()){console.warn(" Employee document not found for userId:",z);const N="  ";return l(I=>new Map(I).set(z,N)),N}const k=E.data(),b=(k==null?void 0:k.fullName)||(k==null?void 0:k.name)||"  ";return l(N=>new Map(N).set(z,b)),console.log(" GLOBAL TOAST: Resolved employee name:",{userId:z,name:b,employeeData:k}),b}catch(O){console.error(" Error resolving employee name:",O);const E="";return l(k=>new Map(k).set(z,E)),E}};h.useEffect(()=>()=>{(s||p>0)&&(console.log(" GLOBAL TOAST: Component unmounting, cleaning up global state"),T(!1))},[s,p]),h.useEffect(()=>{const z=()=>{console.log(" GLOBAL TOAST: Page unloading, blocking new toasts"),T(!1)},O=()=>{document.hidden&&(s||p>0)&&(console.log(" GLOBAL TOAST: Page hidden with active toast, cleaning up"),te())};return window.addEventListener("beforeunload",z),document.addEventListener("visibilitychange",O),()=>{window.removeEventListener("beforeunload",z),document.removeEventListener("visibilitychange",O)}},[s,p]),h.useEffect(()=>{let z=null,O=!1;return(async()=>{try{const k=Q();d(k),console.log(" TOAST: Loaded",k.size,"shown notifications from storage"),await ws.initialize(),console.log(" ActivityLogService initialized");const b=ws.activities||[];if(console.log(" Current activities count:",b.length),b.length>0){const N=b[0];console.log(" Setting initial activity ID (no notification):",N.internalId),a(N.internalId)}O=!0,z=ws.addListener(N=>{if(!(!O||u)&&(console.log(" Activity listener triggered, activities count:",(N==null?void 0:N.length)||0),N&&N.length>0)){const I=N[0];if(y()){console.log(" GLOBAL TOAST: Toast globally blocked during activity processing:",I.internalId);return}const P=c.has(I.internalId);if(I&&I.internalId!==i&&!P){const _=new Date(I.timestamp),U=new Date-_;U<3e4?(console.log(" NEW REAL-TIME ACTIVITY DETECTED - showing notification"),console.log(" Activity:",{id:I.internalId,description:I.description,timestamp:I.timestamp,userId:I.userId,ageInSeconds:Math.floor(U/1e3)}),f(!0),a(I.internalId),d(w=>new Set(w).add(I.internalId)),q(I.internalId),setTimeout(()=>{H(I),f(!1)},100)):(console.log(" Activity too old, skipping notification:",Math.floor(U/1e3),"seconds"),a(I.internalId))}else I&&P?console.log(" TOAST: Activity already shown in this session, skipping duplicate:",I.internalId):I&&console.log(" TOAST: Activity already processed:",{id:I.internalId,sameAsLast:I.internalId===i,alreadyShown:P})}})}catch(k){console.error(" Error initializing ActivityLogService:",k)}})(),()=>{z&&z();const k=setInterval(()=>{const b=Q();d(b),console.log(" TOAST: Cleaned up persistent storage, now tracking",b.size,"notifications")},5*60*1e3);return()=>clearInterval(k)}},[]);const H=async z=>{if(y()){console.log(" GLOBAL TOAST: Another toast is globally active, PREVENTING duplicate:",z.internalId);return}if(s&&n){console.log(" TOAST COUNTER: Notification already visible, maintaining counter at 1. Skipping:",z.internalId);return}if(p>=1){console.log(" TOAST COUNTER: Counter at maximum (1), preventing additional toast:",z.internalId);return}T(!0),console.log(" GLOBAL TOAST: Showing notification for activity:",{id:z.internalId,description:z.description,timestamp:z.timestamp,type:z.type,details:z.details,userId:z.userId,fullActivity:z});try{console.log(" GLOBAL TOAST: Resolving user name for userId:",z.userId);const O=await $(z.userId);console.log(" GLOBAL TOAST: User name resolved as:",O);const E={...z,resolvedUserName:O};console.log(" GLOBAL TOAST: Final notification data:",{userName:O,description:z.description,userId:z.userId,resolvedUserName:E.resolvedUserName}),e(E),r(!0),j(1),console.log(" TOAST COUNTER: Counter set to 1 - toast now visible"),window.dispatchEvent(new CustomEvent("showActivityBell")),setTimeout(()=>{te()},D)}catch(O){console.error(" Error resolving user name for notification:",O);const E={...z,resolvedUserName:""};e(E),r(!0),j(1),console.log(" TOAST COUNTER: Counter set to 1 - fallback toast now visible"),window.dispatchEvent(new CustomEvent("showActivityBell")),setTimeout(()=>te(),D)}},te=()=>{r(!1),j(0),console.log(" TOAST COUNTER: Counter reset to 0 - toast hidden"),T(!1),window.dispatchEvent(new CustomEvent("hideActivityBell")),setTimeout(()=>{e(null)},300)},G=z=>{switch(z){case"tender_create":return"bi-plus-circle-fill";case"tender_update":return"bi-pencil-square";case"tender_delete":return"bi-trash-fill";case"item_add":return"bi-bag-plus-fill";case"item_update":return"bi-bag-check-fill";case"item_delete":return"bi-bag-x-fill";case"document_upload":return"bi-cloud-upload-fill";case"document_delete":return"bi-file-earmark-x-fill";case"material_create":return"bi-box-seam";case"material_update":return"bi-box-arrow-up";case"supplier_create":return"bi-person-plus-fill";case"supplier_update":return"bi-person-check-fill";case"user_login":return"bi-door-open-fill";case"user_logout":return"bi-door-closed-fill";case"settings_update":return"bi-gear-fill";default:return"bi-info-circle-fill"}},F=z=>{switch(z){case"tender_create":case"item_add":case"material_create":case"supplier_create":case"document_upload":return"#28a745";case"tender_update":case"item_update":case"material_update":case"supplier_update":case"settings_update":return"#007bff";case"tender_delete":case"item_delete":case"document_delete":return"#dc3545";case"user_login":return"#20c997";case"user_logout":return"#6c757d";default:return"#6f42c1"}};return!n||!s?null:t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"position-fixed",style:{top:"78px",left:"50%",transform:"translateX(-50%)",zIndex:1e4,width:"450px",animation:s?"slideInDown 0.4s ease-out":"slideOutUp 0.3s ease-in"},children:t.jsxs("div",{className:"bg-white border-0 shadow-lg position-relative",style:{borderRadius:"12px",overflow:"hidden",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.12), 0 4px 16px rgba(0, 0, 0, 0.08)",border:`3px solid ${F(n.type)}`,cursor:"default"},children:[t.jsx("div",{className:"position-absolute top-0 start-0",style:{height:"3px",backgroundColor:F(n.type),animation:"progressBar 15s linear forwards",zIndex:1}}),t.jsx("div",{className:"p-4",children:t.jsxs("div",{className:"d-flex align-items-start",children:[t.jsxs("div",{className:"position-relative me-3 flex-shrink-0",children:[t.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px",backgroundColor:F(n.type),boxShadow:`0 4px 12px ${F(n.type)}30`},children:t.jsx("i",{className:`bi ${G(n.type)} text-white fs-5`})}),t.jsx("div",{className:"position-absolute bg-danger text-white rounded-circle d-flex align-items-center justify-content-center fw-bold",style:{top:"-8px",right:"-8px",width:"24px",height:"24px",fontSize:"12px",fontWeight:"700",border:"2px solid white",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",zIndex:10},children:p})]}),t.jsxs("div",{className:"flex-grow-1",style:{minWidth:0},children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("h6",{className:"mb-1 text-dark",children:n.description}),((X=n.details)==null?void 0:X.contextType)&&t.jsx("span",{className:`badge ${n.details.contextType==="manufactured_product"?"bg-secondary":"bg-primary"}`,style:{fontSize:"10px"},children:n.details.contextType==="manufactured_product"?" ":""})]}),t.jsx("span",{className:"badge bg-success",children:""})]}),((ue=n.details)==null?void 0:ue.itemName)&&t.jsx("div",{className:"mb-2",children:t.jsxs("span",{className:"badge bg-light text-dark me-2",style:{fontSize:"11px"},children:[": ",n.details.itemName]})}),t.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[t.jsxs("div",{className:"d-flex align-items-center text-muted small",children:[t.jsx("i",{className:"bi bi-person me-1"}),t.jsx("span",{className:"me-3 fw-semibold",style:{fontSize:"13px"},children:n.resolvedUserName||((Y=n.user)==null?void 0:Y.name)||""})]}),t.jsxs("div",{className:"text-muted small d-flex flex-column align-items-end",children:[t.jsx("div",{style:{direction:"ltr"},children:(()=>{const z=new Date(n.timestamp).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),[O,E]=z.split(" ");return`${O} ${E.toUpperCase()}`})()}),t.jsx("div",{style:{fontSize:"11px",opacity:.8},className:"text-primary",children:new Date(n.timestamp).toLocaleDateString("en-GB")})]})]}),t.jsx("button",{onClick:z=>{z.stopPropagation(),te()},className:"btn btn-link p-0 ms-2",style:{color:"#6c757d",fontSize:"16px",lineHeight:"1",opacity:.3,transition:"opacity 0.3s",position:"absolute",top:"8px",right:"8px",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:z=>z.target.style.opacity="0.8",onMouseOut:z=>z.target.style.opacity="0.3",title:" ",children:t.jsx("i",{className:"bi bi-x-lg"})})]})]})}),t.jsx("div",{className:"position-absolute",style:{top:"12px",left:"12px",width:"8px",height:"8px",backgroundColor:F(n.type),borderRadius:"50%",animation:"pulse 2s infinite",opacity:.8}})]})}),t.jsx("style",{children:`
        @keyframes slideInDown {
          from {
            opacity: 0;
            transform: translateX(-50%) translateY(-20px);
          }
          to {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
          }
        }

        @keyframes slideOutUp {
          from {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
          }
          to {
            opacity: 0;
            transform: translateX(-50%) translateY(-20px);
          }
        }

        @keyframes progressBar {
          from {
            width: 0%;
          }
          to {
            width: 100%;
          }
        }

        @keyframes pulse {
          0% {
            transform: scale(1);
            opacity: 0.8;
          }
          50% {
            transform: scale(1.2);
            opacity: 1;
          }
          100% {
            transform: scale(1);
            opacity: 0.8;
          }
        }

      `})]})}const G4=()=>{console.log(" TESTING: Simulating global reset scenario");const n=new Date;n.setDate(n.getDate()-1);const e=n.toDateString();localStorage.setItem("PERSISTENT_TIMER_SECONDS","3600"),localStorage.setItem("PERSISTENT_TIMER_LAST_RESET_DATE",e),localStorage.setItem("PERSISTENT_TIMER_SESSION_START",n.getTime().toString()),console.log(" TEST SETUP: Old reset date=",e),console.log(" TEST SETUP: Timer seconds=3600 (should trigger reset)"),console.log(" TEST READY: Refresh page to test global reset")},W4=()=>{console.log(" CLEANUP: Clearing test data"),localStorage.removeItem("PERSISTENT_TIMER_SECONDS"),localStorage.removeItem("PERSISTENT_TIMER_LAST_RESET_DATE"),localStorage.removeItem("PERSISTENT_TIMER_SESSION_START"),console.log(" CLEANUP COMPLETE: Test data cleared")};typeof window<"u"&&(window.testGlobalReset=G4,window.resetTestData=W4);const q4=()=>{console.log(" TESTING: Snapshot schedule functionality");const n=yh.getStatus();if(console.log(" SNAPSHOT SERVICE STATUS:"),console.log("- Scheduled:",n.isScheduled),console.log("- Next Snapshot Time:",n.nextSnapshotTimeFormatted),console.log("- Configured Time:",n.snapshotTimeFormatted),n.nextSnapshotTime){const e=new Date,s=n.nextSnapshotTime.getTime()-e.getTime(),r=Math.floor(s/(1e3*60*60)),i=Math.floor(s%(1e3*60*60)/(1e3*60));console.log(` TIME UNTIL SNAPSHOT: ${r}h ${i}m`)}return n},H4=async()=>{console.log(" TESTING: Real-time snapshot creation with enhanced debugging");try{const n=await yh.getActiveSessions();console.log(` PRE-SNAPSHOT CHECK: Found ${n.length} sessions in Firebase`),n.forEach(s=>{console.log(` SESSION: ${s.employeeName}`),console.log(`   - Firebase totalSeconds: ${s.originalTotalSeconds}`),console.log(`   - Calculated totalSeconds: ${s.totalSeconds}`),console.log(`   - Status: ${s.status}`)});const e=await yh.createManualSnapshot();return e?(console.log(" TEST SUCCESS: Real-time snapshot created successfully"),console.log(" Check the detailed logs above for data source verification")):console.log(" TEST WARNING: No snapshots created (no active sessions?)"),e}catch(n){return console.error(" TEST ERROR: Real-time snapshot failed:",n),!1}},Q4=()=>{console.log(" TESTING: Simulating 07:18 AM for immediate test"),console.log(" TIP: Use testManualSnapshot() to test snapshot functionality immediately"),console.log(" TIP: Check browser console at 07:18 AM to see scheduled snapshot")},K4=async()=>{console.log(" TESTING: Fetching recent snapshot history");try{const n=await yh.getAllSnapshots(10);return console.log(` SNAPSHOT HISTORY: Found ${n.length} recent snapshots`),n.forEach((e,s)=>{console.log(`${s+1}. ${e.employeeName} - ${e.duration} (${e.percentage}%) - ${e.snapshotTime.toLocaleString()}`)}),n}catch(n){return console.error(" SNAPSHOT HISTORY ERROR:",n),[]}};typeof window<"u"&&(window.testSnapshotSchedule=q4,window.testManualSnapshot=H4,window.simulateSnapshotTime=Q4,window.getSnapshotHistory=K4,console.log(" SNAPSHOT TESTING: Functions available in console"),console.log("- testSnapshotSchedule() - Check 07:18 AM schedule"),console.log("- testManualSnapshot() - Test snapshot creation"),console.log("- getSnapshotHistory() - View recent snapshots"));const Y4="modulepreload",J4=function(n){return"/"+n},Dj={},Xe=function(e,s,r){let i=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(s.map(c=>{if(c=J4(c),c in Dj)return;Dj[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":Y4,d||(f.as="script"),f.crossOrigin="",f.href=c,l&&f.setAttribute("nonce",l),document.head.appendChild(f),d)return new Promise((p,j)=>{f.addEventListener("load",p),f.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${c}`)))})}))}function a(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&a(l.reason);return e().catch(a)})};class X4{constructor(){this.cloudFunctionUrl="https://us-central1-tender-74a2b.cloudfunctions.net/testStaleDetection"}async testStaleDetection(){try{console.log(" STALE DETECTION: Testing manual stale detection...");const e=await fetch(this.cloudFunctionUrl,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();return console.log(" STALE DETECTION RESULTS:",s),s}catch(e){throw console.error(" STALE DETECTION ERROR:",e),e}}async getCurrentSessions(){try{const{db:e}=await Xe(async()=>{const{db:u}=await Promise.resolve().then(()=>_l);return{db:u}},void 0),{collection:s,query:r,where:i,getDocs:a}=await Xe(async()=>{const{collection:u,query:f,where:p,getDocs:j}=await Promise.resolve().then(()=>Tl);return{collection:u,query:f,where:p,getDocs:j}},void 0);console.log(" Getting current live tracking sessions...");const o=s(e,"live_tracking"),l=r(o),c=await a(l),d=[];return c.forEach(u=>{const f=u.data();let p=null;f.lastUpdate&&f.lastUpdate.toMillis?p=f.lastUpdate.toMillis():f.syncTimestamp&&(p=f.syncTimestamp),d.push({sessionId:u.id,employeeName:f.employeeName,employeeId:f.employeeId,status:f.status,lastUpdate:p?new Date(p).toLocaleString():"Unknown",timeSinceUpdate:p?Date.now()-p:0,isStale:p?Date.now()-p>2e4:!1,data:f})}),console.log(` Found ${d.length} total sessions:`,d),d}catch(e){return console.error(" Error getting sessions:",e),[]}}async createTestStaleSession(){try{const{db:e}=await Xe(async()=>{const{db:d}=await Promise.resolve().then(()=>_l);return{db:d}},void 0),{doc:s,setDoc:r,serverTimestamp:i}=await Xe(async()=>{const{doc:d,setDoc:u,serverTimestamp:f}=await Promise.resolve().then(()=>Tl);return{doc:d,setDoc:u,serverTimestamp:f}},void 0);console.log(" Creating test stale session...");const a=`test_stale_${Date.now()}`,o=new Date(Date.now()-3e4),l={sessionId:a,employeeId:"test-user",employeeName:"Test User",status:"active",lastUpdate:o,syncTimestamp:o.getTime(),testSession:!0,createdForStaleTest:!0,createdAt:i()},c=s(e,"live_tracking",a);return await r(c,l),console.log(" Test stale session created:",a),a}catch(e){throw console.error(" Error creating test stale session:",e),e}}async cleanupTestSessions(){try{const{db:e}=await Xe(async()=>{const{db:f}=await Promise.resolve().then(()=>_l);return{db:f}},void 0),{collection:s,query:r,where:i,getDocs:a,deleteDoc:o}=await Xe(async()=>{const{collection:f,query:p,where:j,getDocs:L,deleteDoc:R}=await Promise.resolve().then(()=>Tl);return{collection:f,query:p,where:j,getDocs:L,deleteDoc:R}},void 0);console.log(" Cleaning up test sessions...");const l=s(e,"live_tracking"),c=r(l,i("testSession","==",!0)),d=await a(c),u=[];return d.forEach(f=>{u.push(o(f.ref))}),await Promise.all(u),console.log(` Cleaned up ${d.size} test sessions`),d.size}catch(e){return console.error(" Error cleaning up test sessions:",e),0}}async runFullTest(){try{console.log(" FULL STALE DETECTION TEST: Starting comprehensive test..."),console.log(" Step 1: Current sessions");const e=await this.getCurrentSessions();console.log(" Step 2: Creating test stale session");const s=await this.createTestStaleSession();console.log(" Step 3: Waiting for session to be recorded..."),await new Promise(o=>setTimeout(o,2e3)),console.log(" Step 4: Running stale detection");const r=await this.testStaleDetection();console.log(" Step 5: Checking updated sessions");const i=await this.getCurrentSessions();console.log(" Step 6: Cleaning up test sessions"),await this.cleanupTestSessions();const a={initialSessions:e.length,testSessionCreated:s,detectionResult:r,finalSessions:i.length,testCompleted:!0,timestamp:new Date().toISOString()};return console.log(" FULL TEST COMPLETED:",a),a}catch(e){throw console.error(" FULL TEST ERROR:",e),e}}}const vc=new X4;typeof window<"u"&&(window.staleDetectionService=vc,window.testStaleDetection=()=>(console.log(" TESTING: Manual stale detection"),vc.testStaleDetection()),window.getCurrentSessions=()=>(console.log(" DEBUGGING: Getting current sessions"),vc.getCurrentSessions()),window.runFullStaleTest=()=>(console.log(" TESTING: Running full stale detection test"),vc.runFullTest()),window.createTestStaleSession=()=>(console.log(" TESTING: Creating test stale session"),vc.createTestStaleSession()),window.cleanupTestSessions=()=>(console.log(" TESTING: Cleaning up test sessions"),vc.cleanupTestSessions()));const T1="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNTguNDMgMTUxLjI4Ij4KICA8ZGVmcz4KICAgIDxzdHlsZT4KICAgICAgLmNscy0xIHsKICAgICAgICBmaWxsOiAjMTBhMGMxOwogICAgICB9CgogICAgICAuY2xzLTIgewogICAgICAgIGZvbnQtZmFtaWx5OiBDYWlyby1Cb2xkLCBDYWlybzsKICAgICAgICBmb250LXNpemU6IDY1cHg7CiAgICAgICAgZm9udC13ZWlnaHQ6IDcwMDsKICAgICAgfQoKICAgICAgLmNscy0zIHsKICAgICAgICBmaWxsOiAjMTg2MmE0OwogICAgICB9CgogICAgICAuY2xzLTQgewogICAgICAgIGZpbGw6IG5vbmU7CiAgICAgICAgc3Ryb2tlOiAjMTg2MmE0OwogICAgICAgIHN0cm9rZS1taXRlcmxpbWl0OiAxMDsKICAgICAgICBzdHJva2Utd2lkdGg6IDRweDsKICAgICAgfQogICAgPC9zdHlsZT4KICA8L2RlZnM+CiAgPGc+CiAgICA8bGluZSBjbGFzcz0iY2xzLTQiIHgxPSIzLjQzIiB5MT0iMTQ1LjIzIiB4Mj0iMzU4LjQzIiB5Mj0iMTQ1LjIzIi8+CiAgICA8bGluZSBjbGFzcz0iY2xzLTMiIHgxPSIzLjQzIiB5MT0iMTQ1LjIzIiB4Mj0iMzU4LjQzIiB5Mj0iMTQ1LjIzIi8+CiAgPC9nPgogIDxwb2x5bGluZSBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMS4xMiA2My44NCA4NC42MSA3LjY0IDk4LjcyIDE0Ljk3IDk4LjcyIDIgMTA4Ljk4IDIgMTA4Ljk4IDE5LjE3IDIwMi43IDY0Ljk4IDM1Mi4yNyA2Mi45NiIvPgogIDx0ZXh0IGNsYXNzPSJjbHMtMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTUuMzQgMTIzLjMzKSI+PHRzcGFuIGNsYXNzPSJjbHMtMSIgeD0iMCIgeT0iMCI+TW9kZXJuIDwvdHNwYW4+PHRzcGFuIGNsYXNzPSJjbHMtMyIgeD0iMjMyLjUiIHk9IjAiPkJpbjwvdHNwYW4+PC90ZXh0Pgo8L3N2Zz4=",A1="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='176.459'%20height='110.288'%20viewBox='0%200%20176.459%20110.288'%3e%3cg%20id='Group_1'%20data-name='Group%201'%20transform='translate(-824.544%20-530.958)'%3e%3crect%20id='Rectangle_4'%20data-name='Rectangle%204'%20width='31.194'%20height='31.194'%20transform='translate(868.659%20553.016)%20rotate(45)'%20fill='%230073d8'%20opacity='0.6'/%3e%3cpath%20id='Rectangle_11'%20data-name='Rectangle%2011'%20d='M0,0H31.194V31.194H4a4,4,0,0,1-4-4Z'%20transform='translate(846.602%20575.073)%20rotate(45)'%20fill='%230073d8'%20opacity='0.8'/%3e%3crect%20id='Rectangle_7'%20data-name='Rectangle%207'%20width='31.194'%20height='31.194'%20transform='translate(912.774%20553.016)%20rotate(45)'%20fill='%230073d8'%20opacity='0.6'/%3e%3crect%20id='Rectangle_9'%20data-name='Rectangle%209'%20width='31.194'%20height='31.194'%20transform='translate(890.716%20575.073)%20rotate(45)'%20fill='%230073d8'%20opacity='0.8'/%3e%3cpath%20id='Rectangle_13'%20data-name='Rectangle%2013'%20d='M0,0H31.194V27.194a4,4,0,0,1-4,4H0Z'%20transform='translate(912.774%20597.131)%20rotate(45)'%20fill='%230073d8'/%3e%3cpath%20id='Rectangle_14'%20data-name='Rectangle%2014'%20d='M0,0H31.194V27.194a4,4,0,0,1-4,4H0Z'%20transform='translate(868.659%20597.131)%20rotate(45)'%20fill='%230073d8'/%3e%3cpath%20id='Rectangle_15'%20data-name='Rectangle%2015'%20d='M0,0H31.194V27.194a4,4,0,0,1-4,4H0Z'%20transform='translate(956.889%20597.131)%20rotate(45)'%20fill='%230073d8'/%3e%3crect%20id='Rectangle_10'%20data-name='Rectangle%2010'%20width='31.194'%20height='31.194'%20transform='translate(934.831%20575.073)%20rotate(45)'%20fill='%230073d8'%20opacity='0.8'/%3e%3cpath%20id='Rectangle_12'%20data-name='Rectangle%2012'%20d='M0,0H27.194a4,4,0,0,1,4,4V31.194H0Z'%20transform='translate(978.946%20575.073)%20rotate(45)'%20fill='%230073d8'%20opacity='0.8'/%3e%3crect%20id='Rectangle_8'%20data-name='Rectangle%208'%20width='31.194'%20height='31.194'%20transform='translate(956.889%20553.016)%20rotate(45)'%20fill='%230073d8'%20opacity='0.6'/%3e%3cpath%20id='Rectangle_5'%20data-name='Rectangle%205'%20d='M3,0H31.194V31.194H0V3A3,3,0,0,1,3,0Z'%20transform='translate(890.716%20530.958)%20rotate(45)'%20fill='%230073d8'%20opacity='0.4'/%3e%3cpath%20id='Rectangle_6'%20data-name='Rectangle%206'%20d='M3,0H31.194V31.194H0V3A3,3,0,0,1,3,0Z'%20transform='translate(934.831%20530.958)%20rotate(45)'%20fill='%230073d8'%20opacity='0.4'/%3e%3c/g%3e%3c/svg%3e",_1="/images/user.png",R1="/images/pdf-icon.png",D1="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='14'%20height='32'%20viewBox='0%200%2014%2032'%3e%3cpath%20id='Path_2'%20data-name='Path%202'%20d='M968.1,368.23v32l-14-15.835Z'%20transform='translate(-954.096%20-368.23)'%20fill='%23ffffff'/%3e%3c/svg%3e",Z4="/images/pattern.jpg",eU="/images/pattern2.jpg",tU="/images/pattern3.jpg",sU="/images/pattern4.jpg",nU="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='6.697'%20height='28.873'%20viewBox='0%200%206.697%2028.873'%3e%3cg%20id='Group_1'%20data-name='Group%201'%20transform='translate(-984.438%20-402.547)'%3e%3cpath%20id='Path_1'%20data-name='Path%201'%20d='M965.5,414l-5.137,6.779,4.861,7.062-4.861,7.041,5.1,7.1'%20transform='translate(25%20-11)'%20fill='none'%20stroke='%23e2dfdc'%20stroke-width='1.5'/%3e%3c/g%3e%3c/svg%3e",rU="/images/dots.svg";class iU{constructor(){this.imageCache=new Map,this.initializeImages()}initializeImages(){this.images={"logo.svg":T1,"logo-sm.svg":A1,"user.png":_1,"pdf-icon.png":R1,"menu-arrow.svg":D1,"pattern.jpg":Z4,"pattern2.jpg":eU,"pattern3.jpg":tU,"pattern4.jpg":sU,"curve-line.svg":nU,"dots.svg":rU}}getImage(e){return this.images[e]?this.images[e]:`/images/${e}`}getAllImages(){return this.images}injectImageCSS(){if(typeof document>"u")return;const e=document.createElement("style");e.id="senior-react-images";const s=document.getElementById("senior-react-images");s&&s.remove();const r=[":root {",`  --image-logo: url("${this.getImage("logo.svg")}");`,`  --image-logo-sm: url("${this.getImage("logo-sm.svg")}");`,`  --image-user: url("${this.getImage("user.png")}");`,`  --image-pdf-icon: url("${this.getImage("pdf-icon.png")}");`,`  --image-menu-arrow: url("${this.getImage("menu-arrow.svg")}");`,`  --image-pattern: url("${this.getImage("pattern.jpg")}");`,`  --image-pattern2: url("${this.getImage("pattern2.jpg")}");`,`  --image-pattern3: url("${this.getImage("pattern3.jpg")}");`,`  --image-pattern4: url("${this.getImage("pattern4.jpg")}");`,`  --image-curve-line: url("${this.getImage("curve-line.svg")}");`,`  --image-dots: url("${this.getImage("dots.svg")}");`,"}","","/* Fix main.scss background images */",".pattern-bg:nth-child(1) { background: var(--image-pattern) !important; }",".pattern-bg:nth-child(2) { background: var(--image-pattern2) !important; }",".pattern-bg:nth-child(3) { background: var(--image-pattern3) !important; }",".pattern-bg:nth-child(4) { background: var(--image-pattern4) !important; }","","/* Fix menu arrow in CSS */",".sidebar-menu > li.active > a::after,",".menu-arrow::before { background: var(--image-menu-arrow) !important; }","","/* Fix curve line */",".curve-line { background: var(--image-curve-line) repeat-y !important; }","","/* Fix dots */",".dots-bg { background: var(--image-dots) no-repeat !important; }"];e.textContent=r.join(`
`),document.head.appendChild(e)}}const Ly=new iU,aU=n=>Ly.getImage(n);typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>Ly.injectImageCSS(),100)}):setTimeout(()=>Ly.injectImageCSS(),100));const oU=(n,e="   ")=>{if(!n||typeof n!="object")return n;const s={...n.props,disabled:!0,"aria-disabled":"true",style:{...n.props.style,opacity:.6,cursor:"not-allowed",pointerEvents:"none"}};e&&!s.title&&(s.title=e);const r=s.onClick;return s.onClick=i=>{i.preventDefault(),i.stopPropagation(),r&&typeof r=="function"&&console.log(" Click blocked due to insufficient permissions")},h.cloneElement(n,s)},P1=(n,e)=>h.Children.map(n,s=>{var a;if(!s||typeof s!="object")return s;const r=["button","input","select","textarea","a"];return typeof s.type=="string"&&r.includes(s.type.toLowerCase())?oU(s,e):(a=s.props)!=null&&a.children?h.cloneElement(s,{...s.props,children:P1(s.props.children,e)}):s}),Tt=({can:n,mode:e="hide",disabledTooltip:s="   ",children:r})=>{const{hasPerm:i,readOnly:a}=Yn(),o=i(n),l=n&&(n.includes(":create")||n.includes(":update")||n.includes(":delete")),c=!o||a&&l;return e==="hide"&&c?null:e==="disable"&&c?P1(r,a&&l?"   -   ":s):r};function _t({isCollapsed:n}){const e=Xr(),[s,r]=h.useState("dashboard"),{hasPerm:i}=Yn(),[a,o]=h.useState(!1),[l,c]=h.useState(!1),[d,u]=h.useState(!1),[f,p]=h.useState(!1),[j,L]=h.useState(!1),[R,D]=h.useState(!1);h.useEffect(()=>{const v=e.pathname;v==="/"||v==="/tender"?(r("dashboard"),c(!1)):v==="/raw-materials"?(r("raw-materials"),c(!0)):v==="/local-products"?(r("local-product"),c(!0)):v==="/foreign-products"?(r("imported-product"),c(!0)):v==="/manufactured-products"?(r("manufactured-product"),c(!0)):v==="/services"||v.startsWith("/services/")?(r("services"),c(!0)):v==="/suppliers/local"?(r("local-suppliers"),u(!0),c(!1)):v==="/suppliers/foreign"?(r("foreign-suppliers"),u(!0),c(!1)):v==="/clients"?(r("clients"),c(!1)):v==="/competitors"?(r("competitors"),c(!1)):v==="/companies"?(r("companies"),c(!1)):v==="/accounts-chart"||v==="/accounts-archive"?(r("accounts-chart"),D(!0),c(!1)):v==="/journal-entry"?(r("journal-entry"),D(!0),c(!1)):v==="/journal-entry-list"?(r("journal-entry-list"),D(!0),c(!1)):v==="/tenders/list"?(r("list"),o(!0),c(!1)):v==="/tenders/add"||v.startsWith("/tenders/edit/")?(r("add"),o(!0),c(!1)):v==="/tenders/tracking"?(r("tracking"),o(!0),c(!1)):v==="/tenders/archive"?(r("archive"),o(!0),c(!1)):v==="/tenders/lost"?(r("lost"),o(!0),c(!1)):v==="/tenders/won"?(r("projects-list"),p(!0),c(!1)):v==="/employees"?(r("employees"),L(!0),c(!1)):v==="/employee-time-tracking"?(r("employee-time-tracking"),L(!0),c(!1)):v==="/curriculum"?(r("curriculum"),L(!0),c(!1)):v==="/projects"||v==="/projects/list"?(r("projects-list"),p(!0),c(!1)):(r("dashboard"),c(!1))},[e.pathname]);const y=[{id:"dashboard",type:"main",component:"dashboard"},{id:"tenders",type:"treeview",component:"tenders"},{id:"tender-details",type:"treeview",component:"tender-details"},{id:"projects",type:"treeview",component:"projects"},{id:"accounts",type:"treeview",component:"accounts"},{id:"hr",type:"treeview",component:"hr"},{id:"suppliers",type:"treeview",component:"suppliers"},{id:"clients",type:"main",component:"clients"},{id:"competitors",type:"main",component:"competitors"},{id:"companies",type:"main",component:"companies"}],T=[{id:"list",type:"sub",component:"list"},{id:"add",type:"sub",component:"add"},{id:"tracking",type:"sub",component:"tracking"},{id:"archive",type:"sub",component:"archive"},{id:"lost",type:"sub",component:"lost"}],x=[{id:"raw-materials",type:"sub",component:"raw-materials"},{id:"local-product",type:"sub",component:"local-product"},{id:"imported-product",type:"sub",component:"imported-product"},{id:"manufactured-product",type:"sub",component:"manufactured-product"},{id:"services",type:"sub",component:"services"}],S=[{id:"local-suppliers",type:"sub",component:"local-suppliers"},{id:"foreign-suppliers",type:"sub",component:"foreign-suppliers"}],A=[{id:"employees",type:"sub",component:"employees"},{id:"employee-time-tracking",type:"sub",component:"employee-time-tracking"},{id:"curriculum",type:"sub",component:"curriculum"}],Q=[{id:"projects-list",type:"sub",component:"projects-list"}],q=[{id:"accounts-chart",type:"sub",component:"accounts-chart"},{id:"journal-entry",type:"sub",component:"journal-entry"},{id:"journal-entry-list",type:"sub",component:"journal-entry-list"}],B=(v,se)=>se,[$,H]=h.useState(()=>B("sidebar-menu-items",y)),[te,G]=h.useState(()=>B("sidebar-tender-sub-items",T)),[F,X]=h.useState(()=>B("sidebar-tender-detail-sub-items",x)),[ue,Y]=h.useState(()=>B("sidebar-supplier-sub-items",S)),[z,O]=h.useState(()=>B("sidebar-hr-sub-items",A)),[E,k]=h.useState(()=>B("sidebar-projects-sub-items",Q)),[b,N]=h.useState(()=>B("sidebar-accounts-sub-items",q)),I=v=>v.filter(se=>i({dashboard:"dashboard:read",tenders:"tenders:read","tender-details":"products:read",suppliers:"suppliers:read",clients:"clients:read",companies:"companies:read",projects:"dashboard:read",accounts:"dashboard:read","accounts-chart":"dashboard:read",hr:"employees:read"}[se.id]||"dashboard:read")),P=(v,se)=>v.filter(re=>{let J="dashboard:read";return se==="tender"?J={list:"tenders:read",add:"tenders:create",tracking:"tenders:read",archive:"tenders:read",lost:"tenders:read"}[re.id]||"tenders:read":se==="tender-detail"?J={"raw-materials":"products:read","local-product":"products:read","imported-product":"products:read","manufactured-product":"products:read",services:"products:read"}[re.id]||"products:read":se==="supplier"?J="suppliers:read":se==="hr"?J="employees:read":(se==="projects"||se==="accounts")&&(J="dashboard:read"),i(J)}),_=I($),C=P(te,"tender"),U=P(F,"tender-detail"),w=P(ue,"supplier"),W=P(z,"hr"),ie=P(E,"projects"),de=P(b,"accounts"),[ne,ye]=h.useState(!1),pe=()=>{ye(!ne)},[be,xe]=h.useState(null),[Ee,Re]=h.useState(null),fe=(v,se,re)=>{xe(se),Re(re),v.dataTransfer.effectAllowed="move"},Ve=v=>{v.preventDefault(),v.dataTransfer.dropEffect="move"},$e=(v,se,re)=>{if(v.preventDefault(),!(!be||be.id===se.id||Ee!==re)){if(re==="main"){const J=[...$],he=J.findIndex(me=>me.id===be.id),Se=J.findIndex(me=>me.id===se.id);J.splice(he,1),J.splice(Se,0,be),H(J)}else if(re==="tender-sub"){const J=[...te],he=J.findIndex(me=>me.id===be.id),Se=J.findIndex(me=>me.id===se.id);J.splice(he,1),J.splice(Se,0,be),G(J)}else if(re==="tender-detail-sub"){const J=[...F],he=J.findIndex(me=>me.id===be.id),Se=J.findIndex(me=>me.id===se.id);J.splice(he,1),J.splice(Se,0,be),X(J)}else if(re==="supplier-sub"){const J=[...ue],he=J.findIndex(me=>me.id===be.id),Se=J.findIndex(me=>me.id===se.id);J.splice(he,1),J.splice(Se,0,be),Y(J)}else if(re==="hr-sub"){const J=[...z],he=J.findIndex(me=>me.id===be.id),Se=J.findIndex(me=>me.id===se.id);J.splice(he,1),J.splice(Se,0,be),O(J)}else if(re==="projects-sub"){const J=[...E],he=J.findIndex(me=>me.id===be.id),Se=J.findIndex(me=>me.id===se.id);J.splice(he,1),J.splice(Se,0,be),k(J)}else if(re==="accounts-sub"){const J=[...b],he=J.findIndex(me=>me.id===be.id),Se=J.findIndex(me=>me.id===se.id);J.splice(he,1),J.splice(Se,0,be),N(J)}xe(null),Re(null)}},et=()=>{xe(null),Re(null)},ze=v=>t.jsx("li",{className:s==="dashboard"?"active current-page":"",style:n?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:be&&be.id===v.id?.5:1,transition:"opacity 0.2s ease"},draggable:!n&&ne,onDragStart:ne?se=>fe(se,v,"main"):void 0,onDragOver:ne?Ve:void 0,onDrop:ne?se=>$e(se,v,"main"):void 0,onDragEnd:ne?et:void 0,children:t.jsxs(zi,{to:"/tender",onClick:se=>{if(se.target.closest(".drag-handle")){se.preventDefault();return}r("dashboard")},style:n?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",width:"100%"},children:[!n&&ne&&t.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),t.jsx("i",{className:"bi bi-pie-chart",style:n?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:s==="dashboard"?"#0073d8 !important":"transparent !important",color:s==="dashboard"?"white !important":"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!n&&t.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:" "})]})},v.id),tt=v=>t.jsxs("li",{className:`treeview ${a?"open":""}`,style:n?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:be&&be.id===v.id?.5:1,transition:"opacity 0.2s ease"},"data-collapsed":n,draggable:!n&&ne,onDragStart:ne?se=>fe(se,v,"main"):void 0,onDragOver:ne?Ve:void 0,onDrop:ne?se=>$e(se,v,"main"):void 0,onDragEnd:ne?et:void 0,children:[t.jsxs("a",{href:"#!",onClick:se=>{if(se.target.closest(".drag-handle")){se.preventDefault();return}const re=!a;re&&(c(!1),u(!1),p(!1),L(!1),D(!1)),o(re)},style:n?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",color:"#4d4d4d !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",color:"#4d4d4d",width:"100%",position:"relative"},children:[!n&&ne&&t.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),t.jsx("i",{className:"bi bi-box-seam",style:n?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:"transparent !important",color:"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!n&&t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flex:1,height:"100%",marginRight:"-3px"},children:[t.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:""}),t.jsx("i",{className:`bi ${a?"bi-chevron-down":"bi-chevron-left"}`,style:{fontSize:"18px",color:"#666666",marginLeft:"9px",transition:"transform 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",background:"none !important",backgroundColor:"transparent !important",lineHeight:"1",verticalAlign:"middle",position:"absolute",left:"2px",top:"50%",transform:"translateY(-50%)"}})]})]}),a&&!n&&t.jsx("ul",{className:"treeview-menu",children:C.map(se=>bt(se))})]},v.id),rt=v=>t.jsxs("li",{className:`treeview ${l?"open":""}`,style:n?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:be&&be.id===v.id?.5:1,transition:"opacity 0.2s ease"},"data-collapsed":n,draggable:!n&&ne,onDragStart:ne?se=>fe(se,v,"main"):void 0,onDragOver:ne?Ve:void 0,onDrop:ne?se=>$e(se,v,"main"):void 0,onDragEnd:ne?et:void 0,children:[t.jsxs("a",{href:"#!",onClick:se=>{if(se.target.closest(".drag-handle")){se.preventDefault();return}const re=!l;re&&(o(!1),u(!1),p(!1),L(!1),D(!1)),c(re)},style:n?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",color:"#4d4d4d !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",color:"#4d4d4d",width:"100%",position:"relative"},children:[!n&&ne&&t.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),t.jsx("i",{className:"bi bi-clipboard-data",style:n?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:"transparent !important",color:"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!n&&t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flex:1,height:"100%",marginRight:"-3px"},children:[t.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:"  "}),t.jsx("i",{className:`bi ${l?"bi-chevron-down":"bi-chevron-left"}`,style:{fontSize:"18px",color:"#666666",marginLeft:"9px",transition:"transform 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",background:"none !important",backgroundColor:"transparent !important",lineHeight:"1",verticalAlign:"middle",position:"absolute",left:"2px",top:"50%",transform:"translateY(-50%)"}})]})]}),l&&!n&&t.jsx("ul",{className:"treeview-menu",children:U.map(se=>At(se))})]},v.id),bt=v=>{const re={list:{to:"/tenders/list",icon:"bi-list-ul",text:" "},add:{to:"/tenders/add",icon:"bi-plus-circle",text:" "},tracking:{to:"/tenders/tracking",icon:"bi-kanban",text:" "},archive:{to:"/tenders/archive",icon:"bi-archive",text:" "},lost:{to:"/tenders/lost",icon:"bi-x-circle",text:" "}}[v.id];if(!re)return null;const J=me=>{me.stopPropagation(),fe(me,v,"tender-sub")},he=me=>{me.stopPropagation(),Ve(me)},Se=me=>{me.stopPropagation(),$e(me,v,"tender-sub")};return t.jsx("li",{className:s===v.id?"active":"",style:{opacity:be&&be.id===v.id?.5:1,transition:"opacity 0.2s ease"},draggable:ne,onDragStart:ne?J:void 0,onDragOver:ne?he:void 0,onDrop:ne?Se:void 0,onDragEnd:ne?et:void 0,children:re.to?t.jsxs(zi,{to:re.to,onClick:me=>{if(me.target.closest(".drag-handle")){me.preventDefault();return}r(v.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[ne&&t.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:me=>me.stopPropagation()}),t.jsx("i",{className:re.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),t.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:re.text})]}):t.jsxs("a",{href:"#!",onClick:me=>{if(me.target.closest(".drag-handle")){me.preventDefault();return}me.preventDefault(),r(v.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[ne&&t.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:me=>me.stopPropagation()}),t.jsx("i",{className:re.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),t.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:re.text})]})},v.id)},At=v=>{const re={"raw-materials":{to:"/raw-materials",icon:"bi-gear",text:" "},"local-product":{to:"/local-products",icon:"bi-house",text:" "},"imported-product":{to:"/foreign-products",icon:"bi-globe",text:" "},"manufactured-product":{to:"/manufactured-products",icon:"bi-tools",text:" "},services:{to:"/services",icon:"bi-wrench-adjustable-circle",text:""}}[v.id];if(!re)return null;const J=ge=>{ge.stopPropagation(),fe(ge,v,"tender-detail-sub")},he=ge=>{ge.stopPropagation(),Ve(ge)},Se=ge=>{ge.stopPropagation(),$e(ge,v,"tender-detail-sub")},me=v.id==="raw-materials"||v.id==="local-product"||v.id==="imported-product"||v.id==="manufactured-product"||v.id==="services";return t.jsx("li",{className:s===v.id?"active":"",style:{opacity:be&&be.id===v.id?.5:1,transition:"opacity 0.2s ease"},draggable:ne,onDragStart:ne?J:void 0,onDragOver:ne?he:void 0,onDrop:ne?Se:void 0,onDragEnd:ne?et:void 0,children:me?t.jsxs(zi,{to:re.to,onClick:ge=>{if(ge.target.closest(".drag-handle")){ge.preventDefault();return}r(v.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[ne&&t.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:ge=>ge.stopPropagation()}),t.jsx("i",{className:re.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),t.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:re.text})]}):t.jsxs("a",{href:"#!",onClick:ge=>{if(ge.target.closest(".drag-handle")){ge.preventDefault();return}ge.preventDefault(),r(v.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[ne&&t.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:ge=>ge.stopPropagation()}),t.jsx("i",{className:re.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),t.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:re.text})]})},v.id)},ns=v=>{const re={"local-suppliers":{to:"/suppliers/local",icon:"bi-house-fill",text:" "},"foreign-suppliers":{to:"/suppliers/foreign",icon:"bi-globe",text:" "}}[v.id];if(!re)return null;const J=me=>{me.stopPropagation(),fe(me,v,"supplier-sub")},he=me=>{me.stopPropagation(),Ve(me)},Se=me=>{me.stopPropagation(),$e(me,v,"supplier-sub")};return t.jsx("li",{className:s===v.id?"active":"",style:{opacity:be&&be.id===v.id?.5:1,transition:"opacity 0.2s ease"},draggable:ne,onDragStart:ne?J:void 0,onDragOver:ne?he:void 0,onDrop:ne?Se:void 0,onDragEnd:ne?et:void 0,children:t.jsxs(zi,{to:re.to,onClick:me=>{if(me.target.closest(".drag-handle")){me.preventDefault();return}r(v.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[ne&&t.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:me=>me.stopPropagation()}),t.jsx("i",{className:re.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),t.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:re.text})]})},v.id)},Ht=v=>t.jsxs("li",{className:`treeview ${d?"open":""}`,style:n?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:be&&be.id===v.id?.5:1,transition:"opacity 0.2s ease"},"data-collapsed":n,draggable:!n&&ne,onDragStart:ne?se=>fe(se,v,"main"):void 0,onDragOver:ne?Ve:void 0,onDrop:ne?se=>$e(se,v,"main"):void 0,onDragEnd:ne?et:void 0,children:[t.jsxs("a",{href:"#!",onClick:se=>{if(se.target.closest(".drag-handle")){se.preventDefault();return}const re=!d;re&&(o(!1),c(!1),p(!1),L(!1),D(!1)),u(re)},style:n?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",color:"#4d4d4d !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",color:"#4d4d4d",width:"100%",position:"relative"},children:[!n&&ne&&t.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),t.jsx("i",{className:"bi bi-people-fill",style:n?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:"transparent !important",color:"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!n&&t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flex:1,height:"100%",marginRight:"-3px"},children:[t.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:""}),t.jsx("i",{className:`bi ${d?"bi-chevron-down":"bi-chevron-left"}`,style:{fontSize:"18px",color:"#666666",marginLeft:"9px",transition:"transform 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",background:"none !important",backgroundColor:"transparent !important",lineHeight:"1",verticalAlign:"middle",position:"absolute",left:"2px",top:"50%",transform:"translateY(-50%)"}})]})]}),d&&!n&&t.jsx("ul",{className:"treeview-menu",children:w.map(se=>ns(se))})]},v.id),is=v=>t.jsx("li",{className:s==="clients"?"active current-page":"",style:n?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:be&&be.id===v.id?.5:1,transition:"opacity 0.2s ease"},draggable:!n&&ne,onDragStart:ne?se=>fe(se,v,"main"):void 0,onDragOver:ne?Ve:void 0,onDrop:ne?se=>$e(se,v,"main"):void 0,onDragEnd:ne?et:void 0,children:t.jsxs(zi,{to:"/clients",onClick:se=>{if(se.target.closest(".drag-handle")){se.preventDefault();return}r("clients")},style:n?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",width:"100%"},children:[!n&&ne&&t.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),t.jsx("i",{className:"bi bi-person-vcard-fill",style:n?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:s==="clients"?"#0073d8 !important":"transparent !important",color:s==="clients"?"white !important":"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!n&&t.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:""})]})},v.id),Oe=v=>t.jsx("li",{className:s==="competitors"?"active current-page":"",style:n?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:be&&be.id===v.id?.5:1,transition:"opacity 0.2s ease"},draggable:!n&&ne,onDragStart:ne?se=>fe(se,v,"main"):void 0,onDragOver:ne?Ve:void 0,onDrop:ne?se=>$e(se,v,"main"):void 0,onDragEnd:ne?et:void 0,children:t.jsxs(zi,{to:"/competitors",onClick:se=>{if(se.target.closest(".drag-handle")){se.preventDefault();return}r("competitors")},style:n?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",width:"100%"},children:[!n&&ne&&t.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),t.jsx("i",{className:"bi bi-trophy-fill",style:n?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:s==="competitors"?"#0073d8 !important":"transparent !important",color:s==="competitors"?"white !important":"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!n&&t.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:""})]})},v.id),it=v=>t.jsx("li",{className:s==="companies"?"active current-page":"",style:n?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:be&&be.id===v.id?.5:1,transition:"opacity 0.2s ease"},draggable:!n&&ne,onDragStart:ne?se=>fe(se,v,"main"):void 0,onDragOver:ne?Ve:void 0,onDrop:ne?se=>$e(se,v,"main"):void 0,onDragEnd:ne?et:void 0,children:t.jsxs(zi,{to:"/companies",onClick:se=>{if(se.target.closest(".drag-handle")){se.preventDefault();return}r("companies")},style:n?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",width:"100%"},children:[!n&&ne&&t.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),t.jsx("i",{className:"bi bi-buildings",style:n?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:s==="companies"?"#0073d8 !important":"transparent !important",color:s==="companies"?"white !important":"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!n&&t.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:""})]})},v.id),Kt=v=>{const re={employees:{to:"/employees",icon:"bi-person-badge-fill",text:""},"employee-time-tracking":{to:"/employee-time-tracking",icon:"bi-speedometer2",text:"  "},curriculum:{to:"/curriculum",icon:"bi-file-earmark-person",text:" "}}[v.id];if(!re)return null;const J=me=>{me.stopPropagation(),fe(me,v,"hr-sub")},he=me=>{me.stopPropagation(),Ve(me)},Se=me=>{me.stopPropagation(),$e(me,v,"hr-sub")};return t.jsx("li",{className:s===v.id?"active":"",style:{opacity:be&&be.id===v.id?.5:1,transition:"opacity 0.2s ease"},draggable:ne,onDragStart:ne?J:void 0,onDragOver:ne?he:void 0,onDrop:ne?Se:void 0,onDragEnd:ne?et:void 0,children:t.jsxs(zi,{to:re.to,onClick:me=>{if(me.target.closest(".drag-handle")){me.preventDefault();return}r(v.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[ne&&t.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:me=>me.stopPropagation()}),t.jsx("i",{className:re.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),t.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:re.text})]})},v.id)},zs=v=>{const re={"accounts-chart":{to:"/accounts-chart",icon:"bi-journal-text",text:" "},"journal-entry":{to:"/journal-entry",icon:"bi-journal-plus",text:"  "},"journal-entry-list":{to:"/journal-entry-list",icon:"bi-journal-bookmark",text:" "}}[v.id];if(!re)return null;const J=me=>{me.stopPropagation(),fe(me,v,"accounts-sub")},he=me=>{me.stopPropagation(),Ve(me)},Se=me=>{me.stopPropagation(),$e(me,v,"accounts-sub")};return t.jsx("li",{className:s===v.id?"active":"",style:{opacity:be&&be.id===v.id?.5:1,transition:"opacity 0.2s ease"},draggable:ne,onDragStart:ne?J:void 0,onDragOver:ne?he:void 0,onDrop:ne?Se:void 0,onDragEnd:ne?et:void 0,children:t.jsxs(zi,{to:re.to,onClick:me=>{if(me.target.closest(".drag-handle")){me.preventDefault();return}r(v.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[ne&&t.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:me=>me.stopPropagation()}),t.jsx("i",{className:re.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),t.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:re.text})]})},v.id)},xs=v=>t.jsxs("li",{className:`treeview ${R?"open":""}`,style:n?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:be&&be.id===v.id?.5:1,transition:"opacity 0.2s ease"},"data-collapsed":n,draggable:!n&&ne,onDragStart:ne?se=>fe(se,v,"main"):void 0,onDragOver:ne?Ve:void 0,onDrop:ne?se=>$e(se,v,"main"):void 0,onDragEnd:ne?et:void 0,children:[t.jsxs("a",{href:"#!",onClick:se=>{if(se.target.closest(".drag-handle")){se.preventDefault();return}const re=!R;re&&(o(!1),c(!1),u(!1),p(!1),L(!1)),D(re)},style:n?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",color:"#4d4d4d !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",color:"#4d4d4d",width:"100%",position:"relative"},children:[!n&&ne&&t.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),t.jsx("i",{className:"bi bi-calculator",style:n?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:"transparent !important",color:"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!n&&t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flex:1,height:"100%",marginRight:"-3px"},children:[t.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:""}),t.jsx("i",{className:`bi ${R?"bi-chevron-down":"bi-chevron-left"}`,style:{fontSize:"18px",color:"#666666",marginLeft:"9px",transition:"transform 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",background:"none !important",backgroundColor:"transparent !important",lineHeight:"1",verticalAlign:"middle",position:"absolute",left:"2px",top:"50%",transform:"translateY(-50%)"}})]})]}),R&&!n&&t.jsx("ul",{className:"treeview-menu",children:de.map(se=>zs(se))})]},v.id),cs=v=>{const re={"projects-list":{to:"/tenders/won",icon:"bi-trophy",text:" "}}[v.id];if(!re)return null;const J=me=>{me.stopPropagation(),fe(me,v,"projects-sub")},he=me=>{me.stopPropagation(),Ve(me)},Se=me=>{me.stopPropagation(),$e(me,v,"projects-sub")};return t.jsx("li",{className:s===v.id?"active":"",style:{opacity:be&&be.id===v.id?.5:1,transition:"opacity 0.2s ease"},draggable:ne,onDragStart:ne?J:void 0,onDragOver:ne?he:void 0,onDrop:ne?Se:void 0,onDragEnd:ne?et:void 0,children:t.jsxs(zi,{to:re.to,onClick:me=>{if(me.target.closest(".drag-handle")){me.preventDefault();return}r(v.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[ne&&t.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:me=>me.stopPropagation()}),t.jsx("i",{className:re.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),t.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:re.text})]})},v.id)},Os=v=>t.jsxs("li",{className:`treeview ${f?"open":""}`,style:n?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:be&&be.id===v.id?.5:1,transition:"opacity 0.2s ease"},"data-collapsed":n,draggable:!n&&ne,onDragStart:ne?se=>fe(se,v,"main"):void 0,onDragOver:ne?Ve:void 0,onDrop:ne?se=>$e(se,v,"main"):void 0,onDragEnd:ne?et:void 0,children:[t.jsxs("a",{href:"#!",onClick:se=>{if(se.target.closest(".drag-handle")){se.preventDefault();return}const re=!f;re&&(o(!1),c(!1),u(!1),L(!1),D(!1)),p(re)},style:n?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",color:"#4d4d4d !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",color:"#4d4d4d",width:"100%",position:"relative"},children:[!n&&ne&&t.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),t.jsx("i",{className:"bi bi-folder-check",style:n?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:"transparent !important",color:"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!n&&t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flex:1,height:"100%",marginRight:"-3px"},children:[t.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:""}),t.jsx("i",{className:`bi ${f?"bi-chevron-down":"bi-chevron-left"}`,style:{fontSize:"18px",color:"#666666",marginLeft:"9px",transition:"transform 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",background:"none !important",backgroundColor:"transparent !important",lineHeight:"1",verticalAlign:"middle",position:"absolute",left:"2px",top:"50%",transform:"translateY(-50%)"}})]})]}),f&&!n&&t.jsx("ul",{className:"treeview-menu",children:ie.map(se=>cs(se))})]},v.id),vs=v=>t.jsxs("li",{className:`treeview ${j?"open":""}`,style:n?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:be&&be.id===v.id?.5:1,transition:"opacity 0.2s ease"},"data-collapsed":n,draggable:!n&&ne,onDragStart:ne?se=>fe(se,v,"main"):void 0,onDragOver:ne?Ve:void 0,onDrop:ne?se=>$e(se,v,"main"):void 0,onDragEnd:ne?et:void 0,children:[t.jsxs("a",{href:"#!",onClick:se=>{if(se.target.closest(".drag-handle")){se.preventDefault();return}const re=!j;re&&(o(!1),c(!1),u(!1),p(!1),D(!1)),L(re)},style:n?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",color:"#4d4d4d !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",color:"#4d4d4d",width:"100%",position:"relative"},children:[!n&&ne&&t.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),t.jsx("i",{className:"bi bi-person-workspace",style:n?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:"transparent !important",color:"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!n&&t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flex:1,height:"100%",marginRight:"-3px"},children:[t.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:" "}),t.jsx("i",{className:`bi ${j?"bi-chevron-down":"bi-chevron-left"}`,style:{fontSize:"18px",color:"#666666",marginLeft:"9px",transition:"transform 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",background:"none !important",backgroundColor:"transparent !important",lineHeight:"1",verticalAlign:"middle",position:"absolute",left:"2px",top:"50%",transform:"translateY(-50%)"}})]})]}),j&&!n&&t.jsx("ul",{className:"treeview-menu",children:W.map(se=>Kt(se))})]},v.id),Z=v=>{switch(v.component){case"dashboard":return ze(v);case"tenders":return tt(v);case"tender-details":return rt(v);case"suppliers":return Ht(v);case"clients":return is(v);case"competitors":return Oe(v);case"companies":return it(v);case"projects":return Os(v);case"accounts":return xs(v);case"hr":return vs(v);default:return null}};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"shop-profile",style:{padding:n?"0.5rem":"1rem",textAlign:n?"center":"right",display:"flex",alignItems:"center",justifyContent:n?"center":"flex-end"},children:n?t.jsx("img",{src:aU("logo.svg"),alt:"Modern Bin",style:{width:"40px",height:"40px",objectFit:"contain"}}):t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"mb-1 fw-bold text-primary",style:{opacity:n?0:1,transition:"opacity 0.3s ease"},children:"  "}),t.jsx("p",{className:"m-0",style:{opacity:n?0:1,transition:"opacity 0.3s ease"},children:""})]})}),t.jsxs("div",{className:"sidebarMenuScroll",style:{position:"relative"},children:[t.jsx("ul",{className:"sidebar-menu",children:_.map(v=>Z(v))}),t.jsx("div",{className:"sidebar-sort-toggle",style:{position:"fixed",right:n?"15px":"20px",bottom:"20px",zIndex:1050,background:ne?"#28a745":"#0d6efd",color:"white",width:n?"46px":"52px",height:n?"46px":"52px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",transition:"all 0.3s ease",transform:"scale(1)"},onClick:pe,onMouseEnter:v=>{v.target.style.transform="scale(1.1)",v.target.style.boxShadow="0 6px 16px rgba(0,0,0,0.2)"},onMouseLeave:v=>{v.target.style.transform="scale(1)",v.target.style.boxShadow="0 4px 12px rgba(0,0,0,0.15)"},title:ne?" ":" ",children:t.jsx("i",{className:`bi ${ne?"bi-arrows-move":"bi-lock"}`,style:{fontSize:n?"18px":"20px",transition:"transform 0.2s ease"}})})]})]})}function lU({show:n,onClose:e}){kt();const{logActivity:s,getCurrentUser:r}=Zt(),{employeeData:i,currentUser:a}=Bo(),{timeSpent:o,dailyTime:l,isActive:c,sessionStart:d,formatTime:u,getLiveTrackingStatus:f}=M0(),[p,j]=h.useState(!1),L=()=>new Date().getDay()===5,R=D=>L()?"":!D||D===0?"0":Math.floor(D/4.8);return h.useEffect(()=>{const D=async()=>{try{const y=(a==null?void 0:a.uid)||(i==null?void 0:i.id)||"anonymous",T=f(),x=T.isTracking&&(T.sessionId===`user_${y}`||T.sessionId===`user_${a==null?void 0:a.uid}`);j(x),!x&&T.isTracking&&(console.warn(" ANALYTICS: Firebase connected but for different user!"),console.log("Expected session:",`user_${y}`,"Actual:",T.sessionId))}catch{j(!1)}};if(n){D();const y=setInterval(D,3e3);return()=>clearInterval(y)}},[n,f,a,i]),h.useEffect(()=>{const D=y=>{y.keyCode===27&&n&&e()};return document.addEventListener("keydown",D),()=>document.removeEventListener("keydown",D)},[n,e]),n?t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},className:"analytics-modal-overlay",onClick:e,dir:"rtl",children:t.jsx("div",{style:{width:"100%",maxWidth:"765px",maxHeight:"76vh",margin:"auto"},onClick:D=>D.stopPropagation(),children:t.jsxs("div",{className:"card shadow-lg border-0",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"20px",overflow:"hidden"},children:[t.jsx("div",{className:"card-header border-0",style:{backgroundColor:"rgba(255,255,255,0.1)",backdropFilter:"blur(10px)"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("div",{className:"p-3 rounded-circle me-3",style:{background:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)"},children:t.jsx("i",{className:"bi bi-bar-chart text-white fs-4"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-white mb-1 fw-bold",children:"  "}),t.jsxs("p",{className:"text-white-50 mb-0 small",children:[" ",(i==null?void 0:i.fullName)||""," -   "]})]})]}),t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsxs("div",{className:"badge me-3 px-3 py-2 rounded-pill d-flex align-items-center",style:{minWidth:"80px",background:p?"linear-gradient(135deg, #87CEEB 0%, #4169E1 100%)":"linear-gradient(135deg, #6c757d 0%, #495057 100%)",boxShadow:p?"0 4px 15px rgba(65, 105, 225, 0.4)":"0 4px 15px rgba(108, 117, 125, 0.3)",transition:"all 0.3s ease",border:"none"},title:p?"   ":"   ",children:[t.jsx("i",{className:`bi ${p?"bi-cloud-check":"bi-cloud-slash"} text-white me-2`,style:{fontSize:"14px",filter:p?"drop-shadow(0 2px 4px rgba(0,0,0,0.2))":"none"}}),t.jsx("span",{className:"text-white",style:{fontSize:"12px",fontWeight:"500"},children:p?"":" "})]}),t.jsxs("div",{className:`badge ${c?"bg-success":"bg-warning"} px-3 py-2 rounded-pill me-3`,children:[t.jsx("i",{className:`bi ${c?"bi-play-fill":"bi-pause-fill"} me-2`}),c?"":" "]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:e,style:{width:"32px",height:"32px",backgroundColor:"rgba(255,255,255,0.2)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},title:""})]})]})}),t.jsxs("div",{className:"card-body p-5",children:[t.jsx("div",{className:"d-flex justify-content-center mb-5",children:t.jsx("div",{className:"position-relative",children:t.jsxs("div",{className:"position-relative",style:{width:"200px",height:"200px"},children:[t.jsxs("svg",{width:"200",height:"200",className:"position-absolute",children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"timerGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#4facfe"}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#00f2fe"}})]})}),t.jsx("circle",{cx:"100",cy:"100",r:"85",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"8"}),t.jsx("circle",{cx:"100",cy:"100",r:"85",fill:"none",stroke:"url(#timerGradient)",strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${L()?"0 534":`${Math.floor(o/60/4.8)/100*534} 534`}`,transform:"rotate(-90 100 100)",style:{transition:c?"stroke-dasharray 1s ease-in-out":"none",filter:"drop-shadow(0 0 10px rgba(79, 172, 254, 0.5))"}})]}),t.jsxs("div",{className:"position-absolute top-50 start-50 translate-middle text-center",children:[t.jsx("h1",{className:"text-white mb-1 fw-bold",style:{fontSize:"2.2rem",fontFamily:"monospace",textShadow:"0 2px 10px rgba(0,0,0,0.3)"},children:u(o)}),t.jsx("small",{className:"text-white-50",children:" "})]})]})})}),t.jsxs("div",{className:"row g-4",children:[t.jsx("div",{className:"col-md-6",children:t.jsx("div",{className:"card bg-white bg-opacity-10 border-0 h-100",style:{backdropFilter:"blur(10px)",borderRadius:"15px"},children:t.jsxs("div",{className:"card-body text-center",children:[t.jsx("i",{className:"bi bi-calendar-check text-white fs-1 mb-2 d-block opacity-75"}),t.jsx("div",{className:"text-white-50 mb-2",style:{fontSize:"calc(0.875rem + 2px)"},children:new Date().toLocaleDateString("en-GB")}),t.jsx("h3",{className:"text-white fw-bold mb-1",children:(()=>{const D=R(o/60);return D===""?D:`${D}%`})()}),t.jsx("small",{className:"text-white-50",children:"  "})]})})}),t.jsx("div",{className:"col-md-6",children:t.jsx("div",{className:"card bg-white bg-opacity-10 border-0 h-100",style:{backdropFilter:"blur(10px)",borderRadius:"15px"},children:t.jsxs("div",{className:"card-body text-center",children:[t.jsx("i",{className:"bi bi-clock-history text-white fs-1 mb-3 d-block opacity-75"}),t.jsx("h3",{className:"text-white fw-bold mb-1",children:d.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}),t.jsx("small",{className:"text-white-50",children:" "})]})})})]}),t.jsx("div",{className:"mt-4",children:t.jsx("div",{className:"card bg-white bg-opacity-10 border-0",style:{backdropFilter:"blur(10px)",borderRadius:"15px"},children:t.jsx("div",{className:"card-body",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("div",{className:`rounded-circle me-3 ${c?"bg-success":"bg-warning"}`,style:{width:"12px",height:"12px",animation:c?"pulse 2s infinite":"none"}}),t.jsxs("div",{children:[t.jsx("h6",{className:"text-white mb-1 fw-bold",children:" "}),t.jsx("small",{className:"text-white-50",children:c?"    -  ":"   -     "})]})]}),t.jsx("div",{style:{padding:"0",background:"transparent",border:"none"},title:"  ",children:t.jsx("i",{className:`bi ${c?"bi-eye":"bi-eye-slash"} text-white fs-4 opacity-75`})})]})})})})]})]})})}),t.jsx("style",{children:`
        @keyframes pulse {
          0% { opacity: 1; }
          50% { opacity: 0.5; }
          100% { opacity: 1; }
        }
      `})]}):null}function Rt({onToggle:n}){const e=kt(),s=Xr(),{isTimelineVisible:r,toggleTimeline:i}=Ut(),{signOut:a,employeeData:o}=Bo(),{alertConfig:l,closeAlert:c,showConfirm:d}=Bt(),[u,f]=h.useState(!1),[p,j]=h.useState(!1),L=s.pathname==="/time-tracking";h.useEffect(()=>{const D=()=>{console.log(" Header: Showing notification bell"),j(!0)},y=()=>{console.log(" Header: Hiding notification bell"),j(!1)};return window.addEventListener("showActivityBell",D),window.addEventListener("hideActivityBell",y),()=>{window.removeEventListener("showActivityBell",D),window.removeEventListener("hideActivityBell",y)}},[]),h.useEffect(()=>{window.testBell=()=>{console.log(" Testing bell manually"),j(!0),setTimeout(()=>j(!1),15e3)}},[]);const R=()=>{d("     ",async()=>{try{await a(),console.log("    ")}catch(D){console.error("    :",D)}},"  ")};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"app-header-wrapper",children:t.jsxs("div",{className:"app-header d-flex align-items-center justify-content-between px-3",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("button",{onClick:n,type:"button",style:{border:"0",borderRight:"1px solid #e8ebf4",background:"transparent",marginLeft:"10px",padding:"1.35rem 1.5rem",cursor:"pointer",marginBottom:"-11px"},children:t.jsx("i",{className:"bi bi-list lh-1",style:{color:"#0073d8",fontSize:"1.8rem"}})}),t.jsxs("div",{className:"app-brand py-2",style:{marginTop:"-8px",marginRight:"-20px"},children:[t.jsx("a",{href:"/",className:"d-sm-block d-none",children:t.jsx("img",{src:"/images/logo.svg",className:"logo",alt:"Modern Bin",style:{height:"40px",width:"auto"}})}),t.jsx("a",{href:"/",className:"d-sm-none d-block",children:t.jsx("img",{src:"/images/logo-sm.svg",className:"logo",alt:"Modern Bin",style:{height:"40px",width:"auto"}})})]})]}),t.jsxs("div",{className:"header-actions d-lg-flex d-none",children:[t.jsx("div",{className:"back-button-container d-flex align-items-center me-3",children:t.jsx("button",{onClick:()=>e(-1),className:"d-flex align-items-center justify-content-center position-relative",style:{width:"48px",height:"48px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"12px",color:"white",border:"none",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 4px 15px rgba(0, 123, 255, 0.4)",transform:"translateY(-2px)"},onMouseOver:D=>{const y=D.currentTarget;y.style.transform="translateY(-4px)",y.style.boxShadow="0 6px 20px rgba(0, 123, 255, 0.5)"},onMouseOut:D=>{const y=D.currentTarget;y.style.transform="translateY(-2px)",y.style.boxShadow="0 4px 15px rgba(0, 123, 255, 0.4)"},title:"  ",children:t.jsx("i",{className:"bi bi-arrow-right fs-5 lh-1",style:{color:"inherit"}})})}),t.jsx("div",{className:"analytics-icon-container d-flex align-items-center me-3",children:t.jsx("button",{onClick:()=>f(!u),className:"d-flex align-items-center justify-content-center position-relative",style:{width:"48px",height:"48px",background:u?"linear-gradient(135deg, #6f42c1 0%, #5a2d91 100%)":"linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",borderRadius:"12px",color:u?"white":"#6c757d",border:"none",cursor:"pointer",transition:"all 0.3s ease",boxShadow:u?"0 4px 15px rgba(111, 66, 193, 0.4)":"0 2px 8px rgba(0, 0, 0, 0.1)",transform:u?"translateY(-2px)":"translateY(0)"},onMouseOver:D=>{if(!u){const y=D.currentTarget,T=y.querySelector("i");y.style.background="linear-gradient(135deg, #6f42c1 0%, #5a2d91 100%)",y.style.color="white",y.style.transform="translateY(-2px)",y.style.boxShadow="0 4px 15px rgba(111, 66, 193, 0.4)",T&&T.style.setProperty("color","white","important")}},onMouseOut:D=>{if(!u){const y=D.currentTarget,T=y.querySelector("i");y.style.background="linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",y.style.color="#6c757d",y.style.transform="translateY(0)",y.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)",T&&T.style.setProperty("color","#6c757d","important")}},title:"",children:t.jsx("i",{className:"bi bi-graph-up fs-5 lh-1",style:{color:"inherit"}})})}),t.jsx("div",{className:"timer-icon-container d-flex align-items-center me-3",children:t.jsx("button",{onClick:()=>e("/time-tracking"),className:"d-flex align-items-center justify-content-center position-relative",style:{width:"48px",height:"48px",background:L?"linear-gradient(135deg, #28a745 0%, #20c997 100%)":"linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",borderRadius:"12px",color:L?"white":"#6c757d",border:"none",cursor:"pointer",transition:"all 0.3s ease",boxShadow:L?"0 4px 15px rgba(40, 167, 69, 0.4)":"0 2px 8px rgba(0, 0, 0, 0.1)",transform:L?"translateY(-2px)":"translateY(0)"},onMouseOver:D=>{if(!L){const y=D.currentTarget,T=y.querySelector("i");y.style.background="linear-gradient(135deg, #28a745 0%, #20c997 100%)",y.style.color="white",y.style.transform="translateY(-2px)",y.style.boxShadow="0 4px 15px rgba(40, 167, 69, 0.4)",T&&T.style.setProperty("color","white","important")}},onMouseOut:D=>{if(!L){const y=D.currentTarget,T=y.querySelector("i");y.style.background="linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",y.style.color="#6c757d",y.style.transform="translateY(0)",y.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)",T&&T.style.setProperty("color","#6c757d","important")}},title:" ",children:t.jsx("i",{className:"bi bi-list-check fs-5 lh-1",style:{color:"inherit"}})})}),t.jsx(Tt,{can:"settings:read",mode:"hide",children:t.jsx("div",{className:"settings-icon-container d-flex align-items-center me-3",children:t.jsx("button",{onClick:()=>e("/settings"),className:"d-flex align-items-center justify-content-center position-relative",style:{width:"48px",height:"48px",background:"linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",borderRadius:"12px",color:"#6c757d",border:"none",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},onMouseOver:D=>{const y=D.currentTarget,T=y.querySelector("i");y.style.background="linear-gradient(135deg, #007bff 0%, #0056b3 100%)",y.style.color="white",y.style.transform="translateY(-2px)",y.style.boxShadow="0 4px 15px rgba(0, 123, 255, 0.4)",T&&T.style.setProperty("color","white","important")},onMouseOut:D=>{const y=D.currentTarget,T=y.querySelector("i");y.style.background="linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",y.style.color="#6c757d",y.style.transform="translateY(0)",y.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)",T&&T.style.setProperty("color","#6c757d","important")},title:"",children:t.jsx("i",{className:"bi bi-gear fs-5 lh-1",style:{color:"inherit"}})})})}),t.jsx("div",{className:"activity-toggle-container d-flex align-items-center me-3",children:t.jsxs("button",{onClick:i,className:"d-flex align-items-center justify-content-center position-relative",style:{width:"48px",height:"48px",background:r?"linear-gradient(135deg, #007bff 0%, #0056b3 100%)":"linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",borderRadius:"12px",color:r?"white":"#6c757d",border:"none",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},onMouseOver:D=>{D.target.style.transform="translateY(-2px)",D.target.style.boxShadow="0 4px 15px rgba(0, 0, 0, 0.15)"},onMouseOut:D=>{D.target.style.transform="translateY(0)",D.target.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)"},title:r?" ":" ",children:[t.jsx("i",{className:`bi ${r?"bi-clock-history":"bi-clock"} fs-5 lh-1`}),p&&t.jsx("span",{className:"position-absolute",style:{top:"6px",right:"6px",width:"12px",height:"12px",backgroundColor:"#dc3545",borderRadius:"50%",border:"2px solid white",boxShadow:"0 2px 4px rgba(220, 53, 69, 0.3)",animation:"bellPulse 2s infinite",zIndex:10,pointerEvents:"none"}})]})}),t.jsx("div",{className:"logout-button-container d-flex align-items-center me-3",children:t.jsx("button",{onClick:R,className:"d-flex align-items-center justify-content-center position-relative",style:{width:"48px",height:"48px",background:"linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",borderRadius:"12px",color:"#6c757d",border:"none",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},onMouseOver:D=>{const y=D.currentTarget,T=y.querySelector("i");y.style.background="linear-gradient(135deg, #dc3545 0%, #c82333 100%)",y.style.color="white",y.style.transform="translateY(-2px)",y.style.boxShadow="0 4px 15px rgba(220, 53, 69, 0.4)",T&&T.style.setProperty("color","white","important")},onMouseOut:D=>{const y=D.currentTarget,T=y.querySelector("i");y.style.background="linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",y.style.color="#6c757d",y.style.transform="translateY(0)",y.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)",T&&T.style.setProperty("color","#6c757d","important")},title:" ",children:t.jsx("i",{className:"bi bi-box-arrow-right fs-5 lh-1",style:{color:"inherit"}})})}),t.jsx(Tt,{can:"trash:read",mode:"hide",children:t.jsx("div",{className:"trash-icon-container d-flex align-items-center me-3",children:t.jsx("button",{onClick:()=>e("/trash"),className:"d-flex align-items-center justify-content-center position-relative",style:{width:"48px",height:"48px",background:"linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",borderRadius:"12px",color:"#6c757d",border:"none",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},onMouseOver:D=>{const y=D.currentTarget,T=y.querySelector("i");y.style.background="linear-gradient(135deg, #dc3545 0%, #c82333 100%)",y.style.color="white",y.style.transform="translateY(-2px)",y.style.boxShadow="0 4px 15px rgba(220, 53, 69, 0.4)",T&&T.style.setProperty("color","white","important")},onMouseOut:D=>{const y=D.currentTarget,T=y.querySelector("i");y.style.background="linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",y.style.color="#6c757d",y.style.transform="translateY(0)",y.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)",T&&T.style.setProperty("color","#6c757d","important")},title:" ",children:t.jsx("i",{className:"bi bi-trash fs-5 lh-1",style:{color:"inherit"}})})})})]}),t.jsx("div",{className:"d-flex align-items-center",children:t.jsxs("div",{className:"dropdown ms-2",children:[t.jsxs("a",{className:"dropdown-toggle d-flex py-2 align-items-center text-decoration-none",href:"#!",role:"button","data-bs-toggle":"dropdown",children:[t.jsx("img",{src:"/images/user.png",className:"rounded-2 img-3x",alt:"User"}),t.jsx("span",{className:"ms-2 text-truncate d-lg-block d-none",children:(o==null?void 0:o.fullName)||""})]}),t.jsxs("div",{className:"dropdown-menu dropdown-menu-end shadow-lg",children:[t.jsxs("div",{className:"header-action-links mx-3 gap-2",children:[t.jsxs("a",{className:"dropdown-item",href:"profile.html",children:[t.jsx("i",{className:"bi bi-person text-primary"}),"  "]}),t.jsxs("a",{className:"dropdown-item",href:"settings.html",children:[t.jsx("i",{className:"bi bi-gear text-danger"})," "]}),t.jsxs("a",{className:"dropdown-item",href:"widgets.html",children:[t.jsx("i",{className:"bi bi-box text-success"})," "]})]}),t.jsx("div",{className:"mx-3 mt-2 d-grid",children:t.jsxs("button",{onClick:R,className:"btn btn-danger btn-sm",children:[t.jsx("i",{className:"bi bi-box-arrow-right me-1"})," "]})})]})]})})]})}),t.jsx(Mt,{show:l.show,onClose:c,title:l.title,message:l.message,type:l.type,onConfirm:l.onConfirm,confirmText:l.confirmText,cancelText:l.cancelText,showCancel:l.showCancel}),t.jsx(lU,{show:u,onClose:()=>f(!1)})]})}function os({rtl:n=!0}){const[e,s]=h.useState([]),[r,i]=h.useState([]),[a,o]=h.useState(!0),[l,c]=h.useState([]),[d,u]=h.useState(!1),[f,p]=h.useState(!1),[j,L]=h.useState(new Date),[R,D]=h.useState(null),[y,T]=h.useState(null);h.useEffect(()=>{let Y=null;return(async()=>{try{o(!0),ai.isInitialized||await ai.initialize(),Y=ai.addListener(({activities:O,users:E})=>{s(O||[]),i(E||[]),c(O||[]),o(!1)}),s(ai.activities||[]),i(ai.users||[]),c(ai.activities||[]),o(!1),console.log(" Timeline initialized with real Firebase data")}catch(O){console.error("Error initializing timeline:",O),o(!1)}})(),()=>{Y&&Y()}},[]),h.useEffect(()=>{x()},[e,R,y]);const x=()=>{let Y=[...e];R&&(Y=ai.getActivitiesByDate(R)),y&&(Y=Y.filter(z=>z.userId===y)),c(Y),console.log(` Applied filters: ${Y.length} activities`)},S=(Y,z=null)=>{const O=["#e74c3c","#3498db","#2ecc71","#f39c12","#9b59b6","#1abc9c","#e67e22","#34495e","#fd79a8","#17a2b8","#28a745","#dc3545","#6f42c1","#20c997","#fd7e14"];if(!Y&&!z)return O[0];const E=z||Y;let k=0;for(let N=0;N<E.length;N++)k=E.charCodeAt(N)+((k<<5)-k);const b=Math.abs(k)%O.length;return O[b]},A=["","","","","","","","","","","",""],Q=["","","","","","",""],q=Y=>{const z=Y.getFullYear(),O=Y.getMonth(),E=new Date(z,O,1),b=new Date(z,O+1,0).getDate(),N=E.getDay(),I=[],P=new Date(z,O-1,0);for(let C=N-1;C>=0;C--)I.push({day:P.getDate()-C,isCurrentMonth:!1,isNextMonth:!1});for(let C=1;C<=b;C++)I.push({day:C,isCurrentMonth:!0,isNextMonth:!1});const _=42-I.length;for(let C=1;C<=_;C++)I.push({day:C,isCurrentMonth:!1,isNextMonth:!0});return I},B=()=>{L(new Date(j.getFullYear(),j.getMonth()-1))},$=()=>{L(new Date(j.getFullYear(),j.getMonth()+1))},H=(Y,z,O)=>{if(!z)return;const E=new Date(j.getFullYear(),j.getMonth(),Y);D(E)},te=()=>{console.log(" Date filter applied:",R),x(),u(!1)},G=()=>{u(!1),D(null),x()},F=Y=>{T(Y===y?null:Y)},X=()=>{console.log(" User filter applied:",y),x(),p(!1)},ue=()=>{p(!1),T(null),x()};return t.jsxs("div",{className:"card shadow-lg",style:{position:"fixed",left:"20px",top:"145px",width:"360px",height:"calc(100vh - 185px)",zIndex:10,border:"none",borderRadius:"12px",display:"flex",flexDirection:"column"},children:[t.jsx("div",{style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",padding:"20px",color:"white",height:"80px",display:"flex",flexDirection:"column",justifyContent:"center",flexShrink:0,borderTopLeftRadius:"12px",borderTopRightRadius:"12px"},children:t.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-clock-history me-2",style:{fontSize:"20px"}}),t.jsx("h6",{className:"mb-0 fw-semibold",children:" "})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsxs("button",{className:`btn btn-sm ${f?"btn-light":"btn-outline-light"} border-0`,onClick:()=>p(!f),style:{fontSize:"12px",borderRadius:"8px",padding:"6px 12px",transition:"all 0.2s ease",backgroundColor:f?"rgba(255,255,255,0.2)":"transparent",color:"white",border:f?"1px solid rgba(255,255,255,0.3)":"1px solid transparent"},onMouseEnter:Y=>{f||(Y.target.style.backgroundColor="rgba(255,255,255,0.1)",Y.target.style.borderColor="rgba(255,255,255,0.2)")},onMouseLeave:Y=>{f||(Y.target.style.backgroundColor="transparent",Y.target.style.borderColor="transparent")},children:[t.jsx("i",{className:`bi ${f?"bi-person-fill":"bi-person"} me-2`}),"Users"]}),t.jsxs("button",{className:`btn btn-sm ${d?"btn-light":"btn-outline-light"} border-0`,onClick:()=>u(!d),style:{fontSize:"12px",borderRadius:"8px",padding:"6px 12px",transition:"all 0.2s ease",backgroundColor:d?"rgba(255,255,255,0.2)":"transparent",color:"white",border:d?"1px solid rgba(255,255,255,0.3)":"1px solid transparent"},onMouseEnter:Y=>{d||(Y.target.style.backgroundColor="rgba(255,255,255,0.1)",Y.target.style.borderColor="rgba(255,255,255,0.2)")},onMouseLeave:Y=>{d||(Y.target.style.backgroundColor="transparent",Y.target.style.borderColor="transparent")},children:[t.jsx("i",{className:`bi ${d?"bi-funnel-fill":"bi-funnel"} me-2`}),"Filter"]})]})]})}),t.jsxs("div",{style:{flex:1,overflow:"auto",display:"flex",flexDirection:"column"},children:[d&&t.jsx("div",{style:{background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)",borderTop:"1px solid rgba(0,0,0,0.08)"},children:t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[t.jsx("button",{className:"btn btn-sm shadow-sm",onClick:B,style:{backgroundColor:"#ffffff",border:"1px solid #dee2e6",borderRadius:"12px",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",color:"#495057"},onMouseEnter:Y=>{Y.target.style.backgroundColor="#e9ecef",Y.target.style.transform="translateY(-1px)",Y.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:Y=>{Y.target.style.backgroundColor="#ffffff",Y.target.style.transform="translateY(0)",Y.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:t.jsx("i",{className:"bi bi-chevron-right"})}),t.jsx("div",{className:"text-center",children:t.jsxs("h6",{className:"mb-0 fw-semibold",style:{color:"#2c3e50",fontSize:"16px",letterSpacing:"0.5px"},children:[A[j.getMonth()]," ",j.getFullYear()]})}),t.jsx("button",{className:"btn btn-sm shadow-sm",onClick:$,style:{backgroundColor:"#ffffff",border:"1px solid #dee2e6",borderRadius:"12px",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",color:"#495057"},onMouseEnter:Y=>{Y.target.style.backgroundColor="#e9ecef",Y.target.style.transform="translateY(-1px)",Y.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:Y=>{Y.target.style.backgroundColor="#ffffff",Y.target.style.transform="translateY(0)",Y.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:t.jsx("i",{className:"bi bi-chevron-left"})})]}),t.jsxs("div",{className:"calendar-grid mb-3",children:[t.jsx("div",{className:"row g-1 mb-3",children:Q.map((Y,z)=>t.jsx("div",{className:"col text-center",children:t.jsx("small",{className:"fw-bold",style:{color:"#6c757d",fontSize:"11px",letterSpacing:"0.5px"},children:Y})},z))}),Array.from({length:6}).map((Y,z)=>t.jsx("div",{className:"row g-1 mb-1",children:q(j).slice(z*7,(z+1)*7).map((O,E)=>t.jsx("div",{className:"col",children:t.jsx("button",{className:"btn btn-sm w-100 shadow-sm",style:{fontSize:"12px",height:"32px",borderRadius:"8px",border:"1px solid #dee2e6",backgroundColor:O.isCurrentMonth?R&&R.getDate()===O.day?"#0d6efd":O.day===new Date().getDate()&&j.getMonth()===new Date().getMonth()&&j.getFullYear()===new Date().getFullYear()?"#e7f3ff":"#ffffff":"#f8f9fa",color:O.isCurrentMonth?R&&R.getDate()===O.day?"#ffffff":O.day===new Date().getDate()&&j.getMonth()===new Date().getMonth()&&j.getFullYear()===new Date().getFullYear()?"#0d6efd":"#495057":"#adb5bd",opacity:O.isCurrentMonth?1:.6,transition:"all 0.2s ease",fontWeight:R&&R.getDate()===O.day?"600":"400"},onClick:()=>H(O.day,O.isCurrentMonth,O.isNextMonth),disabled:!O.isCurrentMonth,onMouseEnter:k=>{O.isCurrentMonth&&!(R&&R.getDate()===O.day)&&(k.target.style.backgroundColor="#e9ecef",k.target.style.transform="translateY(-1px)")},onMouseLeave:k=>{O.isCurrentMonth&&!(R&&R.getDate()===O.day)&&(k.target.style.backgroundColor=O.day===new Date().getDate()&&j.getMonth()===new Date().getMonth()&&j.getFullYear()===new Date().getFullYear()?"#e7f3ff":"#ffffff",k.target.style.transform="translateY(0)")},children:O.day})},E))},z))]}),t.jsxs("div",{className:"row g-3 mx-2 justify-content-center align-items-center",style:{marginTop:"22px"},children:[t.jsx("div",{className:"col-6",children:t.jsx("button",{className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:G,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#ffffff",border:"1px solid #dee2e6",color:"#6c757d",transition:"all 0.2s ease"},onMouseEnter:Y=>{Y.target.style.backgroundColor="#f8f9fa",Y.target.style.transform="translateY(-1px)",Y.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:Y=>{Y.target.style.backgroundColor="#ffffff",Y.target.style.transform="translateY(0)",Y.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:""})}),t.jsx("div",{className:"col-6",children:t.jsx("button",{className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:te,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#0d6efd",border:"1px solid #0d6efd",color:"#ffffff",transition:"all 0.2s ease"},onMouseEnter:Y=>{Y.target.style.backgroundColor="#0b5ed7",Y.target.style.transform="translateY(-1px)",Y.target.style.boxShadow="0 4px 12px rgba(13,110,253,0.3)"},onMouseLeave:Y=>{Y.target.style.backgroundColor="#0d6efd",Y.target.style.transform="translateY(0)",Y.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:""})})]})]})}),f&&t.jsx("div",{style:{background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)",borderTop:"1px solid rgba(0,0,0,0.08)"},children:t.jsxs("div",{className:"p-4",children:[t.jsx("div",{className:"text-center mb-3",children:t.jsx("h6",{className:"mb-0 fw-semibold",style:{color:"#2c3e50",fontSize:"16px",letterSpacing:"0.5px"},children:"  "})}),t.jsx("div",{className:"mb-4",style:{background:"#ffffff",border:"1px solid #dee2e6",borderRadius:"8px",padding:"16px"},children:r.length>0?t.jsx("div",{className:"d-flex flex-column gap-1",children:r.map((Y,z)=>t.jsx("div",{className:"d-flex align-items-center p-2",style:{borderBottom:z!==r.length-1?"1px solid #f8f9fa":"none"},children:t.jsxs("div",{className:"d-flex align-items-center w-100 justify-content-between",children:[t.jsx("input",{className:"form-check-input",type:"radio",name:"userFilter",id:`user-${Y.id}`,checked:y===Y.id,onChange:()=>F(Y.id),style:{cursor:"pointer",margin:"0",transform:"scale(0.7)",width:"14px",height:"14px",minWidth:"14px"}}),t.jsx("label",{className:"form-check-label flex-grow-1 text-end",htmlFor:`user-${Y.id}`,style:{cursor:"pointer",fontSize:"14px",fontWeight:"500",color:y===Y.id?"#0d6efd":"#495057",marginRight:"8px"},children:Y.name})]})},Y.id))}):t.jsxs("div",{className:"text-center py-3",children:[t.jsx("i",{className:"bi bi-people text-muted",style:{fontSize:"2rem"}}),t.jsx("p",{className:"text-muted mt-2 mb-0",children:"   "})]})}),t.jsxs("div",{className:"row g-3 mx-2 justify-content-center align-items-center",children:[t.jsx("div",{className:"col-6",children:t.jsx("button",{className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:ue,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#ffffff",border:"1px solid #dee2e6",color:"#6c757d",transition:"all 0.2s ease"},onMouseEnter:Y=>{Y.target.style.backgroundColor="#f8f9fa",Y.target.style.transform="translateY(-1px)",Y.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:Y=>{Y.target.style.backgroundColor="#ffffff",Y.target.style.transform="translateY(0)",Y.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:""})}),t.jsx("div",{className:"col-6",children:t.jsx("button",{className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:X,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#0d6efd",border:"1px solid #0d6efd",color:"#ffffff",transition:"all 0.2s ease"},onMouseEnter:Y=>{Y.target.style.backgroundColor="#0b5ed7",Y.target.style.transform="translateY(-1px)",Y.target.style.boxShadow="0 4px 12px rgba(13,110,253,0.3)"},onMouseLeave:Y=>{Y.target.style.backgroundColor="#0d6efd",Y.target.style.transform="translateY(0)",Y.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:""})})]})]})}),t.jsx("div",{className:"card-body p-0",style:{flex:1},children:a?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"spinner-border text-primary",role:"status",children:t.jsx("span",{className:"visually-hidden",children:" ..."})}),t.jsx("p",{className:"text-muted mt-3 mb-0",children:"  ..."})]}):l.length>0?t.jsx("div",{className:"list-group list-group-flush",children:l.map((Y,z)=>{var O,E,k,b,N,I,P,_;return t.jsxs("div",{className:`list-group-item border-0 py-3 ${z!==l.length-1?"border-bottom":""}`,style:{borderBottomColor:"#e9ecef !important",borderBottomWidth:"1px !important"},children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("h6",{className:"mb-1 text-dark",children:Y.description||Y.title}),Y.isManual&&t.jsx("span",{className:"badge bg-info",style:{fontSize:"10px"},children:""}),((O=Y.details)==null?void 0:O.contextType)&&t.jsx("span",{className:`badge ${Y.details.contextType==="manufactured_product"?"bg-secondary":"bg-primary"}`,style:{fontSize:"10px"},children:Y.details.contextType==="manufactured_product"?" ":""})]}),t.jsx("span",{className:`badge ${Y.status==="done"?"bg-success":Y.status==="open"?"bg-warning":"bg-danger"}`,children:Y.status==="done"?"":Y.status==="open"?"":""})]}),(((E=Y.details)==null?void 0:E.detectedFrom)||((k=Y.details)==null?void 0:k.itemName))&&t.jsxs("div",{className:"mb-2",children:[((b=Y.details)==null?void 0:b.itemName)&&t.jsxs("span",{className:"badge bg-light text-dark me-2",style:{fontSize:"11px"},children:[": ",Y.details.itemName]}),((N=Y.details)==null?void 0:N.detectedFrom)&&t.jsx("span",{className:"badge bg-info",style:{fontSize:"10px",opacity:.7},children:Y.details.detectedFrom==="url_pattern"?"  ":Y.details.detectedFrom==="title_analysis"?" ":Y.details.detectedFrom==="explicit"?" ":""})]}),t.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[t.jsxs("div",{className:"d-flex align-items-center text-muted small",children:[t.jsx("i",{className:"bi bi-person me-1"}),t.jsx("span",{className:"me-3 fw-semibold",style:{color:S((I=Y.user)==null?void 0:I.name,((P=Y.user)==null?void 0:P.id)||Y.userId),fontSize:"13px"},children:(_=Y.user)==null?void 0:_.name})]}),t.jsxs("div",{className:"text-muted small d-flex flex-column align-items-end",children:[t.jsx("div",{style:{direction:"ltr"},children:(()=>{const C=new Date(Y.at).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),[U,w]=C.split(" ");return`${U} ${w.toUpperCase()}`})()}),t.jsx("div",{style:{fontSize:"11px",opacity:.8},className:"text-primary",children:new Date(Y.at).toLocaleDateString("en-GB")})]})]}),Y.type&&t.jsxs("div",{className:"mt-2",children:[t.jsx("i",{className:`bi ${Y.type==="task"?"bi-list-task":Y.type==="call"?"bi-telephone":Y.type==="email"?"bi-envelope":Y.type==="meeting"?"bi-people":"bi-sticky"} me-1 text-primary`}),t.jsx("small",{className:"text-primary",children:Y.type==="task"?"":Y.type==="call"?"":Y.type==="email"?" ":Y.type==="meeting"?"":""})]})]},Y.id||z)})}):t.jsxs("div",{className:"text-center py-5",children:[t.jsx("i",{className:"bi bi-clock-history text-muted",style:{fontSize:"3rem"}}),t.jsx("p",{className:"text-muted mt-3 mb-0",children:"   "})]})})]})]})}const Go=Object.freeze(Object.defineProperty({__proto__:null,default:os},Symbol.toStringTag,{value:"Module"}));function ls(){const[n,e]=h.useState(!1),[s,r]=h.useState({type:"task",title:"",description:""}),{createManualActivity:i}=Zt(),a=[{value:"task",label:"",icon:"bi-list-task"},{value:"call",label:"",icon:"bi-telephone"},{value:"email",label:" ",icon:"bi-envelope"},{value:"meeting",label:"",icon:"bi-people"},{value:"note",label:"",icon:"bi-sticky"}],o=c=>{c.preventDefault(),s.title.trim()&&(i(s),r({type:"task",title:"",description:""}),e(!1))},l=()=>{r({type:"task",title:"",description:""}),e(!1)};return t.jsx("div",{style:{position:"fixed",left:"20px",bottom:"20px",zIndex:1e3},children:n?t.jsxs("div",{className:"card shadow-lg",style:{width:"360px",maxHeight:"500px",border:"none",borderRadius:"12px",overflow:"hidden"},children:[t.jsx("div",{style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",padding:"20px",color:"white"},children:t.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[t.jsx("div",{className:"d-flex align-items-center",children:t.jsx("h6",{className:"mb-0 fw-semibold",children:"  "})}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:l,style:{fontSize:"12px",opacity:.8},onMouseEnter:c=>c.target.style.opacity="1",onMouseLeave:c=>c.target.style.opacity="0.8"})]})}),t.jsx("div",{style:{background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)",padding:"24px"},children:t.jsxs("form",{onSubmit:o,children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"form-label fw-semibold",style:{color:"#2c3e50",fontSize:"14px",letterSpacing:"0.3px"},children:" "}),t.jsx("select",{className:"form-select shadow-sm",value:s.type,onChange:c=>r(d=>({...d,type:c.target.value})),style:{fontSize:"14px",borderRadius:"8px",border:"1px solid #dee2e6",backgroundColor:"#ffffff",padding:"10px 12px",transition:"all 0.2s ease",backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"left 12px center",backgroundSize:"12px",paddingLeft:"36px",paddingRight:"12px",textAlign:"right",direction:"rtl"},onFocus:c=>{c.target.style.borderColor="#0d6efd",c.target.style.boxShadow="0 0 0 0.2rem rgba(13,110,253,.25)"},onBlur:c=>{c.target.style.borderColor="#dee2e6",c.target.style.boxShadow="none"},children:a.map(c=>t.jsx("option",{value:c.value,children:c.label},c.value))})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"form-label fw-semibold",style:{color:"#2c3e50",fontSize:"14px",letterSpacing:"0.3px"},children:" *"}),t.jsx("input",{type:"text",className:"form-control shadow-sm",value:s.title,onChange:c=>r(d=>({...d,title:c.target.value})),placeholder:"  ",required:!0,style:{fontSize:"14px",borderRadius:"8px",border:"1px solid #dee2e6",backgroundColor:"#ffffff",padding:"10px 12px",transition:"all 0.2s ease"},onFocus:c=>{c.target.style.borderColor="#0d6efd",c.target.style.boxShadow="0 0 0 0.2rem rgba(13,110,253,.25)"},onBlur:c=>{c.target.style.borderColor="#dee2e6",c.target.style.boxShadow="none"}})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"form-label fw-semibold",style:{color:"#2c3e50",fontSize:"14px",letterSpacing:"0.3px"},children:""}),t.jsx("textarea",{className:"form-control shadow-sm",rows:"3",value:s.description,onChange:c=>r(d=>({...d,description:c.target.value})),placeholder:"   ()",style:{fontSize:"14px",borderRadius:"8px",border:"1px solid #dee2e6",backgroundColor:"#ffffff",padding:"10px 12px",resize:"none",transition:"all 0.2s ease"},onFocus:c=>{c.target.style.borderColor="#0d6efd",c.target.style.boxShadow="0 0 0 0.2rem rgba(13,110,253,.25)"},onBlur:c=>{c.target.style.borderColor="#dee2e6",c.target.style.boxShadow="none"}})]}),t.jsxs("div",{className:"row g-3 mx-2 justify-content-center align-items-center",style:{marginTop:"22px"},children:[t.jsx("div",{className:"col-6",children:t.jsx("button",{type:"button",className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:l,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#ffffff",border:"1px solid #dee2e6",color:"#6c757d",transition:"all 0.2s ease"},onMouseEnter:c=>{c.target.style.backgroundColor="#f8f9fa",c.target.style.transform="translateY(-1px)",c.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:c=>{c.target.style.backgroundColor="#ffffff",c.target.style.transform="translateY(0)",c.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:""})}),t.jsx("div",{className:"col-6",children:t.jsx("button",{type:"submit",className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#0d6efd",border:"1px solid #0d6efd",color:"#ffffff",transition:"all 0.2s ease"},onMouseEnter:c=>{c.target.style.backgroundColor="#0b5ed7",c.target.style.transform="translateY(-1px)",c.target.style.boxShadow="0 4px 12px rgba(13,110,253,0.3)"},onMouseLeave:c=>{c.target.style.backgroundColor="#0d6efd",c.target.style.transform="translateY(0)",c.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:""})})]})]})})]}):t.jsx("button",{onClick:()=>e(!0),className:"btn btn-primary rounded-circle shadow-lg",style:{width:"56px",height:"56px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",border:"none"},title:"  ",children:t.jsx("i",{className:"bi bi-chat-left-text"})})})}const Wo=Object.freeze(Object.defineProperty({__proto__:null,default:ls},Symbol.toStringTag,{value:"Module"}));function cU(){const[n,e]=h.useState(!1),{isTimelineVisible:s}=Ut(),r=()=>{e(!n)};return t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[t.jsx(Rt,{onToggle:r}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!s?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-3",children:t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"mb-4",children:t.jsx("i",{className:"bi bi-speedometer2",style:{fontSize:"80px",color:"#007bff"}})}),t.jsx("h4",{className:"text-muted mb-3",children:" "}),t.jsx("p",{className:"text-muted",children:"     "})]})}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&s&&t.jsx(os,{rtl:!0}),!n&&s&&t.jsx(ls,{})]})}function Pj(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(cU,{})})})}class Ke{static getCurrentUserId(){if(!ut.currentUser)throw new Error("User not authenticated");return ut.currentUser.uid}static createExpiryTimestamp(e=this.DEFAULT_EXPIRY_HOURS){const s=new Date;return s.setHours(s.getHours()+e),hs.fromDate(s)}static cleanDataForFirestore(e){if(e==null)return null;if(Array.isArray(e))return e.map(s=>this.cleanDataForFirestore(s)).filter(s=>s!==void 0);if(typeof e=="object"){const s={};for(const[r,i]of Object.entries(e))i!==void 0&&(s[r]=this.cleanDataForFirestore(i));return s}return e}static async setPendingData(e,s,r=this.DEFAULT_EXPIRY_HOURS){try{const i=this.getCurrentUserId();console.log(" [FIRESTORE] Setting pending data:",e);const a=this.cleanDataForFirestore(s);console.log(" [FIRESTORE] Data cleaned for Firestore compatibility");const o=Le(ae,this.COLLECTION_NAME,`${i}_${e}`),l={ownerId:i,key:e,data:a,expiresAt:this.createExpiryTimestamp(r),createdAt:We(),updatedAt:We()};return await yn(o,l),console.log(" [FIRESTORE] Pending data set:",e),!0}catch(i){throw console.error(" [FIRESTORE] Error setting pending data:",i),new Error("Failed to set pending data: "+i.message)}}static async getPendingData(e){try{const s=this.getCurrentUserId();console.log(" [FIRESTORE] Getting pending data:",e);const r=Le(ae,this.COLLECTION_NAME,`${s}_${e}`),i=await ss(r);if(!i.exists())return console.log(" [FIRESTORE] No pending data found for key:",e),null;const a=i.data();return a.expiresAt&&a.expiresAt.toDate()<new Date?(console.log(" [FIRESTORE] Pending data expired, cleaning up:",e),await this.clearPendingData(e),null):(console.log(" [FIRESTORE] Retrieved pending data:",e),a.data)}catch(s){return console.error(" [FIRESTORE] Error getting pending data:",s),null}}static async clearPendingData(e){try{const s=this.getCurrentUserId();console.log(" [FIRESTORE] Clearing pending data:",e);const r=Le(ae,this.COLLECTION_NAME,`${s}_${e}`);return await es(r),console.log(" [FIRESTORE] Pending data cleared:",e),!0}catch(s){return console.error(" [FIRESTORE] Error clearing pending data:",s),!1}}static async getAllPendingData(){try{const e=this.getCurrentUserId();console.log(" [FIRESTORE] Getting all pending data");const s=Pe(ae,this.COLLECTION_NAME),r=st(s,xt("ownerId","==",e),as("createdAt","desc")),i=await qe(r),a={},o=[];return i.docs.forEach(l=>{const c=l.data();c.expiresAt&&c.expiresAt.toDate()<new Date?o.push(c.key):a[c.key]=c.data}),o.length>0&&await this.clearMultiplePendingData(o),console.log(" [FIRESTORE] Retrieved all pending data, keys:",Object.keys(a)),a}catch(e){return console.error(" [FIRESTORE] Error getting all pending data:",e),{}}}static async clearMultiplePendingData(e){try{const s=this.getCurrentUserId();console.log(" [FIRESTORE] Clearing multiple pending data:",e.length);const r=Fr(ae);return e.forEach(i=>{const a=Le(ae,this.COLLECTION_NAME,`${s}_${i}`);r.delete(a)}),await r.commit(),console.log(" [FIRESTORE] Multiple pending data cleared"),!0}catch(s){return console.error(" [FIRESTORE] Error clearing multiple pending data:",s),!1}}static async clearAllPendingData(){try{const e=this.getCurrentUserId();console.log(" [FIRESTORE] Clearing all pending data");const s=Pe(ae,this.COLLECTION_NAME),r=st(s,xt("ownerId","==",e)),i=await qe(r),a=Fr(ae);return i.docs.forEach(o=>{a.delete(o.ref)}),await a.commit(),console.log(" [FIRESTORE] All pending data cleared:",i.docs.length),i.docs.length}catch(e){return console.error(" [FIRESTORE] Error clearing all pending data:",e),0}}static async cleanupExpiredData(){try{const e=this.getCurrentUserId();console.log(" [FIRESTORE] Cleaning up expired data");const s=Pe(ae,this.COLLECTION_NAME),r=st(s,xt("ownerId","==",e),xt("expiresAt","<",hs.now())),i=await qe(r),a=Fr(ae);return i.docs.forEach(o=>{a.delete(o.ref)}),await a.commit(),console.log(" [FIRESTORE] Expired data cleaned up:",i.docs.length),i.docs.length}catch(e){return console.error(" [FIRESTORE] Error cleaning up expired data:",e),0}}static async setPendingTenderItems(e){return this.setPendingData("pendingTenderItems",e,48)}static async getPendingTenderItems(){return this.getPendingData("pendingTenderItems")}static async clearPendingTenderItems(){return this.clearPendingData("pendingTenderItems")}static async mergePendingTenderItems(e){try{console.log(" [FIRESTORE] Merging pending tender items:",e.length);const s=await this.getPendingTenderItems()||[],r=[...s,...e];return await this.setPendingTenderItems(r),console.log(" [FIRESTORE] Pending tender items merged:",{existing:s.length,new:e.length,total:r.length}),!0}catch(s){throw console.error(" [FIRESTORE] Error merging pending tender items:",s),new Error("Failed to merge pending tender items: "+s.message)}}static async setPendingProductItems(e){return this.setPendingData("pendingProductItems",e,48)}static async getPendingProductItems(){return this.getPendingData("pendingProductItems")}static async clearPendingProductItems(){return this.clearPendingData("pendingProductItems")}static async mergePendingProductItems(e){try{console.log(" [FIRESTORE] Merging pending product items:",e.length);const s=await this.getPendingProductItems()||[],r=[...s,...e];return await this.setPendingProductItems(r),console.log(" [FIRESTORE] Pending product items merged:",{existing:s.length,new:e.length,total:r.length}),!0}catch(s){throw console.error(" [FIRESTORE] Error merging pending product items:",s),new Error("Failed to merge pending product items: "+s.message)}}static async setSessionData(e,s,r=24){return this.setPendingData(e,s,r)}static async getSessionData(e){return this.getPendingData(e)}static async clearSessionData(e){return this.clearPendingData(e)}}Ys(Ke,"COLLECTION_NAME","pendingData"),Ys(Ke,"DEFAULT_EXPIRY_HOURS",24);class k1 extends O0{constructor(){super("tenders")}async getTenderForViewing(e){try{return await this.getById(e)}catch(s){throw console.error("Error fetching tender for viewing:",s),s}}async updateTenderCollaborative(e,s,r={}){try{const i=this.validateTenderData(s);if(Object.keys(i).length>0)throw new Error(`  : ${Object.values(i).join(", ")}`);if(await this.checkDuplicateReferenceNumber(s.referenceNumber,e))throw new Error("     -    ");const a={...s,submissionDeadline:s.submissionDeadline?new Date(s.submissionDeadline):null};return await this.update(e,a,{...r,updateCache:!0})}catch(i){throw console.error("Error updating tender collaboratively:",i),i}}validateTenderData(e){var r,i,a;const s={};return(r=e.title)!=null&&r.trim()||(s.title="  "),(i=e.referenceNumber)!=null&&i.trim()||(s.referenceNumber="  "),(a=e.entity)!=null&&a.trim()||(s.entity="  "),e.submissionDeadline||(s.submissionDeadline="   "),s}async checkDuplicateReferenceNumber(e,s=null){try{return(await this.search(e,["referenceNumber"])).some(i=>i.referenceNumber===e&&i.id!==s)}catch(r){return console.error("Error checking duplicate reference number:",r),!1}}async createTender(e,s={}){try{const r=this.validateTenderData(e);if(Object.keys(r).length>0)throw new Error(`  : ${Object.values(r).join(", ")}`);if(await this.checkDuplicateReferenceNumber(e.referenceNumber))throw new Error("     -    ");const i={...e,internalId:Ct("TENDER"),status:"draft",items:e.items||[],documents:e.documents||[],submissionDeadline:e.submissionDeadline?new Date(e.submissionDeadline):null,createdAt:new Date,updatedAt:new Date};return await this.create(i,{...s,updateCache:!0})}catch(r){throw console.error("Error creating tender:",r),r}}async updateTender(e,s,r={}){try{const i=this.validateTenderData(s);if(Object.keys(i).length>0)throw new Error(`  : ${Object.values(i).join(", ")}`);if(s.referenceNumber&&await this.checkDuplicateReferenceNumber(s.referenceNumber,e))throw new Error("     -    ");const a={...s,submissionDeadline:s.submissionDeadline?new Date(s.submissionDeadline):null};return await this.update(e,a,{...r,updateCache:!0})}catch(i){throw console.error("Error updating tender:",i),i}}async getTenderByInternalId(e){try{return(await this.search(e,["internalId"])).find(r=>r.internalId===e)||null}catch(s){throw console.error("Error fetching tender by internal ID:",s),s}}async getAllTenders(e={}){return await this.getAll({updateCache:!0,...e})}async searchTenders(e){return await this.search(e,["title","referenceNumber","entity","description","internalId"])}async addTenderItem(e,s){try{const r=await this.getById(e);if(!r)throw new Error("Tender not found");const i={...s,internalId:Ct("TENDER_ITEM"),addedAt:new Date,materialInternalId:s.materialInternalId||s.materialId},a=r.items||[];if(a.some(c=>c.materialInternalId===i.materialInternalId))throw new Error(` ${s.materialName||" "}    `);const l=[...a,i];return await this.updateTender(e,{...r,items:l,estimatedValue:this.calculateEstimatedValue(l)}),i.internalId}catch(r){throw console.error("Error adding tender item:",r),r}}async updateTenderItem(e,s,r){try{const i=await this.getById(e);if(!i)throw new Error("Tender not found");const a=i.items||[],o=a.findIndex(l=>l.internalId===s);if(o===-1)throw new Error("Tender item not found");return a[o]={...a[o],...r,updatedAt:new Date},await this.updateTender(e,{...i,items:a,estimatedValue:this.calculateEstimatedValue(a)}),!0}catch(i){throw console.error("Error updating tender item:",i),i}}async removeTenderItem(e,s){try{const r=await this.getById(e);if(!r)throw new Error("Tender not found");const a=(r.items||[]).filter(o=>o.internalId!==s);return await this.updateTender(e,{...r,items:a,estimatedValue:this.calculateEstimatedValue(a)}),!0}catch(r){throw console.error("Error removing tender item:",r),r}}calculateEstimatedValue(e){return!e||!Array.isArray(e)?0:e.reduce((s,r)=>{const i=parseFloat(r.unitPrice||0),a=parseFloat(r.quantity||1);return s+i*a},0)}async addTenderDocument(e,s){try{const r=await this.getById(e);if(!r)throw new Error("Tender not found");const i={...s,internalId:Ct("DOCUMENT"),uploadedAt:new Date},o=[...r.documents||[],i];return await this.updateTender(e,{...r,documents:o}),i.internalId}catch(r){throw console.error("Error adding tender document:",r),r}}async removeTenderDocument(e,s){try{const r=await this.getById(e);if(!r)throw new Error("Tender not found");const a=(r.documents||[]).filter(o=>o.internalId!==s);return await this.updateTender(e,{...r,documents:a}),!0}catch(r){throw console.error("Error removing tender document:",r),r}}async updateTenderDocuments(e,s){try{return await this.update(e,{documents:s||[],updatedAt:new Date},{updateCache:!0})}catch(r){throw console.error("Error updating tender documents:",r),r}}async updateTenderStatus(e,s){try{if(!["draft","submitted","in_review","awarded","rejected","cancelled"].includes(s))throw new Error(`  : ${s}`);const i=await this.getById(e);if(!i)throw new Error("Tender not found");return await this.updateTender(e,{...i,status:s,statusUpdatedAt:new Date}),!0}catch(r){throw console.error("Error updating tender status:",r),r}}}const dn=new k1,Po=Object.freeze(Object.defineProperty({__proto__:null,TenderServiceNew:k1,tenderServiceNew:dn},Symbol.toStringTag,{value:"Module"}));class On{static async isTenderAlreadyTracked(e){try{console.log(" [TRACKING-SERVICE] Checking if tender is already tracked:",e);const s=st(Pe(ae,this.COLLECTION_NAME),xt("tenderId","==",e),xt("isActive","==",!0)),i=!(await qe(s)).empty;return console.log(i?" [TRACKING-SERVICE] Tender already tracked":" [TRACKING-SERVICE] Tender not tracked yet"),i}catch(s){return console.error(" [TRACKING-SERVICE] Error checking tender tracking status:",s),!1}}static async getTrackedTenderIds(){try{console.log(" [TRACKING-SERVICE] Fetching all tracked tender IDs");const e=st(Pe(ae,this.COLLECTION_NAME),xt("isActive","==",!0)),s=await qe(e),r=[];return s.forEach(i=>{const a=i.data();a.tenderId&&r.push(a.tenderId)}),console.log(" [TRACKING-SERVICE] Found tracked tender IDs:",r.length),r}catch(e){return console.error(" [TRACKING-SERVICE] Error fetching tracked tender IDs:",e),[]}}static async removeDuplicateTrackingEntries(){try{console.log(" [TRACKING-SERVICE] Starting duplicate cleanup");const e=st(Pe(ae,this.COLLECTION_NAME),xt("isActive","==",!0)),s=await qe(e),r=new Map,i=[];s.forEach(a=>{const o=a.data(),l=o.tenderId;if(r.has(l)){const c=r.get(l),d=this.safeConvertToDate(c.data.createdAt),u=this.safeConvertToDate(o.createdAt);u&&d&&u>d?(i.push(c.id),r.set(l,{id:a.id,data:o})):i.push(a.id)}else r.set(l,{id:a.id,data:o})});for(const a of i)await es(Le(ae,this.COLLECTION_NAME,a)),console.log(" [TRACKING-SERVICE] Removed duplicate:",a);return console.log(" [TRACKING-SERVICE] Cleanup completed. Removed",i.length,"duplicates"),i.length}catch(e){throw console.error(" [TRACKING-SERVICE] Error during duplicate cleanup:",e),new Error(`    : ${e.message}`)}}static async initializeTenderTracking(e){try{const s=e.id||e.internalId;console.log(" [TRACKING-SERVICE] Initializing tender tracking:",s),console.log(" [TRACKING-SERVICE] Running bulletproof cleanup before initialization...");try{await this.removeTenderFromTracking(s),console.log(" [TRACKING-SERVICE] Bulletproof cleanup completed")}catch(o){console.log(" [TRACKING-SERVICE] Cleanup completed (no documents found):",o.message)}await this.isTenderAlreadyTracked(s)&&(console.log(" [TRACKING-SERVICE] Tender still appears tracked after cleanup, force proceeding..."),console.log(" [TRACKING-SERVICE] This should not happen - investigating..."));const i={tenderId:e.id||e.internalId,title:e.title||" ",entity:e.entity||" ",referenceNumber:e.referenceNumber||"",description:e.description||"",estimatedValue:e.estimatedValue||0,currency:"SAR",submissionDeadline:e.submissionDeadline||e.deadline||null,createdAt:We(),updatedAt:We(),stage:this.STAGES.PENDING,progress:0,priority:e.priority||"medium",statusHistory:[{stage:this.STAGES.PENDING,timestamp:new Date,note:"   ",userId:"current_user"}],isActive:!0,isSelectedTender:!1,tags:[],createdBy:"current_user",lastModifiedBy:"current_user"},a=await As(Pe(ae,this.COLLECTION_NAME),i);console.log(" [TRACKING-SERVICE] Tender tracking initialized with ID:",a.id),console.log(" [TRACKING-SERVICE] Updating main tender document with tracking status...");try{const{TenderService:o}=await Xe(async()=>{const{TenderService:l}=await Promise.resolve().then(()=>uU);return{TenderService:l}},void 0);await o.updateTender(i.tenderId,{trackingStatus:"tracking",trackingStartedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),console.log(" [TRACKING-SERVICE] Main tender document updated with tracking status")}catch(o){throw console.error(" [TRACKING-SERVICE] Failed to update main tender document:",o),new Error("     ")}try{await ws.logActivity("tracking_add",`   : ${i.entity}`,{tenderId:i.tenderId,tenderEntity:i.entity,tenderTitle:i.title,stage:this.STAGES.PENDING,stageTitle:" "}),console.log(" [TRACKING-SERVICE] Activity logged for tracking initialization")}catch(o){console.warn(" [TRACKING-SERVICE] Failed to log activity, but tracking continues:",o)}return{id:a.id,...i}}catch(s){throw console.error(" [TRACKING-SERVICE] Error initializing tender tracking:",s),new Error(`    : ${s.message}`)}}static async getAllTrackedTenders(){try{console.log(" [TRACKING-SERVICE] Fetching all tracked tenders");const e=st(Pe(ae,this.COLLECTION_NAME),xt("isActive","==",!0)),s=await qe(e),r=[];s.forEach(a=>{const o=a.data();r.push({id:a.id,...o,createdAt:this.safeConvertToDate(o.createdAt),updatedAt:this.safeConvertToDate(o.updatedAt),submissionDeadline:this.safeConvertToDate(o.submissionDeadline)})}),r.sort((a,o)=>{const l=a.updatedAt||new Date(0);return(o.updatedAt||new Date(0)).getTime()-l.getTime()});const i={[this.STAGES.PENDING]:[],[this.STAGES.IN_PROGRESS]:[],[this.STAGES.REVIEW]:[],[this.STAGES.COMPLETED]:[]};return r.forEach(a=>{i[a.stage]&&i[a.stage].push(a)}),console.log(" [TRACKING-SERVICE] Retrieved tracked tenders:",{total:r.length,pending:i[this.STAGES.PENDING].length,inProgress:i[this.STAGES.IN_PROGRESS].length,review:i[this.STAGES.REVIEW].length,completed:i[this.STAGES.COMPLETED].length}),i}catch(e){throw console.error(" [TRACKING-SERVICE] Error fetching tracked tenders:",e),new Error(`    : ${e.message}`)}}static subscribeToTrackedTenders(e){try{console.log(" [TRACKING-SERVICE] Setting up real-time listener");const s=st(Pe(ae,this.COLLECTION_NAME),xt("isActive","==",!0));return ar(s,i=>{const a=[];i.forEach(l=>{const c=l.data();a.push({id:l.id,...c,createdAt:this.safeConvertToDate(c.createdAt),updatedAt:this.safeConvertToDate(c.updatedAt),submissionDeadline:this.safeConvertToDate(c.submissionDeadline)})}),a.sort((l,c)=>{const d=l.updatedAt||new Date(0);return(c.updatedAt||new Date(0)).getTime()-d.getTime()});const o={[this.STAGES.PENDING]:[],[this.STAGES.IN_PROGRESS]:[],[this.STAGES.REVIEW]:[],[this.STAGES.COMPLETED]:[]};a.forEach(l=>{o[l.stage]&&o[l.stage].push(l)}),console.log(" [TRACKING-SERVICE] Real-time update:",a.length,"tenders"),e(o)},i=>{console.error(" [TRACKING-SERVICE] Real-time listener error:",i),e(null,i)})}catch(s){throw console.error(" [TRACKING-SERVICE] Error setting up real-time listener:",s),s}}static async moveTenderStage(e,s,r=""){var i,a;try{console.log(" [TRACKING-SERVICE] Moving tender to new stage:",{tenderId:e,newStage:s});const o=await fh(ae,async l=>{const c=Le(ae,this.COLLECTION_NAME,e),d=await l.get(c);if(!d.exists())throw new Error("  ");const u=d.data(),f=u.stage;if(f===s)return console.log(" [TRACKING-SERVICE] Stage unchanged, skipping update"),u;const p={[this.STAGES.PENDING]:25,[this.STAGES.IN_PROGRESS]:50,[this.STAGES.REVIEW]:75,[this.STAGES.COMPLETED]:100},j={stage:s,progress:p[s]||0,updatedAt:We(),lastModifiedBy:"current_user",statusHistory:[...u.statusHistory||[],{fromStage:f,toStage:s,timestamp:new Date,note:r||`    ${this.getStageDisplayName(f)}  ${this.getStageDisplayName(s)}`,userId:"current_user"}]};return l.update(c,j),{id:e,...u,...j}});console.log(" [TRACKING-SERVICE] Tender stage moved successfully");try{const l=this.getStageDisplayName((i=o.statusHistory[o.statusHistory.length-1])==null?void 0:i.fromStage),c=this.getStageDisplayName(o.stage);await ws.logActivity("tracking_stage_move",`   ${o.entity}  ${l}  ${c}`,{tenderId:o.tenderId,tenderEntity:o.entity,tenderTitle:o.title,fromStage:(a=o.statusHistory[o.statusHistory.length-1])==null?void 0:a.fromStage,toStage:o.stage,fromStageTitle:l,toStageTitle:c,note:r}),console.log(" [TRACKING-SERVICE] Activity logged for stage movement")}catch(l){console.warn(" [TRACKING-SERVICE] Failed to log stage movement activity:",l)}return o}catch(o){throw console.error(" [TRACKING-SERVICE] Error moving tender stage:",o),new Error(`    : ${o.message}`)}}static async updateTenderDetails(e,s){try{console.log(" [TRACKING-SERVICE] Updating tender details:",e);const r=Le(ae,this.COLLECTION_NAME,e),i={...s,updatedAt:We(),lastModifiedBy:"current_user"};return await Qt(r,i),console.log(" [TRACKING-SERVICE] Tender details updated successfully"),i}catch(r){throw console.error(" [TRACKING-SERVICE] Error updating tender details:",r),new Error(`    : ${r.message}`)}}static async archiveTender(e,s=""){try{console.log(" [TRACKING-SERVICE] Archiving tender:",e);const r=Le(ae,this.COLLECTION_NAME,e),i={isActive:!1,archivedAt:We(),archiveReason:s,archivedBy:"current_user",updatedAt:We()};return await Qt(r,i),console.log(" [TRACKING-SERVICE] Tender archived successfully"),i}catch(r){throw console.error(" [TRACKING-SERVICE] Error archiving tender:",r),new Error(`   : ${r.message}`)}}static async removeTenderFromTracking(e){try{console.log(" [TRACKING-SERVICE] Removing tender from tracking completely:",e),console.log(" [TRACKING-SERVICE] Querying for tracking documents...");const s=st(Pe(ae,this.COLLECTION_NAME),xt("tenderId","==",e),xt("isActive","==",!0)),r=await qe(s);if(console.log(` [TRACKING-SERVICE] Found ${r.size} tracking documents for tender ${e}`),r.empty)return console.log(" [TRACKING-SERVICE] No tracking document found for tender:",e),!0;const i=[];let a=0;return r.forEach(o=>{a++;const l=o.data();console.log(` [TRACKING-SERVICE] Deleting tracking document ${a}:`,{docId:o.id,tenderId:l.tenderId,isActive:l.isActive,title:l.title}),i.push(es(o.ref))}),console.log(` [TRACKING-SERVICE] Deleting ${i.length} documents...`),await Promise.all(i),console.log(" [TRACKING-SERVICE] Tender removed from tracking successfully"),!0}catch(s){throw console.error(" [TRACKING-SERVICE] Error removing tender from tracking:",s),console.error(" [TRACKING-SERVICE] Full error details:",{message:s.message,code:s.code,stack:s.stack}),new Error(`     : ${s.message}`)}}static async getTenderById(e){try{console.log(" [TRACKING-SERVICE] Fetching tender by ID:",e);const s=Le(ae,this.COLLECTION_NAME,e),r=await ss(s);if(!r.exists())throw new Error("  ");const i=r.data();return{id:r.id,...i,createdAt:this.safeConvertToDate(i.createdAt),updatedAt:this.safeConvertToDate(i.updatedAt),submissionDeadline:this.safeConvertToDate(i.submissionDeadline)}}catch(s){throw console.error(" [TRACKING-SERVICE] Error fetching tender by ID:",s),new Error(`    : ${s.message}`)}}static getStageDisplayName(e){return{[this.STAGES.PENDING]:" ",[this.STAGES.IN_PROGRESS]:" ",[this.STAGES.REVIEW]:"  ",[this.STAGES.COMPLETED]:" "}[e]||" "}static calculateDaysRemaining(e){if(!e)return null;const s=new Date,r=e instanceof Date?e:new Date(e);if(isNaN(r.getTime()))return null;const i=r.getTime()-s.getTime();return Math.ceil(i/(1e3*3600*24))}static getStatusText(e){const s=this.calculateDaysRemaining(e);return s===null?" ":s<0?" ":s===1?"  ":s===2?" ":` ${s} `}static safeConvertToDate(e){try{if(!e)return null;if(e instanceof Date)return isNaN(e.getTime())?null:e;if(e&&typeof e.toDate=="function")return e.toDate();if(typeof e=="string"||typeof e=="number"){const s=new Date(e);return isNaN(s.getTime())?null:s}return e&&typeof e=="object"&&e.seconds?new Date(e.seconds*1e3):null}catch(s){return console.warn(" [TRACKING-SERVICE] Date conversion failed for:",e,s),null}}static async getTrackingStatistics(){try{console.log(" [TRACKING-SERVICE] Fetching tracking statistics");const e=st(Pe(ae,this.COLLECTION_NAME),xt("isActive","==",!0)),s=await qe(e),r={total:0,byStage:{[this.STAGES.PENDING]:0,[this.STAGES.IN_PROGRESS]:0,[this.STAGES.REVIEW]:0,[this.STAGES.COMPLETED]:0},byPriority:{high:0,medium:0,low:0},totalValue:0};return s.forEach(i=>{const a=i.data();r.total++,r.byStage[a.stage]=(r.byStage[a.stage]||0)+1,r.byPriority[a.priority]=(r.byPriority[a.priority]||0)+1,r.totalValue+=a.estimatedValue||0}),console.log(" [TRACKING-SERVICE] Statistics retrieved:",r),r}catch(e){throw console.error(" [TRACKING-SERVICE] Error fetching statistics:",e),new Error(`   : ${e.message}`)}}}Ys(On,"COLLECTION_NAME","tenderTracking"),Ys(On,"STAGES",{PENDING:"pending",IN_PROGRESS:"inProgress",REVIEW:"review",COMPLETED:"completed"});const dU=Object.freeze(Object.defineProperty({__proto__:null,TenderTrackingService:On,default:On},Symbol.toStringTag,{value:"Module"}));class tn{static async getAllTenders(){try{console.log(" Fetching tenders from Firestore...");const e=await dn.getAllTenders();return console.log(" Loaded tenders from Firestore:",e.length),await this.autoArchiveExpiredTenders(e),e}catch(e){throw console.error(" Error fetching tenders:",e),new Error("    : "+e.message)}}static async getTenderById(e){try{console.log(" Fetching tender by ID:",e);const s=await dn.getById(e);if(!s)throw new Error("  ");return s}catch(s){throw console.error(" Error fetching tender:",s),new Error("    : "+s.message)}}static async createTender(e){try{console.log(" Creating tender in Firestore...");const s=await dn.createTender(e);return console.log(" Tender created in Firestore with ID:",s.id),s.id}catch(s){throw console.error(" Error creating tender:",s),new Error("   : "+s.message)}}static async updateTender(e,s){try{console.log(" Updating tender in Firestore:",e);const r={...s},i=await dn.update(e,r);return console.log(" Tender updated in Firestore"),!0}catch(r){throw console.error(" Error updating tender:",r),new Error("    : "+r.message)}}static async deleteTender(e){try{return console.log(" Deleting tender from Firestore:",e),await dn.delete(e),console.log(" Tender deleted from Firestore"),!0}catch(s){throw console.error(" Error deleting tender:",s),new Error("   : "+s.message)}}static validateTenderData(e){var r,i,a;const s={};if((r=e.title)!=null&&r.trim()||(s.title="  "),(i=e.referenceNumber)!=null&&i.trim()||(s.referenceNumber="  "),(a=e.entity)!=null&&a.trim()||(s.entity=" "),e.estimatedValue!==void 0&&e.estimatedValue!==""){const o=parseFloat(e.estimatedValue);(isNaN(o)||o<0)&&(s.estimatedValue="      ")}return e.contactEmail&&e.contactEmail.trim()&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.contactEmail.trim())||(s.contactEmail="    ")),s}static async searchTenders(e){try{return(await this.getAllTenders()).filter(r=>{var i,a,o;return((i=r.title)==null?void 0:i.toLowerCase().includes(e.toLowerCase()))||((a=r.referenceNumber)==null?void 0:a.toLowerCase().includes(e.toLowerCase()))||((o=r.entity)==null?void 0:o.toLowerCase().includes(e.toLowerCase()))})}catch(s){throw console.error(" Error searching tenders:",s),new Error("    : "+s.message)}}static async getTendersByStatus(e){try{return(await this.getAllTenders()).filter(r=>r.status===e)}catch(s){throw console.error(" Error fetching tenders by status:",s),new Error("     : "+s.message)}}static async autoArchiveExpiredTenders(e){var s;try{console.log(" Checking for expired tenders to auto-archive...",e.length,"tenders to check");const r=new Date;let i=0;for(const a of e){if(console.log(` Checking tender: ${a.title}`),console.log(`   - Current status: ${a.status}`),console.log(`   - Submission deadline: ${a.submissionDeadline}`),console.log(`   - Deadline type: ${typeof a.submissionDeadline}`),a.status==="archived"){console.log("    Already archived, skipping");continue}if(a.status==="lost"||a.status===""){console.log("    Tender is lost, skipping auto-archive");continue}if(a.status==="won"||a.status===""){console.log("    Tender is won, ABSOLUTE SKIP for auto-archive");continue}if(a.absolutePersistence===!0||a.persistenceProtection===!0||a.statusLocked===!0||a.preventAutoArchive===!0){console.log("    Tender has protection flags, skipping auto-archive"),console.log(`      absolutePersistence: ${a.absolutePersistence}`),console.log(`      persistenceProtection: ${a.persistenceProtection}`),console.log(`      statusLocked: ${a.statusLocked}`),console.log(`      preventAutoArchive: ${a.preventAutoArchive}`);continue}if(a.protectedStatus&&a.protectedStatus===a.status){console.log(`    Tender status is protected (${a.protectedStatus}), skipping auto-archive`);continue}if(a.wonAt||(s=a.lastStatusChange)!=null&&s.includes("won")){console.log("    EMERGENCY PROTECTION: Detected won tender indicators, forcing skip"),console.log(`      wonAt: ${a.wonAt}`),console.log(`      lastStatusChange: ${a.lastStatusChange}`);continue}const o=this.isTenderExpired(a,r);if(console.log(`   - Is expired: ${o}`),o){console.log(` Auto-archiving expired tender: ${a.title}`);const l=a.id,c=a.internalId;if(console.log(`   - Using Firestore ID: ${l}`),console.log(`   - Internal ID: ${c}`),!l){console.error(`    No Firestore ID found for tender: ${a.title}`);continue}try{const d={status:"archived",archivedAt:r.toISOString(),autoArchived:!0,updatedAt:r.toISOString()};await this.updateTender(l,d),a.status="archived",a.archivedAt=r.toISOString(),a.autoArchived=!0,i++,console.log(`    Successfully archived tender: ${a.title}`)}catch(d){console.error(`    Failed to archive tender ${a.title}:`,d)}}}i>0?console.log(` Auto-archived ${i} expired tenders`):console.log(" No expired tenders found to archive")}catch(r){console.error(" Error in auto-archive process:",r)}}static isTenderExpired(e,s=new Date){if(console.log(`      isTenderExpired check for: ${e.title}`),!e.submissionDeadline)return console.log("      No submission deadline found"),!1;let r;e.submissionDeadline&&typeof e.submissionDeadline=="object"&&e.submissionDeadline.seconds?(r=new Date(e.submissionDeadline.seconds*1e3),console.log(`      Firestore timestamp converted: ${r}`)):e.submissionDeadline instanceof Date?(r=e.submissionDeadline,console.log(`      Date object used: ${r}`)):(r=new Date(e.submissionDeadline),console.log(`      String converted to date: ${r}`));const i=r.getTime()-s.getTime(),a=Math.ceil(i/(1e3*3600*24));return console.log(`      Current date: ${s}`),console.log(`      Deadline: ${r}`),console.log(`      Days remaining: ${a}`),console.log(`      Is expired: ${a<0}`),a<0}static async getActiveTenders(){try{console.log(" Fetching active tenders from Firestore...");const e=await dn.getAllTenders();await this.autoArchiveExpiredTenders(e);const s=e.filter(r=>r.status!=="archived"&&r.trackingStatus!=="tracking"&&r.status!=="lost"&&r.status!==""&&r.status!=="won"&&r.status!=="");return console.log(" Loaded active tenders (excluding archived, tracking, lost, and won):",s.length),s}catch(e){throw console.error(" Error fetching active tenders:",e),new Error("     : "+e.message)}}static async getArchivedTenders(){try{console.log(" Fetching archived tenders from Firestore...");const e=await dn.getAllTenders();await this.autoArchiveExpiredTenders(e);const s=e.filter(r=>r.status==="archived"&&r.trackingStatus!=="tracking");return console.log(" Loaded archived tenders (excluding tracking):",s.length),s}catch(e){throw console.error(" Error fetching archived tenders:",e),new Error("     : "+e.message)}}static async getLostTenders(){try{console.log(" Fetching lost tenders from Firestore...");const s=(await dn.getAllTenders()).filter(r=>r.status==="lost"||r.status==="");return console.log(" Loaded lost tenders:",s.length),s}catch(e){throw console.error(" Error fetching lost tenders:",e),new Error("     : "+e.message)}}static async getWonProjects(){try{console.log(" Fetching won projects from Firestore...");const s=(await dn.getAllTenders()).filter(r=>r.status==="won"||r.status==="");console.log(" Loaded won projects:",s.length);for(const r of s)(!r.preventAutoArchive||!r.absolutePersistence||!r.persistenceProtection||!r.statusLocked||r.protectedStatus!=="won")&&(console.log(` [WON-PROTECTION] Fixing missing protection flags for: ${r.title}`),await this.updateTender(r.id,{preventAutoArchive:!0,absolutePersistence:!0,persistenceProtection:!0,statusLocked:!0,protectedStatus:"won",archivedAt:null,autoArchived:!1,manualArchived:!1,archiveStatus:null,updatedAt:new Date().toISOString()}),console.log(` [WON-PROTECTION] Protection flags applied to: ${r.title}`));return s}catch(e){throw console.error(" Error fetching won projects:",e),new Error("     : "+e.message)}}static async getTrackingTenders(){try{console.log(" Fetching tracking tenders from Firestore...");const s=(await dn.getAllTenders()).filter(r=>r.trackingStatus==="tracking"&&r.status!=="lost"&&r.status!==""&&r.status!=="won"&&r.status!=="");return console.log(" Loaded tracking tenders:",s.length),s}catch(e){throw console.error(" Error fetching tracking tenders:",e),new Error("     : "+e.message)}}static async moveToTracking(e){try{return console.log(" Moving tender to tracking:",e),await this.updateTender(e,{trackingStatus:"tracking",trackingStartedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),console.log(" Tender moved to tracking"),!0}catch(s){throw console.error(" Error moving tender to tracking:",s),new Error("    : "+s.message)}}static async removeFromTracking(e){try{console.log(" [ENHANCED-CLEANUP] REMOVE FROM TRACKING CALLED:",e),console.log(" [ENHANCED-CLEANUP] This should appear in console if method is called"),console.log(" [CLEANUP] Step 1: Updating main tender document..."),await this.updateTender(e,{trackingStatus:null,trackingStage:null,trackingStartedAt:null,trackingEndedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),console.log(" [CLEANUP] Step 1 completed: Main tender document updated"),console.log(" [CLEANUP] Step 2: Removing tracking collection document...");try{await On.removeTenderFromTracking(e),console.log(" [CLEANUP] Step 2 completed: Tracking collection document removed")}catch(s){console.error(" [CLEANUP] Step 2 failed:",s),console.warn(" [CLEANUP] Continuing despite tracking collection cleanup failure")}console.log(" [CLEANUP] Step 3: Verifying cleanup...");try{await On.isTenderAlreadyTracked(e)?(console.error(" [CLEANUP] VERIFICATION FAILED: Tender still appears to be tracked!"),console.log(" [CLEANUP] Attempting additional cleanup..."),await On.removeTenderFromTracking(e)):console.log(" [CLEANUP] Step 3 completed: Verification successful - tender no longer tracked")}catch(s){console.error(" [CLEANUP] Step 3 verification error:",s)}console.log(" Tender removed from tracking completely (both collections cleaned)");try{window.dispatchEvent(new CustomEvent("tenderReturnedToList",{detail:{tenderId:e}})),console.log(" Real-time sync event dispatched")}catch(s){console.warn(" Could not dispatch sync event:",s)}return!0}catch(s){throw console.error(" Error removing tender from tracking:",s),new Error("     : "+s.message)}}static async emergencyCleanupTrackingDocuments(e){try{console.log(" [EMERGENCY-CLEANUP] Cleaning up tracking documents for:",e);const s=await On.removeTenderFromTracking(e);return console.log(" [EMERGENCY-CLEANUP] Cleanup completed:",s),s}catch(s){return console.error(" [EMERGENCY-CLEANUP] Failed:",s),!1}}static async restoreMissingTenders(){try{console.log(" Restoring any missing tenders to tracking...");const s=(await this.getAllTenders()).filter(r=>r.trackingStartedAt&&r.lastStatusChange==="returned_to_selection_list"||r.absolutePersistence===!0&&r.lastStatusChange==="returned_to_selection_list");console.log(`Found ${s.length} potentially missing tenders`);for(const r of s)console.log(` Restoring tender: ${r.title}`),await this.updateTender(r.id,{trackingStatus:"tracking",trackingStage:"pending",status:"active",returnedToListAt:null,lastStatusChange:"restored_to_tracking",absolutePersistence:!1,statusChangeTimestamp:new Date().toISOString(),updatedAt:new Date().toISOString()});return console.log(` Restored ${s.length} tenders to tracking`),s.length}catch(e){throw console.error(" Error restoring missing tenders:",e),e}}static async moveToLostTendersAbsolute(e){try{console.log(" [ABSOLUTE-PERSISTENCE] Starting bulletproof move to lost tenders:",e),console.log(" [ABSOLUTE-PERSISTENCE] Step 1: Complete tracking cleanup"),await this.removeFromTracking(e);try{const{TenderTrackingService:i}=await Xe(async()=>{const{TenderTrackingService:l}=await Promise.resolve().then(()=>dU);return{TenderTrackingService:l}},void 0),a=await i.getAllTrackedTenders(),o=Object.values(a);for(const l of o){const c=l.find(d=>d.tenderId===e||d.id===e||d.internalId===e);c&&(console.log(` [ABSOLUTE-PERSISTENCE] Removing tracking entry: ${c.id}`),await i.removeTenderFromTracking(c.id))}}catch(i){console.log(" [ABSOLUTE-PERSISTENCE] No legacy tracking to clean:",i.message)}console.log(" [ABSOLUTE-PERSISTENCE] Step 2: Setting lost status with persistence flags");const s={status:"lost",trackingStatus:null,trackingStage:null,trackingStartedAt:null,trackingEndedAt:null,lostAt:new Date().toISOString(),absolutePersistence:!0,lastStatusChange:"moved_to_lost",statusChangeTimestamp:new Date().toISOString(),updatedAt:new Date().toISOString()};if(await this.updateTender(e,s),console.log(" [ABSOLUTE-PERSISTENCE] Step 3: Ensuring Firestore consistency"),await new Promise(i=>setTimeout(i,2e3)),console.log(" [ABSOLUTE-PERSISTENCE] Step 4: Verifying persistence"),(await this.getTenderById(e)).status!=="lost")throw new Error("Failed to persist lost status - verification failed");return console.log(" [ABSOLUTE-PERSISTENCE] Bulletproof move to lost completed successfully"),!0}catch(s){throw console.error(" [ABSOLUTE-PERSISTENCE] Error in bulletproof move to lost:",s),new Error("     : "+s.message)}}static async moveFromLostTendersAbsolute(e,s="active",r=!1){try{console.log(" [ABSOLUTE-PERSISTENCE] Starting bulletproof move from lost tenders:",e),console.log(" [ABSOLUTE-PERSISTENCE] Step 1: Preparing restoration data");const i={status:s,lostAt:null,restoredFromLostAt:new Date().toISOString(),absolutePersistence:!0,lastStatusChange:`restored_from_lost_to_${s}`,statusChangeTimestamp:new Date().toISOString(),updatedAt:new Date().toISOString()};if(r&&(i.trackingStatus="tracking",i.trackingStage="pending",i.trackingStartedAt=new Date().toISOString()),console.log(" [ABSOLUTE-PERSISTENCE] Step 2: Updating tender status"),await this.updateTender(e,i),console.log(" [ABSOLUTE-PERSISTENCE] Step 3: Ensuring Firestore consistency"),await new Promise(o=>setTimeout(o,2e3)),console.log(" [ABSOLUTE-PERSISTENCE] Step 4: Verifying restoration"),(await this.getTenderById(e)).status!==s)throw new Error(`Failed to persist ${s} status - verification failed`);return console.log(" [ABSOLUTE-PERSISTENCE] Bulletproof restoration completed successfully"),!0}catch(i){throw console.error(" [ABSOLUTE-PERSISTENCE] Error in bulletproof restoration:",i),new Error("      : "+i.message)}}static async manualArchiveTender(e,s="Manual archive for testing"){try{console.log(" Manually archiving tender:",e);const r=await this.getTenderById(e);return await this.updateTender(e,{...r,status:"archived",archivedAt:new Date().toISOString(),manualArchived:!0,archiveReason:s,updatedAt:new Date().toISOString()}),console.log(" Tender manually archived:",r.title),!0}catch(r){throw console.error(" Error manually archiving tender:",r),r}}static async manualRestoreTender(e){try{console.log(" Manually restoring tender:",e);const s=await this.getTenderById(e);return await this.updateTender(e,{...s,status:"active",archivedAt:null,autoArchived:!1,manualArchived:!1,restoredAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),console.log(" Tender manually restored:",s.title),!0}catch(s){throw console.error(" Error manually restoring tender:",s),s}}static async forceRestoreToTracking(e=" "){try{console.log(" [FORCE-RESTORE] Searching for tender:",e);const s=await this.getAllTenders();console.log(" [FORCE-RESTORE] Total tenders found:",s.length);const r=s.find(o=>o.entity&&o.entity.includes(e));if(!r)throw console.error(" [FORCE-RESTORE] Tender not found:",e),new Error(`    : ${e}`);console.log(" [FORCE-RESTORE] Found tender:",{id:r.id,title:r.title,entity:r.entity,status:r.status,trackingStatus:r.trackingStatus});const i={status:"active",trackingStatus:"tracking",trackingStage:"pending",trackingStartedAt:new Date().toISOString(),archivedAt:null,autoArchived:!1,manualArchived:!1,forceRestoredAt:new Date().toISOString(),forceRestoredBy:"admin",absolutePersistence:!0,lastStatusChange:"force_restored_to_tracking",statusChangeTimestamp:new Date().toISOString(),updatedAt:new Date().toISOString()};await this.updateTender(r.id,i),await new Promise(o=>setTimeout(o,2e3));const a=await this.getTenderById(r.id);if(a.trackingStatus!=="tracking")throw new Error("Failed to verify tracking status after restoration");return console.log(" [FORCE-RESTORE] Successfully restored tender to tracking:",r.entity),{success:!0,tender:a,message:`   ${r.entity}    `}}catch(s){throw console.error(" [FORCE-RESTORE] Error in force restore:",s),new Error(`   : ${s.message}`)}}static async moveToWonProjectsAbsolute(e){try{console.log(" [ABSOLUTE-PERSISTENCE] Starting bulletproof move to won projects:",e),console.log(" [ABSOLUTE-PERSISTENCE] Step 1: Complete tracking cleanup"),await this.removeFromTracking(e),console.log(" [ABSOLUTE-PERSISTENCE] Step 2: Setting won status with persistence flags");const s={status:"won",trackingStatus:null,trackingStage:null,trackingStartedAt:null,trackingEndedAt:null,returnedToListAt:null,archivedAt:null,autoArchived:!1,manualArchived:!1,archiveStatus:null,lostAt:null,restoredAt:null,restoredFrom:null,wonAt:new Date().toISOString(),absolutePersistence:!0,persistenceProtection:!0,protectedStatus:"won",preventAutoArchive:!0,lastStatusChange:"moved_to_won_absolute",statusChangeTimestamp:new Date().toISOString(),statusLocked:!0,updatedAt:new Date().toISOString()};if(await this.updateTender(e,s),console.log(" [ABSOLUTE-PERSISTENCE] Step 3: Ensuring Firestore consistency"),await new Promise(i=>setTimeout(i,2e3)),console.log(" [ABSOLUTE-PERSISTENCE] Step 4: Verifying persistence"),(await this.getTenderById(e)).status!=="won")throw new Error("Failed to persist won status - verification failed");return console.log(" [ABSOLUTE-PERSISTENCE] Bulletproof move to won completed successfully"),!0}catch(s){throw console.error(" [ABSOLUTE-PERSISTENCE] Error in bulletproof move to won:",s),new Error("     : "+s.message)}}static async moveFromWonProjectsAbsolute(e,s="active",r=!1){try{console.log(" [ABSOLUTE-PERSISTENCE] Starting bulletproof move from won projects:",e),console.log(" [ABSOLUTE-PERSISTENCE] Step 1: Preparing restoration data");const i={status:s,wonAt:null,restoredFromWonAt:new Date().toISOString(),absolutePersistence:!0,lastStatusChange:`restored_from_won_to_${s}`,statusChangeTimestamp:new Date().toISOString(),updatedAt:new Date().toISOString()};if(r&&(i.trackingStatus="tracking",i.trackingStage="pending",i.trackingStartedAt=new Date().toISOString()),console.log(" [ABSOLUTE-PERSISTENCE] Step 2: Updating tender status"),await this.updateTender(e,i),console.log(" [ABSOLUTE-PERSISTENCE] Step 3: Ensuring Firestore consistency"),await new Promise(o=>setTimeout(o,2e3)),console.log(" [ABSOLUTE-PERSISTENCE] Step 4: Verifying restoration"),(await this.getTenderById(e)).status!==s)throw new Error(`Failed to persist ${s} status - verification failed`);return console.log(" [ABSOLUTE-PERSISTENCE] Bulletproof restoration completed successfully"),!0}catch(i){throw console.error(" [ABSOLUTE-PERSISTENCE] Error in bulletproof restoration:",i),new Error("      : "+i.message)}}}const uU=Object.freeze(Object.defineProperty({__proto__:null,TenderService:tn,default:tn},Symbol.toStringTag,{value:"Module"})),hU=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>Go),void 0)),mU=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>Wo),void 0)),pU=h.lazy(()=>Xe(()=>import("./TendersList-1759246972099-kczZOTVH.js"),[])),L1=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>fi),void 0).then(n=>({default:n.ActivityProvider}))),F1=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>fi),void 0).then(n=>({default:n.AutoActivityTracker}))),fU=({searchTerm:n})=>{const[e,s]=h.useState(0),[r,i]=h.useState(0);h.useEffect(()=>{a()},[n]);const a=async()=>{try{const o=await tn.getActiveTenders();if(s(o.length),n!=null&&n.trim()){const l=o.filter(c=>{var d,u,f,p,j;return((d=c.title)==null?void 0:d.toLowerCase().includes(n.toLowerCase()))||((u=c.referenceNumber)==null?void 0:u.toLowerCase().includes(n.toLowerCase()))||((f=c.entity)==null?void 0:f.toLowerCase().includes(n.toLowerCase()))||((p=c.category)==null?void 0:p.toLowerCase().includes(n.toLowerCase()))||((j=c.location)==null?void 0:j.toLowerCase().includes(n.toLowerCase()))});i(l.length)}else i(o.length)}catch(o){console.error("Error loading tenders count:",o),s(0),i(0)}};return t.jsx("span",{className:"badge bg-secondary ms-2",style:{fontSize:"12px",fontWeight:"normal"},children:n!=null&&n.trim()?`${r}  ${e}`:e})};function gU(){const[n,e]=h.useState(!1),[s,r]=h.useState(0),[i,a]=h.useState(""),{isTimelineVisible:o}=Ut(),{hasPerm:l}=Yn(),c=kt(),d=l("tenders:create"),u=h.useCallback(()=>{e(p=>!p)},[]),f=h.useCallback(async()=>{try{await Ke.clearPendingData("tenderFormData_new"),await Ke.clearPendingData("tenderDocuments_new"),await Ke.clearPendingTenderItems(),console.log(" All pending data cleared - navigating to fresh Add Tender form"),c("/tenders/add")}catch(p){console.error(" Error clearing pending data:",p),c("/tenders/add")}},[c]);return t.jsx(h.Suspense,{fallback:t.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:"   ..."}),children:t.jsx(L1,{children:t.jsx(F1,{children:t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:u}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!o?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"20px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:10,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-file-earmark-text text-primary me-2"})," "]}),t.jsx(fU,{searchTerm:i})]}),t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:i,onChange:p=>a(p.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsx("button",{onClick:f,className:"btn btn-primary",disabled:!d,title:d?"":"     ",style:{height:"40px",width:"140px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:" "})]})]})}),t.jsx("div",{style:{height:"calc(100vh - 280px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"card-body p-0",children:t.jsx(pU,{refreshTrigger:s,searchTerm:i})})})]})})]}),!n&&o&&t.jsx(hU,{rtl:!0}),!n&&o&&t.jsx(mU,{})]})]})})})})}function kj(){return t.jsx(h.Suspense,{fallback:t.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:" ..."}),children:t.jsx(L1,{children:t.jsx(F1,{children:t.jsx(gU,{})})})})}class Bn{static async isFieldUnique(e,s,r=null,i=null){var o;if(!s||s.trim()==="")return!0;const a=s.trim().toLowerCase();console.log(` Checking uniqueness for ${e}: "${a}"`);for(const[l,c]of Object.entries(this.COLLECTIONS))try{console.log(` Checking collection: ${l} (exclude: ${i})`);const d=await qe(Pe(ae,c));console.log(` Found ${d.docs.length} documents in ${l}`);for(const u of d.docs){const f=u.data();if(r&&u.id===r&&i===l){console.log(` Skipping same document: ${u.id} in ${l}`);continue}const p=(o=f[e])==null?void 0:o.toString().trim().toLowerCase();if(p&&p!==""&&(console.log(` Comparing "${a}" with "${p}" from ${l}`),p===a)){const j=` ${this.getFieldDisplayName(e)}    ${this.getCollectionDisplayName(l)}`;throw console.log(` Duplicate found: ${j}`),new Error(j)}}}catch(d){if(d.message.includes(" "))throw d;console.error(`Error checking uniqueness in ${l}:`,d)}return console.log(` ${e} is unique: "${a}"`),!0}static async validateUniqueFields(e,s=null,r=null){const i={},a=["phone","email","taxNumber"];for(const o of a)if(e[o]&&e[o].trim()!=="")try{await this.isFieldUnique(o,e[o],s,r)}catch(l){i[o]=l.message}return i}static getFieldDisplayName(e){return{name:"",phone:" ",email:" ",taxNumber:" "}[e]||e}static getCollectionDisplayName(e){return{customers:"",suppliers:" ",foreignSuppliers:" ",rawmaterials:" ",competitors:""}[e]||e}static async isNameUnique(e,s=null,r=null){return!0}static async isCompetitorNameUnique(e,s=null){var i;if(!e||e.trim()==="")return!0;const r=e.trim().toLowerCase();console.log(` Checking competitor name uniqueness: "${r}"`);try{const a=await qe(Pe(ae,"competitors"));console.log(` Found ${a.docs.length} competitors to check`);for(const o of a.docs){const l=o.data();if(s&&(o.id===s||l.internalId===s)){console.log(` Skipping same competitor: ${o.id}`);continue}const c=(i=l.name)==null?void 0:i.toString().trim().toLowerCase();if(c&&c===r)return console.log(` Duplicate competitor name found: ${c}`),!1}return console.log(` Competitor name is unique: ${r}`),!0}catch(a){return console.error("Error checking competitor name uniqueness:",a),!0}}static async isPhoneUnique(e,s=null,r=null){return await this.isFieldUnique("phone",e,s,r)}static async isEmailUnique(e,s=null,r=null){return await this.isFieldUnique("email",e,s,r)}static async isTaxNumberUnique(e,s=null,r=null){return await this.isFieldUnique("taxNumber",e,s,r)}static async validateFieldRealTime(e,s,r=null,i=null){if(!s||s.trim()==="")return null;try{return await this.isFieldUnique(e,s,r,i),null}catch(a){return a.message}}}Ys(Bn,"COLLECTIONS",{customers:"customers",suppliers:"suppliers",foreignSuppliers:"foreignSuppliers",rawmaterials:"rawmaterials",competitors:"competitors"});class Xp{static async ensureEmployeeDocument(e=null){try{const s=e||ut.currentUser;if(!s)throw new Error("No authenticated user");const r=s.uid;if(this.cache.has(r)){const a=this.cache.get(r);if(Date.now()-a.timestamp<6e4)return a.employee}if(this.creationPromises.has(r))return await this.creationPromises.get(r);const i=this.createOrGetEmployee(s);this.creationPromises.set(r,i);try{const a=await i;return this.creationPromises.delete(r),a}catch(a){throw this.creationPromises.delete(r),a}}catch(s){throw console.error(" Employee document validation failed:",s),new Error(`     : ${s.message}`)}}static async createOrGetEmployee(e){const s=e.uid;console.log(" Checking employee document for user:",s);const r=Le(ae,"employees",s),i=await ss(r);if(i.exists()){const a=i.data();return console.log(" Employee document found:",{uid:s,name:a.fullName||a.name,status:a.status,email:a.email}),this.cache.set(s,{employee:a,timestamp:Date.now()}),a}return console.log(" Employee document not found, creating automatically..."),await this.createEmployeeDocument(e)}static async createEmployeeDocument(e){const s=e.uid,r=e.email||"",i=e.displayName||"",a=r.split("@")[0]||"",o={fullName:i||a,name:i||a,email:r,status:"active",role:"employee",department:"",jobTitle:"",phone:"",nationalId:"",hireDate:new Date().toISOString(),salary:0,createdAt:We(),updatedAt:We(),createdBy:"auto-system",autoCreated:!0,uid:s};console.log(" Creating employee document:",o);const l=Le(ae,"employees",s);return await yn(l,o),console.log(" Employee document created successfully for:",s),this.cache.set(s,{employee:o,timestamp:Date.now()}),this.logAutoCreation(s,r),o}static logAutoCreation(e,s){console.log(" Auto-Creation Event:",{type:"EMPLOYEE_AUTO_CREATED",uid:e,email:s,timestamp:new Date().toISOString(),reason:"Missing employee document for authenticated user"})}static clearCache(e=null){e?this.cache.delete(e):this.cache.clear()}static async validateEmployee(e=null){try{const s=await this.ensureEmployeeDocument(e);return{isValid:s.status==="active"||s.autoCreated,employee:s,autoCreated:s.autoCreated||!1}}catch(s){return console.error(" Employee validation failed:",s),{isValid:!1,employee:null,error:s.message}}}}Ys(Xp,"cache",new Map),Ys(Xp,"creationPromises",new Map);typeof window<"u"&&(window.EmployeeAutoCreator=Xp);class xU{async uploadFile(e,s="uploads"){var r,i;try{if(console.log(" Starting file upload...",{fileName:e.name,fileSize:e.size,folder:s,fileType:e.type}),!ut.currentUser)throw console.log(" No authenticated user found - cannot upload to Storage"),new Error("     ");const a=ut.currentUser.uid;if(console.log(" Current user:",a),!e)throw new Error("    ");const o=10*1024*1024;if(e.size>o)throw new Error("   .   10 ");const l=Date.now(),c=`${s}/${l}_${e.name}`;console.log(" Upload path:",c);const d=ii(In,c);console.log(" Storage reference created for bucket:",In.app.options.storageBucket),console.log(" Uploading to Firebase Storage folder:",s);const u=await Uc(d,e),f=await wl(d);return console.log(" File upload successful:",f),{url:f,path:c,originalName:e.name,size:e.size,type:e.type,uploadedBy:a,uploadedAt:new Date().toISOString()}}catch(a){throw console.error(" File upload error:",a),console.error(" Error code:",a.code),console.error(" Error message:",a.message),console.error(" Full error object:",a),console.error(" Auth state during error:",{hasUser:!!ut.currentUser,uid:(r=ut.currentUser)==null?void 0:r.uid,email:(i=ut.currentUser)==null?void 0:i.email}),a.code==="storage/unauthorized"?new Error("   .    Firebase"):a.code==="storage/canceled"?new Error("   "):a.code==="storage/unknown"?new Error("      "):new Error(a.message||"   ")}}async uploadFileWithCustomName(e,s="uploads",r){var i,a;try{if(!e)throw new Error("    ");const o=10*1024*1024;if(e.size>o)throw new Error("   .   10 ");const l=Date.now(),c=r?`${s}/${l}_${r}`:`${s}/${l}_${e.name}`,d=ii(In,c),u=await Uc(d,e);return{url:await wl(d),path:c,originalName:r||e.name,size:e.size,type:e.type,uploadedAt:new Date().toISOString()}}catch(o){throw console.error(" File upload error:",o),console.error(" Error code:",o.code),console.error(" Error message:",o.message),console.error(" Full error object:",o),console.error(" Auth state during error:",{hasUser:!!ut.currentUser,uid:(i=ut.currentUser)==null?void 0:i.uid,email:(a=ut.currentUser)==null?void 0:a.email}),o.code==="storage/unauthorized"?new Error("   .    Firebase"):o.code==="storage/canceled"?new Error("   "):o.code==="storage/unknown"?new Error("      "):new Error(o.message||"   ")}}async deleteFile(e){try{if(!e)throw new Error("   ");const s=ii(In,e);await xh(s),console.log("File deleted successfully:",e)}catch(s){if(console.error("File deletion error:",s),s.code==="storage/object-not-found"){console.warn("File not found for deletion:",e);return}throw new Error(`   : ${s.message}`)}}async getFileURL(e){try{if(!e)throw new Error("   ");const s=ii(In,e);return await wl(s)}catch(s){throw console.error("Get file URL error:",s),new Error(`     : ${s.message}`)}}async saveDocumentsToFirestore(e,s){if(!e||!Array.isArray(s))return;const r=s.map(i=>{const a=Le(Pe(ae,`tenders/${e}/tenderDocuments`),i.id||Date.now().toString());return yn(a,i)});await Promise.all(r)}async loadDocumentsFromFirestore(e){try{if(!e)return[];const s=Pe(ae,`tenders/${e}/tenderDocuments`),r=await qe(s),i=[];return r.forEach(a=>{i.push({...a.data(),id:a.id})}),console.log(`Loaded ${i.length} documents from Firestore for tender: ${e}`),i}catch(s){return console.error("Error loading documents from Firestore:",s),[]}}async uploadSupplierDocument(e,s){try{if(console.log(" Starting supplier document upload...",{fileName:e.name,fileSize:e.size,supplierId:s,fileType:e.type}),this.validateFile(e),!ut.currentUser)throw console.log(" No authenticated user found - cannot upload to Storage"),new Error("     ");const r=ut.currentUser.uid;console.log(" Current user:",r);const i=Date.now(),a=`suppliers/${s}/documents/${i}_${e.name}`;console.log(" Upload path:",a);const o=ii(In,a);console.log(" Storage reference created for supplier documents"),console.log(" Uploading to Firebase Storage folder: suppliers");const l=await Uc(o,e),c=await wl(o);return console.log(" Supplier document upload successful:",c),c}catch(r){throw console.error(" Supplier document upload error:",r),console.error(" Error code:",r.code),console.error(" Error message:",r.message),r.code==="storage/unauthorized"?new Error("   .    Firebase"):r.code==="storage/canceled"?new Error("   "):r.code==="storage/unknown"?new Error("      "):new Error(r.message||"   ")}}async saveSupplierDocumentsToFirestore(e,s){if(!e||!Array.isArray(s))return;const r=s.map(i=>{const a=Le(Pe(ae,`suppliers/${e}/supplierDocuments`),i.id||Date.now().toString());return yn(a,i)});await Promise.all(r)}async loadSupplierDocumentsFromFirestore(e){try{if(!e)return[];const s=Pe(ae,`suppliers/${e}/supplierDocuments`),r=await qe(s),i=[];return r.forEach(a=>{i.push({...a.data(),id:a.id})}),console.log(`Loaded ${i.length} documents from Firestore for supplier: ${e}`),i}catch(s){return console.error("Error loading supplier documents from Firestore:",s),[]}}async uploadForeignSupplierDocument(e,s,r){try{if(console.log(" Starting foreign supplier document upload...",{fileName:s.name,customName:r,fileSize:s.size,supplierId:e,fileType:s.type}),this.validateFile(s),!ut.currentUser)throw console.log(" No authenticated user found - cannot upload to Storage"),new Error("     ");const i=ut.currentUser.uid;console.log(" Current user:",i);const a=Date.now(),o=s.name.split(".").pop(),l=`foreign-suppliers/${e}/documents/${a}_${r}.${o}`;console.log(" Upload path:",l);const c=ii(In,l);console.log(" Storage reference created for foreign supplier documents"),console.log(" Uploading to Firebase Storage folder: foreign-suppliers");const d=await Uc(c,s),u=await wl(c);return console.log(" Foreign supplier document upload successful:",u),{fileName:r+"."+o,downloadURL:u,originalFileName:s.name,fileSize:s.size,fileType:s.type,uploadDate:new Date().toISOString()}}catch(i){throw console.error(" Error uploading foreign supplier document:",i),i.code==="storage/unauthorized"?new Error("    "):i.code==="storage/canceled"?new Error("    "):i.code==="storage/quota-exceeded"?new Error("    "):i.message.includes("  ")||i.message.includes("  ")||i.message.includes("   ")?i:new Error("    ")}}async saveForeignSupplierDocumentsToFirestore(e,s){if(!e||!Array.isArray(s))return;const r=s.map(i=>{const a=Le(Pe(ae,`foreignSuppliers/${e}/foreignSupplierDocuments`),i.id||Date.now().toString());return yn(a,i)});await Promise.all(r)}async loadForeignSupplierDocumentsFromFirestore(e){try{if(!e)return[];const s=Pe(ae,`foreignSuppliers/${e}/foreignSupplierDocuments`),r=await qe(s),i=[];return r.forEach(a=>{i.push({...a.data(),id:a.id})}),console.log(`Loaded ${i.length} documents from Firestore for foreign supplier: ${e}`),i}catch(s){return console.error("Error loading foreign supplier documents from Firestore:",s),[]}}async deleteSupplierDocumentFromFirestore(e,s){try{if(!e||!s){console.warn("Missing supplierId or documentId for deletion");return}const r=Le(ae,`suppliers/${e}/supplierDocuments`,s);await es(r),console.log(` Deleted document ${s} from Firestore subcollection for supplier ${e}`)}catch(r){throw console.error(" Error deleting supplier document from Firestore:",r),new Error(`      : ${r.message}`)}}async deleteForeignSupplierDocumentFromFirestore(e,s){try{if(!e||!s){console.warn("Missing supplierId or documentId for deletion");return}const r=Le(ae,`foreignSuppliers/${e}/foreignSupplierDocuments`,s);await es(r),console.log(` Deleted document ${s} from Firestore subcollection for foreign supplier ${e}`)}catch(r){throw console.error(" Error deleting foreign supplier document from Firestore:",r),new Error(`      : ${r.message}`)}}async saveJournalEntryDocumentToFirestore(e,s){try{if(!e||!s){console.warn("Missing journalEntryId or document data");return}await Xp.ensureEmployeeExists();const r=Le(ae,`journalEntries/${e}/journalEntryDocuments`,s.id);await yn(r,{...s,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),console.log(` Saved document ${s.id} to Firestore subcollection for journal entry ${e}`)}catch(r){throw console.error(" Error saving journal entry document to Firestore:",r),new Error(`      : ${r.message}`)}}async getJournalEntryDocumentsFromFirestore(e){try{if(!e)return console.warn("Missing journalEntryId for document retrieval"),[];const s=Pe(ae,`journalEntries/${e}/journalEntryDocuments`),r=await qe(s),i=[];return r.forEach(a=>{i.push({id:a.id,...a.data()})}),console.log(` Retrieved ${i.length} documents from Firestore subcollection for journal entry ${e}`),i}catch(s){return console.error(" Error retrieving journal entry documents from Firestore:",s),[]}}async deleteJournalEntryDocumentFromFirestore(e,s){try{if(!e||!s){console.warn("Missing journalEntryId or documentId for deletion");return}const r=Le(ae,`journalEntries/${e}/journalEntryDocuments`,s);await es(r),console.log(` Deleted document ${s} from Firestore subcollection for journal entry ${e}`)}catch(r){throw console.error(" Error deleting journal entry document from Firestore:",r),new Error(`      : ${r.message}`)}}async deleteFileFromStorage(e){try{if(!e){console.warn("Missing filePath for deletion");return}const s=ii(In,e);await xh(s),console.log(` Deleted file from storage: ${e}`)}catch(s){throw console.error(" Error deleting file from storage:",s),new Error(`     : ${s.message}`)}}validateFile(e,s={}){const{maxSize:r=10*1024*1024,allowedTypes:i=["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}=s;if(!e)throw new Error("   ");if(e.size>r)throw new Error(`   .   ${Math.round(r/(1024*1024))} `);if(!i.includes(e.type))throw new Error("   .  : PDF, Word, ");return!0}}const Ss=new xU,Lj=Object.freeze(Object.defineProperty({__proto__:null,default:Ss},Symbol.toStringTag,{value:"Module"}));class bs{static sanitizeData(e){const s={};for(const[r,i]of Object.entries(e))i!=null&&(i instanceof Date?s[r]=i.toISOString():typeof i=="object"&&i!==null&&!Array.isArray(i)?s[r]=this.sanitizeData(i):s[r]=i);return s}static async moveToTrash(e,s){try{const r=e.title||e.name||e.fileName||e.supplierName||"  ";console.log("Moving to trash:",r,"from",s);let{id:i,...a}=e;if((!i||i===void 0||i===null)&&(i=`generated_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,console.log(" Missing document ID, generated new one:",i)),(await this.getAllTrashItems()).some(f=>f.originalId===i&&f.originalCollection===s&&(f.name===e.name||f.title===e.title||f.fileName===e.fileName||f.supplierName===e.supplierName)))return console.log("Item already exists in trash, skipping"),null;const d={...this.sanitizeData(a),originalId:i,originalCollection:s,deletedAt:We(),deletedBy:" "};console.log(" Adding to trash collection:",{displayName:r,originalCollection:s,originalId:i,hasRequiredFields:!!(d.originalId&&d.originalCollection)});const u=await As(Pe(ae,this.COLLECTION_NAME),d);return console.log(" Successfully moved to trash with ID:",u.id),u.id}catch(r){throw console.error(" Error moving to trash:",r),console.error("Error details:",{name:r.name,message:r.message,code:r.code,stack:r.stack,itemData:{id:e.id,displayName:e.name||e.fileName||e.supplierName,originalCollection:s,hasId:!!e.id}}),new Error(`      : ${r.message}`)}}static async getAllTrashItems(){try{const e=st(Pe(ae,this.COLLECTION_NAME),as("deletedAt","desc")),s=await qe(e),r=[],i=new Map;return s.forEach(a=>{var d,u;const o=a.data(),l={id:a.id,...o,deletedAt:((u=(d=o.deletedAt)==null?void 0:d.toDate)==null?void 0:u.call(d))||new Date};o.originalCollection==="price_quotes"&&(console.log("=== TRASH RECORD DEBUG ==="),console.log("Document ID:",a.id),console.log("Original Collection:",o.originalCollection),console.log("Item keys:",Object.keys(o)),console.log("Context data:",{rawMaterialId:o.rawMaterialId,rawMaterialName:o.rawMaterialName,localProductId:o.localProductId,localProductName:o.localProductName,foreignProductId:o.foreignProductId,foreignProductName:o.foreignProductName,supplierName:o.supplierName,price:o.price,date:o.date}),console.log("Full item data:",o));const c=`${o.originalId||o.id}-${o.originalCollection}-${o.name||o.title}`;i.has(c)?(console.log("Found duplicate item:",c,"marking for deletion"),this.permanentlyDelete(a.id).catch(console.error)):(i.set(c,l),r.push(l))}),console.log("Found",r.length,"unique items in trash (removed duplicates)"),r}catch(e){throw console.error("Error getting trash items:",e),new Error("     ")}}static async permanentlyDelete(e){try{if(console.log("Permanently deleting item:",e),!(await this.getAllTrashItems()).some(o=>o.id===e))return console.log("Item already deleted or does not exist:",e),!0;if(await es(Le(ae,this.COLLECTION_NAME,e)),(await this.getAllTrashItems()).some(o=>o.id===e))throw new Error("    -    ");return console.log("Successfully deleted from trash:",e),!0}catch(s){throw console.error("Error deleting from trash:",s),new Error("      : "+s.message)}}static async restoreItem(e){var r,i,a;let s=null;try{console.log("=== STARTING RESTORATION PROCESS ==="),console.log("Trash ID to restore:",e);const o=await this.getAllTrashItems();if(console.log("Total trash items found:",o.length),s=o.find(j=>j.id===e),!s)throw console.error("RESTORATION FAILED: Item not found in trash"),console.log("Available trash IDs:",o.map(j=>j.id)),new Error("     ");console.log("=== TRASH ITEM FOUND ==="),console.log("Item to restore:",{id:s.id,originalCollection:s.originalCollection,name:s.name||s.supplierName,hasRawMaterialId:!!s.rawMaterialId,hasLocalProductId:!!s.localProductId,hasForeignProductId:!!s.foreignProductId});const{id:l,originalId:c,originalCollection:d,deletedAt:u,deletedBy:f,...p}=s;if(d==="suppliers"){const{SupplierService:j}=await Xe(async()=>{const{SupplierService:L}=await Promise.resolve().then(()=>$j);return{SupplierService:L}},void 0);await j.createSupplier(p)}else if(d==="foreignSuppliers"){const{ForeignSupplierService:j}=await Xe(async()=>{const{ForeignSupplierService:L}=await Promise.resolve().then(()=>zj);return{ForeignSupplierService:L}},void 0);await j.createSupplier(p)}else if(d==="customers"){const{CustomerService:j}=await Xe(async()=>{const{CustomerService:L}=await Promise.resolve().then(()=>y6);return{CustomerService:L}},void 0);await j.createCustomer(p)}else if(d==="employees"){const{EmployeeService:j}=await Xe(async()=>{const{EmployeeService:L}=await Promise.resolve().then(()=>b4);return{EmployeeService:L}},void 0);await j.createEmployee(p)}else if(d==="rawmaterials"){const{RawMaterialService:j}=await Xe(async()=>{const{RawMaterialService:L}=await Promise.resolve().then(()=>dd);return{RawMaterialService:L}},void 0);await j.createRawMaterial(p)}else if(d==="localproducts"){const{LocalProductService:j}=await Xe(async()=>{const{LocalProductService:L}=await Promise.resolve().then(()=>ud);return{LocalProductService:L}},void 0);await j.createLocalProduct(p)}else if(d==="foreignproducts"){const{ForeignProductService:j}=await Xe(async()=>{const{ForeignProductService:L}=await Promise.resolve().then(()=>hd);return{ForeignProductService:L}},void 0);await j.createForeignProduct(p)}else if(d==="price_quotes")if(console.log("=== RESTORING PRICE QUOTE ==="),console.log("Trash item keys:",Object.keys(s)),console.log("Has rawMaterialId:",!!s.rawMaterialId,s.rawMaterialId),console.log("Has localProductId:",!!s.localProductId,s.localProductId),console.log("Has foreignProductId:",!!s.foreignProductId,s.foreignProductId),s.rawMaterialId)console.log("Restoring to raw material..."),await this.restorePriceQuoteToRawMaterial(s,p);else if(s.localProductId)console.log("Restoring to local product..."),await this.restorePriceQuoteToLocalProduct(s,p);else if(s.foreignProductId)console.log("Restoring to foreign product..."),await this.restorePriceQuoteToForeignProduct(s,p);else throw console.error("No valid product ID found in trash item:",{rawMaterialId:s.rawMaterialId,localProductId:s.localProductId,foreignProductId:s.foreignProductId,allKeys:Object.keys(s)}),new Error("     -      ");else if(d==="tenderItems"){console.log("=== RESTORING TENDER ITEM ==="),console.log("Tender context:",s.tenderContext);const j=((r=s.tenderContext)==null?void 0:r.tenderId)||"new",L=`tenderItems_${j}`;let R=[];try{const y=await Ke.getPendingData(L);R=y?JSON.parse(y):[]}catch(y){console.warn("Error parsing existing tender items:",y),R=[]}if(R.some(y=>y.internalId===p.internalId||y.materialInternalId===p.materialInternalId&&y.materialName===p.materialName))throw console.warn("Tender item already exists, not restoring to prevent duplicate"),new Error("     ");R.push({...p,restoredAt:new Date().toISOString(),restoredFrom:"trash"}),await Ke.setPendingData(L,R),await Ke.setPendingData("tenderItems_restored",Date.now().toString()),window.dispatchEvent(new CustomEvent("tenderItemRestored",{detail:{tenderId:j,restoredItem:p}})),console.log("Successfully restored tender item to Firestore session:",{tenderId:j,storageKey:L,itemCount:R.length,restoredItem:p.materialName||p.name})}else if(d==="tender_documents"){console.log("=== RESTORING TENDER DOCUMENT ==="),console.log("Document data:",p);const j=p.tenderId||"new",L=`tenderDocuments_${j}`;console.log("Restoring document to:",{tenderId:j,storageKey:L});let R=[];try{R=await Ke.getPendingData(L)||[],console.log("Existing documents in Firestore session:",R.length)}catch(T){console.warn("Error parsing existing tender documents:",T),R=[]}if(R.some(T=>T.id===p.id&&T.storagePath===p.storagePath)){console.warn("Exact same document already exists, generating new ID for restoration");const T=Date.now(),x=Math.random().toString(36).substr(2,9);p.id=`${T}_${x}_restored`,console.log("Generated new document ID for restoration:",p.id)}const y={...p,restoredAt:new Date().toISOString(),restoredFrom:"trash"};R.push(y),console.log(" Adding restored document:",{documentId:y.id,fileName:y.fileName,tenderId:j,totalDocuments:R.length});try{await Ke.setPendingData(L,R),console.log(" Successfully saved to Firestore session:",L)}catch(T){throw console.error(" Failed to save to Firestore session:",T),new Error("    ")}try{await Ke.setPendingData("tenderDocuments_restored",Date.now().toString());const T=new CustomEvent("tenderDocumentRestored",{detail:{tenderId:j,restoredDocument:y,allDocuments:R}});window.dispatchEvent(T),window.dispatchEvent(new StorageEvent("storage",{key:L,newValue:JSON.stringify(R),url:window.location.href})),console.log(" Events dispatched successfully")}catch(T){console.warn(" Event dispatch failed (non-critical):",T)}console.log(" Successfully restored tender document:",{tenderId:j,storageKey:L,documentCount:R.length,restoredDocument:y.fileName||y.originalFileName})}else if(d==="supplier_documents"){console.log("=== RESTORING SUPPLIER DOCUMENT ==="),console.log("Document data:",p);const j=((i=p.supplierContext)==null?void 0:i.supplierId)||p.supplierId;if(!j||j==="new")throw new Error("   :   ");console.log("Restoring document to supplier:",j);const{SupplierService:L}=await Xe(async()=>{const{SupplierService:x}=await Promise.resolve().then(()=>$j);return{SupplierService:x}},void 0),R=await L.getSupplierById(j);if(!R)throw new Error("      ");let D=R.documents||[];if(D.some(x=>x.id===p.id&&x.fileURL===p.fileURL)){console.warn("Document already exists, generating new ID for restoration");const x=Date.now(),S=Math.random().toString(36).substr(2,9);p.id=`${x}_${S}_restored`}const T=[...D,p];await L.updateSupplier(j,{...R,documents:T});try{await(await Xe(()=>Promise.resolve().then(()=>Lj),void 0)).default.saveSupplierDocumentsToFirestore(j,T)}catch(x){console.warn("Could not update Firestore subcollection:",x)}console.log("Supplier document successfully restored")}else if(d==="foreign_supplier_documents"){console.log("=== RESTORING FOREIGN SUPPLIER DOCUMENT ==="),console.log("Document data:",p);const j=((a=p.context)==null?void 0:a.supplierId)||p.supplierId;if(!j||j==="new")throw new Error("         ");console.log("Restoring to foreign supplier:",j);const{ForeignSupplierService:L}=await Xe(async()=>{const{ForeignSupplierService:T}=await Promise.resolve().then(()=>zj);return{ForeignSupplierService:T}},void 0);let R;try{R=await L.getSupplierById(j)}catch(T){throw console.error("Foreign supplier not found:",j,T.message),new Error("   ")}const D=R.documents||[];if(!p.id){const T=Date.now(),x=Math.random().toString(36).substr(2,9);p.id=`${T}_${x}_restored`}const y=[...D,p];await L.updateSupplier(j,{...R,documents:y});try{await(await Xe(()=>Promise.resolve().then(()=>Lj),void 0)).default.saveForeignSupplierDocumentsToFirestore(j,y)}catch(T){console.warn("Could not update foreign supplier Firestore subcollection:",T)}console.log("Foreign supplier document successfully restored")}else if(d==="manufacturedProducts"){const{ManufacturedProductService:j}=await Xe(async()=>{const{ManufacturedProductService:L}=await Promise.resolve().then(()=>Li);return{ManufacturedProductService:L}},void 0);await j.createManufacturedProduct(p),console.log("Successfully restored manufactured product")}else throw new Error("    ");return await this.permanentlyDelete(e),console.log("Successfully restored item"),!0}catch(o){console.error("=== RESTORATION ERROR ==="),console.error("Error type:",o.constructor.name),console.error("Error message:",o.message),console.error("Error stack:",o.stack),console.error("Error details:",{trashId:e,itemType:s==null?void 0:s.originalCollection,itemName:(s==null?void 0:s.name)||(s==null?void 0:s.supplierName),hasValidItem:!!s,contextIds:{rawMaterialId:s==null?void 0:s.rawMaterialId,localProductId:s==null?void 0:s.localProductId,foreignProductId:s==null?void 0:s.foreignProductId}});let l="   ";throw o.message.includes("    ")?l="  :        ":o.message.includes("    ")?l="  :        ":o.message.includes("    ")?l="  :        ":o.message.includes("     ")?l="  :       ":o.message.includes("   ")?l="  :     ":l=`  : ${o.message}`,new Error(l)}}static async restorePriceQuoteToRawMaterial(e,s){try{console.log("Restoring price quote to raw material:",e.rawMaterialId),console.log("Original trash item:",e);const{RawMaterialService:r}=await Xe(async()=>{const{RawMaterialService:D}=await Promise.resolve().then(()=>dd);return{RawMaterialService:D}},void 0),i=await r.getRawMaterialById(e.rawMaterialId);if(!i)throw new Error("    ");console.log("Found raw material for restore:",{id:i.id,name:i.name,currentQuotesCount:(i.priceQuotes||[]).length});const{rawMaterialId:a,rawMaterialName:o,...l}=s;l.id||(console.warn("Quote missing ID, generating new one:",l),l.id=Date.now().toString()+"_recovered");const c=Date.now(),d=Math.random().toString(36).substr(2,9);l.id=`${c}_${d}_restored`,l.supplierName=l.supplierName||"  ",l.price=l.price||"0",l.date=l.date||"",l.supplierType=l.supplierType||"local",l.id=String(l.id),console.log("Restoring quote data with normalized structure:",l);const u=i.priceQuotes||[];if(console.log("Checking for duplicates in raw material:",{existingQuotesCount:u.length,newQuoteId:l.id,newQuoteSupplier:l.supplierName,newQuotePrice:l.price,newQuoteDate:l.date,existingQuotes:u.map(D=>({id:D.id,supplier:D.supplierName,price:D.price,date:D.date}))}),u.some(D=>D.id===l.id)){console.warn("Quote with same ID already exists, generating new ID");const D=Date.now()+Math.random()*1e3,y=Math.random().toString(36).substr(2,12);l.id=`${D}_${y}_restored_v2`,console.log("Generated new unique ID:",l.id)}const p=[...u,l];console.log("Updated price quotes after restore:",p.length,"total quotes");let j=null,L=null;if(p.length>0){const D=p.reduce((y,T)=>{const x=parseFloat(y.price)||0;return(parseFloat(T.price)||0)<x?T:y});j=D.price,L=D.supplierName}const R={...i,priceQuotes:p};j&&(R.price=j,R.supplier=L,R.lowestPriceSupplier=L),await r.updateRawMaterial(e.rawMaterialId,R),console.log("Price quote successfully restored to raw material")}catch(r){throw console.error("=== RAW MATERIAL RESTORATION ERROR ==="),console.error("Error message:",r.message),console.error("Error stack:",r.stack),console.error("Error details:",{rawMaterialId:e.rawMaterialId,quoteName:s.supplierName,step:"Raw Material Restoration",originalDataKeys:Object.keys(s),trashItemKeys:Object.keys(e)}),r.message.includes("    ")?r:new Error(`      : ${r.message}`)}}static async restorePriceQuoteToLocalProduct(e,s){try{console.log("Restoring price quote to local product:",e.localProductId),console.log("Original trash item:",e);const{LocalProductService:r}=await Xe(async()=>{const{LocalProductService:y}=await Promise.resolve().then(()=>ud);return{LocalProductService:y}},void 0),a=(await r.getAllLocalProducts()).find(y=>y.id===e.localProductId);if(!a)throw new Error("    ");console.log("Found local product for restore:",{id:a.id,name:a.name,currentQuotesCount:(a.priceQuotes||[]).length});const{localProductId:o,localProductName:l,...c}=s,d=Date.now(),u=Math.random().toString(36).substr(2,9);c.id=`${d}_${u}_restored`,c.supplierName=c.supplierName||"  ",c.price=c.price||"0",c.date=c.date||"",c.supplierType=c.supplierType||"local",c.id=String(c.id),console.log("Restoring quote data with normalized structure:",c);const f=a.priceQuotes||[];if(console.log("Checking for duplicates in local product:",{existingQuotesCount:f.length,newQuoteId:c.id,newQuoteSupplier:c.supplierName,newQuotePrice:c.price,newQuoteDate:c.date,existingQuotes:f.map(y=>({id:y.id,supplier:y.supplierName,price:y.price,date:y.date}))}),f.some(y=>y.id===c.id)){console.warn("Quote with same ID already exists, generating new ID");const y=Date.now()+Math.random()*1e3,T=Math.random().toString(36).substr(2,12);c.id=`${y}_${T}_restored_v2`,console.log("Generated new unique ID:",c.id)}const j=[...f,c];console.log("Updated price quotes after restore:",j.length,"total quotes");let L=null,R=null;if(j.length>0){const y=j.reduce((T,x)=>{const S=parseFloat(T.price)||0;return(parseFloat(x.price)||0)<S?x:T});L=y.price,R=y.supplierName}const D={...a,priceQuotes:j};L&&(D.price=L,D.supplier=R),await r.updateLocalProduct(e.localProductId,D),console.log("Price quote successfully restored to local product")}catch(r){throw console.error("=== LOCAL PRODUCT RESTORATION ERROR ==="),console.error("Error message:",r.message),console.error("Error stack:",r.stack),console.error("Error details:",{localProductId:e.localProductId,quoteName:s.supplierName,step:"Local Product Restoration",originalDataKeys:Object.keys(s),trashItemKeys:Object.keys(e)}),r.message.includes("    ")?r:new Error(`      : ${r.message}`)}}static async restorePriceQuoteToForeignProduct(e,s){try{console.log("Restoring price quote to foreign product:",e.foreignProductId),console.log("Original trash item:",e);const{ForeignProductService:r}=await Xe(async()=>{const{ForeignProductService:y}=await Promise.resolve().then(()=>hd);return{ForeignProductService:y}},void 0),a=(await r.getAllForeignProducts()).find(y=>y.id===e.foreignProductId);if(!a)throw new Error("    ");console.log("Found foreign product for restore:",{id:a.id,name:a.name,currentQuotesCount:(a.priceQuotes||[]).length});const{foreignProductId:o,foreignProductName:l,...c}=s,d=Date.now(),u=Math.random().toString(36).substr(2,9);c.id=`${d}_${u}_restored`,c.supplierName=c.supplierName||"  ",c.price=c.price||"0",c.date=c.date||"",c.supplierType=c.supplierType||"foreign",c.id=String(c.id),console.log("Restoring quote data with normalized structure:",c);const f=a.priceQuotes||[];if(console.log("Checking for duplicates in foreign product:",{existingQuotesCount:f.length,newQuoteId:c.id,newQuoteSupplier:c.supplierName,newQuotePrice:c.price,newQuoteDate:c.date,existingQuotes:f.map(y=>({id:y.id,supplier:y.supplierName,price:y.price,date:y.date}))}),f.some(y=>y.id===c.id)){console.warn("Quote with same ID already exists, generating new ID");const y=Date.now()+Math.random()*1e3,T=Math.random().toString(36).substr(2,12);c.id=`${y}_${T}_restored_v2`,console.log("Generated new unique ID:",c.id)}const j=[...f,c];console.log("Updated price quotes after restore:",j.length,"total quotes");let L=null,R=null;if(j.length>0){const y=j.reduce((T,x)=>{const S=parseFloat(T.price)||0;return(parseFloat(x.price)||0)<S?x:T});L=y.price,R=y.supplierName}const D={...a,priceQuotes:j};L&&(D.price=L,D.supplier=R),await r.updateForeignProduct(e.foreignProductId,D),console.log("Price quote successfully restored to foreign product")}catch(r){throw console.error("=== FOREIGN PRODUCT RESTORATION ERROR ==="),console.error("Error message:",r.message),console.error("Error stack:",r.stack),console.error("Error details:",{foreignProductId:e.foreignProductId,quoteName:s.supplierName,step:"Foreign Product Restoration",originalDataKeys:Object.keys(s),trashItemKeys:Object.keys(e)}),r.message.includes("    ")?r:new Error(`      : ${r.message}`)}}static async emptyTrash(){try{console.log("Emptying trash...");const e=await this.getAllTrashItems();console.log("Found",e.length,"items to delete");for(const s of e)await this.permanentlyDelete(s.id);return console.log("Successfully emptied trash"),!0}catch(e){throw console.error("Error emptying trash:",e),new Error("    ")}}static getItemDisplayInfo(e){var a;const r={suppliers:{name:" ",icon:"bi-building",color:"primary"},foreignSuppliers:{name:" ",icon:"bi-globe",color:"info"},customers:{name:"",icon:"bi-person-check",color:"success"},rawmaterials:{name:" ",icon:"bi-box-seam",color:"warning"},localproducts:{name:" ",icon:"bi-box-seam",color:"success"},foreignproducts:{name:" ",icon:"bi-box-seam",color:"info"},manufacturedProducts:{name:" ",icon:"bi-boxes",color:"info"},manufactured_product_documents:{name:"  ",icon:"bi-file-earmark-text",color:"info"},price_quotes:{name:" ",icon:"bi-currency-dollar",color:"dark"},tenderItems:{name:" ",icon:"bi-list-task",color:"secondary"},tender_documents:{name:" ",icon:"bi-file-earmark",color:"warning"}}[e.originalCollection]||{name:"  ",icon:"bi-question-circle",color:"secondary"};let i={};if(e.originalCollection==="rawmaterials")i={displayName:e.name||" ",category:e.category||" ",minimumStock:e.minimumStock||0,supplier:e.lowestPriceSupplier||" "};else if(e.originalCollection==="localproducts")i={displayName:e.name||" ",category:e.category||" ",unit:e.unit||" ",price:e.price?`${e.price} `:" ",supplier:e.supplier||" "};else if(e.originalCollection==="foreignproducts")i={displayName:e.name||" ",category:e.category||" ",unit:e.unit||" ",price:e.price?`${e.price} `:" ",supplier:e.supplier||" "};else if(e.originalCollection==="price_quotes"){let o=" ",l="";e.rawMaterialId&&e.rawMaterialName?(o=e.rawMaterialName,l=" "):e.localProductId&&e.localProductName?(o=e.localProductName,l=" "):e.foreignProductId&&e.foreignProductName?(o=e.foreignProductName,l=" "):e.rawMaterialName?(o=e.rawMaterialName,l=" "):e.localProductName?(o=e.localProductName,l=" "):e.foreignProductName&&(o=e.foreignProductName,l=" "),console.log("Price quote context detection:",{rawMaterialId:e.rawMaterialId,rawMaterialName:e.rawMaterialName,localProductId:e.localProductId,localProductName:e.localProductName,foreignProductId:e.foreignProductId,foreignProductName:e.foreignProductName,finalContextName:o,finalContextLabel:l}),i={displayName:`  - ${e.supplierName||"  "}`,price:e.price?`${e.price} `:" ",supplierName:e.supplierName||" ",date:e.date||" ",contextName:o,contextLabel:l}}else e.originalCollection==="tenderItems"?i={displayName:e.materialName||e.name||" ",quantity:e.quantity||1,price:e.totalPrice?`${Math.round(e.totalPrice)} `:" ",contextName:((a=e.tenderContext)==null?void 0:a.tenderTitle)||"  ",contextLabel:"",itemType:e.type==="localProduct"?" ":e.type==="foreignProduct"?" ":" "}:i={displayName:e.name||" ",email:e.email||" ",phone:e.phone||" "};return{...r,...i}}static getTimeSinceDeleted(e){const s=new Date,r=new Date(e),i=s.getTime()-r.getTime(),a=Math.floor(i/(1e3*60*60*24)),o=Math.floor(i/(1e3*60*60)),l=Math.floor(i/(1e3*60));return a>0?` ${a} ${a>1,""}`:o>0?` ${o} ${o>1,""}`:l>0?` ${l} ${l>1,""}`:" "}static async clearAllTrashRecords(){try{console.log(" Clearing all trash records...");const e=st(Pe(ae,this.COLLECTION_NAME)),s=await qe(e);console.log(`Found ${s.docs.length} records to delete`);const r=[];return s.forEach(i=>{r.push(es(i.ref))}),await Promise.all(r),console.log(" Successfully cleared all trash records"),!0}catch(e){throw console.error(" Error clearing trash records:",e),new Error("    : "+e.message)}}static getItemDisplayInfo(e){var l,c,d,u,f;const r={suppliers:{name:" ",icon:"bi-building",color:"primary"},foreignSuppliers:{name:" ",icon:"bi-globe",color:"info"},customers:{name:"",icon:"bi-person-check",color:"success"},employees:{name:"",icon:"bi-person-badge",color:"primary"},rawmaterials:{name:" ",icon:"bi-box-seam",color:"warning"},localproducts:{name:" ",icon:"bi-box-seam",color:"success"},foreignproducts:{name:" ",icon:"bi-box-seam",color:"info"},manufacturedProducts:{name:" ",icon:"bi-boxes",color:"info"},manufactured_product_documents:{name:"  ",icon:"bi-file-earmark-text",color:"info"},price_quotes:{name:" ",icon:"bi-currency-dollar",color:"dark"},tenderItems:{name:" ",icon:"bi-list-task",color:"secondary"},tender_documents:{name:" ",icon:"bi-file-earmark",color:"warning"},supplier_documents:{name:" ",icon:"bi-file-earmark-text",color:"success"},foreign_supplier_documents:{name:"  ",icon:"bi-file-earmark-text",color:"primary"},employee_documents:{name:" ",icon:"bi-file-earmark-person",color:"success"},manufacturedProducts:{name:" ",icon:"bi-boxes",color:"info"}}[e.originalCollection]||{name:"  ",icon:"bi-question-circle",color:"secondary"};let i={},a=e.name||" ",o="";switch(e.originalCollection){case"suppliers":case"foreignSuppliers":i={email:e.email,phone:e.phone,address:e.address,taxNumber:e.taxNumber};break;case"customers":i={email:e.email,phone:e.phone,address:e.address,taxNumber:e.taxNumber};break;case"employees":a=e.fullName||e.name||"  ",i={email:e.email,phone:e.phone,department:e.department,jobTitle:e.jobTitle,status:e.status,autoCreated:e.autoCreated};break;case"rawmaterials":case"localproducts":case"foreignproducts":i={category:e.category,unit:e.unit,price:e.price?`${e.price} .`:" ",supplier:e.supplier||e.manufacturer};break;case"price_quotes":a=`   ${e.supplierName||" "}`,o=e.rawMaterialName||e.localProductName||e.foreignProductName||" ",i={supplierName:e.supplierName,price:e.price?`${e.price} .`:" ",contextName:o,date:e.date};break;case"tenderItems":a=e.materialName||e.name||" ",o=((l=e.tenderContext)==null?void 0:l.tenderTitle)||"  ",i={materialName:e.materialName,quantity:e.quantity,unitPrice:e.unitPrice?`${e.unitPrice} .`:" ",totalPrice:e.totalPrice?`${e.totalPrice} .`:" ",contextName:o,materialCategory:e.materialCategory,materialUnit:e.materialUnit};break;case"tender_documents":a=e.fileName||e.originalFileName||"  ",o=e.tenderTitle||"  ",i={fileName:e.fileName,originalFileName:e.originalFileName,fileSize:e.fileSize?`${(e.fileSize/1024/1024).toFixed(2)} .`:" ",fileType:e.fileType||"  ",contextName:o,uploadedAt:e.uploadedAt||e.createdAt};break;case"supplier_documents":a=e.fileName||e.originalFileName||"  ",o=((c=e.supplierContext)==null?void 0:c.supplierName)||"  ",i={fileName:e.fileName,originalFileName:e.originalFileName,fileSize:e.fileSize?`${(e.fileSize/1024/1024).toFixed(2)} .`:" ",fileType:e.fileType||"  ",contextName:o,uploadedAt:e.uploadedAt||e.createdAt,supplierName:(d=e.supplierContext)==null?void 0:d.supplierName};break;case"foreign_supplier_documents":a=e.fileName||e.originalFileName||"  ",o=((u=e.context)==null?void 0:u.supplierName)||"   ",i={fileName:e.fileName,originalFileName:e.originalFileName,fileSize:e.fileSize?`${(e.fileSize/1024/1024).toFixed(2)} .`:" ",fileType:e.fileType||"  ",contextName:o,uploadedAt:e.uploadedAt||e.createdAt,supplierName:(f=e.context)==null?void 0:f.supplierName};break;case"employee_documents":a=e.fileName||e.originalFileName||"  ",o=e.employeeName||"  ",i={fileName:e.fileName,originalFileName:e.originalFileName,fileSize:e.fileSize?`${(e.fileSize/1024/1024).toFixed(2)} .`:" ",fileType:e.fileType||"  ",contextName:o,employeeName:e.employeeName,employeeId:e.employeeId,uploadedAt:e.uploadedAt||e.createdAt};break;case"manufacturedProducts":a=e.title||e.productName||e.name||"  ",i={productCode:e.productCode,category:e.category,manufacturer:e.manufacturer,unitPrice:e.unitPrice?`${parseFloat(e.unitPrice).toLocaleString("en-US")} `:" ",stockQuantity:e.stockQuantity||" ",unit:e.unit,status:e.status==="active"?"":" ",batchNumber:e.batchNumber,referenceNumber:e.referenceNumber,estimatedValue:e.estimatedValue,description:e.description,submissionDeadline:e.submissionDeadline};break;default:i={}}return{...r,displayName:a,contextName:o,...i}}}Ys(bs,"COLLECTION_NAME","trash");const O1=n=>{if(!n)return"";const e=n instanceof Date?n:new Date(n);if(isNaN(e.getTime()))return"";const s=e.getDate().toString().padStart(2,"0"),r=(e.getMonth()+1).toString().padStart(2,"0"),i=e.getFullYear();return`${s}/${r}/${i}`},M1=n=>{if(!n)return"";const e=n instanceof Date?n:new Date(n);if(isNaN(e.getTime()))return"";const s=e.getDate().toString().padStart(2,"0"),r=(e.getMonth()+1).toString().padStart(2,"0"),i=e.getFullYear(),a=e.getHours().toString().padStart(2,"0"),o=e.getMinutes().toString().padStart(2,"0");return`${s}/${r}/${i} ${a}:${o}`},Rl=n=>{if(!n)return"";const e=n instanceof Date?n:new Date(n);if(isNaN(e.getTime()))return"";const s=e.getFullYear(),r=(e.getMonth()+1).toString().padStart(2,"0"),i=e.getDate().toString().padStart(2,"0");return`${s}-${r}-${i}`},yU=n=>{if(!n||typeof n!="string")return null;const e=n.split("/");if(e.length===3){const s=parseInt(e[0],10),r=parseInt(e[1],10)-1,i=parseInt(e[2],10);if(!isNaN(s)&&!isNaN(r)&&!isNaN(i))return new Date(i,r,s)}return new Date(n)},bU=()=>O1(new Date),wU=()=>M1(new Date),sc=()=>({formatDate:n=>{if(!n)return"-";try{return O1(n)}catch(e){return console.error("Date formatting error:",e),"-"}},formatDateTime:n=>{if(!n)return"-";try{return M1(n)}catch(e){return console.error("DateTime formatting error:",e),"-"}},formatDateForInput:n=>{if(!n)return"";try{return Rl(n)}catch(e){return console.error("Date input formatting error:",e),""}},parseDate:n=>{try{return yU(n)}catch(e){return console.error("Date parsing error:",e),null}},getToday:()=>{try{return bU()}catch(n){return console.error("Today date error:",n),"-"}},getCurrentDateTime:()=>{try{return wU()}catch(n){return console.error("Current datetime error:",n),"-"}},isExpired:n=>{if(!n)return!1;try{return(n instanceof Date?n:new Date(n))<new Date}catch{return!1}},getDaysRemaining:n=>{if(!n)return 0;try{const r=(n instanceof Date?n:new Date(n))-new Date;return Math.ceil(r/(1e3*60*60*24))}catch{return 0}}}),Td=({show:n,onClose:e,documents:s,setDocuments:r,tenderId:i,uploadingDocument:a,setUploadingDocument:o,handleDocumentUpload:l,handleDeleteClick:c,deleting:d,title:u=" ",readOnly:f=!1,canCreate:p=!0,canDelete:j=!0,canView:L=!0})=>{const{alertConfig:R,closeAlert:D,showSuccess:y,showError:T}=Bt(),{formatDate:x}=sc();return n?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.8)",zIndex:99980,position:"fixed",top:0,left:0,right:0,bottom:0},tabIndex:"-1",dir:"rtl",children:t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"12px 12px 0 0"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-file-earmark-text me-2"}),u]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:e,"aria-label":"Close"})]}),t.jsx("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"},children:t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("div",{className:"bg-primary bg-opacity-10 p-2 rounded-circle me-3",children:t.jsx("i",{className:"bi bi-files text-primary"})}),t.jsxs("div",{children:[t.jsx("h6",{className:"mb-0 fw-bold text-primary",children:" "}),t.jsxs("small",{className:"text-muted",children:[" : ",s.length]})]})]}),t.jsx("div",{style:{marginTop:"10px",marginBottom:"10px"},children:t.jsxs(Tt,{can:"documents:create",mode:"disable",children:[t.jsx("input",{type:"file",id:"documentUpload",onChange:l,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",style:{display:"none"}}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{console.log(" Upload button clicked"),console.log(" TENDER MODAL: Starting fullscreen bypass for file picker"),Kr(2e4);const S=document.getElementById("documentUpload");S?(S.click(),console.log(" File input triggered")):console.error(" File input not found")},disabled:a,title:"  ",style:{height:"32px",minWidth:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",fontWeight:"500"},children:a?t.jsxs(t.Fragment,{children:[t.jsx(It,{size:"small"}),t.jsx("span",{className:"ms-2",children:"..."})]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-cloud-upload me-1"})," "]})})]})})]}),(console.log(" MODAL RENDER CHECK:",new Date().toLocaleTimeString()),console.log(" Documents state:",{length:s.length,docs:s.map(S=>({name:S.fileName,url:!!S.fileURL,id:S.id}))}),null),s.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-folder2-open",style:{fontSize:"3rem"}})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:'  " "  '})]}):t.jsx("div",{className:"table-responsive",style:{maxHeight:"400px",overflowY:"auto"},children:t.jsxs("table",{className:"table table-hover",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:"#"}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""})]})}),t.jsx("tbody",{children:s.map((S,A)=>{if(!S||typeof S!="object")return null;const q=(H=>!H||typeof H!="string"?{icon:"bi-file-earmark",color:"#6c757d"}:H.includes("pdf")?{icon:"bi-file-earmark-pdf",color:"#dc3545"}:H.includes("word")||H.includes("document")?{icon:"bi-file-earmark-word",color:"#2b579a"}:H.includes("image")?{icon:"bi-file-earmark-image",color:"#198754"}:{icon:"bi-file-earmark",color:"#6c757d"})(S.fileType||""),B=S.fileName||S.originalFileName||"  ",$=S.fileSize||0;return S.uploadDate,t.jsxs("tr",{children:[t.jsx("td",{className:"text-center fw-bold text-muted",children:A+1}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:`${q.icon} me-2`,style:{color:q.color}}),t.jsx("span",{className:"fw-bold text-primary",title:B,children:B.length>25?B.substring(0,25)+"...":B})]})}),t.jsx("td",{className:"text-center",children:t.jsxs("span",{className:"badge bg-light text-dark",children:[($/1024/1024).toFixed(2)," ."]})}),t.jsx("td",{className:"text-center",children:t.jsx("small",{className:"text-muted",children:x(S.uploadedAt||S.uploadDate||new Date)})}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(Tt,{can:"documents:read",mode:"disable",children:t.jsx("a",{href:S.fileURL||"#",target:"_blank",rel:"noopener noreferrer",className:"btn btn-success",title:" ",style:{width:"32px",height:"32px",padding:"0",borderRadius:"6px 0 0 6px",fontSize:"12px"},onClick:H=>{S.fileURL||(H.preventDefault(),T("   ",""))},children:t.jsx("i",{className:"bi bi-eye"})})}),t.jsx(Tt,{can:"documents:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>c(S),title:"",disabled:d,style:{width:"32px",height:"32px",padding:"0",borderRadius:"0 6px 6px 0",fontSize:"12px"},children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},S.id||`doc-${A}`)})})]})})]})}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:t.jsxs("div",{className:"d-flex",style:{gap:"10px"},children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:e,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},children:""}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>y("    "," "),style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},children:""})]})})]})})}),t.jsx(Mt,{show:R.show,onClose:D,title:R.title,message:R.message,type:R.type,onConfirm:R.onConfirm,showConfirm:R.showConfirm})]}):null},al="rawmaterials",nx=()=>{window.dispatchEvent(new CustomEvent("rawMaterialsUpdated"))};class Tn{static async getAllRawMaterials(){try{const e=Pe(ae,al),s=st(e,as("createdAt","desc"));return(await qe(s)).docs.map(i=>{var o,l;const a=i.data();return{id:i.id,internalId:a.internalId||Ct("RAW_MATERIAL"),...a,createdAt:(o=a.createdAt)==null?void 0:o.toDate(),updatedAt:(l=a.updatedAt)==null?void 0:l.toDate()}})}catch(e){throw console.error("Error fetching raw materials:",e),new Error("     ")}}static async getRawMaterialById(e){var s,r;try{const i=Le(ae,al,e),a=await ss(i);if(a.exists()){const o=a.data();return{id:a.id,internalId:o.internalId||Ct("RAW_MATERIAL"),...o,createdAt:(s=o.createdAt)==null?void 0:s.toDate(),updatedAt:(r=o.updatedAt)==null?void 0:r.toDate()}}else return null}catch(i){throw console.error("Error fetching raw material by ID:",i),new Error("     ")}}static async getRawMaterialByInternalId(e){var s,r;try{const i=Pe(ae,al),a=st(i,xt("internalId","==",e)),o=await qe(a);if(o.empty)return null;{const l=o.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:(s=c.createdAt)==null?void 0:s.toDate(),updatedAt:(r=c.updatedAt)==null?void 0:r.toDate()}}}catch(i){throw console.error("Error fetching raw material by internal ID:",i),new Error("     ")}}static async updateRawMaterialByInternalId(e,s){try{const r=await this.getRawMaterialByInternalId(e);if(!r)throw new Error("Raw material not found");return await this.updateRawMaterial(r.id,s)}catch(r){throw console.error("Error updating raw material by internal ID:",r),new Error("     ")}}static async deleteRawMaterialByInternalId(e){try{const s=await this.getRawMaterialByInternalId(e);if(!s)throw new Error("Raw material not found");return await this.deleteRawMaterial(s.id)}catch(s){throw console.error("Error deleting raw material by internal ID:",s),new Error("    ")}}static async createRawMaterial(e){try{const s=Ct("RAW_MATERIAL"),r={...e,internalId:s,createdAt:We(),updatedAt:We()},i=await As(Pe(ae,al),r);return nx(),i.id}catch(s){throw console.error("Error creating raw material:",s),new Error("    ")}}static async updateRawMaterial(e,s){try{const r=Le(ae,al,e),i={...s,updatedAt:We()};return await Qt(r,i),nx(),!0}catch(r){throw console.error("Error updating raw material:",r),new Error("     ")}}static async deleteRawMaterial(e){try{const s=Le(ae,al,e);return await es(s),nx(),!0}catch(s){throw console.error("Error deleting raw material:",s),new Error("    ")}}static async searchRawMaterials(e){try{const s=Pe(ae,al);return(await qe(s)).docs.map(o=>{var c,d;const l=o.data();return{id:o.id,internalId:l.internalId||Ct("RAW_MATERIAL"),...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}}).filter(o=>{var l,c,d,u;return((l=o.name)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))||((c=o.category)==null?void 0:c.toLowerCase().includes(e.toLowerCase()))||((d=o.description)==null?void 0:d.toLowerCase().includes(e.toLowerCase()))||((u=o.supplier)==null?void 0:u.toLowerCase().includes(e.toLowerCase()))})}catch(s){throw console.error("Error searching raw materials:",s),new Error("     ")}}static async migrateExistingData(){try{console.log("Starting raw materials migration...");const e=await this.getAllRawMaterials();let s=0;for(const r of e)if(!r.internalId||!r.internalId.startsWith("rm_")){const i=Ct("RAW_MATERIAL");await this.updateRawMaterial(r.id,{...r,internalId:i}),s++,console.log(`Migrated raw material: ${r.name} -> ${i}`)}return console.log(`Migration completed. ${s} raw materials migrated.`),{success:!0,migratedCount:s}}catch(e){throw console.error("Error during migration:",e),new Error("   ")}}static async getRawMaterialsByInternalIds(e){try{const s=e.map(i=>this.getRawMaterialByInternalId(i));return(await Promise.all(s)).filter(i=>i!==null)}catch(s){throw console.error("Error fetching raw materials by internal IDs:",s),new Error("     ")}}static validateRawMaterialData(e){var r,i,a;const s={};return(r=e.name)!=null&&r.trim()||(s.name="   "),(i=e.category)!=null&&i.trim()||(s.category="   "),(a=e.unit)!=null&&a.trim()||(s.unit=" "),(!e.price||parseFloat(e.price)<=0)&&(s.price="      "),s}}const dd=Object.freeze(Object.defineProperty({__proto__:null,RawMaterialService:Tn},Symbol.toStringTag,{value:"Module"})),ol="localproducts",rx=()=>{window.dispatchEvent(new CustomEvent("localProductsUpdated"))};class An{static async getAllLocalProducts(){try{const e=Pe(ae,ol);let s;try{s=st(e,as("createdAt","desc"))}catch{console.log("Using query without orderBy for empty collection"),s=st(e)}const i=(await qe(s)).docs.map(a=>{var l,c;const o=a.data();return{id:a.id,internalId:o.internalId||Ct("LOCAL_PRODUCT"),...o,createdAt:(l=o.createdAt)==null?void 0:l.toDate(),updatedAt:(c=o.updatedAt)==null?void 0:c.toDate()}});return i.length>0&&i[0].createdAt&&i.sort((a,o)=>(o.createdAt||new Date(0))-(a.createdAt||new Date(0))),i}catch(e){if(console.error("Error fetching local products:",e),console.error("Error details:",e.code,e.message),e.code==="failed-precondition"||e.message.includes("index"))return console.log("Collection appears to be empty or missing index, returning empty array"),[];throw new Error("     : "+e.message)}}static async getLocalProductById(e){var s,r;try{const i=Le(ae,ol,e),a=await ss(i);if(a.exists()){const o=a.data();return{id:a.id,internalId:o.internalId||Ct("LOCAL_PRODUCT"),...o,createdAt:(s=o.createdAt)==null?void 0:s.toDate(),updatedAt:(r=o.updatedAt)==null?void 0:r.toDate()}}else return null}catch(i){throw console.error("Error fetching local product by ID:",i),new Error("     ")}}static async createLocalProduct(e){try{const s=Ct("LOCAL_PRODUCT"),r={...e,internalId:s,createdAt:We(),updatedAt:We()},i=await As(Pe(ae,ol),r);return rx(),i.id}catch(s){throw console.error("Error creating local product:",s),new Error("    ")}}static async updateLocalProduct(e,s){try{const r=Le(ae,ol,e),i={...s,updatedAt:We()};return await Qt(r,i),rx(),!0}catch(r){throw console.error("Error updating local product:",r),new Error("     ")}}static async getLocalProductByInternalId(e){var s,r;try{const i=Pe(ae,ol),a=st(i,xt("internalId","==",e)),o=await qe(a);if(o.empty)return null;{const l=o.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:(s=c.createdAt)==null?void 0:s.toDate(),updatedAt:(r=c.updatedAt)==null?void 0:r.toDate()}}}catch(i){throw console.error("Error fetching local product by internal ID:",i),new Error("     ")}}static async updateLocalProductByInternalId(e,s){try{const r=await this.getLocalProductByInternalId(e);if(!r)throw new Error("Local product not found");return await this.updateLocalProduct(r.id,s)}catch(r){throw console.error("Error updating local product by internal ID:",r),new Error("     ")}}static async deleteLocalProduct(e){try{const s=Le(ae,ol,e);return await es(s),rx(),!0}catch(s){throw console.error("Error deleting local product:",s),new Error("    ")}}static async deleteLocalProductByInternalId(e){try{const s=await this.getLocalProductByInternalId(e);if(!s)throw new Error("Local product not found");return await this.deleteLocalProduct(s.id)}catch(s){throw console.error("Error deleting local product by internal ID:",s),new Error("    ")}}static async searchLocalProducts(e){try{const s=Pe(ae,ol);return(await qe(s)).docs.map(o=>{var c,d;const l=o.data();return{id:o.id,internalId:l.internalId||Ct("LOCAL_PRODUCT"),...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}}).filter(o=>{var l,c,d,u;return((l=o.name)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))||((c=o.category)==null?void 0:c.toLowerCase().includes(e.toLowerCase()))||((d=o.description)==null?void 0:d.toLowerCase().includes(e.toLowerCase()))||((u=o.supplier)==null?void 0:u.toLowerCase().includes(e.toLowerCase()))})}catch(s){if(console.error("Error searching local products:",s),console.error("Error details:",s.code,s.message),s.code==="failed-precondition"||s.message.includes("index")||s.code==="not-found")return console.log("Collection appears to be empty or missing, returning empty array"),[];throw new Error("     : "+s.message)}}static async migrateExistingData(){try{console.log("Starting local products migration...");const e=await this.getAllLocalProducts();let s=0;for(const r of e)if(!r.internalId||!r.internalId.startsWith("lp_")){const i=Ct("LOCAL_PRODUCT");await this.updateLocalProduct(r.id,{...r,internalId:i}),s++,console.log(`Migrated local product: ${r.name} -> ${i}`)}return console.log(`Migration completed. ${s} local products migrated.`),{success:!0,migratedCount:s}}catch(e){throw console.error("Error during migration:",e),new Error("   ")}}static validateLocalProductData(e){var r,i,a;const s={};return(r=e.name)!=null&&r.trim()||(s.name="   "),(i=e.category)!=null&&i.trim()||(s.category="   "),(a=e.unit)!=null&&a.trim()||(s.unit=" "),(!e.price||parseFloat(e.price)<=0)&&(s.price="      "),s}}const ud=Object.freeze(Object.defineProperty({__proto__:null,LocalProductService:An},Symbol.toStringTag,{value:"Module"}));async function U1(n,e){const s=await As(Pe(ae,n),{...e,_createdAt:new Date});return await yn(s,{...e,id:s.id,_createdAt:new Date},{merge:!0}),s.id}async function $1(n,e){const s=await ss(Le(ae,n,e));return s.exists()?{id:s.id,...s.data()}:null}const ll="foreignproducts",ix=()=>{window.dispatchEvent(new CustomEvent("foreignProductsUpdated"))};class nn{static calculateLowestTotalCost(e){if(!e.priceQuotes||!Array.isArray(e.priceQuotes)||e.priceQuotes.length===0)return{totalCost:parseFloat(e.price)||0,lowestQuote:null,hasQuotes:!1,displaySupplier:e.supplier};const s=e.priceQuotes.reduce((i,a)=>{const o=(parseFloat(i.price)||0)+(parseFloat(i.shippingCost)||0);return(parseFloat(a.price)||0)+(parseFloat(a.shippingCost)||0)<o?a:i});return{totalCost:(parseFloat(s.price)||0)+(parseFloat(s.shippingCost)||0),lowestQuote:s,hasQuotes:!0,displaySupplier:s.supplierName}}static async getAllForeignProducts(){try{const e=Pe(ae,ll);let s;try{const i=st(e,as("createdAt","desc"));s=await qe(i,"getAllForeignProducts")}catch(i){console.log("OrderBy failed, using simple query:",i.message),s=await qe(e,"getAllForeignProducts-simple")}const r=s.docs.map(i=>{var o,l;const a=i.data();return{id:i.id,internalId:a.internalId||Ct("FOREIGN_PRODUCT"),...a,createdAt:(o=a.createdAt)==null?void 0:o.toDate(),updatedAt:(l=a.updatedAt)==null?void 0:l.toDate()}});return r.length>0&&r[0].createdAt&&r.sort((i,a)=>(a.createdAt||new Date(0))-(i.createdAt||new Date(0))),r}catch(e){if(console.error("Error fetching foreign products:",e),console.error("Error details:",e.code,e.message),e.code==="failed-precondition"||e.message.includes("index"))return console.log("Collection appears to be empty or missing index, returning empty array"),[];throw new Error("     : "+e.message)}}static async getForeignProductById(e){var s,r;try{const i=await $1(ll,e);return i?{...i,internalId:i.internalId||Ct("FOREIGN_PRODUCT"),createdAt:(s=i.createdAt)==null?void 0:s.toDate(),updatedAt:(r=i.updatedAt)==null?void 0:r.toDate()}:null}catch(i){throw console.error("Error fetching foreign product by ID:",i),new Error("     ")}}static async addForeignProduct(e){try{const s=Ct("FOREIGN_PRODUCT");let r=null,i=null;if(e.priceQuotes&&e.priceQuotes.length>0){const l=e.priceQuotes.reduce((c,d)=>{const u=(parseFloat(c.price)||0)+(parseFloat(c.shippingCost)||0);return(parseFloat(d.price)||0)+(parseFloat(d.shippingCost)||0)<u?d:c});r=parseFloat(l.price)||0,i=(parseFloat(l.price)||0)+(parseFloat(l.shippingCost)||0),console.log(" FOREIGN PRODUCT SERVICE: Calculated lowest total cost:",{quote:l,itemPrice:r,shippingCost:parseFloat(l.shippingCost)||0,totalCost:i})}const a={...e,internalId:s,price:r!==null?r.toString():e.price||"",calculatedTotalCost:i!==null?i.toString():null,createdAt:We(),updatedAt:We()},o=await U1(ll,a);return ix(),o}catch(s){throw console.error("Error adding foreign product:",s),new Error("    ")}}static async createForeignProduct(e){return this.addForeignProduct(e)}static async updateForeignProduct(e,s){try{let r=null,i=null;if(s.priceQuotes&&s.priceQuotes.length>0){const l=s.priceQuotes.reduce((c,d)=>{const u=(parseFloat(c.price)||0)+(parseFloat(c.shippingCost)||0);return(parseFloat(d.price)||0)+(parseFloat(d.shippingCost)||0)<u?d:c});r=parseFloat(l.price)||0,i=(parseFloat(l.price)||0)+(parseFloat(l.shippingCost)||0),console.log(" FOREIGN PRODUCT SERVICE: Updated lowest total cost:",{quote:l,itemPrice:r,shippingCost:parseFloat(l.shippingCost)||0,totalCost:i})}const a=Le(ae,ll,e),o={...s,price:r!==null?r.toString():s.price||"",calculatedTotalCost:i!==null?i.toString():null,updatedAt:We()};return await Qt(a,o,"updateForeignProduct"),ix(),!0}catch(r){throw console.error("Error updating foreign product:",r),new Error("     ")}}static async getForeignProductByInternalId(e){var s,r;try{const i=Pe(ae,ll),a=st(i,xt("internalId","==",e)),o=await qe(a,"getForeignProductByInternalId");if(o.empty)return null;{const l=o.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:(s=c.createdAt)==null?void 0:s.toDate(),updatedAt:(r=c.updatedAt)==null?void 0:r.toDate()}}}catch(i){throw console.error("Error fetching foreign product by internal ID:",i),new Error("     ")}}static async updateForeignProductByInternalId(e,s){try{const r=await this.getForeignProductByInternalId(e);if(!r)throw new Error("Foreign product not found");return await this.updateForeignProduct(r.id,s)}catch(r){throw console.error("Error updating foreign product by internal ID:",r),new Error("     ")}}static async deleteForeignProduct(e){try{const s=Le(ae,ll,e);return await es(s,"deleteForeignProduct"),ix(),!0}catch(s){throw console.error("Error deleting foreign product:",s),new Error("    ")}}static async deleteForeignProductByInternalId(e){try{const s=await this.getForeignProductByInternalId(e);if(!s)throw new Error("Foreign product not found");return await this.deleteForeignProduct(s.id)}catch(s){throw console.error("Error deleting foreign product by internal ID:",s),new Error("    ")}}static async searchForeignProducts(e){try{const s=Pe(ae,ll);return(await qe(s,"searchForeignProducts")).docs.map(o=>{var c,d;const l=o.data();return{id:o.id,internalId:l.internalId||Ct("FOREIGN_PRODUCT"),...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}}).filter(o=>{var l,c,d,u;return((l=o.name)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))||((c=o.category)==null?void 0:c.toLowerCase().includes(e.toLowerCase()))||((d=o.description)==null?void 0:d.toLowerCase().includes(e.toLowerCase()))||((u=o.supplier)==null?void 0:u.toLowerCase().includes(e.toLowerCase()))})}catch(s){if(console.error("Error searching foreign products:",s),console.error("Error details:",s.code,s.message),s.code==="failed-precondition"||s.message.includes("index")||s.code==="not-found")return console.log("Collection appears to be empty or missing, returning empty array"),[];throw new Error("     : "+s.message)}}static async migrateExistingData(){try{console.log("Starting foreign products migration...");const e=await this.getAllForeignProducts();let s=0;for(const r of e)if(!r.internalId||!r.internalId.startsWith("fp_")){const i=Ct("FOREIGN_PRODUCT");await this.updateForeignProduct(r.id,{...r,internalId:i}),s++,console.log(`Migrated foreign product: ${r.name} -> ${i}`)}return console.log(`Migration completed. ${s} foreign products migrated.`),{success:!0,migratedCount:s}}catch(e){throw console.error("Error during migration:",e),new Error("   ")}}static validateForeignProductData(e){var r,i,a;const s={};return(r=e.name)!=null&&r.trim()||(s.name="   "),(i=e.category)!=null&&i.trim()||(s.category="   "),(a=e.unit)!=null&&a.trim()||(s.unit=" "),(!e.price||parseFloat(e.price)<=0)&&(s.price="      "),s}}const hd=Object.freeze(Object.defineProperty({__proto__:null,ForeignProductService:nn},Symbol.toStringTag,{value:"Module"})),vi="tenderItems",cl=()=>{window.dispatchEvent(new CustomEvent("tenderItemsUpdated",{detail:{timestamp:Date.now()}}))};class nc{static async getTenderItems(e){try{console.log(" Fetching tender items for tender:",e);const s=Pe(ae,vi),r=st(s,xt("tenderId","==",e),as("createdAt","desc")),a=(await qe(r)).docs.map(o=>{var c,d;const l=o.data();return{id:o.id,internalId:l.internalId||Ct("TENDER_ITEM"),...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}});return console.log(" Fetched tender items:",a.length),a}catch(s){if(console.error(" Error fetching tender items:",s),s.code==="failed-precondition"){console.log(" OrderBy failed, trying simple query...");try{const r=Pe(ae,vi),i=st(r,xt("tenderId","==",e)),o=(await qe(i)).docs.map(l=>{var d,u;const c=l.data();return{id:l.id,internalId:c.internalId||Ct("TENDER_ITEM"),...c,createdAt:(d=c.createdAt)==null?void 0:d.toDate(),updatedAt:(u=c.updatedAt)==null?void 0:u.toDate()}});return o.sort((l,c)=>(c.createdAt||new Date(0))-(l.createdAt||new Date(0))),o}catch(r){return console.error(" Fallback query failed:",r),[]}}throw new Error("    ")}}static async addMaterialToTender(e,s,r,i=1){try{console.log(" Adding material to tender:",{tenderId:e,materialInternalId:s,materialType:r,quantity:i});const o=(await this.getTenderItems(e)).find(j=>j.materialInternalId===s&&j.materialType===r);if(o){console.log(" Duplicate material found, updating quantity instead");const j=(o.quantity||1)+i;return await this.updateTenderItemQuantity(o.id,j)}let l=null;switch(r){case"rawMaterial":l=await Tn.getRawMaterialByInternalId(s);break;case"localProduct":l=await An.getLocalProductByInternalId(s);break;case"foreignProduct":l=await nn.getForeignProductByInternalId(s);break;default:throw new Error(`   : ${r}`)}if(!l)throw new Error(`    : ${s}`);const c=parseFloat(i)||1,d=parseFloat(l.price)||0,u=c*d,f={internalId:Ct("TENDER_ITEM"),tenderId:e,materialInternalId:s,materialType:r,materialName:l.name,materialCategory:l.category,materialUnit:l.unit,quantity:c,unitPrice:d,totalPrice:u,supplierInfo:{name:l.supplier||"",id:l.supplierId||""},createdAt:We(),updatedAt:We()},p=await As(Pe(ae,vi),f);return console.log(" Added tender item with ID:",p.id),cl(),{id:p.id,...f,createdAt:new Date,updatedAt:new Date}}catch(a){throw console.error(" Error adding material to tender:",a),new Error(`    : ${a.message}`)}}static async updateTenderItemQuantity(e,s){try{console.log(" Updating tender item quantity:",{itemId:e,newQuantity:s});const r=await this.getTenderItemById(e);if(!r)throw new Error("  ");const i=parseFloat(s)||1,a=i*(r.unitPrice||0),o=Le(ae,vi,e);return await Qt(o,{quantity:i,totalPrice:a,updatedAt:We()}),console.log(" Updated tender item quantity"),cl(),{...r,quantity:i,totalPrice:a,updatedAt:new Date}}catch(r){throw console.error(" Error updating tender item quantity:",r),new Error("    ")}}static async getTenderItemById(e){var s,r;try{const i=Le(ae,vi,e),a=await ss(i);if(a.exists()){const o=a.data();return{id:a.id,internalId:o.internalId||Ct("TENDER_ITEM"),...o,createdAt:(s=o.createdAt)==null?void 0:s.toDate(),updatedAt:(r=o.updatedAt)==null?void 0:r.toDate()}}else return null}catch(i){throw console.error(" Error fetching tender item by ID:",i),new Error("    ")}}static async updateTenderItem(e,s){try{const r=Le(ae,vi,e);return await Qt(r,{...s,updatedAt:We()}),cl(),!0}catch(r){throw console.error(" Error updating tender item:",r),new Error("   ")}}static async deleteTenderItem(e){try{const s=Le(ae,vi,e);return await es(s),cl(),!0}catch(s){throw console.error(" Error deleting tender item:",s),new Error("   ")}}static async deleteAllTenderItems(e){try{console.log(" Deleting all items for tender:",e);const s=await this.getTenderItems(e);if(s.length===0)return!0;const r=Fr(ae);return s.forEach(i=>{const a=Le(ae,vi,i.id);r.delete(a)}),await r.commit(),console.log(" Deleted all tender items:",s.length),cl(),!0}catch(s){throw console.error(" Error deleting all tender items:",s),new Error("     ")}}static async refreshTenderItemsPricing(e){try{console.log(" Refreshing prices for tender:",e);let s;if(Array.isArray(e)?(console.log(" Input is array of items, using directly"),s=e):(console.log(" Input is tender ID, fetching items from database"),s=await this.getTenderItems(e)),!s||s.length===0)return console.log(" No items to refresh pricing for"),[];const r=[],i=Fr(ae);let a=0;const o=Array.isArray(e);for(const l of s)try{let c=null;switch(l.materialType){case"rawMaterial":c=await Tn.getRawMaterialByInternalId(l.materialInternalId);break;case"localProduct":c=await An.getLocalProductByInternalId(l.materialInternalId);break;case"foreignProduct":c=await nn.getForeignProductByInternalId(l.materialInternalId);break}if(c){const d=parseFloat(c.price)||0,u=(l.quantity||1)*d;if(!o&&l.id&&d!==l.unitPrice){console.log(" Updating database item price:",l.materialName);const p=Le(ae,vi,l.id);i.update(p,{unitPrice:d,totalPrice:u,supplierInfo:{name:c.supplier||"",id:c.supplierId||""},updatedAt:We()}),a++}r.push({...l,unitPrice:d,totalPrice:u,supplierInfo:c.supplier||l.supplierInfo||"",materialUnit:c.unit||l.materialUnit||""})}else console.warn(" Material not found for item:",l.materialInternalId),r.push(l)}catch(c){console.error(" Error refreshing item:",l.materialName,c),r.push(l)}return a>0&&(await i.commit(),console.log(" Batch updated",a,"items")),cl(),r}catch(s){throw console.error(" Error refreshing tender items pricing:",s),new Error("    ")}}static async addMultipleMaterialsToTender(e,s){try{console.log(" Bulk adding materials to tender:",{tenderId:e,count:s.length});const r=Fr(ae),i=[],a=await this.getTenderItems(e),o=new Set(a.map(l=>`${l.materialInternalId}_${l.materialType}`));for(const l of s){const c=`${l.materialInternalId}_${l.materialType}`;if(o.has(c)){console.log(" Skipping duplicate material:",l.materialInternalId);continue}let d=null;switch(l.materialType){case"rawMaterial":d=await Tn.getRawMaterialByInternalId(l.materialInternalId);break;case"localProduct":d=await An.getLocalProductByInternalId(l.materialInternalId);break;case"foreignProduct":d=await nn.getForeignProductByInternalId(l.materialInternalId);break}if(d){const u=parseFloat(l.quantity)||1,f=parseFloat(d.price)||0,p=u*f,j={internalId:Ct("TENDER_ITEM"),tenderId:e,materialInternalId:l.materialInternalId,materialType:l.materialType,materialName:d.name,materialCategory:d.category,materialUnit:d.unit,quantity:u,unitPrice:f,totalPrice:p,supplierInfo:{name:d.supplier||"",id:d.supplierId||""},createdAt:We(),updatedAt:We()},L=Le(Pe(ae,vi));r.set(L,j),i.push({id:L.id,...j,createdAt:new Date,updatedAt:new Date})}}return i.length>0&&(await r.commit(),console.log(" Bulk added items:",i.length)),cl(),i}catch(r){throw console.error(" Error bulk adding materials:",r),new Error("    ")}}static async materialExistsInTender(e,s,r){try{return(await this.getTenderItems(e)).some(a=>a.materialInternalId===s&&a.materialType===r)}catch(i){return console.error(" Error checking material existence:",i),!1}}static async getTenderTotals(e){try{const s=await this.getTenderItems(e),r=s.reduce((o,l)=>o+(l.totalPrice||0),0),i=s.reduce((o,l)=>o+(l.quantity||0),0),a=s.length;return{totalPrice:r,totalQuantity:i,itemsCount:a,items:s}}catch(s){throw console.error(" Error calculating tender totals:",s),new Error("    ")}}static async getTenderItemsByType(e,s){try{const r=Pe(ae,vi),i=st(r,xt("tenderId","==",e),xt("materialType","==",s),as("createdAt","desc"));return(await qe(i)).docs.map(o=>{var c,d;const l=o.data();return{id:o.id,internalId:l.internalId||Ct("TENDER_ITEM"),...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}})}catch(r){return console.error(" Error fetching items by type:",r),(await this.getTenderItems(e)).filter(a=>a.materialType===s)}}static async searchTenderItems(e,s){try{const r=await this.getTenderItems(e);if(!s.trim())return r;const i=s.toLowerCase();return r.filter(a=>{var o;return(a.materialName||"").toLowerCase().includes(i)||(a.materialCategory||"").toLowerCase().includes(i)||(((o=a.supplierInfo)==null?void 0:o.name)||"").toLowerCase().includes(i)||(a.materialType||"").toLowerCase().includes(i)})}catch(r){throw console.error(" Error searching tender items:",r),new Error("    ")}}static async getMaterialsSummary(e){try{const s=await this.getTenderItems(e),r={rawMaterial:{count:0,totalPrice:0},localProduct:{count:0,totalPrice:0},foreignProduct:{count:0,totalPrice:0}};return s.forEach(i=>{const a=i.materialType||"rawMaterial";r[a]&&(r[a].count++,r[a].totalPrice+=i.totalPrice||0)}),r}catch(s){throw console.error(" Error getting materials summary:",s),new Error("    ")}}static validateTenderItemData(e){var r,i,a;const s={};return(r=e.tenderId)!=null&&r.trim()||(s.tenderId="  "),(i=e.materialInternalId)!=null&&i.trim()||(s.materialInternalId="  "),(a=e.materialType)!=null&&a.trim()||(s.materialType="  "),(!e.quantity||parseFloat(e.quantity)<=0)&&(s.quantity="      "),s}static async getTenderStatistics(e){try{const s=await this.getTenderItems(e),r=await this.getMaterialsSummary(e);return{totalItems:s.length,totalValue:s.reduce((a,o)=>a+(o.totalPrice||0),0),totalQuantity:s.reduce((a,o)=>a+(o.quantity||0),0),materialTypes:r,averageItemValue:s.length>0?s.reduce((a,o)=>a+(o.totalPrice||0),0)/s.length:0,highestValueItem:s.reduce((a,o)=>(o.totalPrice||0)>(a.totalPrice||0)?o:a,{}),lowestValueItem:s.reduce((a,o)=>(o.totalPrice||0)<(a.totalPrice||Number.MAX_VALUE)?o:a,{})}}catch(s){throw console.error(" Error getting tender statistics:",s),new Error("    ")}}}const Hf=h.memo(({value:n="",onChange:e,onBlur:s,name:r="category",required:i=!1,disabled:a=!1,placeholder:o=" ",className:l="form-select",style:c={},showDescription:d=!1,"data-testid":u,...f})=>{const{categoriesWithDetails:p,loading:j,error:L,isReady:R}=S4(),D=h.useMemo(()=>R?p.map((y,T)=>({value:y.value,label:y.label,description:y.description,isDefault:y.isDefault,uniqueKey:`${y.value}_${T}`})):[],[p,R]);return j?t.jsx("select",{className:l,style:c,disabled:!0,...f,children:t.jsx("option",{value:"",children:"  ..."})}):L?t.jsxs("div",{children:[t.jsx("select",{className:`${l} is-invalid`,style:c,disabled:!0,...f,children:t.jsx("option",{value:"",children:"   "})}),t.jsx("div",{className:"invalid-feedback",children:L})]}):!R||D.length===0?t.jsxs("div",{children:[t.jsx("select",{className:l,style:c,disabled:!0,...f,children:t.jsx("option",{value:"",children:"   "})}),t.jsx("small",{className:"form-text text-muted",children:"     "})]}):t.jsxs("div",{children:[t.jsxs("select",{name:r,value:n,onChange:e,onBlur:s,required:i,disabled:a,className:l,style:c,"data-testid":u,"aria-label":" ",...f,children:[t.jsx("option",{value:"",children:o}),D.map(y=>t.jsx("option",{value:y.value,title:d&&y.description?y.description:void 0,children:y.label},y.uniqueKey||y.value))]}),R&&t.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-1",children:[t.jsxs("small",{className:"form-text text-muted",children:[D.length,"  "]}),t.jsxs("small",{className:"form-text text-success",style:{fontSize:"10px"},children:[t.jsx("i",{className:"bi bi-wifi me-1"}),""]})]})]})});Hf.displayName="GlobalCategorySelect";const Qf=h.memo(({value:n="",onChange:e,onBlur:s,name:r="unit",required:i=!1,disabled:a=!1,placeholder:o=" ",className:l="form-select",style:c={},showDescription:d=!1,"data-testid":u,...f})=>{const{unitsWithDetails:p,loading:j,error:L,isReady:R}=E4(),D=h.useMemo(()=>R?p.map((y,T)=>({value:y.name,label:y.name,description:y.description,isDefault:y.isDefault,uniqueKey:`${y.name}_${T}`})):[],[p,R]);return j?t.jsx("select",{className:l,style:c,disabled:!0,...f,children:t.jsx("option",{value:"",children:"  ..."})}):L?t.jsxs("div",{children:[t.jsx("select",{className:`${l} is-invalid`,style:c,disabled:!0,...f,children:t.jsx("option",{value:"",children:"   "})}),t.jsx("div",{className:"invalid-feedback",children:L})]}):!R||D.length===0?t.jsxs("div",{children:[t.jsx("select",{className:l,style:c,disabled:!0,...f,children:t.jsx("option",{value:"",children:"   "})}),t.jsx("small",{className:"form-text text-muted",children:"     "})]}):t.jsxs("div",{children:[t.jsxs("select",{name:r,value:n,onChange:e,onBlur:s,required:i,disabled:a,className:l,style:c,"data-testid":u,"aria-label":" ",...f,children:[t.jsx("option",{value:"",children:o}),D.map(y=>t.jsx("option",{value:y.value,title:d&&y.description?y.description:void 0,children:y.label},y.uniqueKey||y.value))]}),R&&t.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-1",children:[t.jsxs("small",{className:"form-text text-muted",children:[D.length,"  "]}),t.jsxs("small",{className:"form-text text-success",style:{fontSize:"10px"},children:[t.jsx("i",{className:"bi bi-wifi me-1"}),""]})]})]})});Qf.displayName="GlobalUnitSelect";const rc=h.memo(({value:n="",onChange:e,onBlur:s,name:r="city",required:i=!1,disabled:a=!1,placeholder:o=" ",className:l="form-select",style:c={},showDescription:d=!1,"data-testid":u,...f})=>{const{citiesWithDetails:p,loading:j,error:L,isReady:R}=C4(),D=h.useMemo(()=>!R||!p||p.length===0?[]:p.map((y,T)=>({value:y.name,label:y.name,description:y.description,isDefault:y.isDefault,uniqueKey:`${y.name}_${T}`})),[p,R]);return L?t.jsx("select",{className:`${l} is-invalid`,style:c,disabled:!0,...f,children:t.jsx("option",{value:"",children:"   "})}):!R||D.length===0?t.jsx("select",{className:l,style:c,disabled:!0,...f,children:t.jsx("option",{value:"",children:j?"  ...":"   "})}):t.jsxs("select",{name:r,value:n,onChange:e,onBlur:s,required:i,disabled:a,className:l,style:c,"data-testid":u,"aria-label":" ",...f,children:[t.jsx("option",{value:"",children:o}),D.map(y=>t.jsx("option",{value:y.value,title:d&&y.description?y.description:void 0,children:y.label},y.uniqueKey||y.value))]})});rc.displayName="GlobalCitySelect";const Vh=h.memo(({position:n="bottom-right",showDetails:e=!1,className:s="",style:r={}})=>{const{isReady:i,loading:a,lastUpdated:o}=Id(),l=(a==null?void 0:a.categories)||(a==null?void 0:a.units)||!1,d=n?{"top-right":{position:"fixed",top:"80px",right:"20px",zIndex:1040},"bottom-right":{position:"fixed",bottom:"20px",right:"20px",zIndex:1040},"top-left":{position:"fixed",top:"80px",left:"20px",zIndex:1040},"bottom-left":{position:"fixed",bottom:"20px",left:"20px",zIndex:1040}}[n]:{},u=typeof i=="function"?i():i;return t.jsxs("div",{className:`badge ${u?"bg-success":l?"bg-warning":"bg-danger"} ${s}`,style:{...d,...r},children:[t.jsx("i",{className:`bi ${u?"bi-wifi":l?"bi-arrow-clockwise":"bi-wifi-off"} me-1`}),u?" ":l?" ...":" ",e&&(o==null?void 0:o.categories)&&t.jsxs("div",{className:"mt-1",style:{fontSize:"10px"},children:[" : ",new Date(o.categories).toLocaleTimeString("ar")]})]})});Vh.displayName="SettingsSyncStatus";const vU=h.memo(({showSettingsLink:n=!0,showRefreshButton:e=!0,size:s="sm",className:r="d-flex gap-2",style:i={}})=>{const{forceRefresh:a,isReady:o}=Id(),l=()=>{a&&a()};return t.jsxs("div",{className:r,style:i,children:[e&&t.jsx("button",{type:"button",className:`btn btn-outline-primary btn-${s}`,onClick:l,disabled:!(typeof o=="function"?o():o),title:" ",children:t.jsx("i",{className:"bi bi-arrow-clockwise"})}),n&&t.jsx("a",{href:"/settings",className:`btn btn-outline-secondary btn-${s}`,title:" ",children:t.jsx("i",{className:"bi bi-gear"})})]})});vU.displayName="SettingsQuickActions";const NU=h.memo(()=>{const{categories:n,units:e,cities:s,loading:r,error:i,initialized:a,lastUpdated:o,isReady:l}=Id();return null});NU.displayName="SettingsStatusPanel";class _r{static async getTenderWithItems(e,s=!0){console.log(" TENDER DATA SERVICE: Loading tender with items:",e);try{const r=await ss(Le(ae,this.COLLECTIONS.TENDERS,e));if(!r.exists())throw new Error(`Tender ${e} not found`);const i={id:r.id,...r.data()};console.log(" TENDER DATA: Main document loaded:",i.title);const a=st(Pe(ae,this.COLLECTIONS.TENDER_ITEMS),xt("tenderId","==",e)),o=await qe(a),l=[];o.forEach(d=>{var u,f,p,j;l.push({id:d.id,...d.data(),createdAt:((f=(u=d.data().createdAt)==null?void 0:u.toDate)==null?void 0:f.call(u))||new Date(d.data().createdAt||Date.now()),updatedAt:((j=(p=d.data().updatedAt)==null?void 0:p.toDate)==null?void 0:j.call(p))||new Date(d.data().updatedAt||Date.now())})}),console.log(" TENDER ITEMS: Loaded",l.length,"items from collection"),s&&this.setupRealTimeSync(e);const c={...i,items:l,lastSync:new Date().toISOString()};return this.cache.set(e,c),c}catch(r){throw console.error(" TENDER DATA SERVICE: Error loading tender:",r),r}}static setupRealTimeSync(e){const s=`tender_${e}`;this.subscriptions.has(s)&&(this.subscriptions.get(s)(),this.subscriptions.delete(s)),console.log(" REAL-TIME SYNC: Setting up for tender:",e);const r=st(Pe(ae,this.COLLECTIONS.TENDER_ITEMS),xt("tenderId","==",e)),i=ar(r,a=>{const o=[];a.forEach(c=>{var d,u,f,p;o.push({id:c.id,...c.data(),createdAt:((u=(d=c.data().createdAt)==null?void 0:d.toDate)==null?void 0:u.call(d))||new Date(c.data().createdAt||Date.now()),updatedAt:((p=(f=c.data().updatedAt)==null?void 0:f.toDate)==null?void 0:p.call(f))||new Date(c.data().updatedAt||Date.now())})}),console.log(" REAL-TIME UPDATE: Items changed for tender",e,"- count:",o.length);const l=this.cache.get(e);if(l){const c={...l,items:o,lastSync:new Date().toISOString()};this.cache.set(e,c),this.notifyListeners(e,c)}},a=>{console.error(" REAL-TIME SYNC: Error in tender items listener:",a)});return this.subscriptions.set(s,i),i}static addTenderListener(e,s){const r=`${e}_${Date.now()}_${Math.random()}`;return this.listeners.has(e)||this.listeners.set(e,new Map),this.listeners.get(e).set(r,s),console.log(" LISTENER: Added for tender",e,"- total listeners:",this.listeners.get(e).size),()=>{this.listeners.has(e)&&(this.listeners.get(e).delete(r),console.log(" LISTENER: Removed for tender",e),this.listeners.get(e).size===0&&(this.listeners.delete(e),this.cleanupRealTimeSync(e)))}}static notifyListeners(e,s){if(this.listeners.has(e)){const r=this.listeners.get(e);console.log(" NOTIFY: Broadcasting to",r.size,"listeners for tender",e),r.forEach((i,a)=>{try{i(s)}catch(o){console.error(" NOTIFY: Error in listener callback:",o),r.delete(a)}})}}static async saveTenderItems(e,s){console.log(" SAVING: Tender items for",e,"- count:",s.length);try{const r=[],i=We(),a=st(Pe(ae,this.COLLECTIONS.TENDER_ITEMS),xt("tenderId","==",e)),o=await qe(a),l=[];o.forEach(u=>{l.push(es(u.ref))}),l.length>0&&(await Promise.all(l),console.log(" CLEARED:",l.length,"existing items"));const c=s.map((u,f)=>{const p={...u,tenderId:e,sortOrder:f,updatedAt:i,createdAt:u.createdAt?u.createdAt:i},j=u.internalId||`${e}_item_${f}_${Date.now()}`;return yn(Le(ae,this.COLLECTIONS.TENDER_ITEMS,j),p)});await Promise.all(c),await Qt(Le(ae,this.COLLECTIONS.TENDERS,e),{items:s,itemsCount:s.length,updatedAt:i}),console.log(" SAVED: Tender items successfully saved to both collection and embedded");const d=this.cache.get(e);if(d){const u={...d,items:s,itemsCount:s.length,lastSync:new Date().toISOString()};this.cache.set(e,u)}return!0}catch(r){throw console.error(" SAVE ERROR: Failed to save tender items:",r),r}}static cleanupRealTimeSync(e){const s=`tender_${e}`;this.subscriptions.has(s)&&(console.log(" CLEANUP: Removing real-time sync for tender:",e),this.subscriptions.get(s)(),this.subscriptions.delete(s)),this.cache.delete(e)}static cleanupAll(){console.log(" CLEANUP ALL: Removing all subscriptions and cache"),this.subscriptions.forEach((e,s)=>{e()}),this.subscriptions.clear(),this.listeners.clear(),this.cache.clear()}static getCachedTender(e){return this.cache.get(e)||null}static async refreshTender(e){return console.log(" REFRESH: Force refreshing tender data:",e),this.cache.delete(e),await this.getTenderWithItems(e,!0)}static getStatus(){return{cachedTenders:Array.from(this.cache.keys()),activeSubscriptions:Array.from(this.subscriptions.keys()),activeListeners:Array.from(this.listeners.keys()).map(e=>{var s;return{tenderId:e,listenerCount:((s=this.listeners.get(e))==null?void 0:s.size)||0}})}}}Ys(_r,"cache",new Map),Ys(_r,"listeners",new Map),Ys(_r,"subscriptions",new Map),Ys(_r,"COLLECTIONS",{TENDERS:"tenders",TENDER_ITEMS:"tenderItems"});const jU=Object.freeze(Object.defineProperty({__proto__:null,TenderDataSharingService:_r,default:_r},Symbol.toStringTag,{value:"Module"})),U0=(n,e=!0)=>{const[s,r]=h.useState(null),[i,a]=h.useState([]),[o,l]=h.useState(!0),[c,d]=h.useState(null),[u,f]=h.useState(null),p=h.useRef(null),j=h.useRef(!0),L=h.useCallback(S=>{j.current&&(console.log(" HOOK: Received real-time update for tender:",n),r(S),a(S.items||[]),f(S.lastSync),d(null))},[n]),R=h.useCallback(async()=>{if(n){l(!0),d(null);try{console.log(" HOOK: Loading tender data for:",n);const S=await _r.getTenderWithItems(n,e);if(!j.current)return;r(S),a(S.items||[]),f(S.lastSync),e&&(p.current=_r.addTenderListener(n,L)),console.log(" HOOK: Tender data loaded successfully:",S.title)}catch(S){console.error(" HOOK: Error loading tender data:",S),j.current&&d(S.message||"    ")}finally{j.current&&l(!1)}}},[n,e,L]),D=h.useCallback(async S=>{if(!n)throw new Error("Tender ID is required");try{if(console.log(" HOOK: Saving tender items:",S.length),await _r.saveTenderItems(n,S),a(S),s){const A={...s,items:S,itemsCount:S.length,lastSync:new Date().toISOString()};r(A),f(A.lastSync)}console.log(" HOOK: Tender items saved successfully")}catch(A){throw console.error(" HOOK: Error saving tender items:",A),A}},[n,s]),y=h.useCallback(async()=>{if(n)try{console.log(" HOOK: Refreshing tender data");const S=await _r.refreshTender(n);if(!j.current)return;r(S),a(S.items||[]),f(S.lastSync),d(null)}catch(S){console.error(" HOOK: Error refreshing tender data:",S),j.current&&d(S.message||"    ")}},[n]),T=h.useCallback(()=>n?_r.getCachedTender(n):null,[n]);h.useEffect(()=>{R()},[R]),h.useEffect(()=>(j.current=!0,()=>{j.current=!1,p.current&&(p.current(),p.current=null)}),[]);const x={subtotal:i.reduce((S,A)=>S+(parseFloat(A.totalPrice)||0),0),itemsCount:i.length,hasItems:i.length>0,estimatedValue:(s==null?void 0:s.estimatedValue)||0,grandTotal:(s==null?void 0:s.grandTotal)||0};return{tenderData:s,tenderItems:i,loading:o,error:c,lastSync:u,...x,saveTenderItems:D,refreshTenderData:y,getCachedData:T,isRealTimeEnabled:e,tenderId:n}},SU=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>Go),void 0)),EU=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>Wo),void 0)),CU=h.lazy(()=>Xe(()=>import("./ItemSelectionModal-1759246972099-D9DWDeE0.js"),[]));function IU(){const n=kt(),{id:e}=Dn(),{logActivity:s,getCurrentUser:r}=Zt(),{alertConfig:i,closeAlert:a,showSuccess:o,showError:l,showConfirm:c}=Bt(),{isTimelineVisible:d}=Ut(),{hasPerm:u,readOnly:f}=Yn(),p=!!e,j=u("tenders:create"),L=u("tenders:update"),R=u("tenders:delete"),D=f||!p&&!j,y=D||p&&!L,T=L,x=R,S=D,[A,Q]=h.useState(!1),[q,B]=h.useState({title:"",referenceNumber:"",entity:"",description:"",submissionDeadline:"",estimatedValue:"",documentPrice:"",location:"",contactPerson:"",contactPhone:"",contactEmail:""}),[$,H]=h.useState({}),[te,G]=h.useState(!1),[F,X]=h.useState(!1),[ue,Y]=h.useState(!1),[z,O]=h.useState(""),[E,k]=h.useState(!1);h.useEffect(()=>{console.log(" showDocumentsModal state changed to:",E)},[E]);const[b,N]=h.useState([]),[I,P]=h.useState(!1),[_,C]=h.useState(!1),[U,w]=h.useState(null),[W,ie]=h.useState(""),[de,ne]=h.useState(!1),{tenderItems:ye,loading:pe,error:be,saveTenderItems:xe}=U0(e,!!e),[Ee,Re]=h.useState([]),fe=e?ye:Ee,[Ve,$e]=h.useState(""),et=()=>{setTimeout(()=>$e(""),3e3)},[ze,tt]=h.useState(!1),[rt,bt]=h.useState(null),[At,ns]=h.useState(null),[Ht,is]=h.useState(!1),[Oe,it]=h.useState(!1);h.useEffect(()=>{(async()=>{var Fe;try{if(X(!0),e)console.log(" EDIT MODE: Skipping pending items check - will load from saved tender");else{let De,Ze,at;try{[De,Ze,at]=await Promise.all([Ke.getPendingData("pendingTenderItems_new"),Ke.getPendingData("tenderFormData_new"),Ke.getPendingData("tenderDocuments_new")])}catch(dt){console.error(" Error loading pending data:",dt),De=null,Ze=null,at=null}De&&Array.isArray(De)&&De.length>0?(Re(De),console.log(" Items loaded for new tender mode:",De.length),console.log(" NEW TENDER STATE SET: Items initialized with pending data")):console.log(" NEW TENDER: No pending items found")}if(e){console.log(" EDIT MODE: Starting - IDENTICAL to creation mode logic");let De;try{De=await dn.getTenderForViewing(e)}catch(ft){throw console.error(" EDIT MODE: Error loading tender:",ft),new Error(`Failed to load tender: ${ft.message}`)}if(!De)throw console.error(" EDIT MODE: Tender not found"),new Error("Tender not found");console.log(" EDIT MODE: Tender loaded:",De.title);const Ze=await Ke.getPendingData(`tenderFormData_${e}`);if(Ze&&Object.keys(Ze).some(ft=>Ze[ft])){console.log(" EDIT MODE: Found saved form changes, using them");const ft={...De,...Ze};B(ft)}else{console.log(" EDIT MODE: Using original tender data");const ft={...De};if(ft.submissionDeadline){let gt=ft.submissionDeadline;gt&&typeof gt=="object"&&gt.seconds?gt=new Date(gt.seconds*1e3):gt&&typeof gt=="object"&&gt.toDate&&(gt=gt.toDate()),ft.submissionDeadline=Rl(gt)}if(ft.deadline){let gt=ft.deadline;gt&&typeof gt=="object"&&gt.seconds?gt=new Date(gt.seconds*1e3):gt&&typeof gt=="object"&&gt.toDate&&(gt=gt.toDate()),ft.submissionDeadline=Rl(gt),delete ft.deadline}if(ft.submissionDate){let gt=ft.submissionDate;gt&&typeof gt=="object"&&gt.seconds?gt=new Date(gt.seconds*1e3):gt&&typeof gt=="object"&&gt.toDate&&(gt=gt.toDate()),ft.submissionDeadline=Rl(gt),delete ft.submissionDate}const Dt=await Ke.getPendingData(`tenderFormData_${e}`);Dt&&(console.log(" EDIT MODE: Found pending form changes, merging with tender data"),Object.assign(ft,Dt)),B(ft)}const at=De.documents&&Array.isArray(De.documents)?De.documents:[];console.log(" FIREBASE-ONLY: Loading documents from single source:",at.length,"documents"),N(at);const dt=await Ke.getPendingData(`pendingTenderItems_${e}`);let ot=[];De.items&&Array.isArray(De.items)&&(console.log(" EDIT MODE: Found existing saved items:",De.items.length),ot=[...De.items]);const Je=await Ke.getPendingData(`pendingTenderItems_${e}`);if(Je&&Je.length>0){console.log(" EDIT MODE: Found tender-specific pending items:",Je.length);const ft=[],Dt=[];if(Je.forEach(us=>{const jt=(us.materialName||us.name||"").trim();if(!jt){console.log(" Empty item name, skipping");return}ot.some(pn=>(pn.materialName||pn.name||"").trim().toLowerCase()===jt.toLowerCase())?(Dt.push(jt),console.log(" DUPLICATE DETECTED:",jt)):ft.push(us)}),Dt.length>0){const us=Dt.length===1?`  "${Dt[0]}"  `:` ${Dt.length}   `;$e(us),et()}const gt=ft;gt.length>0?(console.log(" Adding new items to tender:",gt.length),ot=[...ot,...gt],console.log(" Added",gt.length,"new items, filtered",Dt.length,"duplicates")):console.log(" All pending items were duplicates, skipping"),await Ke.clearPendingData(`pendingTenderItems_${e}`),console.log(" EDIT MODE: Cleared pending items after merging")}if(ot.length>0){console.log(" FINAL ITEMS LIST:",ot.map(Dt=>({internalId:Dt.internalId||Dt.materialInternalId,materialName:Dt.materialName||Dt.name,supplierInfo:Dt.supplierInfo,unitPrice:Dt.unitPrice,quantity:Dt.quantity,totalPrice:Dt.totalPrice}))),await xe(ot),console.log(" Items loaded for edit mode:",ot.length);const ft=ot.reduce((Dt,gt)=>Dt+(gt.unitPrice||gt.price||0)*(gt.quantity||1),0);B(Dt=>({...Dt,estimatedValue:ft.toString()})),console.log(" EDIT MODE STATE SET: Final items count:",ot.length)}else console.log(" EDIT MODE: No items to load")}else{console.log(" NEW TENDER MODE: Checking for saved form data...");const De=await Ke.getPendingData("tenderFormData_new");De?(console.log(" NEW TENDER: Restoring saved form data from previous session"),B(De)):(console.log(" NEW TENDER: Starting with fresh empty form"),B({title:"",referenceNumber:"",entity:"",description:"",submissionDeadline:"",estimatedValue:"",documentPrice:"",category:"",location:"",contactPerson:"",contactPhone:"",contactEmail:""}));const Ze=await Ke.getPendingData("tenderDocuments_new");Ze&&Array.isArray(Ze)?(console.log(" NEW TENDER: Restoring saved documents"),N(Ze)):N([]);const at=await Ke.getPendingData("pendingTenderItems_new");if(at&&at.length>0){console.log(" NEW TENDER: Found pending items, adding to form");const dt=await Ke.getPendingData("tender_success_shown_new")==="true",ot=fe.length===0&&!Oe&&!dt;Re(at);const Je=at.reduce((ft,Dt)=>ft+(Dt.unitPrice||0)*(Dt.quantity||1),0);if(Je>0){console.log(` Updating estimated value from items: ${Je}`);const ft={...De||q,estimatedValue:Je.toString()};B(ft),await Ke.setPendingData("tenderFormData_new",ft)}ot?(it(!0),await Ke.setPendingData("tender_success_shown_new","true"),c(`  ${at.length}   .

       .`,()=>{},"  ","","",!1)):console.log(" Success message skipped (items already exist or already shown)")}else console.log(" No pending items found");console.log(" NEW TENDER: Form initialized with persistence")}console.log(" Data initialization completed"),i.show&&(i.type==="error"||(Fe=i.message)!=null&&Fe.includes("   "))&&setTimeout(()=>{a(),console.log(" Cleared lingering error alert after successful initialization")},100)}catch(De){console.error("Error initializing data:",De),De.message&&!De.message.includes("pending")&&!De.message.includes("not found")?(console.error(" Critical initialization error:",De),l(`   : ${De.message}`,"")):console.log(" Non-critical initialization issue:",De.message)}finally{X(!1)}})()},[e]),h.useEffect(()=>()=>{console.log(" COMPONENT UNMOUNT: Keeping pending items for next navigation")},[]);const Kt=h.useRef(!1),zs=h.useRef(Date.now()),xs=async()=>{if(Kt.current){console.log(" loadPendingItems already running, skipping...");return}if(e&&fe.length>0){console.log(" EDIT MODE: Skipping pending items load - already have saved tender items");return}try{Kt.current=!0,console.log(" Loading pending tender items from Firestore...");const je=await Ke.getPendingData(`pendingTenderItems_${e||"new"}`);if(je){const Fe=Array.isArray(je)?je:JSON.parse(je);console.log(" Found pending tender items:",Fe.length,"items"),console.log(" STORAGE CONTENT:",Fe.map(De=>({id:De.internalId||De.materialInternalId,name:De.materialName||De.name,type:De.materialType,unit:De.materialUnit}))),setTenderItems(De=>{console.log(" PROCESSING NEW ITEMS WITH EXAMPLE PATTERN"),console.log(" CURRENT ITEMS:",De.map(Je=>({name:Je.materialName||Je.name,type:Je.materialType})));const Ze=[],at=[];if(Fe.forEach(Je=>{const ft=(Je.materialName||Je.name||"").trim();if(console.log(" PROCESSING ITEM:",{trimmedName:ft,type:Je.materialType,materialName:Je.materialName,originalName:Je.name}),!ft){console.log(" Empty item name, skipping");return}De.some(gt=>(gt.materialName||gt.name||"").trim().toLowerCase()===ft.toLowerCase())?(at.push(ft),console.log(" DUPLICATE DETECTED:",ft)):(Ze.push(Je),console.log(" ADDING ITEM:",ft,"Type:",Je.materialType))}),at.length>0){const Je=at.length===1?`  "${at[0]}"  `:` ${at.length}   `;$e(Je),et()}if(Ze.length===0)return console.log(" No new items to add after duplicate filtering"),De;const dt=[...De,...Ze];console.log(" Added",Ze.length,"new items, filtered",at.length,"duplicates"),console.log(" FINAL ITEMS LIST:",dt.map(Je=>({name:Je.materialName||Je.name,type:Je.materialType})));const ot=dt.reduce((Je,ft)=>Je+(ft.unitPrice||0)*(ft.quantity||1),0);return ot>0&&B(Je=>({...Je,estimatedValue:ot.toString()})),console.log(" SENIOR REACT STORAGE REPLACEMENT COMPLETED:",{prevItemsCount:De.length,storageItemsCount:Fe.length,finalCount:dt.length,replacementSuccess:"COMPLETE_REPLACEMENT_FROM_STORAGE"}),dt}),setTimeout(()=>{setTenderItems(De=>(console.log(" FORCE RE-RENDER: Ensuring UI reflects current items count:",De.length),[...De]))},100),console.log(" Items loaded and ready - keeping in storage until tender is saved")}else{console.log(" No pending tender items found in Firestore");const Fe=await Ke.getPendingData(`tenderItems_${e||"new"}`);if(Fe&&fe.length===0)try{Array.isArray(Fe)&&Fe.length>0&&(console.log(" Loading existing tender items from Firestore:",Fe.length),setTenderItems(Fe))}catch(De){console.error("Error loading Firestore items:",De)}}}catch(je){console.error("Error loading pending items:",je)}finally{setTimeout(()=>{Kt.current=!1,console.log(" Released loadPendingItems lock after 3-second cooldown")},3e3)}};h.useEffect(()=>{const je=()=>{console.log(" Custom event received - reloading items..."),xs()},Fe=De=>{console.log(" TRASH RESTORE: Tender item restored from trash, reloading items...");const{tenderId:Ze,restoredItem:at}=De.detail||{};Ze===(e||"new")?(console.log(" RESTORE FOR THIS TENDER: Reloading items for tender",Ze),xs()):console.log(" RESTORE FOR OTHER TENDER: Ignoring restoration for tender",Ze)};return window.addEventListener("tenderItemsAdded",je),window.addEventListener("tenderItemRestored",Fe),()=>{window.removeEventListener("tenderItemsAdded",je),window.removeEventListener("tenderItemRestored",Fe)}},[]);const cs=h.useRef(!1);h.useEffect(()=>{const Fe=setTimeout(async()=>{const De=Date.now()-zs.current,Ze=De<5e3,at=cs.current;if(console.log(" AUTO-SAVE TRIGGERED:",{itemsCount:fe.length,isLoadingLocked:Kt.current,timeSinceMount:De,isRecentMount:Ze,isDeletingOperation:at,willSave:fe.length>0&&!Kt.current&&!Ze&&!at}),fe.length>0&&!Kt.current&&!Ze&&!at)try{await Ke.setPendingData(`pendingTenderItems_${e||"new"}`,fe,48),console.log(" SMART AUTO-SAVE: Saved tender items to Firestore:",fe.length,"items"),console.log(" AUTO-SAVE CONTENT:",fe.map(dt=>({id:dt.internalId||dt.materialInternalId,name:dt.materialName||dt.name})))}catch(dt){console.error("Error saving tender items:",dt)}else Kt.current?console.log(" SMART AUTO-SAVE: Skipping save during item loading to prevent race condition"):Ze?console.log(" SMART AUTO-SAVE: Skipping save - component recently mounted, allowing time for item loading"):at?console.log(" SMART AUTO-SAVE: Skipping save during deletion operation to prevent restoring deleted items"):fe.length===0&&console.log(" SMART AUTO-SAVE: Skipping save for empty items array")},2e3);return()=>clearTimeout(Fe)},[fe]),h.useEffect(()=>{const Fe=setTimeout(async()=>{if(b.length>0&&e&&e!=="new")try{console.log(" FIREBASE-ONLY AUTO-SAVE: Updating documents directly in Firebase"),await dn.updateTenderDocuments(e,b),console.log(" FIREBASE-ONLY: Documents saved directly to Firebase:",b.length)}catch(De){console.error(" FIREBASE-ONLY: Error saving documents to Firebase:",De)}},1e3);return()=>clearTimeout(Fe)},[b,e]),h.useEffect(()=>{const je=e||"new",Fe=Ze=>{const at=`tenderDocuments_${je}`;if(console.log(" Storage event detected:",{key:Ze.key,expectedKey:at,isMatch:Ze.key===at}),Ze.key===at&&Ze.newValue)try{const dt=JSON.parse(Ze.newValue);console.log(" Restoring documents from storage event:",dt.length),N(dt);const ot=dt.filter(Je=>Je.restoredFrom==="trash").sort((Je,ft)=>new Date(ft.restoredAt||0)-new Date(Je.restoredAt||0))[0];if(ot){const Je=r();s("file",`${Je.name}    `,` : ${ot.fileName}`)}}catch(dt){console.error("Error parsing restored documents:",dt)}},De=Ze=>{const{tenderId:at,restoredDocument:dt,allDocuments:ot}=Ze.detail;if(console.log(" Custom restore event detected:",{eventTenderId:at,currentTenderId:je,isMatch:at===je,documentName:dt==null?void 0:dt.fileName}),at===je){console.log(" Updating documents from custom event:",ot.length),N([...ot]);const Je=r();s("file",`${Je.name}    `,` : ${dt.fileName}`)}};return window.addEventListener("storage",Fe),window.addEventListener("tenderDocumentRestored",De),()=>{window.removeEventListener("storage",Fe),window.removeEventListener("tenderDocumentRestored",De)}},[e,o,r,s]);const Os=()=>{if(!fe||fe.length===0)return 0;const je=fe.reduce((Fe,De)=>Fe+(De.totalPrice||0),0);return console.log(" INSTANT: Reflecting pre-calculated total from items:",je),je},vs=h.useMemo(()=>fe.reduce((je,Fe)=>je+(Fe.totalPrice||0),0),[fe]),Z=h.useMemo(()=>vs*.15,[vs]),v=h.useMemo(()=>vs+Z,[vs,Z]);h.useEffect(()=>{const je=setTimeout(async()=>{if(Object.keys(q).some(Fe=>q[Fe]))try{await Ke.setPendingData(`tenderFormData_${e||"new"}`,q),console.log(" Debounced auto-saved form data")}catch(Fe){console.error("Auto-save form data failed:",Fe)}},3e3);return()=>clearTimeout(je)},[q,e]),h.useEffect(()=>{if(v>=0&&(B(je=>({...je,estimatedValue:v.toString()})),e&&e!=="new")){const Fe=setTimeout(async()=>{try{console.log(" REAL-TIME SYNC: Updating estimatedValue in Firebase:",v),await dn.update(e,{estimatedValue:v}),console.log(" REAL-TIME SYNC: estimatedValue updated successfully")}catch(De){console.error(" REAL-TIME SYNC failed:",De)}},500);return()=>clearTimeout(Fe)}},[v,e]);const se=()=>{Q(!A)},re=async je=>{const{name:Fe,value:De,type:Ze,checked:at}=je.target,dt={...q,[Fe]:Ze==="checkbox"?at:De};B(dt);try{const ot=e?`tenderFormData_${e}`:"tenderFormData_new";await Ke.setPendingData(ot,dt),console.log(` Form data saved for field: ${Fe}`)}catch(ot){console.error("Error saving form data:",ot)}$[Fe]&&H(ot=>({...ot,[Fe]:""}))},J=async je=>{je.preventDefault();const Fe=tn.validateTenderData({...q,submissionDeadline:q.submissionDeadline?new Date(q.submissionDeadline):null});if(Object.keys(Fe).length>0){H(Fe);return}G(!0),H({});try{const De=await Bn.validateUniqueFields({referenceNumber:q.referenceNumber},p?e:null,"tenders");if(Object.keys(De).length>0){H(De),G(!1);return}const Ze=fe.reduce((ot,Je)=>ot+(Je.totalPrice||0),0),at={...q,submissionDeadline:q.submissionDeadline?new Date(q.submissionDeadline):null,estimatedValue:v,documents:b,items:fe||[]};console.log(" Saving complete tender data to Firebase with grand total (incl. VAT):",{title:at.title,estimatedValue:v,documentsCount:(at.documents||[]).length,itemsCount:(at.items||[]).length});let dt;if(p){dt=await dn.updateTenderCollaborative(e,at),fe&&fe.length>0&&(await xe(fe),console.log(" Tender items saved via shared service for real-time sync"));const ot=r();await s("task",`${ot.name}  `,`  : ${at.entity}`),await Ke.clearPendingData(`tenderFormData_${e}`),await Ke.clearPendingData(`tenderDocuments_${e}`),await Ke.clearPendingData(`pendingTenderItems_${e}`),o("   "," ")}else{if(dt=await dn.createTender(at),dt&&fe&&fe.length>0){const Je=dt.id||dt;await _r.saveTenderItems(Je,fe),console.log(" New tender items saved via shared service:",Je)}const ot=r();await s("task",`${ot.name}  `,`  : ${at.entity}`),await Ke.clearPendingData("tenderFormData_new"),await Ke.clearPendingData("tenderDocuments_new"),await Ke.clearPendingData("pendingTenderItems_new"),await Ke.clearPendingData("tender_success_shown_new"),o("   "," ")}setTimeout(()=>{n("/tenders/list")},1500)}catch(De){H({submit:De.message}),l("   ","  ")}finally{G(!1)}},he=async()=>{try{p||(console.log(" CANCEL: Clearing all pending data for cancelled new tender"),await Ke.clearPendingData("tenderFormData_new"),await Ke.clearPendingData("tenderDocuments_new"),await Ke.clearPendingData("pendingTenderItems_new"),await Ke.clearPendingData("tender_success_shown_new"),console.log(" CANCEL: All pending data cleared successfully"))}catch(je){console.error("Error clearing pending data on cancel:",je)}n("/tenders/list")},Se=()=>{Y(!0)},me=()=>{Y(!1),O("")},ge=je=>{try{switch(console.log("Selected item type:",je),je){case"raw-materials":const Fe=`/tenders/raw-materials/${e||"new"}`;console.log("Navigating to:",Fe),n(Fe);break;case"local-product":const De=`/tenders/local-products/${e||"new"}`;console.log("Navigating to local products:",De),n(De);break;case"imported-product":const Ze=`/tenders/foreign-products/${e||"new"}`;console.log("Navigating to foreign products:",Ze),n(Ze);break;case"manufactured-product":const at=`/tenders/manufactured-products/${e||"new"}`;console.log("Navigating to manufactured products:",at),n(at);break;case"services":const dt=`/tenders/services/${e||"new"}`;console.log("Navigating to services:",dt),n(dt);break;default:console.log("Unknown item type:",je),l("   ","")}}catch(Fe){console.error("Error handling item type selection:",Fe),l("    ","")}},ke=(je,Fe)=>{const De=je.materialName||je.name||"  ";c(`      

${De}`,()=>Ie(je,Fe),"  ")},Ie=async(je,Fe)=>{try{ne(!0),cs.current=!0,console.log(" Starting deletion process:",{itemName:je.materialName||je.name,itemId:je.internalId||je.materialInternalId,isDeletingFlag:cs.current});const De={...je,tenderContext:{tenderId:e||"new",tenderTitle:q.title||" ",addedAt:new Date().toISOString()}};console.log(" CALLING SimpleTrashService.moveToTrash with:",De);const Ze=await bs.moveToTrash(De,"tenderItems");if(console.log(" Successfully moved to trash with result:",Ze),e){const ot=ye.filter((ft,Dt)=>Dt!==Fe);console.log(" EXISTING TENDER: Updating hook data, new count:",ot.length),xe&&await xe(ot),Re(ot);const Je=ot.reduce((ft,Dt)=>ft+(Dt.totalPrice||0),0);B(ft=>({...ft,estimatedValue:Je.toString()}))}else Re(ot=>{const Je=ot.filter((Dt,gt)=>gt!==Fe),ft=Je.reduce((Dt,gt)=>Dt+(gt.totalPrice||0),0);return B(Dt=>({...Dt,estimatedValue:ft.toString()})),console.log(" NEW TENDER: Item removed from list, new count:",Je.length),Je});setTimeout(()=>{cs.current=!1,console.log(" Deletion flag cleared, auto-save can resume")},5e3);const at=r(),dt=je.materialName||je.name||"  ";s("task",`${at.name}   `,`  : ${dt}`),o(`   : ${dt}`,"  ")}catch(De){console.error(" Error moving tender item to trash:",De),l(`    : ${De.message}`,"  "),cs.current=!1}finally{ne(!1)}},oe=(je,Fe)=>{bt({...je}),ns(Fe),tt(!0)},Te=(je,Fe)=>{const De=Math.max(0,parseFloat(Fe)||0);bt(Ze=>({...Ze,quantity:Number(De.toFixed(1)),totalPrice:(Ze.unitPrice||0)*Number(De.toFixed(1))}))},Ne=()=>{At!==null&&rt&&(Re(e?ye.map((je,Fe)=>Fe===At?rt:je):je=>je.map((Fe,De)=>De===At?rt:Fe)),tt(!1),bt(null),ns(null),o("    "," "))},we=()=>{tt(!1),bt(null),ns(null)},_e=()=>Math.round((rt==null?void 0:rt.totalPrice)||0),Ge=async je=>{const Fe=je.target.files[0];if(Fe){P(!0);try{try{Ss.validateFile(Fe,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]})}catch(Ze){throw new Error(Ze.message)}console.log(" Uploading document:",Fe.name);const De=await Ss.uploadFile(Fe,"tender-documents");w({...De,originalFileName:Fe.name,fileSize:Fe.size,fileType:Fe.type}),ie(Fe.name.split(".")[0]),C(!0),je.target.value=""}catch(De){console.error("Error uploading document:",De),l(De.message||"   ","  "),je.target&&(je.target.value="")}finally{P(!1)}}},mt=async()=>{if(!W.trim()){l("   ","  ");return}if(!U){l("   ","");return}try{P(!0),console.log(" Creating document with Firebase database storage:",W);const je={id:Date.now().toString(),fileName:W.trim(),originalFileName:U.originalFileName,fileURL:U.url,storagePath:U.path,fileSize:U.fileSize,fileType:U.fileType,uploadedAt:new Date().toISOString(),uploadDate:new Date().toISOString(),tenderId:e||"new",tenderTitle:q.title||" ",tenderReferenceNumber:q.referenceNumber||" "};if(console.log(" ADDING DOCUMENT:",je.fileName,"to",b.length+1,"total documents"),N(De=>[...De,je]),e&&e!=="new")try{console.log(" FIREBASE-ONLY: Saving document directly to Firebase tender:",e);const De=[...b,je];await dn.updateTenderDocuments(e,De),console.log(" FIREBASE-ONLY: Document saved directly to Firebase successfully")}catch(De){console.error(" FIREBASE-ONLY: Failed to save document to Firebase:",De),N(Ze=>Ze.filter(at=>at.id!==je.id)),l("      ","  ");return}else console.log(" FIREBASE-ONLY: Document stored locally for new tender, will be saved when tender is created");o(`   : ${W}`," ");const Fe=r();s("file",`${Fe.name}  `,`  : ${W}`),C(!1),w(null),ie("")}catch(je){console.error("Error saving document:",je),l(`   : ${je.message}`,"  ")}finally{P(!1)}},pt=()=>{console.log("User cancelled file upload"),C(!1),w(null),ie("")},Ye=je=>{c(`      

${je.fileName}`,()=>Yt(je),"  ")},Yt=async je=>{try{ne(!0),await bs.moveToTrash(je,"tender_documents");const Fe=b.filter(Ze=>Ze.id!==je.id);if(N(Fe),e&&e!=="new")try{console.log(" FIREBASE-ONLY DELETE: Updating documents directly in Firebase"),await dn.updateTenderDocuments(e,Fe),console.log(" FIREBASE-ONLY DELETE: Documents updated in Firebase successfully")}catch(Ze){console.error(" FIREBASE-ONLY DELETE: Failed to update Firebase:",Ze),N(at=>[...at,je]),l("      ","  ");return}else console.log(" FIREBASE-ONLY DELETE: Document removed from local state for new tender");const De=r();s("task",`${De.name}  `,`  : ${je.fileName}`),o(`   : ${je.fileName}`,"  ")}catch(Fe){l(`    : ${Fe.message}`,"  ")}finally{ne(!1)}};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`page-wrapper ${A?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:se}),t.jsxs("div",{className:"main-container",style:{paddingRight:A?"72px":"250px",paddingLeft:A||!d?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:A?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:A})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsx("a",{href:"/tenders/list",className:"text-decoration-none text-primary",children:""})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:p?" ":"  "})]})}),t.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsx("div",{className:"d-flex align-items-center",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:`bi ${p?"bi-pencil-square":"bi-plus-circle-fill"} text-primary me-2`}),p?" ":"  "]})}),t.jsxs("div",{className:"d-flex gap-2",style:{pointerEvents:"auto",zIndex:1e3},children:[t.jsx("button",{type:"button",className:"btn btn-primary",onClick:je=>{console.log(" FIRST BUTTON ( ) CLICKED!",je),Se()},disabled:te,style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:" "}),t.jsx("button",{type:"button",className:"btn btn-secondary document-modal-button",id:"document-modal-btn",onClick:je=>{console.log(" BUTTON CLICKED!",je),console.log(" About to set showDocumentsModal to true..."),k(!0),console.log(" setShowDocumentsModal(true) called")},onMouseDown:je=>console.log(" MOUSE DOWN on button"),onMouseUp:je=>console.log(" MOUSE UP on button"),style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap",zIndex:9999,pointerEvents:"auto",position:"relative"},children:" "})]})]})}),S&&t.jsx("div",{className:"alert alert-warning border-0 rounded-0 mb-0",style:{background:"linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%)"},children:t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-eye text-warning me-2",style:{fontSize:"18px"}}),t.jsx("strong",{children:"  :"}),t.jsxs("span",{className:"ms-2",children:[!L&&p&&"    ",!j&&!p&&"     ",f&&"     "]})]})}),t.jsx("div",{className:"card-body",children:F?t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:t.jsx(It,{size:"large"})}):t.jsxs("form",{onSubmit:J,children:[$.submit&&t.jsxs("div",{className:"alert alert-danger",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),$.submit]}),y&&!D&&t.jsxs("div",{className:"alert alert-info",children:[t.jsx("i",{className:"bi bi-info-circle me-2"}),"               "]}),(!T||!x)&&t.jsxs("div",{className:"alert alert-warning",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),!T&&!x?"           ":T?"        ":"        "]}),t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-8 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"text",className:`form-control ${$.title?"is-invalid":""}`,name:"title",value:q.title,onChange:re,placeholder:"  ",disabled:te,readOnly:y}),$.title&&t.jsx("div",{className:"invalid-feedback",children:$.title})]}),t.jsxs("div",{className:"col-md-4 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"text",className:`form-control ${$.referenceNumber?"is-invalid":""}`,name:"referenceNumber",value:q.referenceNumber,onChange:re,placeholder:" ",disabled:te,readOnly:y}),$.referenceNumber&&t.jsx("div",{className:"invalid-feedback",children:$.referenceNumber})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"text",className:`form-control ${$.entity?"is-invalid":""}`,name:"entity",value:q.entity,onChange:re,placeholder:"  ",disabled:te,readOnly:y}),$.entity&&t.jsx("div",{className:"invalid-feedback",children:$.entity})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"   *"}),t.jsx("input",{type:"date",className:`form-control ${$.submissionDeadline?"is-invalid":""}`,name:"submissionDeadline",value:q.submissionDeadline,onChange:re,disabled:te,readOnly:y,required:!0}),$.submissionDeadline&&t.jsx("div",{className:"invalid-feedback",children:$.submissionDeadline})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsxs("label",{className:"form-label",children:[" ",t.jsx("small",{className:"text-muted ms-2",children:"(   )"})]}),t.jsxs("div",{className:"input-group",children:[t.jsx("input",{type:"text",className:"form-control bg-light",name:"estimatedValue",value:(()=>{const je=parseFloat(q.estimatedValue)||0;return je>0?`${je.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})} `:"0.0 "})(),readOnly:!0,placeholder:"    ",style:{backgroundColor:"#f8f9fa",fontWeight:"bold",color:"#198754"}}),t.jsx("span",{className:"input-group-text bg-light text-success",children:t.jsx("i",{className:"bi bi-calculator"})})]})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"   *"}),t.jsxs("div",{className:"input-group",children:[t.jsx("input",{type:"number",className:`form-control ${$.documentPrice?"is-invalid":""}`,name:"documentPrice",value:q.documentPrice,onChange:re,placeholder:"0",min:"0",step:"0.01",disabled:te}),t.jsx("span",{className:"input-group-text",children:"."})]}),$.documentPrice&&t.jsx("div",{className:"invalid-feedback",children:$.documentPrice})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:""}),t.jsx(rc,{name:"location",value:q.location,onChange:re,placeholder:"   ",disabled:te,required:!1})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:" "}),t.jsx("input",{type:"text",className:"form-control",name:"contactPerson",value:q.contactPerson,onChange:re,placeholder:"  ",disabled:te})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:" "}),t.jsx("input",{type:"tel",className:"form-control",name:"contactPhone",value:q.contactPhone,onChange:re,placeholder:" ",disabled:te})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:" "}),t.jsx("input",{type:"email",className:"form-control",name:"contactEmail",value:q.contactEmail,onChange:re,placeholder:" ",disabled:te})]}),t.jsxs("div",{className:"col-md-12 mb-3",children:[t.jsx("label",{className:"form-label",children:" "}),t.jsx("textarea",{className:"form-control",name:"description",value:q.description,onChange:re,rows:"4",placeholder:"   ...",disabled:te})]}),t.jsx("div",{className:"col-md-12 mb-4",children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-light",children:t.jsx("div",{className:"d-flex justify-content-between align-items-center",children:t.jsxs("h6",{className:"mb-0 fw-bold text-primary",children:[t.jsx("i",{className:"bi bi-list-task me-2"}),"  (",fe.length,")",fe.length===0&&t.jsx("span",{className:"text-danger",children:"-   "}),e&&pe&&t.jsx("span",{className:"text-info ms-2",children:"-  ..."}),e&&be&&t.jsx("span",{className:"text-danger ms-2",children:"-   "})]})})}),t.jsxs("div",{className:"card-body p-0",children:[Ve&&t.jsx("div",{className:"alert alert-warning mx-3 mt-3",role:"alert",children:Ve}),t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",style:{width:"60px"},children:""})]})}),t.jsx("tbody",{children:fe&&fe.length>0?fe.map((je,Fe)=>{let De=je.materialName||je.name||"  ";De&&De.toString().startsWith("rm_")&&(De="  ");const Ze=je.materialUnit||je.unit||"",at=je.totalPrice||0,dt=je.internalId;return t.jsxs("tr",{style:{backgroundColor:Fe%2===0?"#ffffff":"#f8f9fa"},children:[t.jsx("td",{className:"text-center fw-bold text-muted",children:Fe+1}),t.jsx("td",{className:"text-center fw-medium",children:t.jsx("div",{children:t.jsx("button",{className:"btn btn-link p-0 fw-medium text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:async ot=>{ot.preventDefault(),ot.stopPropagation();try{console.log("=== DETAILED DEBUGGING ==="),console.log("Full item object:",JSON.stringify(je,null,2)),console.log("All item keys:",Object.keys(je));const Je=je.materialInternalId,ft=je.materialType||"rawMaterial";console.log("Searching for:"),console.log("- materialInternalId:",Je),console.log("- materialType:",ft);let Dt=null,gt=[];if(ft==="rawMaterial"){console.log("Loading raw material...");const{RawMaterialService:us}=await Xe(async()=>{const{RawMaterialService:Gt}=await Promise.resolve().then(()=>dd);return{RawMaterialService:Gt}},void 0);let jt=await us.getRawMaterialByInternalId(Je);if(!jt)try{jt=await us.getRawMaterialById(Je)}catch{console.log("Could not find material by Firebase ID, trying name fallback...")}if(!jt){console.log("Using name fallback - loading all raw materials...");const Gt=await us.getAllRawMaterials(),pn=je.materialName||je.name;jt=Gt.find(Jn=>Jn.name===pn)}console.log("Found raw material:",jt?"YES":"NO"),jt&&(console.log("Material details:",{id:jt.id,internalId:jt.internalId,name:jt.name}),Dt=jt.id,n(`/raw-materials/edit/${Dt}`))}else if(ft==="localProduct"){console.log("Loading local product...");const{LocalProductService:us}=await Xe(async()=>{const{LocalProductService:Gt}=await Promise.resolve().then(()=>ud);return{LocalProductService:Gt}},void 0);let jt=await us.getLocalProductByInternalId(Je);if(!jt)try{jt=await us.getLocalProductById(Je)}catch{console.log("Could not find product by Firebase ID, trying name fallback...")}if(!jt){console.log("Using name fallback - loading all local products...");const Gt=await us.getAllLocalProducts(),pn=je.materialName||je.name;jt=Gt.find(Jn=>Jn.name===pn)}console.log("Found local product:",jt?"YES":"NO"),jt&&(console.log("Product details:",{id:jt.id,internalId:jt.internalId,name:jt.name}),Dt=jt.id,n(`/local-products/edit/${Dt}`))}else if(ft==="foreignProduct"){console.log("Loading foreign product...");const{ForeignProductService:us}=await Xe(async()=>{const{ForeignProductService:Gt}=await Promise.resolve().then(()=>hd);return{ForeignProductService:Gt}},void 0);let jt=await us.getForeignProductByInternalId(Je);if(!jt)try{jt=await us.getForeignProductById(Je)}catch{console.log("Could not find product by Firebase ID, trying name fallback...")}if(!jt){console.log("Using name fallback - loading all foreign products...");const Gt=await us.getAllForeignProducts(),pn=je.materialName||je.name;jt=Gt.find(Jn=>Jn.name===pn)}console.log("Found foreign product:",jt?"YES":"NO"),jt&&(console.log("Product details:",{id:jt.id,internalId:jt.internalId,name:jt.name}),Dt=jt.id,n(`/foreign-products/edit/${Dt}`))}else if(ft==="manufacturedProduct"){console.log("Loading manufactured products...");const{ManufacturedProductService:us}=await Xe(async()=>{const{ManufacturedProductService:Gt}=await Promise.resolve().then(()=>Li);return{ManufacturedProductService:Gt}},void 0);gt=await us.getAllManufacturedProducts(),console.log("Total manufactured products loaded:",gt.length),console.log("Sample manufactured product IDs:",gt.slice(0,3).map(Gt=>({id:Gt.id,internalId:Gt.internalId,title:Gt.title})));let jt=gt.find(Gt=>Gt.internalId===Je);jt||(jt=gt.find(Gt=>Gt.id===Je)),jt||(jt=gt.find(Gt=>Gt.title===je.materialName)),console.log("Found manufactured product:",jt?"YES":"NO"),jt&&(console.log("Product details:",{id:jt.id,internalId:jt.internalId,title:jt.title}),Dt=jt.id,n(`/manufactured-products/edit/${Dt}`))}else if(ft==="service"){console.log("Loading services...");const{ServiceService:us}=await Xe(async()=>{const{ServiceService:Gt}=await Promise.resolve().then(()=>z0);return{ServiceService:Gt}},void 0);gt=await us.getAllServices(),console.log("Total services loaded:",gt.length),console.log("Sample service IDs:",gt.slice(0,3).map(Gt=>({id:Gt.id,internalId:Gt.internalId,name:Gt.name})));let jt=gt.find(Gt=>Gt.internalId===Je);jt||(jt=gt.find(Gt=>Gt.id===Je)),jt||(jt=gt.find(Gt=>Gt.name===je.materialName)),console.log("Found service:",jt?"YES":"NO"),jt&&(console.log("Service details:",{id:jt.id,internalId:jt.internalId,name:jt.name}),Dt=jt.id,n(`/services/edit/${Dt}`))}Dt||(console.error("=== SEARCH FAILED ==="),console.error("Could not find Firebase ID for:",Je),console.error("Available items in this category:",gt.map(us=>({id:us.id,internalId:us.internalId,name:us.name}))),alert(`     
ID: ${Je}
Type: ${ft}`))}catch(Je){console.error("=== NAVIGATION ERROR ===",Je),alert("     ")}},title:`: ${De}`,children:De})})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"badge bg-primary",children:je.quantity||1})}),t.jsx("td",{className:"text-center",children:Ze}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{children:[t.jsxs("span",{className:"text-success fw-bold",children:[at.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," ."]}),je.unitPrice&&t.jsx("div",{children:t.jsxs("small",{className:"text-muted",children:[je.unitPrice.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1}),"  ",je.quantity.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})]})})]})}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"btn-group btn-group-sm",style:{marginLeft:"20px"},children:[t.jsx("button",{className:"btn btn-outline-primary",type:"button",onClick:ot=>{ot.preventDefault(),ot.stopPropagation(),oe(je,Fe)},disabled:!T,title:T?"":"     ",children:t.jsx("i",{className:"bi bi-pencil"})}),t.jsx("button",{className:"btn btn-outline-danger",type:"button",onClick:ot=>{ot.preventDefault(),ot.stopPropagation(),ke(je,Fe)},title:x?"":"     ",disabled:de||!x,children:t.jsx("i",{className:"bi bi-trash"})})]})})]},dt||`item-${Fe}`)}):t.jsx("tr",{children:t.jsx("td",{colSpan:"6",className:"text-center py-4 text-muted",children:"    "})})}),t.jsxs("tfoot",{className:"table-light",children:[t.jsxs("tr",{children:[t.jsx("th",{colSpan:"4",className:"text-end",children:" :"}),t.jsxs("th",{className:"text-center text-primary fw-bold",children:[Os().toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," ."]}),t.jsx("th",{})]}),t.jsxs("tr",{children:[t.jsx("th",{colSpan:"4",className:"text-end",children:"   (%15):"}),t.jsxs("th",{className:"text-center text-success fw-bold",children:[Z.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," ."]}),t.jsx("th",{})]}),t.jsxs("tr",{className:"table-warning",children:[t.jsx("th",{colSpan:"4",className:"text-end",children:" :"}),t.jsxs("th",{className:"text-center fw-bold",style:{color:"#000000"},children:[v.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," ."]}),t.jsx("th",{})]})]})]})})]})]})})]}),t.jsx("div",{className:"row",children:t.jsxs("div",{className:"col-12 d-flex justify-content-center gap-3 mt-4",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",style:{height:"32px",minWidth:"80px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},onClick:he,disabled:te,children:""}),t.jsx("button",{type:"submit",className:"btn btn-primary",style:{height:"32px",minWidth:"80px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},disabled:S||te,title:S?"   ":"",children:te?t.jsxs(t.Fragment,{children:[t.jsx(It,{size:"small"}),t.jsx("span",{className:"ms-2",children:p?"...":"..."})]}):p?"":""})]})})]})})]})})}),!A&&d&&t.jsx(h.Suspense,{fallback:t.jsx("div",{className:"d-flex justify-content-center p-3",children:t.jsx(It,{size:"small"})}),children:t.jsx(SU,{rtl:!0})}),!A&&d&&t.jsx(h.Suspense,{fallback:t.jsx("div",{className:"d-flex justify-content-center p-2",children:t.jsx(It,{size:"small"})}),children:t.jsx(EU,{})})]})]}),ze&&rt&&t.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.8)",zIndex:99980},children:t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:we,"aria-label":"Close"})]}),t.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"30%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),t.jsx("tbody",{children:t.jsxs("tr",{style:{height:"60px"},children:[t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:"bi bi-layers text-danger me-2"}),t.jsxs("div",{children:[t.jsx("div",{className:"fw-bold text-primary",children:rt.materialName||rt.name}),t.jsx("small",{className:"text-muted",children:rt.materialCategory||rt.category})]})]})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("span",{className:"fw-bold text-success",children:[Math.round(rt.unitPrice)," "]}),t.jsx("div",{children:t.jsxs("small",{className:"text-muted",children:["/",rt.materialUnit||rt.unit||""]})})]}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:je=>{je.preventDefault(),je.stopPropagation(),Te(rt.internalId,Math.max(0,Number((rt.quantity-.1).toFixed(1))))},disabled:rt.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-dash"})}),t.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:rt.quantity,min:"0",step:"any",onChange:je=>{je.preventDefault(),je.stopPropagation(),Te(rt.internalId,je.target.value)},onBlur:je=>{je.preventDefault(),je.stopPropagation();const Fe=Number(je.target.value||0).toFixed(1);Te(rt.internalId,Fe)}}),t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:je=>{je.preventDefault(),je.stopPropagation(),Te(rt.internalId,Number((rt.quantity+.1).toFixed(1)))},style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-plus"})})]})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"text-muted",children:rt.displaySupplier||rt.supplierInfo||"-"})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(rt.totalPrice)," "]}),t.jsxs("small",{className:"text-success",children:["(",rt.quantity.toFixed(1),"  ",Math.round(rt.unitPrice),")"]})]})]},rt.internalId)})]})})}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:t.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("span",{className:"text-muted me-3",children:" :"}),t.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[_e()," "]}),t.jsxs("span",{className:"badge bg-info ms-2",children:[rt.quantity.toFixed(1)," "]})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:we,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:je=>{je.preventDefault(),je.stopPropagation(),Ne()},style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})]})})]})})}),t.jsx(Mt,{show:i.show,onClose:a,title:i.title,message:i.message,type:i.type,onConfirm:i.onConfirm,confirmText:i.confirmText,cancelText:i.cancelText,showCancel:i.showCancel}),t.jsx(h.Suspense,{fallback:null,children:t.jsx(CU,{show:ue,onClose:me,onItemSelect:ge,selectedItemType:z,setSelectedItemType:O})}),(console.log(" MODAL RENDER: showDocumentsModal =",E,"documents.length =",b.length),null),t.jsx(Td,{show:E,onClose:()=>{console.log(" Modal onClose triggered"),k(!1)},documents:b,setDocuments:N,tenderId:e||"new",uploadingDocument:I,setUploadingDocument:P,handleDocumentUpload:Ge,handleDeleteClick:Ye,deleting:de}),_&&t.jsx("div",{className:"modal show d-block",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.9)",zIndex:99985},tabIndex:"-1",dir:"rtl",children:t.jsx("div",{className:"modal-dialog modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsx("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"12px 12px 0 0"},children:t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-pencil-square me-2"})," "]})}),t.jsx("div",{className:"modal-body",style:{padding:"25px"},children:t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"d-flex align-items-center mb-3",children:[t.jsx("div",{className:"bg-success bg-opacity-10 p-2 rounded-circle me-3",children:t.jsx("i",{className:"bi bi-file-earmark-check text-success"})}),t.jsxs("div",{children:[t.jsx("h6",{className:"mb-0 fw-bold text-success",children:"   "}),t.jsx("small",{className:"text-muted",children:U==null?void 0:U.originalFileName})]})]}),t.jsxs("div",{className:"mb-3",children:[t.jsxs("label",{className:"form-label fw-bold text-primary",children:[t.jsx("i",{className:"bi bi-tag me-1"}),"   *"]}),t.jsx("input",{type:"text",className:"form-control",value:W,onChange:je=>ie(je.target.value),placeholder:"   ",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:je=>{je.target.style.borderColor="#28a745",je.target.style.boxShadow="0 0 0 0.2rem rgba(40, 167, 69, 0.25)"},onBlur:je=>{je.target.style.borderColor="#e9ecef",je.target.style.boxShadow="none"},autoFocus:!0}),t.jsxs("small",{className:"text-muted",children:[t.jsx("i",{className:"bi bi-info-circle me-1"}),"        "]})]})]})}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:t.jsxs("div",{className:"d-flex justify-content-end",style:{gap:"12px"},children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:pt,style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500"},children:""}),t.jsxs("button",{type:"button",className:"btn btn-success",onClick:mt,disabled:!W.trim(),style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500",opacity:W.trim()?1:.6},children:[t.jsx("i",{className:"bi bi-check-lg me-1"}),""]})]})})]})})})]})})}function Fj(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(IU,{})})})}const TU=()=>{const[n,e]=h.useState({isDragging:!1,draggedItem:null,draggedFrom:null,dragOverTarget:null}),s=h.useRef(null);h.useRef(null);const r=h.useCallback(()=>{e({isDragging:!1,draggedItem:null,draggedFrom:null,dragOverTarget:null})},[]),i=h.useCallback((d,u,f)=>{try{console.log(" [DRAG START] Item:",(u==null?void 0:u.title)||(u==null?void 0:u.id),"Source:",f),d.dataTransfer.effectAllowed="move",d.dataTransfer.setData("text/plain",JSON.stringify({item:u,source:f})),e({isDragging:!0,draggedItem:u,draggedFrom:f,dragOverTarget:null}),s.current=d.currentTarget}catch(p){console.error(" [DRAG START ERROR]:",p),r()}},[r]),a=h.useCallback(d=>{console.log(" [DRAG END]"),s.current=null,setTimeout(()=>{r()},50)},[r]),o=h.useCallback((d,u)=>{d.preventDefault(),d.dataTransfer.dropEffect="move",e(f=>({...f,dragOverTarget:u}))},[]),l=h.useCallback(d=>{const u=d.relatedTarget;d.currentTarget.contains(u)||e(p=>({...p,dragOverTarget:null}))},[]),c=h.useCallback((d,u,f)=>{d.preventDefault(),console.log(" [DROP] Target:",u);try{const p=d.dataTransfer.getData("text/plain");let j=null;try{j=JSON.parse(p)}catch{j={item:n.draggedItem,source:n.draggedFrom}}if(!j||!j.item){console.error(" [DROP ERROR] No drag data available");return}const{item:L,source:R}=j;if(R===u){console.log(" [DROP CANCELLED] Same source and target");return}console.log(" [DROP SUCCESS] Moving:",(L==null?void 0:L.title)||(L==null?void 0:L.id),"from",R,"to",u),typeof f=="function"&&f(L,R,u)}catch(p){console.error(" [DROP ERROR]:",p)}finally{e(p=>({...p,dragOverTarget:null})),setTimeout(()=>{r()},100)}},[n]);return{dragState:n,handleDragStart:i,handleDragEnd:a,handleDragOver:o,handleDragLeave:l,handleDrop:c,resetDragState:r}};class AU{constructor(){this.collectionName="tender_studies"}async saveTenderStudy(e,s){try{console.log(" TENDER STUDY: Saving study data for tender:",e);const r=Le(ae,this.collectionName,e),i={tenderId:e,profitCalculation:{fixedProfit:s.fixedProfit||0,percentageProfit:s.percentageProfit||0,perItemProfit:s.perItemProfit||0,showPerItemInput:s.showPerItemInput||!1,totalIndividualProfit:s.totalIndividualProfit||0,individualProfitData:s.individualProfitData||"",baseCost:s.baseCost||0,totalProfit:s.totalProfit||0,finalPrice:s.finalPrice||0,profitMargin:s.profitMargin||0},metadata:{lastUpdated:We(),version:"1.0"}};return await yn(r,i,{merge:!0}),console.log(" TENDER STUDY: Study data saved successfully"),{success:!0,id:e}}catch(r){return console.error(" TENDER STUDY: Error saving study data:",r),{success:!1,error:r.message}}}async getTenderStudy(e){try{console.log(" TENDER STUDY: Loading study data for tender:",e);const s=Le(ae,this.collectionName,e),r=await ss(s);if(r.exists()){const i=r.data();return console.log(" TENDER STUDY: Study data loaded successfully"),{success:!0,data:i}}else return console.log(" TENDER STUDY: No study data found, returning defaults"),{success:!0,data:{profitCalculation:{fixedProfit:0,percentageProfit:0,perItemProfit:0,showPerItemInput:!1,totalIndividualProfit:0,individualProfitData:"",baseCost:0,totalProfit:0,finalPrice:0,profitMargin:0}}}}catch(s){return console.error(" TENDER STUDY: Error loading study data:",s),{success:!1,error:s.message}}}async updateProfitCalculation(e,s){try{console.log(" TENDER STUDY: Updating profit calculation for tender:",e);const r=Le(ae,this.collectionName,e);return await Qt(r,{"profitCalculation.fixedProfit":s.fixedProfit||0,"profitCalculation.percentageProfit":s.percentageProfit||0,"profitCalculation.perItemProfit":s.perItemProfit||0,"profitCalculation.showPerItemInput":s.showPerItemInput||!1,"profitCalculation.totalIndividualProfit":s.totalIndividualProfit||0,"profitCalculation.individualProfitData":s.individualProfitData||"","profitCalculation.baseCost":s.baseCost||0,"profitCalculation.totalProfit":s.totalProfit||0,"profitCalculation.finalPrice":s.finalPrice||0,"profitCalculation.profitMargin":s.profitMargin||0,"metadata.lastUpdated":We()}),console.log(" TENDER STUDY: Profit calculation updated successfully"),{success:!0}}catch(r){return console.error(" TENDER STUDY: Error updating profit calculation:",r),{success:!1,error:r.message}}}async getAllTenderStudies(){try{console.log(" TENDER STUDY: Loading all tender studies");const e=Pe(ae,this.collectionName),s=await qe(e),r=[];return s.forEach(i=>{r.push({id:i.id,...i.data()})}),console.log(` TENDER STUDY: Loaded ${r.length} tender studies`),{success:!0,data:r}}catch(e){return console.error(" TENDER STUDY: Error loading all studies:",e),{success:!1,error:e.message}}}async deleteTenderStudy(e){try{console.log(" TENDER STUDY: Deleting study data for tender:",e);const s=Le(ae,this.collectionName,e);return await es(s),console.log(" TENDER STUDY: Study data deleted successfully"),{success:!0}}catch(s){return console.error(" TENDER STUDY: Error deleting study data:",s),{success:!1,error:s.message}}}async tenderStudyExists(e){try{const s=Le(ae,this.collectionName,e);return(await ss(s)).exists()}catch(s){return console.error(" TENDER STUDY: Error checking study existence:",s),!1}}}const Hl=new AU;Number.prototype.toLocaleStringOneDecimal=function(){return this.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})};const qs={PENDING:"pending",IN_PROGRESS:"inProgress",REVIEW:"review",COMPLETED:"completed"},$0={[qs.PENDING]:{title:" ",icon:"bi-search",bgColor:"linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%)",progress:25},[qs.IN_PROGRESS]:{title:" ",icon:"bi-upload",bgColor:"linear-gradient(135deg, #4834d4 0%, #686de0 100%)",progress:50},[qs.REVIEW]:{title:"  ",icon:"bi-envelope-open",bgColor:"linear-gradient(135deg, #f39c12 0%, #e67e22 100%)",progress:75},[qs.COMPLETED]:{title:" ",icon:"bi-award",bgColor:"linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)",progress:100}},_U={[qs.PENDING]:[],[qs.IN_PROGRESS]:[],[qs.REVIEW]:[],[qs.COMPLETED]:[]},RU=n=>{switch(n){case"high":return"#dc3545";case"medium":return"#ffc107";case"low":return"#28a745";default:return"#6c757d"}},Oj=n=>{switch(n){case"high":return"";case"medium":return"";case"low":return"";default:return" "}},Mj=n=>{const e=parseFloat(n)||0;return e>75e4?"high":e>=4e5?"medium":"low"},DU=n=>{console.log(` useRealTimeTenderValues HOOK CALLED FOR TENDER: ${n.id||"NO_ID"}`);const[e,s]=h.useState({estimatedValue:n.estimatedValue||0,grandTotal:n.grandTotal||0,sellingPriceWithProfit:0,tax:n.tax||0,vat:n.vat||0,title:n.title||"",entity:n.entity||"",description:n.description||"",referenceNumber:n.referenceNumber||"",submissionDeadline:n.submissionDeadline||n.deadline||n.submissionDate||n.endDate,category:n.category||"",location:n.location||"",contactPerson:n.contactPerson||"",contactPhone:n.contactPhone||"",contactEmail:n.contactEmail||"",lastUpdated:n.updatedAt||n.createdAt||new Date});return h.useEffect(()=>{const r=async()=>{var a,o;if(n.id){console.log(` UPDATE REAL-TIME VALUES CALLED FOR TENDER ${n.id}`);try{const{default:l}=await Xe(async()=>{const{default:d}=await Promise.resolve().then(()=>jU);return{default:d}},void 0);console.log(` BEFORE TENDER DATA FETCH - TENDER ${n.id}`);const c=await l.getTenderWithItems(n.id,!1);if(console.log(" AFTER TENDER DATA FETCH - RESULT:",c),console.log(" CHECKING TENDER DATA CONDITION:",{hasTenderData:!!c,tenderDataKeys:c?Object.keys(c):"no data",hasItems:!!(c&&c.items),itemsCount:((a=c==null?void 0:c.items)==null?void 0:a.length)||0,tenderDataValue:c}),c&&c.id){console.log(" TENDER DATA FOUND - PROCEEDING TO FIRESTORE FETCH"),console.log(" TENDER DATA STRUCTURE:",c),console.log(" TENDER ITEMS COUNT:",((o=c.items)==null?void 0:o.length)||0);const d=c,f=(c.items||[]).reduce((y,T)=>y+(parseFloat(T.totalPrice)||0),0),p=f>0?f:parseFloat(d.estimatedValue||0),j=parseFloat(d.tax||0),L=parseFloat(d.vat||0),R=p+j+L;let D=0;try{const y=await Hl.getTenderStudy(n.id);y.success&&y.data&&y.data.profitCalculation&&(D=parseFloat(y.data.profitCalculation.finalPrice||0))}catch(y){console.error(" FIRESTORE ERROR:",y)}s({estimatedValue:f>0?f:d.estimatedValue||0,grandTotal:R,sellingPriceWithProfit:D,tax:j,vat:L,title:d.title||n.title||"",entity:d.entity||n.entity||"",description:d.description||n.description||"",referenceNumber:d.referenceNumber||n.referenceNumber||"",submissionDeadline:d.submissionDeadline||d.deadline||d.submissionDate||d.endDate||n.submissionDeadline,category:d.category||n.category||"",location:d.location||n.location||"",contactPerson:d.contactPerson||n.contactPerson||"",contactPhone:d.contactPhone||n.contactPhone||"",contactEmail:d.contactEmail||n.contactEmail||"",lastUpdated:d.updatedAt||d.createdAt||new Date})}else console.error(" NO TENDER DATA FOUND OR INVALID STRUCTURE:",{tenderData:c,hasTenderId:!!(c&&c.id),keys:c?Object.keys(c):"no data"})}catch(l){console.error(" ERROR IN TENDER DATA FETCH:",l),console.warn("Warning: Could not fetch real-time tender data:",l)}}};r();const i=setInterval(r,3e4);return()=>clearInterval(i)},[]),e},z1=h.memo(({tender:n,stage:e,onDragStart:s,onDragEnd:r,isDragging:i,navigate:a})=>{const o=DU(n),l=n.isSelectedTender,c=`kanban-card ${i?"kanban-card--dragging":""} ${l?"kanban-card--selected":""}`,d=f=>{i||(e===qs.PENDING||e===qs.IN_PROGRESS?(f.preventDefault(),f.stopPropagation(),a(`/tender-study/${n.id}`,{state:{tender:n,fromTracking:!0,readOnly:e===qs.IN_PROGRESS}})):e===qs.REVIEW?(f.preventDefault(),f.stopPropagation(),a(`/tender-result?tenderId=${n.id}`,{state:{tender:n,fromTracking:!0}})):e===qs.COMPLETED&&(f.preventDefault(),f.stopPropagation(),a(`/awarding-stage?tenderId=${n.id}`,{state:{tender:n,fromTracking:!0}})))},u=e===qs.PENDING||e===qs.IN_PROGRESS||e===qs.REVIEW||e===qs.COMPLETED;return t.jsxs("div",{className:c,draggable:!0,onDragStart:f=>s(f,n,e),onDragEnd:r,onClick:d,"data-testid":`kanban-card-${n.id}`,role:"button",tabIndex:0,"aria-label":`${n.title} - ${Oj(Mj(n.estimatedValue))} priority`,style:{...l?{border:"2px solid #007bff",boxShadow:"0 4px 12px rgba(0,123,255,0.3)",background:"linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%)",position:"relative"}:{},cursor:u?"pointer":"grab",transition:"all 0.2s ease"},children:[l&&t.jsxs("div",{className:"position-absolute top-0 start-0",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",color:"white",fontSize:"10px",fontWeight:"bold",padding:"2px 6px",borderRadius:"0 0 8px 0",zIndex:10},children:[t.jsx("i",{className:"bi bi-check-circle me-1"}),""]}),t.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[t.jsxs("h6",{className:"card-title mb-0",style:{fontSize:"14px",fontWeight:"bold",color:"#333"},children:[" ",o.entity]}),(()=>{const f=Mj(o.estimatedValue);return t.jsx("span",{className:`badge priority-badge priority-badge--${f}`,style:{backgroundColor:RU(f)},children:Oj(f)})})()]}),t.jsxs("div",{className:"card-info mb-2",style:{fontSize:"13px",color:"#555",fontWeight:"500"},children:[t.jsx("i",{className:"bi bi-file-text me-1"}),o.title]}),t.jsxs("div",{className:"card-info mb-2",style:{fontSize:"12px",color:"#666"},children:[t.jsx("i",{className:"bi bi-calendar-event me-1"}),t.jsx("span",{style:{fontWeight:"500"},children:"  : "}),(()=>{try{const f=o.submissionDeadline,p=n.submissionDeadline||n.deadline||n.submissionDate||n.endDate;if(!f)return" ";let j=f;if(f&&typeof f=="object"&&f.seconds?j=new Date(f.seconds*1e3):j=new Date(f),isNaN(j.getTime()))return" ";const L=j.toLocaleDateString("en-GB");return t.jsx("span",{children:L})}catch{return" "}})()]}),t.jsxs("div",{className:"card-value mb-2",style:{fontSize:"13px",color:"#28a745",fontWeight:"bold"},children:[t.jsx("i",{className:"bi bi-cash me-1"}),t.jsx("span",{children:e==="inProgress"||e==="review"||e==="completed"?": ":" : "}),(console.log(` PRICE DISPLAY DEBUG for ${o.title}:`,{stage:e,tenderStatus:n.status,tenderStage:n.stage,rawTenderObject:n,estimatedValue:o.estimatedValue,grandTotal:o.grandTotal,tenderId:n.id,shouldShowAdvanced:e==="inProgress"||e==="review"||e==="completed"}),console.log(` PRICE DISPLAY DEBUG for ${n.id}:`,{stage:e,shouldShowSellingPrice:e==="inProgress"||e==="review"||e==="completed",sellingPriceWithProfit:o.sellingPriceWithProfit,grandTotal:o.grandTotal,estimatedValue:o.estimatedValue}),e==="inProgress"||e==="review"||e==="completed"?o.sellingPriceWithProfit>0?` ${(o.sellingPriceWithProfit||0).toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})}`:o.grandTotal>0?` ${(o.grandTotal||0).toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})}`:` ${(o.estimatedValue||0).toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})}`:`${(n.estimatedValue||0).toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})}`)," ."]}),(()=>{var p;const f=((p=$0[e])==null?void 0:p.progress)||0;return f>0&&t.jsxs("div",{className:"mb-2",children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[t.jsx("small",{className:"text-muted",children:""}),t.jsxs("small",{className:"fw-bold text-primary",children:[f,"%"]})]}),t.jsx("div",{className:"progress-custom",children:t.jsx("div",{className:"progress-bar-custom",style:{width:`${f}%`}})})]})})()]})});z1.displayName="KanbanCard";const V1=h.memo(({stage:n,tenders:e,onDragOver:s,onDragLeave:r,onDrop:i,onCardDragStart:a,onCardDragEnd:o,dragState:l,navigate:c})=>{const d=$0[n],u=e.length,f=l.dragOverTarget===n,p=l.isDragging&&l.draggedFrom!==n,j=`kanban-column ${f?"kanban-column--drag-over":""} ${p?"kanban-column--drag-active":""}`;return t.jsxs("div",{className:j,onDragOver:L=>s(L,n),onDragLeave:r,onDrop:L=>i(L,n),"data-testid":`kanban-column-${n}`,role:"region","aria-label":`${d.title} - ${u} items`,children:[t.jsx("div",{className:"kanban-header",style:{background:d.bgColor},children:t.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:`bi ${d.icon} me-2`,style:{fontSize:"18px"}}),t.jsx("h6",{className:"fw-bold mb-0",children:d.title})]}),t.jsx("span",{className:"badge bg-white text-dark",children:u})]})}),t.jsx("div",{className:"kanban-content",children:e.length>0?e.map(L=>{var R;return t.jsx(z1,{tender:L,stage:n,onDragStart:a,onDragEnd:o,isDragging:((R=l.draggedItem)==null?void 0:R.id)===L.id,navigate:c},L.id)}):t.jsxs("div",{className:"kanban-empty",children:[t.jsx("div",{className:"kanban-empty-icon",children:t.jsx("i",{className:"bi bi-inbox"})}),t.jsx("p",{className:"mb-1",children:"  "}),t.jsx("small",{children:"  "})]})})]})});V1.displayName="KanbanColumn";const B1=h.memo(({kanbanData:n,onMoveCard:e,navigate:s})=>{const{dragState:r,handleDragStart:i,handleDragEnd:a,handleDragOver:o,handleDragLeave:l,handleDrop:c}=TU(),d=h.useCallback((p,j,L)=>{if(j===L)return;console.log(" [KANBAN] Moving card:",p.title,"from",j,"to",L);const R={...p,progress:$0[L].progress};e(R,j,L)},[e]),u=h.useCallback((p,j)=>{c(p,j,d)},[c,d]),f=[qs.COMPLETED,qs.REVIEW,qs.IN_PROGRESS,qs.PENDING];return t.jsx("div",{className:"kanban-board",style:{minHeight:"calc(100vh - 400px)",marginTop:"15px"},children:f.map(p=>t.jsx(V1,{stage:p,tenders:n[p],onDragOver:o,onDragLeave:l,onDrop:u,onCardDragStart:i,onCardDragEnd:a,dragState:r,navigate:s},p))})});B1.displayName="KanbanBoard";function PU(){var O;const[n,e]=h.useState(!1),{isTimelineVisible:s}=Ut(),{logActivity:r,getCurrentUser:i}=Zt(),a=Xr(),o=kt(),{alertConfig:l,closeAlert:c,showSuccess:d,showError:u,showConfirm:f}=Bt(),[p,j]=h.useState(_U),[L,R]=h.useState(!0),[D,y]=h.useState(!1),[T,x]=h.useState(""),S=(O=a.state)==null?void 0:O.selectedTender;h.useEffect(()=>{A()},[]);const A=async()=>{try{console.log(" [TRACKING-PAGE] Initializing tracking page"),await On.removeDuplicateTrackingEntries(),q()}catch(E){console.error(" [TRACKING-PAGE] Error initializing tracking page:",E),q()}};h.useEffect(()=>{console.log(" [TRACKING-PAGE] Setting up periodic refresh for tracking tenders");const E=setInterval(()=>{console.log(" [TRACKING-PAGE] Periodic refresh triggered"),q()},3e4);return()=>{console.log(" [TRACKING-PAGE] Cleaning up periodic refresh"),clearInterval(E)}},[]),h.useEffect(()=>{S&&!D&&(console.log(" [TRACKING-PAGE] Selected tender found, initializing:",S.title),B())},[S,D]),h.useEffect(()=>{const E=()=>{document.hidden||(console.log(" [BULLETPROOF-NAVIGATION] Page became visible - using bulletproof data refresh"),setTimeout(()=>{q()},1e3))},k=()=>{console.log(" [BULLETPROOF-NAVIGATION] Window focused - bulletproof persistence check"),setTimeout(()=>{q()},1e3)};return document.addEventListener("visibilitychange",E),window.addEventListener("focus",k),()=>{document.removeEventListener("visibilitychange",E),window.removeEventListener("focus",k)}},[]);const Q=async E=>{try{console.log(" [MIGRATION] Checking for legacy tenders to migrate...");let k=0;for(const[b,N]of Object.entries(E))for(const I of N)if(I.isLegacyTender&&I.tenderId)try{console.log(` [MIGRATION] Migrating legacy tender: ${I.title}`),await tn.updateTender(I.tenderId,{trackingStatus:"tracking",trackingStage:b,trackingStartedAt:I.createdAt||new Date().toISOString(),trackingData:{originalTrackingId:I.id,migratedFrom:"legacy-tracking-system",migrationDate:new Date().toISOString()},updatedAt:new Date().toISOString()}),I.isLegacyTender=!1,k++,console.log(` [MIGRATION] Successfully migrated: ${I.title}`)}catch(P){console.error(` [MIGRATION] Failed to migrate ${I.title}:`,P)}k>0?console.log(` [MIGRATION] Successfully migrated ${k} legacy tenders`):console.log(" [MIGRATION] No legacy tenders found to migrate")}catch(k){console.error(" [MIGRATION] Migration process failed:",k)}},q=async()=>{try{console.log(" [TRACKING-PAGE] Loading tracked tenders - HYBRID APPROACH"),R(!0);try{const C=await tn.restoreMissingTenders();C>0&&console.log(` Auto-restored ${C} missing tenders`)}catch(C){console.warn(" Could not restore missing tenders:",C)}let E={[qs.PENDING]:[],[qs.IN_PROGRESS]:[],[qs.REVIEW]:[],[qs.COMPLETED]:[]};try{console.log(" Loading from TenderService (persistence system)...");const C=await tn.getTrackingTenders();if(console.log(" Loaded tracking tenders from TenderService:",C.length),C.forEach(U=>{const w=U.trackingStage||qs.PENDING;E[w].push({...U,isSelectedTender:!1})}),C.length>0){console.log(" Using new system data, skipping legacy system"),j(E),R(!1);return}}catch(C){console.log(" New system failed, trying old system:",C.message)}try{console.log(" Loading from legacy TenderTrackingService with bulletproof filtering...");const C=await On.getAllTrackedTenders(),U=await tn.getLostTenders(),w=new Set(U.map(de=>de.id));(await tn.getAllTenders()).filter(de=>de.status==="lost"||de.status===""||de.absolutePersistence===!0&&de.lastStatusChange==="moved_to_lost").forEach(de=>w.add(de.id)),console.log(" BULLETPROOF exclusion - Lost tender IDs from all sources:",Array.from(w)),Object.keys(C).forEach(de=>{C[de]&&Array.isArray(C[de])&&C[de].forEach(ne=>{if(w.has(ne.id)||w.has(ne.tenderId)||ne.status==="lost"||ne.status===""||ne.absolutePersistence===!0&&ne.lastStatusChange==="moved_to_lost"||ne.lastStatusChange&&ne.lastStatusChange.includes("lost")&&!ne.lastStatusChange.includes("restored_from_lost")){console.log(` BULLETPROOF EXCLUDED lost tender: ${ne.title} (ID: ${ne.id}, Status: ${ne.status}, LastChange: ${ne.lastStatusChange})`);return}Object.values(E).some(be=>be.find(xe=>xe.id===ne.id||xe.tenderId===ne.tenderId||xe.internalId===ne.internalId||xe.title===ne.title&&xe.entity===ne.entity))?console.log(` Skipping duplicate legacy tender: ${ne.title}`):(console.log(` Restoring legacy tender: ${ne.title} to stage ${de}`),E[de].push({...ne,isSelectedTender:!1,isLegacyTender:!0}))})})}catch(C){console.log(" Legacy system also failed:",C.message)}Object.keys(E).forEach(C=>{const U=[],w=new Set;E[C].forEach(W=>{const ie=W.id||W.tenderId||W.internalId||`${W.title}-${W.entity}`;w.has(ie)?console.log(` Removing duplicate tender in final pass: ${W.title}`):(w.add(ie),U.push(W))}),E[C]=U});const k=await tn.getLostTenders(),b=new Set(k.map(C=>C.id));(await tn.getAllTenders()).filter(C=>C.status==="lost"||C.status===""||C.absolutePersistence===!0&&C.lastStatusChange==="moved_to_lost").forEach(C=>b.add(C.id)),b.size>0&&(console.log(" BULLETPROOF FINAL CLEANUP: Removing any lost tenders that slipped through:",Array.from(b)),Object.keys(E).forEach(C=>{const U=E[C].length;E[C]=E[C].filter(w=>{const W=b.has(w.id)||b.has(w.tenderId)||w.status==="lost"||w.status===""||w.absolutePersistence===!0&&w.lastStatusChange==="moved_to_lost"||w.lastStatusChange&&w.lastStatusChange.includes("lost")&&!w.lastStatusChange.includes("restored_from_lost");return W&&console.log(` BULLETPROOF FINAL REMOVAL: ${w.title} from ${C} (Status: ${w.status}, LastChange: ${w.lastStatusChange})`),!W}),E[C].length!==U&&console.log(` BULLETPROOF FINAL CLEANUP: Removed ${U-E[C].length} lost tenders from ${C}`)})),await Q(E);const P=Object.values(E).reduce((C,U)=>C+U.length,0);console.log(` Total unique tenders loaded: ${P}`),j(E),console.log(" [TRACKING-PAGE] Tracked tenders loaded successfully")}catch(E){console.error(" [TRACKING-PAGE] Error loading tracked tenders:",E),u(E.message||"    ","  ")}finally{R(!1)}},B=async()=>{try{console.log(" [TRACKING-PAGE] Initializing selected tender for tracking"),y(!0),f(`     

 : ${S.entity}
 : ${S.title}`,async()=>{try{const E=await On.initializeTenderTracking(S);d("    "," "),console.log(" [TRACKING-PAGE] Tender tracking initialized:",E.id),window.history.replaceState({},document.title),localStorage.setItem("tenderTrackingUpdated",Date.now().toString()),await q()}catch(E){console.error(" [TRACKING-PAGE] Error initializing tender tracking:",E),u(E.message||"    ","")}},"  ")}catch(E){console.error(" [TRACKING-PAGE] Error in initializeSelectedTender:",E)}finally{y(!1)}},$=h.useCallback(()=>{e(E=>!E)},[]),H=()=>{console.log(" [TRACKING] Navigating to tender selection page"),o("/tenders/selection")},te=async E=>{E.preventDefault();try{const k=E.dataTransfer.getData("text/plain"),b=JSON.parse(k);if(!b||!b.item||!b.item.id){u("  ","  ");return}const N=b.item;console.log(" [TRACKING] Returning card to selection list:",N.title),f(`   "${N.title}"    
   .`,async()=>{try{await tn.removeFromTracking(N.id),j(P=>{const _={...P};return Object.keys(_).forEach(C=>{_[C]=_[C].filter(U=>U.id!==N.id)}),_});const I=document.getElementById("return-to-list-zone");I&&(I.style.backgroundColor="rgba(40, 167, 69, 0.1)",I.style.borderColor="#28a745",I.style.transform="scale(1)"),d("     ","    "),console.log(" [TRACKING] Card returned to selection list successfully")}catch(I){console.error(" [TRACKING] Error returning card to list:",I),u("    ","")}}," ")}catch(k){console.error(" [TRACKING] Error in handleReturnToList:",k),u("    ","")}},G=async E=>{E.preventDefault();try{const k=E.dataTransfer.getData("text/plain"),b=JSON.parse(k);if(!b||!b.item||!b.item.id){u("  ","  ");return}const N=b.item;console.log(" [BULLETPROOF-TRACKING] Starting bulletproof move to lost tenders:",N.title),f(`   "${N.title}"   
    .`,async()=>{try{console.log(" [BULLETPROOF-TRACKING] Using absolute persistence system for:",N.id),await tn.moveToLostTendersAbsolute(N.id);const I=i();r("task",`${I.name}    `,`  : ${N.title}`),j(_=>{const C={..._};return Object.keys(C).forEach(U=>{C[U]=C[U].filter(w=>w.id!==N.id)}),C}),console.log(" [BULLETPROOF-TRACKING] Triggering data reload for consistency verification"),setTimeout(()=>{q()},1e3);const P=document.getElementById("move-to-lost-zone");P&&(P.style.backgroundColor="rgba(220, 53, 69, 0.1)",P.style.borderColor="#dc3545",P.style.transform="scale(1)"),d("      ","     "),console.log(" [BULLETPROOF-TRACKING] Bulletproof move to lost completed successfully")}catch(I){console.error(" [BULLETPROOF-TRACKING] Error in bulletproof move to lost:",I),u("     ","")}},"   ()")}catch(k){console.error(" [BULLETPROOF-TRACKING] Error in handleMoveToLost:",k),u("    ","")}},F=async E=>{E.preventDefault();try{const k=E.dataTransfer.getData("text/plain"),b=JSON.parse(k);if(!b||!b.item||!b.item.id){u("  ","  ");return}const N=b.item;console.log(" [BULLETPROOF-TRACKING] Starting bulletproof move to won projects:",N.title),f(`   "${N.title}"   
    .`,async()=>{try{console.log(" [BULLETPROOF-TRACKING] Using absolute persistence system for:",N.id),await tn.moveToWonProjectsAbsolute(N.id);const I=i();r("task",`${I.name}     `,`  : ${N.title}`),j(_=>{const C={..._};return Object.keys(C).forEach(U=>{C[U]=C[U].filter(w=>w.id!==N.id)}),C}),console.log(" [BULLETPROOF-TRACKING] Triggering data reload for consistency verification"),setTimeout(()=>{q()},1e3),window.dispatchEvent(new CustomEvent("tenderMovedToWon",{detail:{tenderId:N.id}})),console.log(" Real-time event dispatched: tenderMovedToWon");const P=document.querySelector('[title*=" "]');P&&(P.style.backgroundColor="rgba(0, 123, 255, 0.1)",P.style.borderColor="#007bff",P.style.transform="scale(1)"),d("      ","     "),console.log(" [BULLETPROOF-TRACKING] Bulletproof move to won completed successfully")}catch(I){console.error(" [BULLETPROOF-TRACKING] Error in bulletproof move to won:",I),u("     ","")}},"   ()")}catch(k){console.error(" [BULLETPROOF-TRACKING] Error in handleMoveToWon:",k),u("    ","")}},X=h.useCallback(async(E,k,b)=>{try{console.log(" [TRACKING-PAGE] Moving card with activity logging:",{id:E.id,from:k,to:b}),j(I=>{const P={};return Object.keys(I).forEach(_=>{_===k?P[_]=I[_].filter(C=>C.id!==E.id):_===b?P[_]=[E,...I[_]]:P[_]=[...I[_]]}),P});const N=E.trackingDocId||E.id;try{await On.moveTenderStage(N,b,`    ${On.getStageDisplayName(k)}  ${On.getStageDisplayName(b)}`),console.log(" [TRACKING-PAGE] Card moved with TenderTrackingService - activity logged")}catch(I){console.warn(" [TRACKING-PAGE] TenderTrackingService failed, falling back to TenderService:",I),await tn.updateTender(E.id,{trackingStage:b,trackingStatus:"tracking",trackingStageUpdatedAt:new Date().toISOString(),updatedAt:new Date().toISOString()});try{await ws.logActivity("tracking_stage_move",`   ${E.entity||" "}  ${On.getStageDisplayName(k)}  ${On.getStageDisplayName(b)}`,{tenderId:E.id,tenderEntity:E.entity,tenderTitle:E.title,fromStage:k,toStage:b,fromStageTitle:On.getStageDisplayName(k),toStageTitle:On.getStageDisplayName(b)}),console.log(" [TRACKING-PAGE] Manual activity logged as fallback")}catch(P){console.warn(" [TRACKING-PAGE] Manual activity logging also failed:",P)}}}catch(N){console.error(" [TRACKING-PAGE] Error moving card:",N),j(I=>{const P={};return Object.keys(I).forEach(_=>{_===b?P[_]=I[_].filter(C=>C.id!==E.id):_===k?P[_]=[E,...I[_]]:P[_]=[...I[_]]}),P}),u(N.message||"    ","  ")}},[u]),ue=h.useMemo(()=>({paddingRight:n?"72px":"250px",paddingLeft:n||!s?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"}),[n,s]),Y=h.useMemo(()=>({width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"}),[n]),z=h.useMemo(()=>{if(!T)return p;const E=T.toLowerCase(),k={};return Object.keys(p).forEach(b=>{k[b]=p[b].filter(N=>{var I,P,_,C;return((I=N.title)==null?void 0:I.toLowerCase().includes(E))||((P=N.entity)==null?void 0:P.toLowerCase().includes(E))||((_=N.description)==null?void 0:_.toLowerCase().includes(E))||((C=N.referenceNumber)==null?void 0:C.toLowerCase().includes(E))})}),k},[p,T]);return t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:$}),t.jsxs("div",{className:"main-container",style:ue,children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:Y,children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:t.jsxs("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:[t.jsx("div",{className:"card shadow-sm mb-4",children:t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-kanban text-primary me-2"})," "]}),t.jsxs("button",{className:"btn btn-outline-danger",id:"move-to-lost-zone",onClick:()=>o("/tenders/lost"),onDragOver:E=>E.preventDefault(),onDrop:E=>G(E),style:{height:"34px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",whiteSpace:"nowrap",marginRight:"20px",border:"2px dashed #dc3545",backgroundColor:"rgba(220, 53, 69, 0.1)",transition:"all 0.3s ease",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:E=>{E.currentTarget.style.backgroundColor="rgba(220, 53, 69, 0.2)",E.currentTarget.style.borderColor="#c82333",E.currentTarget.style.transform="translateY(-1px)"},onMouseOut:E=>{E.currentTarget.style.backgroundColor="rgba(220, 53, 69, 0.1)",E.currentTarget.style.borderColor="#dc3545",E.currentTarget.style.transform="translateY(0)"},onDragEnter:E=>{E.currentTarget.style.backgroundColor="rgba(220, 53, 69, 0.3)",E.currentTarget.style.borderColor="#c82333",E.currentTarget.style.transform="scale(1.05)"},onDragLeave:E=>{E.currentTarget.style.backgroundColor="rgba(220, 53, 69, 0.1)",E.currentTarget.style.borderColor="#dc3545",E.currentTarget.style.transform="scale(1)"},title:"         ",children:[t.jsx("i",{className:"bi bi-x-circle me-1"})," "]}),t.jsxs("button",{className:"btn btn-outline-primary",onClick:()=>o("/tenders/won"),onDragOver:E=>{E.preventDefault(),E.dataTransfer.dropEffect="move"},onDrop:E=>F(E),style:{height:"34px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",whiteSpace:"nowrap",marginRight:"10px",border:"2px dashed #007bff",backgroundColor:"rgba(0, 123, 255, 0.1)",color:"#007bff",transition:"all 0.3s ease",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:E=>{E.currentTarget.style.backgroundColor="rgba(0, 123, 255, 0.2)",E.currentTarget.style.borderColor="#0056b3",E.currentTarget.style.color="#0056b3",E.currentTarget.style.transform="translateY(-1px)"},onMouseOut:E=>{E.currentTarget.style.backgroundColor="rgba(0, 123, 255, 0.1)",E.currentTarget.style.borderColor="#007bff",E.currentTarget.style.color="#007bff",E.currentTarget.style.transform="translateY(0)"},onDragEnter:E=>{E.currentTarget.style.backgroundColor="rgba(0, 123, 255, 0.3)",E.currentTarget.style.borderColor="#0056b3",E.currentTarget.style.color="#0056b3",E.currentTarget.style.transform="scale(1.05)"},onDragLeave:E=>{E.currentTarget.style.backgroundColor="rgba(0, 123, 255, 0.1)",E.currentTarget.style.borderColor="#007bff",E.currentTarget.style.color="#007bff",E.currentTarget.style.transform="scale(1)"},title:"         ",children:[t.jsx("i",{className:"bi bi-trophy me-1"})," "]})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:T,onChange:E=>x(E.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"34px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6",height:"34px"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsxs("button",{className:"btn btn-primary",onClick:H,style:{height:"34px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",whiteSpace:"nowrap"},children:[t.jsx("i",{className:"bi bi-list-check me-1"})," "]}),t.jsxs("button",{className:"btn btn-outline-success",id:"return-to-list-zone",onDragOver:E=>E.preventDefault(),onDrop:E=>te(E),style:{height:"34px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",whiteSpace:"nowrap",marginLeft:"8px",border:"2px dashed #28a745",backgroundColor:"rgba(40, 167, 69, 0.1)",transition:"all 0.3s ease"},onMouseOver:E=>{E.currentTarget.style.backgroundColor="rgba(40, 167, 69, 0.2)",E.currentTarget.style.borderColor="#1e7e34",E.currentTarget.style.transform="translateY(-1px)"},onMouseOut:E=>{E.currentTarget.style.backgroundColor="rgba(40, 167, 69, 0.1)",E.currentTarget.style.borderColor="#28a745",E.currentTarget.style.transform="translateY(0)"},onDragEnter:E=>{E.currentTarget.style.backgroundColor="rgba(40, 167, 69, 0.3)",E.currentTarget.style.borderColor="#1e7e34",E.currentTarget.style.transform="scale(1.05)"},onDragLeave:E=>{E.currentTarget.style.backgroundColor="rgba(40, 167, 69, 0.1)",E.currentTarget.style.borderColor="#28a745",E.currentTarget.style.transform="scale(1)"},title:"    ",children:[t.jsx("i",{className:"bi bi-arrow-return-left me-1"})," "]})]})]})})}),t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body p-0",children:[L&&t.jsx("div",{className:"d-flex justify-content-center align-items-center py-5",children:t.jsxs("div",{className:"text-center",children:[t.jsx(It,{size:"large"}),t.jsx("p",{className:"mt-3 text-muted",children:"   ..."})]})}),!L&&t.jsx(B1,{kanbanData:z,onMoveCard:X,navigate:o})]})})]})})]}),!n&&s&&t.jsx(os,{rtl:!0}),!n&&s&&t.jsx(ls,{})]}),t.jsx(Mt,{show:l.show,onClose:c,title:l.title,message:l.message,type:l.type,onConfirm:l.onConfirm,showConfirm:l.showConfirm,showCancel:l.showCancel,confirmText:l.confirmText,cancelText:l.cancelText})]})}function kU(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(PU,{})})})}const LU=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>Go),void 0)),FU=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>Wo),void 0)),OU=h.lazy(()=>Xe(()=>import("./TenderArchiveList-1759246972099-C1w9RZ4m.js"),[])),G1=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>fi),void 0).then(n=>({default:n.ActivityProvider}))),W1=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>fi),void 0).then(n=>({default:n.AutoActivityTracker}))),MU=({searchTerm:n})=>{const[e,s]=h.useState(0),[r,i]=h.useState(0);h.useEffect(()=>{a()},[n]);const a=async()=>{try{const o=await tn.getArchivedTenders();if(s(o.length),n!=null&&n.trim()){const l=o.filter(c=>{var d,u,f,p,j;return((d=c.title)==null?void 0:d.toLowerCase().includes(n.toLowerCase()))||((u=c.referenceNumber)==null?void 0:u.toLowerCase().includes(n.toLowerCase()))||((f=c.entity)==null?void 0:f.toLowerCase().includes(n.toLowerCase()))||((p=c.category)==null?void 0:p.toLowerCase().includes(n.toLowerCase()))||((j=c.location)==null?void 0:j.toLowerCase().includes(n.toLowerCase()))});i(l.length)}else i(o.length)}catch(o){console.error("Error loading archived tenders count:",o),s(0),i(0)}};return t.jsx("span",{className:"badge bg-secondary ms-2",style:{fontSize:"12px",fontWeight:"normal"},children:n!=null&&n.trim()?`${r}  ${e}`:e})};function UU(){const[n,e]=h.useState(!1),[s,r]=h.useState(0),[i,a]=h.useState(""),{isTimelineVisible:o}=Ut(),l=h.useCallback(()=>{e(c=>!c)},[]);return t.jsx(h.Suspense,{fallback:t.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:"   ..."}),children:t.jsx(G1,{children:t.jsx(W1,{children:t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:l}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!o?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"20px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:10,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-archive text-primary me-2"})," "]}),t.jsx(MU,{searchTerm:i})]}),t.jsx("div",{className:"d-flex align-items-center gap-3",children:t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:i,onChange:c=>a(c.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]})})]})}),t.jsx("div",{style:{height:"calc(100vh - 280px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"card-body p-0",children:t.jsx(OU,{refreshTrigger:s,searchTerm:i})})})]})})]}),!n&&o&&t.jsx(LU,{rtl:!0}),!n&&o&&t.jsx(FU,{})]})]})})})})}function $U(){return t.jsx(h.Suspense,{fallback:t.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:" ..."}),children:t.jsx(G1,{children:t.jsx(W1,{children:t.jsx(UU,{})})})})}const zU=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>Go),void 0)),VU=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>Wo),void 0)),BU=h.lazy(()=>Xe(()=>import("./LostTendersList-1759246972099-B-v6y1u1.js"),[])),q1=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>fi),void 0).then(n=>({default:n.ActivityProvider}))),H1=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>fi),void 0).then(n=>({default:n.AutoActivityTracker}))),GU=({searchTerm:n})=>{const[e,s]=h.useState(0),[r,i]=h.useState(0);h.useEffect(()=>{a()},[n]);const a=async()=>{try{const o=await tn.getLostTenders();if(s(o.length),n!=null&&n.trim()){const l=o.filter(c=>{var d,u,f,p,j;return((d=c.title)==null?void 0:d.toLowerCase().includes(n.toLowerCase()))||((u=c.referenceNumber)==null?void 0:u.toLowerCase().includes(n.toLowerCase()))||((f=c.entity)==null?void 0:f.toLowerCase().includes(n.toLowerCase()))||((p=c.category)==null?void 0:p.toLowerCase().includes(n.toLowerCase()))||((j=c.location)==null?void 0:j.toLowerCase().includes(n.toLowerCase()))});i(l.length)}else i(o.length)}catch(o){console.error("Error loading lost tenders count:",o),s(0),i(0)}};return t.jsx("span",{className:"badge bg-danger ms-2",style:{fontSize:"12px",fontWeight:"normal"},children:n!=null&&n.trim()?`${r}  ${e}`:e})};function WU(){const[n,e]=h.useState(!1),[s,r]=h.useState(0),[i,a]=h.useState(""),{isTimelineVisible:o}=Ut(),l=h.useCallback(()=>{e(c=>!c)},[]);return t.jsx(h.Suspense,{fallback:t.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:"   ..."}),children:t.jsx(q1,{children:t.jsx(H1,{children:t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:l}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!o?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"20px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:10,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-x-circle text-danger me-2"})," "]}),t.jsx(GU,{searchTerm:i})]}),t.jsx("div",{className:"d-flex align-items-center gap-3",children:t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:i,onChange:c=>a(c.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]})})]})}),t.jsx("div",{style:{height:"calc(100vh - 280px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"card-body p-0",children:t.jsx(BU,{refreshTrigger:s,searchTerm:i})})})]})})]}),!n&&o&&t.jsx(zU,{rtl:!0}),!n&&o&&t.jsx(VU,{})]})]})})})})}function qU(){return t.jsx(h.Suspense,{fallback:t.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:" ..."}),children:t.jsx(q1,{children:t.jsx(H1,{children:t.jsx(WU,{})})})})}const HU=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>Go),void 0)),QU=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>Wo),void 0)),KU=h.lazy(()=>Xe(()=>import("./WonProjectsList-1759246972099-DxzbWHD-.js"),[])),Q1=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>fi),void 0).then(n=>({default:n.ActivityProvider}))),K1=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>fi),void 0).then(n=>({default:n.AutoActivityTracker}))),YU=({searchTerm:n})=>{const[e,s]=h.useState(0),[r,i]=h.useState(0);h.useEffect(()=>{a()},[n]);const a=async()=>{try{const o=await tn.getWonProjects();if(s(o.length),n!=null&&n.trim()){const l=o.filter(c=>{var d,u,f,p,j;return((d=c.title)==null?void 0:d.toLowerCase().includes(n.toLowerCase()))||((u=c.referenceNumber)==null?void 0:u.toLowerCase().includes(n.toLowerCase()))||((f=c.entity)==null?void 0:f.toLowerCase().includes(n.toLowerCase()))||((p=c.category)==null?void 0:p.toLowerCase().includes(n.toLowerCase()))||((j=c.location)==null?void 0:j.toLowerCase().includes(n.toLowerCase()))});i(l.length)}else i(o.length)}catch(o){console.error("Error loading won projects count:",o),s(0),i(0)}};return t.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"12px",fontWeight:"normal"},children:n!=null&&n.trim()?`${r}  ${e}`:e})};function JU(){const[n,e]=h.useState(!1),[s,r]=h.useState(0),[i,a]=h.useState(""),{isTimelineVisible:o}=Ut(),l=h.useCallback(()=>{e(c=>!c)},[]);return t.jsx(h.Suspense,{fallback:t.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:"   ..."}),children:t.jsx(Q1,{children:t.jsx(K1,{children:t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:l}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!o?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"20px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:10,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-trophy text-success me-2"})," "]}),t.jsx(YU,{searchTerm:i})]}),t.jsx("div",{className:"d-flex align-items-center gap-3",children:t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:i,onChange:c=>a(c.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]})})]})}),t.jsx("div",{style:{height:"calc(100vh - 280px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"card-body p-0",children:t.jsx(KU,{refreshTrigger:s,searchTerm:i})})})]})})]}),!n&&o&&t.jsx(HU,{rtl:!0}),!n&&o&&t.jsx(QU,{})]})]})})})})}function XU(){return t.jsx(h.Suspense,{fallback:t.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:" ..."}),children:t.jsx(Q1,{children:t.jsx(K1,{children:t.jsx(JU,{})})})})}function ZU(){const[n,e]=h.useState(!1),[s,r]=h.useState(""),[i,a]=h.useState([]),[o,l]=h.useState(!0),[c,d]=h.useState(null),[u,f]=h.useState({}),[p,j]=h.useState([]),{isTimelineVisible:L}=Ut(),{hasPerm:R}=Yn(),D=kt(),{formatDate:y}=sc(),{alertConfig:T,closeAlert:x,showSuccess:S,showError:A,showConfirm:Q}=Bt();R("tenders:read");const q=h.useCallback(()=>{e(G=>!G)},[]);h.useEffect(()=>{B()},[]),h.useEffect(()=>{const G=ue=>{ue.key==="tenderTrackingUpdated"&&(console.log(" [SELECTION-PAGE] Tracking updated, refreshing tender list"),B())},F=()=>{console.log(" [SELECTION-PAGE] Window focused, checking for updates"),B()},X=ue=>{console.log(" [SELECTION-PAGE] Tender returned to list, refreshing immediately:",ue.detail),B()};return window.addEventListener("storage",G),window.addEventListener("focus",F),window.addEventListener("tenderReturnedToList",X),()=>{window.removeEventListener("storage",G),window.removeEventListener("focus",F),window.removeEventListener("tenderReturnedToList",X)}},[]);const B=async()=>{try{l(!0),console.log("Loading tenders for selection...");const[G,F]=await Promise.all([tn.getAllTenders(),tn.getTrackingTenders()]),X=F.map(O=>O.id||O.internalId),ue={pending:F.filter(O=>(O.trackingStage||"pending")==="pending"),inProgress:F.filter(O=>O.trackingStage==="inProgress"),review:F.filter(O=>O.trackingStage==="review"),completed:F.filter(O=>O.trackingStage==="completed")};console.log("Tenders loaded for selection:",G.length),console.log("Tracked tender IDs:",X.length);let Y=0;ue&&typeof ue=="object"&&Object.keys(ue).forEach(O=>{Array.isArray(ue[O])&&(Y+=ue[O].length)}),console.log("Tracked tenders count:",Y),j(X);const z=G.filter(O=>{const E=O.id||O.internalId;if(O.status==="lost"||O.status==="")return console.log(" Filtering out lost tender:",O.title),!1;if(O.status==="archived")return console.log(" Filtering out archived tender:",O.title),!1;if(X.includes(E))return console.log(" Filtering out tracked tender by ID:",O.title),!1;const k=[];if(ue&&typeof ue=="object"&&Object.keys(ue).forEach(U=>{Array.isArray(ue[U])&&k.push(...ue[U])}),k.some(U=>{const w=U.tenderData||U,W=O.entity&&w.entity&&O.entity.trim()===w.entity.trim(),ie=O.referenceNumber&&w.referenceNumber&&O.referenceNumber===w.referenceNumber,de=O.title&&w.title&&O.title.trim()===w.title.trim(),ne=O.entity&&O.entity.includes("  ");return W||ie||de||ne?(console.log(" Found duplicate tender:",{tenderEntity:O.entity,trackedEntity:w.entity,entityMatch:W,refMatch:ie,titleMatch:de,isNorthernBorder:ne}),!0):!1}))return console.log(" Filtering out tracked tender by content match:",O.entity||O.title),!1;const N=new Date,I=O.submissionDeadline||O.deadline||O.submissionDate||O.endDate;if(!I)return!0;let P=I;if(I&&typeof I=="object"&&I.seconds?P=new Date(I.seconds*1e3):P=new Date(I),isNaN(P.getTime()))return!0;const _=P.getTime()-N.getTime();return Math.ceil(_/(1e3*3600*24))>=0});a(z),console.log(` Filtered available tenders: ${z.length} out of ${G.length} (${X.length} already tracked)`)}catch(G){console.error("Error loading tenders:",G),A("    ","  "),a([])}finally{l(!1)}},$=h.useMemo(()=>{if(!s)return i;const G=s.toLowerCase();return i.filter(F=>{var X,ue,Y,z;return((X=F.title)==null?void 0:X.toLowerCase().includes(G))||((ue=F.entity)==null?void 0:ue.toLowerCase().includes(G))||((Y=F.description)==null?void 0:Y.toLowerCase().includes(G))||((z=F.referenceNumber)==null?void 0:z.toLowerCase().includes(G))})},[i,s]),H=G=>{const F=new Date,X=G.submissionDeadline||G.deadline||G.submissionDate||G.endDate;if(!X)return t.jsx("span",{className:"badge bg-secondary",children:" "});let ue=X;if(X&&typeof X=="object"&&X.seconds?ue=new Date(X.seconds*1e3):ue=new Date(X),isNaN(ue.getTime()))return t.jsx("span",{className:"badge bg-secondary",children:"  "});const Y=ue.getTime()-F.getTime(),z=Math.ceil(Y/(1e3*3600*24));let O="",E="text-white";return z>=6?O="bg-success":z>=3?(O="bg-warning",E="text-dark"):O="bg-danger",t.jsx("span",{className:`badge ${O} ${E}`,style:{fontSize:"12px",padding:"4px 8px"},children:z===1?"  ":z===2?" ":` ${z} `})},te=(G,F)=>{F?(async()=>{try{console.log(" [SELECTION] Pre-checking tracking status for:",G.id||G.internalId),await tn.emergencyCleanupTrackingDocuments(G.id||G.internalId);const ue=`     

 : ${G.entity}`;Q(ue,()=>{f(Y=>{const z={};return z[G.id||G.internalId]=!0,d(G),z}),setTimeout(()=>{S(`  : ${G.title}`," ")},300),setTimeout(()=>{D("/tenders/tracking",{state:{selectedTender:G}})},1800)},"  ")}catch(ue){console.error(" [SELECTION] Pre-check failed:",ue),A("    ","")}})():f(X=>{const ue={...X};return delete ue[G.id||G.internalId],d(null),ue})};return o?t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"100vh"},children:t.jsxs("div",{className:"text-center",children:[t.jsx(It,{size:"large"}),t.jsx("p",{className:"mt-3 text-muted",children:"   ..."})]})}):t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx("style",{children:`
          .tender-checkbox {
            appearance: none;
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border: 2px solid #007bff;
            border-radius: 6px;
            background-color: transparent;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
          }
          
          .tender-checkbox:hover:not(:checked) {
            background-color: #f0f8ff;
            box-shadow: 0 0 12px rgba(0,123,255,0.3);
            border-color: #0056b3;
            transform: scale(1.05);
          }
          
          .tender-checkbox:checked {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            border-color: #007bff;
            box-shadow: 0 4px 12px rgba(0,123,255,0.4);
            animation: checkboxPulse 0.6s cubic-bezier(0.4, 0, 0.2, 1);
          }
          
          .tender-checkbox:checked::after {
            content: '';
            color: white;
            font-size: 14px;
            font-weight: bold;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 1;
            animation: checkmarkAppear 0.4s ease-in-out;
          }
          
          .tender-checkbox:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.2);
          }
          
          @keyframes checkboxPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
          }
          
          @keyframes checkmarkAppear {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
          }
        `}),t.jsx(Rt,{onToggle:q}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!L?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsx("a",{href:"/tenders/tracking",className:"text-decoration-none text-primary",children:" "})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsx("div",{className:"d-flex align-items-center",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-list-check text-primary me-2"}),"  "]})}),t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:s,onChange:G=>r(G.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsxs("button",{onClick:()=>D("/tenders/tracking"),className:"btn btn-outline-primary",style:{height:"40px",fontSize:"14px",borderRadius:"8px",padding:"6px 16px",background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)",border:"1px solid #007bff",color:"#007bff",fontWeight:"500",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0,123,255,0.1)",whiteSpace:"nowrap"},onMouseOver:G=>{G.target.style.background="linear-gradient(135deg, #007bff 0%, #0056b3 100%)",G.target.style.color="white",G.target.style.transform="translateY(-1px)",G.target.style.boxShadow="0 4px 12px rgba(0,123,255,0.3)"},onMouseOut:G=>{G.target.style.background="linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)",G.target.style.color="#007bff",G.target.style.transform="translateY(0)",G.target.style.boxShadow="0 2px 4px rgba(0,123,255,0.1)"},children:[t.jsx("i",{className:"bi bi-arrow-right me-2"}),""]})]})]})}),t.jsx("div",{className:"card-body p-0",children:$.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"mb-3",children:t.jsx("i",{className:"bi bi-inbox display-1 text-muted"})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:s?"    ":"       "})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-striped table-hover mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:"#"}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:"  "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",style:{width:"80px"},children:""})]})}),t.jsx("tbody",{children:$.map((G,F)=>t.jsxs("tr",{style:{height:"52px"},children:[t.jsx("td",{className:"text-center align-middle",children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:F+1})}),t.jsx("td",{className:"text-center align-middle",children:t.jsx("span",{className:"fw-bold text-dark",children:G.entity})}),t.jsx("td",{className:"text-center align-middle",children:t.jsxs("span",{className:"badge bg-success text-white",children:[(G.estimatedValue||0).toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," ."]})}),t.jsx("td",{className:"text-center align-middle",children:t.jsx("span",{className:"fw-bold text-primary",children:G.title})}),t.jsx("td",{className:"text-center align-middle",children:t.jsx("span",{className:"text-muted",children:(()=>{const X=G.submissionDeadline||G.deadline||G.submissionDate||G.endDate;if(!X)return" ";try{let ue=X;return X&&typeof X=="object"&&X.seconds?ue=new Date(X.seconds*1e3):ue=new Date(X),isNaN(ue.getTime())?"  ":y(ue)}catch{return"  "}})()})}),t.jsx("td",{className:"text-center align-middle",children:H(G)}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"form-check d-flex justify-content-center",children:[t.jsx("input",{className:"tender-checkbox",type:"checkbox",id:`tender-check-${G.internalId||G.id||F}`,checked:!!u[G.id||G.internalId],onChange:X=>{X.target.checked?(X.target.checked=!1,te(G,!0)):te(G,!1)},title:"  "}),t.jsx("label",{className:"form-check-label visually-hidden",htmlFor:`tender-check-${G.internalId||G.id||F}`,children:" "})]})})]},G.internalId||G.id||`tender-${F}`))})]})})})]})})}),!n&&L&&t.jsx(os,{rtl:!0}),!n&&L&&t.jsx(ls,{})]})]}),t.jsx(Mt,{show:T.show,onClose:x,title:T.title,message:T.message,type:T.type,onConfirm:T.onConfirm,showConfirm:T.showConfirm,showCancel:T.showCancel,confirmText:T.confirmText,cancelText:T.cancelText})]})}function e$(){return t.jsxs(Lt,{children:[t.jsx(Ft,{}),t.jsx(ZU,{})]})}const t$=()=>{window.dispatchEvent(new CustomEvent("manufacturedProductsUpdated"))};class ci{static async createManufacturedProduct(e){try{console.log(" Creating manufactured product:",e.title);const s=Ct("MANUFACTURED_PRODUCT"),r={...e,internalId:s,createdAt:We(),updatedAt:We(),status:e.status||"active"},i=await As(Pe(ae,this.COLLECTION_NAME),r);return console.log(" Manufactured product created with ID:",i.id),{id:i.id,internalId:s,...r,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}catch(s){throw console.error(" Error creating manufactured product:",s),new Error(`    : ${s.message}`)}}static async getAllManufacturedProducts(){try{console.log(" Loading all manufactured products...");const e=st(Pe(ae,this.COLLECTION_NAME),as("createdAt","desc")),s=await qe(e),r=[];return s.forEach(i=>{var o,l,c,d,u,f;const a=i.data();r.push({id:i.id,internalId:a.internalId||Ct("MANUFACTURED_PRODUCT"),...a,createdAt:((c=(l=(o=a.createdAt)==null?void 0:o.toDate)==null?void 0:l.call(o))==null?void 0:c.toISOString())||new Date().toISOString(),updatedAt:((f=(u=(d=a.updatedAt)==null?void 0:d.toDate)==null?void 0:u.call(d))==null?void 0:f.toISOString())||new Date().toISOString()})}),console.log(" Loaded manufactured products:",r.length),r}catch(e){throw console.error(" Error loading manufactured products:",e),new Error(`    : ${e.message}`)}}static async getManufacturedProductById(e){var s,r,i,a,o,l;try{console.log(" Loading manufactured product:",e);const c=Le(ae,this.COLLECTION_NAME,e),d=await ss(c);if(!d.exists())throw new Error("   ");const u=d.data(),f={id:d.id,internalId:u.internalId||Ct("MANUFACTURED_PRODUCT"),...u,createdAt:((i=(r=(s=u.createdAt)==null?void 0:s.toDate)==null?void 0:r.call(s))==null?void 0:i.toISOString())||new Date().toISOString(),updatedAt:((l=(o=(a=u.updatedAt)==null?void 0:a.toDate)==null?void 0:o.call(a))==null?void 0:l.toISOString())||new Date().toISOString()};return console.log(" Loaded manufactured product:",f.title),f}catch(c){throw console.error(" Error loading manufactured product:",c),new Error(`    : ${c.message}`)}}static async getManufacturedProductByInternalId(e){var s,r,i,a,o,l;try{console.log(" Loading manufactured product by internal ID:",e);const c=st(Pe(ae,this.COLLECTION_NAME),xt("internalId","==",e)),d=await qe(c);if(d.empty)throw new Error(`   : ${e}`);const u=d.docs[0],f=u.data(),p={id:u.id,internalId:f.internalId||e,...f,createdAt:((i=(r=(s=f.createdAt)==null?void 0:s.toDate)==null?void 0:r.call(s))==null?void 0:i.toISOString())||new Date().toISOString(),updatedAt:((l=(o=(a=f.updatedAt)==null?void 0:a.toDate)==null?void 0:o.call(a))==null?void 0:l.toISOString())||new Date().toISOString()};if(p.items&&Array.isArray(p.items)&&p.items.length>0){const j=p.items.reduce((L,R)=>L+(R.totalPrice||0),0);p.price=j}else p.price=p.estimatedValue||0;return p.name=p.title,p.category=" ",p.unit="",p.supplier=" ",console.log(" Loaded manufactured product by internal ID:",p.title),p}catch(c){throw console.error(" Error loading manufactured product by internal ID:",c),new Error(`    : ${c.message}`)}}static async updateManufacturedProduct(e,s){try{console.log(" Updating manufactured product:",e);const r=Le(ae,this.COLLECTION_NAME,e),i={...s,updatedAt:We()};return await Qt(r,i),t$(),console.log(" Manufactured product updated successfully"),!0}catch(r){throw console.error(" Error updating manufactured product:",r),new Error(`    : ${r.message}`)}}static async deleteManufacturedProduct(e){try{console.log(" Deleting manufactured product:",e);const s=Le(ae,this.COLLECTION_NAME,e);return await es(s),console.log(" Manufactured product deleted successfully"),!0}catch(s){throw console.error(" Error deleting manufactured product:",s),new Error(`    : ${s.message}`)}}static async searchManufacturedProducts(e){try{console.log(" Searching manufactured products:",e);const s=await this.getAllManufacturedProducts();if(!e.trim())return s;const r=e.toLowerCase(),i=s.filter(a=>{var o,l,c,d,u;return((o=a.title)==null?void 0:o.toLowerCase().includes(r))||((l=a.referenceNumber)==null?void 0:l.toLowerCase().includes(r))||((c=a.description)==null?void 0:c.toLowerCase().includes(r))||((d=a.category)==null?void 0:d.toLowerCase().includes(r))||((u=a.entity)==null?void 0:u.toLowerCase().includes(r))});return console.log(" Search results:",i.length),i}catch(s){throw console.error(" Error searching manufactured products:",s),new Error(`     : ${s.message}`)}}static async getManufacturedProductsByStatus(e){try{console.log(" Loading manufactured products by status:",e);const s=st(Pe(ae,this.COLLECTION_NAME),xt("status","==",e),as("createdAt","desc")),r=await qe(s),i=[];return r.forEach(a=>{var l,c,d,u,f,p;const o=a.data();i.push({id:a.id,internalId:o.internalId||Ct("MANUFACTURED_PRODUCT"),...o,createdAt:((d=(c=(l=o.createdAt)==null?void 0:l.toDate)==null?void 0:c.call(l))==null?void 0:d.toISOString())||new Date().toISOString(),updatedAt:((p=(f=(u=o.updatedAt)==null?void 0:u.toDate)==null?void 0:f.call(u))==null?void 0:p.toISOString())||new Date().toISOString()})}),console.log(" Loaded manufactured products by status:",i.length),i}catch(s){throw console.error(" Error loading manufactured products by status:",s),new Error(`    : ${s.message}`)}}static validateManufacturedProductData(e){const s={};return(!e.title||!e.title.trim())&&(s.title="  "),(!e.referenceNumber||!e.referenceNumber.trim())&&(s.referenceNumber="  "),(!e.entity||!e.entity.trim())&&(s.entity="  "),e.submissionDeadline||(s.submissionDeadline="   "),e.estimatedValue&&isNaN(parseFloat(e.estimatedValue))&&(s.estimatedValue="      "),s}}Ys(ci,"COLLECTION_NAME","manufacturedProducts");const Li=Object.freeze(Object.defineProperty({__proto__:null,ManufacturedProductService:ci},Symbol.toStringTag,{value:"Module"}));function s$(){var cs,Os,vs;const[n,e]=h.useState(!1),{isTimelineVisible:s}=Ut(),r=kt(),i=Xr(),{tenderId:a}=Dn(),[o,l]=h.useState(0),[c,d]=h.useState(0),[u,f]=h.useState(0),[p,j]=h.useState(!1),[L,R]=h.useState(!1),[D,y]=h.useState(!1),{tenderData:T,tenderItems:x,loading:S,error:A,lastSync:Q,subtotal:q,estimatedValue:B,grandTotal:$}=U0(a,!0),[H,te]=h.useState(0),[G,F]=h.useState(""),X=(cs=i.state)==null?void 0:cs.tender,ue=((Os=i.state)==null?void 0:Os.fromTracking)&&X,Y=((vs=i.state)==null?void 0:vs.readOnly)||!1,[z,O]=h.useState(null),[E,k]=h.useState([]),[b,N]=h.useState([]),[I,P]=h.useState(!1),_=ue?z||X:T,C=ue?E:x,U={estimatedValue:(_==null?void 0:_.estimatedValue)||B||0,tax:(_==null?void 0:_.tax)||0,vat:(_==null?void 0:_.vat)||0,grandTotal:(_==null?void 0:_.grandTotal)||$||0,subtotal:ue?C.reduce((Z,v)=>Z+(parseFloat(v.totalPrice)||0),0):q||0},[w,W]=h.useState(!1),[ie,de]=h.useState([]),[ne,ye]=h.useState(!1),[pe,be]=h.useState(!1),[xe,Ee]=h.useState(!1),Re=()=>{e(!n)},fe=Z=>new Promise((v,se)=>{const re=new Image;re.crossOrigin="anonymous",re.onload=()=>{const J=document.createElement("canvas"),he=J.getContext("2d");J.width=re.width,J.height=re.height,he.drawImage(re,0,0),v(J.toDataURL("image/png"))},re.onerror=()=>se("Failed to load image"),re.src=window.location.origin+Z}),Ve=async()=>{const Z=window.open("","_blank");try{const[v,se,re,J,he]=await Promise.all([fe("/assets/images/Header.png"),fe("/assets/images/Logo.png"),fe("/assets/images/Footer.png"),fe("/assets/images/Signature.png"),fe("/assets/images/Stamp.png")]);console.log(" All images loaded successfully for PDF");const Se=C.reduce((Ie,oe,Te)=>{const Ne=parseFloat((oe.totalPrice||0).toFixed(1));let we=Ne;if(p){const _e=oe.internalId||Te,mt=$e()[_e];if(mt)if(mt.type==="percentage"){const pt=parseFloat((Ne*(mt.value/100)).toFixed(10));we=parseFloat((Ne+pt).toFixed(10))}else{const pt=parseFloat((mt.value||0).toFixed(10));we=parseFloat((Ne+pt).toFixed(10))}}else if(c>0){const _e=parseFloat((Ne*(Kt/100)).toFixed(10));we=parseFloat((Ne+_e).toFixed(10))}else if(o>0){const _e=parseFloat((Ne*(Kt/100)).toFixed(10));we=parseFloat((Ne+_e).toFixed(10))}return we=parseFloat(we.toFixed(1)),Ie+we},0),me=Se*.15,ge=it,ke=`
      <!DOCTYPE html>
      <html dir="rtl" lang="ar">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>  ${(_==null?void 0:_.entity)||" "}</title>
        <style>
          @media print {
            @page {
              margin: 0;
              size: A4;
              
              /* Enhanced Multi-Page Support */
              @top-center {
                content: element(running-header);
                width: 100%;
              }
              @bottom-center {
                content: element(running-footer);
                width: 100%;
              }
            }
            
            /* Force header to repeat on every page - PRESERVING EXACT LAYOUT */
            .header {
              position: running(running-header);
            }
            
            /* Force footer to repeat on every page - PRESERVING EXACT LAYOUT */  
            .footer {
              position: running(running-footer);
            }
            
            /* Content area spacing to avoid header/footer overlap */
            .table-container {
              padding-top: 20px !important;
              padding-bottom: 20px !important;
            }
            
            /* Smart page breaks */
            .table-container table {
              page-break-inside: auto;
            }
            
            .table-container thead {
              page-break-after: avoid;
            }
            
            .table-container tbody tr {
              page-break-inside: avoid;
            }
            body { 
              margin: 0 !important; 
              padding: 0 !important;
              background: white !important;
              -webkit-print-color-adjust: exact;
              print-color-adjust: exact;
              position: relative !important;
              min-height: 100vh !important;
            }
            .header {
              margin: 0 !important;
              padding: 0 !important;
              padding-bottom: 20px !important;
            }
            .header-image {
              margin: 0 !important;
              padding: 0 !important;
              width: 100% !important;
              max-width: none !important;
              display: block !important;
            }
            .footer {
              text-align: center;
              margin-top: 30px !important;
              padding: 0 !important;
              padding-top: 22px !important;
              position: absolute !important;
              bottom: 0px !important;
              left: 0 !important;
              right: 0 !important;
              width: 100% !important;
              background: white !important;
              z-index: 999 !important;
            }
            .footer::before {
              content: '';
              position: absolute;
              top: 0;
              left: 0;
              right: 0;
              height: 4px;
              background: white !important;
              z-index: 1000;
            }
            .footer-image {
              margin: 0 !important;
              padding: 0 !important;
              width: 100% !important;
              max-width: none !important;
              display: block !important;
              height: 50% !important;
              transform: scaleY(0.5) !important;
            }
            .logo-container {
              margin: 0 !important;
              padding: 0 !important;
              text-align: left;
              position: relative;
              direction: ltr !important;
            }
            .logo-image {
              width: auto;
              height: 80px;
              margin: 0 !important;
              margin-left: 20px !important;
              margin-top: -30px !important;
              padding: 0 !important;
              display: block;
              transform: scale(1.4) !important;
              transform-origin: left top !important;
            }
            .table-container {
              margin: 20px 15px !important;
              padding: 0 !important;
              border-bottom: none !important;
            }
            
            /* Flexible content area that follows table width */
            .flexible-content {
              margin-left: 15px !important;
              margin-right: 15px !important;
              position: relative;
            }
            table {
              border: none !important;
            }
            .no-print { display: none !important; }
            .table-header {
              background: #a9a9a9 !important;
              -webkit-print-color-adjust: exact;
              print-color-adjust: exact;
            }
            .total-row {
              background: #e0e0e0 !important;
              -webkit-print-color-adjust: exact;
              print-color-adjust: exact;
              border-bottom: none !important;
            }
          }
          
          body {
            font-family: 'Arial', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            direction: rtl;
            margin: 0;
            padding: 20px;
            background: white;
            color: #000;
            font-size: 12px;
            line-height: 1.4;
          }
          
          .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 0;
            padding-bottom: 20px;
            border-bottom: 2px solid #000;
            position: relative;
          }
          
          .header h1 {
            color: #000;
            margin: 0;
            margin-right: 20px;
            font-size: 18px;
            font-weight: bold;
            text-align: right;
            direction: rtl;
          }
          
          .header .tender-info {
            margin-top: 10px;
            font-size: 16px;
            color: #000;
            font-weight: normal;
            text-align: right;
            direction: rtl;
            margin-right: 20px;
          }
          
          .header-image {
            width: 100%;
            height: auto;
            margin: 0;
            margin-bottom: 15px;
            display: block;
          }
          
          .table-container {
            margin: 20px 0;
          }
          
          table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
            font-size: 12px;
            border-left: 2px solid #000;
            border-right: 2px solid #000;
            border-top: none;
            border-bottom: none;
          }
          
          .table-header {
            background: #a9a9a9;
            color: #000;
            font-weight: bold;
          }
          
          .table-header th {
            padding: 10px 8px;
            text-align: center;
            border: 1px solid #000;
            font-size: 12px;
            font-weight: bold;
          }
          
          .table-row {
            background: white;
          }
          
          .table-row:nth-child(even) {
            background: white;
          }
          
          .table-row td {
            padding: 8px 6px;
            text-align: center;
            border: 1px solid #000;
            color: #000;
            font-size: 12px;
            font-weight: normal;
          }
          
          .item-name {
            text-align: right !important;
            font-weight: normal;
            max-width: 200px;
            word-wrap: break-word;
            padding-right: 8px;
          }
          
          .number {
            font-family: 'Arial', 'Segoe UI', sans-serif;
            font-weight: normal;
            color: #000;
          }
          
          .total-row {
            background: #e0e0e0;
            font-weight: bold;
            color: #000;
          }
          
          .total-row td {
            padding: 10px 8px;
            font-size: 12px;
            font-weight: bold;
            border: 1px solid #000;
            text-align: right !important;
          }
          
          .footer {
            margin-top: 30px;
            text-align: center;
            color: #000;
            padding: 15px 0;
            font-size: 10px;
            font-weight: normal;
            border-top: 1px solid #000;
          }
        </style>
      </head>
      <body>
        
        <div class="header">
          <img src="${v}" alt="Header" class="header-image" />
          <div class="logo-container">
            <img src="${se}" alt="Logo" class="logo-image" />
          </div>
          <div style="margin-bottom: 30px; position: relative; text-align: right; margin-right: 20px; direction: rtl;">
            <div style="position: absolute; left: 150px; top: -25px; font-size: 12px; font-weight: normal; color: #000; direction: rtl;">
               / ${_!=null&&_.submissionDeadline?(()=>{try{let Ie;if(_.submissionDeadline.seconds?Ie=new Date(_.submissionDeadline.seconds*1e3):_.submissionDeadline.toDate?Ie=_.submissionDeadline.toDate():Ie=new Date(_.submissionDeadline),isNaN(Ie.getTime()))return" ";const oe=String(Ie.getDate()).padStart(2,"0"),Te=String(Ie.getMonth()+1).padStart(2,"0"),Ne=Ie.getFullYear();return oe+"/"+Te+"/"+Ne}catch(Ie){return console.error(" Date parsing error:",Ie)," "}})():" "}
            </div>
            <span style="font-size: 18px; font-weight: bold; color: #000;"> / ${(_==null?void 0:_.entity)||" "}</span>
            <div style="position: absolute; left: 163px; top: 0; font-size: 18px; font-weight: bold; color: #000; direction: ltr;"></div>
          </div>
          <div class="tender-info">      ${(_==null?void 0:_.title)||At}</div>
        </div>
        
        <div class="table-container">
          <table>
            <thead class="table-header">
              <tr>
                <th style="width: 30px;">#</th>
                <th style="width: 200px;"> </th>
                <th style="width: 70px;"></th>
                <th style="width: 90px;"> </th>
                <th style="width: 120px;"> </th>
              </tr>
            </thead>
            <tbody>
              ${C.map((Ie,oe)=>{const Te=parseFloat(Ie.quantity)||1,Ne=parseFloat(Ie.totalPrice)||0,we=parseFloat(Ne.toFixed(1));let _e=we;if(p){const mt=Ie.internalId||oe,Ye=$e()[mt];if(Ye)if(Ye.type==="percentage"){const Yt=parseFloat((we*(Ye.value/100)).toFixed(10));_e=parseFloat((we+Yt).toFixed(10))}else{const Yt=parseFloat((Ye.value||0).toFixed(10));_e=parseFloat((we+Yt).toFixed(10))}}else if(c>0){const mt=parseFloat((we*(Kt/100)).toFixed(10));_e=parseFloat((we+mt).toFixed(10))}else if(o>0){const mt=parseFloat((we*(Kt/100)).toFixed(10));_e=parseFloat((we+mt).toFixed(10))}_e=parseFloat(_e.toFixed(1));const Ge=Te>0?_e/Te:0;return`
                  <tr class="table-row">
                    <td class="number">${oe+1}</td>
                    <td class="item-name">${Ie.materialName||Ie.name||" "}</td>
                    <td class="number">${Te.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2})}</td>
                    <td class="number">${Ge.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})}</td>
                    <td class="number">${_e.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})}</td>
                  </tr>
                `}).join("")}
            </tbody>
            <tfoot>
              <tr style="background: #e0e0e0; font-weight: bold; color: #000;">
                <td colspan="4" style="padding: 10px 8px; font-size: 12px; font-weight: bold; border: 1px solid #000; text-align: right;"> :</td>
                <td style="padding: 10px 8px; font-size: 12px; font-weight: bold; border: 1px solid #000; text-align: center !important; vertical-align: middle; width: 120px; margin: 0 auto; display: table-cell;">${Se.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})}</td>
              </tr>
              <tr style="background: #e0e0e0; font-weight: bold; color: #000;">
                <td colspan="4" style="padding: 10px 8px; font-size: 12px; font-weight: bold; border: 1px solid #000; text-align: right;">   (15%):</td>
                <td style="padding: 10px 8px; font-size: 12px; font-weight: bold; border: 1px solid #000; text-align: center !important; vertical-align: middle; width: 120px; margin: 0 auto; display: table-cell;">${me.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})}</td>
              </tr>
              <tr style="background: #e0e0e0; font-weight: bold; color: #000;">
                <td colspan="4" style="padding: 10px 8px; font-size: 12px; font-weight: bold; border: 1px solid #000; text-align: right;"> :</td>
                <td style="padding: 10px 8px; font-size: 12px; font-weight: bold; border: 1px solid #000; text-align: center !important; vertical-align: middle; width: 120px; margin: 0 auto; display: table-cell;">${ge.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})}</td>
              </tr>
            </tfoot>
          </table>
        </div>
        
        <div class="flexible-content">
          <div style="text-align: center; margin: 30px 0; font-size: 16px; color: #000; direction: rtl;">
               ,,
          </div>
          
          <div style="text-align: right; margin-right: 8%; margin-top: 40px; font-size: 16px; font-weight: bold; color: #000; direction: rtl;">
               
          </div>
          
          <div style="position: relative; margin-top: 0; margin-bottom: 0; height: 80px;">
            <img src="${J}" alt="Signature" style="position: absolute; right: 8%; height: 80px; width: auto; transform: scale(0.7); transform-origin: right center;" />
            <img src="${he}" alt="Stamp" style="position: absolute; left: 20%; height: 80px; width: auto; transform: scale(1.8); transform-origin: left center;" />
          </div>
          
          <div style="text-align: right; margin-right: 8%; font-size: 16px; color: #000; direction: rtl;">
               
          </div>
        </div>
        
        <div class="footer">
          <img src="${re}" alt="Footer" class="footer-image" />
        </div>
        
      </body>
      </html>
    `;Z.document.write(ke),Z.document.close(),Z.focus(),setTimeout(()=>{Z.print()},500)}catch(v){console.error(" PDF Generation Error:",v),alert("    .    .");const se=`
        <!DOCTYPE html>
        <html dir="rtl" lang="ar">
        <head>
          <meta charset="UTF-8">
          <title>  ${(_==null?void 0:_.entity)||" "}</title>
        </head>
        <body style="font-family: Arial; direction: rtl; margin: 20px;">
          <h1>  ${(_==null?void 0:_.entity)||" "}</h1>
          <p>    .    .</p>
        </body>
        </html>
      `;Z.document.write(se),Z.document.close(),Z.focus(),setTimeout(()=>{Z.print()},500)}},$e=()=>{try{return G?JSON.parse(G):{}}catch{return{}}},et=(Z,v,se,re="fixed")=>{const J=Z.internalId||v,he=$e();he[J]={value:parseFloat(se)||0,type:re,itemTotal:Z.totalPrice||0};const Se=Object.values(he).reduce((ge,ke)=>{const Ie=ke.value||0,oe=ke.type||"fixed",Te=ke.itemTotal||0;return parseFloat(oe==="percentage"?(ge+Te*Ie/100).toFixed(10):(ge+Ie).toFixed(10))},0),me=JSON.stringify(he);F(me),te(Se),console.log(" Individual profit updated (state only):",{item:J,value:se,type:re,newTotal:Se})},ze=(Z,v)=>{var J;const se=Z.internalId||v;return((J=$e()[se])==null?void 0:J.value)||""},tt=(Z,v)=>{var J;const se=Z.internalId||v;return((J=$e()[se])==null?void 0:J.type)||"fixed"},rt=async Z=>{const v=Z.target.files;if(!v||v.length===0)return;const se=v[0];console.log(" TENDER STUDY: Starting document upload for tender:",a);try{ye(!0);const re=await Ss.uploadFile(se,"tender-documents");console.log(" TENDER STUDY: File uploaded successfully:",re);const J={id:`doc_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,fileName:se.name,originalFileName:se.name,fileType:se.type,fileSize:se.size,fileURL:re.downloadURL,uploadedAt:new Date().toISOString(),uploadDate:new Date().toISOString(),tenderId:a,tenderTitle:(_==null?void 0:_.title)||" ",tenderReferenceNumber:(_==null?void 0:_.referenceNumber)||" "};if(de(he=>[...he,J]),a&&a!=="new")try{const he=[...ie,J];await tn.updateTenderDocuments(a,he),console.log(" TENDER STUDY: Document saved to Firebase")}catch(he){console.error(" TENDER STUDY: Error saving document to Firebase:",he)}console.log(" TENDER STUDY: Document upload completed")}catch(re){console.error(" TENDER STUDY: Error uploading document:",re)}finally{ye(!1),Z.target.value=""}},bt=async Z=>{try{be(!0),console.log(" TENDER STUDY: Deleting document:",Z.fileName),await bs.moveToTrash(Z,"tenderDocument");const v=ie.filter(se=>se.id!==Z.id);if(de(v),a&&a!=="new")try{await tn.updateTenderDocuments(a,v),console.log(" TENDER STUDY: Document removed from Firebase")}catch(se){console.error(" TENDER STUDY: Error updating Firebase after delete:",se)}console.log(" TENDER STUDY: Document deleted successfully")}catch(v){console.error(" TENDER STUDY: Error deleting document:",v)}finally{be(!1)}},At=(_==null?void 0:_.title)||` ${a}`;h.useEffect(()=>{ue&&X&&!z&&(console.log(" SENIOR REACT: DEEPTHINK trigger - Starting complete data load"),console.log(" Available data sources:"),console.log("  - tenderId:",a),console.log("  - navigationTenderData.id:",X.id),console.log("  - navigationTenderData.internalId:",X.internalId),console.log("  - navigationTenderData.tenderId:",X.tenderId),console.log("  - navigationTenderData.referenceNumber:",X.referenceNumber),ns())},[ue,X,z]);const ns=async()=>{var Z,v,se,re;try{P(!0),console.log(" SENIOR REACT: LIGHTNING FAST parallel data loading for:",a),console.log(" Navigation tender data:",X);let J=null,he=[],Se=[];const me=[a,X.id,X.internalId,X.tenderId,X.referenceNumber].filter(Boolean);console.log(" LIGHTNING PARALLEL: Starting all strategies simultaneously");const ge=await Promise.allSettled([_r.getTenderWithItems(a,!1).catch(()=>null),(async()=>{const{doc:Ie,getDoc:oe}=await Xe(async()=>{const{doc:we,getDoc:_e}=await Promise.resolve().then(()=>Tl);return{doc:we,getDoc:_e}},void 0),{db:Te}=await Xe(async()=>{const{db:we}=await Promise.resolve().then(()=>_l);return{db:we}},void 0),Ne=await oe(Ie(Te,"tenders",a));return Ne.exists()?{id:Ne.id,...Ne.data()}:null})().catch(()=>null),(async()=>{const{collection:Ie,query:oe,where:Te,getDocs:Ne}=await Xe(async()=>{const{collection:pt,query:Ye,where:Yt,getDocs:je}=await Promise.resolve().then(()=>Tl);return{collection:pt,query:Ye,where:Yt,getDocs:je}},void 0),{db:we}=await Xe(async()=>{const{db:pt}=await Promise.resolve().then(()=>_l);return{db:pt}},void 0),_e=oe(Ie(we,"tenderItems"),Te("tenderId","==",a)),Ge=await Ne(_e),mt=[];return Ge.forEach(pt=>mt.push({id:pt.id,...pt.data()})),mt.length>0?{items:mt}:null})().catch(()=>null),...me.slice(1).map(Ie=>_r.getTenderWithItems(Ie,!1).catch(()=>null)),(async()=>{const{collection:Ie,query:oe,where:Te,getDocs:Ne,limit:we}=await Xe(async()=>{const{collection:Ge,query:mt,where:pt,getDocs:Ye,limit:Yt}=await Promise.resolve().then(()=>Tl);return{collection:Ge,query:mt,where:pt,getDocs:Ye,limit:Yt}},void 0),{db:_e}=await Xe(async()=>{const{db:Ge}=await Promise.resolve().then(()=>_l);return{db:Ge}},void 0);if(X.entity){const Ge=oe(Ie(_e,"tenders"),Te("entity","==",X.entity),we(5)),mt=await Ne(Ge);for(const pt of mt.docs){const Ye={id:pt.id,...pt.data()};if(Ye.referenceNumber===X.referenceNumber||Ye.title===X.title)return Ye}}return null})().catch(()=>null)]);console.log(" LIGHTNING PARALLEL: All strategies completed, processing results...");for(const[Ie,oe]of ge.entries())if(oe.status==="fulfilled"&&oe.value){const Te=oe.value;if(!J&&(Te.title||Te.entity||Te.id)&&(J=Te,console.log(` LIGHTNING: Strategy ${Ie+1} provided main data`)),!he.length&&((Z=Te.items)==null?void 0:Z.length)>0&&(he=Te.items,console.log(` LIGHTNING: Strategy ${Ie+1} provided ${Te.items.length} items`)),!Se.length&&((v=Te.documents)==null?void 0:v.length)>0&&(Se=Te.documents,console.log(` LIGHTNING: Strategy ${Ie+1} provided ${Te.documents.length} documents`)),J&&Se.length>0&&he.length>0){console.log(" LIGHTNING: All data found, stopping early for maximum speed");break}}const ke={...J||X,stage:X.stage,progress:X.progress,statusHistory:X.statusHistory,priority:X.priority,isSelectedTender:X.isSelectedTender,items:he,documents:Se};console.log(" FINAL RESULT - Items found:",he.length),console.log(" FINAL RESULT - Documents found:",Se.length),console.log(" SENIOR REACT: COMPLETE DATA ANALYSIS:"),console.log("  - Complete tender data loaded:",!!J),console.log("  - Tender title:",(J==null?void 0:J.title)||"N/A"),console.log("  - Tender entity:",(J==null?void 0:J.entity)||"N/A"),console.log("  - Estimated value:",(J==null?void 0:J.estimatedValue)||0),console.log("  - Items array length:",((se=J==null?void 0:J.items)==null?void 0:se.length)||0),console.log("  - Documents array length:",((re=J==null?void 0:J.documents)==null?void 0:re.length)||0),console.log("  - Items found via strategies:",he.length),console.log("  - Documents found via strategies:",Se.length),console.log(" SENIOR REACT: DEEPTHINK data loading completed successfully"),he.length===0&&(console.log(" SENIOR REACT: No items found - this tender may not have any items added yet"),console.log(" SENIOR REACT: This is NORMAL behavior for tenders without items")),O(ke),k(he),N(Se)}catch(J){console.error(" SENIOR REACT: All strategies failed:",J),O(X),k([]),N([])}finally{P(!1)}};h.useEffect(()=>{ue?(console.log(" TENDER STUDY: Using tender data from TenderTracking navigation:",X),console.log(" TENDER STUDY: Items from tracking:",C.length)):A?console.error(" TENDER STUDY: Error loading tender data:",A):x&&x.length>0&&console.log(" TENDER STUDY: Tender items loaded via shared service:",x.length)},[x,A,ue,X,C]);const Ht=parseFloat(U.grandTotal||U.estimatedValue||U.subtotal||0),is=parseFloat((Ht*(c/100)).toFixed(10)),Oe=p?H:parseFloat((o+is).toFixed(10)),it=parseFloat((Ht+Oe).toFixed(10)),Kt=Ht>0?parseFloat((Oe/Ht*100).toFixed(10)):0;h.useEffect(()=>{Q&&console.log(" TENDER STUDY: Data synchronized at:",Q)},[Q]),h.useEffect(()=>{!x||x.length===0?console.log(" TENDER STUDY: Waiting for items via shared service..."):console.log(" TENDER STUDY: Items loaded via shared service:",x.length)},[a,x,T]),h.useEffect(()=>{if(!S&&(o>0||c>0||H>0||G||p)){const Z=setTimeout(()=>{xs()},1e3);return()=>clearTimeout(Z)}},[o,c,H,G,p,S]),h.useEffect(()=>{D||zs()},[a,D]),h.useEffect(()=>{if(ue&&b.length>0){console.log(" TENDER STUDY: Using documents from tracking data:",b.length),de(b);return}if(_!=null&&_.documents&&Array.isArray(_.documents)&&_.documents.length>0){console.log(" TENDER STUDY: Using documents from shared service"),de(_.documents);return}(async()=>{console.log(" TENDER STUDY: No documents found, starting with empty list"),Ee(!1)})()},[a,_,ue,b]);const zs=async()=>{try{console.log(" TENDER STUDY: Loading data for tender:",a),P(!0);const Z=await Hl.getTenderStudy(a);if(Z.success&&Z.data.profitCalculation){const{profitCalculation:v}=Z.data;l(v.fixedProfit||0),d(v.percentageProfit||0),f(v.perItemProfit||0),j(v.showPerItemInput||!1),te(v.totalIndividualProfit||0),F(v.individualProfitData||""),y(!0),console.log(" TENDER STUDY: Data loaded successfully"),console.log(" INDIVIDUAL PROFIT DATA LOADED:",v.individualProfitData),console.log(" TOTAL INDIVIDUAL PROFIT LOADED:",v.totalIndividualProfit)}else l(0),d(0),f(0),j(!1),te(0),F(""),y(!0),console.log(" TENDER STUDY: No existing profit data found - initialized with defaults"),console.log(" INDIVIDUAL PROFIT DATA INITIALIZED:",""),console.log(" TOTAL INDIVIDUAL PROFIT INITIALIZED:",0)}catch(Z){console.error(" TENDER STUDY: Error loading data:",Z),l(0),d(0),f(0),j(!1),te(0),F(""),y(!0)}finally{P(!1)}},xs=async()=>{try{R(!0),console.log(" TENDER STUDY: Saving data for tender:",a);const Z={fixedProfit:o,percentageProfit:c,perItemProfit:u,showPerItemInput:p,totalIndividualProfit:H,individualProfitData:G,baseCost:Ht,totalProfit:Oe,finalPrice:it,profitMargin:Kt};console.log(" SAVING INDIVIDUAL PROFIT DATA:",G),console.log(" TOTAL INDIVIDUAL PROFIT:",H);const v=await Hl.saveTenderStudy(a,Z);v.success?console.log(" TENDER STUDY: Data saved successfully"):console.error(" TENDER STUDY: Save failed:",v.error)}catch(Z){console.error(" TENDER STUDY: Error saving data:",Z)}finally{R(!1)}};return t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[t.jsx(Rt,{onToggle:Re}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!s?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",style:{height:"calc(100vh - 70px)",display:"flex",flexDirection:"column"},children:[t.jsxs("div",{style:{position:"sticky",top:0,zIndex:20,backgroundColor:"white",borderBottom:"1px solid #e9ecef",flexShrink:0},children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("span",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-kanban lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:" "})]})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"px-3 py-2",children:t.jsxs("div",{className:"text-center",style:{marginTop:"20px",marginBottom:"12px",position:"relative"},children:[t.jsxs("div",{className:"d-flex align-items-center justify-content-center mb-1",children:[t.jsx("i",{className:"bi bi-file-text me-3 text-primary",style:{fontSize:"2.2rem"}}),t.jsxs("h4",{className:"mb-0 text-primary",children:["  ",(_==null?void 0:_.entity)||" "]}),L&&t.jsx("div",{className:"ms-3",children:t.jsx("div",{className:"spinner-border spinner-border-sm text-success",role:"status",children:t.jsx("span",{className:"visually-hidden",children:" ..."})})})]}),t.jsx("button",{className:"btn btn-outline-info d-flex align-items-center",onClick:()=>W(!0),style:{position:"absolute",left:s?"-870px":"-1250px",top:"50%",transform:"translateY(-50%)",borderRadius:"25px",padding:"8px 16px",fontSize:"0.9rem",fontWeight:"600",transition:"all 0.3s ease",border:"2px solid #17a2b8"},onMouseOver:Z=>{Z.currentTarget.style.transform="translateY(-50%) scale(1.05)",Z.currentTarget.style.boxShadow="0 4px 15px rgba(23, 162, 184, 0.3)"},onMouseOut:Z=>{Z.currentTarget.style.transform="translateY(-50%) scale(1)",Z.currentTarget.style.boxShadow="none"},children:xe?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status",children:t.jsx("span",{className:"visually-hidden",children:"..."})})," ..."]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-folder-open me-2",style:{fontSize:"1.1rem"}}),"  (",ie.length,")"]})}),t.jsx("p",{className:"text-muted mb-0",style:{fontSize:"1rem",marginTop:"-20px"},children:At})]})})]}),t.jsxs("div",{className:"app-content-area",style:{padding:"8px 20px",flex:1,overflowY:"auto"},children:[t.jsxs("div",{className:"row g-4 justify-content-center",style:{marginTop:"15px"},children:[t.jsx("div",{className:"col-lg-3 col-md-6",children:t.jsxs("div",{className:"p-3 bg-white rounded-3 shadow-sm h-100 border border-primary border-opacity-25",children:[t.jsx("div",{className:"text-center mb-2",children:t.jsx("i",{className:"bi bi-currency-exchange text-primary",style:{fontSize:"1.8rem"}})}),t.jsx("div",{className:"fw-bold text-dark mb-1 text-center",style:{fontSize:"0.95rem"},children:"  "}),t.jsxs("div",{className:"text-primary fw-bold text-center",style:{fontSize:"1.4rem"},children:[Ht.toLocaleString(void 0,{minimumFractionDigits:1,maximumFractionDigits:1})," ."]})]})}),t.jsx("div",{className:"col-lg-3 col-md-6",children:t.jsxs("div",{className:"p-3 bg-white rounded-3 shadow-sm h-100 border border-success border-opacity-25",children:[t.jsx("div",{className:"text-center mb-2",children:t.jsx("i",{className:"bi bi-plus-circle text-success",style:{fontSize:"1.8rem"}})}),t.jsx("div",{className:"fw-bold text-dark mb-1 text-center",style:{fontSize:"0.95rem"},children:" "}),t.jsxs("div",{className:"text-success fw-bold text-center",style:{fontSize:"1.4rem"},children:[Oe.toLocaleString(void 0,{minimumFractionDigits:1,maximumFractionDigits:1})," ."]})]})}),t.jsx("div",{className:"col-lg-3 col-md-6",children:t.jsxs("div",{className:"p-3 bg-white rounded-3 shadow-sm h-100 border border-warning border-opacity-25",children:[t.jsx("div",{className:"text-center mb-2",children:t.jsx("i",{className:"bi bi-cash-coin text-warning",style:{fontSize:"1.8rem"}})}),t.jsx("div",{className:"fw-bold text-dark mb-1 text-center",style:{fontSize:"0.95rem"},children:" "}),t.jsxs("div",{className:"text-warning fw-bold text-center",style:{fontSize:"1.4rem"},children:[it.toLocaleString(void 0,{minimumFractionDigits:1,maximumFractionDigits:1})," ."]})]})}),t.jsx("div",{className:"col-lg-3 col-md-6",children:t.jsxs("div",{className:"p-3 bg-white rounded-3 shadow-sm h-100 border border-info border-opacity-25",children:[t.jsx("div",{className:"text-center mb-2",children:t.jsx("i",{className:"bi bi-pie-chart text-info",style:{fontSize:"1.8rem"}})}),t.jsx("div",{className:"fw-bold text-dark mb-1 text-center",style:{fontSize:"0.95rem"},children:" "}),t.jsxs("div",{className:"text-info fw-bold text-center",style:{fontSize:"1.4rem"},children:[Kt.toFixed(1),"%"]})]})})]}),t.jsxs("div",{className:"row g-4 mt-4",children:[t.jsx("div",{className:"col-12",children:t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header bg-light",children:t.jsxs("h5",{className:"mb-0 text-primary",children:[t.jsx("i",{className:"bi bi-clipboard-data me-2"})," "]})}),t.jsx("div",{className:"card-body",children:t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-4",children:[t.jsxs("p",{children:[t.jsx("strong",{children:" :"})," ",(_==null?void 0:_.referenceNumber)||a]}),t.jsxs("p",{children:[t.jsx("strong",{children:":"})," ",At]}),t.jsxs("p",{children:[t.jsx("strong",{children:":"})," ",t.jsx("span",{className:"badge bg-warning",children:" "})]})]}),t.jsx("div",{className:"col-md-4",children:_&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{children:[t.jsx("strong",{children:":"})," ",_.entity||" "]}),t.jsxs("p",{children:[t.jsx("strong",{children:"  :"})," ",_.submissionDeadline?(()=>{try{let Z;if(_.submissionDeadline.seconds?Z=new Date(_.submissionDeadline.seconds*1e3):_.submissionDeadline.toDate?Z=_.submissionDeadline.toDate():Z=new Date(_.submissionDeadline),isNaN(Z.getTime()))return" ";const v=String(Z.getDate()).padStart(2,"0"),se=String(Z.getMonth()+1).padStart(2,"0"),re=Z.getFullYear();return v+"/"+se+"/"+re}catch(Z){return console.error(" Date parsing error:",Z)," "}})():" "]}),t.jsxs("p",{children:[t.jsx("strong",{children:" :"})," ",_.estimatedValue?parseFloat(_.estimatedValue).toLocaleString()+" .":" "]})]})}),t.jsx("div",{className:"col-md-4",children:t.jsx("div",{className:"d-flex flex-column align-items-center justify-content-center h-100",style:{minHeight:"120px",marginLeft:"100px"},children:t.jsx("div",{className:"text-center",children:t.jsxs("button",{onClick:Ve,className:"btn btn-link p-0 d-flex flex-column align-items-center",style:{border:"none",background:"none",textDecoration:"none",transition:"transform 0.2s ease, opacity 0.2s ease"},onMouseEnter:Z=>{Z.target.style.transform="scale(1.1)",Z.target.style.opacity="0.8"},onMouseLeave:Z=>{Z.target.style.transform="scale(1)",Z.target.style.opacity="1"},title:"    ",children:[t.jsx("i",{className:"bi bi-file-earmark-pdf text-danger",style:{fontSize:"3rem",marginBottom:"0.5rem"}}),t.jsx("div",{className:"fw-bold text-dark",children:" "})]})})})})]})})]})}),t.jsx("div",{className:"col-12",children:t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header bg-light",children:t.jsxs("h5",{className:"mb-0 text-success",children:[t.jsx("i",{className:"bi bi-calculator me-2"})," "]})}),t.jsx("div",{className:"card-body",style:{padding:"2rem"},children:t.jsxs("div",{className:"row g-4",children:[t.jsx("div",{className:"col-lg-4 col-md-6",children:t.jsx("div",{className:"card border-success h-100 shadow-sm",style:{borderWidth:"2px",borderRadius:"15px",transition:"all 0.3s ease",minHeight:"280px"},onMouseOver:Z=>{Z.currentTarget.style.transform="translateY(-5px)",Z.currentTarget.style.boxShadow="0 8px 25px rgba(40, 167, 69, 0.2)"},onMouseOut:Z=>{Z.currentTarget.style.transform="translateY(0)",Z.currentTarget.style.boxShadow="0 2px 10px rgba(0,0,0,0.1)"},children:t.jsxs("div",{className:"card-body text-center d-flex flex-column justify-content-between",style:{padding:"2rem 1.5rem"},children:[t.jsxs("div",{children:[t.jsx("div",{className:"mb-4",children:t.jsx("div",{className:"rounded-circle bg-success bg-opacity-10 mx-auto d-flex align-items-center justify-content-center",style:{width:"80px",height:"80px"},children:t.jsx("i",{className:"bi bi-currency-dollar text-success",style:{fontSize:"2.5rem"}})})}),t.jsx("h5",{className:"card-title text-success mb-3 fw-bold",children:" "}),t.jsxs("div",{className:"form-floating mb-3",children:[t.jsx("input",{type:"number",className:"form-control text-center border-2 border-success",id:"fixedProfit",placeholder:"0",step:"0.01",value:o,readOnly:Y,onChange:Y?void 0:Z=>{const v=parseFloat(Z.target.value)||0;l(v),v>0&&(d(0),j(!1))},style:{fontSize:"1.1rem",fontWeight:"600",borderRadius:"10px",height:"60px",display:"flex",alignItems:"center",justifyContent:"center"}}),t.jsx("label",{htmlFor:"fixedProfit",className:"text-success fw-semibold",children:" (.)"})]})]}),t.jsx("small",{className:"text-muted",style:{fontSize:"0.9rem"},children:"    "})]})})}),t.jsx("div",{className:"col-lg-4 col-md-6",children:t.jsx("div",{className:"card border-warning h-100 shadow-sm",style:{borderWidth:"2px",borderRadius:"15px",transition:"all 0.3s ease",minHeight:"280px"},onMouseOver:Z=>{Z.currentTarget.style.transform="translateY(-5px)",Z.currentTarget.style.boxShadow="0 8px 25px rgba(255, 193, 7, 0.2)"},onMouseOut:Z=>{Z.currentTarget.style.transform="translateY(0)",Z.currentTarget.style.boxShadow="0 2px 10px rgba(0,0,0,0.1)"},children:t.jsxs("div",{className:"card-body text-center d-flex flex-column justify-content-between",style:{padding:"2rem 1.5rem"},children:[t.jsxs("div",{children:[t.jsx("div",{className:"mb-4",children:t.jsx("div",{className:"rounded-circle bg-warning bg-opacity-10 mx-auto d-flex align-items-center justify-content-center",style:{width:"80px",height:"80px"},children:t.jsx("i",{className:"bi bi-percent text-warning",style:{fontSize:"2.5rem"}})})}),t.jsx("h5",{className:"card-title text-warning mb-3 fw-bold",children:" "}),t.jsxs("div",{className:"form-floating mb-3",children:[t.jsx("input",{type:"number",className:"form-control text-center border-2 border-warning",id:"percentageProfit",placeholder:"0",min:"1",max:"100",step:"1",value:c,readOnly:Y,onChange:Y?void 0:Z=>{const v=parseInt(Z.target.value)||0;d(v),v>0&&(l(0),j(!1))},style:{fontSize:"1.1rem",fontWeight:"600",borderRadius:"10px",height:"60px",display:"flex",alignItems:"center",justifyContent:"center"}}),t.jsx("label",{htmlFor:"percentageProfit",className:"text-warning fw-semibold",children:" (%)"})]})]}),t.jsx("small",{className:"text-muted",style:{fontSize:"0.9rem"},children:"    "})]})})}),t.jsx("div",{className:"col-lg-4 col-md-12",children:t.jsx("div",{className:"card border-info h-100 shadow-sm",style:{borderWidth:"2px",borderRadius:"15px",transition:"all 0.3s ease",minHeight:"280px"},onMouseOver:Z=>{Z.currentTarget.style.transform="translateY(-5px)",Z.currentTarget.style.boxShadow="0 8px 25px rgba(13, 202, 240, 0.2)"},onMouseOut:Z=>{Z.currentTarget.style.transform="translateY(0)",Z.currentTarget.style.boxShadow="0 2px 10px rgba(0,0,0,0.1)"},children:t.jsxs("div",{className:"card-body text-center d-flex flex-column justify-content-between",style:{padding:"2rem 1.5rem"},children:[t.jsxs("div",{children:[t.jsx("div",{className:"mb-4",children:t.jsx("button",{className:"rounded-circle mx-auto d-flex align-items-center justify-content-center border-0",disabled:Y,onClick:Y?void 0:()=>{j(!p),p?(te(0),F("")):(l(0),d(0))},style:{width:"80px",height:"80px",backgroundColor:p?"#0dcaf0":"rgba(13, 202, 240, 0.1)",cursor:Y?"not-allowed":"pointer",opacity:Y?.6:1,transition:"all 0.3s ease"},onMouseOver:Z=>{Y||(Z.currentTarget.style.transform="scale(1.05)")},onMouseOut:Z=>{Y||(Z.currentTarget.style.transform="scale(1)")},children:t.jsx("i",{className:`bi bi-list-ul ${p?"text-white":"text-info"}`,style:{fontSize:"2.5rem"}})})}),t.jsx("h5",{className:"card-title text-info mb-3 fw-bold",children:"  "}),t.jsx("div",{className:"form-floating mb-3",children:p?t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"text",className:"form-control text-center border-2 border-info",id:"individualProfit",readOnly:!0,value:`${H.toLocaleString(void 0,{minimumFractionDigits:1,maximumFractionDigits:1})} .`,style:{fontSize:"1.1rem",fontWeight:"600",borderRadius:"10px",height:"60px",backgroundColor:"#e7f3ff",display:"flex",alignItems:"center",justifyContent:"center"}}),t.jsx("label",{htmlFor:"individualProfit",className:"text-info fw-semibold",children:"  (.)"})]}):t.jsxs("button",{className:"btn btn-info border-2 fw-semibold w-100",disabled:Y,onClick:Y?void 0:()=>{j(!0),l(0),d(0)},style:{fontSize:"1.1rem",fontWeight:"600",borderRadius:"10px",height:"60px",whiteSpace:"nowrap",opacity:Y?.6:1,cursor:Y?"not-allowed":"pointer"},children:[t.jsx("i",{className:"bi bi-gear me-2"})," "]})})]}),t.jsx("small",{className:"text-muted",style:{fontSize:"0.9rem"},children:"     "})]})})})]})})]})}),t.jsx("div",{className:"col-12",children:t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header bg-light",children:t.jsxs("h5",{className:"mb-0 text-info",children:[t.jsx("i",{className:"bi bi-list-check me-2"}),"  (",C.length,")"]})}),t.jsx("div",{className:"card-body",children:C.length===0?t.jsxs("div",{className:"text-center py-4",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-inbox fs-1"})}),t.jsx("h6",{className:"text-muted",children:"     "}),t.jsx("p",{className:"text-muted small",children:"      "}),t.jsx("div",{className:"mt-4",children:t.jsxs("button",{className:"btn btn-primary me-2",onClick:()=>r(`/tenders/edit/${a}`),children:[t.jsx("i",{className:"bi bi-pencil me-1"}),"   "]})})]}):t.jsx("div",{className:"table-responsive",style:{marginBottom:"40px"},children:t.jsxs("table",{className:"table table-hover mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"50px"},children:"#"}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""})]})}),t.jsx("tbody",{children:C.map((Z,v)=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-center align-middle",children:t.jsx("span",{className:"badge bg-primary",children:v+1})}),t.jsx("td",{className:"align-middle text-center",children:t.jsxs("div",{children:[t.jsx("button",{className:"btn btn-link p-0 fw-medium text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer",fontSize:"1rem"},onClick:async()=>{try{const se=Z.materialInternalId||Z.internalId,re=Z.materialType;console.log(" TENDER STUDY: Navigating to material edit:",{materialInternalId:se,materialType:re,materialName:Z.materialName});let J=null,he=[];if(re==="rawMaterial"){console.log("Loading raw material...");const{RawMaterialService:Se}=await Xe(async()=>{const{RawMaterialService:ge}=await Promise.resolve().then(()=>dd);return{RawMaterialService:ge}},void 0);let me=await Se.getRawMaterialByInternalId(se);if(!me)try{me=await Se.getRawMaterialById(se)}catch{console.log("Could not find material by Firebase ID, trying name fallback...")}if(!me){console.log("Using name fallback - loading all raw materials...");const ge=await Se.getAllRawMaterials(),ke=Z.materialName||Z.name;me=ge.find(Ie=>Ie.name===ke)}console.log("Found raw material:",me?"YES":"NO"),me&&(console.log("Material details:",{id:me.id,internalId:me.internalId,name:me.name}),J=me.id,r(`/raw-materials/edit/${J}`))}else if(re==="localProduct"){console.log("Loading local product...");const{LocalProductService:Se}=await Xe(async()=>{const{LocalProductService:ge}=await Promise.resolve().then(()=>ud);return{LocalProductService:ge}},void 0);let me=await Se.getLocalProductByInternalId(se);if(!me)try{me=await Se.getLocalProductById(se)}catch{console.log("Could not find product by Firebase ID, trying name fallback...")}if(!me){console.log("Using name fallback - loading all local products...");const ge=await Se.getAllLocalProducts(),ke=Z.materialName||Z.name;me=ge.find(Ie=>Ie.name===ke)}console.log("Found local product:",me?"YES":"NO"),me&&(console.log("Product details:",{id:me.id,internalId:me.internalId,name:me.name}),J=me.id,r(`/local-products/edit/${J}`))}else if(re==="foreignProduct"){console.log("Loading foreign product...");const{ForeignProductService:Se}=await Xe(async()=>{const{ForeignProductService:ge}=await Promise.resolve().then(()=>hd);return{ForeignProductService:ge}},void 0);let me=await Se.getForeignProductByInternalId(se);if(!me)try{me=await Se.getForeignProductById(se)}catch{console.log("Could not find product by Firebase ID, trying name fallback...")}if(!me){console.log("Using name fallback - loading all foreign products...");const ge=await Se.getAllForeignProducts(),ke=Z.materialName||Z.name;me=ge.find(Ie=>Ie.name===ke)}console.log("Found foreign product:",me?"YES":"NO"),me&&(console.log("Product details:",{id:me.id,internalId:me.internalId,name:me.name}),J=me.id,r(`/foreign-products/edit/${J}`))}else if(re==="manufacturedProduct"){console.log("Loading manufactured products...");const{ManufacturedProductService:Se}=await Xe(async()=>{const{ManufacturedProductService:ge}=await Promise.resolve().then(()=>Li);return{ManufacturedProductService:ge}},void 0);he=await Se.getAllManufacturedProducts(),console.log("Total manufactured products loaded:",he.length),console.log("Sample manufactured product IDs:",he.slice(0,3).map(ge=>({id:ge.id,internalId:ge.internalId,title:ge.title})));let me=he.find(ge=>ge.internalId===se);me||(me=he.find(ge=>ge.id===se)),me||(me=he.find(ge=>ge.title===Z.materialName)),console.log("Found manufactured product:",me?"YES":"NO"),me&&(console.log("Product details:",{id:me.id,internalId:me.internalId,title:me.title}),J=me.id,r(`/manufactured-products/edit/${J}`))}else if(re==="service"){console.log("Loading services...");const{ServiceService:Se}=await Xe(async()=>{const{ServiceService:ge}=await Promise.resolve().then(()=>z0);return{ServiceService:ge}},void 0);let me=await Se.getServiceByInternalId(se);if(!me)try{me=await Se.getServiceById(se)}catch{console.log("Could not find service by Firebase ID, trying name fallback...")}if(!me){console.log("Using name fallback - loading all services...");const ge=await Se.getAllServices(),ke=Z.materialName||Z.name;me=ge.find(Ie=>Ie.name===ke)}console.log("Found service:",me?"YES":"NO"),me&&(console.log("Service details:",{id:me.id,internalId:me.internalId,name:me.name}),J=me.id,r(`/services/edit/${J}`))}J||(console.log("Material not found with details:",{materialInternalId:se,materialType:re,internalId:Z.internalId,name:Z.name}),alert(`     
ID: ${se}
Type: ${re}`))}catch(se){console.error("=== TENDER STUDY NAVIGATION ERROR ===",se),alert("     ")}},title:`: ${Z.materialName||" "}`,children:Z.materialName||" "}),Z.materialCategory&&t.jsx("small",{className:"text-muted d-block",children:Z.materialCategory})]})}),t.jsxs("td",{className:"text-center align-middle",children:[Z.materialType==="rawMaterial"&&t.jsx("span",{className:"badge bg-danger",children:" "}),Z.materialType==="localProduct"&&t.jsx("span",{className:"badge bg-success",children:" "}),Z.materialType==="foreignProduct"&&t.jsx("span",{className:"badge bg-info",children:" "}),Z.materialType==="manufacturedProduct"&&t.jsx("span",{className:"badge bg-warning",children:" "}),Z.materialType==="service"&&t.jsx("span",{className:"badge bg-purple",children:""}),!Z.materialType&&t.jsx("span",{className:"badge bg-secondary",children:" "})]}),t.jsxs("td",{className:"text-center align-middle",children:[t.jsx("span",{className:"fw-semibold",children:Z.quantity||1}),Z.materialUnit&&t.jsx("small",{className:"text-muted d-block",children:Z.materialUnit})]}),t.jsx("td",{className:"text-center align-middle",children:t.jsxs("span",{className:"text-success fw-bold",children:[(Z.unitPrice||0).toLocaleString(void 0,{minimumFractionDigits:1,maximumFractionDigits:1})," ."]})}),t.jsxs("td",{className:"text-center align-middle",children:[t.jsxs("span",{className:"text-primary fw-bold",children:[(Z.totalPrice||0).toLocaleString(void 0,{minimumFractionDigits:1,maximumFractionDigits:1})," ."]}),t.jsx("small",{className:"text-muted d-block",children:"( )"})]}),t.jsx("td",{className:"text-center align-middle",children:(()=>{const se=parseFloat((Z.totalPrice||0).toFixed(1));let re=se;if(console.log(" SALE PRICE CALCULATION START:",{showPerItemInput:p,percentageProfit:c,fixedProfit:o,displayedBasePrice:se,itemTotalPrice:Z.totalPrice}),p){console.log(" PATH: Individual per-item profit (showPerItemInput=true)");const J=Z.internalId||v,Se=$e()[J];if(Se)if(Se.type==="percentage"){const me=parseFloat((se*(Se.value/100)).toFixed(10));re=parseFloat((se+me).toFixed(10))}else{const me=parseFloat((Se.value||0).toFixed(10));re=parseFloat((se+me).toFixed(10))}}else if(c>0){console.log(" PATH: Percentage profit (percentageProfit > 0)");const J=parseFloat((se*(Kt/100)).toFixed(10));re=parseFloat((se+J).toFixed(10)),console.log(" 10 DECIMAL PROFIT MARGIN CALCULATION:",{displayedBasePrice:se,rawProfitMargin:Kt,profitAmount:J,salePrice:re})}else if(o>0){console.log(" PATH: Fixed profit - Use 10 decimal precision");const J=parseFloat((se*(Kt/100)).toFixed(10));re=parseFloat((se+J).toFixed(10)),console.log(" 10 DECIMAL PROFIT MARGIN CALCULATION:",{fixedProfit:o,rawProfitMargin:Kt,displayedBasePrice:se,profitAmount:J,salePrice:re})}else console.log(" PATH: No profit (default case)");return re=parseFloat(re.toFixed(1)),console.log(" FINAL SALE PRICE:",re),t.jsxs(t.Fragment,{children:[t.jsxs("span",{className:"text-warning fw-bold",children:[re.toLocaleString(void 0,{minimumFractionDigits:1,maximumFractionDigits:1})," ."]}),t.jsx("small",{className:"text-muted d-block",children:"( )"})]})})()}),t.jsx("td",{className:"text-center align-middle",children:p?t.jsx("div",{className:"d-flex justify-content-center",style:{width:"100%"},children:t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[t.jsxs("div",{className:"d-flex rounded-pill border border-primary p-1",style:{backgroundColor:"#f8f9fa",width:"90px",fontSize:"10px",flexShrink:0},children:[t.jsx("button",{type:"button",className:`btn btn-sm rounded-pill flex-fill ${tt(Z,v)==="fixed"?"btn-primary":"btn-light"}`,style:{fontSize:"9px",padding:"4px 10px",border:"none",fontWeight:"600",opacity:Y?.6:1,cursor:Y?"not-allowed":"pointer"},disabled:Y,onClick:Y?void 0:()=>et(Z,v,ze(Z,v),"fixed"),children:""}),t.jsx("button",{type:"button",className:`btn btn-sm rounded-pill flex-fill ${tt(Z,v)==="percentage"?"btn-primary":"btn-light"}`,style:{fontSize:"9px",padding:"4px 10px",border:"none",fontWeight:"600",opacity:Y?.6:1,cursor:Y?"not-allowed":"pointer"},disabled:Y,onClick:Y?void 0:()=>et(Z,v,ze(Z,v),"percentage"),children:"%"})]}),t.jsx("input",{type:"number",className:"form-control text-center border-primary",style:{fontSize:"12px",fontWeight:"600",borderWidth:"2px",width:"120px",height:"34px",padding:"7px 12px",borderRadius:"12px",opacity:Y?.6:1},placeholder:tt(Z,v)==="percentage"?"1-100":"0",step:"0.01",min:tt(Z,v)==="percentage"?"1":"0",max:tt(Z,v)==="percentage"?"100":void 0,value:ze(Z,v)||"",readOnly:Y,onChange:Y?void 0:se=>{const re=parseFloat(se.target.value)||0,J=tt(Z,v);J==="percentage"?re<1?et(Z,v,"1",J):re>100?et(Z,v,"100",J):et(Z,v,se.target.value,J):et(Z,v,se.target.value,J)}})]})}):t.jsx("span",{className:"text-success fw-bold",children:"0.0 ."})})]},Z.internalId||v))}),(()=>{const Z=C.reduce((re,J,he)=>{const Se=parseFloat((J.totalPrice||0).toFixed(1));let me=Se;if(p){const ge=J.internalId||he,Ie=$e()[ge];if(Ie)if(Ie.type==="percentage"){const oe=parseFloat((Se*(Ie.value/100)).toFixed(10));me=parseFloat((Se+oe).toFixed(10))}else{const oe=parseFloat((Ie.value||0).toFixed(10));me=parseFloat((Se+oe).toFixed(10))}}else if(c>0){const ge=parseFloat((Se*(Kt/100)).toFixed(10));me=parseFloat((Se+ge).toFixed(10))}else if(o>0){const ge=parseFloat((Se*(Kt/100)).toFixed(10));me=parseFloat((Se+ge).toFixed(10))}return me=parseFloat(me.toFixed(1)),re+me},0),v=Z*.15,se=it;return t.jsxs("tfoot",{className:"table-light",children:[t.jsxs("tr",{children:[t.jsx("th",{colSpan:"6",className:"text-end",children:" :"}),t.jsxs("th",{className:"text-center text-primary fw-bold",children:[Z.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," ."]})]}),t.jsxs("tr",{children:[t.jsx("th",{colSpan:"6",className:"text-end",children:"   (%15):"}),t.jsxs("th",{className:"text-center text-success fw-bold",children:[v.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," ."]})]}),t.jsxs("tr",{className:"table-warning",children:[t.jsx("th",{colSpan:"6",className:"text-end",children:" :"}),t.jsxs("th",{className:"text-center fw-bold",style:{color:"#000000"},children:[se.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," ."]})]})]})})()]})})})]})})]})]}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&s&&t.jsx(os,{rtl:!0}),!n&&s&&t.jsx(ls,{}),t.jsx(Td,{show:w,onClose:()=>W(!1),documents:ie,setDocuments:de,tenderId:a,uploadingDocument:ne,setUploadingDocument:ye,handleDocumentUpload:rt,handleDeleteClick:bt,deleting:pe,title:"  ",readOnly:!1,canCreate:!0,canDelete:!0,canView:!0})]})}function Uj(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(s$,{})})})}function n$(){const[n,e]=h.useState(!1),{isTimelineVisible:s}=Ut(),[r,i]=h.useState([]),[a,o]=h.useState([]),[l,c]=h.useState(!1),[d,u]=h.useState(null),[f,p]=h.useState(""),[j,L]=h.useState([]),[R,D]=h.useState(!1),[y,T]=h.useState([]),[x,S]=h.useState(null),A=kt(),{tenderId:Q}=Dn(),{logActivity:q,getCurrentUser:B}=Zt(),{alertConfig:$,closeAlert:H,showSuccess:te,showError:G}=Bt(),F=()=>{e(!n)};h.useEffect(()=>{X();const b=P=>{P.type==="rawMaterialsUpdated"&&X()},N=()=>{X()};window.addEventListener("storage",b),window.addEventListener("rawMaterialsUpdated",N);const I=()=>{X()};return window.addEventListener("focus",I),()=>{window.removeEventListener("storage",b),window.removeEventListener("rawMaterialsUpdated",N),window.removeEventListener("focus",I)}},[]),h.useEffect(()=>{if(f.trim()){const b=r.filter(N=>{var I,P,_,C;return((I=N.name)==null?void 0:I.toLowerCase().includes(f.toLowerCase()))||((P=N.category)==null?void 0:P.toLowerCase().includes(f.toLowerCase()))||((_=N.description)==null?void 0:_.toLowerCase().includes(f.toLowerCase()))||((C=N.supplier)==null?void 0:C.toLowerCase().includes(f.toLowerCase()))});L(b)}else L(r)},[f,r]);const X=async()=>{try{c(!0);const N=(await Tn.getAllRawMaterials()).filter(I=>I.active!==!1);i(N),u(null)}catch(b){u(b.message)}finally{c(!1)}},ue=b=>{if(a.some(I=>I.internalId===b.internalId))o(I=>I.filter(P=>P.internalId!==b.internalId));else{const I={...b,type:"rawMaterials",quantity:1};o(P=>[...P,I])}},Y=async()=>{if(a.length===0){G("      ","   ");return}const b=a.map(N=>{let I=N.price||0,P=N.supplier;if(N.priceQuotes&&Array.isArray(N.priceQuotes)&&N.priceQuotes.length>0){const _=N.priceQuotes.reduce((C,U)=>{const w=parseFloat(C.price)||0;return(parseFloat(U.price)||0)<w?U:C});I=parseFloat(_.price)||0,P=_.supplierName}return{...N,quantity:1,unitPrice:I,totalPrice:I,displaySupplier:P}});T(b),S(null),D(!0)},z=(b,N)=>{const I=Math.max(0,parseFloat(N)||0);T(P=>P.map(_=>_.id===b?{..._,quantity:Number(I.toFixed(1)),totalPrice:_.unitPrice*Number(I.toFixed(1))}:_))},O=async()=>{console.log(" FUNCTION START: handleConfirmQuantities called");try{if(!Array.isArray(y)||y.length===0){console.log(" EARLY EXIT: No modal items to process"),G("    ","  ");return}console.log(" STEP 1: Starting duplicate check process..."),console.log(" Modal items to check:",y.map(w=>({name:w.name,internalId:w.internalId,id:w.id})));let b=await Ke.getPendingData(`pendingTenderItems_${Q||"new"}`)||[];if(Q&&Q!=="new")try{console.log(" EDIT MODE: Loading existing tender items for duplicate check, tender ID:",Q);const{tenderServiceNew:w}=await Xe(async()=>{const{tenderServiceNew:ie}=await Promise.resolve().then(()=>Po);return{tenderServiceNew:ie}},void 0),W=await w.getTenderForViewing(Q);W&&W.items&&Array.isArray(W.items)&&(console.log(" EDIT MODE: Found existing tender items:",W.items.length),b=[...b,...W.items])}catch(w){console.error(" Error loading existing tender items for duplicate check:",w)}console.log(" STEP 2: Retrieved existing items from storage:",{count:b.length,items:b.map(w=>({name:w.materialName||w.name,materialInternalId:w.materialInternalId,internalId:w.internalId,id:w.id}))});const N=b.map(w=>w.materialInternalId||w.internalId||w.id).filter(Boolean);console.log(" STEP 3: Extracted existing material IDs:",N);const I=[];for(const w of y){const W=[w.internalId,w.id,w.materialInternalId,w.materialId].filter(Boolean),ie=W.some(de=>N.includes(de));console.log(` STEP 4: Duplicate check for "${w.name}":`),console.log(`  - Possible IDs: [${W.join(", ")}]`),console.log(`  - Existing IDs: [${N.join(", ")}]`),console.log(`  - Is Duplicate: ${ie}`),ie&&(I.push(w.name),console.log(` DUPLICATE FOUND: "${w.name}" with IDs [${W.join(", ")}] matches existing items!`))}if(console.log(" STEP 5: Duplicate prevention analysis complete:",{totalModalItems:y.length,duplicatesFound:I.length,duplicateNames:I,existingIds:N}),I.length>0){console.log(" CRITICAL: DUPLICATE PREVENTION ACTIVATED "),console.log(" STEP 6: Execution will be FORCEFULLY STOPPED"),console.log(" Duplicate items blocking execution:",I),console.log(" Function will return immediately after showing warnings");const w=I.join(" ");G(`       :

${w}

      .

        .`," :  "),S(`  : ${w}`),console.log(" STEP 7: About to return and stop execution completely"),console.log(" If you see any code execution after this point, there is a bug!");return}console.log(" STEP 8: NO DUPLICATES DETECTED - Safe to proceed"),console.log(" Continuing with item creation process...");const P=y,_=[];for(const w of P)try{const W={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:w.internalId,materialType:"rawMaterial",materialName:w.name,materialCategory:w.category||"",materialUnit:w.unit||"",quantity:w.quantity||1,unitPrice:w.unitPrice||w.price||0,totalPrice:(w.quantity||1)*(w.unitPrice||w.price||0),supplierInfo:w.displaySupplier||w.supplier||"",tenderId:Q==="new"?"new":Q,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};_.push(W),console.log("Created tender item with ID relationship:",{tenderItemId:W.internalId,linkedMaterialId:W.materialInternalId,materialName:W.materialName,currentPrice:W.unitPrice,totalPrice:W.totalPrice})}catch(W){console.error("Error creating tender item for material:",w.name,W),G(`   : ${w.name}`,"  ");return}const C=await Ke.getPendingTenderItems()||[];let U=[..._];if(C.length>0)try{if(Array.isArray(C)){const w=await nc.refreshTenderItemsPricing(C);console.log(" SAFE MERGE: Our enhanced duplicate prevention handled conflicts, merging safely"),U=[...w,..._],console.log(" SAFE MERGE completed:",{existingItemsCount:w.length,newItemsCount:_.length,finalItemsCount:U.length,note:"No conflicts - duplicates were prevented above"})}}catch(w){console.error("Error parsing existing items:",w)}console.log("Storing ID-based tender items:",{totalItems:U.length,newItems:_.length,items:U.map(w=>({id:w.internalId,materialId:w.materialInternalId,name:w.materialName,price:w.unitPrice,total:w.totalPrice}))}),await Ke.setPendingData(`pendingTenderItems_${Q||"new"}`,U,48);try{let w=" ";if(Q&&Q!=="new")try{const{tenderServiceNew:W}=await Xe(async()=>{const{tenderServiceNew:de}=await Promise.resolve().then(()=>Po);return{tenderServiceNew:de}},void 0),ie=await W.getTenderForViewing(Q);ie&&ie.entity?w=`: ${ie.entity}`:ie&&ie.title&&(w=`: ${ie.title}`)}catch(W){console.warn("Could not fetch tender entity, using default name:",W)}else try{const W=await Ke.getPendingData("tenderFormData_new");W&&W.entity&&(w=`: ${W.entity}`)}catch(W){console.warn("Could not fetch pending form data:",W)}for(const W of _)await ws.logItemAdd(W.materialName,w,"tender");console.log(` Logged ${_.length} individual item activities with entity name: ${w}`)}catch(w){console.error("Failed to log enhanced activity:",w)}window.dispatchEvent(new CustomEvent("tenderItemsAdded",{detail:{count:_.length,type:"rawMaterial",items:_}})),te(`  ${_.length}      `," "),D(!1),T([]),S(null),setTimeout(()=>{A(Q==="new"?"/tenders/add":`/tenders/edit/${Q}`)},2e3)}catch(b){console.error("Error in handleConfirmQuantities:",b),G("      -   ","  ")}},E=()=>{D(!1),T([]),S(null)},k=()=>Math.round(y.reduce((b,N)=>b+N.totalPrice,0));return l?t.jsx(It,{show:!0,message:"    ...",overlay:!1}):d?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:d}),t.jsxs("button",{className:"btn btn-primary",onClick:X,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[t.jsx(Rt,{onToggle:F}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!s?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-3",children:t.jsx("div",{className:"raw-materials-table",children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"row align-items-center justify-content-between",children:[t.jsx("div",{className:"col-lg-4",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-gear text-danger me-2"}),"   (",j.length,")"]})}),t.jsx("div",{className:"col-lg-8",children:t.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:f,onChange:b=>p(b.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:Y,disabled:a.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["  (",a.length,")"]})]})})]})}),t.jsx("div",{className:"card-body p-0",children:j.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-gear fs-1"})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:f?"    ":"      "})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""})]})}),t.jsx("tbody",{children:j.map(b=>{let N=b.price,I=b.supplier,P=!1,_=null;return b.priceQuotes&&Array.isArray(b.priceQuotes)&&b.priceQuotes.length>0&&(P=!0,_=b.priceQuotes.reduce((C,U)=>{const w=parseFloat(C.price)||0;return(parseFloat(U.price)||0)<w?U:C}),N=_.price,I=_.supplierName),t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",children:t.jsx("div",{className:"form-check d-flex justify-content-center",children:t.jsx("input",{className:"form-check-input",type:"checkbox",checked:a.some(C=>C.internalId===b.internalId),onChange:()=>ue(b),style:{transform:"scale(1.2)"}})})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"fw-bold text-primary",children:b.name})}),t.jsx("td",{className:"text-center",children:b.category||"-"}),t.jsx("td",{className:"text-center",children:b.unit||"-"}),t.jsx("td",{className:"text-center",children:N?t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsxs("span",{children:[N," "]}),P&&t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),t.jsx("td",{className:"text-center",children:I?t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("span",{children:I}),P&&t.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:" "})]}):"-"})]},b.id)})})]})})})]})})}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&s&&t.jsx(os,{rtl:!0}),!n&&s&&t.jsx(ls,{})]}),R&&t.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:99985},children:t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:E,"aria-label":"Close"})]}),t.jsxs("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:[x&&t.jsxs("div",{className:"alert alert-warning alert-dismissible m-3 mb-2",role:"alert",style:{background:"linear-gradient(45deg, #fff3cd, #ffeaa7)",border:"2px solid #f39c12",borderRadius:"8px",boxShadow:"0 4px 12px rgba(243, 156, 18, 0.3)"},children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-exclamation-triangle-fill text-warning me-2",style:{fontSize:"20px"}}),t.jsxs("div",{className:"flex-grow-1",children:[t.jsx("strong",{children:":  !"}),t.jsx("div",{className:"mt-1 text-dark",children:x}),t.jsx("small",{className:"text-muted",children:"      "})]})]}),t.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>S(null)})]}),t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"30%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),t.jsx("tbody",{children:y.map((b,N)=>t.jsxs("tr",{style:{height:"60px"},children:[t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:"bi bi-gear text-danger me-2"}),t.jsxs("div",{children:[t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:I=>{I.preventDefault(),I.stopPropagation(),A(`/raw-materials/edit/${b.id}`)},title:`  : ${b.name}`,children:b.name}),t.jsx("small",{className:"text-muted",children:b.category})]})]})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("span",{className:"fw-bold text-success",children:[Math.round(b.unitPrice)," "]}),t.jsx("div",{children:t.jsxs("small",{className:"text-muted",children:["/",b.unit||""]})})]}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>z(b.id,Math.max(0,Number((b.quantity-.1).toFixed(1)))),disabled:b.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-dash"})}),t.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:b.quantity,min:"0",step:"any",onChange:I=>z(b.id,I.target.value),onBlur:I=>{const P=Number(I.target.value||0).toFixed(1);z(b.id,P)}}),t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>z(b.id,Number((b.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-plus"})})]})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"text-muted",children:b.displaySupplier||"-"})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(b.totalPrice)," "]}),t.jsxs("small",{className:"text-success",children:["(",b.quantity.toFixed(1),"  ",Math.round(b.unitPrice),")"]})]})]},b.id))})]})})]}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:t.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("span",{className:"text-muted me-3",children:" :"}),t.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[k()," "]}),t.jsxs("span",{className:"badge bg-info ms-2",children:[y.reduce((b,N)=>b+N.quantity,0).toFixed(1)," "]})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:E,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:O,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})]})})]})})}),t.jsx(Mt,{show:$.show,onClose:H,title:$.title,message:$.message,type:$.type,onConfirm:$.onConfirm,showConfirm:$.showConfirm})]})}function r$(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(n$,{})})})}function i$(){const[n,e]=h.useState(!1),{isTimelineVisible:s}=Ut(),[r,i]=h.useState([]),[a,o]=h.useState([]),[l,c]=h.useState(!1),[d,u]=h.useState(null),[f,p]=h.useState(""),[j,L]=h.useState([]),[R,D]=h.useState(!1),[y,T]=h.useState([]),[x,S]=h.useState(null),A=kt(),{tenderId:Q}=Dn(),{logActivity:q,getCurrentUser:B}=Zt(),{alertConfig:$,closeAlert:H,showSuccess:te,showError:G}=Bt(),F=()=>{e(!n)};h.useEffect(()=>{X();const b=P=>{P.type==="localProductsUpdated"&&X()},N=()=>{X()};window.addEventListener("storage",b),window.addEventListener("localProductsUpdated",N);const I=()=>{X()};return window.addEventListener("focus",I),()=>{window.removeEventListener("storage",b),window.removeEventListener("localProductsUpdated",N),window.removeEventListener("focus",I)}},[]),h.useEffect(()=>{if(f.trim()){const b=r.filter(N=>{var I,P,_,C;return((I=N.name)==null?void 0:I.toLowerCase().includes(f.toLowerCase()))||((P=N.category)==null?void 0:P.toLowerCase().includes(f.toLowerCase()))||((_=N.description)==null?void 0:_.toLowerCase().includes(f.toLowerCase()))||((C=N.manufacturer)==null?void 0:C.toLowerCase().includes(f.toLowerCase()))});L(b)}else L(r)},[f,r]);const X=async()=>{try{c(!0);const N=(await An.getAllLocalProducts()).filter(I=>I.active!==!1);i(N),u(null)}catch(b){u(b.message)}finally{c(!1)}},ue=b=>{if(a.some(I=>I.internalId===b.internalId))o(I=>I.filter(P=>P.internalId!==b.internalId));else{const I={...b,type:"localProducts",quantity:1};o(P=>[...P,I])}},Y=async()=>{if(a.length===0){G("      ","   ");return}const b=a.map(N=>{let I=N.price||0,P=N.manufacturer;if(N.priceQuotes&&Array.isArray(N.priceQuotes)&&N.priceQuotes.length>0){const _=N.priceQuotes.reduce((C,U)=>{const w=parseFloat(C.price)||0;return(parseFloat(U.price)||0)<w?U:C});I=parseFloat(_.price)||0,P=_.supplierName}return{...N,quantity:1,unitPrice:I,totalPrice:I,displaySupplier:P}});T(b),S(null),D(!0)},z=(b,N)=>{const I=Math.max(0,parseFloat(N)||0);T(P=>P.map(_=>_.id===b?{..._,quantity:Number(I.toFixed(1)),totalPrice:_.unitPrice*Number(I.toFixed(1))}:_))},O=async()=>{try{if(!Array.isArray(y)||y.length===0){G("    ","  ");return}console.log(" STARTING DUPLICATE PREVENTION FOR LOCAL PRODUCTS...");let b=await Ke.getPendingData(`pendingTenderItems_${Q||"new"}`)||[];if(Q&&Q!=="new")try{console.log(" EDIT MODE: Loading existing tender items for duplicate check, tender ID:",Q);const{tenderServiceNew:w}=await Xe(async()=>{const{tenderServiceNew:ie}=await Promise.resolve().then(()=>Po);return{tenderServiceNew:ie}},void 0),W=await w.getById(Q);W&&W.items&&Array.isArray(W.items)&&(console.log(" EDIT MODE: Found existing tender items:",W.items.length),b=[...b,...W.items])}catch(w){console.error(" Error loading existing tender items for duplicate check:",w)}let N=[];if(b.length>0)try{Array.isArray(b)&&(N=b.map(w=>w.materialInternalId||w.internalId||w.id).filter(Boolean))}catch(w){console.error("Error parsing existing items:",w)}console.log(" Existing material IDs:",N),console.log(" Modal items to check:",y.map(w=>({name:w.name,internalId:w.internalId,id:w.id})));const I=[];for(const w of y){const W=[w.internalId,w.id,w.materialInternalId,w.materialId].filter(Boolean),ie=W.some(de=>N.includes(de));console.log(` DUPLICATE CHECK: "${w.name}":`),console.log(`  - Possible IDs: [${W.join(", ")}]`),console.log(`  - Existing IDs: [${N.join(", ")}]`),console.log(`  - Is Duplicate: ${ie}`),ie&&(I.push(w.name),console.log(` DUPLICATE FOUND: "${w.name}" with IDs [${W.join(", ")}] matches existing items!`))}if(console.log(" DUPLICATE PREVENTION RESULT:",{totalItems:y.length,duplicatesFound:I.length,duplicateNames:I}),I.length>0){const w=I.join(" ");console.log(" DUPLICATE PREVENTION ACTIVATED: Blocking duplicates:",w),G(`       :

${w}

      .

        .`," :  "),S(`  : ${w}`);return}console.log(" No duplicates found, proceeding with creation...");const P=y,_=[];for(const w of P)try{const W={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:w.internalId,materialType:"localProduct",materialName:w.name,materialCategory:w.category||"",materialUnit:w.unit||"",quantity:w.quantity||1,unitPrice:w.unitPrice||w.price||0,totalPrice:(w.quantity||1)*(w.unitPrice||w.price||0),supplierInfo:w.displaySupplier||w.supplier||"",tenderId:Q==="new"?"new":Q,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};_.push(W),console.log("Created tender item with ID relationship:",{tenderItemId:W.internalId,linkedProductId:W.materialInternalId,productName:W.materialName,currentPrice:W.unitPrice,totalPrice:W.totalPrice})}catch(W){console.error("Error creating tender item for product:",w.name,W),G(`   : ${w.name}`,"  ");return}const C=await Ke.getPendingData(`pendingTenderItems_${Q||"new"}`)||[];let U=[..._];if(C.length>0)try{if(Array.isArray(C)){const w=await nc.refreshTenderItemsPricing(C);console.log(" SAFE MERGE: Our enhanced duplicate prevention handled conflicts, merging safely"),U=[...w,..._],console.log("Duplicate prevention results:",{existingItemsCount:w.length,newItemsCount:_.length,finalItemsCount:U.length})}}catch(w){console.error("Error parsing existing items:",w)}console.log("Storing ID-based tender items:",{totalItems:U.length,newItems:_.length,items:U.map(w=>({id:w.internalId,materialId:w.materialInternalId,name:w.materialName,price:w.unitPrice,total:w.totalPrice}))}),await Ke.setPendingData(`pendingTenderItems_${Q||"new"}`,U,48);try{let w=" ";if(Q&&Q!=="new")try{const{tenderServiceNew:W}=await Xe(async()=>{const{tenderServiceNew:de}=await Promise.resolve().then(()=>Po);return{tenderServiceNew:de}},void 0),ie=await W.getTenderForViewing(Q);ie&&ie.entity?w=`: ${ie.entity}`:ie&&ie.title&&(w=`: ${ie.title}`)}catch(W){console.warn("Could not fetch tender entity, using default name:",W)}else try{const W=await Ke.getPendingData("tenderFormData_new");W&&W.entity&&(w=`: ${W.entity}`)}catch(W){console.warn("Could not fetch pending form data:",W)}for(const W of _)await ws.logItemAdd(W.materialName,w,"tender");console.log(` Logged ${_.length} individual local product activities with entity name: ${w}`)}catch(w){console.error("Failed to log enhanced activity:",w)}te(`  ${_.length}      `," "),window.dispatchEvent(new CustomEvent("tenderItemsAdded",{detail:{count:_.length,type:"localProduct",items:_}})),D(!1),T([]),S(null),setTimeout(()=>{A(Q==="new"?"/tenders/add":`/tenders/edit/${Q}`)},2e3)}catch(b){console.error("Error in handleConfirmQuantities:",b),G("      -   ","  "),c(!1)}finally{setTimeout(()=>c(!1),2100)}},E=()=>{D(!1),T([]),S(null)},k=()=>Math.round(y.reduce((b,N)=>b+N.totalPrice,0));return l?t.jsx(It,{show:!0,message:"    ...",overlay:!1}):d?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:d}),t.jsxs("button",{className:"btn btn-primary",onClick:X,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[t.jsx(Rt,{onToggle:F}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!s?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-3",children:t.jsx("div",{className:"raw-materials-table",children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"row align-items-center justify-content-between",children:[t.jsx("div",{className:"col-lg-4",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-house text-success me-2"}),"   (",j.length,")"]})}),t.jsx("div",{className:"col-lg-8",children:t.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:f,onChange:b=>p(b.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:Y,disabled:a.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["  (",a.length,")"]})]})})]})}),t.jsx("div",{className:"card-body p-0",children:j.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-house fs-1"})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:f?"    ":"      "})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "})]})}),t.jsx("tbody",{children:j.map(b=>{let N=b.price,I=b.manufacturer,P=!1,_=null;return b.priceQuotes&&Array.isArray(b.priceQuotes)&&b.priceQuotes.length>0&&(P=!0,_=b.priceQuotes.reduce((C,U)=>{const w=parseFloat(C.price)||0;return(parseFloat(U.price)||0)<w?U:C}),N=_.price,I=_.supplierName),t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",children:t.jsx("div",{className:"form-check d-flex justify-content-center",children:t.jsx("input",{className:"form-check-input",type:"checkbox",checked:a.some(C=>C.internalId===b.internalId),onChange:()=>ue(b),style:{transform:"scale(1.2)"}})})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"fw-bold text-primary",children:b.name})}),t.jsx("td",{className:"text-center",children:b.category||"-"}),t.jsx("td",{className:"text-center",children:b.unit||"-"}),t.jsx("td",{className:"text-center",children:N?t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsxs("span",{children:[N," "]}),P&&t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),t.jsx("td",{className:"text-center",children:I?t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("span",{children:I}),P&&t.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:" "})]}):"-"})]},b.id)})})]})})})]})})}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&s&&t.jsx(os,{rtl:!0}),!n&&s&&t.jsx(ls,{})]}),R&&t.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:99985},children:t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:E,"aria-label":"Close"})]}),t.jsxs("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:[x&&t.jsxs("div",{className:"alert alert-warning alert-dismissible m-3 mb-2",role:"alert",style:{background:"linear-gradient(45deg, #fff3cd, #ffeaa7)",border:"2px solid #f39c12",borderRadius:"8px",boxShadow:"0 4px 12px rgba(243, 156, 18, 0.3)"},children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-exclamation-triangle-fill text-warning me-2",style:{fontSize:"20px"}}),t.jsxs("div",{className:"flex-grow-1",children:[t.jsx("strong",{children:":  !"}),t.jsx("div",{className:"mt-1 text-dark",children:x}),t.jsx("small",{className:"text-muted",children:"      "})]})]}),t.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>S(null)})]}),t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"30%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),t.jsx("tbody",{children:y.map((b,N)=>t.jsxs("tr",{style:{height:"60px"},children:[t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:"bi bi-house text-success me-2"}),t.jsxs("div",{children:[t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:I=>{I.preventDefault(),I.stopPropagation(),A(`/local-products/edit/${b.id}`)},title:`  : ${b.name}`,children:b.name}),t.jsx("small",{className:"text-muted",children:b.category})]})]})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("span",{className:"fw-bold text-success",children:[Math.round(b.unitPrice)," "]}),t.jsx("div",{children:t.jsxs("small",{className:"text-muted",children:["/",b.unit||""]})})]}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>z(b.id,Math.max(0,Number((b.quantity-.1).toFixed(1)))),disabled:b.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-dash"})}),t.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:b.quantity,min:"0",step:"any",onChange:I=>z(b.id,I.target.value),onBlur:I=>{const P=Number(I.target.value||0).toFixed(1);z(b.id,P)}}),t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>z(b.id,Number((b.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-plus"})})]})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"text-muted",children:b.displaySupplier||"-"})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(b.totalPrice)," "]}),t.jsxs("small",{className:"text-success",children:["(",b.quantity.toFixed(1),"  ",Math.round(b.unitPrice),")"]})]})]},b.id))})]})})]}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:t.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("span",{className:"text-muted me-3",children:" :"}),t.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[k()," "]}),t.jsxs("span",{className:"badge bg-info ms-2",children:[y.reduce((b,N)=>b+N.quantity,0).toFixed(1)," "]})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:E,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:O,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})]})})]})})}),t.jsx(Mt,{show:$.show,onClose:H,title:$.title,message:$.message,type:$.type,onConfirm:$.onConfirm,showConfirm:$.showConfirm})]})}function a$(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(i$,{})})})}function o$(){const[n,e]=h.useState(!1),{isTimelineVisible:s}=Ut(),[r,i]=h.useState([]),[a,o]=h.useState([]),[l,c]=h.useState(!1),[d,u]=h.useState(null),[f,p]=h.useState(""),[j,L]=h.useState([]),[R,D]=h.useState(!1),[y,T]=h.useState([]),[x,S]=h.useState(null),A=kt(),{tenderId:Q}=Dn(),{logActivity:q,getCurrentUser:B}=Zt(),{alertConfig:$,closeAlert:H,showSuccess:te,showError:G}=Bt(),F=()=>{e(!n)};h.useEffect(()=>{X();const b=P=>{P.type==="foreignProductsUpdated"&&X()},N=()=>{X()};window.addEventListener("storage",b),window.addEventListener("foreignProductsUpdated",N);const I=()=>{X()};return window.addEventListener("focus",I),()=>{window.removeEventListener("storage",b),window.removeEventListener("foreignProductsUpdated",N),window.removeEventListener("focus",I)}},[]),h.useEffect(()=>{if(f.trim()){const b=r.filter(N=>{var I,P,_,C,U;return((I=N.name)==null?void 0:I.toLowerCase().includes(f.toLowerCase()))||((P=N.category)==null?void 0:P.toLowerCase().includes(f.toLowerCase()))||((_=N.description)==null?void 0:_.toLowerCase().includes(f.toLowerCase()))||((C=N.supplier)==null?void 0:C.toLowerCase().includes(f.toLowerCase()))||((U=N.countryOfOrigin)==null?void 0:U.toLowerCase().includes(f.toLowerCase()))});L(b)}else L(r)},[f,r]);const X=async()=>{try{c(!0);const N=(await nn.getAllForeignProducts()).filter(I=>I.active!==!1);i(N),u(null)}catch(b){u(b.message)}finally{c(!1)}},ue=b=>{if(a.some(I=>I.internalId===b.internalId))o(I=>I.filter(P=>P.internalId!==b.internalId));else{const I={...b,type:"foreignProduct",quantity:1};o(P=>[...P,I])}},Y=async()=>{if(a.length===0){G("      ","   ");return}console.log(" FOREIGN PRODUCTS: Fetching existing items for duplicate check...");const b=await Ke.getPendingData(`pendingTenderItems_${Q||"new"}`)||[];console.log(" FOREIGN PRODUCTS: Existing items found:",b.length);let N=[];b&&Array.isArray(b)&&(N=b.map(_=>_.materialInternalId),console.log(" FOREIGN PRODUCTS: Existing material IDs:",N));const I=[];a.filter(_=>{const U=[_.internalId,_.id,_.materialInternalId,_.materialId].filter(Boolean).some(w=>N.includes(w));return U&&I.push(_.name),!U});const P=a.map(_=>{const C=nn.calculateLowestTotalCost(_);return{..._,quantity:1,unitPrice:C.totalCost,totalPrice:C.totalCost,displaySupplier:C.displaySupplier}});T(P),S(null),D(!0)},z=(b,N)=>{const I=Math.max(0,parseFloat(N)||0);T(P=>P.map(_=>_.id===b?{..._,quantity:Number(I.toFixed(1)),totalPrice:_.unitPrice*Number(I.toFixed(1))}:_))},O=async()=>{try{if(!Array.isArray(y)||y.length===0){G("    ","  ");return}console.log(" STARTING DUPLICATE PREVENTION FOR FOREIGN PRODUCTS...");let b=await Ke.getPendingData(`pendingTenderItems_${Q||"new"}`)||[];if(Q&&Q!=="new")try{console.log(" EDIT MODE: Loading existing tender items for duplicate check, tender ID:",Q);const{tenderServiceNew:w}=await Xe(async()=>{const{tenderServiceNew:ie}=await Promise.resolve().then(()=>Po);return{tenderServiceNew:ie}},void 0),W=await w.getById(Q);W&&W.items&&Array.isArray(W.items)&&(console.log(" EDIT MODE: Found existing tender items:",W.items.length),b=[...b,...W.items])}catch(w){console.error(" Error loading existing tender items for duplicate check:",w)}let N=[];b&&Array.isArray(b)&&(N=b.map(w=>w.materialInternalId||w.internalId||w.id).filter(Boolean)),console.log(" Existing material IDs:",N),console.log(" Modal items to check:",y.map(w=>({name:w.name,internalId:w.internalId,id:w.id})));const I=[];for(const w of y){const W=[w.internalId,w.id,w.materialInternalId,w.materialId].filter(Boolean),ie=W.some(de=>N.includes(de));console.log(` DUPLICATE CHECK: "${w.name}":`),console.log(`  - Possible IDs: [${W.join(", ")}]`),console.log(`  - Existing IDs: [${N.join(", ")}]`),console.log(`  - Is Duplicate: ${ie}`),ie&&(I.push(w.name),console.log(` DUPLICATE FOUND: "${w.name}" with IDs [${W.join(", ")}] matches existing items!`))}if(console.log(" DUPLICATE PREVENTION RESULT:",{totalItems:y.length,duplicatesFound:I.length,duplicateNames:I}),I.length>0){const w=I.join(" ");console.log(" DUPLICATE PREVENTION ACTIVATED: Blocking duplicates:",w),G(`       :

${w}

      .

        .`," :  "),S(`  : ${w}`);return}console.log(" No duplicates found, proceeding with creation...");const P=y,_=[];for(const w of P)try{console.log(" Creating tender item directly:",w.name);const W={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:w.internalId,materialType:"foreignProduct",materialName:w.name,materialCategory:w.category||"",materialUnit:w.unit||"",quantity:w.quantity||1,unitPrice:w.unitPrice||w.price||0,totalPrice:(w.quantity||1)*(w.unitPrice||w.price||0),supplierInfo:w.displaySupplier||w.supplier||"",tenderId:Q==="new"?"new":Q,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};_.push(W),console.log(" Created tender item directly:",{internalId:W.internalId,materialName:W.materialName,quantity:W.quantity,unitPrice:W.unitPrice,totalPrice:W.totalPrice})}catch(W){console.error(" Error creating tender item for product:",w.name,W),G(`    "${w.name}": ${W.message||"  "}`,"  ");return}console.log(" MERGE PHASE: Fetching existing items for merge...");const C=await Ke.getPendingData(`pendingTenderItems_${Q||"new"}`)||[];console.log(" MERGE PHASE: Existing items fetched:",{count:C.length,items:C.map(w=>({id:w.materialInternalId,name:w.materialName,type:w.materialType}))});let U=[..._];if(console.log(" MERGE PHASE: Starting with new items:",_.length),C.length>0)try{if(Array.isArray(C)){console.log(" MERGE PHASE: Refreshing pricing for existing items...");const w=await nc.refreshTenderItemsPricing(C);console.log(" MERGE PHASE: Price refresh completed:",{originalCount:C.length,refreshedCount:w.length,refreshedItems:w.map(W=>({id:W.materialInternalId,name:W.materialName,price:W.unitPrice}))}),console.log(" MERGE PHASE: Performing safe merge..."),console.log(" Before merge - Existing items:",w.length),console.log(" Before merge - New items:",_.length),U=[...w,..._],console.log(" MERGE PHASE: Safe merge completed:",{existingItemsCount:w.length,newItemsCount:_.length,finalItemsCount:U.length,finalItems:U.map(W=>({id:W.materialInternalId,name:W.materialName,type:W.materialType}))})}}catch(w){console.error(" MERGE PHASE: Error in merge operation:",w)}else console.log(" MERGE PHASE: No existing items found, using only new items");console.log("Storing ID-based tender items:",{totalItems:U.length,newItems:_.length,items:U.map(w=>({id:w.internalId,materialId:w.materialInternalId,name:w.materialName,price:w.unitPrice,total:w.totalPrice}))}),await Ke.setPendingData(`pendingTenderItems_${Q||"new"}`,U,48),console.log(" STORAGE COMPLETE - Stored items to FirestorePendingDataService:",U.length),setTimeout(async()=>{const w=await Ke.getPendingData(`pendingTenderItems_${Q||"new"}`);console.log(" VERIFICATION: Items in storage after save:",{count:(w==null?void 0:w.length)||0,items:w})},100),console.log(" DISPATCHING CUSTOM EVENT: tenderItemsAdded"),window.dispatchEvent(new CustomEvent("tenderItemsAdded",{detail:{count:_.length,type:"foreignProduct",items:U}}));try{let w=" ";if(Q&&Q!=="new")try{const{tenderServiceNew:W}=await Xe(async()=>{const{tenderServiceNew:de}=await Promise.resolve().then(()=>Po);return{tenderServiceNew:de}},void 0),ie=await W.getTenderForViewing(Q);ie&&ie.entity?w=`: ${ie.entity}`:ie&&ie.title&&(w=`: ${ie.title}`)}catch(W){console.warn("Could not fetch tender entity, using default name:",W)}else try{const W=await Ke.getPendingData("tenderFormData_new");W&&W.entity&&(w=`: ${W.entity}`)}catch(W){console.warn("Could not fetch pending form data:",W)}for(const W of _)await ws.logItemAdd(W.materialName,w,"tender");console.log(` Logged ${_.length} individual foreign product activities with entity name: ${w}`)}catch(w){console.error("Failed to log enhanced activity:",w)}te(`  ${_.length}      `," "),D(!1),T([]),S(null),setTimeout(()=>{A(Q==="new"?"/tenders/add":`/tenders/edit/${Q}`)},2e3)}catch(b){console.error("Error in handleConfirmQuantities:",b),G("      -   ","  ")}},E=()=>{D(!1),T([]),S(null)},k=()=>Math.round(y.reduce((b,N)=>b+N.totalPrice,0));return l?t.jsx(It,{show:!0,message:"    ...",overlay:!1}):d?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:d}),t.jsxs("button",{className:"btn btn-primary",onClick:X,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[t.jsx(Rt,{onToggle:F}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!s?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-3",children:t.jsx("div",{className:"raw-materials-table",children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"row align-items-center justify-content-between",children:[t.jsx("div",{className:"col-lg-4",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-globe text-warning me-2"}),"   (",j.length,")"]})}),t.jsx("div",{className:"col-lg-8",children:t.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:f,onChange:b=>p(b.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:Y,disabled:a.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["  (",a.length,")"]})]})})]})}),t.jsx("div",{className:"card-body p-0",children:j.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-globe fs-1"})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:f?"    ":"      "})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "})]})}),t.jsx("tbody",{children:j.map(b=>{const N=nn.calculateLowestTotalCost(b);return t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",children:t.jsx("div",{className:"form-check d-flex justify-content-center",children:t.jsx("input",{className:"form-check-input",type:"checkbox",checked:a.some(I=>I.internalId===b.internalId),onChange:()=>ue(b),style:{transform:"scale(1.2)"}})})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"fw-bold text-primary",children:b.name})}),t.jsx("td",{className:"text-center",children:b.category||"-"}),t.jsx("td",{className:"text-center",children:b.unit||"-"}),t.jsx("td",{className:"text-center",children:N.totalCost?t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsxs("span",{children:[N.totalCost.toFixed(2)," "]}),N.hasQuotes&&t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"  "})]}):"-"}),t.jsx("td",{className:"text-center",children:N.displaySupplier?t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("span",{children:N.displaySupplier}),N.hasQuotes&&t.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"badge bg-warning text-dark",children:b.countryOfOrigin||" "})})]},b.id)})})]})})})]})})}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&s&&t.jsx(os,{rtl:!0}),!n&&s&&t.jsx(ls,{})]}),R&&t.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:99985},children:t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:E,"aria-label":"Close"})]}),t.jsxs("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:[x&&t.jsxs("div",{className:"alert alert-warning alert-dismissible m-3 mb-2",role:"alert",style:{background:"linear-gradient(45deg, #fff3cd, #ffeaa7)",border:"2px solid #f39c12",borderRadius:"8px",boxShadow:"0 4px 12px rgba(243, 156, 18, 0.3)"},children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-exclamation-triangle-fill text-warning me-2",style:{fontSize:"20px"}}),t.jsxs("div",{className:"flex-grow-1",children:[t.jsx("strong",{children:":  !"}),t.jsx("div",{className:"mt-1 text-dark",children:x}),t.jsx("small",{className:"text-muted",children:"      "})]})]}),t.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>S(null)})]}),t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"30%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),t.jsx("tbody",{children:y.map((b,N)=>t.jsxs("tr",{style:{height:"60px"},children:[t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:"bi bi-globe text-warning me-2"}),t.jsxs("div",{children:[t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:I=>{I.preventDefault(),I.stopPropagation(),A(`/foreign-products/edit/${b.id}`)},title:`  : ${b.name}`,children:b.name}),t.jsx("small",{className:"text-muted",children:b.category}),t.jsx("div",{children:t.jsx("span",{className:"badge bg-warning text-dark",style:{fontSize:"10px"},children:b.countryOfOrigin||" "})})]})]})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("span",{className:"fw-bold text-success",children:[Math.round(b.unitPrice)," "]}),t.jsx("div",{children:t.jsxs("small",{className:"text-muted",children:["/",b.unit||""]})})]}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>z(b.id,Math.max(0,Number((b.quantity-.1).toFixed(1)))),disabled:b.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-dash"})}),t.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:b.quantity,min:"0",step:"any",onChange:I=>z(b.id,I.target.value),onBlur:I=>{const P=Number(I.target.value||0).toFixed(1);z(b.id,P)}}),t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>z(b.id,Number((b.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-plus"})})]})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"text-muted",children:b.displaySupplier||"-"})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(b.totalPrice)," "]}),t.jsxs("small",{className:"text-success",children:["(",b.quantity.toFixed(1),"  ",Math.round(b.unitPrice),")"]})]})]},b.id))})]})})]}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:t.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("span",{className:"text-muted me-3",children:" :"}),t.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[k()," "]}),t.jsxs("span",{className:"badge bg-info ms-2",children:[y.reduce((b,N)=>b+N.quantity,0).toFixed(1)," "]})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:E,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{console.log(" CONFIRM BUTTON CLICKED! Modal items:",y),O()},style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})]})})]})})}),t.jsx(Mt,{show:$.show,onClose:H,title:$.title,message:$.message,type:$.type,onConfirm:$.onConfirm,showConfirm:$.showConfirm})]})}function l$(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(o$,{})})})}function c$(){const[n,e]=h.useState(!1),{isTimelineVisible:s}=Ut(),[r,i]=h.useState([]),[a,o]=h.useState([]),[l,c]=h.useState(!1),[d,u]=h.useState(null),[f,p]=h.useState(""),[j,L]=h.useState([]),[R,D]=h.useState(!1),[y,T]=h.useState([]),x=kt(),{tenderId:S}=Dn(),{logActivity:A,getCurrentUser:Q}=Zt(),{alertConfig:q,closeAlert:B,showSuccess:$,showError:H}=Bt(),{formatDate:te}=sc(),G=()=>{e(!n)},F=(b,N)=>{console.log(" SENIOR REACT: Starting advanced duplicate prevention analysis...");const I=[],P=[],_=new Map,C=new Map;return b.forEach((U,w)=>{const W=U.materialInternalId||U.internalId||U.id;W&&_.set(W,{item:U,index:w});const ie=(U.materialName||U.name||U.title||"").trim();if(ie){const de=ie.toLowerCase();C.set(de,{item:U,index:w})}}),console.log(" DUPLICATE PREVENTION MAPS:",{existingIdsCount:_.size,existingNamesCount:C.size}),N.forEach(U=>{const w=U.materialInternalId||U.internalId||U.id,W=(U.materialName||U.name||U.title||"").trim(),ie=W.toLowerCase();let de=!1,ne="",ye=null;w&&_.has(w)&&(de=!0,ne="ID",ye=_.get(w).item,console.log(` ID DUPLICATE: ${W} matches existing ID: ${w}`)),!de&&W&&C.has(ie)&&(de=!0,ne="NAME",ye=C.get(ie).item,console.log(` NAME DUPLICATE: "${W}" matches existing name (case-insensitive)`)),de?I.push({newItem:U,existingItem:ye,type:ne,displayName:W||"  "}):(P.push(U),console.log(` UNIQUE ITEM: ${W} - Adding to list`),w&&_.set(w,{item:U,index:-1}),W&&C.set(ie,{item:U,index:-1}))}),console.log(" DUPLICATE ANALYSIS COMPLETE:",{totalNewItems:N.length,uniqueItemsFound:P.length,duplicatesFound:I.length,duplicateDetails:I.map(U=>({name:U.displayName,type:U.type}))}),{duplicates:I,uniqueItems:P}};h.useEffect(()=>{X();const b=N=>{N.type==="manufacturedProductsUpdated"&&X()};return window.addEventListener("storage",b),window.addEventListener("focus",X),()=>{window.removeEventListener("storage",b),window.removeEventListener("focus",X)}},[]),h.useEffect(()=>{if(f.trim()){const b=r.filter(N=>{var I,P,_;return((I=N.title)==null?void 0:I.toLowerCase().includes(f.toLowerCase()))||((P=N.referenceNumber)==null?void 0:P.toLowerCase().includes(f.toLowerCase()))||((_=N.description)==null?void 0:_.toLowerCase().includes(f.toLowerCase()))});L(b)}else L(r)},[f,r]);const X=async()=>{try{c(!0);const N=(await ci.getAllManufacturedProducts()).filter(I=>I.status!=="inactive");i(N),u(null)}catch(b){u(b.message)}finally{c(!1)}},ue=b=>{if(a.some(I=>I.internalId===b.internalId))o(I=>I.filter(P=>P.internalId!==b.internalId));else{const I={...b,type:"manufacturedProduct",quantity:1};o(P=>[...P,I])}},Y=async()=>{if(a.length===0){H("      ","   ");return}const b=a.map(N=>{let I=0;return N.items&&Array.isArray(N.items)&&N.items.length>0?I=N.items.reduce((P,_)=>P+(_.totalPrice||0),0):I=N.estimatedValue||0,{...N,quantity:1,unitPrice:I,totalPrice:I,displaySupplier:" "}});T(b),D(!0)},z=(b,N)=>{const I=Math.max(0,parseFloat(N)||0);T(P=>P.map(_=>_.id===b?{..._,quantity:Number(I.toFixed(1)),totalPrice:_.unitPrice*Number(I.toFixed(1))}:_))},O=async()=>{try{if(!Array.isArray(y)||y.length===0){H("    ","  ");return}const b=await Ke.getPendingData(`pendingTenderItems_${S||"new"}`)||[],N=y.map(w=>({...w,materialName:w.title,materialInternalId:w.internalId})),I=F(b,N),{duplicates:P,uniqueItems:_}=I;if(P.length>0){const w=P.map(W=>{const ie=W.type==="ID"?" ":" ";return` "${W.displayName}" (${ie})`});H(`   ${P.length}  .     .

${w.join(`
`)}`," "),console.log(" DUPLICATES BLOCKED:",{count:P.length,names:P.map(W=>W.displayName)});return}const C=[];for(const w of _)try{const W={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:w.internalId,materialType:"manufacturedProduct",materialName:w.title,materialCategory:" ",materialUnit:"",quantity:w.quantity||1,unitPrice:w.unitPrice||0,totalPrice:(w.quantity||1)*(w.unitPrice||0),supplierInfo:" ",tenderId:S==="new"?"new":S,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};C.push(W)}catch(W){console.error("Error creating tender item:",W),H(`   : ${w.title}`,"  ");return}const U=[...b,...C];await Ke.setPendingData(`pendingTenderItems_${S||"new"}`,U,48);try{let w=" ";if(S&&S!=="new")try{const{tenderServiceNew:W}=await Xe(async()=>{const{tenderServiceNew:de}=await Promise.resolve().then(()=>Po);return{tenderServiceNew:de}},void 0),ie=await W.getTenderForViewing(S);ie&&ie.entity?w=`: ${ie.entity}`:ie&&ie.title&&(w=`: ${ie.title}`)}catch(W){console.warn("Could not fetch tender entity, using default name:",W)}else try{const W=await Ke.getPendingData("tenderFormData_new");W&&W.entity&&(w=`: ${W.entity}`)}catch(W){console.warn("Could not fetch pending form data:",W)}for(const W of C)await ws.logItemAdd(W.materialName,w,"tender");console.log(` Logged ${C.length} individual manufactured product activities with entity name: ${w}`)}catch(w){console.error("Failed to log enhanced activity:",w)}$(`  ${C.length}   `," "),window.dispatchEvent(new CustomEvent("tenderItemsAdded",{detail:{count:C.length,type:"manufacturedProduct",items:C}})),D(!1),T([]),setTimeout(()=>{x(S==="new"?"/tenders/add":`/tenders/edit/${S}`)},100)}catch(b){console.error("Error in handleConfirmQuantities:",b),H("     ","  ")}},E=()=>{D(!1),T([])},k=()=>Math.round(y.reduce((b,N)=>b+N.totalPrice,0));return l?t.jsx(It,{show:!0,message:"    ...",overlay:!1}):d?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:d}),t.jsxs("button",{className:"btn btn-primary",onClick:X,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[t.jsx(Rt,{onToggle:G}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!s?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-3",children:t.jsx("div",{className:"manufactured-products-table",children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"row align-items-center justify-content-between",children:[t.jsx("div",{className:"col-lg-4",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-tools text-warning me-2"}),"   (",j.length,")"]})}),t.jsx("div",{className:"col-lg-8",children:t.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:f,onChange:b=>p(b.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:Y,disabled:a.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["  (",a.length,")"]})]})})]})}),t.jsx("div",{className:"card-body p-0",children:j.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-tools fs-1"})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:f?"    ":"      "})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:" "})]})}),t.jsx("tbody",{children:j.map(b=>{let N=0;return b.items&&Array.isArray(b.items)&&b.items.length>0?N=b.items.reduce((I,P)=>I+(P.totalPrice||0),0):N=b.estimatedValue||0,t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",children:t.jsx("div",{className:"form-check d-flex justify-content-center",children:t.jsx("input",{className:"form-check-input",type:"checkbox",checked:a.some(I=>I.internalId===b.internalId),onChange:()=>ue(b),style:{transform:"scale(1.2)"}})})}),t.jsx("td",{className:"text-center",children:t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:I=>{I.preventDefault(),I.stopPropagation(),x(`/manufactured-products/edit/${b.id}`)},title:`  : ${b.title}`,children:b.title})}),t.jsx("td",{className:"text-center",children:b.referenceNumber||"-"}),t.jsx("td",{className:"text-center",children:N?t.jsxs("span",{className:"badge bg-success text-white",children:[N.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," ."]}):"-"}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"text-muted",children:te(b.submissionDeadline)})})]},b.id)})})]})})})]})})}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&s&&t.jsx(os,{rtl:!0}),!n&&s&&t.jsx(ls,{})]}),R&&t.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:99985},children:t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:E,"aria-label":"Close"})]}),t.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"30%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),t.jsx("tbody",{children:y.map((b,N)=>t.jsxs("tr",{style:{height:"60px"},children:[t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:"bi bi-tools text-warning me-2"}),t.jsxs("div",{children:[t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:I=>{I.preventDefault(),I.stopPropagation(),x(`/manufactured-products/edit/${b.id}`)},title:`  : ${b.title}`,children:b.title}),t.jsx("small",{className:"text-muted",children:b.referenceNumber})]})]})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("span",{className:"fw-bold text-success",children:[Math.round(b.unitPrice)," "]}),t.jsx("div",{children:t.jsx("small",{className:"text-muted",children:"/"})})]}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>z(b.id,Math.max(0,Number((b.quantity-.1).toFixed(1)))),disabled:b.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-dash"})}),t.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:b.quantity,min:"0",step:"any",onChange:I=>z(b.id,I.target.value),onBlur:I=>{const P=Number(I.target.value||0).toFixed(1);z(b.id,P)}}),t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>z(b.id,Number((b.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-plus"})})]})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"badge bg-warning text-dark",children:" "})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(b.totalPrice)," "]}),t.jsxs("small",{className:"text-success",children:["(",b.quantity.toFixed(1),"  ",Math.round(b.unitPrice),")"]})]})]},b.id))})]})})}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:t.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("span",{className:"text-muted me-3",children:" :"}),t.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[k()," "]}),t.jsxs("span",{className:"badge bg-info ms-2",children:[y.reduce((b,N)=>b+N.quantity,0).toFixed(1)," "]})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:E,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:O,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})]})})]})})}),t.jsx(Mt,{show:q.show,onClose:B,title:q.title,message:q.message,type:q.type,onConfirm:q.onConfirm,showConfirm:q.showConfirm})]})}function d$(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(c$,{})})})}const dl="suppliers";class rr{static async getAllSuppliers(){try{const e=Pe(ae,dl);let s;try{s=st(e,as("createdAt","desc"))}catch{console.log("Using query without orderBy for empty collection"),s=st(e)}const i=(await qe(s)).docs.map(a=>{var l,c;const o=a.data();return{id:a.id,internalId:o.internalId||Ct("LOCAL_SUPPLIER"),...o,createdAt:(l=o.createdAt)==null?void 0:l.toDate(),updatedAt:(c=o.updatedAt)==null?void 0:c.toDate()}});return i.length>0&&i[0].createdAt&&i.sort((a,o)=>(o.createdAt||new Date(0))-(a.createdAt||new Date(0))),i}catch(e){if(console.error("Error fetching suppliers:",e),e.code==="failed-precondition"||e.code==="not-found")return console.log("Suppliers collection not found, returning empty array"),[];throw new Error("   ")}}static async createSupplier(e){try{const s=Ct("LOCAL_SUPPLIER"),r={...e,internalId:s,createdAt:We(),updatedAt:We()};return(await As(Pe(ae,dl),r)).id}catch(s){throw console.error("Error creating supplier:",s),new Error("   ")}}static async updateSupplier(e,s){try{const r=Le(ae,dl,e),i={...s,updatedAt:We()};return await Qt(r,i),!0}catch(r){throw console.error("Error updating supplier:",r),new Error("    ")}}static async getSupplierById(e){var s,r;try{const i=Le(ae,dl,e),a=await ss(i);if(a.exists()){const o=a.data();return{id:a.id,internalId:o.internalId||Ct("LOCAL_SUPPLIER"),...o,createdAt:(s=o.createdAt)==null?void 0:s.toDate(),updatedAt:(r=o.updatedAt)==null?void 0:r.toDate()}}else return null}catch(i){throw console.error("Error fetching supplier by ID:",i),new Error("    ")}}static async getSupplierByInternalId(e){var s,r;try{const i=Pe(ae,dl),a=st(i,xt("internalId","==",e)),o=await qe(a);if(o.empty)return null;{const l=o.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:(s=c.createdAt)==null?void 0:s.toDate(),updatedAt:(r=c.updatedAt)==null?void 0:r.toDate()}}}catch(i){throw console.error("Error fetching supplier by internal ID:",i),new Error("    ")}}static async updateSupplierByInternalId(e,s){try{const r=await this.getSupplierByInternalId(e);if(!r)throw new Error("Supplier not found");return await this.updateSupplier(r.id,s)}catch(r){throw console.error("Error updating supplier by internal ID:",r),new Error("    ")}}static async deleteSupplier(e){try{const s=Le(ae,dl,e);return await es(s),!0}catch(s){throw console.error("Error deleting supplier:",s),new Error("   ")}}static async deleteSupplierByInternalId(e){try{const s=await this.getSupplierByInternalId(e);if(!s)throw new Error("Supplier not found");return await this.deleteSupplier(s.id)}catch(s){throw console.error("Error deleting supplier by internal ID:",s),new Error("   ")}}static async searchSuppliers(e){try{const s=Pe(ae,dl);return(await qe(s)).docs.map(o=>{var c,d;const l=o.data();return{id:o.id,internalId:l.internalId||Ct("LOCAL_SUPPLIER"),...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}}).filter(o=>{var l,c,d;return((l=o.name)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))||((c=o.email)==null?void 0:c.toLowerCase().includes(e.toLowerCase()))||((d=o.phone)==null?void 0:d.includes(e))})}catch(s){throw console.error("Error searching suppliers:",s),new Error("    ")}}static async migrateExistingData(){try{console.log("Starting local suppliers migration...");const e=await this.getAllSuppliers();let s=0;for(const r of e)if(!r.internalId||!r.internalId.startsWith("ls_")){const i=Ct("LOCAL_SUPPLIER");await this.updateSupplier(r.id,{...r,internalId:i}),s++,console.log(`Migrated local supplier: ${r.name} -> ${i}`)}return console.log(`Migration completed. ${s} local suppliers migrated.`),{success:!0,migratedCount:s}}catch(e){throw console.error("Error during migration:",e),new Error("   ")}}static validateSupplierData(e){var r,i,a;const s={};return(r=e.name)!=null&&r.trim()||(s.name="  "),(i=e.email)!=null&&i.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(s.email="    "):s.email="  ",(a=e.phone)!=null&&a.trim()||(s.phone="  "),s}}const $j=Object.freeze(Object.defineProperty({__proto__:null,SupplierService:rr},Symbol.toStringTag,{value:"Module"})),Vi="foreignSuppliers";class ir{static async getAllForeignSuppliers(){return this.getAllSuppliers()}static async getAllSuppliers(){try{const e=Pe(ae,Vi);let s;try{const i=st(e,as("createdAt","desc"));s=await qe(i,"getAllForeignSuppliers")}catch(i){console.log("OrderBy failed, using simple query:",i.message),s=await qe(e,"getAllForeignSuppliers-simple")}const r=s.docs.map(i=>{var o,l,c,d;const a=i.data();return{id:i.id,internalId:a.internalId||Ct("FOREIGN_SUPPLIER"),...a,createdAt:((l=(o=a.createdAt)==null?void 0:o.toDate)==null?void 0:l.call(o))||new Date,updatedAt:((d=(c=a.updatedAt)==null?void 0:c.toDate)==null?void 0:d.call(c))||new Date}});return r.length>0&&r[0].createdAt&&r.sort((i,a)=>(a.createdAt||new Date(0))-(i.createdAt||new Date(0))),r}catch(e){if(console.error("Error fetching foreign suppliers:",e),e.code==="failed-precondition"||e.code==="not-found")return console.log("Foreign suppliers collection not found, returning empty array"),[];throw new Error("    : "+e.message)}}static async getSupplierById(e){var s,r,i,a;try{const o=await $1(Vi,e);if(!o)throw new Error("Foreign supplier not found");return{...o,internalId:o.internalId||Ct("FOREIGN_SUPPLIER"),createdAt:((r=(s=o.createdAt)==null?void 0:s.toDate)==null?void 0:r.call(s))||new Date,updatedAt:((a=(i=o.updatedAt)==null?void 0:i.toDate)==null?void 0:a.call(i))||new Date}}catch(o){throw console.error("Error fetching foreign supplier:",o),new Error("Failed to fetch foreign supplier: "+o.message)}}static async createSupplier(e){try{const s=this.validateSupplierData(e);if(Object.keys(s).length>0)throw new Error("Validation failed: "+Object.values(s).join(", "));const r=Pe(ae,Vi),i=Ct("FOREIGN_SUPPLIER"),a={...e,internalId:i,createdAt:We(),updatedAt:We(),status:e.status||"active"};return{id:await U1(Vi,a),...a,createdAt:new Date,updatedAt:new Date}}catch(s){throw console.error("Error creating foreign supplier:",s),new Error("Failed to create foreign supplier: "+s.message)}}static async updateSupplier(e,s){try{const r=this.validateSupplierData(s);if(Object.keys(r).length>0)throw new Error("Validation failed: "+Object.values(r).join(", "));const i=Le(ae,Vi,e),a={...s,updatedAt:We()};return await Qt(i,a,"updateForeignSupplier"),{id:e,...a,updatedAt:new Date}}catch(r){throw console.error("Error updating foreign supplier:",r),new Error("Failed to update foreign supplier: "+r.message)}}static async getSupplierByInternalId(e){var s,r,i,a;try{const o=Pe(ae,Vi),l=st(o,xt("internalId","==",e)),c=await qe(l,"getForeignSupplierByInternalId");if(c.empty)return null;{const d=c.docs[0],u=d.data();return{id:d.id,internalId:u.internalId,...u,createdAt:((r=(s=u.createdAt)==null?void 0:s.toDate)==null?void 0:r.call(s))||new Date,updatedAt:((a=(i=u.updatedAt)==null?void 0:i.toDate)==null?void 0:a.call(i))||new Date}}}catch(o){throw console.error("Error fetching foreign supplier by internal ID:",o),new Error("Failed to fetch foreign supplier by internal ID: "+o.message)}}static async updateSupplierByInternalId(e,s){try{const r=await this.getSupplierByInternalId(e);if(!r)throw new Error("Foreign supplier not found");return await this.updateSupplier(r.id,s)}catch(r){throw console.error("Error updating foreign supplier by internal ID:",r),new Error("Failed to update foreign supplier by internal ID: "+r.message)}}static async deleteSupplier(e){try{const s=Le(ae,Vi,e);return await es(s,"deleteForeignSupplier"),{success:!0,message:"Foreign supplier deleted successfully"}}catch(s){throw console.error("Error deleting foreign supplier:",s),new Error("Failed to delete foreign supplier: "+s.message)}}static async deleteSupplierByInternalId(e){try{const s=await this.getSupplierByInternalId(e);if(!s)throw new Error("Foreign supplier not found");return await this.deleteSupplier(s.id)}catch(s){throw console.error("Error deleting foreign supplier by internal ID:",s),new Error("Failed to delete foreign supplier by internal ID: "+s.message)}}static async getSuppliersByStatus(e){try{const s=Pe(ae,Vi),r=st(s,xt("status","==",e),as("createdAt","desc"));return(await qe(r,"getForeignSuppliersByStatus")).docs.map(a=>{var l,c,d,u;const o=a.data();return{id:a.id,internalId:o.internalId||Ct("FOREIGN_SUPPLIER"),...o,createdAt:((c=(l=o.createdAt)==null?void 0:l.toDate)==null?void 0:c.call(l))||new Date,updatedAt:((u=(d=o.updatedAt)==null?void 0:d.toDate)==null?void 0:u.call(d))||new Date}})}catch(s){throw console.error("Error fetching foreign suppliers by status:",s),new Error("Failed to fetch foreign suppliers by status: "+s.message)}}static async searchSuppliers(e){try{const s=Pe(ae,Vi),i=(await qe(s,"searchForeignSuppliers")).docs.map(o=>{var c,d,u,f;const l=o.data();return{id:o.id,internalId:l.internalId||Ct("FOREIGN_SUPPLIER"),...l,createdAt:((d=(c=l.createdAt)==null?void 0:c.toDate)==null?void 0:d.call(c))||new Date,updatedAt:((f=(u=l.updatedAt)==null?void 0:u.toDate)==null?void 0:f.call(u))||new Date}});if(!e||e.trim()==="")return i;const a=e.toLowerCase();return i.filter(o=>{var l,c,d,u,f;return((l=o.name)==null?void 0:l.toLowerCase().includes(a))||((c=o.email)==null?void 0:c.toLowerCase().includes(a))||((d=o.phone)==null?void 0:d.includes(e))||((u=o.city)==null?void 0:u.toLowerCase().includes(a))||((f=o.address)==null?void 0:f.toLowerCase().includes(a))})}catch(s){throw console.error("Error searching foreign suppliers:",s),new Error("Failed to search foreign suppliers: "+s.message)}}static validateSupplierData(e){const s={};return(!e.name||e.name.trim()==="")&&(s.name="Company name is required"),!e.email||e.email.trim()===""?s.email="Email is required":this.validateEmail(e.email)||(s.email="Please enter a valid email address"),(!e.phone||e.phone.trim()==="")&&(s.phone="Phone number is required"),e.email&&!this.validateEmail(e.email)&&(s.email="Please enter a valid email address"),e.name&&e.name.length<2&&(s.name="Company name must be at least 2 characters long"),e.phone&&e.phone.length<10&&(s.phone="Phone number must be at least 10 digits long"),s}static validateEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static async uploadDocument(e,s,r="general"){try{if(!s)throw new Error("No file provided");const i=`${Date.now()}_${s.name}`,a=ii(In,`foreign-suppliers/${e}/documents/${r}/${i}`),o=await Uc(a,s),l=await wl(o.ref);return{fileName:s.name,url:l,type:r,uploadedAt:new Date,size:s.size}}catch(i){throw console.error("Error uploading document:",i),new Error("Failed to upload document: "+i.message)}}static async deleteDocument(e){try{const s=ii(In,e);return await xh(s),{success:!0,message:"Document deleted successfully"}}catch(s){throw console.error("Error deleting document:",s),new Error("Failed to delete document: "+s.message)}}static async migrateExistingData(){try{console.log("Starting foreign suppliers migration...");const e=await this.getAllSuppliers();let s=0;for(const r of e)if(!r.internalId||!r.internalId.startsWith("fs_")){const i=Ct("FOREIGN_SUPPLIER");await this.updateSupplier(r.id,{...r,internalId:i}),s++,console.log(`Migrated foreign supplier: ${r.name} -> ${i}`)}return console.log(`Migration completed. ${s} foreign suppliers migrated.`),{success:!0,migratedCount:s}}catch(e){throw console.error("Error during migration:",e),new Error("Failed to migrate foreign suppliers: "+e.message)}}static async getSupplierStats(){try{const e=Pe(ae,Vi),r=(await qe(e,"getForeignSupplierStats")).docs.map(i=>i.data());return{total:r.length,active:r.filter(i=>i.status==="active").length,inactive:r.filter(i=>i.status==="inactive").length,pending:r.filter(i=>i.status==="pending").length,byCity:r.reduce((i,a)=>{const o=a.city||"Unknown";return i[o]=(i[o]||0)+1,i},{})}}catch(e){throw console.error("Error fetching foreign supplier stats:",e),new Error("Failed to fetch foreign supplier statistics: "+e.message)}}}const zj=Object.freeze(Object.defineProperty({__proto__:null,ForeignSupplierService:ir},Symbol.toStringTag,{value:"Module"})),cr=(n,e=30)=>{const[s,r]=h.useState(1),i=Math.ceil(n.length/e),a=h.useMemo(()=>{const u=(s-1)*e,f=u+e;return n.slice(u,f)},[n,s,e]),o=h.useCallback(u=>{var f;if(u>=1&&u<=i){r(u);const p=(f=document.querySelector("[data-list] table"))==null?void 0:f.closest('[style*="overflow"]');p?p.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})}},[i]),l=h.useCallback(()=>{r(1)},[]),c=h.useCallback(()=>{r(1)},[]),d=h.useCallback(()=>{r(i)},[i]);return{currentPage:s,totalPages:i,paginatedItems:a,handlePageChange:o,resetPage:l,goToFirstPage:c,goToLastPage:d,totalItems:n.length,itemsPerPage:e,hasNextPage:s<i,hasPreviousPage:s>1}},dr=({currentPage:n,totalPages:e,onPageChange:s,totalItems:r,itemsPerPage:i=30,showItemsInfo:a=!0})=>{const o=()=>{const u=[],f=[];for(let p=Math.max(2,n-2);p<=Math.min(e-1,n+2);p++)u.push(p);return n-2>2?f.push(1,"..."):f.push(1),f.push(...u),n+2<e-1?f.push("...",e):f.push(e),f},l=(n-1)*i+1,c=Math.min(n*i,r);return e<=1?null:t.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-4 px-3 py-3 border-top bg-light",children:[a&&t.jsx("div",{className:"text-muted",children:t.jsxs("small",{children:[" ",l.toLocaleString("en-US")," - ",c.toLocaleString("en-US"),"  ",r.toLocaleString("en-US")," "]})}),t.jsx("nav",{"aria-label":"  ",children:t.jsxs("ul",{className:"pagination pagination-sm mb-0",style:{direction:"ltr"},children:[t.jsx("li",{className:`page-item ${n===1?"disabled":""}`,children:t.jsxs("span",{className:"page-link",onClick:()=>{n>1&&s(n-1)},style:{borderRadius:"6px 0 0 6px",border:"1px solid #dee2e6",color:n===1?"#6c757d":"#007bff",cursor:n===1?"not-allowed":"pointer",userSelect:"none"},role:n===1?"text":"button",tabIndex:n===1?-1:0,children:[t.jsx("i",{className:"bi bi-chevron-left",style:{fontSize:"12px"}}),t.jsx("span",{className:"me-1",children:""})]})}),o().map((d,u)=>t.jsx("li",{className:`page-item ${d===n?"active":""}`,children:d==="..."?t.jsx("span",{className:"page-link",style:{border:"1px solid #dee2e6",color:"#6c757d",cursor:"default"},children:"..."}):t.jsx("span",{className:"page-link",onClick:()=>{d!==n&&d>=1&&d<=e&&s(d)},style:{border:"1px solid #dee2e6",minWidth:"40px",backgroundColor:d===n?"#007bff":"white",color:d===n?"white":"#007bff",fontWeight:d===n?"600":"400",cursor:d===n?"default":"pointer",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center"},role:"button",tabIndex:d===n?-1:0,children:d})},u)),t.jsx("li",{className:`page-item ${n===e?"disabled":""}`,children:t.jsxs("span",{className:"page-link",onClick:()=>{n<e&&s(n+1)},style:{borderRadius:"0 6px 6px 0",border:"1px solid #dee2e6",color:n===e?"#6c757d":"#007bff",cursor:n===e?"not-allowed":"pointer",userSelect:"none"},role:n===e?"text":"button",tabIndex:n===e?-1:0,children:[t.jsx("span",{className:"ms-1",children:""}),t.jsx("i",{className:"bi bi-chevron-right",style:{fontSize:"12px"}})]})})]})}),!a&&t.jsx("div",{})]})},ic=(n,e={})=>{if(!Array.isArray(n)||n.length===0)return n;const{primaryDateField:s="createdAt",fallbackDateFields:r=["updatedAt","dateAdded","timestamp","date"],debugMode:i=!1}=e;return n.sort((a,o)=>{const l=Vj(a,s,r),c=Vj(o,s,r);if(i&&console.log("Sorting comparison:",{itemA:a.title||a.name||a.id,itemB:o.title||o.name||o.id,dateA:l?new Date(l).toISOString():"No date",dateB:c?new Date(c).toISOString():"No date"}),l&&c){const f=new Date(l).getTime();return new Date(c).getTime()-f}if(l&&!c)return-1;if(!l&&c)return 1;const d=Gj(a),u=Gj(o);return d&&u?u-d:0})},Vj=(n,e,s)=>{if(n[e])return Bj(n[e]);for(const r of s)if(n[r])return Bj(n[r]);return null},Bj=n=>n?typeof n=="object"&&n.seconds?new Date(n.seconds*1e3):typeof n=="object"&&typeof n.toDate=="function"?n.toDate():n:null,Gj=n=>{const e=["id","internalId","_id","uid"];for(const s of e){const r=n[s];if(r){if(typeof r=="number")return r;if(typeof r=="string"){const i=r.match(/\d+/);if(i)return parseInt(i[0],10)}}}return null},Bz=n=>!Array.isArray(n)||n.length===0?n:n.sort((e,s)=>{const r=c=>{const d=c.submissionDeadline||c.deadline||c.submissionDate||c.endDate;return d?typeof d=="object"&&d.seconds?new Date(d.seconds*1e3):typeof d=="object"&&typeof d.toDate=="function"?d.toDate():new Date(d):null},i=r(e),a=r(s);if(console.log("Sorting comparison:",{tenderA:e.title,tenderB:s.title,dateA:i?i.toISOString():"No date",dateB:a?a.toISOString():"No date"}),i&&a)return a.getTime()-i.getTime();if(i&&!a)return-1;if(!i&&a)return 1;const o=e.createdAt?new Date(e.createdAt):null,l=s.createdAt?new Date(s.createdAt):null;return o&&l?l.getTime()-o.getTime():0}),Kf=n=>ic(n,{primaryDateField:"createdAt",fallbackDateFields:["updatedAt","dateAdded"]}),Y1=n=>ic(n,{primaryDateField:"createdAt",fallbackDateFields:["updatedAt","dateAdded"]}),u$=n=>ic(n,{primaryDateField:"createdAt",fallbackDateFields:["updatedAt","dateAdded"]}),h$=n=>ic(n,{primaryDateField:"createdAt",fallbackDateFields:["updatedAt","dateAdded"]}),m$=n=>ic(n,{primaryDateField:"createdAt",fallbackDateFields:["updatedAt","dateAdded"]}),p$=n=>ic(n,{primaryDateField:"createdAt",fallbackDateFields:["updatedAt","dateAdded"]}),f$=n=>ic(n,{primaryDateField:"createdAt",fallbackDateFields:["updatedAt","dateAdded"]}),g$=({refreshTrigger:n,searchTerm:e})=>{var Ee,Re;const[s,r]=h.useState([]),[i,a]=h.useState(!0),[o,l]=h.useState(null),[c,d]=h.useState(""),u=e!==void 0?e:c,[f,p]=h.useState([]),[j,L]=h.useState(!1),[R,D]=h.useState(!1),[y,T]=h.useState(!1),[x,S]=h.useState(null),[A,Q]=h.useState([]),[q,B]=h.useState([]),[$,H]=h.useState([]),te=kt(),G=Xr(),{logActivity:F,getCurrentUser:X}=Zt(),{alertConfig:ue,closeAlert:Y,showSuccess:z,showError:O,showConfirm:E}=Bt(),k=((Ee=G.state)==null?void 0:Ee.fromTender)||!1,b=((Re=G.state)==null?void 0:Re.tenderData)||null,{currentPage:N,totalPages:I,paginatedItems:P,handlePageChange:_,resetPage:C,totalItems:U,itemsPerPage:w}=cr(f,30);h.useEffect(()=>{W(),ie();const fe=et=>{et.key==="rawMaterials_updated"&&W()},Ve=()=>{W()};window.addEventListener("storage",fe),window.addEventListener("rawMaterialsUpdated",Ve);const $e=()=>{W()};return window.addEventListener("focus",$e),()=>{window.removeEventListener("storage",fe),window.removeEventListener("rawMaterialsUpdated",Ve),window.removeEventListener("focus",$e)}},[]),h.useEffect(()=>{n&&W()},[n]),h.useEffect(()=>{if(u.trim()){console.log("Searching for:",u),console.log("Total materials before filter:",s.length);const fe=s.filter(Ve=>{var $e,et,ze,tt;return(($e=Ve.name)==null?void 0:$e.toLowerCase().includes(u.toLowerCase()))||((et=Ve.category)==null?void 0:et.toLowerCase().includes(u.toLowerCase()))||((ze=Ve.description)==null?void 0:ze.toLowerCase().includes(u.toLowerCase()))||((tt=Ve.supplier)==null?void 0:tt.toLowerCase().includes(u.toLowerCase()))});console.log("Filtered materials:",fe.length),console.log("First filtered material:",fe[0]),p(fe)}else console.log("No search term, showing all materials:",s.length),p(s);C()},[u,s,C]);const W=async()=>{try{a(!0);const fe=await Tn.getAllRawMaterials(),Ve=h$(fe);r(Ve),l(null)}catch(fe){l(fe.message)}finally{a(!1)}},ie=async()=>{try{const[fe,Ve]=await Promise.all([rr.getAllSuppliers(),ir.getAllSuppliers()]);Q(fe),B(Ve)}catch(fe){console.error("Error loading suppliers:",fe)}},de=async(fe,Ve)=>{try{if(Ve==="local"){const $e=A.find(et=>et.name===fe);$e&&(S($e),D(!0))}else if(Ve==="foreign"){const $e=q.find(et=>et.name===fe);$e&&(S($e),T(!0))}}catch($e){console.error("Error opening supplier modal:",$e)}},ne=()=>{D(!1),T(!1),S(null)},ye=fe=>{E(`       

${fe.name}`,()=>pe(fe),"   ")},pe=async fe=>{try{L(!0),await bs.moveToTrash(fe,"rawmaterials"),await Tn.deleteRawMaterial(fe.id);const Ve=X();F("task",`${Ve.name}   `,`   : ${fe.name}`),await W(),z(`    : ${fe.name}`,"  ")}catch(Ve){l(Ve.message),O(`     : ${Ve.message}`,"  ")}finally{L(!1)}},be=fe=>{if($.some($e=>$e.internalId===fe.internalId))H($e=>$e.filter(et=>et.internalId!==fe.internalId));else{const $e={...fe,type:"rawMaterials",quantity:1};H(et=>[...et,$e])}},xe=async()=>{const fe=$.map($e=>({internalId:$e.internalId,type:"rawMaterials",quantity:$e.quantity||1,addedAt:new Date().toISOString()}));await Ke.setPendingTenderItems(fe);const Ve=b!=null&&b.id?`/tenders/edit/${b.id}`:"/tenders/add";te(Ve,{state:{selectedItems:fe,fromSelection:!0}})};return i?t.jsx(It,{show:!0,message:"    ...",overlay:!1}):o?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:o}),t.jsxs("button",{className:"btn btn-primary",onClick:W,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):t.jsxs("div",{"data-list":"raw-materials",children:[f.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-box-seam fs-1"})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:u?"    ":"      "}),!u&&!k&&t.jsxs("button",{className:"btn btn-primary",onClick:()=>te("/raw-materials/add"),children:[t.jsx("i",{className:"bi bi-plus-lg me-1"}),"   "]})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",style:{width:"120px"},children:""})]})}),t.jsx("tbody",{children:P.map((fe,Ve)=>{let $e=fe.price,et=fe.supplier,ze=!1,tt=null,rt=null;return fe.priceQuotes&&Array.isArray(fe.priceQuotes)&&fe.priceQuotes.length>0&&(ze=!0,rt=fe.priceQuotes.reduce((bt,At)=>{const ns=parseFloat(bt.price)||0;return(parseFloat(At.price)||0)<ns?At:bt}),$e=rt.price,et=rt.supplierName,tt=rt.supplierType),t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(N-1)*w+Ve+1})}),t.jsx("td",{className:"text-center",children:t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary material-name-btn",onClick:bt=>{if(bt.preventDefault(),bt.stopPropagation(),console.log("=== MATERIAL BUTTON CLICKED ==="),console.log("Material Name:",fe.name),console.log("Material ID:",fe.id),console.log("Material Object:",fe),console.log("Navigate function:",typeof te),fe.id){const At=`/raw-materials/edit/${fe.id}`;console.log("Navigating to:",At);try{te(At),console.log(" Navigation successful")}catch(ns){console.log(" Navigation failed:",ns),O("     ","  ")}}else console.error("Material ID is missing:",fe),O("     ","  ");console.log("=== END CLICK HANDLER ===")},onMouseDown:bt=>bt.preventDefault(),style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0",userSelect:"none",pointerEvents:"auto",zIndex:"1"},title:`  | Internal ID: ${fe.internalId||"Not Set"} | Firebase ID: ${fe.id||"Missing"}`,children:fe.name})}),t.jsx("td",{className:"text-center",children:fe.category||"-"}),t.jsx("td",{className:"text-center",children:fe.unit||"-"}),t.jsx("td",{className:"text-center",children:$e?t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsxs("span",{children:[$e," "]}),ze&&t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),t.jsx("td",{className:"text-center",children:et?t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[ze&&tt?t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",onClick:()=>de(et,tt),style:{textDecoration:"none"},title:`  ${tt==="local"?" ":" "}`,children:et}):t.jsx("span",{children:et}),ze&&t.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),t.jsx("td",{className:"text-center",children:k?t.jsx("div",{className:"form-check d-flex justify-content-center",children:t.jsx("input",{className:"form-check-input",type:"checkbox",checked:$.some(bt=>bt.internalId===fe.internalId),onChange:()=>be(fe),style:{transform:"scale(1.2)"}})}):t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(Tt,{can:"products:update",mode:"disable",children:t.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>te(`/raw-materials/edit/${fe.id}`),title:"",children:t.jsx("i",{className:"bi bi-pencil"})})}),t.jsx(Tt,{can:"products:delete",mode:"disable",children:t.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>ye(fe),title:"",children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},fe.internalId||fe.id)})})]})}),f.length>0&&t.jsx(dr,{currentPage:N,totalPages:I,onPageChange:_,totalItems:U,itemsPerPage:w}),k&&t.jsx("div",{className:"card-footer border-top bg-light p-3",children:t.jsx("div",{className:"d-flex gap-2 justify-content-center",children:t.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:xe,disabled:$.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[t.jsx("i",{className:"bi bi-check-circle-fill me-2"}),"  (",$.length,")"]})})}),R&&x&&ty.createPortal(t.jsx("div",{className:"modal show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.6)",zIndex:10500,position:"fixed",top:0,left:0,right:0,bottom:0,backdropFilter:"blur(2px)"},tabIndex:"-1",onClick:fe=>{fe.target===fe.currentTarget&&ne()},children:t.jsx("div",{className:"modal-dialog modal-lg",onClick:fe=>fe.stopPropagation(),children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 25px 50px rgba(0,0,0,0.25)",overflow:"hidden"},children:[t.jsxs("div",{className:"modal-header border-0",style:{backgroundColor:"#007bff"},children:[t.jsxs("h5",{className:"modal-title mb-0 d-flex align-items-center",style:{color:"white !important"},children:[t.jsx("i",{className:"bi bi-shop me-2 fs-4",style:{color:"white"}}),t.jsxs("span",{style:{color:"white",fontWeight:"bold"},children:["   - ",x.name]})]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:ne})]}),t.jsx("div",{className:"modal-body",children:t.jsxs("div",{className:"row g-3",children:[t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.name})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.email||""})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:x.phone||""})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.city||""})]}),t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.address||""})]}),x.taxNumber&&t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.taxNumber})]}),x.bankAccount&&t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:"  "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.bankAccount})]}),x.notes&&t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.notes})]})]})}),t.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center bg-light",children:t.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:ne,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""})})]})})}),document.body),y&&x&&ty.createPortal(t.jsx("div",{className:"modal show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.6)",zIndex:10500,position:"fixed",top:0,left:0,right:0,bottom:0,backdropFilter:"blur(2px)"},tabIndex:"-1",onClick:fe=>{fe.target===fe.currentTarget&&ne()},children:t.jsx("div",{className:"modal-dialog modal-lg",onClick:fe=>fe.stopPropagation(),children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 25px 50px rgba(0,0,0,0.25)",overflow:"hidden"},children:[t.jsxs("div",{className:"modal-header border-0",style:{backgroundColor:"#007bff"},children:[t.jsxs("h5",{className:"modal-title mb-0 d-flex align-items-center",style:{color:"white !important"},children:[t.jsx("i",{className:"bi bi-globe me-2 fs-4",style:{color:"white"}}),t.jsxs("span",{style:{color:"white",fontWeight:"bold"},children:["   - ",x.name]})]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:ne})]}),t.jsx("div",{className:"modal-body",children:t.jsxs("div",{className:"row g-3",children:[t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.name})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.email||""})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:x.phone||""})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.country||""})]}),t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.address||""})]}),x.taxNumber&&t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.taxNumber})]}),x.bankAccount&&t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:"  "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.bankAccount})]}),x.notes&&t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.notes})]})]})}),t.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center bg-light",children:t.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:ne,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""})})]})})}),document.body),t.jsx(Mt,{show:ue.show,onClose:Y,title:ue.title,message:ue.message,type:ue.type,onConfirm:ue.onConfirm,confirmText:ue.confirmText,cancelText:ue.cancelText,showCancel:ue.showCancel})]})},x$=({searchTerm:n})=>{const[e,s]=h.useState(0),[r,i]=h.useState(0);h.useEffect(()=>{a()},[n]);const a=async()=>{try{const o=await Tn.getAllRawMaterials();if(s(o.length),n!=null&&n.trim()){const l=o.filter(c=>{var d,u,f,p;return((d=c.name)==null?void 0:d.toLowerCase().includes(n.toLowerCase()))||((u=c.category)==null?void 0:u.toLowerCase().includes(n.toLowerCase()))||((f=c.description)==null?void 0:f.toLowerCase().includes(n.toLowerCase()))||((p=c.supplier)==null?void 0:p.toLowerCase().includes(n.toLowerCase()))});i(l.length)}else i(o.length)}catch(o){console.error("Error loading raw materials count:",o),s(0),i(0)}};return t.jsx("span",{className:"badge bg-secondary ms-2",style:{fontSize:"12px",fontWeight:"normal"},children:n!=null&&n.trim()?`${r}  ${e}`:e})};function y$(){const[n,e]=h.useState(!1),[s,r]=h.useState(0),[i,a]=h.useState(""),{isTimelineVisible:o}=Ut(),l=kt(),c=()=>{e(!n)};return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[t.jsx(Rt,{onToggle:c}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!o?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"20px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef",pointerEvents:"none"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-box text-primary me-2"}),"  "]}),t.jsx(x$,{searchTerm:i})]}),t.jsxs("div",{className:"d-flex align-items-center gap-3",style:{pointerEvents:"auto"},children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px",pointerEvents:"auto"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:i,onChange:d=>a(d.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px",pointerEvents:"auto"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsx("button",{onClick:()=>l("/raw-materials/add"),className:"btn btn-primary",style:{height:"40px",width:"140px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap",pointerEvents:"auto"},children:"  "})]})]})}),t.jsx("div",{style:{height:"calc(100vh - 280px)",overflowY:"auto",overflowX:"hidden",position:"relative",zIndex:1},children:t.jsx("div",{className:"card-body p-0",children:t.jsx(g$,{refreshTrigger:s,searchTerm:i})})})]})}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&o&&t.jsx(os,{rtl:!0}),!n&&o&&t.jsx(ls,{})]})})})}function b$(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(y$,{})})})}const w$={logo:()=>T1,logoSm:()=>A1,user:()=>_1,pdfIcon:()=>R1,menuArrow:()=>D1},Ad=({size:n=32,clickable:e=!1,onClick:s=null,title:r="PDF",className:i="",style:a={}})=>{const o={width:`${n}px`,height:`${n}px`,objectFit:"contain",...e&&{cursor:"pointer"},...a},l=c=>{e&&s&&(c.preventDefault(),s(c))};return t.jsx("img",{src:w$.pdfIcon(),alt:"PDF",title:r,className:i,style:o,onClick:l})},v$=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>Go),void 0)),N$=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>Wo),void 0)),j$=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>fi),void 0).then(n=>({default:n.ActivityProvider}))),S$=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>fi),void 0).then(n=>({default:n.AutoActivityTracker}))),E$=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>E1),void 0));function C$(){var Os,vs,Z;const[n,e]=h.useState(!1),{isTimelineVisible:s}=Ut(),[r,i]=h.useState({name:"",category:"",description:"",unit:"",price:"",supplier:"",stockQuantity:"",minimumStock:"",storageConditions:"",expiryDate:"",batchNumber:"",origin:"",notes:"",active:!0}),[a,o]=h.useState({}),[l,c]=h.useState(!1),[d,u]=h.useState(!1),[f,p]=h.useState(!1),[j,L]=h.useState(!1),[R,D]=h.useState(null),[y,T]=h.useState(!1),[x,S]=h.useState(null),[A,Q]=h.useState({supplierType:"local",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),[q,B]=h.useState(null),[$,H]=h.useState([]),[te,G]=h.useState([]),[F,X]=h.useState([]),[ue,Y]=h.useState(!1),{alertConfig:z,closeAlert:O,showSuccess:E,showError:k,showConfirm:b}=Bt(),N=v=>{if(v.length===0)return;const se=v.reduce((re,J)=>{const he=parseFloat(re.price)||0;return(parseFloat(J.price)||0)<he?J:re});i(re=>({...re,price:se.price,supplier:se.supplierName}))},I=kt(),{id:P}=Dn(),_=!!P,C=`rawMaterialForm_${P||"new"}`,{logActivity:U,getCurrentUser:w}=Zt(),{hasPerm:W,readOnly:ie}=Yn(),de=W("products:create"),ne=W("products:update"),ye=ie||_&&!ne||!_&&!de,pe=de||ne;h.useMemo(()=>F.map(v=>({...v,formattedPrice:`${v.price} `,formattedDate:new Date(v.date).toLocaleDateString("ar-SA")})),[F]),h.useMemo(()=>F.length===0?null:F.reduce((v,se)=>{const re=parseFloat(v.price)||0;return(parseFloat(se.price)||0)<re?se:v}),[F]);const be=()=>{e(!n)};h.useEffect(()=>{try{const v=localStorage.getItem(C);if(v){const se=JSON.parse(v);console.log(" [FORCE PERSIST] Restoring raw material form data from localStorage:",se),i(se)}}catch(v){console.warn("Failed to parse saved raw material form data:",v)}},[C]),h.useEffect(()=>{const v=()=>{try{localStorage.setItem(C,JSON.stringify(r)),console.log(" [FORCE PERSIST] Raw material form data saved on beforeunload")}catch(J){console.warn("Failed to save raw material form data on beforeunload:",J)}},se=()=>{if(document.hidden)try{localStorage.setItem(C,JSON.stringify(r)),console.log(" [FORCE PERSIST] Raw material form data saved on visibility change")}catch(J){console.warn("Failed to save raw material form data on visibility change:",J)}},re=()=>{try{localStorage.setItem(C,JSON.stringify(r)),console.log(" [FORCE PERSIST] Raw material form data saved on window blur")}catch(J){console.warn("Failed to save raw material form data on window blur:",J)}};return window.addEventListener("beforeunload",v),document.addEventListener("visibilitychange",se),window.addEventListener("blur",re),()=>{window.removeEventListener("beforeunload",v),document.removeEventListener("visibilitychange",se),window.removeEventListener("blur",re)}},[r,C]),h.useEffect(()=>{_&&(localStorage.getItem(C)?(console.log(" [FORCE PERSIST] User changes exist, preserving raw material form data"),Ee()):Re()),xe();const v=()=>{_&&P&&(console.log("Window focused - refreshing raw material data..."),Re())};return window.addEventListener("focus",v),()=>{window.removeEventListener("focus",v)}},[P]),h.useEffect(()=>{const v=sessionStorage.getItem("selectedSupplier"),se=sessionStorage.getItem("openPriceModal");if(v)try{const re=JSON.parse(v);Q(J=>({...J,supplier:re.id,supplierName:re.name,supplierType:re.type})),sessionStorage.removeItem("selectedSupplier"),console.log(" Supplier selected from selection page:",re),se==="true"&&(sessionStorage.removeItem("openPriceModal"),setTimeout(()=>{p(!0),console.log(" Auto-opening price quote modal")},100))}catch(re){console.error(" Error parsing selected supplier:",re),sessionStorage.removeItem("selectedSupplier"),sessionStorage.removeItem("openPriceModal")}},[]),h.useEffect(()=>{var v;console.log("PriceQuoteData changed:",{hasFile:!!A.quotationFile,fileName:(v=A.quotationFile)==null?void 0:v.name,supplierName:A.supplierName,price:A.price})},[A]);const xe=async()=>{try{const[v,se]=await Promise.all([rr.getAllSuppliers(),ir.getAllSuppliers()]);H(v),G(se)}catch(v){console.error("Error loading suppliers:",v)}},Ee=async()=>{try{console.log("Loading price quotes only for raw material ID:",P);const v=await Tn.getRawMaterialById(P);v&&v.priceQuotes&&Array.isArray(v.priceQuotes)?(console.log("Loading price quotes for raw material:",v.name,v.priceQuotes),X(v.priceQuotes),setTimeout(()=>{N(v.priceQuotes)},200)):console.log("No price quotes found for raw material:",(v==null?void 0:v.name)||"Material not found")}catch(v){console.error("Error loading price quotes only:",v)}},Re=async()=>{try{u(!0),console.log("Loading raw material data for ID:",P);const v=await Tn.getRawMaterialById(P);v?(console.log("Raw material found:",v.name),i({name:v.name||"",category:v.category||"",description:v.description||"",unit:v.unit||"",price:v.price||"",supplier:v.supplier||"",stockQuantity:v.stockQuantity||"",minimumStock:v.minimumStock||"",storageConditions:v.storageConditions||"",expiryDate:v.expiryDate||"",batchNumber:v.batchNumber||"",origin:v.origin||"",notes:v.notes||"",active:v.active!==void 0?v.active:!0}),v.priceQuotes&&Array.isArray(v.priceQuotes)?(console.log("Loading price quotes for raw material:",v.name,v.priceQuotes),console.log("Price quotes analysis:"),v.priceQuotes.forEach((se,re)=>{console.log(`Quote ${re}:`,{id:se.id,supplierName:se.supplierName,price:se.price,hasId:!!se.id,keys:Object.keys(se)})}),X(v.priceQuotes),setTimeout(()=>{N(v.priceQuotes)},200)):console.log("No price quotes found for raw material:",v.name)):(console.error("Raw material not found with ID:",P),o({submit:"      "}))}catch(v){console.error("Error loading raw material:",v),o({submit:"     : "+v.message})}finally{u(!1)}},fe=v=>{const{name:se,value:re,type:J,checked:he}=v.target,Se={...r,[se]:J==="checkbox"?he:re};i(Se);try{localStorage.setItem(C,JSON.stringify(Se)),console.log(" [FORCE PERSIST] Raw material form data saved to localStorage on every change")}catch(me){console.warn("Failed to save raw material form data to localStorage:",me)}a[se]&&o(me=>({...me,[se]:""}))},Ve=async v=>{v.preventDefault();const se=Tn.validateRawMaterialData(r);if(F.length===0&&(se.priceQuotes="      "),Object.keys(se).length>0){o(se);return}c(!0),o({});try{const re=await Bn.validateUniqueFields({name:r.name},_?P:null,_?"rawmaterials":null);if(Object.keys(re).length>0){o(re),c(!1);return}const J={...r,price:parseFloat(r.price)||0,stockQuantity:parseFloat(r.stockQuantity)||0,minimumStock:parseFloat(r.minimumStock)||0,priceQuotes:F,status:"active"};if(console.log("Saving raw material with price quotes:",{name:J.name,priceQuotes:J.priceQuotes,priceQuotesCount:J.priceQuotes.length}),_){await Tn.updateRawMaterial(P,J);const he=w();U("task",`${he.name}   `,`   : ${J.name}`)}else{await Tn.createRawMaterial(J);const he=w();U("task",`${he.name}   `,`   : ${J.name}`)}try{localStorage.removeItem(C),console.log(" [FORCE PERSIST] Cleared raw material form data from localStorage on successful save")}catch(he){console.warn("Failed to clear raw material form data from localStorage:",he)}I("/raw-materials")}catch(re){o({submit:re.message})}finally{c(!1)}},$e=()=>{I("/raw-materials")},et=()=>{p(!0)},ze=()=>{p(!1),B(null),Q({supplierType:"local",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),o(v=>({...v,fileUpload:""})),console.log("Modal closed and state reset")},tt=()=>{const v=window.location.pathname,re=`/supplier-selection/${A.supplierType||"local"}?returnPath=${encodeURIComponent(v)}&materialType=rawMaterial&materialId=${P||"new"}`;I(re)},rt=()=>{L(!1),D(null)},bt=h.useCallback((v,se)=>{try{let re=null,J=[];if(se==="local")J=$,re=J.find(he=>he.name===v);else if(se==="foreign")J=te,re=J.find(he=>he.name===v);else{console.error("Invalid supplier type:",se),k(`   : ${se}`,"");return}if(re){console.log("SUCCESS: Supplier found:",re.name),console.log("Supplier data:",re);const he={...re,supplierType:se};console.log("Setting supplier to edit:",he),S(he),T(!0),console.log("Modal state should be true now")}else J.length===0?(loadSuppliersData(),k("   .   ...","  ")):k(`    : ${v}`,"  ")}catch(re){k(`    : ${re.message}`,"  ")}},[$,te,k]),At=()=>{T(!1),S(null)},ns=v=>{D(v)},Ht=()=>{R&&Q(v=>{var re,J;console.log("Before supplier selection - preserving file:",(re=v.quotationFile)==null?void 0:re.name);const se={...v,supplier:R.id,supplierName:R.name};return console.log("After supplier selection - file preserved:",(J=se.quotationFile)==null?void 0:J.name),se}),L(!1),D(null)},is=v=>{console.log("File details:",{name:v==null?void 0:v.name,size:v==null?void 0:v.size,type:v==null?void 0:v.type,lastModified:v==null?void 0:v.lastModified}),a.fileUpload&&o(se=>({...se,fileUpload:""})),Q(se=>{var J;const re={...se,quotationFile:v};return console.log("Updated priceQuoteData with file:",{hasFile:!!re.quotationFile,fileName:(J=re.quotationFile)==null?void 0:J.name}),re})},Oe=v=>{const{name:se,value:re,type:J}=v.target;J!=="file"&&Q(se==="supplierType"?he=>({...he,[se]:re,supplier:"",supplierName:""}):he=>({...he,[se]:re}))},it=async v=>{if(v.preventDefault(),console.log("Form element:",v.target),console.log("Current priceQuoteData:",A),console.log("Editing quote ID:",q),!A.supplierName){o(he=>({...he,fileUpload:"   "}));return}if(!A.date){o(he=>({...he,fileUpload:"   "}));return}if(!A.price){o(he=>({...he,fileUpload:"  "}));return}const se=new FormData(v.target),re=se.get("quotationFile");console.log("File from form directly:",re),console.log("File from state:",A.quotationFile);const J=A.quotationFile||re;console.log("File to upload:",J),console.log("File upload details:",{exists:!!J,isFile:J instanceof File,name:J==null?void 0:J.name,size:J==null?void 0:J.size,type:J==null?void 0:J.type,lastModified:J==null?void 0:J.lastModified});try{if(c(!0),!q&&(!J||J.size===0))throw new Error("    ");let he=null;if(console.log("File upload analysis:",{hasFileInState:!!A.quotationFile,hasFileInForm:!!re,hasFileToUpload:!!J,fileType:typeof J,fileName:J==null?void 0:J.name,fileSize:J==null?void 0:J.size}),J&&typeof J!="string"&&J.size>0){console.log("Starting file upload:",J.name);try{Ss.validateFile(J,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}),console.log("File validation passed")}catch(Se){throw console.error("File validation failed:",Se),new Error(Se.message)}console.log("Attempting file upload to Firebase...");try{const Se=J.name.split(".").pop()||"pdf",me=A.supplierName?`  ${A.supplierName}.${Se}`:J.name;console.log("Uploading with custom name:",me),he=await Ss.uploadFileWithCustomName(J,"quotations",me),console.log("File uploaded successfully:",he)}catch(Se){throw console.error("Firebase upload failed:",Se),new Error(`   : ${Se.message}`)}}else console.log("No valid file to upload:",{fileExists:!!J,isString:typeof J=="string",hasSize:(J==null?void 0:J.size)>0});if(q)console.log("Updating existing price quote with ID:",q),X(Se=>{const me=Se.map(ge=>ge.id===q?{...ge,supplierType:A.supplierType,supplier:A.supplier,supplierName:A.supplierName,date:A.date,price:A.price,quotationFile:he?he.path:ge.quotationFile,quotationFileURL:he?he.url:ge.quotationFileURL,quotationFileName:he?he.originalName:ge.quotationFileName,quotationFileSize:he?he.size:ge.quotationFileSize,quotationFileType:he?he.type:ge.quotationFileType,updatedAt:new Date}:ge);return console.log("Updated price quotes:",me),setTimeout(()=>{N(me)},100),me});else{const Se={id:Date.now().toString(),supplierType:A.supplierType,supplier:A.supplier,supplierName:A.supplierName,date:A.date,price:A.price,quotationFile:he?he.path:null,quotationFileURL:he?he.url:null,quotationFileName:he?he.originalName:null,quotationFileSize:he?he.size:null,quotationFileType:he?he.type:null,createdAt:new Date};console.log("Adding new price quote:",Se),X(me=>{const ge=[...me,Se];return console.log("Updated price quotes:",ge),setTimeout(()=>{N(ge)},100),ge})}a.priceQuotes&&o(Se=>({...Se,priceQuotes:""})),ze(),_&&P&&setTimeout(async()=>{try{console.log("Auto-saving raw material after price quote change..."),X(Se=>{const me={...se,priceQuotes:Se};return Tn.updateRawMaterial(P,me).then(()=>{console.log("Auto-save successful")}).catch(ge=>{console.error("Auto-save failed:",ge),k("   ","  ")}),Se})}catch(Se){console.error("Auto-save setup error:",Se)}},200)}catch(he){console.error("Error uploading file:",he),o(Se=>({...Se,fileUpload:he.message||"   .   ."}))}finally{c(!1)}},Kt=v=>{console.log("Starting edit for quote:",v),B(v.id),Q({supplierType:v.supplierType||"local",supplier:v.supplier||"",supplierName:v.supplierName||"",date:v.date||"",price:v.price||"",quotationFile:v.quotationFile||null}),p(!0)},zs=v=>{if(console.log("Price quote delete button clicked:",v),console.log("Quote ID:",v==null?void 0:v.id),console.log("Quote keys:",v?Object.keys(v):"quote is null/undefined"),!v||!v.id){console.error("Invalid quote object - missing quote or ID:",{quote:v,hasId:!!(v!=null&&v.id),quoteId:v==null?void 0:v.id,quoteType:typeof v}),k("    ","");return}b(`      

${v.supplierName} - ${v.price} `,()=>xs(v),"   ")},xs=async v=>{if(console.log("Delete confirmation called for quote:",v),console.log("Confirmation - Quote ID:",v==null?void 0:v.id),console.log("Confirmation - Quote keys:",v?Object.keys(v):"quote is null/undefined"),console.log("Is editing mode:",_),console.log("Raw material ID:",P),console.log("Form data name:",r.name),!v||!v.id){console.error("Invalid quote in confirmation - missing quote or ID:",{quote:v,hasId:!!(v!=null&&v.id),quoteId:v==null?void 0:v.id,quoteType:typeof v}),k("    ",""),Y(!1);return}try{if(Y(!0),console.log("Starting delete process..."),console.log("Moving to trash..."),_&&P){const re={...v,rawMaterialId:P,rawMaterialName:r.name};console.log("Quote with context for trash:",re),console.log("Calling SimpleTrashService.moveToTrash...");const J=await bs.moveToTrash(re,"price_quotes");console.log("Trash service result:",J),console.log("Moved to trash successfully")}else console.log("Skipping trash - raw material not saved yet (isEditing:",_,", id:",P,")");const se=w();console.log("Logging activity with current user:",se),U("task",`${se.name}   `,`   : ${v.supplierName} - ${v.price} `),console.log("Updating local state..."),console.log("Current price quotes before deletion:",F),X(re=>{const J=re.filter(he=>he.id!==v.id);return console.log("Filtered quotes:",J.length,"from",re.length),console.log("Removed quote with ID:",v.id),console.log("Remaining quotes:",J.map(he=>({id:he.id,supplierName:he.supplierName}))),setTimeout(()=>{N(J)},100),J}),console.log("Showing success message..."),_&&P?E(`    : ${v.supplierName}`,"  "):E(`   : ${v.supplierName}`," "),console.log("Delete process completed successfully"),_&&P&&setTimeout(async()=>{try{console.log("Auto-saving raw material after price quote deletion..."),X(re=>{const J={...r,priceQuotes:re};return Tn.updateRawMaterial(P,J).then(()=>{console.log("Auto-save after deletion successful")}).catch(he=>{console.error("Auto-save after deletion failed:",he)}),re})}catch(re){console.error("Auto-save after deletion setup error:",re)}},200)}catch(se){console.error("Error deleting price quote:",se),console.error("Error stack:",se.stack),k(`    : ${se.message||"  "}`,"  ")}finally{console.log("Setting deleting to false"),Y(!1)}},cs=()=>(A.supplierType==="local"?$:te).filter(re=>{const J=re.hasOwnProperty("active"),he=re.hasOwnProperty("status");return J?re.active===!0:he?re.status==="active":!0});return d?t.jsx(It,{show:!0,message:"    ..."}):t.jsx(h.Suspense,{fallback:t.jsx(It,{show:!0,message:"  ...",overlay:!0}),children:t.jsxs(S$,{children:[t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:be}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!s?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{style:{position:"sticky",top:0,zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsx("a",{href:"/raw-materials",className:"text-decoration-none text-primary",children:" "})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsx("a",{href:"/raw-materials",className:"text-decoration-none text-primary",children:" "})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:_?"  ":"   "})]})})}),t.jsxs("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:[t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"60px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsxs("div",{className:"card-header bg-white border-bottom py-4 d-flex align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),_?"  ":"   "]}),t.jsx("div",{style:{flex:1}}),t.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:et,disabled:!pe,title:pe?"   ":"     ",style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:"1",paddingTop:"2px"},children:" "})]}),t.jsxs("form",{onSubmit:Ve,children:[t.jsxs("div",{className:"card-body p-4",children:[ye&&t.jsx("div",{className:"alert alert-info border-0 shadow-sm mb-4",children:t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-info-circle-fill text-info me-3 fs-5"}),t.jsxs("div",{children:[t.jsx("strong",{className:"fw-bold",children:"  "}),t.jsx("div",{className:"mt-1",children:t.jsxs("span",{className:"ms-2",children:[!ne&&_&&"     ",!de&&!_&&"      ",ie&&"     "]})})]})]})}),a.submit&&t.jsxs("div",{className:"alert alert-danger",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.submit]}),t.jsxs("div",{className:"row mb-4",children:[t.jsx("div",{className:"col-12",children:t.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[t.jsx("i",{className:"bi bi-info-circle me-2"})," "]})}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:"   *"}),t.jsx("input",{type:"text",className:`form-control ${a.name?"is-invalid":""}`,name:"name",value:r.name,onChange:fe,placeholder:"   ",readOnly:ye}),a.name&&t.jsx("div",{className:"invalid-feedback",children:a.name})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:" *"}),t.jsx(Hf,{name:"category",value:r.category,onChange:fe,required:!0,className:`form-select ${a.category?"is-invalid":""}`,placeholder:" ",showDescription:!0,disabled:ye}),a.category&&t.jsx("div",{className:"invalid-feedback",children:a.category})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:" *"}),t.jsx(Qf,{name:"unit",value:r.unit,onChange:fe,required:!0,className:`form-select ${a.unit?"is-invalid":""}`,placeholder:" ",showDescription:!0,disabled:ye}),a.unit&&t.jsx("div",{className:"invalid-feedback",children:a.unit})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsxs("label",{className:"form-label fw-bold",children:[" () *",t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:F.length>0?"  ":" "})]}),t.jsx("input",{type:"number",step:"0.01",min:"0",className:`form-control ${a.price?"is-invalid":""}`,name:"price",value:r.price,onChange:null,onKeyPress:null,placeholder:"0.00",readOnly:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"}}),a.price&&t.jsx("div",{className:"invalid-feedback",children:a.price}),t.jsx("div",{className:"mt-1",children:t.jsxs("small",{className:"text-muted",children:[t.jsx("i",{className:"bi bi-info-circle me-1"}),F.length>0?"        ":"       "]})})]}),t.jsxs("div",{className:"col-md-12 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:""}),t.jsx("textarea",{className:"form-control",name:"description",value:r.description,onChange:fe,rows:"3",placeholder:"  ",readOnly:ye})]}),t.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("span",{className:`badge ${r.active?"bg-success":"bg-secondary"} px-3 py-2`,children:r.active?"":" "}),t.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"rawMaterialActiveSwitch",name:"active",checked:r.active,onChange:fe,style:{width:"48px",height:"24px",marginRight:"8px"}})]})})]}),t.jsxs("div",{className:"row mb-4",children:[t.jsxs("div",{className:"col-12",children:[t.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[t.jsx("i",{className:"bi bi-receipt me-2"})," "]}),a.priceQuotes&&t.jsxs("div",{className:"alert alert-danger",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.priceQuotes]})]}),F.length>0&&t.jsx("div",{className:"col-12",children:t.jsxs("div",{className:"card mb-3 border-0 shadow-lg",style:{background:"linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%)",borderRadius:"16px"},children:[t.jsx("div",{className:"card-header border-0",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"16px 16px 0 0",padding:"20px"},children:t.jsxs("h5",{className:"card-title text-white mb-0 d-flex align-items-center",children:[t.jsx("div",{className:"me-3",style:{background:"rgba(255,255,255,0.2)",borderRadius:"12px",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx("i",{className:"bi bi-bar-chart-fill fs-5"})}),t.jsx("span",{className:"fw-bold",children:"  "}),t.jsxs("span",{className:"badge bg-light text-primary ms-3",style:{borderRadius:"20px",fontSize:"12px",padding:"6px 12px"},children:[F.length," "]})]})}),t.jsx("div",{className:"card-body",style:{padding:"30px"},children:t.jsx("div",{style:{minHeight:"675px",direction:"ltr"},children:t.jsxs("div",{style:{width:"100%",height:"655px",position:"relative"},children:[t.jsx("style",{dangerouslySetInnerHTML:{__html:`
                                        g[class*="hover-group-"]:hover .hover-supplier-name {
                                          opacity: 1 !important;
                                          transition: opacity 0.3s ease-in-out;
                                        }
                                        .hover-supplier-name {
                                          transition: opacity 0.3s ease-in-out;
                                        }
                                        g[class*="hover-group-"] {
                                          cursor: pointer;
                                        }
                                      `}}),(()=>{F.map(Se=>parseFloat(Se.price)||0);const v=640,J=F.length*150,he=Math.max(v,J);return t.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${he+160} 655`,style:{direction:"ltr"},children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"chartBg",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#ffffff",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#f8f9ff",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"bestPriceGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#00f5a0",stopOpacity:1}}),t.jsx("stop",{offset:"30%",style:{stopColor:"#00d9f5",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#0066cc",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"regularPriceGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),t.jsx("stop",{offset:"50%",style:{stopColor:"#764ba2",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#f093fb",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient0",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#764ba2",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient1",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#f093fb",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#f5576c",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient2",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#4facfe",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#00f2fe",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient3",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#a8edea",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#fed6e3",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient4",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#ffecd2",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#fcb69f",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient5",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#a18cd1",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#fbc2eb",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient6",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#fad0c4",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#ffd1ff",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient7",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#a1c4fd",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#c2e9fb",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"metallicShine",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),t.jsx("stop",{offset:"45%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),t.jsx("stop",{offset:"50%",style:{stopColor:"rgba(255,255,255,0.8)",stopOpacity:1}}),t.jsx("stop",{offset:"55%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),t.jsx("stop",{offset:"100%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}})]}),t.jsx("filter",{id:"dropShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"6",stdDeviation:"8",floodColor:"rgba(0,0,0,0.15)"})}),t.jsxs("filter",{id:"premiumGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"5",result:"coloredBlur"}),t.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0 0 0  0 1 1 0 0  0 0 1 0 0  0 0 0 1 0"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("filter",{id:"bevelEffect",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2",result:"blur"}),t.jsx("feSpecularLighting",{in:"blur",result:"specOut",surfaceScale:"5",specularConstant:"0.8",specularExponent:"20","lighting-color":"white",children:t.jsx("fePointLight",{x:"-50",y:"-50",z:"200"})}),t.jsx("feComposite",{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut2"}),t.jsx("feComposite",{in:"SourceGraphic",in2:"specOut2",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"})]}),t.jsxs("filter",{id:"pulseGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),t.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0.8 0 0  0 1 1 0 0  0 0 1 0.2 0  0 0 0 1 0"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),t.jsx("rect",{width:he+160,height:"605",fill:"url(#chartBg)",rx:"12",style:{filter:"drop-shadow(0 4px 20px rgba(0,0,0,0.1))"}}),t.jsx("g",{transform:"translate(80, 40)",children:(()=>{const Se=F.map(pt=>parseFloat(pt.price)||0),me=Math.max(...Se),ge=Math.min(...Se),ke=me-ge||1,Ie=350,oe=640,we=F.length*150,_e=Math.max(oe,we),Ge=Math.min(_e/F.length*.6,80),mt=_e/F.length;return t.jsxs(t.Fragment,{children:[[0,1,2,3,4,5].map(pt=>{const Yt=150+(Ie-150)/5*pt,Fe=(1-pt/5)*Math.max(...Se);return t.jsxs("g",{children:[t.jsx("line",{x1:"0",y1:Yt,x2:_e,y2:Yt,stroke:pt===5?"#007bff":"rgba(123, 140, 252, 0.2)",strokeWidth:pt===5?"2":"1",strokeDasharray:pt===5?"0":"5,5"}),t.jsx("text",{x:"-15",y:Yt+5,textAnchor:"end",fontSize:"12",fill:"#4f46e5",fontWeight:"600",children:Math.round(Fe).toLocaleString()})]},pt)}),F.map((pt,Ye)=>{const Yt=parseFloat(pt.price)||0;let je;if(ke>0){const dt=Ie-150,ot=Yt/Math.max(...Se);je=Math.max(ot*dt,15)}else je=(Ie-150)*.8;const Fe=mt*Ye+(mt-Ge)/2,De=150+(Ie-150)-je,Ze=Yt===ge;let at;return Ze?at="bestPriceGradient":at=`gradient${Ye%8}`,t.jsxs("g",{className:Ze?"":`hover-group-${Ye}`,children:[t.jsx("rect",{x:Fe+4,y:De+8,width:Ge,height:je,fill:"rgba(0,0,0,0.05)",rx:"10"}),t.jsx("rect",{x:Fe+2,y:De+4,width:Ge,height:je,fill:"rgba(0,0,0,0.08)",rx:"9"}),t.jsxs("rect",{x:Fe,y:De,width:Ge,height:je,fill:`url(#${at})`,rx:"10",filter:Ze?"url(#premiumGlow)":"url(#bevelEffect)",style:{transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer"},children:[t.jsx("animate",{attributeName:"height",from:"0",to:je,dur:"2s",begin:`${Ye*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),t.jsx("animate",{attributeName:"y",from:Ie,to:De,dur:"2s",begin:`${Ye*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),Ze&&t.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;1.05;1",dur:"3s",repeatCount:"indefinite",begin:`${Ye*.3+2}s`})]}),t.jsx("rect",{x:Fe+2,y:De+2,width:Ge-4,height:Math.max(je/2.5,30),fill:"url(#metallicShine)",rx:"8",opacity:"0.6",children:t.jsx("animateTransform",{attributeName:"transform",type:"translate",values:`-${Ge};${Ge}`,dur:"4s",repeatCount:"indefinite",begin:`${Ye*.5+3}s`})}),t.jsx("rect",{x:Fe+3,y:De+3,width:Math.max(Ge/4,8),height:Math.max(je-6,20),fill:"rgba(255,255,255,0.4)",rx:"6"}),t.jsx("rect",{x:Fe+Ge-6,y:De+6,width:"3",height:Math.max(je-12,15),fill:"rgba(255,255,255,0.2)",rx:"1.5"}),t.jsxs("g",{children:[t.jsx("rect",{x:Fe+Ge/2-30,y:De-28,width:"60",height:"20",fill:"rgba(0,0,0,0.8)",rx:"10",opacity:"0.9"}),t.jsxs("text",{x:Fe+Ge/2,y:De-15,textAnchor:"middle",fontSize:"12",fill:"white",fontWeight:"bold",children:[". ",Yt.toLocaleString()]})]}),Ze&&t.jsx("g",{children:(()=>{const dt=pt.supplierName,ot=dt.length*7,Je=Math.max(ot+20,Ge+10);return t.jsxs(t.Fragment,{children:[t.jsx("rect",{x:Fe+Ge/2-Je/2,y:Ie+30,width:Je,height:22,fill:"rgba(255,255,255,0.96)",rx:"11",stroke:"rgba(0,123,255,0.5)",strokeWidth:"1.5",filter:"url(#dropShadow)"}),t.jsx("text",{x:Fe+Ge/2,y:Ie+41,textAnchor:"middle",fontSize:"11",fill:"#1e40af",fontWeight:"700",style:{fontFamily:"system-ui, -apple-system, sans-serif",letterSpacing:"0.2px"},dominantBaseline:"middle",children:dt})]})})()}),!Ze&&t.jsx("g",{opacity:"0",className:"hover-supplier-name",style:{pointerEvents:"none"},children:(()=>{const dt=pt.supplierName,ot=dt.length*7,Je=Math.max(ot+20,Ge+10);return t.jsxs(t.Fragment,{children:[t.jsx("rect",{x:Fe+Ge/2-Je/2,y:Ie+30,width:Je,height:22,fill:"rgba(255,255,255,0.96)",rx:"11",stroke:"rgba(0,123,255,0.5)",strokeWidth:"1.5",filter:"url(#dropShadow)"}),t.jsx("text",{x:Fe+Ge/2,y:Ie+41,textAnchor:"middle",fontSize:"11",fill:"#1e40af",fontWeight:"700",style:{fontFamily:"system-ui, -apple-system, sans-serif",letterSpacing:"0.2px"},dominantBaseline:"middle",children:dt})]})})()}),Ze&&t.jsxs("g",{children:[t.jsx("circle",{cx:Fe+Ge/2,cy:De-100,r:"18",fill:"linear-gradient(135deg, #ffd700 0%, #ffb300 100%)",stroke:"#fff",strokeWidth:"3",filter:"url(#dropShadow)"}),t.jsx("text",{x:Fe+Ge/2,y:De-95,textAnchor:"middle",fontSize:"16",fill:"#fff",children:""}),t.jsx("rect",{x:Fe-5,y:De-70,width:Ge+10,height:"20",fill:"#28a745",rx:"10",opacity:"0.9"}),t.jsx("text",{x:Fe+Ge/2,y:De-57,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:" "})]})]},pt.id)}),t.jsx("text",{x:_e/2,y:20,textAnchor:"middle",fontSize:"18",fill:"url(#bestPriceGradient)",fontWeight:"bold",direction:"rtl",children:"   "}),t.jsxs("g",{transform:`translate(${_e/2}, ${Ie+110})`,children:[t.jsx("rect",{x:"-200",y:"-25",width:"400",height:"145",fill:"rgba(255,255,255,0.98)",rx:"20",stroke:"url(#bestPriceGradient)",strokeWidth:"2",filter:"url(#dropShadow)"}),t.jsx("text",{x:"0",y:"-5",textAnchor:"middle",fontSize:"16",fill:"#1f2937",fontWeight:"800",letterSpacing:"0.5px",children:" "}),t.jsxs("g",{transform:"translate(0, 15)",children:[t.jsxs("g",{transform:"translate(-125, 0)",children:[t.jsxs("g",{transform:"translate(0, 0)",children:[t.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#bestPriceGradient)",rx:"7",filter:"url(#premiumGlow)"}),t.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#059669",fontWeight:"700",children:" "}),t.jsx("text",{x:"80",y:"13",fontSize:"18",children:""})]}),t.jsx("line",{x1:"110",y1:"-5",x2:"110",y2:"19",stroke:"rgba(0,0,0,0.15)",strokeWidth:"2"}),t.jsxs("g",{transform:"translate(125, 0)",children:[t.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#regularPriceGradient)",rx:"7"}),t.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#6366f1",fontWeight:"700",children:" "}),t.jsx("text",{x:"90",y:"13",fontSize:"16",children:""})]})]}),t.jsxs("g",{transform:"translate(0, 40)",children:[t.jsx("rect",{x:"-170",y:"-8",width:"340",height:"22",fill:"rgba(59, 130, 246, 0.08)",rx:"11"}),t.jsxs("text",{x:"0",y:"5",textAnchor:"middle",fontSize:"14",fill:"#1e40af",fontWeight:"700",children:["   : ",(Math.max(...Se)-Math.min(...Se)).toLocaleString()," ."]})]}),t.jsx("g",{transform:"translate(0, 90)",children:t.jsxs("text",{x:"0",y:"0",textAnchor:"middle",fontSize:"12",fill:"#6b7280",fontWeight:"600",children:["  : ",Math.max(...Se).toLocaleString()," .      : ",Math.min(...Se).toLocaleString()," ."]})})]})]})]})})()})]})})()]})})})]})}),t.jsx("div",{className:"col-12",style:{position:"sticky",top:"0",zIndex:9999,backgroundColor:"rgba(255, 255, 255, 0.98)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",boxShadow:"0 2px 20px rgba(0, 0, 0, 0.1)",borderRadius:"8px",margin:"10px 0"},children:t.jsxs("div",{className:"card shadow-lg",style:{border:"2px solid #007bff",borderRadius:"12px"},children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsx("div",{className:"d-flex justify-content-between align-items-center",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-list-ul text-primary me-2"}),"   (",F.length,")"]})})}),t.jsx("div",{className:"card-body p-0",children:F.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-receipt fs-1"})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:"      "})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:"60px"},children:"#"}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" ()"}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",style:{width:"120px"},children:""})]})}),t.jsx("tbody",{children:F.map((v,se)=>{const re=F.length>=1&&F.reduce((J,he)=>{const Se=parseFloat(J.price)||0;return(parseFloat(he.price)||0)<Se?he:J}).id===v.id;return t.jsxs("tr",{className:re?"table-success":"",children:[t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:se+1})}),t.jsxs("td",{className:"text-center",children:[t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},onClick:J=>{J.preventDefault(),J.stopPropagation(),console.log("Button clicked, calling handleSupplierEdit..."),bt(v.supplierName,v.supplierType)},title:` : ${v.supplierName}`,type:"button",children:v.supplierName}),re&&t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:`badge ${v.supplierType==="local"?"bg-success":"bg-info"}`,children:v.supplierType==="local"?"":""})}),t.jsx("td",{className:"text-center",children:v.date}),t.jsxs("td",{className:"text-center",children:[v.price," ",re&&t.jsx("i",{className:"bi bi-arrow-down-circle-fill text-success ms-2",title:" "})]}),t.jsx("td",{className:"text-center",children:v.quotationFile&&t.jsx(Ad,{size:25,clickable:!0,onClick:()=>{Kr(3e4),v.quotationFileURL?window.open(v.quotationFileURL,"_blank"):(console.log("No file URL available for:",v.quotationFile),alert("   "))},title:` : ${v.quotationFileName||v.quotationFile}`})}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(Tt,{can:"products:update",mode:"disable",children:t.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>Kt(v),title:"",children:t.jsx("i",{className:"bi bi-pencil"})})}),t.jsx(Tt,{can:"products:delete",mode:"disable",children:t.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>zs(v),title:"",children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},v.id)})})]})})})]})})]})]}),t.jsx("div",{className:"card-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:t.jsxs("div",{className:"d-flex gap-3",style:{marginBottom:"15px"},children:[t.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:$e,disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""}),t.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:l||ye,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:l?" ...":t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-check-lg me-1"}),_?"":""]})})]})})]})]})}),t.jsx("div",{className:"app-footer",style:{textAlign:"center",padding:"20px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",marginTop:"20px"},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]})]}),!n&&s&&t.jsx(v$,{rtl:!0}),!n&&s&&t.jsx(N$,{}),f&&t.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:99990},tabIndex:"-1",children:t.jsx("div",{className:"modal-dialog modal-lg",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[t.jsxs("div",{className:"modal-header border-0 pb-2",children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-receipt text-primary me-2"}),"  "]}),t.jsx("button",{type:"button",className:"btn-close",onClick:ze,style:{fontSize:"12px"}})]}),t.jsxs("form",{onSubmit:it,onReset:v=>v.preventDefault(),children:[t.jsxs("div",{className:"modal-body px-4",children:[a.fileUpload&&t.jsxs("div",{className:"alert alert-danger mb-3",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.fileUpload]}),t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:"  *"}),t.jsxs("select",{className:"form-select",name:"supplierType",value:A.supplierType,onChange:Oe,required:!0,children:[t.jsx("option",{value:"local",children:" "}),t.jsx("option",{value:"foreign",children:" "})]})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:" *"}),t.jsxs("div",{className:"form-control d-flex align-items-center justify-content-between",onClick:tt,style:{cursor:"pointer",backgroundColor:"#f8f9fa"},children:[t.jsx("span",{className:A.supplierName?"text-dark":"text-muted",children:A.supplierName||" "}),t.jsx("i",{className:"bi bi-chevron-down"})]})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:"  *"}),t.jsx("input",{type:"date",className:"form-control",name:"date",value:A.date,onChange:Oe,required:!0})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:" () *"}),t.jsx("input",{type:"number",step:"0.01",min:"0",className:"form-control",name:"price",value:A.price,onChange:Oe,onKeyPress:v=>{(v.key==="-"||v.key!=="."&&v.key!=="Backspace"&&(v.key<"0"||v.key>"9"))&&v.preventDefault()},placeholder:"0.00",required:!0})]}),t.jsxs("div",{className:"col-md-12 mb-3",children:[t.jsxs("label",{className:"form-label fw-bold",children:["   ",q?"()":"*"]}),t.jsxs("div",{className:"mb-2",children:[t.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.jpg,.png,.jpeg",style:{display:"none"},ref:v=>{v&&(v.onclick=()=>{v.value=""},v.onchange=se=>{var J;const re=(J=se.target.files)==null?void 0:J[0];re&&is(re)})},id:`fileInput_${f}_${Date.now()}`}),t.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>{console.log(" Raw Material price quote upload button clicked"),console.log(" RAW MATERIAL MODAL: Starting fullscreen bypass for file picker"),Kr(2e4);const v=document.querySelector(`#fileInput_${f}_${Date.now()}`);if(v)v.click();else{const se=document.createElement("input");se.type="file",se.accept=".pdf,.doc,.docx,.jpg,.png,.jpeg",se.style.display="none",se.onchange=re=>{var he;const J=(he=re.target.files)==null?void 0:he[0];J&&is(J),document.body.removeChild(se)},document.body.appendChild(se),se.click()}},style:{borderRadius:"6px",height:"38px",minWidth:"150px"},children:[t.jsx("i",{className:"bi bi-upload me-2"})," "]})]}),A.quotationFile&&t.jsxs("div",{className:"alert alert-success py-2 mb-2",style:{position:"relative"},children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-check-circle me-2 text-success"}),t.jsxs("div",{className:"flex-grow-1",children:[t.jsx("strong",{children:A.quotationFile.name?A.supplierName?`  ${A.supplierName}.${A.quotationFile.name.split(".").pop()}`:A.quotationFile.name:q?A.supplierName?`  ${A.supplierName}.pdf`:((Os=F.find(v=>v.id===q))==null?void 0:Os.quotationFileName)||" ":" "}),t.jsxs("small",{className:"text-muted ms-2",children:["(",A.quotationFile.size?Math.round(A.quotationFile.size/1024):q?Math.round((((vs=F.find(v=>v.id===q))==null?void 0:vs.quotationFileSize)||0)/1024):0," KB)"]})]})]}),t.jsx("button",{type:"button",className:"btn-close btn-close-sm",onClick:()=>{Q(v=>({...v,quotationFile:null}))},title:" ",style:{position:"absolute",top:"8px",left:"8px",width:"20px",height:"20px",fontSize:"10px",opacity:.7},onMouseEnter:v=>v.target.style.opacity=1,onMouseLeave:v=>v.target.style.opacity=.7})]}),q&&!A.quotationFile&&t.jsxs("div",{className:"alert alert-info py-2 mb-2",children:[t.jsx("i",{className:"bi bi-info-circle me-2"}),t.jsxs("small",{children:[" : ",((Z=F.find(v=>v.id===q))==null?void 0:Z.quotationFileName)||" "]})]}),!A.quotationFile&&!q&&t.jsx("div",{className:"mt-1",children:t.jsxs("small",{className:"text-muted",children:[t.jsx("i",{className:"bi bi-info-circle me-1"}),"   PDF  Word  "]})})]})]})]}),t.jsx("div",{className:"modal-footer border-0 pt-0 d-flex justify-content-center",style:{marginBottom:"10px"},children:t.jsxs("div",{className:"d-flex gap-3",children:[t.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:ze,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""}),t.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:l||!pe,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:l?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"10px",height:"10px"}}),"..."]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-check-lg me-1"}),""]})})]})})]})]})})}),j&&t.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:99990},tabIndex:"-1",children:t.jsx("div",{className:"modal-dialog modal-xl",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[t.jsxs("div",{className:"modal-header border-0 pb-2",style:{marginBottom:"5px"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-people-fill text-primary me-2"}),A.supplierType==="local"?"  ":"  ",t.jsxs("span",{className:"text-muted ms-2",children:["(",cs().length,")"]})]}),t.jsx("button",{type:"button",className:"btn-close",onClick:rt,style:{fontSize:"12px"}})]}),t.jsx("div",{className:"modal-body p-0",children:cs().length>0?t.jsx("div",{className:"table-responsive suppliers-table",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"50px"}}),t.jsx("th",{children:" "}),t.jsx("th",{children:" "}),t.jsx("th",{children:""}),t.jsx("th",{children:""})]})}),t.jsx("tbody",{children:cs().map(v=>t.jsxs("tr",{onClick:()=>ns(v),style:{cursor:"pointer"},children:[t.jsx("td",{className:"text-center",children:t.jsx("div",{className:"form-check d-flex justify-content-center",children:t.jsx("input",{className:"form-check-input custom-radio",type:"radio",name:"selectedSupplier",checked:(R==null?void 0:R.id)===v.id,onChange:()=>{},style:{pointerEvents:"none",width:"18px",height:"18px",borderWidth:"2px",borderColor:(R==null?void 0:R.id)===v.id?"#007bff":"#dee2e6"}})})}),t.jsx("td",{children:t.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},children:v.name})}),t.jsx("td",{children:t.jsx("a",{href:`mailto:${v.email}`,className:"text-decoration-none",children:v.email})}),t.jsx("td",{children:v.phone}),t.jsx("td",{children:v.city||"-"})]},v.id))})]})}):t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-people fs-1"})}),t.jsx("h5",{className:"text-muted",children:"  "}),t.jsxs("p",{className:"text-muted",children:["  ",A.supplierType==="local"?" ":" "," "]})]})}),t.jsx("div",{className:"modal-footer border-0 d-flex justify-content-center",style:{marginTop:"15px"},children:t.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:Ht,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",margin:"20px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:""})})]})})}),y&&x&&t.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:v=>{v.target===v.currentTarget&&At()},children:t.jsx("div",{className:"modal-dialog modal-lg",onClick:v=>v.stopPropagation(),children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[t.jsxs("div",{className:"modal-header border-0",children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"  - ",x.name,t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:x.supplierType==="local"?"":""})]}),t.jsx("button",{type:"button",className:"btn-close",onClick:At})]}),t.jsx("div",{className:"modal-body",children:t.jsxs("div",{className:"row g-3",children:[t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.name})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.email||""})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:x.phone||""})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.city||""})]}),t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.address||""})]}),x.taxNumber&&t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.taxNumber})]}),x.bankAccount&&t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:"  "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.bankAccount})]}),x.notes&&t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.notes})]})]})}),t.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:t.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:At,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""})})]})})})]}),t.jsx(It,{show:l,message:_?"   ...":"   ..."}),t.jsx(E$,{show:z.show,onClose:O,title:z.title,message:z.message,type:z.type,onConfirm:z.onConfirm,confirmText:z.confirmText,cancelText:z.cancelText,showCancel:z.showCancel}),t.jsx(Vh,{position:"bottom-right",showDetails:!0})]})})}function Wj(){return t.jsx(j$,{children:t.jsx(C$,{})})}const I$=({refreshTrigger:n,searchTerm:e})=>{const[s,r]=h.useState([]),[i,a]=h.useState(!0),[o,l]=h.useState(null),[c,d]=h.useState(""),u=e!==void 0?e:c,[f,p]=h.useState([]),[j,L]=h.useState(!1),[R,D]=h.useState(!1),[y,T]=h.useState(!1),[x,S]=h.useState(null),[A,Q]=h.useState([]),[q,B]=h.useState([]),$=kt(),{logActivity:H,getCurrentUser:te}=Zt(),{alertConfig:G,closeAlert:F,showSuccess:X,showError:ue,showConfirm:Y}=Bt(),{currentPage:z,totalPages:O,paginatedItems:E,handlePageChange:k,resetPage:b,totalItems:N,itemsPerPage:I}=cr(f,30);h.useEffect(()=>{P(),_()},[]),h.useEffect(()=>{n&&P()},[n]),h.useEffect(()=>{if(u.trim()){const ie=s.filter(de=>{var ne,ye,pe,be;return((ne=de.name)==null?void 0:ne.toLowerCase().includes(u.toLowerCase()))||((ye=de.category)==null?void 0:ye.toLowerCase().includes(u.toLowerCase()))||((pe=de.description)==null?void 0:pe.toLowerCase().includes(u.toLowerCase()))||((be=de.supplier)==null?void 0:be.toLowerCase().includes(u.toLowerCase()))});p(ie)}else p(s);b()},[u,s,b]);const P=async()=>{try{a(!0);const ie=await An.getAllLocalProducts(),de=m$(ie);r(de),l(null)}catch(ie){l(ie.message)}finally{a(!1)}},_=async()=>{try{const[ie,de]=await Promise.all([rr.getAllSuppliers(),ir.getAllSuppliers()]);Q(ie),B(de)}catch(ie){console.error("Error loading suppliers:",ie)}},C=async(ie,de)=>{try{if(de==="local"){const ne=A.find(ye=>ye.name===ie);ne&&(S(ne),D(!0))}else if(de==="foreign"){const ne=q.find(ye=>ye.name===ie);ne&&(S(ne),T(!0))}}catch(ne){console.error("Error opening supplier modal:",ne)}},U=()=>{D(!1),T(!1),S(null)},w=ie=>{Y(`       

${ie.name}`,()=>W(ie),"   ")},W=async ie=>{try{L(!0),await bs.moveToTrash(ie,"localproducts"),await An.deleteLocalProduct(ie.id);const de=te();H("task",`${de.name}   `,`   : ${ie.name}`),await P(),X(`    : ${ie.name}`,"  ")}catch(de){l(de.message),ue(`     : ${de.message}`,"  ")}finally{L(!1)}};return i?t.jsx(It,{show:!0,message:"    ...",overlay:!1}):o?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:o}),t.jsxs("button",{className:"btn btn-primary",onClick:P,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):t.jsxs("div",{"data-list":"local-products",children:[f.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-box-seam fs-1"})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:u?"    ":"      "})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",style:{width:"120px"},children:""})]})}),t.jsx("tbody",{children:E.map((ie,de)=>{let ne=ie.price,ye=ie.supplier,pe=!1,be=null,xe=null;return ie.priceQuotes&&Array.isArray(ie.priceQuotes)&&ie.priceQuotes.length>0&&(pe=!0,xe=ie.priceQuotes.reduce((Ee,Re)=>{const fe=parseFloat(Ee.price)||0;return(parseFloat(Re.price)||0)<fe?Re:Ee}),ne=xe.price,ye=xe.supplierName,be=xe.supplierType),t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(z-1)*I+de+1})}),t.jsx("td",{className:"text-center",children:t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary product-name-btn",onClick:Ee=>{if(Ee.preventDefault(),Ee.stopPropagation(),console.log("=== LOCAL PRODUCT BUTTON CLICKED ==="),console.log("Product Name:",ie.name),console.log("Product ID:",ie.id),ie.id){const Re=`/local-products/edit/${ie.id}`;console.log("Navigating to:",Re);try{$(Re),console.log(" Navigation successful")}catch(fe){console.log(" Navigation failed:",fe),ue("     ","  ")}}else console.error("Product ID is missing:",ie),ue("     ","  ")},onMouseDown:Ee=>Ee.preventDefault(),style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0",userSelect:"none",pointerEvents:"auto",zIndex:"1"},title:`  | Internal ID: ${ie.internalId||"Not Set"} | Firebase ID: ${ie.id||"Missing"}`,children:ie.name})}),t.jsx("td",{className:"text-center",children:ie.category||"-"}),t.jsx("td",{className:"text-center",children:ie.unit||"-"}),t.jsx("td",{className:"text-center",children:ne?t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsxs("span",{children:[ne," "]}),pe&&t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),t.jsx("td",{className:"text-center",children:ye?t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[pe&&be?t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",onClick:()=>C(ye,be),style:{textDecoration:"none"},title:`  ${be==="local"?" ":" "}`,children:ye}):t.jsx("span",{children:ye}),pe&&t.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(Tt,{can:"products:update",mode:"disable",children:t.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>$(`/local-products/edit/${ie.id}`),title:"",children:t.jsx("i",{className:"bi bi-pencil"})})}),t.jsx(Tt,{can:"products:delete",mode:"disable",children:t.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>w(ie),title:"",children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},ie.internalId||ie.id)})})]})}),f.length>0&&t.jsx(dr,{currentPage:z,totalPages:O,onPageChange:k,totalItems:N,itemsPerPage:I}),R&&x&&t.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:ie=>{ie.target===ie.currentTarget&&U()},children:t.jsx("div",{className:"modal-dialog modal-lg",onClick:ie=>ie.stopPropagation(),children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[t.jsxs("div",{className:"modal-header border-0",children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"  - ",x.name,t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:""})]}),t.jsx("button",{type:"button",className:"btn-close",onClick:U})]}),t.jsx("div",{className:"modal-body",children:t.jsxs("div",{className:"row g-3",children:[t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.name})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.email||""})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:x.phone||""})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.city||""})]}),t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.address||""})]}),x.taxNumber&&t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.taxNumber})]}),x.bankAccount&&t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:"  "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.bankAccount})]}),x.notes&&t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.notes})]})]})}),t.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:t.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:U,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""})})]})})}),y&&x&&t.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:ie=>{ie.target===ie.currentTarget&&U()},children:t.jsx("div",{className:"modal-dialog modal-lg",onClick:ie=>ie.stopPropagation(),children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[t.jsxs("div",{className:"modal-header border-0",children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"  - ",x.name,t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:""})]}),t.jsx("button",{type:"button",className:"btn-close",onClick:U})]}),t.jsx("div",{className:"modal-body",children:t.jsxs("div",{className:"row g-3",children:[t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.name})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.email||""})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:x.phone||""})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.country||""})]}),t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.address||""})]}),x.taxNumber&&t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.taxNumber})]}),x.bankAccount&&t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:"  "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.bankAccount})]}),x.notes&&t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.notes})]})]})}),t.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:t.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:U,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""})})]})})}),t.jsx(Mt,{show:G.show,onClose:F,title:G.title,message:G.message,type:G.type,onConfirm:G.onConfirm,confirmText:G.confirmText,cancelText:G.cancelText,showCancel:G.showCancel})]})},T$=({searchTerm:n})=>{const[e,s]=h.useState(0),[r,i]=h.useState(0);h.useEffect(()=>{a()},[n]);const a=async()=>{try{const o=await An.getAllLocalProducts();if(s(o.length),n!=null&&n.trim()){const l=o.filter(c=>{var d,u,f,p;return((d=c.name)==null?void 0:d.toLowerCase().includes(n.toLowerCase()))||((u=c.category)==null?void 0:u.toLowerCase().includes(n.toLowerCase()))||((f=c.description)==null?void 0:f.toLowerCase().includes(n.toLowerCase()))||((p=c.supplier)==null?void 0:p.toLowerCase().includes(n.toLowerCase()))});i(l.length)}else i(o.length)}catch(o){console.error("Error loading local products count:",o),s(0),i(0)}};return t.jsx("span",{className:"badge bg-secondary ms-2",style:{fontSize:"12px",fontWeight:"normal"},children:n!=null&&n.trim()?`${r}  ${e}`:e})};function A$(){const[n,e]=h.useState(!1),[s,r]=h.useState(0),[i,a]=h.useState(""),{isTimelineVisible:o}=Ut(),l=kt(),c=()=>{e(!n)};return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[t.jsx(Rt,{onToggle:c}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!o?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"20px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef",pointerEvents:"none"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-box text-primary me-2"}),"  "]}),t.jsx(T$,{searchTerm:i})]}),t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:i,onChange:d=>a(d.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsx("button",{onClick:()=>l("/local-products/add"),className:"btn btn-primary",style:{height:"40px",width:"140px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:"  "})]})]})}),t.jsx("div",{style:{height:"calc(100vh - 280px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"card-body p-0",children:t.jsx(I$,{refreshTrigger:s,searchTerm:i})})})]})}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&o&&t.jsx(os,{rtl:!0}),!n&&o&&t.jsx(ls,{})]})})})}function _$(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(A$,{})})})}function R$(){var Os,vs,Z;const[n,e]=h.useState(!1),{isTimelineVisible:s}=Ut(),[r,i]=h.useState({name:"",category:"",description:"",unit:"",price:"",supplier:"",stockQuantity:"",minimumStock:"",storageConditions:"",expiryDate:"",batchNumber:"",origin:"",notes:"",active:!0}),[a,o]=h.useState({}),[l,c]=h.useState(!1),[d,u]=h.useState(!1),[f,p]=h.useState(!1),[j,L]=h.useState(!1),[R,D]=h.useState(null),[y,T]=h.useState(!1),[x,S]=h.useState(null),[A,Q]=h.useState({supplierType:"local",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),[q,B]=h.useState(null),[$,H]=h.useState([]),[te,G]=h.useState([]),[F,X]=h.useState([]),[ue,Y]=h.useState(!1),{alertConfig:z,closeAlert:O,showSuccess:E,showError:k,showConfirm:b}=Bt(),N=v=>{if(v.length===0)return;const se=v.reduce((re,J)=>{const he=parseFloat(re.price)||0;return(parseFloat(J.price)||0)<he?J:re});console.log("Lowest price quote found:",se),i(re=>({...re,price:se.price,supplier:se.supplierName}))},I=kt(),{id:P}=Dn(),_=!!P,C=`localProductForm_${P||"new"}`,{logActivity:U,getCurrentUser:w}=Zt(),{hasPerm:W,readOnly:ie}=Yn(),de=W("products:create"),ne=W("products:update"),ye=ie||_&&!ne||!_&&!de,pe=de||ne,be=()=>{e(!n)};h.useEffect(()=>{try{const v=localStorage.getItem(C);if(v){const se=JSON.parse(v);console.log(" [FORCE PERSIST] Restoring local product form data from localStorage:",se),i(se)}}catch(v){console.warn("Failed to parse saved local product form data:",v)}},[C]),h.useEffect(()=>{const v=()=>{try{localStorage.setItem(C,JSON.stringify(r)),console.log(" [FORCE PERSIST] Local product form data saved on beforeunload")}catch(J){console.warn("Failed to save local product form data on beforeunload:",J)}},se=()=>{if(document.hidden)try{localStorage.setItem(C,JSON.stringify(r)),console.log(" [FORCE PERSIST] Local product form data saved on visibility change")}catch(J){console.warn("Failed to save local product form data on visibility change:",J)}},re=()=>{try{localStorage.setItem(C,JSON.stringify(r)),console.log(" [FORCE PERSIST] Local product form data saved on window blur")}catch(J){console.warn("Failed to save local product form data on window blur:",J)}};return window.addEventListener("beforeunload",v),document.addEventListener("visibilitychange",se),window.addEventListener("blur",re),()=>{window.removeEventListener("beforeunload",v),document.removeEventListener("visibilitychange",se),window.removeEventListener("blur",re)}},[r,C]),h.useEffect(()=>{console.log(" AddLocalProduct useEffect triggered:",{id:P,isEditing:_}),xe(),_&&P&&(localStorage.getItem(C)?(console.log(" [FORCE PERSIST] User changes exist, preserving local product form data"),Ee()):(console.log(" Loading local product data for edit mode..."),Re()));const v=()=>{_&&P&&(console.log("Window focused - refreshing local product data..."),Re())};return window.addEventListener("focus",v),()=>{window.removeEventListener("focus",v)}},[P,_]),h.useEffect(()=>{const v=sessionStorage.getItem("selectedSupplier"),se=sessionStorage.getItem("openPriceModal");if(v)try{const re=JSON.parse(v);Q(J=>({...J,supplier:re.id,supplierName:re.name,supplierType:re.type})),sessionStorage.removeItem("selectedSupplier"),console.log(" Supplier selected from selection page:",re),se==="true"&&(sessionStorage.removeItem("openPriceModal"),setTimeout(()=>{p(!0),console.log(" Auto-opening price quote modal")},100))}catch(re){console.error(" Error parsing selected supplier:",re),sessionStorage.removeItem("selectedSupplier"),sessionStorage.removeItem("openPriceModal")}},[]),h.useEffect(()=>{var v;console.log("PriceQuoteData changed:",{hasFile:!!A.quotationFile,fileName:(v=A.quotationFile)==null?void 0:v.name,supplierName:A.supplierName,price:A.price})},[A]);const xe=async()=>{try{const[v,se]=await Promise.all([rr.getAllSuppliers(),ir.getAllSuppliers()]);H(v),G(se)}catch(v){console.error("Error loading suppliers:",v)}},Ee=async()=>{try{console.log("Loading price quotes only for local product ID:",P);const v=await An.getLocalProductById(P);v&&v.priceQuotes&&Array.isArray(v.priceQuotes)&&(console.log("Loading price quotes for local product:",v.name,v.priceQuotes),X(v.priceQuotes),setTimeout(()=>{N(v.priceQuotes)},200))}catch(v){console.error("Error loading price quotes only:",v)}},Re=async()=>{try{u(!0),console.log("Loading local product data for ID:",P);const v=await An.getLocalProductById(P);v?(console.log("Local product found:",v.name),i({name:v.name||"",category:v.category||"",description:v.description||"",unit:v.unit||"",price:v.price||"",supplier:v.supplier||"",stockQuantity:v.stockQuantity||"",minimumStock:v.minimumStock||"",storageConditions:v.storageConditions||"",expiryDate:v.expiryDate||"",batchNumber:v.batchNumber||"",origin:v.origin||"",notes:v.notes||"",active:v.active!==void 0?v.active:!0}),v.priceQuotes&&Array.isArray(v.priceQuotes)?(console.log("Loading price quotes for local product:",v.name,v.priceQuotes),X(v.priceQuotes),setTimeout(()=>{N(v.priceQuotes)},200)):console.log("No price quotes found for local product:",v.name)):(console.error("Local product not found with ID:",P),o({submit:"      "}))}catch(v){console.error("Error loading local product:",v),o({submit:"     : "+v.message})}finally{u(!1)}},fe=v=>{const{name:se,value:re,type:J,checked:he}=v.target,Se={...r,[se]:J==="checkbox"?he:re};i(Se);try{localStorage.setItem(C,JSON.stringify(Se)),console.log(" [FORCE PERSIST] Local product form data saved to localStorage on every change")}catch(me){console.warn("Failed to save local product form data to localStorage:",me)}a[se]&&o(me=>({...me,[se]:""}))},Ve=async v=>{v.preventDefault();const se=An.validateLocalProductData(r);if(F.length===0&&(se.priceQuotes="      "),Object.keys(se).length>0){o(se);return}c(!0),o({});try{const re=await Bn.validateUniqueFields({name:r.name},_?P:null,_?"localproducts":null);if(Object.keys(re).length>0){o(re),c(!1);return}const J={...r,price:parseFloat(r.price)||0,stockQuantity:parseFloat(r.stockQuantity)||0,minimumStock:parseFloat(r.minimumStock)||0,priceQuotes:F,status:"active"};if(console.log("Saving local product with price quotes:",{name:J.name,priceQuotes:J.priceQuotes,priceQuotesCount:J.priceQuotes.length}),_){await An.updateLocalProduct(P,J);const he=w();U("task",`${he.name}   `,`   : ${J.name}`)}else{await An.createLocalProduct(J);const he=w();U("task",`${he.name}   `,`   : ${J.name}`)}try{localStorage.removeItem(C),console.log(" [FORCE PERSIST] Cleared local product form data from localStorage on successful save")}catch(he){console.warn("Failed to clear local product form data from localStorage:",he)}I("/local-products")}catch(re){o({submit:re.message})}finally{c(!1)}},$e=()=>{I("/local-products")},et=()=>{p(!0)},ze=()=>{p(!1),B(null),Q({supplierType:"local",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),o(v=>({...v,fileUpload:""})),console.log("Modal closed and state reset")},tt=()=>{const v=window.location.pathname,re=`/supplier-selection/${A.supplierType||"local"}?returnPath=${encodeURIComponent(v)}&materialType=localProduct&materialId=${P||"new"}`;I(re)},rt=()=>{L(!1),D(null)},bt=v=>{console.log("Supplier Name:",v);try{console.log("Using already loaded local supplier data...");const se=$;console.log("Available local suppliers:",se.length),console.log("Local suppliers list:",se.map(J=>({id:J.id,name:J.name})));const re=se.find(J=>J.name===v);console.log("Found supplier:",re?"YES":"NO"),re?(console.log("SUCCESS: Local supplier found:",re.name),console.log("Supplier data:",re),S(re),T(!0),console.log("Modal state should be true now"),setTimeout(()=>{console.log("Modal state check - showSupplierEditModal:",y),console.log("Modal state check - selectedSupplierToEdit:",x==null?void 0:x.name)},100)):(console.error("LOCAL SUPPLIER NOT FOUND"),console.error("Looking for supplier name:",v),console.error("Available suppliers:",se.map(J=>J.name)),se.length===0?(console.log("No suppliers loaded, triggering data reload..."),loadSuppliersData(),k("    .   ...","  ")):k(`     : ${v}`,"  "))}catch(se){console.error("=== LOCAL SUPPLIER SEARCH ERROR ==="),console.error("Error details:",se),console.error("Error message:",se.message),k(`     : ${se.message}`,"  ")}},At=()=>{console.log("Called by:",new Error().stack),T(!1),S(null)},ns=v=>{D(v)},Ht=()=>{R&&Q(v=>{var re,J;console.log("Before supplier selection - preserving file:",(re=v.quotationFile)==null?void 0:re.name);const se={...v,supplier:R.id,supplierName:R.name};return console.log("After supplier selection - file preserved:",(J=se.quotationFile)==null?void 0:J.name),se}),L(!1),D(null)},is=v=>{console.log("File details:",{name:v==null?void 0:v.name,size:v==null?void 0:v.size,type:v==null?void 0:v.type,lastModified:v==null?void 0:v.lastModified}),a.fileUpload&&o(se=>({...se,fileUpload:""})),Q(se=>{var J;const re={...se,quotationFile:v};return console.log("Updated priceQuoteData with file:",{hasFile:!!re.quotationFile,fileName:(J=re.quotationFile)==null?void 0:J.name}),re})},Oe=v=>{const{name:se,value:re,type:J}=v.target;J!=="file"&&Q(se==="supplierType"?he=>({...he,[se]:re,supplier:"",supplierName:""}):he=>({...he,[se]:re}))},it=async v=>{if(v.preventDefault(),console.log("Form element:",v.target),console.log("Current priceQuoteData:",A),console.log("Editing quote ID:",q),!A.supplierName){o(he=>({...he,fileUpload:"   "}));return}if(!A.date){o(he=>({...he,fileUpload:"   "}));return}if(!A.price){o(he=>({...he,fileUpload:"  "}));return}const se=new FormData(v.target),re=se.get("quotationFile");console.log("File from form directly:",re),console.log("File from state:",A.quotationFile);const J=A.quotationFile||re;console.log("File to upload:",J),console.log("File upload details:",{exists:!!J,isFile:J instanceof File,name:J==null?void 0:J.name,size:J==null?void 0:J.size,type:J==null?void 0:J.type,lastModified:J==null?void 0:J.lastModified});try{if(c(!0),!q&&(!J||J.size===0))throw new Error("    ");let he=null;if(J&&typeof J!="string"&&J.size>0){console.log("Starting file upload:",J.name);try{Ss.validateFile(J,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}),console.log("File validation passed")}catch(Se){throw console.error("File validation failed:",Se),new Error(Se.message)}console.log("Attempting file upload to Firebase...");try{const Se=J.name.split(".").pop()||"pdf",me=A.supplierName?`  ${A.supplierName}.${Se}`:J.name;console.log("Uploading with custom name:",me),he=await Ss.uploadFileWithCustomName(J,"quotations",me),console.log("File uploaded successfully:",he)}catch(Se){throw console.error("Firebase upload failed:",Se),new Error(`   : ${Se.message}`)}}if(q)console.log("Updating existing price quote with ID:",q),X(Se=>{const me=Se.map(ge=>ge.id===q?{...ge,supplierType:A.supplierType,supplier:A.supplier,supplierName:A.supplierName,date:A.date,price:A.price,quotationFile:he?he.path:ge.quotationFile,quotationFileURL:he?he.url:ge.quotationFileURL,quotationFileName:he?he.originalName:ge.quotationFileName,quotationFileSize:he?he.size:ge.quotationFileSize,quotationFileType:he?he.type:ge.quotationFileType,updatedAt:new Date}:ge);return console.log("Updated price quotes:",me),setTimeout(()=>{N(me)},100),me});else{const Se={id:Date.now().toString(),supplierType:A.supplierType,supplier:A.supplier,supplierName:A.supplierName,date:A.date,price:A.price,quotationFile:he?he.path:null,quotationFileURL:he?he.url:null,quotationFileName:he?he.originalName:null,quotationFileSize:he?he.size:null,quotationFileType:he?he.type:null,createdAt:new Date};console.log("Adding new price quote:",Se),X(me=>{const ge=[...me,Se];return console.log("Updated price quotes:",ge),setTimeout(()=>{N(ge)},100),ge})}a.priceQuotes&&o(Se=>({...Se,priceQuotes:""})),ze(),_&&P&&setTimeout(async()=>{try{console.log("Auto-saving local product after price quote change..."),X(Se=>{const me={...se,priceQuotes:Se};return An.updateLocalProduct(P,me).then(()=>{console.log("Auto-save successful")}).catch(ge=>{console.error("Auto-save failed:",ge),k("   ","  ")}),Se})}catch(Se){console.error("Auto-save setup error:",Se)}},200)}catch(he){console.error("Error uploading file:",he),o(Se=>({...Se,fileUpload:he.message||"   .   ."}))}finally{c(!1)}},Kt=v=>{console.log("Starting edit for quote:",v),B(v.id),Q({supplierType:v.supplierType||"local",supplier:v.supplier||"",supplierName:v.supplierName||"",date:v.date||"",price:v.price||"",quotationFile:v.quotationFile||null}),p(!0)},zs=v=>{if(console.log("Price quote delete button clicked:",v),console.log("Quote ID:",v==null?void 0:v.id),console.log("Quote keys:",v?Object.keys(v):"quote is null/undefined"),!v||!v.id){console.error("Invalid quote object - missing quote or ID:",{quote:v,hasId:!!(v!=null&&v.id),quoteId:v==null?void 0:v.id,quoteType:typeof v}),k("    ","");return}b(`      

${v.supplierName} - ${v.price} `,()=>xs(v),"   ")},xs=async v=>{if(console.log("Delete confirmation called for quote:",v),console.log("Confirmation - Quote ID:",v==null?void 0:v.id),console.log("Confirmation - Quote keys:",v?Object.keys(v):"quote is null/undefined"),console.log("Is editing mode:",_),console.log("Local product ID:",P),console.log("Form data name:",r.name),!v||!v.id){console.error("Invalid quote in confirmation - missing quote or ID:",{quote:v,hasId:!!(v!=null&&v.id),quoteId:v==null?void 0:v.id,quoteType:typeof v}),k("    ",""),Y(!1);return}try{if(Y(!0),console.log("Starting delete process..."),console.log("Moving to trash..."),_&&P){const re={...v,localProductId:P,localProductName:r.name};console.log("Quote with context for trash:",re),console.log("Calling SimpleTrashService.moveToTrash...");const J=await bs.moveToTrash(re,"price_quotes");console.log("Trash service result:",J),console.log("Moved to trash successfully")}else console.log("Skipping trash - local product not saved yet (isEditing:",_,", id:",P,")");const se=w();console.log("Logging activity with current user:",se),U("task",`${se.name}   `,`   : ${v.supplierName} - ${v.price} `),console.log("Updating local state..."),console.log("Current price quotes before deletion:",F),X(re=>{const J=re.filter(he=>he.id!==v.id);return console.log("Filtered quotes:",J.length,"from",re.length),console.log("Removed quote with ID:",v.id),console.log("Remaining quotes:",J.map(he=>({id:he.id,supplierName:he.supplierName}))),setTimeout(()=>{N(J)},100),J}),console.log("Showing success message..."),_&&P?E(`    : ${v.supplierName}`,"  "):E(`   : ${v.supplierName}`," "),console.log("Delete process completed successfully"),_&&P&&setTimeout(async()=>{try{console.log("Auto-saving local product after price quote deletion..."),X(re=>{const J={...r,priceQuotes:re};return An.updateLocalProduct(P,J).then(()=>{console.log("Auto-save after deletion successful")}).catch(he=>{console.error("Auto-save after deletion failed:",he)}),re})}catch(re){console.error("Auto-save after deletion setup error:",re)}},200)}catch(se){console.error("Error deleting price quote:",se),console.error("Error stack:",se.stack),k(`    : ${se.message||"  "}`,"  ")}finally{console.log("Setting deleting to false"),Y(!1)}},cs=()=>$.filter(re=>{const J=re.hasOwnProperty("active"),he=re.hasOwnProperty("status");return J?re.active===!0:he?re.status==="active":!0});return d?t.jsx(It,{show:!0,message:"    ..."}):t.jsxs(Ft,{children:[t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:be}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!s?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{style:{position:"sticky",top:0,zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsx("a",{href:"/local-products",className:"text-decoration-none text-primary",children:" "})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsx("a",{href:"/local-products",className:"text-decoration-none text-primary",children:" "})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:_?"  ":"   "})]})})}),t.jsxs("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:[t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"60px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsxs("div",{className:"card-header bg-white border-bottom py-4 d-flex align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),_?"  ":"   "]}),t.jsx("div",{style:{flex:1}}),t.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:et,disabled:!pe,title:pe?"   ":"     ",style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:"1",paddingTop:"2px"},children:" "})]}),t.jsxs("form",{onSubmit:Ve,children:[t.jsxs("div",{className:"card-body p-4",children:[a.submit&&t.jsxs("div",{className:"alert alert-danger",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.submit]}),t.jsxs("div",{className:"row mb-4",children:[t.jsx("div",{className:"col-12",children:t.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[t.jsx("i",{className:"bi bi-info-circle me-2"})," "]})}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:"   *"}),t.jsx("input",{type:"text",className:`form-control ${a.name?"is-invalid":""}`,name:"name",value:r.name,onChange:fe,placeholder:"   ",readOnly:ye}),a.name&&t.jsx("div",{className:"invalid-feedback",children:a.name})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:" *"}),t.jsx(Hf,{name:"category",value:r.category,onChange:fe,required:!0,className:`form-select ${a.category?"is-invalid":""}`,placeholder:" ",showDescription:!0}),a.category&&t.jsx("div",{className:"invalid-feedback",children:a.category})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:" *"}),t.jsx(Qf,{name:"unit",value:r.unit,onChange:fe,required:!0,className:`form-select ${a.unit?"is-invalid":""}`,placeholder:" ",showDescription:!0}),a.unit&&t.jsx("div",{className:"invalid-feedback",children:a.unit})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsxs("label",{className:"form-label fw-bold",children:[" () *",t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:F.length>0?"  ":" "})]}),t.jsx("input",{type:"number",step:"0.01",min:"0",className:`form-control ${a.price?"is-invalid":""}`,name:"price",value:r.price,onChange:null,onKeyPress:null,placeholder:"0.00",readOnly:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"}}),a.price&&t.jsx("div",{className:"invalid-feedback",children:a.price}),t.jsx("div",{className:"mt-1",children:t.jsxs("small",{className:"text-muted",children:[t.jsx("i",{className:"bi bi-info-circle me-1"}),F.length>0?"        ":"       "]})})]}),t.jsxs("div",{className:"col-md-12 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:""}),t.jsx("textarea",{className:"form-control",name:"description",value:r.description,onChange:fe,rows:"3",placeholder:"  ",readOnly:ye})]}),t.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("span",{className:`badge ${r.active?"bg-success":"bg-secondary"} px-3 py-2`,children:r.active?"":" "}),t.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"localProductActiveSwitch",name:"active",checked:r.active,onChange:fe,style:{width:"48px",height:"24px",marginRight:"8px"}})]})})]}),t.jsxs("div",{className:"row mb-4",children:[t.jsxs("div",{className:"col-12",children:[t.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[t.jsx("i",{className:"bi bi-receipt me-2"})," "]}),a.priceQuotes&&t.jsxs("div",{className:"alert alert-danger",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.priceQuotes]})]}),F.length>0&&t.jsx("div",{className:"col-12",children:t.jsxs("div",{className:"card mb-3 border-0 shadow-lg",style:{background:"linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%)",borderRadius:"16px"},children:[t.jsx("div",{className:"card-header border-0",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"16px 16px 0 0",padding:"20px"},children:t.jsxs("h5",{className:"card-title text-white mb-0 d-flex align-items-center",children:[t.jsx("div",{className:"me-3",style:{background:"rgba(255,255,255,0.2)",borderRadius:"12px",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx("i",{className:"bi bi-bar-chart-fill fs-5"})}),t.jsx("span",{className:"fw-bold",children:"  "}),t.jsxs("span",{className:"badge bg-light text-primary ms-3",style:{borderRadius:"20px",fontSize:"12px",padding:"6px 12px"},children:[F.length," "]})]})}),t.jsx("div",{className:"card-body",style:{padding:"30px"},children:t.jsx("div",{style:{minHeight:"675px",direction:"ltr"},children:t.jsxs("div",{style:{width:"100%",height:"655px",position:"relative"},children:[t.jsx("style",{dangerouslySetInnerHTML:{__html:`
                                        g[class*="hover-group-"]:hover .hover-supplier-name {
                                          opacity: 1 !important;
                                          transition: opacity 0.3s ease-in-out;
                                        }
                                        .hover-supplier-name {
                                          transition: opacity 0.3s ease-in-out;
                                        }
                                        g[class*="hover-group-"] {
                                          cursor: pointer;
                                        }
                                      `}}),(()=>{F.map(Se=>parseFloat(Se.price)||0);const v=640,J=F.length*150,he=Math.max(v,J);return t.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${he+160} 655`,style:{direction:"ltr"},children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"chartBgLocal",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#ffffff",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#f8f9ff",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"bestPriceGradientLocal",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#00f5a0",stopOpacity:1}}),t.jsx("stop",{offset:"30%",style:{stopColor:"#00d9f5",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#0066cc",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"regularPriceGradientLocal",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),t.jsx("stop",{offset:"50%",style:{stopColor:"#764ba2",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#f093fb",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient0Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#764ba2",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient1Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#f093fb",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#f5576c",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient2Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#4facfe",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#00f2fe",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient3Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#a8edea",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#fed6e3",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient4Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#ffecd2",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#fcb69f",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient5Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#a18cd1",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#fbc2eb",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient6Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#fad0c4",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#ffd1ff",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient7Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#a1c4fd",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#c2e9fb",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"metallicShineLocal",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),t.jsx("stop",{offset:"45%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),t.jsx("stop",{offset:"50%",style:{stopColor:"rgba(255,255,255,0.8)",stopOpacity:1}}),t.jsx("stop",{offset:"55%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),t.jsx("stop",{offset:"100%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}})]}),t.jsx("filter",{id:"dropShadowLocal",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"6",stdDeviation:"8",floodColor:"rgba(0,0,0,0.15)"})}),t.jsxs("filter",{id:"premiumGlowLocal",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"5",result:"coloredBlur"}),t.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0 0 0  0 1 1 0 0  0 0 1 0 0  0 0 0 1 0"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("filter",{id:"bevelEffectLocal",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2",result:"blur"}),t.jsx("feSpecularLighting",{in:"blur",result:"specOut",surfaceScale:"5",specularConstant:"0.8",specularExponent:"20","lighting-color":"white",children:t.jsx("fePointLight",{x:"-50",y:"-50",z:"200"})}),t.jsx("feComposite",{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut2"}),t.jsx("feComposite",{in:"SourceGraphic",in2:"specOut2",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"})]}),t.jsxs("filter",{id:"pulseGlowLocal",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),t.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0.8 0 0  0 1 1 0 0  0 0 1 0.2 0  0 0 0 1 0"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),t.jsx("rect",{width:he+160,height:"655",fill:"url(#chartBgLocal)",rx:"12",style:{filter:"drop-shadow(0 4px 20px rgba(0,0,0,0.1))"}}),t.jsx("g",{transform:"translate(80, 40)",children:(()=>{const Se=F.map(pt=>parseFloat(pt.price)||0),me=Math.max(...Se),ge=Math.min(...Se),ke=me-ge||1,Ie=350,oe=640,we=F.length*150,_e=Math.max(oe,we),Ge=Math.min(_e/F.length*.6,80),mt=_e/F.length;return t.jsxs(t.Fragment,{children:[[0,1,2,3,4,5].map(pt=>{const Yt=150+(Ie-150)/5*pt,Fe=(1-pt/5)*Math.max(...Se);return t.jsxs("g",{children:[t.jsx("line",{x1:"0",y1:Yt,x2:_e,y2:Yt,stroke:pt===5?"#007bff":"rgba(123, 140, 252, 0.2)",strokeWidth:pt===5?"2":"1",strokeDasharray:pt===5?"0":"5,5"}),t.jsx("text",{x:"-15",y:Yt+5,textAnchor:"end",fontSize:"12",fill:"#4f46e5",fontWeight:"600",children:Math.round(Fe).toLocaleString()})]},pt)}),F.map((pt,Ye)=>{const Yt=parseFloat(pt.price)||0;let je;if(ke>0){const dt=Ie-150,ot=Yt/Math.max(...Se);je=Math.max(ot*dt,15)}else je=(Ie-150)*.8;const Fe=mt*Ye+(mt-Ge)/2,De=150+(Ie-150)-je,Ze=Yt===ge;let at;return Ze?at="bestPriceGradientLocal":at=`gradient${Ye%8}Local`,t.jsxs("g",{className:Ze?"":`hover-group-${Ye}`,children:[t.jsx("rect",{x:Fe+4,y:De+8,width:Ge,height:je,fill:"rgba(0,0,0,0.05)",rx:"10"}),t.jsx("rect",{x:Fe+2,y:De+4,width:Ge,height:je,fill:"rgba(0,0,0,0.08)",rx:"9"}),t.jsxs("rect",{x:Fe,y:De,width:Ge,height:je,fill:`url(#${at})`,rx:"10",filter:Ze?"url(#premiumGlowLocal)":"url(#bevelEffectLocal)",style:{transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer"},children:[t.jsx("animate",{attributeName:"height",from:"0",to:je,dur:"2s",begin:`${Ye*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),t.jsx("animate",{attributeName:"y",from:Ie,to:De,dur:"2s",begin:`${Ye*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),Ze&&t.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;1.05;1",dur:"3s",repeatCount:"indefinite",begin:`${Ye*.3+2}s`})]}),t.jsx("rect",{x:Fe+2,y:De+2,width:Ge-4,height:Math.max(je/2.5,30),fill:"url(#metallicShineLocal)",rx:"8",opacity:"0.6",children:t.jsx("animateTransform",{attributeName:"transform",type:"translate",values:`-${Ge};${Ge}`,dur:"4s",repeatCount:"indefinite",begin:`${Ye*.5+3}s`})}),t.jsx("rect",{x:Fe+3,y:De+3,width:Math.max(Ge/4,8),height:Math.max(je-6,20),fill:"rgba(255,255,255,0.4)",rx:"6"}),t.jsx("rect",{x:Fe+Ge-6,y:De+6,width:"3",height:Math.max(je-12,15),fill:"rgba(255,255,255,0.2)",rx:"1.5"}),t.jsxs("g",{children:[t.jsx("rect",{x:Fe+Ge/2-30,y:De-28,width:"60",height:"20",fill:"rgba(0,0,0,0.8)",rx:"10",opacity:"0.9"}),t.jsxs("text",{x:Fe+Ge/2,y:De-15,textAnchor:"middle",fontSize:"12",fill:"white",fontWeight:"bold",children:[". ",Yt.toLocaleString()]})]}),Ze&&t.jsx("g",{children:(()=>{const dt=pt.supplierName,ot=dt.length*7,Je=Math.max(ot+20,Ge+10);return t.jsxs(t.Fragment,{children:[t.jsx("rect",{x:Fe+Ge/2-Je/2,y:Ie+30,width:Je,height:22,fill:"rgba(255,255,255,0.96)",rx:"11",stroke:"rgba(0,123,255,0.5)",strokeWidth:"1.5",filter:"url(#dropShadowLocal)"}),t.jsx("text",{x:Fe+Ge/2,y:Ie+41,textAnchor:"middle",fontSize:"11",fill:"#1e40af",fontWeight:"700",style:{fontFamily:"system-ui, -apple-system, sans-serif",letterSpacing:"0.2px"},dominantBaseline:"middle",children:dt})]})})()}),!Ze&&t.jsx("g",{opacity:"0",className:"hover-supplier-name",style:{pointerEvents:"none"},children:(()=>{const dt=pt.supplierName,ot=dt.length*7,Je=Math.max(ot+20,Ge+10);return t.jsxs(t.Fragment,{children:[t.jsx("rect",{x:Fe+Ge/2-Je/2,y:Ie+30,width:Je,height:22,fill:"rgba(255,255,255,0.96)",rx:"11",stroke:"rgba(0,123,255,0.5)",strokeWidth:"1.5",filter:"url(#dropShadowLocal)"}),t.jsx("text",{x:Fe+Ge/2,y:Ie+41,textAnchor:"middle",fontSize:"11",fill:"#1e40af",fontWeight:"700",style:{fontFamily:"system-ui, -apple-system, sans-serif",letterSpacing:"0.2px"},dominantBaseline:"middle",children:dt})]})})()}),Ze&&t.jsxs("g",{children:[t.jsx("circle",{cx:Fe+Ge/2,cy:De-100,r:"18",fill:"linear-gradient(135deg, #ffd700 0%, #ffb300 100%)",stroke:"#fff",strokeWidth:"3",filter:"url(#dropShadowLocal)"}),t.jsx("text",{x:Fe+Ge/2,y:De-95,textAnchor:"middle",fontSize:"16",fill:"#fff",children:""}),t.jsx("rect",{x:Fe-5,y:De-70,width:Ge+10,height:"20",fill:"#28a745",rx:"10",opacity:"0.9"}),t.jsx("text",{x:Fe+Ge/2,y:De-57,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:" "})]})]},pt.id)}),t.jsx("text",{x:_e/2,y:20,textAnchor:"middle",fontSize:"18",fill:"url(#bestPriceGradientLocal)",fontWeight:"bold",direction:"rtl",children:"   "}),t.jsxs("g",{transform:`translate(${_e/2}, ${Ie+110})`,children:[t.jsx("rect",{x:"-200",y:"-25",width:"400",height:"145",fill:"rgba(255,255,255,0.98)",rx:"20",stroke:"url(#bestPriceGradientLocal)",strokeWidth:"2",filter:"url(#dropShadowLocal)"}),t.jsx("text",{x:"0",y:"-5",textAnchor:"middle",fontSize:"16",fill:"#1f2937",fontWeight:"800",letterSpacing:"0.5px",children:" "}),t.jsxs("g",{transform:"translate(0, 15)",children:[t.jsxs("g",{transform:"translate(-125, 0)",children:[t.jsxs("g",{transform:"translate(0, 0)",children:[t.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#bestPriceGradientLocal)",rx:"7",filter:"url(#premiumGlowLocal)"}),t.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#059669",fontWeight:"700",children:" "}),t.jsx("text",{x:"80",y:"13",fontSize:"18",children:""})]}),t.jsx("line",{x1:"110",y1:"-5",x2:"110",y2:"19",stroke:"rgba(0,0,0,0.15)",strokeWidth:"2"}),t.jsxs("g",{transform:"translate(125, 0)",children:[t.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#regularPriceGradientLocal)",rx:"7"}),t.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#6366f1",fontWeight:"700",children:" "}),t.jsx("text",{x:"90",y:"13",fontSize:"16",children:""})]})]}),t.jsxs("g",{transform:"translate(0, 40)",children:[t.jsx("rect",{x:"-170",y:"-8",width:"340",height:"22",fill:"rgba(59, 130, 246, 0.08)",rx:"11"}),t.jsxs("text",{x:"0",y:"5",textAnchor:"middle",fontSize:"14",fill:"#1e40af",fontWeight:"700",children:["   : ",(Math.max(...Se)-Math.min(...Se)).toLocaleString()," ."]})]}),t.jsx("g",{transform:"translate(0, 90)",children:t.jsxs("text",{x:"0",y:"0",textAnchor:"middle",fontSize:"12",fill:"#6b7280",fontWeight:"600",children:["  : ",Math.max(...Se).toLocaleString()," .      : ",Math.min(...Se).toLocaleString()," ."]})})]})]})]})})()})]})})()]})})})]})}),t.jsx("div",{className:"col-12",style:{position:"sticky",top:"0",zIndex:9999,backgroundColor:"rgba(255, 255, 255, 0.98)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",boxShadow:"0 2px 20px rgba(0, 0, 0, 0.1)",borderRadius:"8px",margin:"10px 0"},children:t.jsxs("div",{className:"card shadow-lg",style:{border:"2px solid #007bff",borderRadius:"12px"},children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsx("div",{className:"d-flex justify-content-between align-items-center",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-list-ul text-primary me-2"}),"   (",F.length,")"]})})}),t.jsx("div",{className:"card-body p-0",children:F.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-receipt fs-1"})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:"      "})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:"60px"},children:"#"}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" ()"}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",style:{width:"120px"},children:""})]})}),t.jsx("tbody",{children:F.map((v,se)=>{const re=F.length>=1&&F.reduce((J,he)=>{const Se=parseFloat(J.price)||0;return(parseFloat(he.price)||0)<Se?he:J}).id===v.id;return t.jsxs("tr",{className:re?"table-success":"",children:[t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:se+1})}),t.jsxs("td",{className:"text-center",children:[t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},onClick:J=>{J.preventDefault(),J.stopPropagation(),console.log("Button clicked, calling handleSupplierEdit..."),bt(v.supplierName)},title:` : ${v.supplierName}`,type:"button",children:v.supplierName}),re&&t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:`badge ${v.supplierType==="local"?"bg-success":"bg-info"}`,children:v.supplierType==="local"?"":""})}),t.jsx("td",{className:"text-center",children:v.date}),t.jsxs("td",{className:"text-center",children:[v.price," ",re&&t.jsx("i",{className:"bi bi-arrow-down-circle-fill text-success ms-2",title:" "})]}),t.jsx("td",{className:"text-center",children:v.quotationFile&&t.jsx(Ad,{size:25,clickable:!0,onClick:()=>{Kr(3e4),v.quotationFileURL?window.open(v.quotationFileURL,"_blank"):(console.log("No file URL available for:",v.quotationFile),alert("   "))},title:` : ${v.quotationFileName||v.quotationFile}`})}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(Tt,{can:"products:update",mode:"disable",children:t.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>Kt(v),title:"",children:t.jsx("i",{className:"bi bi-pencil"})})}),t.jsx(Tt,{can:"products:delete",mode:"disable",children:t.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>zs(v),title:"",children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},v.id)})})]})})})]})})]})]}),t.jsx("div",{className:"card-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:t.jsxs("div",{className:"d-flex gap-3",style:{marginBottom:"15px"},children:[t.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:$e,disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""}),t.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:l?" ...":t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-check-lg me-1"}),_?"":""]})})]})})]})]})}),t.jsx("div",{className:"app-footer",style:{textAlign:"center",padding:"20px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",marginTop:"20px"},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]})]}),!n&&s&&t.jsx(os,{rtl:!0}),!n&&s&&t.jsx(ls,{}),f&&t.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:99990},tabIndex:"-1",children:t.jsx("div",{className:"modal-dialog modal-lg",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[t.jsxs("div",{className:"modal-header border-0 pb-2",children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-receipt text-primary me-2"}),"  "]}),t.jsx("button",{type:"button",className:"btn-close",onClick:ze,style:{fontSize:"12px"}})]}),t.jsxs("form",{onSubmit:it,onReset:v=>v.preventDefault(),children:[t.jsxs("div",{className:"modal-body px-4",children:[a.fileUpload&&t.jsxs("div",{className:"alert alert-danger mb-3",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.fileUpload]}),t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:"  *"}),t.jsx("select",{className:"form-select",name:"supplierType",value:"local",onChange:Oe,required:!0,disabled:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"},children:t.jsx("option",{value:"local",children:" "})})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:" *"}),t.jsxs("div",{className:"form-control d-flex align-items-center justify-content-between",onClick:tt,style:{cursor:"pointer",backgroundColor:"#f8f9fa"},children:[t.jsx("span",{className:A.supplierName?"text-dark":"text-muted",children:A.supplierName||" "}),t.jsx("i",{className:"bi bi-chevron-down"})]})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:"  *"}),t.jsx("input",{type:"date",className:"form-control",name:"date",value:A.date,onChange:Oe,required:!0})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:" () *"}),t.jsx("input",{type:"number",step:"0.01",min:"0",className:"form-control",name:"price",value:A.price,onChange:Oe,onKeyPress:v=>{(v.key==="-"||v.key!=="."&&v.key!=="Backspace"&&(v.key<"0"||v.key>"9"))&&v.preventDefault()},placeholder:"0.00",required:!0})]}),t.jsxs("div",{className:"col-md-12 mb-3",children:[t.jsxs("label",{className:"form-label fw-bold",children:["   ",q?"()":"*"]}),t.jsxs("div",{className:"mb-2",children:[t.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.jpg,.png,.jpeg",style:{display:"none"},ref:v=>{v&&(v.onclick=()=>{v.value=""},v.onchange=se=>{var J;const re=(J=se.target.files)==null?void 0:J[0];re&&is(re)})},id:`fileInput_${f}_${Date.now()}`}),t.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>{console.log(" Local Product price quote upload button clicked"),console.log(" LOCAL PRODUCT MODAL: Starting fullscreen bypass for file picker"),Kr(2e4);const v=document.querySelector(`#fileInput_${f}_${Date.now()}`);if(v)v.click();else{const se=document.createElement("input");se.type="file",se.accept=".pdf,.doc,.docx,.jpg,.png,.jpeg",se.style.display="none",se.onchange=re=>{var he;const J=(he=re.target.files)==null?void 0:he[0];J&&is(J),document.body.removeChild(se)},document.body.appendChild(se),se.click()}},style:{borderRadius:"6px",height:"38px",minWidth:"150px"},children:[t.jsx("i",{className:"bi bi-upload me-2"})," "]})]}),A.quotationFile&&t.jsxs("div",{className:"alert alert-success py-2 mb-2",style:{position:"relative"},children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-check-circle me-2 text-success"}),t.jsxs("div",{className:"flex-grow-1",children:[t.jsx("strong",{children:A.quotationFile.name?A.supplierName?`  ${A.supplierName}.${A.quotationFile.name.split(".").pop()}`:A.quotationFile.name:q?A.supplierName?`  ${A.supplierName}.pdf`:((Os=F.find(v=>v.id===q))==null?void 0:Os.quotationFileName)||" ":" "}),t.jsxs("small",{className:"text-muted ms-2",children:["(",A.quotationFile.size?Math.round(A.quotationFile.size/1024):q?Math.round((((vs=F.find(v=>v.id===q))==null?void 0:vs.quotationFileSize)||0)/1024):0," KB)"]})]})]}),t.jsx("button",{type:"button",className:"btn-close btn-close-sm",onClick:()=>{Q(v=>({...v,quotationFile:null}))},title:" ",style:{position:"absolute",top:"8px",left:"8px",width:"20px",height:"20px",fontSize:"10px",opacity:.7},onMouseEnter:v=>v.target.style.opacity=1,onMouseLeave:v=>v.target.style.opacity=.7})]}),q&&!A.quotationFile&&t.jsxs("div",{className:"alert alert-info py-2 mb-2",children:[t.jsx("i",{className:"bi bi-info-circle me-2"}),t.jsxs("small",{children:[" : ",((Z=F.find(v=>v.id===q))==null?void 0:Z.quotationFileName)||" "]})]}),!A.quotationFile&&!q&&t.jsx("div",{className:"mt-1",children:t.jsxs("small",{className:"text-muted",children:[t.jsx("i",{className:"bi bi-info-circle me-1"}),"   PDF  Word  "]})})]})]})]}),t.jsx("div",{className:"modal-footer border-0 pt-0 d-flex justify-content-center",style:{marginBottom:"10px"},children:t.jsxs("div",{className:"d-flex gap-3",children:[t.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:ze,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""}),t.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:l||!pe,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:l?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"10px",height:"10px"}}),"..."]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-check-lg me-1"}),""]})})]})})]})]})})}),j&&t.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:99990},tabIndex:"-1",children:t.jsx("div",{className:"modal-dialog modal-xl",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[t.jsxs("div",{className:"modal-header border-0 pb-2",style:{marginBottom:"5px"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-people-fill text-primary me-2"}),"  ",t.jsxs("span",{className:"text-muted ms-2",children:["(",cs().length,")"]})]}),t.jsx("button",{type:"button",className:"btn-close",onClick:rt,style:{fontSize:"12px"}})]}),t.jsx("div",{className:"modal-body p-0",children:cs().length>0?t.jsx("div",{className:"table-responsive suppliers-table",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"50px"}}),t.jsx("th",{children:" "}),t.jsx("th",{children:" "}),t.jsx("th",{children:""}),t.jsx("th",{children:""})]})}),t.jsx("tbody",{children:cs().map(v=>t.jsxs("tr",{onClick:()=>ns(v),style:{cursor:"pointer"},children:[t.jsx("td",{className:"text-center",children:t.jsx("div",{className:"form-check d-flex justify-content-center",children:t.jsx("input",{className:"form-check-input custom-radio",type:"radio",name:"selectedSupplier",checked:(R==null?void 0:R.id)===v.id,onChange:()=>{},style:{pointerEvents:"none",width:"18px",height:"18px",borderWidth:"2px",borderColor:(R==null?void 0:R.id)===v.id?"#007bff":"#dee2e6"}})})}),t.jsx("td",{children:t.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},children:v.name})}),t.jsx("td",{children:t.jsx("a",{href:`mailto:${v.email}`,className:"text-decoration-none",children:v.email})}),t.jsx("td",{children:v.phone}),t.jsx("td",{children:v.city||"-"})]},v.id))})]})}):t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-people fs-1"})}),t.jsx("h5",{className:"text-muted",children:"  "}),t.jsx("p",{className:"text-muted",children:"    "})]})}),t.jsx("div",{className:"modal-footer border-0 d-flex justify-content-center",style:{marginTop:"15px"},children:t.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:Ht,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",margin:"20px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:""})})]})})}),y&&x&&t.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:v=>{v.target===v.currentTarget&&At()},children:t.jsx("div",{className:"modal-dialog modal-lg",onClick:v=>v.stopPropagation(),children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[t.jsxs("div",{className:"modal-header border-0",children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"  - ",x==null?void 0:x.name,t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:""})]}),t.jsx("button",{type:"button",className:"btn-close",onClick:At})]}),t.jsx("div",{className:"modal-body",children:t.jsxs("div",{className:"row g-3",children:[t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x==null?void 0:x.name})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:(x==null?void 0:x.email)||""})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:(x==null?void 0:x.phone)||""})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:(x==null?void 0:x.city)||""})]}),t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:(x==null?void 0:x.address)||""})]}),(x==null?void 0:x.taxNumber)&&t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.taxNumber})]}),(x==null?void 0:x.bankAccount)&&t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:"  "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.bankAccount})]}),(x==null?void 0:x.notes)&&t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.notes})]})]})}),t.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:t.jsx("div",{className:"d-flex gap-3",children:t.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:At,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""})})})]})})})]}),t.jsx(It,{show:l,message:_?"   ...":"   ..."}),t.jsx(Mt,{show:z.show,onClose:O,title:z.title,message:z.message,type:z.type,onConfirm:z.onConfirm,confirmText:z.confirmText,cancelText:z.cancelText,showCancel:z.showCancel}),t.jsx(Vh,{position:"bottom-right",showDetails:!0})]})}function qj(){return t.jsx(R$,{})}const D$=({refreshTrigger:n,searchTerm:e})=>{const[s,r]=h.useState([]),[i,a]=h.useState(!0),[o,l]=h.useState(null),[c,d]=h.useState(""),u=e!==void 0?e:c,[f,p]=h.useState([]),[j,L]=h.useState(!1),[R,D]=h.useState(!1),[y,T]=h.useState(!1),[x,S]=h.useState(null),[A,Q]=h.useState([]),[q,B]=h.useState([]),$=kt(),{logActivity:H,getCurrentUser:te}=Zt(),{alertConfig:G,closeAlert:F,showSuccess:X,showError:ue,showConfirm:Y}=Bt(),{currentPage:z,totalPages:O,paginatedItems:E,handlePageChange:k,resetPage:b,totalItems:N,itemsPerPage:I}=cr(f,30);h.useEffect(()=>{P(),_()},[]),h.useEffect(()=>{n&&P()},[n]),h.useEffect(()=>{if(u.trim()){const ie=s.filter(de=>{var ne,ye,pe,be;return((ne=de.name)==null?void 0:ne.toLowerCase().includes(u.toLowerCase()))||((ye=de.category)==null?void 0:ye.toLowerCase().includes(u.toLowerCase()))||((pe=de.description)==null?void 0:pe.toLowerCase().includes(u.toLowerCase()))||((be=de.supplier)==null?void 0:be.toLowerCase().includes(u.toLowerCase()))});p(ie)}else p(s);b()},[u,s,b]);const P=async()=>{try{a(!0),l(null);const ie=await nn.getAllForeignProducts();if(!Array.isArray(ie))throw new Error("Invalid data structure received from service");const de=p$(ie);r(de),p(de),l(null)}catch(ie){console.error("Error loading foreign products:",ie),l(ie.message||"   "),r([]),p([])}finally{a(!1)}},_=async()=>{try{const[ie,de]=await Promise.all([rr.getAllSuppliers(),ir.getAllSuppliers()]);Q(ie),B(de)}catch(ie){console.error("Error loading suppliers:",ie)}},C=async(ie,de)=>{try{if(de==="local"){const ne=A.find(ye=>ye.name===ie);ne&&(S(ne),D(!0))}else if(de==="foreign"){const ne=q.find(ye=>ye.name===ie);ne&&(S(ne),T(!0))}}catch(ne){console.error("Error opening supplier modal:",ne)}},U=()=>{D(!1),T(!1),S(null)},w=ie=>{Y(`       

${ie.name}`,()=>W(ie),"   ")},W=async ie=>{try{L(!0),await bs.moveToTrash(ie,"foreignproducts"),await nn.deleteForeignProduct(ie.id);const de=te();H("task",`${de.name}   `,`   : ${ie.name}`),await P(),X(`    : ${ie.name}`,"  ")}catch(de){l(de.message),ue(`     : ${de.message}`,"  ")}finally{L(!1)}};return i?t.jsx(It,{show:!0,message:"    ...",overlay:!1}):o?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:o}),t.jsxs("button",{className:"btn btn-primary",onClick:P,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):t.jsxs("div",{"data-list":"foreign-products",children:[f.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-box-seam fs-1"})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:u?"    ":"      "}),!u&&t.jsxs("div",{children:[t.jsxs("button",{className:"btn btn-primary mt-3 me-2",onClick:P,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"  "]}),t.jsxs("button",{className:"btn btn-outline-info mt-3",onClick:()=>{console.log("=== FOREIGN PRODUCTS DEBUG INFO ==="),console.log("Foreign Products State:",s),console.log("Filtered Products State:",f),console.log("Search Term:",u),console.log("Loading State:",i),console.log("Error State:",o),console.log("=== END DEBUG INFO ===")},children:[t.jsx("i",{className:"bi bi-bug me-2"}),"  "]})]})]}):t.jsxs("div",{children:[t.jsxs("div",{className:"alert alert-info mb-3",style:{fontSize:"12px"},children:[" ",E.length,"   ",f.length," "]}),t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",style:{width:"120px"},children:""})]})}),t.jsx("tbody",{children:E.map((ie,de)=>{let ne=ie.totalPrice||((parseFloat(ie.price)||0)+(parseFloat(ie.shippingCost)||0)).toFixed(2)||ie.price,ye=ie.supplier,pe=!1,be=null,xe=null;return ie.priceQuotes&&Array.isArray(ie.priceQuotes)&&ie.priceQuotes.length>0&&(pe=!0,xe=ie.priceQuotes.reduce((Ee,Re)=>{const fe=parseFloat(Ee.totalPrice)||(parseFloat(Ee.price)||0)+(parseFloat(Ee.shippingCost)||0);return(parseFloat(Re.totalPrice)||(parseFloat(Re.price)||0)+(parseFloat(Re.shippingCost)||0))<fe?Re:Ee}),ne=(parseFloat(xe.totalPrice)||(parseFloat(xe.price)||0)+(parseFloat(xe.shippingCost)||0)).toFixed(2),ye=xe.supplierName,be=xe.supplierType),t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(z-1)*I+de+1})}),t.jsx("td",{className:"text-center",children:t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary product-name-btn",onClick:Ee=>{if(Ee.preventDefault(),Ee.stopPropagation(),console.log("=== FOREIGN PRODUCT BUTTON CLICKED ==="),console.log("Product Name:",ie.name),console.log("Product ID:",ie.id),ie.id){const Re=`/foreign-products/edit/${ie.id}`;console.log("Navigating to:",Re);try{$(Re),console.log(" Navigation successful")}catch(fe){console.log(" Navigation failed:",fe),ue("     ","  ")}}else console.error("Product ID is missing:",ie),ue("     ","  ")},onMouseDown:Ee=>Ee.preventDefault(),style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0",userSelect:"none",pointerEvents:"auto",zIndex:"1"},title:`  | Internal ID: ${ie.internalId||"Not Set"} | Firebase ID: ${ie.id||"Missing"}`,children:ie.name})}),t.jsx("td",{className:"text-center",children:ie.category||"-"}),t.jsx("td",{className:"text-center",children:ie.unit||"-"}),t.jsx("td",{className:"text-center",children:ne?t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsxs("span",{children:[ne," "]}),pe&&t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"  "})]}):"-"}),t.jsx("td",{className:"text-center",children:ye?t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[pe&&be?t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",onClick:()=>C(ye,be),style:{textDecoration:"none"},title:`  ${be==="local"?" ":" "}`,children:ye}):t.jsx("span",{children:ye}),pe&&t.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(Tt,{can:"products:update",mode:"disable",children:t.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>$(`/foreign-products/edit/${ie.id}`),title:"",children:t.jsx("i",{className:"bi bi-pencil"})})}),t.jsx(Tt,{can:"products:delete",mode:"disable",children:t.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>w(ie),title:"",children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},ie.internalId||ie.id)})})]})})]}),f.length>0&&t.jsx(dr,{currentPage:z,totalPages:O,onPageChange:k,totalItems:N,itemsPerPage:I}),R&&x&&t.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:ie=>{ie.target===ie.currentTarget&&U()},children:t.jsx("div",{className:"modal-dialog modal-lg",onClick:ie=>ie.stopPropagation(),children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[t.jsxs("div",{className:"modal-header border-0",children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"  - ",x.name,t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:""})]}),t.jsx("button",{type:"button",className:"btn-close",onClick:U})]}),t.jsx("div",{className:"modal-body",children:t.jsxs("div",{className:"row g-3",children:[t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.name})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.email||""})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:x.phone||""})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.city||""})]}),t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.address||""})]}),x.taxNumber&&t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.taxNumber})]}),x.bankAccount&&t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:"  "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.bankAccount})]}),x.notes&&t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.notes})]})]})}),t.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:t.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:U,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""})})]})})}),y&&x&&t.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:ie=>{ie.target===ie.currentTarget&&U()},children:t.jsx("div",{className:"modal-dialog modal-lg",onClick:ie=>ie.stopPropagation(),children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[t.jsxs("div",{className:"modal-header border-0",children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"  - ",x.name,t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:""})]}),t.jsx("button",{type:"button",className:"btn-close",onClick:U})]}),t.jsx("div",{className:"modal-body",children:t.jsxs("div",{className:"row g-3",children:[t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.name})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.email||""})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:x.phone||""})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.country||""})]}),t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.address||""})]}),x.taxNumber&&t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.taxNumber})]}),x.bankAccount&&t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:"  "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.bankAccount})]}),x.notes&&t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.notes})]})]})}),t.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:t.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:U,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""})})]})})}),t.jsx(Mt,{show:G.show,onClose:F,title:G.title,message:G.message,type:G.type,onConfirm:G.onConfirm,confirmText:G.confirmText,cancelText:G.cancelText,showCancel:G.showCancel})]})},P$=({searchTerm:n})=>{const[e,s]=h.useState(0),[r,i]=h.useState(0);h.useEffect(()=>{a()},[n]);const a=async()=>{try{const o=await nn.getAllForeignProducts();if(s(o.length),n!=null&&n.trim()){const l=o.filter(c=>{var d,u,f,p;return((d=c.name)==null?void 0:d.toLowerCase().includes(n.toLowerCase()))||((u=c.category)==null?void 0:u.toLowerCase().includes(n.toLowerCase()))||((f=c.description)==null?void 0:f.toLowerCase().includes(n.toLowerCase()))||((p=c.supplier)==null?void 0:p.toLowerCase().includes(n.toLowerCase()))});i(l.length)}else i(o.length)}catch(o){console.error("Error loading foreign products count:",o),s(0),i(0)}};return t.jsx("span",{className:"badge bg-secondary ms-2",style:{fontSize:"12px",fontWeight:"normal"},children:n!=null&&n.trim()?`${r}  ${e}`:e})};function k$(){const[n,e]=h.useState(!1),[s,r]=h.useState(0),[i,a]=h.useState(""),{isTimelineVisible:o}=Ut(),l=kt(),c=()=>{e(!n)};return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[t.jsx(Rt,{onToggle:c}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!o?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"20px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:10,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-globe text-primary me-2"}),"  "]}),t.jsx(P$,{searchTerm:i})]}),t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:i,onChange:d=>a(d.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsx("button",{onClick:()=>r(d=>d+1),className:"btn btn-outline-secondary",style:{height:"40px",width:"40px",fontSize:"14px",borderRadius:"6px",padding:"6px",marginRight:"8px"},title:" ",children:t.jsx("i",{className:"bi bi-arrow-clockwise"})}),t.jsx("button",{onClick:()=>l("/foreign-products/add"),className:"btn btn-primary",style:{height:"40px",width:"140px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:"  "})]})]})}),t.jsx("div",{style:{height:"calc(100vh - 280px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"card-body p-0",children:t.jsx(D$,{refreshTrigger:s,searchTerm:i})})})]})}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&o&&t.jsx(os,{rtl:!0}),!n&&o&&t.jsx(ls,{})]})})})}function L$(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(k$,{})})})}function F$(){var cs,Os,vs;const[n,e]=h.useState(!1),{isTimelineVisible:s}=Ut(),[r,i]=h.useState({name:"",category:"",description:"",unit:"",price:"",supplier:"",stockQuantity:"",minimumStock:"",importLicense:"",customsCode:"",origin:"",notes:"",active:!0}),[a,o]=h.useState({}),[l,c]=h.useState(!1),[d,u]=h.useState(!1),[f,p]=h.useState(!1),[j,L]=h.useState(!1),[R,D]=h.useState(null),[y,T]=h.useState(!1),[x,S]=h.useState(null),[A,Q]=h.useState({supplierType:"foreign",supplier:"",supplierName:"",date:"",price:"",shippingCost:"",quotationFile:null}),[q,B]=h.useState(null),[$,H]=h.useState([]),[te,G]=h.useState([]),[F,X]=h.useState([]),[ue,Y]=h.useState(!1),{alertConfig:z,closeAlert:O,showSuccess:E,showError:k,showConfirm:b}=Bt(),N=Z=>{if(Z.length===0)return;const v=Z.reduce((re,J)=>{const he=parseFloat(re.totalPrice)||(parseFloat(re.price)||0)+(parseFloat(re.shippingCost)||0);return(parseFloat(J.totalPrice)||(parseFloat(J.price)||0)+(parseFloat(J.shippingCost)||0))<he?J:re});console.log("Lowest price quote found:",v);const se=parseFloat(v.totalPrice)||(parseFloat(v.price)||0)+(parseFloat(v.shippingCost)||0);i(re=>({...re,price:se.toFixed(2),supplier:v.supplierName}))},I=kt(),{id:P}=Dn(),_=!!P,C=`foreignProductForm_${P||"new"}`,{logActivity:U,getCurrentUser:w}=Zt(),{hasPerm:W,readOnly:ie}=Yn(),de=W("products:create"),ne=W("products:update"),ye=de||ne,pe=()=>{e(!n)};h.useEffect(()=>{try{const Z=localStorage.getItem(C);if(Z){const v=JSON.parse(Z);console.log(" [FORCE PERSIST] Restoring foreign product form data from localStorage:",v),i(v)}}catch(Z){console.warn("Failed to parse saved foreign product form data:",Z)}},[C]),h.useEffect(()=>{const Z=()=>{try{localStorage.setItem(C,JSON.stringify(r)),console.log(" [FORCE PERSIST] Foreign product form data saved on beforeunload")}catch(re){console.warn("Failed to save foreign product form data on beforeunload:",re)}},v=()=>{if(document.hidden)try{localStorage.setItem(C,JSON.stringify(r)),console.log(" [FORCE PERSIST] Foreign product form data saved on visibility change")}catch(re){console.warn("Failed to save foreign product form data on visibility change:",re)}},se=()=>{try{localStorage.setItem(C,JSON.stringify(r)),console.log(" [FORCE PERSIST] Foreign product form data saved on window blur")}catch(re){console.warn("Failed to save foreign product form data on window blur:",re)}};return window.addEventListener("beforeunload",Z),document.addEventListener("visibilitychange",v),window.addEventListener("blur",se),()=>{window.removeEventListener("beforeunload",Z),document.removeEventListener("visibilitychange",v),window.removeEventListener("blur",se)}},[r,C]),h.useEffect(()=>{_&&(localStorage.getItem(C)?(console.log(" [FORCE PERSIST] User changes exist, preserving foreign product form data"),xe()):Ee()),be();const Z=()=>{_&&P&&(console.log("Window focused - refreshing foreign product data..."),Ee())};return window.addEventListener("focus",Z),()=>{window.removeEventListener("focus",Z)}},[P]),h.useEffect(()=>{const Z=sessionStorage.getItem("selectedSupplier"),v=sessionStorage.getItem("openPriceModal");if(Z)try{const se=JSON.parse(Z);Q(re=>({...re,supplier:se.id,supplierName:se.name,supplierType:se.type})),sessionStorage.removeItem("selectedSupplier"),console.log(" Supplier selected from selection page:",se),v==="true"&&(sessionStorage.removeItem("openPriceModal"),setTimeout(()=>{p(!0),console.log(" Auto-opening price quote modal")},100))}catch(se){console.error(" Error parsing selected supplier:",se),sessionStorage.removeItem("selectedSupplier"),sessionStorage.removeItem("openPriceModal")}},[]),h.useEffect(()=>{var Z;console.log("PriceQuoteData changed:",{hasFile:!!A.quotationFile,fileName:(Z=A.quotationFile)==null?void 0:Z.name,supplierName:A.supplierName,price:A.price})},[A]);const be=async()=>{try{const[Z,v]=await Promise.all([rr.getAllSuppliers(),ir.getAllSuppliers()]);H(Z),G(v)}catch(Z){console.error("Error loading suppliers:",Z)}},xe=async()=>{try{console.log("Loading price quotes only for foreign product ID:",P);const Z=await nn.getForeignProductById(P);Z&&Z.priceQuotes&&Array.isArray(Z.priceQuotes)?(console.log("Loading price quotes for foreign product:",Z.name,Z.priceQuotes),console.log("Price quotes analysis:"),Z.priceQuotes.forEach((v,se)=>{console.log(`Quote ${se}:`,{id:v.id,supplierName:v.supplierName,price:v.price,hasId:!!v.id,keys:Object.keys(v)})}),X(Z.priceQuotes),setTimeout(()=>{N(Z.priceQuotes)},200)):console.log("No price quotes found for foreign product:",(Z==null?void 0:Z.name)||"Product not found")}catch(Z){console.error("Error loading price quotes only:",Z)}},Ee=async()=>{try{u(!0),console.log("Loading foreign product data for ID:",P);const Z=await nn.getForeignProductById(P);Z?(console.log("Foreign product found:",Z.name),i({name:Z.name||"",category:Z.category||"",description:Z.description||"",unit:Z.unit||"",price:Z.price||"",supplier:Z.supplier||"",stockQuantity:Z.stockQuantity||"",minimumStock:Z.minimumStock||"",importLicense:Z.importLicense||"",customsCode:Z.customsCode||"",origin:Z.origin||"",notes:Z.notes||"",active:Z.active!==void 0?Z.active:!0}),Z.priceQuotes&&Array.isArray(Z.priceQuotes)?(console.log("Loading price quotes for foreign product:",Z.name,Z.priceQuotes),console.log("Price quotes analysis:"),Z.priceQuotes.forEach((v,se)=>{console.log(`Quote ${se}:`,{id:v.id,supplierName:v.supplierName,price:v.price,hasId:!!v.id,keys:Object.keys(v)})}),X(Z.priceQuotes),setTimeout(()=>{N(Z.priceQuotes)},200)):console.log("No price quotes found for foreign product:",Z.name)):(console.error("Foreign product not found with ID:",P),o({submit:"      "}))}catch(Z){console.error("Error loading foreign product:",Z),o({submit:"     : "+Z.message})}finally{u(!1)}},Re=Z=>{const{name:v,value:se,type:re,checked:J}=Z.target,he={...r,[v]:re==="checkbox"?J:se};i(he);try{localStorage.setItem(C,JSON.stringify(he)),console.log(" [FORCE PERSIST] Foreign product form data saved to localStorage on every change")}catch(Se){console.warn("Failed to save foreign product form data to localStorage:",Se)}a[v]&&o(Se=>({...Se,[v]:""}))},fe=async Z=>{Z.preventDefault();const v=nn.validateForeignProductData(r);if(F.length===0&&(v.priceQuotes="      "),Object.keys(v).length>0){o(v);return}c(!0),o({});try{const se=await Bn.validateUniqueFields({name:r.name},_?P:null,_?"foreignproducts":null);if(Object.keys(se).length>0){o(se),c(!1);return}const re={...r,price:parseFloat(r.price)||0,stockQuantity:parseFloat(r.stockQuantity)||0,minimumStock:parseFloat(r.minimumStock)||0,priceQuotes:F,status:"active"};if(console.log("Saving foreign product with price quotes:",{name:re.name,priceQuotes:re.priceQuotes,priceQuotesCount:re.priceQuotes.length}),_){await nn.updateForeignProduct(P,re);const J=w();U("task",`${J.name}   `,`   : ${re.name}`)}else{await nn.addForeignProduct(re);const J=w();U("task",`${J.name}   `,`   : ${re.name}`)}try{localStorage.removeItem(C),console.log(" [FORCE PERSIST] Cleared foreign product form data from localStorage on successful save")}catch(J){console.warn("Failed to clear foreign product form data from localStorage:",J)}I("/foreign-products")}catch(se){o({submit:se.message})}finally{c(!1)}},Ve=()=>{I("/foreign-products")},$e=()=>{p(!0)},et=()=>{p(!1),B(null),Q({supplierType:"foreign",supplier:"",supplierName:"",date:"",price:"",shippingCost:"",quotationFile:null}),o(Z=>({...Z,fileUpload:""})),console.log("Modal closed and state reset")},ze=()=>{const Z=window.location.pathname,se=`/supplier-selection/${A.supplierType||"local"}?returnPath=${encodeURIComponent(Z)}&materialType=foreignProduct&materialId=${P||"new"}`;I(se)},tt=()=>{L(!1),D(null)},rt=Z=>{console.log("Supplier Name:",Z);try{console.log("Using already loaded foreign supplier data...");const v=te;console.log("Available foreign suppliers:",v.length),console.log("Foreign suppliers list:",v.map(re=>({id:re.id,name:re.name})));const se=v.find(re=>re.name===Z);console.log("Found supplier:",se?"YES":"NO"),se?(console.log("SUCCESS: Foreign supplier found:",se.name),console.log("Supplier data:",se),S(se),T(!0),console.log("Modal state should be true now"),setTimeout(()=>{console.log("Modal state check - showSupplierEditModal:",y),console.log("Modal state check - selectedSupplierToEdit:",x==null?void 0:x.name)},100)):(console.error("FOREIGN SUPPLIER NOT FOUND"),console.error("Looking for supplier name:",Z),console.error("Available suppliers:",v.map(re=>re.name)),v.length===0?(console.log("No suppliers loaded, triggering data reload..."),loadSuppliersData(),k("    .   ...","  ")):k(`     : ${Z}`,"  "))}catch(v){console.error("=== FOREIGN SUPPLIER SEARCH ERROR ==="),console.error("Error details:",v),console.error("Error message:",v.message),k(`     : ${v.message}`,"  ")}},bt=()=>{console.log("Called by:",new Error().stack),T(!1),S(null)},At=Z=>{D(Z)},ns=()=>{R&&Q(Z=>{var se,re;console.log("Before supplier selection - preserving file:",(se=Z.quotationFile)==null?void 0:se.name);const v={...Z,supplier:R.id,supplierName:R.name};return console.log("After supplier selection - file preserved:",(re=v.quotationFile)==null?void 0:re.name),v}),L(!1),D(null)},Ht=Z=>{console.log("File details:",{name:Z==null?void 0:Z.name,size:Z==null?void 0:Z.size,type:Z==null?void 0:Z.type,lastModified:Z==null?void 0:Z.lastModified}),a.fileUpload&&o(v=>({...v,fileUpload:""})),Q(v=>{var re;const se={...v,quotationFile:Z};return console.log("Updated priceQuoteData with file:",{hasFile:!!se.quotationFile,fileName:(re=se.quotationFile)==null?void 0:re.name}),se})},is=Z=>{const{name:v,value:se,type:re}=Z.target;re!=="file"&&Q(v==="supplierType"?J=>({...J,[v]:se,supplier:"",supplierName:""}):J=>({...J,[v]:se}))},Oe=async Z=>{if(Z.preventDefault(),console.log("Form element:",Z.target),console.log("Current priceQuoteData:",A),console.log("Editing quote ID:",q),!A.supplierName){o(J=>({...J,fileUpload:"   "}));return}if(!A.date){o(J=>({...J,fileUpload:"   "}));return}if(!A.price){o(J=>({...J,fileUpload:"  "}));return}if(A.shippingCost===""||A.shippingCost===null||A.shippingCost===void 0){o(J=>({...J,fileUpload:"   "}));return}if(parseFloat(A.shippingCost)<0){o(J=>({...J,fileUpload:"         "}));return}const v=new FormData(Z.target),se=v.get("quotationFile");console.log("File from form directly:",se),console.log("File from state:",A.quotationFile);const re=A.quotationFile||se;console.log("File to upload:",re),console.log("File upload details:",{exists:!!re,isFile:re instanceof File,name:re==null?void 0:re.name,size:re==null?void 0:re.size,type:re==null?void 0:re.type,lastModified:re==null?void 0:re.lastModified});try{if(c(!0),!q&&(!re||re.size===0))throw new Error("    ");let J=null;if(console.log("File upload analysis:",{hasFileInState:!!A.quotationFile,hasFileInForm:!!se,hasFileToUpload:!!re,fileType:typeof re,fileName:re==null?void 0:re.name,fileSize:re==null?void 0:re.size}),re&&typeof re!="string"&&re.size>0){console.log("Starting file upload:",re.name);try{Ss.validateFile(re,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}),console.log("File validation passed")}catch(he){throw console.error("File validation failed:",he),new Error(he.message)}console.log("Attempting file upload to Firebase...");try{const he=re.name.split(".").pop()||"pdf",Se=A.supplierName?`  ${A.supplierName}.${he}`:re.name;console.log("Uploading with custom name:",Se),J=await Ss.uploadFileWithCustomName(re,"quotations",Se),console.log("File uploaded successfully:",J)}catch(he){throw console.error("Firebase upload failed:",he),new Error(`   : ${he.message}`)}}else console.log("No valid file to upload:",{fileExists:!!re,isString:typeof re=="string",hasSize:(re==null?void 0:re.size)>0});if(q)console.log("Updating existing price quote with ID:",q),X(he=>{const Se=he.map(me=>me.id===q?{...me,supplierType:A.supplierType,supplier:A.supplier,supplierName:A.supplierName,date:A.date,price:A.price,shippingCost:A.shippingCost,totalPrice:(parseFloat(A.price)||0)+(parseFloat(A.shippingCost)||0),quotationFile:J?J.path:me.quotationFile,quotationFileURL:J?J.url:me.quotationFileURL,quotationFileName:J?J.originalName:me.quotationFileName,quotationFileSize:J?J.size:me.quotationFileSize,quotationFileType:J?J.type:me.quotationFileType,updatedAt:new Date}:me);return console.log("Updated price quotes:",Se),setTimeout(()=>{N(Se)},100),Se});else{const he={id:Date.now().toString(),supplierType:A.supplierType,supplier:A.supplier,supplierName:A.supplierName,date:A.date,price:A.price,shippingCost:A.shippingCost,totalPrice:(parseFloat(A.price)||0)+(parseFloat(A.shippingCost)||0),quotationFile:J?J.path:null,quotationFileURL:J?J.url:null,quotationFileName:J?J.originalName:null,quotationFileSize:J?J.size:null,quotationFileType:J?J.type:null,createdAt:new Date};console.log("Adding new price quote:",he),X(Se=>{const me=[...Se,he];return console.log("Updated price quotes:",me),setTimeout(()=>{N(me)},100),me})}a.priceQuotes&&o(he=>({...he,priceQuotes:""})),et(),_&&P&&setTimeout(async()=>{try{console.log("Auto-saving foreign product after price quote change..."),X(he=>{const Se={...v,priceQuotes:he};return nn.updateForeignProduct(P,Se).then(()=>{console.log("Auto-save successful")}).catch(me=>{console.error("Auto-save failed:",me),k("   ","  ")}),he})}catch(he){console.error("Auto-save setup error:",he)}},200)}catch(J){console.error("Error uploading file:",J),o(he=>({...he,fileUpload:J.message||"   .   ."}))}finally{c(!1)}},it=Z=>{console.log("Starting edit for quote:",Z),B(Z.id),Q({supplierType:Z.supplierType||"local",supplier:Z.supplier||"",supplierName:Z.supplierName||"",date:Z.date||"",price:Z.price||"",shippingCost:Z.shippingCost||"",quotationFile:Z.quotationFile||null}),p(!0)},Kt=Z=>{if(console.log("Price quote delete button clicked:",Z),console.log("Quote ID:",Z==null?void 0:Z.id),console.log("Quote keys:",Z?Object.keys(Z):"quote is null/undefined"),!Z||!Z.id){console.error("Invalid quote object - missing quote or ID:",{quote:Z,hasId:!!(Z!=null&&Z.id),quoteId:Z==null?void 0:Z.id,quoteType:typeof Z}),k("    ","");return}b(`      

${Z.supplierName} - ${Z.price} `,()=>zs(Z),"   ")},zs=async Z=>{if(console.log("Delete confirmation called for quote:",Z),console.log("Confirmation - Quote ID:",Z==null?void 0:Z.id),console.log("Confirmation - Quote keys:",Z?Object.keys(Z):"quote is null/undefined"),console.log("Is editing mode:",_),console.log("Foreign product ID:",P),console.log("Form data name:",r.name),!Z||!Z.id){console.error("Invalid quote in confirmation - missing quote or ID:",{quote:Z,hasId:!!(Z!=null&&Z.id),quoteId:Z==null?void 0:Z.id,quoteType:typeof Z}),k("    ",""),Y(!1);return}try{if(Y(!0),console.log("Starting delete process..."),console.log("Moving to trash..."),_&&P){const se={...Z,foreignProductId:P,foreignProductName:r.name};console.log("Quote with context for trash:",se),console.log("Calling SimpleTrashService.moveToTrash...");const re=await bs.moveToTrash(se,"price_quotes");console.log("Trash service result:",re),console.log("Moved to trash successfully")}else console.log("Skipping trash - foreign product not saved yet (isEditing:",_,", id:",P,")");const v=w();console.log("Logging activity with current user:",v),U("task",`${v.name}   `,`   : ${Z.supplierName} - ${Z.price} `),console.log("Updating local state..."),console.log("Current price quotes before deletion:",F),X(se=>{const re=se.filter(J=>J.id!==Z.id);return console.log("Filtered quotes:",re.length,"from",se.length),console.log("Removed quote with ID:",Z.id),console.log("Remaining quotes:",re.map(J=>({id:J.id,supplierName:J.supplierName}))),setTimeout(()=>{N(re)},100),re}),console.log("Showing success message..."),_&&P?E(`    : ${Z.supplierName}`,"  "):E(`   : ${Z.supplierName}`," "),console.log("Delete process completed successfully"),_&&P&&setTimeout(async()=>{try{console.log("Auto-saving foreign product after price quote deletion..."),X(se=>{const re={...r,priceQuotes:se};return nn.updateForeignProduct(P,re).then(()=>{console.log("Auto-save after deletion successful")}).catch(J=>{console.error("Auto-save after deletion failed:",J)}),se})}catch(se){console.error("Auto-save after deletion setup error:",se)}},200)}catch(v){console.error("Error deleting price quote:",v),console.error("Error stack:",v.stack),k(`    : ${v.message||"  "}`,"  ")}finally{console.log("Setting deleting to false"),Y(!1)}},xs=()=>(A.supplierType==="local"?$:te).filter(se=>{const re=se.hasOwnProperty("active"),J=se.hasOwnProperty("status");return re?se.active===!0:J?se.status==="active":!0});return d?t.jsx(It,{show:!0,message:"    ..."}):t.jsxs(Ft,{children:[t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:pe}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!s?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{style:{position:"sticky",top:0,zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsx("a",{href:"/foreign-products",className:"text-decoration-none text-primary",children:" "})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsx("a",{href:"/foreign-products",className:"text-decoration-none text-primary",children:" "})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:_?"  ":"   "})]})})}),t.jsxs("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:[t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"60px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsxs("div",{className:"card-header bg-white border-bottom py-4 d-flex align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),_?"  ":"   "]}),t.jsx("div",{style:{flex:1}}),t.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:$e,disabled:!ye,title:ye?"   ":"     ",style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:"1",paddingTop:"2px"},children:" "})]}),t.jsxs("form",{onSubmit:fe,children:[t.jsxs("div",{className:"card-body p-4",children:[a.submit&&t.jsxs("div",{className:"alert alert-danger",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.submit]}),t.jsxs("div",{className:"row mb-4",children:[t.jsx("div",{className:"col-12",children:t.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[t.jsx("i",{className:"bi bi-info-circle me-2"})," "]})}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:"   *"}),t.jsx("input",{type:"text",className:`form-control ${a.name?"is-invalid":""}`,name:"name",value:r.name,onChange:Re,placeholder:"   "}),a.name&&t.jsx("div",{className:"invalid-feedback",children:a.name})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:" *"}),t.jsx(Hf,{name:"category",value:r.category,onChange:Re,required:!0,className:`form-select ${a.category?"is-invalid":""}`,placeholder:" ",showDescription:!0}),a.category&&t.jsx("div",{className:"invalid-feedback",children:a.category})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:" *"}),t.jsx(Qf,{name:"unit",value:r.unit,onChange:Re,required:!0,className:`form-select ${a.unit?"is-invalid":""}`,placeholder:" ",showDescription:!0}),a.unit&&t.jsx("div",{className:"invalid-feedback",children:a.unit})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsxs("label",{className:"form-label fw-bold",children:[" () *",t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:F.length>0?"  ":" "})]}),t.jsx("input",{type:"number",step:"0.01",min:"0",className:`form-control ${a.price?"is-invalid":""}`,name:"price",value:r.price,onChange:null,onKeyPress:null,placeholder:"0.00",readOnly:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"}}),a.price&&t.jsx("div",{className:"invalid-feedback",children:a.price}),t.jsx("div",{className:"mt-1",children:t.jsxs("small",{className:"text-muted",children:[t.jsx("i",{className:"bi bi-info-circle me-1"}),F.length>0?"        ":"       "]})})]}),t.jsxs("div",{className:"col-md-12 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:""}),t.jsx("textarea",{className:"form-control",name:"description",value:r.description,onChange:Re,rows:"3",placeholder:"  "})]}),t.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("span",{className:`badge ${r.active?"bg-success":"bg-secondary"} px-3 py-2`,children:r.active?"":" "}),t.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"foreignProductActiveSwitch",name:"active",checked:r.active,onChange:Re,style:{width:"48px",height:"24px",marginRight:"8px"}})]})})]}),t.jsxs("div",{className:"row mb-4",children:[t.jsxs("div",{className:"col-12",children:[t.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[t.jsx("i",{className:"bi bi-receipt me-2"})," "]}),a.priceQuotes&&t.jsxs("div",{className:"alert alert-danger",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.priceQuotes]})]}),F.length>0&&t.jsx("div",{className:"col-12",children:t.jsxs("div",{className:"card mb-3 border-0 shadow-lg",style:{background:"linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%)",borderRadius:"16px"},children:[t.jsx("div",{className:"card-header border-0",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"16px 16px 0 0",padding:"20px"},children:t.jsxs("h5",{className:"card-title text-white mb-0 d-flex align-items-center",children:[t.jsx("div",{className:"me-3",style:{background:"rgba(255,255,255,0.2)",borderRadius:"12px",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx("i",{className:"bi bi-bar-chart-fill fs-5"})}),t.jsx("span",{className:"fw-bold",children:"  "}),t.jsxs("span",{className:"badge bg-light text-primary ms-3",style:{borderRadius:"20px",fontSize:"12px",padding:"6px 12px"},children:[F.length," "]})]})}),t.jsx("div",{className:"card-body",style:{padding:"30px"},children:t.jsx("div",{style:{minHeight:"675px",direction:"ltr"},children:t.jsxs("div",{style:{width:"100%",height:"655px",position:"relative"},children:[t.jsx("style",{dangerouslySetInnerHTML:{__html:`
                                        g[class*="hover-group-"]:hover .hover-supplier-name {
                                          opacity: 1 !important;
                                          transition: opacity 0.3s ease-in-out;
                                        }
                                        .hover-supplier-name {
                                          transition: opacity 0.3s ease-in-out;
                                        }
                                        g[class*="hover-group-"] {
                                          cursor: pointer;
                                        }
                                      `}}),(()=>{F.map(he=>parseFloat(he.price)||0);const Z=640,re=F.length*150,J=Math.max(Z,re);return t.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${J+160} 655`,style:{direction:"ltr"},children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"chartBgForeign",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#ffffff",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#f8f9ff",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"bestPriceGradientForeign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#00f5a0",stopOpacity:1}}),t.jsx("stop",{offset:"30%",style:{stopColor:"#00d9f5",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#0066cc",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"regularPriceGradientForeign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),t.jsx("stop",{offset:"50%",style:{stopColor:"#764ba2",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#f093fb",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient0Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#764ba2",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient1Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#f093fb",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#f5576c",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient2Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#4facfe",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#00f2fe",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient3Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#a8edea",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#fed6e3",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient4Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#ffecd2",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#fcb69f",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient5Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#a18cd1",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#fbc2eb",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient6Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#fad0c4",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#ffd1ff",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"gradient7Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#a1c4fd",stopOpacity:1}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#c2e9fb",stopOpacity:1}})]}),t.jsxs("linearGradient",{id:"metallicShineForeign",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),t.jsx("stop",{offset:"45%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),t.jsx("stop",{offset:"50%",style:{stopColor:"rgba(255,255,255,0.8)",stopOpacity:1}}),t.jsx("stop",{offset:"55%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),t.jsx("stop",{offset:"100%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}})]}),t.jsx("filter",{id:"dropShadowForeign",x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feDropShadow",{dx:"0",dy:"6",stdDeviation:"8",floodColor:"rgba(0,0,0,0.15)"})}),t.jsxs("filter",{id:"premiumGlowForeign",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"5",result:"coloredBlur"}),t.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0 0 0  0 1 1 0 0  0 0 1 0 0  0 0 0 1 0"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("filter",{id:"bevelEffectForeign",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2",result:"blur"}),t.jsx("feSpecularLighting",{in:"blur",result:"specOut",surfaceScale:"5",specularConstant:"0.8",specularExponent:"20","lighting-color":"white",children:t.jsx("fePointLight",{x:"-50",y:"-50",z:"200"})}),t.jsx("feComposite",{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut2"}),t.jsx("feComposite",{in:"SourceGraphic",in2:"specOut2",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"})]}),t.jsxs("filter",{id:"pulseGlowForeign",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),t.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0.8 0 0  0 1 1 0 0  0 0 1 0.2 0  0 0 0 1 0"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),t.jsx("rect",{width:J+160,height:"655",fill:"url(#chartBgForeign)",rx:"12",style:{filter:"drop-shadow(0 4px 20px rgba(0,0,0,0.1))"}}),t.jsx("g",{transform:"translate(80, 40)",children:(()=>{const he=F.map(mt=>{const pt=parseFloat(mt.price)||0,Ye=parseFloat(mt.shippingCost)||0;return pt+Ye}),Se=Math.max(...he),me=Math.min(...he);F.map(mt=>parseFloat(mt.price)||0);const ge=Se-me||1,ke=350,Ie=640,Ne=F.length*150,we=Math.max(Ie,Ne),_e=Math.min(we/F.length*.6,80),Ge=we/F.length;return t.jsxs(t.Fragment,{children:[[0,1,2,3,4,5].map(mt=>{const Ye=150+(ke-150)/5*mt,je=(1-mt/5)*Math.max(...he);return t.jsxs("g",{children:[t.jsx("line",{x1:"0",y1:Ye,x2:we,y2:Ye,stroke:mt===5?"#007bff":"rgba(123, 140, 252, 0.2)",strokeWidth:mt===5?"2":"1",strokeDasharray:mt===5?"0":"5,5"}),t.jsx("text",{x:"-15",y:Ye+5,textAnchor:"end",fontSize:"12",fill:"#4f46e5",fontWeight:"600",children:Math.round(je).toLocaleString()})]},mt)}),F.map((mt,pt)=>{const Ye=parseFloat(mt.price)||0,Yt=parseFloat(mt.shippingCost)||0,je=Ye+Yt;let Fe;if(ge>0){const ot=ke-150,Je=je/Math.max(...he);Fe=Math.max(Je*ot,15)}else Fe=(ke-150)*.8;const De=Ge*pt+(Ge-_e)/2,Ze=150+(ke-150)-Fe,at=je===me;let dt;return at?dt="bestPriceGradientForeign":dt=`gradient${pt%8}Foreign`,t.jsxs("g",{className:at?"":`hover-group-${pt}`,children:[t.jsx("rect",{x:De+4,y:Ze+8,width:_e,height:Fe,fill:"rgba(0,0,0,0.05)",rx:"10"}),t.jsx("rect",{x:De+2,y:Ze+4,width:_e,height:Fe,fill:"rgba(0,0,0,0.08)",rx:"9"}),t.jsxs("rect",{x:De,y:Ze,width:_e,height:Fe,fill:`url(#${dt})`,rx:"10",filter:at?"url(#premiumGlowForeign)":"url(#bevelEffectForeign)",style:{transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer"},children:[t.jsx("animate",{attributeName:"height",from:"0",to:Fe,dur:"2s",begin:`${pt*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),t.jsx("animate",{attributeName:"y",from:ke,to:Ze,dur:"2s",begin:`${pt*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),at&&t.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;1.05;1",dur:"3s",repeatCount:"indefinite",begin:`${pt*.3+2}s`})]}),t.jsx("rect",{x:De+2,y:Ze+2,width:_e-4,height:Math.max(Fe/2.5,30),fill:"url(#metallicShineForeign)",rx:"8",opacity:"0.6",children:t.jsx("animateTransform",{attributeName:"transform",type:"translate",values:`-${_e};${_e}`,dur:"4s",repeatCount:"indefinite",begin:`${pt*.5+3}s`})}),t.jsx("rect",{x:De+3,y:Ze+3,width:Math.max(_e/4,8),height:Math.max(Fe-6,20),fill:"rgba(255,255,255,0.4)",rx:"6"}),t.jsx("rect",{x:De+_e-6,y:Ze+6,width:"3",height:Math.max(Fe-12,15),fill:"rgba(255,255,255,0.2)",rx:"1.5"}),t.jsxs("g",{children:[t.jsx("rect",{x:De+_e/2-30,y:Ze-28,width:"60",height:"20",fill:"rgba(0,0,0,0.8)",rx:"10",opacity:"0.9"}),t.jsxs("text",{x:De+_e/2,y:Ze-15,textAnchor:"middle",fontSize:"12",fill:"white",fontWeight:"bold",children:[". ",Ye.toLocaleString()]})]}),at&&t.jsx("g",{children:(()=>{const ot=mt.supplierName,Je=ot.length*7,ft=Math.max(Je+20,_e+10);return t.jsxs(t.Fragment,{children:[t.jsx("rect",{x:De+_e/2-ft/2,y:ke+30,width:ft,height:22,fill:"rgba(255,255,255,0.96)",rx:"11",stroke:"rgba(0,123,255,0.5)",strokeWidth:"1.5",filter:"url(#dropShadowForeign)"}),t.jsx("text",{x:De+_e/2,y:ke+41,textAnchor:"middle",fontSize:"11",fill:"#1e40af",fontWeight:"700",style:{fontFamily:"system-ui, -apple-system, sans-serif",letterSpacing:"0.2px"},dominantBaseline:"middle",children:ot})]})})()}),!at&&t.jsx("g",{opacity:"0",className:"hover-supplier-name",style:{pointerEvents:"none"},children:(()=>{const ot=mt.supplierName,Je=ot.length*7,ft=Math.max(Je+20,_e+10);return t.jsxs(t.Fragment,{children:[t.jsx("rect",{x:De+_e/2-ft/2,y:ke+30,width:ft,height:22,fill:"rgba(255,255,255,0.96)",rx:"11",stroke:"rgba(0,123,255,0.5)",strokeWidth:"1.5",filter:"url(#dropShadowForeign)"}),t.jsx("text",{x:De+_e/2,y:ke+41,textAnchor:"middle",fontSize:"11",fill:"#1e40af",fontWeight:"700",style:{fontFamily:"system-ui, -apple-system, sans-serif",letterSpacing:"0.2px"},dominantBaseline:"middle",children:ot})]})})()}),at&&t.jsxs("g",{children:[t.jsx("circle",{cx:De+_e/2,cy:Ze-100,r:"18",fill:"linear-gradient(135deg, #ffd700 0%, #ffb300 100%)",stroke:"#fff",strokeWidth:"3",filter:"url(#dropShadowForeign)"}),t.jsx("text",{x:De+_e/2,y:Ze-95,textAnchor:"middle",fontSize:"16",fill:"#fff",children:""}),t.jsx("rect",{x:De-5,y:Ze-70,width:_e+10,height:"20",fill:"#28a745",rx:"10",opacity:"0.9"}),t.jsx("text",{x:De+_e/2,y:Ze-57,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:" "})]})]},mt.id)}),t.jsx("text",{x:we/2,y:20,textAnchor:"middle",fontSize:"18",fill:"url(#bestPriceGradientForeign)",fontWeight:"bold",direction:"rtl",children:"   "}),t.jsxs("g",{transform:`translate(${we/2}, ${ke+110})`,children:[t.jsx("rect",{x:"-200",y:"-25",width:"400",height:"145",fill:"rgba(255,255,255,0.98)",rx:"20",stroke:"url(#bestPriceGradientForeign)",strokeWidth:"2",filter:"url(#dropShadowForeign)"}),t.jsx("text",{x:"0",y:"-5",textAnchor:"middle",fontSize:"16",fill:"#1f2937",fontWeight:"800",letterSpacing:"0.5px",children:" "}),t.jsxs("g",{transform:"translate(0, 15)",children:[t.jsxs("g",{transform:"translate(-125, 0)",children:[t.jsxs("g",{transform:"translate(0, 0)",children:[t.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#bestPriceGradientForeign)",rx:"7",filter:"url(#premiumGlowForeign)"}),t.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#059669",fontWeight:"700",children:" "}),t.jsx("text",{x:"80",y:"13",fontSize:"18",children:""})]}),t.jsx("line",{x1:"110",y1:"-5",x2:"110",y2:"19",stroke:"rgba(0,0,0,0.15)",strokeWidth:"2"}),t.jsxs("g",{transform:"translate(125, 0)",children:[t.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#regularPriceGradientForeign)",rx:"7"}),t.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#6366f1",fontWeight:"700",children:" "}),t.jsx("text",{x:"90",y:"13",fontSize:"16",children:""})]})]}),t.jsxs("g",{transform:"translate(0, 40)",children:[t.jsx("rect",{x:"-170",y:"-8",width:"340",height:"22",fill:"rgba(59, 130, 246, 0.08)",rx:"11"}),t.jsxs("text",{x:"0",y:"5",textAnchor:"middle",fontSize:"14",fill:"#1e40af",fontWeight:"700",children:["    : ",(Math.max(...he)-Math.min(...he)).toLocaleString()," ."]})]}),t.jsx("g",{transform:"translate(0, 90)",children:t.jsxs("text",{x:"0",y:"0",textAnchor:"middle",fontSize:"12",fill:"#6b7280",fontWeight:"600",children:["   : ",Math.max(...he).toLocaleString()," .       : ",Math.min(...he).toLocaleString()," ."]})})]})]})]})})()})]})})()]})})})]})}),t.jsx("div",{className:"col-12",style:{position:"sticky",top:"0",zIndex:9999,backgroundColor:"rgba(255, 255, 255, 0.98)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",boxShadow:"0 2px 20px rgba(0, 0, 0, 0.1)",borderRadius:"8px",margin:"10px 0"},children:t.jsxs("div",{className:"card shadow-lg",style:{border:"2px solid #007bff",borderRadius:"12px"},children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsx("div",{className:"d-flex justify-content-between align-items-center",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-list-ul text-primary me-2"}),"   (",F.length,")"]})})}),t.jsx("div",{className:"card-body p-0",children:F.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-receipt fs-1"})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:"      "})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:"60px"},children:"#"}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" ()"}),t.jsx("th",{className:"text-center",children:" ()"}),t.jsx("th",{className:"text-center",children:" ()"}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",style:{width:"120px"},children:""})]})}),t.jsx("tbody",{children:F.map((Z,v)=>{const se=F.length>=1&&F.reduce((re,J)=>{const he=(parseFloat(re.price)||0)+(parseFloat(re.shippingCost)||0);return(parseFloat(J.price)||0)+(parseFloat(J.shippingCost)||0)<he?J:re}).id===Z.id;return t.jsxs("tr",{className:se?"table-success":"",children:[t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:v+1})}),t.jsxs("td",{className:"text-center",children:[t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},onClick:re=>{re.preventDefault(),re.stopPropagation(),console.log("Button clicked, calling handleSupplierEdit..."),rt(Z.supplierName)},title:` : ${Z.supplierName}`,type:"button",children:Z.supplierName}),se&&t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:`badge ${Z.supplierType==="local"?"bg-success":"bg-info"}`,children:Z.supplierType==="local"?"":""})}),t.jsx("td",{className:"text-center",children:Z.date}),t.jsxs("td",{className:"text-center",children:[Z.price," "]}),t.jsxs("td",{className:"text-center",children:[Z.shippingCost||"0"," "]}),t.jsxs("td",{className:"text-center",children:[t.jsxs("span",{className:"fw-bold text-primary",children:[(parseFloat(Z.totalPrice)||(parseFloat(Z.price)||0)+(parseFloat(Z.shippingCost)||0)).toFixed(2)," "]}),se&&t.jsx("i",{className:"bi bi-arrow-down-circle-fill text-success ms-2",title:"  "})]}),t.jsx("td",{className:"text-center",children:Z.quotationFile&&t.jsx(Ad,{size:25,clickable:!0,onClick:()=>{Kr(3e4),Z.quotationFileURL?window.open(Z.quotationFileURL,"_blank"):(console.log("No file URL available for:",Z.quotationFile),alert("   "))},title:` : ${Z.quotationFileName||Z.quotationFile}`})}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(Tt,{can:"products:update",mode:"disable",children:t.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>it(Z),title:"",children:t.jsx("i",{className:"bi bi-pencil"})})}),t.jsx(Tt,{can:"products:delete",mode:"disable",children:t.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>Kt(Z),title:"",children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},Z.id)})})]})})})]})})]})]}),t.jsx("div",{className:"card-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:t.jsxs("div",{className:"d-flex gap-3",style:{marginBottom:"15px"},children:[t.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:Ve,disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""}),t.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:l?" ...":t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-check-lg me-1"}),_?"":""]})})]})})]})]})}),t.jsx("div",{className:"app-footer",style:{textAlign:"center",padding:"20px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",marginTop:"20px"},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]})]}),!n&&s&&t.jsx(os,{rtl:!0}),!n&&s&&t.jsx(ls,{}),f&&t.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:99990},tabIndex:"-1",children:t.jsx("div",{className:"modal-dialog modal-lg",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[t.jsxs("div",{className:"modal-header border-0 pb-2",children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-receipt text-primary me-2"}),"  "]}),t.jsx("button",{type:"button",className:"btn-close",onClick:et,style:{fontSize:"12px"}})]}),t.jsxs("form",{onSubmit:Oe,onReset:Z=>Z.preventDefault(),children:[t.jsxs("div",{className:"modal-body px-4",children:[a.fileUpload&&t.jsxs("div",{className:"alert alert-danger mb-3",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.fileUpload]}),t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:"  *"}),t.jsx("select",{className:"form-select",name:"supplierType",value:A.supplierType,onChange:is,required:!0,disabled:!0,children:t.jsx("option",{value:"foreign",children:" "})})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:" *"}),t.jsxs("div",{className:"form-control d-flex align-items-center justify-content-between",onClick:ze,style:{cursor:"pointer",backgroundColor:"#f8f9fa"},children:[t.jsx("span",{className:A.supplierName?"text-dark":"text-muted",children:A.supplierName||" "}),t.jsx("i",{className:"bi bi-chevron-down"})]})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:"  *"}),t.jsx("input",{type:"date",className:"form-control",name:"date",value:A.date,onChange:is,required:!0})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:" () *"}),t.jsx("input",{type:"number",step:"0.01",min:"0",className:"form-control",name:"price",value:A.price,onChange:is,onKeyPress:Z=>{(Z.key==="-"||Z.key!=="."&&Z.key!=="Backspace"&&(Z.key<"0"||Z.key>"9"))&&Z.preventDefault()},placeholder:"0.00",required:!0})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:"  () *"}),t.jsx("input",{type:"number",step:"0.01",min:"0",className:"form-control",name:"shippingCost",value:A.shippingCost,onChange:is,onKeyPress:Z=>{(Z.key==="-"||Z.key!=="."&&Z.key!=="Backspace"&&(Z.key<"0"||Z.key>"9"))&&Z.preventDefault()},placeholder:"0.00",required:!0})]}),t.jsx("div",{className:"col-md-12 mb-3",children:t.jsxs("div",{className:"alert alert-info py-2",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-calculator text-info me-2"}),t.jsx("span",{className:"fw-bold",children:" : "}),t.jsxs("span",{className:"ms-2 text-primary fw-bold",children:[((parseFloat(A.price)||0)+(parseFloat(A.shippingCost)||0)).toFixed(2)," "]})]}),t.jsxs("small",{className:"text-muted",children:[t.jsx("i",{className:"bi bi-info-circle me-1"})," (",(parseFloat(A.price)||0).toFixed(2),") +  (",(parseFloat(A.shippingCost)||0).toFixed(2),")"]})]})}),t.jsxs("div",{className:"col-md-12 mb-3",children:[t.jsxs("label",{className:"form-label fw-bold",children:["   ",q?"()":"*"]}),t.jsxs("div",{className:"mb-2",children:[t.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.jpg,.png,.jpeg",style:{display:"none"},ref:Z=>{Z&&(Z.onclick=()=>{Z.value=""},Z.onchange=v=>{var re;const se=(re=v.target.files)==null?void 0:re[0];se&&Ht(se)})},id:`fileInput_${f}_${Date.now()}`}),t.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>{console.log(" Foreign Product price quote upload button clicked"),console.log(" FOREIGN PRODUCT MODAL: Starting fullscreen bypass for file picker"),Kr(2e4);const Z=document.querySelector(`#fileInput_${f}_${Date.now()}`);if(Z)Z.click();else{const v=document.createElement("input");v.type="file",v.accept=".pdf,.doc,.docx,.jpg,.png,.jpeg",v.style.display="none",v.onchange=se=>{var J;const re=(J=se.target.files)==null?void 0:J[0];re&&Ht(re),document.body.removeChild(v)},document.body.appendChild(v),v.click()}},style:{borderRadius:"6px",height:"38px",minWidth:"150px"},children:[t.jsx("i",{className:"bi bi-upload me-2"})," "]})]}),A.quotationFile&&t.jsxs("div",{className:"alert alert-success py-2 mb-2",style:{position:"relative"},children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-check-circle me-2 text-success"}),t.jsxs("div",{className:"flex-grow-1",children:[t.jsx("strong",{children:A.quotationFile.name?A.supplierName?`  ${A.supplierName}.${A.quotationFile.name.split(".").pop()}`:A.quotationFile.name:q?A.supplierName?`  ${A.supplierName}.pdf`:((cs=F.find(Z=>Z.id===q))==null?void 0:cs.quotationFileName)||" ":" "}),t.jsxs("small",{className:"text-muted ms-2",children:["(",A.quotationFile.size?Math.round(A.quotationFile.size/1024):q?Math.round((((Os=F.find(Z=>Z.id===q))==null?void 0:Os.quotationFileSize)||0)/1024):0," KB)"]})]})]}),t.jsx("button",{type:"button",className:"btn-close btn-close-sm",onClick:()=>{Q(Z=>({...Z,quotationFile:null}))},title:" ",style:{position:"absolute",top:"8px",left:"8px",width:"20px",height:"20px",fontSize:"10px",opacity:.7},onMouseEnter:Z=>Z.target.style.opacity=1,onMouseLeave:Z=>Z.target.style.opacity=.7})]}),q&&!A.quotationFile&&t.jsxs("div",{className:"alert alert-info py-2 mb-2",children:[t.jsx("i",{className:"bi bi-info-circle me-2"}),t.jsxs("small",{children:[" : ",((vs=F.find(Z=>Z.id===q))==null?void 0:vs.quotationFileName)||" "]})]}),!A.quotationFile&&!q&&t.jsx("div",{className:"mt-1",children:t.jsxs("small",{className:"text-muted",children:[t.jsx("i",{className:"bi bi-info-circle me-1"}),"   PDF  Word  "]})})]})]})]}),t.jsx("div",{className:"modal-footer border-0 pt-0 d-flex justify-content-center",style:{marginBottom:"10px"},children:t.jsxs("div",{className:"d-flex gap-3",children:[t.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:et,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""}),t.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:l||!ye,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:l?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"10px",height:"10px"}}),"..."]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-check-lg me-1"}),""]})})]})})]})]})})}),j&&t.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:99990},tabIndex:"-1",children:t.jsx("div",{className:"modal-dialog modal-xl",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[t.jsxs("div",{className:"modal-header border-0 pb-2",style:{marginBottom:"5px"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-people-fill text-primary me-2"}),A.supplierType==="local"?"  ":"  ",t.jsxs("span",{className:"text-muted ms-2",children:["(",xs().length,")"]})]}),t.jsx("button",{type:"button",className:"btn-close",onClick:tt,style:{fontSize:"12px"}})]}),t.jsx("div",{className:"modal-body p-0",children:xs().length>0?t.jsx("div",{className:"table-responsive suppliers-table",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"50px"}}),t.jsx("th",{children:" "}),t.jsx("th",{children:" "}),t.jsx("th",{children:""}),t.jsx("th",{children:""})]})}),t.jsx("tbody",{children:xs().map(Z=>t.jsxs("tr",{onClick:()=>At(Z),style:{cursor:"pointer"},children:[t.jsx("td",{className:"text-center",children:t.jsx("div",{className:"form-check d-flex justify-content-center",children:t.jsx("input",{className:"form-check-input custom-radio",type:"radio",name:"selectedSupplier",checked:(R==null?void 0:R.id)===Z.id,onChange:()=>{},style:{pointerEvents:"none",width:"18px",height:"18px",borderWidth:"2px",borderColor:(R==null?void 0:R.id)===Z.id?"#007bff":"#dee2e6"}})})}),t.jsx("td",{children:t.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},children:Z.name})}),t.jsx("td",{children:t.jsx("a",{href:`mailto:${Z.email}`,className:"text-decoration-none",children:Z.email})}),t.jsx("td",{children:Z.phone}),t.jsx("td",{children:Z.city||"-"})]},Z.id))})]})}):t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-people fs-1"})}),t.jsx("h5",{className:"text-muted",children:"  "}),t.jsxs("p",{className:"text-muted",children:["  ",A.supplierType==="local"?" ":" "," "]})]})}),t.jsx("div",{className:"modal-footer border-0 d-flex justify-content-center",style:{marginTop:"15px"},children:t.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:ns,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",margin:"20px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:""})})]})})}),y&&x&&t.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:Z=>{Z.target===Z.currentTarget&&bt()},children:t.jsx("div",{className:"modal-dialog modal-lg",onClick:Z=>Z.stopPropagation(),children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[t.jsxs("div",{className:"modal-header border-0",children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"  - ",x==null?void 0:x.name,t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:""})]}),t.jsx("button",{type:"button",className:"btn-close",onClick:bt})]}),t.jsx("div",{className:"modal-body",children:t.jsxs("div",{className:"row g-3",children:[t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x==null?void 0:x.name})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:(x==null?void 0:x.email)||""})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:(x==null?void 0:x.phone)||""})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:(x==null?void 0:x.country)||""})]}),t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:(x==null?void 0:x.address)||""})]}),(x==null?void 0:x.taxNumber)&&t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.taxNumber})]}),(x==null?void 0:x.bankAccount)&&t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:"  "}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.bankAccount})]}),(x==null?void 0:x.notes)&&t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:x.notes})]})]})}),t.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:t.jsx("div",{className:"d-flex gap-3",children:t.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:bt,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""})})})]})})})]}),t.jsx(It,{show:l,message:_?"   ...":"   ..."}),t.jsx(Mt,{show:z.show,onClose:O,title:z.title,message:z.message,type:z.type,onConfirm:z.onConfirm,confirmText:z.confirmText,cancelText:z.cancelText,showCancel:z.showCancel}),t.jsx(Vh,{position:"bottom-right",showDetails:!0})]})}function Hj(){return t.jsx(Lt,{children:t.jsx(F$,{})})}const O$=({refreshTrigger:n,searchTerm:e})=>{const s=kt();console.log("ManufacturedProductsListFixed is rendering");const[r,i]=h.useState([]),[a,o]=h.useState(!0),[l,c]=h.useState(null),[d,u]=h.useState(""),f=e!==void 0?e:d,[p,j]=h.useState([]),[L,R]=h.useState(!1),[D,y]=h.useState(!1),{logActivity:T,getCurrentUser:x}=Zt(),{alertConfig:S,closeAlert:A,showSuccess:Q,showError:q,showConfirm:B}=Bt(),{currentPage:$,totalPages:H,paginatedItems:te,handlePageChange:G,resetPage:F,totalItems:X,itemsPerPage:ue}=cr(p,30);console.log("ManufacturedProductsListFixed state:",{productsCount:r.length,loading:a,error:l});const Y=async()=>{try{o(!0),c(null),console.log("Loading manufactured products...");const E=await ci.getAllManufacturedProducts();console.log("Manufactured products loaded:",E.length);const k=f$(E);i(k)}catch(E){console.error("Error loading manufactured products:",E),c(E.message||"    ")}finally{o(!1)}};h.useEffect(()=>{(async()=>{try{if(console.log(" [List] Initializing Firebase authentication..."),ut.currentUser){console.log(" [List] User already authenticated:",ut.currentUser.uid),y(!0);return}return T0(ut,async b=>{if(b)console.log(" [List] User authenticated:",b.uid),y(!0);else{console.log(" [List] No user found, attempting anonymous sign-in...");try{await BT(ut),console.log(" [List] Anonymous sign-in successful"),y(!0)}catch(N){console.error(" [List] Anonymous sign-in failed:",N),y(!1)}}})}catch(k){console.error(" [List] Auth initialization error:",k),c("   ")}})()},[]),h.useEffect(()=>{D&&Y()},[n,D]),h.useEffect(()=>{if(f.trim()){const E=r.filter(k=>{var b,N,I;return((b=k.title)==null?void 0:b.toLowerCase().includes(f.toLowerCase()))||((N=k.referenceNumber)==null?void 0:N.toLowerCase().includes(f.toLowerCase()))||((I=k.description)==null?void 0:I.toLowerCase().includes(f.toLowerCase()))});j(E)}else j(r);F()},[f,r,F]);const z=E=>{B(`       

${E.title}`,()=>O(E),"   ")},O=async E=>{try{R(!0),await bs.moveToTrash(E,"manufacturedProducts"),await ci.deleteManufacturedProduct(E.id);const k=x();T("task",`${k.name}   `,`   : ${E.title}`),Y(),Q(`    : ${E.title}`,"  ")}catch(k){console.error("Error deleting manufactured product:",k),q(`     : ${k.message}`,"  ")}finally{R(!1)}};return a?(console.log("ManufacturedProductsListFixed: Showing loading state"),t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"spinner-border text-primary",role:"status",children:t.jsx("span",{className:"visually-hidden",children:" ..."})}),t.jsx("p",{className:"mt-3 text-muted",children:"    ..."})]})})):l?(console.log("ManufacturedProductsListFixed: Showing error state:",l),t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:l}),t.jsx("div",{className:"d-flex gap-2 justify-content-center",children:t.jsxs("button",{className:"btn btn-primary",onClick:Y,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"  "]})})]})})):(console.log("ManufacturedProductsListFixed: Showing main content with",p.length,"products"),t.jsxs("div",{"data-list":"manufactured-products",children:[p.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-gear-wide-connected fs-1"})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:f?"    ":"      "}),!f&&t.jsxs("button",{className:"btn btn-primary",onClick:()=>s("/manufactured-products/add"),children:[t.jsx("i",{className:"bi bi-plus-lg me-1"}),"   "]})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",style:{width:"120px",paddingLeft:"40px"},children:""})]})}),t.jsx("tbody",{children:te.map((E,k)=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:($-1)*ue+k+1})}),t.jsx("td",{className:"text-center",children:t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary product-title-btn",onClick:()=>{E.id?s(`/manufactured-products/edit/${E.id}`):q("     ","  ")},style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0"},title:`  | Firebase ID: ${E.id||"Missing"}`,children:E.title})}),t.jsx("td",{className:"text-center",children:t.jsxs("span",{className:"badge bg-success text-white",children:[(()=>{let b=0;return E.items&&Array.isArray(E.items)&&E.items.length>0?b=E.items.reduce((N,I)=>N+(I.totalPrice||0),0):b=E.estimatedValue||0,b.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})})()," ."]})}),t.jsx("td",{className:"text-center",style:{paddingLeft:"40px"},children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(Tt,{can:"products:update",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-primary",onClick:()=>{if(!E||!E.id){q("     ","  ");return}s(`/manufactured-products/edit/${E.id}`)},title:"",children:t.jsx("i",{className:"bi bi-pencil"})})}),t.jsx(Tt,{can:"products:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>z(E),title:"",children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},E.internalId||E.id||`product-${k}`))})]})}),p.length>0&&t.jsx(dr,{currentPage:$,totalPages:H,onPageChange:G,totalItems:X,itemsPerPage:ue}),t.jsx(Mt,{show:S.show,onClose:A,title:S.title,message:S.message,type:S.type,onConfirm:S.onConfirm,showConfirm:S.showConfirm})]}))},M$=({searchTerm:n})=>{const[e,s]=h.useState(0),[r,i]=h.useState(0);h.useEffect(()=>{a()},[n]);const a=async()=>{try{const o=await ci.getAllManufacturedProducts();if(s(o.length),n!=null&&n.trim()){const l=o.filter(c=>{var d,u,f;return((d=c.title)==null?void 0:d.toLowerCase().includes(n.toLowerCase()))||((u=c.referenceNumber)==null?void 0:u.toLowerCase().includes(n.toLowerCase()))||((f=c.description)==null?void 0:f.toLowerCase().includes(n.toLowerCase()))});i(l.length)}else i(o.length)}catch(o){console.error("Error loading manufactured products count:",o),s(0),i(0)}};return t.jsx("span",{className:"badge bg-secondary ms-2",style:{fontSize:"12px",fontWeight:"normal"},children:n!=null&&n.trim()?`${r}  ${e}`:e})};function U$(){const[n,e]=h.useState(!1),[s,r]=h.useState(0),[i,a]=h.useState(""),{isTimelineVisible:o}=Ut(),l=kt(),c=()=>{e(!n)};return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:c}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!o?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"  "})]})}),t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"20px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:10,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-gear-wide-connected text-primary me-2"}),"  "]}),t.jsx(M$,{searchTerm:i})]}),t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:i,onChange:d=>a(d.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsx("button",{onClick:()=>l("/manufactured-products/add"),className:"btn btn-primary",style:{height:"40px",width:"140px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:" "})]})]})}),t.jsx("div",{style:{height:"calc(100vh - 280px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"card-body p-0",children:t.jsx(O$,{refreshTrigger:s,searchTerm:i})})})]})})]}),!n&&o&&t.jsx(os,{rtl:!0}),!n&&o&&t.jsx(ls,{})]})]})})})}function $$(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(U$,{})})})}const z$=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>Go),void 0)),V$=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>Wo),void 0)),B$=h.lazy(()=>Xe(()=>import("./ItemSelectionModal-1759246972099-D9DWDeE0.js"),[]));function G$(){const n=kt(),{id:e}=Dn(),{logActivity:s,getCurrentUser:r}=Zt(),{alertConfig:i,closeAlert:a,showSuccess:o,showError:l,showConfirm:c}=Bt(),{isTimelineVisible:d}=Ut(),{hasPerm:u,readOnly:f}=Yn(),p=!!e;u("products:create"),u("products:update"),u("products:delete");const[j,L]=h.useState(!1),[R,D]=h.useState({title:"",referenceNumber:"",description:"",submissionDeadline:"",estimatedValue:""}),[y,T]=h.useState({}),[x,S]=h.useState(!1),[A,Q]=h.useState(!1),[q,B]=h.useState(!1),[$,H]=h.useState(""),[te,G]=h.useState(!1),[F,X]=h.useState([]),[ue,Y]=h.useState(!1),[z,O]=h.useState(!1),[E,k]=h.useState(null),[b,N]=h.useState(""),[I,P]=h.useState(!1),[_,C]=h.useState([]),[U,w]=h.useState(""),W=h.useCallback(()=>{setTimeout(()=>w(""),3e3)},[]),[ie,de]=h.useState(!1),[ne,ye]=h.useState(null),[pe,be]=h.useState(null),[xe,Ee]=h.useState(!1),[Re,fe]=h.useState(!1);h.useEffect(()=>{(async()=>{try{if(Q(!0),console.log(" SENIOR REACT: Starting unified data initialization..."),e)console.log(" EDIT MODE: Skipping pending items check - will load from saved product");else{console.log(" NEW PRODUCT: Loading pending product items...");const ke=await Ke.getPendingData("pendingProductItems_new");ke&&Array.isArray(ke)&&ke.length>0?(console.log(" NEW PRODUCT: Found",ke.length,"pending items - SETTING STATE IMMEDIATELY"),console.log(" PENDING ITEMS DATA:",ke.map(Ie=>({id:Ie.internalId||Ie.materialInternalId,name:Ie.materialName||Ie.name||"UNNAMED"}))),C(ke),console.log(" Items loaded for new product mode:",ke.length),console.log(" NEW PRODUCT STATE SET: Items initialized with pending data")):console.log(" NEW PRODUCT: No pending items found")}if(e){console.log(" EDIT MODE: Starting - IDENTICAL to creation mode logic");const ke=await ci.getManufacturedProductById(e);if(!ke){console.error(" EDIT MODE: Product not found");return}console.log(" EDIT MODE: Product loaded:",ke.title);const Ie=await Ke.getPendingData(`productFormData_${e}`);if(Ie&&Object.keys(Ie).some(Ne=>Ie[Ne])){console.log(" EDIT MODE: Found saved form changes, using them");const Ne={...ke,...Ie};D(Ne)}else{console.log(" EDIT MODE: Using original product data");const Ne={...ke};if(Ne.submissionDeadline){let _e=Ne.submissionDeadline;_e&&typeof _e=="object"&&_e.seconds?_e=new Date(_e.seconds*1e3):_e&&typeof _e=="object"&&_e.toDate&&(_e=_e.toDate()),Ne.submissionDeadline=Rl(_e)}const we=await Ke.getPendingData(`productFormData_${e}`);we&&(console.log(" EDIT MODE: Found pending form changes, merging with product data"),Object.assign(Ne,we)),D(Ne)}ke.documents&&Array.isArray(ke.documents)&&X(ke.documents);const oe=await Ke.getPendingData(`pendingProductItems_${e}`);let Te=[];if(ke.items&&Array.isArray(ke.items)&&(console.log(" EDIT MODE: Found existing saved items:",ke.items.length),Te=[...ke.items]),oe&&oe.length>0){console.log(" EDIT MODE: Found pending items from material pages:",oe.length);const Ne=Te.map(_e=>_e.internalId||_e.materialInternalId||_e.id).filter(_e=>_e),we=oe.filter(_e=>{const Ge=_e.internalId||_e.materialInternalId||_e.id;return Ge&&!Ne.includes(Ge)});we.length>0?(console.log(" Adding new items to product:",we.length),Te=[...Te,...we]):console.log(" All pending items were duplicates, skipping"),await Ke.clearPendingData(`pendingProductItems_${e}`),console.log(" EDIT MODE: Cleared pending items after merging")}if(Te.length>0){console.log(" FINAL ITEMS LIST:",Te.map(we=>({internalId:we.internalId||we.materialInternalId,materialName:we.materialName||we.name,supplierInfo:we.supplierInfo,unitPrice:we.unitPrice,quantity:we.quantity,totalPrice:we.totalPrice}))),C(Te),console.log(" Items loaded for edit mode:",Te.length);const Ne=Te.reduce((we,_e)=>we+(_e.unitPrice||_e.price||0)*(_e.quantity||1),0);D(we=>({...we,estimatedValue:Ne.toString()})),console.log(" EDIT MODE STATE SET: Final items count:",Te.length)}else console.log(" EDIT MODE: No items to load")}else{console.log(" NEW PRODUCT MODE: Checking for saved form data...");const ke=await Ke.getPendingData("productFormData_new");ke?(console.log(" NEW PRODUCT: Restoring saved form data from previous session"),D(ke)):(console.log(" NEW PRODUCT: Starting with fresh empty form"),D({title:"",referenceNumber:"",description:"",submissionDeadline:"",estimatedValue:""}));const Ie=await Ke.getPendingData("productDocuments_new");Ie&&Array.isArray(Ie)?(console.log(" NEW PRODUCT: Restoring saved documents"),X(Ie)):X([]);const oe=await Ke.getPendingData("pendingProductItems_new");if(oe&&oe.length>0){console.log(" NEW PRODUCT: Found pending items, adding to form");const Te=await Ke.getPendingData("product_success_shown_new")==="true",Ne=_.length===0&&!Re&&!Te;C(oe);const we=oe.reduce((_e,Ge)=>_e+(Ge.unitPrice||0)*(Ge.quantity||1),0);if(we>0){console.log(` Updating estimated value from items: ${we}`);const _e={...ke||R,estimatedValue:we.toString()};D(_e),await Ke.setPendingData("productFormData_new",_e)}Ne?(fe(!0),await Ke.setPendingData("product_success_shown_new","true"),c(`  ${oe.length}    .

       .`,()=>{},"  ","","",!1)):console.log(" Success message skipped (items already exist or already shown)")}else C([]);console.log(" NEW PRODUCT: Form initialized with persistence")}console.log(" Data initialization completed")}catch(ke){console.error("Error initializing data:",ke),l("   ","")}finally{Q(!1)}})()},[e]),h.useEffect(()=>()=>{console.log(" COMPONENT UNMOUNT: Keeping pending items for next navigation")},[]);const Ve=h.useRef(!1),$e=h.useRef(Date.now()),et=async()=>{if(Ve.current){console.log(" loadPendingItems already running, skipping...");return}if(e&&_.length>0){console.log(" EDIT MODE: Skipping pending items load - already have saved product items");return}try{Ve.current=!0,console.log(" Loading pending product items from Firestore...");const ge=await Ke.getPendingData(`pendingProductItems_${e||"new"}`);if(ge){const ke=Array.isArray(ge)?ge:JSON.parse(ge);console.log(" Found pending product items:",ke.length,"items"),console.log(" STORAGE CONTENT:",ke.map(Ie=>({id:Ie.internalId||Ie.materialInternalId,name:Ie.materialName||Ie.name}))),C(Ie=>{console.log(" PROCESSING NEW ITEMS WITH SIMPLE DUPLICATE PREVENTION");const oe=[],Te=[];if(ke.forEach(_e=>{const Ge=(_e.materialName||_e.name||"").trim();if(!Ge){console.log(" Empty item name, skipping");return}Ie.some(pt=>(pt.materialName||pt.name||"").trim().toLowerCase()===Ge.toLowerCase())?(Te.push(Ge),console.log(" DUPLICATE DETECTED (name-based):",Ge)):oe.push(_e)}),Te.length>0){const _e=Te.length===1?`  "${Te[0]}"  `:` ${Te.length}   `;w(_e),W()}if(oe.length===0)return console.log(" No new items to add after duplicate filtering"),Ie;const Ne=[...Ie,...oe];console.log(" Added",oe.length,"new items, filtered",Te.length,"duplicates");const we=Ne.reduce((_e,Ge)=>_e+(Ge.unitPrice||0)*(Ge.quantity||1),0);return we>0&&D(_e=>({..._e,estimatedValue:we.toString()})),console.log(" SENIOR REACT STORAGE REPLACEMENT COMPLETED:",{prevItemsCount:Ie.length,storageItemsCount:ke.length,finalCount:Ne.length,replacementSuccess:"COMPLETE_REPLACEMENT_FROM_STORAGE"}),Ne}),setTimeout(()=>{C(Ie=>(console.log(" FORCE RE-RENDER: Ensuring UI reflects current items count:",Ie.length),[...Ie]))},100),console.log(" Items loaded and ready - keeping in storage until product is saved")}else{console.log(" No pending product items found in Firestore");const ke=await Ke.getPendingData(`productItems_${e||"new"}`);if(ke&&_.length===0)try{Array.isArray(ke)&&ke.length>0&&(console.log(" Loading existing product items from Firestore:",ke.length),C(ke))}catch(Ie){console.error("Error loading Firestore items:",Ie)}}}catch(ge){console.error("Error loading pending items:",ge)}finally{setTimeout(()=>{Ve.current=!1,console.log(" Released loadPendingItems lock after 3-second cooldown")},3e3)}};h.useEffect(()=>{const ge=()=>{console.log(" Custom event received - reloading items..."),et()},ke=Ie=>{console.log(" TRASH RESTORE: Product item restored from trash, reloading items...");const{productId:oe,restoredItem:Te}=Ie.detail||{};oe===(e||"new")?(console.log(" RESTORE FOR THIS PRODUCT: Reloading items for product",oe),et()):console.log(" RESTORE FOR OTHER PRODUCT: Ignoring restoration for product",oe)};return window.addEventListener("productItemsAdded",ge),window.addEventListener("productItemRestored",ke),()=>{window.removeEventListener("productItemsAdded",ge),window.removeEventListener("productItemRestored",ke)}},[]);const ze=h.useRef(!1);h.useEffect(()=>{const ke=setTimeout(async()=>{const Ie=Date.now()-$e.current,oe=Ie<5e3,Te=ze.current;if(console.log(" AUTO-SAVE TRIGGERED:",{itemsCount:_.length,isLoadingLocked:Ve.current,timeSinceMount:Ie,isRecentMount:oe,isDeletingOperation:Te,willSave:_.length>0&&!Ve.current&&!oe&&!Te}),_.length>0&&!Ve.current&&!oe&&!Te)try{await Ke.setPendingData(`pendingProductItems_${e||"new"}`,_,48),console.log(" SMART AUTO-SAVE: Saved product items to Firestore:",_.length,"items"),console.log(" AUTO-SAVE CONTENT:",_.map(Ne=>({id:Ne.internalId||Ne.materialInternalId,name:Ne.materialName||Ne.name})))}catch(Ne){console.error("Error saving product items:",Ne)}else Ve.current?console.log(" SMART AUTO-SAVE: Skipping save during item loading to prevent race condition"):oe?console.log(" SMART AUTO-SAVE: Skipping save - component recently mounted, allowing time for item loading"):Te?console.log(" SMART AUTO-SAVE: Skipping save during deletion operation to prevent restoring deleted items"):_.length===0&&console.log(" SMART AUTO-SAVE: Skipping save for empty items array")},4e3);return()=>clearTimeout(ke)},[_]),h.useEffect(()=>{const ke=setTimeout(async()=>{if(F.length>0)try{await Ke.setPendingData(`productDocuments_${e||"new"}`,F),console.log("Saved product documents to Firestore:",F.length,"documents")}catch(Ie){console.error("Error saving product documents:",Ie)}},2500);return()=>clearTimeout(ke)},[F,e]),h.useEffect(()=>{const ge=e||"new",ke=oe=>{const Te=`productDocuments_${ge}`;if(console.log(" Storage event detected:",{key:oe.key,expectedKey:Te,isMatch:oe.key===Te}),oe.key===Te&&oe.newValue)try{const Ne=JSON.parse(oe.newValue);console.log(" Restoring documents from storage event:",Ne.length),X(Ne);const we=Ne.filter(_e=>_e.restoredFrom==="trash").sort((_e,Ge)=>new Date(Ge.restoredAt||0)-new Date(_e.restoredAt||0))[0];if(we){const _e=r();s("file",`${_e.name}    `,` : ${we.fileName}`)}}catch(Ne){console.error("Error parsing restored documents:",Ne)}},Ie=oe=>{const{productId:Te,restoredDocument:Ne,allDocuments:we}=oe.detail;if(console.log(" Custom restore event detected:",{eventProductId:Te,currentProductId:ge,isMatch:Te===ge,documentName:Ne==null?void 0:Ne.fileName}),Te===ge){console.log(" Updating documents from custom event:",we.length),X([...we]);const _e=r();s("file",`${_e.name}    `,` : ${Ne.fileName}`)}};return window.addEventListener("storage",ke),window.addEventListener("productDocumentRestored",Ie),()=>{window.removeEventListener("storage",ke),window.removeEventListener("productDocumentRestored",Ie)}},[e,o,r,s]);const tt=h.useCallback(()=>{if(!_||_.length===0)return 0;const ge=_.reduce((ke,Ie)=>ke+(Ie.totalPrice||0),0);return console.log(" INSTANT: Reflecting pre-calculated total from items:",ge),ge},[_]),rt=h.useMemo(()=>tt()*.15,[tt]),bt=h.useMemo(()=>tt()+rt,[tt,rt]);h.useCallback(()=>{const ge=_.reduce((ke,Ie)=>ke+(Ie.totalPrice||0),0);return D(ke=>({...ke,estimatedValue:ge.toString()})),console.log(" CONTROLLED: Updated estimated value explicitly:",ge),ge},[_]),h.useEffect(()=>{const ke=setTimeout(async()=>{if(Object.keys(R).some(Ie=>R[Ie]))try{await Ke.setPendingData(`productFormData_${e||"new"}`,R),console.log(" Saved product form data for navigation persistence:",R.title||"New Product")}catch(Ie){console.error("Error saving form data:",Ie)}},3e3);return()=>clearTimeout(ke)},[R,e]);const At=()=>{L(!j)},ns=async ge=>{const{name:ke,value:Ie,type:oe,checked:Te}=ge.target,Ne={...R,[ke]:oe==="checkbox"?Te:Ie};D(Ne);try{const we=e?`productFormData_${e}`:"productFormData_new";await Ke.setPendingData(we,Ne),console.log(` Form data saved for field: ${ke}`)}catch(we){console.error("Error saving form data:",we)}y[ke]&&T(we=>({...we,[ke]:""}))},Ht=async()=>{var ke;const ge={};return(ke=R.title)!=null&&ke.trim()||(ge.title="  "),T(ge),Object.keys(ge).length===0},is=async ge=>{if(ge.preventDefault(),!await Ht()){l("    ","  ");return}S(!0),T({});try{const Ie=_.reduce((_e,Ge)=>_e+(Ge.totalPrice||0),0),oe=Ie*.15,Te=Ie+oe,Ne={...R,submissionDeadline:R.submissionDeadline?new Date(R.submissionDeadline):null,estimatedValue:Te,documents:F,items:_||[]};console.log(" Saving complete product data to Firebase with grand total (includes VAT):",{title:Ne.title,estimatedValue:Te,documentsCount:(Ne.documents||[]).length,itemsCount:(Ne.items||[]).length});let we;if(p){we=await ci.updateManufacturedProduct(e,Ne);const _e=r();await s("task",`${_e.name}   `,`  : ${Ne.title}`),await Ke.clearPendingData(`productFormData_${e}`),await Ke.clearPendingData(`productDocuments_${e}`),await Ke.clearPendingData(`pendingProductItems_${e}`),o("    "," ")}else{we=await ci.createManufacturedProduct(Ne);const _e=r();await s("task",`${_e.name}   `,`  : ${Ne.title}`),await Ke.clearPendingData("productFormData_new"),await Ke.clearPendingData("productDocuments_new"),await Ke.clearPendingData("pendingProductItems_new"),await Ke.clearPendingData("product_success_shown_new"),o("    "," ")}setTimeout(()=>{n("/manufactured-products")},1500)}catch(Ie){T({submit:Ie.message}),l("    ","  ")}finally{S(!1)}},Oe=async()=>{try{p||(console.log(" CANCEL: Clearing all pending data for cancelled new product"),await Ke.clearPendingData("productFormData_new"),await Ke.clearPendingData("productDocuments_new"),await Ke.clearPendingData("pendingProductItems_new"),await Ke.clearPendingData("product_success_shown_new"),console.log(" CANCEL: All pending data cleared successfully"))}catch(ge){console.error("Error clearing pending data on cancel:",ge)}n("/manufactured-products")},it=()=>{B(!0)},Kt=()=>{B(!1),H("")},zs=ge=>{try{switch(console.log("Selected item type:",ge),ge){case"raw-materials":const ke=`/manufactured-products/raw-materials/${e||"new"}`;console.log("Navigating to:",ke),n(ke);break;case"local-product":const Ie=`/manufactured-products/local-products/${e||"new"}`;console.log("Navigating to local products:",Ie),n(Ie);break;case"imported-product":const oe=`/manufactured-products/foreign-products/${e||"new"}`;console.log("Navigating to foreign products:",oe),n(oe);break;case"services":const Te=`/services/manufacture/${e||"new"}`;console.log("Navigating to service manufacture:",Te),n(Te);break;case"manufactured-product":const Ne="/manufactured-products";console.log("Navigating to manufactured products list:",Ne),n(Ne);break;default:console.log("Unknown item type:",ge),l("   ","")}}catch(ke){console.error("Error handling item type selection:",ke),l("    ","")}},xs=(ge,ke)=>{const Ie=ge.materialName||ge.name||"  ";c(`      

${Ie}`,()=>cs(ge,ke),"  ")},cs=async(ge,ke)=>{try{P(!0),ze.current=!0,console.log(" Starting deletion process:",{itemName:ge.materialName||ge.name,itemId:ge.internalId||ge.materialInternalId,isDeletingFlag:ze.current});const Ie={...ge,productContext:{productId:e||"new",productTitle:R.title||" ",addedAt:new Date().toISOString()}};await bs.moveToTrash(Ie,"productItems"),console.log(" Successfully moved to trash"),C(Ne=>{const we=Ne.filter((Ge,mt)=>mt!==ke),_e=we.reduce((Ge,mt)=>Ge+(mt.totalPrice||0),0);return D(Ge=>({...Ge,estimatedValue:_e.toString()})),console.log(" Item removed from list, new count:",we.length),we}),setTimeout(()=>{ze.current=!1,console.log(" Deletion flag cleared, auto-save can resume")},5e3);const oe=r(),Te=ge.materialName||ge.name||"  ";s("task",`${oe.name}   `,`  : ${Te}`),o(`   : ${Te}`,"  ")}catch(Ie){console.error(" Error moving product item to trash:",Ie),l(`    : ${Ie.message}`,"  "),ze.current=!1}finally{P(!1)}},Os=(ge,ke)=>{ye({...ge}),be(ke),de(!0)},vs=(ge,ke)=>{const Ie=Math.max(0,parseFloat(ke)||0);ye(oe=>({...oe,quantity:Number(Ie.toFixed(1)),totalPrice:(oe.unitPrice||0)*Number(Ie.toFixed(1))}))},Z=()=>{pe!==null&&ne&&(C(ge=>ge.map((ke,Ie)=>Ie===pe?ne:ke)),de(!1),ye(null),be(null),o("    "," "))},v=()=>{de(!1),ye(null),be(null)},se=()=>Math.round((ne==null?void 0:ne.totalPrice)||0),re=async ge=>{const ke=ge.target.files[0];if(ke){Y(!0);try{try{Ss.validateFile(ke,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]})}catch(oe){throw new Error(oe.message)}console.log(" Uploading document:",ke.name);const Ie=await Ss.uploadFile(ke,"product-documents");k({...Ie,originalFileName:ke.name,fileSize:ke.size,fileType:ke.type}),N(ke.name.split(".")[0]),O(!0),ge.target.value=""}catch(Ie){console.error("Error uploading document:",Ie),l(Ie.message||"   ","  "),ge.target&&(ge.target.value="")}finally{Y(!1)}}},J=async()=>{if(!b.trim()){l("   ","  ");return}if(!E){l("   ","");return}try{Y(!0),console.log(" Creating document with Firebase database storage:",b);const ge={id:Date.now().toString(),fileName:b.trim(),originalFileName:E.originalFileName,fileURL:E.url,storagePath:E.path,fileSize:E.fileSize,fileType:E.fileType,uploadedAt:new Date().toISOString(),uploadDate:new Date().toISOString(),productId:e||"new",productTitle:R.title||"  ",productReferenceNumber:R.referenceNumber||" "};if(X(Ie=>[...Ie,ge]),e&&e!=="new")try{console.log(" Saving document to Firebase database for existing product:",e);const Ie=await ci.getManufacturedProductById(e);if(Ie){const oe=[...Ie.documents||[],ge];await ci.updateManufacturedProduct(e,{...Ie,documents:oe}),console.log(" Document saved to Firebase database successfully")}}catch(Ie){console.warn(" Firebase database save failed, document stored locally only:",Ie.message)}else console.log(" Document stored locally for new product, will be saved to Firebase when product is created");o(`   : ${b}`," ");const ke=r();s("file",`${ke.name}  `,`  : ${b}`),O(!1),k(null),N("")}catch(ge){console.error("Error saving document:",ge),l(`   : ${ge.message}`,"  ")}finally{Y(!1)}},he=()=>{console.log("User cancelled file upload"),O(!1),k(null),N("")},Se=ge=>{c(`      

${ge.fileName}`,()=>me(ge),"  ")},me=async ge=>{try{P(!0),await bs.moveToTrash(ge,"product_documents"),X(Ie=>Ie.filter(oe=>oe.id!==ge.id));const ke=r();s("task",`${ke.name}  `,`  : ${ge.fileName}`),o(`   : ${ge.fileName}`,"  ")}catch(ke){l(`    : ${ke.message}`,"  ")}finally{P(!1)}};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`page-wrapper ${j?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:At}),t.jsxs("div",{className:"main-container",style:{paddingRight:j?"72px":"250px",paddingLeft:j||!d?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:j?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:j})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsx("a",{href:"/manufactured-products",className:"text-decoration-none text-primary",children:" "})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:p?" ":"  "})]})}),t.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsx("div",{className:"d-flex align-items-center",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:`bi ${p?"bi-pencil-square":"bi-plus-circle-fill"} text-primary me-2`}),p?" ":"  "]})}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-primary",onClick:it,style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:" "}),t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>G(!0),style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:" "})]})]})}),t.jsx("div",{className:"card-body",children:A?t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:t.jsx(It,{size:"large"})}):t.jsxs("form",{onSubmit:is,children:[y.submit&&t.jsxs("div",{className:"alert alert-danger",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),y.submit]}),t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-12 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"text",className:`form-control ${y.title?"is-invalid":""}`,name:"title",value:R.title,onChange:ns,placeholder:"  ",disabled:x}),y.title&&t.jsx("div",{className:"invalid-feedback",children:y.title})]}),t.jsxs("div",{className:"col-md-12 mb-3",children:[t.jsxs("label",{className:"form-label",children:[" ",t.jsx("small",{className:"text-muted ms-2",children:"(   )"})]}),t.jsxs("div",{className:"input-group",children:[t.jsx("input",{type:"text",className:"form-control bg-light",name:"estimatedValue",value:(()=>{const ge=tt();return ge>0?`${ge.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})} `:"0.0 "})(),readOnly:!0,placeholder:"    ",style:{backgroundColor:"#f8f9fa",fontWeight:"bold",color:"#198754"}}),t.jsx("span",{className:"input-group-text bg-light text-success",children:t.jsx("i",{className:"bi bi-calculator"})})]})]}),t.jsxs("div",{className:"col-md-12 mb-3",children:[t.jsx("label",{className:"form-label",children:" "}),t.jsx("textarea",{className:"form-control",name:"description",value:R.description,onChange:ns,rows:"4",placeholder:"    ...",disabled:x})]}),t.jsx("div",{className:"col-md-12 mb-4",children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-light",children:t.jsx("div",{className:"d-flex justify-content-between align-items-center",children:t.jsxs("h6",{className:"mb-0 fw-bold text-primary",children:[t.jsx("i",{className:"bi bi-list-task me-2"}),"  (",_.length,")",_.length===0&&t.jsx("span",{className:"text-danger",children:"-   "})]})})}),t.jsxs("div",{className:"card-body p-0",children:[U&&t.jsx("div",{className:"alert alert-warning mx-3 mt-3",role:"alert",children:U}),t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",style:{width:"60px"},children:""})]})}),t.jsx("tbody",{children:_&&_.length>0?_.map((ge,ke)=>{let Ie=ge.materialName||ge.name||"  ";Ie&&Ie.toString().startsWith("rm_")&&(Ie="  ");const oe=ge.materialUnit||ge.unit||"",Te=ge.totalPrice||0,Ne=ge.internalId;return t.jsxs("tr",{style:{backgroundColor:ke%2===0?"#ffffff":"#f8f9fa"},children:[t.jsx("td",{className:"text-center fw-bold text-muted",children:ke+1}),t.jsx("td",{className:"text-center fw-medium",children:t.jsx("div",{children:t.jsx("button",{className:"btn btn-link p-0 fw-medium text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:async we=>{we.preventDefault(),we.stopPropagation();const _e=ge.materialType||"rawMaterial";if(_e==="service"){console.log(" Service clicked - opening edit modal"),Os(ge,ke);return}try{console.log("=== DETAILED DEBUGGING ==="),console.log("Full item object:",JSON.stringify(ge,null,2)),console.log("All item keys:",Object.keys(ge));const Ge=ge.materialInternalId;console.log("Searching for:"),console.log("- materialInternalId:",Ge),console.log("- materialType:",_e);let mt=null,pt=[];if(_e==="rawMaterial"){console.log("Loading raw material...");let Ye=await Tn.getRawMaterialByInternalId(Ge);if(!Ye)try{Ye=await Tn.getRawMaterialById(Ge)}catch{console.log("Could not find material by Firebase ID, trying name fallback...")}if(!Ye){console.log("Using name fallback - loading all raw materials...");const Yt=await Tn.getAllRawMaterials(),je=ge.materialName||ge.name;Ye=Yt.find(Fe=>Fe.name===je)}console.log("Found raw material:",Ye?"YES":"NO"),Ye&&(console.log("Material details:",{id:Ye.id,internalId:Ye.internalId,name:Ye.name}),mt=Ye.id,n(`/raw-materials/edit/${mt}`))}else if(_e==="localProduct"){console.log("Loading local product...");let Ye=await An.getLocalProductByInternalId(Ge);if(!Ye)try{Ye=await An.getLocalProductById(Ge)}catch{console.log("Could not find product by Firebase ID, trying name fallback...")}if(!Ye){console.log("Using name fallback - loading all local products...");const Yt=await An.getAllLocalProducts(),je=ge.materialName||ge.name;Ye=Yt.find(Fe=>Fe.name===je)}console.log("Found local product:",Ye?"YES":"NO"),Ye&&(console.log("Product details:",{id:Ye.id,internalId:Ye.internalId,name:Ye.name}),mt=Ye.id,n(`/local-products/edit/${mt}`))}else if(_e==="foreignProduct"){console.log("Loading foreign product...");let Ye=await nn.getForeignProductByInternalId(Ge);if(!Ye)try{Ye=await nn.getForeignProductById(Ge)}catch{console.log("Could not find product by Firebase ID, trying name fallback...")}if(!Ye){console.log("Using name fallback - loading all foreign products...");const Yt=await nn.getAllForeignProducts(),je=ge.materialName||ge.name;Ye=Yt.find(Fe=>Fe.name===je)}console.log("Found foreign product:",Ye?"YES":"NO"),Ye&&(console.log("Product details:",{id:Ye.id,internalId:Ye.internalId,name:Ye.name}),mt=Ye.id,n(`/foreign-products/edit/${mt}`))}mt||(console.error("=== SEARCH FAILED ==="),console.error("Could not find Firebase ID for:",Ge),console.error("Available items in this category:",pt.map(Ye=>({id:Ye.id,internalId:Ye.internalId,name:Ye.name}))),alert(`     
ID: ${Ge}
Type: ${_e}`))}catch(Ge){console.error("=== NAVIGATION ERROR ===",Ge),alert("     ")}},title:`: ${Ie}`,children:Ie})})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"badge bg-primary",children:ge.quantity||1})}),t.jsx("td",{className:"text-center",children:oe}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{children:[t.jsxs("span",{className:"text-success fw-bold",children:[Te.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," ."]}),ge.unitPrice&&t.jsx("div",{children:t.jsxs("small",{className:"text-muted",children:[ge.unitPrice.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1}),"  ",ge.quantity.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})]})})]})}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"btn-group btn-group-sm",style:{marginLeft:"20px"},children:[t.jsx(Tt,{can:"products:update",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-primary",type:"button",onClick:we=>{we.preventDefault(),we.stopPropagation(),Os(ge,ke)},title:"",children:t.jsx("i",{className:"bi bi-pencil"})})}),t.jsx(Tt,{can:"products:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-danger",type:"button",onClick:we=>{we.preventDefault(),we.stopPropagation(),xs(ge,ke)},title:"",disabled:I,children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},Ne||`item-${ke}`)}):t.jsx("tr",{children:t.jsx("td",{colSpan:"6",className:"text-center py-4 text-muted",children:"    "})})}),t.jsxs("tfoot",{className:"table-light",children:[t.jsxs("tr",{children:[t.jsx("th",{colSpan:"4",className:"text-end",children:" :"}),t.jsxs("th",{className:"text-center text-primary fw-bold",children:[tt().toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," ."]}),t.jsx("th",{})]}),t.jsxs("tr",{children:[t.jsx("th",{colSpan:"4",className:"text-end",children:"   (%15):"}),t.jsxs("th",{className:"text-center text-success fw-bold",children:[rt.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," ."]}),t.jsx("th",{})]}),t.jsxs("tr",{className:"table-warning",children:[t.jsx("th",{colSpan:"4",className:"text-end",children:" :"}),t.jsxs("th",{className:"text-center fw-bold",style:{color:"#000000"},children:[bt.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," ."]}),t.jsx("th",{})]})]})]})})]})]})})]}),t.jsx("div",{className:"row",children:t.jsxs("div",{className:"col-12 d-flex justify-content-center gap-3 mt-4",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",style:{height:"32px",minWidth:"80px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},onClick:Oe,disabled:x,children:""}),t.jsx("button",{type:"submit",className:"btn btn-primary",style:{height:"32px",minWidth:"80px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},disabled:x,children:x?t.jsxs(t.Fragment,{children:[t.jsx(It,{size:"small"}),t.jsx("span",{className:"ms-2",children:p?"...":"..."})]}):p?"":""})]})})]})})]})})}),d&&t.jsxs("div",{style:{position:"fixed",left:"20px",top:"70px",width:"350px",height:"calc(100vh - 90px)",zIndex:10,background:"white",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",display:"flex",flexDirection:"column"},children:[t.jsx("div",{style:{flex:1,overflow:"hidden"},children:t.jsx(z$,{})}),t.jsx("div",{style:{borderTop:"1px solid #e9ecef",padding:"10px",background:"#f8f9fa",borderRadius:"0 0 8px 8px"},children:t.jsx(V$,{})})]})]})]}),ie&&ne&&t.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.8)",zIndex:99980},children:t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:v,"aria-label":"Close"})]}),t.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"30%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),t.jsx("tbody",{children:t.jsxs("tr",{style:{height:"60px"},children:[t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:"bi bi-layers text-danger me-2"}),t.jsxs("div",{children:[t.jsx("div",{className:"fw-bold text-primary",children:ne.materialName||ne.name}),t.jsx("small",{className:"text-muted",children:ne.materialCategory||ne.category})]})]})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("span",{className:"fw-bold text-success",children:[Math.round(ne.unitPrice)," "]}),t.jsx("div",{children:t.jsxs("small",{className:"text-muted",children:["/",ne.materialUnit||ne.unit||""]})})]}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:ge=>{ge.preventDefault(),ge.stopPropagation(),vs(ne.internalId,Math.max(0,Number((ne.quantity-.1).toFixed(1))))},disabled:ne.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-dash"})}),t.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:ne.quantity,min:"0",step:"any",onChange:ge=>{ge.preventDefault(),ge.stopPropagation(),vs(ne.internalId,ge.target.value)},onBlur:ge=>{ge.preventDefault(),ge.stopPropagation();const ke=Number(ge.target.value||0).toFixed(1);vs(ne.internalId,ke)}}),t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:ge=>{ge.preventDefault(),ge.stopPropagation(),vs(ne.internalId,Number((ne.quantity+.1).toFixed(1)))},style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-plus"})})]})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"text-muted",children:ne.displaySupplier||ne.supplierInfo||"-"})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(ne.totalPrice)," "]}),t.jsxs("small",{className:"text-success",children:["(",ne.quantity.toFixed(1),"  ",Math.round(ne.unitPrice),")"]})]})]},ne.internalId)})]})})}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:t.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("span",{className:"text-muted me-3",children:" :"}),t.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[se()," "]}),t.jsxs("span",{className:"badge bg-info ms-2",children:[ne.quantity.toFixed(1)," "]})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:v,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:ge=>{ge.preventDefault(),ge.stopPropagation(),Z()},style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})]})})]})})}),t.jsx(Mt,{show:i.show,onClose:a,title:i.title,message:i.message,type:i.type,onConfirm:i.onConfirm,confirmText:i.confirmText,cancelText:i.cancelText,showCancel:i.showCancel}),t.jsx(B$,{show:q,onClose:Kt,onItemSelect:zs,selectedItemType:$,setSelectedItemType:H}),t.jsx(Td,{show:te,onClose:()=>G(!1),documents:F,setDocuments:X,tenderId:e||"new",tenderTitle:R.title||" ",uploadingDocument:ue,setUploadingDocument:Y,handleDocumentUpload:re,handleDeleteClick:Se,deleting:I}),z&&t.jsx("div",{className:"modal show d-block",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.9)",zIndex:99970},tabIndex:"-1",dir:"rtl",children:t.jsx("div",{className:"modal-dialog modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsx("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"12px 12px 0 0"},children:t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-pencil-square me-2"})," "]})}),t.jsx("div",{className:"modal-body",style:{padding:"25px"},children:t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"d-flex align-items-center mb-3",children:[t.jsx("div",{className:"bg-success bg-opacity-10 p-2 rounded-circle me-3",children:t.jsx("i",{className:"bi bi-file-earmark-check text-success"})}),t.jsxs("div",{children:[t.jsx("h6",{className:"mb-0 fw-bold text-success",children:"   "}),t.jsx("small",{className:"text-muted",children:E==null?void 0:E.originalFileName})]})]}),t.jsxs("div",{className:"mb-3",children:[t.jsxs("label",{className:"form-label fw-bold text-primary",children:[t.jsx("i",{className:"bi bi-tag me-1"}),"   *"]}),t.jsx("input",{type:"text",className:"form-control",value:b,onChange:ge=>N(ge.target.value),placeholder:"   ",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:ge=>{ge.target.style.borderColor="#28a745",ge.target.style.boxShadow="0 0 0 0.2rem rgba(40, 167, 69, 0.25)"},onBlur:ge=>{ge.target.style.borderColor="#e9ecef",ge.target.style.boxShadow="none"},autoFocus:!0}),t.jsxs("small",{className:"text-muted",children:[t.jsx("i",{className:"bi bi-info-circle me-1"}),"        "]})]})]})}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:t.jsxs("div",{className:"d-flex justify-content-end",style:{gap:"12px"},children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:he,style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500"},children:""}),t.jsx("button",{type:"button",className:"btn btn-success",onClick:J,disabled:!b.trim()||ue,style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500",opacity:b.trim()&&!ue?1:.6},children:ue?t.jsxs(t.Fragment,{children:[t.jsx(It,{size:"small"}),t.jsx("span",{className:"ms-1",children:"..."})]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-check-lg me-1"}),""]})})]})})]})})})]})})}function Qj(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(G$,{})})})}function W$(){const[n,e]=h.useState(!1),{isTimelineVisible:s}=Ut(),[r,i]=h.useState([]),[a,o]=h.useState([]),[l,c]=h.useState(!1),[d,u]=h.useState(null),[f,p]=h.useState(""),[j,L]=h.useState([]),[R,D]=h.useState(!1),[y,T]=h.useState([]),[x,S]=h.useState(null),A=kt(),{productId:Q}=Dn(),{logActivity:q,getCurrentUser:B}=Zt(),{alertConfig:$,closeAlert:H,showSuccess:te,showError:G}=Bt(),F=()=>{e(!n)};h.useEffect(()=>{X();const b=P=>{P.type==="rawMaterialsUpdated"&&X()},N=()=>{X()};window.addEventListener("storage",b),window.addEventListener("rawMaterialsUpdated",N);const I=()=>{X()};return window.addEventListener("focus",I),()=>{window.removeEventListener("storage",b),window.removeEventListener("rawMaterialsUpdated",N),window.removeEventListener("focus",I)}},[]),h.useEffect(()=>{if(f.trim()){const b=r.filter(N=>{var I,P,_,C;return((I=N.name)==null?void 0:I.toLowerCase().includes(f.toLowerCase()))||((P=N.category)==null?void 0:P.toLowerCase().includes(f.toLowerCase()))||((_=N.description)==null?void 0:_.toLowerCase().includes(f.toLowerCase()))||((C=N.supplier)==null?void 0:C.toLowerCase().includes(f.toLowerCase()))});L(b)}else L(r)},[f,r]);const X=async()=>{try{c(!0);const N=(await Tn.getAllRawMaterials()).filter(I=>I.active!==!1);i(N),u(null)}catch(b){u(b.message)}finally{c(!1)}},ue=b=>{if(a.some(I=>I.internalId===b.internalId))o(I=>I.filter(P=>P.internalId!==b.internalId));else{const I={...b,type:"rawMaterials",quantity:1};o(P=>[...P,I])}},Y=async()=>{if(a.length===0){G("      ","   ");return}const b=a.map(N=>{let I=N.price||0,P=N.supplier;if(N.priceQuotes&&Array.isArray(N.priceQuotes)&&N.priceQuotes.length>0){const _=N.priceQuotes.reduce((C,U)=>{const w=parseFloat(C.price)||0;return(parseFloat(U.price)||0)<w?U:C});I=parseFloat(_.price)||0,P=_.supplierName}return{...N,quantity:1,unitPrice:I,totalPrice:I,displaySupplier:P}});T(b),S(null),D(!0)},z=(b,N)=>{const I=Math.max(0,parseFloat(N)||0);T(P=>P.map(_=>_.id===b?{..._,quantity:Number(I.toFixed(1)),totalPrice:_.unitPrice*Number(I.toFixed(1))}:_))},O=async()=>{console.log(" FUNCTION START: handleConfirmQuantities called");try{if(!Array.isArray(y)||y.length===0){console.log(" EARLY EXIT: No modal items to process"),G("    ","  ");return}console.log(" STEP 1: Starting duplicate check process..."),console.log(" Modal items to check:",y.map(w=>({name:w.name,internalId:w.internalId,id:w.id})));let b=await Ke.getPendingData(`pendingProductItems_${Q||"new"}`)||[];if(Q&&Q!=="new")try{console.log(" EDIT MODE: Loading existing product items for duplicate check, product ID:",Q);const{ManufacturedProductService:w}=await Xe(async()=>{const{ManufacturedProductService:ie}=await Promise.resolve().then(()=>Li);return{ManufacturedProductService:ie}},void 0),W=await w.getManufacturedProductById(Q);W&&W.items&&Array.isArray(W.items)&&(console.log(" EDIT MODE: Found existing product items:",W.items.length),b=[...b,...W.items])}catch(w){console.error(" Error loading existing product items for duplicate check:",w)}console.log(" STEP 2: Retrieved existing items from storage:",{count:b.length,items:b.map(w=>({name:w.materialName||w.name,materialInternalId:w.materialInternalId,internalId:w.internalId,id:w.id}))});const N=b.map(w=>w.materialInternalId||w.internalId||w.id).filter(Boolean);console.log(" STEP 3: Extracted existing material IDs:",N);const I=[];for(const w of y){const W=[w.internalId,w.id,w.materialInternalId,w.materialId].filter(Boolean),ie=W.some(de=>N.includes(de));console.log(` STEP 4: Duplicate check for "${w.name}":`),console.log(`  - Possible IDs: [${W.join(", ")}]`),console.log(`  - Existing IDs: [${N.join(", ")}]`),console.log(`  - Is Duplicate: ${ie}`),ie&&(I.push(w.name),console.log(` DUPLICATE FOUND: "${w.name}" with IDs [${W.join(", ")}] matches existing items!`))}if(console.log(" STEP 5: Duplicate prevention analysis complete:",{totalModalItems:y.length,duplicatesFound:I.length,duplicateNames:I,existingIds:N}),I.length>0){console.log(" CRITICAL: DUPLICATE PREVENTION ACTIVATED "),console.log(" STEP 6: Execution will be FORCEFULLY STOPPED"),console.log(" Duplicate items blocking execution:",I),console.log(" Function will return immediately after showing warnings");const w=I.join(" ");G(`        :

${w}

      .

        .`," :  "),S(`  : ${w}`),console.log(" STEP 7: About to return and stop execution completely"),console.log(" If you see any code execution after this point, there is a bug!");return}console.log(" STEP 8: NO DUPLICATES DETECTED - Safe to proceed"),console.log(" Continuing with item creation process...");const P=y,_=[];for(const w of P)try{const W={internalId:`pi_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:w.internalId,materialType:"rawMaterial",materialName:w.name,materialCategory:w.category||"",materialUnit:w.unit||"",quantity:w.quantity||1,unitPrice:w.unitPrice||w.price||0,totalPrice:(w.quantity||1)*(w.unitPrice||w.price||0),supplierInfo:w.displaySupplier||w.supplier||"",productId:Q==="new"?"new":Q,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};_.push(W),console.log("Created product item with ID relationship:",{productItemId:W.internalId,linkedMaterialId:W.materialInternalId,materialName:W.materialName,currentPrice:W.unitPrice,totalPrice:W.totalPrice})}catch(W){console.error("Error creating product item for material:",w.name,W),G(`   : ${w.name}`,"  ");return}const C=await Ke.getPendingData(`pendingProductItems_${Q||"new"}`)||[];let U=[..._];if(C.length>0)try{if(Array.isArray(C)){const w=await nc.refreshTenderItemsPricing(C);console.log(" SAFE MERGE: Our enhanced duplicate prevention handled conflicts, merging safely"),U=[...w,..._],console.log(" SAFE MERGE completed:",{existingItemsCount:w.length,newItemsCount:_.length,finalItemsCount:U.length,note:"No conflicts - duplicates were prevented above"})}}catch(w){console.error("Error parsing existing items:",w)}console.log("Storing ID-based product items:",{totalItems:U.length,newItems:_.length,items:U.map(w=>({id:w.internalId,materialId:w.materialInternalId,name:w.materialName,price:w.unitPrice,total:w.totalPrice}))}),await Ke.setPendingData(`pendingProductItems_${Q||"new"}`,U,48);try{let w="  ";if(Q&&Q!=="new")try{const{ManufacturedProductService:W}=await Xe(async()=>{const{ManufacturedProductService:de}=await Promise.resolve().then(()=>Li);return{ManufacturedProductService:de}},void 0),ie=await W.getManufacturedProductById(Q);ie&&ie.name&&(w=`: ${ie.name}`)}catch(W){console.warn("Could not fetch product name, using default name:",W)}else try{const W=await Ke.getPendingData("productFormData_new");W&&W.name&&(w=`: ${W.name}`)}catch(W){console.warn("Could not fetch pending product form data:",W)}for(const W of _)await ws.logItemAdd(W.materialName,w,"manufactured_product");console.log(` Logged ${_.length} individual raw material activities with product name: ${w}`)}catch(w){console.error("Failed to log enhanced activity:",w)}window.dispatchEvent(new CustomEvent("productItemsAdded",{detail:{count:_.length,type:"rawMaterial",items:_}})),te(`  ${_.length}       `," "),D(!1),T([]),S(null),setTimeout(()=>{A(Q==="new"?"/manufactured-products/add":`/manufactured-products/edit/${Q}`)},2e3)}catch(b){console.error("Error in handleConfirmQuantities:",b),G("       -   ","  ")}},E=()=>{D(!1),T([]),S(null)},k=()=>Math.round(y.reduce((b,N)=>b+N.totalPrice,0));return l?t.jsx(It,{show:!0,message:"    ...",overlay:!1}):d?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:d}),t.jsxs("button",{className:"btn btn-primary",onClick:X,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[t.jsx(Rt,{onToggle:F}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!s?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-3",children:t.jsx("div",{className:"raw-materials-table",children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"row align-items-center justify-content-between",children:[t.jsx("div",{className:"col-lg-4",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-gear text-danger me-2"}),"   (",j.length,")"]})}),t.jsx("div",{className:"col-lg-8",children:t.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:f,onChange:b=>p(b.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:Y,disabled:a.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["  (",a.length,")"]})]})})]})}),t.jsx("div",{className:"card-body p-0",children:j.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-gear fs-1"})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:f?"    ":"      "})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""})]})}),t.jsx("tbody",{children:j.map(b=>{let N=b.price,I=b.supplier,P=!1,_=null;return b.priceQuotes&&Array.isArray(b.priceQuotes)&&b.priceQuotes.length>0&&(P=!0,_=b.priceQuotes.reduce((C,U)=>{const w=parseFloat(C.price)||0;return(parseFloat(U.price)||0)<w?U:C}),N=_.price,I=_.supplierName),t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",children:t.jsx("div",{className:"form-check d-flex justify-content-center",children:t.jsx("input",{className:"form-check-input",type:"checkbox",checked:a.some(C=>C.internalId===b.internalId),onChange:()=>ue(b),style:{transform:"scale(1.2)"}})})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"fw-bold text-primary",children:b.name})}),t.jsx("td",{className:"text-center",children:b.category||"-"}),t.jsx("td",{className:"text-center",children:b.unit||"-"}),t.jsx("td",{className:"text-center",children:N?t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsxs("span",{children:[N," "]}),P&&t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),t.jsx("td",{className:"text-center",children:I?t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("span",{children:I}),P&&t.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:" "})]}):"-"})]},b.id)})})]})})})]})})}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&s&&t.jsx(os,{rtl:!0}),!n&&s&&t.jsx(ls,{})]}),R&&t.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:99985},children:t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:E,"aria-label":"Close"})]}),t.jsxs("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:[x&&t.jsxs("div",{className:"alert alert-warning alert-dismissible m-3 mb-2",role:"alert",style:{background:"linear-gradient(45deg, #fff3cd, #ffeaa7)",border:"2px solid #f39c12",borderRadius:"8px",boxShadow:"0 4px 12px rgba(243, 156, 18, 0.3)"},children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-exclamation-triangle-fill text-warning me-2",style:{fontSize:"20px"}}),t.jsxs("div",{className:"flex-grow-1",children:[t.jsx("strong",{children:":  !"}),t.jsx("div",{className:"mt-1 text-dark",children:x}),t.jsx("small",{className:"text-muted",children:"      "})]})]}),t.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>S(null)})]}),t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"30%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),t.jsx("tbody",{children:y.map((b,N)=>t.jsxs("tr",{style:{height:"60px"},children:[t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:"bi bi-gear text-danger me-2"}),t.jsxs("div",{children:[t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:I=>{I.preventDefault(),I.stopPropagation(),A(`/raw-materials/edit/${b.id}`)},title:`  : ${b.name}`,children:b.name}),t.jsx("small",{className:"text-muted",children:b.category})]})]})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("span",{className:"fw-bold text-success",children:[Math.round(b.unitPrice)," "]}),t.jsx("div",{children:t.jsxs("small",{className:"text-muted",children:["/",b.unit||""]})})]}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>z(b.id,Math.max(0,Number((b.quantity-.1).toFixed(1)))),disabled:b.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-dash"})}),t.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:b.quantity,min:"0",step:"any",onChange:I=>z(b.id,I.target.value),onBlur:I=>{const P=Number(I.target.value||0).toFixed(1);z(b.id,P)}}),t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>z(b.id,Number((b.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-plus"})})]})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"text-muted",children:b.displaySupplier||"-"})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(b.totalPrice)," "]}),t.jsxs("small",{className:"text-success",children:["(",b.quantity.toFixed(1),"  ",Math.round(b.unitPrice),")"]})]})]},b.id))})]})})]}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:t.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("span",{className:"text-muted me-3",children:" :"}),t.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[k()," "]}),t.jsxs("span",{className:"badge bg-info ms-2",children:[y.reduce((b,N)=>b+N.quantity,0).toFixed(1)," "]})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:E,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:O,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})]})})]})})}),t.jsx(Mt,{show:$.show,onClose:H,title:$.title,message:$.message,type:$.type,onConfirm:$.onConfirm,showConfirm:$.showConfirm})]})}function q$(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(W$,{})})})}function H$(){const[n,e]=h.useState(!1),{isTimelineVisible:s}=Ut(),[r,i]=h.useState([]),[a,o]=h.useState([]),[l,c]=h.useState(!1),[d,u]=h.useState(null),[f,p]=h.useState(""),[j,L]=h.useState([]),[R,D]=h.useState(!1),[y,T]=h.useState([]),[x,S]=h.useState(null),A=kt(),{productId:Q}=Dn(),{logActivity:q,getCurrentUser:B}=Zt(),{alertConfig:$,closeAlert:H,showSuccess:te,showError:G}=Bt(),F=()=>{e(!n)};h.useEffect(()=>{X();const b=P=>{P.type==="localProductsUpdated"&&X()},N=()=>{X()};window.addEventListener("storage",b),window.addEventListener("localProductsUpdated",N);const I=()=>{X()};return window.addEventListener("focus",I),()=>{window.removeEventListener("storage",b),window.removeEventListener("localProductsUpdated",N),window.removeEventListener("focus",I)}},[]),h.useEffect(()=>{if(f.trim()){const b=r.filter(N=>{var I,P,_,C;return((I=N.name)==null?void 0:I.toLowerCase().includes(f.toLowerCase()))||((P=N.category)==null?void 0:P.toLowerCase().includes(f.toLowerCase()))||((_=N.description)==null?void 0:_.toLowerCase().includes(f.toLowerCase()))||((C=N.manufacturer)==null?void 0:C.toLowerCase().includes(f.toLowerCase()))});L(b)}else L(r)},[f,r]);const X=async()=>{try{c(!0);const N=(await An.getAllLocalProducts()).filter(I=>I.active!==!1);i(N),u(null)}catch(b){u(b.message)}finally{c(!1)}},ue=b=>{if(a.some(I=>I.internalId===b.internalId))o(I=>I.filter(P=>P.internalId!==b.internalId));else{const I={...b,type:"localProducts",quantity:1};o(P=>[...P,I])}},Y=async()=>{if(a.length===0){G("      ","   ");return}const b=a.map(N=>{let I=N.price||0,P=N.manufacturer;if(N.priceQuotes&&Array.isArray(N.priceQuotes)&&N.priceQuotes.length>0){const _=N.priceQuotes.reduce((C,U)=>{const w=parseFloat(C.price)||0;return(parseFloat(U.price)||0)<w?U:C});I=parseFloat(_.price)||0,P=_.supplierName}return{...N,quantity:1,unitPrice:I,totalPrice:I,displaySupplier:P}});T(b),S(null),D(!0)},z=(b,N)=>{const I=Math.max(0,parseFloat(N)||0);T(P=>P.map(_=>_.id===b?{..._,quantity:Number(I.toFixed(1)),totalPrice:_.unitPrice*Number(I.toFixed(1))}:_))},O=async()=>{try{if(!Array.isArray(y)||y.length===0){G("    ","  ");return}console.log(" STARTING DUPLICATE PREVENTION FOR LOCAL PRODUCTS...");let b=await Ke.getPendingData(`pendingProductItems_${Q||"new"}`)||[];if(Q&&Q!=="new")try{console.log(" EDIT MODE: Loading existing product items for duplicate check, product ID:",Q);const{ManufacturedProductService:w}=await Xe(async()=>{const{ManufacturedProductService:ie}=await Promise.resolve().then(()=>Li);return{ManufacturedProductService:ie}},void 0),W=await w.getManufacturedProductById(Q);W&&W.items&&Array.isArray(W.items)&&(console.log(" EDIT MODE: Found existing product items:",W.items.length),b=[...b,...W.items])}catch(w){console.error(" Error loading existing product items for duplicate check:",w)}let N=[];if(b.length>0)try{Array.isArray(b)&&(N=b.map(w=>w.materialInternalId||w.internalId||w.id).filter(Boolean))}catch(w){console.error("Error parsing existing items:",w)}console.log(" Existing material IDs:",N),console.log(" Modal items to check:",y.map(w=>({name:w.name,internalId:w.internalId,id:w.id})));const I=[];for(const w of y){const W=[w.internalId,w.id,w.materialInternalId,w.materialId].filter(Boolean),ie=W.some(de=>N.includes(de));console.log(` DUPLICATE CHECK: "${w.name}":`),console.log(`  - Possible IDs: [${W.join(", ")}]`),console.log(`  - Existing IDs: [${N.join(", ")}]`),console.log(`  - Is Duplicate: ${ie}`),ie&&(I.push(w.name),console.log(` DUPLICATE FOUND: "${w.name}" with IDs [${W.join(", ")}] matches existing items!`))}if(console.log(" DUPLICATE PREVENTION RESULT:",{totalItems:y.length,duplicatesFound:I.length,duplicateNames:I}),I.length>0){const w=I.join(" ");console.log(" DUPLICATE PREVENTION ACTIVATED: Blocking duplicates:",w),G(`        :

${w}

      .

        .`," :  "),S(`  : ${w}`);return}console.log(" No duplicates found, proceeding with creation...");const P=y,_=[];for(const w of P)try{const W={internalId:`pi_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:w.internalId,materialType:"localProduct",materialName:w.name,materialCategory:w.category||"",materialUnit:w.unit||"",quantity:w.quantity||1,unitPrice:w.unitPrice||w.price||0,totalPrice:(w.quantity||1)*(w.unitPrice||w.price||0),supplierInfo:w.displaySupplier||w.supplier||"",productId:Q==="new"?"new":Q,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};_.push(W),console.log("Created product item with ID relationship:",{productItemId:W.internalId,linkedProductId:W.materialInternalId,productName:W.materialName,currentPrice:W.unitPrice,totalPrice:W.totalPrice})}catch(W){console.error("Error creating product item for product:",w.name,W),G(`   : ${w.name}`,"  ");return}const C=await Ke.getPendingData(`pendingProductItems_${Q||"new"}`)||[];let U=[..._];if(C.length>0)try{if(Array.isArray(C)){const w=await nc.refreshTenderItemsPricing(C);console.log(" SAFE MERGE: Our enhanced duplicate prevention handled conflicts, merging safely"),U=[...w,..._],console.log("Duplicate prevention results:",{existingItemsCount:w.length,newItemsCount:_.length,finalItemsCount:U.length})}}catch(w){console.error("Error parsing existing items:",w)}console.log("Storing ID-based product items:",{totalItems:U.length,newItems:_.length,items:U.map(w=>({id:w.internalId,materialId:w.materialInternalId,name:w.materialName,price:w.unitPrice,total:w.totalPrice}))}),await Ke.setPendingData(`pendingProductItems_${Q||"new"}`,U,48);try{let w="  ";if(Q&&Q!=="new")try{const{ManufacturedProductService:W}=await Xe(async()=>{const{ManufacturedProductService:de}=await Promise.resolve().then(()=>Li);return{ManufacturedProductService:de}},void 0),ie=await W.getManufacturedProductById(Q);ie&&ie.name&&(w=`: ${ie.name}`)}catch(W){console.warn("Could not fetch product name, using default name:",W)}else try{const W=await Ke.getPendingData("productFormData_new");W&&W.name&&(w=`: ${W.name}`)}catch(W){console.warn("Could not fetch pending product form data:",W)}for(const W of _)await ws.logItemAdd(W.materialName,w,"manufactured_product");console.log(` Logged ${_.length} individual local product activities with product name: ${w}`)}catch(w){console.error("Failed to log enhanced activity:",w)}te(`  ${_.length}       `," "),window.dispatchEvent(new CustomEvent("productItemsAdded",{detail:{count:_.length,type:"localProduct",items:_}})),D(!1),T([]),S(null),setTimeout(()=>{A(Q==="new"?"/manufactured-products/add":`/manufactured-products/edit/${Q}`)},2e3)}catch(b){console.error("Error in handleConfirmQuantities:",b),G("       -   ","  "),c(!1)}finally{setTimeout(()=>c(!1),2100)}},E=()=>{D(!1),T([]),S(null)},k=()=>Math.round(y.reduce((b,N)=>b+N.totalPrice,0));return l?t.jsx(It,{show:!0,message:"    ...",overlay:!1}):d?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:d}),t.jsxs("button",{className:"btn btn-primary",onClick:X,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[t.jsx(Rt,{onToggle:F}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!s?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-3",children:t.jsx("div",{className:"raw-materials-table",children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"row align-items-center justify-content-between",children:[t.jsx("div",{className:"col-lg-4",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-house text-success me-2"}),"   (",j.length,")"]})}),t.jsx("div",{className:"col-lg-8",children:t.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:f,onChange:b=>p(b.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:Y,disabled:a.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["  (",a.length,")"]})]})})]})}),t.jsx("div",{className:"card-body p-0",children:j.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-house fs-1"})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:f?"    ":"      "})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "})]})}),t.jsx("tbody",{children:j.map(b=>{let N=b.price,I=b.manufacturer,P=!1,_=null;return b.priceQuotes&&Array.isArray(b.priceQuotes)&&b.priceQuotes.length>0&&(P=!0,_=b.priceQuotes.reduce((C,U)=>{const w=parseFloat(C.price)||0;return(parseFloat(U.price)||0)<w?U:C}),N=_.price,I=_.supplierName),t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",children:t.jsx("div",{className:"form-check d-flex justify-content-center",children:t.jsx("input",{className:"form-check-input",type:"checkbox",checked:a.some(C=>C.internalId===b.internalId),onChange:()=>ue(b),style:{transform:"scale(1.2)"}})})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"fw-bold text-primary",children:b.name})}),t.jsx("td",{className:"text-center",children:b.category||"-"}),t.jsx("td",{className:"text-center",children:b.unit||"-"}),t.jsx("td",{className:"text-center",children:N?t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsxs("span",{children:[N," "]}),P&&t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),t.jsx("td",{className:"text-center",children:I?t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("span",{children:I}),P&&t.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:" "})]}):"-"})]},b.id)})})]})})})]})})}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&s&&t.jsx(os,{rtl:!0}),!n&&s&&t.jsx(ls,{})]}),R&&t.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:99985},children:t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:E,"aria-label":"Close"})]}),t.jsxs("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:[x&&t.jsxs("div",{className:"alert alert-warning alert-dismissible m-3 mb-2",role:"alert",style:{background:"linear-gradient(45deg, #fff3cd, #ffeaa7)",border:"2px solid #f39c12",borderRadius:"8px",boxShadow:"0 4px 12px rgba(243, 156, 18, 0.3)"},children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-exclamation-triangle-fill text-warning me-2",style:{fontSize:"20px"}}),t.jsxs("div",{className:"flex-grow-1",children:[t.jsx("strong",{children:":  !"}),t.jsx("div",{className:"mt-1 text-dark",children:x}),t.jsx("small",{className:"text-muted",children:"      "})]})]}),t.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>S(null)})]}),t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"30%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),t.jsx("tbody",{children:y.map((b,N)=>t.jsxs("tr",{style:{height:"60px"},children:[t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:"bi bi-house text-success me-2"}),t.jsxs("div",{children:[t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:I=>{I.preventDefault(),I.stopPropagation(),A(`/local-products/edit/${b.id}`)},title:`  : ${b.name}`,children:b.name}),t.jsx("small",{className:"text-muted",children:b.category})]})]})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("span",{className:"fw-bold text-success",children:[Math.round(b.unitPrice)," "]}),t.jsx("div",{children:t.jsxs("small",{className:"text-muted",children:["/",b.unit||""]})})]}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>z(b.id,Math.max(0,Number((b.quantity-.1).toFixed(1)))),disabled:b.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-dash"})}),t.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:b.quantity,min:"0",step:"any",onChange:I=>z(b.id,I.target.value),onBlur:I=>{const P=Number(I.target.value||0).toFixed(1);z(b.id,P)}}),t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>z(b.id,Number((b.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-plus"})})]})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"text-muted",children:b.displaySupplier||"-"})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(b.totalPrice)," "]}),t.jsxs("small",{className:"text-success",children:["(",b.quantity.toFixed(1),"  ",Math.round(b.unitPrice),")"]})]})]},b.id))})]})})]}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:t.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("span",{className:"text-muted me-3",children:" :"}),t.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[k()," "]}),t.jsxs("span",{className:"badge bg-info ms-2",children:[y.reduce((b,N)=>b+N.quantity,0).toFixed(1)," "]})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:E,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:O,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})]})})]})})}),t.jsx(Mt,{show:$.show,onClose:H,title:$.title,message:$.message,type:$.type,onConfirm:$.onConfirm,showConfirm:$.showConfirm})]})}function Q$(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(H$,{})})})}function K$(){const[n,e]=h.useState(!1),{isTimelineVisible:s}=Ut(),[r,i]=h.useState([]),[a,o]=h.useState([]),[l,c]=h.useState(!1),[d,u]=h.useState(null),[f,p]=h.useState(""),[j,L]=h.useState([]),[R,D]=h.useState(!1),[y,T]=h.useState([]),[x,S]=h.useState(null),A=kt(),{productId:Q}=Dn(),{logActivity:q,getCurrentUser:B}=Zt(),{alertConfig:$,closeAlert:H,showSuccess:te,showError:G}=Bt(),F=()=>{e(!n)};h.useEffect(()=>{X();const b=P=>{P.type==="foreignProductsUpdated"&&X()},N=()=>{X()};window.addEventListener("storage",b),window.addEventListener("foreignProductsUpdated",N);const I=()=>{X()};return window.addEventListener("focus",I),()=>{window.removeEventListener("storage",b),window.removeEventListener("foreignProductsUpdated",N),window.removeEventListener("focus",I)}},[]),h.useEffect(()=>{if(f.trim()){const b=r.filter(N=>{var I,P,_,C,U;return((I=N.name)==null?void 0:I.toLowerCase().includes(f.toLowerCase()))||((P=N.category)==null?void 0:P.toLowerCase().includes(f.toLowerCase()))||((_=N.description)==null?void 0:_.toLowerCase().includes(f.toLowerCase()))||((C=N.supplier)==null?void 0:C.toLowerCase().includes(f.toLowerCase()))||((U=N.countryOfOrigin)==null?void 0:U.toLowerCase().includes(f.toLowerCase()))});L(b)}else L(r)},[f,r]);const X=async()=>{try{c(!0);const N=(await nn.getAllForeignProducts()).filter(I=>I.active!==!1);i(N),u(null)}catch(b){u(b.message)}finally{c(!1)}},ue=b=>{if(a.some(I=>I.internalId===b.internalId))o(I=>I.filter(P=>P.internalId!==b.internalId));else{const I={...b,type:"foreignProduct",quantity:1};o(P=>[...P,I])}},Y=async()=>{if(a.length===0){G("      ","   ");return}console.log(" FOREIGN PRODUCTS: Fetching existing items for duplicate check...");const b=await Ke.getPendingData(`pendingProductItems_${Q||"new"}`)||[];console.log(" FOREIGN PRODUCTS: Existing items found:",b.length);let N=[];b&&Array.isArray(b)&&(N=b.map(_=>_.materialInternalId),console.log(" FOREIGN PRODUCTS: Existing material IDs:",N));const I=[];a.filter(_=>{const U=[_.internalId,_.id,_.materialInternalId,_.materialId].filter(Boolean).some(w=>N.includes(w));return U&&I.push(_.name),!U});const P=a.map(_=>{const C=nn.calculateLowestTotalCost(_);return{..._,quantity:1,unitPrice:C.totalCost,totalPrice:C.totalCost,displaySupplier:C.displaySupplier}});T(P),S(null),D(!0)},z=(b,N)=>{const I=Math.max(0,parseFloat(N)||0);T(P=>P.map(_=>_.id===b?{..._,quantity:Number(I.toFixed(1)),totalPrice:_.unitPrice*Number(I.toFixed(1))}:_))},O=async()=>{try{if(!Array.isArray(y)||y.length===0){G("    ","  ");return}console.log(" STARTING DUPLICATE PREVENTION FOR FOREIGN PRODUCTS...");let b=await Ke.getPendingData(`pendingProductItems_${Q||"new"}`)||[];if(Q&&Q!=="new")try{console.log(" EDIT MODE: Loading existing manufactured product items for duplicate check, product ID:",Q);const w=await ci.getManufacturedProductById(Q);w&&w.items&&Array.isArray(w.items)&&(console.log(" EDIT MODE: Found existing manufactured product items:",w.items.length),b=[...b,...w.items])}catch(w){console.error(" Error loading existing manufactured product items for duplicate check:",w)}let N=[];b&&Array.isArray(b)&&(N=b.map(w=>w.materialInternalId||w.internalId||w.id).filter(Boolean)),console.log(" Existing material IDs:",N),console.log(" Modal items to check:",y.map(w=>({name:w.name,internalId:w.internalId,id:w.id})));const I=[];for(const w of y){const W=[w.internalId,w.id,w.materialInternalId,w.materialId].filter(Boolean),ie=W.some(de=>N.includes(de));console.log(` DUPLICATE CHECK: "${w.name}":`),console.log(`  - Possible IDs: [${W.join(", ")}]`),console.log(`  - Existing IDs: [${N.join(", ")}]`),console.log(`  - Is Duplicate: ${ie}`),ie&&(I.push(w.name),console.log(` DUPLICATE FOUND: "${w.name}" with IDs [${W.join(", ")}] matches existing items!`))}if(console.log(" DUPLICATE PREVENTION RESULT:",{totalItems:y.length,duplicatesFound:I.length,duplicateNames:I}),I.length>0){const w=I.join(" ");console.log(" DUPLICATE PREVENTION ACTIVATED: Blocking duplicates:",w),G(`        :

${w}

      .

        .`," :  "),S(`  : ${w}`);return}console.log(" No duplicates found, proceeding with creation...");const P=y,_=[];for(const w of P)try{console.log(" Creating manufactured product item directly:",w.name);const W={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:w.internalId,materialType:"foreignProduct",materialName:w.name,materialCategory:w.category||"",materialUnit:w.unit||"",quantity:w.quantity||1,unitPrice:w.unitPrice||w.price||0,totalPrice:(w.quantity||1)*(w.unitPrice||w.price||0),supplierInfo:w.displaySupplier||w.supplier||"",productId:Q==="new"?"new":Q,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};_.push(W),console.log(" Created manufactured product item directly:",{internalId:W.internalId,materialName:W.materialName,quantity:W.quantity,unitPrice:W.unitPrice,totalPrice:W.totalPrice})}catch(W){console.error(" Error creating manufactured product item for product:",w.name,W),G(`    "${w.name}": ${W.message||"  "}`,"  ");return}console.log(" MERGE PHASE: Fetching existing items for merge...");const C=await Ke.getPendingData(`pendingProductItems_${Q||"new"}`)||[];console.log(" MERGE PHASE: Existing items fetched:",{count:C.length,items:C.map(w=>({id:w.materialInternalId,name:w.materialName,type:w.materialType}))});let U=[..._];if(console.log(" MERGE PHASE: Starting with new items:",_.length),C.length>0)try{if(Array.isArray(C)){console.log(" MERGE PHASE: Refreshing pricing for existing items...");const w=await nc.refreshTenderItemsPricing(C);console.log(" MERGE PHASE: Price refresh completed:",{originalCount:C.length,refreshedCount:w.length,refreshedItems:w.map(W=>({id:W.materialInternalId,name:W.materialName,price:W.unitPrice}))}),console.log(" MERGE PHASE: Performing safe merge..."),console.log(" Before merge - Existing items:",w.length),console.log(" Before merge - New items:",_.length),U=[...w,..._],console.log(" MERGE PHASE: Safe merge completed:",{existingItemsCount:w.length,newItemsCount:_.length,finalItemsCount:U.length,finalItems:U.map(W=>({id:W.materialInternalId,name:W.materialName,type:W.materialType}))})}}catch(w){console.error(" MERGE PHASE: Error in merge operation:",w)}else console.log(" MERGE PHASE: No existing items found, using only new items");console.log("Storing ID-based manufactured product items:",{totalItems:U.length,newItems:_.length,items:U.map(w=>({id:w.internalId,materialId:w.materialInternalId,name:w.materialName,price:w.unitPrice,total:w.totalPrice}))}),await Ke.setPendingData(`pendingProductItems_${Q||"new"}`,U,48),console.log(" STORAGE COMPLETE - Stored items to FirestorePendingDataService:",U.length),setTimeout(async()=>{const w=await Ke.getPendingData(`pendingProductItems_${Q||"new"}`);console.log(" VERIFICATION: Items in storage after save:",{count:(w==null?void 0:w.length)||0,items:w})},100),console.log(" DISPATCHING CUSTOM EVENT: productItemsAdded"),window.dispatchEvent(new CustomEvent("productItemsAdded",{detail:{count:_.length,type:"foreignProduct",items:U}}));try{let w="  ";if(Q&&Q!=="new")try{const{ManufacturedProductService:W}=await Xe(async()=>{const{ManufacturedProductService:de}=await Promise.resolve().then(()=>Li);return{ManufacturedProductService:de}},void 0),ie=await W.getManufacturedProductById(Q);ie&&ie.name&&(w=`: ${ie.name}`)}catch(W){console.warn("Could not fetch product name, using default name:",W)}else try{const W=await Ke.getPendingData("productFormData_new");W&&W.name&&(w=`: ${W.name}`)}catch(W){console.warn("Could not fetch pending product form data:",W)}for(const W of _)await ws.logItemAdd(W.materialName,w,"manufactured_product");console.log(` Logged ${_.length} individual foreign product activities with product name: ${w}`)}catch(w){console.error("Failed to log enhanced activity:",w)}te(`  ${_.length}       `," "),D(!1),T([]),S(null),setTimeout(()=>{A(Q==="new"?"/manufactured-products/add":`/manufactured-products/edit/${Q}`)},2e3)}catch(b){console.error("Error in handleConfirmQuantities:",b),G("       -   ","  ")}},E=()=>{D(!1),T([]),S(null)},k=()=>Math.round(y.reduce((b,N)=>b+N.totalPrice,0));return l?t.jsx(It,{show:!0,message:"    ...",overlay:!1}):d?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:d}),t.jsxs("button",{className:"btn btn-primary",onClick:X,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[t.jsx(Rt,{onToggle:F}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!s?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-3",children:t.jsx("div",{className:"raw-materials-table",children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"row align-items-center justify-content-between",children:[t.jsx("div",{className:"col-lg-4",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-globe text-warning me-2"}),"   (",j.length,")"]})}),t.jsx("div",{className:"col-lg-8",children:t.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:f,onChange:b=>p(b.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:Y,disabled:a.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["  (",a.length,")"]})]})})]})}),t.jsx("div",{className:"card-body p-0",children:j.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-globe fs-1"})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:f?"    ":"      "})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "})]})}),t.jsx("tbody",{children:j.map(b=>{const N=nn.calculateLowestTotalCost(b);return t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",children:t.jsx("div",{className:"form-check d-flex justify-content-center",children:t.jsx("input",{className:"form-check-input",type:"checkbox",checked:a.some(I=>I.internalId===b.internalId),onChange:()=>ue(b),style:{transform:"scale(1.2)"}})})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"fw-bold text-primary",children:b.name})}),t.jsx("td",{className:"text-center",children:b.category||"-"}),t.jsx("td",{className:"text-center",children:b.unit||"-"}),t.jsx("td",{className:"text-center",children:N.totalCost?t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsxs("span",{children:[N.totalCost.toFixed(2)," "]}),N.hasQuotes&&t.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"  "})]}):"-"}),t.jsx("td",{className:"text-center",children:N.displaySupplier?t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("span",{children:N.displaySupplier}),N.hasQuotes&&t.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:" "})]}):"-"}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"badge bg-warning text-dark",children:b.countryOfOrigin||" "})})]},b.id)})})]})})})]})})}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&s&&t.jsx(os,{rtl:!0}),!n&&s&&t.jsx(ls,{})]}),R&&t.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:99985},children:t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:E,"aria-label":"Close"})]}),t.jsxs("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:[x&&t.jsxs("div",{className:"alert alert-warning alert-dismissible m-3 mb-2",role:"alert",style:{background:"linear-gradient(45deg, #fff3cd, #ffeaa7)",border:"2px solid #f39c12",borderRadius:"8px",boxShadow:"0 4px 12px rgba(243, 156, 18, 0.3)"},children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-exclamation-triangle-fill text-warning me-2",style:{fontSize:"20px"}}),t.jsxs("div",{className:"flex-grow-1",children:[t.jsx("strong",{children:":  !"}),t.jsx("div",{className:"mt-1 text-dark",children:x}),t.jsx("small",{className:"text-muted",children:"      "})]})]}),t.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>S(null)})]}),t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"30%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),t.jsx("tbody",{children:y.map((b,N)=>t.jsxs("tr",{style:{height:"60px"},children:[t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:"bi bi-globe text-warning me-2"}),t.jsxs("div",{children:[t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:I=>{I.preventDefault(),I.stopPropagation(),A(`/foreign-products/edit/${b.id}`)},title:`  : ${b.name}`,children:b.name}),t.jsx("small",{className:"text-muted",children:b.category}),t.jsx("div",{children:t.jsx("span",{className:"badge bg-warning text-dark",style:{fontSize:"10px"},children:b.countryOfOrigin||" "})})]})]})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("span",{className:"fw-bold text-success",children:[Math.round(b.unitPrice)," "]}),t.jsx("div",{children:t.jsxs("small",{className:"text-muted",children:["/",b.unit||""]})})]}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>z(b.id,Math.max(0,Number((b.quantity-.1).toFixed(1)))),disabled:b.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-dash"})}),t.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:b.quantity,min:"0",step:"any",onChange:I=>z(b.id,I.target.value),onBlur:I=>{const P=Number(I.target.value||0).toFixed(1);z(b.id,P)}}),t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>z(b.id,Number((b.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-plus"})})]})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"text-muted",children:b.displaySupplier||"-"})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(b.totalPrice)," "]}),t.jsxs("small",{className:"text-success",children:["(",b.quantity.toFixed(1),"  ",Math.round(b.unitPrice),")"]})]})]},b.id))})]})})]}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:t.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("span",{className:"text-muted me-3",children:" :"}),t.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[k()," "]}),t.jsxs("span",{className:"badge bg-info ms-2",children:[y.reduce((b,N)=>b+N.quantity,0).toFixed(1)," "]})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:E,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{console.log(" CONFIRM BUTTON CLICKED! Modal items:",y),O()},style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})]})})]})})}),t.jsx(Mt,{show:$.show,onClose:H,title:$.title,message:$.message,type:$.type,onConfirm:$.onConfirm,showConfirm:$.showConfirm})]})}function Y$(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(K$,{})})})}const J$=({onEdit:n,onAdd:e,refreshTrigger:s,searchTerm:r,onSearchStatsChange:i})=>{const[a,o]=h.useState([]),[l,c]=h.useState(!0),[d,u]=h.useState(null),[f,p]=h.useState(""),j=r!==void 0?r:f,[L,R]=h.useState([]),[D,y]=h.useState(!1),{logActivity:T,getCurrentUser:x}=Zt(),{alertConfig:S,closeAlert:A,showSuccess:Q,showError:q,showConfirm:B}=Bt(),$=h.useRef(i);h.useEffect(()=>{$.current=i},[i]);const{currentPage:H,totalPages:te,paginatedItems:G,handlePageChange:F,resetPage:X,totalItems:ue,itemsPerPage:Y}=cr(L,30);h.useEffect(()=>{z()},[]),h.useEffect(()=>{s&&z()},[s]),h.useEffect(()=>{if(console.log(" SuppliersList: Search term changed:",j),j&&j.trim()){const k=j.toLowerCase(),b=a.filter(N=>{var I,P,_,C,U,w;return((I=N.name)==null?void 0:I.toLowerCase().includes(k))||((P=N.email)==null?void 0:P.toLowerCase().includes(k))||((_=N.phone)==null?void 0:_.includes(j))||((C=N.contactPerson)==null?void 0:C.toLowerCase().includes(k))||((U=N.category)==null?void 0:U.toLowerCase().includes(k))||((w=N.taxNumber)==null?void 0:w.includes(j))});console.log(" SuppliersList: Filtered results:",b.length,"of",a.length),R(b)}else console.log(" SuppliersList: No search, showing all suppliers"),R(a);X()},[j,a,X]),h.useEffect(()=>{const k=$.current;if(k){const b=L.length,N=a.length;console.log(" SuppliersList: Reporting stats:",{filtered:b,total:N}),k({filtered:b,total:N})}},[L.length,a.length]);const z=async()=>{try{c(!0);const k=await rr.getAllSuppliers(),b=Kf(k);o(b),u(null)}catch(k){u(k.message)}finally{c(!1)}},O=k=>{B(`      

${k.name}`,()=>E(k),"  ")},E=async k=>{try{y(!0),await bs.moveToTrash(k,"suppliers"),await rr.deleteSupplier(k.id);const b=x();T("task",`${b.name}   `,`  : ${k.name}`),await z(),Q(`   : ${k.name}`,"  ")}catch(b){u(b.message),q(`    : ${b.message}`,"  ")}finally{y(!1)}};return l?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"spinner-border text-primary",role:"status",children:t.jsx("span",{className:"visually-hidden",children:" ..."})}),t.jsx("p",{className:"mt-3 text-muted",children:"   ..."})]})}):d?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:d}),t.jsxs("button",{className:"btn btn-primary",onClick:z,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):t.jsxs("div",{"data-list":"suppliers",children:[L.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-people fs-1"})}),t.jsx("h5",{className:"text-muted",children:"  "}),t.jsx("p",{className:"text-muted",children:j?"    ":"     "}),!j&&t.jsxs("button",{className:"btn btn-primary",onClick:e,children:[t.jsx("i",{className:"bi bi-plus-lg me-1"}),"  "]})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",style:{tableLayout:"fixed"},children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:"60px",textAlign:"center"},children:"#"}),t.jsx("th",{style:{width:"25%",textAlign:"right"},children:" "}),t.jsx("th",{style:{width:"25%",textAlign:"right"},children:" "}),t.jsx("th",{style:{width:"15%",textAlign:"center"},children:""}),t.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),t.jsx("th",{style:{width:"120px",textAlign:"center"},children:""})]})}),t.jsx("tbody",{children:G.map((k,b)=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",style:{verticalAlign:"middle"},children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(H-1)*Y+b+1})}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:t.jsx("span",{className:"fw-bold text-primary supplier-name-link",onClick:N=>{console.log(" Supplier name clicked:",k.name,"ID:",k.id),N.preventDefault(),N.stopPropagation(),console.log(" Calling onEdit function..."),n(k)},style:{cursor:"pointer",textDecoration:"underline",userSelect:"none",display:"inline-block",padding:"4px",borderRadius:"3px",transition:"background-color 0.2s",pointerEvents:"auto",zIndex:1e3,position:"relative"},onMouseEnter:N=>{N.target.style.backgroundColor="#f8f9fa",console.log(" Hover on supplier:",k.name)},onMouseLeave:N=>N.target.style.backgroundColor="transparent",title:`Click to edit: ${k.name} (ID: ${k.internalId||"Not Set"})`,role:"button",tabIndex:0,children:k.name})}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:t.jsx("a",{href:`mailto:${k.email}`,className:"text-decoration-none",children:k.email})}),t.jsx("td",{style:{direction:"ltr",textAlign:"center",verticalAlign:"middle"},children:k.phone}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:k.city||"-"}),t.jsx("td",{style:{textAlign:"center",verticalAlign:"middle"},children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(Tt,{can:"suppliers:update",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-primary",onClick:()=>n(k),title:"",children:t.jsx("i",{className:"bi bi-pencil"})})}),t.jsx(Tt,{can:"suppliers:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>O(k),title:"",children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},k.internalId||k.id))})]})}),L.length>0&&t.jsx(dr,{currentPage:H,totalPages:te,onPageChange:F,totalItems:ue,itemsPerPage:Y}),t.jsx(Mt,{show:S.show,onClose:A,title:S.title,message:S.message,type:S.type,onConfirm:S.onConfirm,confirmText:S.confirmText,cancelText:S.cancelText,showCancel:S.showCancel})]})},Yf=({searchTerm:n,filteredCount:e,totalCount:s,onClearSearch:r,className:i="",style:a={}})=>{if(!n||n.trim()==="")return null;const o=e===0;return t.jsxs("div",{className:`search-results-indicator d-flex justify-content-between align-items-center px-3 py-2 ${i}`,style:{backgroundColor:o?"#fff3cd":"#d1ecf1",border:`1px solid ${o?"#ffeaa7":"#bee5eb"}`,borderRadius:"6px",margin:"12px 16px",fontSize:"13px",color:o?"#856404":"#0c5460",...a},children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:`bi ${o?"bi-exclamation-triangle":"bi-search"} me-2`,style:{fontSize:"14px"}}),t.jsx("span",{children:o?`     "${n}"`:`${e}   ${s}    "${n}"`})]}),t.jsxs("button",{type:"button",className:"btn btn-link p-0 text-decoration-none",onClick:r,style:{color:"inherit",fontSize:"12px",fontWeight:"500"},title:" ",children:[t.jsx("i",{className:"bi bi-x-circle me-1"}),""]})]})},ax=()=>{console.log(" Running Search Diagnostics...");const n=document.querySelector(".advanced-search-container"),e=document.querySelector(".advanced-search-container input"),s=document.querySelectorAll('table td span[role="button"]'),r=document.querySelectorAll(".pagination .page-link");if(console.log(" Diagnostics Results:"),console.log("- Search Container:",n?" Found":" Missing"),console.log("- Search Input:",e?" Found":" Missing"),console.log("- Supplier Buttons:",s.length,"found"),console.log("- Pagination Buttons:",r.length,"found"),e&&console.log("- Search Input Events:",Object.getOwnPropertyNames(e).filter(i=>i.startsWith("on"))),s.length>0){const i=s[0];console.log("- First Supplier Button Style:",{pointerEvents:getComputedStyle(i).pointerEvents,cursor:getComputedStyle(i).cursor,zIndex:getComputedStyle(i).zIndex})}return{searchContainer:!!n,searchInput:!!e,supplierButtonsCount:s.length,paginationButtonsCount:r.length}};typeof window<"u"&&(window.runSearchDiagnostics=ax,document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{setTimeout(ax,1e3)}):setTimeout(ax,1e3));const X$=({searchTerm:n,searchStats:e})=>{const[s,r]=h.useState(0);h.useEffect(()=>{i()},[]);const i=async()=>{try{const l=await rr.getAllSuppliers();r(l.length)}catch(l){console.error("Error loading suppliers count:",l),r(0)}},a=(e==null?void 0:e.total)>0?e.total:s,o=(e==null?void 0:e.filtered)||a;return t.jsx("span",{className:"badge bg-secondary ms-2",style:{fontSize:"12px",fontWeight:"normal"},children:n!=null&&n.trim()?`${o}  ${a}`:a})};function Z$(){const[n,e]=h.useState(!1),[s,r]=h.useState(0),[i,a]=h.useState(""),[o,l]=h.useState({filtered:0,total:0}),{isTimelineVisible:c}=Ut(),d=kt(),u=()=>{e(!n)},f=()=>{d("/local-suppliers/add")},p=D=>{console.log(" LocalSuppliers: handleEditSupplier called with:",D),console.log(" LocalSuppliers: Navigating to:",`/local-suppliers/edit/${D.id}`);try{d(`/local-suppliers/edit/${D.id}`),console.log(" LocalSuppliers: Navigation completed")}catch(y){console.error(" LocalSuppliers: Navigation failed:",y)}},j=D=>{console.log(" LocalSuppliers: Search term received:",D),a(D)},L=()=>{console.log(" LocalSuppliers: Clearing search"),a("")},R=h.useCallback(D=>{console.log(" LocalSuppliers: Search stats received:",D),l(D)},[]);return h.useEffect(()=>{console.log(" LocalSuppliers: Search term state changed to:",i)},[i]),t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:u}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!c?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-primary",children:""}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"20px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-building text-primary me-2"}),"  "]}),t.jsx(X$,{searchTerm:i,searchStats:o})]}),t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px",pointerEvents:"auto"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:i,onChange:D=>j(D.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px",pointerEvents:"auto"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsx("div",{className:"d-flex gap-2",children:t.jsx("button",{onClick:f,className:"btn btn-primary",style:{height:"40px",width:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:" "})})]})]})}),t.jsx(Yf,{searchTerm:i,filteredCount:o.filtered,totalCount:o.total,onClearSearch:L}),t.jsx("div",{style:{height:"calc(100vh - 280px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"card-body p-0",children:t.jsx(J$,{onAdd:f,onEdit:p,refreshTrigger:s,searchTerm:i,onSearchStatsChange:R})})})]})})]}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]}),!n&&c&&t.jsx(os,{rtl:!0}),!n&&c&&t.jsx(ls,{})]})})})}function e6(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(Z$,{})})})}const t6=({show:n,onClose:e,documents:s,setDocuments:r,supplierId:i,uploadingDocument:a,setUploadingDocument:o,handleDocumentUpload:l,handleDeleteClick:c,deleting:d,title:u=" ",canCreate:f=!0,canDelete:p=!0,canView:j=!0,readOnly:L=!1})=>{const{alertConfig:R,closeAlert:D,showSuccess:y,showError:T}=Bt(),{formatDate:x}=sc();return n?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.8)",zIndex:99980,position:"fixed",top:0,left:0,right:0,bottom:0},tabIndex:"-1",dir:"rtl",children:t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"12px 12px 0 0"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-building me-2"}),u]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:e,"aria-label":"Close"})]}),t.jsx("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"},children:t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("div",{className:"bg-success bg-opacity-10 p-2 rounded-circle me-3",children:t.jsx("i",{className:"bi bi-files text-success"})}),t.jsxs("div",{children:[t.jsx("h6",{className:"mb-0 fw-bold text-success",children:" "}),t.jsxs("small",{className:"text-muted",children:[" : ",s.length]})]})]}),t.jsx("div",{style:{marginTop:"10px",marginBottom:"10px"},children:t.jsxs(Tt,{can:"documents:create",mode:"disable",children:[t.jsx("input",{type:"file",id:"supplierDocumentUpload",onChange:S=>{console.log(" File selected in modal:",S.target.files[0]);const A=S.target.files[0];S.target.value="",A&&l&&l({target:{files:[A],value:""}})},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",style:{display:"none"}}),t.jsx("button",{type:"button",className:"btn btn-success",onClick:()=>{console.log(" Supplier upload button clicked"),console.log(" SUPPLIER MODAL: Starting fullscreen bypass for file picker"),Kr(2e4);const S=document.getElementById("supplierDocumentUpload");S?(S.value="",S.click(),console.log(" Supplier file input triggered")):console.error(" Supplier file input not found")},disabled:a,title:"  ",style:{height:"32px",minWidth:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",fontWeight:"500"},children:a?t.jsxs(t.Fragment,{children:[t.jsx(It,{size:"small"}),t.jsx("span",{className:"ms-2",children:"..."})]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-cloud-upload me-1"})," "]})})]})})]}),(console.log(" SUPPLIER MODAL RENDER CHECK:",new Date().toLocaleTimeString()),console.log(" Supplier Documents state:",{length:s.length,docs:s.map(S=>({name:S.fileName,url:!!S.fileURL,id:S.id}))}),null),s.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-folder2-open",style:{fontSize:"3rem"}})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:'  " "  '})]}):t.jsx("div",{className:"table-responsive",style:{maxHeight:"400px",overflowY:"auto"},children:t.jsxs("table",{className:"table table-hover",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:"#"}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""})]})}),t.jsx("tbody",{children:s.map((S,A)=>{if(!S||typeof S!="object")return null;const q=(H=>!H||typeof H!="string"?{icon:"bi-file-earmark",color:"#6c757d"}:H.includes("pdf")?{icon:"bi-file-earmark-pdf",color:"#dc3545"}:H.includes("word")||H.includes("document")?{icon:"bi-file-earmark-word",color:"#2b579a"}:H.includes("image")?{icon:"bi-file-earmark-image",color:"#198754"}:{icon:"bi-file-earmark",color:"#6c757d"})(S.fileType||""),B=S.fileName||S.originalFileName||"  ",$=S.fileSize||0;return S.uploadDate,t.jsxs("tr",{children:[t.jsx("td",{className:"text-center fw-bold text-muted",children:A+1}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:`${q.icon} me-2`,style:{color:q.color}}),t.jsx("span",{className:"fw-bold text-success",title:B,children:B.length>25?B.substring(0,25)+"...":B})]})}),t.jsx("td",{className:"text-center",children:t.jsxs("span",{className:"badge bg-light text-dark",children:[($/1024/1024).toFixed(2)," ."]})}),t.jsx("td",{className:"text-center",children:t.jsx("small",{className:"text-muted",children:x(S.uploadedAt||S.uploadDate||new Date)})}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(Tt,{can:"documents:read",mode:"disable",children:t.jsx("a",{href:S.fileURL||"#",target:"_blank",rel:"noopener noreferrer",className:"btn btn-success",title:" ",style:{width:"32px",height:"32px",padding:"0",borderRadius:"6px 0 0 6px",fontSize:"12px"},onClick:H=>{S.fileURL||(H.preventDefault(),T("   ",""))},children:t.jsx("i",{className:"bi bi-eye"})})}),t.jsx(Tt,{can:"documents:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>{console.log(" Delete button clicked for document:",S),c?c(S):console.error(" handleDeleteClick function not provided")},title:"",disabled:d,style:{width:"32px",height:"32px",padding:"0",borderRadius:"0 6px 6px 0",fontSize:"12px"},children:d?t.jsx(It,{size:"small"}):t.jsx("i",{className:"bi bi-trash"})})})]})})]},S.id||`doc-${A}`)})})]})})]})}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:t.jsxs("div",{className:"d-flex",style:{gap:"10px"},children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:e,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},children:""}),t.jsx("button",{type:"button",className:"btn btn-success",onClick:()=>y("    "," "),style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},children:""})]})})]})})}),t.jsx(Mt,{show:R.show,onClose:D,title:R.title,message:R.message,type:R.type,onConfirm:R.onConfirm,showConfirm:R.showConfirm})]}):null};function s6(){const n=kt(),{id:e}=Dn(),{logActivity:s,getCurrentUser:r}=Zt(),{alertConfig:i,closeAlert:a,showSuccess:o,showError:l,showConfirm:c}=Bt(),{isTimelineVisible:d}=Ut(),{hasPerm:u,readOnly:f}=Yn(),p=!!e,j=u("suppliers:create"),L=u("suppliers:update"),R=f||p&&!L||!p&&!j,[D,y]=h.useState(!1),T=`localSupplierForm_${e||"new"}`,[x,S]=h.useState(()=>{const xe=localStorage.getItem(T);if(xe)try{return console.log(" [FORCE PERSIST] Restoring form data from localStorage:",xe),JSON.parse(xe)}catch(Ee){console.warn("Failed to parse saved form data:",Ee)}return{name:"",email:"",phone:"",address:"",city:"",taxNumber:"",bankAccount:"",notes:"",active:!0}}),[A,Q]=h.useState({}),[q,B]=h.useState(!1),[$,H]=h.useState(!1),[te,G]=h.useState(!1),[F,X]=h.useState([]),[ue,Y]=h.useState(!1),[z,O]=h.useState(!1),[E,k]=h.useState(!1),[b,N]=h.useState(null),[I,P]=h.useState(""),_=()=>{y(!D)};h.useEffect(()=>{const xe=()=>{try{localStorage.setItem(T,JSON.stringify(x)),console.log(" [FORCE PERSIST] Form data saved on beforeunload")}catch(fe){console.warn("Failed to save form data on beforeunload:",fe)}},Ee=()=>{if(document.hidden)try{localStorage.setItem(T,JSON.stringify(x)),console.log(" [FORCE PERSIST] Form data saved on visibility change")}catch(fe){console.warn("Failed to save form data on visibility change:",fe)}},Re=()=>{try{localStorage.setItem(T,JSON.stringify(x)),console.log(" [FORCE PERSIST] Form data saved on window blur")}catch(fe){console.warn("Failed to save form data on window blur:",fe)}};return window.addEventListener("beforeunload",xe),document.addEventListener("visibilitychange",Ee),window.addEventListener("blur",Re),()=>{window.removeEventListener("beforeunload",xe),document.removeEventListener("visibilitychange",Ee),window.removeEventListener("blur",Re)}},[x,T]),h.useEffect(()=>{p&&e&&(localStorage.getItem(T)?console.log(" [FORCE PERSIST] User changes exist, preserving form data"):C())},[e,p]);const C=async()=>{try{H(!0);const xe=await rr.getSupplierById(e);if(xe){S({name:xe.name||"",email:xe.email||"",phone:xe.phone||"",address:xe.address||"",city:xe.city||"",taxNumber:xe.taxNumber||"",bankAccount:xe.bankAccount||"",notes:xe.notes||"",active:xe.active!==void 0?xe.active:!0}),console.log(" Loading supplier documents from multiple sources...");let Ee=[];xe.documents&&Array.isArray(xe.documents)&&(console.log(` Found ${xe.documents.length} embedded documents`),Ee=[...xe.documents]);try{const Re=await Ss.loadSupplierDocumentsFromFirestore(e);if(Re&&Re.length>0){console.log(` Found ${Re.length} documents in Firestore subcollection`);const fe=Re.map($e=>$e.id);Ee=[...Ee.filter($e=>!fe.includes($e.id)),...Re],console.log(` Merged total documents: ${Ee.length}`)}}catch(Re){console.log("No documents found in Firestore subcollection or error loading:",Re.message)}X(Ee),console.log(` Final documents loaded: ${Ee.length}`)}}catch(xe){console.error("Error loading supplier data:",xe),l("    ","")}finally{H(!1)}},U=xe=>{const{name:Ee,value:Re,type:fe,checked:Ve}=xe.target,$e={...x,[Ee]:fe==="checkbox"?Ve:Re};S($e);try{localStorage.setItem(T,JSON.stringify($e)),console.log(" [FORCE PERSIST] Form data saved to localStorage on every change")}catch(et){console.warn("Failed to save form data to localStorage:",et)}A[Ee]&&Q(et=>({...et,[Ee]:""}))},w=()=>{const xe={};return x.name.trim()||(xe.name="  "),x.email.trim()?/\S+@\S+\.\S+/.test(x.email)||(xe.email="   "):xe.email="  ",x.phone.trim()?/^[\+\d\s\-\(\)]+$/.test(x.phone)||(xe.phone="        + "):xe.phone="  ",Q(xe),Object.keys(xe).length===0},W=async xe=>{if(xe.preventDefault(),console.log(" Submit button clicked, form data:",x),!w()){console.log(" Form validation failed");return}console.log(" Form validation passed, proceeding with save");try{B(!0);try{await Bn.isEmailUnique(x.email,p?e:null,"suppliers")}catch(Ve){Q($e=>({...$e,email:Ve.message})),B(!1);return}try{await Bn.isPhoneUnique(x.phone,p?e:null,"suppliers")}catch(Ve){Q($e=>({...$e,phone:Ve.message})),B(!1);return}if(x.taxNumber)try{await Bn.isTaxNumberUnique(x.taxNumber,p?e:null,"suppliers")}catch(Ve){Q($e=>({...$e,taxNumber:Ve.message})),B(!1);return}const Ee={...x,documents:F,updatedAt:new Date().toISOString()};p||(Ee.createdAt=new Date().toISOString());let Re,fe;if(p?(Re=await rr.updateSupplier(e,Ee),fe=e,s("task",`${r().name}   `,`  : ${x.name}`),o("   "," ")):(Re=await rr.createSupplier(Ee),fe=Re.id||Re,s("task",`${r().name}   `,`  : ${x.name}`),o("   "," ")),F.length>0&&fe)try{console.log(` Saving ${F.length} documents to Firestore subcollection for supplier ${fe}...`),await Ss.saveSupplierDocumentsToFirestore(fe,F),console.log(" Documents saved to Firestore subcollection successfully")}catch(Ve){console.error(" Error saving documents to subcollection:",Ve)}else console.log(" No documents to save or missing supplier ID");try{localStorage.removeItem(T),console.log(" [FORCE PERSIST] Cleared form data from localStorage on successful save")}catch(Ve){console.warn("Failed to clear form data from localStorage:",Ve)}setTimeout(()=>{n("/suppliers/local")},1500)}catch(Ee){console.error("Error saving supplier:",Ee),l(p?"   ":"   ","")}finally{B(!1)}},ie=()=>{console.log(" Cancel button clicked - navigating directly to list"),n("/suppliers/local")},de=xe=>{const Ee=xe.target.files[0];Ee&&(N(Ee),P(Ee.name.split(".")[0]),k(!0),xe.target.value="")},ne=async()=>{if(!b||!I.trim()){l("   ","");return}try{Y(!0);const xe=await Ss.uploadSupplierDocument(b,e||"new"),Ee={id:`doc_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,fileName:I.trim(),originalFileName:b.name,fileType:b.type,fileSize:b.size,fileURL:xe,uploadedAt:new Date().toISOString(),supplierId:e||"new"};X(Re=>{const fe=[...Re,Ee];return p&&e&&e!=="new"&&Ss.saveSupplierDocumentsToFirestore(e,fe).then(()=>{console.log(" Document saved to Firestore subcollection")}).catch(Ve=>{console.error(" Error saving to Firestore subcollection:",Ve)}),fe}),o(`   : ${I}`," "),s("file",`${r().name}   `,`  : ${I}`),k(!1),N(null),P("")}catch(xe){console.error("Error uploading document:",xe),l("   "," ")}finally{Y(!1)}},ye=()=>{k(!1),N(null),P(""),console.log(" File upload cancelled, filename modal closed")},pe=async xe=>{try{console.log(" Starting document deletion for:",xe),O(!0);const Ee={...xe,supplierContext:{supplierId:e||"new",supplierName:x.name||" "}};if(console.log(" Moving document to trash:",Ee),await bs.moveToTrash(Ee,"supplier_documents"),console.log(" Document moved to trash successfully"),p&&e&&e!=="new")try{await Ss.deleteSupplierDocumentFromFirestore(e,xe.id),console.log(" Local supplier document removed from Firestore subcollection");const Re=F.filter(fe=>fe.id!==xe.id);await rr.updateSupplier(e,{documents:Re,updatedAt:new Date().toISOString()}),console.log(" Local supplier document removed from embedded documents array")}catch(Re){console.error(" Error removing local supplier document from storage:",Re)}X(Re=>{const fe=Re.filter(Ve=>Ve.id!==xe.id);return console.log(" Documents before filter:",Re.length,"After filter:",fe.length),fe}),console.log(" Document removed from state"),o("   "," "),s("file",`${r().name}   `,`  : ${xe.fileName}`)}catch(Ee){console.error(" Error deleting document:",Ee),l(`   : ${Ee.message}`,"")}finally{O(!1)}},be=xe=>{c(`      

${xe.fileName}`,()=>pe(xe),"  ")};return $?t.jsx(It,{show:!0,message:p?"   ...":" ...",overlay:!0}):t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsxs("div",{className:`page-wrapper ${D?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:_}),t.jsxs("div",{className:"main-container",style:{paddingRight:D?"72px":"250px",paddingLeft:D||!d?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:D?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:D})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsx("a",{href:"/suppliers/local",className:"text-decoration-none text-primary",children:" "})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:p?"  ":"  "})]})}),t.jsx("div",{className:"app-content-area",style:{height:"calc(100vh - 140px)",overflowY:"auto",padding:"20px"},children:t.jsx("form",{onSubmit:W,children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom",children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-building text-primary me-2"}),p?"  ":"   "]}),t.jsxs("button",{type:"button",className:"btn btn-primary",onClick:()=>G(!0),style:{backgroundColor:"#007bff",borderColor:"#007bff",height:"40px",fontSize:"14px",borderRadius:"6px",padding:"8px 16px"},children:["  (",F.length,")"]})]})}),t.jsxs("div",{className:"card-body",children:[R&&t.jsx("div",{className:"alert alert-info border-0 shadow-sm mb-4",children:t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-info-circle-fill text-info me-3 fs-5"}),t.jsxs("div",{children:[t.jsx("strong",{className:"fw-bold",children:"  "}),t.jsx("div",{className:"mt-1",children:t.jsxs("span",{className:"ms-2",children:[!L&&p&&"    ",!j&&!p&&"     ",f&&"     "]})})]})]})}),t.jsxs("div",{className:"row g-4",children:[t.jsx("div",{className:"col-12",children:t.jsxs("h6",{className:"text-primary mb-3",children:[t.jsx("i",{className:"bi bi-info-circle me-2"})," "]})}),t.jsxs("div",{className:"col-md-6",children:[t.jsxs("label",{className:"form-label fw-bold",children:["  ",t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsx("input",{type:"text",name:"name",value:x.name,onChange:U,className:`form-control ${A.name?"is-invalid":""}`,placeholder:"  ",readOnly:R}),A.name&&t.jsx("div",{className:"invalid-feedback",children:A.name})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsxs("label",{className:"form-label fw-bold",children:["  ",t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsx("input",{type:"email",name:"email",value:x.email,onChange:U,className:`form-control ${A.email?"is-invalid":""}`,placeholder:"  ",readOnly:R}),A.email&&t.jsx("div",{className:"invalid-feedback",children:A.email})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsxs("label",{className:"form-label fw-bold",children:["  ",t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsx("input",{type:"text",name:"phone",value:x.phone,onChange:U,className:`form-control ${A.phone?"is-invalid":""}`,placeholder:"  ",readOnly:R}),A.phone&&t.jsx("div",{className:"invalid-feedback",children:A.phone})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold",children:""}),t.jsx(rc,{name:"city",value:x.city,onChange:U,placeholder:" ",required:!1,disabled:R})]}),t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold",children:""}),t.jsx("textarea",{name:"address",value:x.address,onChange:U,className:"form-control",rows:"2",placeholder:"  ",readOnly:R})]}),t.jsx("div",{className:"col-12 mt-4",children:t.jsxs("h6",{className:"text-primary mb-3",children:[t.jsx("i",{className:"bi bi-credit-card me-2"})," "]})}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold",children:" "}),t.jsx("input",{type:"text",name:"taxNumber",value:x.taxNumber,onChange:U,className:`form-control ${A.taxNumber?"is-invalid":""}`,placeholder:"  ",readOnly:R}),A.taxNumber&&t.jsx("div",{className:"invalid-feedback",children:A.taxNumber})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold",children:"  "}),t.jsx("input",{type:"text",name:"bankAccount",value:x.bankAccount,onChange:U,className:"form-control",placeholder:"   ",readOnly:R})]}),t.jsx("div",{className:"col-12 mt-4",children:t.jsxs("h6",{className:"text-primary mb-3",children:[t.jsx("i",{className:"bi bi-card-text me-2"})," "]})}),t.jsxs("div",{className:"col-12",children:[t.jsx("label",{className:"form-label fw-bold",children:""}),t.jsx("textarea",{name:"notes",value:x.notes,onChange:U,className:"form-control",rows:"3",placeholder:"   ",readOnly:R})]}),t.jsx("div",{className:"col-md-6 d-flex justify-content-start",style:{marginTop:"20px"},children:t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("span",{className:`badge ${x.active?"bg-success":"bg-secondary"} px-3 py-2`,children:x.active?"":" "}),t.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"supplierActiveSwitch",name:"active",checked:x.active,onChange:U,style:{width:"50px",height:"25px",cursor:"pointer"}})]})})]})]}),t.jsxs("div",{className:"card-footer bg-light d-flex gap-2 justify-content-center",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:ie,disabled:q,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px"},children:""}),t.jsx("button",{type:"submit",className:"btn btn-primary",disabled:q||R,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px"},children:q?t.jsxs(t.Fragment,{children:[t.jsx(It,{size:"small"}),t.jsx("span",{className:"ms-1",children:"..."})]}):p?"":""})]})]})})})]})]}),!D&&d&&t.jsx(os,{rtl:!0}),!D&&d&&t.jsx(ls,{}),t.jsx(t6,{show:te,onClose:()=>G(!1),documents:F,setDocuments:X,supplierId:e||"new",uploadingDocument:ue,setUploadingDocument:Y,handleDocumentUpload:de,handleDeleteClick:be,deleting:z,title:"  "}),E&&t.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)",zIndex:99990},tabIndex:"-1",dir:"rtl",children:t.jsx("div",{className:"modal-dialog modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsx("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"12px 12px 0 0"},children:t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-pencil-square me-2"})," "]})}),t.jsx("div",{className:"modal-body",style:{padding:"25px"},children:t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"d-flex align-items-center mb-3",children:[t.jsx("div",{className:"bg-success bg-opacity-10 p-2 rounded-circle me-3",children:t.jsx("i",{className:"bi bi-file-earmark-check text-success"})}),t.jsxs("div",{children:[t.jsx("h6",{className:"mb-0 fw-bold text-success",children:"  "}),t.jsx("small",{className:"text-muted",children:"    "})]})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{className:"form-label fw-bold",children:" "}),t.jsx("input",{type:"text",className:"form-control",value:I,onChange:xe=>P(xe.target.value),placeholder:"  ...",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onKeyPress:xe=>{xe.key==="Enter"&&I.trim()&&ne()},autoFocus:!0}),b&&t.jsxs("small",{className:"text-muted mt-1",children:[" : ",b.name]})]})]})}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:t.jsxs("div",{className:"d-flex gap-2 w-100 justify-content-center",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:ye,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px"},children:""}),t.jsx("button",{type:"button",className:"btn btn-success",onClick:ne,disabled:!I.trim()||ue,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",opacity:I.trim()&&!ue?1:.6},children:ue?t.jsxs(t.Fragment,{children:[t.jsx(It,{size:"small"}),t.jsx("span",{className:"ms-1",children:"..."})]}):""})]})})]})})}),t.jsx("div",{style:{zIndex:9999},children:t.jsx(Mt,{show:i.show,onClose:a,title:i.title,message:i.message,type:i.type,onConfirm:i.onConfirm,showConfirm:i.showConfirm})})]})})})}function Kj(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(s6,{})})})}const n6=({onEdit:n,onAdd:e,refreshTrigger:s,searchTerm:r})=>{const[i,a]=h.useState([]),[o,l]=h.useState(!0),[c,d]=h.useState(null),[u,f]=h.useState(""),p=r!==void 0?r:u,[j,L]=h.useState([]),[R,D]=h.useState(!1),{logActivity:y,getCurrentUser:T}=Zt(),{alertConfig:x,closeAlert:S,showSuccess:A,showError:Q,showConfirm:q}=Bt(),{currentPage:B,totalPages:$,paginatedItems:H,handlePageChange:te,resetPage:G,totalItems:F,itemsPerPage:X}=cr(j,30);h.useEffect(()=>{ue()},[]),h.useEffect(()=>{s&&ue()},[s]),h.useEffect(()=>{if(p.trim()){const O=i.filter(E=>{var k,b,N;return((k=E.name)==null?void 0:k.toLowerCase().includes(p.toLowerCase()))||((b=E.email)==null?void 0:b.toLowerCase().includes(p.toLowerCase()))||((N=E.phone)==null?void 0:N.includes(p))});L(O)}else L(i);G()},[p,i,G]);const ue=async()=>{try{l(!0);const O=await ir.getAllSuppliers();a(O),d(null)}catch(O){d(O.message)}finally{l(!1)}},Y=O=>{q(`      

${O.name}`,()=>z(O),"  ")},z=async O=>{try{D(!0),await bs.moveToTrash(O,"foreignSuppliers"),await ir.deleteSupplier(O.id);const E=T();y("task",`${E.name}   `,`  : ${O.name}`),await ue(),A(`     : ${O.name}`,"  ")}catch(E){d(E.message),Q(`    : ${E.message}`,"  ")}finally{D(!1)}};return o?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"spinner-border text-primary",role:"status",children:t.jsx("span",{className:"visually-hidden",children:" ..."})}),t.jsx("p",{className:"mt-3 text-muted",children:"   ..."})]})}):c?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:c}),t.jsxs("button",{className:"btn btn-primary",onClick:ue,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):t.jsxs("div",{"data-list":"foreign-suppliers",children:[j.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-people fs-1"})}),t.jsx("h5",{className:"text-muted",children:"  "}),t.jsx("p",{className:"text-muted",children:p?"    ":"     "}),!p&&t.jsxs("button",{className:"btn btn-primary",onClick:e,children:[t.jsx("i",{className:"bi bi-plus-lg me-1"}),"  "]})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",style:{tableLayout:"fixed"},children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:"60px",textAlign:"center"},children:"#"}),t.jsx("th",{style:{width:"25%",textAlign:"right"},children:" "}),t.jsx("th",{style:{width:"25%",textAlign:"right"},children:" "}),t.jsx("th",{style:{width:"15%",textAlign:"center"},children:""}),t.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),t.jsx("th",{style:{width:"120px",textAlign:"center"},children:""})]})}),t.jsx("tbody",{children:H.map((O,E)=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",style:{verticalAlign:"middle"},children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(B-1)*X+E+1})}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:t.jsx("span",{className:"fw-bold text-primary",onClick:()=>n(O),onMouseDown:k=>k.preventDefault(),style:{cursor:"pointer",textDecoration:"underline",userSelect:"none",display:"inline-block",padding:"4px",borderRadius:"3px",transition:"background-color 0.2s"},onMouseEnter:k=>k.target.style.backgroundColor="#f8f9fa",onMouseLeave:k=>k.target.style.backgroundColor="transparent",title:`Internal ID: ${O.internalId||"Not Set"}`,role:"button",tabIndex:0,onKeyDown:k=>{(k.key==="Enter"||k.key===" ")&&(k.preventDefault(),n(O))},children:O.name})}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:t.jsx("a",{href:`mailto:${O.email}`,className:"text-decoration-none",children:O.email})}),t.jsx("td",{style:{direction:"ltr",textAlign:"center",verticalAlign:"middle"},children:O.phone}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:O.city||"-"}),t.jsx("td",{style:{textAlign:"center",verticalAlign:"middle"},children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(Tt,{can:"suppliers:update",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-primary",onClick:()=>n(O),title:"",children:t.jsx("i",{className:"bi bi-pencil"})})}),t.jsx(Tt,{can:"suppliers:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>Y(O),title:"",children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},O.internalId||O.id))})]})}),j.length>0&&t.jsx(dr,{currentPage:B,totalPages:$,onPageChange:te,totalItems:F,itemsPerPage:X}),t.jsx(Mt,{show:x.show,onClose:S,title:x.title,message:x.message,type:x.type,onConfirm:x.onConfirm,confirmText:x.confirmText,cancelText:x.cancelText,showCancel:x.showCancel})]})},r6=({searchTerm:n})=>{const[e,s]=h.useState(0),[r,i]=h.useState(0);h.useEffect(()=>{a()},[n]);const a=async()=>{try{const o=await ir.getAllSuppliers();if(s(o.length),n!=null&&n.trim()){const l=o.filter(c=>{var d,u,f,p,j;return((d=c.name)==null?void 0:d.toLowerCase().includes(n.toLowerCase()))||((u=c.email)==null?void 0:u.toLowerCase().includes(n.toLowerCase()))||((f=c.phone)==null?void 0:f.includes(n))||((p=c.country)==null?void 0:p.toLowerCase().includes(n.toLowerCase()))||((j=c.city)==null?void 0:j.toLowerCase().includes(n.toLowerCase()))});i(l.length)}else i(o.length)}catch(o){console.error("Error loading foreign suppliers count:",o),s(0),i(0)}};return t.jsx("span",{className:"badge bg-secondary ms-2",style:{fontSize:"12px",fontWeight:"normal"},children:n!=null&&n.trim()?`${r}  ${e}`:e})};function i6(){const[n,e]=h.useState(!1),[s,r]=h.useState(0),[i,a]=h.useState(""),{isTimelineVisible:o}=Ut(),l=kt(),c=()=>{e(!n)},d=()=>{l("/foreign-suppliers/add")},u=f=>{l(`/foreign-suppliers/edit/${f.id}`)};return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:c}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!o?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-primary",children:""}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"20px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef",pointerEvents:"none"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-globe2 text-primary me-2"}),"  "]}),t.jsx(r6,{searchTerm:i})]}),t.jsxs("div",{className:"d-flex align-items-center gap-3",style:{pointerEvents:"auto"},children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px",pointerEvents:"auto"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:i,onChange:f=>a(f.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px",pointerEvents:"auto"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsx("button",{onClick:d,className:"btn btn-primary",style:{height:"40px",width:"140px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap",pointerEvents:"auto"},children:"  "})]})]})}),t.jsx("div",{style:{height:"calc(100vh - 280px)",overflowY:"auto",overflowX:"hidden",position:"relative",zIndex:1},children:t.jsx("div",{className:"card-body p-0",children:t.jsx(n6,{onAdd:d,onEdit:u,refreshTrigger:s,searchTerm:i})})})]})})]}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]}),!n&&o&&t.jsx(os,{rtl:!0}),!n&&o&&t.jsx(ls,{})]})})})}function a6(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(i6,{})})})}const o6=({show:n,onClose:e,documents:s,setDocuments:r,supplierId:i,uploadingDocument:a,setUploadingDocument:o,handleDocumentUpload:l,handleDeleteClick:c,deleting:d,title:u="  ",canCreate:f=!0,canDelete:p=!0,canView:j=!0,readOnly:L=!1})=>{const{alertConfig:R,closeAlert:D,showSuccess:y,showError:T}=Bt(),{formatDate:x}=sc();return n?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.8)",zIndex:99980,position:"fixed",top:0,left:0,right:0,bottom:0},tabIndex:"-1",dir:"rtl",children:t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"12px 12px 0 0"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-globe2 me-2"}),u]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:e,"aria-label":"Close"})]}),t.jsx("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"},children:t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("div",{className:"bg-primary bg-opacity-10 p-2 rounded-circle me-3",children:t.jsx("i",{className:"bi bi-files text-primary"})}),t.jsxs("div",{children:[t.jsx("h6",{className:"mb-0 fw-bold text-primary",children:" "}),t.jsxs("small",{className:"text-muted",children:[" : ",s.length]})]})]}),t.jsxs("div",{style:{marginTop:"10px",marginBottom:"10px"},children:[t.jsx("input",{type:"file",id:"foreignSupplierDocumentUpload",onChange:l,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",style:{display:"none"}}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{console.log(" Foreign supplier upload button clicked"),console.log(" FOREIGN SUPPLIER MODAL: Starting fullscreen bypass for file picker"),Kr(2e4);const S=document.getElementById("foreignSupplierDocumentUpload");S?(S.click(),console.log(" Foreign supplier file input triggered")):console.error(" Foreign supplier file input not found")},disabled:a,style:{height:"32px",minWidth:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",fontWeight:"500"},children:a?t.jsxs(t.Fragment,{children:[t.jsx(It,{size:"small"}),t.jsx("span",{className:"ms-2",children:"..."})]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-cloud-upload me-1"})," "]})})]})]}),(console.log(" FOREIGN SUPPLIER MODAL RENDER CHECK:",new Date().toLocaleTimeString()),console.log(" Foreign Supplier Documents state:",{length:s.length,docs:s.map(S=>({name:S.fileName,url:!!S.fileURL,id:S.id}))}),null),s.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-folder2-open",style:{fontSize:"3rem"}})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:'  " "  '})]}):t.jsx("div",{className:"table-responsive",style:{maxHeight:"400px",overflowY:"auto"},children:t.jsxs("table",{className:"table table-hover",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:"#"}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""})]})}),t.jsx("tbody",{children:s.map((S,A)=>{if(!S||typeof S!="object")return null;const q=(H=>!H||typeof H!="string"?{icon:"bi-file-earmark",color:"#6c757d"}:H.includes("pdf")?{icon:"bi-file-earmark-pdf",color:"#dc3545"}:H.includes("word")||H.includes("document")?{icon:"bi-file-earmark-word",color:"#2b579a"}:H.includes("image")?{icon:"bi-file-earmark-image",color:"#198754"}:{icon:"bi-file-earmark",color:"#6c757d"})(S.fileType||""),B=S.fileName||S.originalFileName||"  ",$=S.fileSize||0;return S.uploadDate,t.jsxs("tr",{children:[t.jsx("td",{className:"text-center fw-bold text-muted",children:A+1}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:`${q.icon} me-2`,style:{color:q.color}}),t.jsx("span",{className:"fw-bold text-primary",title:B,children:B.length>25?B.substring(0,25)+"...":B})]})}),t.jsx("td",{className:"text-center",children:t.jsxs("span",{className:"badge bg-light text-dark",children:[($/1024/1024).toFixed(2)," ."]})}),t.jsx("td",{className:"text-center",children:t.jsx("small",{className:"text-muted",children:x(S.uploadedAt||S.uploadDate||new Date)})}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx("a",{href:S.fileURL||"#",target:"_blank",rel:"noopener noreferrer",className:"btn btn-primary",title:" ",style:{width:"32px",height:"32px",padding:"0",borderRadius:"6px 0 0 6px",fontSize:"12px"},onClick:H=>{S.fileURL||(H.preventDefault(),T("   ",""))},children:t.jsx("i",{className:"bi bi-eye"})}),t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>c(S),title:"",disabled:d,style:{width:"32px",height:"32px",padding:"0",borderRadius:"0 6px 6px 0",fontSize:"12px"},children:t.jsx("i",{className:"bi bi-trash"})})]})})]},S.id||`doc-${A}`)})})]})})]})}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:t.jsxs("div",{className:"d-flex",style:{gap:"10px"},children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:e,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},children:""}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>y("     "," "),style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},children:""})]})})]})})}),t.jsx(Mt,{show:R.show,onClose:D,title:R.title,message:R.message,type:R.type,onConfirm:R.onConfirm,showConfirm:R.showConfirm})]}):null};function l6(){const n=kt(),{id:e}=Dn(),{logActivity:s,getCurrentUser:r}=Zt(),{alertConfig:i,closeAlert:a,showSuccess:o,showError:l,showConfirm:c}=Bt(),{isTimelineVisible:d}=Ut(),{hasPerm:u,readOnly:f}=Yn(),p=!!e,j=u("suppliers:create"),L=u("suppliers:update"),R=f||p&&!L||!p&&!j,[D,y]=h.useState(!1),T=`foreignSupplierForm_${e||"new"}`,[x,S]=h.useState(()=>{const pe=localStorage.getItem(T);if(pe)try{return console.log(" [FORCE PERSIST] Restoring foreign supplier form data from localStorage:",pe),JSON.parse(pe)}catch(be){console.warn("Failed to parse saved foreign supplier form data:",be)}return{name:"",email:"",phone:"",address:"",city:"",country:"",taxNumber:"",bankAccount:"",notes:"",active:!0}}),[A,Q]=h.useState({}),[q,B]=h.useState(!1),[$,H]=h.useState(!1),[te,G]=h.useState(!1),[F,X]=h.useState([]),[ue,Y]=h.useState(!1),[z,O]=h.useState(!1),[E,k]=h.useState(!1),[b,N]=h.useState(null),[I,P]=h.useState(""),_=()=>{y(!D)};h.useEffect(()=>{const pe=()=>{try{localStorage.setItem(T,JSON.stringify(x)),console.log(" [FORCE PERSIST] Foreign supplier form data saved on beforeunload")}catch(Ee){console.warn("Failed to save foreign supplier form data on beforeunload:",Ee)}},be=()=>{if(document.hidden)try{localStorage.setItem(T,JSON.stringify(x)),console.log(" [FORCE PERSIST] Foreign supplier form data saved on visibility change")}catch(Ee){console.warn("Failed to save foreign supplier form data on visibility change:",Ee)}},xe=()=>{try{localStorage.setItem(T,JSON.stringify(x)),console.log(" [FORCE PERSIST] Foreign supplier form data saved on window blur")}catch(Ee){console.warn("Failed to save foreign supplier form data on window blur:",Ee)}};return window.addEventListener("beforeunload",pe),document.addEventListener("visibilitychange",be),window.addEventListener("blur",xe),()=>{window.removeEventListener("beforeunload",pe),document.removeEventListener("visibilitychange",be),window.removeEventListener("blur",xe)}},[x,T]),h.useEffect(()=>{p&&e&&(localStorage.getItem(T)?console.log(" [FORCE PERSIST] User changes exist, preserving foreign supplier form data"):C())},[p,e]);const C=async()=>{try{H(!0),console.log(" Loading foreign supplier data for ID:",e);const pe=await ir.getSupplierById(e);console.log(" Foreign supplier data loaded:",pe),S({name:pe.name||"",email:pe.email||"",phone:pe.phone||"",address:pe.address||"",city:pe.city||"",country:pe.country||"",taxNumber:pe.taxNumber||"",bankAccount:pe.bankAccount||"",notes:pe.notes||"",active:pe.active!==void 0?pe.active:!0}),console.log(" Loading foreign supplier documents from multiple sources...");let be=[];pe.documents&&Array.isArray(pe.documents)&&(console.log(` Found ${pe.documents.length} embedded foreign supplier documents`),be=[...pe.documents]);try{const xe=await Ss.loadForeignSupplierDocumentsFromFirestore(e);if(xe&&xe.length>0){console.log(` Found ${xe.length} foreign supplier documents in Firestore subcollection`);const Ee=xe.map(fe=>fe.id);be=[...be.filter(fe=>!Ee.includes(fe.id)),...xe],console.log(` Merged total foreign supplier documents: ${be.length}`)}}catch(xe){console.log("No foreign supplier documents found in Firestore subcollection or error loading:",xe.message)}X(be),console.log(` Final foreign supplier documents loaded: ${be.length}`)}catch(pe){console.error(" Error loading foreign supplier data:",pe),l("     ",""),n("/suppliers/foreign")}finally{H(!1)}},U=pe=>{const{name:be,value:xe,type:Ee,checked:Re}=pe.target,fe={...x,[be]:Ee==="checkbox"?Re:xe};S(fe);try{localStorage.setItem(T,JSON.stringify(fe)),console.log(" [FORCE PERSIST] Foreign supplier form data saved to localStorage on every change")}catch(Ve){console.warn("Failed to save foreign supplier form data to localStorage:",Ve)}A[be]&&Q(Ve=>({...Ve,[be]:""}))},w=()=>{const pe={};return x.name.trim()||(pe.name="  "),x.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x.email)||(pe.email="   "):pe.email="  ",x.phone.trim()||(pe.phone="  "),x.country.trim()||(pe.country=" "),Q(pe),Object.keys(pe).length===0},W=async pe=>{if(pe.preventDefault(),console.log(" Submit button clicked, form data:",x),!w()){console.log(" Form validation failed");return}console.log(" Form validation passed, proceeding with save");try{B(!0);try{await Bn.isEmailUnique(x.email,p?e:null,"foreignSuppliers")}catch(Re){Q(fe=>({...fe,email:Re.message})),B(!1);return}try{await Bn.isPhoneUnique(x.phone,p?e:null,"foreignSuppliers")}catch(Re){Q(fe=>({...fe,phone:Re.message})),B(!1);return}if(x.taxNumber)try{await Bn.isTaxNumberUnique(x.taxNumber,p?e:null,"foreignSuppliers")}catch(Re){Q(fe=>({...fe,taxNumber:Re.message})),B(!1);return}const be={...x,documents:F,updatedAt:new Date().toISOString()};p||(be.createdAt=new Date().toISOString());let xe,Ee;if(p?(xe=await ir.updateSupplier(e,be),Ee=e,s("task",`${r().name}   `,`  : ${x.name}`),o("    "," ")):(xe=await ir.createSupplier(be),Ee=xe.id||xe,s("task",`${r().name}   `,`  : ${x.name}`),o("    "," ")),F.length>0&&Ee)try{console.log(` Saving ${F.length} foreign supplier documents to Firestore subcollection for supplier ${Ee}...`),await Ss.saveForeignSupplierDocumentsToFirestore(Ee,F),console.log(" Foreign supplier documents saved to Firestore subcollection successfully")}catch(Re){console.error(" Error saving foreign supplier documents to subcollection:",Re)}else console.log(" No foreign supplier documents to save or missing supplier ID");try{localStorage.removeItem(T),console.log(" [FORCE PERSIST] Cleared foreign supplier form data from localStorage on successful save")}catch(Re){console.warn("Failed to clear foreign supplier form data from localStorage:",Re)}setTimeout(()=>{n("/suppliers/foreign")},1500)}catch(be){console.error("Error saving foreign supplier:",be),l(p?"    ":"    ","")}finally{B(!1)}},ie=()=>{console.log(" Cancel button clicked - navigating directly to list"),n("/suppliers/foreign")},de=async pe=>{const be=pe.target.files[0];be&&(console.log(" Foreign supplier file selected:",be.name),N({file:be,target:pe.target}),k(!0))},ne=async()=>{if(!b||!I.trim()){l("   ","");return}try{Y(!0),console.log(" Starting foreign supplier document upload...");const pe=p?e:"temp_"+Date.now(),be=await Ss.uploadForeignSupplierDocument(pe,b.file,I.trim());console.log(" Foreign supplier document upload successful:",be);const xe={id:`doc_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,fileName:be.fileName,originalFileName:b.file.name,fileURL:be.downloadURL,fileSize:b.file.size,fileType:b.file.type,uploadDate:new Date().toISOString(),uploadedAt:new Date().toISOString()};X(Ee=>{const Re=[...Ee,xe];return p&&e&&e!=="new"&&Ss.saveForeignSupplierDocumentsToFirestore(e,Re).then(()=>{console.log(" Foreign supplier document saved to Firestore subcollection")}).catch(fe=>{console.error(" Error saving foreign supplier document to Firestore subcollection:",fe)}),Re}),o("   "," "),b.target&&(b.target.value=""),N(null),P(""),k(!1)}catch(pe){console.error(" Error uploading foreign supplier document:",pe),l(pe.message||"   ","")}finally{Y(!1)}},ye=async pe=>{console.log(" Delete button clicked for foreign supplier document:",pe.fileName),c(`      "${pe.fileName}"`,async()=>{try{O(!0),console.log(" Moving foreign supplier document to trash:",pe);const be={...pe,originalCollection:"foreign_supplier_documents",originalSupplierId:p?e:null,context:{supplierName:x.name||" ",supplierId:p?e:null}};if(await bs.moveToTrash(be,"foreign_supplier_documents"),p&&e&&e!=="new")try{await Ss.deleteForeignSupplierDocumentFromFirestore(e,pe.id),console.log(" Foreign supplier document removed from Firestore subcollection");const xe=F.filter(Ee=>Ee.id!==pe.id);await ir.updateSupplier(e,{documents:xe,updatedAt:new Date().toISOString()}),console.log(" Foreign supplier document removed from embedded documents array")}catch(xe){console.error(" Error removing foreign supplier document from storage:",xe)}X(xe=>xe.filter(Ee=>Ee.id!==pe.id)),s("task",`${r().name}    `,`  : ${pe.fileName}`),o("     "," ")}catch(be){console.error(" Error deleting foreign supplier document:",be),l("   ","")}finally{O(!1)}}," ")};return $?t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"100vh"},children:t.jsxs("div",{className:"text-center",children:[t.jsx(It,{size:"large"}),t.jsx("p",{className:"mt-3 text-muted",children:"    ..."})]})}):t.jsx(Lt,{children:t.jsxs(Ft,{children:[t.jsxs("div",{className:`page-wrapper ${D?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:_}),t.jsxs("div",{className:"main-container",style:{paddingRight:D?"72px":"250px",paddingLeft:D||!d?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:D?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:D})}),t.jsxs("div",{className:"app-container",children:[t.jsxs("div",{style:{position:"sticky",top:0,zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsx("a",{href:"/suppliers/foreign",className:"text-decoration-none text-primary",children:" "})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:p?"  ":"  "})]})}),t.jsx("div",{className:"d-flex justify-content-end align-items-center px-3 py-2 bg-light border-bottom",children:t.jsx("button",{onClick:()=>G(!0),className:"btn btn-primary",style:{height:"32px",minWidth:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center"},children:" "})})]}),t.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"60px"},children:t.jsxs("form",{onSubmit:W,children:[t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-primary text-white",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-globe2 me-2"}),p?"  ":"   "]})}),t.jsxs("div",{className:"card-body",children:[R&&t.jsx("div",{className:"alert alert-info border-0 shadow-sm mb-4",children:t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-info-circle-fill text-info me-3 fs-5"}),t.jsxs("div",{children:[t.jsx("strong",{className:"fw-bold",children:"  "}),t.jsx("div",{className:"mt-1",children:t.jsxs("span",{className:"ms-2",children:[!L&&p&&"    ",!j&&!p&&"     ",f&&"     "]})})]})]})}),t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:"  *"}),t.jsx("input",{type:"text",name:"name",value:x.name,onChange:U,className:`form-control ${A.name?"is-invalid":""}`,placeholder:"  ",readOnly:R}),A.name&&t.jsx("div",{className:"invalid-feedback",children:A.name})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:"  *"}),t.jsx("input",{type:"email",name:"email",value:x.email,onChange:U,className:`form-control ${A.email?"is-invalid":""}`,placeholder:"example@company.com",readOnly:R}),A.email&&t.jsx("div",{className:"invalid-feedback",children:A.email})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:"  *"}),t.jsx("input",{type:"tel",name:"phone",value:x.phone,onKeyPress:pe=>{/[0-9+]/.test(pe.key)||pe.preventDefault()},onChange:pe=>{const be=pe.target.value.replace(/[^0-9+]/g,"");U({target:{name:"phone",value:be}})},className:`form-control ${A.phone?"is-invalid":""}`,placeholder:"+966 50 123 4567"}),A.phone&&t.jsx("div",{className:"invalid-feedback",children:A.phone})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:""}),t.jsx(rc,{name:"city",value:x.city,onChange:U,placeholder:" ",required:!1})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:" *"}),t.jsx("input",{type:"text",name:"country",value:x.country,onChange:U,className:`form-control ${A.country?"is-invalid":""}`,placeholder:""}),A.country&&t.jsx("div",{className:"invalid-feedback",children:A.country})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:" "}),t.jsx("input",{type:"text",name:"taxNumber",value:x.taxNumber,onChange:U,className:`form-control ${A.taxNumber?"is-invalid":""}`,placeholder:" "}),A.taxNumber&&t.jsx("div",{className:"invalid-feedback",children:A.taxNumber})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:"  "}),t.jsx("input",{type:"text",name:"bankAccount",value:x.bankAccount,onChange:U,className:"form-control",placeholder:"  "})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:""}),t.jsx("textarea",{name:"address",value:x.address,onChange:U,className:"form-control",rows:"3",placeholder:"  "})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:""}),t.jsx("textarea",{name:"notes",value:x.notes,onChange:U,className:"form-control",rows:"3",placeholder:"   "})]}),t.jsx("div",{className:"col-md-6 d-flex justify-content-start",style:{marginTop:"20px"},children:t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("span",{className:`badge ${x.active?"bg-success":"bg-secondary"} px-3 py-2`,children:x.active?"":" "}),t.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"foreignSupplierActiveSwitch",name:"active",checked:x.active,onChange:U,style:{width:"50px",height:"25px",cursor:"pointer"}})]})})]})]})]}),t.jsxs("div",{className:"card-footer bg-light d-flex gap-2 justify-content-center",style:{marginTop:"20px",padding:"20px"},children:[t.jsx("button",{type:"button",onClick:ie,className:"btn btn-secondary",disabled:q,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),t.jsx("button",{type:"submit",className:"btn btn-primary",disabled:q||R,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:q?t.jsxs(t.Fragment,{children:[t.jsx(It,{size:"small"}),t.jsx("span",{className:"ms-1",children:"..."})]}):p?"":""})]})]})})})]})]}),!D&&d&&t.jsx(os,{rtl:!0}),!D&&d&&t.jsx(ls,{})]}),t.jsx(o6,{show:te,onClose:()=>G(!1),documents:F,setDocuments:X,supplierId:p?e:null,uploadingDocument:ue,setUploadingDocument:Y,handleDocumentUpload:de,handleDeleteClick:ye,deleting:z,title:"  "}),E&&t.jsx("div",{className:"modal show d-block",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.9)",zIndex:99990},children:t.jsx("div",{className:"modal-dialog modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h5",{className:"modal-title",children:" "}),t.jsx("button",{type:"button",className:"btn-close",onClick:()=>k(!1)})]}),t.jsx("div",{className:"modal-body",children:t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:" "}),t.jsx("input",{type:"text",className:"form-control",value:I,onChange:pe=>P(pe.target.value),placeholder:"  ",autoFocus:!0}),b&&t.jsxs("small",{className:"text-muted",children:[" : ",b.file.name]})]})}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:t.jsxs("div",{className:"d-flex gap-2 w-100 justify-content-center",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>k(!1),style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px"},children:""}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:ne,disabled:ue||!I.trim(),style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px"},children:ue?t.jsxs(t.Fragment,{children:[t.jsx(It,{size:"small"}),t.jsx("span",{className:"ms-2",children:"..."})]}):""})]})})]})})}),t.jsx("div",{style:{zIndex:9999},children:t.jsx(Mt,{show:i.show,onClose:a,title:i.title,message:i.message,type:i.type,onConfirm:i.onConfirm,showConfirm:i.showConfirm})})]})})}function Yj(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(l6,{})})})}function c6(){const[n,e]=h.useState(!1),[s,r]=h.useState([]),[i,a]=h.useState([]),[o,l]=h.useState(!0),[c,d]=h.useState(null),[u,f]=h.useState(""),[p,j]=h.useState(null),[L,R]=h.useState({filtered:0,total:0}),{isTimelineVisible:D}=Ut(),y=kt(),[T]=Eh(),x=T.get("returnPath")||"/raw-materials";T.get("materialId"),T.get("materialType");const{currentPage:S,totalPages:A,paginatedItems:Q,handlePageChange:q,resetPage:B,totalItems:$,itemsPerPage:H}=cr(i,30),te=()=>{e(!n)},G=E=>{console.log(" LocalSupplierSelection: Search term received:",E),f(E)},F=()=>{console.log(" LocalSupplierSelection: Clearing search"),f("")},X=h.useCallback(E=>{console.log(" LocalSupplierSelection: Search stats received:",E),R(E)},[]);h.useEffect(()=>{console.log(" LocalSupplierSelection: Search term state changed to:",u)},[u]);const ue=async()=>{try{l(!0);const E=await rr.getAllSuppliers(),b=Kf(E).filter(N=>N.active!==!1);r(b),d(null)}catch(E){d(E.message)}finally{l(!1)}};h.useEffect(()=>{ue()},[]),h.useEffect(()=>{if(console.log(" LocalSupplierSelection: Search term changed:",u),u&&u.trim()){const E=u.toLowerCase(),k=s.filter(b=>{var N,I,P,_,C,U;return((N=b.name)==null?void 0:N.toLowerCase().includes(E))||((I=b.email)==null?void 0:I.toLowerCase().includes(E))||((P=b.phone)==null?void 0:P.includes(u))||((_=b.contactPerson)==null?void 0:_.toLowerCase().includes(E))||((C=b.category)==null?void 0:C.toLowerCase().includes(E))||((U=b.taxNumber)==null?void 0:U.includes(u))});console.log(" LocalSupplierSelection: Filtered results:",k.length,"of",s.length),a(k)}else console.log(" LocalSupplierSelection: No search, showing all suppliers"),a(s);B()},[u,s,B]),h.useEffect(()=>{const E=i.length,k=s.length;console.log(" LocalSupplierSelection: Reporting stats:",{filtered:E,total:k}),X({filtered:E,total:k})},[i.length,s.length,X]);const Y=E=>{j(E)},z=()=>{if(!p)return;const E={id:p.id,name:p.name,email:p.email,phone:p.phone,city:p.city,type:"local"};sessionStorage.setItem("selectedSupplier",JSON.stringify(E)),sessionStorage.setItem("openPriceModal","true"),y(x)},O=()=>{y(x)};return o?t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:te}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!D?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsx("div",{className:"app-container",children:t.jsx("div",{className:"app-content-area p-4",children:t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"spinner-border text-primary",role:"status",children:t.jsx("span",{className:"visually-hidden",children:" ..."})}),t.jsx("p",{className:"mt-3 text-muted",children:"    ..."})]})})})})]})]}):c?t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:te}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!D?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsx("div",{className:"app-container",children:t.jsx("div",{className:"app-content-area p-4",children:t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:c}),t.jsx("div",{className:"d-flex gap-2 justify-content-center",children:t.jsxs("button",{className:"btn btn-primary",onClick:ue,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"  "]})})]})})})})]})]}):t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:te}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!D?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"20px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsx("div",{className:"d-flex align-items-center",children:t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-people-fill text-primary me-2"}),"  "]})}),t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px",pointerEvents:"auto"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:u,onChange:E=>G(E.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px",pointerEvents:"auto"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("button",{onClick:O,className:"btn btn-outline-secondary",style:{height:"40px",width:"80px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:""}),t.jsx("button",{onClick:z,disabled:!p,className:"btn btn-primary",style:{height:"40px",width:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:" "})]})]})]})}),t.jsx(Yf,{searchTerm:u,filteredCount:L.filtered,totalCount:L.total,onClearSearch:F}),t.jsx("div",{style:{height:"calc(100vh - 280px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"card-body p-0",children:i.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-people fs-1"})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:u?"    ":"      "}),u&&t.jsxs("button",{className:"btn btn-primary",onClick:F,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",style:{tableLayout:"fixed"},children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:"60px",textAlign:"center"},children:"#"}),t.jsx("th",{style:{width:"25%",textAlign:"right"},children:" "}),t.jsx("th",{style:{width:"25%",textAlign:"right"},children:" "}),t.jsx("th",{style:{width:"15%",textAlign:"center"},children:""}),t.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),t.jsx("th",{style:{width:"120px",textAlign:"center"},children:""})]})}),t.jsx("tbody",{children:Q.map((E,k)=>t.jsxs("tr",{onClick:()=>Y(E),style:{cursor:"pointer",backgroundColor:(p==null?void 0:p.id)===E.id?"#e3f2fd":"inherit"},className:(p==null?void 0:p.id)===E.id?"table-active":"",children:[t.jsx("td",{className:"text-center",style:{verticalAlign:"middle"},children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(S-1)*H+k+1})}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:t.jsx("span",{className:"fw-bold text-primary supplier-name-link",style:{cursor:"pointer",textDecoration:"none",color:(p==null?void 0:p.id)===E.id?"#0056b3 !important":"#007bff !important"},children:E.name})}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:t.jsx("a",{href:`mailto:${E.email}`,className:"text-decoration-none",children:E.email})}),t.jsx("td",{style:{direction:"ltr",textAlign:"center",verticalAlign:"middle"},children:E.phone}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:E.city||"-"}),t.jsx("td",{style:{textAlign:"center",verticalAlign:"middle"},children:t.jsx("div",{className:"form-check d-flex justify-content-center",children:t.jsx("input",{className:"form-check-input",type:"radio",name:"selectedSupplier",checked:(p==null?void 0:p.id)===E.id,onChange:()=>{},style:{pointerEvents:"none",width:"18px",height:"18px",borderWidth:"2px"}})})})]},E.internalId||E.id))})]})})})})]})})]}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]}),i.length>0&&t.jsx("div",{style:{position:"fixed",bottom:"50px",left:"50%",transform:"translateX(-50%)",zIndex:12},children:t.jsx(dr,{currentPage:S,totalPages:A,onPageChange:q,totalItems:$,itemsPerPage:H})})]})}function d6(){const[n,e]=h.useState(!1),[s,r]=h.useState([]),[i,a]=h.useState([]),[o,l]=h.useState(!0),[c,d]=h.useState(null),[u,f]=h.useState(""),[p,j]=h.useState(null),[L,R]=h.useState({filtered:0,total:0}),{isTimelineVisible:D}=Ut(),y=kt(),[T]=Eh(),x=T.get("returnPath")||"/raw-materials";T.get("materialId"),T.get("materialType");const{currentPage:S,totalPages:A,paginatedItems:Q,handlePageChange:q,resetPage:B,totalItems:$,itemsPerPage:H}=cr(i,30),te=()=>{e(!n)},G=E=>{console.log(" ForeignSupplierSelection: Search term received:",E),f(E)},F=()=>{console.log(" ForeignSupplierSelection: Clearing search"),f("")},X=h.useCallback(E=>{console.log(" ForeignSupplierSelection: Search stats received:",E),R(E)},[]);h.useEffect(()=>{console.log(" ForeignSupplierSelection: Search term state changed to:",u)},[u]);const ue=async()=>{try{l(!0);const E=await ir.getAllForeignSuppliers(),b=Kf(E).filter(N=>N.active!==!1);r(b),d(null)}catch(E){d(E.message)}finally{l(!1)}};h.useEffect(()=>{ue()},[]),h.useEffect(()=>{if(console.log(" ForeignSupplierSelection: Search term changed:",u),u&&u.trim()){const E=u.toLowerCase(),k=s.filter(b=>{var N,I,P,_,C,U,w;return((N=b.name)==null?void 0:N.toLowerCase().includes(E))||((I=b.email)==null?void 0:I.toLowerCase().includes(E))||((P=b.phone)==null?void 0:P.includes(u))||((_=b.contactPerson)==null?void 0:_.toLowerCase().includes(E))||((C=b.country)==null?void 0:C.toLowerCase().includes(E))||((U=b.city)==null?void 0:U.toLowerCase().includes(E))||((w=b.company)==null?void 0:w.toLowerCase().includes(E))});console.log(" ForeignSupplierSelection: Filtered results:",k.length,"of",s.length),a(k)}else console.log(" ForeignSupplierSelection: No search, showing all suppliers"),a(s);B()},[u,s,B]),h.useEffect(()=>{const E=i.length,k=s.length;console.log(" ForeignSupplierSelection: Reporting stats:",{filtered:E,total:k}),X({filtered:E,total:k})},[i.length,s.length,X]);const Y=E=>{j(E)},z=()=>{if(!p)return;const E={id:p.id,name:p.name,email:p.email,phone:p.phone,country:p.country,city:p.city,type:"foreign"};sessionStorage.setItem("selectedSupplier",JSON.stringify(E)),sessionStorage.setItem("openPriceModal","true"),y(x)},O=()=>{y(x)};return o?t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:te}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!D?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsx("div",{className:"app-container",children:t.jsx("div",{className:"app-content-area p-4",children:t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"spinner-border text-primary",role:"status",children:t.jsx("span",{className:"visually-hidden",children:" ..."})}),t.jsx("p",{className:"mt-3 text-muted",children:"    ..."})]})})})})]})]}):c?t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:te}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!D?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsx("div",{className:"app-container",children:t.jsx("div",{className:"app-content-area p-4",children:t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:c}),t.jsx("div",{className:"d-flex gap-2 justify-content-center",children:t.jsxs("button",{className:"btn btn-primary",onClick:ue,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"  "]})})]})})})})]})]}):t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:te}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!D?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"20px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsx("div",{className:"d-flex align-items-center",children:t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-globe text-primary me-2"}),"  "]})}),t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px",pointerEvents:"auto"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:u,onChange:E=>G(E.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px",pointerEvents:"auto"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("button",{onClick:O,className:"btn btn-outline-secondary",style:{height:"40px",width:"80px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:""}),t.jsx("button",{onClick:z,disabled:!p,className:"btn btn-primary",style:{height:"40px",width:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:" "})]})]})]})}),t.jsx(Yf,{searchTerm:u,filteredCount:L.filtered,totalCount:L.total,onClearSearch:F}),t.jsx("div",{style:{height:"calc(100vh - 280px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"card-body p-0",children:i.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-globe fs-1"})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:u?"    ":"      "}),u&&t.jsxs("button",{className:"btn btn-primary",onClick:F,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",style:{tableLayout:"fixed"},children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:"60px",textAlign:"center"},children:"#"}),t.jsx("th",{style:{width:"20%",textAlign:"right"},children:" "}),t.jsx("th",{style:{width:"20%",textAlign:"right"},children:" "}),t.jsx("th",{style:{width:"15%",textAlign:"center"},children:""}),t.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),t.jsx("th",{style:{width:"10%",textAlign:"right"},children:""}),t.jsx("th",{style:{width:"120px",textAlign:"center"},children:""})]})}),t.jsx("tbody",{children:Q.map((E,k)=>t.jsxs("tr",{onClick:()=>Y(E),style:{cursor:"pointer",backgroundColor:(p==null?void 0:p.id)===E.id?"#e3f2fd":"inherit"},className:(p==null?void 0:p.id)===E.id?"table-active":"",children:[t.jsx("td",{className:"text-center",style:{verticalAlign:"middle"},children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(S-1)*H+k+1})}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:t.jsx("span",{className:"fw-bold text-primary supplier-name-link",style:{cursor:"pointer",textDecoration:"none",color:(p==null?void 0:p.id)===E.id?"#0056b3 !important":"#007bff !important"},children:E.name})}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:t.jsx("a",{href:`mailto:${E.email}`,className:"text-decoration-none",children:E.email})}),t.jsx("td",{style:{direction:"ltr",textAlign:"center",verticalAlign:"middle"},children:E.phone}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:E.country||"-"}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:E.city||"-"}),t.jsx("td",{style:{textAlign:"center",verticalAlign:"middle"},children:t.jsx("div",{className:"form-check d-flex justify-content-center",children:t.jsx("input",{className:"form-check-input",type:"radio",name:"selectedSupplier",checked:(p==null?void 0:p.id)===E.id,onChange:()=>{},style:{pointerEvents:"none",width:"18px",height:"18px",borderWidth:"2px"}})})})]},E.internalId||E.id))})]})})})})]})})]}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]}),i.length>0&&t.jsx("div",{style:{position:"fixed",bottom:"50px",left:"50%",transform:"translateX(-50%)",zIndex:12},children:t.jsx(dr,{currentPage:S,totalPages:A,onPageChange:q,totalItems:$,itemsPerPage:H})})]})}const ha="services",cu=()=>{window.dispatchEvent(new CustomEvent("servicesUpdated"))};class Sa{static async getAllServices(){try{const e=Pe(ae,ha),s=st(e,as("createdAt","desc"));return(await qe(s)).docs.map(i=>{var o,l;const a=i.data();return{id:i.id,internalId:a.internalId||Ct("SERVICE"),...a,createdAt:(o=a.createdAt)==null?void 0:o.toDate(),updatedAt:(l=a.updatedAt)==null?void 0:l.toDate()}})}catch(e){throw console.error("Error fetching services:",e),e}}static async getServiceById(e){var s,r;try{const i=Le(ae,ha,e),a=await ss(i);if(a.exists()){const o=a.data();return{id:a.id,...o,createdAt:(s=o.createdAt)==null?void 0:s.toDate(),updatedAt:(r=o.updatedAt)==null?void 0:r.toDate()}}else throw new Error("  ")}catch(i){throw console.error("Error fetching service:",i),i}}static async getServiceByInternalId(e){var s,r;try{const i=Pe(ae,ha),a=st(i,xt("internalId","==",e)),o=await qe(a);if(o.empty)throw new Error("  ");{const l=o.docs[0],c=l.data();return{id:l.id,...c,createdAt:(s=c.createdAt)==null?void 0:s.toDate(),updatedAt:(r=c.updatedAt)==null?void 0:r.toDate()}}}catch(i){throw console.error("Error fetching service by internal ID:",i),i}}static async createService(e){try{const s=Ct("SERVICE"),r=new Date,i={...e,internalId:s,createdAt:We(),updatedAt:We(),active:!0},a=await As(Pe(ae,ha),i);return cu(),{id:a.id,...i,createdAt:r,updatedAt:r}}catch(s){throw console.error("Error creating service:",s),s}}static async updateService(e,s){try{const r=Le(ae,ha,e),i={...s,updatedAt:We()};return await Qt(r,i),cu(),{id:e,...i,updatedAt:new Date}}catch(r){throw console.error("Error updating service:",r),r}}static async deleteService(e){try{const s=Le(ae,ha,e);return await es(s),cu(),e}catch(s){throw console.error("Error deleting service:",s),s}}static async deactivateService(e){try{const s=Le(ae,ha,e);return await Qt(s,{active:!1,updatedAt:We()}),cu(),e}catch(s){throw console.error("Error deactivating service:",s),s}}static async activateService(e){try{const s=Le(ae,ha,e);return await Qt(s,{active:!0,updatedAt:We()}),cu(),e}catch(s){throw console.error("Error activating service:",s),s}}static async searchServices(e){try{const s=Pe(ae,ha),r=st(s,as("createdAt","desc")),i=await qe(r),a=e.toLowerCase();return i.docs.map(o=>{var c,d;const l=o.data();return{id:o.id,...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}}).filter(o=>{var l,c,d,u;return((l=o.name)==null?void 0:l.toLowerCase().includes(a))||((c=o.type)==null?void 0:c.toLowerCase().includes(a))||((d=o.description)==null?void 0:d.toLowerCase().includes(a))||((u=o.provider)==null?void 0:u.toLowerCase().includes(a))})}catch(s){throw console.error("Error searching services:",s),s}}}const z0=Object.freeze(Object.defineProperty({__proto__:null,ServiceService:Sa},Symbol.toStringTag,{value:"Module"}));function u6(){const[n,e]=h.useState(!1),[s,r]=h.useState([]),[i,a]=h.useState([]),[o,l]=h.useState(!0),[c,d]=h.useState(""),[u,f]=h.useState([]),[p,j]=h.useState(!1),[L,R]=h.useState(null),{isTimelineVisible:D}=Ut(),{logActivity:y,getCurrentUser:T}=Zt(),{alertConfig:x,closeAlert:S,showSuccess:A,showError:Q,showConfirm:q}=Bt(),B=kt(),$=()=>{e(!n)};h.useEffect(()=>{H();const z=k=>{k.type==="servicesUpdated"&&H()},O=()=>{H()};window.addEventListener("storage",z),window.addEventListener("servicesUpdated",O);const E=()=>{H()};return window.addEventListener("focus",E),()=>{window.removeEventListener("storage",z),window.removeEventListener("servicesUpdated",O),window.removeEventListener("focus",E)}},[]),h.useEffect(()=>{if(c.trim()){const z=s.filter(O=>{var E,k,b,N;return((E=O.name)==null?void 0:E.toLowerCase().includes(c.toLowerCase()))||((k=O.type)==null?void 0:k.toLowerCase().includes(c.toLowerCase()))||((b=O.description)==null?void 0:b.toLowerCase().includes(c.toLowerCase()))||((N=O.provider)==null?void 0:N.toLowerCase().includes(c.toLowerCase()))});a(z)}else a(s)},[c,s]);const H=async()=>{try{l(!0);const O=(await Sa.getAllServices()).filter(E=>E.active!==!1);r(O),a(O)}catch(z){console.error("Error loading services:",z),Q("    ","")}finally{l(!1)}},te=z=>{R(z),q(" ",`      "${z.name}"`,()=>{G(z)})},G=async z=>{try{await Sa.deleteService(z.id);const O=T();O&&O.name&&y("delete",`${O.name}  `,`  : ${z.name}`),A("   "," "),H()}catch(O){console.error("Error deleting service:",O),Q("   ","")}},F=()=>{if(u.length===0){Q("      ","   ");return}q("  ",`     ${u.length} `,()=>{X()})},X=async()=>{try{for(const O of u)await Sa.deleteService(O);const z=T();z&&z.name&&y("delete",`${z.name}   `,`  ${u.length} `),A(`  ${u.length}  `," "),f([]),H()}catch(z){console.error("Error deleting services:",z),Q("   ","")}},ue=z=>{f(O=>O.includes(z)?O.filter(E=>E!==z):[...O,z])},Y=()=>{u.length===i.length?f([]):f(i.map(z=>z.id))};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[t.jsx(Rt,{onToggle:$}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!D?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:""})]})}),t.jsx("div",{className:"app-content-area p-4",children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsx("div",{className:"d-flex align-items-center",children:t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-wrench-adjustable-circle text-primary me-2"}),"  (",i.length,")"]})}),t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:c,onChange:z=>d(z.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsx("button",{onClick:()=>B("/services/add"),className:"btn btn-primary",style:{height:"40px",width:"140px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:" "}),u.length>0&&t.jsxs("button",{onClick:F,className:"btn btn-danger",style:{height:"40px",width:"160px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:["  (",u.length,")"]})]})]})}),t.jsx("div",{className:"card-body p-0",children:o?t.jsxs("div",{className:"text-center py-5",children:[t.jsx(It,{size:"large"}),t.jsx("p",{className:"text-muted mt-3",children:"  ..."})]}):i.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-wrench-adjustable-circle fs-1"})}),t.jsx("h5",{className:"text-muted",children:"  "}),t.jsx("p",{className:"text-muted",children:c?"    ":"     "}),!c&&t.jsx("button",{className:"btn btn-primary mt-3",onClick:()=>B("/services/add"),children:"  "})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"50px"},children:t.jsx("div",{className:"form-check d-flex justify-content-center",children:t.jsx("input",{className:"form-check-input",type:"checkbox",checked:u.length===i.length&&i.length>0,onChange:Y,style:{transform:"scale(1.2)"}})})}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""})]})}),t.jsx("tbody",{children:i.map(z=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",children:t.jsx("div",{className:"form-check d-flex justify-content-center",children:t.jsx("input",{className:"form-check-input",type:"checkbox",checked:u.includes(z.id),onChange:()=>ue(z.id),style:{transform:"scale(1.2)"}})})}),t.jsx("td",{className:"text-center",children:t.jsx(Tt,{can:"products:update",mode:"fallback",fallback:z.name||" ",children:t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:()=>B(`/services/edit/${z.id}`),title:` : ${z.name}`,children:z.name||" "})})}),t.jsx("td",{className:"text-center",children:z.type||"-"}),t.jsx("td",{className:"text-center",children:z.provider||"-"}),t.jsx("td",{className:"text-center",children:z.price?t.jsxs("span",{className:"fw-bold text-success",children:[z.price," "]}):"-"}),t.jsx("td",{className:"text-center",children:z.description?t.jsx("span",{className:"text-muted",children:z.description.length>30?z.description.substring(0,30)+"...":z.description}):"-"}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"btn-group",role:"group",children:[t.jsx(Tt,{can:"products:update",mode:"disable",children:t.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>B(`/services/edit/${z.id}`),title:"",children:t.jsx("i",{className:"bi bi-pencil"})})}),t.jsx(Tt,{can:"products:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>te(z),title:"",children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},z.id))})]})})})]})}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&D&&t.jsx(os,{rtl:!0}),!n&&D&&t.jsx(ls,{})]}),t.jsx(Mt,{show:x.show,onClose:S,title:x.title,message:x.message,type:x.type,onConfirm:x.onConfirm,showConfirm:x.showConfirm})]})}function h6(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(u6,{})})})}function m6(){const[n,e]=h.useState([""]),[s,r]=h.useState(!0),i=["","","","",""];h.useEffect(()=>{(async()=>{try{await Dr.initialize();const l=Dr.getSetting("sidebar-active-button");l&&e([l])}catch(l){console.error("Error loading active button:",l)}finally{r(!1)}})()},[]),h.useEffect(()=>{!s&&n.length>0&&Dr.setSetting("sidebar-active-button",n[0])},[n,s]);const a=o=>{i.includes(o)&&(n.includes(o)||e([o]))};return t.jsx("div",{className:"rectangle-buttons-row px-3 py-2",style:{backgroundColor:"#e6f3ff",borderBottom:"1px solid #b3d9ff"},children:t.jsx("div",{className:"d-flex align-items-center gap-3",children:i.map((o,l)=>{const c=n.includes(o);return t.jsx("div",{className:"rectangle-button d-flex align-items-center justify-content-center",onClick:()=>a(o),style:{background:c?"linear-gradient(135deg, #007bff 0%, #0056b3 100%)":"#e9ecef",border:`1px solid ${c?"#0056b3":"#dee2e6"}`,borderRadius:"6px",padding:"4px 8px",fontSize:"12px",color:c?"white":"#212529",transition:"all 0.2s ease",cursor:"pointer",minHeight:"24px",width:"80px",textAlign:"center"},onMouseEnter:d=>{c?(d.currentTarget.style.background="linear-gradient(135deg, #0056b3 0%, #004085 100%)",d.currentTarget.style.borderColor="#004085"):(d.currentTarget.style.background="#dee2e6",d.currentTarget.style.borderColor="#ced4da")},onMouseLeave:d=>{c?(d.currentTarget.style.background="linear-gradient(135deg, #007bff 0%, #0056b3 100%)",d.currentTarget.style.borderColor="#0056b3"):(d.currentTarget.style.background="#e9ecef",d.currentTarget.style.borderColor="#dee2e6")},children:t.jsx("span",{children:o})},l)})})})}function p6(){const[n,e]=h.useState(!1),{isTimelineVisible:s}=Ut(),[r,i]=h.useState({name:"",type:"",addDate:new Date().toISOString().split("T")[0],description:"",active:!0}),[a,o]=h.useState({}),[l,c]=h.useState(!1),[d,u]=h.useState(!1),[f,p]=h.useState(!1),[j,L]=h.useState(!1),[R,D]=h.useState(null),[y,T]=h.useState(!1),[x,S]=h.useState(null),[A,Q]=h.useState({providerType:"local",provider:"",providerName:"",date:"",price:"",quotationFile:null}),[q,B]=h.useState(null),[$,H]=h.useState([]),[te,G]=h.useState([]),[F,X]=h.useState([]),[ue,Y]=h.useState([]),{alertConfig:z,closeAlert:O,showSuccess:E,showError:k}=Bt(),b=kt(),{id:N}=Dn(),I=!!N,P=`serviceForm_${N||"new"}`,{logActivity:_,getCurrentUser:C}=Zt();h.useMemo(()=>F.map(pe=>({...pe,formattedPrice:`${pe.price} `,formattedDate:new Date(pe.date).toLocaleDateString("ar-SA")})),[F]),h.useMemo(()=>F.length===0?null:F.reduce((pe,be)=>{const xe=parseFloat(pe.price)||0;return(parseFloat(be.price)||0)<xe?be:pe}),[F]);const U=()=>{e(!n)};h.useEffect(()=>{try{const pe=localStorage.getItem(P);if(pe){const be=JSON.parse(pe);console.log(" [FORCE PERSIST] Restoring service form data from localStorage:",be),i(be)}}catch(pe){console.warn("Failed to parse saved service form data:",pe)}},[P]),h.useEffect(()=>{const pe=()=>{try{localStorage.setItem(P,JSON.stringify(r)),console.log(" [FORCE PERSIST] Service form data saved on beforeunload")}catch(Ee){console.warn("Failed to save service form data on beforeunload:",Ee)}},be=()=>{if(document.hidden)try{localStorage.setItem(P,JSON.stringify(r)),console.log(" [FORCE PERSIST] Service form data saved on visibility change")}catch(Ee){console.warn("Failed to save service form data on visibility change:",Ee)}},xe=()=>{try{localStorage.setItem(P,JSON.stringify(r)),console.log(" [FORCE PERSIST] Service form data saved on window blur")}catch(Ee){console.warn("Failed to save service form data on window blur:",Ee)}};return window.addEventListener("beforeunload",pe),document.addEventListener("visibilitychange",be),window.addEventListener("blur",xe),()=>{window.removeEventListener("beforeunload",pe),document.removeEventListener("visibilitychange",be),window.removeEventListener("blur",xe)}},[r,P]),h.useEffect(()=>{I&&(localStorage.getItem(P)?console.log(" [FORCE PERSIST] User changes exist, preserving service form data"):ie()),w(),W();const pe=()=>{I&&N&&(console.log("Window focused - refreshing service data..."),ie())};return window.addEventListener("focus",pe),()=>{window.removeEventListener("focus",pe)}},[N]),h.useEffect(()=>{var pe;console.log("PriceQuoteData changed:",{hasFile:!!A.quotationFile,fileName:(pe=A.quotationFile)==null?void 0:pe.name,providerName:A.providerName,price:A.price})},[A]);const w=async()=>{try{const[pe,be]=await Promise.all([rr.getAllSuppliers(),ir.getAllSuppliers()]);H(pe),G(be)}catch(pe){console.error("Error loading providers:",pe)}},W=async()=>{try{const pe=await Ws.getAllServiceTypes();Y(pe)}catch(pe){console.error("Error loading service types:",pe)}},ie=async()=>{try{u(!0),console.log("Loading service data for ID:",N);const pe=await Sa.getServiceById(N);pe?(console.log("Service found:",pe.name),i({name:pe.name||"",type:pe.type||pe.category||"",addDate:pe.addDate||new Date().toISOString().split("T")[0],description:pe.description||"",active:pe.active!==void 0?pe.active:!0})):(k("     ","   "),b("/services"))}catch(pe){console.error("Error loading service:",pe),k("     ","  "),b("/services")}finally{u(!1)}},de=pe=>{const{name:be,value:xe,type:Ee,checked:Re}=pe.target,fe={...r,[be]:Ee==="checkbox"?Re:xe};i(fe);try{localStorage.setItem(P,JSON.stringify(fe)),console.log(" [FORCE PERSIST] Service form data saved to localStorage on every change")}catch(Ve){console.warn("Failed to save service form data to localStorage:",Ve)}a[be]&&o(Ve=>({...Ve,[be]:""}))},ne=async()=>{const pe={};return r.name.trim()||(pe.name="  "),r.type.trim()||(pe.type="  "),r.addDate||(pe.addDate="   "),console.log("Form validation result:",pe),o(pe),Object.keys(pe).length===0},ye=async pe=>{pe.preventDefault(),console.log("Form submitted with data:",r);const be=await ne();if(console.log("Form validation passed:",be),!be){k("    ","  ");return}try{c(!0);const xe={...r};let Ee,Re,fe;I?(Ee=await Sa.updateService(N,xe),Re=`  : ${r.name}`,fe="   "):(console.log("Adding service with data:",xe),Ee=await Sa.createService(xe),console.log("Service added successfully:",Ee),Re=`   : ${r.name}`,fe="   ");const Ve=C();Ve&&Ve.name&&_("task",`${Ve.name} ${Re}`,fe),E(fe," "),window.dispatchEvent(new CustomEvent("servicesUpdated"));try{localStorage.removeItem(P),console.log(" [FORCE PERSIST] Cleared service form data from localStorage on successful save")}catch($e){console.warn("Failed to clear service form data from localStorage:",$e)}console.log("Navigating to services list..."),setTimeout(()=>{console.log("Navigation timeout reached, navigating to /services"),b("/services")},1500)}catch(xe){console.error("Error saving service:",xe),k(I?"    -   ":"    -   ","  ")}finally{c(!1)}};return d?t.jsx(It,{show:!0,message:"   ...",overlay:!1}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[t.jsx(Rt,{onToggle:U}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!s?"20px":"400px",paddingBottom:"60px",minHeight:"100vh",overflow:"auto",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsx("a",{href:"/services",className:"text-decoration-none text-primary",children:""})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:I?" ":" "})]})}),t.jsx(m6,{}),t.jsx("div",{className:"app-content-area p-3",children:t.jsx("form",{onSubmit:ye,className:"service-form",children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom",children:t.jsxs("div",{className:"row align-items-center",children:[t.jsx("div",{className:"col",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-wrench-adjustable-circle text-info me-2"}),I?" ":"  "]})}),t.jsx("div",{className:"col-auto",children:t.jsx(Vh,{})})]})}),t.jsx("div",{className:"card-body",children:t.jsxs("div",{className:"row g-4",children:[t.jsxs("div",{className:"col-md-6",children:[t.jsxs("label",{htmlFor:"name",className:"form-label fw-bold",children:["  ",t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsx("input",{type:"text",className:`form-control ${a.name?"is-invalid":""}`,id:"name",name:"name",value:r.name,onChange:de,placeholder:"  ",style:{textAlign:"right"}}),a.name&&t.jsx("div",{className:"invalid-feedback",children:a.name})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsxs("label",{htmlFor:"type",className:"form-label fw-bold",children:["  ",t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsxs("select",{className:`form-select ${a.type?"is-invalid":""}`,id:"type",name:"type",value:r.type,onChange:de,style:{textAlign:"right"},children:[t.jsx("option",{value:"",children:"  "}),ue.map(pe=>t.jsx("option",{value:pe.name,children:pe.name},pe.id))]}),a.type&&t.jsx("div",{className:"invalid-feedback",children:a.type})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsxs("label",{htmlFor:"addDate",className:"form-label fw-bold",children:["   ",t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsx("input",{type:"date",className:`form-control ${a.addDate?"is-invalid":""}`,id:"addDate",name:"addDate",value:r.addDate,onChange:de,style:{textAlign:"right"}}),a.addDate&&t.jsx("div",{className:"invalid-feedback",children:a.addDate})]}),t.jsxs("div",{className:"col-12",children:[t.jsx("label",{htmlFor:"description",className:"form-label fw-bold",children:" "}),t.jsx("textarea",{className:"form-control",id:"description",name:"description",rows:"4",value:r.description,onChange:de,placeholder:"  ",style:{textAlign:"right"}})]})]})}),t.jsx("div",{className:"card-footer bg-light",children:t.jsx("div",{className:"d-flex justify-content-center align-items-center",children:t.jsxs("div",{className:"d-flex gap-3",children:[t.jsx("button",{type:"submit",className:"btn btn-primary",disabled:l,onClick:pe=>{console.log("Add button clicked!")},style:{height:"36px",width:"100px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:l?t.jsx(It,{show:!0,size:"small"}):t.jsx(t.Fragment,{children:I?"":""})}),t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>b("/services"),style:{height:"36px",width:"100px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})})})]})})}),t.jsx("div",{className:"app-footer",style:{textAlign:"center",padding:"20px 10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",marginTop:"30px"},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&s&&t.jsx(os,{rtl:!0}),!n&&s&&t.jsx(ls,{})]}),t.jsx(Mt,{show:z.show,onClose:O,title:z.title,message:z.message,type:z.type,onConfirm:z.onConfirm,showConfirm:z.showConfirm})]})}function Jj(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(p6,{})})})}function f6(){const[n,e]=h.useState(!1),{isTimelineVisible:s}=Ut(),[r,i]=h.useState([]),[a,o]=h.useState([]),[l,c]=h.useState(!1),[d,u]=h.useState(null),[f,p]=h.useState(""),[j,L]=h.useState([]),[R,D]=h.useState(!1),[y,T]=h.useState([]),[x,S]=h.useState(null),A=kt(),{tenderId:Q}=Dn(),{logActivity:q,getCurrentUser:B}=Zt(),{alertConfig:$,closeAlert:H,showSuccess:te,showError:G}=Bt(),F=()=>{e(!n)},X=(I,P)=>{console.log(" SENIOR REACT: Starting advanced duplicate prevention analysis...");const _=[],C=[],U=new Map,w=new Map;return I.forEach((W,ie)=>{const de=W.materialInternalId||W.internalId||W.id;de&&U.set(de,{item:W,index:ie});const ne=(W.materialName||W.name||W.title||"").trim();if(ne){const ye=ne.toLowerCase();w.set(ye,{item:W,index:ie})}}),console.log(" DUPLICATE PREVENTION MAPS:",{existingIdsCount:U.size,existingNamesCount:w.size}),P.forEach(W=>{const ie=W.materialInternalId||W.internalId||W.id,de=(W.materialName||W.name||W.title||"").trim(),ne=de.toLowerCase();let ye=!1,pe="",be=null;ie&&U.has(ie)&&(ye=!0,pe="ID",be=U.get(ie).item,console.log(` ID DUPLICATE: ${de} matches existing ID: ${ie}`)),!ye&&de&&w.has(ne)&&(ye=!0,pe="NAME",be=w.get(ne).item,console.log(` NAME DUPLICATE: "${de}" matches existing name (case-insensitive)`)),ye?_.push({newItem:W,existingItem:be,type:pe,displayName:de||"  "}):(C.push(W),console.log(` UNIQUE ITEM: ${de} - Adding to list`),ie&&U.set(ie,{item:W,index:-1}),de&&w.set(ne,{item:W,index:-1}))}),console.log(" DUPLICATE ANALYSIS COMPLETE:",{totalNewItems:P.length,uniqueItemsFound:C.length,duplicatesFound:_.length,duplicateDetails:_.map(W=>({name:W.displayName,type:W.type}))}),{duplicates:_,uniqueItems:C}};h.useEffect(()=>{ue();const I=C=>{C.type==="servicesUpdated"&&ue()},P=()=>{ue()};window.addEventListener("storage",I),window.addEventListener("servicesUpdated",P);const _=()=>{ue()};return window.addEventListener("focus",_),()=>{window.removeEventListener("storage",I),window.removeEventListener("servicesUpdated",P),window.removeEventListener("focus",_)}},[]),h.useEffect(()=>{if(f.trim()){const I=r.filter(P=>{var _,C,U;return((_=P.name)==null?void 0:_.toLowerCase().includes(f.toLowerCase()))||((C=P.type)==null?void 0:C.toLowerCase().includes(f.toLowerCase()))||((U=P.description)==null?void 0:U.toLowerCase().includes(f.toLowerCase()))});L(I)}else L(r)},[f,r]);const ue=async()=>{try{c(!0);const P=(await Sa.getAllServices()).filter(_=>_.active!==!1);i(P),u(null)}catch(I){u(I.message)}finally{c(!1)}},Y=I=>{if(a.some(_=>_.internalId===I.internalId))o(_=>_.filter(C=>C.internalId!==I.internalId));else{const _={...I,type:"services",quantity:1};o(C=>[...C,_])}},z=async()=>{if(a.length===0){G("     ","   ");return}const I=a.map(P=>{let _=parseFloat(P.price)||0,C=Number(_.toFixed(1)),U=P.provider||"";return console.log(" INITIALIZING SERVICE:",{name:P.name,originalPrice:P.price,parsedPrice:_,formattedPrice:C}),{...P,quantity:1,unitPrice:C,totalPrice:C,displaySupplier:U,unit:""}});T(I),S(null),D(!0)},O=(I,P)=>{const _=Math.max(0,parseFloat(P)||0);T(C=>C.map(U=>U.id===I?{...U,quantity:Number(_.toFixed(1)),totalPrice:U.unitPrice*Number(_.toFixed(1))}:U))},E=(I,P)=>{if(console.log(" handlePriceChange called:",{itemId:I,newPrice:P,type:typeof P}),P===""||P===null||P===void 0){console.log(" Setting price to 0 (empty input)"),T(U=>U.map(w=>w.id===I?{...w,unitPrice:0,totalPrice:0}:w));return}const _=Math.max(0,parseFloat(P)||0),C=Number(_.toFixed(1));console.log(" Price calculation:",{input:P,parsed:_,rounded:C}),T(U=>U.map(w=>w.id===I?{...w,unitPrice:C,totalPrice:C*(w.quantity||1)}:w))},k=async()=>{console.log(" FUNCTION START: handleConfirmQuantities called");try{if(!Array.isArray(y)||y.length===0){console.log(" EARLY EXIT: No modal items to process"),G("    ","  ");return}const I=await Ke.getPendingData(`pendingTenderItems_${Q||"new"}`)||[],P=y.map(de=>({...de,materialName:de.name,materialInternalId:de.internalId})),_=X(I,P),{duplicates:C,uniqueItems:U}=_;if(C.length>0){const de=C.map(ne=>{const ye=ne.type==="ID"?" ":" ";return` "${ne.displayName}" (${ye})`});if(G(`   ${C.length}  .     .

${de.join(`
`)}`," "),U.length===0){console.log(" ALL ITEMS ARE DUPLICATES - Exiting without adding anything");return}console.log(` Found ${C.length} duplicates, proceeding with ${U.length} unique items`)}const w=U,W=[];for(const de of w)try{const ne={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:de.internalId,materialType:"service",materialName:de.name,materialCategory:de.type||"",materialUnit:"",quantity:de.quantity||1,unitPrice:de.unitPrice||de.price||0,totalPrice:(de.quantity||1)*(de.unitPrice||de.price||0),supplierInfo:de.displaySupplier||de.provider||"",tenderId:Q==="new"?"new":Q,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};W.push(ne)}catch(ne){console.error(` Error creating tender item for "${de.name}":`,ne)}const ie=[...I,...W];await Ke.setPendingData(`pendingTenderItems_${Q||"new"}`,ie,48),window.dispatchEvent(new CustomEvent("tenderItemsAdded",{detail:{items:W}})),console.log(" STEP 10: Items stored and event dispatched successfully");try{let de=" ";if(Q&&Q!=="new")try{const{tenderServiceNew:ne}=await Xe(async()=>{const{tenderServiceNew:pe}=await Promise.resolve().then(()=>Po);return{tenderServiceNew:pe}},void 0),ye=await ne.getTenderForViewing(Q);ye&&ye.entity?de=`: ${ye.entity}`:ye&&ye.title&&(de=`: ${ye.title}`)}catch(ne){console.warn("Could not fetch tender entity, using default name:",ne)}else try{const ne=await Ke.getPendingData("tenderFormData_new");ne&&ne.entity&&(de=`: ${ne.entity}`)}catch(ne){console.warn("Could not fetch pending form data:",ne)}for(const ne of W)await ws.logItemAdd(ne.materialName,de,"tender");console.log(` Logged ${W.length} individual service activities with entity name: ${de}`)}catch(de){console.error("Failed to log enhanced activity:",de)}te(`  ${W.length}  `," "),D(!1),o([]),T([]),S(null),setTimeout(()=>{const de=Q!=="new"?`/tenders/edit/${Q}`:"/tenders/add";A(de)},1500)}catch(I){console.error(" Error in handleConfirmQuantities:",I),G("     -   ","  ")}},b=()=>{D(!1),T([]),S(null)},N=()=>{const I=y.reduce((P,_)=>P+_.totalPrice,0);return I===0?"0":I.toFixed(1)};return l?t.jsx(It,{show:!0,message:"   ...",overlay:!1}):d?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:d}),t.jsxs("button",{className:"btn btn-primary",onClick:ue,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[t.jsx(Rt,{onToggle:F}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!s?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:""})]})}),t.jsx("div",{className:"app-content-area p-3",children:t.jsx("div",{className:"raw-materials-table",children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"row align-items-center justify-content-between",children:[t.jsx("div",{className:"col-lg-4",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-wrench-adjustable-circle text-info me-2"}),"  (",j.length,")"]})}),t.jsx("div",{className:"col-lg-8",children:t.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:f,onChange:I=>p(I.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:z,disabled:a.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["  (",a.length,")"]})]})})]})}),t.jsx("div",{className:"card-body p-0",children:j.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-wrench-adjustable-circle fs-1"})}),t.jsx("h5",{className:"text-muted",children:"  "}),t.jsx("p",{className:"text-muted",children:f?"    ":"     "})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""})]})}),t.jsx("tbody",{children:j.map(I=>{let P=I.price||0;return I.provider,t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",children:t.jsx("div",{className:"form-check d-flex justify-content-center",children:t.jsx("input",{className:"form-check-input",type:"checkbox",checked:a.some(_=>_.internalId===I.internalId),onChange:()=>Y(I),style:{transform:"scale(1.2)"}})})}),t.jsx("td",{className:"text-center",children:t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:_=>{_.preventDefault(),_.stopPropagation();const C=I.internalId||I.id;C&&A(`/services/edit/${C}`)},title:` : ${I.name}`,children:I.name})}),t.jsx("td",{className:"text-center",children:I.type||"-"}),t.jsx("td",{className:"text-center",children:""}),t.jsx("td",{className:"text-center",children:P?t.jsx("div",{className:"d-flex align-items-center justify-content-center",children:t.jsxs("span",{children:[P," "]})}):"-"}),t.jsx("td",{className:"text-center",children:I.description?t.jsx("span",{className:"text-muted",children:I.description.length>30?I.description.substring(0,30)+"...":I.description}):"-"})]},I.id)})})]})})})]})})}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&s&&t.jsx(os,{rtl:!0}),!n&&s&&t.jsx(ls,{})]}),R&&t.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:b,"aria-label":"Close"})]}),t.jsxs("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:[x&&t.jsxs("div",{className:"alert alert-warning alert-dismissible m-3 mb-2",role:"alert",style:{background:"linear-gradient(45deg, #fff3cd, #ffeaa7)",border:"2px solid #f39c12",borderRadius:"8px",boxShadow:"0 4px 12px rgba(243, 156, 18, 0.3)"},children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-exclamation-triangle-fill text-warning me-2",style:{fontSize:"20px"}}),t.jsxs("div",{className:"flex-grow-1",children:[t.jsx("strong",{children:":  !"}),t.jsx("div",{className:"mt-1 text-dark",children:x}),t.jsx("small",{className:"text-muted",children:"      "})]})]}),t.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>S(null)})]}),t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"25%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),t.jsx("tbody",{children:y.map((I,P)=>t.jsxs("tr",{style:{height:"60px"},children:[t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:"bi bi-wrench-adjustable-circle text-info me-2"}),t.jsxs("div",{children:[t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:_=>{_.preventDefault(),_.stopPropagation();const C=I.internalId||I.id;C&&A(`/services/edit/${C}`)},title:` : ${I.name}`,children:I.name}),t.jsx("small",{className:"text-muted",children:I.type})]})]})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{const _=parseFloat(I.unitPrice)||0,C=Math.max(0,Number((_-.1).toFixed(1)));console.log(" PRICE DOWN: current=",_,"new=",C),E(I.id,C)},disabled:(parseFloat(I.unitPrice)||0)<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-dash"})}),t.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:I.unitPrice||"",min:"0",step:"any",placeholder:"0",onChange:_=>{E(I.id,_.target.value)},onBlur:_=>{const C=Number(_.target.value||0).toFixed(1);E(I.id,C)},onFocus:_=>{_.target.select()}}),t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{const _=parseFloat(I.unitPrice)||0,C=Number((_+.1).toFixed(1));console.log(" PRICE UP: current=",_,"new=",C),E(I.id,C)},style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-plus"})}),t.jsx("span",{className:"ms-2 text-muted",children:""})]}),t.jsx("div",{children:t.jsxs("small",{className:"text-muted",children:["/",I.unit||""]})})]}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>O(I.id,Math.max(0,Number((I.quantity-.1).toFixed(1)))),disabled:I.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-dash"})}),t.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:I.quantity,min:"0",step:"any",onChange:_=>O(I.id,_.target.value),onBlur:_=>{const C=Number(_.target.value||0).toFixed(1);O(I.id,C)}}),t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>O(I.id,Number((I.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-plus"})})]})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"text-muted",children:I.displaySupplier||"-"})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("div",{className:"fw-bold text-primary fs-6",children:[I.totalPrice===0?"0":I.totalPrice.toFixed(1)," "]}),t.jsxs("small",{className:"text-success",children:["(",I.quantity.toFixed(1),"  ",I.unitPrice===0?"0":I.unitPrice.toFixed(1),")"]})]})]},I.id))})]})})]}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:t.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("span",{className:"text-muted me-3",children:" :"}),t.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[N()," "]}),t.jsxs("span",{className:"badge bg-info ms-2",children:[y.reduce((I,P)=>I+P.quantity,0).toFixed(1)," "]})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:b,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:k,disabled:y.length===0,style:{height:"32px",width:"120px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:" "})]})]})})]})})}),t.jsx(Mt,{show:$.show,onClose:H,title:$.title,message:$.message,type:$.type,onConfirm:$.onConfirm,showConfirm:$.showConfirm})]})}function Xj(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(f6,{})})})}function g6(){const[n,e]=h.useState(!1),{isTimelineVisible:s}=Ut(),[r,i]=h.useState([]),[a,o]=h.useState([]),[l,c]=h.useState(!1),[d,u]=h.useState(null),[f,p]=h.useState(""),[j,L]=h.useState([]),[R,D]=h.useState(!1),[y,T]=h.useState([]),[x,S]=h.useState(null),[A,Q]=h.useState(!1),[q,B]=h.useState(""),$=kt(),{productId:H}=Dn(),{logActivity:te,getCurrentUser:G}=Zt(),{alertConfig:F,closeAlert:X,showSuccess:ue,showError:Y}=Bt(),z=()=>{e(!n)};h.useEffect(()=>{O();const C=W=>{W.type==="servicesUpdated"&&O()},U=()=>{O()};window.addEventListener("storage",C),window.addEventListener("servicesUpdated",U);const w=()=>{O()};return window.addEventListener("focus",w),()=>{window.removeEventListener("storage",C),window.removeEventListener("servicesUpdated",U),window.removeEventListener("focus",w)}},[]),h.useEffect(()=>{if(f.trim()){const C=r.filter(U=>{var w,W,ie;return((w=U.name)==null?void 0:w.toLowerCase().includes(f.toLowerCase()))||((W=U.type)==null?void 0:W.toLowerCase().includes(f.toLowerCase()))||((ie=U.description)==null?void 0:ie.toLowerCase().includes(f.toLowerCase()))});L(C)}else L(r)},[f,r]);const O=async()=>{try{c(!0);const U=(await Sa.getAllServices()).filter(w=>w.active!==!1);i(U),u(null)}catch(C){u(C.message)}finally{c(!1)}},E=C=>{if(a.some(w=>w.internalId===C.internalId))o(w=>w.filter(W=>W.internalId!==C.internalId));else{const w={...C,type:"services",quantity:1};o(W=>[...W,w])}},k=async()=>{if(a.length===0){Y("     ","   ");return}console.log(" DEBUGGING: selectedServices array:",a.map(U=>({name:U.name,internalId:U.internalId,id:U.id})));const C=a.map(U=>{let w=parseFloat(U.price)||0,W=Number(w.toFixed(1)),ie=U.provider||"";return console.log(" INITIALIZING SERVICE (Manufacture):",{name:U.name,originalPrice:U.price,parsedPrice:w,formattedPrice:W}),{...U,quantity:1,unitPrice:W,totalPrice:W,displaySupplier:ie,unit:""}});console.log(" DEBUGGING: itemsWithQuantity array:",C.map(U=>({name:U.name,internalId:U.internalId,id:U.id}))),T(C),S(null),D(!0)},b=(C,U)=>{const w=Math.max(0,parseFloat(U)||0);T(W=>W.map(ie=>ie.id===C?{...ie,quantity:Number(w.toFixed(1)),totalPrice:ie.unitPrice*Number(w.toFixed(1))}:ie))},N=(C,U)=>{if(U===""||U===null||U===void 0){T(ie=>ie.map(de=>de.id===C?{...de,unitPrice:0,totalPrice:0}:de));return}const w=Math.max(0,parseFloat(U)||0),W=Number(w.toFixed(1));T(ie=>ie.map(de=>de.id===C?{...de,unitPrice:W,totalPrice:W*(de.quantity||1)}:de))},I=async()=>{console.log(" FUNCTION START: handleConfirmQuantities called for services");try{if(!Array.isArray(y)||y.length===0){console.log(" EARLY EXIT: No modal items to process"),Y("    ","  ");return}let C=await Ke.getPendingData(`pendingProductItems_${H||"new"}`)||[];if(H&&H!=="new")try{console.log(" EDIT MODE: Loading existing product items for duplicate check, product ID:",H);const{ManufacturedProductService:ye}=await Xe(async()=>{const{ManufacturedProductService:be}=await Promise.resolve().then(()=>Li);return{ManufacturedProductService:be}},void 0),pe=await ye.getManufacturedProductById(H);pe&&pe.items&&Array.isArray(pe.items)&&(console.log(" EDIT MODE: Found existing product items:",pe.items.length),C=[...C,...pe.items])}catch(ye){console.error(" Error loading existing product items for duplicate check:",ye)}const U=C.map(ye=>ye.materialInternalId||ye.internalId||ye.id).filter(Boolean),w=[];for(const ye of y)[ye.internalId,ye.id,ye.materialInternalId,ye.materialId].filter(Boolean).some(xe=>U.includes(xe))&&w.push(ye.name);if(w.length>0){const ye=w.join(" ");console.log(" CUSTOM DESIGN: Using custom-designed duplicate alert"),S(null);const pe=`       :

${ye}

     .
       .`;B(pe),Q(!0),console.log(" CUSTOM DESIGN: Custom duplicate alert displayed");return}console.log(" NO DUPLICATES DETECTED - Safe to proceed");const W=y,ie=[];for(const ye of W)try{const pe={internalId:`pi_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:ye.internalId,materialType:"service",materialName:ye.name,materialCategory:ye.type||"",materialUnit:"",quantity:ye.quantity||1,unitPrice:ye.unitPrice||ye.price||0,totalPrice:(ye.quantity||1)*(ye.unitPrice||ye.price||0),supplierInfo:ye.displaySupplier||ye.provider||"",productId:H==="new"?"new":H,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};ie.push(pe)}catch(pe){console.error(` Error creating product item for "${ye.name}":`,pe)}const de=await Ke.getPendingData(`pendingProductItems_${H||"new"}`)||[];let ne=[...ie];if(de.length>0)try{Array.isArray(de)&&(ne=[...await nc.refreshTenderItemsPricing(de),...ie])}catch(ye){console.error("Error parsing existing items:",ye)}await Ke.setPendingData(`pendingProductItems_${H||"new"}`,ne,48);try{const ye=G();ye&&ye.name&&te("task",`${ye.name}    `,`  ${ie.length}    `)}catch(ye){console.error("Failed to log activity:",ye)}window.dispatchEvent(new CustomEvent("productItemsAdded",{detail:{count:ie.length,type:"service",items:ie}})),ue(`  ${ie.length}      `," "),D(!1),T([]),S(null),setTimeout(()=>{$(H==="new"?"/manufactured-products/add":`/manufactured-products/edit/${H}`)},2e3)}catch(C){console.error("Error in handleConfirmQuantities:",C),Y("      -   ","  ")}},P=()=>{D(!1),T([]),S(null)},_=()=>{const C=y.reduce((U,w)=>U+w.totalPrice,0);return C===0?"0":C.toFixed(1)};return t.jsxs("div",{className:"d-flex",style:{minHeight:"100vh",backgroundColor:"#f8f9fa"},children:[t.jsx(_t,{collapsed:n}),t.jsxs("div",{className:`flex-grow-1 transition-all ${n?"sidebar-collapsed":"sidebar-expanded"}`,style:{transition:"margin-left 0.3s ease"},children:[t.jsx(Rt,{onToggle:z}),t.jsxs("div",{className:"app-content p-3",style:{overflow:"auto",height:"calc(100vh - 60px)"},children:[t.jsx("div",{className:"app-breadcrumbs",style:{direction:"rtl"},children:t.jsxs("ol",{className:"breadcrumb",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/manufactured-products",className:"text-decoration-none",children:[t.jsx("i",{className:"bi bi-house-door text-primary me-1"})," "]})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsx("a",{href:H!=="new"?`/manufactured-products/edit/${H}`:"/manufactured-products/add",className:"text-decoration-none",children:H!=="new"?" ":" "})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:""})]})}),t.jsx("div",{className:"app-content-area p-3",children:t.jsx("div",{className:"raw-materials-table",children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"row align-items-center justify-content-between",children:[t.jsx("div",{className:"col-lg-4",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-wrench-adjustable-circle text-info me-2"}),"  (",j.length,")"]})}),t.jsx("div",{className:"col-lg-8",children:t.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:f,onChange:C=>p(C.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:k,disabled:a.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["  (",a.length,")"]})]})})]})}),t.jsxs("div",{className:"card-body p-0",children:[l&&t.jsxs("div",{className:"text-center py-5",children:[t.jsx(It,{size:"large"}),t.jsx("p",{className:"mt-3 text-muted",children:"  ..."})]}),d&&t.jsxs("div",{className:"alert alert-danger border-0 shadow-sm m-4",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),d]}),!l&&!d&&t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover mb-0 align-middle",children:[t.jsx("thead",{className:"table-light sticky-top",children:t.jsxs("tr",{style:{fontSize:"14px",textAlign:"center",direction:"rtl"},children:[t.jsx("th",{style:{width:"50px"},children:""}),t.jsx("th",{children:" "}),t.jsx("th",{children:""}),t.jsx("th",{children:""}),t.jsx("th",{children:""}),t.jsx("th",{children:""})]})}),t.jsx("tbody",{children:j.length===0&&!l?t.jsx("tr",{children:t.jsxs("td",{colSpan:"6",className:"text-center text-muted py-5",children:[t.jsx("div",{className:"mb-3",children:t.jsx("i",{className:"bi bi-wrench-adjustable-circle display-4 text-muted"})}),t.jsx("h6",{children:"   "}),t.jsx("p",{className:"mb-0",children:f?"      ":"     "})]})}):j.map(C=>{const U=a.some(W=>W.internalId===C.internalId),w=C.price?Number(C.price).toFixed(2):null;return t.jsxs("tr",{className:`${U?"table-success":""}`,style:{cursor:"pointer",fontSize:"14px",textAlign:"center",direction:"rtl"},onClick:()=>E(C),children:[t.jsx("td",{className:"text-center",children:t.jsx("input",{type:"checkbox",className:"form-check-input",checked:U,onChange:W=>{W.stopPropagation(),E(C)},onClick:W=>W.stopPropagation(),style:{transform:"scale(1.2)"}})}),t.jsx("td",{className:"text-center",children:t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:W=>{W.preventDefault(),W.stopPropagation();const ie=C.internalId||C.id;ie&&$(`/services/edit/${ie}`)},title:` : ${C.name}`,children:C.name})}),t.jsx("td",{className:"text-center",children:C.type||"-"}),t.jsx("td",{className:"text-center",children:""}),t.jsx("td",{className:"text-center",children:w?t.jsx("div",{className:"d-flex align-items-center justify-content-center",children:t.jsxs("span",{children:[w," "]})}):"-"}),t.jsx("td",{className:"text-center",children:C.description?t.jsx("span",{className:"text-muted",children:C.description.length>30?C.description.substring(0,30)+"...":C.description}):"-"})]},C.internalId)})})]})})]})]})})})]}),!n&&s&&t.jsx(os,{rtl:!0}),!n&&s&&t.jsx(ls,{})]}),R&&t.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-calculator me-2"}),"  "]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:P,"aria-label":"Close"})]}),t.jsxs("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:[x&&t.jsxs("div",{className:"alert alert-warning alert-dismissible m-3 mb-2",role:"alert",style:{background:"linear-gradient(45deg, #fff3cd, #ffeaa7)",border:"2px solid #f39c12",borderRadius:"8px",boxShadow:"0 4px 12px rgba(243, 156, 18, 0.3)"},children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-exclamation-triangle-fill text-warning me-2",style:{fontSize:"20px"}}),t.jsxs("div",{className:"flex-grow-1",children:[t.jsx("strong",{children:":  !"}),t.jsx("div",{className:"mt-1 text-dark",children:x}),t.jsx("small",{className:"text-muted",children:"      "})]})]}),t.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>{S(null),X()}})]}),t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"25%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:""}),t.jsx("th",{className:"text-center",style:{width:"15%"},children:" "}),t.jsx("th",{className:"text-center",style:{width:"20%"},children:" "})]})}),t.jsx("tbody",{children:y.map((C,U)=>t.jsxs("tr",{style:{height:"60px"},children:[t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:"bi bi-wrench-adjustable-circle text-info me-2"}),t.jsxs("div",{children:[t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:w=>{w.preventDefault(),w.stopPropagation();const W=C.internalId||C.id;W&&$(`/services/edit/${W}`)},title:` : ${C.name}`,children:C.name}),t.jsx("small",{className:"text-muted",children:C.type})]})]})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{const w=parseFloat(C.unitPrice)||0,W=Math.max(0,Number((w-.1).toFixed(1)));console.log(" PRICE DOWN (Manufacture): current=",w,"new=",W),N(C.id,W)},disabled:(parseFloat(C.unitPrice)||0)<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-dash"})}),t.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:C.unitPrice||"",min:"0",step:"any",placeholder:"0",onChange:w=>{N(C.id,w.target.value)},onBlur:w=>{const W=Number(w.target.value||0).toFixed(1);N(C.id,W)},onFocus:w=>{w.target.select()}}),t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{const w=parseFloat(C.unitPrice)||0,W=Number((w+.1).toFixed(1));console.log(" PRICE UP (Manufacture): current=",w,"new=",W),N(C.id,W)},style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-plus"})}),t.jsx("span",{className:"ms-2 text-muted",children:""})]}),t.jsx("div",{children:t.jsxs("small",{className:"text-muted",children:["/",C.unit||""]})})]}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>b(C.id,Math.max(0,Number((C.quantity-.1).toFixed(1)))),disabled:C.quantity<=0,style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-dash"})}),t.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:C.quantity,min:"0",step:"any",onChange:w=>b(C.id,w.target.value),onBlur:w=>{const W=Number(w.target.value||0).toFixed(1);b(C.id,W)}}),t.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>b(C.id,Number((C.quantity+.1).toFixed(1))),style:{width:"32px",height:"32px",borderRadius:"6px"},children:t.jsx("i",{className:"bi bi-plus"})})]})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"text-muted",children:C.displaySupplier||"-"})}),t.jsxs("td",{className:"text-center",children:[t.jsxs("div",{className:"fw-bold text-primary fs-6",children:[C.totalPrice===0?"0":C.totalPrice.toFixed(1)," "]}),t.jsxs("small",{className:"text-success",children:["(",C.quantity.toFixed(1),"  ",C.unitPrice===0?"0":C.unitPrice.toFixed(1),")"]})]})]},C.id))})]})})]}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:t.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("span",{className:"text-muted me-3",children:" :"}),t.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[_()," "]}),t.jsxs("span",{className:"badge bg-info ms-2",children:[y.reduce((C,U)=>C+U.quantity,0).toFixed(1)," "]})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:P,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:I,disabled:y.length===0,style:{height:"32px",width:"120px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:" "})]})]})})]})})}),A&&t.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.8)",position:"fixed",top:0,left:0,right:0,bottom:0,width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:t.jsx("div",{className:"modal-dialog modal-dialog-centered",style:{maxWidth:"420px"},children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",overflow:"hidden",boxShadow:"0 15px 40px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{className:"modal-header border-0 text-white p-3",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",position:"relative"},children:[t.jsxs("div",{className:"d-flex align-items-center w-100 justify-content-center",children:[t.jsx("i",{className:"bi bi-exclamation-triangle-fill me-2",style:{fontSize:"20px"}}),t.jsx("h6",{className:"modal-title mb-0 fw-bold",children:":  "})]}),t.jsx("div",{style:{position:"absolute",top:"-8px",right:"-8px",width:"24px",height:"24px",background:"rgba(255,255,255,0.2)",borderRadius:"50%"}}),t.jsx("div",{style:{position:"absolute",bottom:"-4px",left:"-4px",width:"16px",height:"16px",background:"rgba(255,255,255,0.1)",borderRadius:"50%"}})]}),t.jsx("div",{className:"modal-body py-3 px-3",style:{backgroundColor:"#fefefe"},children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"mb-2",children:t.jsx("i",{className:"bi bi-shield-exclamation",style:{fontSize:"36px",color:"#dc3545",filter:"drop-shadow(2px 2px 4px rgba(0,0,0,0.1))"}})}),t.jsx("div",{style:{fontSize:"14px",lineHeight:"1.5",color:"#2c3e50",textAlign:"center"},children:q.split(`
`).map((C,U)=>t.jsx("div",{className:`${U===1?"fw-bold text-danger my-2 p-2 bg-light rounded":U===2||U===3?"text-muted mt-1":"mb-1"}`,children:C},U))})]})}),t.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",style:{backgroundColor:"#fefefe"},children:t.jsx("button",{type:"button",className:"btn",onClick:()=>{console.log(" CUSTOM ALERT: Close button clicked"),Q(!1),B("")},style:{borderRadius:"20px",height:"38px",fontSize:"14px",fontWeight:"600",width:"100px",background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",border:"none",color:"#fff",boxShadow:"0 3px 12px rgba(220, 53, 69, 0.4)",transition:"all 0.3s ease"},onMouseOver:C=>{C.target.style.transform="translateY(-1px)",C.target.style.boxShadow="0 5px 16px rgba(220, 53, 69, 0.6)"},onMouseOut:C=>{C.target.style.transform="translateY(0)",C.target.style.boxShadow="0 3px 12px rgba(220, 53, 69, 0.4)"},children:""})})]})})}),t.jsx(Mt,{show:!!F.message,type:F.type,title:F.title,message:F.message,onClose:X,onConfirm:F.onConfirm,confirmText:F.confirmText,cancelText:F.cancelText,showCancel:F.showCancel})]})}function x6(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(g6,{})})})}const ul="customers";class Dl{static async getAllCustomers(){try{const e=Pe(ae,ul),s=st(e,as("createdAt","desc"));return(await qe(s)).docs.map(i=>{var o,l;const a=i.data();return{id:i.id,internalId:a.internalId||Ct("CUSTOMER"),...a,createdAt:(o=a.createdAt)==null?void 0:o.toDate(),updatedAt:(l=a.updatedAt)==null?void 0:l.toDate()}})}catch(e){throw console.error("Error fetching customers:",e),new Error("    ")}}static async createCustomer(e){try{const s=Ct("CUSTOMER"),r={...e,internalId:s,createdAt:We(),updatedAt:We()};return(await As(Pe(ae,ul),r)).id}catch(s){throw console.error("Error creating customer:",s),new Error("   ")}}static async updateCustomer(e,s){try{const r=Le(ae,ul,e),i={...s,updatedAt:We()};return await Qt(r,i),!0}catch(r){throw console.error("Error updating customer:",r),new Error("    ")}}static async getCustomerById(e){var s,r;try{const i=Le(ae,ul,e),a=await ss(i);if(a.exists()){const o=a.data();return{id:a.id,internalId:o.internalId||Ct("CUSTOMER"),...o,createdAt:(s=o.createdAt)==null?void 0:s.toDate(),updatedAt:(r=o.updatedAt)==null?void 0:r.toDate()}}else return null}catch(i){throw console.error("Error fetching customer by ID:",i),new Error("    ")}}static async getCustomerByInternalId(e){var s,r;try{const i=Pe(ae,ul),a=st(i,xt("internalId","==",e)),o=await qe(a);if(o.empty)return null;{const l=o.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:(s=c.createdAt)==null?void 0:s.toDate(),updatedAt:(r=c.updatedAt)==null?void 0:r.toDate()}}}catch(i){throw console.error("Error fetching customer by internal ID:",i),new Error("    ")}}static async updateCustomerByInternalId(e,s){try{const r=await this.getCustomerByInternalId(e);if(!r)throw new Error("Customer not found");return await this.updateCustomer(r.id,s)}catch(r){throw console.error("Error updating customer by internal ID:",r),new Error("    ")}}static async deleteCustomer(e){try{const s=Le(ae,ul,e);return await es(s),!0}catch(s){throw console.error("Error deleting customer:",s),new Error("   ")}}static async deleteCustomerByInternalId(e){try{const s=await this.getCustomerByInternalId(e);if(!s)throw new Error("Customer not found");return await this.deleteCustomer(s.id)}catch(s){throw console.error("Error deleting customer by internal ID:",s),new Error("   ")}}static async searchCustomers(e){try{const s=Pe(ae,ul);return(await qe(s)).docs.map(o=>{var c,d;const l=o.data();return{id:o.id,internalId:l.internalId||Ct("CUSTOMER"),...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}}).filter(o=>{var l,c,d;return((l=o.name)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))||((c=o.email)==null?void 0:c.toLowerCase().includes(e.toLowerCase()))||((d=o.phone)==null?void 0:d.includes(e))})}catch(s){throw console.error("Error searching customers:",s),new Error("    ")}}static async migrateExistingData(){try{console.log("Starting customers migration...");const e=await this.getAllCustomers();let s=0;for(const r of e)if(!r.internalId||!r.internalId.startsWith("cst_")){const i=Ct("CUSTOMER");await this.updateCustomer(r.id,{...r,internalId:i}),s++,console.log(`Migrated customer: ${r.name} -> ${i}`)}return console.log(`Migration completed. ${s} customers migrated.`),{success:!0,migratedCount:s}}catch(e){throw console.error("Error during migration:",e),new Error("   ")}}static validateCustomerData(e){var r,i,a;const s={};return(r=e.name)!=null&&r.trim()||(s.name="  "),(i=e.email)!=null&&i.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(s.email="    "):s.email="  ",(a=e.phone)!=null&&a.trim()||(s.phone="  "),s}}const y6=Object.freeze(Object.defineProperty({__proto__:null,CustomerService:Dl},Symbol.toStringTag,{value:"Module"})),b6=({onEdit:n,onAdd:e,refreshTrigger:s,searchTerm:r})=>{const[i,a]=h.useState([]),[o,l]=h.useState(!0),[c,d]=h.useState(null),[u,f]=h.useState(""),p=r!==void 0?r:u,[j,L]=h.useState([]),[R,D]=h.useState(!1),{logActivity:y,getCurrentUser:T}=Zt(),{alertConfig:x,closeAlert:S,showSuccess:A,showError:Q,showConfirm:q}=Bt(),{currentPage:B,totalPages:$,paginatedItems:H,handlePageChange:te,resetPage:G,totalItems:F,itemsPerPage:X}=cr(j,30);h.useEffect(()=>{ue()},[]),h.useEffect(()=>{s&&ue()},[s]),h.useEffect(()=>{if(p.trim()){const O=i.filter(E=>{var k,b,N;return((k=E.name)==null?void 0:k.toLowerCase().includes(p.toLowerCase()))||((b=E.email)==null?void 0:b.toLowerCase().includes(p.toLowerCase()))||((N=E.phone)==null?void 0:N.includes(p))});L(O)}else L(i);G()},[p,i,G]);const ue=async()=>{try{l(!0);const O=await Dl.getAllCustomers(),E=Y1(O);a(E),d(null)}catch(O){d(O.message)}finally{l(!1)}},Y=O=>{q(`      

${O.name}`,()=>z(O),"  ")},z=async O=>{try{D(!0),await bs.moveToTrash(O,"customers"),await Dl.deleteCustomer(O.id);const E=T();y("task",`${E.name}  `,`  : ${O.name}`),await ue(),A(`   : ${O.name}`,"  ")}catch(E){d(E.message),Q(`    : ${E.message}`,"  ")}finally{D(!1)}};return o?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"spinner-border text-primary",role:"status",children:t.jsx("span",{className:"visually-hidden",children:" ..."})}),t.jsx("p",{className:"mt-3 text-muted",children:"   ..."})]})}):c?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:c}),t.jsxs("button",{className:"btn btn-primary",onClick:ue,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):t.jsxs("div",{"data-list":"customers",children:[j.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-person-lines-fill fs-1"})}),t.jsx("h5",{className:"text-muted",children:"  "}),t.jsx("p",{className:"text-muted",children:p?"    ":"     "}),!p&&t.jsxs("button",{className:"btn btn-primary",onClick:e,children:[t.jsx("i",{className:"bi bi-plus-lg me-1"}),"  "]})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",style:{tableLayout:"fixed"},children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:"60px",textAlign:"center"},children:"#"}),t.jsx("th",{style:{width:"25%",textAlign:"right"},children:" "}),t.jsx("th",{style:{width:"25%",textAlign:"right"},children:" "}),t.jsx("th",{style:{width:"15%",textAlign:"center"},children:""}),t.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),t.jsx("th",{style:{width:"120px",textAlign:"center"},children:""})]})}),t.jsx("tbody",{children:H.map((O,E)=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",style:{verticalAlign:"middle"},children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(B-1)*X+E+1})}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",onClick:()=>n(O),style:{textDecoration:"none",textAlign:"right"},title:`Internal ID: ${O.internalId||"Not Set"}`,children:O.name})}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:t.jsx("a",{href:`mailto:${O.email}`,className:"text-decoration-none",children:O.email})}),t.jsx("td",{style:{direction:"ltr",textAlign:"center",verticalAlign:"middle"},children:O.phone}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:O.city||"-"}),t.jsx("td",{style:{textAlign:"center",verticalAlign:"middle"},children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(Tt,{can:"clients:update",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-primary",onClick:()=>n(O),title:"",children:t.jsx("i",{className:"bi bi-pencil"})})}),t.jsx(Tt,{can:"clients:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>Y(O),title:"",children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},O.internalId||O.id))})]})}),j.length>0&&t.jsx(dr,{currentPage:B,totalPages:$,onPageChange:te,totalItems:F,itemsPerPage:X}),t.jsx(Mt,{show:x.show,onClose:S,title:x.title,message:x.message,type:x.type,onConfirm:x.onConfirm,confirmText:x.confirmText,cancelText:x.cancelText,showCancel:x.showCancel})]})},w6=({customer:n,onSave:e,onCancel:s})=>{const[r,i]=h.useState({name:"",email:"",phone:"",address:"",city:"",taxNumber:"",bankAccount:"",notes:"",active:!0}),[a,o]=h.useState({}),[l,c]=h.useState(!1),d=!!n,{logActivity:u,getCurrentUser:f}=Zt(),{hasPerm:p,readOnly:j}=Yn(),L=p("clients:create"),R=p("clients:update"),D=j||d&&!R||!d&&!L;h.useEffect(()=>{n&&i({name:n.name||"",email:n.email||"",phone:n.phone||"",address:n.address||"",city:n.city||"",taxNumber:n.taxNumber||"",bankAccount:n.bankAccount||"",notes:n.notes||"",active:n.active!==void 0?n.active:!0})},[n]);const y=x=>{const{name:S,value:A,type:Q,checked:q}=x.target;i(B=>({...B,[S]:Q==="checkbox"?q:A})),a[S]&&o(B=>({...B,[S]:""}))},T=async x=>{x.preventDefault();const S=Dl.validateCustomerData(r);if(Object.keys(S).length>0){o(S);return}c(!0),o({});try{const A=await Bn.validateUniqueFields(r,d?n.id:null,d?"customers":null);if(Object.keys(A).length>0){o(A),c(!1);return}const Q={...r,status:d&&n.status||"active"};if(d){await Dl.updateCustomer(n.id,Q);const q=f();u("task",`${q.name}  `,`  : ${Q.name}`)}else{await Dl.createCustomer(Q);const q=f();u("task",`${q.name}  `,`  : ${Q.name}`)}e()}catch(A){o({submit:A.message})}finally{c(!1)}};return t.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.6)",zIndex:99990,position:"fixed",top:0,left:0,right:0,bottom:0},children:t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",children:[t.jsxs("div",{className:"modal-header",children:[t.jsxs("h5",{className:"modal-title",children:[t.jsx("i",{className:"bi bi-person-plus-fill text-primary me-2"}),d?" ":"  "]}),t.jsx("button",{type:"button",className:"btn-close",onClick:s})]}),t.jsxs("form",{onSubmit:T,children:[t.jsxs("div",{className:"modal-body",children:[D&&t.jsx("div",{className:"alert alert-info border-0 shadow-sm mb-4",children:t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-info-circle-fill text-info me-3 fs-5"}),t.jsxs("div",{children:[t.jsx("strong",{className:"fw-bold",children:"  "}),t.jsx("div",{className:"mt-1",children:t.jsxs("span",{className:"ms-2",children:[!R&&d&&"    ",!L&&!d&&"     ",j&&"     "]})})]})]})}),a.submit&&t.jsxs("div",{className:"alert alert-danger",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.submit]}),t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"text",className:`form-control ${a.name?"is-invalid":""}`,name:"name",value:r.name,onChange:y,placeholder:"  ",readOnly:D}),a.name&&t.jsx("div",{className:"invalid-feedback",children:a.name})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"email",className:`form-control ${a.email?"is-invalid":""}`,name:"email",value:r.email,onChange:y,placeholder:"example@company.com",readOnly:D}),a.email&&t.jsx("div",{className:"invalid-feedback",children:a.email})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"tel",className:`form-control ${a.phone?"is-invalid":""}`,name:"phone",value:r.phone,onKeyPress:x=>{/[0-9+]/.test(x.key)||x.preventDefault()},onChange:x=>{const S=x.target.value.replace(/[^0-9+]/g,"");y({target:{name:"phone",value:S}})},placeholder:"+966 50 123 4567",readOnly:D}),a.phone&&t.jsx("div",{className:"invalid-feedback",children:a.phone})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:""}),t.jsx(rc,{name:"city",value:r.city,onChange:y,placeholder:" ",required:!1,disabled:D})]}),t.jsxs("div",{className:"col-md-12 mb-3",children:[t.jsx("label",{className:"form-label",children:""}),t.jsx("textarea",{className:"form-control",name:"address",value:r.address,onChange:y,rows:"2",placeholder:"  ",readOnly:D})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:" "}),t.jsx("input",{type:"text",className:"form-control",name:"taxNumber",value:r.taxNumber,onChange:y,placeholder:" ",readOnly:D})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  "}),t.jsx("input",{type:"text",className:"form-control",name:"bankAccount",value:r.bankAccount,onChange:y,placeholder:"  ",readOnly:D})]}),t.jsxs("div",{className:"col-md-12 mb-3",children:[t.jsx("label",{className:"form-label",children:""}),t.jsx("textarea",{className:"form-control",name:"notes",value:r.notes,onChange:y,rows:"3",placeholder:"  ...",readOnly:D})]}),t.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("span",{className:`badge ${r.active?"bg-success":"bg-secondary"} px-3 py-2`,children:r.active?"":" "}),t.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"customerActiveSwitch",name:"active",checked:r.active,onChange:y,disabled:D,style:{width:"50px",height:"25px",cursor:D?"not-allowed":"pointer"}})]})})]})]}),t.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:t.jsxs("div",{className:"d-flex gap-3",children:[t.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:s,disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""}),t.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:l||D,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:l?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"12px",height:"12px"}}),"..."]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-check-lg me-1"}),d?"":""]})})]})})]})]})})})},v6=({searchTerm:n})=>{const[e,s]=h.useState(0),[r,i]=h.useState(0);h.useEffect(()=>{a()},[n]);const a=async()=>{try{const o=await Dl.getAllCustomers();if(s(o.length),n!=null&&n.trim()){const l=o.filter(c=>{var d,u,f,p,j;return((d=c.name)==null?void 0:d.toLowerCase().includes(n.toLowerCase()))||((u=c.email)==null?void 0:u.toLowerCase().includes(n.toLowerCase()))||((f=c.phone)==null?void 0:f.includes(n))||((p=c.company)==null?void 0:p.toLowerCase().includes(n.toLowerCase()))||((j=c.city)==null?void 0:j.toLowerCase().includes(n.toLowerCase()))});i(l.length)}else i(o.length)}catch(o){console.error("Error loading customers count:",o),s(0),i(0)}};return t.jsx("span",{className:"badge bg-secondary ms-2",style:{fontSize:"12px",fontWeight:"normal"},children:n!=null&&n.trim()?`${r}  ${e}`:e})};function N6(){const[n,e]=h.useState(!1),[s,r]=h.useState(!1),[i,a]=h.useState(null),[o,l]=h.useState(0),[c,d]=h.useState(""),{isTimelineVisible:u}=Ut();kt();const f=()=>{e(!n)},p=()=>{a(null),r(!0)},j=D=>{a(D),r(!0)},L=()=>{r(!1),a(null),l(D=>D+1)},R=()=>{r(!1),a(null)};return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:f}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!u?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:""})]})}),t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"20px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:10,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-people text-primary me-2"})," "]}),t.jsx(v6,{searchTerm:c})]}),t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:c,onChange:D=>d(D.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsx("button",{onClick:p,className:"btn btn-primary",style:{height:"40px",width:"140px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:" "})]})]})}),t.jsx("div",{style:{height:"calc(100vh - 280px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"card-body p-0",children:t.jsx(b6,{onAdd:p,onEdit:j,refreshTrigger:o,searchTerm:c})})})]})}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&u&&t.jsx(os,{rtl:!0}),!n&&u&&t.jsx(ls,{}),s&&t.jsx("div",{className:"customer-form",children:t.jsx(w6,{customer:i,onSave:L,onCancel:R})})]})})})}function j6(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(N6,{})})})}class S6{constructor(){this.collectionName="competitors",this.localStorageKey="competitors_data"}generateInternalId(){return Ct("COMPETITOR")}async createCompetitor(e){try{const s=this.generateInternalId(),r={...e,internalId:s,active:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};try{const i=await As(Pe(ae,this.collectionName),r);return console.log(" Competitor created in Firebase:",i.id),this.saveToLocalStorage(r),{id:i.id,...r}}catch(i){console.warn(" Firebase creation failed, using localStorage:",i);const o={id:`temp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,...r,_isLocal:!0};return this.saveToLocalStorage(o),o}}catch(s){throw console.error(" Error creating competitor:",s),new Error(`   : ${s.message}`)}}async getAllCompetitors(){try{try{const e=await qe(st(Pe(ae,this.collectionName),as("createdAt","desc"))),s=[];return e.forEach(r=>{s.push({id:r.id,...r.data()})}),console.log(` Loaded ${s.length} competitors from Firebase`),s}catch(e){return console.warn(" Firebase read failed, using localStorage:",e),this.getFromLocalStorage()}}catch(e){throw console.error(" Error loading competitors:",e),new Error(`    : ${e.message}`)}}async getCompetitorById(e){try{try{const s=Le(ae,this.collectionName,e),r=await ss(s);if(r.exists())return{id:r.id,...r.data()};throw new Error("Competitor not found in Firebase")}catch(s){console.warn(" Firebase read failed, checking localStorage:",s);const i=this.getFromLocalStorage().find(a=>a.id===e);if(i)return i;throw new Error("Competitor not found")}}catch(s){throw console.error(" Error getting competitor:",s),new Error(`    : ${s.message}`)}}async updateCompetitor(e,s){try{const r={...s,updatedAt:new Date().toISOString()};try{const i=Le(ae,this.collectionName,e);return await Qt(i,r),console.log(" Competitor updated in Firebase:",e),this.updateInLocalStorage(e,r),{id:e,...r}}catch(i){return console.warn(" Firebase update failed, updating localStorage:",i),this.updateInLocalStorage(e,r),{id:e,...r}}}catch(r){throw console.error(" Error updating competitor:",r),new Error(`    : ${r.message}`)}}async deleteCompetitor(e){try{try{return await es(Le(ae,this.collectionName,e)),console.log(" Competitor deleted from Firebase:",e),this.removeFromLocalStorage(e),!0}catch(s){return console.warn(" Firebase deletion failed, removing from localStorage:",s),this.removeFromLocalStorage(e),!0}}catch(s){throw console.error(" Error deleting competitor:",s),new Error(`   : ${s.message}`)}}async searchCompetitors(e){try{const s=await this.getAllCompetitors();if(!e||e.trim()==="")return s;const r=e.toLowerCase();return s.filter(i=>{var a,o,l,c;return((a=i.name)==null?void 0:a.toLowerCase().includes(r))||((o=i.email)==null?void 0:o.toLowerCase().includes(r))||((l=i.phone)==null?void 0:l.includes(r))||((c=i.city)==null?void 0:c.toLowerCase().includes(r))})}catch(s){throw console.error(" Error searching competitors:",s),new Error(`    : ${s.message}`)}}async getActiveCompetitors(){try{return(await this.getAllCompetitors()).filter(s=>s.active!==!1)}catch(e){throw console.error(" Error getting active competitors:",e),new Error(`    : ${e.message}`)}}saveToLocalStorage(e){try{const r=[...this.getFromLocalStorage(),e];localStorage.setItem(this.localStorageKey,JSON.stringify(r))}catch(s){console.warn("Failed to save to localStorage:",s)}}getFromLocalStorage(){try{const e=localStorage.getItem(this.localStorageKey);return e?JSON.parse(e):[]}catch(e){return console.warn("Failed to read from localStorage:",e),[]}}updateInLocalStorage(e,s){try{const r=this.getFromLocalStorage(),i=r.findIndex(a=>a.id===e);i!==-1&&(r[i]={...r[i],...s},localStorage.setItem(this.localStorageKey,JSON.stringify(r)))}catch(r){console.warn("Failed to update localStorage:",r)}}removeFromLocalStorage(e){try{const r=this.getFromLocalStorage().filter(i=>i.id!==e);localStorage.setItem(this.localStorageKey,JSON.stringify(r))}catch(s){console.warn("Failed to remove from localStorage:",s)}}async clearAll(){try{const e=await qe(Pe(ae,this.collectionName)),s=[];return e.forEach(r=>{s.push(es(r.ref))}),await Promise.all(s),localStorage.removeItem(this.localStorageKey),console.log(" All competitors cleared"),!0}catch(e){throw console.error(" Error clearing competitors:",e),new Error(`   : ${e.message}`)}}}const md=new S6,E6=({onEdit:n,onAdd:e,refreshTrigger:s,searchTerm:r})=>{const[i,a]=h.useState([]),[o,l]=h.useState(!0),[c,d]=h.useState(null),[u,f]=h.useState(""),p=r!==void 0?r:u,[j,L]=h.useState([]),[R,D]=h.useState(!1),{logActivity:y,getCurrentUser:T}=Zt(),{alertConfig:x,closeAlert:S,showSuccess:A,showError:Q,showConfirm:q}=Bt(),{currentPage:B,totalPages:$,paginatedItems:H,handlePageChange:te,resetPage:G,totalItems:F,itemsPerPage:X}=cr(j,30);h.useEffect(()=>{ue()},[]),h.useEffect(()=>{s&&(console.log(" CompetitorsList: Refresh trigger received:",s),ue())},[s]),h.useEffect(()=>{if(p.trim()){const O=i.filter(E=>{var k,b,N,I;return((k=E.name)==null?void 0:k.toLowerCase().includes(p.toLowerCase()))||((b=E.email)==null?void 0:b.toLowerCase().includes(p.toLowerCase()))||((N=E.phone)==null?void 0:N.includes(p))||((I=E.city)==null?void 0:I.toLowerCase().includes(p.toLowerCase()))});L(O)}else L(i);G()},[p,i,G]);const ue=async()=>{try{l(!0);const O=await md.getAllCompetitors(),E=u$(O);a(E),d(null)}catch(O){d(O.message)}finally{l(!1)}},Y=O=>{q(`      

${O.name}`,()=>z(O),"  ")},z=async O=>{try{D(!0),await bs.moveToTrash(O,"competitors"),await md.deleteCompetitor(O.id);const E=T();y("task",`${E.name}  `,`  : ${O.name}`),await ue(),A(`   : ${O.name}`,"  ")}catch(E){d(E.message),Q(`    : ${E.message}`,"  ")}finally{D(!1)}};return o?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"spinner-border text-primary",role:"status",children:t.jsx("span",{className:"visually-hidden",children:" ..."})}),t.jsx("p",{className:"mt-3 text-muted",children:"   ..."})]})}):c?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:c}),t.jsxs("button",{className:"btn btn-primary",onClick:ue,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):t.jsxs("div",{"data-list":"competitors",children:[j.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-trophy fs-1"})}),t.jsx("h5",{className:"text-muted",children:"  "}),t.jsx("p",{className:"text-muted",children:p?"    ":"     "}),!p&&t.jsxs("button",{className:"btn btn-primary",onClick:e,children:[t.jsx("i",{className:"bi bi-plus-lg me-1"}),"  "]})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center fw-bold",style:{width:"80px",padding:"16px 8px"},children:"#"}),t.jsx("th",{className:"text-center fw-bold",style:{width:"30%",padding:"16px 12px"},children:" "}),t.jsx("th",{className:"text-center fw-bold",style:{width:"28%",padding:"16px 12px"},children:" "}),t.jsx("th",{className:"text-center fw-bold",style:{width:"16%",padding:"16px 12px"},children:""}),t.jsx("th",{className:"text-center fw-bold",style:{width:"14%",padding:"16px 12px"},children:""}),t.jsx("th",{className:"text-center fw-bold",style:{width:"12%",padding:"16px 8px"},children:""})]})}),t.jsx("tbody",{children:H.map((O,E)=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-center align-middle",style:{padding:"12px 15px 12px 8px"},children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(B-1)*X+E+1})}),t.jsx("td",{className:"text-center align-middle",style:{padding:"12px"},children:t.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",onClick:()=>n(O),style:{textDecoration:"none",fontSize:"15px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"},title:`${O.name} - Internal ID: ${O.internalId||"Not Set"}`,children:O.name})}),t.jsx("td",{className:"text-center align-middle",style:{padding:"12px"},children:O.email?t.jsx("a",{href:`mailto:${O.email}`,className:"text-decoration-none text-primary",style:{fontSize:"14px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",display:"inline-block"},children:O.email}):t.jsx("span",{className:"text-muted",children:"-"})}),t.jsx("td",{className:"text-center align-middle",style:{padding:"12px",direction:"ltr"},children:O.phone?t.jsx("span",{style:{fontSize:"14px",fontFamily:"monospace"},children:O.phone}):t.jsx("span",{className:"text-muted",children:"-"})}),t.jsx("td",{className:"text-center align-middle",style:{padding:"12px"},children:t.jsx("span",{style:{fontSize:"14px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",display:"inline-block"},children:O.city||"-"})}),t.jsx("td",{className:"text-center align-middle",style:{padding:"12px 8px"},children:t.jsxs("div",{className:"btn-group btn-group-sm",role:"group",children:[t.jsx(Tt,{can:"competitors:update",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>n(O),title:" ",style:{fontSize:"11px",padding:"4px 8px",borderRadius:"4px 0 0 4px"},children:t.jsx("i",{className:"bi bi-pencil-square"})})}),t.jsx(Tt,{can:"competitors:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>Y(O),title:" ",style:{fontSize:"11px",padding:"4px 8px",borderRadius:"0 4px 4px 0"},children:t.jsx("i",{className:"bi bi-trash3"})})})]})})]},O.internalId||O.id))})]})}),j.length>0&&t.jsx(dr,{currentPage:B,totalPages:$,onPageChange:te,totalItems:F,itemsPerPage:X}),t.jsx(Mt,{show:x.show,onClose:S,title:x.title,message:x.message,type:x.type,onConfirm:x.onConfirm,confirmText:x.confirmText,cancelText:x.cancelText,showCancel:x.showCancel})]})},C6=({competitor:n,onSave:e,onCancel:s})=>{const[r,i]=h.useState({name:"",email:"",phone:"",city:""}),[a,o]=h.useState({}),[l,c]=h.useState(!1),d=!!n,{logActivity:u,getCurrentUser:f}=Zt(),{hasPerm:p,readOnly:j,user:L,role:R,permissions:D}=Yn(),y=p("competitors:create"),T=p("competitors:update"),x=!1,S=j||d&&!T||!d&&!y,A=S;console.log(" CompetitorForm Permissions Debug:",{user:!!L,role:R,readOnly:j,isEditing:d,canCreate:y,canUpdate:T,isReadOnlyMode:S,finalReadOnlyMode:A,isDevelopment:x,allPermissions:D}),h.useEffect(()=>{n&&i({name:n.name||"",email:n.email||"",phone:n.phone||"",city:n.city||""})},[n]);const Q=$=>{const{name:H,value:te}=$.target;i(G=>({...G,[H]:te})),a[H]&&o(G=>({...G,[H]:""}))},q=async()=>{const $={};if(!r.name.trim())$.name="  ";else try{await Bn.isCompetitorNameUnique(r.name,n==null?void 0:n.internalId)||($.name="   ")}catch(H){console.warn("Competitor name validation failed:",H)}if(r.phone.trim()&&(/^[+]?[0-9\s\-()]+$/.test(r.phone)||($.phone="          +   ")),r.email.trim()&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.email)||($.email="    ")),r.phone.trim())try{await Bn.isPhoneUnique(r.phone,n==null?void 0:n.internalId)||($.phone="    ")}catch(H){console.warn("Phone validation failed:",H)}if(r.email.trim())try{await Bn.isEmailUnique(r.email,n==null?void 0:n.internalId)||($.email="    ")}catch(H){console.warn("Email validation failed:",H)}return o($),Object.keys($).length===0},B=async $=>{if($.preventDefault(),!(A||!await q())){c(!0);try{let te;d?te=await md.updateCompetitor(n.id,r):te=await md.createCompetitor(r);const G=f(),F=d?" ":" ",X=d?`  : ${r.name}`:`   : ${r.name}`;u("task",`${G.name} ${F}`,X),e(te)}catch(te){console.error("Error saving competitor:",te),o({submit:te.message||"    "})}finally{c(!1)}}};return t.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.6)",backdropFilter:"blur(5px)"},children:t.jsx("div",{className:"modal-dialog modal-xl",dir:"rtl",style:{marginTop:"2rem",marginBottom:"2rem"},children:t.jsx("div",{className:"modal-content shadow-lg",style:{borderRadius:"15px",border:"none",overflow:"hidden"},children:t.jsxs("form",{onSubmit:B,children:[t.jsxs("div",{className:"modal-header bg-gradient",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderBottom:"3px solid rgba(255,255,255,0.2)"},children:[t.jsxs("h5",{className:"modal-title d-flex align-items-center text-white fw-bold",children:[t.jsx("div",{className:"bg-white bg-opacity-20 rounded-circle p-2 me-3",style:{width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx("i",{className:"bi bi-trophy-fill text-white fs-5"})}),t.jsx("span",{style:{fontSize:"18px"},children:d?" ":"  "})]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white shadow-sm",onClick:s,disabled:l,style:{fontSize:"14px",opacity:.8,transition:"all 0.2s ease"},onMouseEnter:$=>$.target.style.opacity="1",onMouseLeave:$=>$.target.style.opacity="0.8"})]}),t.jsxs("div",{className:"modal-body",style:{background:"linear-gradient(135deg, #f8f9fa 0%, #fff 100%)",padding:"2rem"},children:[a.submit&&t.jsx("div",{className:"alert alert-danger shadow-sm border-0 rounded-3 mb-4",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",color:"white"},children:t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("div",{className:"bg-white bg-opacity-20 rounded-circle p-2 me-3",style:{width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx("i",{className:"bi bi-exclamation-triangle text-white"})}),t.jsx("span",{style:{fontWeight:"500"},children:a.submit})]})}),t.jsxs("div",{className:"row g-4",children:[t.jsxs("div",{className:"col-md-6 mb-4",children:[t.jsxs("label",{htmlFor:"name",className:"form-label d-flex align-items-center fw-semibold mb-3",style:{color:"#495057",fontSize:"14px"},children:[t.jsx("div",{className:"bg-primary bg-gradient rounded-circle d-flex align-items-center justify-content-center me-3",style:{width:"32px",height:"32px",minWidth:"32px"},children:t.jsx("i",{className:"bi bi-person text-white",style:{fontSize:"14px"}})}),t.jsx("span",{children:"  *"})]}),t.jsxs("div",{className:"position-relative",children:[t.jsx("input",{type:"text",className:`form-control shadow-sm ${a.name?"is-invalid":""}`,id:"name",name:"name",value:r.name,onChange:Q,placeholder:"  ",disabled:A,required:!0,style:{height:"50px",borderRadius:"10px",border:a.name?"2px solid #dc3545":"2px solid #e9ecef",fontSize:"15px",paddingLeft:"16px",paddingRight:"16px",transition:"all 0.3s ease"},onFocus:$=>{a.name||($.target.style.border="2px solid #007bff"),$.target.style.boxShadow="0 0 0 0.2rem rgba(0, 123, 255, 0.25)"},onBlur:$=>{a.name||($.target.style.border="2px solid #e9ecef"),$.target.style.boxShadow="none"}}),a.name&&t.jsxs("div",{className:"invalid-feedback d-flex align-items-center",style:{fontSize:"13px",marginTop:"8px"},children:[t.jsx("i",{className:"bi bi-exclamation-circle me-2"}),a.name]})]})]}),t.jsxs("div",{className:"col-md-6 mb-4",children:[t.jsxs("label",{htmlFor:"phone",className:"form-label d-flex align-items-center fw-semibold mb-3",style:{color:"#495057",fontSize:"14px"},children:[t.jsx("div",{className:"bg-success bg-gradient rounded-circle d-flex align-items-center justify-content-center me-3",style:{width:"32px",height:"32px",minWidth:"32px"},children:t.jsx("i",{className:"bi bi-telephone text-white",style:{fontSize:"14px"}})}),t.jsx("span",{children:" "})]}),t.jsxs("div",{className:"position-relative",children:[t.jsx("input",{type:"tel",className:`form-control shadow-sm ${a.phone?"is-invalid":""}`,id:"phone",name:"phone",value:r.phone,onChange:Q,placeholder:"   ()",disabled:A,style:{height:"50px",borderRadius:"10px",border:a.phone?"2px solid #dc3545":"2px solid #e9ecef",fontSize:"15px",paddingLeft:"16px",paddingRight:"16px",transition:"all 0.3s ease"},onFocus:$=>{a.phone||($.target.style.border="2px solid #28a745"),$.target.style.boxShadow="0 0 0 0.2rem rgba(40, 167, 69, 0.25)"},onBlur:$=>{a.phone||($.target.style.border="2px solid #e9ecef"),$.target.style.boxShadow="none"}}),a.phone&&t.jsxs("div",{className:"invalid-feedback d-flex align-items-center",style:{fontSize:"13px",marginTop:"8px"},children:[t.jsx("i",{className:"bi bi-exclamation-circle me-2"}),a.phone]})]})]}),t.jsxs("div",{className:"col-md-6 mb-4",children:[t.jsxs("label",{htmlFor:"email",className:"form-label d-flex align-items-center fw-semibold mb-3",style:{color:"#495057",fontSize:"14px"},children:[t.jsx("div",{className:"bg-info bg-gradient rounded-circle d-flex align-items-center justify-content-center me-3",style:{width:"32px",height:"32px",minWidth:"32px"},children:t.jsx("i",{className:"bi bi-envelope text-white",style:{fontSize:"14px"}})}),t.jsx("span",{children:" "})]}),t.jsxs("div",{className:"position-relative",children:[t.jsx("input",{type:"email",className:`form-control shadow-sm ${a.email?"is-invalid":""}`,id:"email",name:"email",value:r.email,onChange:Q,placeholder:"   ()",disabled:A,style:{height:"50px",borderRadius:"10px",border:a.email?"2px solid #dc3545":"2px solid #e9ecef",fontSize:"15px",paddingLeft:"16px",paddingRight:"16px",transition:"all 0.3s ease"},onFocus:$=>{a.email||($.target.style.border="2px solid #17a2b8"),$.target.style.boxShadow="0 0 0 0.2rem rgba(23, 162, 184, 0.25)"},onBlur:$=>{a.email||($.target.style.border="2px solid #e9ecef"),$.target.style.boxShadow="none"}}),a.email&&t.jsxs("div",{className:"invalid-feedback d-flex align-items-center",style:{fontSize:"13px",marginTop:"8px"},children:[t.jsx("i",{className:"bi bi-exclamation-circle me-2"}),a.email]})]})]}),t.jsxs("div",{className:"col-md-6 mb-4",children:[t.jsxs("label",{htmlFor:"city",className:"form-label d-flex align-items-center fw-semibold mb-3",style:{color:"#495057",fontSize:"14px"},children:[t.jsx("div",{className:"bg-warning bg-gradient rounded-circle d-flex align-items-center justify-content-center me-3",style:{width:"32px",height:"32px",minWidth:"32px"},children:t.jsx("i",{className:"bi bi-geo-alt text-white",style:{fontSize:"14px"}})}),t.jsx("span",{children:""})]}),t.jsxs("div",{className:"position-relative",children:[t.jsx("div",{style:{border:a.city?"2px solid #dc3545":"2px solid #e9ecef",borderRadius:"10px",transition:"all 0.3s ease",overflow:"hidden"},children:t.jsx(rc,{value:r.city,onChange:$=>{const H=$.target.value;i(te=>({...te,city:H})),a.city&&o(te=>({...te,city:""}))},className:"shadow-sm form-select",disabled:A,style:{height:"50px",border:"none",fontSize:"15px",paddingLeft:"16px",paddingRight:"45px",borderRadius:"0",backgroundPosition:"left 12px center",backgroundSize:"12px"}})}),a.city&&t.jsxs("div",{className:"invalid-feedback d-flex align-items-center",style:{fontSize:"13px",marginTop:"8px",display:"block"},children:[t.jsx("i",{className:"bi bi-exclamation-circle me-2"}),a.city]})]})]})]})]}),t.jsx("div",{className:"modal-footer border-0 pt-4",style:{background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)",borderRadius:"0 0 12px 12px"},children:t.jsxs("div",{className:"d-flex gap-3 w-100 justify-content-end",children:[t.jsxs("button",{type:"button",className:"btn shadow-sm",onClick:s,disabled:l,style:{width:"120px",height:"45px",borderRadius:"10px",background:"linear-gradient(135deg, #6c757d 0%, #495057 100%)",border:"none",color:"white",fontWeight:"500",fontSize:"14px",transition:"all 0.3s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseEnter:$=>{$.target.style.transform="translateY(-2px)",$.target.style.boxShadow="0 8px 25px rgba(108, 117, 125, 0.3)"},onMouseLeave:$=>{$.target.style.transform="translateY(0)",$.target.style.boxShadow="0 2px 8px rgba(0,0,0,0.1)"},children:[t.jsx("i",{className:"bi bi-x-circle",style:{fontSize:"16px"}}),t.jsx("span",{children:""})]}),!A&&t.jsx("button",{type:"submit",className:"btn shadow-sm",disabled:l,style:{width:"120px",height:"45px",borderRadius:"10px",background:l?"linear-gradient(135deg, #28a745 0%, #20c997 100%)":"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none",color:"white",fontWeight:"600",fontSize:"14px",transition:"all 0.3s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",opacity:l?.8:1},onMouseEnter:$=>{l||($.target.style.transform="translateY(-2px)",$.target.style.boxShadow="0 8px 25px rgba(0, 123, 255, 0.4)")},onMouseLeave:$=>{l||($.target.style.transform="translateY(0)",$.target.style.boxShadow="0 4px 12px rgba(0, 123, 255, 0.2)")},children:l?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",style:{width:"16px",height:"16px",borderWidth:"2px"}}),t.jsx("span",{children:" ..."})]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-check-circle",style:{fontSize:"16px"}}),t.jsx("span",{children:d?"":""})]})})]})})]})})})})},I6=({searchTerm:n})=>{const[e,s]=h.useState(0),[r,i]=h.useState(0);h.useEffect(()=>{a()},[n]);const a=async()=>{try{const o=await md.getAllCompetitors();if(s(o.length),n!=null&&n.trim()){const l=o.filter(c=>{var d,u,f,p,j;return((d=c.name)==null?void 0:d.toLowerCase().includes(n.toLowerCase()))||((u=c.email)==null?void 0:u.toLowerCase().includes(n.toLowerCase()))||((f=c.phone)==null?void 0:f.includes(n))||((p=c.company)==null?void 0:p.toLowerCase().includes(n.toLowerCase()))||((j=c.address)==null?void 0:j.toLowerCase().includes(n.toLowerCase()))});i(l.length)}else i(o.length)}catch(o){console.error("Error loading competitors count:",o),s(0),i(0)}};return t.jsx("span",{className:"badge bg-secondary ms-2",style:{fontSize:"12px",fontWeight:"normal"},children:n!=null&&n.trim()?`${r}  ${e}`:e})};function T6(){const[n,e]=h.useState(!1),[s,r]=h.useState(!1),[i,a]=h.useState(null),[o,l]=h.useState(0),[c,d]=h.useState(""),{isTimelineVisible:u}=Ut();kt();const f=()=>{e(!n)},p=()=>{a(null),r(!0)},j=D=>{a(D),r(!0)},L=()=>{console.log(" CompetitorsPage: Form saved, triggering list refresh"),r(!1),a(null),l(D=>D+1)},R=()=>{r(!1),a(null)};return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:f}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!u?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:""})]})}),t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"20px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:10,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-trophy text-primary me-2"})," "]}),t.jsx(I6,{searchTerm:c})]}),t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:c,onChange:D=>d(D.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsx("button",{onClick:p,className:"btn btn-primary",style:{height:"40px",width:"140px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:" "})]})]})}),t.jsx("div",{style:{height:"calc(100vh - 280px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"card-body p-0",children:t.jsx(E6,{onAdd:p,onEdit:j,refreshTrigger:o,searchTerm:c})})})]})}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&u&&t.jsx(os,{rtl:!0}),!n&&u&&t.jsx(ls,{}),s&&t.jsx("div",{className:"competitor-form",children:t.jsx(C6,{competitor:i,onSave:L,onCancel:R})})]})})})}function A6(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(T6,{})})})}class _6{static getCurrentUserUID(){if(!ut.currentUser)throw new Error("     ");return ut.currentUser.uid}static async validateActiveEmployee(){const e=this.getCurrentUserUID();try{const s=await ss(Le(ae,"employees",e));if(!s.exists())throw new Error("     ");const r=s.data();if(r.status!=="active")throw new Error("   ");return{uid:e,employeeData:r}}catch(s){throw new Error(`    : ${s.message}`)}}static async secureCollection(e){return await this.validateActiveEmployee(),Pe(ae,e)}static async secureDoc(e,s){return await this.validateActiveEmployee(),Le(ae,e,s)}static async secureAddDoc(e,s,r={}){const{uid:i}=await this.validateActiveEmployee(),a={...s,createdBy:i,createdAt:new Date().toISOString(),updatedBy:i,updatedAt:new Date().toISOString(),...r.additionalFields},o=Pe(ae,e);return await As(o,a)}static async secureSetDoc(e,s,r,i={}){const{uid:a}=await this.validateActiveEmployee(),o={...r,createdBy:a,createdAt:new Date().toISOString(),updatedBy:a,updatedAt:new Date().toISOString(),...i.additionalFields},l=Le(ae,e,s);return await yn(l,o,i.merge?{merge:!0}:{})}static async secureGetDoc(e,s){await this.validateActiveEmployee();const r=Le(ae,e,s);return await ss(r)}static async secureGetDocs(e,s=[]){await this.validateActiveEmployee();const r=Pe(ae,e);let i=r;return s.length>0&&(i=st(r,...s)),await qe(i)}static async secureUpdateDoc(e,s,r,i={}){const{uid:a}=await this.validateActiveEmployee(),o={...r,updatedBy:a,updatedAt:new Date().toISOString(),...i.additionalFields},l=Le(ae,e,s);return await Qt(l,o)}static async secureDeleteDoc(e,s,r={}){const{uid:i}=await this.validateActiveEmployee();if(r.hardDelete){const a=Le(ae,e,s);return await es(a)}else return await this.secureUpdateDoc(e,s,{isDeleted:!0,deletedBy:i,deletedAt:new Date().toISOString()})}static async secureOnSnapshot(e,s,r=[]){await this.validateActiveEmployee();const i=Pe(ae,e);let a=i;return r.length>0&&(a=st(i,...r)),ar(a,s)}static async secureBatchWrite(e){const{uid:s}=await this.validateActiveEmployee(),r=Fr(ae);return e.forEach(i=>{const a=Le(ae,i.collection,i.id);if(i.type==="set"){const o={...i.data,createdBy:s,createdAt:new Date().toISOString(),updatedBy:s,updatedAt:new Date().toISOString()};r.set(a,o)}else if(i.type==="update"){const o={...i.data,updatedBy:s,updatedAt:new Date().toISOString()};r.update(a,o)}else i.type==="delete"&&r.delete(a)}),await r.commit()}static async secureTransaction(e){const{uid:s}=await this.validateActiveEmployee();return await fh(ae,r=>e(r,s))}static async createEmployeeDoc(e,s=null){const r=this.getCurrentUserUID(),i=s||r;s&&s!==r&&await this.validateActiveEmployee();const a={...e,createdBy:r,createdAt:new Date().toISOString(),updatedBy:r,updatedAt:new Date().toISOString()},o=Le(ae,"employees",i);return await yn(o,a)}static async updateOwnEmployeeDoc(e){const s=this.getCurrentUserUID(),r={...e,updatedBy:s,updatedAt:new Date().toISOString()},i=Le(ae,"employees",s);return await Qt(i,r)}static async getOwnEmployeeDoc(){const e=this.getCurrentUserUID(),s=Le(ae,"employees",e);return await ss(s)}}const hl="companies";class Uu{static async getAllCompanies(){try{let e=[];try{e.push(as("createdAt","desc"))}catch{console.log("Using query without orderBy for empty collection"),e=[]}const r=(await _6.secureGetDocs(hl,e)).docs.map(i=>{var o,l;const a=i.data();return{id:i.id,internalId:a.internalId||Ct("COMPANY"),...a,createdAt:(o=a.createdAt)==null?void 0:o.toDate(),updatedAt:(l=a.updatedAt)==null?void 0:l.toDate()}});return r.length>0&&r[0].createdAt&&r.sort((i,a)=>(a.createdAt||new Date(0))-(i.createdAt||new Date(0))),r}catch(e){if(console.error("Error fetching companies:",e),e.code==="failed-precondition"||e.code==="not-found")return console.log("Companies collection not found, returning empty array"),[];throw new Error("   ")}}static async createCompany(e){try{const s=Ct("COMPANY"),r={...e,internalId:s,createdAt:We(),updatedAt:We()};return(await As(Pe(ae,hl),r)).id}catch(s){throw console.error("Error creating company:",s),new Error("   ")}}static async updateCompany(e,s){try{const r=Le(ae,hl,e),i={...s,updatedAt:We()};return await Qt(r,i),!0}catch(r){throw console.error("Error updating company:",r),new Error("    ")}}static async getCompanyById(e){var s,r;try{const i=Le(ae,hl,e),a=await ss(i);if(a.exists()){const o=a.data();return{id:a.id,internalId:o.internalId||Ct("COMPANY"),...o,createdAt:(s=o.createdAt)==null?void 0:s.toDate(),updatedAt:(r=o.updatedAt)==null?void 0:r.toDate()}}else return null}catch(i){throw console.error("Error fetching company by ID:",i),new Error("    ")}}static async getCompanyByInternalId(e){var s,r;try{const i=Pe(ae,hl),a=st(i,xt("internalId","==",e)),o=await qe(a);if(o.empty)return null;{const l=o.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:(s=c.createdAt)==null?void 0:s.toDate(),updatedAt:(r=c.updatedAt)==null?void 0:r.toDate()}}}catch(i){throw console.error("Error fetching company by internal ID:",i),new Error("    ")}}static async updateCompanyByInternalId(e,s){try{const r=await this.getCompanyByInternalId(e);if(!r)throw new Error("Company not found");return await this.updateCompany(r.id,s)}catch(r){throw console.error("Error updating company by internal ID:",r),new Error("    ")}}static async deleteCompany(e){try{const s=Le(ae,hl,e);return await es(s),!0}catch(s){throw console.error("Error deleting company:",s),new Error("   ")}}static async deleteCompanyByInternalId(e){try{const s=await this.getCompanyByInternalId(e);if(!s)throw new Error("Company not found");return await this.deleteCompany(s.id)}catch(s){throw console.error("Error deleting company by internal ID:",s),new Error("   ")}}static async searchCompanies(e){try{const s=Pe(ae,hl);return(await qe(s)).docs.map(o=>{var c,d;const l=o.data();return{id:o.id,internalId:l.internalId||Ct("COMPANY"),...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}}).filter(o=>{var l,c,d;return((l=o.name)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))||((c=o.email)==null?void 0:c.toLowerCase().includes(e.toLowerCase()))||((d=o.phone)==null?void 0:d.includes(e))})}catch(s){throw console.error("Error searching companies:",s),new Error("    ")}}static async migrateExistingData(){try{console.log("Starting companies migration...");const e=await this.getAllCompanies();let s=0;for(const r of e)if(!r.internalId||!r.internalId.startsWith("comp_")){const i=Ct("COMPANY");await this.updateCompany(r.id,{...r,internalId:i}),s++,console.log(`Migrated company: ${r.name} -> ${i}`)}return console.log(`Migration completed. ${s} companies migrated.`),{success:!0,migratedCount:s}}catch(e){throw console.error("Error during migration:",e),new Error("   ")}}static validateCompanyData(e){var r,i,a;const s={};return(r=e.name)!=null&&r.trim()||(s.name="  "),(i=e.email)!=null&&i.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(s.email="    "):s.email="  ",(a=e.phone)!=null&&a.trim()||(s.phone="  "),s}}const R6=({onEdit:n,onAdd:e,refreshTrigger:s})=>{const[r,i]=h.useState([]),[a,o]=h.useState(!0),[l,c]=h.useState(null),[d,u]=h.useState(""),[f,p]=h.useState([]),[j,L]=h.useState(!1),{logActivity:R,getCurrentUser:D}=Zt(),{alertConfig:y,closeAlert:T,showSuccess:x,showError:S,showConfirm:A}=Bt(),{currentPage:Q,totalPages:q,paginatedItems:B,handlePageChange:$,resetPage:H,totalItems:te,itemsPerPage:G}=cr(f,30);h.useEffect(()=>{F()},[]),h.useEffect(()=>{s&&F()},[s]),h.useEffect(()=>{if(d.trim()){const Y=r.filter(z=>{var O,E,k;return((O=z.name)==null?void 0:O.toLowerCase().includes(d.toLowerCase()))||((E=z.email)==null?void 0:E.toLowerCase().includes(d.toLowerCase()))||((k=z.phone)==null?void 0:k.includes(d))});p(Y)}else p(r);H()},[d,r,H]);const F=async()=>{try{o(!0);const Y=await Uu.getAllCompanies();i(Y),c(null)}catch(Y){c(Y.message)}finally{o(!1)}},X=Y=>{A(`      

${Y.name}`,()=>ue(Y),"  ")},ue=async Y=>{try{L(!0),await bs.moveToTrash(Y,"companies"),await Uu.deleteCompany(Y.id);const z=D();R("task",`${z.name}  `,`  : ${Y.name}`),await F(),x(`   : ${Y.name}`,"  ")}catch(z){c(z.message),S(`    : ${z.message}`,"  ")}finally{L(!1)}};return a?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"spinner-border text-primary",role:"status",children:t.jsx("span",{className:"visually-hidden",children:" ..."})}),t.jsx("p",{className:"mt-3 text-muted",children:"   ..."})]})}):l?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:l}),t.jsxs("button",{className:"btn btn-primary",onClick:F,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):t.jsxs("div",{className:"card shadow-sm","data-list":"companies",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"row align-items-center justify-content-between",children:[t.jsx("div",{className:"col-lg-4",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-building-fill text-primary me-2"}),"  (",f.length,")"]})}),t.jsx("div",{className:"col-lg-8",children:t.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[t.jsxs("div",{className:"input-group suppliers-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:d,onChange:Y=>u(Y.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted"})})]}),t.jsx(Tt,{can:"companies:create",mode:"disable",children:t.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:e,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[t.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"  "]})})]})})]})}),t.jsxs("div",{className:"card-body p-0",children:[f.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-building fs-1"})}),t.jsx("h5",{className:"text-muted",children:"  "}),t.jsx("p",{className:"text-muted",children:d?"    ":"     "}),!d&&t.jsx(Tt,{can:"companies:create",mode:"disable",children:t.jsxs("button",{className:"btn btn-primary",onClick:e,children:[t.jsx("i",{className:"bi bi-plus-lg me-1"}),"  "]})})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:"60px"},children:"#"}),t.jsx("th",{children:" "}),t.jsx("th",{children:" "}),t.jsx("th",{children:""}),t.jsx("th",{children:""}),t.jsx("th",{style:{width:"120px"},children:""})]})}),t.jsx("tbody",{children:B.map((Y,z)=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(Q-1)*G+z+1})}),t.jsx("td",{children:t.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",onClick:()=>n(Y),style:{textDecoration:"none"},title:`Internal ID: ${Y.internalId||"Not Set"}`,children:Y.name})}),t.jsx("td",{children:t.jsx("a",{href:`mailto:${Y.email}`,className:"text-decoration-none",children:Y.email})}),t.jsx("td",{style:{direction:"ltr",textAlign:"left"},children:Y.phone}),t.jsx("td",{children:Y.city||"-"}),t.jsx("td",{children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(Tt,{can:"companies:update",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-primary",onClick:()=>n(Y),title:"",children:t.jsx("i",{className:"bi bi-pencil"})})}),t.jsx(Tt,{can:"companies:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>X(Y),title:"",children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},Y.internalId||Y.id))})]})}),f.length>0&&t.jsx(dr,{currentPage:Q,totalPages:q,onPageChange:$,totalItems:te,itemsPerPage:G})]}),t.jsx(Mt,{show:y.show,onClose:T,title:y.title,message:y.message,type:y.type,onConfirm:y.onConfirm,confirmText:y.confirmText,cancelText:y.cancelText,showCancel:y.showCancel})]})};class ba{static async withRetry(e,{retries:s=5,base:r=150}={}){let i=0;for(;;)try{return await e()}catch(a){if(i++,i>s)throw a;const o=Math.floor(r*Math.pow(2,i-1)+Math.random()*r);await new Promise(l=>setTimeout(l,o))}}static async uploadDocument(e,{companyId:s,companyName:r="",companyEmail:i="",customFileName:a,expiryDate:o,userId:l}={}){console.log(" Starting company document upload:",e.name);try{if(!ut.currentUser)throw new Error("    ");const c=l||ut.currentUser.uid,d=await As(Pe(ae,this.collectionName),{fileName:a||e.name,originalFileName:e.name,size:e.size,fileSize:e.size,contentType:e.type||"application/octet-stream",fileType:e.type||"application/octet-stream",status:"uploading",isTrashed:!1,companyId:s||"new",companyName:r,companyEmail:i,expiryDate:o||null,createdAt:We(),updatedAt:We(),trashedAt:null,trashedBy:null,uploadedBy:c,url:null,fileURL:null,storagePath:null});console.log(" Company document shell created:",d.id),console.log(" About to call fileStorageService.uploadFile with:",{fileName:e.name,fileSize:e.size,folder:"company-documents"});const u=await Ss.uploadFile(e,"company-documents");return console.log(" File uploaded to storage:",u.path),await Qt(Le(ae,this.collectionName,d.id),{url:u.url,fileURL:u.url,storagePath:u.path,status:"ready",updatedAt:We()}),console.log(" Company document upload completed:",d.id),{id:d.id,fileName:a||e.name,originalFileName:e.name,url:u.url,fileURL:u.url,storagePath:u.path,size:e.size,fileSize:e.size,contentType:e.type||"application/octet-stream",fileType:e.type||"application/octet-stream"}}catch(c){throw console.error(" Company document upload failed:",c),new Error(`    : ${c.message}`)}}static async moveDocumentToTrash(e,{userId:s}={}){var i;const r=s||((i=ut.currentUser)==null?void 0:i.uid)||"system";console.log(" Moving company document to trash:",{documentId:e,userId:r,collection:this.collectionName});try{await this.withRetry(async()=>{await fh(ae,async a=>{const o=Le(ae,this.collectionName,e),l=await a.get(o);if(console.log(" Document lookup result:",{documentId:e,exists:l.exists(),collection:this.collectionName}),!l.exists())throw console.error(" Document not found in Firebase:",{documentId:e,collection:this.collectionName,attemptedPath:`${this.collectionName}/${e}`}),new Error(`       (ID: ${e})`);const c=l.data();if(console.log(" Document data:",{fileName:c.fileName,isTrashed:c.isTrashed,status:c.status}),c.isTrashed===!0){console.log("Company document already trashed - idempotent operation");return}a.update(o,{isTrashed:!0,trashedAt:We(),trashedBy:r,updatedAt:We()})})}),console.log(" Company document moved to trash successfully")}catch(a){throw console.error(" Error moving company document to trash:",{documentId:e,error:a.message,stack:a.stack}),a.message.includes("   ")?a:new Error(`     : ${a.message}`)}}static async restoreDocumentFromTrash(e){console.log(" Restoring company document from trash:",e),await this.withRetry(async()=>{await fh(ae,async s=>{const r=Le(ae,this.collectionName,e),i=await s.get(r);if(!i.exists())throw new Error("   ");if(i.data().isTrashed===!1){console.log("Company document already active - idempotent operation");return}s.update(r,{isTrashed:!1,trashedAt:null,trashedBy:null,updatedAt:We()})})}),console.log(" Company document restored from trash successfully")}static subscribeToCompanyDocuments(e,s){console.log(" Setting up Firebase subscription for companyId:",e);const r=st(Pe(ae,this.collectionName),xt("companyId","==",e),xt("isTrashed","==",!1));return console.log(" Firebase query created for company documents:",{collection:this.collectionName,companyId:e,filters:["companyId ==",e,"isTrashed ==",!1]}),ar(r,i=>{console.log(" Firebase snapshot received for company documents:"),console.log("- Snapshot size:",i.size),console.log("- Snapshot empty:",i.empty);const a=[];i.forEach(o=>{const l=o.data(),c={id:o.id,...l,fileURL:l.fileURL||l.url,fileType:l.fileType||l.contentType,fileSize:l.fileSize||l.size};console.log("- Company document found:",{id:o.id,fileName:c.fileName,companyId:c.companyId,isTrashed:c.isTrashed,status:c.status,hasURL:!!c.fileURL,hasExpiryDate:!!c.expiryDate}),a.push(c)}),a.sort((o,l)=>{var u,f;const c=((u=o.updatedAt)==null?void 0:u.seconds)||0;return(((f=l.updatedAt)==null?void 0:f.seconds)||0)-c}),console.log(" Calling callback with",a.length,"company documents (sorted manually)"),s(a)},i=>{console.error(" Company document subscription error:",i),console.error("Error details:",{code:i.code,message:i.message,companyId:e,collection:this.collectionName}),s([])})}static subscribeToTrashedDocuments(e){const s=st(Pe(ae,this.collectionName),xt("isTrashed","==",!0));return ar(s,r=>{const i=[];r.forEach(a=>{i.push({id:a.id,...a.data()})}),i.sort((a,o)=>{var d,u;const l=((d=a.updatedAt)==null?void 0:d.seconds)||0;return(((u=o.updatedAt)==null?void 0:u.seconds)||0)-l}),e(i)},r=>{console.error("Company trashed documents subscription error:",r),e([])})}static async getCompanyDocuments(e){try{console.log(" Getting company documents for ID:",e);const s=st(Pe(ae,this.collectionName),xt("companyId","==",e),xt("isTrashed","==",!1)),r=await qe(s),i=[];return r.forEach(a=>{const o=a.data(),l={id:a.id,...o,fileURL:o.fileURL||o.url,fileType:o.fileType||o.contentType,fileSize:o.fileSize||o.size};console.log(" Found document:",l.fileName,"for company:",l.companyId),i.push(l)}),console.log(` Total documents found for company ${e}: ${i.length}`),i.sort((a,o)=>{var d,u;const l=((d=a.updatedAt)==null?void 0:d.seconds)||0;return(((u=o.updatedAt)==null?void 0:u.seconds)||0)-l}),i}catch(s){throw console.error("Error getting company documents:",s),new Error(`    : ${s.message}`)}}static async getAllDocuments(){try{const e=await qe(Pe(ae,this.collectionName)),s=[];return e.forEach(r=>{s.push({id:r.id,...r.data()})}),s.sort((r,i)=>{var l,c;const a=((l=r.updatedAt)==null?void 0:l.seconds)||0;return(((c=i.updatedAt)==null?void 0:c.seconds)||0)-a}),s}catch(e){throw console.error("Error getting all company documents:",e),new Error(`     : ${e.message}`)}}static async getTrashedDocuments(){try{const e=st(Pe(ae,this.collectionName),xt("isTrashed","==",!0)),s=await qe(e),r=[];return s.forEach(i=>{r.push({id:i.id,...i.data()})}),r.sort((i,a)=>{var c,d;const o=((c=i.updatedAt)==null?void 0:c.seconds)||0;return(((d=a.updatedAt)==null?void 0:d.seconds)||0)-o}),r}catch(e){throw console.error("Error getting trashed company documents:",e),new Error(`     : ${e.message}`)}}static async permanentlyDeleteDocuments(e=[]){if(!e.length)return;console.log(" Permanently deleting company documents:",e);const s=Fr(ae),r=e.map(o=>Le(ae,this.collectionName,o)),i=await Promise.all(r.map(o=>ss(o))),a=[];i.forEach(o=>{if(!o.exists())return;const l=o.data();if(l.isTrashed===!0&&(s.delete(Le(ae,this.collectionName,o.id)),l.storagePath)){const c=ii(In,l.storagePath);a.push(xh(c).catch(d=>{console.warn("Storage delete failed (continuing):",d)}))}}),await s.commit(),await Promise.allSettled(a),console.log(" Company documents permanently deleted")}static async updateDocumentCompanyId(e,s,r={}){console.log(" Updating company documents from temp ID to real ID:",{oldCompanyId:e,newCompanyId:s,companyName:r.name});try{const i=st(Pe(ae,this.collectionName),xt("companyId","==",e),xt("isTrashed","==",!1)),a=await qe(i);if(a.empty)return console.log("No documents found with old company ID:",e),0;console.log(`Found ${a.size} documents to update company ID`);const o=[];return a.forEach(l=>{const c={companyId:s,companyName:r.name||"",companyEmail:r.email||"",updatedAt:We()};o.push(Qt(Le(ae,this.collectionName,l.id),c))}),await Promise.all(o),console.log(` Updated ${a.size} documents with new company ID:`,s),a.size}catch(i){throw console.error(" Error updating document company IDs:",i),new Error(`    : ${i.message}`)}}static async deleteDocument(e){return await this.moveDocumentToTrash(e)}}Ys(ba,"collectionName","companydocuments"),Ys(ba,"storagePath","company-documents");const D6=({expiryDate:n,className:e="",style:s={}})=>{const[r,i]=h.useState("00"),[a,o]=h.useState(!1);return h.useEffect(()=>{if(!n){i("00"),o(!1);return}const l=()=>{try{const d=new Date,[u,f,p]=n.split("-").map(Number),L=new Date(u,f-1,p,23,59,59).getTime()-d.getTime();if(L<=0){i("00"),o(!0);return}const R=Math.floor(L/1e3),D=Math.floor(R/(24*60*60)),T=(x=>x.toString().padStart(2,"0"))(D);i(T),o(!1)}catch(d){console.error("CountdownTimer error:",d),i("--"),o(!1)}};l();const c=setInterval(l,1e3);return()=>clearInterval(c)},[n]),a?t.jsx("div",{className:`countdown-timer expired ${e}`,style:s,children:t.jsx("div",{className:"digital-display text-danger",children:t.jsx("small",{className:"fw-bold",children:" "})})}):t.jsx("div",{className:`countdown-timer ${e}`,style:s,children:t.jsx("div",{className:"digital-display",children:t.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{fontSize:"14px",fontFamily:"monospace"},children:t.jsx("span",{className:"text-danger fw-bold",children:r})})})})},P6=({show:n,onClose:e,title:s=" ",documents:r=[],setDocuments:i,companyId:a="new",companyName:o="",companyEmail:l="",canCreate:c=!0,canDelete:d=!0,canView:u=!0,readOnly:f=!1})=>{const[p,j]=h.useState(!1),[L,R]=h.useState(null),[D,y]=h.useState(""),[T,x]=h.useState(""),[S,A]=h.useState(!1),[Q,q]=h.useState(null),[B,$]=h.useState(null),[H,te]=h.useState(null),G=h.useRef(null),{alertConfig:F,closeAlert:X,showSuccess:ue,showError:Y,showConfirm:z}=Bt(),{logActivity:O,getCurrentUser:E}=Zt(),{currentUser:k}=Bo(),{formatDate:b}=sc();h.useEffect(()=>{if(n&&a){console.log(" Modal opened - setting up Firebase subscription for company documents:",a);const ne=ba.subscribeToCompanyDocuments(a,ye=>{console.log(" Received company documents from Firebase:",ye.length),i&&i(ye)});return te(()=>ne),()=>{ne&&(console.log(" Cleaning up Firebase subscription for company documents"),ne())}}},[n,a,i]),h.useEffect(()=>{!n&&H&&(console.log(" Modal closed - cleaning up Firebase subscription"),H(),te(null))},[n,H]);const N=ne=>{var pe;const ye=(pe=ne.target.files)==null?void 0:pe[0];ye?(console.log(" File selected - processing:",ye.name),I(ye)):console.log(" File selection cancelled"),ne.target.value=""},I=async ne=>{console.log(" Document file selected:",{name:ne.name,size:ne.size,type:ne.type}),A(!0);try{Ss.validateFile(ne,{maxSize:10*1024*1024,allowedTypes:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png","image/jpg"]}),console.log(" Preparing company document for upload:",ne.name),R({file:ne,originalFileName:ne.name,fileSize:ne.size,fileType:ne.type}),y(ne.name.split(".")[0]),console.log(" Opening file name modal (bypass system active)"),j(!0),console.log(" Document file validated and ready for naming")}catch(ye){console.error(" File validation failed:",ye),Y(ye.message,"  ")}finally{A(!1)}},P=()=>{var ne;console.log(" MULTI-UPLOAD: Starting file upload with enhanced bypass"),$(null),Kr(2e4),(ne=G.current)==null||ne.click()},_=ne=>{var ye;console.log(" MULTI-UPLOAD: Starting document replacement with enhanced bypass"),$(ne.id),Kr(2e4),(ye=G.current)==null||ye.click()},C=async()=>{if(!D.trim()){Y("   ","  ");return}if(!L){Y("   ","");return}j(!1);const ne=L.file,ye=D.trim(),pe=B;R(null),y(""),x(""),$(null);try{A(!0),console.log(" Uploading company document to Firebase via service:",ye);const be=E();pe&&(console.log(" Deleting old expired document before uploading replacement:",pe),r.find(Re=>Re.id===pe)&&(await ba.deleteDocument(pe),console.log(" Old expired document deleted successfully"))),console.log(" About to upload document with authUser:",{uid:k==null?void 0:k.uid,email:k==null?void 0:k.email,hasUser:!!k});const xe=await ba.uploadDocument(ne,{companyId:a,companyName:o,companyEmail:l,customFileName:ye,uploadDate:new Date().toISOString().split("T")[0],expiryDate:T||null,userId:k==null?void 0:k.uid});console.log(" Document uploaded successfully via Firebase service:",xe),pe?(ue(`   : ${ye}`," "),O("file",`${be.name}     `,`  : ${ye}`)):(ue(`   : ${ye}`," "),O("file",`${be.name}   `,`  : ${ye}`))}catch(be){console.error(" Error uploading company document via Firebase:",be),Y(`   : ${be.message}`,"  ")}finally{A(!1)}},U=()=>{console.log("User cancelled company document upload"),j(!1),R(null),y(""),x("")},w=ne=>{const ye=ne.documentFileURL||ne.fileURL||ne.url;ye?window.open(ye,"_blank"):Y("   ","  ")},W=ne=>{z(`      

${ne.fileName}`,async()=>{try{A(!0);const ye=E();await ba.moveDocumentToTrash(ne.id,{userId:k==null?void 0:k.uid}),O("task",`${ye.name}   `,`  : ${ne.fileName}`),ue(`   : ${ne.fileName}`,"  ")}catch(ye){console.error(" Error deleting company document:",ye),Y(`   : ${ye.message}`,"  ")}finally{A(!1)}},"  ")},ie=()=>{console.log(" Modal closing"),j(!1),R(null),y(""),x(""),e()},de=ne=>ne?ne.includes("pdf")?{icon:"bi-file-earmark-pdf",color:"#dc3545"}:ne.includes("word")||ne.includes("document")?{icon:"bi-file-earmark-word",color:"#2b579a"}:ne.includes("image")?{icon:"bi-file-earmark-image",color:"#198754"}:{icon:"bi-file-earmark",color:"#6c757d"}:{icon:"bi-file-earmark",color:"#6c757d"};return n?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.8)",zIndex:99980,position:"fixed",top:0,left:0,right:0,bottom:0},tabIndex:"-1",dir:"rtl",children:t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"12px 12px 0 0"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-building-fill me-2"}),s]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:ie,"aria-label":"Close"})]}),t.jsxs("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"},children:[t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[t.jsxs("div",{children:[t.jsx("h6",{className:"mb-0 fw-bold text-primary",children:"  "}),t.jsx("div",{className:"d-flex align-items-center gap-3",children:t.jsxs("small",{className:"text-muted",children:[" : ",r.length]})})]}),t.jsx("div",{style:{marginLeft:"20px"},children:t.jsx(Tt,{can:"documents:create",mode:"disable",children:t.jsx("button",{type:"button",className:"btn btn-primary",onClick:P,disabled:S,style:{height:"32px",minWidth:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",fontWeight:"500"},children:S?t.jsxs(t.Fragment,{children:[t.jsx(It,{size:"small"}),t.jsx("span",{className:"ms-2",children:"..."})]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-cloud-upload me-1"})," "]})})})})]})}),r.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-building fs-1"})}),t.jsx("h5",{className:"text-muted",children:"  "}),t.jsx("p",{className:"text-muted",children:"    "})]}):t.jsx("div",{className:"table-responsive company-documents-table",children:t.jsxs("table",{className:"table table-hover custom-striped",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""})]})}),t.jsx("tbody",{children:r.map((ne,ye)=>{const pe=ne.fileName||"  ",be=de(ne.documentFileType),xe=ne.expiryDate&&new Date(ne.expiryDate)<new Date;return t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",children:ne.documentFileURL||ne.fileURL||ne.url?t.jsx(Ad,{size:25,clickable:!0,onClick:()=>w(ne),title:` : ${ne.documentFileName||ne.fileName}`}):t.jsx("i",{className:be.icon,style:{color:be.color,fontSize:"24px"}})}),t.jsxs("td",{className:"text-center",children:[t.jsx("div",{className:"fw-bold",children:pe}),ne.description&&t.jsx("small",{className:"text-muted",children:ne.description})]}),t.jsx("td",{className:"text-center",children:ne.expiryDate?t.jsx("small",{className:"text-muted",children:b(ne.expiryDate)}):t.jsx("small",{className:"text-muted",children:" "})}),t.jsx("td",{className:"text-center",children:ne.expiryDate?t.jsx(D6,{expiryDate:ne.expiryDate,style:{minWidth:"80px"}},`countdown-${ne.id}-${ne.expiryDate}`):t.jsx("small",{className:"text-muted",children:"-"})}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[!xe&&t.jsx(Tt,{can:"documents:read",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-primary",onClick:()=>w(ne),disabled:!ne.documentFileURL&&!ne.fileURL&&!ne.url,title:ne.documentFileURL||ne.fileURL||ne.url?` : ${ne.documentFileName||ne.fileName}`:"  ",style:{width:"28px",height:"32px"},children:t.jsx("i",{className:"bi bi-eye"})})}),xe?t.jsx(Tt,{can:"documents:create",mode:"disable",children:t.jsx("button",{className:"btn btn-warning",onClick:()=>_(ne),title:"  ",style:{width:"28px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx("i",{className:"bi bi-folder2-open",style:{color:"black",fontSize:"12px"}})})}):t.jsx(Tt,{can:"documents:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>W(ne),title:"",style:{width:"28px",height:"32px"},children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},ne.id||ye)})})]})})]}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:e,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px"},children:""}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{ue("   "," "),setTimeout(()=>e(),1500)},style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px"},children:""})]})})]})})}),p&&t.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.9)",zIndex:99990,position:"fixed",top:0,left:0,right:0,bottom:0},tabIndex:"-1",dir:"rtl",children:t.jsx("div",{className:"modal-dialog modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"12px 12px 0 0"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-pencil-square me-2"})," "]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:U,"aria-label":"Close"})]}),t.jsx("div",{className:"modal-body",style:{padding:"25px"},children:t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"d-flex align-items-center mb-3",children:[t.jsx("div",{className:"bg-success bg-opacity-10 p-2 rounded-circle me-3",children:t.jsx("i",{className:"bi bi-file-earmark-check text-success"})}),t.jsxs("div",{children:[t.jsx("h6",{className:"mb-0 fw-bold text-success",children:"   "}),t.jsx("small",{className:"text-muted",children:L==null?void 0:L.originalFileName})]})]}),t.jsxs("div",{className:"mb-3",children:[t.jsxs("label",{className:"form-label fw-bold text-primary",children:[t.jsx("i",{className:"bi bi-tag me-1"}),"   *"]}),t.jsx("input",{type:"text",className:"form-control",value:D,onChange:ne=>y(ne.target.value),placeholder:"   ",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:ne=>{ne.target.style.borderColor="#28a745",ne.target.style.boxShadow="0 0 0 0.2rem rgba(40, 167, 69, 0.25)"},onBlur:ne=>{ne.target.style.borderColor="#e9ecef",ne.target.style.boxShadow="none"},autoFocus:!0}),t.jsxs("small",{className:"text-muted",children:[t.jsx("i",{className:"bi bi-info-circle me-1"}),"         "]})]}),t.jsxs("div",{className:"mb-3",children:[t.jsxs("label",{className:"form-label fw-bold text-warning",children:[t.jsx("i",{className:"bi bi-calendar-event me-1"}),"  "]}),t.jsx("input",{type:"date",className:"form-control",value:T,onChange:ne=>x(ne.target.value),placeholder:"   ",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:ne=>{ne.target.style.borderColor="#ffc107",ne.target.style.boxShadow="0 0 0 0.2rem rgba(255, 193, 7, 0.25)"},onBlur:ne=>{ne.target.style.borderColor="#e9ecef",ne.target.style.boxShadow="none"}}),t.jsxs("small",{className:"text-muted",children:[t.jsx("i",{className:"bi bi-info-circle me-1"}),"       "]})]})]})}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:t.jsxs("div",{className:"d-flex justify-content-end",style:{gap:"12px"},children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:U,style:{height:"32px",fontSize:"13px",borderRadius:"6px",padding:"0 12px",width:"80px"},children:""}),t.jsxs("button",{type:"button",className:"btn btn-primary",onClick:C,disabled:!D.trim(),style:{height:"32px",fontSize:"13px",borderRadius:"6px",padding:"0 12px",width:"80px"},children:[t.jsx("i",{className:"bi bi-check-lg me-1"}),""]})]})})]})})}),t.jsx(Mt,{show:F.show,onClose:X,title:F.title,message:F.message,type:F.type,onConfirm:F.onConfirm,showConfirm:F.showConfirm}),t.jsx("input",{ref:G,type:"file",accept:".pdf,.doc,.docx,.jpg,.png,.jpeg",onChange:N,style:{position:"absolute",left:"-9999px",top:"-9999px",width:"1px",height:"1px",opacity:0,pointerEvents:"none",zIndex:-1},tabIndex:-1,"aria-hidden":"true"})]}):null},k6=({company:n,onSave:e,onCancel:s})=>{const[r,i]=h.useState({name:"",email:"",phone:"",address:"",city:"",taxNumber:"",bankAccount:"",notes:"",active:!0}),[a,o]=h.useState({}),[l,c]=h.useState(!1),[d,u]=h.useState(!1),[f,p]=h.useState([]),[j,L]=h.useState(!1),[R,D]=h.useState(null),[y,T]=h.useState(null),x=!!n,{logActivity:S,getCurrentUser:A}=Zt(),{hasPerm:Q,readOnly:q}=Yn(),B=Q("companies:create"),$=Q("companies:update"),H=q||x&&!$||!x&&!B;h.useEffect(()=>{n&&i({name:n.name||"",email:n.email||"",phone:n.phone||"",address:n.address||"",city:n.city||"",taxNumber:n.taxNumber||"",bankAccount:n.bankAccount||"",notes:n.notes||"",active:n.active!==void 0?n.active:!0})},[n]),h.useEffect(()=>{(()=>{x&&(n!=null&&n.id)?te():(async()=>{L(!0);try{const z=await ba.getCompanyDocuments("new");console.log(" Loaded temp company documents from Firebase:",z.length),p(z)}catch(z){console.error("Error loading temp company documents from Firebase:",z),p([])}finally{L(!1)}})()})()},[x,n==null?void 0:n.id]),h.useEffect(()=>()=>{y&&(console.log(" Cleaning up Firebase subscription for company documents"),y())},[y]);const te=()=>{if(!(n!=null&&n.id))return;L(!0),y&&y();const ue=ba.subscribeToCompanyDocuments(n.id,Y=>{console.log(" Received company documents from Firebase:",Y.length),p(Y),L(!1),D(null)});T(()=>ue)},G=()=>{console.log("Opening document modal..."),u(!0)},F=ue=>{const{name:Y,value:z,type:O,checked:E}=ue.target;i(k=>({...k,[Y]:O==="checkbox"?E:z})),a[Y]&&o(k=>({...k,[Y]:""}))},X=async ue=>{ue.preventDefault();const Y=Uu.validateCompanyData(r);if(Object.keys(Y).length>0){o(Y);return}c(!0),o({});try{const z=await Bn.validateUniqueFields(r,x?n.id:null,x?"companies":null);if(Object.keys(z).length>0){o(z),c(!1);return}const O={...r,status:x&&n.status||"active"};if(x){await Uu.updateCompany(n.id,O);const E=A();S("task",`${E.name}  `,`  : ${O.name}`)}else{const E=await Uu.createCompany(O);try{const b=await ba.updateDocumentCompanyId("new",E,O);b>0&&console.log(` Linked ${b} documents to new company:`,E)}catch(b){console.warn(" Failed to link documents to new company:",b)}const k=A();S("task",`${k.name}  `,`  : ${O.name}`)}e()}catch(z){o({submit:z.message})}finally{c(!1)}};return t.jsxs("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.6)",zIndex:99990,position:"fixed",top:0,left:0,right:0,bottom:0},children:[t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",children:[t.jsx("div",{className:"modal-header",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-between w-100",children:[t.jsxs("h5",{className:"modal-title mb-0",children:[t.jsx("i",{className:"bi bi-building-plus-fill text-primary me-2"}),x?" ":"  "]}),t.jsxs("div",{className:"d-flex align-items-center",style:{gap:"15px"},children:[x&&t.jsx("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:G,disabled:j,style:{height:"32px",fontSize:"13px",borderRadius:"6px",padding:"0 12px",whiteSpace:"nowrap",marginLeft:"20px"},children:j?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"spinner-border spinner-border-sm me-1",role:"status",style:{width:"12px",height:"12px"}}),"..."]}):R?t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-1 text-warning"})," "]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-file-earmark-text me-1"}),"  (",f.length,")"]})}),t.jsx("button",{type:"button",className:"btn-close",onClick:s})]})]})}),t.jsxs("form",{onSubmit:X,children:[t.jsxs("div",{className:"modal-body",children:[H&&t.jsx("div",{className:"alert alert-info border-0 shadow-sm mb-4",children:t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-info-circle-fill text-info me-3 fs-5"}),t.jsxs("div",{children:[t.jsx("strong",{className:"fw-bold",children:"  "}),t.jsx("div",{className:"mt-1",children:t.jsxs("span",{className:"ms-2",children:[!$&&x&&"    ",!B&&!x&&"     ",q&&"     "]})})]})]})}),a.submit&&t.jsxs("div",{className:"alert alert-danger",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.submit]}),R&&t.jsxs("div",{className:"alert alert-warning d-flex align-items-center justify-content-between",children:[t.jsxs("div",{children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"    : ",R]}),t.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:te,style:{borderRadius:"4px"},children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-1"})," "]})]}),t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"text",className:`form-control ${a.name?"is-invalid":""}`,name:"name",value:r.name,onChange:F,placeholder:"  ",readOnly:H}),a.name&&t.jsx("div",{className:"invalid-feedback",children:a.name})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"email",className:`form-control ${a.email?"is-invalid":""}`,name:"email",value:r.email,onChange:F,placeholder:"example@company.com",readOnly:H}),a.email&&t.jsx("div",{className:"invalid-feedback",children:a.email})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"tel",className:`form-control ${a.phone?"is-invalid":""}`,name:"phone",value:r.phone,onKeyPress:ue=>{/[0-9+]/.test(ue.key)||ue.preventDefault()},onChange:ue=>{const Y=ue.target.value.replace(/[^0-9+]/g,"");F({target:{name:"phone",value:Y}})},placeholder:"+966 50 123 4567",readOnly:H}),a.phone&&t.jsx("div",{className:"invalid-feedback",children:a.phone})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:""}),t.jsx(rc,{name:"city",value:r.city,onChange:F,placeholder:" ",required:!1,disabled:H})]}),t.jsxs("div",{className:"col-md-12 mb-3",children:[t.jsx("label",{className:"form-label",children:""}),t.jsx("textarea",{className:"form-control",name:"address",value:r.address,onChange:F,rows:"2",placeholder:"  ",readOnly:H})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:" "}),t.jsx("input",{type:"text",className:"form-control",name:"taxNumber",value:r.taxNumber,onChange:F,placeholder:" ",readOnly:H})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  "}),t.jsx("input",{type:"text",className:"form-control",name:"bankAccount",value:r.bankAccount,onChange:F,placeholder:"  ",readOnly:H})]}),t.jsxs("div",{className:"col-md-12 mb-3",children:[t.jsx("label",{className:"form-label",children:""}),t.jsx("textarea",{className:"form-control",name:"notes",value:r.notes,onChange:F,rows:"3",placeholder:"  ...",readOnly:H})]}),t.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("span",{className:`badge ${r.active?"bg-success":"bg-secondary"} px-3 py-2`,children:r.active?"":" "}),t.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"companyActiveSwitch",name:"active",checked:r.active,onChange:F,disabled:H,style:{width:"50px",height:"25px",cursor:H?"not-allowed":"pointer"}})]})})]})]}),t.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:t.jsxs("div",{className:"d-flex gap-3",children:[t.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:s,disabled:l,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""}),t.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:l||H,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:l?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"12px",height:"12px"}}),"..."]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-check-lg me-1"}),x?"":""]})})]})})]})]})}),d&&t.jsx(P6,{show:d,onClose:()=>u(!1),title:" ",documents:f,setDocuments:p,companyId:(n==null?void 0:n.id)||"new",companyName:(n==null?void 0:n.name)||" ",companyEmail:(n==null?void 0:n.email)||""})]})};function L6(){const[n,e]=h.useState(!1),[s,r]=h.useState(!1),[i,a]=h.useState(null),[o,l]=h.useState(0),{isTimelineVisible:c}=Ut(),d=()=>{e(!n)},u=()=>{a(null),r(!0)},f=L=>{a(L),r(!0)},p=()=>{r(!1),a(null),l(L=>L+1)},j=()=>{r(!1),a(null)};return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:d}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!c?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:""})]})}),t.jsx("div",{className:"app-content-area p-3",children:t.jsx("div",{className:"suppliers-table",children:t.jsx(R6,{onAdd:u,onEdit:f,refreshTrigger:o})})})]}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]}),!n&&c&&t.jsx(os,{rtl:!0}),!n&&c&&t.jsx(ls,{}),s&&t.jsx("div",{className:"company-form",children:t.jsx(k6,{company:i,onSave:p,onCancel:j})})]})})})}function F6(){return t.jsx(L6,{})}const O6=({onEdit:n,onAdd:e,onView:s,refreshTrigger:r})=>{const i=kt(),{employeeData:a}=Bo(),[o,l]=h.useState([]),[c,d]=h.useState(!0),[u,f]=h.useState(null),[p,j]=h.useState(""),[L,R]=h.useState([]),[D,y]=h.useState(!1),{logActivity:T,getCurrentUser:x}=Zt(),{alertConfig:S,closeAlert:A,showSuccess:Q,showError:q,showConfirm:B}=Bt(),$=()=>new Date().getDay()===5,{currentPage:H,totalPages:te,paginatedItems:G,handlePageChange:F,resetPage:X,totalItems:ue,itemsPerPage:Y}=cr(L,30);h.useEffect(()=>{z()},[]),h.useEffect(()=>{r&&z()},[r]),h.useEffect(()=>{O()},[o,p]);const z=async()=>{try{d(!0),f(null);const P=await jo.getAllEmployees({limit:1e3});l(P.employees||[])}catch(P){console.error("Error loading employees:",P),f(P.message),q(P.message,"  ")}finally{d(!1)}},O=()=>{let P=[...o];if(p.trim()){const _=p.toLowerCase();P=P.filter(C=>{var U,w,W,ie,de,ne;return((U=C.fullName)==null?void 0:U.toLowerCase().includes(_))||((w=C.department)==null?void 0:w.toLowerCase().includes(_))||((W=C.jobTitle)==null?void 0:W.toLowerCase().includes(_))||((ie=C.email)==null?void 0:ie.toLowerCase().includes(_))||((de=C.phone)==null?void 0:de.includes(p))||((ne=C.nationalId)==null?void 0:ne.includes(p))})}R(P),X()},E=P=>{B(`     

${P.fullName}

       .`,()=>k(P),"  ")},k=async P=>{try{y(!0),await bs.moveToTrash(P,"employees"),await jo.deleteEmployee(P.id);const _=x();T("task",`${_.name}  `,`  : ${P.fullName}`),await z(),Q(`   : ${P.fullName}`,"  ")}catch(_){f(_.message),q(`    : ${_.message}`,"  ")}finally{y(!1)}},b=P=>P?`${parseFloat(P).toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})} `:" ",N=P=>{if(!P)return" ";const _=new Date(P),C=String(_.getDate()).padStart(2,"0"),U=String(_.getMonth()+1).padStart(2,"0"),w=_.getFullYear();return`${C}/${U}/${w}`},I=P=>{const _={active:{class:"bg-light text-dark",text:""},inactive:{class:"bg-light text-dark",text:" "}},C=_[P]||_.active;return t.jsx("span",{className:`badge ${C.class}`,children:C.text})};return c?t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"400px"},children:t.jsx(It,{size:"large"})}):t.jsxs("div",{className:"card shadow-sm","data-list":"employees",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"row align-items-center justify-content-between",children:[t.jsx("div",{className:"col-lg-4",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-person-badge-fill text-primary me-2"})," ",$()?t.jsx("span",{className:"badge bg-warning ms-2",children:""}):t.jsxs("span",{className:"badge bg-primary ms-2",children:["(",L.length,")"]})]})}),t.jsx("div",{className:"col-lg-8",children:t.jsxs("div",{className:"d-flex justify-content-end align-items-center",style:{gap:"25px"},children:[t.jsxs("div",{className:"input-group employees-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:p,onChange:P=>j(P.target.value),style:{borderRadius:"0 8px 8px 0",fontSize:"14px",height:"44px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"8px 0 0 8px",borderRight:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted"})})]}),t.jsx("div",{className:"d-flex gap-2",children:t.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:e,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[t.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"  "]})})]})})]})}),t.jsxs("div",{className:"card-body p-0",children:[u&&t.jsxs("div",{className:"alert alert-danger m-4",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),u]}),!u&&L.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-person-x",style:{fontSize:"3rem"}})}),t.jsx("h5",{className:"text-muted",children:"  "}),t.jsx("p",{className:"text-muted",children:p?"     ":"     "}),!p&&t.jsx("div",{className:"d-flex flex-column align-items-center gap-2",children:t.jsxs("button",{className:"btn btn-primary",onClick:e,children:[t.jsx("i",{className:"bi bi-plus-circle me-1"}),"  "]})})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",style:{width:"140px"},children:""})]})}),t.jsx("tbody",{children:G.map((P,_)=>t.jsxs("tr",{style:{backgroundColor:((H-1)*Y+_)%2===0?"#ffffff":"#f8f9fa"},children:[t.jsx("td",{className:"text-center fw-bold text-muted",children:(H-1)*Y+_+1}),t.jsx("td",{className:"text-center",children:t.jsx("div",{className:"d-flex align-items-center justify-content-center",children:t.jsx("div",{children:t.jsx("div",{className:"fw-bold text-primary",style:{cursor:"pointer",textDecoration:"underline"},onClick:()=>s&&s(P),title:"  ",children:P.fullName})})})}),t.jsx("td",{className:"text-center",children:P.phone||" "}),t.jsx("td",{className:"text-center",children:P.email||" "}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"fw-bold text-success",children:b(P.salary)})}),t.jsx("td",{className:"text-center",children:I(P.status)}),t.jsx("td",{className:"text-center",children:t.jsx("small",{className:"text-muted",children:N(P.hireDate)})}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"btn-group btn-group-sm shadow-sm",children:[t.jsx(Tt,{can:"employees:read",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-primary",onClick:()=>s&&s(P),title:" ",style:{width:"32px",height:"32px",padding:"0",borderRadius:"6px 0 0 6px",fontSize:"12px"},children:t.jsx("i",{className:"bi bi-eye"})})}),!(a!=null&&a.permissionPageDisabled)&&t.jsx("button",{className:"btn btn-outline-success position-relative",onClick:()=>i(`/employees/${P.id}/permissions`),title:" ",style:{width:"32px",height:"32px",padding:"0",borderRadius:"0",fontSize:"12px"},children:t.jsx("i",{className:"bi bi-shield-check"})}),t.jsx(Tt,{can:"employees:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>E(P),title:"",disabled:D,style:{width:"32px",height:"32px",padding:"0",borderRadius:"0 6px 6px 0",fontSize:"12px"},children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},P.id))})]})}),te>1&&t.jsx("div",{className:"d-flex justify-content-center p-4",children:t.jsx(dr,{currentPage:H,totalPages:te,onPageChange:F,totalItems:ue,itemsPerPage:Y})})]})]}),t.jsx(Mt,{show:S.show,onClose:A,title:S.title,message:S.message,type:S.type,onConfirm:S.onConfirm,confirmText:S.confirmText,cancelText:S.cancelText,showCancel:S.showCancel})]})};class Zp{static async uploadDocument(e,s,r){try{console.log(" EmployeeDocumentService: Uploading document:",e.name,"for employee:",s),Ss.validateFile(e,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]});const i=await Ss.uploadFile(e,"employee-documents"),a={fileName:r.trim(),originalFileName:e.name,fileURL:i.url,storagePath:i.path,fileSize:e.size,fileType:e.type,employeeId:s||"new",employeeName:"",ownerId:i.uploadedBy||"unknown",uploadedAt:We(),createdAt:We(),updatedAt:We()},o=await As(Pe(ae,this.COLLECTION_NAME),a);return console.log(" EmployeeDocumentService: Document uploaded successfully:",o.id),{id:o.id,...a,uploadedAt:new Date().toISOString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}catch(i){throw console.error(" EmployeeDocumentService: Upload failed:",i),new Error(`    : ${i.message}`)}}static async getEmployeeDocuments(e){try{if(console.log(" EmployeeDocumentService: Loading documents for employee:",e),!e||e==="new")return console.log(" EmployeeDocumentService: No employee ID provided, returning empty array"),[];let s;try{const i=st(Pe(ae,this.COLLECTION_NAME),xt("employeeId","==",e),as("uploadedAt","desc"));s=await qe(i)}catch(i){console.warn(" EmployeeDocumentService: OrderBy query failed, using simple where:",i.message);const a=st(Pe(ae,this.COLLECTION_NAME),xt("employeeId","==",e));s=await qe(a)}const r=[];return s.forEach(i=>{var o,l,c,d,u,f;const a=i.data();r.push({id:i.id,...a,uploadedAt:(l=(o=a.uploadedAt)==null?void 0:o.toDate)!=null&&l.call(o)?a.uploadedAt.toDate().toISOString():new Date().toISOString(),createdAt:(d=(c=a.createdAt)==null?void 0:c.toDate)!=null&&d.call(c)?a.createdAt.toDate().toISOString():new Date().toISOString(),updatedAt:(f=(u=a.updatedAt)==null?void 0:u.toDate)!=null&&f.call(u)?a.updatedAt.toDate().toISOString():new Date().toISOString()})}),r.sort((i,a)=>new Date(a.uploadedAt)-new Date(i.uploadedAt)),console.log(" EmployeeDocumentService: Loaded documents:",r.length),r}catch(s){if(console.error(" EmployeeDocumentService: Load failed:",s),s.code==="permission-denied"||s.code==="not-found")return console.log(" EmployeeDocumentService: Collection not accessible, returning empty array"),[];throw new Error(`    : ${s.message}`)}}static async deleteDocument(e){try{console.log(" EmployeeDocumentService: Deleting document:",e);const s=Le(ae,this.COLLECTION_NAME,e),r=await ss(s);if(!r.exists())throw new Error("  ");const i=r.data();if(i.storagePath)try{await Ss.deleteFile(i.storagePath),console.log(" EmployeeDocumentService: File deleted from storage:",i.storagePath)}catch(a){console.warn(" EmployeeDocumentService: Storage delete failed (non-critical):",a.message)}return await es(s),console.log(" EmployeeDocumentService: Document deleted successfully"),!0}catch(s){throw console.error(" EmployeeDocumentService: Delete failed:",s),new Error(`    : ${s.message}`)}}static async updateDocument(e,s){try{console.log(" EmployeeDocumentService: Updating document:",e);const r=Le(ae,this.COLLECTION_NAME,e),i={...s,updatedAt:We()};return await Qt(r,i),console.log(" EmployeeDocumentService: Document updated successfully"),!0}catch(r){throw console.error(" EmployeeDocumentService: Update failed:",r),new Error(`    : ${r.message}`)}}static async updateEmployeeName(e,s){try{console.log(" EmployeeDocumentService: Updating employee name in documents:",e,s);const r=await this.getEmployeeDocuments(e);if(r.length===0)return console.log(" EmployeeDocumentService: No documents to update"),[];const i=r.map(a=>this.updateDocument(a.id,{employeeName:s}));return await Promise.all(i),console.log(" EmployeeDocumentService: Employee name updated in all documents:",r.length),r}catch(r){throw console.error(" EmployeeDocumentService: Name update failed:",r),new Error(`      : ${r.message}`)}}static async transferDocuments(e,s,r=""){try{console.log(" EmployeeDocumentService: Transferring documents from:",e,"to:",s);const i=await this.getEmployeeDocuments(e);if(i.length===0)return console.log(" EmployeeDocumentService: No documents to transfer"),[];const a={employeeId:s,...r&&{employeeName:r}},o=i.map(l=>this.updateDocument(l.id,a));return await Promise.all(o),console.log(" EmployeeDocumentService: Documents transferred successfully:",i.length),i}catch(i){throw console.error(" EmployeeDocumentService: Transfer failed:",i),new Error(`    : ${i.message}`)}}static async getAllDocuments(){try{console.log(" EmployeeDocumentService: Loading all employee documents");let e;try{const r=st(Pe(ae,this.COLLECTION_NAME),as("uploadedAt","desc"));e=await qe(r)}catch{console.warn(" EmployeeDocumentService: OrderBy failed, using simple query"),e=await qe(Pe(ae,this.COLLECTION_NAME))}const s=[];return e.forEach(r=>{var a,o,l,c,d,u;const i=r.data();s.push({id:r.id,...i,uploadedAt:(o=(a=i.uploadedAt)==null?void 0:a.toDate)!=null&&o.call(a)?i.uploadedAt.toDate().toISOString():new Date().toISOString(),createdAt:(c=(l=i.createdAt)==null?void 0:l.toDate)!=null&&c.call(l)?i.createdAt.toDate().toISOString():new Date().toISOString(),updatedAt:(u=(d=i.updatedAt)==null?void 0:d.toDate)!=null&&u.call(d)?i.updatedAt.toDate().toISOString():new Date().toISOString()})}),s.sort((r,i)=>new Date(i.uploadedAt)-new Date(r.uploadedAt)),console.log(" EmployeeDocumentService: Loaded all documents:",s.length),s}catch(e){throw console.error(" EmployeeDocumentService: Load all failed:",e),new Error(`     : ${e.message}`)}}static validateDocumentData(e){const s={};return(!e.fileName||!e.fileName.trim())&&(s.fileName="  "),e.fileURL||(s.fileURL="  "),e.employeeId||(s.employeeId="  "),e.originalFileName||(s.originalFileName="   "),s}}Ys(Zp,"COLLECTION_NAME","employee_documents");const M6=({show:n,onClose:e,employee:s,documents:r,setDocuments:i,title:a=" ",readOnly:o=!1,canCreate:l=!0,canDelete:c=!0,canView:d=!0})=>{const[u,f]=h.useState(!1),[p,j]=h.useState(!1),[L,R]=h.useState(null),[D,y]=h.useState(""),[T,x]=h.useState(!1);h.useRef(null);const{alertConfig:S,closeAlert:A,showSuccess:Q,showError:q,showConfirm:B}=Bt(),{logActivity:$,getCurrentUser:H}=Zt(),{formatDate:te}=sc(),G=(s==null?void 0:s.id)||"new",F=(s==null?void 0:s.fullName)||" ",X=async E=>{const k=E.target.files[0];if(!k){console.log(" EmployeeDocumentModal: No file selected");return}console.log(" EmployeeDocumentModal: Starting file upload:",k.name),f(!0);try{try{Ss.validateFile(k,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]})}catch(N){throw new Error(N.message)}console.log(" Uploading employee document:",k.name);const b=await Ss.uploadFile(k,"employee-documents");console.log(" File upload result:",b),console.log(" Generated file URL:",b.url),R({...b,originalFileName:k.name,fileSize:k.size,fileType:k.type}),y(k.name.split(".")[0]),j(!0),E.target.value=""}catch(b){console.error("Error uploading employee document:",b),q(b.message||"   ","  "),E.target&&(E.target.value="")}finally{f(!1)}},ue=async()=>{var E,k;if(!D.trim()){q("   ","  ");return}if(!L){q("   ","");return}try{f(!0),console.log(" Creating employee document with Firebase database storage:",D);const b={id:Date.now().toString(),fileName:D.trim(),originalFileName:L.originalFileName,fileURL:L.url,storagePath:L.path,fileSize:L.fileSize,fileType:L.fileType,uploadedAt:new Date().toISOString(),uploadDate:new Date().toISOString(),employeeId:G,employeeName:F,employeeEmail:(s==null?void 0:s.email)||" "};if(console.log(" Created document object:",b),console.log(" Document fileURL field:",b.fileURL),console.log(" ADDING EMPLOYEE DOCUMENT:",b.fileName,"to",r.length+1,"total documents"),i(I=>[...I,b]),G&&G!=="new")try{console.log(" SENIOR ENGINEER FORCE: Direct Firestore write bypassing service layer"),console.log(" Auth state check:",{hasAuth:!!ut.currentUser,uid:(E=ut.currentUser)==null?void 0:E.uid,email:(k=ut.currentUser)==null?void 0:k.email});const I=await As(Pe(ae,"employee_documents"),{fileName:D.trim(),originalFileName:L.originalFileName,fileURL:L.url,storagePath:L.path,fileSize:L.fileSize,fileType:L.fileType,employeeId:G,employeeName:F,employeeEmail:(s==null?void 0:s.email)||" ",ownerId:L.uploadedBy||"force-save",uploadedAt:new Date().toISOString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),createdBy:"EmployeeDocumentModal-FORCE",timestamp:Date.now()});console.log(" SENIOR ENGINEER FORCE: Document saved directly to Firestore:",I.id),Q(`   : ${D}`," ")}catch(I){console.error(" SENIOR ENGINEER FORCE: Direct Firestore write failed:",I),console.error(" Error details:",{code:I.code,message:I.message,stack:I.stack});try{console.log(" FINAL FORCE: Attempting with timestamp-based ID...");const P=`emp_doc_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,_=await As(Pe(ae,"employee_documents"),{id:P,fileName:D.trim(),originalFileName:L.originalFileName,fileURL:L.url,storagePath:L.path,fileSize:L.fileSize,fileType:L.fileType,employeeId:G,employeeName:F,employeeEmail:(s==null?void 0:s.email)||" ",ownerId:"final-force",uploadedAt:new Date().toISOString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),forceCreated:!0,debugInfo:{userAgent:navigator.userAgent,timestamp:new Date().toISOString(),method:"FINAL_FORCE"}});console.log(" FINAL FORCE SUCCESS: Document created:",_.id),Q("    -  !"," ")}catch(P){console.error(" FINAL FORCE FAILED:",P),q(`  : ${P.code||P.message}
    `," ")}}else console.log(" New employee - document will be transferred when employee is saved");const N=H();$("file",`${N.name}   `,`  : ${D} : ${F}`),Q(`   : ${D}`," "),j(!1),R(null),y("")}catch(b){console.error(" Employee document save failed:",b),q(`   : ${b.message}`,"  ")}finally{f(!1)}},Y=()=>{console.log(" EmployeeDocumentModal: File naming cancelled"),j(!1),R(null),y("")},z=E=>{B(`      

${E.fileName}`,()=>O(E),"  ")},O=async E=>{try{if(x(!0),console.log(" EmployeeDocumentModal: Deleting document:",E.id),G!=="new"&&E.id&&!E.id.toString().startsWith("temp_"))try{await bs.moveToTrash(E,"employee_documents"),console.log(" EmployeeDocumentModal: Document moved to trash"),await Zp.deleteDocument(E.id),console.log(" EmployeeDocumentModal: Document deleted from Firebase")}catch(b){console.warn(" EmployeeDocumentModal: Firebase delete failed, removing locally:",b.message)}else try{await bs.moveToTrash(E,"employee_documents"),console.log(" EmployeeDocumentModal: Document moved to trash")}catch(b){console.warn(" EmployeeDocumentModal: Trash service failed, removing locally only:",b.message)}i(b=>{const N=b.filter(I=>I.id!==E.id);return console.log(" EmployeeDocumentModal: Document removed from state, total:",N.length),N});const k=H();$("task",`${k.name}   `,`  : ${E.fileName} : ${F}`),Q(`  : ${E.fileName}`," ")}catch(k){console.error(" EmployeeDocumentModal: Delete failed:",k),q(`   : ${k.message}`,"  ")}finally{x(!1)}};return n?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.8)",zIndex:99980,position:"fixed",top:0,left:0,right:0,bottom:0},tabIndex:"-1",dir:"rtl",children:t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"12px 12px 0 0"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-file-earmark-person me-2"}),a]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:e,"aria-label":"Close"})]}),t.jsx("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"},children:t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("div",{className:"bg-primary bg-opacity-10 p-2 rounded-circle me-3",children:t.jsx("i",{className:"bi bi-files text-primary"})}),t.jsxs("div",{children:[t.jsx("h6",{className:"mb-0 fw-bold text-primary",children:" "}),t.jsxs("small",{className:"text-muted",children:[" : ",r.length]})]})]}),t.jsx("div",{style:{marginTop:"10px",marginBottom:"10px"},children:t.jsxs(Tt,{can:"documents:create",mode:"disable",children:[t.jsx("input",{type:"file",id:"employeeDocumentUpload",onChange:X,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",style:{display:"none"}}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{console.log(" Employee Upload button clicked"),console.log(" EMPLOYEE MODAL: Starting fullscreen bypass for file picker"),Kr(2e4);const E=document.getElementById("employeeDocumentUpload");E?(E.click(),console.log(" Employee File input triggered")):console.error(" Employee File input not found")},disabled:u,title:"  ",style:{height:"32px",minWidth:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",fontWeight:"500"},children:u?t.jsxs(t.Fragment,{children:[t.jsx(It,{size:"small"}),t.jsx("span",{className:"ms-2",children:"..."})]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-cloud-upload me-1"})," "]})})]})})]}),(console.log(" EMPLOYEE MODAL RENDER CHECK:",new Date().toLocaleTimeString()),console.log(" Employee Documents state:",{length:r.length,docs:r.map(E=>({name:E.fileName,url:!!E.fileURL,id:E.id}))}),null),r.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-folder2-open",style:{fontSize:"3rem"}})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:'  " "  '})]}):t.jsx("div",{className:"table-responsive",style:{maxHeight:"400px",overflowY:"auto"},children:t.jsxs("table",{className:"table table-hover",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:"#"}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""}),t.jsx("th",{className:"text-center",children:" "}),t.jsx("th",{className:"text-center",children:""})]})}),t.jsx("tbody",{children:r.map((E,k)=>{if(!E||typeof E!="object")return null;const N=(_=>!_||typeof _!="string"?{icon:"bi-file-earmark",color:"#6c757d"}:_.includes("pdf")?{icon:"bi-file-earmark-pdf",color:"#dc3545"}:_.includes("word")||_.includes("document")?{icon:"bi-file-earmark-word",color:"#2b579a"}:_.includes("image")?{icon:"bi-file-earmark-image",color:"#198754"}:{icon:"bi-file-earmark",color:"#6c757d"})(E.fileType||""),I=E.fileName||E.originalFileName||"  ",P=E.fileSize||0;return E.uploadDate,t.jsxs("tr",{children:[t.jsx("td",{className:"text-center fw-bold text-muted",children:k+1}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:`${N.icon} me-2`,style:{color:N.color}}),t.jsx("span",{className:"fw-bold text-primary",title:I,children:I.length>25?I.substring(0,25)+"...":I})]})}),t.jsx("td",{className:"text-center",children:t.jsxs("span",{className:"badge bg-light text-dark",children:[(P/1024/1024).toFixed(2)," ."]})}),t.jsx("td",{className:"text-center",children:t.jsx("small",{className:"text-muted",children:te(E.uploadedAt||E.uploadDate||new Date)})}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(Tt,{can:"documents:read",mode:"disable",children:t.jsx("button",{className:"btn btn-success",title:" ",style:{width:"32px",height:"32px",padding:"0",borderRadius:"6px 0 0 6px",fontSize:"12px"},onClick:_=>{if(console.log(" Attempting to view employee document:",E),console.log(" Document fileURL:",E.fileURL),!E.fileURL){q("   ","");return}try{if(E.fileType&&E.fileType.includes("pdf")){console.log(" PDF detected - using download approach");const C=E.fileURL.replace("alt=media","alt=media&attachment=false");console.log(" Modified URL for PDF viewing:",C);const U=window.open("","_blank");if(U)U.document.write(`
                                                <html>
                                                  <head>
                                                    <title>${E.fileName||""}</title>
                                                    <style>
                                                      body { margin: 0; padding: 0; }
                                                      iframe { width: 100vw; height: 100vh; border: none; }
                                                    </style>
                                                  </head>
                                                  <body>
                                                    <iframe src="${C}" type="application/pdf"></iframe>
                                                  </body>
                                                </html>
                                              `),U.document.close();else{const w=E.createElement("a");w.href=E.fileURL,w.download=E.fileName||"document.pdf",E.body.appendChild(w),w.click(),E.body.removeChild(w)}}else console.log(" Non-PDF file - opening directly"),window.open(E.fileURL,"_blank","noopener,noreferrer")}catch(C){console.error(" Error opening file:",C),q("   ","  ")}},children:t.jsx("i",{className:"bi bi-eye"})})}),t.jsx(Tt,{can:"documents:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>z(E),title:"",disabled:T,style:{width:"32px",height:"32px",padding:"0",borderRadius:"0 6px 6px 0",fontSize:"12px"},children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},E.id||`doc-${k}`)})})]})})]})}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:t.jsxs("div",{className:"d-flex",style:{gap:"10px"},children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:e,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},children:""}),t.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>Q("    "," "),style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},children:""})]})})]})})}),p&&t.jsx("div",{className:"modal show d-block",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.9)",zIndex:99990},tabIndex:"-1",dir:"rtl",children:t.jsx("div",{className:"modal-dialog modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsx("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"12px 12px 0 0"},children:t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-pencil-square me-2"})," "]})}),t.jsx("div",{className:"modal-body",style:{padding:"25px"},children:t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"d-flex align-items-center mb-3",children:[t.jsx("div",{className:"bg-success bg-opacity-10 p-2 rounded-circle me-3",children:t.jsx("i",{className:"bi bi-file-earmark-check text-success"})}),t.jsxs("div",{children:[t.jsx("h6",{className:"mb-0 fw-bold text-success",children:"   "}),t.jsx("small",{className:"text-muted",children:L==null?void 0:L.originalFileName})]})]}),t.jsxs("div",{className:"mb-3",children:[t.jsxs("label",{className:"form-label fw-bold text-primary",children:[t.jsx("i",{className:"bi bi-tag me-1"}),"   *"]}),t.jsx("input",{type:"text",className:"form-control",value:D,onChange:E=>y(E.target.value),placeholder:"   ",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:E=>{E.target.style.borderColor="#28a745",E.target.style.boxShadow="0 0 0 0.2rem rgba(40, 167, 69, 0.25)"},onBlur:E=>{E.target.style.borderColor="#e9ecef",E.target.style.boxShadow="none"},autoFocus:!0}),t.jsxs("small",{className:"text-muted",children:[t.jsx("i",{className:"bi bi-info-circle me-1"}),"        "]})]})]})}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:t.jsxs("div",{className:"d-flex justify-content-end",style:{gap:"12px"},children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:Y,style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",fontWeight:"500"},children:""}),t.jsxs("button",{type:"button",className:"btn btn-success",onClick:ue,disabled:!D.trim(),style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",fontWeight:"500",opacity:D.trim()?1:.6},children:[t.jsx("i",{className:"bi bi-check-lg me-1"}),""]})]})})]})})}),t.jsx(Mt,{show:S.show,onClose:A,title:S.title,message:S.message,type:S.type,onConfirm:S.onConfirm,showConfirm:S.showConfirm})]}):null},ox=({employee:n,onSave:e,onCancel:s})=>{const[r,i]=h.useState({fullName:"",jobTitle:"",department:"",phone:"",email:"",nationalId:"",password:"",status:"active",role:"user",salary:"",hireDate:"",notes:""}),[a,o]=h.useState({}),[l,c]=h.useState(!1),[d,u]=h.useState(!1),[f,p]=h.useState(!1),[j,L]=h.useState([]),[R,D]=h.useState(""),[y,T]=h.useState(!1),[x,S]=h.useState(""),{logActivity:A,getCurrentUser:Q}=Zt(),{alertConfig:q,closeAlert:B,showSuccess:$,showError:H}=Bt(),{hasPerm:te,readOnly:G}=Yn(),F=!!n,X=te("employees:create"),ue=te("employees:update"),Y=G||F&&!ue||!F&&!X;h.useEffect(()=>{n?(n.password&&(console.warn(" Employee has password in database:",n.password),console.warn(" This should be removed for security")),i({fullName:n.fullName||"",jobTitle:n.jobTitle||"",department:n.department||"",phone:n.phone||"",email:n.email||"",nationalId:n.nationalId||"",password:"",status:n.status||"active",role:n.role||"user",salary:n.salary?n.salary.toString():"",hireDate:n.hireDate?Rl(n.hireDate):"",notes:n.notes||""}),D(""),setTimeout(()=>{i(N=>({...N,password:""}))},100),z()):L([])},[n]);const z=async()=>{if(!(n!=null&&n.id)||n.id==="new"){L([]);return}try{console.log(" EmployeeForm: Loading documents for employee:",n.id);const N=await Zp.getEmployeeDocuments(n.id);L(N),console.log(" EmployeeForm: Loaded employee documents:",N.length)}catch(N){console.error(" EmployeeForm: Error loading employee documents:",N),L([])}},O=N=>{const{name:I,value:P}=N.target;i(_=>({..._,[I]:P})),a[I]&&o(_=>({..._,[I]:""}))},E=async()=>{const N=jo.validateEmployeeData(r),I={};r.email&&r.email.trim()&&(I.email=r.email.trim());try{const P=await Bn.validateUniqueFields(I,F?n.id:null,"employees"),_={...N,...P};return o(_),Object.keys(_).length===0}catch(P){return console.error("Validation error:",P),o(N),Object.keys(N).length===0}},k=async N=>{if(N.preventDefault(),!(l||!await E())){c(!0);try{const P={...r,salary:r.salary?parseFloat(r.salary):null,hireDate:r.hireDate?new Date(r.hireDate):new Date};F?!r.password||r.password.trim()===""?(delete P.password,console.log("Empty password field, skipping password update")):console.log("Password provided, will attempt update"):r.password&&r.password.trim()&&console.log("New employee, setting initial password");let _;const C=Q();if(F){await jo.updateEmployee(n.id,P),_={...n,...P};const U=r.password&&r.password.trim()!=="";A("task",`${C.name}  `,`   : ${r.fullName}`),$(U?`    !

:               `:"    "," ")}else{const U=await jo.createEmployee(P);if(_={...P,id:U.id,internalId:U.internalId},j.length>0)try{console.log(" EmployeeForm: Transferring documents to new employee:",U.id),await Zp.transferDocuments("new",U.id,r.fullName),console.log(" EmployeeForm: Documents transferred successfully")}catch(w){console.warn(" EmployeeForm: Document transfer failed (non-critical):",w.message)}A("task",`${C.name}  `,`   : ${r.fullName}`),$("   "," ")}e&&e(_)}catch(P){console.error("Error saving employee:",P),H(P.message||"    ","  ")}finally{c(!1)}}},b=()=>{s&&s()};return t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsx("div",{className:"d-flex align-items-center",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:`bi ${F?"bi-pencil-square":"bi-person-plus-fill"} text-primary me-2`}),F?"  ":"  "]})}),t.jsx("div",{className:"d-flex gap-2",children:t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>p(!0),style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:" "})})]})}),t.jsxs("div",{className:"card-body",children:[Y&&t.jsx("div",{className:"alert alert-info border-0 shadow-sm mb-4",children:t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-info-circle-fill text-info me-3 fs-5"}),t.jsxs("div",{children:[t.jsx("strong",{className:"fw-bold",children:"  "}),t.jsx("div",{className:"mt-1",children:t.jsxs("span",{className:"ms-2",children:[!ue&&F&&"    ",!X&&!F&&"     ",G&&"     "]})})]})]})}),t.jsxs("form",{onSubmit:k,children:[t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"text",className:`form-control ${a.fullName?"is-invalid":""}`,name:"fullName",value:r.fullName,onChange:O,placeholder:"  ",disabled:l,required:!0,readOnly:Y}),a.fullName&&t.jsx("div",{className:"invalid-feedback",children:a.fullName})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:" "}),t.jsx("input",{type:"text",className:`form-control ${a.jobTitle?"is-invalid":""}`,name:"jobTitle",value:r.jobTitle,onChange:O,placeholder:"  ",disabled:l,readOnly:Y}),a.jobTitle&&t.jsx("div",{className:"invalid-feedback",children:a.jobTitle})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:""}),t.jsx("input",{type:"text",className:`form-control ${a.department?"is-invalid":""}`,name:"department",value:r.department,onChange:O,placeholder:"  ",disabled:l,readOnly:Y}),a.department&&t.jsx("div",{className:"invalid-feedback",children:a.department})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"tel",className:`form-control ${a.phone?"is-invalid":""}`,name:"phone",value:r.phone,onChange:O,placeholder:"  ",disabled:l,required:!0,readOnly:Y}),a.phone&&t.jsx("div",{className:"invalid-feedback",children:a.phone})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"email",className:`form-control ${a.email?"is-invalid":""}`,name:"email",value:r.email,onChange:O,placeholder:"  ",disabled:l,required:!0,readOnly:Y}),a.email&&t.jsx("div",{className:"invalid-feedback",children:a.email})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>u(!d),disabled:l||Y,style:{border:"1px solid #ced4da",color:"#6c757d",fontSize:"16px",padding:"8px",width:"38px",height:"38px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px",flexShrink:0},title:d?"  ":"  ",children:t.jsx("i",{className:`bi ${d?"bi-eye-slash":"bi-eye"}`})}),t.jsx("input",{type:d?"text":"password",className:`form-control ${a.password?"is-invalid":""}`,name:"password",value:r.password,onChange:O,placeholder:F?"   ":"  ",disabled:l,required:!F,readOnly:Y})]}),a.password&&t.jsx("div",{className:"invalid-feedback",children:a.password})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  "}),t.jsx("input",{type:"text",className:`form-control ${a.nationalId?"is-invalid":""}`,name:"nationalId",value:r.nationalId,onChange:O,placeholder:"   ",disabled:l,readOnly:Y}),a.nationalId&&t.jsx("div",{className:"invalid-feedback",children:a.nationalId})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:" ()"}),t.jsx("input",{type:"number",className:`form-control ${a.salary?"is-invalid":""}`,name:"salary",value:r.salary,onChange:O,placeholder:" ",min:"0",step:"0.01",disabled:l,readOnly:Y}),a.salary&&t.jsx("div",{className:"invalid-feedback",children:a.salary})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"date",className:`form-control ${a.hireDate?"is-invalid":""}`,name:"hireDate",value:r.hireDate,onChange:O,disabled:l,required:!0,readOnly:Y}),a.hireDate&&t.jsx("div",{className:"invalid-feedback",children:a.hireDate})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label fw-bold",children:""}),t.jsxs("div",{className:"d-flex gap-2 mt-2",children:[t.jsxs("button",{type:"button",className:`btn ${r.status==="active"?"btn-primary":"btn-outline-secondary"}`,onClick:()=>O({target:{name:"status",value:"active"}}),disabled:l||Y,style:{minWidth:"80px",height:"38px",fontSize:"14px",borderRadius:"6px"},children:[r.status==="active"&&t.jsx("i",{className:"bi bi-check me-1"}),""]}),t.jsxs("button",{type:"button",className:`btn ${r.status==="inactive"?"btn-success":"btn-outline-secondary"}`,onClick:()=>O({target:{name:"status",value:"inactive"}}),disabled:l||Y,style:{minWidth:"80px",height:"38px",fontSize:"14px",borderRadius:"6px"},children:[r.status==="inactive"&&t.jsx("i",{className:"bi bi-check me-1"})," "]})]}),a.status&&t.jsx("div",{className:"invalid-feedback d-block",children:a.status})]}),t.jsxs("div",{className:"col-12 mb-3",children:[t.jsx("label",{className:"form-label",children:""}),t.jsx("textarea",{className:`form-control ${a.notes?"is-invalid":""}`,name:"notes",value:r.notes,onChange:O,rows:"4",placeholder:"  ...",disabled:l,readOnly:Y}),a.notes&&t.jsx("div",{className:"invalid-feedback",children:a.notes})]})]}),t.jsx("div",{className:"row",children:t.jsxs("div",{className:"col-12 d-flex justify-content-center gap-3 mt-4 mb-2",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:b,disabled:l,style:{height:"32px",width:"80px",fontSize:"14px",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),t.jsx("button",{type:"submit",className:"btn btn-primary",disabled:l||Y,style:{height:"32px",width:"80px",fontSize:"14px",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center"},children:l?t.jsxs(t.Fragment,{children:[t.jsx(It,{size:"small"}),t.jsx("span",{className:"ms-2",children:F?"...":"..."})]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:`bi ${F?"bi-check-lg":"bi-plus-circle"} me-1`}),F?"":""]})})]})})]})]}),t.jsx(Mt,{show:q.show,onClose:B,title:q.title,message:q.message,type:q.type,onConfirm:q.onConfirm,confirmText:q.confirmText,cancelText:q.cancelText,showCancel:q.showCancel}),t.jsx(M6,{show:f,onClose:()=>p(!1),employee:n,documents:j,setDocuments:L,title:" "})]})};function U6(){kt();const n=Xr(),[e,s]=h.useState(!1),[r,i]=h.useState("list"),[a,o]=h.useState(null),[l,c]=h.useState(0),{isTimelineVisible:d}=Ut();h.useEffect(()=>{if(n.state){const{selectedEmployee:T,currentView:x}=n.state;T&&x&&(o(T),i(x))}},[n.state]);const u=()=>{s(!e)},f=()=>{o(null),i("add")},p=T=>{o(T),i("edit")},j=T=>{o(T),i("view")},L=()=>{i("list"),o(null),c(T=>T+1)},R=()=>{L()},D=()=>{switch(r){case"add":return t.jsx(ox,{onSave:R,onCancel:L});case"edit":return t.jsx(ox,{employee:a,onSave:R,onCancel:L});case"view":return t.jsx(ox,{employee:a,onSave:R,onCancel:L});case"list":default:return t.jsx(O6,{onEdit:p,onAdd:f,onView:j,refreshTrigger:l})}},y=()=>{const T=[{text:"",href:"/"},{text:" ",href:"/employees"}];switch(r){case"add":T.push({text:"  ",active:!0});break;case"edit":T.push({text:" ",active:!0});break;case"view":T.push({text:"  ",active:!0});break;default:T.push({text:"",active:!0});break}return T};return t.jsxs("div",{className:`page-wrapper ${e?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:u}),t.jsxs("div",{className:"main-container",style:{paddingRight:e?"72px":"250px",paddingLeft:e||!d?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:e?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:e})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsx("ol",{className:"breadcrumb m-0",children:y().map((T,x)=>t.jsx("li",{className:`breadcrumb-item ${T.active?"text-secondary":""}`,...T.active&&{"aria-current":"page"},children:T.active?T.text:t.jsxs("a",{href:T.href,className:"text-decoration-none d-flex align-items-center",children:[x===0&&t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:T.text})]})},x))})}),t.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:t.jsxs("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:[r!=="list"&&t.jsx("div",{className:"mb-3 d-flex justify-content-end"}),D()]})}),!e&&d&&t.jsx(os,{rtl:!0}),!e&&d&&t.jsx(ls,{})]})]})]})}function $6(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(U6,{})})})}const ml="curriculum";class ef{static async getAllCurriculum(){try{const e=Pe(ae,ml),s=st(e,as("createdAt","desc"));return(await qe(s)).docs.map(i=>{var o,l;const a=i.data();return{id:i.id,internalId:a.internalId||Ct("CURRICULUM"),...a,createdAt:(o=a.createdAt)==null?void 0:o.toDate(),updatedAt:(l=a.updatedAt)==null?void 0:l.toDate()}})}catch(e){throw console.error("Error fetching curriculum:",e),new Error("     ")}}static async createCurriculum(e){try{const s=Ct("CURRICULUM"),r={...e,internalId:s,createdAt:We(),updatedAt:We()};return(await As(Pe(ae,ml),r)).id}catch(s){throw console.error("Error creating curriculum:",s),new Error("    ")}}static async updateCurriculum(e,s){try{const r=Le(ae,ml,e),i={...s,updatedAt:We()};return await Qt(r,i),!0}catch(r){throw console.error("Error updating curriculum:",r),new Error("     ")}}static async getCurriculumById(e){var s,r;try{const i=Le(ae,ml,e),a=await ss(i);if(a.exists()){const o=a.data();return{id:a.id,internalId:o.internalId||Ct("CURRICULUM"),...o,createdAt:(s=o.createdAt)==null?void 0:s.toDate(),updatedAt:(r=o.updatedAt)==null?void 0:r.toDate()}}else return null}catch(i){throw console.error("Error fetching curriculum by ID:",i),new Error("     ")}}static async getCurriculumByInternalId(e){var s,r;try{const i=Pe(ae,ml),a=st(i,xt("internalId","==",e)),o=await qe(a);if(o.empty)return null;{const l=o.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:(s=c.createdAt)==null?void 0:s.toDate(),updatedAt:(r=c.updatedAt)==null?void 0:r.toDate()}}}catch(i){throw console.error("Error fetching curriculum by internal ID:",i),new Error("     ")}}static async updateCurriculumByInternalId(e,s){try{const r=await this.getCurriculumByInternalId(e);if(!r)throw new Error("Curriculum not found");return await this.updateCurriculum(r.id,s)}catch(r){throw console.error("Error updating curriculum by internal ID:",r),new Error("     ")}}static async deleteCurriculum(e){try{const s=Le(ae,ml,e);return await es(s),!0}catch(s){throw console.error("Error deleting curriculum:",s),new Error("    ")}}static async deleteCurriculumByInternalId(e){try{const s=await this.getCurriculumByInternalId(e);if(!s)throw new Error("Curriculum not found");return await this.deleteCurriculum(s.id)}catch(s){throw console.error("Error deleting curriculum by internal ID:",s),new Error("    ")}}static async searchCurriculum(e){try{const s=Pe(ae,ml);return(await qe(s)).docs.map(o=>{var c,d;const l=o.data();return{id:o.id,internalId:l.internalId||Ct("CURRICULUM"),...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}}).filter(o=>{var l,c,d,u,f;return((l=o.name)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))||((c=o.email)==null?void 0:c.toLowerCase().includes(e.toLowerCase()))||((d=o.phone)==null?void 0:d.includes(e))||((u=o.position)==null?void 0:u.toLowerCase().includes(e.toLowerCase()))||((f=o.specialization)==null?void 0:f.toLowerCase().includes(e.toLowerCase()))})}catch(s){throw console.error("Error searching curriculum:",s),new Error("     ")}}static async migrateExistingData(){try{console.log("Starting curriculum migration...");const e=await this.getAllCurriculum();let s=0;for(const r of e)if(!r.internalId||!r.internalId.startsWith("cur_")){const i=Ct("CURRICULUM");await this.updateCurriculum(r.id,{...r,internalId:i}),s++,console.log(`Migrated curriculum: ${r.name} -> ${i}`)}return console.log(`Migration completed. ${s} curriculum migrated.`),{success:!0,migratedCount:s}}catch(e){throw console.error("Error during migration:",e),new Error("   ")}}static validateCurriculumData(e){var r,i,a,o;const s={};return(r=e.name)!=null&&r.trim()||(s.name="  "),(i=e.email)!=null&&i.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(s.email="    "):s.email="  ",(a=e.phone)!=null&&a.trim()||(s.phone="  "),(o=e.position)!=null&&o.trim()||(s.position="  "),s}}const z6=({onEdit:n,onAdd:e,refreshTrigger:s,searchTerm:r,showActiveOnly:i=!0,onTotalCountChange:a})=>{const[o,l]=h.useState([]),[c,d]=h.useState(!0),[u,f]=h.useState(null),[p,j]=h.useState(""),L=r!==void 0?r:p,[R,D]=h.useState([]),[y,T]=h.useState(!1),{logActivity:x,getCurrentUser:S}=Zt(),{alertConfig:A,closeAlert:Q,showSuccess:q,showError:B,showConfirm:$}=Bt(),{currentPage:H,totalPages:te,paginatedItems:G,handlePageChange:F,resetPage:X,totalItems:ue,itemsPerPage:Y}=cr(R,30);h.useEffect(()=>{z()},[]),h.useEffect(()=>{s&&z()},[s]),h.useEffect(()=>{let k=[...o];i?k=k.filter(b=>b.active!==!1&&b.status!=="inactive"):k=k.filter(b=>b.active===!1||b.status==="inactive"),L.trim()&&(k=k.filter(b=>{var N,I,P,_;return((N=b.name)==null?void 0:N.toLowerCase().includes(L.toLowerCase()))||((I=b.email)==null?void 0:I.toLowerCase().includes(L.toLowerCase()))||((P=b.phone)==null?void 0:P.includes(L))||((_=b.position)==null?void 0:_.toLowerCase().includes(L.toLowerCase()))})),D(k),a&&a(k.length),X()},[L,i,o,X,a]);const z=async()=>{try{d(!0);const k=await ef.getAllCurriculum(),b=Y1(k);l(b),f(null)}catch(k){f(k.message)}finally{d(!1)}},O=k=>{$(`       

${k.name}`,()=>E(k),"   ")},E=async k=>{try{T(!0),await bs.moveToTrash(k,"curriculum"),await ef.deleteCurriculum(k.id);const b=S();x("task",`${b.name}   `,`   : ${k.name}`),await z(),q(`    : ${k.name}`,"  ")}catch(b){f(b.message),B(`     : ${b.message}`,"  ")}finally{T(!1)}};return c?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"spinner-border text-primary",role:"status",children:t.jsx("span",{className:"visually-hidden",children:" ..."})}),t.jsx("p",{className:"mt-3 text-muted",children:"    ..."})]})}):u?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:u}),t.jsxs("button",{className:"btn btn-primary",onClick:z,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):t.jsxs("div",{"data-list":"curriculum",children:[R.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-file-earmark-person fs-1"})}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:L?"    ":"      "}),!L&&t.jsx(Tt,{can:"curriculum:create",mode:"disable",children:t.jsxs("button",{className:"btn btn-primary",onClick:e,children:[t.jsx("i",{className:"bi bi-plus-lg me-1"}),"   "]})})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",style:{tableLayout:"fixed"},children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:"50px",textAlign:"center"},children:"#"}),t.jsx("th",{style:{width:"22%",textAlign:"center"},children:""}),t.jsx("th",{style:{width:"20%",textAlign:"center"},children:" "}),t.jsx("th",{style:{width:"12%",textAlign:"center"},children:""}),t.jsx("th",{style:{width:"18%",textAlign:"center"},children:""}),t.jsx("th",{style:{width:"8%",textAlign:"center"},children:""}),t.jsx("th",{style:{width:"60px",textAlign:"center"},children:" "}),t.jsx("th",{style:{width:"120px",textAlign:"center"},children:""})]})}),t.jsx("tbody",{children:G.map((k,b)=>{const N=k.active===!1||k.status==="inactive",I=N?{textDecoration:"line-through",opacity:"0.6",color:"#6c757d"}:{};return t.jsxs("tr",{style:I,children:[t.jsx("td",{className:"text-center",style:{verticalAlign:"middle"},children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(H-1)*Y+b+1})}),t.jsx("td",{style:{textAlign:"center",verticalAlign:"middle"},children:t.jsx("button",{className:`btn btn-link p-0 fw-bold ${N?"text-muted":"text-primary"}`,onClick:()=>n(k),style:{textDecoration:N?"line-through":"none",textAlign:"center"},title:`Internal ID: ${k.internalId||"Not Set"}${N?" -  ":""}`,children:k.name})}),t.jsx("td",{style:{textAlign:"center",verticalAlign:"middle"},children:t.jsx("a",{href:`mailto:${k.email}`,className:`text-decoration-none ${N?"text-muted":""}`,style:N?{textDecoration:"line-through"}:{},children:k.email})}),t.jsx("td",{style:{textAlign:"center",verticalAlign:"middle"},children:t.jsx("span",{style:{direction:"ltr",display:"inline-block",textAlign:"left",fontFamily:"monospace",...N?{textDecoration:"line-through"}:{}},children:k.phone})}),t.jsx("td",{style:{textAlign:"center",verticalAlign:"middle"},children:t.jsx("span",{style:N?{textDecoration:"line-through"}:{},children:k.position||"-"})}),t.jsx("td",{style:{textAlign:"center",verticalAlign:"middle"},children:t.jsx("span",{className:`badge ${N?"bg-secondary":"bg-success"} px-2 py-1`,style:{fontSize:"11px"},children:N?" ":""})}),t.jsx("td",{style:{textAlign:"center",verticalAlign:"middle"},children:k.cvFile&&t.jsx(Ad,{size:25,clickable:!0,onClick:()=>{k.cvFileURL?window.open(k.cvFileURL,"_blank"):(console.log("No file URL available for:",k.cvFile),alert("   "))},title:`  : ${k.cvFileName||k.name}`,style:N?{opacity:"0.6"}:{}})}),t.jsx("td",{style:{textAlign:"center",verticalAlign:"middle"},children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(Tt,{can:"curriculum:update",mode:"disable",children:t.jsx("button",{className:`btn ${N?"btn-outline-secondary":"btn-outline-primary"}`,onClick:()=>n(k),title:N?" -  ":"",style:N?{opacity:"0.7"}:{},children:t.jsx("i",{className:"bi bi-pencil"})})}),t.jsx(Tt,{can:"curriculum:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>O(k),title:"",style:N?{opacity:"0.7"}:{},children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},k.internalId||k.id)})})]})}),R.length>0&&t.jsx(dr,{currentPage:H,totalPages:te,onPageChange:F,totalItems:ue,itemsPerPage:Y}),t.jsx(Mt,{show:A.show,onClose:Q,title:A.title,message:A.message,type:A.type,onConfirm:A.onConfirm,confirmText:A.confirmText,cancelText:A.cancelText,showCancel:A.showCancel})]})},V6=[" "," "," "," "," ",""," "," "," "," "," "," "," "," "," ","  "," "," "," "," "," "," ",""],B6=({curriculum:n,onSave:e,onCancel:s})=>{const[r,i]=h.useState({name:"",email:"",phone:"",position:"",notes:"",cvFile:null,active:!0}),[a,o]=h.useState({}),[l,c]=h.useState(!1),[d,u]=h.useState(!1),f=h.useRef(null),p=!!n,{logActivity:j,getCurrentUser:L}=Zt(),{hasPerm:R,readOnly:D}=Yn(),y=R("curriculum:create"),T=R("curriculum:update"),x=D||p&&!T||!p&&!y;h.useEffect(()=>{n&&i({name:n.name||"",email:n.email||"",phone:n.phone||"",position:n.position||"",notes:n.notes||"",cvFile:n.cvFile||null,active:n.active!==void 0?n.active:!0})},[n]);const S=$=>{const{name:H,value:te,type:G,checked:F}=$.target,X=G==="checkbox"?F:te;i(ue=>{const Y={...ue,[H]:X};if(H==="name"&&ue.cvFile&&X.trim()){const z=`   ${X.trim()}.pdf`,O=new File([ue.cvFile],z,{type:ue.cvFile.type,lastModified:ue.cvFile.lastModified});return console.log(" CV file auto-renamed to:",z),{...Y,cvFile:O}}return Y}),a[H]&&o(ue=>({...ue,[H]:""}))},A=async $=>{const H=$.target.files[0];if(!H)return;if(H.type!=="application/pdf"){o(G=>({...G,cvFile:"      PDF "})),$.target.value="";return}if(H.size>5*1024*1024){o(G=>({...G,cvFile:"       5 "})),$.target.value="";return}let te=H;if(r.name&&r.name.trim()){const G=`   ${r.name.trim()}.pdf`;te=new File([H],G,{type:H.type,lastModified:H.lastModified}),console.log(" CV file renamed to:",G)}i(G=>({...G,cvFile:te})),o(G=>({...G,cvFile:""}))},Q=()=>{i($=>({...$,cvFile:null})),f.current&&(f.current.value="")},q=()=>{var H,te,G,F;const $={};return(H=r.name)!=null&&H.trim()||($.name="  "),(te=r.email)!=null&&te.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.email)||($.email="    "):$.email="  ",(G=r.phone)!=null&&G.trim()||($.phone="  "),(F=r.position)!=null&&F.trim()||($.position="  "),$},B=async $=>{$.preventDefault();const H=q();if(Object.keys(H).length>0){o(H);return}c(!0),o({});try{const te=await Bn.validateUniqueFields({email:r.email,phone:r.phone},p?n.id:null,p?"curriculum":null);if(Object.keys(te).length>0){o(te),c(!1);return}let G=null;if(r.cvFile&&r.cvFile instanceof File){u(!0);try{G=await Ss.uploadFile(r.cvFile,"curriculum-cvs")}catch(X){console.error("File upload error:",X),o({cvFile:"   .    ."}),c(!1),u(!1);return}u(!1)}const F={name:r.name,email:r.email,phone:r.phone,position:r.position,notes:r.notes||"",active:r.active,cvFile:G?G.path:p?n.cvFile:null,cvFileURL:G?G.url:p?n.cvFileURL:null,cvFileName:G?G.originalName:p?n.cvFileName:null,cvFileSize:G?G.size:p?n.cvFileSize:null,cvFileType:G?G.type:p?n.cvFileType:null,status:p&&n.status||"active"};if(p){await ef.updateCurriculum(n.id,F);const X=L();j("task",`${X.name}   `,`   : ${F.name}`)}else{await ef.createCurriculum(F);const X=L();j("task",`${X.name}   `,`   : ${F.name}`)}e()}catch(te){console.error("Error saving curriculum:",te),o({submit:te.message})}finally{c(!1),u(!1)}};return t.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.6)",zIndex:99990,position:"fixed",top:0,left:0,right:0,bottom:0},children:t.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",children:[t.jsxs("div",{className:"modal-header",children:[t.jsxs("h5",{className:"modal-title",children:[t.jsx("i",{className:"bi bi-file-earmark-person text-primary me-2"}),p?"  ":"   "]}),t.jsx("button",{type:"button",className:"btn-close",onClick:s})]}),t.jsxs("form",{onSubmit:B,children:[t.jsxs("div",{className:"modal-body",style:{padding:"25px"},children:[x&&t.jsx("div",{className:"alert alert-info border-0 shadow-sm mb-4",children:t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-info-circle-fill text-info me-3 fs-5"}),t.jsxs("div",{children:[t.jsx("strong",{className:"fw-bold",children:"  "}),t.jsx("div",{className:"mt-1",children:t.jsxs("span",{className:"ms-2",children:[!T&&p&&"     ",!y&&!p&&"      ",D&&"     "]})})]})]})}),a.submit&&t.jsxs("div",{className:"alert alert-danger",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),a.submit]}),t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"text",className:`form-control ${a.name?"is-invalid":""}`,name:"name",value:r.name,onChange:S,placeholder:"  ",readOnly:x}),a.name&&t.jsx("div",{className:"invalid-feedback",children:a.name})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"email",className:`form-control ${a.email?"is-invalid":""}`,name:"email",value:r.email,onChange:S,placeholder:"example@company.com",readOnly:x}),a.email&&t.jsx("div",{className:"invalid-feedback",children:a.email})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"tel",className:`form-control ${a.phone?"is-invalid":""}`,name:"phone",value:r.phone,onKeyPress:$=>{/[0-9+]/.test($.key)||$.preventDefault()},onChange:$=>{const H=$.target.value.replace(/[^0-9+]/g,"");S({target:{name:"phone",value:H}})},placeholder:"+966 50 123 4567",readOnly:x}),a.phone&&t.jsx("div",{className:"invalid-feedback",children:a.phone})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsxs("select",{className:`form-select ${a.position?"is-invalid":""}`,name:"position",value:r.position,onChange:S,disabled:x,children:[t.jsx("option",{value:"",children:" ..."}),V6.map(($,H)=>t.jsx("option",{value:$,children:$},H))]}),a.position&&t.jsx("div",{className:"invalid-feedback",children:a.position})]}),t.jsxs("div",{className:"col-md-12 mb-3",children:[t.jsx("label",{className:"form-label",children:"  (PDF)"}),t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("input",{type:"file",ref:f,accept:".pdf",onChange:A,style:{display:"none"}}),t.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>{console.log(" CV Upload button clicked"),console.log(" CV UPLOAD: Starting fullscreen bypass for file picker"),Kr(2e4),f.current?(f.current.value="",f.current.click(),console.log(" CV File input triggered")):console.error(" CV File input ref not found")},disabled:x||d,style:{height:"38px",minWidth:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",fontWeight:"500"},children:d?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"spinner-border spinner-border-sm me-2",style:{width:"14px",height:"14px"}}),"..."]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-cloud-upload me-1"}),"  PDF"]})}),a.cvFile&&t.jsxs("div",{className:"text-danger ms-2",style:{fontSize:"14px"},children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),a.cvFile]})]}),r.cvFile&&t.jsx("div",{className:"alert alert-success py-2 mt-2 mb-0",style:{position:"relative"},children:t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-check-circle me-2 text-success"}),t.jsxs("div",{className:"flex-grow-1",children:[t.jsx("strong",{children:r.cvFile.name||p&&n.cvFileName||"  "}),t.jsx("br",{}),t.jsxs("small",{className:"text-muted",children:["(",r.cvFile.size?Math.round(r.cvFile.size/1024):p&&n.cvFileSize?Math.round(n.cvFileSize/1024):0," KB)"]})]}),!x&&t.jsx("button",{type:"button",className:"btn-close btn-sm",onClick:Q,title:" ",style:{position:"absolute",top:"8px",left:"8px",fontSize:"10px",width:"16px",height:"16px"}})]})})]}),t.jsxs("div",{className:"col-md-12 mb-3",children:[t.jsx("label",{className:"form-label",children:""}),t.jsx("textarea",{className:"form-control",name:"notes",value:r.notes,onChange:S,rows:"3",placeholder:"  ...",readOnly:x})]}),t.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("span",{className:`badge ${r.active?"bg-success":"bg-secondary"} px-3 py-2`,children:r.active?"":" "}),t.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"curriculumActiveSwitch",name:"active",checked:r.active,onChange:S,disabled:x,style:{width:"50px",height:"25px",cursor:x?"not-allowed":"pointer"}})]})})]})]}),t.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:t.jsxs("div",{className:"d-flex gap-3",children:[t.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:s,disabled:l||d,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:""}),t.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:l||d||x,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:l||d?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"12px",height:"12px"}}),d?"...":"..."]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-check-lg me-1"}),p?"":""]})})]})})]})]})})})};function G6(){const[n,e]=h.useState(!1),[s,r]=h.useState(!1),[i,a]=h.useState(null),[o,l]=h.useState(0),[c,d]=h.useState(""),[u,f]=h.useState(!0),[p,j]=h.useState(0),{isTimelineVisible:L}=Ut();kt();const R=()=>{e(!n)},D=()=>{a(null),r(!0)},y=A=>{a(A),r(!0)},T=()=>{r(!1),a(null),l(A=>A+1)},x=()=>{r(!1),a(null)},S=A=>{j(A)};return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:R}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!L?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsx("span",{className:"text-primary",children:" "})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"20px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:10,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsx("div",{className:"d-flex align-items-center",children:t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-file-earmark-person text-primary me-2"}),"  ",t.jsx("span",{className:"badge bg-primary ms-2",style:{fontSize:"0.75rem"},children:p})]})}),t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("span",{className:`badge ${u?"bg-success":"bg-secondary"} px-3 py-2`,children:u?"":" "}),t.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"cvActiveSwitch",checked:u,onChange:A=>f(A.target.checked),style:{width:"48px",height:"24px",marginRight:"8px"}})]}),t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"   ...",value:c,onChange:A=>d(A.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsx(Tt,{can:"curriculum:create",mode:"disable",children:t.jsx("button",{onClick:D,className:"btn btn-primary",style:{height:"40px",width:"150px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:"  "})})]})]})}),t.jsx("div",{style:{height:"calc(100vh - 280px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"card-body p-0",children:t.jsx(z6,{onAdd:D,onEdit:y,refreshTrigger:o,searchTerm:c,showActiveOnly:u,onTotalCountChange:S})})})]})}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&L&&t.jsx(os,{rtl:!0}),!n&&L&&t.jsx(ls,{}),s&&t.jsx("div",{className:"curriculum-form",children:t.jsx(B6,{curriculum:i,onSave:T,onCancel:x})})]})})})}function W6(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(G6,{})})})}const pl={"dashboard:read":"    ","tenders:read":"  ","tenders:create":"  ","tenders:update":" ","tenders:delete":" ","products:read":"   ","products:create":"   ","products:update":"  ","products:delete":"  ","suppliers:read":"  ( )","suppliers:create":"  ","suppliers:update":"  ","suppliers:delete":" ","clients:read":" ","clients:create":"  ","clients:update":"  ","clients:delete":" ","companies:read":" ","companies:create":"  ","companies:update":"  ","companies:delete":" ","competitors:read":" ","competitors:create":"  ","competitors:update":"  ","competitors:delete":" ","employees:read":"   ","employees:create":"  ","employees:update":"  ","employees:delete":" ","curriculum:read":"  ","curriculum:create":"   ","curriculum:update":"  ","curriculum:delete":"  ","documents:read":"  ","documents:create":"  ","documents:update":" ","documents:delete":" ","trash:read":"  ","trash:restore":"   ","trash:delete":"   ","trash:deleteAll":"    ","settings:read":"  ","settings:update":"  ","settings:delete":"    "},Zj=[{value:"admin",label:" ",description:" "},{value:"manager",label:"",description:"  "},{value:"employee",label:"",description:" "},{value:"viewer",label:"",description:" "}],q6={" ":["dashboard:read"],:["tenders:read","tenders:create","tenders:update","tenders:delete"]," ":["products:read","products:create","products:update","products:delete"],:["suppliers:read","suppliers:create","suppliers:update","suppliers:delete"],:["clients:read","clients:create","clients:update","clients:delete"],:["companies:read","companies:create","companies:update","companies:delete"],:["competitors:read","competitors:create","competitors:update","competitors:delete"],"  ":["employees:read","employees:create","employees:update","employees:delete"]," ":["curriculum:read","curriculum:create","curriculum:update","curriculum:delete"],:["documents:read","documents:create","documents:update","documents:delete"]," ":["trash:read","trash:restore","trash:delete","trash:deleteAll"]," ":["settings:read","settings:update","settings:delete"]};function H6(){var z;const{employeeId:n}=Dn(),e=kt(),[s,r]=h.useState(!1),{isTimelineVisible:i}=Ut(),{alertConfig:a,closeAlert:o,showSuccess:l,showError:c}=Bt(),[d,u]=h.useState(null),[f,p]=h.useState(!0),[j,L]=h.useState(!1),[R,D]=h.useState({}),[y,T]=h.useState("viewer"),[x,S]=h.useState(!1),[A,Q]=h.useState(!1),[q,B]=h.useState(!1),[$,H]=h.useState("active");h.useEffect(()=>{G()},[n]);const te=()=>{r(!s)},G=async()=>{if(n)try{p(!0);const O=Le(ae,"employees",n),E=await ss(O);if(E.exists()){const k=E.data();u({id:n,...k}),D(k.permissions||{}),T(k.role||"viewer"),S(k.readOnly||!1),Q(k.permissionPageDisabled||!1),B(k.timerSettingsDisabled||!1),H(k.status||"active")}else c("     ",""),e("/employees")}catch(O){console.error("Error loading employee:",O),c("     ","")}finally{p(!1)}},F=(O,E)=>{D(k=>({...k,[O]:E}))},X=O=>{T(O);let E={};switch(O){case"admin":Object.keys(pl).forEach(k=>{E[k]=!0});break;case"manager":Object.keys(pl).forEach(k=>{!k.includes("settings")&&!k.includes("trash:delete")&&(E[k]=!0)});break;case"employee":["dashboard:read","tenders:read","tenders:create","tenders:update","suppliers:read","customers:read","materials:read","companies:read","documents:read","activity:read"].forEach(k=>{E[k]=!0});break;case"viewer":Object.keys(pl).forEach(k=>{k.includes(":read")&&(E[k]=!0)});break}D(E)},ue=async()=>{try{L(!0);const O=Le(ae,"employees",n);await Qt(O,{permissions:R,role:y,readOnly:x,permissionPageDisabled:A,timerSettingsDisabled:q,status:$,updatedAt:We()}),l(`   ${(d==null?void 0:d.displayName)||""} `,"   ")}catch(O){console.error("Error saving permissions:",O),c("    ","   ")}finally{L(!1)}},Y=()=>[{text:"",href:"/"},{text:"",href:"/employees"},{text:` ${(d==null?void 0:d.displayName)||""}`,active:!0}];return f?t.jsxs("div",{className:`page-wrapper ${s?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:te}),t.jsxs("div",{className:"main-container",style:{paddingRight:s?"72px":"250px",paddingLeft:s||!i?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:s?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:s})}),t.jsx("div",{className:"app-container",children:t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"60vh"},children:t.jsxs("div",{className:"text-center",children:[t.jsx(It,{size:"large"}),t.jsx("p",{className:"mt-3 text-muted",children:"   ..."})]})})})]})]}):t.jsxs("div",{className:`page-wrapper ${s?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:te}),t.jsxs("div",{className:"main-container",style:{paddingRight:s?"72px":"250px",paddingLeft:s||!i?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:s?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:s})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsx("ol",{className:"breadcrumb m-0",children:Y().map((O,E)=>t.jsx("li",{className:`breadcrumb-item ${O.active?"text-secondary":""}`,children:O.active?O.text:t.jsxs("a",{href:O.href,className:"text-decoration-none d-flex align-items-center",children:[E===0&&t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:O.text})]})},E))})}),t.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:t.jsxs("div",{className:"app-content-area p-4",children:[t.jsx("div",{className:"card shadow-sm mb-4",children:t.jsx("div",{className:"card-header bg-white border-bottom py-3",children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("div",{className:"bg-primary bg-gradient rounded-circle d-flex align-items-center justify-content-center me-3",style:{width:"50px",height:"50px"},children:t.jsx("i",{className:"bi bi-person-badge text-white fs-4"})}),t.jsxs("div",{children:[t.jsx("h5",{className:"mb-1 fw-bold",children:(d==null?void 0:d.displayName)||(d==null?void 0:d.fullName)}),t.jsxs("p",{className:"text-muted mb-0",children:[t.jsx("i",{className:"bi bi-envelope me-1"}),d==null?void 0:d.email]}),t.jsxs("div",{className:"d-flex gap-2 mt-2",children:[t.jsx("span",{className:`badge ${y==="admin"?"bg-danger":y==="manager"?"bg-warning text-dark":y==="employee"?"bg-info":"bg-secondary"}`,children:((z=Zj.find(O=>O.value===y))==null?void 0:z.label)||y}),t.jsx("span",{className:`badge ${$==="active"?"bg-success":"bg-danger"}`,children:$==="active"?" ":" "}),x&&t.jsx("span",{className:"badge bg-warning text-dark",children:"  "})]})]})]}),t.jsx("div",{className:"d-flex gap-2",children:t.jsx("button",{className:"btn btn-primary shadow-sm px-4",onClick:ue,disabled:j,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:j?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"spinner-border spinner-border-sm me-2"})," ..."]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-check-circle me-2"})," "]})})})]})})}),t.jsxs("div",{className:"row",children:[t.jsx("div",{className:"col-md-4",children:t.jsxs("div",{className:"card shadow-sm h-100",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-3",children:t.jsxs("h6",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-gear-fill text-primary me-2"})," "]})}),t.jsxs("div",{className:"card-body",children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"form-label fw-semibold",children:" "}),t.jsx("select",{className:"form-select shadow-sm",value:y,onChange:O=>X(O.target.value),style:{borderRadius:"8px",fontSize:"14px",height:"44px"},children:Zj.map(O=>t.jsxs("option",{value:O.value,children:[O.label," - ",O.description]},O.value))})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"form-label fw-semibold",children:" "}),t.jsxs("select",{className:"form-select shadow-sm",value:$,onChange:O=>H(O.target.value),style:{borderRadius:"8px",fontSize:"14px",height:"44px"},children:[t.jsx("option",{value:"active",children:" "}),t.jsx("option",{value:"suspended",children:" "})]})]}),t.jsx("div",{className:"bg-light bg-gradient p-3 rounded",style:{borderRadius:"8px"},children:t.jsxs("div",{className:"form-check",children:[t.jsx("input",{className:"form-check-input",type:"checkbox",id:"readOnlyMode",checked:x,onChange:O=>S(O.target.checked),style:{transform:"scale(1.2)"}}),t.jsx("label",{className:"form-check-label fw-semibold",htmlFor:"readOnlyMode",children:"   "}),t.jsx("div",{className:"form-text mt-2",children:"          "})]})}),t.jsx("div",{className:"bg-primary bg-gradient p-3 rounded mt-3",style:{borderRadius:"8px"},children:t.jsxs("div",{className:"form-check",children:[t.jsx("input",{className:"form-check-input",type:"checkbox",id:"permissionPageDisabled",checked:A,onChange:O=>Q(O.target.checked),style:{transform:"scale(1.2)"}}),t.jsx("label",{className:"form-check-label fw-semibold text-white",htmlFor:"permissionPageDisabled",children:"   "}),t.jsx("div",{className:"form-text mt-2 text-white",children:"           "})]})}),t.jsx("div",{className:"p-3 rounded mt-3",style:{borderRadius:"8px",backgroundColor:"#6f42c1"},children:t.jsxs("div",{className:"form-check",children:[t.jsx("input",{className:"form-check-input",type:"checkbox",id:"timerSettingsDisabled",checked:q,onChange:O=>B(O.target.checked),style:{transform:"scale(1.2)"}}),t.jsx("label",{className:"form-check-label fw-semibold text-white",htmlFor:"timerSettingsDisabled",children:"   "}),t.jsx("div",{className:"form-text mt-2 text-white",children:"         "})]})})]})]})}),t.jsx("div",{className:"col-md-8",children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-3",children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{children:[t.jsxs("h6",{className:"mb-1 fw-bold",children:[t.jsx("i",{className:"bi bi-shield-check-fill text-success me-2"})," "]}),t.jsxs("small",{className:"text-muted",children:["  ",Object.values(R).filter(Boolean).length,"   ",Object.keys(pl).length," ",t.jsxs("span",{className:"badge bg-primary ms-2",children:[Math.round(Object.values(R).filter(Boolean).length/Object.keys(pl).length*100),"%"]})]})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsxs("button",{className:"btn btn-outline-success shadow-sm",onClick:()=>{const O={};Object.keys(pl).forEach(E=>{O[E]=!0}),D(O)},style:{borderRadius:"6px",fontSize:"12px",fontWeight:"500",height:"32px",padding:"0 12px"},children:[t.jsx("i",{className:"bi bi-check-all me-1"})," "]}),t.jsxs("button",{className:"btn btn-outline-danger shadow-sm",onClick:()=>D({}),style:{borderRadius:"6px",fontSize:"12px",fontWeight:"500",height:"32px",padding:"0 12px"},children:[t.jsx("i",{className:"bi bi-x-circle me-1"})," "]})]})]})}),t.jsx("div",{className:"card-body",style:{maxHeight:"500px",overflowY:"auto",overflowX:"hidden"},children:Object.entries(q6).map(([O,E])=>t.jsxs("div",{className:"mb-4 p-3 border rounded bg-light bg-gradient",style:{borderRadius:"8px"},children:[t.jsxs("div",{className:"mb-3",children:[t.jsxs("h6",{className:"text-primary mb-1 fw-bold",children:[t.jsx("i",{className:"bi bi-folder-fill me-2"}),O]}),t.jsxs("small",{className:"text-muted",children:[E.filter(k=>R[k]).length,"  ",E.length,t.jsx("span",{className:`badge ms-2 ${E.filter(k=>R[k]).length===E.length?"bg-success":E.filter(k=>R[k]).length===0?"bg-secondary":"bg-warning text-dark"}`,children:E.filter(k=>R[k]).length===E.length?" ":E.filter(k=>R[k]).length===0?" ":" "})]})]}),t.jsx("div",{className:"row",children:E.map(k=>t.jsx("div",{className:"col-md-6 mb-2",children:t.jsxs("div",{className:"form-check bg-white p-2 rounded shadow-sm",style:{borderRadius:"6px"},children:[t.jsx("input",{className:"form-check-input",type:"checkbox",id:k,checked:R[k]||!1,onChange:b=>F(k,b.target.checked),style:{transform:"scale(1.1)"}}),t.jsxs("label",{className:"form-check-label fw-medium",htmlFor:k,children:[t.jsx("i",{className:`bi ${R[k]?"bi-check-circle-fill text-success":"bi-circle text-muted"} me-1`}),pl[k]]})]})},k))})]},O))})]})})]})]})}),!s&&i&&t.jsx(os,{rtl:!0}),!s&&i&&t.jsx(ls,{})]})]}),t.jsx(Mt,{show:a.show,onClose:o,title:a.title,message:a.message,type:a.type})]})}function Q6(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(H6,{})})})}function K6(){var pe,be,xe,Ee,Re,fe,Ve,$e,et;const n=kt(),[e,s]=h.useState(!1),{isTimelineVisible:r}=Ut(),[i,a]=h.useState([]),[o,l]=h.useState(!0),[c,d]=h.useState(null),[u,f]=h.useState(""),[p,j]=h.useState([]),[L,R]=h.useState(null),[D,y]=h.useState(!1),[T,x]=h.useState(!1),[S,A]=h.useState(null),[Q,q]=h.useState({}),[B,$]=h.useState(null),{logActivity:H,getCurrentUser:te}=Zt(),{alertConfig:G,closeAlert:F}=Bt(),{currentPage:X,totalPages:ue,paginatedItems:Y,handlePageChange:z,resetPage:O,totalItems:E,itemsPerPage:k}=cr(p,30),b=()=>{s(!e)};h.useEffect(()=>{P();const ze=N(),tt=setInterval(()=>{q(rt=>({...rt}))},1e3);return()=>{ze&&ze(),clearInterval(tt),B&&clearInterval(B)}},[]);const N=()=>{if(!ae){console.warn(" Database not available for live tracking");return}console.log(" LIVE TRACKING: Setting up real-time listener...");const ze=Pe(ae,"live_tracking"),tt=st(ze);return ar(tt,bt=>{const At={};bt.forEach(ns=>{const Ht=ns.data();Ht.employeeId&&(At[Ht.employeeId]={status:Ht.status||"inactive",lastUpdate:Ht.lastUpdate,sessionStart:Ht.sessionStart,totalSeconds:Ht.totalSeconds||0,isActive:Ht.status==="active"})}),console.log(" LIVE TRACKING: Updated tracking data for",Object.keys(At).length,"employees"),q(At)},bt=>{console.error(" LIVE TRACKING: Listener error:",bt)})};h.useEffect(()=>{I()},[i,u]);const I=()=>{if(!Array.isArray(i)){j([]);return}let ze=[...i];if(u.trim()){const tt=u.toLowerCase();ze=ze.filter(rt=>{var bt,At,ns,Ht,is,Oe,it;return((bt=rt.fullName)==null?void 0:bt.toLowerCase().includes(tt))||((At=rt.department)==null?void 0:At.toLowerCase().includes(tt))||((ns=rt.jobTitle)==null?void 0:ns.toLowerCase().includes(tt))||((Ht=rt.position)==null?void 0:Ht.toLowerCase().includes(tt))||((is=rt.email)==null?void 0:is.toLowerCase().includes(tt))||((Oe=rt.phone)==null?void 0:Oe.includes(u))||((it=rt.nationalId)==null?void 0:it.includes(u))})}j(ze),O()},P=async()=>{try{l(!0),d(null);const ze=await jo.getAllEmployees({limit:1e3});console.log(" Employees result received:",ze);const tt=ze.employees||[];a(tt),d(null)}catch(ze){console.error(" Error loading employees:",ze),d(ze.message),a([])}finally{l(!1)}},_=ze=>{n("/employees",{state:{selectedEmployee:ze,currentView:"edit"}})},C=ze=>{R(ze),y(!0)},U=()=>{R(null),y(!1)},w=ze=>{console.log(" LIST FUNCTION: Employee",ze.fullName),n("/time-tracking",{state:{selectedEmployeeId:ze.id||ze.internalId,selectedEmployeeName:ze.fullName,filterByEmployee:!0}})},W=ze=>{console.log(" ANALYTICS FUNCTION: Employee",ze.fullName),console.log(" CRITICAL DEBUG: Employee object:",ze),console.log(" CRITICAL DEBUG: Employee ID:",ze.id),console.log(" CRITICAL DEBUG: Employee internalId:",ze.internalId),console.log(" CRITICAL DEBUG: Available tracking data keys:",Object.keys(Q));const tt=ze.id||ze.internalId;console.log(" CRITICAL DEBUG: Using UID:",tt),console.log(" CRITICAL DEBUG: Live tracking data for this UID:",Q[tt]),A(ze),x(!0);const rt=setInterval(()=>{console.log(" ANALYTICS MODAL: Real-time sync for employee",ze.fullName),console.log(" ANALYTICS MODAL: Current data for UID",tt,":",Q[tt]),q(bt=>({...bt}))},1e3);$(rt),console.log(" ANALYTICS MODAL: Started 1-second real-time sync interval")},ie=()=>{B&&(clearInterval(B),$(null),console.log(" ANALYTICS MODAL: Stopped 1-second real-time sync interval")),A(null),x(!1)},de=()=>new Date().getDay()===5,ne=ze=>de()?"":!ze||ze===0?"0":Math.floor(ze/60/4.8),ye=ze=>{const tt=Q[ze.id];switch(((tt==null?void 0:tt.status)||"inactive").toLowerCase()){case"active":return t.jsx("span",{className:"badge bg-success",children:""});case"paused":return t.jsx("span",{className:"badge bg-warning",children:" "});case"stopped":return t.jsx("span",{className:"badge bg-secondary",children:""});default:return t.jsx("span",{className:"badge bg-secondary",children:" "})}};return t.jsxs("div",{className:`page-wrapper ${e?"sidebar-collapsed":""}`,children:[t.jsx(Rt,{onToggle:b}),t.jsxs("div",{className:"main-container",style:{paddingRight:e?"72px":"250px",paddingLeft:e||!r?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:e?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:e})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-secondary",children:t.jsx("span",{children:" "})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"  "})]})}),t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"20px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:10,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-person-workspace text-primary me-2"}),"  "]}),t.jsx("span",{className:`badge rounded-pill ${de()?"bg-warning":"bg-primary"}`,children:de()?"":`${p.length} `})]}),t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[t.jsxs("div",{className:"search-box",style:{position:"relative"},children:[t.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"  ...",value:u,onChange:ze=>f(ze.target.value),style:{paddingLeft:"35px",borderRadius:"6px",minWidth:"250px"}}),t.jsx("i",{className:"bi bi-search",style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"#6c757d",fontSize:"14px"}})]}),t.jsxs("button",{className:"btn btn-outline-primary btn-sm",onClick:P,disabled:o,title:" ",children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-1"}),""]})]})]})}),t.jsxs("div",{className:"card-body p-0",children:[o?t.jsxs("div",{className:"text-center py-5",children:[t.jsx(It,{size:"large"}),t.jsx("p",{className:"mt-3 text-muted",children:"   ..."})]}):c?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:c}),t.jsxs("button",{className:"btn btn-primary",onClick:P,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]}):p.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-person-workspace fs-1"})}),t.jsx("h5",{className:"text-muted",children:"  "}),t.jsx("p",{className:"text-muted",children:u?"    ":"     "})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",style:{tableLayout:"fixed"},children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:"80px",textAlign:"center"},children:"#"}),t.jsx("th",{style:{width:"35%",textAlign:"right"},children:" "}),t.jsx("th",{style:{width:"20%",textAlign:"center"},children:""}),t.jsx("th",{style:{width:"25%",textAlign:"right"},children:""}),t.jsx("th",{style:{width:"10%",textAlign:"center"},children:""}),t.jsx("th",{style:{width:"10%",textAlign:"center"},children:""})]})}),t.jsx("tbody",{children:Y.map((ze,tt)=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",style:{verticalAlign:"middle"},children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(X-1)*k+tt+1})}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:t.jsx("div",{className:"fw-bold text-primary",style:{cursor:"pointer",textDecoration:"underline"},onClick:()=>C(ze),title:`  - Internal ID: ${ze.internalId||"Not Set"}`,children:ze.fullName||"-"})}),t.jsx("td",{style:{direction:"ltr",textAlign:"center",verticalAlign:"middle"},children:ze.phone||"-"}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:ze.jobTitle||ze.position||"-"}),t.jsx("td",{style:{textAlign:"center",verticalAlign:"middle"},children:ye(ze)}),t.jsx("td",{style:{textAlign:"center",verticalAlign:"middle"},children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx("button",{className:"btn btn-primary",onClick:()=>w(ze),title:"",style:{width:"32px",height:"32px",padding:"0",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx("i",{className:"bi bi-list-check"})}),t.jsx("button",{className:"btn",onClick:()=>W(ze),title:"",style:{backgroundColor:"#6f42c1",borderColor:"#6f42c1",color:"white",width:"32px",height:"32px",padding:"0",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx("i",{className:"bi bi-graph-up"})})]})})]},ze.internalId||ze.id))})]})}),p.length>0&&t.jsx(dr,{currentPage:X,totalPages:ue,onPageChange:z,totalItems:E,itemsPerPage:k})]})]})}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!e&&r&&t.jsx(os,{rtl:!0}),!e&&r&&t.jsx(ls,{}),D&&L&&t.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:t.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderTopLeftRadius:"12px",borderTopRightRadius:"12px"},children:[t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-person-circle me-2"})," "]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:U,"aria-label":""})]}),t.jsx("div",{className:"modal-body p-4",children:t.jsxs("div",{className:"row",children:[t.jsx("div",{className:"col-md-4 text-center mb-4",children:t.jsxs("div",{className:"employee-photo-container",children:[t.jsx("div",{className:"bg-light rounded-circle d-inline-flex align-items-center justify-content-center",style:{width:"120px",height:"120px",fontSize:"48px",color:"#6c757d"},children:t.jsx("i",{className:"bi bi-person-fill"})}),t.jsx("h5",{className:"mt-3 mb-1 fw-bold text-primary",children:L.fullName||" "}),t.jsx("div",{className:"mb-2",children:ye(L)})]})}),t.jsx("div",{className:"col-md-8",children:t.jsxs("div",{className:"row g-3",children:[t.jsx("div",{className:"col-12",children:t.jsxs("h6",{className:"fw-bold text-secondary mb-3",children:[t.jsx("i",{className:"bi bi-info-circle me-2"})," "]})}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext bg-light rounded p-2",children:L.jobTitle||L.position||" "})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext bg-light rounded p-2",children:L.department||" "})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext bg-light rounded p-2",style:{direction:"ltr"},children:L.phone||" "})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext bg-light rounded p-2",children:L.email||" "})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext bg-light rounded p-2",style:{direction:"ltr"},children:L.nationalId||" "})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:" "}),t.jsx("div",{className:"form-control-plaintext bg-light rounded p-2",style:{direction:"ltr"},children:L.hireDate?new Date(L.hireDate).toLocaleDateString("en-GB"):" "})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label fw-bold text-muted",children:""}),t.jsx("div",{className:"form-control-plaintext bg-light rounded p-2",children:L.salary?`${L.salary} `:" "})]})]})})]})}),t.jsxs("div",{className:"modal-footer bg-light d-flex justify-content-center gap-3 py-3",style:{borderBottomLeftRadius:"12px",borderBottomRightRadius:"12px"},children:[t.jsxs("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>{U(),_(L)},style:{minWidth:"120px",height:"38px",fontSize:"14px",borderRadius:"6px"},children:[t.jsx("i",{className:"bi bi-pencil me-2"})," "]}),t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:U,style:{minWidth:"80px",height:"38px",fontSize:"14px",borderRadius:"6px"},children:""})]})]})})}),T&&S&&t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},className:"analytics-modal-overlay",onClick:ie,dir:"rtl",children:t.jsx("div",{style:{width:"100%",maxWidth:"765px",maxHeight:"76vh",margin:"auto"},onClick:ze=>ze.stopPropagation(),children:t.jsxs("div",{className:"card shadow-lg border-0",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"20px",overflow:"hidden"},children:[t.jsx("div",{className:"card-header border-0",style:{backgroundColor:"rgba(255,255,255,0.1)",backdropFilter:"blur(10px)"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("div",{className:"p-3 rounded-circle me-3",style:{background:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)"},children:t.jsx("i",{className:"bi bi-bar-chart text-white fs-4"})}),t.jsxs("div",{children:[t.jsxs("h4",{className:"text-white mb-1 fw-bold",children:["   ",(S==null?void 0:S.fullName)||""]}),t.jsx("p",{className:"text-white-50 mb-0 small",children:"     "})]})]}),t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsxs("div",{className:"badge me-3 px-3 py-2 rounded-pill d-flex align-items-center",style:{minWidth:"80px",background:Q[S==null?void 0:S.id]?"linear-gradient(135deg, #87CEEB 0%, #4169E1 100%)":"linear-gradient(135deg, #6c757d 0%, #495057 100%)",boxShadow:Q[S==null?void 0:S.id]?"0 4px 15px rgba(65, 105, 225, 0.4)":"0 4px 15px rgba(108, 117, 125, 0.3)",transition:"all 0.3s ease",border:"none"},title:Q[S==null?void 0:S.id]?"   ":"   ",children:[t.jsx("i",{className:`bi ${Q[S==null?void 0:S.id]?"bi-cloud-check":"bi-cloud-slash"} text-white me-2`,style:{fontSize:"14px",filter:Q[S==null?void 0:S.id]?"drop-shadow(0 2px 4px rgba(0,0,0,0.2))":"none"}}),t.jsx("span",{className:"text-white",style:{fontSize:"12px",fontWeight:"500"},children:Q[S==null?void 0:S.id]?"":" "})]}),t.jsxs("div",{className:`badge ${(pe=Q[S==null?void 0:S.id])!=null&&pe.isActive?"bg-success":"bg-warning"} px-3 py-2 rounded-pill me-3`,children:[t.jsx("i",{className:`bi ${(be=Q[S==null?void 0:S.id])!=null&&be.isActive?"bi-play-fill":"bi-pause-fill"} me-2`}),(xe=Q[S==null?void 0:S.id])!=null&&xe.isActive?"":" "]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:ie,style:{width:"32px",height:"32px",backgroundColor:"rgba(255,255,255,0.2)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},title:""})]})]})}),t.jsxs("div",{className:"card-body p-5",children:[t.jsx("div",{className:"d-flex justify-content-center mb-5",children:t.jsx("div",{className:"position-relative",children:t.jsxs("div",{className:"position-relative",style:{width:"200px",height:"200px"},children:[t.jsxs("svg",{width:"200",height:"200",className:"position-absolute",children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"timerGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t.jsx("stop",{offset:"0%",style:{stopColor:"#4facfe"}}),t.jsx("stop",{offset:"100%",style:{stopColor:"#00f2fe"}})]})}),t.jsx("circle",{cx:"100",cy:"100",r:"85",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"8"}),t.jsx("circle",{cx:"100",cy:"100",r:"85",fill:"none",stroke:"url(#timerGradient)",strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${de()?"0 534":`${Math.floor((((Ee=Q[S==null?void 0:S.id])==null?void 0:Ee.totalSeconds)||0)/60/4.8)/100*534} 534`}`,transform:"rotate(-90 100 100)",style:{transition:(Re=Q[S==null?void 0:S.id])!=null&&Re.isActive?"stroke-dasharray 1s ease-in-out":"none",filter:"drop-shadow(0 0 10px rgba(79, 172, 254, 0.5))"}})]}),t.jsxs("div",{className:"position-absolute top-50 start-50 translate-middle text-center",children:[t.jsx("h1",{className:"text-white mb-1 fw-bold",style:{fontSize:"2.2rem",fontFamily:"monospace",textShadow:"0 2px 10px rgba(0,0,0,0.3)"},children:(()=>{var At;const ze=((At=Q[S==null?void 0:S.id])==null?void 0:At.totalSeconds)||0,tt=Math.floor(ze/3600),rt=Math.floor(ze%3600/60),bt=ze%60;return`${tt.toString().padStart(2,"0")}:${rt.toString().padStart(2,"0")}:${bt.toString().padStart(2,"0")}`})()}),t.jsx("small",{className:"text-white-50",children:" "})]})]})})}),t.jsxs("div",{className:"row g-4",children:[t.jsx("div",{className:"col-md-6",children:t.jsx("div",{className:"card bg-white bg-opacity-10 border-0 h-100",style:{backdropFilter:"blur(10px)",borderRadius:"15px"},children:t.jsxs("div",{className:"card-body text-center",children:[t.jsx("i",{className:"bi bi-calendar-check text-white fs-1 mb-2 d-block opacity-75"}),t.jsx("div",{className:"text-white-50 mb-2",style:{fontSize:"calc(0.875rem + 2px)"},children:new Date().toLocaleDateString("en-GB")}),t.jsx("h3",{className:"text-white fw-bold mb-1",children:(()=>{var tt;const ze=ne(((tt=Q[S==null?void 0:S.id])==null?void 0:tt.totalSeconds)||0);return ze===""?ze:`${ze}%`})()}),t.jsx("small",{className:"text-white-50",children:"  "})]})})}),t.jsx("div",{className:"col-md-6",children:t.jsx("div",{className:"card bg-white bg-opacity-10 border-0 h-100",style:{backdropFilter:"blur(10px)",borderRadius:"15px"},children:t.jsxs("div",{className:"card-body text-center",children:[t.jsx("i",{className:"bi bi-clock-history text-white fs-1 mb-3 d-block opacity-75"}),t.jsx("h3",{className:"text-white fw-bold mb-1",children:(()=>{const ze=Q[S==null?void 0:S.id];if(!ze||!ze.sessionStart)return"--:--";try{let tt;return ze.sessionStart.toDate?tt=ze.sessionStart.toDate():ze.sessionStart.seconds?tt=new Date(ze.sessionStart.seconds*1e3):tt=new Date(ze.sessionStart),isNaN(tt.getTime())?(console.warn(" Invalid session start date in employee analytics:",ze.sessionStart),"--:--"):tt.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}catch(tt){return console.error(" Error formatting employee session start time:",tt,ze.sessionStart),"--:--"}})()}),t.jsx("small",{className:"text-white-50",children:" "})]})})})]}),t.jsx("div",{className:"mt-4",children:t.jsx("div",{className:"card bg-white bg-opacity-10 border-0",style:{backdropFilter:"blur(10px)",borderRadius:"15px"},children:t.jsx("div",{className:"card-body",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("div",{className:`rounded-circle me-3 ${(fe=Q[S==null?void 0:S.id])!=null&&fe.isActive?"bg-success":"bg-warning"}`,style:{width:"12px",height:"12px",animation:(Ve=Q[S==null?void 0:S.id])!=null&&Ve.isActive?"pulse 2s infinite":"none"}}),t.jsxs("div",{children:[t.jsx("h6",{className:"text-white mb-1 fw-bold",children:" "}),t.jsx("small",{className:"text-white-50",children:($e=Q[S==null?void 0:S.id])!=null&&$e.isActive?"     -  ":"    -     "})]})]}),t.jsx("div",{style:{padding:"0",background:"transparent",border:"none"},title:"  ",children:t.jsx("i",{className:`bi ${(et=Q[S==null?void 0:S.id])!=null&&et.isActive?"bi-eye":"bi-eye-slash"} text-white fs-4 opacity-75`})})]})})})})]})]})})}),t.jsx("style",{children:`
            @keyframes pulse {
              0% { opacity: 1; }
              50% { opacity: 0.5; }
              100% { opacity: 1; }
            }
          `})]}),t.jsx(Mt,{show:G.show,onClose:F,title:G.title,message:G.message,type:G.type,onConfirm:G.onConfirm,confirmText:G.confirmText,cancelText:G.cancelText,showCancel:G.showCancel})]})}function Y6(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(K6,{})})})}const J6=()=>{const[n,e]=h.useState([]),[s,r]=h.useState([]),[i,a]=h.useState(!0),[o,l]=h.useState(""),[c,d]=h.useState(""),[u,f]=h.useState(""),{logActivity:p,getCurrentUser:j}=Zt(),{alertConfig:L,closeAlert:R,showSuccess:D,showError:y,showConfirm:T}=Bt(),{currentPage:x,totalPages:S,paginatedItems:A,handlePageChange:Q,resetPage:q,totalItems:B,itemsPerPage:$}=cr(s,30);h.useEffect(()=>{H()},[]),h.useEffect(()=>{if(u.trim()){const X=n.filter(ue=>{var O,E,k,b,N,I,P,_,C;const Y=bs.getItemDisplayInfo(ue),z=u.toLowerCase();return((O=Y.displayName)==null?void 0:O.toLowerCase().includes(z))||((E=Y.email)==null?void 0:E.toLowerCase().includes(z))||((k=Y.phone)==null?void 0:k.includes(u))||((b=Y.supplierName)==null?void 0:b.toLowerCase().includes(z))||((N=Y.category)==null?void 0:N.toLowerCase().includes(z))||((I=Y.contextName)==null?void 0:I.toLowerCase().includes(z))||((P=Y.price)==null?void 0:P.toLowerCase().includes(z))||((_=Y.name)==null?void 0:_.toLowerCase().includes(z))||((C=ue.originalCollection)==null?void 0:C.toLowerCase().includes(z))});r(X)}else r(n);q()},[u,n,q]);const H=async()=>{try{a(!0),l("");const X=await bs.getAllTrashItems();e(X),r(X)}catch(X){l(X.message)}finally{a(!1)}},te=async(X,ue)=>{var Y,z;try{d(X),l("");const O=n.find(b=>b.id===X);if(O&&O.originalCollection==="tenderItems"){const b=((Y=O.tenderContext)==null?void 0:Y.tenderTitle)||"  ",N=((z=O.tenderContext)==null?void 0:z.tenderId)||"new";T(`      

: ${ue}
  : ${b}`,async()=>{try{e(P=>P.filter(_=>_.id!==X)),await bs.restoreItem(X);const I=j();p("task",`${I.name}     `,`  : ${ue} : ${b}`),D(`     : ${b}`," "),setTimeout(H,1e3)}catch(I){console.error("Error restoring tender item:",I),e(P=>[...P,O]),y(`   : ${I.message}`,"  ")}finally{d("")}},"   "),d("");return}e(b=>b.filter(N=>N.id!==X)),await bs.restoreItem(X);const E=j(),k=bs.getItemDisplayInfo(O).name;p("task",`${E.name}  ${k}  `,`  ${k}: ${ue}`),setTimeout(async()=>{await H()},500),D(`   : ${ue}`,"  ")}catch(O){console.error("Restore error:",O),l(O.message),y(`  : ${O.message}`,"  "),await H()}finally{d("")}},G=(X,ue)=>{T(`   "${ue}" 
     !`,async()=>{try{d(X),l(""),e(E=>E.filter(k=>k.id!==X)),await bs.permanentlyDelete(X);const Y=j(),z=n.find(E=>E.id===X),O=bs.getItemDisplayInfo(z).name;p("task",`${Y.name}  ${O}   `,`  ${O} : ${ue}`),setTimeout(async()=>{await H()},500),D(`   : ${ue}`,"  ")}catch(Y){console.error("Permanent delete error:",Y),l(Y.message),y(`  : ${Y.message}`,"  "),await H()}finally{d("")}},"  ")},F=()=>{T(` :       
         .
     !`,async()=>{try{a(!0),e([]),await bs.clearAllTrashRecords();const X=j();p("task",`${X.name}    `,"      "),await H(),D("     ","  ")}catch(X){l(X.message),y(`   : ${X.message}`,"  "),await H()}finally{a(!1)}}," -   ")};return t.jsxs("div",{className:"trash-list",children:[t.jsxs("div",{className:"card shadow-sm",children:[t.jsxs("div",{className:"card-header bg-white border-bottom py-4",children:[t.jsxs("div",{className:"row align-items-center justify-content-between",children:[t.jsx("div",{className:"col-lg-4",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-trash text-danger me-2"}),"  (",s.length,")"]})}),t.jsx("div",{className:"col-lg-8",children:t.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[t.jsxs("div",{className:"input-group trash-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:u,onChange:X=>f(X.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted"})})]}),n.length>0&&t.jsx(Tt,{can:"trash:deleteAll",mode:"disable",children:t.jsxs("button",{className:"btn btn-danger shadow-sm px-4",onClick:F,disabled:i,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500",background:"linear-gradient(135deg, #dc3545 0%, #b02a37 100%)",border:"none",color:"white"},children:[t.jsx("i",{className:"bi bi-trash3 me-2"}),"  "]})})]})})]}),o&&t.jsxs("div",{className:"alert alert-danger mt-3 mb-0",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),o]})]}),t.jsx("div",{className:"card-body p-0",children:i?t.jsx(It,{show:!0,message:"  ...",overlay:!1}):s.length===0?t.jsx("div",{className:"text-center py-5",children:t.jsxs("div",{className:"empty-state",children:[t.jsx("i",{className:"bi bi-trash3 text-muted mb-3",style:{fontSize:"4rem"}}),t.jsx("h5",{className:"text-muted",children:n.length===0?"  ":"   "}),t.jsx("p",{className:"text-muted",children:n.length===0?"   ":"     "})]})}):t.jsxs("div",{className:"p-4",children:[t.jsx("div",{className:"row g-3",children:A.map((X,ue)=>{const Y=bs.getItemDisplayInfo(X),z=bs.getTimeSinceDeleted(X.deletedAt),O={fontSize:"12px",fontWeight:"600",color:"#6c757d",marginLeft:"8px"},E={fontSize:"13px",color:"#495057",fontWeight:"500"};return t.jsx("div",{className:"col-lg-4 col-md-6",children:t.jsxs("div",{className:"card h-100 shadow-sm",style:{borderRadius:"10px",border:"1px solid #e3e6f0",transition:"all 0.3s ease",overflow:"hidden"},children:[t.jsxs("div",{className:"card-body p-4",children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-3",children:[t.jsxs("span",{className:`badge bg-${Y.color} px-3 py-2`,style:{borderRadius:"20px",fontSize:"11px",fontWeight:"600"},children:[t.jsx("i",{className:`bi ${Y.icon} me-1`}),Y.name]}),t.jsx("small",{className:"text-muted fw-medium",style:{fontSize:"11px"},children:z})]}),t.jsx("h6",{className:"card-title mb-3",style:{color:"#2c3e50",fontSize:"16px",fontWeight:"600",lineHeight:"1.3"},children:Y.displayName}),t.jsxs("div",{className:"card-text",children:[X.originalCollection==="rawmaterials"&&t.jsxs("div",{className:"info-grid",children:[t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value",style:E,children:Y.category})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:" :"}),t.jsx("span",{className:"info-value",style:E,children:Y.minimumStock})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value",style:E,children:Y.supplier})]})]}),X.originalCollection==="employees"&&t.jsxs("div",{className:"info-grid",children:[t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:" :"}),t.jsx("span",{className:"info-value",style:E,children:X.email||" "})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:" :"}),t.jsx("span",{className:"info-value",style:E,children:X.phone||" "})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value",style:E,children:X.department||" "})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value",style:E,children:X.jobTitle||" "})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:`badge ${X.status==="active"?"bg-success":"bg-secondary"}`,style:{fontSize:"10px"},children:X.status==="active"?"":" "})]}),X.autoCreated&&t.jsx("div",{className:"info-item mb-2",children:t.jsxs("span",{className:"badge bg-warning text-dark",style:{fontSize:"10px"},children:[t.jsx("i",{className:"bi bi-robot me-1"}),"  "]})})]}),X.originalCollection==="price_quotes"&&t.jsxs("div",{className:"info-grid",children:[t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value text-success fw-bold",style:{...E,color:"#28a745"},children:Y.price})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value",style:E,children:Y.supplierName})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value",style:E,children:Y.date})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsxs("span",{className:"info-label",style:O,children:[Y.contextLabel,":"]}),t.jsx("span",{className:"info-value",style:{...E,color:"#007bff"},children:Y.contextName})]})]}),(X.originalCollection==="localproducts"||X.originalCollection==="foreignproducts")&&t.jsxs("div",{className:"info-grid",children:[t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value",style:E,children:Y.category})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value",style:E,children:Y.unit})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value text-success fw-bold",style:{...E,color:"#28a745"},children:Y.price})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value",style:E,children:Y.supplier})]})]}),X.originalCollection==="tenderItems"&&t.jsxs("div",{className:"info-grid",children:[t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value",style:E,children:Y.quantity})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value text-success fw-bold",style:{...E,color:"#28a745"},children:Y.price})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value",style:E,children:Y.itemType})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsxs("span",{className:"info-label",style:O,children:[Y.contextLabel,":"]}),t.jsx("span",{className:"info-value",style:{...E,color:"#007bff"},children:Y.contextName})]})]}),X.originalCollection==="tender_documents"&&t.jsxs("div",{className:"info-grid",children:[t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value",style:E,children:Y.fileSize})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value",style:E,children:Y.fileType})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value fw-bold",style:{...E,color:"#007bff"},children:Y.contextName})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:" :"}),t.jsx("span",{className:"info-value",style:{...E,color:"#6c757d",fontFamily:"monospace"},children:X.tenderReferenceNumber||" "})]})]}),X.originalCollection==="employee_documents"&&t.jsxs("div",{className:"info-grid",children:[t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:" :"}),t.jsx("span",{className:"info-value",style:{...E,fontSize:"12px",color:"#6c757d"},children:X.originalFileName||" "})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value",style:E,children:X.fileSize?`${(X.fileSize/1024/1024).toFixed(2)} .`:" "})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:" :"}),t.jsx("span",{className:"info-value",style:E,children:(()=>{var b;const k=X.fileType||"";return k.includes("pdf")?"PDF":k.includes("word")||k.includes("document")?"Word":k.includes("image")?"":k.includes("excel")||k.includes("sheet")?"Excel":((b=k.split("/")[1])==null?void 0:b.toUpperCase())||" "})()})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value fw-bold",style:{...E,color:"#28a745"},children:X.employeeName||Y.contextName})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:" :"}),t.jsx("span",{className:"info-value",style:{...E,color:"#6c757d",fontFamily:"monospace",fontSize:"12px"},children:X.employeeId||" "})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:" :"}),t.jsx("span",{className:"info-value",style:{...E,color:"#6c757d",fontSize:"12px"},children:(()=>{const k=X.uploadedAt||X.uploadDate;if(!k)return" ";try{return new Date(k).toLocaleDateString("ar-SA",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return" "}})()})]}),X.fileURL&&t.jsx("div",{className:"info-item mb-2",children:t.jsxs("span",{className:"badge bg-success bg-opacity-10 text-success",style:{fontSize:"10px"},children:[t.jsx("i",{className:"bi bi-link-45deg me-1"}),"  "]})})]}),X.originalCollection==="manufacturedProducts"&&t.jsxs("div",{className:"info-grid",children:[X.referenceNumber&&t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:" :"}),t.jsx("span",{className:"info-value",style:{...E,fontFamily:"monospace",color:"#007bff"},children:X.referenceNumber})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:" :"}),t.jsx("span",{className:"info-value text-success fw-bold",style:{...E,color:"#28a745"},children:X.estimatedValue?`${parseFloat(X.estimatedValue).toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})} `:"  "})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:" :"}),t.jsx("span",{className:"info-value",style:E,children:(()=>{const k=X.submissionDeadline;if(!k)return" ";try{return new Date(k).toLocaleDateString("ar-SA",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return k}})()})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:`badge ${X.status==="active"?"bg-success":"bg-secondary"}`,style:{fontSize:"10px"},children:X.status==="active"?"":" "})]}),X.description&&t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value",style:{...E,fontSize:"12px",color:"#6c757d",lineHeight:"1.4"},children:X.description.length>80?`${X.description.substring(0,80)}...`:X.description})]}),X.internalId&&t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:" :"}),t.jsx("span",{className:"info-value",style:{...E,color:"#6c757d",fontFamily:"monospace",fontSize:"11px"},children:X.internalId})]}),X.createdAt&&t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:" :"}),t.jsx("span",{className:"info-value",style:{...E,color:"#6c757d",fontSize:"12px"},children:(()=>{var k;try{let b;if((k=X.createdAt)!=null&&k.toDate)b=X.createdAt.toDate();else if(X.createdAt)b=new Date(X.createdAt);else return" ";return b.toLocaleDateString("ar-SA",{year:"numeric",month:"short",day:"numeric"})}catch{return" "}})()})]})]}),(X.originalCollection==="suppliers"||X.originalCollection==="foreignSuppliers"||X.originalCollection==="customers")&&t.jsxs("div",{className:"info-grid",children:[t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value",style:E,children:Y.email})]}),t.jsxs("div",{className:"info-item mb-2",children:[t.jsx("span",{className:"info-label",style:O,children:":"}),t.jsx("span",{className:"info-value",style:{...E,direction:"ltr"},children:Y.phone})]})]})]})]}),t.jsx("div",{className:"card-footer bg-white border-top",children:t.jsxs("div",{className:"d-flex justify-content-center gap-3",children:[t.jsx(Tt,{can:"trash:restore",mode:"disable",children:t.jsx("button",{className:"btn btn-success",onClick:()=>te(X.id,Y.displayName),disabled:c===X.id,title:"",style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",border:"none",color:"white"},children:c===X.id?t.jsx("span",{className:"spinner-border spinner-border-sm",style:{width:"12px",height:"12px"}}):""})}),t.jsx(Tt,{can:"trash:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-danger",onClick:()=>G(X.id,Y.displayName),disabled:c===X.id,title:" ",style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",border:"none",color:"white"},children:c===X.id?t.jsx("span",{className:"spinner-border spinner-border-sm",style:{width:"12px",height:"12px"}}):""})})]})})]})},X.id)})}),s.length>0&&t.jsx(dr,{currentPage:x,totalPages:S,onPageChange:Q,totalItems:B,itemsPerPage:$})]})})]}),t.jsx(Mt,{show:L.show,onClose:R,title:L.title,message:L.message,type:L.type,onConfirm:L.onConfirm,confirmText:L.confirmText,cancelText:L.cancelText,showCancel:L.showCancel})]})};function X6(){const[n,e]=h.useState(!1),{isTimelineVisible:s}=Ut(),r=()=>{e(!n)};return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:r}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!s?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{style:{position:"sticky",top:0,zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})})}),t.jsxs("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:[t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"60px"},children:t.jsx(J6,{})}),t.jsx("div",{className:"app-footer",style:{textAlign:"center",padding:"20px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",marginTop:"20px"},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]})]}),!n&&s&&t.jsx(os,{rtl:!0}),!n&&s&&t.jsx(ls,{})]})})})}function Z6(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(X6,{})})})}const ez=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>Go),void 0)),tz=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>Wo),void 0)),J1=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>fi),void 0).then(n=>({default:n.ActivityProvider}))),X1=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>fi),void 0).then(n=>({default:n.AutoActivityTracker}))),sz=h.lazy(()=>Xe(()=>Promise.resolve().then(()=>E1),void 0));function nz(){kt();const{logActivity:n,getCurrentUser:e}=Zt(),{alertConfig:s,closeAlert:r,showSuccess:i,showError:a,showConfirm:o}=Bt(),{isTimelineVisible:l}=Ut(),{hasPerm:c,readOnly:d,timerSettingsDisabled:u}=Yn(),f=c("settings:update"),p=d||!f,[j,L]=h.useState(!1),[R,D]=h.useState(!0),[y,T]=h.useState([]),[x,S]=h.useState([]),[A,Q]=h.useState([]),[q,B]=h.useState([]),[$,H]=h.useState("categories");h.useEffect(()=>{$==="timerSettings"&&u&&H("categories")},[$,u]);const[te,G]=h.useState({name:"",description:""}),[F,X]=h.useState(null),[ue,Y]=h.useState({name:"",description:""}),[z,O]=h.useState(null),[E,k]=h.useState({name:"",description:""}),[b,N]=h.useState(null),[I,P]=h.useState({name:"",description:"",region:""}),[_,C]=h.useState(null),[U,w]=h.useState({resetTime:"09:00",snapshotTime:"18:00",enableAutoReset:!0,enableSnapshot:!0}),[W,ie]=h.useState(!1),de=h.useCallback(async()=>{try{D(!0),await Ws.initializeDefaultSettings();const[Oe,it,Kt,zs]=await Promise.all([Ws.getAllCategories(),Ws.getAllUnits(),Ws.getAllServiceTypes(),Ws.getAllCities()]);T(Oe),S(it),Q(Kt),B(zs);try{const xs=localStorage.getItem("timer_scheduler_settings");if(xs){const cs=JSON.parse(xs);w({resetTime:cs.resetTime||"09:00",snapshotTime:cs.snapshotTime||"18:00",enableAutoReset:cs.enableAutoReset!==!1,enableSnapshot:cs.enableSnapshot!==!1}),console.log(" TIMER SETTINGS: Loaded from localStorage",cs)}}catch(xs){console.warn(" TIMER SETTINGS: Failed to load, using defaults",xs)}}catch(Oe){console.error("Error loading settings:",Oe),a&&a("   ","  ")}finally{D(!1)}},[]);h.useEffect(()=>{de()},[]);const ne=h.useCallback(()=>{L(Oe=>!Oe)},[]);h.useMemo(()=>y.length+x.length+A.length+q.length,[y.length,x.length,A.length,q.length]);const ye=async Oe=>{if(Oe.preventDefault(),!te.name.trim()){a("  "," ");return}try{ie(!0);const it=e();F?(await Ws.updateCategory(F,te),n("task",`${it.name}  `,`  : ${te.name}`),i("   "," "),X(null)):(await Ws.createCategory(te),n("task",`${it.name}   `,`  : ${te.name}`),i("   "," ")),G({name:"",description:""}),de()}catch(it){a(it.message,"")}finally{ie(!1)}},pe=Oe=>{G({name:Oe.name,description:Oe.description||""}),X(Oe.id)},be=Oe=>{o(`      "${Oe.name}"
     !`,async()=>{try{ie(!0),await Ws.deleteCategory(Oe.id);const it=e();n("task",`${it.name}  `,`  : ${Oe.name}`),i("   "," "),de()}catch(it){a(it.message,"  ")}finally{ie(!1)}}," ")},xe=()=>{G({name:"",description:""}),X(null)},Ee=async Oe=>{if(Oe.preventDefault(),!ue.name.trim()){a("  "," ");return}try{ie(!0);const it=e();z?(await Ws.updateUnit(z,ue),n("task",`${it.name}  `,`  : ${ue.name}`),i("   "," "),O(null)):(await Ws.createUnit(ue),n("task",`${it.name}   `,`  : ${ue.name}`),i("   "," ")),Y({name:"",description:""}),de()}catch(it){a(it.message,"")}finally{ie(!1)}},Re=Oe=>{Y({name:Oe.name,description:Oe.description||""}),O(Oe.id)},fe=Oe=>{o(`      "${Oe.name}"
     !`,async()=>{try{ie(!0),await Ws.deleteUnit(Oe.id);const it=e();n("task",`${it.name}  `,`  : ${Oe.name}`),i("   "," "),de()}catch(it){a(it.message,"  ")}finally{ie(!1)}}," ")},Ve=()=>{Y({name:"",description:""}),O(null)},$e=async Oe=>{if(Oe.preventDefault(),!E.name.trim()){a("   "," ");return}try{ie(!0);const it=e();b?(await Ws.updateServiceType(b,E),n("task",`${it.name}   `,`   : ${E.name}`),i("    "," "),N(null)):(await Ws.createServiceType(E),n("task",`${it.name}    `,`   : ${E.name}`),i("    "," ")),k({name:"",description:""}),de()}catch(it){a(it.message,"")}finally{ie(!1)}},et=Oe=>{k({name:Oe.name,description:Oe.description||""}),N(Oe.id)},ze=Oe=>{o(`       "${Oe.name}"\\n     !`,async()=>{try{ie(!0),await Ws.deleteServiceType(Oe.id);const it=e();n("task",`${it.name}   `,`   : ${Oe.name}`),i("    "," "),de()}catch(it){a(it.message,"  ")}finally{ie(!1)}}," ")},tt=()=>{k({name:"",description:""}),N(null)},rt=async Oe=>{if(Oe.preventDefault(),!I.name.trim()){a("  "," ");return}try{ie(!0);const it=e();_?(await Ws.updateCity(_,I),n("task",`${it.name}  `,`  : ${I.name}`),i("   "," "),C(null)):(await Ws.createCity(I),n("task",`${it.name}   `,`  : ${I.name}`),i("   "," ")),P({name:"",description:"",region:""}),de()}catch(it){a(it.message,"")}finally{ie(!1)}},bt=Oe=>{P({name:Oe.name,description:Oe.description||"",region:Oe.region||""}),C(Oe.id)},At=Oe=>{o(`      "${Oe.name}"\\n     !`,async()=>{try{ie(!0),await Ws.deleteCity(Oe.id);const it=e();n("task",`${it.name}  `,`  : ${Oe.name}`),i("   "," "),de()}catch(it){a(it.message,"  ")}finally{ie(!1)}}," ")},ns=()=>{P({name:"",description:"",region:""}),C(null)},Ht=async Oe=>{Oe.preventDefault();try{ie(!0);const it=e(),Kt=/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/;if(!Kt.test(U.resetTime)||!Kt.test(U.snapshotTime)){a("   .   HH:MM","  ");return}localStorage.setItem("timer_scheduler_settings",JSON.stringify({...U,lastUpdated:new Date().toISOString(),updatedBy:it.name})),n("task",`${it.name}   `,` : ${U.resetTime}  : ${U.snapshotTime}`),i("    "," "),window.dispatchEvent(new CustomEvent("timerSettingsUpdated",{detail:U}))}catch(it){a(it.message,"  ")}finally{ie(!1)}},is=()=>{o("         ",()=>{w({resetTime:"09:00",snapshotTime:"18:00",enableAutoReset:!0,enableSnapshot:!0}),i("     "," ")},"  ")};return R?t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"100vh"},children:t.jsx(It,{show:!0,message:"  ..."})}):t.jsx(J1,{children:t.jsxs(X1,{children:[t.jsxs("div",{className:`page-wrapper ${j?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:ne}),t.jsxs("div",{className:"main-container",style:{paddingRight:j?"72px":"250px",paddingLeft:j||!l?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:j?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:j})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"app-content-area p-4",children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsx("div",{className:"d-flex justify-content-between align-items-center",children:t.jsx("div",{className:"d-flex align-items-center",children:t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-gear-wide-connected text-primary me-2"})," "]})})})}),t.jsxs("div",{className:"card-body p-0",children:[t.jsxs("ul",{className:"nav nav-tabs border-bottom-0",id:"settingsTabs",role:"tablist",children:[t.jsx("li",{className:"nav-item",role:"presentation",children:t.jsxs("button",{className:`nav-link ${$==="categories"?"active":""}`,onClick:()=>H("categories"),type:"button",style:{borderRadius:"0",borderBottom:$==="categories"?"3px solid #007bff":"1px solid #dee2e6",fontWeight:"500"},children:[t.jsx("i",{className:"bi bi-tags me-2"})," "]})}),t.jsx("li",{className:"nav-item",role:"presentation",children:t.jsxs("button",{className:`nav-link ${$==="units"?"active":""}`,onClick:()=>H("units"),type:"button",style:{borderRadius:"0",borderBottom:$==="units"?"3px solid #007bff":"1px solid #dee2e6",fontWeight:"500"},children:[t.jsx("i",{className:"bi bi-rulers me-2"})," "]})}),t.jsx("li",{className:"nav-item",role:"presentation",children:t.jsxs("button",{className:`nav-link ${$==="serviceTypes"?"active":""}`,onClick:()=>H("serviceTypes"),type:"button",style:{borderRadius:"0",borderBottom:$==="serviceTypes"?"3px solid #007bff":"1px solid #dee2e6",fontWeight:"500"},children:[t.jsx("i",{className:"bi bi-briefcase me-2"})," "]})}),t.jsx("li",{className:"nav-item",role:"presentation",children:t.jsxs("button",{className:`nav-link ${$==="cities"?"active":""}`,onClick:()=>H("cities"),type:"button",style:{borderRadius:"0",borderBottom:$==="cities"?"3px solid #007bff":"1px solid #dee2e6",fontWeight:"500"},children:[t.jsx("i",{className:"bi bi-geo-alt me-2"}),""]})}),!u&&t.jsx("li",{className:"nav-item",role:"presentation",children:t.jsxs("button",{className:`nav-link ${$==="timerSettings"?"active":""}`,onClick:()=>H("timerSettings"),type:"button",style:{borderRadius:"0",borderBottom:$==="timerSettings"?"3px solid #007bff":"1px solid #dee2e6",fontWeight:"500"},children:[t.jsx("i",{className:"bi bi-clock-history me-2"})," "]})})]}),t.jsxs("div",{className:"tab-content p-4",children:[$==="categories"&&t.jsx("div",{className:"tab-pane fade show active",children:t.jsxs("div",{className:"row",children:[t.jsx("div",{className:"col-md-4",children:t.jsxs("div",{className:"card bg-light",children:[t.jsx("div",{className:"card-header",children:t.jsxs("h6",{className:"mb-0",children:[t.jsx("i",{className:"bi bi-plus-circle me-2"}),F?" ":"  "]})}),t.jsxs("div",{className:"card-body",children:[p&&t.jsx("div",{className:"alert alert-info border-0 shadow-sm mb-4",children:t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-info-circle-fill text-info me-3 fs-6"}),t.jsxs("div",{children:[t.jsx("strong",{className:"fw-bold",children:"  "}),t.jsx("div",{className:"mt-1",children:t.jsxs("span",{className:"ms-2",children:[!f&&"     ",d&&"     "]})})]})]})}),t.jsxs("form",{onSubmit:ye,children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"text",className:"form-control",value:te.name,onChange:Oe=>G({...te,name:Oe.target.value}),placeholder:"  ",required:!0,readOnly:p})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:""}),t.jsx("textarea",{className:"form-control",rows:"2",value:te.description,onChange:Oe=>G({...te,description:Oe.target.value}),placeholder:"  ",readOnly:p})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsxs("button",{type:"submit",className:"btn btn-primary flex-fill",disabled:W||p,style:{height:"32px",fontSize:"14px"},children:[W?t.jsx("span",{className:"spinner-border spinner-border-sm me-2"}):t.jsx("i",{className:`bi ${F?"bi-check-lg":"bi-plus-lg"} me-2`}),F?"":""]}),F&&t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:xe,style:{height:"32px",fontSize:"14px"},children:""})]})]})]})]})}),t.jsx("div",{className:"col-md-8",children:t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header",children:t.jsxs("h6",{className:"mb-0",children:[t.jsx("i",{className:"bi bi-list me-2"}),"  (",y.length,")"]})}),t.jsx("div",{className:"card-body p-0",children:t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{children:" "}),t.jsx("th",{children:""}),t.jsx("th",{style:{width:"100px"},children:""})]})}),t.jsx("tbody",{children:y.length===0?t.jsx("tr",{children:t.jsxs("td",{colSpan:"3",className:"text-center py-4 text-muted",children:[t.jsx("i",{className:"bi bi-inbox fs-1 d-block mb-2"}),"   "]})}):y.map(Oe=>t.jsxs("tr",{children:[t.jsx("td",{children:t.jsx("strong",{children:Oe.name})}),t.jsx("td",{children:t.jsx("small",{className:"text-muted",children:Oe.description||"  "})}),t.jsx("td",{children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(Tt,{can:"settings:update",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-primary",onClick:()=>pe(Oe),title:"",children:t.jsx("i",{className:"bi bi-pencil"})})}),t.jsx(Tt,{can:"settings:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>be(Oe),title:"",children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},Oe.id))})]})})})]})})]})}),$==="units"&&t.jsx("div",{className:"tab-pane fade show active",children:t.jsxs("div",{className:"row",children:[t.jsx("div",{className:"col-md-4",children:t.jsxs("div",{className:"card bg-light",children:[t.jsx("div",{className:"card-header",children:t.jsxs("h6",{className:"mb-0",children:[t.jsx("i",{className:"bi bi-plus-circle me-2"}),z?" ":"  "]})}),t.jsx("div",{className:"card-body",children:t.jsxs("form",{onSubmit:Ee,children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"text",className:"form-control",value:ue.name,onChange:Oe=>Y({...ue,name:Oe.target.value}),placeholder:":   ",required:!0,readOnly:p})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:""}),t.jsx("textarea",{className:"form-control",rows:"2",value:ue.description,onChange:Oe=>Y({...ue,description:Oe.target.value}),placeholder:"  ",readOnly:p})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsxs("button",{type:"submit",className:"btn btn-primary flex-fill",disabled:W||p,style:{height:"32px",fontSize:"14px"},children:[W?t.jsx("span",{className:"spinner-border spinner-border-sm me-2"}):t.jsx("i",{className:`bi ${z?"bi-check-lg":"bi-plus-lg"} me-2`}),z?"":""]}),z&&t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:Ve,style:{height:"32px",fontSize:"14px"},children:""})]})]})})]})}),t.jsx("div",{className:"col-md-8",children:t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header",children:t.jsxs("h6",{className:"mb-0",children:[t.jsx("i",{className:"bi bi-list me-2"}),"  (",x.length,")"]})}),t.jsx("div",{className:"card-body p-0",children:t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{children:" "}),t.jsx("th",{children:""}),t.jsx("th",{style:{width:"100px"},children:""})]})}),t.jsx("tbody",{children:x.length===0?t.jsx("tr",{children:t.jsxs("td",{colSpan:"3",className:"text-center py-4 text-muted",children:[t.jsx("i",{className:"bi bi-inbox fs-1 d-block mb-2"}),"   "]})}):x.map(Oe=>t.jsxs("tr",{children:[t.jsx("td",{children:t.jsx("strong",{children:Oe.name})}),t.jsx("td",{children:t.jsx("small",{className:"text-muted",children:Oe.description||"  "})}),t.jsx("td",{children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(Tt,{can:"settings:update",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-primary",onClick:()=>Re(Oe),title:"",children:t.jsx("i",{className:"bi bi-pencil"})})}),t.jsx(Tt,{can:"settings:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>fe(Oe),title:"",children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},Oe.id))})]})})})]})})]})}),$==="serviceTypes"&&t.jsx("div",{className:"tab-pane fade show active",children:t.jsxs("div",{className:"row",children:[t.jsx("div",{className:"col-md-4",children:t.jsxs("div",{className:"card bg-light",children:[t.jsx("div",{className:"card-header",children:t.jsxs("h6",{className:"mb-0",children:[t.jsx("i",{className:"bi bi-plus-circle me-2"}),b?"  ":"   "]})}),t.jsx("div",{className:"card-body",children:t.jsxs("form",{onSubmit:$e,children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:"   *"}),t.jsx("input",{type:"text",className:"form-control",value:E.name,onChange:Oe=>k({...E,name:Oe.target.value}),placeholder:":  ",required:!0,readOnly:p})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:""}),t.jsx("textarea",{className:"form-control",rows:"2",value:E.description,onChange:Oe=>k({...E,description:Oe.target.value}),placeholder:"  ...",readOnly:p})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("button",{type:"submit",className:"btn btn-primary",disabled:W||p,style:{width:"80px",height:"32px"},children:W?t.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:t.jsx("span",{className:"visually-hidden",children:"Loading..."})}):b?"":""}),b&&t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:tt,style:{width:"80px",height:"32px"},children:""})]})]})})]})}),t.jsx("div",{className:"col-md-8",children:t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header",children:t.jsxs("h6",{className:"mb-0",children:[t.jsx("i",{className:"bi bi-briefcase me-2"}),"  (",A.length,")"]})}),t.jsx("div",{className:"card-body p-0",children:t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-striped table-hover mb-0",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{width:"30%",children:""}),t.jsx("th",{width:"50%",children:""}),t.jsx("th",{width:"20%",className:"text-center",children:""})]})}),t.jsx("tbody",{children:A.length===0?t.jsx("tr",{children:t.jsxs("td",{colSpan:"3",className:"text-center text-muted py-4",children:[t.jsx("i",{className:"bi bi-briefcase-fill fs-1 d-block mb-2 opacity-50"}),"   "]})}):A.map(Oe=>t.jsxs("tr",{children:[t.jsxs("td",{children:[t.jsx("span",{className:"fw-bold",children:Oe.name}),Oe.isDefault&&t.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:""})]}),t.jsx("td",{children:Oe.description||"-"}),t.jsx("td",{children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(Tt,{can:"settings:update",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-primary",onClick:()=>et(Oe),title:"",children:t.jsx("i",{className:"bi bi-pencil"})})}),t.jsx(Tt,{can:"settings:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>ze(Oe),title:"",children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},Oe.id))})]})})})]})})]})}),$==="cities"&&t.jsx("div",{className:"tab-pane fade show active",children:t.jsxs("div",{className:"row",children:[t.jsx("div",{className:"col-md-4",children:t.jsxs("div",{className:"card bg-light",children:[t.jsx("div",{className:"card-header",children:t.jsxs("h6",{className:"mb-0",children:[t.jsx("i",{className:"bi bi-plus-circle me-2"}),_?" ":"  "]})}),t.jsx("div",{className:"card-body",children:t.jsxs("form",{onSubmit:rt,children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"text",className:"form-control",value:I.name,onChange:Oe=>P({...I,name:Oe.target.value}),placeholder:": ",required:!0,readOnly:p})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:""}),t.jsx("input",{type:"text",className:"form-control",value:I.region,onChange:Oe=>P({...I,region:Oe.target.value}),placeholder:":  ",readOnly:p})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:""}),t.jsx("textarea",{className:"form-control",rows:"2",value:I.description,onChange:Oe=>P({...I,description:Oe.target.value}),placeholder:" ...",readOnly:p})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("button",{type:"submit",className:"btn btn-primary",disabled:W||p,style:{width:"80px",height:"32px"},children:W?t.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:t.jsx("span",{className:"visually-hidden",children:"Loading..."})}):_?"":""}),_&&t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:ns,style:{width:"80px",height:"32px"},children:""})]})]})})]})}),t.jsx("div",{className:"col-md-8",children:t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header",children:t.jsxs("h6",{className:"mb-0",children:[t.jsx("i",{className:"bi bi-geo-alt me-2"})," (",q.length,")"]})}),t.jsx("div",{className:"card-body p-0",children:t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-striped table-hover mb-0",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{width:"25%",children:""}),t.jsx("th",{width:"25%",children:""}),t.jsx("th",{width:"35%",children:""}),t.jsx("th",{width:"15%",className:"text-center",children:""})]})}),t.jsx("tbody",{children:q.length===0?t.jsx("tr",{children:t.jsxs("td",{colSpan:"4",className:"text-center text-muted py-4",children:[t.jsx("i",{className:"bi bi-geo-alt-fill fs-1 d-block mb-2 opacity-50"}),"  "]})}):q.map(Oe=>t.jsxs("tr",{children:[t.jsxs("td",{children:[t.jsx("span",{className:"fw-bold",children:Oe.name}),Oe.isDefault&&t.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:""})]}),t.jsx("td",{children:Oe.region||"-"}),t.jsx("td",{children:Oe.description||"-"}),t.jsx("td",{children:t.jsxs("div",{className:"btn-group btn-group-sm",children:[t.jsx(Tt,{can:"settings:update",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-primary",onClick:()=>bt(Oe),title:"",children:t.jsx("i",{className:"bi bi-pencil"})})}),t.jsx(Tt,{can:"settings:delete",mode:"disable",children:t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>At(Oe),title:"",children:t.jsx("i",{className:"bi bi-trash"})})})]})})]},Oe.id))})]})})})]})})]})}),$==="timerSettings"&&!u&&t.jsx("div",{className:"tab-pane fade show active",children:t.jsxs("div",{className:"row",children:[t.jsx("div",{className:"col-md-6",children:t.jsxs("div",{className:"card bg-light",children:[t.jsx("div",{className:"card-header",children:t.jsxs("h6",{className:"mb-0",children:[t.jsx("i",{className:"bi bi-gear-wide-connected me-2"}),"  "]})}),t.jsxs("div",{className:"card-body",children:[p&&t.jsx("div",{className:"alert alert-info border-0 shadow-sm mb-4",children:t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-info-circle-fill text-info me-3 fs-6"}),t.jsxs("div",{children:[t.jsx("strong",{className:"fw-bold",children:"  "}),t.jsx("div",{className:"mt-1",children:t.jsx("span",{className:"ms-2",children:"        "})})]})]})}),t.jsxs("form",{onSubmit:Ht,children:[t.jsxs("div",{className:"card mb-4",children:[t.jsx("div",{className:"card-header py-2 bg-primary text-white",children:t.jsxs("h6",{className:"mb-0",children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"   "]})}),t.jsx("div",{className:"card-body",children:t.jsxs("div",{className:"row align-items-center",children:[t.jsxs("div",{className:"col-md-4",children:[t.jsx("label",{className:"form-label fw-bold",children:"  "}),t.jsx("input",{type:"time",className:"form-control",value:U.resetTime,onChange:Oe=>w({...U,resetTime:Oe.target.value}),readOnly:p,style:{fontSize:"14px",fontWeight:"500",textAlign:"center"}}),t.jsx("small",{className:"text-muted",children:" 24 "})]}),t.jsxs("div",{className:"col-md-5",children:[t.jsxs("div",{className:"form-check",children:[t.jsx("input",{className:"form-check-input",type:"checkbox",id:"enableAutoReset",checked:U.enableAutoReset,onChange:Oe=>w({...U,enableAutoReset:Oe.target.checked}),disabled:p}),t.jsx("label",{className:"form-check-label fw-bold",htmlFor:"enableAutoReset",children:"   "})]}),t.jsx("small",{className:"text-muted",children:"        "})]}),t.jsx("div",{className:"col-md-3 text-center",children:t.jsxs("div",{className:"badge bg-success px-3 py-2 fs-6",children:[t.jsx("i",{className:"bi bi-clock me-1"}),U.resetTime]})})]})})]}),t.jsxs("div",{className:"card mb-4",children:[t.jsx("div",{className:"card-header py-2 bg-info text-white",children:t.jsxs("h6",{className:"mb-0",children:[t.jsx("i",{className:"bi bi-camera me-2"}),"  "]})}),t.jsx("div",{className:"card-body",children:t.jsxs("div",{className:"row align-items-center",children:[t.jsxs("div",{className:"col-md-4",children:[t.jsx("label",{className:"form-label fw-bold",children:"   "}),t.jsx("input",{type:"time",className:"form-control",value:U.snapshotTime,onChange:Oe=>w({...U,snapshotTime:Oe.target.value}),readOnly:p,style:{fontSize:"14px",fontWeight:"500",textAlign:"center"}}),t.jsx("small",{className:"text-muted",children:" 24 "})]}),t.jsxs("div",{className:"col-md-5",children:[t.jsxs("div",{className:"form-check",children:[t.jsx("input",{className:"form-check-input",type:"checkbox",id:"enableSnapshot",checked:U.enableSnapshot,onChange:Oe=>w({...U,enableSnapshot:Oe.target.checked}),disabled:p}),t.jsx("label",{className:"form-check-label fw-bold",htmlFor:"enableSnapshot",children:"  "})]}),t.jsx("small",{className:"text-muted",children:"        "})]}),t.jsx("div",{className:"col-md-3 text-center",children:t.jsxs("div",{className:"badge bg-info px-3 py-2 fs-6",children:[t.jsx("i",{className:"bi bi-camera me-1"}),U.snapshotTime]})})]})})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsxs("button",{type:"submit",className:"btn btn-success flex-fill",disabled:W||p,style:{height:"40px",fontWeight:"600"},children:[W?t.jsx("span",{className:"spinner-border spinner-border-sm me-2"}):t.jsx("i",{className:"bi bi-check-lg me-2"})," "]}),t.jsxs("button",{type:"button",className:"btn btn-outline-secondary",onClick:is,disabled:W||p,style:{height:"40px",minWidth:"120px"},children:[t.jsx("i",{className:"bi bi-arrow-repeat me-2"})," "]})]})]})]})]})}),t.jsx("div",{className:"col-md-6",children:t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header",children:t.jsxs("h6",{className:"mb-0",children:[t.jsx("i",{className:"bi bi-info-circle me-2"}),"  "]})}),t.jsxs("div",{className:"card-body",children:[t.jsxs("div",{className:"alert alert-light border-0 mb-4",children:[t.jsxs("h6",{className:"fw-bold text-primary mb-3",children:[t.jsx("i",{className:"bi bi-lightbulb me-2"}),"   "]}),t.jsxs("ul",{className:"list-unstyled mb-0",children:[t.jsxs("li",{className:"mb-2",children:[t.jsx("i",{className:"bi bi-arrow-clockwise text-success me-2"}),t.jsx("strong",{children:" :"}),"         "]}),t.jsxs("li",{className:"mb-2",children:[t.jsx("i",{className:"bi bi-camera text-info me-2"}),t.jsx("strong",{children:" :"}),"        "]}),t.jsxs("li",{className:"mb-2",children:[t.jsx("i",{className:"bi bi-shield-check text-warning me-2"}),t.jsx("strong",{children:":"}),"       "]}),t.jsxs("li",{children:[t.jsx("i",{className:"bi bi-cloud-check text-primary me-2"}),t.jsx("strong",{children:":"}),"    Firebase   "]})]})]}),t.jsxs("div",{className:"row text-center",children:[t.jsx("div",{className:"col-6",children:t.jsx("div",{className:"card bg-success text-white",children:t.jsxs("div",{className:"card-body py-3",children:[t.jsx("i",{className:"bi bi-sunrise fs-2 mb-2"}),t.jsx("h6",{className:"fw-bold mb-1",children:" "}),t.jsx("h4",{className:"mb-0",children:U.resetTime}),t.jsx("small",{children:U.enableAutoReset?"":""})]})})}),t.jsx("div",{className:"col-6",children:t.jsx("div",{className:"card bg-info text-white",children:t.jsxs("div",{className:"card-body py-3",children:[t.jsx("i",{className:"bi bi-sunset fs-2 mb-2"}),t.jsx("h6",{className:"fw-bold mb-1",children:" "}),t.jsx("h4",{className:"mb-0",children:U.snapshotTime}),t.jsx("small",{children:U.enableSnapshot?"":""})]})})})]})]})]})})]})})]})]})]})})})]}),!j&&l&&t.jsx(ez,{rtl:!0}),!j&&l&&t.jsx(tz,{})]})]}),t.jsx(sz,{show:s.show,onClose:r,title:s.title,message:s.message,type:s.type,onConfirm:s.onConfirm,confirmText:s.confirmText,cancelText:s.cancelText,showCancel:s.showCancel})]})})}function rz(){return t.jsx(h.Suspense,{fallback:t.jsx(It,{show:!0,message:"   ...",overlay:!0}),children:t.jsx(J1,{children:t.jsx(X1,{children:t.jsx(nz,{})})})})}function iz(){const{employeeData:n,currentUser:e}=Bo(),[s,r]=h.useState([]),[i,a]=h.useState(!0),[o,l]=h.useState(null),[c,d]=h.useState(0),u=h.useRef(null);h.useEffect(()=>((()=>{try{if(u.current&&(u.current(),u.current=null),!e||!ae){r([]),a(!1);return}a(!0),l(null);const S=Pe(ae,"time_tracking_snapshots"),A=st(S,xt("employeeId","==",e.uid));u.current=ar(A,Q=>{try{const q=[];Q.forEach($=>{var te,G,F,X;const H=$.data();q.push({id:$.id,...H,snapshotTime:((G=(te=H.snapshotTime)==null?void 0:te.toDate)==null?void 0:G.call(te))||new Date((X=(F=H.createdAt)==null?void 0:F.toDate)==null?void 0:X.call(F))||new Date})}),q.sort(($,H)=>H.snapshotTime.getTime()-$.snapshotTime.getTime());const B=q.slice(0,50);r(B),a(!1),console.log(` SNAPSHOTS REALTIME: Updated with ${B.length} snapshots`)}catch(q){console.error(" SNAPSHOTS REALTIME: Process error:",q),l("     "),a(!1)}},Q=>{console.error(" SNAPSHOTS REALTIME: Listener error:",Q),l("    "),a(!1)}),console.log(" SNAPSHOTS: Real-time listener setup for user:",e.uid)}catch(S){console.error(" SNAPSHOTS: Setup listener error:",S),l("    "),a(!1)}})(),()=>{u.current&&(u.current(),u.current=null)}),[e,c]);const f=()=>{d(x=>x+1)},p=()=>new Date().getDay()===5,j=x=>{if(!x)return"";const S=new Date(x),A=String(S.getDate()).padStart(2,"0"),Q=String(S.getMonth()+1).padStart(2,"0"),q=S.getFullYear();return`${A}/${Q}/${q}`},L=x=>x?new Date(x).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"",R=x=>x?(x.toDate?x.toDate():new Date(x)).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"",D=x=>{switch(x){case"active":return"bg-success";default:return"bg-secondary"}},y=x=>{switch(x){case"active":return"";default:return" "}},T=x=>{if(!x)return"00:00";if(typeof x=="string"&&x.includes(":")){const S=x.split(":");return`${S[0]}:${S[1]}`}return x};return i?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx(It,{size:"large"}),t.jsx("p",{className:"text-muted mt-3",children:"    ..."})]})}):o?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("i",{className:"bi bi-exclamation-triangle text-warning fs-1 mb-3"}),t.jsx("p",{className:"text-danger",children:o}),t.jsxs("button",{className:"btn btn-primary",onClick:f,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):t.jsxs("div",{className:"card shadow-sm",style:{height:"calc(100vh - 140px)",display:"flex",flexDirection:"column"},children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:10,backgroundColor:"white",borderBottom:"1px solid #e9ecef",flexShrink:0},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsx("div",{className:"d-flex align-items-center",children:t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-graph-up-arrow text-primary me-2"}),"   ",(n==null?void 0:n.fullName)||(e==null?void 0:e.displayName)||(e==null?void 0:e.name)||"",p()&&t.jsx("span",{className:"badge bg-warning ms-2",children:""})]})}),t.jsx("div",{className:"d-flex gap-2"})]})}),t.jsx("div",{className:"card-body p-0",style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:s.length===0?t.jsxs("div",{className:"text-center py-5",style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[t.jsx("i",{className:"bi bi-camera text-muted fs-1 mb-3"}),t.jsx("p",{className:"text-muted",children:"     "}),t.jsx("p",{className:"text-muted small",children:"       18:40"})]}):t.jsx("div",{className:"table-responsive",style:{flex:1,overflow:"auto"},children:t.jsxs("table",{className:"table table-striped table-hover mb-0",children:[t.jsx("thead",{className:"table-light",style:{position:"sticky",top:0,zIndex:5,backgroundColor:"#f8f9fa"},children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"text-center",style:{width:"50px"},children:""}),t.jsx("th",{scope:"col",className:"text-center",style:{width:"120px"},children:""}),t.jsx("th",{scope:"col",className:"text-center",style:{width:"140px"},children:" "}),t.jsx("th",{scope:"col",className:"text-center",style:{width:"100px"},children:" "}),t.jsx("th",{scope:"col",className:"text-center",style:{width:"120px"},children:" "}),t.jsx("th",{scope:"col",className:"text-center",style:{width:"80px"},children:""}),t.jsx("th",{scope:"col",className:"text-center",style:{width:"140px"},children:" "})]})}),t.jsx("tbody",{children:s.map((x,S)=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-center fw-bold text-primary py-3",style:{fontSize:"1.1rem"},children:S+1}),t.jsx("td",{className:"text-center py-3",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:"bi bi-calendar3 text-primary me-2",style:{fontSize:"1rem"}}),t.jsx("span",{className:"fw-medium",style:{fontSize:"0.95rem",color:"#495057"},children:j(x.date)})]})}),t.jsx("td",{className:"text-center py-3",children:new Date(x.date).getDay()===5?t.jsx("span",{className:"badge bg-warning",style:{fontSize:"0.9rem"},children:""}):t.jsxs("div",{className:"d-flex flex-column align-items-center",children:[t.jsx("div",{className:"progress mb-2",style:{width:"90px",height:"8px",backgroundColor:"#e9ecef"},children:t.jsx("div",{className:`progress-bar ${x.percentage>=100?"bg-success":x.percentage>=75?"bg-primary":x.percentage>=50?"bg-warning":"bg-danger"}`,role:"progressbar",style:{width:`${Math.min(100,x.percentage)}%`,background:x.percentage>=100?"#28a745":x.percentage>=75?"#007bff":x.percentage>=50?"#ffc107":"#dc3545"}})}),t.jsxs("span",{className:"fw-bold",style:{fontSize:"0.9rem",color:"#495057"},children:[x.percentage,"%"]})]})}),t.jsx("td",{className:"text-center py-3",children:t.jsx("span",{className:"fw-bold",style:{color:"#dc3545",fontSize:"1rem",fontFamily:"monospace"},children:new Date(x.date).getDay()===5?"00:00":T(x.duration)})}),t.jsx("td",{className:"text-center py-3",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:"bi bi-play-circle text-success me-2",style:{fontSize:"1rem"}}),t.jsx("span",{className:"fw-medium",style:{fontSize:"0.9rem",color:"#495057",direction:"ltr",fontFamily:"monospace"},children:new Date(x.date).getDay()===5?"00:00":R(x.sessionStart)})]})}),t.jsx("td",{className:"text-center py-3",children:t.jsx("span",{className:`badge ${new Date(x.date).getDay()===5?"bg-warning":D(x.status)} px-2 py-1`,style:{fontSize:"0.75rem",fontWeight:"500"},children:new Date(x.date).getDay()===5?"":y(x.status)})}),t.jsx("td",{className:"text-center py-3",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:"bi bi-camera text-info me-2",style:{fontSize:"1rem"}}),t.jsx("span",{className:"fw-medium",style:{fontSize:"0.9rem",color:"#495057",direction:"ltr",fontFamily:"monospace"},children:new Date(x.date).getDay()===5?"00:00":L(x.snapshotTime)})]})})]},x.id))})]})})}),s.length>0&&t.jsx("div",{className:"card-footer bg-light text-muted",style:{flexShrink:0},children:t.jsxs("div",{className:"row",children:[t.jsx("div",{className:"col-md-6",children:t.jsxs("small",{children:[t.jsx("i",{className:"bi bi-info-circle me-1"}),"       18:40"]})}),t.jsx("div",{className:"col-md-6 text-end",children:t.jsxs("small",{children:[t.jsx("i",{className:"bi bi-clock-history me-1"})," : ",new Date().toLocaleString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})]})})]})})]})}function az({employeeId:n,employeeName:e}){kt();const[s,r]=h.useState([]),[i,a]=h.useState(!0),[o,l]=h.useState(null),[c,d]=h.useState(0),u=h.useRef(null),{alertConfig:f,closeAlert:p}=Bt();h.useEffect(()=>((()=>{try{if(u.current&&(u.current(),u.current=null),!n||!ae){r([]),a(!1);return}a(!0),l(null);const Q=Pe(ae,"time_tracking_snapshots"),q=st(Q,xt("employeeId","==",n));u.current=ar(q,B=>{try{const $=[];B.forEach(te=>{var F,X,ue,Y;const G=te.data();$.push({id:te.id,...G,snapshotTime:((X=(F=G.snapshotTime)==null?void 0:F.toDate)==null?void 0:X.call(F))||new Date((Y=(ue=G.createdAt)==null?void 0:ue.toDate)==null?void 0:Y.call(ue))||new Date})}),$.sort((te,G)=>G.snapshotTime.getTime()-te.snapshotTime.getTime());const H=$.slice(0,50);r(H),a(!1),console.log(` EMPLOYEE SNAPSHOTS: Updated with ${H.length} snapshots for ${e}`)}catch($){console.error(" EMPLOYEE SNAPSHOTS: Process error:",$),l("     "),a(!1)}},B=>{console.error(" EMPLOYEE SNAPSHOTS: Listener error:",B),l("    "),a(!1)}),console.log(" EMPLOYEE SNAPSHOTS: Real-time listener setup for employee:",n,e)}catch(Q){console.error(" EMPLOYEE SNAPSHOTS: Setup listener error:",Q),l("    "),a(!1)}})(),()=>{u.current&&(u.current(),u.current=null)}),[n,e,c]);const j=()=>{d(A=>A+1)},L=()=>new Date().getDay()===5,R=A=>{if(!A)return"";const Q=new Date(A),q=String(Q.getDate()).padStart(2,"0"),B=String(Q.getMonth()+1).padStart(2,"0"),$=Q.getFullYear();return`${q}/${B}/${$}`},D=A=>A?new Date(A).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"",y=A=>A?(A.toDate?A.toDate():new Date(A)).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"",T=A=>{switch(A){case"active":return"bg-success";default:return"bg-secondary"}},x=A=>{switch(A){case"active":return"";default:return" "}},S=A=>{if(!A)return"00:00";if(typeof A=="string"&&A.includes(":")){const Q=A.split(":");return`${Q[0]}:${Q[1]}`}return A};return i?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx(It,{size:"large"}),t.jsxs("p",{className:"text-muted mt-3",children:["      ",e,"..."]})]})}):o?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("i",{className:"bi bi-exclamation-triangle text-warning fs-1 mb-3"}),t.jsx("p",{className:"text-danger",children:o}),t.jsxs("button",{className:"btn btn-primary",onClick:j,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]})}):t.jsxs("div",{className:"card shadow-sm",style:{height:"calc(100vh - 140px)",display:"flex",flexDirection:"column"},children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:10,backgroundColor:"white",borderBottom:"1px solid #e9ecef",flexShrink:0},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-person-workspace text-primary me-2"}),"   ",e]}),t.jsx("span",{className:`badge rounded-pill ${L()?"bg-warning":"bg-primary"}`,children:L()?"":`${s.length} `})]}),t.jsx("div",{className:"d-flex gap-2"})]})}),t.jsx("div",{className:"card-body p-0",style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:s.length===0?t.jsxs("div",{className:"text-center py-5",style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[t.jsx("i",{className:"bi bi-camera text-muted fs-1 mb-3"}),t.jsxs("p",{className:"text-muted",children:["      ",e]}),t.jsx("p",{className:"text-muted small",children:"       18:40"})]}):t.jsx("div",{className:"table-responsive",style:{flex:1,overflow:"auto"},children:t.jsxs("table",{className:"table table-striped table-hover mb-0",children:[t.jsx("thead",{className:"table-light",style:{position:"sticky",top:0,zIndex:5,backgroundColor:"#f8f9fa"},children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"text-center",style:{width:"50px"},children:""}),t.jsx("th",{scope:"col",className:"text-center",style:{width:"120px"},children:""}),t.jsx("th",{scope:"col",className:"text-center",style:{width:"140px"},children:" "}),t.jsx("th",{scope:"col",className:"text-center",style:{width:"100px"},children:" "}),t.jsx("th",{scope:"col",className:"text-center",style:{width:"120px"},children:" "}),t.jsx("th",{scope:"col",className:"text-center",style:{width:"80px"},children:""}),t.jsx("th",{scope:"col",className:"text-center",style:{width:"140px"},children:" "})]})}),t.jsx("tbody",{children:s.map((A,Q)=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-center fw-bold text-primary py-3",style:{fontSize:"1.1rem"},children:Q+1}),t.jsx("td",{className:"text-center py-3",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:"bi bi-calendar3 text-primary me-2",style:{fontSize:"1rem"}}),t.jsx("span",{className:"fw-medium",style:{fontSize:"0.95rem",color:"#495057"},children:R(A.date)})]})}),t.jsx("td",{className:"text-center py-3",children:new Date(A.date).getDay()===5?t.jsx("span",{className:"badge bg-warning",style:{fontSize:"0.9rem"},children:""}):t.jsxs("div",{className:"d-flex flex-column align-items-center",children:[t.jsx("div",{className:"progress mb-2",style:{width:"90px",height:"8px",backgroundColor:"#e9ecef"},children:t.jsx("div",{className:`progress-bar ${A.percentage>=100?"bg-success":A.percentage>=75?"bg-primary":A.percentage>=50?"bg-warning":"bg-danger"}`,role:"progressbar",style:{width:`${Math.min(100,A.percentage)}%`,background:A.percentage>=100?"#28a745":A.percentage>=75?"#007bff":A.percentage>=50?"#ffc107":"#dc3545"}})}),t.jsxs("span",{className:"fw-bold",style:{fontSize:"0.9rem",color:"#495057"},children:[A.percentage,"%"]})]})}),t.jsx("td",{className:"text-center py-3",children:t.jsx("span",{className:"fw-bold",style:{color:"#dc3545",fontSize:"1rem",fontFamily:"monospace"},children:new Date(A.date).getDay()===5?"00:00":S(A.duration)})}),t.jsx("td",{className:"text-center py-3",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:"bi bi-play-circle text-success me-2",style:{fontSize:"1rem"}}),t.jsx("span",{className:"fw-medium",style:{fontSize:"0.9rem",color:"#495057",direction:"ltr",fontFamily:"monospace"},children:new Date(A.date).getDay()===5?"00:00":y(A.sessionStart)})]})}),t.jsx("td",{className:"text-center py-3",children:t.jsx("span",{className:`badge ${new Date(A.date).getDay()===5?"bg-warning":T(A.status)} px-2 py-1`,style:{fontSize:"0.75rem",fontWeight:"500"},children:new Date(A.date).getDay()===5?"":x(A.status)})}),t.jsx("td",{className:"text-center py-3",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[t.jsx("i",{className:"bi bi-camera text-info me-2",style:{fontSize:"1rem"}}),t.jsx("span",{className:"fw-medium",style:{fontSize:"0.9rem",color:"#495057",direction:"ltr",fontFamily:"monospace"},children:new Date(A.date).getDay()===5?"00:00":D(A.snapshotTime)})]})})]},A.id))})]})})}),s.length>0&&t.jsx("div",{className:"card-footer bg-light text-muted",style:{flexShrink:0},children:t.jsxs("div",{className:"row",children:[t.jsx("div",{className:"col-md-6",children:t.jsxs("small",{children:[t.jsx("i",{className:"bi bi-info-circle me-1"}),"       18:40"]})}),t.jsx("div",{className:"col-md-6 text-end",children:t.jsxs("small",{children:[t.jsx("i",{className:"bi bi-clock-history me-1"})," : ",new Date().toLocaleString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})]})})]})}),t.jsx(Mt,{show:f.show,onClose:p,title:f.title,message:f.message,type:f.type,onConfirm:f.onConfirm,confirmText:f.confirmText,cancelText:f.cancelText,showCancel:f.showCancel})]})}function oz(){const[n,e]=h.useState(!1),{isTimelineVisible:s}=Ut(),{timeSpent:r,dailyTime:i,isActive:a,sessionStart:o,formatTime:l}=M0(),c=Xr(),[d,u]=h.useState(null),f=()=>{e(!n)};return h.useEffect(()=>{var p,j;(p=c.state)!=null&&p.filterByEmployee&&((j=c.state)!=null&&j.selectedEmployeeId)?(u({id:c.state.selectedEmployeeId,name:c.state.selectedEmployeeName}),console.log(" TIME TRACKING: Filtered for employee:",c.state.selectedEmployeeName)):u(null)},[c.state]),t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,children:[t.jsx(Rt,{onToggle:f}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!s?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),d?t.jsxs(t.Fragment,{children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsx("a",{href:"/employee-time-tracking",className:"text-decoration-none text-primary",children:"  "})}),t.jsxs("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:["  - ",d.name]})]}):t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-3",children:t.jsx("div",{className:"row",children:t.jsx("div",{className:"col-12",children:d?t.jsx(az,{employeeId:d.id,employeeName:d.name}):t.jsx(iz,{})})})}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&s&&t.jsx(os,{rtl:!0}),!n&&s&&t.jsx(ls,{})]})}function lz(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(oz,{})})})}class cz{constructor(){this.collectionName="accountsChart"}async createAccount(e){try{const s=Pe(ae,this.collectionName),r=st(s,xt("accountCode","==",e.accountCode));if(!(await qe(r)).empty)throw new Error("   ");const a={...e,createdAt:hs.now(),updatedAt:hs.now()},o=await As(s,a);return console.log("    :",o.id),{id:o.id,...a}}catch(s){throw console.error("    :",s),s}}async getAllAccounts(){try{const e=Pe(ae,this.collectionName),s=await qe(e),r=[];return s.forEach(i=>{var o,l;const a=i.data();!a.isArchived&&a.isActive!==!1&&r.push({id:i.id,...a,createdAt:(o=a.createdAt)==null?void 0:o.toDate(),updatedAt:(l=a.updatedAt)==null?void 0:l.toDate()})}),r.sort((i,a)=>{const o=parseInt(i.accountCode)||0,l=parseInt(a.accountCode)||0;return o-l}),console.log(`   ${r.length} `),r}catch(e){throw console.error("    :",e),e}}async getAccountsByType(e){try{const s=Pe(ae,this.collectionName),r=st(s,xt("accountType","==",e),xt("isActive","==",!0)),i=await qe(r),a=[];return i.forEach(o=>{var l,c;a.push({id:o.id,...o.data(),createdAt:(l=o.data().createdAt)==null?void 0:l.toDate(),updatedAt:(c=o.data().updatedAt)==null?void 0:c.toDate()})}),a.sort((o,l)=>{const c=parseInt(o.accountCode)||0,d=parseInt(l.accountCode)||0;return c-d}),a}catch(s){throw console.error("      :",s),s}}async getActiveAccounts(){try{const e=Pe(ae,this.collectionName),s=st(e,xt("isActive","==",!0)),r=await qe(s),i=[];return r.forEach(a=>{var o,l;i.push({id:a.id,...a.data(),createdAt:(o=a.data().createdAt)==null?void 0:o.toDate(),updatedAt:(l=a.data().updatedAt)==null?void 0:l.toDate()})}),i.sort((a,o)=>{const l=parseInt(a.accountCode)||0,c=parseInt(o.accountCode)||0;return l-c}),i}catch(e){throw console.error("     :",e),e}}async updateAccount(e,s){try{if(s.accountCode){const a=Pe(ae,this.collectionName),o=st(a,xt("accountCode","==",s.accountCode));if((await qe(o)).docs.find(d=>d.id!==e))throw new Error("   ")}const r=Le(ae,this.collectionName,e),i={...s,updatedAt:hs.now()};return await Qt(r,i),console.log("    :",e),i}catch(r){throw console.error("    :",r),r}}async archiveAccount(e,s="  "){try{const r=Le(ae,this.collectionName,e),i=await qe(st(Pe(ae,this.collectionName),xt("__name__","==",e)));if(i.empty)throw new Error("  ");const a={id:e,...i.docs[0].data()};return await Qt(r,{isArchived:!0,archivedAt:hs.now(),archiveReason:s,updatedAt:hs.now()}),console.log("    :",e),a}catch(r){throw console.error("    :",r),r}}async restoreAccount(e){try{const s=Le(ae,this.collectionName,e);await Qt(s,{isArchived:!1,archivedAt:null,archiveReason:null,restoredAt:hs.now(),updatedAt:hs.now(),isActive:!0}),console.log("    :",e)}catch(s){throw console.error("    :",s),s}}async getArchivedAccounts(){try{const e=Pe(ae,this.collectionName),s=await qe(e),r=[];return s.forEach(i=>{var o,l,c,d;const a=i.data();(a.isArchived||a.isActive===!1)&&r.push({id:i.id,...a,createdAt:(o=a.createdAt)==null?void 0:o.toDate(),updatedAt:(l=a.updatedAt)==null?void 0:l.toDate(),archivedAt:(c=a.archivedAt)==null?void 0:c.toDate(),restoredAt:(d=a.restoredAt)==null?void 0:d.toDate(),archiveReason:a.archiveReason||(a.isActive===!1&&!a.isArchived?"  ":a.archiveReason)})}),r.sort((i,a)=>{const o=i.archivedAt||i.updatedAt||new Date(0);return(a.archivedAt||a.updatedAt||new Date(0))-o}),console.log(`   ${r.length}  `),r}catch(e){throw console.error("     :",e),e}}async deleteAccount(e){try{return await this.archiveAccount(e)}catch(s){throw console.error("    :",s),s}}async searchAccounts(e){try{return(await this.getAllAccounts()).filter(i=>i.accountName.toLowerCase().includes(e.toLowerCase())||i.accountCode.includes(e)||i.accountType.includes(e)||i.description&&i.description.toLowerCase().includes(e.toLowerCase()))}catch(s){throw console.error("     :",s),s}}async getAccountByCode(e){var s,r;try{const i=Pe(ae,this.collectionName),a=st(i,xt("accountCode","==",e)),o=await qe(a);if(o.empty)return null;const l=o.docs[0];return{id:l.id,...l.data(),createdAt:(s=l.data().createdAt)==null?void 0:s.toDate(),updatedAt:(r=l.data().updatedAt)==null?void 0:r.toDate()}}catch(i){throw console.error("       :",i),i}}async forceCorrectHierarchy(){try{console.log("    ...");const e=Pe(ae,this.collectionName),s=await qe(e),r=[];s.forEach(o=>{r.push({id:o.id,...o.data()})});const i=[],a={4101:{newCode:"4100",newName:" ",parentCode:"4000"},4102:{newCode:"4200",newName:" ",parentCode:"4000"},4103:{newCode:"4300",newName:" ",parentCode:"4000"},3101:{newCode:"3100",newName:" ",parentCode:"3000"},3102:{newCode:"3200",newName:" ",parentCode:"3000"}};for(const o of r){const l=a[o.accountCode];l&&(console.log(`  : ${o.accountCode}  ${l.newCode}`),i.push({id:o.id,oldCode:o.accountCode,newCode:l.newCode,newName:l.newName,parentCode:l.parentCode,accountType:o.accountType}))}for(const o of i){const l=Le(ae,this.collectionName,o.id);await Qt(l,{accountCode:o.newCode,accountName:o.newName,parentAccountCode:o.parentCode,updatedAt:hs.now()})}return console.log(`    ${i.length}    `),i.length}catch(e){throw console.error("     :",e),e}}async migrateAccountTypes(){try{console.log("   ...");const e=Pe(ae,this.collectionName),s=await qe(e);let r=0;const i=[];s.forEach(a=>{const o=a.data();let l=!1,c=o.accountType,d=o.accountCode,u=o.accountName;o.accountType===""?(c="",l=!0):(o.accountType===""||o.accountType==="")&&(c="",l=!0);const f={4101:"4100",4102:"4200",4103:"4300",3101:"3100",3102:"3200"};f[o.accountCode]&&(d=f[o.accountCode],l=!0,console.log(`   : ${o.accountCode}  ${d}`)),l&&i.push({id:a.id,accountType:c,accountCode:d,accountName:u})});for(const a of i){const o=Le(ae,this.collectionName,a.id);await Qt(o,{accountType:a.accountType,accountCode:a.accountCode,updatedAt:hs.now()}),r++}return console.log(`   ${r} `),r}catch(e){throw console.error("     :",e),e}}async repairExistingAccounts(){try{console.log("    ...");const e=await this.migrateAccountTypes(),s=await this.forceCorrectHierarchy(),r=e+s;return console.log(`   ${r}  `),r}catch(e){throw console.error("    :",e),e}}async createDefaultAccounts(){try{console.log("   ..."),await this.migrateAccountTypes(),await this.forceCorrectHierarchy();const e=[{accountCode:"1000",accountName:"",accountType:"",description:"  "},{accountCode:"1100",accountName:" ",accountType:"",parentAccountCode:"1000"},{accountCode:"1101",accountName:" ",accountType:"",parentAccountCode:"1100"},{accountCode:"1102",accountName:" ",accountType:"",parentAccountCode:"1100"},{accountCode:"1103",accountName:"",accountType:"",parentAccountCode:"1100"},{accountCode:"1104",accountName:"",accountType:"",parentAccountCode:"1100"},{accountCode:"1200",accountName:" ",accountType:"",parentAccountCode:"1000"},{accountCode:"1201",accountName:" ",accountType:"",parentAccountCode:"1200"},{accountCode:"1202",accountName:" ",accountType:"",parentAccountCode:"1200"},{accountCode:"1203",accountName:" ",accountType:"",parentAccountCode:"1200"},{accountCode:"2000",accountName:"",accountType:"",description:"  "},{accountCode:"2100",accountName:" ",accountType:"",parentAccountCode:"2000"},{accountCode:"2101",accountName:"",accountType:"",parentAccountCode:"2100"},{accountCode:"2102",accountName:" ",accountType:"",parentAccountCode:"2100"},{accountCode:"2103",accountName:" ",accountType:"",parentAccountCode:"2100"},{accountCode:"2200",accountName:"  ",accountType:"",parentAccountCode:"2000"},{accountCode:"2201",accountName:"  ",accountType:"",parentAccountCode:"2200"},{accountCode:"3000",accountName:" ",accountType:" ",description:"   "},{accountCode:"3100",accountName:" ",accountType:" ",parentAccountCode:"3000"},{accountCode:"3200",accountName:" ",accountType:" ",parentAccountCode:"3000"},{accountCode:"4000",accountName:"",accountType:"",description:"  "},{accountCode:"4100",accountName:" ",accountType:"",parentAccountCode:"4000"},{accountCode:"4200",accountName:" ",accountType:"",parentAccountCode:"4000"},{accountCode:"4300",accountName:" ",accountType:"",parentAccountCode:"4000"},{accountCode:"5000",accountName:"",accountType:"",description:"  "},{accountCode:"5100",accountName:"  ",accountType:"",parentAccountCode:"5000"},{accountCode:"5101",accountName:"  ",accountType:"",parentAccountCode:"5100"},{accountCode:"5102",accountName:"  ",accountType:"",parentAccountCode:"5100"},{accountCode:"5200",accountName:" ",accountType:"",parentAccountCode:"5000"},{accountCode:"5201",accountName:" ",accountType:"",parentAccountCode:"5200"},{accountCode:"5202",accountName:" ",accountType:"",parentAccountCode:"5200"},{accountCode:"5203",accountName:"  ",accountType:"",parentAccountCode:"5200"},{accountCode:"5204",accountName:" ",accountType:"",parentAccountCode:"5200"},{accountCode:"5205",accountName:" ",accountType:"",parentAccountCode:"5200"},{accountCode:"5206",accountName:" ",accountType:"",parentAccountCode:"5200"}];let s=0;for(const r of e)try{await this.getAccountByCode(r.accountCode)||(await this.createAccount({...r,isActive:!0}),s++)}catch(i){console.warn(`  ${r.accountCode}:`,i.message)}return console.log(`   ${s}  `),s}catch(e){throw console.error("     :",e),e}}}const qi=new cz;function dz(){const[n,e]=h.useState([]),[s,r]=h.useState(!0),[i,a]=h.useState(!1),[o,l]=h.useState(!1),[c,d]=h.useState(null),[u,f]=h.useState(!1),[p,j]=h.useState(""),[L,R]=h.useState({show:!1,message:"",type:""}),[D,y]=h.useState({}),[T,x]=h.useState({}),[S,A]=h.useState({accountCode:"",accountName:"",accountType:"",parentAccountCode:"",description:"",isActive:!0}),[Q,q]=h.useState(""),B=["",""," ","",""],$=[""," "," "," "," "," "," "," "],H=C=>({:"bi-building-gear",:"bi-credit-card"," ":"bi-shield-check",:"bi-graph-up-arrow",:"bi-graph-down-arrow"})[C]||"bi-folder";h.useEffect(()=>{te();const C=()=>{console.log(" Accounts repaired - refreshing data..."),te()};return window.addEventListener("accountsRepaired",C),()=>{window.removeEventListener("accountsRepaired",C)}},[]),h.useEffect(()=>{if(p.trim()!==""){const C={};B.forEach(U=>{C[U]=!1}),y(C),window.accountsToAutoExpand&&window.accountsToAutoExpand.size>0&&x(U=>{const w={...U};return window.accountsToAutoExpand.forEach(W=>{w[W]=!1}),w})}else if(Q===""){const C={};B.forEach(U=>{C[U]=!0}),y(C),x(U=>{const w={...U};return n.forEach(W=>{w[W.accountCode]=!0}),w})}},[p,Q,n]);const te=async()=>{try{r(!0);const C=await qi.getAllAccounts();console.log(" [DEBUG] Loaded accounts from service:",C),console.log(" [DEBUG] Total accounts count:",C.length),console.log(" [DEBUG] Sample account structure:",C[0]),e(C)}catch(C){console.error("   :",C),G("    ","error")}finally{r(!1)}},G=(C,U,w=null)=>{U==="confirm"?R({show:!0,message:C,type:U,onConfirm:w}):(R({show:!0,message:C,type:U}),setTimeout(()=>R({show:!1,message:"",type:""}),3e3))},F=async C=>{if(!C.trim())return{isValid:!1,message:"  ",type:"error"};if(n.some(w=>w.accountCode===C.trim()))return{isValid:!1,message:`  "${C}"      `,type:"error"};try{if((await qi.getArchivedAccounts()).some(ie=>ie.accountCode===C.trim()))return{isValid:!1,message:`  "${C}"     `,type:"error"}}catch(w){console.error("   :",w)}return{isValid:!0}},X=C=>{y(U=>({...U,[C]:!U[C]}))},ue=C=>{x(U=>({...U,[C]:!U[C]}))},Y=async C=>{C.preventDefault();try{if(!c&&u){const U=await F(S.accountCode);if(!U.isValid){G(U.message,U.type);return}}c?(await qi.updateAccount(c.id,S),G("   ","success")):(await qi.createAccount(S),G("   ","success")),await te(),k()}catch(U){console.error("   :",U),G("    ","error")}},z=C=>{d(C),A({accountCode:C.accountCode,accountName:C.accountName,accountType:C.accountType,parentAccountCode:C.parentAccountCode||"",description:C.description||"",isActive:C.isActive}),l(!0)},O=async C=>{const U=`    "${C.accountName}"

       .`;G(U,"confirm",async()=>{try{const w=`   - ${C.accountType}`;await qi.archiveAccount(C.id,w),G(`   "${C.accountName}" `,"success"),await te()}catch(w){console.error("   :",w),G(`    : ${w.message}`,"error")}})},E=C=>{const U=C.accountCode;let w="";const W=n.filter(ie=>ie.accountType===C.accountType);if(C.hierarchyLevel===0){const ie=U.substring(0,1),de=W.filter(ye=>ye.accountCode.startsWith(ie)&&ye.accountCode.length===4&&ye.accountCode.endsWith("00")&&ye.accountCode!==U&&ye.parentAccountCode===U).map(ye=>parseInt(ye.accountCode.substring(1,2))).sort((ye,pe)=>ye-pe);let ne=1;for(;de.includes(ne);)ne++;w=ie+ne+"00"}else if(C.hierarchyLevel===1){const ie=U.substring(0,3),ne=W.filter(pe=>pe.accountCode.startsWith(ie)&&pe.accountCode.length>=4&&pe.accountCode!==U).map(pe=>pe.accountCode).sort().map(pe=>{const be=pe.substring(3);return be?parseInt(be):0}).filter(pe=>!isNaN(pe)).sort((pe,be)=>pe-be);let ye=ne.length>0?Math.max(...ne)+1:1;w=ie+ye}else{const de=W.filter(ye=>ye.accountCode.startsWith(U)&&ye.accountCode!==U).map(ye=>ye.accountCode).sort().map(ye=>{const pe=ye.substring(U.length);return pe?parseInt(pe):0}).filter(ye=>!isNaN(ye)).sort((ye,pe)=>ye-pe);let ne=de.length>0?Math.max(...de)+1:1;w=U+ne}A({accountCode:w,accountName:"",accountType:C.accountType,parentAccountCode:C.accountCode,description:"",isActive:!0}),d(null),f(!1),a(!0)},k=()=>{a(!1),l(!1),d(null),f(!1),A({accountCode:"",accountName:"",accountType:"",parentAccountCode:"",description:"",isActive:!0})},b=(C,U)=>{let w=0,W=C;for(;W&&W.parentAccountCode&&(w++,W=U.find(ie=>ie.accountCode===W.parentAccountCode),!(w>10)););return w},N=(C,U)=>{const w=U.filter(ie=>ie.parentAccountCode===C);let W=[...w];return w.forEach(ie=>{const de=N(ie.accountCode,U);W=[...W,...de]}),W},I=(C,U)=>{const w=[];let W=C;for(;W&&W.parentAccountCode;){const ie=U.find(de=>de.accountCode===W.parentAccountCode);if(ie)w.push(ie),W=ie;else break}return w},P=(()=>{let C=n;if(Q!==""){const de=$.indexOf(Q)-1;C=n.filter(ne=>b(ne,n)<=de)}if(p.trim()==="")return C;const U=p.toLowerCase().trim(),w=new Set;C.forEach(de=>{const ne=de.accountName.toLowerCase().includes(U),ye=de.accountCode.toLowerCase().includes(U);(ne||ye)&&(w.add(de.accountCode),I(de,n).forEach(xe=>w.add(xe.accountCode)),N(de.accountCode,n).forEach(xe=>w.add(xe.accountCode)))});const W=new Set;w.forEach(de=>{const ne=n.find(ye=>ye.accountCode===de);ne&&I(ne,n).forEach(pe=>{W.add(pe.accountCode)})}),window.accountsToAutoExpand=W;const ie=C.filter(de=>w.has(de.accountCode));if(p.trim()!==""){const de=p.toLowerCase().trim();return ie.sort((ne,ye)=>{const pe=fe=>{const Ve=fe.accountName.toLowerCase(),$e=fe.accountCode.toLowerCase();if(Ve===de||$e===p.trim())return 100;if(Ve.startsWith(de)||$e.startsWith(p.trim()))return 80;const et=de.split(" "),ze=Ve.split(" ");return et.some(tt=>ze.some(rt=>rt===tt))?60:Ve.includes(de)||$e.includes(p.trim())?40:10},be=pe(ne),xe=pe(ye);if(be!==xe)return xe-be;const Ee=b(ne,n),Re=b(ye,n);return Ee!==Re?Ee-Re:ne.accountCode.localeCompare(ye.accountCode,void 0,{numeric:!0})})}return ie})(),_=B.reduce((C,U)=>{const w=P.filter($e=>$e.accountType===U),W=w.sort(($e,et)=>$e.accountCode.localeCompare(et.accountCode,void 0,{numeric:!0})),ie=W.map($e=>{const et=b($e,W),ze=w.filter(tt=>tt.parentAccountCode===$e.accountCode).length;return{...$e,hierarchyLevel:et,childrenCount:ze}}),de=ie,ne=Q!=="",ye=p.trim()!=="",xe=[...ie.filter($e=>{if(ne||ye||$e.hierarchyLevel===0)return!0;let et=$e;for(;et&&et.parentAccountCode;){if(T[et.parentAccountCode])return!1;et=de.find(ze=>ze.accountCode===et.parentAccountCode)}return!0}).map($e=>({...$e,allTypeAccounts:de}))],Ee=new Map,Re=[];xe.forEach($e=>{$e.parentAccountCode?(Ee.has($e.parentAccountCode)||Ee.set($e.parentAccountCode,[]),Ee.get($e.parentAccountCode).push($e)):Re.push($e)});const fe=($e,et=[])=>($e.sort((tt,rt)=>tt.accountCode.localeCompare(rt.accountCode,void 0,{numeric:!0})).forEach(tt=>{et.push(tt);const rt=Ee.get(tt.accountCode)||[];rt.length>0&&fe(rt,et)}),et),Ve=fe(Re);return C[U]=Ve,C},{});return s?t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:t.jsx(It,{size:"large"})}):t.jsxs("div",{className:"container-fluid",dir:"rtl",children:[L.show&&t.jsx(Mt,{show:L.show,message:L.message,type:L.type,onClose:()=>R({show:!1,message:"",type:""}),onConfirm:L.onConfirm,showCancel:L.type==="confirm"}),t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:10,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsx("div",{className:"d-flex align-items-center",children:t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-journal-text text-primary me-2"})," "]})}),t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[t.jsxs("div",{className:"input-group",style:{maxWidth:"200px",direction:"ltr"},children:[t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"8px 0 0 8px",borderRight:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-funnel text-muted"})}),t.jsx("select",{className:"form-select shadow-sm border-1",value:Q,onChange:C=>q(C.target.value),style:{borderRadius:"0 8px 8px 0",fontSize:"14px",height:"40px",direction:"rtl",textAlign:"right"},children:$.map(C=>t.jsx("option",{value:C,style:{direction:"rtl",textAlign:"right"},children:C},C))})]}),t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:p,onChange:C=>j(C.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsxs("button",{className:"btn btn-primary",style:{height:"40px",width:"180px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},onClick:()=>{f(!0),A({accountCode:"",accountName:"",accountType:"",parentAccountCode:"",description:"",isActive:!0}),d(null),a(!0)},children:[t.jsx("i",{className:"bi bi-plus-lg ms-2"}),"  "]})]})]})}),t.jsxs("div",{className:"card-body p-0",children:[B.map(C=>{const U=_[C]||[];if(U.length===0)return null;const w=p.trim()!=="",W=Q!=="",ie=w||W||!D[C];return t.jsxs("div",{className:"card mb-4",children:[t.jsx("div",{className:"card-header",style:{cursor:"pointer",transition:"all 0.2s ease"},onClick:()=>X(C),onMouseEnter:de=>{de.currentTarget.style.setProperty("background-color","#e3f2fd","important")},onMouseLeave:de=>{de.currentTarget.style.removeProperty("background-color")},children:t.jsxs("h5",{className:"mb-0 d-flex align-items-center justify-content-between",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:`${H(C)} ms-2`,style:{fontSize:"1.2rem",color:"#0d6efd"}}),t.jsx("span",{style:{marginRight:"8px"},children:C})]}),t.jsx("i",{className:`bi ${w||W||!D[C]?"bi-chevron-up":"bi-chevron-down"}`,style:{fontSize:"1rem"}})]})}),ie&&t.jsx("div",{className:"card-body p-0",children:t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{style:{paddingRight:"25px"},children:" "}),t.jsx("th",{style:{width:"250px",textAlign:"center"},children:""}),t.jsx("th",{style:{width:"80px"},children:""}),t.jsx("th",{style:{width:"120px"},children:""})]})}),t.jsx("tbody",{children:U.map((de,ne)=>{const ye=(()=>{const xe=de.hierarchyLevel,Ee=de.hierarchyLevel===0?null:de.hierarchyLevel===1?de.accountCode.substring(0,1)+"000":de.hierarchyLevel===2?de.accountCode.substring(0,2)+"00":de.accountCode.substring(0,4+(xe-3));for(let Re=ne+1;Re<U.length;Re++){const fe=U[Re];if(fe.hierarchyLevel<xe)break;if(fe.hierarchyLevel===xe&&(fe.hierarchyLevel===0?null:fe.hierarchyLevel===1?fe.accountCode.substring(0,1)+"000":fe.hierarchyLevel===2?fe.accountCode.substring(0,2)+"00":fe.accountCode.substring(0,4+(xe-3)))===Ee)return!1}return!0})(),pe=de.allTypeAccounts.some(xe=>xe.parentAccountCode===de.accountCode),be=T[de.accountCode];return t.jsxs("tr",{className:"account-row",style:{backgroundColor:de.hierarchyLevel===0?"#f8fafc":de.hierarchyLevel===1?"#f0fdf4":"transparent",borderLeft:de.hierarchyLevel===0?"3px solid #2563eb":de.hierarchyLevel===1?"3px solid #059669":"3px solid transparent",transition:"all 0.2s ease",cursor:"pointer"},onMouseEnter:xe=>{const Ee=xe.currentTarget;Ee.style.setProperty("background-color","#e3f2fd","important"),Ee.style.setProperty("--bs-table-striped-bg","#e3f2fd","important"),Ee.querySelectorAll("td").forEach(fe=>{fe.style.setProperty("background-color","#e3f2fd","important")})},onMouseLeave:xe=>{const Ee=xe.currentTarget;Ee.style.removeProperty("background-color"),Ee.style.removeProperty("--bs-table-striped-bg"),Ee.querySelectorAll("td").forEach(fe=>{fe.style.removeProperty("background-color")})},children:[t.jsxs("td",{style:{paddingRight:`${25+de.hierarchyLevel*30}px`,position:"relative",cursor:pe?"pointer":"default"},onClick:pe?()=>ue(de.accountCode):void 0,children:[de.hierarchyLevel>0&&t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"absolute",right:`${15+(de.hierarchyLevel-1)*30+12}px`,top:0,bottom:ye?"50%":0,width:"2px",backgroundColor:"#374151",zIndex:1}}),t.jsx("div",{style:{position:"absolute",right:`${15+(de.hierarchyLevel-1)*30+12}px`,top:"calc(50% - 1px)",width:"15px",height:"2px",backgroundColor:"#374151",zIndex:1}}),t.jsx("div",{style:{position:"absolute",right:`${15+(de.hierarchyLevel-1)*30+9}px`,top:"calc(50% - 4px)",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#1f2937",border:"1px solid #ffffff",zIndex:3,boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}})]}),pe&&t.jsx("i",{className:`bi ${be?"bi-plus-square":"bi-dash-square"} me-2`,style:{color:"#6c757d",fontSize:"0.9rem",position:"relative",zIndex:3}}),t.jsxs("span",{style:{fontWeight:de.hierarchyLevel===0?"700":de.hierarchyLevel===1?"600":"500",fontSize:de.hierarchyLevel===0?"1.1rem":de.hierarchyLevel===1?"1rem":"0.95rem",color:de.hierarchyLevel===0?"#2563eb":de.hierarchyLevel===1?"#059669":"#6b7280",position:"relative",zIndex:3,letterSpacing:de.hierarchyLevel===0?"0.5px":"normal"},children:[de.accountCode,"-",de.accountName]})]}),t.jsx("td",{className:"text-muted small",style:{textAlign:"center"},children:de.description}),t.jsx("td",{children:t.jsx("span",{className:`badge ${de.isActive?"bg-success":"bg-secondary"}`,children:de.isActive?"":" "})}),t.jsx("td",{children:t.jsxs("div",{className:"btn-group btn-group-sm",style:{gap:"2px",position:"relative",zIndex:10},children:[t.jsx("button",{className:"btn btn-success",onClick:()=>E(de),title:"  ",disabled:de.hierarchyLevel>=6,style:{background:"linear-gradient(45deg, #28a745, #20c997)",border:"none",transition:"all 0.2s ease"},onMouseEnter:xe=>{xe.target.style.background="linear-gradient(45deg, #218838, #1aa085)",xe.target.style.transform="translateY(-1px)",xe.target.style.boxShadow="0 4px 8px rgba(40, 167, 69, 0.3)"},onMouseLeave:xe=>{xe.target.style.background="linear-gradient(45deg, #28a745, #20c997)",xe.target.style.transform="translateY(0)",xe.target.style.boxShadow="none"},children:t.jsx("i",{className:"bi bi-plus-lg"})}),t.jsx("button",{className:"btn btn-outline-primary",onClick:()=>z(de),title:"",children:t.jsx("i",{className:"bi bi-pencil"})}),t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>O(de),title:"",children:t.jsx("i",{className:"bi bi-trash"})})]})})]},de.id)})})]})})})]},C)}).filter(Boolean),P.length===0&&t.jsxs("div",{className:"text-center py-5",children:[t.jsx("i",{className:"bi bi-folder2-open display-1 text-muted mb-3"}),n.length===0?t.jsxs(t.Fragment,{children:[t.jsx("h5",{className:"text-muted",children:"    "}),t.jsx("p",{className:"text-muted",children:"   "}),t.jsxs("button",{className:"btn btn-primary mt-3",onClick:()=>{f(!0),A({accountCode:"1000",accountName:"",accountType:"",parentAccountCode:"",description:"  ",isActive:!0}),a(!0)},children:[t.jsx("i",{className:"bi bi-plus-circle me-2"}),"  "]})]}):t.jsxs(t.Fragment,{children:[t.jsx("h5",{className:"text-muted",children:"    "}),t.jsx("p",{className:"text-muted",children:"       "}),t.jsxs("p",{className:"text-muted small",children:['  : "',p,'"  ',n.length," "]})]})]})]})]}),i&&t.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:t.jsx("div",{className:"modal-dialog modal-xl",children:t.jsxs("div",{className:"modal-content",children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h5",{className:"modal-title",children:"  "}),t.jsx("button",{type:"button",className:"btn-close",onClick:k})]}),t.jsxs("form",{onSubmit:Y,children:[t.jsxs("div",{className:"modal-body",children:[t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"text",className:"form-control",value:S.accountCode,onChange:u?C=>A({...S,accountCode:C.target.value}):void 0,readOnly:!u,style:u?{}:{backgroundColor:"#f8f9fa",cursor:"not-allowed"},required:!0,placeholder:": 1001"})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"text",className:"form-control",value:S.accountName,onChange:C=>A({...S,accountName:C.target.value}),required:!0,placeholder:":  "})]})]}),t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("select",{className:"form-select",value:S.accountType,onChange:C=>A({...S,accountType:C.target.value}),required:!0,children:B.map(C=>t.jsx("option",{value:C,children:C},C))})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:" "}),t.jsx("input",{type:"text",className:"form-control",value:S.parentAccountCode,onChange:u?C=>A({...S,parentAccountCode:C.target.value}):void 0,readOnly:!u,style:u?{}:{backgroundColor:"#f8f9fa",cursor:"not-allowed"},placeholder:": 1000"})]})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:""}),t.jsx("textarea",{className:"form-control",rows:"3",value:S.description,onChange:C=>A({...S,description:C.target.value}),placeholder:"  ..."})]}),t.jsx("div",{className:"row",children:t.jsx("div",{className:"col-md-12 mb-3",children:t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("label",{className:"form-label me-3 mb-0",children:""}),t.jsxs("div",{className:"form-check form-switch mb-0",children:[t.jsx("input",{className:"form-check-input",type:"checkbox",id:"isActiveAdd",checked:S.isActive,onChange:C=>A({...S,isActive:C.target.checked})}),t.jsx("label",{className:"form-check-label",htmlFor:"isActiveAdd",children:S.isActive?"":" "})]})]})})})]}),t.jsxs("div",{className:"modal-footer justify-content-center",style:{gap:"10px"},children:[t.jsx("button",{type:"submit",className:"btn btn-primary",style:{background:"linear-gradient(45deg, #007bff, #0056b3)",border:"none",borderRadius:"6px",height:"38px",width:"120px"},children:" "}),t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:k,style:{borderRadius:"6px",height:"38px",width:"120px"},children:""})]})]})]})})}),o&&t.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:t.jsx("div",{className:"modal-dialog modal-xl",children:t.jsxs("div",{className:"modal-content",children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h5",{className:"modal-title",children:" "}),t.jsx("button",{type:"button",className:"btn-close",onClick:k})]}),t.jsxs("form",{onSubmit:Y,children:[t.jsxs("div",{className:"modal-body",children:[t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"text",className:"form-control",value:S.accountCode,onChange:C=>A({...S,accountCode:C.target.value}),readOnly:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"},required:!0})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"text",className:"form-control",value:S.accountName,onChange:C=>A({...S,accountName:C.target.value}),required:!0})]})]}),t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("select",{className:"form-select",value:S.accountType,onChange:C=>A({...S,accountType:C.target.value}),required:!0,children:B.map(C=>t.jsx("option",{value:C,children:C},C))})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:" "}),t.jsx("input",{type:"text",className:"form-control",value:S.parentAccountCode,onChange:C=>A({...S,parentAccountCode:C.target.value}),readOnly:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"}})]})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:""}),t.jsx("textarea",{className:"form-control",rows:"3",value:S.description,onChange:C=>A({...S,description:C.target.value})})]}),t.jsx("div",{className:"row",children:t.jsx("div",{className:"col-md-12 mb-3",children:t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("label",{className:"form-label me-3 mb-0",children:""}),t.jsxs("div",{className:"form-check form-switch mb-0",children:[t.jsx("input",{className:"form-check-input",type:"checkbox",id:"isActiveEdit",checked:S.isActive,onChange:C=>A({...S,isActive:C.target.checked})}),t.jsx("label",{className:"form-check-label",htmlFor:"isActiveEdit",children:S.isActive?"":" "})]})]})})})]}),t.jsxs("div",{className:"modal-footer justify-content-center",style:{gap:"10px"},children:[t.jsx("button",{type:"submit",className:"btn btn-primary",style:{background:"linear-gradient(45deg, #007bff, #0056b3)",border:"none",borderRadius:"6px",height:"38px",width:"120px"},children:" "}),t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:k,style:{borderRadius:"6px",height:"38px",width:"120px"},children:""})]})]})]})})})]})}function uz(){const n=kt(),[e,s]=h.useState(!1),[r,i]=h.useState(!1),[a,o]=h.useState({show:!1,message:"",type:""}),{isTimelineVisible:l}=Ut(),c=()=>{s(!e)},d=(f,p,j=null)=>{p==="confirm"?o({show:!0,message:f,type:p,onConfirm:j}):(o({show:!0,message:f,type:p}),setTimeout(()=>o({show:!1,message:"",type:""}),5e3))},u=async()=>{d(`    

        (    ).`,"confirm",async()=>{try{i(!0),console.log("     ...");const p=await qi.repairExistingAccounts();console.log(`   -   ${p} `),p>0?(d(`  ${p}  !    ...`,"success"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("accountsRepaired"))},2e3)):(d("     -     ","success"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("accountsRepaired"))},1500))}catch(p){console.error("    :",p),d(`    : ${p.message}`,"error")}finally{i(!1)}})};return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsxs("div",{className:`page-wrapper ${e?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:c}),t.jsxs("div",{className:"main-container",style:{paddingRight:e?"72px":"250px",paddingLeft:e||!l?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:e?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:e})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsxs("div",{className:"app-content-area p-3",style:{maxHeight:"calc(100vh - 200px)",overflowY:"auto",paddingBottom:"80px"},children:[a.show&&t.jsx(Mt,{show:a.show,message:a.message,type:a.type,onClose:()=>o({show:!1,message:"",type:""}),onConfirm:a.onConfirm,showCancel:a.type==="confirm"}),t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"h3 mb-1",children:" "}),t.jsx("p",{className:"text-muted mb-0",children:"   "})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsxs("button",{className:"btn btn-primary",onClick:()=>n("/accounts-archive"),style:{borderRadius:"6px",height:"38px",minWidth:"160px",background:"linear-gradient(45deg, #007bff, #0056b3)",border:"none",transition:"all 0.2s ease"},onMouseEnter:f=>{f.target.style.background="linear-gradient(45deg, #0056b3, #004085)",f.target.style.transform="translateY(-1px)",f.target.style.boxShadow="0 4px 8px rgba(0, 123, 255, 0.3)"},onMouseLeave:f=>{f.target.style.background="linear-gradient(45deg, #007bff, #0056b3)",f.target.style.transform="translateY(0)",f.target.style.boxShadow="none"},children:[t.jsx("i",{className:"bi bi-archive me-2"})," "]}),t.jsx("button",{className:"btn btn-outline-primary",onClick:u,disabled:r,style:{borderRadius:"6px",height:"38px",minWidth:"160px"},children:r?t.jsxs(t.Fragment,{children:[t.jsx(It,{size:"small"}),t.jsx("span",{className:"ms-2",children:" ..."})]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-wrench me-2"}),"  "]})})]})]}),t.jsx("div",{className:"accounts-chart-table",children:t.jsx(dz,{})})]})]}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]}),!e&&l&&t.jsx(os,{rtl:!0}),!e&&l&&t.jsx(ls,{})]})})})}function hz(){return t.jsx(uz,{})}function mz(){const n=kt(),[e,s]=h.useState(!1),[r,i]=h.useState(!0),[a,o]=h.useState([]),[l,c]=h.useState(""),[d,u]=h.useState({show:!1,message:"",type:""}),{isTimelineVisible:f}=Ut(),p=()=>{s(!e)},j=(S,A,Q=null)=>{A==="confirm"?u({show:!0,message:S,type:A,onConfirm:Q}):(u({show:!0,message:S,type:A}),setTimeout(()=>u({show:!1,message:"",type:""}),5e3))};h.useEffect(()=>{L()},[]);const L=async()=>{try{i(!0);const S=await qi.getArchivedAccounts();o(S)}catch(S){console.error("    :",S),j("     ","error")}finally{i(!1)}},R=async S=>{const A=`    "${S.accountName}"  

      .`;j(A,"confirm",async()=>{try{await qi.restoreAccount(S.id),j(`   "${S.accountName}" `,"success"),await L()}catch(Q){console.error("   :",Q),j(`    : ${Q.message}`,"error")}})},D=async S=>{if(window.confirm(`    "${S.accountName}"       .`)&&window.confirm("   -       !"))try{j(`   "${S.accountName}" `,"success"),await L()}catch(A){console.error("   :",A),j(`    : ${A.message}`,"error")}},y=a.filter(S=>{if(l.trim()==="")return!0;const A=l.toLowerCase().trim();return S.accountName.toLowerCase().includes(A)||S.accountCode.includes(l.trim())||S.accountType.includes(l.trim())||S.description&&S.description.toLowerCase().includes(A)||S.archiveReason&&S.archiveReason.toLowerCase().includes(A)}),T=S=>({:"primary",:"danger"," ":"success",:"info",:"warning"})[S]||"secondary",x=S=>({:"bi-building-gear",:"bi-credit-card"," ":"bi-shield-check",:"bi-graph-up-arrow",:"bi-graph-down-arrow"})[S]||"bi-folder";return r?t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"80vh"},children:t.jsx(It,{size:"large"})}):t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsxs("div",{className:`page-wrapper ${e?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:p}),t.jsxs("div",{className:"main-container",style:{paddingRight:e?"72px":"250px",paddingLeft:e||!f?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:e?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:e})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsx("a",{href:"/accounts-chart",className:"text-decoration-none d-flex align-items-center",children:t.jsx("span",{className:"text-primary",children:" "})})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsxs("div",{className:"app-content-area p-3",style:{maxHeight:"calc(100vh - 200px)",overflowY:"auto",paddingBottom:"80px"},children:[d.show&&t.jsx(Mt,{show:d.show,message:d.message,type:d.type,onClose:()=>u({show:!1,message:"",type:""}),onConfirm:d.onConfirm,showCancel:d.type==="confirm"}),t.jsx("div",{className:"card shadow-sm",children:t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:10,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsx("div",{className:"d-flex align-items-center",children:t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-archive text-primary me-2"})," "]})}),t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:l,onChange:S=>c(S.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsxs("button",{className:"btn btn-outline-primary",onClick:()=>n("/accounts-chart"),style:{height:"40px",width:"180px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:[t.jsx("i",{className:"bi bi-arrow-left me-2"})," "]})]})]})})}),t.jsx("div",{className:"mt-4",children:y.length===0?t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("i",{className:"bi bi-archive display-1 text-muted mb-3"}),t.jsx("h5",{className:"text-muted",children:"    "}),t.jsx("p",{className:"text-muted",children:l?"      ":"    "})]})}):(()=>{const S=["",""," ","",""],A={};return S.forEach(Q=>{A[Q]=y.filter(q=>q.accountType===Q)}),S.map(Q=>{const q=A[Q]||[];return q.length===0?null:t.jsxs("div",{className:"card mb-4",children:[t.jsx("div",{className:"card-header",style:{cursor:"pointer",backgroundColor:"#f8f9fa",borderRadius:"12px 12px 0 0",border:"none",padding:"15px 20px"},children:t.jsx("div",{className:"d-flex align-items-center justify-content-between",children:t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:`${x(Q)} me-3 text-${T(Q)}`,style:{fontSize:"1.5rem"}}),t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("span",{className:`text-${T(Q)}`,children:Q}),t.jsxs("span",{className:"text-muted ms-2",children:["(",q.length,"  )"]})]})]})})}),t.jsx("div",{className:"card-body p-0",children:t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{style:{paddingRight:"25px"},children:" "}),t.jsx("th",{style:{width:"200px",textAlign:"center"},children:""}),t.jsx("th",{style:{width:"120px"},children:" "}),t.jsx("th",{style:{width:"80px"},children:""}),t.jsx("th",{style:{width:"160px"},children:""})]})}),t.jsx("tbody",{children:q.map(B=>t.jsxs("tr",{className:"account-row",style:{backgroundColor:"#fff5f5",borderLeft:"3px solid #dc3545",transition:"all 0.2s ease",cursor:"default"},onMouseEnter:$=>{const H=$.currentTarget;H.style.setProperty("background-color","#fee2e2","important"),H.querySelectorAll("td").forEach(G=>{G.style.setProperty("background-color","#fee2e2","important")})},onMouseLeave:$=>{const H=$.currentTarget;H.style.setProperty("background-color","#fff5f5","important"),H.querySelectorAll("td").forEach(G=>{G.style.setProperty("background-color","#fff5f5","important")})},children:[t.jsx("td",{style:{paddingRight:"25px",position:"relative"},children:t.jsxs("span",{style:{fontWeight:"600",fontSize:"1rem",color:"#dc3545",position:"relative",zIndex:3},children:[B.accountCode,"-",B.accountName]})}),t.jsx("td",{className:"text-muted small",style:{textAlign:"center"},children:B.description||"-"}),t.jsxs("td",{className:"small",children:[t.jsx("div",{className:"text-muted",children:B.archivedAt?B.archivedAt.toLocaleDateString("en-GB"):" "}),B.archiveReason&&t.jsxs("div",{className:"text-warning small mt-1",title:B.archiveReason,children:[t.jsx("i",{className:"bi bi-info-circle me-1"}),(()=>{let $=B.archiveReason.replace("   - ","").replace("   ","").replace("  ","");return $.length>20?$.substring(0,20)+"...":$})()]})]}),t.jsx("td",{children:t.jsx("span",{className:`badge ${B.isActive?"bg-success":"bg-secondary"}`,children:B.isActive?"":" "})}),t.jsx("td",{children:t.jsxs("div",{className:"btn-group btn-group-sm",style:{gap:"2px",position:"relative",zIndex:10},children:[t.jsx("button",{className:"btn btn-success",onClick:()=>R(B),title:" ",style:{background:"linear-gradient(45deg, #28a745, #20c997)",border:"none",transition:"all 0.2s ease"},onMouseEnter:$=>{$.target.style.background="linear-gradient(45deg, #218838, #1aa085)",$.target.style.transform="translateY(-1px)",$.target.style.boxShadow="0 4px 8px rgba(40, 167, 69, 0.3)"},onMouseLeave:$=>{$.target.style.background="linear-gradient(45deg, #28a745, #20c997)",$.target.style.transform="translateY(0)",$.target.style.boxShadow="none"},children:t.jsx("i",{className:"bi bi-arrow-clockwise"})}),t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>D(B),title:" ",children:t.jsx("i",{className:"bi bi-trash3"})})]})})]},B.id))})]})})})]},Q)}).filter(Boolean)})()})]})]}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]}),!e&&f&&t.jsx(os,{rtl:!0}),!e&&f&&t.jsx(ls,{})]})})})}function pz(){return t.jsx(mz,{})}function fz({show:n,onClose:e,onSelectAccount:s,selectedAccountId:r=null}){const[i,a]=h.useState([]),[o,l]=h.useState(!0),[c,d]=h.useState(""),[u,f]=h.useState({}),[p,j]=h.useState({}),[L,R]=h.useState(""),D=["",""," ","",""],y=[""," "," "," "," "," "," "," "],T=G=>({:"bi-building-gear",:"bi-credit-card"," ":"bi-shield-check",:"bi-graph-up-arrow",:"bi-graph-down-arrow"})[G]||"bi-folder";h.useEffect(()=>{n&&x()},[n]),h.useEffect(()=>{if(c.trim()!==""){const G={};D.forEach(F=>{G[F]=!1}),f(G),window.accountsToAutoExpand&&window.accountsToAutoExpand.size>0&&j(F=>{const X={...F};return window.accountsToAutoExpand.forEach(ue=>{X[ue]=!1}),X})}else if(L===""){const G={};D.forEach(F=>{G[F]=!1}),f(G),j(F=>{const X={...F};return i.forEach(ue=>{X[ue.accountCode]=!1}),X})}},[c,L,i]);const x=async()=>{try{l(!0);const G=await qi.getAllAccounts();a(G)}catch(G){console.error("Error loading accounts:",G)}finally{l(!1)}},S=G=>{f(F=>({...F,[G]:!F[G]}))},A=G=>{j(F=>({...F,[G]:!F[G]}))},Q=(G,F)=>{let X=0,ue=G;for(;ue&&ue.parentAccountCode&&(X++,ue=F.find(Y=>Y.accountCode===ue.parentAccountCode),!(X>10)););return X},q=(G,F)=>{const X=F.filter(Y=>Y.parentAccountCode===G);let ue=[...X];return X.forEach(Y=>{const z=q(Y.accountCode,F);ue=[...ue,...z]}),ue},B=(G,F)=>{const X=[];let ue=G;for(;ue&&ue.parentAccountCode;){const Y=F.find(z=>z.accountCode===ue.parentAccountCode);if(Y)X.push(Y),ue=Y;else break}return X},$=(()=>{let G=i;if(L!==""){const z=y.indexOf(L)-1;G=i.filter(O=>Q(O,i)<=z)}if(c.trim()==="")return G;const F=c.toLowerCase().trim(),X=new Set;G.forEach(z=>{const O=z.accountName.toLowerCase().includes(F),E=z.accountCode.toLowerCase().includes(F);(O||E)&&(X.add(z.accountCode),B(z,i).forEach(N=>X.add(N.accountCode)),q(z.accountCode,i).forEach(N=>X.add(N.accountCode)))});const ue=new Set;X.forEach(z=>{const O=i.find(E=>E.accountCode===z);O&&B(O,i).forEach(k=>{ue.add(k.accountCode)})}),window.accountsToAutoExpand=ue;const Y=G.filter(z=>X.has(z.accountCode));if(c.trim()!==""){const z=c.toLowerCase().trim();return Y.sort((O,E)=>{const k=_=>{const C=_.accountName.toLowerCase(),U=_.accountCode.toLowerCase();if(C===z||U===c.trim())return 100;if(C.startsWith(z)||U.startsWith(c.trim()))return 80;const w=z.split(" "),W=C.split(" ");return w.some(ie=>W.some(de=>de===ie))?60:C.includes(z)||U.includes(c.trim())?40:10},b=k(O),N=k(E);if(b!==N)return N-b;const I=Q(O,i),P=Q(E,i);return I!==P?I-P:O.accountCode.localeCompare(E.accountCode,void 0,{numeric:!0})})}return Y})(),H=D.reduce((G,F)=>{const X=$.filter(U=>U.accountType===F),ue=X.sort((U,w)=>U.accountCode.localeCompare(w.accountCode,void 0,{numeric:!0})),Y=ue.map(U=>{const w=Q(U,ue),W=X.filter(ie=>ie.parentAccountCode===U.accountCode).length;return{...U,hierarchyLevel:w,childrenCount:W}}),z=Y,O=L!=="",E=c.trim()!=="",N=[...Y.filter(U=>{if(O||E||U.hierarchyLevel===0)return!0;let w=U;for(;w&&w.parentAccountCode;){if(p[w.parentAccountCode])return!1;w=z.find(W=>W.accountCode===w.parentAccountCode)}return!0}).map(U=>({...U,allTypeAccounts:z}))],I=new Map,P=[];N.forEach(U=>{U.parentAccountCode?(I.has(U.parentAccountCode)||I.set(U.parentAccountCode,[]),I.get(U.parentAccountCode).push(U)):P.push(U)});const _=(U,w=[])=>(U.sort((ie,de)=>ie.accountCode.localeCompare(de.accountCode,void 0,{numeric:!0})).forEach(ie=>{w.push(ie);const de=I.get(ie.accountCode)||[];de.length>0&&_(de,w)}),w),C=_(P);return G[F]=C,G},{}),te=G=>{G.allTypeAccounts.some(X=>X.parentAccountCode===G.accountCode)||(s(G),e())};return n?t.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:t.jsx("div",{className:"modal-dialog modal-xl",children:t.jsxs("div",{className:"modal-content",children:[t.jsxs("div",{className:"modal-header",style:{background:"linear-gradient(45deg, #007bff, #0056b3)",color:"white",borderBottom:"none"},children:[t.jsxs("h5",{className:"modal-title d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-journal-text me-2"})," "]}),t.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:e,style:{filter:"invert(1)"}})]}),t.jsxs("div",{className:"modal-body p-0",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:10,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:t.jsxs("div",{className:"d-flex justify-content-center align-items-center gap-3",children:[t.jsxs("div",{className:"input-group",style:{maxWidth:"200px",direction:"ltr"},children:[t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"8px 0 0 8px",borderRight:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-funnel text-muted"})}),t.jsx("select",{className:"form-select shadow-sm border-1",value:L,onChange:G=>R(G.target.value),style:{borderRadius:"0 8px 8px 0",fontSize:"14px",height:"40px",direction:"rtl",textAlign:"right"},children:y.map(G=>t.jsx("option",{value:G,style:{direction:"rtl",textAlign:"right"},children:G},G))})]}),t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:c,onChange:G=>d(G.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]})]})}),t.jsx("div",{style:{maxHeight:"500px",overflowY:"auto"},children:o?t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:t.jsx(It,{size:"large"})}):t.jsxs("div",{className:"container-fluid",dir:"rtl",children:[D.map(G=>{const F=H[G]||[];if(F.length===0)return null;const X=c.trim()!=="",ue=L!=="",Y=X||ue||!u[G];return t.jsxs("div",{className:"card mb-4",children:[t.jsx("div",{className:"card-header",style:{cursor:"pointer",transition:"all 0.2s ease"},onClick:()=>S(G),onMouseEnter:z=>{z.currentTarget.style.setProperty("background-color","#e3f2fd","important")},onMouseLeave:z=>{z.currentTarget.style.removeProperty("background-color")},children:t.jsxs("h5",{className:"mb-0 d-flex align-items-center justify-content-between",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:`${T(G)} ms-2`,style:{fontSize:"1.2rem",color:"#0d6efd"}}),t.jsx("span",{style:{marginRight:"8px"},children:G})]}),t.jsx("i",{className:`bi ${X||ue||!u[G]?"bi-chevron-up":"bi-chevron-down"}`,style:{fontSize:"1rem"}})]})}),Y&&t.jsx("div",{className:"card-body p-0",children:t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{style:{paddingRight:"25px"},children:" "}),t.jsx("th",{style:{width:"250px",textAlign:"center"},children:""}),t.jsx("th",{style:{width:"80px"},children:""})]})}),t.jsx("tbody",{children:F.map((z,O)=>{const E=(()=>{const P=z.hierarchyLevel,_=z.hierarchyLevel===0?null:z.hierarchyLevel===1?z.accountCode.substring(0,1)+"000":z.hierarchyLevel===2?z.accountCode.substring(0,2)+"00":z.accountCode.substring(0,4+(P-3));for(let C=O+1;C<F.length;C++){const U=F[C];if(U.hierarchyLevel<P)break;if(U.hierarchyLevel===P&&(U.hierarchyLevel===0?null:U.hierarchyLevel===1?U.accountCode.substring(0,1)+"000":U.hierarchyLevel===2?U.accountCode.substring(0,2)+"00":U.accountCode.substring(0,4+(P-3)))===_)return!1}return!0})(),k=z.allTypeAccounts.some(P=>P.parentAccountCode===z.accountCode),b=p[z.accountCode],N=r===z.id,I=!k;return t.jsxs("tr",{className:"account-row",style:{backgroundColor:N?"#e3f2fd":z.hierarchyLevel===0?"#f8fafc":z.hierarchyLevel===1?"#f0fdf4":"transparent",borderLeft:z.hierarchyLevel===0?"3px solid #2563eb":z.hierarchyLevel===1?"3px solid #059669":"3px solid transparent",transition:"all 0.2s ease",cursor:I||k?"pointer":"default"},onMouseEnter:P=>{if(I){const _=P.currentTarget;_.style.setProperty("background-color","#e3f2fd","important"),_.style.setProperty("--bs-table-striped-bg","#e3f2fd","important"),_.querySelectorAll("td").forEach(U=>{U.style.setProperty("background-color","#e3f2fd","important")})}},onMouseLeave:P=>{if(I&&!N){const _=P.currentTarget;_.style.removeProperty("background-color"),_.style.removeProperty("--bs-table-striped-bg"),_.querySelectorAll("td").forEach(U=>{U.style.removeProperty("background-color")})}},onClick:()=>{k?A(z.accountCode):I&&te(z)},children:[t.jsxs("td",{style:{paddingRight:`${25+z.hierarchyLevel*30}px`,position:"relative"},children:[z.hierarchyLevel>0&&t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"absolute",right:`${15+(z.hierarchyLevel-1)*30+12}px`,top:0,bottom:E?"50%":0,width:"2px",backgroundColor:"#374151",zIndex:1}}),t.jsx("div",{style:{position:"absolute",right:`${15+(z.hierarchyLevel-1)*30+12}px`,top:"calc(50% - 1px)",width:"15px",height:"2px",backgroundColor:"#374151",zIndex:1}}),t.jsx("div",{style:{position:"absolute",right:`${15+(z.hierarchyLevel-1)*30+9}px`,top:"calc(50% - 4px)",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#1f2937",border:"1px solid #ffffff",zIndex:3,boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}})]}),k&&t.jsx("i",{className:`bi ${b?"bi-plus-square":"bi-dash-square"} me-2`,style:{color:"#6c757d",fontSize:"0.9rem",position:"relative",zIndex:3}}),t.jsxs("span",{style:{fontWeight:z.hierarchyLevel===0?"700":z.hierarchyLevel===1?"600":"500",fontSize:z.hierarchyLevel===0?"1.1rem":z.hierarchyLevel===1?"1rem":"0.95rem",color:N?"#007bff":z.hierarchyLevel===0?"#2563eb":z.hierarchyLevel===1?"#059669":"#6b7280",position:"relative",zIndex:3,letterSpacing:z.hierarchyLevel===0?"0.5px":"normal"},children:[z.accountCode,"-",z.accountName]})]}),t.jsx("td",{className:"text-muted small",style:{textAlign:"center"},children:z.description}),t.jsx("td",{children:t.jsx("span",{className:`badge ${z.isActive?"bg-success":"bg-secondary"}`,children:z.isActive?"":" "})})]},z.id)})})]})})})]},G)}).filter(Boolean),$.length===0&&t.jsxs("div",{className:"text-center py-5",children:[t.jsx("i",{className:"bi bi-folder2-open display-1 text-muted mb-3"}),t.jsx("h5",{className:"text-muted",children:"    "}),t.jsx("p",{className:"text-muted",children:"   "}),c.trim()&&t.jsxs("p",{className:"text-muted small",children:['  : "',c,'"  ',i.length," "]})]})]})})]}),t.jsx("div",{className:"modal-footer justify-content-center",style:{gap:"10px"},children:t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:e,style:{borderRadius:"6px",height:"38px",width:"120px"},children:""})})]})})}):null}const Ha="journalEntries";class br{static async getAllJournalEntries(){try{const e=Pe(ae,Ha),s=st(e,as("date","desc"));return(await qe(s)).docs.map(i=>{var o,l;const a=i.data();return{id:i.id,internalId:a.internalId||Ct("JOURNAL"),...a,createdAt:(o=a.createdAt)==null?void 0:o.toDate(),updatedAt:(l=a.updatedAt)==null?void 0:l.toDate()}})}catch(e){throw console.error("Error fetching journal entries:",e),new Error("     ")}}static async createJournalEntry(e){try{if(console.log(" Creating journal entry with data:",e),!e.date||!e.referenceNumber||!e.description)throw new Error("  :    ");if(!e.lines||e.lines.length===0)throw new Error("    ");const s=Ct("JOURNAL");console.log(" Generated internal ID:",s);let r=0,i=0;e.lines.forEach(l=>{l.debit&&(r+=l.debit),l.credit&&(i+=l.credit)}),console.log(" Calculated totals - Debit:",r,"Credit:",i);const a={...e,internalId:s,totalDebit:r,totalCredit:i,status:"active",createdAt:We(),updatedAt:We()};if(console.log(" Final document to save:",a),!ae)throw new Error("   .    .");const o=await As(Pe(ae,Ha),a);return console.log(" Journal entry created successfully with ID:",o.id),{id:o.id,internalId:s,...e,totalDebit:r,totalCredit:i}}catch(s){throw console.error(" Error creating journal entry:",s),s.code==="permission-denied"?new Error("     .   ."):s.code==="unavailable"?new Error("   .    ."):s.code==="unauthenticated"?new Error("   ."):s.message&&s.message.includes("  ")?s:new Error(`    : ${s.message||"  "}`)}}static async updateJournalEntry(e,s){try{const r=Le(ae,Ha,e);let i={...s};if(s.lines){let a=0,o=0;s.lines.forEach(l=>{l.debit&&(a+=l.debit),l.credit&&(o+=l.credit)}),i.totalDebit=a,i.totalCredit=o}return i.updatedAt=We(),await Qt(r,i),!0}catch(r){throw console.error("Error updating journal entry:",r),new Error("     ")}}static async getJournalEntryById(e){var s,r;try{const i=Le(ae,Ha,e),a=await ss(i);if(a.exists()){const o=a.data();return{id:a.id,internalId:o.internalId||Ct("JOURNAL"),...o,createdAt:(s=o.createdAt)==null?void 0:s.toDate(),updatedAt:(r=o.updatedAt)==null?void 0:r.toDate()}}else return null}catch(i){throw console.error("Error fetching journal entry:",i),new Error("     ")}}static async deleteJournalEntry(e){try{const s=Le(ae,Ha,e);return await es(s),!0}catch(s){throw console.error("Error deleting journal entry:",s),new Error("    ")}}static async getJournalEntriesByDateRange(e,s){try{const r=Pe(ae,Ha),i=st(r,xt("date",">=",e),xt("date","<=",s),as("date","desc"));return(await qe(i)).docs.map(o=>{var c,d;const l=o.data();return{id:o.id,internalId:l.internalId||Ct("JOURNAL"),...l,createdAt:(c=l.createdAt)==null?void 0:c.toDate(),updatedAt:(d=l.updatedAt)==null?void 0:d.toDate()}})}catch(r){throw console.error("Error fetching journal entries by date range:",r),new Error("      ")}}static async getJournalEntriesByReferenceNumber(e){try{const s=Pe(ae,Ha),r=st(s,xt("referenceNumber","==",e));return(await qe(r)).docs.map(a=>{var l,c;const o=a.data();return{id:a.id,internalId:o.internalId||Ct("JOURNAL"),...o,createdAt:(l=o.createdAt)==null?void 0:l.toDate(),updatedAt:(c=o.updatedAt)==null?void 0:c.toDate()}})}catch(s){throw console.error("Error fetching journal entries by reference number:",s),new Error("       ")}}static async reverseJournalEntry(e,s=""){try{const r=await this.getJournalEntryById(e);if(!r)throw new Error("      ");const i=r.lines.map(l=>({...l,debit:l.credit||0,credit:l.debit||0,amount:l.amount})),a={date:new Date().toISOString().split("T")[0],referenceNumber:`REV-${r.referenceNumber}`,description:`  - ${r.description}${s?` - ${s}`:""}`,lines:i,originalEntryId:e,isReversal:!0},o=await this.createJournalEntry(a);return await this.updateJournalEntry(e,{status:"reversed",reversalEntryId:o.id,reversalDate:new Date().toISOString()}),o}catch(r){throw console.error("Error reversing journal entry:",r),new Error("    ")}}static async updateJournalDocuments(e,s){try{console.log(" [JOURNAL] Updating journal documents:",{journalId:e,documentsCount:s?s.length:0});const r=Le(ae,Ha,e);return await Qt(r,{documents:s||[],updatedAt:We()}),console.log(" [JOURNAL] Journal documents updated successfully"),!0}catch(r){throw console.error(" [JOURNAL] Error updating journal documents:",r),new Error("Failed to update journal documents: "+r.message)}}static formatCurrency(e){return`${new Intl.NumberFormat("en-US",{minimumFractionDigits:1,maximumFractionDigits:1}).format(e||0)} `}static formatNumber(e){return new Intl.NumberFormat("en-US").format(e||0)}static formatDate(e){if(!e)return"-";try{const s=new Date(e),r=String(s.getDate()).padStart(2,"0"),i=String(s.getMonth()+1).padStart(2,"0"),a=s.getFullYear();return`${r}/${i}/${a}`}catch(s){return console.error("Error formatting date:",s),e}}}function gz(){var Ie;const n=kt(),e=Xr(),[s,r]=h.useState(!1),[i,a]=h.useState(null),[o,l]=h.useState(!0),d=new URLSearchParams(e.search).get("mode")==="opening",[u,f]=h.useState({show:!1,message:"",type:""}),[p,j]=h.useState(!1),{isTimelineVisible:L}=Ut(),[R,D]=h.useState(!1),[y,T]=h.useState(null),[x,S]=h.useState(!1),[A,Q]=h.useState(!1),[q,B]=h.useState(!1),[$,H]=h.useState(!1),[te,G]=h.useState(null),[F,X]=h.useState(""),{logActivity:ue,getCurrentUser:Y}=Zt(),{alertConfig:z,closeAlert:O,showSuccess:E,showError:k,showConfirm:b}=Bt(),N=()=>{r(!s)},[I,P]=h.useState({date:new Date().toISOString().split("T")[0],referenceNumber:"",description:""}),[_,C]=h.useState([{id:1,lineId:1,accountId:"",accountCode:"",accountName:"",amount:"",debitCredit:"debit",costCenter:"",operations:"",documents:[]}]),[U,w]=h.useState([]),[W,ie]=h.useState([]),[de,ne]=h.useState(-1),[ye,pe]=h.useState([]),be=[{id:"1",name:""},{id:"2",name:""},{id:"3",name:""},{id:"4",name:""}],xe=async()=>{try{const oe=await br.getAllJournalEntries();if(oe.length===0)return"02";const Te=oe.map(_e=>parseInt(_e.referenceNumber)||0).filter(_e=>_e>0),we=Math.max(...Te,1)+1;return we<10?we.toString().padStart(2,"0"):we.toString()}catch(oe){return console.error("Error generating reference number:",oe),"02"}},Ee=async()=>{try{console.log(" Checking if opening journal exists in Firestore...");const Te=(await br.getAllJournalEntries()).find(_e=>_e.referenceNumber==="01");if(Te)return console.log(" Opening journal already exists:",Te.id),Te;console.log(" Creating opening journal in Firestore...");const Ne={date:"2025-01-01",referenceNumber:"01",description:" ",lines:[{lineId:Date.now(),accountId:"",accountCode:"",accountName:"",debit:0,credit:0,costCenter:"",operations:"",documents:[]}],totalDebit:0,totalCredit:0,status:"active"},we=await br.createJournalEntry(Ne);return console.log(" Opening journal created in Firestore:",we.id),we}catch(oe){throw console.error(" Error ensuring opening journal exists:",oe),oe}},Re=async()=>{try{const oe=await Ee();if(console.log(" Loading opening journal from Firestore:",oe),P({date:oe.date||"2025-01-01",referenceNumber:oe.referenceNumber||"01",description:oe.description||" "}),oe.lines&&oe.lines.length>0){const Te=oe.lines.map((Ne,we)=>({id:Date.now()+we,lineId:Ne.lineId||Ne.id||Date.now()+we,accountId:Ne.accountId||"",accountCode:Ne.accountCode||"",accountName:Ne.accountName||"",amount:Ne.debit>0?Ne.debit.toString():Ne.credit>0?Ne.credit.toString():"",debitCredit:Ne.debit>0?"debit":"credit",costCenter:Ne.costCenter||"",operations:Ne.operations||"",documents:Ne.documents||[]}));C(Te)}else C([{id:Date.now(),lineId:Date.now(),accountId:"",accountCode:"",accountName:"",amount:"",debitCredit:"debit",costCenter:"",operations:"",documents:[]}]);return a(oe.id),console.log(" Opening journal loaded from Firestore"),oe}catch(oe){throw console.error(" Error loading opening journal from Firestore:",oe),oe}};h.useEffect(()=>{(async()=>{$e(),fe(),await ze();const Te=new URLSearchParams(e.search),Ne=Te.get("id"),we=Te.get("mode");if(Ne)a(Ne),Ve(Ne);else if(we==="opening")await Re(),l(!1);else{const _e=await xe();P({date:new Date().toISOString().split("T")[0],referenceNumber:_e,description:""}),l(!1)}})()},[e.search]),h.useEffect(()=>{if(W.length>0&&i){const oe=W.findIndex(Te=>Te.id===i);ne(oe),console.log(` Current journal position: ${oe+1}/${W.length}`)}else ne(-1),console.log(" New journal mode")},[W,i]);const fe=async()=>{try{console.log(" Testing Firebase write access...");const oe=await Py();console.log(" Firebase connection test result:",oe);const{collection:Te,addDoc:Ne}=await Xe(async()=>{const{collection:_e,addDoc:Ge}=await Promise.resolve().then(()=>Tl);return{collection:_e,addDoc:Ge}},void 0),{db:we}=await Xe(async()=>{const{db:_e}=await Promise.resolve().then(()=>_l);return{db:_e}},void 0);if(!we){console.error(" Firestore db not available");return}console.log(" Firestore db is available, testing write access...")}catch(oe){console.error(" Firebase access test failed:",oe)}},Ve=async oe=>{try{l(!0),console.log(" Loading existing journal:",oe);const Te=await br.getJournalEntryById(oe);if(Te){if(console.log(" Journal data loaded:",Te),P({date:Te.date||new Date().toISOString().split("T")[0],referenceNumber:Te.referenceNumber||"",description:Te.description||""}),Te.lines&&Te.lines.length>0){const Ne=Te.lines.map((we,_e)=>{var Ge;return{id:Date.now()+_e,lineId:we.lineId||we.id||Date.now()+_e,accountId:we.accountId||"",accountCode:we.accountCode||"",accountName:we.accountName||"",amount:((Ge=we.amount)==null?void 0:Ge.toString())||"",debitCredit:we.debit>0?"debit":"credit",costCenter:we.costCenter||"",operations:we.operations||"",documents:we.documents||[]}});C(Ne),console.log(" Loaded journal lines with individual documents:",Ne)}console.log(" Journal loaded successfully for editing")}else k("     ",""),n("/journal-entry-list")}catch(Te){console.error(" Error loading journal:",Te),k("    ",""),n("/journal-entry-list")}finally{l(!1)}},$e=async()=>{try{l(!0);const oe=await qi.getAllAccounts();pe(oe)}catch(oe){console.error("Error loading accounts:",oe),et("   ","error")}finally{l(!1)}},et=(oe,Te,Ne=null)=>{f({show:!0,message:oe,type:Te}),setTimeout(()=>f({show:!1,message:"",type:""}),5e3)},ze=async()=>{try{console.log(" Loading all journals...");const Ne=(await br.getAllJournalEntries()).filter(we=>we.referenceNumber!=="01").sort((we,_e)=>{const Ge=parseInt(we.referenceNumber)||0,mt=parseInt(_e.referenceNumber)||0;return Ge-mt});return ie(Ne),console.log(` Loaded ${Ne.length} journals (excluding opening):`,Ne.map(we=>we.referenceNumber).join(", ")),Ne}catch(oe){return console.error(" Error loading journals:",oe),ie([]),[]}},tt=async oe=>{try{if(l(!0),console.log(` Loading journal data: ${oe.referenceNumber}`),oe.isOpeningJournal||oe.referenceNumber==="01"){console.log(" Loading opening journal from Firestore"),await Re(),l(!1);return}if(P({date:oe.date||new Date().toISOString().split("T")[0],referenceNumber:oe.referenceNumber||"",description:oe.description||""}),oe.lines&&oe.lines.length>0){const Te=oe.lines.map((Ne,we)=>{var _e;return{id:Date.now()+we,lineId:Ne.lineId||Ne.id||Date.now()+we,accountId:Ne.accountId||"",accountCode:Ne.accountCode||"",accountName:Ne.accountName||"",amount:((_e=Ne.amount)==null?void 0:_e.toString())||"",debitCredit:Ne.debit>0?"debit":"credit",costCenter:Ne.costCenter||"",operations:Ne.operations||"",documents:Ne.documents||[]}});C(Te),console.log(" Loaded journal lines with documents:",Te)}else{const Te=Date.now();C([{id:Te,lineId:Te,accountId:"",accountCode:"",accountName:"",amount:"",debitCredit:"debit",costCenter:"",operations:"",documents:[]}])}a(oe.id),console.log(" Journal data loaded smoothly")}catch(Te){console.error(" Error loading journal data:",Te),k("    ","")}finally{l(!1)}},rt=async()=>{if(W.length>0){const oe=W[0];console.log(` Smooth navigate to FIRST journal: ${oe.referenceNumber}`),await tt(oe),ne(0)}},bt=async()=>{if(de>0){const oe=W[de-1];console.log(` Navigate to PREVIOUS journal: ${oe.referenceNumber}`),await tt(oe),ne(de-1)}else if(de===-1&&W.length>0){const oe=W[W.length-1];console.log(` From NEW journal to most recent: ${oe.referenceNumber}`),await tt(oe),ne(W.length-1)}else console.log(" Already at first journal")},At=async()=>{if(de>=0&&de<W.length-1){const oe=W[de+1];console.log(` Navigate to NEXT journal: ${oe.referenceNumber}`),await tt(oe),ne(de+1)}else de===W.length-1?(console.log(" From last journal to NEW journal"),await Ht()):console.log(" No next available")},ns=async()=>{if(W.length>0){const oe=W[W.length-1];console.log(` Smooth navigate to LAST journal: ${oe.referenceNumber}`),await tt(oe),ne(W.length-1)}},Ht=async()=>{console.log(" Navigate to NEW journal");const oe=await xe();P({date:new Date().toISOString().split("T")[0],referenceNumber:oe,description:""});const Te=Date.now();C([{id:Te,lineId:Te,accountId:"",accountCode:"",accountName:"",amount:"",debitCredit:"debit",costCenter:"",operations:"",documents:[]}]),a(null),ne(-1),console.log(" Switched to new journal mode")},is=oe=>{const Te={},Ne=[];return oe.forEach(we=>{Te[we.accountCode]={...we,children:[]}}),oe.forEach(we=>{we.parentAccountCode&&Te[we.parentAccountCode]?Te[we.parentAccountCode].children.push(Te[we.accountCode]):Ne.push(Te[we.accountCode])}),Ne},Oe=(oe,Te)=>{P(Ne=>({...Ne,[oe]:Te}))},it=(oe,Te,Ne)=>{C(we=>we.map(_e=>{if(_e.id===oe){const Ge={..._e,[Te]:Ne};if(Te==="accountId"&&Ne){const mt=ye.find(pt=>pt.id===Ne);mt&&(Ge.accountCode=mt.accountCode,Ge.accountName=mt.accountName)}return Ge}return _e}))},Kt=()=>{const oe=Date.now(),Te={id:oe,lineId:oe,accountId:"",accountCode:"",accountName:"",amount:"",debitCredit:"debit",costCenter:"",operations:"",documents:[]};C(Ne=>[...Ne,Te])},zs=oe=>{_.length>1&&C(Te=>Te.filter(Ne=>Ne.id!==oe))},xs=(oe,Te)=>{it(oe,"debitCredit",Te)},cs=oe=>{y&&(it(y,"accountId",oe.id),it(y,"accountCode",oe.accountCode),it(y,"accountName",oe.accountName)),D(!1),T(null)},Os=oe=>{T(oe),D(!0)},vs=oe=>{const Te=_.find(Ne=>Ne.id===oe);Te&&(T(oe),w(Te.documents||[]),S(!0))},Z=async oe=>{const Te=oe.target.files[0];if(Te){Q(!0);try{try{Ss.validateFile(Te,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]})}catch(we){throw new Error(we.message)}console.log(" Uploading document:",Te.name);const Ne=await Ss.uploadFile(Te,"journal-documents");G({...Ne,originalFileName:Te.name,fileSize:Te.size,fileType:Te.type}),X(Te.name.split(".")[0]),H(!0),oe.target.value=""}catch(Ne){console.error("Error uploading document:",Ne),k(Ne.message||"   ","  "),oe.target&&(oe.target.value="")}finally{Q(!1)}}},v=async oe=>{b(`      

${oe.fileName}`,async()=>{try{B(!0);const Te={...oe,originalCollection:"journal_entry_documents",lineId:y,journalEntryId:I.referenceNumber||"draft"};if(await bs.moveToTrash(Te,"journal_entry_documents"),C(Ne=>Ne.map(we=>{if(we.id===y){const _e=we.documents.filter(Ge=>Ge.id!==oe.id);return{...we,documents:_e}}return we})),w(Ne=>Ne.filter(we=>we.id!==oe.id)),I.referenceNumber)try{await Ss.deleteJournalEntryDocumentFromFirestore(I.referenceNumber,oe.id),console.log(" Journal entry document removed from Firestore subcollection")}catch(Ne){console.error(" Error removing journal entry document from storage:",Ne)}ue("file",`${Y().name}    `,`  : ${oe.fileName}`),E("   "," ")}catch(Te){console.error("Error deleting document:",Te),k("    ","  ")}finally{B(!1)}},"  ")},se=async()=>{if(!F.trim()){k("   ","  ");return}if(!te||!y){k("      ","");return}try{Q(!0),console.log(" Creating document for line:",y,"file:",F);const oe={id:Date.now().toString(),fileName:F.trim(),originalFileName:te.originalFileName,fileURL:te.url,storagePath:te.path,fileSize:te.fileSize,fileType:te.fileType,uploadedAt:new Date().toISOString(),uploadDate:new Date().toISOString(),lineId:y,journalId:i||"new",journalDescription:I.description||"  ",journalReferenceNumber:I.referenceNumber||" "};if(C(Ne=>Ne.map(we=>{if(we.id===y){const _e=[...we.documents||[],oe];return{...we,documents:_e}}return we})),w(Ne=>[...Ne,oe]),i&&i!=="new")try{console.log(" FIREBASE-ONLY: Saving line document directly to Firebase journal:",i);const Ne=_.map(we=>we.id===y?{...we,documents:[...we.documents||[],oe]}:we);await br.updateJournalEntry(i,{lines:Ne.map(we=>({lineId:we.lineId||we.id,accountId:we.accountId,accountCode:we.accountCode,accountName:we.accountName,amount:parseFloat(we.amount)||0,debit:we.debitCredit==="debit"&&parseFloat(we.amount)||0,credit:we.debitCredit==="credit"&&parseFloat(we.amount)||0,costCenter:we.costCenter||null,operations:we.operations||"",documents:we.documents||[]}))}),console.log(" FIREBASE-ONLY: Line document saved directly to Firebase successfully")}catch(Ne){console.error(" FIREBASE-ONLY: Failed to save line document to Firebase:",Ne),C(we=>we.map(_e=>{if(_e.id===y){const Ge=_e.documents.filter(mt=>mt.id!==oe.id);return{..._e,documents:Ge}}return _e})),w(we=>we.filter(_e=>_e.id!==oe.id)),k("      ","  ");return}else console.log(" FIREBASE-ONLY: Line document stored locally for new journal, will be saved when journal is created");E(`   : ${F}`," ");const Te=Y();ue("file",`${Te.name}    `,`  : ${F}`),H(!1),G(null),X("")}catch(oe){console.error("Error saving document:",oe),k(`   : ${oe.message}`,"  ")}finally{Q(!1)}},re=async()=>{if(te!=null&&te.path)try{await Ss.deleteFileFromStorage(te.path),console.log(" Canceled file deleted from storage")}catch(oe){console.error("Error deleting canceled file:",oe)}H(!1),G(null),X(""),Q(!1)},J=()=>{let oe=0,Te=0;return _.forEach(Ne=>{const we=parseFloat(Ne.amount)||0;Ne.debitCredit==="debit"?oe+=we:Te+=we}),{totalDebit:oe,totalCredit:Te}},he=()=>{if(!I.date||!I.referenceNumber||!I.description)return et("    ","error"),!1;if(_.filter(we=>we.accountId&&we.amount&&parseFloat(we.amount)>0).length<2)return et("        ","error"),!1;const{totalDebit:Te,totalCredit:Ne}=J();return Math.abs(Te-Ne)>.01?(et("   -        ","error"),!1):!0},Se=async()=>{if(he()){j(!0);try{if(console.log(" Testing Firebase connection..."),!await Py())throw new Error("    .    .");console.log(" Firebase connection successful"),console.log(" Starting journal entry save process...");const Te=_.filter(Ye=>Ye.accountId&&Ye.amount&&parseFloat(Ye.amount)>0);if(console.log(" Valid lines found:",Te.length,Te),Te.length<2)throw new Error("        ");const Ne={date:I.date,referenceNumber:I.referenceNumber,description:I.description,lines:Te.map(Ye=>({lineId:Ye.lineId||Ye.id,accountId:Ye.accountId,accountCode:Ye.accountCode,accountName:Ye.accountName,amount:parseFloat(Ye.amount),debit:Ye.debitCredit==="debit"?parseFloat(Ye.amount):0,credit:Ye.debitCredit==="credit"?parseFloat(Ye.amount):0,costCenter:Ye.costCenter||null,operations:Ye.operations||"",documents:Ye.documents||[]}))};console.log(" Saving journal entry:",Ne);let we;const _e=Y();i?(await br.updateJournalEntry(i,Ne),we={id:i,...Ne},console.log(" Journal entry updated successfully:",we),ue("journal",`${_e.name}   `,` : ${I.referenceNumber} - ${I.description}`)):(we=await br.createJournalEntry(Ne),console.log(" Journal entry created successfully:",we),ue("journal",`${_e.name}   `,` : ${I.referenceNumber} - ${I.description}`)),E(i?"    ":"    ",i?" ":" "),P({date:new Date().toISOString().split("T")[0],referenceNumber:"",description:""});const pt=Date.now();C([{id:pt,lineId:pt,accountId:"",accountCode:"",accountName:"",amount:"",debitCredit:"debit",costCenter:"",operations:"",documents:[]}]),setTimeout(()=>{n("/journal-entry-list")},1500)}catch(oe){console.error(" Error saving journal entry:",oe),k(oe.message||"     ","  ")}finally{j(!1)}}};is(ye);const{totalDebit:me,totalCredit:ge}=J(),ke=Math.abs(me-ge)<.01;return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsxs("div",{className:`page-wrapper ${s?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:N}),t.jsxs("div",{className:"main-container",style:{paddingRight:s?"72px":"250px",paddingLeft:s||!L?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:s?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:s})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsx("a",{href:"/accounts-chart",className:"text-decoration-none",children:t.jsx("span",{className:"text-primary",children:" "})})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:i?"  ":" "})]})}),t.jsxs("div",{className:"app-content-area p-3",style:{maxHeight:"calc(100vh - 200px)",overflowY:"auto",paddingBottom:"80px"},children:[u.show&&t.jsx(Mt,{show:u.show,message:u.message,type:u.type,onClose:()=>f({show:!1,message:"",type:""}),onConfirm:u.onConfirm,showCancel:u.type==="confirm"}),o?t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"400px"},children:t.jsx(It,{size:"large"})}):t.jsxs("div",{children:[t.jsx("div",{className:"d-flex justify-content-between align-items-center mb-4",children:t.jsxs("h2",{className:"mb-0",children:[t.jsx("i",{className:`${i?"bi bi-journal-check":"bi bi-journal-plus"} me-3`}),i?"  ":d?" ":"  "]})}),t.jsxs("div",{className:"card",children:[t.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[t.jsx("h5",{className:"mb-0",children:d?" ":" "}),!d&&t.jsx("div",{className:"d-flex align-items-center",style:{marginLeft:"20px"},children:t.jsx("div",{className:"navigation-container",style:{background:"linear-gradient(120deg, #f8f9fa 0%, #e9ecef 100%)",borderRadius:"16px",padding:"8px 12px",boxShadow:"0 8px 25px rgba(233, 236, 239, 0.3)",border:"1px solid rgba(0,0,0,0.1)"},children:t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("button",{type:"button",className:"nav-btn d-flex align-items-center justify-content-center",title:" ",onClick:rt,disabled:W.length===0,style:{width:"34px",height:"34px",borderRadius:"8px",border:"none",background:"linear-gradient(135deg, #adb5bd 0%, #6c757d 100%)",color:"#fff",fontSize:"16px",fontWeight:"700",cursor:"pointer",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",lineHeight:"1",outline:"none",boxShadow:"none",textAlign:"center",lineHeight:"1",outline:"none",boxShadow:"none",position:"relative",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",lineHeight:"1",outline:"none",boxShadow:"none",textAlign:"center",lineHeight:"1",outline:"none",boxShadow:"none"},onFocus:oe=>{oe.target.style.outline="none",oe.target.style.boxShadow="none"},onMouseEnter:oe=>{oe.target.style.transform="scale(1.05) translateY(-2px)",oe.target.style.boxShadow="0 12px 30px rgba(0,0,0,0.3)",oe.target.style.outline="none",oe.target.style.border="none"},onMouseLeave:oe=>{oe.target.style.transform="scale(1) translateY(0)",oe.target.style.boxShadow="none",oe.target.style.outline="none",oe.target.style.border="none"},children:t.jsx("i",{className:"bi bi-skip-end-fill",style:{display:"block",textAlign:"center",width:"100%",margin:0,padding:0,lineHeight:"1",fontSize:"14px",fontSize:"14px"}})}),t.jsx("button",{type:"button",className:"nav-btn d-flex align-items-center justify-content-center",title:"",onClick:bt,disabled:W.length===0,style:{width:"34px",height:"34px",borderRadius:"8px",border:"none",background:"linear-gradient(135deg, #adb5bd 0%, #6c757d 100%)",color:"#fff",fontSize:"16px",fontWeight:"700",cursor:"pointer",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",lineHeight:"1",outline:"none",boxShadow:"none",textAlign:"center",lineHeight:"1",outline:"none",boxShadow:"none"},onFocus:oe=>{oe.target.style.outline="none",oe.target.style.boxShadow="none"},onMouseEnter:oe=>{oe.target.style.transform="scale(1.05) translateY(-2px)",oe.target.style.boxShadow="0 12px 30px rgba(0,0,0,0.3)",oe.target.style.outline="none",oe.target.style.border="none"},onMouseLeave:oe=>{oe.target.style.transform="scale(1) translateY(0)",oe.target.style.boxShadow="none",oe.target.style.outline="none",oe.target.style.border="none"},children:t.jsx("i",{className:"bi bi-chevron-right",style:{display:"block",textAlign:"center",width:"100%",margin:0,padding:0,lineHeight:"1",fontSize:"14px",fontSize:"14px"}})}),t.jsxs("div",{style:{background:"rgba(255,255,255,0.95)",borderRadius:"14px",padding:"8px 16px",minWidth:"120px",textAlign:"center",margin:"0 4px",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)",border:"1px solid rgba(255,255,255,0.3)"},children:[t.jsx("div",{style:{fontSize:"11px",color:"#666",fontWeight:"500",textTransform:"uppercase",letterSpacing:"0.5px"},children:" "}),t.jsx("div",{style:{fontSize:"14px",color:"#2c3e50",fontWeight:"700",marginTop:"2px",background:"linear-gradient(45deg, #6c757d, #495057)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:i?`${I.referenceNumber||"#---"}`:""})]}),t.jsx("button",{type:"button",className:"nav-btn d-flex align-items-center justify-content-center",title:"",onClick:At,disabled:W.length===0||de===-1,style:{width:"34px",height:"34px",borderRadius:"8px",border:"none",background:"linear-gradient(135deg, #adb5bd 0%, #6c757d 100%)",color:"#fff",fontSize:"16px",fontWeight:"700",cursor:"pointer",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",lineHeight:"1",outline:"none",boxShadow:"none",textAlign:"center",lineHeight:"1",outline:"none",boxShadow:"none"},onFocus:oe=>{oe.target.style.outline="none",oe.target.style.boxShadow="none"},onMouseEnter:oe=>{oe.target.style.transform="scale(1.05) translateY(-2px)",oe.target.style.boxShadow="0 12px 30px rgba(0,0,0,0.3)",oe.target.style.outline="none",oe.target.style.border="none"},onMouseLeave:oe=>{oe.target.style.transform="scale(1) translateY(0)",oe.target.style.boxShadow="none",oe.target.style.outline="none",oe.target.style.border="none"},children:t.jsx("i",{className:"bi bi-chevron-left",style:{display:"block",textAlign:"center",width:"100%",margin:0,padding:0,lineHeight:"1",fontSize:"14px",fontSize:"14px"}})}),t.jsx("button",{type:"button",className:"nav-btn d-flex align-items-center justify-content-center",title:" ",onClick:ns,disabled:W.length===0,style:{width:"34px",height:"34px",borderRadius:"8px",border:"none",background:"linear-gradient(135deg, #adb5bd 0%, #6c757d 100%)",color:"#fff",fontSize:"16px",fontWeight:"700",cursor:"pointer",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",lineHeight:"1",outline:"none",boxShadow:"none",textAlign:"center",lineHeight:"1",outline:"none",boxShadow:"none"},onFocus:oe=>{oe.target.style.outline="none",oe.target.style.boxShadow="none"},onMouseEnter:oe=>{oe.target.style.transform="scale(1.05) translateY(-2px)",oe.target.style.boxShadow="0 12px 30px rgba(0,0,0,0.3)",oe.target.style.outline="none",oe.target.style.border="none"},onMouseLeave:oe=>{oe.target.style.transform="scale(1) translateY(0)",oe.target.style.boxShadow="none",oe.target.style.outline="none",oe.target.style.border="none"},children:t.jsx("i",{className:"bi bi-skip-start-fill",style:{display:"block",textAlign:"center",width:"100%",margin:0,padding:0,lineHeight:"1",fontSize:"14px",fontSize:"14px"}})})]})})})]}),t.jsxs("div",{className:"card-body",children:[t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-4 mb-3",children:[t.jsx("label",{htmlFor:"date",className:"form-label",children:"  *"}),t.jsx("input",{type:"date",className:"form-control",id:"date",value:I.date,onChange:oe=>Oe("date",oe.target.value),required:!0,style:{textAlign:"right",direction:"rtl",paddingRight:"12px"}})]}),t.jsxs("div",{className:"col-md-2 mb-3",children:[t.jsx("label",{htmlFor:"referenceNumber",className:"form-label",children:" "}),t.jsx("input",{type:"text",className:"form-control",id:"referenceNumber",value:I.referenceNumber,onChange:oe=>Oe("referenceNumber",oe.target.value),placeholder:" ",required:!0,disabled:!0})]}),t.jsx("div",{className:"col-md-6 mb-3",children:t.jsx("div",{className:"d-flex align-items-center",style:{height:"100%",paddingTop:"31px"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center w-100",children:[t.jsx("span",{className:`badge ${ke?"bg-success":"bg-danger"} d-flex align-items-center justify-content-center`,style:{fontSize:"16px",padding:"0 24px",borderRadius:"6px",minWidth:"140px",height:"34px",fontWeight:"500"},children:ke?" ":"  "}),t.jsxs("div",{className:"d-flex gap-2 align-items-center",children:[t.jsx("div",{className:"d-flex align-items-center px-3 py-1",style:{backgroundColor:"#e8f5e8",borderRadius:"20px",border:"1px solid #4caf50",fontSize:"14px",fontWeight:"500"},children:t.jsxs("span",{style:{color:"#388e3c"},children:[": ",me.toFixed(2)]})}),t.jsx("div",{className:"d-flex align-items-center px-3 py-1",style:{backgroundColor:"#e3f2fd",borderRadius:"20px",border:"1px solid #2196f3",fontSize:"14px",fontWeight:"500"},children:t.jsxs("span",{style:{color:"#1976d2"},children:[": ",ge.toFixed(2)]})})]})]})})})]}),t.jsx("div",{className:"row",children:t.jsxs("div",{className:"col-12 mb-3",children:[t.jsx("label",{htmlFor:"description",className:"form-label",children:" *"}),t.jsx("textarea",{className:"form-control",id:"description",rows:"3",value:I.description,onChange:oe=>Oe("description",oe.target.value),placeholder:"  ",required:!0,disabled:d})]})})]})]}),t.jsxs("div",{className:"card mt-4",children:[t.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[t.jsx("h5",{className:"mb-0",children:" "}),t.jsxs("button",{type:"button",className:"btn btn-primary d-flex align-items-center justify-content-center",onClick:Kt,style:{borderRadius:"6px",height:"32px",minWidth:"100px",fontSize:"0.9rem"},children:[t.jsx("i",{className:"bi bi-plus-circle me-2"})," "]})]}),t.jsx("div",{className:"card-body p-0",children:t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-striped mb-0",children:[t.jsx("thead",{className:"table-dark",children:t.jsxs("tr",{children:[t.jsx("th",{width:"5%",style:{textAlign:"center"},children:"#"}),t.jsx("th",{width:"20%",style:{textAlign:"center"},children:""}),t.jsx("th",{width:"5%",style:{textAlign:"center"},children:""}),t.jsx("th",{width:"10%",style:{textAlign:"center"},children:""}),t.jsx("th",{width:"20%",style:{textAlign:"center"},children:" / "}),t.jsx("th",{width:"10%",style:{textAlign:"center"},children:" "}),t.jsx("th",{width:"20%",style:{textAlign:"center"},children:""}),t.jsx("th",{width:"5%",style:{textAlign:"center"},children:""})]})}),t.jsx("tbody",{children:_.map((oe,Te)=>t.jsxs("tr",{children:[t.jsx("td",{style:{textAlign:"center",verticalAlign:"middle"},children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:Te+1})}),t.jsx("td",{style:{verticalAlign:"middle",paddingRight:"5px"},children:t.jsx("input",{type:"text",className:"form-control",value:oe.accountCode?`${oe.accountCode} - ${oe.accountName}`:"",placeholder:" ...",readOnly:!0,style:{backgroundColor:"#f8f9fa",cursor:"pointer",fontSize:"0.9rem",height:"36px",borderRadius:"6px"},onClick:()=>Os(oe.id)})}),t.jsx("td",{className:"text-center",style:{verticalAlign:"middle"},children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center",style:{position:"relative"},children:[t.jsx(Ad,{size:25,clickable:!0,onClick:()=>vs(oe.id),title:`  (${(oe.documents||[]).length})`,style:{cursor:"pointer"}}),(oe.documents||[]).length>0&&t.jsx("span",{className:"badge bg-info",style:{fontSize:"8px",position:"absolute",top:"-2px",right:"-2px",minWidth:"14px",height:"14px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:(oe.documents||[]).length})]})}),t.jsx("td",{children:t.jsx("input",{type:"number",className:"form-control",value:oe.amount,onChange:Ne=>it(oe.id,"amount",Ne.target.value),placeholder:"0.00",min:"0",step:"0.01",required:!0,style:{height:"36px",borderRadius:"6px"}})}),t.jsx("td",{children:t.jsxs("div",{className:"btn-group w-100",role:"group",children:[t.jsx("input",{type:"radio",className:"btn-check",name:`debitCredit_${oe.id}`,id:`debit_${oe.id}`,checked:oe.debitCredit==="debit",onChange:()=>xs(oe.id,"debit")}),t.jsx("label",{className:"btn btn-outline-success btn-sm d-flex align-items-center justify-content-center",htmlFor:`debit_${oe.id}`,style:{fontSize:"0.85rem",borderRadius:"6px 0 0 6px",height:"36px",minWidth:"60px",fontWeight:"500",padding:"0",border:"1px solid #198754",backgroundColor:oe.debitCredit==="debit"?"#198754":"#fff",color:oe.debitCredit==="debit"?"#fff":"#198754",transition:"all 0.15s ease-in-out",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:"1"},children:""}),t.jsx("input",{type:"radio",className:"btn-check",name:`debitCredit_${oe.id}`,id:`credit_${oe.id}`,checked:oe.debitCredit==="credit",onChange:()=>xs(oe.id,"credit")}),t.jsx("label",{className:"btn btn-outline-success btn-sm d-flex align-items-center justify-content-center",htmlFor:`credit_${oe.id}`,style:{fontSize:"0.85rem",borderRadius:"0 6px 6px 0",height:"36px",minWidth:"60px",fontWeight:"500",padding:"0",border:"1px solid #0d6efd",backgroundColor:oe.debitCredit==="credit"?"#0d6efd":"#fff",color:oe.debitCredit==="credit"?"#fff":"#0d6efd",transition:"all 0.15s ease-in-out",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:"1"},children:""})]})}),t.jsx("td",{children:t.jsxs("select",{className:"form-select",value:oe.costCenter,onChange:Ne=>it(oe.id,"costCenter",Ne.target.value),style:{height:"36px",borderRadius:"6px"},children:[t.jsx("option",{value:"",children:"..."}),be.map(Ne=>t.jsx("option",{value:Ne.id,children:Ne.name},Ne.id))]})}),t.jsx("td",{children:t.jsx("input",{type:"text",className:"form-control",value:oe.operations||"",onChange:Ne=>it(oe.id,"operations",Ne.target.value),placeholder:"...",style:{height:"36px",borderRadius:"6px"}})}),t.jsx("td",{className:"text-center",style:{verticalAlign:"middle"},children:_.length>1&&t.jsx("div",{className:"btn-group btn-group-sm",children:t.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>zs(oe.id),title:" ",children:t.jsx("i",{className:"bi bi-trash"})})})})]},oe.id))}),t.jsx("tfoot",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("td",{}),t.jsx("td",{className:"fw-bold",children:""}),t.jsx("td",{}),t.jsx("td",{}),t.jsx("td",{className:"fw-bold",children:t.jsxs("div",{className:"d-flex justify-content-between",children:[t.jsxs("span",{className:"text-success",children:[": ",me.toFixed(2)]}),t.jsxs("span",{className:"text-primary",children:[": ",ge.toFixed(2)]})]})}),t.jsx("td",{}),t.jsx("td",{}),t.jsx("td",{})]})})]})})})]}),t.jsx("div",{className:"row mt-4",children:t.jsx("div",{className:"col-12",children:t.jsx("div",{className:"d-flex justify-content-end",children:t.jsx("button",{type:"button",className:"btn btn-success btn-lg",onClick:Se,disabled:p||!ke,style:{minWidth:"150px"},children:p?t.jsxs(t.Fragment,{children:[t.jsx(It,{size:"small"}),t.jsx("span",{className:"me-2",children:" ..."})]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-check-circle me-2"})," "]})})})})})]})]})]}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]}),!s&&L&&t.jsx(os,{rtl:!0}),!s&&L&&t.jsx(ls,{}),t.jsx(fz,{show:R,onClose:()=>{D(!1),T(null)},onSelectAccount:cs,selectedAccountId:y?(Ie=_.find(oe=>oe.id===y))==null?void 0:Ie.accountId:null}),t.jsx(Td,{show:x,onClose:()=>{S(!1),T(null),w([])},documents:U,setDocuments:w,tenderId:`journal_line_${y}`,uploadingDocument:A,setUploadingDocument:Q,handleDocumentUpload:Z,handleDeleteClick:v,deleting:q,title:"  "}),t.jsx(Mt,{show:z.show,onClose:O,title:z.title,message:z.message,type:z.type,onConfirm:z.onConfirm,confirmText:z.confirmText,cancelText:z.cancelText,showCancel:z.showCancel}),$&&t.jsx("div",{className:"modal show d-block",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.9)",zIndex:99985},tabIndex:"-1",dir:"rtl",children:t.jsx("div",{className:"modal-dialog modal-dialog-centered",children:t.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[t.jsx("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"12px 12px 0 0"},children:t.jsxs("h5",{className:"modal-title fw-bold",children:[t.jsx("i",{className:"bi bi-pencil-square me-2"})," "]})}),t.jsx("div",{className:"modal-body",style:{padding:"25px"},children:t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"d-flex align-items-center mb-3",children:[t.jsx("div",{className:"bg-success bg-opacity-10 p-2 rounded-circle me-3",children:t.jsx("i",{className:"bi bi-file-earmark-check text-success"})}),t.jsxs("div",{children:[t.jsx("h6",{className:"mb-0 fw-bold text-success",children:"   "}),t.jsx("small",{className:"text-muted",children:te==null?void 0:te.originalFileName})]})]}),t.jsxs("div",{className:"mb-3",children:[t.jsxs("label",{className:"form-label fw-bold text-primary",children:[t.jsx("i",{className:"bi bi-tag me-1"}),"   *"]}),t.jsx("input",{type:"text",className:"form-control",value:F,onChange:oe=>X(oe.target.value),placeholder:"   ",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:oe=>{oe.target.style.borderColor="#28a745",oe.target.style.boxShadow="0 0 0 0.2rem rgba(40, 167, 69, 0.25)"},onBlur:oe=>{oe.target.style.borderColor="#e9ecef",oe.target.style.boxShadow="none"},autoFocus:!0}),t.jsxs("small",{className:"text-muted",children:[t.jsx("i",{className:"bi bi-info-circle me-1"}),"        "]})]})]})}),t.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:t.jsxs("div",{className:"d-flex justify-content-end",style:{gap:"12px"},children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:re,style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500"},children:""}),t.jsxs("button",{type:"button",className:"btn btn-success",onClick:se,disabled:!F.trim(),style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500",opacity:F.trim()?1:.6},children:[t.jsx("i",{className:"bi bi-check-lg me-1"}),""]})]})})]})})})]})})})}function xz(){return t.jsx(gz,{})}const yz=({searchTerm:n})=>{const[e,s]=h.useState(0),[r,i]=h.useState(0);h.useEffect(()=>{a()},[n]);const a=async()=>{try{const o=await br.getAllJournalEntries(),l=o.find(u=>u.referenceNumber==="01"),c=o.filter(u=>u.referenceNumber!=="01"),d=l?[l,...c]:c;if(s(d.length),n!=null&&n.trim()){const u=d.filter(f=>{var p,j,L,R;return((p=f.description)==null?void 0:p.toLowerCase().includes(n.toLowerCase()))||((j=f.referenceNumber)==null?void 0:j.toLowerCase().includes(n.toLowerCase()))||((L=f.totalDebit)==null?void 0:L.toString().includes(n))||((R=f.totalCredit)==null?void 0:R.toString().includes(n))});i(u.length)}else i(d.length)}catch(o){console.error("Error loading journal entries count:",o),s(0),i(0)}};return t.jsx("span",{className:"badge bg-secondary ms-2",style:{fontSize:"12px",fontWeight:"normal"},children:n!=null&&n.trim()?`${r}  ${e}`:e})},bz=({searchTerm:n,refreshTrigger:e,onViewDetails:s,onEdit:r,onReverse:i,onDelete:a})=>{const[o,l]=h.useState([]),[c,d]=h.useState(!1);h.useEffect(()=>{u()},[e,n]);const u=async()=>{d(!0);try{const f=await br.getAllJournalEntries(),p=f.find(D=>D.referenceNumber==="01"),j=f.filter(D=>D.referenceNumber!=="01");p||console.log(" Opening journal not found in Firestore, will be created when accessed");const L=p?[p,...j]:j;let R=L;n!=null&&n.trim()&&(R=L.filter(D=>{var y,T,x,S;return((y=D.description)==null?void 0:y.toLowerCase().includes(n.toLowerCase()))||((T=D.referenceNumber)==null?void 0:T.toLowerCase().includes(n.toLowerCase()))||((x=D.totalDebit)==null?void 0:x.toString().includes(n))||((S=D.totalCredit)==null?void 0:S.toString().includes(n))})),l(R)}catch(f){console.error("Error loading journal entries:",f)}finally{d(!1)}};return c?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"spinner-border text-primary",role:"status",children:t.jsx("span",{className:"visually-hidden",children:" ..."})}),t.jsx("div",{className:"mt-2 text-muted",children:"  ..."})]}):o.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("i",{className:"bi bi-journal-bookmark text-muted",style:{fontSize:"3rem"}}),t.jsx("h5",{className:"mt-3 text-muted",children:"   "}),t.jsx("p",{className:"text-muted",children:"       ."})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-striped table-hover mb-0",children:[t.jsx("thead",{className:"table-light sticky-top",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"text-center",children:" "}),t.jsx("th",{scope:"col",className:"text-center",children:""}),t.jsx("th",{scope:"col",className:"text-center",children:""}),t.jsx("th",{scope:"col",className:"text-center",children:" /"}),t.jsx("th",{scope:"col",className:"text-center",children:" "}),t.jsx("th",{scope:"col",className:"text-center",children:""}),t.jsx("th",{scope:"col",className:"text-center",style:{width:"120px"},children:""})]})}),t.jsx("tbody",{children:o.map((f,p)=>{var j;return t.jsxs("tr",{children:[t.jsx("td",{className:"text-center fw-medium",children:t.jsx("a",{href:"#",className:"text-primary text-decoration-none fw-medium",onClick:L=>{L.preventDefault(),r(f)},style:{cursor:"pointer"},title:"  ",children:f.referenceNumber||"-"})}),t.jsx("td",{className:"text-center fw-medium",children:t.jsx("a",{href:"#",className:"text-primary text-decoration-none fw-medium",onClick:L=>{L.preventDefault(),r(f)},style:{cursor:"pointer"},title:"  ",children:f.description||" "})}),t.jsx("td",{className:"text-center",children:br.formatDate(f.date)||"-"}),t.jsx("td",{className:"text-center fw-medium",children:br.formatCurrency(f.totalDebit||f.totalCredit)}),t.jsx("td",{className:"text-center",children:t.jsxs("span",{className:"badge bg-info fs-7",children:[br.formatNumber(((j=f.lines)==null?void 0:j.length)||0)," "]})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:`badge ${f.status==="active"?"bg-success":f.status==="reversed"?"bg-warning":"bg-secondary"} fs-7`,children:f.status==="active"?"":f.status==="reversed"?"":""})}),t.jsx("td",{className:"text-center",children:t.jsxs("div",{className:"btn-group btn-group-sm",style:{gap:"2px",position:"relative",zIndex:10},children:[t.jsx("button",{type:"button",className:"btn btn-outline-primary",title:" ",onClick:()=>s(f),children:t.jsx("i",{className:"bi bi-eye"})}),t.jsx("button",{type:"button",className:"btn btn-outline-primary",title:"",onClick:()=>r(f),disabled:f.status!=="active",children:t.jsx("i",{className:"bi bi-pencil"})}),f.referenceNumber!=="01"&&t.jsx("button",{type:"button",className:"btn btn-outline-primary",title:" ",onClick:()=>i(f),disabled:f.status!=="active",children:t.jsx("i",{className:"bi bi-arrow-counterclockwise"})}),f.referenceNumber!=="01"&&t.jsx("button",{type:"button",className:"btn btn-outline-danger",title:"",onClick:()=>a(f),disabled:f.status!=="active",children:t.jsx("i",{className:"bi bi-trash"})})]})})]},f.id||p)})})]})})};function wz(){const[n,e]=h.useState(!1),[s,r]=h.useState(0),[i,a]=h.useState(""),{isTimelineVisible:o}=Ut(),l=kt(),c=()=>{e(!n)},d=()=>{l("/journal-entry")},u=L=>{console.log("View details for:",L)},f=L=>{L.referenceNumber==="01"?l("/journal-entry?mode=opening"):l(`/journal-entry?id=${L.id}`)},p=async L=>{if(window.confirm(`       ${L.referenceNumber}`))try{await br.reverseJournalEntry(L.id,"  "),r(R=>R+1),alert("   ")}catch(R){console.error("Error reversing journal entry:",R),alert("    ")}},j=async L=>{if(window.confirm(`       ${L.referenceNumber}`))try{await br.deleteJournalEntry(L.id),r(R=>R+1),alert("   ")}catch(R){console.error("Error deleting journal entry:",R),alert("    ")}};return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:c}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!o?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsx("span",{className:"text-muted",children:""})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]})}),t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"20px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",style:{position:"sticky",top:"0",zIndex:10,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-journal-bookmark text-primary me-2"})," "]}),t.jsx(yz,{searchTerm:i})]}),t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[t.jsx("button",{onClick:()=>l("/journal-entry?mode=opening"),className:"btn btn-success",style:{height:"40px",width:"140px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:" "}),t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:i,onChange:L=>a(L.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsx("button",{onClick:d,className:"btn btn-primary",style:{height:"40px",width:"140px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:" "})]})]})}),t.jsx("div",{style:{height:"calc(100vh - 280px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"card-body p-0",children:t.jsx(bz,{searchTerm:i,refreshTrigger:s,onViewDetails:u,onEdit:f,onReverse:p,onDelete:j})})})]})}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}),!n&&o&&t.jsx(os,{rtl:!0}),!n&&o&&t.jsx(ls,{})]})})})}function vz(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(wz,{})})})}function Nz(){const[n,e]=h.useState(!1),[s,r]=h.useState([]),[i,a]=h.useState([]),[o,l]=h.useState(!0),[c,d]=h.useState(null),[u,f]=h.useState(""),[p,j]=h.useState(null),[L,R]=h.useState({filtered:0,total:0}),{isTimelineVisible:D}=Ut(),y=kt(),[T]=Eh(),x=T.get("returnPath")||"/tender-result",S=T.get("tenderId"),A=T.get("existingCompetitorIds")?T.get("existingCompetitorIds").split(","):[],{currentPage:Q,totalPages:q,paginatedItems:B,handlePageChange:$,resetPage:H,totalItems:te,itemsPerPage:G}=cr(i,30),F=()=>{e(!n)},X=N=>{console.log(" CompetitorSelection: Search term received:",N),f(N)},ue=()=>{console.log(" CompetitorSelection: Clearing search"),f("")},Y=h.useCallback(N=>{console.log(" CompetitorSelection: Search stats received:",N),R(N)},[]);h.useEffect(()=>{console.log(" CompetitorSelection: Search term state changed to:",u)},[u]);const z=async()=>{try{l(!0);const N=await md.getAllCompetitors(),P=Kf(N).filter(_=>_.active!==!1);r(P),d(null)}catch(N){d(N.message)}finally{l(!1)}};h.useEffect(()=>{z()},[]),h.useEffect(()=>{if(console.log(" CompetitorSelection: Search term changed:",u),u&&u.trim()){const N=u.toLowerCase(),I=s.filter(P=>{var _,C,U,w,W,ie;return((_=P.name)==null?void 0:_.toLowerCase().includes(N))||((C=P.email)==null?void 0:C.toLowerCase().includes(N))||((U=P.phone)==null?void 0:U.includes(u))||((w=P.contactPerson)==null?void 0:w.toLowerCase().includes(N))||((W=P.category)==null?void 0:W.toLowerCase().includes(N))||((ie=P.city)==null?void 0:ie.toLowerCase().includes(N))});console.log(" CompetitorSelection: Filtered results:",I.length,"of",s.length),a(I)}else console.log(" CompetitorSelection: No search, showing all competitors"),a(s);H()},[u,s,H]),h.useEffect(()=>{const N=i.length,I=s.length;console.log(" CompetitorSelection: Reporting stats:",{filtered:N,total:I}),Y({filtered:N,total:I})},[i.length,s.length,Y]);const O=N=>A.includes(N),E=N=>{O(N.id)||j(N)},k=()=>{if(!p)return;const N={id:p.id,name:p.name,email:p.email,phone:p.phone,city:p.city,type:"competitor"};sessionStorage.setItem("selectedCompetitor",JSON.stringify(N)),y(`${x}?tenderId=${S}`)},b=()=>{y(`${x}?tenderId=${S}`)};return o?t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:F}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!D?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsx("div",{className:"app-container",children:t.jsx("div",{className:"app-content-area p-4",children:t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"spinner-border text-primary",role:"status",children:t.jsx("span",{className:"visually-hidden",children:" ..."})}),t.jsx("p",{className:"mt-3 text-muted",children:"   ..."})]})})})})]})]}):c?t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:F}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!D?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsx("div",{className:"app-container",children:t.jsx("div",{className:"app-content-area p-4",children:t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:c}),t.jsx("div",{className:"d-flex gap-2 justify-content-center",children:t.jsxs("button",{className:"btn btn-primary",onClick:z,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"  "]})})]})})})})]})]}):t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:F}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!D?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item text-primary",children:" "}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:""})]})}),t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"20px"},children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsx("div",{className:"d-flex align-items-center",children:t.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[t.jsx("i",{className:"bi bi-trophy text-primary me-2"})," "]})}),t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[t.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px",pointerEvents:"auto"},children:[t.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"  ...",value:u,onChange:N=>X(N.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"40px",pointerEvents:"auto"}}),t.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:t.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("button",{onClick:b,className:"btn btn-outline-secondary",style:{height:"40px",width:"80px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:""}),t.jsx("button",{onClick:k,disabled:!p,className:"btn btn-primary",style:{height:"40px",width:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:" "})]})]})]})}),t.jsx(Yf,{searchTerm:u,filteredCount:L.filtered,totalCount:L.total,onClearSearch:ue}),t.jsx("div",{style:{height:"calc(100vh - 280px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"card-body p-0",children:i.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("div",{className:"text-muted mb-3",children:t.jsx("i",{className:"bi bi-trophy fs-1"})}),t.jsx("h5",{className:"text-muted",children:"  "}),t.jsx("p",{className:"text-muted",children:u?"    ":"     "}),u&&t.jsxs("button",{className:"btn btn-primary",onClick:ue,children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"})," "]})]}):t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover custom-striped mb-0",style:{tableLayout:"fixed"},children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:"60px",textAlign:"center"},children:"#"}),t.jsx("th",{style:{width:"25%",textAlign:"right"},children:" "}),t.jsx("th",{style:{width:"25%",textAlign:"right"},children:" "}),t.jsx("th",{style:{width:"15%",textAlign:"center"},children:""}),t.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),t.jsx("th",{style:{width:"120px",textAlign:"center"},children:""})]})}),t.jsx("tbody",{children:B.map((N,I)=>{const P=O(N.id),_=P?{textDecoration:"line-through",opacity:"0.6",color:"#6c757d"}:{};return t.jsxs("tr",{onClick:()=>E(N),style:{cursor:P?"not-allowed":"pointer",backgroundColor:(p==null?void 0:p.id)===N.id?"#e3f2fd":"inherit",..._},className:(p==null?void 0:p.id)===N.id?"table-active":"",children:[t.jsx("td",{className:"text-center",style:{verticalAlign:"middle"},children:t.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(Q-1)*G+I+1})}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:t.jsxs("span",{className:`fw-bold competitor-name-link ${P?"text-muted":"text-primary"}`,style:{cursor:P?"not-allowed":"pointer",textDecoration:P?"line-through":"none",color:P?"#6c757d":(p==null?void 0:p.id)===N.id?"#0056b3":"#007bff"},title:P?`${N.name} -  `:N.name,children:[N.name,P&&t.jsx("span",{className:"ms-2 badge bg-secondary px-2 py-1",style:{fontSize:"11px"},children:""})]})}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:t.jsx("a",{href:`mailto:${N.email}`,className:`text-decoration-none ${P?"text-muted":""}`,style:P?{textDecoration:"line-through"}:{},children:N.email})}),t.jsx("td",{style:{direction:"ltr",textAlign:"center",verticalAlign:"middle",...P?{textDecoration:"line-through"}:{}},children:t.jsx("span",{style:{direction:"ltr",display:"inline-block",textAlign:"left",fontFamily:"monospace",...P?{textDecoration:"line-through"}:{}},children:N.phone})}),t.jsx("td",{style:{textAlign:"right",verticalAlign:"middle",paddingRight:"15px"},children:t.jsx("span",{style:P?{textDecoration:"line-through"}:{},children:N.city||"-"})}),t.jsx("td",{style:{textAlign:"center",verticalAlign:"middle"},children:t.jsx("div",{className:"form-check d-flex justify-content-center",children:t.jsx("input",{className:"form-check-input",type:"radio",name:"selectedCompetitor",checked:(p==null?void 0:p.id)===N.id&&!P,disabled:P,onChange:()=>{},style:{pointerEvents:"none",width:"18px",height:"18px",borderWidth:"2px",...P?{opacity:"0.6"}:{}}})})})]},N.internalId||N.id)})})]})})})})]})})]}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]}),i.length>0&&t.jsx("div",{style:{position:"fixed",bottom:"50px",left:"50%",transform:"translateX(-50%)",zIndex:12},children:t.jsx(dr,{currentPage:Q,totalPages:q,onPageChange:$,totalItems:te,itemsPerPage:G})})]})}class Ei{static async getTenderResult(e){try{if(console.log(" TENDER RESULT: Fetching result for tender ID:",e),!ae)throw new Error("Firestore not initialized");const s=Le(ae,this.COLLECTION_TENDER_RESULTS,e),r=await ss(s);if(r.exists()){const i={id:r.id,...r.data()};return console.log(" TENDER RESULT: Found result data:",i),i}else return console.log(" TENDER RESULT: No result data found, will create new"),null}catch(s){throw console.error(" TENDER RESULT: Error fetching result:",s),new Error("    : "+s.message)}}static async saveTenderResult(e,s){try{if(console.log(" TENDER RESULT: Saving result for tender ID:",e),!ae)throw new Error("Firestore not initialized");const r=Le(ae,this.COLLECTION_TENDER_RESULTS,e),i={...s,tenderId:e,updatedAt:We(),...!s.createdAt&&{createdAt:We()}};return await yn(r,i,{merge:!0}),console.log(" TENDER RESULT: Result saved successfully"),i}catch(r){throw console.error(" TENDER RESULT: Error saving result:",r),new Error("    : "+r.message)}}static async getCompetitorPrices(e){try{if(console.log(" COMPETITOR PRICES: Fetching prices for tender ID:",e),!ae)throw new Error("Firestore not initialized");const s=st(Pe(ae,this.COLLECTION_COMPETITOR_PRICES),xt("tenderId","==",e)),r=await qe(s),i=[];r.forEach(l=>{i.push({id:l.id,...l.data()})});const a=new Map;i.forEach(l=>{var d,u;const c=l.competitorId;if(c)if(!a.has(c))a.set(c,l);else{const p=((d=a.get(c).addedAt)==null?void 0:d.seconds)||0;(((u=l.addedAt)==null?void 0:u.seconds)||0)>p&&a.set(c,l)}});const o=Array.from(a.values());return o.sort((l,c)=>{var f,p;const d=((f=l.addedAt)==null?void 0:f.seconds)||0;return(((p=c.addedAt)==null?void 0:p.seconds)||0)-d}),console.log(` COMPETITOR PRICES: Deduplicated ${i.length}  ${o.length} unique competitors`),console.log(" COMPETITOR PRICES: Final unique competitor prices:",o.length),o}catch(s){throw console.error(" COMPETITOR PRICES: Error fetching prices:",s),new Error("    : "+s.message)}}static async competitorExists(e,s){try{if(!ae)throw new Error("Firestore not initialized");const r=st(Pe(ae,this.COLLECTION_COMPETITOR_PRICES),xt("tenderId","==",e),xt("competitorId","==",s)),a=!(await qe(r)).empty;return console.log(` COMPETITOR CHECK: Competitor ${s} exists in tender ${e}: ${a}`),a}catch(r){return console.error(" COMPETITOR CHECK: Error checking competitor existence:",r),!1}}static async addCompetitorPrice(e,s){try{if(console.log(" COMPETITOR PRICES: Adding competitor price for tender ID:",e),!ae)throw new Error("Firestore not initialized");if(await this.competitorExists(e,s.competitorId))throw console.log(" COMPETITOR PRICES: Competitor already exists, preventing duplicate"),new Error(` ${s.competitorName}    `);const a={internalId:`cp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,tenderId:e,competitorId:s.competitorId,competitorName:s.competitorName,competitorEmail:s.competitorEmail||"",competitorPhone:s.competitorPhone||"",competitorCity:s.competitorCity||"",price:parseFloat(s.price)||0,addedAt:We(),updatedAt:We(),createdBy:s.createdBy||"system"},o=await As(Pe(ae,this.COLLECTION_COMPETITOR_PRICES),a);return console.log(" COMPETITOR PRICES: Added competitor price with ID:",o.id),{id:o.id,...a}}catch(r){throw console.error(" COMPETITOR PRICES: Error adding competitor price:",r),new Error("    : "+r.message)}}static async updateCompetitorPrice(e,s){try{if(console.log(" COMPETITOR PRICES: Updating competitor price ID:",e),!ae)throw new Error("Firestore not initialized");const r=Le(ae,this.COLLECTION_COMPETITOR_PRICES,e),i={...s,price:parseFloat(s.price)||0,updatedAt:We()};return await Qt(r,i),console.log(" COMPETITOR PRICES: Updated competitor price successfully"),i}catch(r){throw console.error(" COMPETITOR PRICES: Error updating competitor price:",r),new Error("    : "+r.message)}}static async deleteCompetitorPrice(e){try{if(console.log(" COMPETITOR PRICES: Deleting competitor price ID:",e),!ae)throw new Error("Firestore not initialized");const s=Le(ae,this.COLLECTION_COMPETITOR_PRICES,e);return await es(s),console.log(" COMPETITOR PRICES: Deleted competitor price successfully"),!0}catch(s){throw console.error(" COMPETITOR PRICES: Error deleting competitor price:",s),new Error("    : "+s.message)}}static async checkCompetitorExists(e,s){try{if(console.log(" COMPETITOR PRICES: Checking if competitor exists for tender:",e,"competitor:",s),!ae)throw new Error("Firestore not initialized");const r=st(Pe(ae,this.COLLECTION_COMPETITOR_PRICES),xt("tenderId","==",e),xt("competitorId","==",s)),a=!(await qe(r)).empty;return console.log(" COMPETITOR PRICES: Competitor exists:",a),a}catch(r){throw console.error(" COMPETITOR PRICES: Error checking competitor existence:",r),new Error("    : "+r.message)}}static async deleteAllCompetitorPrices(e){try{if(console.log(" COMPETITOR PRICES: Deleting all competitor prices for tender ID:",e),!ae)throw new Error("Firestore not initialized");const s=st(Pe(ae,this.COLLECTION_COMPETITOR_PRICES),xt("tenderId","==",e)),r=await qe(s);if(r.empty)return console.log(" COMPETITOR PRICES: No competitor prices to delete"),0;const i=Fr(ae);let a=0;return r.forEach(o=>{i.delete(o.ref),a++}),await i.commit(),console.log(" COMPETITOR PRICES: Deleted",a,"competitor prices"),a}catch(s){throw console.error(" COMPETITOR PRICES: Error batch deleting competitor prices:",s),new Error("    : "+s.message)}}static async getTenderResultStats(e){try{console.log(" TENDER RESULT: Calculating stats for tender ID:",e);const s=await this.getCompetitorPrices(e),r=await this.getTenderResult(e);let i=0;console.log(" TENDER RESULT: Fetching our price from tender study...");const a=await Hl.getTenderStudy(e);a!=null&&a.success&&(a!=null&&a.data)?(i=parseFloat(a.data.finalPrice||a.data._||a.data.totalPrice||a.data.total||0),console.log(" TENDER RESULT: Found our price from tender study:",i),console.log(" TENDER RESULT: Study data keys:",Object.keys(a.data))):(console.log(" TENDER RESULT: No tender study found, trying tender result..."),i=parseFloat((r==null?void 0:r.ourPrice)||0),console.log(" TENDER RESULT: Using tender result ourPrice:",i));const o=s.map(d=>parseFloat(d.price)||0).filter(d=>d>0),l=[i,...o].filter(d=>d>0),c={ourPrice:i,lowestPrice:l.length>0?Math.min(...l):0,highestPrice:l.length>0?Math.max(...l):0,averagePrice:l.length>0?l.reduce((d,u)=>d+u,0)/l.length:0,competitorCount:o.length,totalBids:l.length};return console.log(" TENDER RESULT: Calculated stats with our price included:",c),c}catch(s){throw console.error(" TENDER RESULT: Error calculating stats:",s),new Error("    : "+s.message)}}static async migrateFromLocalStorage(e){try{console.log(" MIGRATION: Migrating competitor prices from localStorage for tender:",e);const s=`competitorPrices_${e}`,r=localStorage.getItem(s);if(!r)return console.log(" MIGRATION: No localStorage data to migrate"),{migrated:0};const i=JSON.parse(r);if(!Array.isArray(i)||i.length===0)return console.log(" MIGRATION: No valid competitor prices to migrate"),{migrated:0};let a=0;for(const o of i)try{await this.checkCompetitorExists(e,o.competitorId)||(await this.addCompetitorPrice(e,o),a++)}catch(l){console.warn(" MIGRATION: Failed to migrate competitor:",o.competitorName,l)}return a>0&&(localStorage.removeItem(s),console.log(" MIGRATION: Successfully migrated",a,"competitor prices and cleared localStorage")),{migrated:a}}catch(s){throw console.error(" MIGRATION: Error migrating from localStorage:",s),new Error("   : "+s.message)}}static async testConnection(){try{if(!ae)throw new Error("Firestore not initialized");const e=Pe(ae,this.COLLECTION_TENDER_RESULTS);return await qe(e),console.log(" TENDER RESULT SERVICE: Firestore connection test successful"),!0}catch(e){return console.error(" TENDER RESULT SERVICE: Firestore connection test failed:",e),!1}}}Ys(Ei,"COLLECTION_TENDER_RESULTS","tenderResults"),Ys(Ei,"COLLECTION_COMPETITOR_PRICES","competitorPrices");const jz=Object.freeze(Object.defineProperty({__proto__:null,TenderResultService:Ei,default:Ei},Symbol.toStringTag,{value:"Module"}));function Sz(){var I;const[n,e]=h.useState(!1),[s,r]=h.useState([]),[i,a]=h.useState(!0),[o,l]=h.useState(null),[c,d]=h.useState(null),[u,f]=h.useState(!1),[p,j]=h.useState(!1),[L,R]=h.useState({visible:!1,x:0,y:0,arrowX:50,content:{name:"",price:0}}),{alertConfig:D,closeAlert:y,showSuccess:T,showError:x,showConfirm:S}=Bt(),{isTimelineVisible:A}=Ut(),Q=kt(),[q]=Eh(),B=q.get("tenderId"),{tenderData:$,loading:H,error:te}=U0(B,!1),G=()=>{e(!n)},F=h.useCallback(async()=>{try{console.log(" TENDER RESULT: Initializing Firestore...");const P=await Ei.testConnection();if(j(P),P){if(console.log(" TENDER RESULT: Firestore connected successfully"),B){const _=await Ei.migrateFromLocalStorage(B);_.migrated>0&&(console.log(" TENDER RESULT: Migrated",_.migrated,"competitor prices from localStorage"),T(`  ${_.migrated}      `,"  "))}}else console.warn(" TENDER RESULT: Firestore not available, falling back to localStorage")}catch(P){console.error(" TENDER RESULT: Error initializing Firestore:",P),j(!1)}},[B,T]),X=h.useCallback(async()=>{try{if(a(!0),console.log(" TENDER RESULT: Loading competitor prices..."),p){const P=await Ei.getCompetitorPrices(B);console.log(" TENDER RESULT: Loaded competitor prices from Firestore:",P.length),r(P)}else{console.log(" TENDER RESULT: Loading competitor prices from localStorage (fallback)");const P=localStorage.getItem(`competitorPrices_${B}`);if(P){const _=JSON.parse(P),C=new Map;_.forEach(w=>{const W=w.competitorId;if(W)if(!C.has(W))C.set(W,w);else{const ie=C.get(W),de=new Date(ie.addedAt||0).getTime();new Date(w.addedAt||0).getTime()>de&&C.set(W,w)}});const U=Array.from(C.values());console.log(` TENDER RESULT: LocalStorage deduplicated ${_.length}  ${U.length} unique competitors`),r(U),console.log(" TENDER RESULT: Loaded competitor prices from localStorage:",U.length)}}l(null)}catch(P){console.error(" TENDER RESULT: Error loading competitor prices:",P),l("    ")}finally{a(!1)}},[B,p]),ue=h.useCallback(async()=>{if(B)try{console.log(" TENDER RESULT: Loading tender study data for:",B);const P=await Hl.getTenderStudy(B);P.success?(d(P.data),console.log(" TENDER RESULT: Tender study data loaded:",P.data)):(console.log(" TENDER RESULT: No tender study data found"),d(null))}catch(P){console.error(" TENDER RESULT: Error loading tender study data:",P),d(null)}},[B]);h.useEffect(()=>{B&&F()},[B,F]),h.useEffect(()=>{B&&p!==null&&(X(),ue())},[B,p,X,ue]),h.useEffect(()=>{const P=sessionStorage.getItem("selectedCompetitor");if(P){const _=JSON.parse(P);(async()=>{try{if(p){if(await Ei.checkCompetitorExists(B,_.id)){console.log(" COMPETITOR: Competitor already exists in Firestore:",_.name),sessionStorage.removeItem("selectedCompetitor");return}await Ei.addCompetitorPrice(B,{competitorId:_.id,competitorName:_.name,competitorEmail:_.email,competitorPhone:_.phone,competitorCity:_.city,price:0}),console.log(" COMPETITOR: Added new competitor to Firestore:",_.name)}else r(U=>{if(!U.some(W=>W.competitorId===_.id)){const W={competitorId:_.id,competitorName:_.name,competitorEmail:_.email,competitorPhone:_.phone,competitorCity:_.city,price:0,addedAt:new Date().toISOString()},ie=[...U,W];return localStorage.setItem(`competitorPrices_${B}`,JSON.stringify(ie)),ie}return U});await X()}catch(U){console.error(" COMPETITOR: Error adding competitor:",U),x("    ","  ")}finally{sessionStorage.removeItem("selectedCompetitor")}})()}},[B,p,X,x]);const Y=()=>{const P=s.map(C=>C.competitorId).join(","),_=P?`&existingCompetitorIds=${P}`:"";Q(`/competitor-selection?tenderId=${B}&returnPath=/tender-result${_}`)},z=async(P,_)=>{try{const C=parseFloat(_)||0;if(p){const U=s.find(w=>w.competitorId===P);U&&U.id&&await Ei.updateCompetitorPrice(U.id,{price:C})}else{const U=s.map(w=>w.competitorId===P?{...w,price:C,updatedAt:new Date().toISOString()}:w);r(U),localStorage.setItem(`competitorPrices_${B}`,JSON.stringify(U))}r(U=>U.map(w=>w.competitorId===P?{...w,price:C}:w))}catch(C){console.error(" COMPETITOR: Error updating competitor price:",C),x("     ","  ")}},O=P=>{S(`      

${P.competitorName}`,()=>E(P),"  ")},E=async P=>{try{if(f(!0),p)P.id&&await Ei.deleteCompetitorPrice(P.id);else{const _=s.filter(C=>C.competitorId!==P.competitorId);localStorage.setItem(`competitorPrices_${B}`,JSON.stringify(_))}r(_=>_.filter(C=>C.competitorId!==P.competitorId)),T(`  : ${P.competitorName}`,"  ")}catch(_){console.error(" COMPETITOR: Error deleting competitor:",_),x("    ","  ")}finally{f(!1)}},k=()=>{var xe;const P=((xe=c==null?void 0:c.profitCalculation)==null?void 0:xe.finalPrice)||0,_=parseFloat(P)||0,C=s.filter((Ee,Re,fe)=>fe.findIndex(Ve=>Ve.competitorId===Ee.competitorId)===Re).map(Ee=>({price:parseFloat(Ee.price)||0,name:Ee.competitorName,competitorId:Ee.competitorId})).filter(Ee=>Ee.price>0&&Ee.name&&Ee.name.trim());console.log(" PRICE STATS: Filtered unique competitors:",C.length,"from",s.length);const U=[{price:_,name:"  ",competitorId:"our_company"},...C].filter(Ee=>Ee.price>0),w=U.map(Ee=>Ee.price),W=w.length>0?Math.min(...w):0,ie=w.length>0?Math.max(...w):0,de=U.filter(Ee=>Ee.price===W),ne=U.filter(Ee=>Ee.price===ie),ye=de.find(Ee=>Ee.competitorId==="our_company")||de[0],pe=ne.find(Ee=>Ee.competitorId==="our_company")||ne[0],be={ourPrice:_,lowestPrice:W,highestPrice:ie,averagePrice:w.length>0?w.reduce((Ee,Re)=>Ee+Re,0)/w.length:0,competitorCount:C.length,lowestPriceCompetitor:(ye==null?void 0:ye.name)||"",highestPriceCompetitor:(pe==null?void 0:pe.name)||"",totalBids:w.length};return console.log(" PRICE STATS: Calculated with unique competitors:",be),be},b=P=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(P||0),N=k();return i||H?t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:G}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!A?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsx("div",{className:"app-container",children:t.jsx("div",{className:"app-content-area p-4",children:t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"spinner-border text-primary",role:"status",children:t.jsx("span",{className:"visually-hidden",children:" ..."})}),t.jsx("p",{className:"mt-3 text-muted",children:p?"      ...":"   ..."})]})})})})]})]}):o||te?t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:G}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!A?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsx("div",{className:"app-container",children:t.jsx("div",{className:"app-content-area p-4",children:t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-danger mb-3",children:t.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),t.jsx("h5",{className:"text-danger",children:" "}),t.jsx("p",{className:"text-muted",children:o||te}),!p&&t.jsx("div",{className:"mt-3",children:t.jsxs("span",{className:"badge bg-warning",children:[t.jsx("i",{className:"bi bi-wifi-off me-1"}),"   -   "]})})]})})})})]})]}):$?t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:G}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!A?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsxs("div",{className:"app-hero-header d-flex align-items-center justify-content-between px-3 py-2 border-top bg-white sticky-top",style:{zIndex:5},children:[t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsx("a",{href:"/tenders",className:"text-decoration-none text-primary",children:""})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]}),t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[!p&&t.jsxs("span",{className:"badge bg-warning",children:[t.jsx("i",{className:"bi bi-wifi-off me-1"}),"  "]}),t.jsxs("h6",{className:"mb-0 text-primary fw-bold",children:[t.jsx("i",{className:"bi bi-trophy me-2"})," "]})]})]}),t.jsxs("div",{className:"app-content-area p-4",style:{maxHeight:"calc(100vh - 140px)",overflowY:"auto",scrollbarWidth:"thin"},children:[t.jsxs("div",{className:"card shadow-sm mb-4",children:[t.jsx("div",{className:"card-header bg-primary text-white",children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-trophy me-2"})," : ",$.title]}),t.jsxs("span",{className:"badge bg-light text-dark fs-6",children:[": ",$.referenceNumber]})]})}),t.jsxs("div",{className:"card-body",children:[t.jsxs("div",{className:"row",children:[t.jsx("div",{className:"col-lg-3 col-md-6",children:t.jsxs("p",{className:"mb-2",children:[t.jsx("i",{className:"bi bi-building me-2 text-primary"}),t.jsx("strong",{children:":"})," ",$.entity]})}),t.jsx("div",{className:"col-lg-3 col-md-6",children:t.jsxs("p",{className:"mb-2",children:[t.jsx("i",{className:"bi bi-calendar-event me-2 text-primary"}),t.jsx("strong",{children:" :"})," ",(()=>{const P=$.submissionDeadline;return P?P&&typeof P=="object"&&P.seconds?new Date(P.seconds*1e3).toLocaleDateString("en-GB"):P&&typeof P=="object"&&P.toDate?P.toDate().toLocaleDateString("en-GB"):new Date(P).toLocaleDateString("en-GB"):" "})()]})})]}),t.jsxs("div",{className:"row",children:[t.jsx("div",{className:"col-lg-3 col-md-6",children:t.jsxs("p",{className:"mb-2",children:[t.jsx("i",{className:"bi bi-currency-exchange me-2 text-success"}),t.jsx("strong",{children:" :"})," ",t.jsx("span",{className:"fw-bold text-success",children:b(((I=c==null?void 0:c.profitCalculation)==null?void 0:I.finalPrice)||0)})]})}),t.jsx("div",{className:"col-lg-3 col-md-6",children:t.jsxs("p",{className:"mb-2",children:[t.jsx("i",{className:"bi bi-people me-2 text-primary"}),t.jsx("strong",{children:" :"})," ",t.jsx("span",{className:"badge bg-primary",children:N.totalBids.toLocaleString("en-US")})]})}),$.description&&t.jsx("div",{className:"col-lg-6 col-md-12",children:t.jsxs("p",{className:"mb-2",children:[t.jsx("i",{className:"bi bi-file-text me-2 text-primary"}),t.jsx("strong",{children:":"})," ",t.jsx("span",{className:"text-muted",children:$.description})]})})]})]})]}),t.jsxs("div",{className:"row mb-4",children:[t.jsx("div",{className:"col-xl-3 col-lg-6 mb-3",children:t.jsx("div",{className:"card h-100 shadow-sm border-0",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"8px"},children:t.jsxs("div",{className:"card-body text-white text-center",children:[t.jsx("div",{className:"mb-3",children:t.jsx("i",{className:"bi bi-house-check-fill fs-1"})}),t.jsx("h6",{className:"card-title mb-2",children:"  "}),t.jsx("h3",{className:"mb-0 fw-bold",children:b(N.ourPrice)}),N.ourPrice===N.lowestPrice&&N.competitorCount>0&&t.jsxs("small",{className:"d-block mt-2",children:[t.jsx("i",{className:"bi bi-trophy me-2"})," "]}),(()=>{const P=[{price:N.ourPrice,name:"  ",competitorId:"our_company"},...s.filter((U,w,W)=>W.findIndex(ie=>ie.competitorId===U.competitorId)===w).map(U=>({price:parseFloat(U.price)||0,name:U.competitorName,competitorId:U.competitorId})).filter(U=>U.price>0&&U.name&&U.name.trim())].filter(U=>U.price>0);P.sort((U,w)=>U.price-w.price);const _=P.findIndex(U=>U.competitorId==="our_company")+1,C=P.length;return _>0&&C>1?t.jsxs("small",{className:"d-block mt-2",style:{fontSize:"14px"},children:[" ",_]}):null})()]})})}),t.jsx("div",{className:"col-xl-3 col-lg-6 mb-3",children:t.jsx("div",{className:"card h-100 shadow-sm border-0",style:{background:"linear-gradient(135deg, #007bff 0%, #6610f2 100%)",borderRadius:"8px"},children:t.jsxs("div",{className:"card-body text-white text-center",children:[t.jsx("div",{className:"mb-3",children:t.jsx("i",{className:"bi bi-arrow-down-circle-fill fs-1"})}),t.jsx("h6",{className:"card-title mb-2",children:" "}),t.jsx("h3",{className:"mb-0 fw-bold",children:b(N.lowestPrice)}),N.lowestPriceCompetitor&&t.jsx("small",{className:"d-block mt-2 fw-bold",style:{fontSize:"13px"},children:N.lowestPriceCompetitor}),t.jsxs("small",{className:"d-block mt-1",children:["  ",(N.competitorCount+(N.ourPrice>0?1:0)).toLocaleString("en-US")," "]})]})})}),t.jsx("div",{className:"col-xl-3 col-lg-6 mb-3",children:t.jsx("div",{className:"card h-100 shadow-sm border-0",style:{background:"linear-gradient(135deg, #dc3545 0%, #e83e8c 100%)",borderRadius:"8px"},children:t.jsxs("div",{className:"card-body text-white text-center",children:[t.jsx("div",{className:"mb-3",children:t.jsx("i",{className:"bi bi-arrow-up-circle-fill fs-1"})}),t.jsx("h6",{className:"card-title mb-2",children:" "}),t.jsx("h3",{className:"mb-0 fw-bold",children:b(N.highestPrice)}),N.highestPriceCompetitor&&t.jsx("small",{className:"d-block mt-2 fw-bold",style:{fontSize:"13px"},children:N.highestPriceCompetitor}),t.jsxs("small",{className:"d-block mt-1",children:["  ",(N.competitorCount+(N.ourPrice>0?1:0)).toLocaleString("en-US")," "]})]})})}),t.jsx("div",{className:"col-xl-3 col-lg-6 mb-3",children:t.jsx("div",{className:"card h-100 shadow-sm border-0",style:{background:"linear-gradient(135deg, #fd7e14 0%, #ffc107 100%)",borderRadius:"8px"},children:t.jsxs("div",{className:"card-body text-white text-center",children:[t.jsx("div",{className:"mb-3",children:t.jsx("i",{className:"bi bi-calculator-fill fs-1"})}),t.jsx("h6",{className:"card-title mb-2",children:" "}),t.jsx("h3",{className:"mb-0 fw-bold",children:b(N.averagePrice)}),t.jsx("small",{className:"d-block mt-2",children:"  "})]})})})]}),(s.length>0||N.ourPrice>0)&&t.jsx("div",{className:"mb-4",style:{background:"#FFFFFF",border:"1px solid #E1E5E9",borderRadius:"8px",overflow:"hidden",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:t.jsx("div",{className:"card-body p-0",children:(()=>{const P=[];N.ourPrice>0&&P.push({price:N.ourPrice,name:"  ",isOurs:!0});let _=1;if(s.filter((xe,Ee,Re)=>Re.findIndex(fe=>fe.competitorId===xe.competitorId)===Ee).forEach(xe=>{xe.price&&xe.price>0&&(P.push({price:parseFloat(xe.price),name:`${_}`,originalName:xe.competitorName,isOurs:!1}),_++)}),P.sort((xe,Ee)=>xe.price-Ee.price),P.length===0)return null;const C=Math.max(...P.map(xe=>xe.price)),U=Math.min(...P.map(xe=>xe.price)),W=(C-U)*.15,ie=Math.max(0,U-W),de=C+W,ne=(xe,Ee)=>{const Re=Ee-xe,fe=Math.pow(10,Math.floor(Math.log10(Re))),Ve=Re/fe;let $e;Ve<=1?$e=fe*.2:Ve<=2?$e=fe*.5:Ve<=5?$e=fe:$e=fe*2;const et=Math.floor(xe/$e)*$e,ze=Math.ceil(Ee/$e)*$e;return{yAxisMin:et,yAxisMax:ze,tickInterval:$e}},{yAxisMin:ye,yAxisMax:pe,tickInterval:be}=ne(ie,de);return t.jsxs("div",{style:{padding:"40px 30px 30px",overflow:"hidden"},children:[t.jsx("div",{style:{padding:"20px 20px 0 20px"},children:t.jsx("h4",{style:{color:"#333333",fontSize:"16px",fontWeight:"600",margin:"0 0 20px 0",fontFamily:"system-ui, -apple-system, sans-serif"},children:"  "})}),t.jsx("div",{style:{width:"100%",display:"flex",justifyContent:"center",overflow:"hidden"},children:t.jsxs("div",{id:"chart-container",style:{height:"450px",width:"100%",maxWidth:"1200px",background:"#FAFBFC",padding:"30px 20px",position:"relative",margin:"0"},children:[t.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 1200 400",style:{display:"block"},children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"areaGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#6CB4EE",stopOpacity:"0.7"}),t.jsx("stop",{offset:"100%",stopColor:"#6CB4EE",stopOpacity:"0.1"})]})}),(()=>{const xe=[];for(let Ee=ye;Ee<=pe;Ee+=be)xe.push(Ee);return xe.map((Ee,Re)=>{const Ve=80+280*((pe-Ee)/(pe-ye));return t.jsxs("g",{children:[t.jsx("line",{x1:"100",y1:Ve,x2:"1100",y2:Ve,stroke:"#E8E8E8",strokeWidth:"1"}),t.jsx("text",{x:"85",y:Ve+4,textAnchor:"end",fontSize:"12",fontWeight:"400",fill:"#666666",fontFamily:"system-ui, -apple-system, sans-serif",children:Math.round(Ee).toLocaleString("en-US")})]},Re)})})(),(()=>{const xe=P.map((Re,fe)=>{const Ve=100+(fe+1)/(P.length+1)*1e3,$e=360-(Re.price-ye)/(pe-ye||1)*280;return{x:Ve,y:$e,bid:Re}});let Ee=`M ${xe[0].x} 360`;Ee+=` L ${xe[0].x} ${xe[0].y}`;for(let Re=1;Re<xe.length;Re++){const fe=xe[Re],Ve=xe[Re-1],$e=(Ve.x+fe.x)/2;Ee+=` Q ${$e} ${Ve.y} ${fe.x} ${fe.y}`}return Ee+=` L ${xe[xe.length-1].x} 360 Z`,t.jsxs("g",{children:[t.jsx("path",{d:Ee,fill:"url(#areaGradient)",stroke:"#4A90E2",strokeWidth:"2",style:{animation:"fillArea 2s ease-out",transformOrigin:"bottom"}}),(()=>{const Re=360-(N.averagePrice-ye)/(pe-ye||1)*280;return t.jsxs("g",{children:[t.jsx("line",{x1:xe[0].x,y1:Re,x2:xe[xe.length-1].x,y2:Re,stroke:"#DC3545",strokeWidth:"1",strokeDasharray:"3,3",style:{opacity:.7,animation:"fadeUp 2s ease-out 0.5s both"}}),t.jsx("text",{x:"1105",y:Re+4,fontSize:"11",fontWeight:"500",fill:"#DC3545",fontFamily:"system-ui, -apple-system, sans-serif",children:" "})]})})(),xe.map((Re,fe)=>{const Ve=xe.map(ze=>ze.bid.price),$e=Math.min(...Ve),et=Re.bid.price===$e;return t.jsxs("g",{children:[et&&t.jsx("text",{x:Re.x,y:Re.y-35,textAnchor:"middle",dominantBaseline:"middle",style:{fontSize:"28px",fill:"#FFD700",filter:"drop-shadow(0 2px 4px rgba(255, 215, 0, 0.6))"},children:""}),t.jsx("circle",{cx:Re.x,cy:Re.y,r:et?"7":"5",fill:Re.bid.isOurs?"#28A745":et?"#FFD700":"#FFFFFF",stroke:Re.bid.isOurs?"#1E7E34":et?"#FFA000":"#29B6F6",strokeWidth:"2",style:{filter:et?"drop-shadow(0 4px 8px rgba(255, 215, 0, 0.5))":"drop-shadow(0 2px 4px rgba(0,0,0,0.3))",cursor:"pointer",animation:`pointDrop 1.5s ease-out ${fe*.1}s both`},onMouseEnter:ze=>{const tt=ze.target,rt=document.getElementById("chart-container");if(!rt||!tt)return;const bt=tt.getBoundingClientRect(),At=rt.getBoundingClientRect(),ns=Math.round(bt.left+bt.width/2-At.left),Ht=Math.round(bt.top+bt.height/2-At.top),is=180,Oe=60;let it=ns-is/2;const Kt=Ht-Oe-10,zs=ns,xs=10,cs=rt.offsetWidth;let Os=!1;it<xs?(it=xs,Os=!0):it+is>cs-xs&&(it=cs-is-xs,Os=!0);const vs=zs-it;let Z=vs/is*100;Z=Math.max(6,Math.min(94,Z)),console.log(` PERFECT ALIGNMENT Circle ${fe}:`,{circleCenter:ns,tooltipLeft:it,arrowOffset:vs,arrowPercentage:Z.toFixed(2)+"%",boundaryAdjusted:Os,name:Re.bid.name}),R({visible:!0,x:it,y:Kt,arrowX:Z,content:{name:Re.bid.originalName||Re.bid.name,price:Re.bid.price}})},onMouseLeave:()=>{R(ze=>({...ze,visible:!1}))}}),Re.bid.isOurs&&t.jsx("line",{x1:Re.x,y1:Re.y+5,x2:Re.x,y2:365,stroke:"#999999",strokeWidth:"1.5",strokeDasharray:"3,2",style:{animation:`fadeUp 2s ease-out ${fe*.1}s both`,opacity:.9}}),t.jsx("text",{x:Re.x,y:385,textAnchor:"middle",fontSize:"12",fontWeight:Re.bid.isOurs?"600":"400",fill:Re.bid.isOurs?"#495057":"#666666",fontFamily:"system-ui, -apple-system, sans-serif",style:{animation:`fadeUp 2s ease-out ${fe*.1}s both`},dx:"0",children:` ${Re.bid.name} `})]},fe)})]})})(),[0,.2,.4,.6,.8,1].map((xe,Ee)=>t.jsx("text",{x:"50",y:44+180*xe,textAnchor:"end",fontSize:"10",fill:"rgba(255,255,255,0.7)",children:b(C-xe*(C-U))},Ee))]}),t.jsxs("div",{style:{position:"absolute",top:"20px",right:"20px",background:"rgba(255,255,255,0.15)",borderRadius:"10px",padding:"12px",backdropFilter:"blur(10px)"},children:[t.jsxs("div",{className:"d-flex align-items-center gap-2 mb-2",children:[t.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:"#28A745",border:"2px solid #1E7E34"}}),t.jsx("small",{style:{color:"#666666",fontWeight:"bold"},children:""})]}),t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:"#FFFFFF",border:"2px solid #29B6F6"}}),t.jsx("small",{style:{color:"#666666"},children:""})]})]}),L.visible&&t.jsx("div",{style:{position:"absolute",left:`${L.x}px`,top:`${L.y}px`,pointerEvents:"none",zIndex:1e3,transform:"translateZ(0)",willChange:"transform"},children:t.jsxs("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",padding:"10px 16px",borderRadius:"8px",fontSize:"13px",whiteSpace:"nowrap",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.3)",border:"1px solid rgba(255,255,255,0.2)",position:"relative",textAlign:"center"},children:[t.jsx("div",{style:{fontWeight:600,marginBottom:"4px",textAlign:"center"},children:L.content.name}),t.jsx("div",{style:{color:"#FFD700",fontWeight:700,fontSize:"14px",textAlign:"center"},children:b(L.content.price)}),t.jsx("div",{style:{position:"absolute",bottom:"-6px",left:`${L.arrowX}%`,transform:"translateX(-50%)",width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid #667eea",imageRendering:"pixelated",shapeRendering:"crispEdges"}})]})})]})})]})})()})}),(s.length>0||N.ourPrice>0)&&t.jsxs("div",{className:"mb-4",style:{background:"#FFFFFF",border:"1px solid #E1E5E9",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},children:[t.jsx("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"8px 8px 0 0",padding:"20px 30px"},children:t.jsx("h5",{style:{color:"white",fontSize:"18px",fontWeight:"700",margin:"0",textAlign:"center",textShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:"    "})}),t.jsxs("div",{style:{padding:"30px",background:"linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%)"},children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:"20px",maxWidth:"1200px",margin:"0 auto"},children:[t.jsxs("div",{style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"16px",padding:"24px",color:"white",textAlign:"center",boxShadow:"0 8px 20px rgba(40, 167, 69, 0.3)",border:"2px solid rgba(255, 255, 255, 0.2)",position:"relative",overflow:"hidden"},children:[t.jsx("div",{style:{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",opacity:"0.1",backgroundImage:`radial-gradient(circle at 20% 50%, white 2px, transparent 2px),
                                        radial-gradient(circle at 80% 50%, white 2px, transparent 2px)`,backgroundSize:"30px 30px"}}),t.jsxs("div",{style:{position:"relative",zIndex:"1"},children:[t.jsx("div",{style:{fontSize:"32px",marginBottom:"12px",filter:"drop-shadow(0 4px 8px rgba(255, 215, 0, 0.8))",animation:"crownGlow 2s ease-in-out infinite"},children:""}),t.jsx("h6",{style:{fontSize:"16px",fontWeight:"600",margin:"0 0 8px 0",opacity:"0.9"},children:" "}),t.jsx("div",{style:{fontSize:"28px",fontWeight:"800",marginBottom:"8px",textShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:b(N.lowestPrice)}),t.jsx("div",{style:{fontSize:"13px",opacity:"0.85",fontWeight:"500"},children:N.lowestPriceCompetitor||"  "})]})]}),t.jsxs("div",{style:{background:"linear-gradient(135deg, #6c5ce7 0%, #a55eea 100%)",borderRadius:"16px",padding:"24px",color:"white",textAlign:"center",boxShadow:"0 8px 20px rgba(108, 92, 231, 0.3)",border:"2px solid rgba(255, 255, 255, 0.2)",position:"relative"},children:[t.jsx("div",{style:{fontSize:"24px",marginBottom:"12px"},children:""}),t.jsx("h6",{style:{fontSize:"16px",fontWeight:"600",margin:"0 0 12px 0",opacity:"0.9"},children:" "}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[t.jsxs("div",{style:{textAlign:"right"},children:[t.jsx("div",{style:{fontSize:"12px",opacity:"0.8"},children:""}),t.jsx("div",{style:{fontSize:"18px",fontWeight:"700"},children:b(N.lowestPrice)})]}),t.jsx("div",{style:{flex:"1",height:"4px",background:"rgba(255,255,255,0.3)",borderRadius:"2px",margin:"0 12px",position:"relative"},children:t.jsx("div",{style:{position:"absolute",left:"0",top:"0",height:"100%",width:"30%",background:"rgba(255,255,255,0.8)",borderRadius:"2px"}})}),t.jsxs("div",{style:{textAlign:"left"},children:[t.jsx("div",{style:{fontSize:"12px",opacity:"0.8"},children:""}),t.jsx("div",{style:{fontSize:"18px",fontWeight:"700"},children:b(N.highestPrice)})]})]}),t.jsxs("div",{style:{fontSize:"13px",opacity:"0.85",fontWeight:"500"},children:[": ",b(N.highestPrice-N.lowestPrice)]})]}),t.jsxs("div",{style:{background:"linear-gradient(135deg, #00b894 0%, #00cec9 100%)",borderRadius:"16px",padding:"24px",color:"white",textAlign:"center",boxShadow:"0 8px 20px rgba(0, 184, 148, 0.3)",border:"2px solid rgba(255, 255, 255, 0.2)"},children:[t.jsx("div",{style:{fontSize:"24px",marginBottom:"12px"},children:""}),t.jsx("h6",{style:{fontSize:"16px",fontWeight:"600",margin:"0 0 12px 0",opacity:"0.9"},children:" "}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginBottom:"12px"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"12px",opacity:"0.8"},children:""}),t.jsx("div",{style:{fontSize:"18px",fontWeight:"700"},children:b(N.averagePrice)})]}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"12px",opacity:"0.8"},children:""}),t.jsx("div",{style:{fontSize:"18px",fontWeight:"700"},children:N.competitorCount+(N.ourPrice>0?1:0)})]})]}),t.jsx("div",{style:{fontSize:"13px",opacity:"0.85",fontWeight:"500"},children:N.competitorCount>0?" ":"  "})]})]}),t.jsxs("div",{style:{marginTop:"30px",padding:"20px",background:"rgba(0, 123, 255, 0.05)",borderRadius:"12px",border:"1px solid rgba(0, 123, 255, 0.1)"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[t.jsx("h6",{style:{fontSize:"16px",fontWeight:"600",margin:"0",color:"#007bff"},children:"        "}),t.jsx("span",{style:{fontSize:"18px",fontWeight:"800",color:N.ourPrice>N.lowestPrice?"#dc3545":N.ourPrice===N.lowestPrice?"#28a745":"#007bff",background:N.ourPrice>N.lowestPrice?"rgba(220, 53, 69, 0.1)":N.ourPrice===N.lowestPrice?"rgba(40, 167, 69, 0.1)":"rgba(0, 123, 255, 0.1)",padding:"8px 16px",borderRadius:"20px",border:`2px solid ${N.ourPrice>N.lowestPrice?"#dc3545":N.ourPrice===N.lowestPrice?"#28a745":"#007bff"}`},children:(()=>{const P=N.ourPrice-N.lowestPrice;return P===0?"   ":P>0?`+${b(P)}`:b(P)})()})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginTop:"16px"},children:[t.jsxs("div",{style:{flex:"1",textAlign:"center",padding:"12px",background:"rgba(40, 167, 69, 0.1)",borderRadius:"8px",border:"1px solid rgba(40, 167, 69, 0.3)"},children:[t.jsx("div",{style:{fontSize:"12px",color:"#28a745",fontWeight:"600",marginBottom:"4px"},children:"   "}),t.jsx("div",{style:{fontSize:"16px",fontWeight:"700",color:"#28a745"},children:b(N.lowestPrice)})]}),t.jsx("div",{style:{fontSize:"20px",color:"#6c757d"},children:""}),t.jsxs("div",{style:{flex:"1",textAlign:"center",padding:"12px",background:"rgba(0, 123, 255, 0.1)",borderRadius:"8px",border:"1px solid rgba(0, 123, 255, 0.3)"},children:[t.jsx("div",{style:{fontSize:"12px",color:"#007bff",fontWeight:"600",marginBottom:"4px"},children:"   "}),t.jsx("div",{style:{fontSize:"16px",fontWeight:"700",color:"#007bff"},children:b(N.ourPrice)})]})]}),t.jsx("div",{style:{marginTop:"16px",padding:"12px",background:N.ourPrice===N.lowestPrice?"rgba(40, 167, 69, 0.05)":N.ourPrice>N.lowestPrice?"rgba(220, 53, 69, 0.05)":"rgba(0, 123, 255, 0.05)",borderRadius:"8px",textAlign:"center",fontSize:"14px",fontWeight:"600",color:N.ourPrice===N.lowestPrice?"#28a745":N.ourPrice>N.lowestPrice?"#dc3545":"#007bff"},children:N.ourPrice===N.lowestPrice?" !        ":N.ourPrice>N.lowestPrice?"       ":"      "})]})]})]}),t.jsx("style",{jsx:!0,global:!0,children:`
              @keyframes fillArea {
                from {
                  opacity: 0;
                  transform: scaleY(0);
                }
                to {
                  opacity: 1;
                  transform: scaleY(1);
                }
              }

              @keyframes pointDrop {
                from {
                  opacity: 0;
                  transform: translateY(-20px) scale(0);
                }
                to {
                  opacity: 1;
                  transform: translateY(0) scale(1);
                }
              }

              @keyframes crownGlow {
                0%, 100% {
                  filter: drop-shadow(0 2px 4px rgba(255, 215, 0, 0.5));
                  transform: scale(1);
                }
                50% {
                  filter: drop-shadow(0 4px 8px rgba(255, 215, 0, 0.8));
                  transform: scale(1.1);
                }
              }

              @keyframes fadeUp {
                from {
                  opacity: 0;
                  transform: translateY(10px);
                }
                to {
                  opacity: 1;
                  transform: translateY(0);
                }
              }
            `}),t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom",children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-people-fill text-primary me-2"})," ",p&&t.jsxs("span",{className:"badge bg-success ms-2",children:[t.jsx("i",{className:"bi bi-cloud-check me-1"}),""]})]}),t.jsxs("button",{onClick:Y,className:"btn btn-primary btn-sm",style:{height:"40px",borderRadius:"8px",padding:"8px 16px"},children:[t.jsx("i",{className:"bi bi-plus-circle me-2"})," "]})]})}),t.jsx("div",{className:"card-body",children:s.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted mb-4",children:"    "}),t.jsxs("button",{onClick:Y,className:"btn btn-primary",children:[t.jsx("i",{className:"bi bi-plus-circle me-2"}),"  "]})]}):t.jsx("div",{className:"row",children:s.filter((P,_,C)=>C.findIndex(U=>U.competitorId===P.competitorId)===_).map((P,_)=>t.jsx("div",{className:"col-lg-6 col-xl-4 mb-4",children:t.jsxs("div",{className:"card h-100 border shadow-sm",children:[t.jsxs("div",{className:"card-header bg-light d-flex justify-content-between align-items-center py-2",children:[t.jsxs("h6",{className:"mb-0 fw-bold text-dark",children:[" ",(_+1).toLocaleString("en-US")]}),t.jsx("div",{className:"btn-group btn-group-sm",children:t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>O(P),title:"",disabled:u,style:{width:"32px",height:"32px",padding:"0",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"32px",maxWidth:"32px",minHeight:"32px",maxHeight:"32px",borderRadius:"8px",position:"relative"},children:t.jsx("i",{className:"bi bi-trash",style:{fontSize:"14px",position:"absolute",left:"0px",top:"50%",transform:"translateY(-50%)",lineHeight:"1",display:"flex",alignItems:"center",justifyContent:"center",width:"14px",height:"14px",textAlign:"center",verticalAlign:"middle"}})})})]}),t.jsxs("div",{className:"card-body",children:[t.jsx("div",{className:"mb-3",children:t.jsxs("p",{className:"mb-1",children:[t.jsx("strong",{children:":"})," ",P.competitorName]})}),t.jsxs("div",{className:"mb-0",children:[t.jsx("label",{className:"form-label fw-bold",children:""}),t.jsxs("div",{className:"input-group",children:[t.jsx("input",{type:"number",step:"0.1",className:"form-control",placeholder:"0.0",value:P.price,onChange:C=>z(P.competitorId,C.target.value),style:{fontSize:"16px",fontWeight:"500"}}),t.jsx("span",{className:"input-group-text bg-light",children:""})]}),P.price>0&&t.jsxs("div",{className:"mt-2",children:[t.jsx("span",{className:"badge bg-primary",children:b(P.price)}),P.price===N.lowestPrice&&t.jsxs("span",{className:"badge bg-success ms-2",children:[t.jsx("i",{className:"bi bi-trophy me-2"})," "]}),P.price===N.highestPrice&&N.lowestPrice!==N.highestPrice&&t.jsxs("span",{className:"badge bg-danger ms-2",children:[t.jsx("i",{className:"bi bi-arrow-up me-2"})," "]})]})]})]})]})},P.competitorId||P.id))})})]})]})]}),t.jsx(Mt,{show:D.show,onClose:y,title:D.title,message:D.message,type:D.type,onConfirm:D.onConfirm,confirmText:D.confirmText,cancelText:D.cancelText,showCancel:D.showCancel}),t.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:t.jsx("span",{children:" Modern Bin 2025"})})]})]}):t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:G}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!A?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsx("div",{className:"app-container",children:t.jsx("div",{className:"app-content-area p-4",children:t.jsx("div",{className:"card shadow-sm",children:t.jsxs("div",{className:"card-body text-center py-5",children:[t.jsx("div",{className:"text-warning mb-3",children:t.jsx("i",{className:"bi bi-folder-x fs-1"})}),t.jsx("h5",{className:"text-muted",children:"  "}),t.jsx("p",{className:"text-muted",children:"      "})]})})})})]})]})}const Ez=wa.memo(({tenderId:n})=>{const[e,s]=h.useState(null),[r,i]=h.useState(!0),[a,o]=h.useState(!1),l=kt(),c=h.useCallback(async R=>{try{console.log("=== DETAILED DEBUGGING ==="),console.log("Full item object:",JSON.stringify(R,null,2)),console.log("All item keys:",Object.keys(R));const D=R.materialInternalId,y=R.materialType||"rawMaterial";console.log("Searching for:"),console.log("- materialInternalId:",D),console.log("- materialType:",y);let T=null,x=[];if(y==="rawMaterial"){console.log("Loading raw material...");const{RawMaterialService:S}=await Xe(async()=>{const{RawMaterialService:Q}=await Promise.resolve().then(()=>dd);return{RawMaterialService:Q}},void 0);let A=await S.getRawMaterialByInternalId(D);if(!A)try{A=await S.getRawMaterialById(D)}catch{console.log("Could not find material by Firebase ID, trying name fallback...")}if(!A){console.log("Using name fallback - loading all raw materials...");const Q=await S.getAllRawMaterials(),q=R.materialName||R.name;A=Q.find(B=>B.name===q)}console.log("Found raw material:",A?"YES":"NO"),A&&(console.log("Material details:",{id:A.id,internalId:A.internalId,name:A.name}),T=A.id,l(`/raw-materials/edit/${T}`))}else if(y==="localProduct"){console.log("Loading local product...");const{LocalProductService:S}=await Xe(async()=>{const{LocalProductService:Q}=await Promise.resolve().then(()=>ud);return{LocalProductService:Q}},void 0);let A=await S.getLocalProductByInternalId(D);if(!A)try{A=await S.getLocalProductById(D)}catch{console.log("Could not find product by Firebase ID, trying name fallback...")}if(!A){console.log("Using name fallback - loading all local products...");const Q=await S.getAllLocalProducts(),q=R.materialName||R.name;A=Q.find(B=>B.name===q)}console.log("Found local product:",A?"YES":"NO"),A&&(console.log("Product details:",{id:A.id,internalId:A.internalId,name:A.name}),T=A.id,l(`/local-products/edit/${T}`))}else if(y==="foreignProduct"){console.log("Loading foreign product...");const{ForeignProductService:S}=await Xe(async()=>{const{ForeignProductService:Q}=await Promise.resolve().then(()=>hd);return{ForeignProductService:Q}},void 0);let A=await S.getForeignProductByInternalId(D);if(!A)try{A=await S.getForeignProductById(D)}catch{console.log("Could not find product by Firebase ID, trying name fallback...")}if(!A){console.log("Using name fallback - loading all foreign products...");const Q=await S.getAllForeignProducts(),q=R.materialName||R.name;A=Q.find(B=>B.name===q)}console.log("Found foreign product:",A?"YES":"NO"),A&&(console.log("Product details:",{id:A.id,internalId:A.internalId,name:A.name}),T=A.id,l(`/foreign-products/edit/${T}`))}else if(y==="manufacturedProduct"){console.log("Loading manufactured products...");const{ManufacturedProductService:S}=await Xe(async()=>{const{ManufacturedProductService:Q}=await Promise.resolve().then(()=>Li);return{ManufacturedProductService:Q}},void 0);x=await S.getAllManufacturedProducts(),console.log("Total manufactured products loaded:",x.length),console.log("Sample manufactured product IDs:",x.slice(0,3).map(Q=>({id:Q.id,internalId:Q.internalId,title:Q.title})));let A=x.find(Q=>Q.internalId===D);A||(A=x.find(Q=>Q.id===D)),A||(A=x.find(Q=>Q.title===R.materialName)),console.log("Found manufactured product:",A?"YES":"NO"),A&&(console.log("Product details:",{id:A.id,internalId:A.internalId,title:A.title}),T=A.id,l(`/manufactured-products/edit/${T}`))}else if(y==="service"){console.log("Loading services...");const{ServiceService:S}=await Xe(async()=>{const{ServiceService:Q}=await Promise.resolve().then(()=>z0);return{ServiceService:Q}},void 0);x=await S.getAllServices(),console.log("Total services loaded:",x.length),console.log("Sample service IDs:",x.slice(0,3).map(Q=>({id:Q.id,internalId:Q.internalId,name:Q.name})));let A=x.find(Q=>Q.internalId===D);A||(A=x.find(Q=>Q.id===D)),A||(A=x.find(Q=>Q.name===R.materialName)),console.log("Found service:",A?"YES":"NO"),A&&(console.log("Service details:",{id:A.id,internalId:A.internalId,name:A.name}),T=A.id,l(`/services/edit/${T}`))}T||(console.error("=== SEARCH FAILED ==="),console.error("Could not find Firebase ID for:",D),console.error("Available items in this category:",x.map(S=>({id:S.id,internalId:S.internalId,name:S.name}))),alert(`     
ID: ${D}
Type: ${y}`))}catch(D){console.error("=== NAVIGATION ERROR ===",D),alert("     ")}},[l]);if(h.useEffect(()=>{let R=!0;return(async()=>{if(!(!n||!R))try{i(!0);const y=await dn.getTenderForViewing(n);R&&y&&s({formData:{title:y.title||"",referenceNumber:y.referenceNumber||"",entity:y.entity||"",description:y.description||"",submissionDeadline:y.submissionDeadline?Rl(y.submissionDeadline):"",estimatedValue:y.estimatedValue||"",documentPrice:y.documentPrice||"",location:y.location||"",contactPerson:y.contactPerson||"",contactPhone:y.contactPhone||"",contactEmail:y.contactEmail||""},documents:y.documents||[],tenderItems:y.items||[]})}catch(y){console.error(" Error loading tender data:",y)}finally{R&&i(!1)}})(),()=>{R=!1}},[n]),r)return t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:t.jsx(It,{size:"large"})});if(!e)return t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:t.jsxs("div",{className:"text-center",children:[t.jsx("i",{className:"bi bi-exclamation-triangle text-warning",style:{fontSize:"48px"}}),t.jsx("h5",{className:"mt-3",children:"   "})]})});const{formData:d,documents:u,tenderItems:f}=e,p=(f==null?void 0:f.reduce((R,D)=>R+(parseFloat(D.totalPrice)||0),0))||0,j=p*.15,L=p+j;return t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom py-4",children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsx("div",{className:"d-flex align-items-center",children:t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-pencil-square text-primary me-2"})," "]})}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-primary",disabled:!0,style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",opacity:"0.6"},children:" "}),t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>o(!0),style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500"},children:" "})]})]})}),t.jsx("div",{className:"alert alert-warning border-0 rounded-0 mb-0",style:{background:"linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%)"},children:t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-eye text-warning me-2",style:{fontSize:"18px"}}),t.jsx("strong",{children:"  :"}),t.jsx("span",{className:"ms-2",children:"     "})]})}),t.jsx("div",{className:"card-body",children:t.jsx("form",{children:t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-8 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"text",className:"form-control",value:d.title,readOnly:!0,style:{backgroundColor:"#f8f9fa"}})]}),t.jsxs("div",{className:"col-md-4 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"text",className:"form-control",value:d.referenceNumber,readOnly:!0,style:{backgroundColor:"#f8f9fa"}})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"  *"}),t.jsx("input",{type:"text",className:"form-control",value:d.entity,readOnly:!0,style:{backgroundColor:"#f8f9fa"}})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"   *"}),t.jsx("input",{type:"date",className:"form-control",value:d.submissionDeadline,readOnly:!0,style:{backgroundColor:"#f8f9fa"}})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsxs("label",{className:"form-label",children:[" ",t.jsx("small",{className:"text-muted ms-2",children:"(   )"})]}),t.jsxs("div",{className:"input-group",children:[t.jsx("input",{type:"text",className:"form-control bg-light",value:p>0?`${p.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})} `:"0.0 ",readOnly:!0,style:{backgroundColor:"#f8f9fa",fontWeight:"bold",color:"#198754"}}),t.jsx("span",{className:"input-group-text bg-light text-success",children:t.jsx("i",{className:"bi bi-calculator"})})]})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:"   *"}),t.jsxs("div",{className:"input-group",children:[t.jsx("input",{type:"number",className:"form-control",value:d.documentPrice,readOnly:!0,style:{backgroundColor:"#f8f9fa"}}),t.jsx("span",{className:"input-group-text",children:"."})]})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:""}),t.jsx("input",{type:"text",className:"form-control",value:d.location,readOnly:!0,style:{backgroundColor:"#f8f9fa"}})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:" "}),t.jsx("input",{type:"text",className:"form-control",value:d.contactPerson,readOnly:!0,style:{backgroundColor:"#f8f9fa"}})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:" "}),t.jsx("input",{type:"tel",className:"form-control",value:d.contactPhone,readOnly:!0,style:{backgroundColor:"#f8f9fa"}})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"form-label",children:" "}),t.jsx("input",{type:"email",className:"form-control",value:d.contactEmail,readOnly:!0,style:{backgroundColor:"#f8f9fa"}})]}),t.jsxs("div",{className:"col-md-12 mb-3",children:[t.jsx("label",{className:"form-label",children:" "}),t.jsx("textarea",{className:"form-control",value:d.description,rows:"4",readOnly:!0,style:{backgroundColor:"#f8f9fa"}})]}),t.jsx("div",{className:"col-md-12 mb-4",children:t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-light",children:t.jsx("div",{className:"d-flex justify-content-between align-items-center",children:t.jsxs("h6",{className:"mb-0 fw-bold text-primary",children:[t.jsx("i",{className:"bi bi-list-check me-2"}),"  (",(f==null?void 0:f.length)||0,")"]})})}),t.jsx("div",{className:"card-body p-0",children:f&&f.length>0?t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-striped mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",width:"5%",children:"#"}),t.jsx("th",{className:"text-center",width:"40%",children:""}),t.jsx("th",{className:"text-center",width:"15%",children:""}),t.jsx("th",{className:"text-center",width:"15%",children:""}),t.jsx("th",{className:"text-center",width:"12%",children:" "}),t.jsx("th",{className:"text-center",width:"13%",children:""})]})}),t.jsx("tbody",{children:f.map((R,D)=>{const y=R.materialName||R.name||"  ",T=R.materialUnit||R.unit||"",x=R.totalPrice||0;return t.jsxs("tr",{style:{backgroundColor:D%2===0?"#ffffff":"#f8f9fa"},children:[t.jsx("td",{className:"text-center fw-bold text-muted",children:D+1}),t.jsx("td",{className:"text-center fw-medium",children:t.jsx("div",{children:t.jsx("button",{className:"btn btn-link p-0 fw-medium text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:async S=>{S.preventDefault(),S.stopPropagation(),await c(R)},title:`  ${y}`,children:y})})}),t.jsx("td",{className:"text-center fw-bold text-info",children:R.quantity}),t.jsx("td",{className:"text-center text-muted",children:T}),t.jsxs("td",{className:"text-center text-success",children:[parseFloat(R.unitPrice||0).toLocaleString("en-US",{minimumFractionDigits:2})," ."]}),t.jsxs("td",{className:"text-center fw-bold text-success",children:[parseFloat(x).toLocaleString("en-US",{minimumFractionDigits:2})," ."]})]},R.internalId||`item-${D}`)})}),t.jsxs("tfoot",{className:"table-light",children:[t.jsxs("tr",{children:[t.jsx("th",{colSpan:"5",className:"text-end",children:" :"}),t.jsxs("th",{className:"text-center text-primary fw-bold",children:[p.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," ."]})]}),t.jsxs("tr",{children:[t.jsx("th",{colSpan:"5",className:"text-end",children:"   (%15):"}),t.jsxs("th",{className:"text-center text-success fw-bold",children:[j.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," ."]})]}),t.jsxs("tr",{className:"table-warning",children:[t.jsx("th",{colSpan:"5",className:"text-end",children:" :"}),t.jsxs("th",{className:"text-center fw-bold",style:{color:"#000000"},children:[L.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," ."]})]})]})]})}):t.jsxs("div",{className:"text-center py-5",children:[t.jsx("i",{className:"bi bi-inbox text-muted",style:{fontSize:"48px"}}),t.jsx("h6",{className:"mt-3 text-muted",children:"    "}),t.jsx("p",{className:"text-muted mb-0",children:"       "})]})})]})})]})})}),a&&t.jsx(Td,{show:a,onHide:()=>{console.log(" Document modal closing..."),o(!1)},onClose:()=>{console.log(" Document modal onClose triggered"),o(!1)},documents:u,onDocumentUploaded:()=>{},onDocumentDeleted:()=>{},uploading:!1,deleting:!1,readOnly:!0})]})}),Cz=wa.memo(({tenderId:n})=>{const[e,s]=h.useState(!0),[r,i]=h.useState(null),[a,o]=h.useState([]),[l,c]=h.useState([]),[d,u]=h.useState(!1),f=kt(),[p,j]=h.useState(0),[L,R]=h.useState(0),[D,y]=h.useState(!1),[T,x]=h.useState(0),[S,A]=h.useState(""),Q=h.useCallback(async N=>{try{console.log("=== DETAILED DEBUGGING ==="),console.log("Full item object:",JSON.stringify(N,null,2)),console.log("All item keys:",Object.keys(N));const I=N.materialInternalId,P=N.materialType||"rawMaterial";console.log("Searching for:"),console.log("- materialInternalId:",I),console.log("- materialType:",P);let _=null;if(P==="rawMaterial"){console.log("Loading raw material...");const{RawMaterialService:C}=await Xe(async()=>{const{RawMaterialService:w}=await Promise.resolve().then(()=>dd);return{RawMaterialService:w}},void 0);let U=await C.getRawMaterialByInternalId(I);if(!U)try{U=await C.getRawMaterialById(I)}catch{console.log("Could not find material by Firebase ID, trying name fallback...")}if(!U){console.log("Using name fallback - loading all raw materials...");const w=await C.getAllRawMaterials(),W=N.materialName||N.name;U=w.find(ie=>ie.name===W)}console.log("Found raw material:",U?"YES":"NO"),U&&(console.log("Material details:",{id:U.id,internalId:U.internalId,name:U.name}),_=U.id,f(`/raw-materials/edit/${_}`))}else if(P==="localProduct"){console.log("Loading local product...");const{LocalProductService:C}=await Xe(async()=>{const{LocalProductService:w}=await Promise.resolve().then(()=>ud);return{LocalProductService:w}},void 0);let U=await C.getLocalProductByInternalId(I);if(!U)try{U=await C.getLocalProductById(I)}catch{console.log("Could not find product by Firebase ID, trying name fallback...")}if(!U){console.log("Using name fallback - loading all local products...");const w=await C.getAllLocalProducts(),W=N.materialName||N.name;U=w.find(ie=>ie.name===W)}console.log("Found local product:",U?"YES":"NO"),U&&(console.log("Product details:",{id:U.id,internalId:U.internalId,name:U.name}),_=U.id,f(`/local-products/edit/${_}`))}else if(P==="foreignProduct"){console.log("Loading foreign product...");const{ForeignProductService:C}=await Xe(async()=>{const{ForeignProductService:w}=await Promise.resolve().then(()=>hd);return{ForeignProductService:w}},void 0);let U=await C.getForeignProductByInternalId(I);if(!U)try{U=await C.getForeignProductById(I)}catch{console.log("Could not find product by Firebase ID, trying name fallback...")}if(!U){console.log("Using name fallback - loading all foreign products...");const w=await C.getAllForeignProducts(),W=N.materialName||N.name;U=w.find(ie=>ie.name===W)}console.log("Found foreign product:",U?"YES":"NO"),U&&(console.log("Product details:",{id:U.id,internalId:U.internalId,name:U.name}),_=U.id,f(`/foreign-products/edit/${_}`))}else if(P==="manufacturedProduct"){console.log("Loading manufactured product...");const{ManufacturedProductService:C}=await Xe(async()=>{const{ManufacturedProductService:w}=await Promise.resolve().then(()=>Li);return{ManufacturedProductService:w}},void 0);let U=await C.getManufacturedProductByInternalId(I);if(!U)try{U=await C.getManufacturedProductById(I)}catch{console.log("Could not find manufactured product by Firebase ID, trying name fallback...")}if(!U){console.log("Using name fallback - loading all manufactured products...");const w=await C.getAllManufacturedProducts(),W=N.materialName||N.name;U=w.find(ie=>ie.name===W)}console.log("Found manufactured product:",U?"YES":"NO"),U&&(console.log("Product details:",{id:U.id,internalId:U.internalId,name:U.name}),_=U.id,f(`/manufactured-products/edit/${_}`))}_||(console.error(" Could not find item to navigate to"),console.log("Search failed for:",{materialInternalId:I,materialType:P}))}catch(I){console.error(" Error navigating to item:",I)}},[f]);h.useEffect(()=>{let N=!0;return(async()=>{var P;if(!(!n||!N))try{s(!0);const[_,C]=await Promise.all([dn.getTenderForViewing(n),Hl.getTenderStudy(n)]);if(N&&(i(_),_!=null&&_.items&&Array.isArray(_.items)&&o(_.items),_!=null&&_.documents&&Array.isArray(_.documents)&&c(_.documents),C!=null&&C.success&&((P=C.data)!=null&&P.profitCalculation))){const{profitCalculation:U}=C.data;j(U.fixedProfit||0),R(U.percentageProfit||0),x(U.totalIndividualProfit||0),y(U.showPerItemInput||!1),A(U.individualProfitData||"")}}catch(_){console.error("Error loading price study data:",_)}finally{N&&s(!1)}})(),()=>{N=!1}},[n]);const q={estimatedValue:(r==null?void 0:r.estimatedValue)||0,tax:(r==null?void 0:r.tax)||0,vat:(r==null?void 0:r.vat)||0,grandTotal:(r==null?void 0:r.grandTotal)||0,subtotal:a.reduce((N,I)=>N+(parseFloat(I.totalPrice)||0),0)},B=parseFloat(q.grandTotal||q.estimatedValue||q.subtotal||0),$=parseFloat((B*(L/100)).toFixed(10)),H=D?T:parseFloat((p+$).toFixed(10)),te=parseFloat((B+H).toFixed(10)),G=B>0?parseFloat((H/B*100).toFixed(10)):0,F=()=>{try{return S?JSON.parse(S):{}}catch{return{}}},X=(N,I)=>{var C;const P=N.internalId||I;return((C=F()[P])==null?void 0:C.value)||0},ue=(N,I)=>{var C;const P=N.internalId||I;return((C=F()[P])==null?void 0:C.type)||"fixed"},Y=N=>{if(!N)return" ";try{let I;if(N.seconds?I=new Date(N.seconds*1e3):N.toDate?I=N.toDate():I=new Date(N),isNaN(I.getTime()))return" ";const P=String(I.getDate()).padStart(2,"0"),_=String(I.getMonth()+1).padStart(2,"0"),C=I.getFullYear();return`${P}/${_}/${C}`}catch{return" "}};if(e)return t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:t.jsx(It,{size:"large"})});if(!r)return t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:t.jsxs("div",{className:"text-center",children:[t.jsx("i",{className:"bi bi-exclamation-triangle text-warning",style:{fontSize:"48px"}}),t.jsx("h5",{className:"mt-3",children:"    "})]})});const z=a.map(N=>parseFloat((N.totalPrice||0).toFixed(1)));let E=z.reduce((N,I)=>N+I,0);D?E=a.reduce((N,I,P)=>{const _=parseFloat((I.totalPrice||0).toFixed(1));let C=_;const U=I.internalId||P,W=F()[U];if(W)if(W.type==="percentage"){const ie=parseFloat((_*(W.value/100)).toFixed(10));C=parseFloat((_+ie).toFixed(10))}else{const ie=parseFloat((W.value||0).toFixed(10));C=parseFloat((_+ie).toFixed(10))}return N+C},0):G>0&&(E=z.reduce((N,I)=>{const P=parseFloat((I*(G/100)).toFixed(10)),_=parseFloat((I+P).toFixed(10));return N+_},0));const k=parseFloat((E*.15).toFixed(1)),b=parseFloat((E+k).toFixed(1));return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"alert alert-info mb-4",style:{background:"linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%)",border:"1px solid #abd2d8",borderRadius:"8px"},children:t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-info-circle text-info me-2",style:{fontSize:"18px"}}),t.jsx("strong",{children:"  :"}),t.jsx("span",{className:"ms-2",children:"      -   "})]})}),t.jsxs("div",{className:"text-center",style:{marginBottom:"25px",position:"relative"},children:[t.jsxs("div",{className:"d-flex align-items-center justify-content-center",style:{marginBottom:"10px"},children:[t.jsx("i",{className:"bi bi-calculator me-3 text-primary",style:{fontSize:"2.2rem"}}),t.jsxs("h4",{className:"mb-0 text-primary",children:["  ",(r==null?void 0:r.entity)||" "]})]}),t.jsxs("button",{className:"btn btn-outline-info d-flex align-items-center",onClick:()=>u(!0),style:{position:"absolute",left:"50%",transform:"translateX(-50%)",borderRadius:"25px",padding:"8px 16px",fontSize:"0.9rem",fontWeight:"600",transition:"all 0.3s ease",border:"2px solid #17a2b8"},onMouseOver:N=>{N.currentTarget.style.transform="translateX(-50%) scale(1.05)",N.currentTarget.style.boxShadow="0 4px 15px rgba(23, 162, 184, 0.3)"},onMouseOut:N=>{N.currentTarget.style.transform="translateX(-50%) scale(1)",N.currentTarget.style.boxShadow="none"},children:[t.jsx("i",{className:"bi bi-folder-open me-2",style:{fontSize:"1.1rem"}}),"  (",l.length,")"]}),t.jsx("p",{className:"text-muted mb-0",style:{fontSize:"1rem",marginTop:"20px"},children:(r==null?void 0:r.title)||" "})]}),t.jsxs("div",{className:"row g-4 justify-content-center",style:{marginTop:"15px",marginBottom:"30px"},children:[t.jsx("div",{className:"col-lg-3 col-md-6",children:t.jsxs("div",{className:"p-3 bg-white rounded-3 shadow-sm h-100 border border-primary border-opacity-25",children:[t.jsx("div",{className:"text-center mb-2",children:t.jsx("i",{className:"bi bi-currency-exchange text-primary",style:{fontSize:"1.8rem"}})}),t.jsx("div",{className:"fw-bold text-dark mb-1 text-center",style:{fontSize:"0.95rem"},children:"  "}),t.jsxs("div",{className:"text-primary fw-bold text-center",style:{fontSize:"1.4rem"},children:[B.toLocaleString(void 0,{minimumFractionDigits:1,maximumFractionDigits:1})," ."]})]})}),t.jsx("div",{className:"col-lg-3 col-md-6",children:t.jsxs("div",{className:"p-3 bg-white rounded-3 shadow-sm h-100 border border-success border-opacity-25",children:[t.jsx("div",{className:"text-center mb-2",children:t.jsx("i",{className:"bi bi-plus-circle text-success",style:{fontSize:"1.8rem"}})}),t.jsx("div",{className:"fw-bold text-dark mb-1 text-center",style:{fontSize:"0.95rem"},children:" "}),t.jsxs("div",{className:"text-success fw-bold text-center",style:{fontSize:"1.4rem"},children:[H.toLocaleString(void 0,{minimumFractionDigits:1,maximumFractionDigits:1})," ."]})]})}),t.jsx("div",{className:"col-lg-3 col-md-6",children:t.jsxs("div",{className:"p-3 bg-white rounded-3 shadow-sm h-100 border border-warning border-opacity-25",children:[t.jsx("div",{className:"text-center mb-2",children:t.jsx("i",{className:"bi bi-cash-coin text-warning",style:{fontSize:"1.8rem"}})}),t.jsx("div",{className:"fw-bold text-dark mb-1 text-center",style:{fontSize:"0.95rem"},children:" "}),t.jsxs("div",{className:"text-warning fw-bold text-center",style:{fontSize:"1.4rem"},children:[te.toLocaleString(void 0,{minimumFractionDigits:1,maximumFractionDigits:1})," ."]})]})}),t.jsx("div",{className:"col-lg-3 col-md-6",children:t.jsxs("div",{className:"p-3 bg-white rounded-3 shadow-sm h-100 border border-info border-opacity-25",children:[t.jsx("div",{className:"text-center mb-2",children:t.jsx("i",{className:"bi bi-pie-chart text-info",style:{fontSize:"1.8rem"}})}),t.jsx("div",{className:"fw-bold text-dark mb-1 text-center",style:{fontSize:"0.95rem"},children:" "}),t.jsxs("div",{className:"text-info fw-bold text-center",style:{fontSize:"1.4rem"},children:[G.toFixed(1),"%"]})]})})]}),t.jsxs("div",{className:"row g-4 mt-4",children:[t.jsx("div",{className:"col-12",children:t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header bg-light",children:t.jsxs("h5",{className:"mb-0 text-primary",children:[t.jsx("i",{className:"bi bi-clipboard-data me-2"})," "]})}),t.jsx("div",{className:"card-body",children:t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-4",children:[t.jsxs("p",{children:[t.jsx("strong",{children:" :"})," ",(r==null?void 0:r.referenceNumber)||n]}),t.jsxs("p",{children:[t.jsx("strong",{children:":"})," ",(r==null?void 0:r.title)||" "]}),t.jsxs("p",{children:[t.jsx("strong",{children:":"})," ",t.jsx("span",{className:"badge bg-success",children:" "})]})]}),t.jsxs("div",{className:"col-md-4",children:[t.jsxs("p",{children:[t.jsx("strong",{children:":"})," ",(r==null?void 0:r.entity)||" "]}),t.jsxs("p",{children:[t.jsx("strong",{children:"  :"})," ",Y(r==null?void 0:r.submissionDeadline)]}),t.jsxs("p",{children:[t.jsx("strong",{children:" :"})," ",r!=null&&r.estimatedValue?parseFloat(r.estimatedValue).toLocaleString()+" .":" "]})]}),t.jsx("div",{className:"col-md-4",children:t.jsx("div",{className:"d-flex flex-column align-items-center justify-content-center h-100",style:{minHeight:"120px",marginLeft:"100px"},children:t.jsxs("div",{className:"text-center",children:[t.jsx("i",{className:"bi bi-eye text-info",style:{fontSize:"3rem",marginBottom:"0.5rem"}}),t.jsx("div",{className:"fw-bold text-muted",children:"  "})]})})})]})})]})}),t.jsx("div",{className:"col-12",children:t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header bg-light",children:t.jsxs("h5",{className:"mb-0 text-success",children:[t.jsx("i",{className:"bi bi-calculator me-2"})," "]})}),t.jsx("div",{className:"card-body",style:{padding:"2rem"},children:t.jsxs("div",{className:"row g-4",children:[t.jsx("div",{className:"col-lg-4 col-md-6",children:t.jsx("div",{className:"card border-success h-100 shadow-sm",style:{borderWidth:"2px",borderRadius:"15px",transition:"all 0.3s ease",minHeight:"280px",opacity:.8},children:t.jsxs("div",{className:"card-body text-center d-flex flex-column justify-content-between",style:{padding:"2rem 1.5rem"},children:[t.jsxs("div",{children:[t.jsx("div",{className:"mb-4",children:t.jsx("div",{className:"rounded-circle bg-success bg-opacity-10 mx-auto d-flex align-items-center justify-content-center",style:{width:"80px",height:"80px"},children:t.jsx("i",{className:"bi bi-currency-dollar text-success",style:{fontSize:"2.5rem"}})})}),t.jsx("h5",{className:"card-title text-success mb-3 fw-bold",children:" "}),t.jsxs("div",{className:"form-floating mb-3",children:[t.jsx("input",{type:"number",className:"form-control text-center border-2 border-success bg-light",id:"fixedProfitReadOnly",placeholder:"0",step:"0.01",value:p,readOnly:!0,style:{fontSize:"1.1rem",fontWeight:"600",borderRadius:"10px",height:"60px",backgroundColor:"#f8f9fa !important"}}),t.jsx("label",{htmlFor:"fixedProfitReadOnly",className:"text-success fw-semibold",children:" (.)"})]})]}),t.jsx("small",{className:"text-muted",style:{fontSize:"0.9rem"},children:"    "})]})})}),t.jsx("div",{className:"col-lg-4 col-md-6",children:t.jsx("div",{className:"card border-warning h-100 shadow-sm",style:{borderWidth:"2px",borderRadius:"15px",transition:"all 0.3s ease",minHeight:"280px",opacity:.8},children:t.jsxs("div",{className:"card-body text-center d-flex flex-column justify-content-between",style:{padding:"2rem 1.5rem"},children:[t.jsxs("div",{children:[t.jsx("div",{className:"mb-4",children:t.jsx("div",{className:"rounded-circle bg-warning bg-opacity-10 mx-auto d-flex align-items-center justify-content-center",style:{width:"80px",height:"80px"},children:t.jsx("i",{className:"bi bi-percent text-warning",style:{fontSize:"2.5rem"}})})}),t.jsx("h5",{className:"card-title text-warning mb-3 fw-bold",children:" "}),t.jsxs("div",{className:"form-floating mb-3",children:[t.jsx("input",{type:"number",className:"form-control text-center border-2 border-warning bg-light",id:"percentageProfitReadOnly",placeholder:"0",min:"1",max:"100",step:"1",value:L,readOnly:!0,style:{fontSize:"1.1rem",fontWeight:"600",borderRadius:"10px",height:"60px",backgroundColor:"#f8f9fa !important"}}),t.jsx("label",{htmlFor:"percentageProfitReadOnly",className:"text-warning fw-semibold",children:" (%)"})]})]}),t.jsx("small",{className:"text-muted",style:{fontSize:"0.9rem"},children:"    "})]})})}),t.jsx("div",{className:"col-lg-4 col-md-12",children:t.jsx("div",{className:"card border-info h-100 shadow-sm",style:{borderWidth:"2px",borderRadius:"15px",transition:"all 0.3s ease",minHeight:"280px",opacity:D?1:.6},children:t.jsxs("div",{className:"card-body text-center d-flex flex-column justify-content-between",style:{padding:"2rem 1.5rem"},children:[t.jsxs("div",{children:[t.jsx("div",{className:"mb-4",children:t.jsx("div",{className:"rounded-circle bg-info bg-opacity-10 mx-auto d-flex align-items-center justify-content-center",style:{width:"80px",height:"80px"},children:t.jsx("i",{className:"bi bi-list-ol text-info",style:{fontSize:"2.5rem"}})})}),t.jsx("h5",{className:"card-title text-info mb-3 fw-bold",children:" "}),t.jsxs("div",{className:"form-check form-switch mb-3 d-flex justify-content-center",children:[t.jsx("input",{className:"form-check-input",type:"checkbox",id:"perItemSwitchReadOnly",checked:D,disabled:!0,style:{transform:"scale(1.5)",cursor:"not-allowed"}}),t.jsx("label",{className:"form-check-label text-info fw-semibold ms-3",htmlFor:"perItemSwitchReadOnly",children:" "})]})]}),t.jsxs("div",{className:"mb-3",children:[t.jsxs("div",{className:"fw-bold text-info mb-2",style:{fontSize:"1.3rem"},children:[T.toLocaleString(void 0,{minimumFractionDigits:1,maximumFractionDigits:1})," ."]}),t.jsx("small",{className:"text-muted",style:{fontSize:"0.9rem"},children:"     "})]})]})})})]})})]})})]}),a&&a.length>0&&t.jsxs("div",{className:"card mb-4",children:[t.jsx("div",{className:"card-header bg-light",children:t.jsxs("h5",{className:"mb-0 text-primary",children:[t.jsx("i",{className:"bi bi-list me-2"})," ",t.jsxs("span",{className:"badge bg-secondary ms-2",children:["(",a.length," )"]})]})}),t.jsx("div",{className:"card-body p-0",children:t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-striped table-hover mb-0",children:[t.jsx("thead",{className:"table-light",children:t.jsxs("tr",{children:[t.jsx("th",{width:"4%",className:"text-center",children:"#"}),t.jsx("th",{width:"25%",children:""}),t.jsx("th",{width:"12%",className:"text-center",children:""}),t.jsx("th",{width:"8%",className:"text-center",children:""}),t.jsx("th",{width:"8%",className:"text-center",children:""}),t.jsx("th",{width:"12%",className:"text-center",children:" "}),t.jsx("th",{width:"12%",className:"text-center",children:" "}),t.jsx("th",{width:"19%",className:"text-center",children:" "})]})}),t.jsx("tbody",{children:a.map((N,I)=>{const P=parseFloat((N.totalPrice||0).toFixed(1));let _=P;if(D){const C=N.internalId||I,w=F()[C];if(w)if(w.type==="percentage"){const W=parseFloat((P*(w.value/100)).toFixed(10));_=parseFloat((P+W).toFixed(10))}else{const W=parseFloat((w.value||0).toFixed(10));_=parseFloat((P+W).toFixed(10))}}else if(L>0){const C=parseFloat((P*(G/100)).toFixed(10));_=parseFloat((P+C).toFixed(10))}else if(p>0){const C=parseFloat((P*(G/100)).toFixed(10));_=parseFloat((P+C).toFixed(10))}return t.jsxs("tr",{children:[t.jsx("td",{className:"text-center fw-bold",children:I+1}),t.jsx("td",{className:"text-center fw-medium",children:t.jsx("div",{children:t.jsx("button",{className:"btn btn-link p-0 fw-medium text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:async C=>{C.preventDefault(),C.stopPropagation(),await Q(N)},title:`  ${N.materialName||N.name}`,children:N.materialName||N.name})})}),t.jsx("td",{className:"text-center",children:t.jsx("span",{className:"badge bg-info",children:N.materialCategory||" "})}),t.jsx("td",{className:"text-center",children:N.quantity}),t.jsx("td",{className:"text-center",children:N.materialUnit||N.unit}),t.jsxs("td",{className:"text-center",children:[parseFloat(N.unitPrice||0).toLocaleString(void 0,{minimumFractionDigits:1,maximumFractionDigits:1})," ."]}),t.jsx("td",{className:"text-center align-middle",children:t.jsxs(t.Fragment,{children:[t.jsxs("span",{className:"text-warning fw-bold",children:[_.toLocaleString(void 0,{minimumFractionDigits:1,maximumFractionDigits:1})," ."]}),t.jsx("small",{className:"text-muted d-block",children:"( )"})]})}),t.jsx("td",{className:"text-center align-middle",children:D?t.jsx("div",{className:"d-flex justify-content-center",style:{width:"100%"},children:t.jsxs("div",{className:"d-flex align-items-center gap-3",children:[t.jsxs("div",{className:"d-flex rounded-pill border border-primary p-1",style:{backgroundColor:"#f8f9fa",width:"90px",fontSize:"10px",flexShrink:0,opacity:.7},children:[t.jsx("button",{type:"button",className:`btn btn-sm rounded-pill flex-fill ${ue(N,I)==="fixed"?"btn-primary":"btn-light"}`,style:{fontSize:"9px",padding:"4px 10px",border:"none",fontWeight:"600",opacity:.6,cursor:"not-allowed"},disabled:!0,children:""}),t.jsx("button",{type:"button",className:`btn btn-sm rounded-pill flex-fill ${ue(N,I)==="percentage"?"btn-primary":"btn-light"}`,style:{fontSize:"9px",padding:"4px 8px",border:"none",fontWeight:"600",opacity:.6,cursor:"not-allowed"},disabled:!0,children:""})]}),t.jsxs("div",{className:"input-group",style:{width:"120px",flexShrink:0},children:[t.jsx("input",{type:"number",className:"form-control form-control-sm bg-light text-center fw-bold border-primary",value:X(N,I),readOnly:!0,style:{fontSize:"12px",height:"32px",backgroundColor:"#f8f9fa",cursor:"not-allowed"}}),t.jsx("span",{className:"input-group-text input-group-text-sm bg-light text-primary fw-bold",style:{fontSize:"10px",padding:"0 8px"},children:ue(N,I)==="percentage"?"%":"."})]})]})}):t.jsx("span",{className:"text-muted",style:{fontSize:"0.9rem"},children:"-"})})]},N.internalId||I)})}),t.jsxs("tfoot",{className:"table-light",children:[t.jsxs("tr",{children:[t.jsx("th",{colSpan:"7",className:"text-end",children:" :"}),t.jsxs("th",{className:"text-center text-primary fw-bold",children:[E.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," ."]})]}),t.jsxs("tr",{children:[t.jsx("th",{colSpan:"7",className:"text-end",children:"   (%15):"}),t.jsxs("th",{className:"text-center text-success fw-bold",children:[k.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," ."]})]}),t.jsxs("tr",{className:"table-warning",children:[t.jsx("th",{colSpan:"7",className:"text-end",children:" :"}),t.jsxs("th",{className:"text-center fw-bold",style:{color:"#000000"},children:[b.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})," ."]})]})]})]})})})]}),d&&t.jsx(Td,{show:d,onHide:()=>u(!1),onClose:()=>u(!1),documents:l,onDocumentUploaded:()=>{},onDocumentDeleted:()=>{},uploading:!1,deleting:!1,readOnly:!0})]})}),Iz=wa.memo(({tenderId:n})=>{var D;const[e,s]=h.useState([]),[r,i]=h.useState(!0),[a,o]=h.useState(null),[l,c]=h.useState(null),[d,u]=h.useState(!1),[f,p]=h.useState({visible:!1,x:0,y:0,arrowX:50,content:{name:"",price:0}});h.useEffect(()=>{let y=!0;return(async()=>{if(!(!n||!y))try{i(!0),console.log(" COMPETITOR ANALYSIS: Loading data for tender:",n);const{TenderResultService:x}=await Xe(async()=>{const{TenderResultService:B}=await Promise.resolve().then(()=>jz);return{TenderResultService:B}},void 0),S=await x.testConnection();u(S);const[A,Q]=await Promise.all([dn.getTenderForViewing(n),Hl.getTenderStudy(n)]);let q=[];if(S)try{console.log(" COMPETITOR ANALYSIS: Loading competitor prices from Firestore..."),q=await x.getCompetitorPrices(n),console.log(" COMPETITOR ANALYSIS: Loaded from Firestore:",q.length,"competitors")}catch(B){console.error(" COMPETITOR ANALYSIS: Firestore loading failed:",B)}if(q.length===0){console.log(" COMPETITOR ANALYSIS: Falling back to localStorage...");const B=localStorage.getItem(`competitorPrices_${n}`);B&&(q=JSON.parse(B),console.log(" COMPETITOR ANALYSIS: Loaded from localStorage:",q.length,"competitors"))}y&&(o(A),c(Q!=null&&Q.success?Q.data:null),s(q),console.log(" COMPETITOR ANALYSIS: All data loaded successfully"))}catch(x){console.error(" COMPETITOR ANALYSIS: Error loading data:",x)}finally{y&&i(!1)}})(),()=>{y=!1}},[n]);const j=y=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(y||0),L=()=>{var G;const y=((G=l==null?void 0:l.profitCalculation)==null?void 0:G.finalPrice)||0,T=parseFloat(y)||0,x=e.filter((F,X,ue)=>ue.findIndex(Y=>Y.competitorId===F.competitorId)===X).map(F=>({price:parseFloat(F.price)||0,name:F.competitorName,competitorId:F.competitorId})).filter(F=>F.price>0&&F.name&&F.name.trim()),S=[{price:T,name:"  ",competitorId:"our_company"},...x].filter(F=>F.price>0),A=S.map(F=>F.price),Q=A.length>0?Math.min(...A):0,q=A.length>0?Math.max(...A):0,B=S.filter(F=>F.price===Q),$=S.filter(F=>F.price===q),H=B.find(F=>F.competitorId==="our_company")||B[0],te=$.find(F=>F.competitorId==="our_company")||$[0];return{ourPrice:T,lowestPrice:Q,highestPrice:q,averagePrice:A.length>0?A.reduce((F,X)=>F+X,0)/A.length:0,competitorCount:x.length,lowestPriceCompetitor:(H==null?void 0:H.name)||"",highestPriceCompetitor:(te==null?void 0:te.name)||"",totalBids:A.length}};if(r)return t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:t.jsx(It,{size:"large"})});if(!a)return t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:t.jsxs("div",{className:"text-center",children:[t.jsx("i",{className:"bi bi-exclamation-triangle text-warning",style:{fontSize:"48px"}}),t.jsx("h5",{className:"mt-3",children:"    "})]})});const R=L();return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"card shadow-sm mb-4",children:[t.jsx("div",{className:"card-header bg-primary text-white",children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-trophy me-2"})," : ",a.title]}),t.jsxs("span",{className:"badge bg-light text-dark fs-6",children:[": ",a.referenceNumber]})]})}),t.jsxs("div",{className:"card-body",children:[t.jsxs("div",{className:"row",children:[t.jsx("div",{className:"col-lg-3 col-md-6",children:t.jsxs("p",{className:"mb-2",children:[t.jsx("i",{className:"bi bi-building me-2 text-primary"}),t.jsx("strong",{children:":"})," ",a.entity]})}),t.jsx("div",{className:"col-lg-3 col-md-6",children:t.jsxs("p",{className:"mb-2",children:[t.jsx("i",{className:"bi bi-calendar-event me-2 text-primary"}),t.jsx("strong",{children:" :"})," ",(()=>{const y=a.submissionDeadline;return y?y&&typeof y=="object"&&y.seconds?new Date(y.seconds*1e3).toLocaleDateString("en-GB"):y&&typeof y=="object"&&y.toDate?y.toDate().toLocaleDateString("en-GB"):new Date(y).toLocaleDateString("en-GB"):" "})()]})})]}),t.jsxs("div",{className:"row",children:[t.jsx("div",{className:"col-lg-3 col-md-6",children:t.jsxs("p",{className:"mb-2",children:[t.jsx("i",{className:"bi bi-currency-exchange me-2 text-success"}),t.jsx("strong",{children:" :"})," ",t.jsx("span",{className:"fw-bold text-success",children:j(((D=l==null?void 0:l.profitCalculation)==null?void 0:D.finalPrice)||0)})]})}),t.jsx("div",{className:"col-lg-3 col-md-6",children:t.jsxs("p",{className:"mb-2",children:[t.jsx("i",{className:"bi bi-people me-2 text-primary"}),t.jsx("strong",{children:" :"})," ",t.jsx("span",{className:"badge bg-primary",children:R.totalBids.toLocaleString("en-US")})]})}),a.description&&t.jsx("div",{className:"col-lg-6 col-md-12",children:t.jsxs("p",{className:"mb-2",children:[t.jsx("i",{className:"bi bi-file-text me-2 text-primary"}),t.jsx("strong",{children:":"})," ",t.jsx("span",{className:"text-muted",children:a.description})]})})]})]})]}),t.jsxs("div",{className:"row mb-4",children:[t.jsx("div",{className:"col-xl-3 col-lg-6 mb-3",children:t.jsx("div",{className:"card h-100 shadow-sm border-0",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"8px"},children:t.jsxs("div",{className:"card-body text-white text-center",children:[t.jsx("div",{className:"mb-3",children:t.jsx("i",{className:"bi bi-house-check-fill fs-1"})}),t.jsx("h6",{className:"card-title mb-2",children:"  "}),t.jsx("h3",{className:"mb-0 fw-bold",children:j(R.ourPrice)}),R.ourPrice===R.lowestPrice&&R.competitorCount>0&&t.jsxs("small",{className:"d-block mt-2",children:[t.jsx("i",{className:"bi bi-trophy me-2"})," "]}),(()=>{const y=[{price:R.ourPrice,name:"  ",competitorId:"our_company"},...e.filter((S,A,Q)=>Q.findIndex(q=>q.competitorId===S.competitorId)===A).map(S=>({price:parseFloat(S.price)||0,name:S.competitorName,competitorId:S.competitorId})).filter(S=>S.price>0&&S.name&&S.name.trim())].filter(S=>S.price>0);y.sort((S,A)=>S.price-A.price);const T=y.findIndex(S=>S.competitorId==="our_company")+1,x=y.length;return T>0&&x>1?t.jsxs("small",{className:"d-block mt-2",style:{fontSize:"14px"},children:[" ",T]}):null})()]})})}),t.jsx("div",{className:"col-xl-3 col-lg-6 mb-3",children:t.jsx("div",{className:"card h-100 shadow-sm border-0",style:{background:"linear-gradient(135deg, #007bff 0%, #6610f2 100%)",borderRadius:"8px"},children:t.jsxs("div",{className:"card-body text-white text-center",children:[t.jsx("div",{className:"mb-3",children:t.jsx("i",{className:"bi bi-arrow-down-circle-fill fs-1"})}),t.jsx("h6",{className:"card-title mb-2",children:" "}),t.jsx("h3",{className:"mb-0 fw-bold",children:j(R.lowestPrice)}),R.lowestPriceCompetitor&&t.jsx("small",{className:"d-block mt-2 fw-bold",style:{fontSize:"13px"},children:R.lowestPriceCompetitor}),t.jsxs("small",{className:"d-block mt-1",children:["  ",(R.competitorCount+(R.ourPrice>0?1:0)).toLocaleString("en-US")," "]})]})})}),t.jsx("div",{className:"col-xl-3 col-lg-6 mb-3",children:t.jsx("div",{className:"card h-100 shadow-sm border-0",style:{background:"linear-gradient(135deg, #dc3545 0%, #e83e8c 100%)",borderRadius:"8px"},children:t.jsxs("div",{className:"card-body text-white text-center",children:[t.jsx("div",{className:"mb-3",children:t.jsx("i",{className:"bi bi-arrow-up-circle-fill fs-1"})}),t.jsx("h6",{className:"card-title mb-2",children:" "}),t.jsx("h3",{className:"mb-0 fw-bold",children:j(R.highestPrice)}),R.highestPriceCompetitor&&t.jsx("small",{className:"d-block mt-2 fw-bold",style:{fontSize:"13px"},children:R.highestPriceCompetitor}),t.jsxs("small",{className:"d-block mt-1",children:["  ",(R.competitorCount+(R.ourPrice>0?1:0)).toLocaleString("en-US")," "]})]})})}),t.jsx("div",{className:"col-xl-3 col-lg-6 mb-3",children:t.jsx("div",{className:"card h-100 shadow-sm border-0",style:{background:"linear-gradient(135deg, #fd7e14 0%, #ffc107 100%)",borderRadius:"8px"},children:t.jsxs("div",{className:"card-body text-white text-center",children:[t.jsx("div",{className:"mb-3",children:t.jsx("i",{className:"bi bi-calculator-fill fs-1"})}),t.jsx("h6",{className:"card-title mb-2",children:" "}),t.jsx("h3",{className:"mb-0 fw-bold",children:j(R.averagePrice)}),t.jsx("small",{className:"d-block mt-2",children:"  "})]})})})]}),(e.length>0||R.ourPrice>0)&&t.jsx("div",{className:"mb-4",style:{background:"#FFFFFF",border:"1px solid #E1E5E9",borderRadius:"8px",overflow:"hidden",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:t.jsx("div",{className:"card-body p-0",children:(()=>{const y=[];R.ourPrice>0&&y.push({price:R.ourPrice,name:"  ",isOurs:!0});let T=1;if(e.filter((F,X,ue)=>ue.findIndex(Y=>Y.competitorId===F.competitorId)===X).forEach(F=>{F.price&&F.price>0&&(y.push({price:parseFloat(F.price),name:`${T}`,originalName:F.competitorName,isOurs:!1}),T++)}),y.sort((F,X)=>F.price-X.price),y.length===0)return null;const x=Math.max(...y.map(F=>F.price)),S=Math.min(...y.map(F=>F.price)),Q=(x-S)*.15,q=Math.max(0,S-Q),B=x+Q,$=(F,X)=>{const ue=X-F,Y=Math.pow(10,Math.floor(Math.log10(ue))),z=ue/Y;let O;z<=1?O=Y*.2:z<=2?O=Y*.5:z<=5?O=Y:O=Y*2;const E=Math.floor(F/O)*O,k=Math.ceil(X/O)*O;return{yAxisMin:E,yAxisMax:k,tickInterval:O}},{yAxisMin:H,yAxisMax:te,tickInterval:G}=$(q,B);return t.jsxs("div",{style:{padding:"40px 30px 30px",overflow:"hidden"},children:[t.jsx("div",{style:{padding:"20px 20px 0 20px"},children:t.jsx("h4",{style:{color:"#333333",fontSize:"16px",fontWeight:"600",margin:"0 0 20px 0",fontFamily:"system-ui, -apple-system, sans-serif"},children:"  "})}),t.jsx("div",{style:{width:"100%",display:"flex",justifyContent:"center",overflow:"hidden"},children:t.jsxs("div",{id:"chart-container",style:{height:"450px",width:"100%",maxWidth:"1200px",background:"#FAFBFC",padding:"30px 20px",position:"relative",margin:"0"},children:[t.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 1200 400",style:{display:"block"},children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"areaGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#6CB4EE",stopOpacity:"0.7"}),t.jsx("stop",{offset:"100%",stopColor:"#6CB4EE",stopOpacity:"0.1"})]})}),(()=>{const F=[];for(let X=H;X<=te;X+=G)F.push(X);return F.map((X,ue)=>{const z=80+280*((te-X)/(te-H));return t.jsxs("g",{children:[t.jsx("line",{x1:"100",y1:z,x2:"1100",y2:z,stroke:"#E8E8E8",strokeWidth:"1"}),t.jsx("text",{x:"85",y:z+4,textAnchor:"end",fontSize:"12",fontWeight:"400",fill:"#666666",fontFamily:"system-ui, -apple-system, sans-serif",children:Math.round(X).toLocaleString("en-US")})]},ue)})})(),(()=>{const F=y.map((ue,Y)=>{const z=100+(Y+1)/(y.length+1)*1e3,O=360-(ue.price-H)/(te-H||1)*280;return{x:z,y:O,bid:ue}});let X=`M ${F[0].x} 360`;X+=` L ${F[0].x} ${F[0].y}`;for(let ue=1;ue<F.length;ue++){const Y=F[ue],z=F[ue-1],O=(z.x+Y.x)/2;X+=` Q ${O} ${z.y} ${Y.x} ${Y.y}`}return X+=` L ${F[F.length-1].x} 360 Z`,t.jsxs("g",{children:[t.jsx("path",{d:X,fill:"url(#areaGradient)",stroke:"#4A90E2",strokeWidth:"2",style:{animation:"fillArea 2s ease-out",transformOrigin:"bottom"}}),(()=>{const ue=360-(R.averagePrice-H)/(te-H||1)*280;return t.jsxs("g",{children:[t.jsx("line",{x1:F[0].x,y1:ue,x2:F[F.length-1].x,y2:ue,stroke:"#DC3545",strokeWidth:"1",strokeDasharray:"3,3",style:{opacity:.7,animation:"fadeUp 2s ease-out 0.5s both"}}),t.jsx("text",{x:"1105",y:ue+4,fontSize:"11",fontWeight:"500",fill:"#DC3545",fontFamily:"system-ui, -apple-system, sans-serif",children:" "})]})})(),F.map((ue,Y)=>{const z=F.map(k=>k.bid.price),O=Math.min(...z),E=ue.bid.price===O;return t.jsxs("g",{children:[E&&t.jsx("text",{x:ue.x,y:ue.y-35,textAnchor:"middle",dominantBaseline:"middle",style:{fontSize:"28px",fill:"#FFD700",filter:"drop-shadow(0 2px 4px rgba(255, 215, 0, 0.6))"},children:""}),t.jsx("circle",{cx:ue.x,cy:ue.y,r:E?"7":"5",fill:ue.bid.isOurs?"#28A745":E?"#FFD700":"#FFFFFF",stroke:ue.bid.isOurs?"#1E7E34":E?"#FFA000":"#29B6F6",strokeWidth:"2",style:{filter:E?"drop-shadow(0 4px 8px rgba(255, 215, 0, 0.5))":"drop-shadow(0 2px 4px rgba(0,0,0,0.3))",cursor:"pointer",animation:`pointDrop 1.5s ease-out ${Y*.1}s both`},onMouseEnter:k=>{const b=k.target,N=document.getElementById("chart-container");if(!N||!b)return;const I=b.getBoundingClientRect(),P=N.getBoundingClientRect(),_=Math.round(I.left+I.width/2-P.left),C=Math.round(I.top+I.height/2-P.top),U=180,w=60;let W=_-U/2;const ie=C-w-10,de=_,ne=10,ye=N.offsetWidth;W<ne?W=ne:W+U>ye-ne&&(W=ye-U-ne);let be=(de-W)/U*100;be=Math.max(6,Math.min(94,be)),p({visible:!0,x:W,y:ie,arrowX:be,content:{name:ue.bid.originalName||ue.bid.name,price:ue.bid.price}})},onMouseLeave:()=>{p(k=>({...k,visible:!1}))}}),ue.bid.isOurs&&t.jsx("line",{x1:ue.x,y1:ue.y+5,x2:ue.x,y2:365,stroke:"#999999",strokeWidth:"1.5",strokeDasharray:"3,2",style:{animation:`fadeUp 2s ease-out ${Y*.1}s both`,opacity:.9}}),t.jsx("text",{x:ue.x,y:385,textAnchor:"middle",fontSize:"12",fontWeight:ue.bid.isOurs?"600":"400",fill:ue.bid.isOurs?"#495057":"#666666",fontFamily:"system-ui, -apple-system, sans-serif",style:{animation:`fadeUp 2s ease-out ${Y*.1}s both`},children:` ${ue.bid.name} `})]},Y)})]})})()]}),t.jsxs("div",{style:{position:"absolute",top:"20px",right:"20px",background:"rgba(255,255,255,0.15)",borderRadius:"10px",padding:"12px",backdropFilter:"blur(10px)"},children:[t.jsxs("div",{className:"d-flex align-items-center gap-2 mb-2",children:[t.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:"#28A745",border:"2px solid #1E7E34"}}),t.jsx("small",{style:{color:"#666666",fontWeight:"bold"},children:""})]}),t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:"#FFFFFF",border:"2px solid #29B6F6"}}),t.jsx("small",{style:{color:"#666666"},children:""})]})]}),f.visible&&t.jsx("div",{style:{position:"absolute",left:`${f.x}px`,top:`${f.y}px`,pointerEvents:"none",zIndex:1e3,transform:"translateZ(0)",willChange:"transform"},children:t.jsxs("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",padding:"10px 16px",borderRadius:"8px",fontSize:"13px",whiteSpace:"nowrap",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.3)",border:"1px solid rgba(255,255,255,0.2)",position:"relative",textAlign:"center"},children:[t.jsx("div",{style:{fontWeight:600,marginBottom:"4px",textAlign:"center"},children:f.content.name}),t.jsx("div",{style:{color:"#FFD700",fontWeight:700,fontSize:"14px",textAlign:"center"},children:j(f.content.price)}),t.jsx("div",{style:{position:"absolute",bottom:"-6px",left:`${f.arrowX}%`,transform:"translateX(-50%)",width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid #667eea",imageRendering:"pixelated",shapeRendering:"crispEdges"}})]})})]})})]})})()})}),(e.length>0||R.ourPrice>0)&&t.jsxs("div",{className:"mb-4",style:{background:"#FFFFFF",border:"1px solid #E1E5E9",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},children:[t.jsx("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"8px 8px 0 0",padding:"20px 30px"},children:t.jsx("h5",{style:{color:"white",fontSize:"18px",fontWeight:"700",margin:"0",textAlign:"center",textShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:"    "})}),t.jsxs("div",{style:{padding:"30px",background:"linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%)"},children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:"20px",maxWidth:"1200px",margin:"0 auto"},children:[t.jsxs("div",{style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"16px",padding:"24px",color:"white",textAlign:"center",boxShadow:"0 8px 20px rgba(40, 167, 69, 0.3)",border:"2px solid rgba(255, 255, 255, 0.2)",position:"relative",overflow:"hidden"},children:[t.jsx("div",{style:{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",opacity:"0.1",backgroundImage:`radial-gradient(circle at 20% 50%, white 2px, transparent 2px),
                                  radial-gradient(circle at 80% 50%, white 2px, transparent 2px)`,backgroundSize:"30px 30px"}}),t.jsxs("div",{style:{position:"relative",zIndex:"1"},children:[t.jsx("div",{style:{fontSize:"32px",marginBottom:"12px",filter:"drop-shadow(0 4px 8px rgba(255, 215, 0, 0.8))",animation:"crownGlow 2s ease-in-out infinite"},children:""}),t.jsx("h6",{style:{fontSize:"16px",fontWeight:"600",margin:"0 0 8px 0",opacity:"0.9"},children:" "}),t.jsx("div",{style:{fontSize:"28px",fontWeight:"800",marginBottom:"8px",textShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:j(R.lowestPrice)}),t.jsx("div",{style:{fontSize:"13px",opacity:"0.85",fontWeight:"500"},children:R.lowestPriceCompetitor||"  "})]})]}),t.jsxs("div",{style:{background:"linear-gradient(135deg, #6c5ce7 0%, #a55eea 100%)",borderRadius:"16px",padding:"24px",color:"white",textAlign:"center",boxShadow:"0 8px 20px rgba(108, 92, 231, 0.3)",border:"2px solid rgba(255, 255, 255, 0.2)",position:"relative"},children:[t.jsx("div",{style:{fontSize:"24px",marginBottom:"12px"},children:""}),t.jsx("h6",{style:{fontSize:"16px",fontWeight:"600",margin:"0 0 12px 0",opacity:"0.9"},children:" "}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[t.jsxs("div",{style:{textAlign:"right"},children:[t.jsx("div",{style:{fontSize:"12px",opacity:"0.8"},children:""}),t.jsx("div",{style:{fontSize:"18px",fontWeight:"700"},children:j(R.lowestPrice)})]}),t.jsx("div",{style:{flex:"1",height:"4px",background:"rgba(255,255,255,0.3)",borderRadius:"2px",margin:"0 12px",position:"relative"},children:t.jsx("div",{style:{position:"absolute",left:"0",top:"0",height:"100%",width:"30%",background:"rgba(255,255,255,0.8)",borderRadius:"2px"}})}),t.jsxs("div",{style:{textAlign:"left"},children:[t.jsx("div",{style:{fontSize:"12px",opacity:"0.8"},children:""}),t.jsx("div",{style:{fontSize:"18px",fontWeight:"700"},children:j(R.highestPrice)})]})]}),t.jsxs("div",{style:{fontSize:"13px",opacity:"0.85",fontWeight:"500"},children:[": ",j(R.highestPrice-R.lowestPrice)]})]}),t.jsxs("div",{style:{background:"linear-gradient(135deg, #00b894 0%, #00cec9 100%)",borderRadius:"16px",padding:"24px",color:"white",textAlign:"center",boxShadow:"0 8px 20px rgba(0, 184, 148, 0.3)",border:"2px solid rgba(255, 255, 255, 0.2)"},children:[t.jsx("div",{style:{fontSize:"24px",marginBottom:"12px"},children:""}),t.jsx("h6",{style:{fontSize:"16px",fontWeight:"600",margin:"0 0 12px 0",opacity:"0.9"},children:" "}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginBottom:"12px"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"12px",opacity:"0.8"},children:""}),t.jsx("div",{style:{fontSize:"18px",fontWeight:"700"},children:j(R.averagePrice)})]}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"12px",opacity:"0.8"},children:""}),t.jsx("div",{style:{fontSize:"18px",fontWeight:"700"},children:R.competitorCount+(R.ourPrice>0?1:0)})]})]}),t.jsx("div",{style:{fontSize:"13px",opacity:"0.85",fontWeight:"500"},children:R.competitorCount>0?" ":"  "})]})]}),t.jsxs("div",{style:{marginTop:"30px",padding:"20px",background:"rgba(0, 123, 255, 0.05)",borderRadius:"12px",border:"1px solid rgba(0, 123, 255, 0.1)"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[t.jsx("h6",{style:{fontSize:"16px",fontWeight:"600",margin:"0",color:"#007bff"},children:"        "}),t.jsx("span",{style:{fontSize:"18px",fontWeight:"800",color:R.ourPrice>R.lowestPrice?"#dc3545":R.ourPrice===R.lowestPrice?"#28a745":"#007bff",background:R.ourPrice>R.lowestPrice?"rgba(220, 53, 69, 0.1)":R.ourPrice===R.lowestPrice?"rgba(40, 167, 69, 0.1)":"rgba(0, 123, 255, 0.1)",padding:"8px 16px",borderRadius:"20px",border:`2px solid ${R.ourPrice>R.lowestPrice?"#dc3545":R.ourPrice===R.lowestPrice?"#28a745":"#007bff"}`},children:(()=>{const y=R.ourPrice-R.lowestPrice;return y===0?"   ":y>0?`+${j(y)}`:j(y)})()})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginTop:"16px"},children:[t.jsxs("div",{style:{flex:"1",textAlign:"center",padding:"12px",background:"rgba(40, 167, 69, 0.1)",borderRadius:"8px",border:"1px solid rgba(40, 167, 69, 0.3)"},children:[t.jsx("div",{style:{fontSize:"12px",color:"#28a745",fontWeight:"600",marginBottom:"4px"},children:"   "}),t.jsx("div",{style:{fontSize:"16px",fontWeight:"700",color:"#28a745"},children:j(R.lowestPrice)})]}),t.jsx("div",{style:{fontSize:"20px",color:"#6c757d"},children:""}),t.jsxs("div",{style:{flex:"1",textAlign:"center",padding:"12px",background:"rgba(0, 123, 255, 0.1)",borderRadius:"8px",border:"1px solid rgba(0, 123, 255, 0.3)"},children:[t.jsx("div",{style:{fontSize:"12px",color:"#007bff",fontWeight:"600",marginBottom:"4px"},children:"   "}),t.jsx("div",{style:{fontSize:"16px",fontWeight:"700",color:"#007bff"},children:j(R.ourPrice)})]})]}),t.jsx("div",{style:{marginTop:"16px",padding:"12px",background:R.ourPrice===R.lowestPrice?"rgba(40, 167, 69, 0.05)":R.ourPrice>R.lowestPrice?"rgba(220, 53, 69, 0.05)":"rgba(0, 123, 255, 0.05)",borderRadius:"8px",textAlign:"center",fontSize:"14px",fontWeight:"600",color:R.ourPrice===R.lowestPrice?"#28a745":R.ourPrice>R.lowestPrice?"#dc3545":"#007bff"},children:R.ourPrice===R.lowestPrice?" !        ":R.ourPrice>R.lowestPrice?"       ":"      "})]})]})]}),t.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes fillArea {
          from {
            opacity: 0;
            transform: scaleY(0);
          }
          to {
            opacity: 1;
            transform: scaleY(1);
          }
        }

        @keyframes pointDrop {
          from {
            opacity: 0;
            transform: translateY(-20px) scale(0);
          }
          to {
            opacity: 1;
            transform: translateY(0) scale(1);
          }
        }

        @keyframes crownGlow {
          0%, 100% {
            filter: drop-shadow(0 2px 4px rgba(255, 215, 0, 0.5));
            transform: scale(1);
          }
          50% {
            filter: drop-shadow(0 4px 8px rgba(255, 215, 0, 0.8));
            transform: scale(1.1);
          }
        }

        @keyframes fadeUp {
          from {
            opacity: 0;
            transform: translateY(10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
      `}),t.jsx("div",{className:"alert alert-info border-0 mb-4",style:{background:"linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%)"},children:t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-eye text-info me-2",style:{fontSize:"18px"}}),t.jsx("strong",{children:"  :"}),t.jsx("span",{className:"ms-2",children:"     "})]})}),t.jsxs("div",{className:"card shadow-sm",children:[t.jsx("div",{className:"card-header bg-white border-bottom",children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("h5",{className:"mb-0 fw-bold",children:[t.jsx("i",{className:"bi bi-people-fill text-primary me-2"})," ",d&&t.jsxs("span",{className:"badge bg-success ms-2",children:[t.jsx("i",{className:"bi bi-cloud-check me-1"}),""]}),!d&&t.jsxs("span",{className:"badge bg-warning ms-2",children:[t.jsx("i",{className:"bi bi-wifi-off me-1"})," "]})]}),t.jsxs("span",{className:"badge bg-secondary",children:[t.jsx("i",{className:"bi bi-eye me-1"})," "]})]})}),t.jsx("div",{className:"card-body",children:e.length===0?t.jsxs("div",{className:"text-center py-5",children:[t.jsx("i",{className:"bi bi-people text-muted",style:{fontSize:"48px"}}),t.jsx("h5",{className:"text-muted",children:"   "}),t.jsx("p",{className:"text-muted mb-0",children:"      "})]}):t.jsx("div",{className:"row",children:e.filter((y,T,x)=>x.findIndex(S=>S.competitorId===y.competitorId)===T).map((y,T)=>t.jsx("div",{className:"col-lg-6 col-xl-4 mb-4",children:t.jsxs("div",{className:"card h-100 border shadow-sm",children:[t.jsxs("div",{className:"card-header bg-light d-flex justify-content-between align-items-center py-2",children:[t.jsxs("h6",{className:"mb-0 fw-bold text-dark",children:[" ",(T+1).toLocaleString("en-US")]}),t.jsx("span",{className:"badge bg-secondary",children:" "})]}),t.jsxs("div",{className:"card-body",children:[t.jsx("div",{className:"mb-3",children:t.jsxs("p",{className:"mb-1",children:[t.jsx("strong",{children:":"})," ",y.competitorName]})}),t.jsxs("div",{className:"mb-0",children:[t.jsx("label",{className:"form-label fw-bold",children:""}),t.jsxs("div",{className:"input-group",children:[t.jsx("input",{type:"number",className:"form-control bg-light",value:y.price,readOnly:!0,style:{fontSize:"16px",fontWeight:"500",backgroundColor:"#f8f9fa"}}),t.jsx("span",{className:"input-group-text bg-light",children:""})]}),y.price>0&&t.jsxs("div",{className:"mt-2",children:[t.jsx("span",{className:"badge bg-primary",children:j(y.price)}),y.price===R.lowestPrice&&t.jsxs("span",{className:"badge bg-success ms-2",children:[t.jsx("i",{className:"bi bi-trophy me-2"})," "]}),y.price===R.highestPrice&&R.lowestPrice!==R.highestPrice&&t.jsxs("span",{className:"badge bg-danger ms-2",children:[t.jsx("i",{className:"bi bi-arrow-up me-2"})," "]})]})]})]})]})},y.competitorId||y.id))})})]})]})});function Tz(){const[n,e]=h.useState(!1),[s,r]=h.useState("details"),{isTimelineVisible:i}=Ut(),{alertConfig:a,closeAlert:o}=Bt(),l=kt(),[c]=Eh(),d=h.useMemo(()=>c.get("tenderId"),[c]),u=h.useCallback(()=>{e(p=>!p)},[]),f=h.useMemo(()=>[{id:"details",label:" ",icon:"bi-info-circle"},{id:"pricing",label:" ",icon:"bi-calculator"},{id:"competitors",label:" ",icon:"bi-people"}],[]);return d?t.jsxs("div",{className:`page-wrapper ${n?"sidebar-collapsed":""}`,dir:"rtl",children:[t.jsx(Rt,{onToggle:u}),t.jsxs("div",{className:"main-container",style:{paddingRight:n?"72px":"250px",paddingLeft:n||!i?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[t.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:n?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:t.jsx(_t,{isCollapsed:n})}),t.jsxs("div",{className:"app-container",children:[t.jsxs("div",{className:"app-hero-header d-flex align-items-center justify-content-between px-3 py-2 border-top",children:[t.jsxs("ol",{className:"breadcrumb m-0",children:[t.jsx("li",{className:"breadcrumb-item",children:t.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[t.jsx("i",{className:"bi bi-house lh-1 me-2"}),t.jsx("span",{className:"text-primary",children:""})]})}),t.jsx("li",{className:"breadcrumb-item",children:t.jsx("a",{href:"/tenders/tracking",className:"text-decoration-none",children:t.jsx("span",{className:"text-primary",children:" "})})}),t.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:" "})]}),t.jsx("div",{className:"d-flex gap-2 justify-content-center",children:f.map(p=>t.jsxs("button",{className:`btn ${s===p.id?"btn-primary":"btn-outline-primary"}`,onClick:()=>r(p.id),style:{minWidth:"150px",fontSize:"14px",fontWeight:"500",borderRadius:"8px",transition:"all 0.2s ease"},children:[t.jsx("i",{className:`${p.icon} me-2`}),p.label]},p.id))})]}),t.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:t.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:t.jsxs(h.Suspense,{fallback:t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:t.jsxs("div",{className:"text-center",children:[t.jsx(It,{size:"large"}),t.jsx("p",{className:"mt-3 text-muted",children:" ..."})]})}),children:[s==="details"&&t.jsx(Ez,{tenderId:d}),s==="pricing"&&t.jsx(Cz,{tenderId:d}),s==="competitors"&&t.jsx(Iz,{tenderId:d})]})})})]}),!n&&i&&t.jsx(h.Suspense,{fallback:null,children:t.jsx(SimpleActivityTimeline,{rtl:!0})}),!n&&i&&t.jsx(h.Suspense,{fallback:null,children:t.jsx(ManualActivityCreator,{})})]}),t.jsx(Mt,{show:a.show,onClose:o,title:a.title,message:a.message,type:a.type,onConfirm:a.onConfirm,showConfirm:a.showConfirm,showCancel:a.showCancel,confirmText:a.confirmText,cancelText:a.cancelText})]}):t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"60vh"},children:t.jsxs("div",{className:"text-center",children:[t.jsx("i",{className:"bi bi-exclamation-triangle text-warning",style:{fontSize:"48px"}}),t.jsx("h5",{className:"mt-3",children:"     "}),t.jsx("p",{className:"text-muted",children:"     "}),t.jsx("button",{className:"btn btn-primary",onClick:()=>l("/tenders/tracking"),children:" "})]})})}function Az(){return t.jsx(Lt,{children:t.jsx(Ft,{children:t.jsx(Tz,{})})})}const _z=()=>{document.readyState!=="loading"?eS():document.addEventListener("DOMContentLoaded",eS)},eS=()=>{console.log(" Applying emergency navigation fix...");const n=['.table td span[role="button"]',".table td button",".table td a",".pagination .page-link",".sidebar-menu a",".sidebar-menu button",".btn","input",".card-body",".app-content-area"];n.forEach(s=>{document.querySelectorAll(s).forEach(i=>{i.style.setProperty("pointer-events","auto","important"),i.style.setProperty("position","relative","important"),i.style.setProperty("z-index","1100","important")})}),new MutationObserver(s=>{s.forEach(r=>{r.addedNodes.forEach(i=>{i.nodeType===Node.ELEMENT_NODE&&n.forEach(a=>{i.matches&&i.matches(a)&&(i.style.setProperty("pointer-events","auto","important"),i.style.setProperty("position","relative","important"),i.style.setProperty("z-index","1100","important")),i.querySelectorAll(a).forEach(l=>{l.style.setProperty("pointer-events","auto","important"),l.style.setProperty("position","relative","important"),l.style.setProperty("z-index","1100","important")})})})})}).observe(document.body,{childList:!0,subtree:!0}),console.log(" Emergency navigation fix applied")};_z();const Rz=()=>t.jsx(M4,{children:t.jsx(D4,{children:t.jsx(j4,{children:t.jsx(R4,{children:t.jsx(V4,{children:t.jsx(Lt,{children:t.jsxs(x4,{children:[t.jsx(B4,{}),t.jsx(KD,{basename:"/",future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:t.jsxs(zD,{children:[t.jsx(Et,{path:"/",element:t.jsx(Pj,{})}),t.jsx(Et,{path:"/tender",element:t.jsx(Pj,{})}),t.jsx(Et,{path:"/tenders",element:t.jsx(kj,{})}),t.jsx(Et,{path:"/tenders/list",element:t.jsx(kj,{})}),t.jsx(Et,{path:"/tenders/add",element:t.jsx(Fj,{})}),t.jsx(Et,{path:"/tenders/edit/:id",element:t.jsx(Fj,{})}),t.jsx(Et,{path:"/tenders/tracking",element:t.jsx(kU,{})}),t.jsx(Et,{path:"/tenders/archive",element:t.jsx($U,{})}),t.jsx(Et,{path:"/tenders/lost",element:t.jsx(qU,{})}),t.jsx(Et,{path:"/tenders/won",element:t.jsx(XU,{})}),t.jsx(Et,{path:"/tenders/selection",element:t.jsx(e$,{})}),t.jsx(Et,{path:"/tender-study/:tenderId",element:t.jsx(Uj,{})}),t.jsx(Et,{path:"/tenders/study/:tenderId",element:t.jsx(Uj,{})}),t.jsx(Et,{path:"/tenders/raw-materials/:tenderId",element:t.jsx(r$,{})}),t.jsx(Et,{path:"/tenders/local-products/:tenderId",element:t.jsx(a$,{})}),t.jsx(Et,{path:"/tenders/foreign-products/:tenderId",element:t.jsx(l$,{})}),t.jsx(Et,{path:"/tenders/manufactured-products/:tenderId",element:t.jsx(d$,{})}),t.jsx(Et,{path:"/tenders/services/:tenderId",element:t.jsx(Xj,{})}),t.jsx(Et,{path:"/services",element:t.jsx(h6,{})}),t.jsx(Et,{path:"/services/add",element:t.jsx(Jj,{})}),t.jsx(Et,{path:"/services/edit/:id",element:t.jsx(Jj,{})}),t.jsx(Et,{path:"/services/tender",element:t.jsx(Xj,{})}),t.jsx(Et,{path:"/services/manufacture/:productId",element:t.jsx(x6,{})}),t.jsx(Et,{path:"/raw-materials",element:t.jsx(b$,{})}),t.jsx(Et,{path:"/raw-materials/add",element:t.jsx(Wj,{})}),t.jsx(Et,{path:"/raw-materials/edit/:id",element:t.jsx(Wj,{})}),t.jsx(Et,{path:"/local-products",element:t.jsx(_$,{})}),t.jsx(Et,{path:"/local-products/add",element:t.jsx(qj,{})}),t.jsx(Et,{path:"/local-products/edit/:id",element:t.jsx(qj,{})}),t.jsx(Et,{path:"/foreign-products",element:t.jsx(L$,{})}),t.jsx(Et,{path:"/foreign-products/add",element:t.jsx(Hj,{})}),t.jsx(Et,{path:"/foreign-products/edit/:id",element:t.jsx(Hj,{})}),t.jsx(Et,{path:"/manufactured-products",element:t.jsx($$,{})}),t.jsx(Et,{path:"/manufactured-products/add",element:t.jsx(Qj,{})}),t.jsx(Et,{path:"/manufactured-products/edit/:id",element:t.jsx(Qj,{})}),t.jsx(Et,{path:"/manufactured-products/raw-materials/:productId",element:t.jsx(q$,{})}),t.jsx(Et,{path:"/manufactured-products/local-products/:productId",element:t.jsx(Q$,{})}),t.jsx(Et,{path:"/manufactured-products/foreign-products/:productId",element:t.jsx(Y$,{})}),t.jsx(Et,{path:"/suppliers/local",element:t.jsx(e6,{})}),t.jsx(Et,{path:"/local-suppliers/add",element:t.jsx(Kj,{})}),t.jsx(Et,{path:"/local-suppliers/edit/:id",element:t.jsx(Kj,{})}),t.jsx(Et,{path:"/suppliers/foreign",element:t.jsx(a6,{})}),t.jsx(Et,{path:"/foreign-suppliers/add",element:t.jsx(Yj,{})}),t.jsx(Et,{path:"/foreign-suppliers/edit/:id",element:t.jsx(Yj,{})}),t.jsx(Et,{path:"/supplier-selection/local",element:t.jsx(c6,{})}),t.jsx(Et,{path:"/supplier-selection/foreign",element:t.jsx(d6,{})}),t.jsx(Et,{path:"/clients",element:t.jsx(j6,{})}),t.jsx(Et,{path:"/competitors",element:t.jsx(A6,{})}),t.jsx(Et,{path:"/competitor-selection",element:t.jsx(Nz,{})}),t.jsx(Et,{path:"/tender-result",element:t.jsx(Sz,{})}),t.jsx(Et,{path:"/awarding-stage",element:t.jsx(Az,{})}),t.jsx(Et,{path:"/companies",element:t.jsx(F6,{})}),t.jsx(Et,{path:"/employees",element:t.jsx($6,{})}),t.jsx(Et,{path:"/employees/:employeeId/permissions",element:t.jsx(Q6,{})}),t.jsx(Et,{path:"/curriculum",element:t.jsx(W6,{})}),t.jsx(Et,{path:"/employee-time-tracking",element:t.jsx(Y6,{})}),t.jsx(Et,{path:"/trash",element:t.jsx(Z6,{})}),t.jsx(Et,{path:"/settings",element:t.jsx(rz,{})}),t.jsx(Et,{path:"/time-tracking",element:t.jsx(lz,{})}),t.jsx(Et,{path:"/accounts-chart",element:t.jsx(hz,{})}),t.jsx(Et,{path:"/accounts-archive",element:t.jsx(pz,{})}),t.jsx(Et,{path:"/journal-entry",element:t.jsx(xz,{})}),t.jsx(Et,{path:"/journal-entry-list",element:t.jsx(vz,{})})]})})]})})})})})})});function Dz(){return t.jsx(L4,{children:t.jsx(Rz,{})})}const V0=4;function tS(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}function Pz(n=V0){var a,o;const e=window.innerWidth,s=window.innerHeight,r=(((a=window.screen)==null?void 0:a.availWidth)??window.screen.width)-n,i=(((o=window.screen)==null?void 0:o.availHeight)??window.screen.height)-n;return e>=r&&s>=i}function kz({requireF11:n=!1,tolerance:e=V0}={}){return n?tS():tS()||Pz(e)}function Lz(n,{requireF11:e=!1,tolerance:s=V0}={}){const r=()=>{if(!(document.visibilityState==="visible")){n({ok:!1,reason:"Tab hidden/background"});return}if(!kz({requireF11:e,tolerance:s})){n({ok:!1,reason:e?"Not in F11 fullscreen":"Window not fullscreen/maximized"});return}n({ok:!0,reason:""})};return document.addEventListener("visibilitychange",r),document.addEventListener("fullscreenchange",r),document.addEventListener("webkitfullscreenchange",r),document.addEventListener("mozfullscreenchange",r),document.addEventListener("MSFullscreenChange",r),window.addEventListener("resize",r),r(),()=>{document.removeEventListener("visibilitychange",r),document.removeEventListener("fullscreenchange",r),document.removeEventListener("webkitfullscreenchange",r),document.removeEventListener("mozfullscreenchange",r),document.removeEventListener("MSFullscreenChange",r),window.removeEventListener("resize",r)}}async function Fz(n=document.documentElement){const e=n;if(e.requestFullscreen)return e.requestFullscreen();if(e.webkitRequestFullscreen)return e.webkitRequestFullscreen();if(e.mozRequestFullScreen)return e.mozRequestFullScreen();if(e.msRequestFullscreen)return e.msRequestFullscreen();throw new Error("Fullscreen API not supported")}function Oz({requireF11:n=!1,tolerance:e=4,blockerZIndex:s=9999,onEnter:r,onExit:i,children:a}){const[o,l]=h.useState(!1),[c,d]=h.useState("Not fullscreen"),[u,f]=h.useState(""),p=h.useRef(!1);h.useEffect(()=>{const L=Lz(({ok:R,reason:D})=>{const y=R||U4();l(y),d(y?"":D||"")},{requireF11:n,tolerance:e});return()=>L()},[n,e]),h.useEffect(()=>{o!==p.current&&(p.current=o,o?r==null||r():i==null||i())},[o,r,i]);const j=async()=>{try{await Fz(),f("")}catch(L){f((L==null?void 0:L.message)||"Failed to enter fullscreen")}};return o?t.jsx(t.Fragment,{children:a}):t.jsx("div",{style:{position:"fixed",inset:0,background:"linear-gradient(135deg, rgba(0,123,255,0.95) 0%, rgba(0,86,179,0.95) 100%)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",zIndex:s,padding:24,textAlign:"center",fontFamily:"system-ui, -apple-system, sans-serif",direction:"rtl"},children:t.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.95)",color:"#333",padding:"40px",borderRadius:"16px",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",maxWidth:"500px",width:"90%",backdropFilter:"blur(10px)"},children:[t.jsx("div",{style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",width:"80px",height:"80px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 24px auto",fontSize:"36px",color:"white"},children:t.jsx("i",{className:"bi bi-arrows-fullscreen"})}),t.jsx("h2",{style:{fontSize:"24px",fontWeight:"bold",color:"#333",marginBottom:"24px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:n?"    (F11)":"  "}),t.jsxs("button",{onClick:j,style:{padding:"16px 32px",fontSize:"16px",fontWeight:"bold",borderRadius:"12px",border:"none",cursor:"pointer",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",color:"white",transition:"all 0.3s ease",boxShadow:"0 4px 15px rgba(0,123,255,0.4)",marginBottom:"16px",minWidth:"200px"},onMouseEnter:L=>{L.target.style.transform="translateY(-2px)",L.target.style.boxShadow="0 8px 25px rgba(0,123,255,0.6)"},onMouseLeave:L=>{L.target.style.transform="translateY(0)",L.target.style.boxShadow="0 4px 15px rgba(0,123,255,0.4)"},children:[t.jsx("i",{className:"bi bi-arrows-fullscreen me-2"}),"  "]}),u&&t.jsxs("div",{style:{marginTop:"16px",padding:"12px",background:"linear-gradient(135deg, #dc3545 0%, #b02a37 100%)",color:"white",borderRadius:"8px",fontSize:"14px"},children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),u]}),t.jsxs("p",{style:{marginTop:"20px",opacity:.7,fontSize:"14px",color:"#666",lineHeight:"1.5"},children:[t.jsx("i",{className:"bi bi-info-circle me-2"}),"        ."]})]})})}var Mz={exports:{}};/*!
  * Bootstrap v5.3.7 (https://getbootstrap.com/)
  * Copyright 2011-2025 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */(function(n,e){(function(s,r){n.exports=r()})(j_,function(){const s=new Map,r={set(ee,g,V){s.has(ee)||s.set(ee,new Map);const le=s.get(ee);le.has(g)||le.size===0?le.set(g,V):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(le.keys())[0]}.`)},get:(ee,g)=>s.has(ee)&&s.get(ee).get(g)||null,remove(ee,g){if(!s.has(ee))return;const V=s.get(ee);V.delete(g),V.size===0&&s.delete(ee)}},i="transitionend",a=ee=>(ee&&window.CSS&&window.CSS.escape&&(ee=ee.replace(/#([^\s"#']+)/g,(g,V)=>`#${CSS.escape(V)}`)),ee),o=ee=>{ee.dispatchEvent(new Event(i))},l=ee=>!(!ee||typeof ee!="object")&&(ee.jquery!==void 0&&(ee=ee[0]),ee.nodeType!==void 0),c=ee=>l(ee)?ee.jquery?ee[0]:ee:typeof ee=="string"&&ee.length>0?document.querySelector(a(ee)):null,d=ee=>{if(!l(ee)||ee.getClientRects().length===0)return!1;const g=getComputedStyle(ee).getPropertyValue("visibility")==="visible",V=ee.closest("details:not([open])");if(!V)return g;if(V!==ee){const le=ee.closest("summary");if(le&&le.parentNode!==V||le===null)return!1}return g},u=ee=>!ee||ee.nodeType!==Node.ELEMENT_NODE||!!ee.classList.contains("disabled")||(ee.disabled!==void 0?ee.disabled:ee.hasAttribute("disabled")&&ee.getAttribute("disabled")!=="false"),f=ee=>{if(!document.documentElement.attachShadow)return null;if(typeof ee.getRootNode=="function"){const g=ee.getRootNode();return g instanceof ShadowRoot?g:null}return ee instanceof ShadowRoot?ee:ee.parentNode?f(ee.parentNode):null},p=()=>{},j=ee=>{ee.offsetHeight},L=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,R=[],D=()=>document.documentElement.dir==="rtl",y=ee=>{var g;g=()=>{const V=L();if(V){const le=ee.NAME,ve=V.fn[le];V.fn[le]=ee.jQueryInterface,V.fn[le].Constructor=ee,V.fn[le].noConflict=()=>(V.fn[le]=ve,ee.jQueryInterface)}},document.readyState==="loading"?(R.length||document.addEventListener("DOMContentLoaded",()=>{for(const V of R)V()}),R.push(g)):g()},T=(ee,g=[],V=ee)=>typeof ee=="function"?ee.call(...g):V,x=(ee,g,V=!0)=>{if(!V)return void T(ee);const le=(Ue=>{if(!Ue)return 0;let{transitionDuration:Qe,transitionDelay:ct}=window.getComputedStyle(Ue);const vt=Number.parseFloat(Qe),St=Number.parseFloat(ct);return vt||St?(Qe=Qe.split(",")[0],ct=ct.split(",")[0],1e3*(Number.parseFloat(Qe)+Number.parseFloat(ct))):0})(g)+5;let ve=!1;const Ce=({target:Ue})=>{Ue===g&&(ve=!0,g.removeEventListener(i,Ce),T(ee))};g.addEventListener(i,Ce),setTimeout(()=>{ve||o(g)},le)},S=(ee,g,V,le)=>{const ve=ee.length;let Ce=ee.indexOf(g);return Ce===-1?!V&&le?ee[ve-1]:ee[0]:(Ce+=V?1:-1,le&&(Ce=(Ce+ve)%ve),ee[Math.max(0,Math.min(Ce,ve-1))])},A=/[^.]*(?=\..*)\.|.*/,Q=/\..*/,q=/::\d+$/,B={};let $=1;const H={mouseenter:"mouseover",mouseleave:"mouseout"},te=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function G(ee,g){return g&&`${g}::${$++}`||ee.uidEvent||$++}function F(ee){const g=G(ee);return ee.uidEvent=g,B[g]=B[g]||{},B[g]}function X(ee,g,V=null){return Object.values(ee).find(le=>le.callable===g&&le.delegationSelector===V)}function ue(ee,g,V){const le=typeof g=="string",ve=le?V:g||V;let Ce=E(ee);return te.has(Ce)||(Ce=ee),[le,ve,Ce]}function Y(ee,g,V,le,ve){if(typeof g!="string"||!ee)return;let[Ce,Ue,Qe]=ue(g,V,le);g in H&&(Ue=(Jt=>function(Wt){if(!Wt.relatedTarget||Wt.relatedTarget!==Wt.delegateTarget&&!Wt.delegateTarget.contains(Wt.relatedTarget))return Jt.call(this,Wt)})(Ue));const ct=F(ee),vt=ct[Qe]||(ct[Qe]={}),St=X(vt,Ue,Ce?V:null);if(St)return void(St.oneOff=St.oneOff&&ve);const yt=G(Ue,g.replace(A,"")),ts=Ce?function($t,Jt,Wt){return function Xt(Ms){const Gs=$t.querySelectorAll(Jt);for(let{target:ds}=Ms;ds&&ds!==this;ds=ds.parentNode)for(const Ts of Gs)if(Ts===ds)return b(Ms,{delegateTarget:ds}),Xt.oneOff&&k.off($t,Ms.type,Jt,Wt),Wt.apply(ds,[Ms])}}(ee,V,Ue):function($t,Jt){return function Wt(Xt){return b(Xt,{delegateTarget:$t}),Wt.oneOff&&k.off($t,Xt.type,Jt),Jt.apply($t,[Xt])}}(ee,Ue);ts.delegationSelector=Ce?V:null,ts.callable=Ue,ts.oneOff=ve,ts.uidEvent=yt,vt[yt]=ts,ee.addEventListener(Qe,ts,Ce)}function z(ee,g,V,le,ve){const Ce=X(g[V],le,ve);Ce&&(ee.removeEventListener(V,Ce,!!ve),delete g[V][Ce.uidEvent])}function O(ee,g,V,le){const ve=g[V]||{};for(const[Ce,Ue]of Object.entries(ve))Ce.includes(le)&&z(ee,g,V,Ue.callable,Ue.delegationSelector)}function E(ee){return ee=ee.replace(Q,""),H[ee]||ee}const k={on(ee,g,V,le){Y(ee,g,V,le,!1)},one(ee,g,V,le){Y(ee,g,V,le,!0)},off(ee,g,V,le){if(typeof g!="string"||!ee)return;const[ve,Ce,Ue]=ue(g,V,le),Qe=Ue!==g,ct=F(ee),vt=ct[Ue]||{},St=g.startsWith(".");if(Ce===void 0){if(St)for(const yt of Object.keys(ct))O(ee,ct,yt,g.slice(1));for(const[yt,ts]of Object.entries(vt)){const $t=yt.replace(q,"");Qe&&!g.includes($t)||z(ee,ct,Ue,ts.callable,ts.delegationSelector)}}else{if(!Object.keys(vt).length)return;z(ee,ct,Ue,Ce,ve?V:null)}},trigger(ee,g,V){if(typeof g!="string"||!ee)return null;const le=L();let ve=null,Ce=!0,Ue=!0,Qe=!1;g!==E(g)&&le&&(ve=le.Event(g,V),le(ee).trigger(ve),Ce=!ve.isPropagationStopped(),Ue=!ve.isImmediatePropagationStopped(),Qe=ve.isDefaultPrevented());const ct=b(new Event(g,{bubbles:Ce,cancelable:!0}),V);return Qe&&ct.preventDefault(),Ue&&ee.dispatchEvent(ct),ct.defaultPrevented&&ve&&ve.preventDefault(),ct}};function b(ee,g={}){for(const[V,le]of Object.entries(g))try{ee[V]=le}catch{Object.defineProperty(ee,V,{configurable:!0,get:()=>le})}return ee}function N(ee){if(ee==="true")return!0;if(ee==="false")return!1;if(ee===Number(ee).toString())return Number(ee);if(ee===""||ee==="null")return null;if(typeof ee!="string")return ee;try{return JSON.parse(decodeURIComponent(ee))}catch{return ee}}function I(ee){return ee.replace(/[A-Z]/g,g=>`-${g.toLowerCase()}`)}const P={setDataAttribute(ee,g,V){ee.setAttribute(`data-bs-${I(g)}`,V)},removeDataAttribute(ee,g){ee.removeAttribute(`data-bs-${I(g)}`)},getDataAttributes(ee){if(!ee)return{};const g={},V=Object.keys(ee.dataset).filter(le=>le.startsWith("bs")&&!le.startsWith("bsConfig"));for(const le of V){let ve=le.replace(/^bs/,"");ve=ve.charAt(0).toLowerCase()+ve.slice(1),g[ve]=N(ee.dataset[le])}return g},getDataAttribute:(ee,g)=>N(ee.getAttribute(`data-bs-${I(g)}`))};class _{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(g){return g=this._mergeConfigObj(g),g=this._configAfterMerge(g),this._typeCheckConfig(g),g}_configAfterMerge(g){return g}_mergeConfigObj(g,V){const le=l(V)?P.getDataAttribute(V,"config"):{};return{...this.constructor.Default,...typeof le=="object"?le:{},...l(V)?P.getDataAttributes(V):{},...typeof g=="object"?g:{}}}_typeCheckConfig(g,V=this.constructor.DefaultType){for(const[ve,Ce]of Object.entries(V)){const Ue=g[ve],Qe=l(Ue)?"element":(le=Ue)==null?`${le}`:Object.prototype.toString.call(le).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(Ce).test(Qe))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${ve}" provided type "${Qe}" but expected type "${Ce}".`)}var le}}class C extends _{constructor(g,V){super(),(g=c(g))&&(this._element=g,this._config=this._getConfig(V),r.set(this._element,this.constructor.DATA_KEY,this))}dispose(){r.remove(this._element,this.constructor.DATA_KEY),k.off(this._element,this.constructor.EVENT_KEY);for(const g of Object.getOwnPropertyNames(this))this[g]=null}_queueCallback(g,V,le=!0){x(g,V,le)}_getConfig(g){return g=this._mergeConfigObj(g,this._element),g=this._configAfterMerge(g),this._typeCheckConfig(g),g}static getInstance(g){return r.get(c(g),this.DATA_KEY)}static getOrCreateInstance(g,V={}){return this.getInstance(g)||new this(g,typeof V=="object"?V:null)}static get VERSION(){return"5.3.7"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(g){return`${g}${this.EVENT_KEY}`}}const U=ee=>{let g=ee.getAttribute("data-bs-target");if(!g||g==="#"){let V=ee.getAttribute("href");if(!V||!V.includes("#")&&!V.startsWith("."))return null;V.includes("#")&&!V.startsWith("#")&&(V=`#${V.split("#")[1]}`),g=V&&V!=="#"?V.trim():null}return g?g.split(",").map(V=>a(V)).join(","):null},w={find:(ee,g=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(g,ee)),findOne:(ee,g=document.documentElement)=>Element.prototype.querySelector.call(g,ee),children:(ee,g)=>[].concat(...ee.children).filter(V=>V.matches(g)),parents(ee,g){const V=[];let le=ee.parentNode.closest(g);for(;le;)V.push(le),le=le.parentNode.closest(g);return V},prev(ee,g){let V=ee.previousElementSibling;for(;V;){if(V.matches(g))return[V];V=V.previousElementSibling}return[]},next(ee,g){let V=ee.nextElementSibling;for(;V;){if(V.matches(g))return[V];V=V.nextElementSibling}return[]},focusableChildren(ee){const g=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(V=>`${V}:not([tabindex^="-"])`).join(",");return this.find(g,ee).filter(V=>!u(V)&&d(V))},getSelectorFromElement(ee){const g=U(ee);return g&&w.findOne(g)?g:null},getElementFromSelector(ee){const g=U(ee);return g?w.findOne(g):null},getMultipleElementsFromSelector(ee){const g=U(ee);return g?w.find(g):[]}},W=(ee,g="hide")=>{const V=`click.dismiss${ee.EVENT_KEY}`,le=ee.NAME;k.on(document,V,`[data-bs-dismiss="${le}"]`,function(ve){if(["A","AREA"].includes(this.tagName)&&ve.preventDefault(),u(this))return;const Ce=w.getElementFromSelector(this)||this.closest(`.${le}`);ee.getOrCreateInstance(Ce)[g]()})},ie=".bs.alert",de=`close${ie}`,ne=`closed${ie}`;class ye extends C{static get NAME(){return"alert"}close(){if(k.trigger(this._element,de).defaultPrevented)return;this._element.classList.remove("show");const g=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,g)}_destroyElement(){this._element.remove(),k.trigger(this._element,ne),this.dispose()}static jQueryInterface(g){return this.each(function(){const V=ye.getOrCreateInstance(this);if(typeof g=="string"){if(V[g]===void 0||g.startsWith("_")||g==="constructor")throw new TypeError(`No method named "${g}"`);V[g](this)}})}}W(ye,"close"),y(ye);const pe='[data-bs-toggle="button"]';class be extends C{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(g){return this.each(function(){const V=be.getOrCreateInstance(this);g==="toggle"&&V[g]()})}}k.on(document,"click.bs.button.data-api",pe,ee=>{ee.preventDefault();const g=ee.target.closest(pe);be.getOrCreateInstance(g).toggle()}),y(be);const xe=".bs.swipe",Ee=`touchstart${xe}`,Re=`touchmove${xe}`,fe=`touchend${xe}`,Ve=`pointerdown${xe}`,$e=`pointerup${xe}`,et={endCallback:null,leftCallback:null,rightCallback:null},ze={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class tt extends _{constructor(g,V){super(),this._element=g,g&&tt.isSupported()&&(this._config=this._getConfig(V),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return et}static get DefaultType(){return ze}static get NAME(){return"swipe"}dispose(){k.off(this._element,xe)}_start(g){this._supportPointerEvents?this._eventIsPointerPenTouch(g)&&(this._deltaX=g.clientX):this._deltaX=g.touches[0].clientX}_end(g){this._eventIsPointerPenTouch(g)&&(this._deltaX=g.clientX-this._deltaX),this._handleSwipe(),T(this._config.endCallback)}_move(g){this._deltaX=g.touches&&g.touches.length>1?0:g.touches[0].clientX-this._deltaX}_handleSwipe(){const g=Math.abs(this._deltaX);if(g<=40)return;const V=g/this._deltaX;this._deltaX=0,V&&T(V>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(k.on(this._element,Ve,g=>this._start(g)),k.on(this._element,$e,g=>this._end(g)),this._element.classList.add("pointer-event")):(k.on(this._element,Ee,g=>this._start(g)),k.on(this._element,Re,g=>this._move(g)),k.on(this._element,fe,g=>this._end(g)))}_eventIsPointerPenTouch(g){return this._supportPointerEvents&&(g.pointerType==="pen"||g.pointerType==="touch")}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const rt=".bs.carousel",bt=".data-api",At="ArrowLeft",ns="ArrowRight",Ht="next",is="prev",Oe="left",it="right",Kt=`slide${rt}`,zs=`slid${rt}`,xs=`keydown${rt}`,cs=`mouseenter${rt}`,Os=`mouseleave${rt}`,vs=`dragstart${rt}`,Z=`load${rt}${bt}`,v=`click${rt}${bt}`,se="carousel",re="active",J=".active",he=".carousel-item",Se=J+he,me={[At]:it,[ns]:Oe},ge={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},ke={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class Ie extends C{constructor(g,V){super(g,V),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=w.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===se&&this.cycle()}static get Default(){return ge}static get DefaultType(){return ke}static get NAME(){return"carousel"}next(){this._slide(Ht)}nextWhenVisible(){!document.hidden&&d(this._element)&&this.next()}prev(){this._slide(is)}pause(){this._isSliding&&o(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?k.one(this._element,zs,()=>this.cycle()):this.cycle())}to(g){const V=this._getItems();if(g>V.length-1||g<0)return;if(this._isSliding)return void k.one(this._element,zs,()=>this.to(g));const le=this._getItemIndex(this._getActive());if(le===g)return;const ve=g>le?Ht:is;this._slide(ve,V[g])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(g){return g.defaultInterval=g.interval,g}_addEventListeners(){this._config.keyboard&&k.on(this._element,xs,g=>this._keydown(g)),this._config.pause==="hover"&&(k.on(this._element,cs,()=>this.pause()),k.on(this._element,Os,()=>this._maybeEnableCycle())),this._config.touch&&tt.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const V of w.find(".carousel-item img",this._element))k.on(V,vs,le=>le.preventDefault());const g={leftCallback:()=>this._slide(this._directionToOrder(Oe)),rightCallback:()=>this._slide(this._directionToOrder(it)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}};this._swipeHelper=new tt(this._element,g)}_keydown(g){if(/input|textarea/i.test(g.target.tagName))return;const V=me[g.key];V&&(g.preventDefault(),this._slide(this._directionToOrder(V)))}_getItemIndex(g){return this._getItems().indexOf(g)}_setActiveIndicatorElement(g){if(!this._indicatorsElement)return;const V=w.findOne(J,this._indicatorsElement);V.classList.remove(re),V.removeAttribute("aria-current");const le=w.findOne(`[data-bs-slide-to="${g}"]`,this._indicatorsElement);le&&(le.classList.add(re),le.setAttribute("aria-current","true"))}_updateInterval(){const g=this._activeElement||this._getActive();if(!g)return;const V=Number.parseInt(g.getAttribute("data-bs-interval"),10);this._config.interval=V||this._config.defaultInterval}_slide(g,V=null){if(this._isSliding)return;const le=this._getActive(),ve=g===Ht,Ce=V||S(this._getItems(),le,ve,this._config.wrap);if(Ce===le)return;const Ue=this._getItemIndex(Ce),Qe=yt=>k.trigger(this._element,yt,{relatedTarget:Ce,direction:this._orderToDirection(g),from:this._getItemIndex(le),to:Ue});if(Qe(Kt).defaultPrevented||!le||!Ce)return;const ct=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(Ue),this._activeElement=Ce;const vt=ve?"carousel-item-start":"carousel-item-end",St=ve?"carousel-item-next":"carousel-item-prev";Ce.classList.add(St),j(Ce),le.classList.add(vt),Ce.classList.add(vt),this._queueCallback(()=>{Ce.classList.remove(vt,St),Ce.classList.add(re),le.classList.remove(re,St,vt),this._isSliding=!1,Qe(zs)},le,this._isAnimated()),ct&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return w.findOne(Se,this._element)}_getItems(){return w.find(he,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(g){return D()?g===Oe?is:Ht:g===Oe?Ht:is}_orderToDirection(g){return D()?g===is?Oe:it:g===is?it:Oe}static jQueryInterface(g){return this.each(function(){const V=Ie.getOrCreateInstance(this,g);if(typeof g!="number"){if(typeof g=="string"){if(V[g]===void 0||g.startsWith("_")||g==="constructor")throw new TypeError(`No method named "${g}"`);V[g]()}}else V.to(g)})}}k.on(document,v,"[data-bs-slide], [data-bs-slide-to]",function(ee){const g=w.getElementFromSelector(this);if(!g||!g.classList.contains(se))return;ee.preventDefault();const V=Ie.getOrCreateInstance(g),le=this.getAttribute("data-bs-slide-to");return le?(V.to(le),void V._maybeEnableCycle()):P.getDataAttribute(this,"slide")==="next"?(V.next(),void V._maybeEnableCycle()):(V.prev(),void V._maybeEnableCycle())}),k.on(window,Z,()=>{const ee=w.find('[data-bs-ride="carousel"]');for(const g of ee)Ie.getOrCreateInstance(g)}),y(Ie);const oe=".bs.collapse",Te=`show${oe}`,Ne=`shown${oe}`,we=`hide${oe}`,_e=`hidden${oe}`,Ge=`click${oe}.data-api`,mt="show",pt="collapse",Ye="collapsing",Yt=`:scope .${pt} .${pt}`,je='[data-bs-toggle="collapse"]',Fe={parent:null,toggle:!0},De={parent:"(null|element)",toggle:"boolean"};class Ze extends C{constructor(g,V){super(g,V),this._isTransitioning=!1,this._triggerArray=[];const le=w.find(je);for(const ve of le){const Ce=w.getSelectorFromElement(ve),Ue=w.find(Ce).filter(Qe=>Qe===this._element);Ce!==null&&Ue.length&&this._triggerArray.push(ve)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return Fe}static get DefaultType(){return De}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let g=[];if(this._config.parent&&(g=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(ve=>ve!==this._element).map(ve=>Ze.getOrCreateInstance(ve,{toggle:!1}))),g.length&&g[0]._isTransitioning||k.trigger(this._element,Te).defaultPrevented)return;for(const ve of g)ve.hide();const V=this._getDimension();this._element.classList.remove(pt),this._element.classList.add(Ye),this._element.style[V]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const le=`scroll${V[0].toUpperCase()+V.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(Ye),this._element.classList.add(pt,mt),this._element.style[V]="",k.trigger(this._element,Ne)},this._element,!0),this._element.style[V]=`${this._element[le]}px`}hide(){if(this._isTransitioning||!this._isShown()||k.trigger(this._element,we).defaultPrevented)return;const g=this._getDimension();this._element.style[g]=`${this._element.getBoundingClientRect()[g]}px`,j(this._element),this._element.classList.add(Ye),this._element.classList.remove(pt,mt);for(const V of this._triggerArray){const le=w.getElementFromSelector(V);le&&!this._isShown(le)&&this._addAriaAndCollapsedClass([V],!1)}this._isTransitioning=!0,this._element.style[g]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(Ye),this._element.classList.add(pt),k.trigger(this._element,_e)},this._element,!0)}_isShown(g=this._element){return g.classList.contains(mt)}_configAfterMerge(g){return g.toggle=!!g.toggle,g.parent=c(g.parent),g}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const g=this._getFirstLevelChildren(je);for(const V of g){const le=w.getElementFromSelector(V);le&&this._addAriaAndCollapsedClass([V],this._isShown(le))}}_getFirstLevelChildren(g){const V=w.find(Yt,this._config.parent);return w.find(g,this._config.parent).filter(le=>!V.includes(le))}_addAriaAndCollapsedClass(g,V){if(g.length)for(const le of g)le.classList.toggle("collapsed",!V),le.setAttribute("aria-expanded",V)}static jQueryInterface(g){const V={};return typeof g=="string"&&/show|hide/.test(g)&&(V.toggle=!1),this.each(function(){const le=Ze.getOrCreateInstance(this,V);if(typeof g=="string"){if(le[g]===void 0)throw new TypeError(`No method named "${g}"`);le[g]()}})}}k.on(document,Ge,je,function(ee){(ee.target.tagName==="A"||ee.delegateTarget&&ee.delegateTarget.tagName==="A")&&ee.preventDefault();for(const g of w.getMultipleElementsFromSelector(this))Ze.getOrCreateInstance(g,{toggle:!1}).toggle()}),y(Ze);var at="top",dt="bottom",ot="right",Je="left",ft="auto",Dt=[at,dt,ot,Je],gt="start",us="end",jt="clippingParents",Gt="viewport",pn="popper",Jn="reference",qo=Dt.reduce(function(ee,g){return ee.concat([g+"-"+gt,g+"-"+us])},[]),_d=[].concat(Dt,[ft]).reduce(function(ee,g){return ee.concat([g,g+"-"+gt,g+"-"+us])},[]),Rd="beforeRead",Dd="read",Pd="afterRead",ac="beforeMain",oc="main",kd="afterMain",Ld="beforeWrite",Bh="write",Gh="afterWrite",Fd=[Rd,Dd,Pd,ac,oc,kd,Ld,Bh,Gh];function Or(ee){return ee?(ee.nodeName||"").toLowerCase():null}function ur(ee){if(ee==null)return window;if(ee.toString()!=="[object Window]"){var g=ee.ownerDocument;return g&&g.defaultView||window}return ee}function hr(ee){return ee instanceof ur(ee).Element||ee instanceof Element}function ln(ee){return ee instanceof ur(ee).HTMLElement||ee instanceof HTMLElement}function La(ee){return typeof ShadowRoot<"u"&&(ee instanceof ur(ee).ShadowRoot||ee instanceof ShadowRoot)}const Fa={name:"applyStyles",enabled:!0,phase:"write",fn:function(ee){var g=ee.state;Object.keys(g.elements).forEach(function(V){var le=g.styles[V]||{},ve=g.attributes[V]||{},Ce=g.elements[V];ln(Ce)&&Or(Ce)&&(Object.assign(Ce.style,le),Object.keys(ve).forEach(function(Ue){var Qe=ve[Ue];Qe===!1?Ce.removeAttribute(Ue):Ce.setAttribute(Ue,Qe===!0?"":Qe)}))})},effect:function(ee){var g=ee.state,V={popper:{position:g.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(g.elements.popper.style,V.popper),g.styles=V,g.elements.arrow&&Object.assign(g.elements.arrow.style,V.arrow),function(){Object.keys(g.elements).forEach(function(le){var ve=g.elements[le],Ce=g.attributes[le]||{},Ue=Object.keys(g.styles.hasOwnProperty(le)?g.styles[le]:V[le]).reduce(function(Qe,ct){return Qe[ct]="",Qe},{});ln(ve)&&Or(ve)&&(Object.assign(ve.style,Ue),Object.keys(Ce).forEach(function(Qe){ve.removeAttribute(Qe)}))})}},requires:["computeStyles"]};function Mr(ee){return ee.split("-")[0]}var Cs=Math.max,aa=Math.min,Zr=Math.round;function oa(){var ee=navigator.userAgentData;return ee!=null&&ee.brands&&Array.isArray(ee.brands)?ee.brands.map(function(g){return g.brand+"/"+g.version}).join(" "):navigator.userAgent}function Wh(){return!/^((?!chrome|android).)*safari/i.test(oa())}function la(ee,g,V){g===void 0&&(g=!1),V===void 0&&(V=!1);var le=ee.getBoundingClientRect(),ve=1,Ce=1;g&&ln(ee)&&(ve=ee.offsetWidth>0&&Zr(le.width)/ee.offsetWidth||1,Ce=ee.offsetHeight>0&&Zr(le.height)/ee.offsetHeight||1);var Ue=(hr(ee)?ur(ee):window).visualViewport,Qe=!Wh()&&V,ct=(le.left+(Qe&&Ue?Ue.offsetLeft:0))/ve,vt=(le.top+(Qe&&Ue?Ue.offsetTop:0))/Ce,St=le.width/ve,yt=le.height/Ce;return{width:St,height:yt,top:vt,right:ct+St,bottom:vt+yt,left:ct,x:ct,y:vt}}function Od(ee){var g=la(ee),V=ee.offsetWidth,le=ee.offsetHeight;return Math.abs(g.width-V)<=1&&(V=g.width),Math.abs(g.height-le)<=1&&(le=g.height),{x:ee.offsetLeft,y:ee.offsetTop,width:V,height:le}}function qh(ee,g){var V=g.getRootNode&&g.getRootNode();if(ee.contains(g))return!0;if(V&&La(V)){var le=g;do{if(le&&ee.isSameNode(le))return!0;le=le.parentNode||le.host}while(le)}return!1}function gi(ee){return ur(ee).getComputedStyle(ee)}function Jf(ee){return["table","td","th"].indexOf(Or(ee))>=0}function Sr(ee){return((hr(ee)?ee.ownerDocument:ee.document)||window.document).documentElement}function Ur(ee){return Or(ee)==="html"?ee:ee.assignedSlot||ee.parentNode||(La(ee)?ee.host:null)||Sr(ee)}function Md(ee){return ln(ee)&&gi(ee).position!=="fixed"?ee.offsetParent:null}function Oa(ee){for(var g=ur(ee),V=Md(ee);V&&Jf(V)&&gi(V).position==="static";)V=Md(V);return V&&(Or(V)==="html"||Or(V)==="body"&&gi(V).position==="static")?g:V||function(le){var ve=/firefox/i.test(oa());if(/Trident/i.test(oa())&&ln(le)&&gi(le).position==="fixed")return null;var Ce=Ur(le);for(La(Ce)&&(Ce=Ce.host);ln(Ce)&&["html","body"].indexOf(Or(Ce))<0;){var Ue=gi(Ce);if(Ue.transform!=="none"||Ue.perspective!=="none"||Ue.contain==="paint"||["transform","perspective"].indexOf(Ue.willChange)!==-1||ve&&Ue.willChange==="filter"||ve&&Ue.filter&&Ue.filter!=="none")return Ce;Ce=Ce.parentNode}return null}(ee)||g}function lc(ee){return["top","bottom"].indexOf(ee)>=0?"x":"y"}function ei(ee,g,V){return Cs(ee,aa(g,V))}function Hh(ee){return Object.assign({},{top:0,right:0,bottom:0,left:0},ee)}function Qh(ee,g){return g.reduce(function(V,le){return V[le]=ee,V},{})}const Kh={name:"arrow",enabled:!0,phase:"main",fn:function(ee){var g,V=ee.state,le=ee.name,ve=ee.options,Ce=V.elements.arrow,Ue=V.modifiersData.popperOffsets,Qe=Mr(V.placement),ct=lc(Qe),vt=[Je,ot].indexOf(Qe)>=0?"height":"width";if(Ce&&Ue){var St=function(Us,Ds){return Hh(typeof(Us=typeof Us=="function"?Us(Object.assign({},Ds.rects,{placement:Ds.placement})):Us)!="number"?Us:Qh(Us,Dt))}(ve.padding,V),yt=Od(Ce),ts=ct==="y"?at:Je,$t=ct==="y"?dt:ot,Jt=V.rects.reference[vt]+V.rects.reference[ct]-Ue[ct]-V.rects.popper[vt],Wt=Ue[ct]-V.rects.reference[ct],Xt=Oa(Ce),Ms=Xt?ct==="y"?Xt.clientHeight||0:Xt.clientWidth||0:0,Gs=Jt/2-Wt/2,ds=St[ts],Ts=Ms-yt[vt]-St[$t],rs=Ms/2-yt[vt]/2+Gs,ys=ei(ds,rs,Ts),Rs=ct;V.modifiersData[le]=((g={})[Rs]=ys,g.centerOffset=ys-rs,g)}},effect:function(ee){var g=ee.state,V=ee.options.element,le=V===void 0?"[data-popper-arrow]":V;le!=null&&(typeof le!="string"||(le=g.elements.popper.querySelector(le)))&&qh(g.elements.popper,le)&&(g.elements.arrow=le)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function mr(ee){return ee.split("-")[1]}var Xf={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Yh(ee){var g,V=ee.popper,le=ee.popperRect,ve=ee.placement,Ce=ee.variation,Ue=ee.offsets,Qe=ee.position,ct=ee.gpuAcceleration,vt=ee.adaptive,St=ee.roundOffsets,yt=ee.isFixed,ts=Ue.x,$t=ts===void 0?0:ts,Jt=Ue.y,Wt=Jt===void 0?0:Jt,Xt=typeof St=="function"?St({x:$t,y:Wt}):{x:$t,y:Wt};$t=Xt.x,Wt=Xt.y;var Ms=Ue.hasOwnProperty("x"),Gs=Ue.hasOwnProperty("y"),ds=Je,Ts=at,rs=window;if(vt){var ys=Oa(V),Rs="clientHeight",Us="clientWidth";ys===ur(V)&&gi(ys=Sr(V)).position!=="static"&&Qe==="absolute"&&(Rs="scrollHeight",Us="scrollWidth"),(ve===at||(ve===Je||ve===ot)&&Ce===us)&&(Ts=dt,Wt-=(yt&&ys===rs&&rs.visualViewport?rs.visualViewport.height:ys[Rs])-le.height,Wt*=ct?1:-1),ve!==Je&&(ve!==at&&ve!==dt||Ce!==us)||(ds=ot,$t-=(yt&&ys===rs&&rs.visualViewport?rs.visualViewport.width:ys[Us])-le.width,$t*=ct?1:-1)}var Ds,fn=Object.assign({position:Qe},vt&&Xf),$r=St===!0?function(yi,fr){var si=yi.x,ni=yi.y,cn=fr.devicePixelRatio||1;return{x:Zr(si*cn)/cn||0,y:Zr(ni*cn)/cn||0}}({x:$t,y:Wt},ur(V)):{x:$t,y:Wt};return $t=$r.x,Wt=$r.y,ct?Object.assign({},fn,((Ds={})[Ts]=Gs?"0":"",Ds[ds]=Ms?"0":"",Ds.transform=(rs.devicePixelRatio||1)<=1?"translate("+$t+"px, "+Wt+"px)":"translate3d("+$t+"px, "+Wt+"px, 0)",Ds)):Object.assign({},fn,((g={})[Ts]=Gs?Wt+"px":"",g[ds]=Ms?$t+"px":"",g.transform="",g))}const Ma={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(ee){var g=ee.state,V=ee.options,le=V.gpuAcceleration,ve=le===void 0||le,Ce=V.adaptive,Ue=Ce===void 0||Ce,Qe=V.roundOffsets,ct=Qe===void 0||Qe,vt={placement:Mr(g.placement),variation:mr(g.placement),popper:g.elements.popper,popperRect:g.rects.popper,gpuAcceleration:ve,isFixed:g.options.strategy==="fixed"};g.modifiersData.popperOffsets!=null&&(g.styles.popper=Object.assign({},g.styles.popper,Yh(Object.assign({},vt,{offsets:g.modifiersData.popperOffsets,position:g.options.strategy,adaptive:Ue,roundOffsets:ct})))),g.modifiersData.arrow!=null&&(g.styles.arrow=Object.assign({},g.styles.arrow,Yh(Object.assign({},vt,{offsets:g.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:ct})))),g.attributes.popper=Object.assign({},g.attributes.popper,{"data-popper-placement":g.placement})},data:{}};var ca={passive:!0};const cc={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(ee){var g=ee.state,V=ee.instance,le=ee.options,ve=le.scroll,Ce=ve===void 0||ve,Ue=le.resize,Qe=Ue===void 0||Ue,ct=ur(g.elements.popper),vt=[].concat(g.scrollParents.reference,g.scrollParents.popper);return Ce&&vt.forEach(function(St){St.addEventListener("scroll",V.update,ca)}),Qe&&ct.addEventListener("resize",V.update,ca),function(){Ce&&vt.forEach(function(St){St.removeEventListener("scroll",V.update,ca)}),Qe&&ct.removeEventListener("resize",V.update,ca)}},data:{}};var Ho={left:"right",right:"left",bottom:"top",top:"bottom"};function Fi(ee){return ee.replace(/left|right|bottom|top/g,function(g){return Ho[g]})}var Jh={start:"end",end:"start"};function dc(ee){return ee.replace(/start|end/g,function(g){return Jh[g]})}function Bs(ee){var g=ur(ee);return{scrollLeft:g.pageXOffset,scrollTop:g.pageYOffset}}function Ud(ee){return la(Sr(ee)).left+Bs(ee).scrollLeft}function $d(ee){var g=gi(ee),V=g.overflow,le=g.overflowX,ve=g.overflowY;return/auto|scroll|overlay|hidden/.test(V+ve+le)}function zd(ee){return["html","body","#document"].indexOf(Or(ee))>=0?ee.ownerDocument.body:ln(ee)&&$d(ee)?ee:zd(Ur(ee))}function Ua(ee,g){var V;g===void 0&&(g=[]);var le=zd(ee),ve=le===((V=ee.ownerDocument)==null?void 0:V.body),Ce=ur(le),Ue=ve?[Ce].concat(Ce.visualViewport||[],$d(le)?le:[]):le,Qe=g.concat(Ue);return ve?Qe:Qe.concat(Ua(Ur(Ue)))}function uc(ee){return Object.assign({},ee,{left:ee.x,top:ee.y,right:ee.x+ee.width,bottom:ee.y+ee.height})}function Qo(ee,g,V){return g===Gt?uc(function(le,ve){var Ce=ur(le),Ue=Sr(le),Qe=Ce.visualViewport,ct=Ue.clientWidth,vt=Ue.clientHeight,St=0,yt=0;if(Qe){ct=Qe.width,vt=Qe.height;var ts=Wh();(ts||!ts&&ve==="fixed")&&(St=Qe.offsetLeft,yt=Qe.offsetTop)}return{width:ct,height:vt,x:St+Ud(le),y:yt}}(ee,V)):hr(g)?function(le,ve){var Ce=la(le,!1,ve==="fixed");return Ce.top=Ce.top+le.clientTop,Ce.left=Ce.left+le.clientLeft,Ce.bottom=Ce.top+le.clientHeight,Ce.right=Ce.left+le.clientWidth,Ce.width=le.clientWidth,Ce.height=le.clientHeight,Ce.x=Ce.left,Ce.y=Ce.top,Ce}(g,V):uc(function(le){var ve,Ce=Sr(le),Ue=Bs(le),Qe=(ve=le.ownerDocument)==null?void 0:ve.body,ct=Cs(Ce.scrollWidth,Ce.clientWidth,Qe?Qe.scrollWidth:0,Qe?Qe.clientWidth:0),vt=Cs(Ce.scrollHeight,Ce.clientHeight,Qe?Qe.scrollHeight:0,Qe?Qe.clientHeight:0),St=-Ue.scrollLeft+Ud(le),yt=-Ue.scrollTop;return gi(Qe||Ce).direction==="rtl"&&(St+=Cs(Ce.clientWidth,Qe?Qe.clientWidth:0)-ct),{width:ct,height:vt,x:St,y:yt}}(Sr(ee)))}function Vd(ee){var g,V=ee.reference,le=ee.element,ve=ee.placement,Ce=ve?Mr(ve):null,Ue=ve?mr(ve):null,Qe=V.x+V.width/2-le.width/2,ct=V.y+V.height/2-le.height/2;switch(Ce){case at:g={x:Qe,y:V.y-le.height};break;case dt:g={x:Qe,y:V.y+V.height};break;case ot:g={x:V.x+V.width,y:ct};break;case Je:g={x:V.x-le.width,y:ct};break;default:g={x:V.x,y:V.y}}var vt=Ce?lc(Ce):null;if(vt!=null){var St=vt==="y"?"height":"width";switch(Ue){case gt:g[vt]=g[vt]-(V[St]/2-le[St]/2);break;case us:g[vt]=g[vt]+(V[St]/2-le[St]/2)}}return g}function Xn(ee,g){g===void 0&&(g={});var V=g,le=V.placement,ve=le===void 0?ee.placement:le,Ce=V.strategy,Ue=Ce===void 0?ee.strategy:Ce,Qe=V.boundary,ct=Qe===void 0?jt:Qe,vt=V.rootBoundary,St=vt===void 0?Gt:vt,yt=V.elementContext,ts=yt===void 0?pn:yt,$t=V.altBoundary,Jt=$t!==void 0&&$t,Wt=V.padding,Xt=Wt===void 0?0:Wt,Ms=Hh(typeof Xt!="number"?Xt:Qh(Xt,Dt)),Gs=ts===pn?Jn:pn,ds=ee.rects.popper,Ts=ee.elements[Jt?Gs:ts],rs=function(fr,si,ni,cn){var Mi=si==="clippingParents"?function(Vs){var gr=Ua(Ur(Vs)),ri=["absolute","fixed"].indexOf(gi(Vs).position)>=0&&ln(Vs)?Oa(Vs):Vs;return hr(ri)?gr.filter(function(Ga){return hr(Ga)&&qh(Ga,ri)&&Or(Ga)!=="body"}):[]}(fr):[].concat(si),Ui=[].concat(Mi,[ni]),yc=Ui[0],Fn=Ui.reduce(function(Vs,gr){var ri=Qo(fr,gr,cn);return Vs.top=Cs(ri.top,Vs.top),Vs.right=aa(ri.right,Vs.right),Vs.bottom=aa(ri.bottom,Vs.bottom),Vs.left=Cs(ri.left,Vs.left),Vs},Qo(fr,yc,cn));return Fn.width=Fn.right-Fn.left,Fn.height=Fn.bottom-Fn.top,Fn.x=Fn.left,Fn.y=Fn.top,Fn}(hr(Ts)?Ts:Ts.contextElement||Sr(ee.elements.popper),ct,St,Ue),ys=la(ee.elements.reference),Rs=Vd({reference:ys,element:ds,placement:ve}),Us=uc(Object.assign({},ds,Rs)),Ds=ts===pn?Us:ys,fn={top:rs.top-Ds.top+Ms.top,bottom:Ds.bottom-rs.bottom+Ms.bottom,left:rs.left-Ds.left+Ms.left,right:Ds.right-rs.right+Ms.right},$r=ee.modifiersData.offset;if(ts===pn&&$r){var yi=$r[ve];Object.keys(fn).forEach(function(fr){var si=[ot,dt].indexOf(fr)>=0?1:-1,ni=[at,dt].indexOf(fr)>=0?"y":"x";fn[fr]+=yi[ni]*si})}return fn}function Xh(ee,g){g===void 0&&(g={});var V=g,le=V.placement,ve=V.boundary,Ce=V.rootBoundary,Ue=V.padding,Qe=V.flipVariations,ct=V.allowedAutoPlacements,vt=ct===void 0?_d:ct,St=mr(le),yt=St?Qe?qo:qo.filter(function(Jt){return mr(Jt)===St}):Dt,ts=yt.filter(function(Jt){return vt.indexOf(Jt)>=0});ts.length===0&&(ts=yt);var $t=ts.reduce(function(Jt,Wt){return Jt[Wt]=Xn(ee,{placement:Wt,boundary:ve,rootBoundary:Ce,padding:Ue})[Mr(Wt)],Jt},{});return Object.keys($t).sort(function(Jt,Wt){return $t[Jt]-$t[Wt]})}const Zh={name:"flip",enabled:!0,phase:"main",fn:function(ee){var g=ee.state,V=ee.options,le=ee.name;if(!g.modifiersData[le]._skip){for(var ve=V.mainAxis,Ce=ve===void 0||ve,Ue=V.altAxis,Qe=Ue===void 0||Ue,ct=V.fallbackPlacements,vt=V.padding,St=V.boundary,yt=V.rootBoundary,ts=V.altBoundary,$t=V.flipVariations,Jt=$t===void 0||$t,Wt=V.allowedAutoPlacements,Xt=g.options.placement,Ms=Mr(Xt),Gs=ct||(Ms!==Xt&&Jt?function(Vs){if(Mr(Vs)===ft)return[];var gr=Fi(Vs);return[dc(Vs),gr,dc(gr)]}(Xt):[Fi(Xt)]),ds=[Xt].concat(Gs).reduce(function(Vs,gr){return Vs.concat(Mr(gr)===ft?Xh(g,{placement:gr,boundary:St,rootBoundary:yt,padding:vt,flipVariations:Jt,allowedAutoPlacements:Wt}):gr)},[]),Ts=g.rects.reference,rs=g.rects.popper,ys=new Map,Rs=!0,Us=ds[0],Ds=0;Ds<ds.length;Ds++){var fn=ds[Ds],$r=Mr(fn),yi=mr(fn)===gt,fr=[at,dt].indexOf($r)>=0,si=fr?"width":"height",ni=Xn(g,{placement:fn,boundary:St,rootBoundary:yt,altBoundary:ts,padding:vt}),cn=fr?yi?ot:Je:yi?dt:at;Ts[si]>rs[si]&&(cn=Fi(cn));var Mi=Fi(cn),Ui=[];if(Ce&&Ui.push(ni[$r]<=0),Qe&&Ui.push(ni[cn]<=0,ni[Mi]<=0),Ui.every(function(Vs){return Vs})){Us=fn,Rs=!1;break}ys.set(fn,Ui)}if(Rs)for(var yc=function(Vs){var gr=ds.find(function(ri){var Ga=ys.get(ri);if(Ga)return Ga.slice(0,Vs).every(function(dm){return dm})});if(gr)return Us=gr,"break"},Fn=Jt?3:1;Fn>0&&yc(Fn)!=="break";Fn--);g.placement!==Us&&(g.modifiersData[le]._skip=!0,g.placement=Us,g.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function $a(ee,g,V){return V===void 0&&(V={x:0,y:0}),{top:ee.top-g.height-V.y,right:ee.right-g.width+V.x,bottom:ee.bottom-g.height+V.y,left:ee.left-g.width-V.x}}function Bd(ee){return[at,ot,dt,Je].some(function(g){return ee[g]>=0})}const hc={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(ee){var g=ee.state,V=ee.name,le=g.rects.reference,ve=g.rects.popper,Ce=g.modifiersData.preventOverflow,Ue=Xn(g,{elementContext:"reference"}),Qe=Xn(g,{altBoundary:!0}),ct=$a(Ue,le),vt=$a(Qe,ve,Ce),St=Bd(ct),yt=Bd(vt);g.modifiersData[V]={referenceClippingOffsets:ct,popperEscapeOffsets:vt,isReferenceHidden:St,hasPopperEscaped:yt},g.attributes.popper=Object.assign({},g.attributes.popper,{"data-popper-reference-hidden":St,"data-popper-escaped":yt})}},Ko={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(ee){var g=ee.state,V=ee.options,le=ee.name,ve=V.offset,Ce=ve===void 0?[0,0]:ve,Ue=_d.reduce(function(St,yt){return St[yt]=function(ts,$t,Jt){var Wt=Mr(ts),Xt=[Je,at].indexOf(Wt)>=0?-1:1,Ms=typeof Jt=="function"?Jt(Object.assign({},$t,{placement:ts})):Jt,Gs=Ms[0],ds=Ms[1];return Gs=Gs||0,ds=(ds||0)*Xt,[Je,ot].indexOf(Wt)>=0?{x:ds,y:Gs}:{x:Gs,y:ds}}(yt,g.rects,Ce),St},{}),Qe=Ue[g.placement],ct=Qe.x,vt=Qe.y;g.modifiersData.popperOffsets!=null&&(g.modifiersData.popperOffsets.x+=ct,g.modifiersData.popperOffsets.y+=vt),g.modifiersData[le]=Ue}},mc={name:"popperOffsets",enabled:!0,phase:"read",fn:function(ee){var g=ee.state,V=ee.name;g.modifiersData[V]=Vd({reference:g.rects.reference,element:g.rects.popper,placement:g.placement})},data:{}},Yo={name:"preventOverflow",enabled:!0,phase:"main",fn:function(ee){var g=ee.state,V=ee.options,le=ee.name,ve=V.mainAxis,Ce=ve===void 0||ve,Ue=V.altAxis,Qe=Ue!==void 0&&Ue,ct=V.boundary,vt=V.rootBoundary,St=V.altBoundary,yt=V.padding,ts=V.tether,$t=ts===void 0||ts,Jt=V.tetherOffset,Wt=Jt===void 0?0:Jt,Xt=Xn(g,{boundary:ct,rootBoundary:vt,padding:yt,altBoundary:St}),Ms=Mr(g.placement),Gs=mr(g.placement),ds=!Gs,Ts=lc(Ms),rs=Ts==="x"?"y":"x",ys=g.modifiersData.popperOffsets,Rs=g.rects.reference,Us=g.rects.popper,Ds=typeof Wt=="function"?Wt(Object.assign({},g.rects,{placement:g.placement})):Wt,fn=typeof Ds=="number"?{mainAxis:Ds,altAxis:Ds}:Object.assign({mainAxis:0,altAxis:0},Ds),$r=g.modifiersData.offset?g.modifiersData.offset[g.placement]:null,yi={x:0,y:0};if(ys){if(Ce){var fr,si=Ts==="y"?at:Je,ni=Ts==="y"?dt:ot,cn=Ts==="y"?"height":"width",Mi=ys[Ts],Ui=Mi+Xt[si],yc=Mi-Xt[ni],Fn=$t?-Us[cn]/2:0,Vs=Gs===gt?Rs[cn]:Us[cn],gr=Gs===gt?-Us[cn]:-Rs[cn],ri=g.elements.arrow,Ga=$t&&ri?Od(ri):{width:0,height:0},dm=g.modifiersData["arrow#persistent"]?g.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},yw=dm[si],bw=dm[ni],um=ei(0,Rs[cn],Ga[cn]),h_=ds?Rs[cn]/2-Fn-um-yw-fn.mainAxis:Vs-um-yw-fn.mainAxis,m_=ds?-Rs[cn]/2+Fn+um+bw+fn.mainAxis:gr+um+bw+fn.mainAxis,ug=g.elements.arrow&&Oa(g.elements.arrow),p_=ug?Ts==="y"?ug.clientTop||0:ug.clientLeft||0:0,ww=(fr=$r==null?void 0:$r[Ts])!=null?fr:0,f_=Mi+m_-ww,vw=ei($t?aa(Ui,Mi+h_-ww-p_):Ui,Mi,$t?Cs(yc,f_):yc);ys[Ts]=vw,yi[Ts]=vw-Mi}if(Qe){var Nw,g_=Ts==="x"?at:Je,x_=Ts==="x"?dt:ot,il=ys[rs],hm=rs==="y"?"height":"width",jw=il+Xt[g_],Sw=il-Xt[x_],hg=[at,Je].indexOf(Ms)!==-1,Ew=(Nw=$r==null?void 0:$r[rs])!=null?Nw:0,Cw=hg?jw:il-Rs[hm]-Us[hm]-Ew+fn.altAxis,Iw=hg?il+Rs[hm]+Us[hm]-Ew-fn.altAxis:Sw,Tw=$t&&hg?function(y_,b_,mg){var Aw=ei(y_,b_,mg);return Aw>mg?mg:Aw}(Cw,il,Iw):ei($t?Cw:jw,il,$t?Iw:Sw);ys[rs]=Tw,yi[rs]=Tw-il}g.modifiersData[le]=yi}},requiresIfExists:["offset"]};function Zf(ee,g,V){V===void 0&&(V=!1);var le,ve,Ce=ln(g),Ue=ln(g)&&function(yt){var ts=yt.getBoundingClientRect(),$t=Zr(ts.width)/yt.offsetWidth||1,Jt=Zr(ts.height)/yt.offsetHeight||1;return $t!==1||Jt!==1}(g),Qe=Sr(g),ct=la(ee,Ue,V),vt={scrollLeft:0,scrollTop:0},St={x:0,y:0};return(Ce||!Ce&&!V)&&((Or(g)!=="body"||$d(Qe))&&(vt=(le=g)!==ur(le)&&ln(le)?{scrollLeft:(ve=le).scrollLeft,scrollTop:ve.scrollTop}:Bs(le)),ln(g)?((St=la(g,!0)).x+=g.clientLeft,St.y+=g.clientTop):Qe&&(St.x=Ud(Qe))),{x:ct.left+vt.scrollLeft-St.x,y:ct.top+vt.scrollTop-St.y,width:ct.width,height:ct.height}}function em(ee){var g=new Map,V=new Set,le=[];function ve(Ce){V.add(Ce.name),[].concat(Ce.requires||[],Ce.requiresIfExists||[]).forEach(function(Ue){if(!V.has(Ue)){var Qe=g.get(Ue);Qe&&ve(Qe)}}),le.push(Ce)}return ee.forEach(function(Ce){g.set(Ce.name,Ce)}),ee.forEach(function(Ce){V.has(Ce.name)||ve(Ce)}),le}var za={placement:"bottom",modifiers:[],strategy:"absolute"};function Gd(){for(var ee=arguments.length,g=new Array(ee),V=0;V<ee;V++)g[V]=arguments[V];return!g.some(function(le){return!(le&&typeof le.getBoundingClientRect=="function")})}function Jo(ee){ee===void 0&&(ee={});var g=ee,V=g.defaultModifiers,le=V===void 0?[]:V,ve=g.defaultOptions,Ce=ve===void 0?za:ve;return function(Ue,Qe,ct){ct===void 0&&(ct=Ce);var vt,St,yt={placement:"bottom",orderedModifiers:[],options:Object.assign({},za,Ce),modifiersData:{},elements:{reference:Ue,popper:Qe},attributes:{},styles:{}},ts=[],$t=!1,Jt={state:yt,setOptions:function(Xt){var Ms=typeof Xt=="function"?Xt(yt.options):Xt;Wt(),yt.options=Object.assign({},Ce,yt.options,Ms),yt.scrollParents={reference:hr(Ue)?Ua(Ue):Ue.contextElement?Ua(Ue.contextElement):[],popper:Ua(Qe)};var Gs,ds,Ts=function(rs){var ys=em(rs);return Fd.reduce(function(Rs,Us){return Rs.concat(ys.filter(function(Ds){return Ds.phase===Us}))},[])}((Gs=[].concat(le,yt.options.modifiers),ds=Gs.reduce(function(rs,ys){var Rs=rs[ys.name];return rs[ys.name]=Rs?Object.assign({},Rs,ys,{options:Object.assign({},Rs.options,ys.options),data:Object.assign({},Rs.data,ys.data)}):ys,rs},{}),Object.keys(ds).map(function(rs){return ds[rs]})));return yt.orderedModifiers=Ts.filter(function(rs){return rs.enabled}),yt.orderedModifiers.forEach(function(rs){var ys=rs.name,Rs=rs.options,Us=Rs===void 0?{}:Rs,Ds=rs.effect;if(typeof Ds=="function"){var fn=Ds({state:yt,name:ys,instance:Jt,options:Us});ts.push(fn||function(){})}}),Jt.update()},forceUpdate:function(){if(!$t){var Xt=yt.elements,Ms=Xt.reference,Gs=Xt.popper;if(Gd(Ms,Gs)){yt.rects={reference:Zf(Ms,Oa(Gs),yt.options.strategy==="fixed"),popper:Od(Gs)},yt.reset=!1,yt.placement=yt.options.placement,yt.orderedModifiers.forEach(function(Ds){return yt.modifiersData[Ds.name]=Object.assign({},Ds.data)});for(var ds=0;ds<yt.orderedModifiers.length;ds++)if(yt.reset!==!0){var Ts=yt.orderedModifiers[ds],rs=Ts.fn,ys=Ts.options,Rs=ys===void 0?{}:ys,Us=Ts.name;typeof rs=="function"&&(yt=rs({state:yt,options:Rs,name:Us,instance:Jt})||yt)}else yt.reset=!1,ds=-1}}},update:(vt=function(){return new Promise(function(Xt){Jt.forceUpdate(),Xt(yt)})},function(){return St||(St=new Promise(function(Xt){Promise.resolve().then(function(){St=void 0,Xt(vt())})})),St}),destroy:function(){Wt(),$t=!0}};if(!Gd(Ue,Qe))return Jt;function Wt(){ts.forEach(function(Xt){return Xt()}),ts=[]}return Jt.setOptions(ct).then(function(Xt){!$t&&ct.onFirstUpdate&&ct.onFirstUpdate(Xt)}),Jt}}var Wd=Jo(),qd=Jo({defaultModifiers:[cc,mc,Ma,Fa]}),pc=Jo({defaultModifiers:[cc,mc,Ma,Fa,Ko,Zh,Yo,Kh,hc]});const Xo=Object.freeze(Object.defineProperty({__proto__:null,afterMain:kd,afterRead:Pd,afterWrite:Gh,applyStyles:Fa,arrow:Kh,auto:ft,basePlacements:Dt,beforeMain:ac,beforeRead:Rd,beforeWrite:Ld,bottom:dt,clippingParents:jt,computeStyles:Ma,createPopper:pc,createPopperBase:Wd,createPopperLite:qd,detectOverflow:Xn,end:us,eventListeners:cc,flip:Zh,hide:hc,left:Je,main:oc,modifierPhases:Fd,offset:Ko,placements:_d,popper:pn,popperGenerator:Jo,popperOffsets:mc,preventOverflow:Yo,read:Dd,reference:Jn,right:ot,start:gt,top:at,variationPlacements:qo,viewport:Gt,write:Bh},Symbol.toStringTag,{value:"Module"})),Hd="dropdown",Oi=".bs.dropdown",xi=".data-api",tm="ArrowUp",Qd="ArrowDown",sm=`hide${Oi}`,nm=`hidden${Oi}`,fc=`show${Oi}`,pr=`shown${Oi}`,Kd=`click${Oi}${xi}`,Yd=`keydown${Oi}${xi}`,Va=`keyup${Oi}${xi}`,m="show",M='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',K=`${M}.${m}`,ce=".dropdown-menu",Ae=D()?"top-end":"top-start",Me=D()?"top-start":"top-end",lt=D()?"bottom-end":"bottom-start",_s=D()?"bottom-start":"bottom-end",En=D()?"left-start":"right-start",Ns=D()?"right-start":"left-start",Pn={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},kn={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class Ln extends C{constructor(g,V){super(g,V),this._popper=null,this._parent=this._element.parentNode,this._menu=w.next(this._element,ce)[0]||w.prev(this._element,ce)[0]||w.findOne(ce,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return Pn}static get DefaultType(){return kn}static get NAME(){return Hd}toggle(){return this._isShown()?this.hide():this.show()}show(){if(u(this._element)||this._isShown())return;const g={relatedTarget:this._element};if(!k.trigger(this._element,fc,g).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const V of[].concat(...document.body.children))k.on(V,"mouseover",p);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(m),this._element.classList.add(m),k.trigger(this._element,pr,g)}}hide(){if(u(this._element)||!this._isShown())return;const g={relatedTarget:this._element};this._completeHide(g)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(g){if(!k.trigger(this._element,sm,g).defaultPrevented){if("ontouchstart"in document.documentElement)for(const V of[].concat(...document.body.children))k.off(V,"mouseover",p);this._popper&&this._popper.destroy(),this._menu.classList.remove(m),this._element.classList.remove(m),this._element.setAttribute("aria-expanded","false"),P.removeDataAttribute(this._menu,"popper"),k.trigger(this._element,nm,g),this._element.focus()}}_getConfig(g){if(typeof(g=super._getConfig(g)).reference=="object"&&!l(g.reference)&&typeof g.reference.getBoundingClientRect!="function")throw new TypeError(`${Hd.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return g}_createPopper(){if(Xo===void 0)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org/docs/v2/)");let g=this._element;this._config.reference==="parent"?g=this._parent:l(this._config.reference)?g=c(this._config.reference):typeof this._config.reference=="object"&&(g=this._config.reference);const V=this._getPopperConfig();this._popper=pc(g,this._menu,V)}_isShown(){return this._menu.classList.contains(m)}_getPlacement(){const g=this._parent;if(g.classList.contains("dropend"))return En;if(g.classList.contains("dropstart"))return Ns;if(g.classList.contains("dropup-center"))return"top";if(g.classList.contains("dropdown-center"))return"bottom";const V=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return g.classList.contains("dropup")?V?Me:Ae:V?_s:lt}_detectNavbar(){return this._element.closest(".navbar")!==null}_getOffset(){const{offset:g}=this._config;return typeof g=="string"?g.split(",").map(V=>Number.parseInt(V,10)):typeof g=="function"?V=>g(V,this._element):g}_getPopperConfig(){const g={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(P.setDataAttribute(this._menu,"popper","static"),g.modifiers=[{name:"applyStyles",enabled:!1}]),{...g,...T(this._config.popperConfig,[void 0,g])}}_selectMenuItem({key:g,target:V}){const le=w.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(ve=>d(ve));le.length&&S(le,V,g===Qd,!le.includes(V)).focus()}static jQueryInterface(g){return this.each(function(){const V=Ln.getOrCreateInstance(this,g);if(typeof g=="string"){if(V[g]===void 0)throw new TypeError(`No method named "${g}"`);V[g]()}})}static clearMenus(g){if(g.button===2||g.type==="keyup"&&g.key!=="Tab")return;const V=w.find(K);for(const le of V){const ve=Ln.getInstance(le);if(!ve||ve._config.autoClose===!1)continue;const Ce=g.composedPath(),Ue=Ce.includes(ve._menu);if(Ce.includes(ve._element)||ve._config.autoClose==="inside"&&!Ue||ve._config.autoClose==="outside"&&Ue||ve._menu.contains(g.target)&&(g.type==="keyup"&&g.key==="Tab"||/input|select|option|textarea|form/i.test(g.target.tagName)))continue;const Qe={relatedTarget:ve._element};g.type==="click"&&(Qe.clickEvent=g),ve._completeHide(Qe)}}static dataApiKeydownHandler(g){const V=/input|textarea/i.test(g.target.tagName),le=g.key==="Escape",ve=[tm,Qd].includes(g.key);if(!ve&&!le||V&&!le)return;g.preventDefault();const Ce=this.matches(M)?this:w.prev(this,M)[0]||w.next(this,M)[0]||w.findOne(M,g.delegateTarget.parentNode),Ue=Ln.getOrCreateInstance(Ce);if(ve)return g.stopPropagation(),Ue.show(),void Ue._selectMenuItem(g);Ue._isShown()&&(g.stopPropagation(),Ue.hide(),Ce.focus())}}k.on(document,Yd,M,Ln.dataApiKeydownHandler),k.on(document,Yd,ce,Ln.dataApiKeydownHandler),k.on(document,Kd,Ln.clearMenus),k.on(document,Va,Ln.clearMenus),k.on(document,Kd,M,function(ee){ee.preventDefault(),Ln.getOrCreateInstance(this).toggle()}),y(Ln);const Er="backdrop",Zo="show",gc=`mousedown.bs.${Er}`,eA={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},tA={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class B0 extends _{constructor(g){super(),this._config=this._getConfig(g),this._isAppended=!1,this._element=null}static get Default(){return eA}static get DefaultType(){return tA}static get NAME(){return Er}show(g){if(!this._config.isVisible)return void T(g);this._append();const V=this._getElement();this._config.isAnimated&&j(V),V.classList.add(Zo),this._emulateAnimation(()=>{T(g)})}hide(g){this._config.isVisible?(this._getElement().classList.remove(Zo),this._emulateAnimation(()=>{this.dispose(),T(g)})):T(g)}dispose(){this._isAppended&&(k.off(this._element,gc),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const g=document.createElement("div");g.className=this._config.className,this._config.isAnimated&&g.classList.add("fade"),this._element=g}return this._element}_configAfterMerge(g){return g.rootElement=c(g.rootElement),g}_append(){if(this._isAppended)return;const g=this._getElement();this._config.rootElement.append(g),k.on(g,gc,()=>{T(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(g){x(g,this._getElement(),this._config.isAnimated)}}const rm=".bs.focustrap",sA=`focusin${rm}`,nA=`keydown.tab${rm}`,G0="backward",rA={autofocus:!0,trapElement:null},iA={autofocus:"boolean",trapElement:"element"};class W0 extends _{constructor(g){super(),this._config=this._getConfig(g),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return rA}static get DefaultType(){return iA}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),k.off(document,rm),k.on(document,sA,g=>this._handleFocusin(g)),k.on(document,nA,g=>this._handleKeydown(g)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,k.off(document,rm))}_handleFocusin(g){const{trapElement:V}=this._config;if(g.target===document||g.target===V||V.contains(g.target))return;const le=w.focusableChildren(V);le.length===0?V.focus():this._lastTabNavDirection===G0?le[le.length-1].focus():le[0].focus()}_handleKeydown(g){g.key==="Tab"&&(this._lastTabNavDirection=g.shiftKey?G0:"forward")}}const q0=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",H0=".sticky-top",im="padding-right",Q0="margin-right";class eg{constructor(){this._element=document.body}getWidth(){const g=document.documentElement.clientWidth;return Math.abs(window.innerWidth-g)}hide(){const g=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,im,V=>V+g),this._setElementAttributes(q0,im,V=>V+g),this._setElementAttributes(H0,Q0,V=>V-g)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,im),this._resetElementAttributes(q0,im),this._resetElementAttributes(H0,Q0)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(g,V,le){const ve=this.getWidth();this._applyManipulationCallback(g,Ce=>{if(Ce!==this._element&&window.innerWidth>Ce.clientWidth+ve)return;this._saveInitialAttribute(Ce,V);const Ue=window.getComputedStyle(Ce).getPropertyValue(V);Ce.style.setProperty(V,`${le(Number.parseFloat(Ue))}px`)})}_saveInitialAttribute(g,V){const le=g.style.getPropertyValue(V);le&&P.setDataAttribute(g,V,le)}_resetElementAttributes(g,V){this._applyManipulationCallback(g,le=>{const ve=P.getDataAttribute(le,V);ve!==null?(P.removeDataAttribute(le,V),le.style.setProperty(V,ve)):le.style.removeProperty(V)})}_applyManipulationCallback(g,V){if(l(g))V(g);else for(const le of w.find(g,this._element))V(le)}}const ti=".bs.modal",aA=`hide${ti}`,oA=`hidePrevented${ti}`,K0=`hidden${ti}`,Y0=`show${ti}`,lA=`shown${ti}`,cA=`resize${ti}`,dA=`click.dismiss${ti}`,uA=`mousedown.dismiss${ti}`,hA=`keydown.dismiss${ti}`,mA=`click${ti}.data-api`,J0="modal-open",X0="show",tg="modal-static",pA={backdrop:!0,focus:!0,keyboard:!0},fA={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class el extends C{constructor(g,V){super(g,V),this._dialog=w.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new eg,this._addEventListeners()}static get Default(){return pA}static get DefaultType(){return fA}static get NAME(){return"modal"}toggle(g){return this._isShown?this.hide():this.show(g)}show(g){this._isShown||this._isTransitioning||k.trigger(this._element,Y0,{relatedTarget:g}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(J0),this._adjustDialog(),this._backdrop.show(()=>this._showElement(g)))}hide(){this._isShown&&!this._isTransitioning&&(k.trigger(this._element,aA).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(X0),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){k.off(window,ti),k.off(this._dialog,ti),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new B0({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new W0({trapElement:this._element})}_showElement(g){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const V=w.findOne(".modal-body",this._dialog);V&&(V.scrollTop=0),j(this._element),this._element.classList.add(X0),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,k.trigger(this._element,lA,{relatedTarget:g})},this._dialog,this._isAnimated())}_addEventListeners(){k.on(this._element,hA,g=>{g.key==="Escape"&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())}),k.on(window,cA,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),k.on(this._element,uA,g=>{k.one(this._element,dA,V=>{this._element===g.target&&this._element===V.target&&(this._config.backdrop!=="static"?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(J0),this._resetAdjustments(),this._scrollBar.reset(),k.trigger(this._element,K0)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(k.trigger(this._element,oA).defaultPrevented)return;const g=this._element.scrollHeight>document.documentElement.clientHeight,V=this._element.style.overflowY;V==="hidden"||this._element.classList.contains(tg)||(g||(this._element.style.overflowY="hidden"),this._element.classList.add(tg),this._queueCallback(()=>{this._element.classList.remove(tg),this._queueCallback(()=>{this._element.style.overflowY=V},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const g=this._element.scrollHeight>document.documentElement.clientHeight,V=this._scrollBar.getWidth(),le=V>0;if(le&&!g){const ve=D()?"paddingLeft":"paddingRight";this._element.style[ve]=`${V}px`}if(!le&&g){const ve=D()?"paddingRight":"paddingLeft";this._element.style[ve]=`${V}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(g,V){return this.each(function(){const le=el.getOrCreateInstance(this,g);if(typeof g=="string"){if(le[g]===void 0)throw new TypeError(`No method named "${g}"`);le[g](V)}})}}k.on(document,mA,'[data-bs-toggle="modal"]',function(ee){const g=w.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&ee.preventDefault(),k.one(g,Y0,le=>{le.defaultPrevented||k.one(g,K0,()=>{d(this)&&this.focus()})});const V=w.findOne(".modal.show");V&&el.getInstance(V).hide(),el.getOrCreateInstance(g).toggle(this)}),W(el),y(el);const da=".bs.offcanvas",Z0=".data-api",gA=`load${da}${Z0}`,ew="show",tw="showing",sw="hiding",nw=".offcanvas.show",xA=`show${da}`,yA=`shown${da}`,bA=`hide${da}`,rw=`hidePrevented${da}`,iw=`hidden${da}`,wA=`resize${da}`,vA=`click${da}${Z0}`,NA=`keydown.dismiss${da}`,jA={backdrop:!0,keyboard:!0,scroll:!1},SA={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class ua extends C{constructor(g,V){super(g,V),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return jA}static get DefaultType(){return SA}static get NAME(){return"offcanvas"}toggle(g){return this._isShown?this.hide():this.show(g)}show(g){this._isShown||k.trigger(this._element,xA,{relatedTarget:g}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||new eg().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(tw),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(ew),this._element.classList.remove(tw),k.trigger(this._element,yA,{relatedTarget:g})},this._element,!0))}hide(){this._isShown&&(k.trigger(this._element,bA).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(sw),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(ew,sw),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new eg().reset(),k.trigger(this._element,iw)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const g=!!this._config.backdrop;return new B0({className:"offcanvas-backdrop",isVisible:g,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:g?()=>{this._config.backdrop!=="static"?this.hide():k.trigger(this._element,rw)}:null})}_initializeFocusTrap(){return new W0({trapElement:this._element})}_addEventListeners(){k.on(this._element,NA,g=>{g.key==="Escape"&&(this._config.keyboard?this.hide():k.trigger(this._element,rw))})}static jQueryInterface(g){return this.each(function(){const V=ua.getOrCreateInstance(this,g);if(typeof g=="string"){if(V[g]===void 0||g.startsWith("_")||g==="constructor")throw new TypeError(`No method named "${g}"`);V[g](this)}})}}k.on(document,vA,'[data-bs-toggle="offcanvas"]',function(ee){const g=w.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&ee.preventDefault(),u(this))return;k.one(g,iw,()=>{d(this)&&this.focus()});const V=w.findOne(nw);V&&V!==g&&ua.getInstance(V).hide(),ua.getOrCreateInstance(g).toggle(this)}),k.on(window,gA,()=>{for(const ee of w.find(nw))ua.getOrCreateInstance(ee).show()}),k.on(window,wA,()=>{for(const ee of w.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(ee).position!=="fixed"&&ua.getOrCreateInstance(ee).hide()}),W(ua),y(ua);const aw={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},EA=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),CA=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,IA=(ee,g)=>{const V=ee.nodeName.toLowerCase();return g.includes(V)?!EA.has(V)||!!CA.test(ee.nodeValue):g.filter(le=>le instanceof RegExp).some(le=>le.test(V))},TA={allowList:aw,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},AA={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},_A={entry:"(string|element|function|null)",selector:"(string|element)"};class RA extends _{constructor(g){super(),this._config=this._getConfig(g)}static get Default(){return TA}static get DefaultType(){return AA}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(g=>this._resolvePossibleFunction(g)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(g){return this._checkContent(g),this._config.content={...this._config.content,...g},this}toHtml(){const g=document.createElement("div");g.innerHTML=this._maybeSanitize(this._config.template);for(const[ve,Ce]of Object.entries(this._config.content))this._setContent(g,Ce,ve);const V=g.children[0],le=this._resolvePossibleFunction(this._config.extraClass);return le&&V.classList.add(...le.split(" ")),V}_typeCheckConfig(g){super._typeCheckConfig(g),this._checkContent(g.content)}_checkContent(g){for(const[V,le]of Object.entries(g))super._typeCheckConfig({selector:V,entry:le},_A)}_setContent(g,V,le){const ve=w.findOne(le,g);ve&&((V=this._resolvePossibleFunction(V))?l(V)?this._putElementInTemplate(c(V),ve):this._config.html?ve.innerHTML=this._maybeSanitize(V):ve.textContent=V:ve.remove())}_maybeSanitize(g){return this._config.sanitize?function(V,le,ve){if(!V.length)return V;if(ve&&typeof ve=="function")return ve(V);const Ce=new window.DOMParser().parseFromString(V,"text/html"),Ue=[].concat(...Ce.body.querySelectorAll("*"));for(const Qe of Ue){const ct=Qe.nodeName.toLowerCase();if(!Object.keys(le).includes(ct)){Qe.remove();continue}const vt=[].concat(...Qe.attributes),St=[].concat(le["*"]||[],le[ct]||[]);for(const yt of vt)IA(yt,St)||Qe.removeAttribute(yt.nodeName)}return Ce.body.innerHTML}(g,this._config.allowList,this._config.sanitizeFn):g}_resolvePossibleFunction(g){return T(g,[void 0,this])}_putElementInTemplate(g,V){if(this._config.html)return V.innerHTML="",void V.append(g);V.textContent=g.textContent}}const DA=new Set(["sanitize","allowList","sanitizeFn"]),sg="fade",am="show",PA=".tooltip-inner",ow=".modal",lw="hide.bs.modal",Jd="hover",ng="focus",rg="click",kA={AUTO:"auto",TOP:"top",RIGHT:D()?"left":"right",BOTTOM:"bottom",LEFT:D()?"right":"left"},LA={allowList:aw,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},FA={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class tl extends C{constructor(g,V){if(Xo===void 0)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org/docs/v2/)");super(g,V),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return LA}static get DefaultType(){return FA}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),k.off(this._element.closest(ow),lw,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const g=k.trigger(this._element,this.constructor.eventName("show")),V=(f(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(g.defaultPrevented||!V)return;this._disposePopper();const le=this._getTipElement();this._element.setAttribute("aria-describedby",le.getAttribute("id"));const{container:ve}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(ve.append(le),k.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(le),le.classList.add(am),"ontouchstart"in document.documentElement)for(const Ce of[].concat(...document.body.children))k.on(Ce,"mouseover",p);this._queueCallback(()=>{k.trigger(this._element,this.constructor.eventName("shown")),this._isHovered===!1&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!k.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(am),"ontouchstart"in document.documentElement)for(const g of[].concat(...document.body.children))k.off(g,"mouseover",p);this._activeTrigger[rg]=!1,this._activeTrigger[ng]=!1,this._activeTrigger[Jd]=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),k.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(g){const V=this._getTemplateFactory(g).toHtml();if(!V)return null;V.classList.remove(sg,am),V.classList.add(`bs-${this.constructor.NAME}-auto`);const le=(ve=>{do ve+=Math.floor(1e6*Math.random());while(document.getElementById(ve));return ve})(this.constructor.NAME).toString();return V.setAttribute("id",le),this._isAnimated()&&V.classList.add(sg),V}setContent(g){this._newContent=g,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(g){return this._templateFactory?this._templateFactory.changeContent(g):this._templateFactory=new RA({...this._config,content:g,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[PA]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(g){return this.constructor.getOrCreateInstance(g.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(sg)}_isShown(){return this.tip&&this.tip.classList.contains(am)}_createPopper(g){const V=T(this._config.placement,[this,g,this._element]),le=kA[V.toUpperCase()];return pc(this._element,g,this._getPopperConfig(le))}_getOffset(){const{offset:g}=this._config;return typeof g=="string"?g.split(",").map(V=>Number.parseInt(V,10)):typeof g=="function"?V=>g(V,this._element):g}_resolvePossibleFunction(g){return T(g,[this._element,this._element])}_getPopperConfig(g){const V={placement:g,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:le=>{this._getTipElement().setAttribute("data-popper-placement",le.state.placement)}}]};return{...V,...T(this._config.popperConfig,[void 0,V])}}_setListeners(){const g=this._config.trigger.split(" ");for(const V of g)if(V==="click")k.on(this._element,this.constructor.eventName("click"),this._config.selector,le=>{const ve=this._initializeOnDelegatedTarget(le);ve._activeTrigger[rg]=!(ve._isShown()&&ve._activeTrigger[rg]),ve.toggle()});else if(V!=="manual"){const le=V===Jd?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),ve=V===Jd?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");k.on(this._element,le,this._config.selector,Ce=>{const Ue=this._initializeOnDelegatedTarget(Ce);Ue._activeTrigger[Ce.type==="focusin"?ng:Jd]=!0,Ue._enter()}),k.on(this._element,ve,this._config.selector,Ce=>{const Ue=this._initializeOnDelegatedTarget(Ce);Ue._activeTrigger[Ce.type==="focusout"?ng:Jd]=Ue._element.contains(Ce.relatedTarget),Ue._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},k.on(this._element.closest(ow),lw,this._hideModalHandler)}_fixTitle(){const g=this._element.getAttribute("title");g&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",g),this._element.setAttribute("data-bs-original-title",g),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(g,V){clearTimeout(this._timeout),this._timeout=setTimeout(g,V)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(g){const V=P.getDataAttributes(this._element);for(const le of Object.keys(V))DA.has(le)&&delete V[le];return g={...V,...typeof g=="object"&&g?g:{}},g=this._mergeConfigObj(g),g=this._configAfterMerge(g),this._typeCheckConfig(g),g}_configAfterMerge(g){return g.container=g.container===!1?document.body:c(g.container),typeof g.delay=="number"&&(g.delay={show:g.delay,hide:g.delay}),typeof g.title=="number"&&(g.title=g.title.toString()),typeof g.content=="number"&&(g.content=g.content.toString()),g}_getDelegateConfig(){const g={};for(const[V,le]of Object.entries(this._config))this.constructor.Default[V]!==le&&(g[V]=le);return g.selector=!1,g.trigger="manual",g}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(g){return this.each(function(){const V=tl.getOrCreateInstance(this,g);if(typeof g=="string"){if(V[g]===void 0)throw new TypeError(`No method named "${g}"`);V[g]()}})}}y(tl);const OA=".popover-header",MA=".popover-body",UA={...tl.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},$A={...tl.DefaultType,content:"(null|string|element|function)"};class om extends tl{static get Default(){return UA}static get DefaultType(){return $A}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[OA]:this._getTitle(),[MA]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(g){return this.each(function(){const V=om.getOrCreateInstance(this,g);if(typeof g=="string"){if(V[g]===void 0)throw new TypeError(`No method named "${g}"`);V[g]()}})}}y(om);const ig=".bs.scrollspy",zA=`activate${ig}`,cw=`click${ig}`,VA=`load${ig}.data-api`,xc="active",ag="[href]",dw=".nav-link",BA=`${dw}, .nav-item > ${dw}, .list-group-item`,GA={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},WA={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class Xd extends C{constructor(g,V){super(g,V),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return GA}static get DefaultType(){return WA}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const g of this._observableSections.values())this._observer.observe(g)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(g){return g.target=c(g.target)||document.body,g.rootMargin=g.offset?`${g.offset}px 0px -30%`:g.rootMargin,typeof g.threshold=="string"&&(g.threshold=g.threshold.split(",").map(V=>Number.parseFloat(V))),g}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(k.off(this._config.target,cw),k.on(this._config.target,cw,ag,g=>{const V=this._observableSections.get(g.target.hash);if(V){g.preventDefault();const le=this._rootElement||window,ve=V.offsetTop-this._element.offsetTop;if(le.scrollTo)return void le.scrollTo({top:ve,behavior:"smooth"});le.scrollTop=ve}}))}_getNewObserver(){const g={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(V=>this._observerCallback(V),g)}_observerCallback(g){const V=Ue=>this._targetLinks.get(`#${Ue.target.id}`),le=Ue=>{this._previousScrollData.visibleEntryTop=Ue.target.offsetTop,this._process(V(Ue))},ve=(this._rootElement||document.documentElement).scrollTop,Ce=ve>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=ve;for(const Ue of g){if(!Ue.isIntersecting){this._activeTarget=null,this._clearActiveClass(V(Ue));continue}const Qe=Ue.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(Ce&&Qe){if(le(Ue),!ve)return}else Ce||Qe||le(Ue)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const g=w.find(ag,this._config.target);for(const V of g){if(!V.hash||u(V))continue;const le=w.findOne(decodeURI(V.hash),this._element);d(le)&&(this._targetLinks.set(decodeURI(V.hash),V),this._observableSections.set(V.hash,le))}}_process(g){this._activeTarget!==g&&(this._clearActiveClass(this._config.target),this._activeTarget=g,g.classList.add(xc),this._activateParents(g),k.trigger(this._element,zA,{relatedTarget:g}))}_activateParents(g){if(g.classList.contains("dropdown-item"))w.findOne(".dropdown-toggle",g.closest(".dropdown")).classList.add(xc);else for(const V of w.parents(g,".nav, .list-group"))for(const le of w.prev(V,BA))le.classList.add(xc)}_clearActiveClass(g){g.classList.remove(xc);const V=w.find(`${ag}.${xc}`,g);for(const le of V)le.classList.remove(xc)}static jQueryInterface(g){return this.each(function(){const V=Xd.getOrCreateInstance(this,g);if(typeof g=="string"){if(V[g]===void 0||g.startsWith("_")||g==="constructor")throw new TypeError(`No method named "${g}"`);V[g]()}})}}k.on(window,VA,()=>{for(const ee of w.find('[data-bs-spy="scroll"]'))Xd.getOrCreateInstance(ee)}),y(Xd);const sl=".bs.tab",qA=`hide${sl}`,HA=`hidden${sl}`,QA=`show${sl}`,KA=`shown${sl}`,YA=`click${sl}`,JA=`keydown${sl}`,XA=`load${sl}`,ZA="ArrowLeft",uw="ArrowRight",e_="ArrowUp",hw="ArrowDown",og="Home",mw="End",nl="active",pw="fade",lg="show",fw=".dropdown-toggle",cg=`:not(${fw})`,gw='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',dg=`.nav-link${cg}, .list-group-item${cg}, [role="tab"]${cg}, ${gw}`,t_=`.${nl}[data-bs-toggle="tab"], .${nl}[data-bs-toggle="pill"], .${nl}[data-bs-toggle="list"]`;class rl extends C{constructor(g){super(g),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),k.on(this._element,JA,V=>this._keydown(V)))}static get NAME(){return"tab"}show(){const g=this._element;if(this._elemIsActive(g))return;const V=this._getActiveElem(),le=V?k.trigger(V,qA,{relatedTarget:g}):null;k.trigger(g,QA,{relatedTarget:V}).defaultPrevented||le&&le.defaultPrevented||(this._deactivate(V,g),this._activate(g,V))}_activate(g,V){g&&(g.classList.add(nl),this._activate(w.getElementFromSelector(g)),this._queueCallback(()=>{g.getAttribute("role")==="tab"?(g.removeAttribute("tabindex"),g.setAttribute("aria-selected",!0),this._toggleDropDown(g,!0),k.trigger(g,KA,{relatedTarget:V})):g.classList.add(lg)},g,g.classList.contains(pw)))}_deactivate(g,V){g&&(g.classList.remove(nl),g.blur(),this._deactivate(w.getElementFromSelector(g)),this._queueCallback(()=>{g.getAttribute("role")==="tab"?(g.setAttribute("aria-selected",!1),g.setAttribute("tabindex","-1"),this._toggleDropDown(g,!1),k.trigger(g,HA,{relatedTarget:V})):g.classList.remove(lg)},g,g.classList.contains(pw)))}_keydown(g){if(![ZA,uw,e_,hw,og,mw].includes(g.key))return;g.stopPropagation(),g.preventDefault();const V=this._getChildren().filter(ve=>!u(ve));let le;if([og,mw].includes(g.key))le=V[g.key===og?0:V.length-1];else{const ve=[uw,hw].includes(g.key);le=S(V,g.target,ve,!0)}le&&(le.focus({preventScroll:!0}),rl.getOrCreateInstance(le).show())}_getChildren(){return w.find(dg,this._parent)}_getActiveElem(){return this._getChildren().find(g=>this._elemIsActive(g))||null}_setInitialAttributes(g,V){this._setAttributeIfNotExists(g,"role","tablist");for(const le of V)this._setInitialAttributesOnChild(le)}_setInitialAttributesOnChild(g){g=this._getInnerElement(g);const V=this._elemIsActive(g),le=this._getOuterElement(g);g.setAttribute("aria-selected",V),le!==g&&this._setAttributeIfNotExists(le,"role","presentation"),V||g.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(g,"role","tab"),this._setInitialAttributesOnTargetPanel(g)}_setInitialAttributesOnTargetPanel(g){const V=w.getElementFromSelector(g);V&&(this._setAttributeIfNotExists(V,"role","tabpanel"),g.id&&this._setAttributeIfNotExists(V,"aria-labelledby",`${g.id}`))}_toggleDropDown(g,V){const le=this._getOuterElement(g);if(!le.classList.contains("dropdown"))return;const ve=(Ce,Ue)=>{const Qe=w.findOne(Ce,le);Qe&&Qe.classList.toggle(Ue,V)};ve(fw,nl),ve(".dropdown-menu",lg),le.setAttribute("aria-expanded",V)}_setAttributeIfNotExists(g,V,le){g.hasAttribute(V)||g.setAttribute(V,le)}_elemIsActive(g){return g.classList.contains(nl)}_getInnerElement(g){return g.matches(dg)?g:w.findOne(dg,g)}_getOuterElement(g){return g.closest(".nav-item, .list-group-item")||g}static jQueryInterface(g){return this.each(function(){const V=rl.getOrCreateInstance(this);if(typeof g=="string"){if(V[g]===void 0||g.startsWith("_")||g==="constructor")throw new TypeError(`No method named "${g}"`);V[g]()}})}}k.on(document,YA,gw,function(ee){["A","AREA"].includes(this.tagName)&&ee.preventDefault(),u(this)||rl.getOrCreateInstance(this).show()}),k.on(window,XA,()=>{for(const ee of w.find(t_))rl.getOrCreateInstance(ee)}),y(rl);const Ba=".bs.toast",s_=`mouseover${Ba}`,n_=`mouseout${Ba}`,r_=`focusin${Ba}`,i_=`focusout${Ba}`,a_=`hide${Ba}`,o_=`hidden${Ba}`,l_=`show${Ba}`,c_=`shown${Ba}`,xw="hide",lm="show",cm="showing",d_={animation:"boolean",autohide:"boolean",delay:"number"},u_={animation:!0,autohide:!0,delay:5e3};class Zd extends C{constructor(g,V){super(g,V),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return u_}static get DefaultType(){return d_}static get NAME(){return"toast"}show(){k.trigger(this._element,l_).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(xw),j(this._element),this._element.classList.add(lm,cm),this._queueCallback(()=>{this._element.classList.remove(cm),k.trigger(this._element,c_),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(k.trigger(this._element,a_).defaultPrevented||(this._element.classList.add(cm),this._queueCallback(()=>{this._element.classList.add(xw),this._element.classList.remove(cm,lm),k.trigger(this._element,o_)},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(lm),super.dispose()}isShown(){return this._element.classList.contains(lm)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(g,V){switch(g.type){case"mouseover":case"mouseout":this._hasMouseInteraction=V;break;case"focusin":case"focusout":this._hasKeyboardInteraction=V}if(V)return void this._clearTimeout();const le=g.relatedTarget;this._element===le||this._element.contains(le)||this._maybeScheduleHide()}_setListeners(){k.on(this._element,s_,g=>this._onInteraction(g,!0)),k.on(this._element,n_,g=>this._onInteraction(g,!1)),k.on(this._element,r_,g=>this._onInteraction(g,!0)),k.on(this._element,i_,g=>this._onInteraction(g,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(g){return this.each(function(){const V=Zd.getOrCreateInstance(this,g);if(typeof g=="string"){if(V[g]===void 0)throw new TypeError(`No method named "${g}"`);V[g](this)}})}}return W(Zd),y(Zd),{Alert:ye,Button:be,Carousel:Ie,Collapse:Ze,Dropdown:Ln,Modal:el,Offcanvas:ua,Popover:om,ScrollSpy:Xd,Tab:rl,Toast:Zd,Tooltip:tl}})})(Mz);class Uz{constructor(){this.processedCount=0,this.updatedCount=0,this.errorCount=0}async migrateAllActivityRecords(){console.log(" Starting Activity Records Migration..."),console.log(' This will update activity descriptions from "title" to "entity" format');try{await ws.initialize();const e=ws.activities||[];if(console.log(` Found ${e.length} activity records to process`),e.length===0){console.log(" No activities found to migrate");return}const s=10;for(let r=0;r<e.length;r+=s){const i=e.slice(r,r+s);await this.processBatch(i,r+1),await new Promise(a=>setTimeout(a,500))}return console.log(" Migration completed successfully!"),console.log(` Statistics:
        - Total processed: ${this.processedCount}
        - Successfully updated: ${this.updatedCount}
        - Errors: ${this.errorCount}`),{success:!0,processed:this.processedCount,updated:this.updatedCount,errors:this.errorCount}}catch(e){return console.error(" Migration failed:",e),{success:!1,error:e.message,processed:this.processedCount,updated:this.updatedCount,errors:this.errorCount}}}async processBatch(e,s){console.log(` Processing batch ${Math.ceil(s/10)} (activities ${s}-${s+e.length-1})`);const r=e.map(a=>this.updateActivityRecord(a));(await Promise.allSettled(r)).forEach((a,o)=>{a.status==="fulfilled"&&a.value?this.updatedCount++:a.status==="rejected"&&(this.errorCount++,console.error(` Error updating activity ${e[o].internalId}:`,a.reason)),this.processedCount++})}async updateActivityRecord(e){try{if(!this.needsUpdate(e))return!1;console.log(` Updating activity: ${e.internalId}`),console.log(`   Old description: ${e.description}`);const s=await this.getTenderEntity(e);if(!s)return console.log(` Could not find entity for activity ${e.internalId}`),!1;const r=this.createNewDescription(e,s);if(r===e.description)return console.log(` Activity ${e.internalId} already has correct format`),!1;const i={...e,description:r,details:{...e.details,tenderEntity:s,originalDescription:e.description,migrated:!0,migratedAt:new Date().toISOString()}};return await ws.update(e.id||e._id||e.docId,i),console.log(` Updated activity: ${e.internalId}`),console.log(`   New description: ${r}`),!0}catch(s){throw console.error(` Error updating activity ${e.internalId}:`,s),s}}needsUpdate(e){var i;return(i=e.details)!=null&&i.migrated||!["tender_create","tender_update","tender_delete","document_upload","document_delete"].includes(e.type)?!1:e.description.includes("   :")||e.description.includes("  :")||e.description.includes(" ")||e.description.includes(" ")}async getTenderEntity(e){var s,r;try{if((s=e.details)!=null&&s.tenderInternalId){const i=await dn.getByInternalId(e.details.tenderInternalId);if(i&&i.entity)return i.entity}if((r=e.details)!=null&&r.tenderTitle)return e.details.tenderTitle;if(e.description.includes(":")){const i=e.description.split(":");if(i.length>1)return i[1].trim()}return null}catch(i){return console.error("Error getting tender entity:",i),null}}createNewDescription(e,s){var r,i;switch(e.type){case"tender_create":return`  : ${s}`;case"tender_update":return`  : ${s}`;case"document_upload":return`  : ${((r=e.details)==null?void 0:r.fileName)||""} : ${s}`;case"document_delete":return`  : ${((i=e.details)==null?void 0:i.fileName)||""}  : ${s}`;default:return e.description}}async rollbackMigration(){console.log(" Starting Migration Rollback...");try{await ws.initialize();const s=(ws.activities||[]).filter(r=>{var i,a;return((i=r.details)==null?void 0:i.migrated)&&((a=r.details)==null?void 0:a.originalDescription)});console.log(` Found ${s.length} migrated records to rollback`);for(const r of s){const i={...r,description:r.details.originalDescription,details:{...r.details,migrated:!1,rolledBackAt:new Date().toISOString()}};await ws.update(r.id||r._id||r.docId,i),console.log(` Rolled back activity: ${r.internalId}`)}return console.log(" Rollback completed successfully!"),{success:!0,rolledBack:s.length}}catch(e){return console.error(" Rollback failed:",e),{success:!1,error:e.message}}}}const Z1=new Uz;window.migrateActivityRecords=()=>Z1.migrateAllActivityRecords();window.rollbackActivityMigration=()=>Z1.rollbackMigration();console.log(" Activity Migration Utilities Loaded");console.log(" Available commands:");console.log("    window.migrateActivityRecords() - Migrate all records to new format");console.log("    window.rollbackActivityMigration() - Rollback migration if needed");console.log(" Starting application...");window.addEventListener("error",n=>{console.error("Global error:",n.error)});window.addEventListener("unhandledrejection",n=>{if(n.reason&&n.reason.message){const e=n.reason.message;if(e.includes("Document not found")||e.includes("   usersettings")||e.includes("UserSettingsService")||e.includes("_getRecaptchaConfig")||e.includes("client is offline")||e.includes("auth/network-request-failed")){console.log(" Suppressed non-critical Firebase error:",e),n.preventDefault();return}}console.error("Unhandled promise rejection:",n.reason)});console.log(" React imported");class $z extends wa.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){console.error("Error boundary caught:",e,s)}render(){var e;return this.state.hasError?t.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",fontFamily:"Arial",background:"#f8f9fa"},children:t.jsxs("div",{style:{textAlign:"center",padding:"40px",background:"white",borderRadius:"8px",boxShadow:"0 2px 10px rgba(0,0,0,0.1)",maxWidth:"500px"},children:[t.jsx("h2",{style:{color:"#dc3545"},children:"  "}),t.jsx("p",{style:{color:"#666",margin:"20px 0"},children:"   .    ."}),t.jsx("button",{onClick:()=>window.location.reload(),style:{padding:"12px 24px",background:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"16px"},children:" "}),t.jsxs("details",{style:{marginTop:"20px",textAlign:"left"},children:[t.jsx("summary",{style:{cursor:"pointer",color:"#666"},children:" "}),t.jsx("pre",{style:{background:"#f8f9fa",padding:"10px",borderRadius:"4px",fontSize:"12px",overflow:"auto",maxHeight:"200px"},children:(e=this.state.error)==null?void 0:e.toString()})]})]})}):this.props.children}}try{console.log("Loading core modules...")}catch(n){console.error("Import error:",n)}console.log(" All modules loaded");console.log(" Loading migration utilities...");console.log(" Skipping dev utilities for stability");try{console.log("Creating React root...");const n=document.getElementById("root");if(!n)throw new Error("Root element not found");const e=lx.createRoot(n);console.log(" React root created"),console.log("Rendering application..."),e.render(t.jsx($z,{children:t.jsx(Oz,{requireF11:!1,tolerance:4,onEnter:()=>{try{startTimer==null||startTimer()}catch{}},onExit:()=>{try{pauseTimer==null||pauseTimer()}catch{}},children:t.jsx(Dz,{})})})),console.log(" Application rendered successfully")}catch(n){console.error("Critical rendering error:",n),document.body.innerHTML=`
    <div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-family: Arial;">
      <div style="text-align: center; padding: 40px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <h2 style="color: #dc3545;">   </h2>
        <p style="color: #666;">   : ${n.message}</p>
        <button onclick="window.location.reload()" style="padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
           
        </button>
      </div>
    </div>
  `}export{Mt as C,Tt as I,dr as P,bs as S,tn as T,Yn as a,Zt as b,Bt as c,cr as d,sc as e,nc as f,Ei as g,t as j,h as r,Bz as s,Hl as t,kt as u};
