(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(a){if(a.ep)return;a.ep=!0;const l=t(a);fetch(a.href,l)}})();function GE(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ib={exports:{}},Sm={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yj;function xA(){if(yj)return Sm;yj=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,a,l){var c=null;if(l!==void 0&&(c=""+l),a.key!==void 0&&(c=""+a.key),"key"in a){l={};for(var u in a)u!=="key"&&(l[u]=a[u])}else l=a;return a=l.ref,{$$typeof:r,type:s,key:c,ref:a!==void 0?a:null,props:l}}return Sm.Fragment=e,Sm.jsx=t,Sm.jsxs=t,Sm}var bj;function yA(){return bj||(bj=1,ib.exports=xA()),ib.exports}var n=yA(),ab={exports:{}},qt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wj;function bA(){if(wj)return qt;wj=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),b=Symbol.for("react.lazy"),w=Symbol.iterator;function j(_){return _===null||typeof _!="object"?null:(_=w&&_[w]||_["@@iterator"],typeof _=="function"?_:null)}var D={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},O=Object.assign,Q={};function z(_,E,R){this.props=_,this.context=E,this.refs=Q,this.updater=R||D}z.prototype.isReactComponent={},z.prototype.setState=function(_,E){if(typeof _!="object"&&typeof _!="function"&&_!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,_,E,"setState")},z.prototype.forceUpdate=function(_){this.updater.enqueueForceUpdate(this,_,"forceUpdate")};function I(){}I.prototype=z.prototype;function ee(_,E,R){this.props=_,this.context=E,this.refs=Q,this.updater=R||D}var J=ee.prototype=new I;J.constructor=ee,O(J,z.prototype),J.isPureReactComponent=!0;var oe=Array.isArray,Y={H:null,A:null,T:null,S:null,V:null},be=Object.prototype.hasOwnProperty;function M(_,E,R,V,ne,B){return R=B.ref,{$$typeof:r,type:_,key:E,ref:R!==void 0?R:null,props:B}}function H(_,E){return M(_.type,E,void 0,void 0,void 0,_.props)}function k(_){return typeof _=="object"&&_!==null&&_.$$typeof===r}function $(_){var E={"=":"=0",":":"=2"};return"$"+_.replace(/[=:]/g,function(R){return E[R]})}var X=/\/+/g;function te(_,E){return typeof _=="object"&&_!==null&&_.key!=null?$(""+_.key):E.toString(36)}function F(){}function ce(_){switch(_.status){case"fulfilled":return _.value;case"rejected":throw _.reason;default:switch(typeof _.status=="string"?_.then(F,F):(_.status="pending",_.then(function(E){_.status==="pending"&&(_.status="fulfilled",_.value=E)},function(E){_.status==="pending"&&(_.status="rejected",_.reason=E)})),_.status){case"fulfilled":return _.value;case"rejected":throw _.reason}}throw _}function Be(_,E,R,V,ne){var B=typeof _;(B==="undefined"||B==="boolean")&&(_=null);var q=!1;if(_===null)q=!0;else switch(B){case"bigint":case"string":case"number":q=!0;break;case"object":switch(_.$$typeof){case r:case e:q=!0;break;case b:return q=_._init,Be(q(_._payload),E,R,V,ne)}}if(q)return ne=ne(_),q=V===""?"."+te(_,0):V,oe(ne)?(R="",q!=null&&(R=q.replace(X,"$&/")+"/"),Be(ne,E,R,"",function(Z){return Z})):ne!=null&&(k(ne)&&(ne=H(ne,R+(ne.key==null||_&&_.key===ne.key?"":(""+ne.key).replace(X,"$&/")+"/")+q)),E.push(ne)),1;q=0;var me=V===""?".":V+":";if(oe(_))for(var C=0;C<_.length;C++)V=_[C],B=me+te(V,C),q+=Be(V,E,R,B,ne);else if(C=j(_),typeof C=="function")for(_=C.call(_),C=0;!(V=_.next()).done;)V=V.value,B=me+te(V,C++),q+=Be(V,E,R,B,ne);else if(B==="object"){if(typeof _.then=="function")return Be(ce(_),E,R,V,ne);throw E=String(_),Error("Objects are not valid as a React child (found: "+(E==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":E)+"). If you meant to render a collection of children, use an array instead.")}return q}function U(_,E,R){if(_==null)return _;var V=[],ne=0;return Be(_,V,"","",function(B){return E.call(R,B,ne++)}),V}function se(_){if(_._status===-1){var E=_._result;E=E(),E.then(function(R){(_._status===0||_._status===-1)&&(_._status=1,_._result=R)},function(R){(_._status===0||_._status===-1)&&(_._status=2,_._result=R)}),_._status===-1&&(_._status=0,_._result=E)}if(_._status===1)return _._result.default;throw _._result}var fe=typeof reportError=="function"?reportError:function(_){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var E=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof _=="object"&&_!==null&&typeof _.message=="string"?String(_.message):String(_),error:_});if(!window.dispatchEvent(E))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",_);return}console.error(_)};function ie(){}return qt.Children={map:U,forEach:function(_,E,R){U(_,function(){E.apply(this,arguments)},R)},count:function(_){var E=0;return U(_,function(){E++}),E},toArray:function(_){return U(_,function(E){return E})||[]},only:function(_){if(!k(_))throw Error("React.Children.only expected to receive a single React element child.");return _}},qt.Component=z,qt.Fragment=t,qt.Profiler=a,qt.PureComponent=ee,qt.StrictMode=s,qt.Suspense=m,qt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Y,qt.__COMPILER_RUNTIME={__proto__:null,c:function(_){return Y.H.useMemoCache(_)}},qt.cache=function(_){return function(){return _.apply(null,arguments)}},qt.cloneElement=function(_,E,R){if(_==null)throw Error("The argument must be a React element, but you passed "+_+".");var V=O({},_.props),ne=_.key,B=void 0;if(E!=null)for(q in E.ref!==void 0&&(B=void 0),E.key!==void 0&&(ne=""+E.key),E)!be.call(E,q)||q==="key"||q==="__self"||q==="__source"||q==="ref"&&E.ref===void 0||(V[q]=E[q]);var q=arguments.length-2;if(q===1)V.children=R;else if(1<q){for(var me=Array(q),C=0;C<q;C++)me[C]=arguments[C+2];V.children=me}return M(_.type,ne,void 0,void 0,B,V)},qt.createContext=function(_){return _={$$typeof:c,_currentValue:_,_currentValue2:_,_threadCount:0,Provider:null,Consumer:null},_.Provider=_,_.Consumer={$$typeof:l,_context:_},_},qt.createElement=function(_,E,R){var V,ne={},B=null;if(E!=null)for(V in E.key!==void 0&&(B=""+E.key),E)be.call(E,V)&&V!=="key"&&V!=="__self"&&V!=="__source"&&(ne[V]=E[V]);var q=arguments.length-2;if(q===1)ne.children=R;else if(1<q){for(var me=Array(q),C=0;C<q;C++)me[C]=arguments[C+2];ne.children=me}if(_&&_.defaultProps)for(V in q=_.defaultProps,q)ne[V]===void 0&&(ne[V]=q[V]);return M(_,B,void 0,void 0,null,ne)},qt.createRef=function(){return{current:null}},qt.forwardRef=function(_){return{$$typeof:u,render:_}},qt.isValidElement=k,qt.lazy=function(_){return{$$typeof:b,_payload:{_status:-1,_result:_},_init:se}},qt.memo=function(_,E){return{$$typeof:p,type:_,compare:E===void 0?null:E}},qt.startTransition=function(_){var E=Y.T,R={};Y.T=R;try{var V=_(),ne=Y.S;ne!==null&&ne(R,V),typeof V=="object"&&V!==null&&typeof V.then=="function"&&V.then(ie,fe)}catch(B){fe(B)}finally{Y.T=E}},qt.unstable_useCacheRefresh=function(){return Y.H.useCacheRefresh()},qt.use=function(_){return Y.H.use(_)},qt.useActionState=function(_,E,R){return Y.H.useActionState(_,E,R)},qt.useCallback=function(_,E){return Y.H.useCallback(_,E)},qt.useContext=function(_){return Y.H.useContext(_)},qt.useDebugValue=function(){},qt.useDeferredValue=function(_,E){return Y.H.useDeferredValue(_,E)},qt.useEffect=function(_,E,R){var V=Y.H;if(typeof R=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return V.useEffect(_,E)},qt.useId=function(){return Y.H.useId()},qt.useImperativeHandle=function(_,E,R){return Y.H.useImperativeHandle(_,E,R)},qt.useInsertionEffect=function(_,E){return Y.H.useInsertionEffect(_,E)},qt.useLayoutEffect=function(_,E){return Y.H.useLayoutEffect(_,E)},qt.useMemo=function(_,E){return Y.H.useMemo(_,E)},qt.useOptimistic=function(_,E){return Y.H.useOptimistic(_,E)},qt.useReducer=function(_,E,R){return Y.H.useReducer(_,E,R)},qt.useRef=function(_){return Y.H.useRef(_)},qt.useState=function(_){return Y.H.useState(_)},qt.useSyncExternalStore=function(_,E,R){return Y.H.useSyncExternalStore(_,E,R)},qt.useTransition=function(){return Y.H.useTransition()},qt.version="19.1.1",qt}var vj;function E0(){return vj||(vj=1,ab.exports=bA()),ab.exports}var N=E0();const S0=GE(N);var ob={exports:{}},Im={},lb={exports:{}},cb={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nj;function wA(){return Nj||(Nj=1,(function(r){function e(U,se){var fe=U.length;U.push(se);e:for(;0<fe;){var ie=fe-1>>>1,_=U[ie];if(0<a(_,se))U[ie]=se,U[fe]=_,fe=ie;else break e}}function t(U){return U.length===0?null:U[0]}function s(U){if(U.length===0)return null;var se=U[0],fe=U.pop();if(fe!==se){U[0]=fe;e:for(var ie=0,_=U.length,E=_>>>1;ie<E;){var R=2*(ie+1)-1,V=U[R],ne=R+1,B=U[ne];if(0>a(V,fe))ne<_&&0>a(B,V)?(U[ie]=B,U[ne]=fe,ie=ne):(U[ie]=V,U[R]=fe,ie=R);else if(ne<_&&0>a(B,fe))U[ie]=B,U[ne]=fe,ie=ne;else break e}}return se}function a(U,se){var fe=U.sortIndex-se.sortIndex;return fe!==0?fe:U.id-se.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;r.unstable_now=function(){return l.now()}}else{var c=Date,u=c.now();r.unstable_now=function(){return c.now()-u}}var m=[],p=[],b=1,w=null,j=3,D=!1,O=!1,Q=!1,z=!1,I=typeof setTimeout=="function"?setTimeout:null,ee=typeof clearTimeout=="function"?clearTimeout:null,J=typeof setImmediate<"u"?setImmediate:null;function oe(U){for(var se=t(p);se!==null;){if(se.callback===null)s(p);else if(se.startTime<=U)s(p),se.sortIndex=se.expirationTime,e(m,se);else break;se=t(p)}}function Y(U){if(Q=!1,oe(U),!O)if(t(m)!==null)O=!0,be||(be=!0,te());else{var se=t(p);se!==null&&Be(Y,se.startTime-U)}}var be=!1,M=-1,H=5,k=-1;function $(){return z?!0:!(r.unstable_now()-k<H)}function X(){if(z=!1,be){var U=r.unstable_now();k=U;var se=!0;try{e:{O=!1,Q&&(Q=!1,ee(M),M=-1),D=!0;var fe=j;try{t:{for(oe(U),w=t(m);w!==null&&!(w.expirationTime>U&&$());){var ie=w.callback;if(typeof ie=="function"){w.callback=null,j=w.priorityLevel;var _=ie(w.expirationTime<=U);if(U=r.unstable_now(),typeof _=="function"){w.callback=_,oe(U),se=!0;break t}w===t(m)&&s(m),oe(U)}else s(m);w=t(m)}if(w!==null)se=!0;else{var E=t(p);E!==null&&Be(Y,E.startTime-U),se=!1}}break e}finally{w=null,j=fe,D=!1}se=void 0}}finally{se?te():be=!1}}}var te;if(typeof J=="function")te=function(){J(X)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,ce=F.port2;F.port1.onmessage=X,te=function(){ce.postMessage(null)}}else te=function(){I(X,0)};function Be(U,se){M=I(function(){U(r.unstable_now())},se)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(U){U.callback=null},r.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):H=0<U?Math.floor(1e3/U):5},r.unstable_getCurrentPriorityLevel=function(){return j},r.unstable_next=function(U){switch(j){case 1:case 2:case 3:var se=3;break;default:se=j}var fe=j;j=se;try{return U()}finally{j=fe}},r.unstable_requestPaint=function(){z=!0},r.unstable_runWithPriority=function(U,se){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var fe=j;j=U;try{return se()}finally{j=fe}},r.unstable_scheduleCallback=function(U,se,fe){var ie=r.unstable_now();switch(typeof fe=="object"&&fe!==null?(fe=fe.delay,fe=typeof fe=="number"&&0<fe?ie+fe:ie):fe=ie,U){case 1:var _=-1;break;case 2:_=250;break;case 5:_=1073741823;break;case 4:_=1e4;break;default:_=5e3}return _=fe+_,U={id:b++,callback:se,priorityLevel:U,startTime:fe,expirationTime:_,sortIndex:-1},fe>ie?(U.sortIndex=fe,e(p,U),t(m)===null&&U===t(p)&&(Q?(ee(M),M=-1):Q=!0,Be(Y,fe-ie))):(U.sortIndex=_,e(m,U),O||D||(O=!0,be||(be=!0,te()))),U},r.unstable_shouldYield=$,r.unstable_wrapCallback=function(U){var se=j;return function(){var fe=j;j=se;try{return U.apply(this,arguments)}finally{j=fe}}}})(cb)),cb}var jj;function vA(){return jj||(jj=1,lb.exports=wA()),lb.exports}var db={exports:{}},Dr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _j;function NA(){if(_j)return Dr;_j=1;var r=E0();function e(m){var p="https://react.dev/errors/"+m;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var b=2;b<arguments.length;b++)p+="&args[]="+encodeURIComponent(arguments[b])}return"Minified React error #"+m+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},a=Symbol.for("react.portal");function l(m,p,b){var w=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:w==null?null:""+w,children:m,containerInfo:p,implementation:b}}var c=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(m,p){if(m==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return Dr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Dr.createPortal=function(m,p){var b=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(e(299));return l(m,p,null,b)},Dr.flushSync=function(m){var p=c.T,b=s.p;try{if(c.T=null,s.p=2,m)return m()}finally{c.T=p,s.p=b,s.d.f()}},Dr.preconnect=function(m,p){typeof m=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,s.d.C(m,p))},Dr.prefetchDNS=function(m){typeof m=="string"&&s.d.D(m)},Dr.preinit=function(m,p){if(typeof m=="string"&&p&&typeof p.as=="string"){var b=p.as,w=u(b,p.crossOrigin),j=typeof p.integrity=="string"?p.integrity:void 0,D=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;b==="style"?s.d.S(m,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:w,integrity:j,fetchPriority:D}):b==="script"&&s.d.X(m,{crossOrigin:w,integrity:j,fetchPriority:D,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},Dr.preinitModule=function(m,p){if(typeof m=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var b=u(p.as,p.crossOrigin);s.d.M(m,{crossOrigin:b,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&s.d.M(m)},Dr.preload=function(m,p){if(typeof m=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var b=p.as,w=u(b,p.crossOrigin);s.d.L(m,b,{crossOrigin:w,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},Dr.preloadModule=function(m,p){if(typeof m=="string")if(p){var b=u(p.as,p.crossOrigin);s.d.m(m,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:b,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else s.d.m(m)},Dr.requestFormReset=function(m){s.d.r(m)},Dr.unstable_batchedUpdates=function(m,p){return m(p)},Dr.useFormState=function(m,p,b){return c.H.useFormState(m,p,b)},Dr.useFormStatus=function(){return c.H.useHostTransitionStatus()},Dr.version="19.1.1",Dr}var Ej;function jA(){if(Ej)return db.exports;Ej=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),db.exports=NA(),db.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sj;function _A(){if(Sj)return Im;Sj=1;var r=vA(),e=E0(),t=jA();function s(i){var o="https://react.dev/errors/"+i;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)o+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+i+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function l(i){var o=i,d=i;if(i.alternate)for(;o.return;)o=o.return;else{i=o;do o=i,(o.flags&4098)!==0&&(d=o.return),i=o.return;while(i)}return o.tag===3?d:null}function c(i){if(i.tag===13){var o=i.memoizedState;if(o===null&&(i=i.alternate,i!==null&&(o=i.memoizedState)),o!==null)return o.dehydrated}return null}function u(i){if(l(i)!==i)throw Error(s(188))}function m(i){var o=i.alternate;if(!o){if(o=l(i),o===null)throw Error(s(188));return o!==i?null:i}for(var d=i,h=o;;){var g=d.return;if(g===null)break;var y=g.alternate;if(y===null){if(h=g.return,h!==null){d=h;continue}break}if(g.child===y.child){for(y=g.child;y;){if(y===d)return u(g),i;if(y===h)return u(g),o;y=y.sibling}throw Error(s(188))}if(d.return!==h.return)d=g,h=y;else{for(var P=!1,G=g.child;G;){if(G===d){P=!0,d=g,h=y;break}if(G===h){P=!0,h=g,d=y;break}G=G.sibling}if(!P){for(G=y.child;G;){if(G===d){P=!0,d=y,h=g;break}if(G===h){P=!0,h=y,d=g;break}G=G.sibling}if(!P)throw Error(s(189))}}if(d.alternate!==h)throw Error(s(190))}if(d.tag!==3)throw Error(s(188));return d.stateNode.current===d?i:o}function p(i){var o=i.tag;if(o===5||o===26||o===27||o===6)return i;for(i=i.child;i!==null;){if(o=p(i),o!==null)return o;i=i.sibling}return null}var b=Object.assign,w=Symbol.for("react.element"),j=Symbol.for("react.transitional.element"),D=Symbol.for("react.portal"),O=Symbol.for("react.fragment"),Q=Symbol.for("react.strict_mode"),z=Symbol.for("react.profiler"),I=Symbol.for("react.provider"),ee=Symbol.for("react.consumer"),J=Symbol.for("react.context"),oe=Symbol.for("react.forward_ref"),Y=Symbol.for("react.suspense"),be=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),H=Symbol.for("react.lazy"),k=Symbol.for("react.activity"),$=Symbol.for("react.memo_cache_sentinel"),X=Symbol.iterator;function te(i){return i===null||typeof i!="object"?null:(i=X&&i[X]||i["@@iterator"],typeof i=="function"?i:null)}var F=Symbol.for("react.client.reference");function ce(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===F?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case O:return"Fragment";case z:return"Profiler";case Q:return"StrictMode";case Y:return"Suspense";case be:return"SuspenseList";case k:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case D:return"Portal";case J:return(i.displayName||"Context")+".Provider";case ee:return(i._context.displayName||"Context")+".Consumer";case oe:var o=i.render;return i=i.displayName,i||(i=o.displayName||o.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case M:return o=i.displayName||null,o!==null?o:ce(i.type)||"Memo";case H:o=i._payload,i=i._init;try{return ce(i(o))}catch{}}return null}var Be=Array.isArray,U=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,fe={pending:!1,data:null,method:null,action:null},ie=[],_=-1;function E(i){return{current:i}}function R(i){0>_||(i.current=ie[_],ie[_]=null,_--)}function V(i,o){_++,ie[_]=i.current,i.current=o}var ne=E(null),B=E(null),q=E(null),me=E(null);function C(i,o){switch(V(q,o),V(B,i),V(ne,null),o.nodeType){case 9:case 11:i=(i=o.documentElement)&&(i=i.namespaceURI)?GN(i):0;break;default:if(i=o.tagName,o=o.namespaceURI)o=GN(o),i=QN(o,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}R(ne),V(ne,i)}function Z(){R(ne),R(B),R(q)}function je(i){i.memoizedState!==null&&V(me,i);var o=ne.current,d=QN(o,i.type);o!==d&&(V(B,i),V(ne,d))}function Ge(i){B.current===i&&(R(ne),R(B)),me.current===i&&(R(me),vm._currentValue=fe)}var Ke=Object.prototype.hasOwnProperty,ft=r.unstable_scheduleCallback,Ot=r.unstable_cancelCallback,Ee=r.unstable_shouldYield,it=r.unstable_requestPaint,Nt=r.unstable_now,hn=r.unstable_getCurrentPriorityLevel,xn=r.unstable_ImmediatePriority,is=r.unstable_UserBlockingPriority,Un=r.unstable_NormalPriority,Xt=r.unstable_LowPriority,yn=r.unstable_IdlePriority,Zn=r.log,es=r.unstable_setDisableYieldValue,an=null,Bt=null;function Nn(i){if(typeof Zn=="function"&&es(i),Bt&&typeof Bt.setStrictMode=="function")try{Bt.setStrictMode(an,i)}catch{}}var T=Math.clz32?Math.clz32:de,re=Math.log,he=Math.LN2;function de(i){return i>>>=0,i===0?32:31-(re(i)/he|0)|0}var xe=256,Ue=4194304;function bt(i){var o=i&42;if(o!==0)return o;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function pt(i,o,d){var h=i.pendingLanes;if(h===0)return 0;var g=0,y=i.suspendedLanes,P=i.pingedLanes;i=i.warmLanes;var G=h&134217727;return G!==0?(h=G&~y,h!==0?g=bt(h):(P&=G,P!==0?g=bt(P):d||(d=G&~i,d!==0&&(g=bt(d))))):(G=h&~y,G!==0?g=bt(G):P!==0?g=bt(P):d||(d=h&~i,d!==0&&(g=bt(d)))),g===0?0:o!==0&&o!==g&&(o&y)===0&&(y=g&-g,d=o&-o,y>=d||y===32&&(d&4194048)!==0)?o:g}function Vs(i,o){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&o)===0}function Ne(i,o){switch(i){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ue(){var i=xe;return xe<<=1,(xe&4194048)===0&&(xe=256),i}function le(){var i=Ue;return Ue<<=1,(Ue&62914560)===0&&(Ue=4194304),i}function Ie(i){for(var o=[],d=0;31>d;d++)o.push(i);return o}function Te(i,o){i.pendingLanes|=o,o!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function We(i,o,d,h,g,y){var P=i.pendingLanes;i.pendingLanes=d,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=d,i.entangledLanes&=d,i.errorRecoveryDisabledLanes&=d,i.shellSuspendCounter=0;var G=i.entanglements,ae=i.expirationTimes,Ae=i.hiddenUpdates;for(d=P&~d;0<d;){var $e=31-T(d),Qe=1<<$e;G[$e]=0,ae[$e]=-1;var Re=Ae[$e];if(Re!==null)for(Ae[$e]=null,$e=0;$e<Re.length;$e++){var Pe=Re[$e];Pe!==null&&(Pe.lane&=-536870913)}d&=~Qe}h!==0&&ye(i,h,0),y!==0&&g===0&&i.tag!==0&&(i.suspendedLanes|=y&~(P&~o))}function ye(i,o,d){i.pendingLanes|=o,i.suspendedLanes&=~o;var h=31-T(o);i.entangledLanes|=o,i.entanglements[h]=i.entanglements[h]|1073741824|d&4194090}function ze(i,o){var d=i.entangledLanes|=o;for(i=i.entanglements;d;){var h=31-T(d),g=1<<h;g&o|i[h]&o&&(i[h]|=o),d&=~g}}function Oe(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function nt(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function Ze(){var i=se.p;return i!==0?i:(i=window.event,i===void 0?32:hj(i.type))}function Je(i,o){var d=se.p;try{return se.p=i,o()}finally{se.p=d}}var Ve=Math.random().toString(36).slice(2),ke="__reactFiber$"+Ve,et="__reactProps$"+Ve,bn="__reactContainer$"+Ve,fs="__reactEvents$"+Ve,dr="__reactListeners$"+Ve,vs="__reactHandles$"+Ve,Hr="__reactResources$"+Ve,Ai="__reactMarker$"+Ve;function Na(i){delete i[ke],delete i[et],delete i[fs],delete i[dr],delete i[vs]}function li(i){var o=i[ke];if(o)return o;for(var d=i.parentNode;d;){if(o=d[bn]||d[ke]){if(d=o.alternate,o.child!==null||d!==null&&d.child!==null)for(i=XN(i);i!==null;){if(d=i[ke])return d;i=XN(i)}return o}i=d,d=i.parentNode}return null}function Di(i){if(i=i[ke]||i[bn]){var o=i.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return i}return null}function Ri(i){var o=i.tag;if(o===5||o===26||o===27||o===6)return i.stateNode;throw Error(s(33))}function ps(i){var o=i[Hr];return o||(o=i[Hr]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function Qt(i){i[Ai]=!0}var zs=new Set,Rs={};function Vn(i,o){Gr(i,o),Gr(i+"Capture",o)}function Gr(i,o){for(Rs[i]=o,i=0;i<o.length;i++)zs.add(o[i])}var ta=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Pi={},Qr={};function Ec(i){return Ke.call(Qr,i)?!0:Ke.call(Pi,i)?!1:ta.test(i)?Qr[i]=!0:(Pi[i]=!0,!1)}function ki(i,o,d){if(Ec(o))if(d===null)i.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":i.removeAttribute(o);return;case"boolean":var h=o.toLowerCase().slice(0,5);if(h!=="data-"&&h!=="aria-"){i.removeAttribute(o);return}}i.setAttribute(o,""+d)}}function ur(i,o,d){if(d===null)i.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(o);return}i.setAttribute(o,""+d)}}function Ps(i,o,d,h){if(h===null)i.removeAttribute(d);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(d);return}i.setAttributeNS(o,d,""+h)}}var na,ul;function Oi(i){if(na===void 0)try{throw Error()}catch(d){var o=d.stack.trim().match(/\n( *(at )?)/);na=o&&o[1]||"",ul=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+na+i+ul}var lo=!1;function co(i,o){if(!i||lo)return"";lo=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var h={DetermineComponentFrameRoot:function(){try{if(o){var Qe=function(){throw Error()};if(Object.defineProperty(Qe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Qe,[])}catch(Pe){var Re=Pe}Reflect.construct(i,[],Qe)}else{try{Qe.call()}catch(Pe){Re=Pe}i.call(Qe.prototype)}}else{try{throw Error()}catch(Pe){Re=Pe}(Qe=i())&&typeof Qe.catch=="function"&&Qe.catch(function(){})}}catch(Pe){if(Pe&&Re&&typeof Pe.stack=="string")return[Pe.stack,Re.stack]}return[null,null]}};h.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(h.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(h.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=h.DetermineComponentFrameRoot(),P=y[0],G=y[1];if(P&&G){var ae=P.split(`
`),Ae=G.split(`
`);for(g=h=0;h<ae.length&&!ae[h].includes("DetermineComponentFrameRoot");)h++;for(;g<Ae.length&&!Ae[g].includes("DetermineComponentFrameRoot");)g++;if(h===ae.length||g===Ae.length)for(h=ae.length-1,g=Ae.length-1;1<=h&&0<=g&&ae[h]!==Ae[g];)g--;for(;1<=h&&0<=g;h--,g--)if(ae[h]!==Ae[g]){if(h!==1||g!==1)do if(h--,g--,0>g||ae[h]!==Ae[g]){var $e=`
`+ae[h].replace(" at new "," at ");return i.displayName&&$e.includes("<anonymous>")&&($e=$e.replace("<anonymous>",i.displayName)),$e}while(1<=h&&0<=g);break}}}finally{lo=!1,Error.prepareStackTrace=d}return(d=i?i.displayName||i.name:"")?Oi(d):""}function hl(i){switch(i.tag){case 26:case 27:case 5:return Oi(i.type);case 16:return Oi("Lazy");case 13:return Oi("Suspense");case 19:return Oi("SuspenseList");case 0:case 15:return co(i.type,!1);case 11:return co(i.type.render,!1);case 1:return co(i.type,!0);case 31:return Oi("Activity");default:return""}}function uo(i){try{var o="";do o+=hl(i),i=i.return;while(i);return o}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}function er(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function ml(i){var o=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Dd(i){var o=ml(i)?"checked":"value",d=Object.getOwnPropertyDescriptor(i.constructor.prototype,o),h=""+i[o];if(!i.hasOwnProperty(o)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var g=d.get,y=d.set;return Object.defineProperty(i,o,{configurable:!0,get:function(){return g.call(this)},set:function(P){h=""+P,y.call(this,P)}}),Object.defineProperty(i,o,{enumerable:d.enumerable}),{getValue:function(){return h},setValue:function(P){h=""+P},stopTracking:function(){i._valueTracker=null,delete i[o]}}}}function ho(i){i._valueTracker||(i._valueTracker=Dd(i))}function fl(i){if(!i)return!1;var o=i._valueTracker;if(!o)return!0;var d=o.getValue(),h="";return i&&(h=ml(i)?i.checked?"true":"false":i.value),i=h,i!==d?(o.setValue(i),!0):!1}function tr(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var hr=/[\n"\\]/g;function kn(i){return i.replace(hr,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Bn(i,o,d,h,g,y,P,G){i.name="",P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"?i.type=P:i.removeAttribute("type"),o!=null?P==="number"?(o===0&&i.value===""||i.value!=o)&&(i.value=""+er(o)):i.value!==""+er(o)&&(i.value=""+er(o)):P!=="submit"&&P!=="reset"||i.removeAttribute("value"),o!=null?Mi(i,P,er(o)):d!=null?Mi(i,P,er(d)):h!=null&&i.removeAttribute("value"),g==null&&y!=null&&(i.defaultChecked=!!y),g!=null&&(i.checked=g&&typeof g!="function"&&typeof g!="symbol"),G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"?i.name=""+er(G):i.removeAttribute("name")}function sa(i,o,d,h,g,y,P,G){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(i.type=y),o!=null||d!=null){if(!(y!=="submit"&&y!=="reset"||o!=null))return;d=d!=null?""+er(d):"",o=o!=null?""+er(o):d,G||o===i.value||(i.value=o),i.defaultValue=o}h=h??g,h=typeof h!="function"&&typeof h!="symbol"&&!!h,i.checked=G?i.checked:!!h,i.defaultChecked=!!h,P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"&&(i.name=P)}function Mi(i,o,d){o==="number"&&tr(i.ownerDocument)===i||i.defaultValue===""+d||(i.defaultValue=""+d)}function ks(i,o,d,h){if(i=i.options,o){o={};for(var g=0;g<d.length;g++)o["$"+d[g]]=!0;for(d=0;d<i.length;d++)g=o.hasOwnProperty("$"+i[d].value),i[d].selected!==g&&(i[d].selected=g),g&&h&&(i[d].defaultSelected=!0)}else{for(d=""+er(d),o=null,g=0;g<i.length;g++){if(i[g].value===d){i[g].selected=!0,h&&(i[g].defaultSelected=!0);return}o!==null||i[g].disabled||(o=i[g])}o!==null&&(o.selected=!0)}}function Jt(i,o,d){if(o!=null&&(o=""+er(o),o!==i.value&&(i.value=o),d==null)){i.defaultValue!==o&&(i.defaultValue=o);return}i.defaultValue=d!=null?""+er(d):""}function Li(i,o,d,h){if(o==null){if(h!=null){if(d!=null)throw Error(s(92));if(Be(h)){if(1<h.length)throw Error(s(93));h=h[0]}d=h}d==null&&(d=""),o=d}d=er(o),i.defaultValue=d,h=i.textContent,h===d&&h!==""&&h!==null&&(i.value=h)}function $s(i,o){if(o){var d=i.firstChild;if(d&&d===i.lastChild&&d.nodeType===3){d.nodeValue=o;return}}i.textContent=o}var ra=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Sc(i,o,d){var h=o.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?h?i.setProperty(o,""):o==="float"?i.cssFloat="":i[o]="":h?i.setProperty(o,d):typeof d!="number"||d===0||ra.has(o)?o==="float"?i.cssFloat=d:i[o]=(""+d).trim():i[o]=d+"px"}function Fi(i,o,d){if(o!=null&&typeof o!="object")throw Error(s(62));if(i=i.style,d!=null){for(var h in d)!d.hasOwnProperty(h)||o!=null&&o.hasOwnProperty(h)||(h.indexOf("--")===0?i.setProperty(h,""):h==="float"?i.cssFloat="":i[h]="");for(var g in o)h=o[g],o.hasOwnProperty(g)&&d[g]!==h&&Sc(i,g,h)}else for(var y in o)o.hasOwnProperty(y)&&Sc(i,y,o[y])}function mo(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Rd=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ci=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function pl(i){return ci.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}var nr=null;function mr(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Ui=null,Lr=null;function fo(i){var o=Di(i);if(o&&(i=o.stateNode)){var d=i[et]||null;e:switch(i=o.stateNode,o.type){case"input":if(Bn(i,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),o=d.name,d.type==="radio"&&o!=null){for(d=i;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+kn(""+o)+'"][type="radio"]'),o=0;o<d.length;o++){var h=d[o];if(h!==i&&h.form===i.form){var g=h[et]||null;if(!g)throw Error(s(90));Bn(h,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(o=0;o<d.length;o++)h=d[o],h.form===i.form&&fl(h)}break e;case"textarea":Jt(i,d.value,d.defaultValue);break e;case"select":o=d.value,o!=null&&ks(i,!!d.multiple,o,!1)}}}var Er=!1;function Ic(i,o,d){if(Er)return i(o,d);Er=!0;try{var h=i(o);return h}finally{if(Er=!1,(Ui!==null||Lr!==null)&&(Pp(),Ui&&(o=Ui,i=Lr,Lr=Ui=null,fo(o),i)))for(o=0;o<i.length;o++)fo(i[o])}}function ja(i,o){var d=i.stateNode;if(d===null)return null;var h=d[et]||null;if(h===null)return null;d=h[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(i=i.type,h=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!h;break e;default:i=!1}if(i)return null;if(d&&typeof d!="function")throw Error(s(231,o,typeof d));return d}var Wr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Bs=!1;if(Wr)try{var po={};Object.defineProperty(po,"passive",{get:function(){Bs=!0}}),window.addEventListener("test",po,po),window.removeEventListener("test",po,po)}catch{Bs=!1}var di=null,Vi=null,Kr=null;function go(){if(Kr)return Kr;var i,o=Vi,d=o.length,h,g="value"in di?di.value:di.textContent,y=g.length;for(i=0;i<d&&o[i]===g[i];i++);var P=d-i;for(h=1;h<=P&&o[d-h]===g[y-h];h++);return Kr=g.slice(i,1<h?1-h:void 0)}function zi(i){var o=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&o===13&&(i=13)):i=o,i===10&&(i=13),32<=i||i===13?i:0}function Fr(){return!0}function Tc(){return!1}function Ns(i){function o(d,h,g,y,P){this._reactName=d,this._targetInst=g,this.type=h,this.nativeEvent=y,this.target=P,this.currentTarget=null;for(var G in i)i.hasOwnProperty(G)&&(d=i[G],this[G]=d?d(y):y[G]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Fr:Tc,this.isPropagationStopped=Tc,this}return b(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Fr)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Fr)},persist:function(){},isPersistent:Fr}),o}var ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_a=Ns(ln),ia=b({},ln,{view:0,detail:0}),Cc=Ns(ia),$i,Ea,ui,Sa=b({},ia,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:vo,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==ui&&(ui&&i.type==="mousemove"?($i=i.screenX-ui.screenX,Ea=i.screenY-ui.screenY):Ea=$i=0,ui=i),$i)},movementY:function(i){return"movementY"in i?i.movementY:Ea}}),qs=Ns(Sa),Pd=b({},Sa,{dataTransfer:0}),kd=Ns(Pd),Ia=b({},ia,{relatedTarget:0}),xo=Ns(Ia),gl=b({},ln,{animationName:0,elapsedTime:0,pseudoElement:0}),yo=Ns(gl),xl=b({},ln,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),bo=Ns(xl),bh=b({},ln,{data:0}),Ac=Ns(bh),Ta={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Dc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wo={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Rc(i){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(i):(i=wo[i])?!!o[i]:!1}function vo(){return Rc}var yl=b({},ia,{key:function(i){if(i.key){var o=Ta[i.key]||i.key;if(o!=="Unidentified")return o}return i.type==="keypress"?(i=zi(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Dc[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:vo,charCode:function(i){return i.type==="keypress"?zi(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?zi(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),No=Ns(yl),Pc=b({},Sa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hi=Ns(Pc),mi=b({},ia,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:vo}),Od=Ns(mi),kc=b({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0}),Md=Ns(kc),Ld=b({},Sa,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),bl=Ns(Ld),fr=b({},ln,{newState:0,oldState:0}),Oc=Ns(fr),Mc=[9,13,27,32],Bi=Wr&&"CompositionEvent"in window,f=null;Wr&&"documentMode"in document&&(f=document.documentMode);var v=Wr&&"TextEvent"in window&&!f,A=Wr&&(!Bi||f&&8<f&&11>=f),K=" ",_e=!1;function Me(i,o){switch(i){case"keyup":return Mc.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function st(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Zt=!1;function js(i,o){switch(i){case"compositionend":return st(o);case"keypress":return o.which!==32?null:(_e=!0,K);case"textInput":return i=o.data,i===K&&_e?null:i;default:return null}}function en(i,o){if(Zt)return i==="compositionend"||!Bi&&Me(i,o)?(i=go(),Kr=Vi=di=null,Zt=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return A&&o.locale!=="ko"?null:o.data;default:return null}}var Os={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function _s(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o==="input"?!!Os[i.type]:o==="textarea"}function Es(i,o,d,h){Ui?Lr?Lr.push(h):Lr=[h]:Ui=h,o=Up(o,"onChange"),0<o.length&&(d=new _a("onChange","change",null,d,h),i.push({event:d,listeners:o}))}var Ms=null,fi=null;function wl(i){zN(i,0)}function Fd(i){var o=Ri(i);if(fl(o))return i}function Gf(i,o){if(i==="change")return o}var wh=!1;if(Wr){var vl;if(Wr){var vh="oninput"in document;if(!vh){var Qf=document.createElement("div");Qf.setAttribute("oninput","return;"),vh=typeof Qf.oninput=="function"}vl=vh}else vl=!1;wh=vl&&(!document.documentMode||9<document.documentMode)}function Nh(){Ms&&(Ms.detachEvent("onpropertychange",Wf),fi=Ms=null)}function Wf(i){if(i.propertyName==="value"&&Fd(fi)){var o=[];Es(o,fi,i,mr(i)),Ic(wl,o)}}function Wx(i,o,d){i==="focusin"?(Nh(),Ms=o,fi=d,Ms.attachEvent("onpropertychange",Wf)):i==="focusout"&&Nh()}function Kf(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Fd(fi)}function Yf(i,o){if(i==="click")return Fd(o)}function Xf(i,o){if(i==="input"||i==="change")return Fd(o)}function Ud(i,o){return i===o&&(i!==0||1/i===1/o)||i!==i&&o!==o}var Sr=typeof Object.is=="function"?Object.is:Ud;function jo(i,o){if(Sr(i,o))return!0;if(typeof i!="object"||i===null||typeof o!="object"||o===null)return!1;var d=Object.keys(i),h=Object.keys(o);if(d.length!==h.length)return!1;for(h=0;h<d.length;h++){var g=d[h];if(!Ke.call(o,g)||!Sr(i[g],o[g]))return!1}return!0}function Ur(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Jf(i,o){var d=Ur(i);i=0;for(var h;d;){if(d.nodeType===3){if(h=i+d.textContent.length,i<=o&&h>=o)return{node:d,offset:o-i};i=h}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Ur(d)}}function Zf(i,o){return i&&o?i===o?!0:i&&i.nodeType===3?!1:o&&o.nodeType===3?Zf(i,o.parentNode):"contains"in i?i.contains(o):i.compareDocumentPosition?!!(i.compareDocumentPosition(o)&16):!1:!1}function jh(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var o=tr(i.document);o instanceof i.HTMLIFrameElement;){try{var d=typeof o.contentWindow.location.href=="string"}catch{d=!1}if(d)i=o.contentWindow;else break;o=tr(i.document)}return o}function Vd(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o&&(o==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||o==="textarea"||i.contentEditable==="true")}var Kx=Wr&&"documentMode"in document&&11>=document.documentMode,Nl=null,_h=null,Lc=null,Eh=!1;function ep(i,o,d){var h=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Eh||Nl==null||Nl!==tr(h)||(h=Nl,"selectionStart"in h&&Vd(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Lc&&jo(Lc,h)||(Lc=h,h=Up(_h,"onSelect"),0<h.length&&(o=new _a("onSelect","select",null,o,d),i.push({event:o,listeners:h}),o.target=Nl)))}function Ca(i,o){var d={};return d[i.toLowerCase()]=o.toLowerCase(),d["Webkit"+i]="webkit"+o,d["Moz"+i]="moz"+o,d}var _o={animationend:Ca("Animation","AnimationEnd"),animationiteration:Ca("Animation","AnimationIteration"),animationstart:Ca("Animation","AnimationStart"),transitionrun:Ca("Transition","TransitionRun"),transitionstart:Ca("Transition","TransitionStart"),transitioncancel:Ca("Transition","TransitionCancel"),transitionend:Ca("Transition","TransitionEnd")},Fc={},tp={};Wr&&(tp=document.createElement("div").style,"AnimationEvent"in window||(delete _o.animationend.animation,delete _o.animationiteration.animation,delete _o.animationstart.animation),"TransitionEvent"in window||delete _o.transitionend.transition);function Eo(i){if(Fc[i])return Fc[i];if(!_o[i])return i;var o=_o[i],d;for(d in o)if(o.hasOwnProperty(d)&&d in tp)return Fc[i]=o[d];return i}var Aa=Eo("animationend"),qi=Eo("animationiteration"),Sh=Eo("animationstart"),Yx=Eo("transitionrun"),np=Eo("transitionstart"),sp=Eo("transitioncancel"),Ih=Eo("transitionend"),Th=new Map,Ch="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ch.push("scrollEnd");function pi(i,o){Th.set(i,o),Vn(o,[i])}var rp=new WeakMap;function Vr(i,o){if(typeof i=="object"&&i!==null){var d=rp.get(i);return d!==void 0?d:(o={value:i,source:o,stack:uo(o)},rp.set(i,o),o)}return{value:i,source:o,stack:uo(o)}}var zr=[],jl=0,Ah=0;function zd(){for(var i=jl,o=Ah=jl=0;o<i;){var d=zr[o];zr[o++]=null;var h=zr[o];zr[o++]=null;var g=zr[o];zr[o++]=null;var y=zr[o];if(zr[o++]=null,h!==null&&g!==null){var P=h.pending;P===null?g.next=g:(g.next=P.next,P.next=g),h.pending=g}y!==0&&Rh(d,g,y)}}function $d(i,o,d,h){zr[jl++]=i,zr[jl++]=o,zr[jl++]=d,zr[jl++]=h,Ah|=h,i.lanes|=h,i=i.alternate,i!==null&&(i.lanes|=h)}function Dh(i,o,d,h){return $d(i,o,d,h),Bd(i)}function Ir(i,o){return $d(i,null,null,o),Bd(i)}function Rh(i,o,d){i.lanes|=d;var h=i.alternate;h!==null&&(h.lanes|=d);for(var g=!1,y=i.return;y!==null;)y.childLanes|=d,h=y.alternate,h!==null&&(h.childLanes|=d),y.tag===22&&(i=y.stateNode,i===null||i._visibility&1||(g=!0)),i=y,y=y.return;return i.tag===3?(y=i.stateNode,g&&o!==null&&(g=31-T(d),i=y.hiddenUpdates,h=i[g],h===null?i[g]=[o]:h.push(o),o.lane=d|536870912),y):null}function Bd(i){if(50<mm)throw mm=0,Cy=null,Error(s(185));for(var o=i.return;o!==null;)i=o,o=i.return;return i.tag===3?i.stateNode:null}var _l={};function Xx(i,o,d,h){this.tag=i,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function $r(i,o,d,h){return new Xx(i,o,d,h)}function Ph(i){return i=i.prototype,!(!i||!i.isReactComponent)}function aa(i,o){var d=i.alternate;return d===null?(d=$r(i.tag,o,i.key,i.mode),d.elementType=i.elementType,d.type=i.type,d.stateNode=i.stateNode,d.alternate=i,i.alternate=d):(d.pendingProps=o,d.type=i.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=i.flags&65011712,d.childLanes=i.childLanes,d.lanes=i.lanes,d.child=i.child,d.memoizedProps=i.memoizedProps,d.memoizedState=i.memoizedState,d.updateQueue=i.updateQueue,o=i.dependencies,d.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},d.sibling=i.sibling,d.index=i.index,d.ref=i.ref,d.refCleanup=i.refCleanup,d}function ip(i,o){i.flags&=65011714;var d=i.alternate;return d===null?(i.childLanes=0,i.lanes=o,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=d.childLanes,i.lanes=d.lanes,i.child=d.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=d.memoizedProps,i.memoizedState=d.memoizedState,i.updateQueue=d.updateQueue,i.type=d.type,o=d.dependencies,i.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),i}function qd(i,o,d,h,g,y){var P=0;if(h=i,typeof i=="function")Ph(i)&&(P=1);else if(typeof i=="string")P=rA(i,d,ne.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case k:return i=$r(31,d,o,g),i.elementType=k,i.lanes=y,i;case O:return oa(d.children,g,y,o);case Q:P=8,g|=24;break;case z:return i=$r(12,d,o,g|2),i.elementType=z,i.lanes=y,i;case Y:return i=$r(13,d,o,g),i.elementType=Y,i.lanes=y,i;case be:return i=$r(19,d,o,g),i.elementType=be,i.lanes=y,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case I:case J:P=10;break e;case ee:P=9;break e;case oe:P=11;break e;case M:P=14;break e;case H:P=16,h=null;break e}P=29,d=Error(s(130,i===null?"null":typeof i,"")),h=null}return o=$r(P,d,o,g),o.elementType=i,o.type=h,o.lanes=y,o}function oa(i,o,d,h){return i=$r(7,i,h,o),i.lanes=d,i}function El(i,o,d){return i=$r(6,i,null,o),i.lanes=d,i}function kh(i,o,d){return o=$r(4,i.children!==null?i.children:[],i.key,o),o.lanes=d,o.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},o}var So=[],Io=0,Da=null,Sl=0,Tr=[],Yr=0,To=null,la=1,pr="";function Co(i,o){So[Io++]=Sl,So[Io++]=Da,Da=i,Sl=o}function ap(i,o,d){Tr[Yr++]=la,Tr[Yr++]=pr,Tr[Yr++]=To,To=i;var h=la;i=pr;var g=32-T(h)-1;h&=~(1<<g),d+=1;var y=32-T(o)+g;if(30<y){var P=g-g%5;y=(h&(1<<P)-1).toString(32),h>>=P,g-=P,la=1<<32-T(o)+g|d<<g|h,pr=y+i}else la=1<<y|d<<g|h,pr=i}function Oh(i){i.return!==null&&(Co(i,1),ap(i,1,0))}function Mh(i){for(;i===Da;)Da=So[--Io],So[Io]=null,Sl=So[--Io],So[Io]=null;for(;i===To;)To=Tr[--Yr],Tr[Yr]=null,pr=Tr[--Yr],Tr[Yr]=null,la=Tr[--Yr],Tr[Yr]=null}var Ls=null,qn=null,mn=!1,Ra=null,Hi=!1,Pa=Error(s(519));function ca(i){var o=Error(s(418,""));throw gi(Vr(o,i)),Pa}function Lh(i){var o=i.stateNode,d=i.type,h=i.memoizedProps;switch(o[ke]=i,o[et]=h,d){case"dialog":Kt("cancel",o),Kt("close",o);break;case"iframe":case"object":case"embed":Kt("load",o);break;case"video":case"audio":for(d=0;d<pm.length;d++)Kt(pm[d],o);break;case"source":Kt("error",o);break;case"img":case"image":case"link":Kt("error",o),Kt("load",o);break;case"details":Kt("toggle",o);break;case"input":Kt("invalid",o),sa(o,h.value,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name,!0),ho(o);break;case"select":Kt("invalid",o);break;case"textarea":Kt("invalid",o),Li(o,h.value,h.defaultValue,h.children),ho(o)}d=h.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||o.textContent===""+d||h.suppressHydrationWarning===!0||HN(o.textContent,d)?(h.popover!=null&&(Kt("beforetoggle",o),Kt("toggle",o)),h.onScroll!=null&&Kt("scroll",o),h.onScrollEnd!=null&&Kt("scrollend",o),h.onClick!=null&&(o.onclick=Vp),o=!0):o=!1,o||ca(i)}function op(i){for(Ls=i.return;Ls;)switch(Ls.tag){case 5:case 13:Hi=!1;return;case 27:case 3:Hi=!0;return;default:Ls=Ls.return}}function Uc(i){if(i!==Ls)return!1;if(!mn)return op(i),mn=!0,!1;var o=i.tag,d;if((d=o!==3&&o!==27)&&((d=o===5)&&(d=i.type,d=!(d!=="form"&&d!=="button")||Hy(i.type,i.memoizedProps)),d=!d),d&&qn&&ca(i),op(i),o===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(s(317));e:{for(i=i.nextSibling,o=0;i;){if(i.nodeType===8)if(d=i.data,d==="/$"){if(o===0){qn=ma(i.nextSibling);break e}o--}else d!=="$"&&d!=="$!"&&d!=="$?"||o++;i=i.nextSibling}qn=null}}else o===27?(o=qn,zl(i.type)?(i=Ky,Ky=null,qn=i):qn=o):qn=Ls?ma(i.stateNode.nextSibling):null;return!0}function Vc(){qn=Ls=null,mn=!1}function Il(){var i=Ra;return i!==null&&(ni===null?ni=i:ni.push.apply(ni,i),Ra=null),i}function gi(i){Ra===null?Ra=[i]:Ra.push(i)}var Fh=E(null),Ao=null,da=null;function ka(i,o,d){V(Fh,o._currentValue),o._currentValue=d}function ua(i){i._currentValue=Fh.current,R(Fh)}function Uh(i,o,d){for(;i!==null;){var h=i.alternate;if((i.childLanes&o)!==o?(i.childLanes|=o,h!==null&&(h.childLanes|=o)):h!==null&&(h.childLanes&o)!==o&&(h.childLanes|=o),i===d)break;i=i.return}}function Vh(i,o,d,h){var g=i.child;for(g!==null&&(g.return=i);g!==null;){var y=g.dependencies;if(y!==null){var P=g.child;y=y.firstContext;e:for(;y!==null;){var G=y;y=g;for(var ae=0;ae<o.length;ae++)if(G.context===o[ae]){y.lanes|=d,G=y.alternate,G!==null&&(G.lanes|=d),Uh(y.return,d,i),h||(P=null);break e}y=G.next}}else if(g.tag===18){if(P=g.return,P===null)throw Error(s(341));P.lanes|=d,y=P.alternate,y!==null&&(y.lanes|=d),Uh(P,d,i),P=null}else P=g.child;if(P!==null)P.return=g;else for(P=g;P!==null;){if(P===i){P=null;break}if(g=P.sibling,g!==null){g.return=P.return,P=g;break}P=P.return}g=P}}function zc(i,o,d,h){i=null;for(var g=o,y=!1;g!==null;){if(!y){if((g.flags&524288)!==0)y=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var P=g.alternate;if(P===null)throw Error(s(387));if(P=P.memoizedProps,P!==null){var G=g.type;Sr(g.pendingProps.value,P.value)||(i!==null?i.push(G):i=[G])}}else if(g===me.current){if(P=g.alternate,P===null)throw Error(s(387));P.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(i!==null?i.push(vm):i=[vm])}g=g.return}i!==null&&Vh(o,i,d,h),o.flags|=262144}function $c(i){for(i=i.firstContext;i!==null;){if(!Sr(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function Do(i){Ao=i,da=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function Hs(i){return zh(Ao,i)}function Tl(i,o){return Ao===null&&Do(i),zh(i,o)}function zh(i,o){var d=o._currentValue;if(o={context:o,memoizedValue:d,next:null},da===null){if(i===null)throw Error(s(308));da=o,i.dependencies={lanes:0,firstContext:o},i.flags|=524288}else da=da.next=o;return d}var Ro=typeof AbortController<"u"?AbortController:function(){var i=[],o=this.signal={aborted:!1,addEventListener:function(d,h){i.push(h)}};this.abort=function(){o.aborted=!0,i.forEach(function(d){return d()})}},lp=r.unstable_scheduleCallback,$h=r.unstable_NormalPriority,gs={$$typeof:J,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Bc(){return{controller:new Ro,data:new Map,refCount:0}}function Cl(i){i.refCount--,i.refCount===0&&lp($h,function(){i.controller.abort()})}var Po=null,Bh=0,Xr=0,Br=null;function Jx(i,o){if(Po===null){var d=Po=[];Bh=0,Xr=My(),Br={status:"pending",value:void 0,then:function(h){d.push(h)}}}return Bh++,o.then(cp,cp),o}function cp(){if(--Bh===0&&Po!==null){Br!==null&&(Br.status="fulfilled");var i=Po;Po=null,Xr=0,Br=null;for(var o=0;o<i.length;o++)(0,i[o])()}}function Zx(i,o){var d=[],h={status:"pending",value:null,reason:null,then:function(g){d.push(g)}};return i.then(function(){h.status="fulfilled",h.value=o;for(var g=0;g<d.length;g++)(0,d[g])(o)},function(g){for(h.status="rejected",h.reason=g,g=0;g<d.length;g++)(0,d[g])(void 0)}),h}var dp=U.S;U.S=function(i,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&Jx(i,o),dp!==null&&dp(i,o)};var ko=E(null);function qh(){var i=ko.current;return i!==null?i:Hn.pooledCache}function Hd(i,o){o===null?V(ko,ko.current):V(ko,o.pool)}function up(){var i=qh();return i===null?null:{parent:gs._currentValue,pool:i}}var Al=Error(s(460)),qc=Error(s(474)),Oo=Error(s(542)),Hh={then:function(){}};function hp(i){return i=i.status,i==="fulfilled"||i==="rejected"}function Oa(){}function L(i,o,d){switch(d=i[d],d===void 0?i.push(o):d!==o&&(o.then(Oa,Oa),o=d),o.status){case"fulfilled":return o.value;case"rejected":throw i=o.reason,W(i),i;default:if(typeof o.status=="string")o.then(Oa,Oa);else{if(i=Hn,i!==null&&100<i.shellSuspendCounter)throw Error(s(482));i=o,i.status="pending",i.then(function(h){if(o.status==="pending"){var g=o;g.status="fulfilled",g.value=h}},function(h){if(o.status==="pending"){var g=o;g.status="rejected",g.reason=h}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw i=o.reason,W(i),i}throw x=o,Al}}var x=null;function S(){if(x===null)throw Error(s(459));var i=x;return x=null,i}function W(i){if(i===Al||i===Oo)throw Error(s(483))}var ge=!1;function we(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Le(i,o){i=i.updateQueue,o.updateQueue===i&&(o.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function qe(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function tt(i,o,d){var h=i.updateQueue;if(h===null)return null;if(h=h.shared,(In&2)!==0){var g=h.pending;return g===null?o.next=o:(o.next=g.next,g.next=o),h.pending=o,o=Bd(i),Rh(i,null,d),o}return $d(i,h,o,d),Bd(i)}function dt(i,o,d){if(o=o.updateQueue,o!==null&&(o=o.shared,(d&4194048)!==0)){var h=o.lanes;h&=i.pendingLanes,d|=h,o.lanes=d,ze(i,d)}}function mt(i,o){var d=i.updateQueue,h=i.alternate;if(h!==null&&(h=h.updateQueue,d===h)){var g=null,y=null;if(d=d.firstBaseUpdate,d!==null){do{var P={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};y===null?g=y=P:y=y.next=P,d=d.next}while(d!==null);y===null?g=y=o:y=y.next=o}else g=y=o;d={baseState:h.baseState,firstBaseUpdate:g,lastBaseUpdate:y,shared:h.shared,callbacks:h.callbacks},i.updateQueue=d;return}i=d.lastBaseUpdate,i===null?d.firstBaseUpdate=o:i.next=o,d.lastBaseUpdate=o}var ot=!1;function Lt(){if(ot){var i=Br;if(i!==null)throw i}}function Et(i,o,d,h){ot=!1;var g=i.updateQueue;ge=!1;var y=g.firstBaseUpdate,P=g.lastBaseUpdate,G=g.shared.pending;if(G!==null){g.shared.pending=null;var ae=G,Ae=ae.next;ae.next=null,P===null?y=Ae:P.next=Ae,P=ae;var $e=i.alternate;$e!==null&&($e=$e.updateQueue,G=$e.lastBaseUpdate,G!==P&&(G===null?$e.firstBaseUpdate=Ae:G.next=Ae,$e.lastBaseUpdate=ae))}if(y!==null){var Qe=g.baseState;P=0,$e=Ae=ae=null,G=y;do{var Re=G.lane&-536870913,Pe=Re!==G.lane;if(Pe?(dn&Re)===Re:(h&Re)===Re){Re!==0&&Re===Xr&&(ot=!0),$e!==null&&($e=$e.next={lane:0,tag:G.tag,payload:G.payload,callback:null,next:null});e:{var Mt=i,Tt=G;Re=o;var Ln=d;switch(Tt.tag){case 1:if(Mt=Tt.payload,typeof Mt=="function"){Qe=Mt.call(Ln,Qe,Re);break e}Qe=Mt;break e;case 3:Mt.flags=Mt.flags&-65537|128;case 0:if(Mt=Tt.payload,Re=typeof Mt=="function"?Mt.call(Ln,Qe,Re):Mt,Re==null)break e;Qe=b({},Qe,Re);break e;case 2:ge=!0}}Re=G.callback,Re!==null&&(i.flags|=64,Pe&&(i.flags|=8192),Pe=g.callbacks,Pe===null?g.callbacks=[Re]:Pe.push(Re))}else Pe={lane:Re,tag:G.tag,payload:G.payload,callback:G.callback,next:null},$e===null?(Ae=$e=Pe,ae=Qe):$e=$e.next=Pe,P|=Re;if(G=G.next,G===null){if(G=g.shared.pending,G===null)break;Pe=G,G=Pe.next,Pe.next=null,g.lastBaseUpdate=Pe,g.shared.pending=null}}while(!0);$e===null&&(ae=Qe),g.baseState=ae,g.firstBaseUpdate=Ae,g.lastBaseUpdate=$e,y===null&&(g.shared.lanes=0),Ll|=P,i.lanes=P,i.memoizedState=Qe}}function Ft(i,o){if(typeof i!="function")throw Error(s(191,i));i.call(o)}function Dt(i,o){var d=i.callbacks;if(d!==null)for(i.callbacks=null,i=0;i<d.length;i++)Ft(d[i],o)}var It=E(null),fn=E(0);function En(i,o){i=$o,V(fn,i),V(It,o),$o=i|o.baseLanes}function $t(){V(fn,$o),V(It,It.current)}function on(){$o=fn.current,R(It),R(fn)}var Rt=0,lt=null,jt=null,Pt=null,cn=!1,On=!1,Ss=!1,Cr=0,Is=0,Gs=null,Jr=0;function zt(){throw Error(s(321))}function Zr(i,o){if(o===null)return!1;for(var d=0;d<o.length&&d<i.length;d++)if(!Sr(i[d],o[d]))return!1;return!0}function ei(i,o,d,h,g,y){return Rt=y,lt=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,U.H=i===null||i.memoizedState===null?Ev:Sv,Ss=!1,y=d(h,g),Ss=!1,On&&(y=Ts(o,d,h,g)),Mo(i),y}function Mo(i){U.H=wp;var o=jt!==null&&jt.next!==null;if(Rt=0,Pt=jt=lt=null,cn=!1,Is=0,Gs=null,o)throw Error(s(300));i===null||sr||(i=i.dependencies,i!==null&&$c(i)&&(sr=!0))}function Ts(i,o,d,h){lt=i;var g=0;do{if(On&&(Gs=null),Is=0,On=!1,25<=g)throw Error(s(301));if(g+=1,Pt=jt=null,i.updateQueue!=null){var y=i.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}U.H=pC,y=o(d,h)}while(On);return y}function Sn(){var i=U.H,o=i.useState()[0];return o=typeof o.then=="function"?Ma(o):o,i=i.useState()[0],(jt!==null?jt.memoizedState:null)!==i&&(lt.flags|=1024),o}function Qs(){var i=Cr!==0;return Cr=0,i}function Ar(i,o,d){o.updateQueue=i.updateQueue,o.flags&=-2053,i.lanes&=~d}function Gi(i){if(cn){for(i=i.memoizedState;i!==null;){var o=i.queue;o!==null&&(o.pending=null),i=i.next}cn=!1}Rt=0,Pt=jt=lt=null,On=!1,Is=Cr=0,Gs=null}function Ws(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pt===null?lt.memoizedState=Pt=i:Pt=Pt.next=i,Pt}function as(){if(jt===null){var i=lt.alternate;i=i!==null?i.memoizedState:null}else i=jt.next;var o=Pt===null?lt.memoizedState:Pt.next;if(o!==null)Pt=o,jt=i;else{if(i===null)throw lt.alternate===null?Error(s(467)):Error(s(310));jt=i,i={memoizedState:jt.memoizedState,baseState:jt.baseState,baseQueue:jt.baseQueue,queue:jt.queue,next:null},Pt===null?lt.memoizedState=Pt=i:Pt=Pt.next=i}return Pt}function Gd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ma(i){var o=Is;return Is+=1,Gs===null&&(Gs=[]),i=L(Gs,i,o),o=lt,(Pt===null?o.memoizedState:Pt.next)===null&&(o=o.alternate,U.H=o===null||o.memoizedState===null?Ev:Sv),i}function Qd(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Ma(i);if(i.$$typeof===J)return Hs(i)}throw Error(s(438,String(i)))}function Gh(i){var o=null,d=lt.updateQueue;if(d!==null&&(o=d.memoCache),o==null){var h=lt.alternate;h!==null&&(h=h.updateQueue,h!==null&&(h=h.memoCache,h!=null&&(o={data:h.data.map(function(g){return g.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),d===null&&(d=Gd(),lt.updateQueue=d),d.memoCache=o,d=o.data[o.index],d===void 0)for(d=o.data[o.index]=Array(i),h=0;h<i;h++)d[h]=$;return o.index++,d}function xi(i,o){return typeof o=="function"?o(i):o}function Wd(i){var o=as();return Kd(o,jt,i)}function Kd(i,o,d){var h=i.queue;if(h===null)throw Error(s(311));h.lastRenderedReducer=d;var g=i.baseQueue,y=h.pending;if(y!==null){if(g!==null){var P=g.next;g.next=y.next,y.next=P}o.baseQueue=g=y,h.pending=null}if(y=i.baseState,g===null)i.memoizedState=y;else{o=g.next;var G=P=null,ae=null,Ae=o,$e=!1;do{var Qe=Ae.lane&-536870913;if(Qe!==Ae.lane?(dn&Qe)===Qe:(Rt&Qe)===Qe){var Re=Ae.revertLane;if(Re===0)ae!==null&&(ae=ae.next={lane:0,revertLane:0,action:Ae.action,hasEagerState:Ae.hasEagerState,eagerState:Ae.eagerState,next:null}),Qe===Xr&&($e=!0);else if((Rt&Re)===Re){Ae=Ae.next,Re===Xr&&($e=!0);continue}else Qe={lane:0,revertLane:Ae.revertLane,action:Ae.action,hasEagerState:Ae.hasEagerState,eagerState:Ae.eagerState,next:null},ae===null?(G=ae=Qe,P=y):ae=ae.next=Qe,lt.lanes|=Re,Ll|=Re;Qe=Ae.action,Ss&&d(y,Qe),y=Ae.hasEagerState?Ae.eagerState:d(y,Qe)}else Re={lane:Qe,revertLane:Ae.revertLane,action:Ae.action,hasEagerState:Ae.hasEagerState,eagerState:Ae.eagerState,next:null},ae===null?(G=ae=Re,P=y):ae=ae.next=Re,lt.lanes|=Qe,Ll|=Qe;Ae=Ae.next}while(Ae!==null&&Ae!==o);if(ae===null?P=y:ae.next=G,!Sr(y,i.memoizedState)&&(sr=!0,$e&&(d=Br,d!==null)))throw d;i.memoizedState=y,i.baseState=P,i.baseQueue=ae,h.lastRenderedState=y}return g===null&&(h.lanes=0),[i.memoizedState,h.dispatch]}function Qh(i){var o=as(),d=o.queue;if(d===null)throw Error(s(311));d.lastRenderedReducer=i;var h=d.dispatch,g=d.pending,y=o.memoizedState;if(g!==null){d.pending=null;var P=g=g.next;do y=i(y,P.action),P=P.next;while(P!==g);Sr(y,o.memoizedState)||(sr=!0),o.memoizedState=y,o.baseQueue===null&&(o.baseState=y),d.lastRenderedState=y}return[y,h]}function Wh(i,o,d){var h=lt,g=as(),y=mn;if(y){if(d===void 0)throw Error(s(407));d=d()}else d=o();var P=!Sr((jt||g).memoizedState,d);P&&(g.memoizedState=d,sr=!0),g=g.queue;var G=fp.bind(null,h,g,i);if(nm(2048,8,G,[i]),g.getSnapshot!==o||P||Pt!==null&&Pt.memoizedState.tag&1){if(h.flags|=2048,Zd(9,xp(),mp.bind(null,h,g,d,o),null),Hn===null)throw Error(s(349));y||(Rt&124)!==0||Kh(h,o,d)}return d}function Kh(i,o,d){i.flags|=16384,i={getSnapshot:o,value:d},o=lt.updateQueue,o===null?(o=Gd(),lt.updateQueue=o,o.stores=[i]):(d=o.stores,d===null?o.stores=[i]:d.push(i))}function mp(i,o,d,h){o.value=d,o.getSnapshot=h,La(o)&&Hc(i)}function fp(i,o,d){return d(function(){La(o)&&Hc(i)})}function La(i){var o=i.getSnapshot;i=i.value;try{var d=o();return!Sr(i,d)}catch{return!0}}function Hc(i){var o=Ir(i,2);o!==null&&Ni(o,i,2)}function Yd(i){var o=Ws();if(typeof i=="function"){var d=i;if(i=d(),Ss){Nn(!0);try{d()}finally{Nn(!1)}}}return o.memoizedState=o.baseState=i,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:xi,lastRenderedState:i},o}function Yh(i,o,d,h){return i.baseState=d,Kd(i,jt,typeof h=="function"?h:xi)}function Xh(i,o,d,h,g){if(bp(i))throw Error(s(485));if(i=o.action,i!==null){var y={payload:g,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(P){y.listeners.push(P)}};U.T!==null?d(!0):y.isTransition=!1,h(y),d=o.pending,d===null?(y.next=o.pending=y,Jh(o,y)):(y.next=d.next,o.pending=d.next=y)}}function Jh(i,o){var d=o.action,h=o.payload,g=i.state;if(o.isTransition){var y=U.T,P={};U.T=P;try{var G=d(g,h),ae=U.S;ae!==null&&ae(P,G),Zh(i,o,G)}catch(Ae){Xd(i,o,Ae)}finally{U.T=y}}else try{y=d(g,h),Zh(i,o,y)}catch(Ae){Xd(i,o,Ae)}}function Zh(i,o,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(h){em(i,o,h)},function(h){return Xd(i,o,h)}):em(i,o,d)}function em(i,o,d){o.status="fulfilled",o.value=d,pp(o),i.state=d,o=i.pending,o!==null&&(d=o.next,d===o?i.pending=null:(d=d.next,o.next=d,Jh(i,d)))}function Xd(i,o,d){var h=i.pending;if(i.pending=null,h!==null){h=h.next;do o.status="rejected",o.reason=d,pp(o),o=o.next;while(o!==h)}i.action=null}function pp(i){i=i.listeners;for(var o=0;o<i.length;o++)(0,i[o])()}function gp(i,o){return o}function Jd(i,o){if(mn){var d=Hn.formState;if(d!==null){e:{var h=lt;if(mn){if(qn){t:{for(var g=qn,y=Hi;g.nodeType!==8;){if(!y){g=null;break t}if(g=ma(g.nextSibling),g===null){g=null;break t}}y=g.data,g=y==="F!"||y==="F"?g:null}if(g){qn=ma(g.nextSibling),h=g.data==="F!";break e}}ca(h)}h=!1}h&&(o=d[0])}}return d=Ws(),d.memoizedState=d.baseState=o,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:gp,lastRenderedState:o},d.queue=h,d=Nv.bind(null,lt,h),h.dispatch=d,h=Yd(!1),y=ry.bind(null,lt,!1,h.queue),h=Ws(),g={state:o,dispatch:null,action:i,pending:null},h.queue=g,d=Xh.bind(null,lt,g,y,d),g.dispatch=d,h.memoizedState=i,[o,d,!1]}function tm(i){var o=as();return iv(o,jt,i)}function iv(i,o,d){if(o=Kd(i,o,gp)[0],i=Wd(xi)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var h=Ma(o)}catch(P){throw P===Al?Oo:P}else h=o;o=as();var g=o.queue,y=g.dispatch;return d!==o.memoizedState&&(lt.flags|=2048,Zd(9,xp(),uC.bind(null,g,d),null)),[h,y,i]}function uC(i,o){i.action=o}function av(i){var o=as(),d=jt;if(d!==null)return iv(o,d,i);as(),o=o.memoizedState,d=as();var h=d.queue.dispatch;return d.memoizedState=i,[o,h,!1]}function Zd(i,o,d,h){return i={tag:i,create:d,deps:h,inst:o,next:null},o=lt.updateQueue,o===null&&(o=Gd(),lt.updateQueue=o),d=o.lastEffect,d===null?o.lastEffect=i.next=i:(h=d.next,d.next=i,i.next=h,o.lastEffect=i),i}function xp(){return{destroy:void 0,resource:void 0}}function ov(){return as().memoizedState}function yp(i,o,d,h){var g=Ws();h=h===void 0?null:h,lt.flags|=i,g.memoizedState=Zd(1|o,xp(),d,h)}function nm(i,o,d,h){var g=as();h=h===void 0?null:h;var y=g.memoizedState.inst;jt!==null&&h!==null&&Zr(h,jt.memoizedState.deps)?g.memoizedState=Zd(o,y,d,h):(lt.flags|=i,g.memoizedState=Zd(1|o,y,d,h))}function lv(i,o){yp(8390656,8,i,o)}function cv(i,o){nm(2048,8,i,o)}function dv(i,o){return nm(4,2,i,o)}function uv(i,o){return nm(4,4,i,o)}function hv(i,o){if(typeof o=="function"){i=i();var d=o(i);return function(){typeof d=="function"?d():o(null)}}if(o!=null)return i=i(),o.current=i,function(){o.current=null}}function mv(i,o,d){d=d!=null?d.concat([i]):null,nm(4,4,hv.bind(null,o,i),d)}function ey(){}function fv(i,o){var d=as();o=o===void 0?null:o;var h=d.memoizedState;return o!==null&&Zr(o,h[1])?h[0]:(d.memoizedState=[i,o],i)}function pv(i,o){var d=as();o=o===void 0?null:o;var h=d.memoizedState;if(o!==null&&Zr(o,h[1]))return h[0];if(h=i(),Ss){Nn(!0);try{i()}finally{Nn(!1)}}return d.memoizedState=[h,o],h}function ty(i,o,d){return d===void 0||(Rt&1073741824)!==0?i.memoizedState=o:(i.memoizedState=d,i=yN(),lt.lanes|=i,Ll|=i,d)}function gv(i,o,d,h){return Sr(d,o)?d:It.current!==null?(i=ty(i,d,h),Sr(i,o)||(sr=!0),i):(Rt&42)===0?(sr=!0,i.memoizedState=d):(i=yN(),lt.lanes|=i,Ll|=i,o)}function xv(i,o,d,h,g){var y=se.p;se.p=y!==0&&8>y?y:8;var P=U.T,G={};U.T=G,ry(i,!1,o,d);try{var ae=g(),Ae=U.S;if(Ae!==null&&Ae(G,ae),ae!==null&&typeof ae=="object"&&typeof ae.then=="function"){var $e=Zx(ae,h);sm(i,o,$e,vi(i))}else sm(i,o,h,vi(i))}catch(Qe){sm(i,o,{then:function(){},status:"rejected",reason:Qe},vi())}finally{se.p=y,U.T=P}}function hC(){}function ny(i,o,d,h){if(i.tag!==5)throw Error(s(476));var g=yv(i).queue;xv(i,g,o,fe,d===null?hC:function(){return bv(i),d(h)})}function yv(i){var o=i.memoizedState;if(o!==null)return o;o={memoizedState:fe,baseState:fe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xi,lastRenderedState:fe},next:null};var d={};return o.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xi,lastRenderedState:d},next:null},i.memoizedState=o,i=i.alternate,i!==null&&(i.memoizedState=o),o}function bv(i){var o=yv(i).next.queue;sm(i,o,{},vi())}function sy(){return Hs(vm)}function wv(){return as().memoizedState}function vv(){return as().memoizedState}function mC(i){for(var o=i.return;o!==null;){switch(o.tag){case 24:case 3:var d=vi();i=qe(d);var h=tt(o,i,d);h!==null&&(Ni(h,o,d),dt(h,o,d)),o={cache:Bc()},i.payload=o;return}o=o.return}}function fC(i,o,d){var h=vi();d={lane:h,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null},bp(i)?jv(o,d):(d=Dh(i,o,d,h),d!==null&&(Ni(d,i,h),_v(d,o,h)))}function Nv(i,o,d){var h=vi();sm(i,o,d,h)}function sm(i,o,d,h){var g={lane:h,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null};if(bp(i))jv(o,g);else{var y=i.alternate;if(i.lanes===0&&(y===null||y.lanes===0)&&(y=o.lastRenderedReducer,y!==null))try{var P=o.lastRenderedState,G=y(P,d);if(g.hasEagerState=!0,g.eagerState=G,Sr(G,P))return $d(i,o,g,0),Hn===null&&zd(),!1}catch{}finally{}if(d=Dh(i,o,g,h),d!==null)return Ni(d,i,h),_v(d,o,h),!0}return!1}function ry(i,o,d,h){if(h={lane:2,revertLane:My(),action:h,hasEagerState:!1,eagerState:null,next:null},bp(i)){if(o)throw Error(s(479))}else o=Dh(i,d,h,2),o!==null&&Ni(o,i,2)}function bp(i){var o=i.alternate;return i===lt||o!==null&&o===lt}function jv(i,o){On=cn=!0;var d=i.pending;d===null?o.next=o:(o.next=d.next,d.next=o),i.pending=o}function _v(i,o,d){if((d&4194048)!==0){var h=o.lanes;h&=i.pendingLanes,d|=h,o.lanes=d,ze(i,d)}}var wp={readContext:Hs,use:Qd,useCallback:zt,useContext:zt,useEffect:zt,useImperativeHandle:zt,useLayoutEffect:zt,useInsertionEffect:zt,useMemo:zt,useReducer:zt,useRef:zt,useState:zt,useDebugValue:zt,useDeferredValue:zt,useTransition:zt,useSyncExternalStore:zt,useId:zt,useHostTransitionStatus:zt,useFormState:zt,useActionState:zt,useOptimistic:zt,useMemoCache:zt,useCacheRefresh:zt},Ev={readContext:Hs,use:Qd,useCallback:function(i,o){return Ws().memoizedState=[i,o===void 0?null:o],i},useContext:Hs,useEffect:lv,useImperativeHandle:function(i,o,d){d=d!=null?d.concat([i]):null,yp(4194308,4,hv.bind(null,o,i),d)},useLayoutEffect:function(i,o){return yp(4194308,4,i,o)},useInsertionEffect:function(i,o){yp(4,2,i,o)},useMemo:function(i,o){var d=Ws();o=o===void 0?null:o;var h=i();if(Ss){Nn(!0);try{i()}finally{Nn(!1)}}return d.memoizedState=[h,o],h},useReducer:function(i,o,d){var h=Ws();if(d!==void 0){var g=d(o);if(Ss){Nn(!0);try{d(o)}finally{Nn(!1)}}}else g=o;return h.memoizedState=h.baseState=g,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:g},h.queue=i,i=i.dispatch=fC.bind(null,lt,i),[h.memoizedState,i]},useRef:function(i){var o=Ws();return i={current:i},o.memoizedState=i},useState:function(i){i=Yd(i);var o=i.queue,d=Nv.bind(null,lt,o);return o.dispatch=d,[i.memoizedState,d]},useDebugValue:ey,useDeferredValue:function(i,o){var d=Ws();return ty(d,i,o)},useTransition:function(){var i=Yd(!1);return i=xv.bind(null,lt,i.queue,!0,!1),Ws().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,o,d){var h=lt,g=Ws();if(mn){if(d===void 0)throw Error(s(407));d=d()}else{if(d=o(),Hn===null)throw Error(s(349));(dn&124)!==0||Kh(h,o,d)}g.memoizedState=d;var y={value:d,getSnapshot:o};return g.queue=y,lv(fp.bind(null,h,y,i),[i]),h.flags|=2048,Zd(9,xp(),mp.bind(null,h,y,d,o),null),d},useId:function(){var i=Ws(),o=Hn.identifierPrefix;if(mn){var d=pr,h=la;d=(h&~(1<<32-T(h)-1)).toString(32)+d,o="«"+o+"R"+d,d=Cr++,0<d&&(o+="H"+d.toString(32)),o+="»"}else d=Jr++,o="«"+o+"r"+d.toString(32)+"»";return i.memoizedState=o},useHostTransitionStatus:sy,useFormState:Jd,useActionState:Jd,useOptimistic:function(i){var o=Ws();o.memoizedState=o.baseState=i;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=d,o=ry.bind(null,lt,!0,d),d.dispatch=o,[i,o]},useMemoCache:Gh,useCacheRefresh:function(){return Ws().memoizedState=mC.bind(null,lt)}},Sv={readContext:Hs,use:Qd,useCallback:fv,useContext:Hs,useEffect:cv,useImperativeHandle:mv,useInsertionEffect:dv,useLayoutEffect:uv,useMemo:pv,useReducer:Wd,useRef:ov,useState:function(){return Wd(xi)},useDebugValue:ey,useDeferredValue:function(i,o){var d=as();return gv(d,jt.memoizedState,i,o)},useTransition:function(){var i=Wd(xi)[0],o=as().memoizedState;return[typeof i=="boolean"?i:Ma(i),o]},useSyncExternalStore:Wh,useId:wv,useHostTransitionStatus:sy,useFormState:tm,useActionState:tm,useOptimistic:function(i,o){var d=as();return Yh(d,jt,i,o)},useMemoCache:Gh,useCacheRefresh:vv},pC={readContext:Hs,use:Qd,useCallback:fv,useContext:Hs,useEffect:cv,useImperativeHandle:mv,useInsertionEffect:dv,useLayoutEffect:uv,useMemo:pv,useReducer:Qh,useRef:ov,useState:function(){return Qh(xi)},useDebugValue:ey,useDeferredValue:function(i,o){var d=as();return jt===null?ty(d,i,o):gv(d,jt.memoizedState,i,o)},useTransition:function(){var i=Qh(xi)[0],o=as().memoizedState;return[typeof i=="boolean"?i:Ma(i),o]},useSyncExternalStore:Wh,useId:wv,useHostTransitionStatus:sy,useFormState:av,useActionState:av,useOptimistic:function(i,o){var d=as();return jt!==null?Yh(d,jt,i,o):(d.baseState=i,[i,d.queue.dispatch])},useMemoCache:Gh,useCacheRefresh:vv},eu=null,rm=0;function vp(i){var o=rm;return rm+=1,eu===null&&(eu=[]),L(eu,i,o)}function im(i,o){o=o.props.ref,i.ref=o!==void 0?o:null}function Np(i,o){throw o.$$typeof===w?Error(s(525)):(i=Object.prototype.toString.call(o),Error(s(31,i==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":i)))}function Iv(i){var o=i._init;return o(i._payload)}function Tv(i){function o(ve,pe){if(i){var Ce=ve.deletions;Ce===null?(ve.deletions=[pe],ve.flags|=16):Ce.push(pe)}}function d(ve,pe){if(!i)return null;for(;pe!==null;)o(ve,pe),pe=pe.sibling;return null}function h(ve){for(var pe=new Map;ve!==null;)ve.key!==null?pe.set(ve.key,ve):pe.set(ve.index,ve),ve=ve.sibling;return pe}function g(ve,pe){return ve=aa(ve,pe),ve.index=0,ve.sibling=null,ve}function y(ve,pe,Ce){return ve.index=Ce,i?(Ce=ve.alternate,Ce!==null?(Ce=Ce.index,Ce<pe?(ve.flags|=67108866,pe):Ce):(ve.flags|=67108866,pe)):(ve.flags|=1048576,pe)}function P(ve){return i&&ve.alternate===null&&(ve.flags|=67108866),ve}function G(ve,pe,Ce,He){return pe===null||pe.tag!==6?(pe=El(Ce,ve.mode,He),pe.return=ve,pe):(pe=g(pe,Ce),pe.return=ve,pe)}function ae(ve,pe,Ce,He){var gt=Ce.type;return gt===O?$e(ve,pe,Ce.props.children,He,Ce.key):pe!==null&&(pe.elementType===gt||typeof gt=="object"&&gt!==null&&gt.$$typeof===H&&Iv(gt)===pe.type)?(pe=g(pe,Ce.props),im(pe,Ce),pe.return=ve,pe):(pe=qd(Ce.type,Ce.key,Ce.props,null,ve.mode,He),im(pe,Ce),pe.return=ve,pe)}function Ae(ve,pe,Ce,He){return pe===null||pe.tag!==4||pe.stateNode.containerInfo!==Ce.containerInfo||pe.stateNode.implementation!==Ce.implementation?(pe=kh(Ce,ve.mode,He),pe.return=ve,pe):(pe=g(pe,Ce.children||[]),pe.return=ve,pe)}function $e(ve,pe,Ce,He,gt){return pe===null||pe.tag!==7?(pe=oa(Ce,ve.mode,He,gt),pe.return=ve,pe):(pe=g(pe,Ce),pe.return=ve,pe)}function Qe(ve,pe,Ce){if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return pe=El(""+pe,ve.mode,Ce),pe.return=ve,pe;if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case j:return Ce=qd(pe.type,pe.key,pe.props,null,ve.mode,Ce),im(Ce,pe),Ce.return=ve,Ce;case D:return pe=kh(pe,ve.mode,Ce),pe.return=ve,pe;case H:var He=pe._init;return pe=He(pe._payload),Qe(ve,pe,Ce)}if(Be(pe)||te(pe))return pe=oa(pe,ve.mode,Ce,null),pe.return=ve,pe;if(typeof pe.then=="function")return Qe(ve,vp(pe),Ce);if(pe.$$typeof===J)return Qe(ve,Tl(ve,pe),Ce);Np(ve,pe)}return null}function Re(ve,pe,Ce,He){var gt=pe!==null?pe.key:null;if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint")return gt!==null?null:G(ve,pe,""+Ce,He);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case j:return Ce.key===gt?ae(ve,pe,Ce,He):null;case D:return Ce.key===gt?Ae(ve,pe,Ce,He):null;case H:return gt=Ce._init,Ce=gt(Ce._payload),Re(ve,pe,Ce,He)}if(Be(Ce)||te(Ce))return gt!==null?null:$e(ve,pe,Ce,He,null);if(typeof Ce.then=="function")return Re(ve,pe,vp(Ce),He);if(Ce.$$typeof===J)return Re(ve,pe,Tl(ve,Ce),He);Np(ve,Ce)}return null}function Pe(ve,pe,Ce,He,gt){if(typeof He=="string"&&He!==""||typeof He=="number"||typeof He=="bigint")return ve=ve.get(Ce)||null,G(pe,ve,""+He,gt);if(typeof He=="object"&&He!==null){switch(He.$$typeof){case j:return ve=ve.get(He.key===null?Ce:He.key)||null,ae(pe,ve,He,gt);case D:return ve=ve.get(He.key===null?Ce:He.key)||null,Ae(pe,ve,He,gt);case H:var Gt=He._init;return He=Gt(He._payload),Pe(ve,pe,Ce,He,gt)}if(Be(He)||te(He))return ve=ve.get(Ce)||null,$e(pe,ve,He,gt,null);if(typeof He.then=="function")return Pe(ve,pe,Ce,vp(He),gt);if(He.$$typeof===J)return Pe(ve,pe,Ce,Tl(pe,He),gt);Np(pe,He)}return null}function Mt(ve,pe,Ce,He){for(var gt=null,Gt=null,_t=pe,At=pe=0,ir=null;_t!==null&&At<Ce.length;At++){_t.index>At?(ir=_t,_t=null):ir=_t.sibling;var wn=Re(ve,_t,Ce[At],He);if(wn===null){_t===null&&(_t=ir);break}i&&_t&&wn.alternate===null&&o(ve,_t),pe=y(wn,pe,At),Gt===null?gt=wn:Gt.sibling=wn,Gt=wn,_t=ir}if(At===Ce.length)return d(ve,_t),mn&&Co(ve,At),gt;if(_t===null){for(;At<Ce.length;At++)_t=Qe(ve,Ce[At],He),_t!==null&&(pe=y(_t,pe,At),Gt===null?gt=_t:Gt.sibling=_t,Gt=_t);return mn&&Co(ve,At),gt}for(_t=h(_t);At<Ce.length;At++)ir=Pe(_t,ve,At,Ce[At],He),ir!==null&&(i&&ir.alternate!==null&&_t.delete(ir.key===null?At:ir.key),pe=y(ir,pe,At),Gt===null?gt=ir:Gt.sibling=ir,Gt=ir);return i&&_t.forEach(function(Gl){return o(ve,Gl)}),mn&&Co(ve,At),gt}function Tt(ve,pe,Ce,He){if(Ce==null)throw Error(s(151));for(var gt=null,Gt=null,_t=pe,At=pe=0,ir=null,wn=Ce.next();_t!==null&&!wn.done;At++,wn=Ce.next()){_t.index>At?(ir=_t,_t=null):ir=_t.sibling;var Gl=Re(ve,_t,wn.value,He);if(Gl===null){_t===null&&(_t=ir);break}i&&_t&&Gl.alternate===null&&o(ve,_t),pe=y(Gl,pe,At),Gt===null?gt=Gl:Gt.sibling=Gl,Gt=Gl,_t=ir}if(wn.done)return d(ve,_t),mn&&Co(ve,At),gt;if(_t===null){for(;!wn.done;At++,wn=Ce.next())wn=Qe(ve,wn.value,He),wn!==null&&(pe=y(wn,pe,At),Gt===null?gt=wn:Gt.sibling=wn,Gt=wn);return mn&&Co(ve,At),gt}for(_t=h(_t);!wn.done;At++,wn=Ce.next())wn=Pe(_t,ve,At,wn.value,He),wn!==null&&(i&&wn.alternate!==null&&_t.delete(wn.key===null?At:wn.key),pe=y(wn,pe,At),Gt===null?gt=wn:Gt.sibling=wn,Gt=wn);return i&&_t.forEach(function(gA){return o(ve,gA)}),mn&&Co(ve,At),gt}function Ln(ve,pe,Ce,He){if(typeof Ce=="object"&&Ce!==null&&Ce.type===O&&Ce.key===null&&(Ce=Ce.props.children),typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case j:e:{for(var gt=Ce.key;pe!==null;){if(pe.key===gt){if(gt=Ce.type,gt===O){if(pe.tag===7){d(ve,pe.sibling),He=g(pe,Ce.props.children),He.return=ve,ve=He;break e}}else if(pe.elementType===gt||typeof gt=="object"&&gt!==null&&gt.$$typeof===H&&Iv(gt)===pe.type){d(ve,pe.sibling),He=g(pe,Ce.props),im(He,Ce),He.return=ve,ve=He;break e}d(ve,pe);break}else o(ve,pe);pe=pe.sibling}Ce.type===O?(He=oa(Ce.props.children,ve.mode,He,Ce.key),He.return=ve,ve=He):(He=qd(Ce.type,Ce.key,Ce.props,null,ve.mode,He),im(He,Ce),He.return=ve,ve=He)}return P(ve);case D:e:{for(gt=Ce.key;pe!==null;){if(pe.key===gt)if(pe.tag===4&&pe.stateNode.containerInfo===Ce.containerInfo&&pe.stateNode.implementation===Ce.implementation){d(ve,pe.sibling),He=g(pe,Ce.children||[]),He.return=ve,ve=He;break e}else{d(ve,pe);break}else o(ve,pe);pe=pe.sibling}He=kh(Ce,ve.mode,He),He.return=ve,ve=He}return P(ve);case H:return gt=Ce._init,Ce=gt(Ce._payload),Ln(ve,pe,Ce,He)}if(Be(Ce))return Mt(ve,pe,Ce,He);if(te(Ce)){if(gt=te(Ce),typeof gt!="function")throw Error(s(150));return Ce=gt.call(Ce),Tt(ve,pe,Ce,He)}if(typeof Ce.then=="function")return Ln(ve,pe,vp(Ce),He);if(Ce.$$typeof===J)return Ln(ve,pe,Tl(ve,Ce),He);Np(ve,Ce)}return typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint"?(Ce=""+Ce,pe!==null&&pe.tag===6?(d(ve,pe.sibling),He=g(pe,Ce),He.return=ve,ve=He):(d(ve,pe),He=El(Ce,ve.mode,He),He.return=ve,ve=He),P(ve)):d(ve,pe)}return function(ve,pe,Ce,He){try{rm=0;var gt=Ln(ve,pe,Ce,He);return eu=null,gt}catch(_t){if(_t===Al||_t===Oo)throw _t;var Gt=$r(29,_t,null,ve.mode);return Gt.lanes=He,Gt.return=ve,Gt}finally{}}}var tu=Tv(!0),Cv=Tv(!1),Qi=E(null),Fa=null;function Dl(i){var o=i.alternate;V(Ks,Ks.current&1),V(Qi,i),Fa===null&&(o===null||It.current!==null||o.memoizedState!==null)&&(Fa=i)}function Av(i){if(i.tag===22){if(V(Ks,Ks.current),V(Qi,i),Fa===null){var o=i.alternate;o!==null&&o.memoizedState!==null&&(Fa=i)}}else Rl()}function Rl(){V(Ks,Ks.current),V(Qi,Qi.current)}function Lo(i){R(Qi),Fa===i&&(Fa=null),R(Ks)}var Ks=E(0);function jp(i){for(var o=i;o!==null;){if(o.tag===13){var d=o.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||Wy(d)))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}function iy(i,o,d,h){o=i.memoizedState,d=d(h,o),d=d==null?o:b({},o,d),i.memoizedState=d,i.lanes===0&&(i.updateQueue.baseState=d)}var ay={enqueueSetState:function(i,o,d){i=i._reactInternals;var h=vi(),g=qe(h);g.payload=o,d!=null&&(g.callback=d),o=tt(i,g,h),o!==null&&(Ni(o,i,h),dt(o,i,h))},enqueueReplaceState:function(i,o,d){i=i._reactInternals;var h=vi(),g=qe(h);g.tag=1,g.payload=o,d!=null&&(g.callback=d),o=tt(i,g,h),o!==null&&(Ni(o,i,h),dt(o,i,h))},enqueueForceUpdate:function(i,o){i=i._reactInternals;var d=vi(),h=qe(d);h.tag=2,o!=null&&(h.callback=o),o=tt(i,h,d),o!==null&&(Ni(o,i,d),dt(o,i,d))}};function Dv(i,o,d,h,g,y,P){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(h,y,P):o.prototype&&o.prototype.isPureReactComponent?!jo(d,h)||!jo(g,y):!0}function Rv(i,o,d,h){i=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(d,h),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(d,h),o.state!==i&&ay.enqueueReplaceState(o,o.state,null)}function Gc(i,o){var d=o;if("ref"in o){d={};for(var h in o)h!=="ref"&&(d[h]=o[h])}if(i=i.defaultProps){d===o&&(d=b({},d));for(var g in i)d[g]===void 0&&(d[g]=i[g])}return d}var _p=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)};function Pv(i){_p(i)}function kv(i){console.error(i)}function Ov(i){_p(i)}function Ep(i,o){try{var d=i.onUncaughtError;d(o.value,{componentStack:o.stack})}catch(h){setTimeout(function(){throw h})}}function Mv(i,o,d){try{var h=i.onCaughtError;h(d.value,{componentStack:d.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function oy(i,o,d){return d=qe(d),d.tag=3,d.payload={element:null},d.callback=function(){Ep(i,o)},d}function Lv(i){return i=qe(i),i.tag=3,i}function Fv(i,o,d,h){var g=d.type.getDerivedStateFromError;if(typeof g=="function"){var y=h.value;i.payload=function(){return g(y)},i.callback=function(){Mv(o,d,h)}}var P=d.stateNode;P!==null&&typeof P.componentDidCatch=="function"&&(i.callback=function(){Mv(o,d,h),typeof g!="function"&&(Fl===null?Fl=new Set([this]):Fl.add(this));var G=h.stack;this.componentDidCatch(h.value,{componentStack:G!==null?G:""})})}function gC(i,o,d,h,g){if(d.flags|=32768,h!==null&&typeof h=="object"&&typeof h.then=="function"){if(o=d.alternate,o!==null&&zc(o,d,g,!0),d=Qi.current,d!==null){switch(d.tag){case 13:return Fa===null?Dy():d.alternate===null&&xs===0&&(xs=3),d.flags&=-257,d.flags|=65536,d.lanes=g,h===Hh?d.flags|=16384:(o=d.updateQueue,o===null?d.updateQueue=new Set([h]):o.add(h),Py(i,h,g)),!1;case 22:return d.flags|=65536,h===Hh?d.flags|=16384:(o=d.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([h])},d.updateQueue=o):(d=o.retryQueue,d===null?o.retryQueue=new Set([h]):d.add(h)),Py(i,h,g)),!1}throw Error(s(435,d.tag))}return Py(i,h,g),Dy(),!1}if(mn)return o=Qi.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=g,h!==Pa&&(i=Error(s(422),{cause:h}),gi(Vr(i,d)))):(h!==Pa&&(o=Error(s(423),{cause:h}),gi(Vr(o,d))),i=i.current.alternate,i.flags|=65536,g&=-g,i.lanes|=g,h=Vr(h,d),g=oy(i.stateNode,h,g),mt(i,g),xs!==4&&(xs=2)),!1;var y=Error(s(520),{cause:h});if(y=Vr(y,d),hm===null?hm=[y]:hm.push(y),xs!==4&&(xs=2),o===null)return!0;h=Vr(h,d),d=o;do{switch(d.tag){case 3:return d.flags|=65536,i=g&-g,d.lanes|=i,i=oy(d.stateNode,h,i),mt(d,i),!1;case 1:if(o=d.type,y=d.stateNode,(d.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Fl===null||!Fl.has(y))))return d.flags|=65536,g&=-g,d.lanes|=g,g=Lv(g),Fv(g,i,d,h),mt(d,g),!1}d=d.return}while(d!==null);return!1}var Uv=Error(s(461)),sr=!1;function gr(i,o,d,h){o.child=i===null?Cv(o,null,d,h):tu(o,i.child,d,h)}function Vv(i,o,d,h,g){d=d.render;var y=o.ref;if("ref"in h){var P={};for(var G in h)G!=="ref"&&(P[G]=h[G])}else P=h;return Do(o),h=ei(i,o,d,P,y,g),G=Qs(),i!==null&&!sr?(Ar(i,o,g),Fo(i,o,g)):(mn&&G&&Oh(o),o.flags|=1,gr(i,o,h,g),o.child)}function zv(i,o,d,h,g){if(i===null){var y=d.type;return typeof y=="function"&&!Ph(y)&&y.defaultProps===void 0&&d.compare===null?(o.tag=15,o.type=y,$v(i,o,y,h,g)):(i=qd(d.type,null,h,o,o.mode,g),i.ref=o.ref,i.return=o,o.child=i)}if(y=i.child,!py(i,g)){var P=y.memoizedProps;if(d=d.compare,d=d!==null?d:jo,d(P,h)&&i.ref===o.ref)return Fo(i,o,g)}return o.flags|=1,i=aa(y,h),i.ref=o.ref,i.return=o,o.child=i}function $v(i,o,d,h,g){if(i!==null){var y=i.memoizedProps;if(jo(y,h)&&i.ref===o.ref)if(sr=!1,o.pendingProps=h=y,py(i,g))(i.flags&131072)!==0&&(sr=!0);else return o.lanes=i.lanes,Fo(i,o,g)}return ly(i,o,d,h,g)}function Bv(i,o,d){var h=o.pendingProps,g=h.children,y=i!==null?i.memoizedState:null;if(h.mode==="hidden"){if((o.flags&128)!==0){if(h=y!==null?y.baseLanes|d:d,i!==null){for(g=o.child=i.child,y=0;g!==null;)y=y|g.lanes|g.childLanes,g=g.sibling;o.childLanes=y&~h}else o.childLanes=0,o.child=null;return qv(i,o,h,d)}if((d&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},i!==null&&Hd(o,y!==null?y.cachePool:null),y!==null?En(o,y):$t(),Av(o);else return o.lanes=o.childLanes=536870912,qv(i,o,y!==null?y.baseLanes|d:d,d)}else y!==null?(Hd(o,y.cachePool),En(o,y),Rl(),o.memoizedState=null):(i!==null&&Hd(o,null),$t(),Rl());return gr(i,o,g,d),o.child}function qv(i,o,d,h){var g=qh();return g=g===null?null:{parent:gs._currentValue,pool:g},o.memoizedState={baseLanes:d,cachePool:g},i!==null&&Hd(o,null),$t(),Av(o),i!==null&&zc(i,o,h,!0),null}function Sp(i,o){var d=o.ref;if(d===null)i!==null&&i.ref!==null&&(o.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(s(284));(i===null||i.ref!==d)&&(o.flags|=4194816)}}function ly(i,o,d,h,g){return Do(o),d=ei(i,o,d,h,void 0,g),h=Qs(),i!==null&&!sr?(Ar(i,o,g),Fo(i,o,g)):(mn&&h&&Oh(o),o.flags|=1,gr(i,o,d,g),o.child)}function Hv(i,o,d,h,g,y){return Do(o),o.updateQueue=null,d=Ts(o,h,d,g),Mo(i),h=Qs(),i!==null&&!sr?(Ar(i,o,y),Fo(i,o,y)):(mn&&h&&Oh(o),o.flags|=1,gr(i,o,d,y),o.child)}function Gv(i,o,d,h,g){if(Do(o),o.stateNode===null){var y=_l,P=d.contextType;typeof P=="object"&&P!==null&&(y=Hs(P)),y=new d(h,y),o.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=ay,o.stateNode=y,y._reactInternals=o,y=o.stateNode,y.props=h,y.state=o.memoizedState,y.refs={},we(o),P=d.contextType,y.context=typeof P=="object"&&P!==null?Hs(P):_l,y.state=o.memoizedState,P=d.getDerivedStateFromProps,typeof P=="function"&&(iy(o,d,P,h),y.state=o.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(P=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),P!==y.state&&ay.enqueueReplaceState(y,y.state,null),Et(o,h,y,g),Lt(),y.state=o.memoizedState),typeof y.componentDidMount=="function"&&(o.flags|=4194308),h=!0}else if(i===null){y=o.stateNode;var G=o.memoizedProps,ae=Gc(d,G);y.props=ae;var Ae=y.context,$e=d.contextType;P=_l,typeof $e=="object"&&$e!==null&&(P=Hs($e));var Qe=d.getDerivedStateFromProps;$e=typeof Qe=="function"||typeof y.getSnapshotBeforeUpdate=="function",G=o.pendingProps!==G,$e||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(G||Ae!==P)&&Rv(o,y,h,P),ge=!1;var Re=o.memoizedState;y.state=Re,Et(o,h,y,g),Lt(),Ae=o.memoizedState,G||Re!==Ae||ge?(typeof Qe=="function"&&(iy(o,d,Qe,h),Ae=o.memoizedState),(ae=ge||Dv(o,d,ae,h,Re,Ae,P))?($e||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(o.flags|=4194308)):(typeof y.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=h,o.memoizedState=Ae),y.props=h,y.state=Ae,y.context=P,h=ae):(typeof y.componentDidMount=="function"&&(o.flags|=4194308),h=!1)}else{y=o.stateNode,Le(i,o),P=o.memoizedProps,$e=Gc(d,P),y.props=$e,Qe=o.pendingProps,Re=y.context,Ae=d.contextType,ae=_l,typeof Ae=="object"&&Ae!==null&&(ae=Hs(Ae)),G=d.getDerivedStateFromProps,(Ae=typeof G=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(P!==Qe||Re!==ae)&&Rv(o,y,h,ae),ge=!1,Re=o.memoizedState,y.state=Re,Et(o,h,y,g),Lt();var Pe=o.memoizedState;P!==Qe||Re!==Pe||ge||i!==null&&i.dependencies!==null&&$c(i.dependencies)?(typeof G=="function"&&(iy(o,d,G,h),Pe=o.memoizedState),($e=ge||Dv(o,d,$e,h,Re,Pe,ae)||i!==null&&i.dependencies!==null&&$c(i.dependencies))?(Ae||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(h,Pe,ae),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(h,Pe,ae)),typeof y.componentDidUpdate=="function"&&(o.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof y.componentDidUpdate!="function"||P===i.memoizedProps&&Re===i.memoizedState||(o.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||P===i.memoizedProps&&Re===i.memoizedState||(o.flags|=1024),o.memoizedProps=h,o.memoizedState=Pe),y.props=h,y.state=Pe,y.context=ae,h=$e):(typeof y.componentDidUpdate!="function"||P===i.memoizedProps&&Re===i.memoizedState||(o.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||P===i.memoizedProps&&Re===i.memoizedState||(o.flags|=1024),h=!1)}return y=h,Sp(i,o),h=(o.flags&128)!==0,y||h?(y=o.stateNode,d=h&&typeof d.getDerivedStateFromError!="function"?null:y.render(),o.flags|=1,i!==null&&h?(o.child=tu(o,i.child,null,g),o.child=tu(o,null,d,g)):gr(i,o,d,g),o.memoizedState=y.state,i=o.child):i=Fo(i,o,g),i}function Qv(i,o,d,h){return Vc(),o.flags|=256,gr(i,o,d,h),o.child}var cy={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function dy(i){return{baseLanes:i,cachePool:up()}}function uy(i,o,d){return i=i!==null?i.childLanes&~d:0,o&&(i|=Wi),i}function Wv(i,o,d){var h=o.pendingProps,g=!1,y=(o.flags&128)!==0,P;if((P=y)||(P=i!==null&&i.memoizedState===null?!1:(Ks.current&2)!==0),P&&(g=!0,o.flags&=-129),P=(o.flags&32)!==0,o.flags&=-33,i===null){if(mn){if(g?Dl(o):Rl(),mn){var G=qn,ae;if(ae=G){e:{for(ae=G,G=Hi;ae.nodeType!==8;){if(!G){G=null;break e}if(ae=ma(ae.nextSibling),ae===null){G=null;break e}}G=ae}G!==null?(o.memoizedState={dehydrated:G,treeContext:To!==null?{id:la,overflow:pr}:null,retryLane:536870912,hydrationErrors:null},ae=$r(18,null,null,0),ae.stateNode=G,ae.return=o,o.child=ae,Ls=o,qn=null,ae=!0):ae=!1}ae||ca(o)}if(G=o.memoizedState,G!==null&&(G=G.dehydrated,G!==null))return Wy(G)?o.lanes=32:o.lanes=536870912,null;Lo(o)}return G=h.children,h=h.fallback,g?(Rl(),g=o.mode,G=Ip({mode:"hidden",children:G},g),h=oa(h,g,d,null),G.return=o,h.return=o,G.sibling=h,o.child=G,g=o.child,g.memoizedState=dy(d),g.childLanes=uy(i,P,d),o.memoizedState=cy,h):(Dl(o),hy(o,G))}if(ae=i.memoizedState,ae!==null&&(G=ae.dehydrated,G!==null)){if(y)o.flags&256?(Dl(o),o.flags&=-257,o=my(i,o,d)):o.memoizedState!==null?(Rl(),o.child=i.child,o.flags|=128,o=null):(Rl(),g=h.fallback,G=o.mode,h=Ip({mode:"visible",children:h.children},G),g=oa(g,G,d,null),g.flags|=2,h.return=o,g.return=o,h.sibling=g,o.child=h,tu(o,i.child,null,d),h=o.child,h.memoizedState=dy(d),h.childLanes=uy(i,P,d),o.memoizedState=cy,o=g);else if(Dl(o),Wy(G)){if(P=G.nextSibling&&G.nextSibling.dataset,P)var Ae=P.dgst;P=Ae,h=Error(s(419)),h.stack="",h.digest=P,gi({value:h,source:null,stack:null}),o=my(i,o,d)}else if(sr||zc(i,o,d,!1),P=(d&i.childLanes)!==0,sr||P){if(P=Hn,P!==null&&(h=d&-d,h=(h&42)!==0?1:Oe(h),h=(h&(P.suspendedLanes|d))!==0?0:h,h!==0&&h!==ae.retryLane))throw ae.retryLane=h,Ir(i,h),Ni(P,i,h),Uv;G.data==="$?"||Dy(),o=my(i,o,d)}else G.data==="$?"?(o.flags|=192,o.child=i.child,o=null):(i=ae.treeContext,qn=ma(G.nextSibling),Ls=o,mn=!0,Ra=null,Hi=!1,i!==null&&(Tr[Yr++]=la,Tr[Yr++]=pr,Tr[Yr++]=To,la=i.id,pr=i.overflow,To=o),o=hy(o,h.children),o.flags|=4096);return o}return g?(Rl(),g=h.fallback,G=o.mode,ae=i.child,Ae=ae.sibling,h=aa(ae,{mode:"hidden",children:h.children}),h.subtreeFlags=ae.subtreeFlags&65011712,Ae!==null?g=aa(Ae,g):(g=oa(g,G,d,null),g.flags|=2),g.return=o,h.return=o,h.sibling=g,o.child=h,h=g,g=o.child,G=i.child.memoizedState,G===null?G=dy(d):(ae=G.cachePool,ae!==null?(Ae=gs._currentValue,ae=ae.parent!==Ae?{parent:Ae,pool:Ae}:ae):ae=up(),G={baseLanes:G.baseLanes|d,cachePool:ae}),g.memoizedState=G,g.childLanes=uy(i,P,d),o.memoizedState=cy,h):(Dl(o),d=i.child,i=d.sibling,d=aa(d,{mode:"visible",children:h.children}),d.return=o,d.sibling=null,i!==null&&(P=o.deletions,P===null?(o.deletions=[i],o.flags|=16):P.push(i)),o.child=d,o.memoizedState=null,d)}function hy(i,o){return o=Ip({mode:"visible",children:o},i.mode),o.return=i,i.child=o}function Ip(i,o){return i=$r(22,i,null,o),i.lanes=0,i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},i}function my(i,o,d){return tu(o,i.child,null,d),i=hy(o,o.pendingProps.children),i.flags|=2,o.memoizedState=null,i}function Kv(i,o,d){i.lanes|=o;var h=i.alternate;h!==null&&(h.lanes|=o),Uh(i.return,o,d)}function fy(i,o,d,h,g){var y=i.memoizedState;y===null?i.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:h,tail:d,tailMode:g}:(y.isBackwards=o,y.rendering=null,y.renderingStartTime=0,y.last=h,y.tail=d,y.tailMode=g)}function Yv(i,o,d){var h=o.pendingProps,g=h.revealOrder,y=h.tail;if(gr(i,o,h.children,d),h=Ks.current,(h&2)!==0)h=h&1|2,o.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=o.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Kv(i,d,o);else if(i.tag===19)Kv(i,d,o);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===o)break e;for(;i.sibling===null;){if(i.return===null||i.return===o)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}h&=1}switch(V(Ks,h),g){case"forwards":for(d=o.child,g=null;d!==null;)i=d.alternate,i!==null&&jp(i)===null&&(g=d),d=d.sibling;d=g,d===null?(g=o.child,o.child=null):(g=d.sibling,d.sibling=null),fy(o,!1,g,d,y);break;case"backwards":for(d=null,g=o.child,o.child=null;g!==null;){if(i=g.alternate,i!==null&&jp(i)===null){o.child=g;break}i=g.sibling,g.sibling=d,d=g,g=i}fy(o,!0,d,null,y);break;case"together":fy(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Fo(i,o,d){if(i!==null&&(o.dependencies=i.dependencies),Ll|=o.lanes,(d&o.childLanes)===0)if(i!==null){if(zc(i,o,d,!1),(d&o.childLanes)===0)return null}else return null;if(i!==null&&o.child!==i.child)throw Error(s(153));if(o.child!==null){for(i=o.child,d=aa(i,i.pendingProps),o.child=d,d.return=o;i.sibling!==null;)i=i.sibling,d=d.sibling=aa(i,i.pendingProps),d.return=o;d.sibling=null}return o.child}function py(i,o){return(i.lanes&o)!==0?!0:(i=i.dependencies,!!(i!==null&&$c(i)))}function xC(i,o,d){switch(o.tag){case 3:C(o,o.stateNode.containerInfo),ka(o,gs,i.memoizedState.cache),Vc();break;case 27:case 5:je(o);break;case 4:C(o,o.stateNode.containerInfo);break;case 10:ka(o,o.type,o.memoizedProps.value);break;case 13:var h=o.memoizedState;if(h!==null)return h.dehydrated!==null?(Dl(o),o.flags|=128,null):(d&o.child.childLanes)!==0?Wv(i,o,d):(Dl(o),i=Fo(i,o,d),i!==null?i.sibling:null);Dl(o);break;case 19:var g=(i.flags&128)!==0;if(h=(d&o.childLanes)!==0,h||(zc(i,o,d,!1),h=(d&o.childLanes)!==0),g){if(h)return Yv(i,o,d);o.flags|=128}if(g=o.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),V(Ks,Ks.current),h)break;return null;case 22:case 23:return o.lanes=0,Bv(i,o,d);case 24:ka(o,gs,i.memoizedState.cache)}return Fo(i,o,d)}function Xv(i,o,d){if(i!==null)if(i.memoizedProps!==o.pendingProps)sr=!0;else{if(!py(i,d)&&(o.flags&128)===0)return sr=!1,xC(i,o,d);sr=(i.flags&131072)!==0}else sr=!1,mn&&(o.flags&1048576)!==0&&ap(o,Sl,o.index);switch(o.lanes=0,o.tag){case 16:e:{i=o.pendingProps;var h=o.elementType,g=h._init;if(h=g(h._payload),o.type=h,typeof h=="function")Ph(h)?(i=Gc(h,i),o.tag=1,o=Gv(null,o,h,i,d)):(o.tag=0,o=ly(null,o,h,i,d));else{if(h!=null){if(g=h.$$typeof,g===oe){o.tag=11,o=Vv(null,o,h,i,d);break e}else if(g===M){o.tag=14,o=zv(null,o,h,i,d);break e}}throw o=ce(h)||h,Error(s(306,o,""))}}return o;case 0:return ly(i,o,o.type,o.pendingProps,d);case 1:return h=o.type,g=Gc(h,o.pendingProps),Gv(i,o,h,g,d);case 3:e:{if(C(o,o.stateNode.containerInfo),i===null)throw Error(s(387));h=o.pendingProps;var y=o.memoizedState;g=y.element,Le(i,o),Et(o,h,null,d);var P=o.memoizedState;if(h=P.cache,ka(o,gs,h),h!==y.cache&&Vh(o,[gs],d,!0),Lt(),h=P.element,y.isDehydrated)if(y={element:h,isDehydrated:!1,cache:P.cache},o.updateQueue.baseState=y,o.memoizedState=y,o.flags&256){o=Qv(i,o,h,d);break e}else if(h!==g){g=Vr(Error(s(424)),o),gi(g),o=Qv(i,o,h,d);break e}else{switch(i=o.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(qn=ma(i.firstChild),Ls=o,mn=!0,Ra=null,Hi=!0,d=Cv(o,null,h,d),o.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling}else{if(Vc(),h===g){o=Fo(i,o,d);break e}gr(i,o,h,d)}o=o.child}return o;case 26:return Sp(i,o),i===null?(d=tj(o.type,null,o.pendingProps,null))?o.memoizedState=d:mn||(d=o.type,i=o.pendingProps,h=zp(q.current).createElement(d),h[ke]=o,h[et]=i,yr(h,d,i),Qt(h),o.stateNode=h):o.memoizedState=tj(o.type,i.memoizedProps,o.pendingProps,i.memoizedState),null;case 27:return je(o),i===null&&mn&&(h=o.stateNode=JN(o.type,o.pendingProps,q.current),Ls=o,Hi=!0,g=qn,zl(o.type)?(Ky=g,qn=ma(h.firstChild)):qn=g),gr(i,o,o.pendingProps.children,d),Sp(i,o),i===null&&(o.flags|=4194304),o.child;case 5:return i===null&&mn&&((g=h=qn)&&(h=HC(h,o.type,o.pendingProps,Hi),h!==null?(o.stateNode=h,Ls=o,qn=ma(h.firstChild),Hi=!1,g=!0):g=!1),g||ca(o)),je(o),g=o.type,y=o.pendingProps,P=i!==null?i.memoizedProps:null,h=y.children,Hy(g,y)?h=null:P!==null&&Hy(g,P)&&(o.flags|=32),o.memoizedState!==null&&(g=ei(i,o,Sn,null,null,d),vm._currentValue=g),Sp(i,o),gr(i,o,h,d),o.child;case 6:return i===null&&mn&&((i=d=qn)&&(d=GC(d,o.pendingProps,Hi),d!==null?(o.stateNode=d,Ls=o,qn=null,i=!0):i=!1),i||ca(o)),null;case 13:return Wv(i,o,d);case 4:return C(o,o.stateNode.containerInfo),h=o.pendingProps,i===null?o.child=tu(o,null,h,d):gr(i,o,h,d),o.child;case 11:return Vv(i,o,o.type,o.pendingProps,d);case 7:return gr(i,o,o.pendingProps,d),o.child;case 8:return gr(i,o,o.pendingProps.children,d),o.child;case 12:return gr(i,o,o.pendingProps.children,d),o.child;case 10:return h=o.pendingProps,ka(o,o.type,h.value),gr(i,o,h.children,d),o.child;case 9:return g=o.type._context,h=o.pendingProps.children,Do(o),g=Hs(g),h=h(g),o.flags|=1,gr(i,o,h,d),o.child;case 14:return zv(i,o,o.type,o.pendingProps,d);case 15:return $v(i,o,o.type,o.pendingProps,d);case 19:return Yv(i,o,d);case 31:return h=o.pendingProps,d=o.mode,h={mode:h.mode,children:h.children},i===null?(d=Ip(h,d),d.ref=o.ref,o.child=d,d.return=o,o=d):(d=aa(i.child,h),d.ref=o.ref,o.child=d,d.return=o,o=d),o;case 22:return Bv(i,o,d);case 24:return Do(o),h=Hs(gs),i===null?(g=qh(),g===null&&(g=Hn,y=Bc(),g.pooledCache=y,y.refCount++,y!==null&&(g.pooledCacheLanes|=d),g=y),o.memoizedState={parent:h,cache:g},we(o),ka(o,gs,g)):((i.lanes&d)!==0&&(Le(i,o),Et(o,null,null,d),Lt()),g=i.memoizedState,y=o.memoizedState,g.parent!==h?(g={parent:h,cache:h},o.memoizedState=g,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=g),ka(o,gs,h)):(h=y.cache,ka(o,gs,h),h!==g.cache&&Vh(o,[gs],d,!0))),gr(i,o,o.pendingProps.children,d),o.child;case 29:throw o.pendingProps}throw Error(s(156,o.tag))}function Uo(i){i.flags|=4}function Jv(i,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!aj(o)){if(o=Qi.current,o!==null&&((dn&4194048)===dn?Fa!==null:(dn&62914560)!==dn&&(dn&536870912)===0||o!==Fa))throw x=Hh,qc;i.flags|=8192}}function Tp(i,o){o!==null&&(i.flags|=4),i.flags&16384&&(o=i.tag!==22?le():536870912,i.lanes|=o,iu|=o)}function am(i,o){if(!mn)switch(i.tailMode){case"hidden":o=i.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?i.tail=null:d.sibling=null;break;case"collapsed":d=i.tail;for(var h=null;d!==null;)d.alternate!==null&&(h=d),d=d.sibling;h===null?o||i.tail===null?i.tail=null:i.tail.sibling=null:h.sibling=null}}function os(i){var o=i.alternate!==null&&i.alternate.child===i.child,d=0,h=0;if(o)for(var g=i.child;g!==null;)d|=g.lanes|g.childLanes,h|=g.subtreeFlags&65011712,h|=g.flags&65011712,g.return=i,g=g.sibling;else for(g=i.child;g!==null;)d|=g.lanes|g.childLanes,h|=g.subtreeFlags,h|=g.flags,g.return=i,g=g.sibling;return i.subtreeFlags|=h,i.childLanes=d,o}function yC(i,o,d){var h=o.pendingProps;switch(Mh(o),o.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return os(o),null;case 1:return os(o),null;case 3:return d=o.stateNode,h=null,i!==null&&(h=i.memoizedState.cache),o.memoizedState.cache!==h&&(o.flags|=2048),ua(gs),Z(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(i===null||i.child===null)&&(Uc(o)?Uo(o):i===null||i.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,Il())),os(o),null;case 26:return d=o.memoizedState,i===null?(Uo(o),d!==null?(os(o),Jv(o,d)):(os(o),o.flags&=-16777217)):d?d!==i.memoizedState?(Uo(o),os(o),Jv(o,d)):(os(o),o.flags&=-16777217):(i.memoizedProps!==h&&Uo(o),os(o),o.flags&=-16777217),null;case 27:Ge(o),d=q.current;var g=o.type;if(i!==null&&o.stateNode!=null)i.memoizedProps!==h&&Uo(o);else{if(!h){if(o.stateNode===null)throw Error(s(166));return os(o),null}i=ne.current,Uc(o)?Lh(o):(i=JN(g,h,d),o.stateNode=i,Uo(o))}return os(o),null;case 5:if(Ge(o),d=o.type,i!==null&&o.stateNode!=null)i.memoizedProps!==h&&Uo(o);else{if(!h){if(o.stateNode===null)throw Error(s(166));return os(o),null}if(i=ne.current,Uc(o))Lh(o);else{switch(g=zp(q.current),i){case 1:i=g.createElementNS("http://www.w3.org/2000/svg",d);break;case 2:i=g.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;default:switch(d){case"svg":i=g.createElementNS("http://www.w3.org/2000/svg",d);break;case"math":i=g.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;case"script":i=g.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild);break;case"select":i=typeof h.is=="string"?g.createElement("select",{is:h.is}):g.createElement("select"),h.multiple?i.multiple=!0:h.size&&(i.size=h.size);break;default:i=typeof h.is=="string"?g.createElement(d,{is:h.is}):g.createElement(d)}}i[ke]=o,i[et]=h;e:for(g=o.child;g!==null;){if(g.tag===5||g.tag===6)i.appendChild(g.stateNode);else if(g.tag!==4&&g.tag!==27&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===o)break e;for(;g.sibling===null;){if(g.return===null||g.return===o)break e;g=g.return}g.sibling.return=g.return,g=g.sibling}o.stateNode=i;e:switch(yr(i,d,h),d){case"button":case"input":case"select":case"textarea":i=!!h.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&Uo(o)}}return os(o),o.flags&=-16777217,null;case 6:if(i&&o.stateNode!=null)i.memoizedProps!==h&&Uo(o);else{if(typeof h!="string"&&o.stateNode===null)throw Error(s(166));if(i=q.current,Uc(o)){if(i=o.stateNode,d=o.memoizedProps,h=null,g=Ls,g!==null)switch(g.tag){case 27:case 5:h=g.memoizedProps}i[ke]=o,i=!!(i.nodeValue===d||h!==null&&h.suppressHydrationWarning===!0||HN(i.nodeValue,d)),i||ca(o)}else i=zp(i).createTextNode(h),i[ke]=o,o.stateNode=i}return os(o),null;case 13:if(h=o.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(g=Uc(o),h!==null&&h.dehydrated!==null){if(i===null){if(!g)throw Error(s(318));if(g=o.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(s(317));g[ke]=o}else Vc(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;os(o),g=!1}else g=Il(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=g),g=!0;if(!g)return o.flags&256?(Lo(o),o):(Lo(o),null)}if(Lo(o),(o.flags&128)!==0)return o.lanes=d,o;if(d=h!==null,i=i!==null&&i.memoizedState!==null,d){h=o.child,g=null,h.alternate!==null&&h.alternate.memoizedState!==null&&h.alternate.memoizedState.cachePool!==null&&(g=h.alternate.memoizedState.cachePool.pool);var y=null;h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(y=h.memoizedState.cachePool.pool),y!==g&&(h.flags|=2048)}return d!==i&&d&&(o.child.flags|=8192),Tp(o,o.updateQueue),os(o),null;case 4:return Z(),i===null&&Vy(o.stateNode.containerInfo),os(o),null;case 10:return ua(o.type),os(o),null;case 19:if(R(Ks),g=o.memoizedState,g===null)return os(o),null;if(h=(o.flags&128)!==0,y=g.rendering,y===null)if(h)am(g,!1);else{if(xs!==0||i!==null&&(i.flags&128)!==0)for(i=o.child;i!==null;){if(y=jp(i),y!==null){for(o.flags|=128,am(g,!1),i=y.updateQueue,o.updateQueue=i,Tp(o,i),o.subtreeFlags=0,i=d,d=o.child;d!==null;)ip(d,i),d=d.sibling;return V(Ks,Ks.current&1|2),o.child}i=i.sibling}g.tail!==null&&Nt()>Dp&&(o.flags|=128,h=!0,am(g,!1),o.lanes=4194304)}else{if(!h)if(i=jp(y),i!==null){if(o.flags|=128,h=!0,i=i.updateQueue,o.updateQueue=i,Tp(o,i),am(g,!0),g.tail===null&&g.tailMode==="hidden"&&!y.alternate&&!mn)return os(o),null}else 2*Nt()-g.renderingStartTime>Dp&&d!==536870912&&(o.flags|=128,h=!0,am(g,!1),o.lanes=4194304);g.isBackwards?(y.sibling=o.child,o.child=y):(i=g.last,i!==null?i.sibling=y:o.child=y,g.last=y)}return g.tail!==null?(o=g.tail,g.rendering=o,g.tail=o.sibling,g.renderingStartTime=Nt(),o.sibling=null,i=Ks.current,V(Ks,h?i&1|2:i&1),o):(os(o),null);case 22:case 23:return Lo(o),on(),h=o.memoizedState!==null,i!==null?i.memoizedState!==null!==h&&(o.flags|=8192):h&&(o.flags|=8192),h?(d&536870912)!==0&&(o.flags&128)===0&&(os(o),o.subtreeFlags&6&&(o.flags|=8192)):os(o),d=o.updateQueue,d!==null&&Tp(o,d.retryQueue),d=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(d=i.memoizedState.cachePool.pool),h=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(h=o.memoizedState.cachePool.pool),h!==d&&(o.flags|=2048),i!==null&&R(ko),null;case 24:return d=null,i!==null&&(d=i.memoizedState.cache),o.memoizedState.cache!==d&&(o.flags|=2048),ua(gs),os(o),null;case 25:return null;case 30:return null}throw Error(s(156,o.tag))}function bC(i,o){switch(Mh(o),o.tag){case 1:return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 3:return ua(gs),Z(),i=o.flags,(i&65536)!==0&&(i&128)===0?(o.flags=i&-65537|128,o):null;case 26:case 27:case 5:return Ge(o),null;case 13:if(Lo(o),i=o.memoizedState,i!==null&&i.dehydrated!==null){if(o.alternate===null)throw Error(s(340));Vc()}return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 19:return R(Ks),null;case 4:return Z(),null;case 10:return ua(o.type),null;case 22:case 23:return Lo(o),on(),i!==null&&R(ko),i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 24:return ua(gs),null;case 25:return null;default:return null}}function Zv(i,o){switch(Mh(o),o.tag){case 3:ua(gs),Z();break;case 26:case 27:case 5:Ge(o);break;case 4:Z();break;case 13:Lo(o);break;case 19:R(Ks);break;case 10:ua(o.type);break;case 22:case 23:Lo(o),on(),i!==null&&R(ko);break;case 24:ua(gs)}}function om(i,o){try{var d=o.updateQueue,h=d!==null?d.lastEffect:null;if(h!==null){var g=h.next;d=g;do{if((d.tag&i)===i){h=void 0;var y=d.create,P=d.inst;h=y(),P.destroy=h}d=d.next}while(d!==g)}}catch(G){zn(o,o.return,G)}}function Pl(i,o,d){try{var h=o.updateQueue,g=h!==null?h.lastEffect:null;if(g!==null){var y=g.next;h=y;do{if((h.tag&i)===i){var P=h.inst,G=P.destroy;if(G!==void 0){P.destroy=void 0,g=o;var ae=d,Ae=G;try{Ae()}catch($e){zn(g,ae,$e)}}}h=h.next}while(h!==y)}}catch($e){zn(o,o.return,$e)}}function eN(i){var o=i.updateQueue;if(o!==null){var d=i.stateNode;try{Dt(o,d)}catch(h){zn(i,i.return,h)}}}function tN(i,o,d){d.props=Gc(i.type,i.memoizedProps),d.state=i.memoizedState;try{d.componentWillUnmount()}catch(h){zn(i,o,h)}}function lm(i,o){try{var d=i.ref;if(d!==null){switch(i.tag){case 26:case 27:case 5:var h=i.stateNode;break;case 30:h=i.stateNode;break;default:h=i.stateNode}typeof d=="function"?i.refCleanup=d(h):d.current=h}}catch(g){zn(i,o,g)}}function Ua(i,o){var d=i.ref,h=i.refCleanup;if(d!==null)if(typeof h=="function")try{h()}catch(g){zn(i,o,g)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(g){zn(i,o,g)}else d.current=null}function nN(i){var o=i.type,d=i.memoizedProps,h=i.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":d.autoFocus&&h.focus();break e;case"img":d.src?h.src=d.src:d.srcSet&&(h.srcset=d.srcSet)}}catch(g){zn(i,i.return,g)}}function gy(i,o,d){try{var h=i.stateNode;VC(h,i.type,d,o),h[et]=o}catch(g){zn(i,i.return,g)}}function sN(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&zl(i.type)||i.tag===4}function xy(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||sN(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&zl(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function yy(i,o,d){var h=i.tag;if(h===5||h===6)i=i.stateNode,o?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(i,o):(o=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,o.appendChild(i),d=d._reactRootContainer,d!=null||o.onclick!==null||(o.onclick=Vp));else if(h!==4&&(h===27&&zl(i.type)&&(d=i.stateNode,o=null),i=i.child,i!==null))for(yy(i,o,d),i=i.sibling;i!==null;)yy(i,o,d),i=i.sibling}function Cp(i,o,d){var h=i.tag;if(h===5||h===6)i=i.stateNode,o?d.insertBefore(i,o):d.appendChild(i);else if(h!==4&&(h===27&&zl(i.type)&&(d=i.stateNode),i=i.child,i!==null))for(Cp(i,o,d),i=i.sibling;i!==null;)Cp(i,o,d),i=i.sibling}function rN(i){var o=i.stateNode,d=i.memoizedProps;try{for(var h=i.type,g=o.attributes;g.length;)o.removeAttributeNode(g[0]);yr(o,h,d),o[ke]=i,o[et]=d}catch(y){zn(i,i.return,y)}}var Vo=!1,Cs=!1,by=!1,iN=typeof WeakSet=="function"?WeakSet:Set,rr=null;function wC(i,o){if(i=i.containerInfo,By=Qp,i=jh(i),Vd(i)){if("selectionStart"in i)var d={start:i.selectionStart,end:i.selectionEnd};else e:{d=(d=i.ownerDocument)&&d.defaultView||window;var h=d.getSelection&&d.getSelection();if(h&&h.rangeCount!==0){d=h.anchorNode;var g=h.anchorOffset,y=h.focusNode;h=h.focusOffset;try{d.nodeType,y.nodeType}catch{d=null;break e}var P=0,G=-1,ae=-1,Ae=0,$e=0,Qe=i,Re=null;t:for(;;){for(var Pe;Qe!==d||g!==0&&Qe.nodeType!==3||(G=P+g),Qe!==y||h!==0&&Qe.nodeType!==3||(ae=P+h),Qe.nodeType===3&&(P+=Qe.nodeValue.length),(Pe=Qe.firstChild)!==null;)Re=Qe,Qe=Pe;for(;;){if(Qe===i)break t;if(Re===d&&++Ae===g&&(G=P),Re===y&&++$e===h&&(ae=P),(Pe=Qe.nextSibling)!==null)break;Qe=Re,Re=Qe.parentNode}Qe=Pe}d=G===-1||ae===-1?null:{start:G,end:ae}}else d=null}d=d||{start:0,end:0}}else d=null;for(qy={focusedElem:i,selectionRange:d},Qp=!1,rr=o;rr!==null;)if(o=rr,i=o.child,(o.subtreeFlags&1024)!==0&&i!==null)i.return=o,rr=i;else for(;rr!==null;){switch(o=rr,y=o.alternate,i=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((i&1024)!==0&&y!==null){i=void 0,d=o,g=y.memoizedProps,y=y.memoizedState,h=d.stateNode;try{var Mt=Gc(d.type,g,d.elementType===d.type);i=h.getSnapshotBeforeUpdate(Mt,y),h.__reactInternalSnapshotBeforeUpdate=i}catch(Tt){zn(d,d.return,Tt)}}break;case 3:if((i&1024)!==0){if(i=o.stateNode.containerInfo,d=i.nodeType,d===9)Qy(i);else if(d===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":Qy(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(s(163))}if(i=o.sibling,i!==null){i.return=o.return,rr=i;break}rr=o.return}}function aN(i,o,d){var h=d.flags;switch(d.tag){case 0:case 11:case 15:kl(i,d),h&4&&om(5,d);break;case 1:if(kl(i,d),h&4)if(i=d.stateNode,o===null)try{i.componentDidMount()}catch(P){zn(d,d.return,P)}else{var g=Gc(d.type,o.memoizedProps);o=o.memoizedState;try{i.componentDidUpdate(g,o,i.__reactInternalSnapshotBeforeUpdate)}catch(P){zn(d,d.return,P)}}h&64&&eN(d),h&512&&lm(d,d.return);break;case 3:if(kl(i,d),h&64&&(i=d.updateQueue,i!==null)){if(o=null,d.child!==null)switch(d.child.tag){case 27:case 5:o=d.child.stateNode;break;case 1:o=d.child.stateNode}try{Dt(i,o)}catch(P){zn(d,d.return,P)}}break;case 27:o===null&&h&4&&rN(d);case 26:case 5:kl(i,d),o===null&&h&4&&nN(d),h&512&&lm(d,d.return);break;case 12:kl(i,d);break;case 13:kl(i,d),h&4&&cN(i,d),h&64&&(i=d.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(d=CC.bind(null,d),QC(i,d))));break;case 22:if(h=d.memoizedState!==null||Vo,!h){o=o!==null&&o.memoizedState!==null||Cs,g=Vo;var y=Cs;Vo=h,(Cs=o)&&!y?Ol(i,d,(d.subtreeFlags&8772)!==0):kl(i,d),Vo=g,Cs=y}break;case 30:break;default:kl(i,d)}}function oN(i){var o=i.alternate;o!==null&&(i.alternate=null,oN(o)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(o=i.stateNode,o!==null&&Na(o)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var ts=null,ti=!1;function zo(i,o,d){for(d=d.child;d!==null;)lN(i,o,d),d=d.sibling}function lN(i,o,d){if(Bt&&typeof Bt.onCommitFiberUnmount=="function")try{Bt.onCommitFiberUnmount(an,d)}catch{}switch(d.tag){case 26:Cs||Ua(d,o),zo(i,o,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:Cs||Ua(d,o);var h=ts,g=ti;zl(d.type)&&(ts=d.stateNode,ti=!1),zo(i,o,d),xm(d.stateNode),ts=h,ti=g;break;case 5:Cs||Ua(d,o);case 6:if(h=ts,g=ti,ts=null,zo(i,o,d),ts=h,ti=g,ts!==null)if(ti)try{(ts.nodeType===9?ts.body:ts.nodeName==="HTML"?ts.ownerDocument.body:ts).removeChild(d.stateNode)}catch(y){zn(d,o,y)}else try{ts.removeChild(d.stateNode)}catch(y){zn(d,o,y)}break;case 18:ts!==null&&(ti?(i=ts,YN(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,d.stateNode),Em(i)):YN(ts,d.stateNode));break;case 4:h=ts,g=ti,ts=d.stateNode.containerInfo,ti=!0,zo(i,o,d),ts=h,ti=g;break;case 0:case 11:case 14:case 15:Cs||Pl(2,d,o),Cs||Pl(4,d,o),zo(i,o,d);break;case 1:Cs||(Ua(d,o),h=d.stateNode,typeof h.componentWillUnmount=="function"&&tN(d,o,h)),zo(i,o,d);break;case 21:zo(i,o,d);break;case 22:Cs=(h=Cs)||d.memoizedState!==null,zo(i,o,d),Cs=h;break;default:zo(i,o,d)}}function cN(i,o){if(o.memoizedState===null&&(i=o.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{Em(i)}catch(d){zn(o,o.return,d)}}function vC(i){switch(i.tag){case 13:case 19:var o=i.stateNode;return o===null&&(o=i.stateNode=new iN),o;case 22:return i=i.stateNode,o=i._retryCache,o===null&&(o=i._retryCache=new iN),o;default:throw Error(s(435,i.tag))}}function wy(i,o){var d=vC(i);o.forEach(function(h){var g=AC.bind(null,i,h);d.has(h)||(d.add(h),h.then(g,g))})}function yi(i,o){var d=o.deletions;if(d!==null)for(var h=0;h<d.length;h++){var g=d[h],y=i,P=o,G=P;e:for(;G!==null;){switch(G.tag){case 27:if(zl(G.type)){ts=G.stateNode,ti=!1;break e}break;case 5:ts=G.stateNode,ti=!1;break e;case 3:case 4:ts=G.stateNode.containerInfo,ti=!0;break e}G=G.return}if(ts===null)throw Error(s(160));lN(y,P,g),ts=null,ti=!1,y=g.alternate,y!==null&&(y.return=null),g.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)dN(o,i),o=o.sibling}var ha=null;function dN(i,o){var d=i.alternate,h=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:yi(o,i),bi(i),h&4&&(Pl(3,i,i.return),om(3,i),Pl(5,i,i.return));break;case 1:yi(o,i),bi(i),h&512&&(Cs||d===null||Ua(d,d.return)),h&64&&Vo&&(i=i.updateQueue,i!==null&&(h=i.callbacks,h!==null&&(d=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=d===null?h:d.concat(h))));break;case 26:var g=ha;if(yi(o,i),bi(i),h&512&&(Cs||d===null||Ua(d,d.return)),h&4){var y=d!==null?d.memoizedState:null;if(h=i.memoizedState,d===null)if(h===null)if(i.stateNode===null){e:{h=i.type,d=i.memoizedProps,g=g.ownerDocument||g;t:switch(h){case"title":y=g.getElementsByTagName("title")[0],(!y||y[Ai]||y[ke]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=g.createElement(h),g.head.insertBefore(y,g.querySelector("head > title"))),yr(y,h,d),y[ke]=i,Qt(y),h=y;break e;case"link":var P=rj("link","href",g).get(h+(d.href||""));if(P){for(var G=0;G<P.length;G++)if(y=P[G],y.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&y.getAttribute("rel")===(d.rel==null?null:d.rel)&&y.getAttribute("title")===(d.title==null?null:d.title)&&y.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){P.splice(G,1);break t}}y=g.createElement(h),yr(y,h,d),g.head.appendChild(y);break;case"meta":if(P=rj("meta","content",g).get(h+(d.content||""))){for(G=0;G<P.length;G++)if(y=P[G],y.getAttribute("content")===(d.content==null?null:""+d.content)&&y.getAttribute("name")===(d.name==null?null:d.name)&&y.getAttribute("property")===(d.property==null?null:d.property)&&y.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&y.getAttribute("charset")===(d.charSet==null?null:d.charSet)){P.splice(G,1);break t}}y=g.createElement(h),yr(y,h,d),g.head.appendChild(y);break;default:throw Error(s(468,h))}y[ke]=i,Qt(y),h=y}i.stateNode=h}else ij(g,i.type,i.stateNode);else i.stateNode=sj(g,h,i.memoizedProps);else y!==h?(y===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):y.count--,h===null?ij(g,i.type,i.stateNode):sj(g,h,i.memoizedProps)):h===null&&i.stateNode!==null&&gy(i,i.memoizedProps,d.memoizedProps)}break;case 27:yi(o,i),bi(i),h&512&&(Cs||d===null||Ua(d,d.return)),d!==null&&h&4&&gy(i,i.memoizedProps,d.memoizedProps);break;case 5:if(yi(o,i),bi(i),h&512&&(Cs||d===null||Ua(d,d.return)),i.flags&32){g=i.stateNode;try{$s(g,"")}catch(Pe){zn(i,i.return,Pe)}}h&4&&i.stateNode!=null&&(g=i.memoizedProps,gy(i,g,d!==null?d.memoizedProps:g)),h&1024&&(by=!0);break;case 6:if(yi(o,i),bi(i),h&4){if(i.stateNode===null)throw Error(s(162));h=i.memoizedProps,d=i.stateNode;try{d.nodeValue=h}catch(Pe){zn(i,i.return,Pe)}}break;case 3:if(qp=null,g=ha,ha=$p(o.containerInfo),yi(o,i),ha=g,bi(i),h&4&&d!==null&&d.memoizedState.isDehydrated)try{Em(o.containerInfo)}catch(Pe){zn(i,i.return,Pe)}by&&(by=!1,uN(i));break;case 4:h=ha,ha=$p(i.stateNode.containerInfo),yi(o,i),bi(i),ha=h;break;case 12:yi(o,i),bi(i);break;case 13:yi(o,i),bi(i),i.child.flags&8192&&i.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(Sy=Nt()),h&4&&(h=i.updateQueue,h!==null&&(i.updateQueue=null,wy(i,h)));break;case 22:g=i.memoizedState!==null;var ae=d!==null&&d.memoizedState!==null,Ae=Vo,$e=Cs;if(Vo=Ae||g,Cs=$e||ae,yi(o,i),Cs=$e,Vo=Ae,bi(i),h&8192)e:for(o=i.stateNode,o._visibility=g?o._visibility&-2:o._visibility|1,g&&(d===null||ae||Vo||Cs||Qc(i)),d=null,o=i;;){if(o.tag===5||o.tag===26){if(d===null){ae=d=o;try{if(y=ae.stateNode,g)P=y.style,typeof P.setProperty=="function"?P.setProperty("display","none","important"):P.display="none";else{G=ae.stateNode;var Qe=ae.memoizedProps.style,Re=Qe!=null&&Qe.hasOwnProperty("display")?Qe.display:null;G.style.display=Re==null||typeof Re=="boolean"?"":(""+Re).trim()}}catch(Pe){zn(ae,ae.return,Pe)}}}else if(o.tag===6){if(d===null){ae=o;try{ae.stateNode.nodeValue=g?"":ae.memoizedProps}catch(Pe){zn(ae,ae.return,Pe)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===i)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break e;for(;o.sibling===null;){if(o.return===null||o.return===i)break e;d===o&&(d=null),o=o.return}d===o&&(d=null),o.sibling.return=o.return,o=o.sibling}h&4&&(h=i.updateQueue,h!==null&&(d=h.retryQueue,d!==null&&(h.retryQueue=null,wy(i,d))));break;case 19:yi(o,i),bi(i),h&4&&(h=i.updateQueue,h!==null&&(i.updateQueue=null,wy(i,h)));break;case 30:break;case 21:break;default:yi(o,i),bi(i)}}function bi(i){var o=i.flags;if(o&2){try{for(var d,h=i.return;h!==null;){if(sN(h)){d=h;break}h=h.return}if(d==null)throw Error(s(160));switch(d.tag){case 27:var g=d.stateNode,y=xy(i);Cp(i,y,g);break;case 5:var P=d.stateNode;d.flags&32&&($s(P,""),d.flags&=-33);var G=xy(i);Cp(i,G,P);break;case 3:case 4:var ae=d.stateNode.containerInfo,Ae=xy(i);yy(i,Ae,ae);break;default:throw Error(s(161))}}catch($e){zn(i,i.return,$e)}i.flags&=-3}o&4096&&(i.flags&=-4097)}function uN(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var o=i;uN(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),i=i.sibling}}function kl(i,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)aN(i,o.alternate,o),o=o.sibling}function Qc(i){for(i=i.child;i!==null;){var o=i;switch(o.tag){case 0:case 11:case 14:case 15:Pl(4,o,o.return),Qc(o);break;case 1:Ua(o,o.return);var d=o.stateNode;typeof d.componentWillUnmount=="function"&&tN(o,o.return,d),Qc(o);break;case 27:xm(o.stateNode);case 26:case 5:Ua(o,o.return),Qc(o);break;case 22:o.memoizedState===null&&Qc(o);break;case 30:Qc(o);break;default:Qc(o)}i=i.sibling}}function Ol(i,o,d){for(d=d&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var h=o.alternate,g=i,y=o,P=y.flags;switch(y.tag){case 0:case 11:case 15:Ol(g,y,d),om(4,y);break;case 1:if(Ol(g,y,d),h=y,g=h.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(Ae){zn(h,h.return,Ae)}if(h=y,g=h.updateQueue,g!==null){var G=h.stateNode;try{var ae=g.shared.hiddenCallbacks;if(ae!==null)for(g.shared.hiddenCallbacks=null,g=0;g<ae.length;g++)Ft(ae[g],G)}catch(Ae){zn(h,h.return,Ae)}}d&&P&64&&eN(y),lm(y,y.return);break;case 27:rN(y);case 26:case 5:Ol(g,y,d),d&&h===null&&P&4&&nN(y),lm(y,y.return);break;case 12:Ol(g,y,d);break;case 13:Ol(g,y,d),d&&P&4&&cN(g,y);break;case 22:y.memoizedState===null&&Ol(g,y,d),lm(y,y.return);break;case 30:break;default:Ol(g,y,d)}o=o.sibling}}function vy(i,o){var d=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(d=i.memoizedState.cachePool.pool),i=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(i=o.memoizedState.cachePool.pool),i!==d&&(i!=null&&i.refCount++,d!=null&&Cl(d))}function Ny(i,o){i=null,o.alternate!==null&&(i=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==i&&(o.refCount++,i!=null&&Cl(i))}function Va(i,o,d,h){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)hN(i,o,d,h),o=o.sibling}function hN(i,o,d,h){var g=o.flags;switch(o.tag){case 0:case 11:case 15:Va(i,o,d,h),g&2048&&om(9,o);break;case 1:Va(i,o,d,h);break;case 3:Va(i,o,d,h),g&2048&&(i=null,o.alternate!==null&&(i=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==i&&(o.refCount++,i!=null&&Cl(i)));break;case 12:if(g&2048){Va(i,o,d,h),i=o.stateNode;try{var y=o.memoizedProps,P=y.id,G=y.onPostCommit;typeof G=="function"&&G(P,o.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(ae){zn(o,o.return,ae)}}else Va(i,o,d,h);break;case 13:Va(i,o,d,h);break;case 23:break;case 22:y=o.stateNode,P=o.alternate,o.memoizedState!==null?y._visibility&2?Va(i,o,d,h):cm(i,o):y._visibility&2?Va(i,o,d,h):(y._visibility|=2,nu(i,o,d,h,(o.subtreeFlags&10256)!==0)),g&2048&&vy(P,o);break;case 24:Va(i,o,d,h),g&2048&&Ny(o.alternate,o);break;default:Va(i,o,d,h)}}function nu(i,o,d,h,g){for(g=g&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var y=i,P=o,G=d,ae=h,Ae=P.flags;switch(P.tag){case 0:case 11:case 15:nu(y,P,G,ae,g),om(8,P);break;case 23:break;case 22:var $e=P.stateNode;P.memoizedState!==null?$e._visibility&2?nu(y,P,G,ae,g):cm(y,P):($e._visibility|=2,nu(y,P,G,ae,g)),g&&Ae&2048&&vy(P.alternate,P);break;case 24:nu(y,P,G,ae,g),g&&Ae&2048&&Ny(P.alternate,P);break;default:nu(y,P,G,ae,g)}o=o.sibling}}function cm(i,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var d=i,h=o,g=h.flags;switch(h.tag){case 22:cm(d,h),g&2048&&vy(h.alternate,h);break;case 24:cm(d,h),g&2048&&Ny(h.alternate,h);break;default:cm(d,h)}o=o.sibling}}var dm=8192;function su(i){if(i.subtreeFlags&dm)for(i=i.child;i!==null;)mN(i),i=i.sibling}function mN(i){switch(i.tag){case 26:su(i),i.flags&dm&&i.memoizedState!==null&&aA(ha,i.memoizedState,i.memoizedProps);break;case 5:su(i);break;case 3:case 4:var o=ha;ha=$p(i.stateNode.containerInfo),su(i),ha=o;break;case 22:i.memoizedState===null&&(o=i.alternate,o!==null&&o.memoizedState!==null?(o=dm,dm=16777216,su(i),dm=o):su(i));break;default:su(i)}}function fN(i){var o=i.alternate;if(o!==null&&(i=o.child,i!==null)){o.child=null;do o=i.sibling,i.sibling=null,i=o;while(i!==null)}}function um(i){var o=i.deletions;if((i.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var h=o[d];rr=h,gN(h,i)}fN(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)pN(i),i=i.sibling}function pN(i){switch(i.tag){case 0:case 11:case 15:um(i),i.flags&2048&&Pl(9,i,i.return);break;case 3:um(i);break;case 12:um(i);break;case 22:var o=i.stateNode;i.memoizedState!==null&&o._visibility&2&&(i.return===null||i.return.tag!==13)?(o._visibility&=-3,Ap(i)):um(i);break;default:um(i)}}function Ap(i){var o=i.deletions;if((i.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var h=o[d];rr=h,gN(h,i)}fN(i)}for(i=i.child;i!==null;){switch(o=i,o.tag){case 0:case 11:case 15:Pl(8,o,o.return),Ap(o);break;case 22:d=o.stateNode,d._visibility&2&&(d._visibility&=-3,Ap(o));break;default:Ap(o)}i=i.sibling}}function gN(i,o){for(;rr!==null;){var d=rr;switch(d.tag){case 0:case 11:case 15:Pl(8,d,o);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var h=d.memoizedState.cachePool.pool;h!=null&&h.refCount++}break;case 24:Cl(d.memoizedState.cache)}if(h=d.child,h!==null)h.return=d,rr=h;else e:for(d=i;rr!==null;){h=rr;var g=h.sibling,y=h.return;if(oN(h),h===d){rr=null;break e}if(g!==null){g.return=y,rr=g;break e}rr=y}}}var NC={getCacheForType:function(i){var o=Hs(gs),d=o.data.get(i);return d===void 0&&(d=i(),o.data.set(i,d)),d}},jC=typeof WeakMap=="function"?WeakMap:Map,In=0,Hn=null,Wt=null,dn=0,Tn=0,wi=null,Ml=!1,ru=!1,jy=!1,$o=0,xs=0,Ll=0,Wc=0,_y=0,Wi=0,iu=0,hm=null,ni=null,Ey=!1,Sy=0,Dp=1/0,Rp=null,Fl=null,xr=0,Ul=null,au=null,ou=0,Iy=0,Ty=null,xN=null,mm=0,Cy=null;function vi(){if((In&2)!==0&&dn!==0)return dn&-dn;if(U.T!==null){var i=Xr;return i!==0?i:My()}return Ze()}function yN(){Wi===0&&(Wi=(dn&536870912)===0||mn?ue():536870912);var i=Qi.current;return i!==null&&(i.flags|=32),Wi}function Ni(i,o,d){(i===Hn&&(Tn===2||Tn===9)||i.cancelPendingCommit!==null)&&(lu(i,0),Vl(i,dn,Wi,!1)),Te(i,d),((In&2)===0||i!==Hn)&&(i===Hn&&((In&2)===0&&(Wc|=d),xs===4&&Vl(i,dn,Wi,!1)),za(i))}function bN(i,o,d){if((In&6)!==0)throw Error(s(327));var h=!d&&(o&124)===0&&(o&i.expiredLanes)===0||Vs(i,o),g=h?SC(i,o):Ry(i,o,!0),y=h;do{if(g===0){ru&&!h&&Vl(i,o,0,!1);break}else{if(d=i.current.alternate,y&&!_C(d)){g=Ry(i,o,!1),y=!1;continue}if(g===2){if(y=o,i.errorRecoveryDisabledLanes&y)var P=0;else P=i.pendingLanes&-536870913,P=P!==0?P:P&536870912?536870912:0;if(P!==0){o=P;e:{var G=i;g=hm;var ae=G.current.memoizedState.isDehydrated;if(ae&&(lu(G,P).flags|=256),P=Ry(G,P,!1),P!==2){if(jy&&!ae){G.errorRecoveryDisabledLanes|=y,Wc|=y,g=4;break e}y=ni,ni=g,y!==null&&(ni===null?ni=y:ni.push.apply(ni,y))}g=P}if(y=!1,g!==2)continue}}if(g===1){lu(i,0),Vl(i,o,0,!0);break}e:{switch(h=i,y=g,y){case 0:case 1:throw Error(s(345));case 4:if((o&4194048)!==o)break;case 6:Vl(h,o,Wi,!Ml);break e;case 2:ni=null;break;case 3:case 5:break;default:throw Error(s(329))}if((o&62914560)===o&&(g=Sy+300-Nt(),10<g)){if(Vl(h,o,Wi,!Ml),pt(h,0,!0)!==0)break e;h.timeoutHandle=WN(wN.bind(null,h,d,ni,Rp,Ey,o,Wi,Wc,iu,Ml,y,2,-0,0),g);break e}wN(h,d,ni,Rp,Ey,o,Wi,Wc,iu,Ml,y,0,-0,0)}}break}while(!0);za(i)}function wN(i,o,d,h,g,y,P,G,ae,Ae,$e,Qe,Re,Pe){if(i.timeoutHandle=-1,Qe=o.subtreeFlags,(Qe&8192||(Qe&16785408)===16785408)&&(wm={stylesheets:null,count:0,unsuspend:iA},mN(o),Qe=oA(),Qe!==null)){i.cancelPendingCommit=Qe(IN.bind(null,i,o,y,d,h,g,P,G,ae,$e,1,Re,Pe)),Vl(i,y,P,!Ae);return}IN(i,o,y,d,h,g,P,G,ae)}function _C(i){for(var o=i;;){var d=o.tag;if((d===0||d===11||d===15)&&o.flags&16384&&(d=o.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var h=0;h<d.length;h++){var g=d[h],y=g.getSnapshot;g=g.value;try{if(!Sr(y(),g))return!1}catch{return!1}}if(d=o.child,o.subtreeFlags&16384&&d!==null)d.return=o,o=d;else{if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Vl(i,o,d,h){o&=~_y,o&=~Wc,i.suspendedLanes|=o,i.pingedLanes&=~o,h&&(i.warmLanes|=o),h=i.expirationTimes;for(var g=o;0<g;){var y=31-T(g),P=1<<y;h[y]=-1,g&=~P}d!==0&&ye(i,d,o)}function Pp(){return(In&6)===0?(fm(0),!1):!0}function Ay(){if(Wt!==null){if(Tn===0)var i=Wt.return;else i=Wt,da=Ao=null,Gi(i),eu=null,rm=0,i=Wt;for(;i!==null;)Zv(i.alternate,i),i=i.return;Wt=null}}function lu(i,o){var d=i.timeoutHandle;d!==-1&&(i.timeoutHandle=-1,$C(d)),d=i.cancelPendingCommit,d!==null&&(i.cancelPendingCommit=null,d()),Ay(),Hn=i,Wt=d=aa(i.current,null),dn=o,Tn=0,wi=null,Ml=!1,ru=Vs(i,o),jy=!1,iu=Wi=_y=Wc=Ll=xs=0,ni=hm=null,Ey=!1,(o&8)!==0&&(o|=o&32);var h=i.entangledLanes;if(h!==0)for(i=i.entanglements,h&=o;0<h;){var g=31-T(h),y=1<<g;o|=i[g],h&=~y}return $o=o,zd(),d}function vN(i,o){lt=null,U.H=wp,o===Al||o===Oo?(o=S(),Tn=3):o===qc?(o=S(),Tn=4):Tn=o===Uv?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,wi=o,Wt===null&&(xs=1,Ep(i,Vr(o,i.current)))}function NN(){var i=U.H;return U.H=wp,i===null?wp:i}function jN(){var i=U.A;return U.A=NC,i}function Dy(){xs=4,Ml||(dn&4194048)!==dn&&Qi.current!==null||(ru=!0),(Ll&134217727)===0&&(Wc&134217727)===0||Hn===null||Vl(Hn,dn,Wi,!1)}function Ry(i,o,d){var h=In;In|=2;var g=NN(),y=jN();(Hn!==i||dn!==o)&&(Rp=null,lu(i,o)),o=!1;var P=xs;e:do try{if(Tn!==0&&Wt!==null){var G=Wt,ae=wi;switch(Tn){case 8:Ay(),P=6;break e;case 3:case 2:case 9:case 6:Qi.current===null&&(o=!0);var Ae=Tn;if(Tn=0,wi=null,cu(i,G,ae,Ae),d&&ru){P=0;break e}break;default:Ae=Tn,Tn=0,wi=null,cu(i,G,ae,Ae)}}EC(),P=xs;break}catch($e){vN(i,$e)}while(!0);return o&&i.shellSuspendCounter++,da=Ao=null,In=h,U.H=g,U.A=y,Wt===null&&(Hn=null,dn=0,zd()),P}function EC(){for(;Wt!==null;)_N(Wt)}function SC(i,o){var d=In;In|=2;var h=NN(),g=jN();Hn!==i||dn!==o?(Rp=null,Dp=Nt()+500,lu(i,o)):ru=Vs(i,o);e:do try{if(Tn!==0&&Wt!==null){o=Wt;var y=wi;t:switch(Tn){case 1:Tn=0,wi=null,cu(i,o,y,1);break;case 2:case 9:if(hp(y)){Tn=0,wi=null,EN(o);break}o=function(){Tn!==2&&Tn!==9||Hn!==i||(Tn=7),za(i)},y.then(o,o);break e;case 3:Tn=7;break e;case 4:Tn=5;break e;case 7:hp(y)?(Tn=0,wi=null,EN(o)):(Tn=0,wi=null,cu(i,o,y,7));break;case 5:var P=null;switch(Wt.tag){case 26:P=Wt.memoizedState;case 5:case 27:var G=Wt;if(!P||aj(P)){Tn=0,wi=null;var ae=G.sibling;if(ae!==null)Wt=ae;else{var Ae=G.return;Ae!==null?(Wt=Ae,kp(Ae)):Wt=null}break t}}Tn=0,wi=null,cu(i,o,y,5);break;case 6:Tn=0,wi=null,cu(i,o,y,6);break;case 8:Ay(),xs=6;break e;default:throw Error(s(462))}}IC();break}catch($e){vN(i,$e)}while(!0);return da=Ao=null,U.H=h,U.A=g,In=d,Wt!==null?0:(Hn=null,dn=0,zd(),xs)}function IC(){for(;Wt!==null&&!Ee();)_N(Wt)}function _N(i){var o=Xv(i.alternate,i,$o);i.memoizedProps=i.pendingProps,o===null?kp(i):Wt=o}function EN(i){var o=i,d=o.alternate;switch(o.tag){case 15:case 0:o=Hv(d,o,o.pendingProps,o.type,void 0,dn);break;case 11:o=Hv(d,o,o.pendingProps,o.type.render,o.ref,dn);break;case 5:Gi(o);default:Zv(d,o),o=Wt=ip(o,$o),o=Xv(d,o,$o)}i.memoizedProps=i.pendingProps,o===null?kp(i):Wt=o}function cu(i,o,d,h){da=Ao=null,Gi(o),eu=null,rm=0;var g=o.return;try{if(gC(i,g,o,d,dn)){xs=1,Ep(i,Vr(d,i.current)),Wt=null;return}}catch(y){if(g!==null)throw Wt=g,y;xs=1,Ep(i,Vr(d,i.current)),Wt=null;return}o.flags&32768?(mn||h===1?i=!0:ru||(dn&536870912)!==0?i=!1:(Ml=i=!0,(h===2||h===9||h===3||h===6)&&(h=Qi.current,h!==null&&h.tag===13&&(h.flags|=16384))),SN(o,i)):kp(o)}function kp(i){var o=i;do{if((o.flags&32768)!==0){SN(o,Ml);return}i=o.return;var d=yC(o.alternate,o,$o);if(d!==null){Wt=d;return}if(o=o.sibling,o!==null){Wt=o;return}Wt=o=i}while(o!==null);xs===0&&(xs=5)}function SN(i,o){do{var d=bC(i.alternate,i);if(d!==null){d.flags&=32767,Wt=d;return}if(d=i.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!o&&(i=i.sibling,i!==null)){Wt=i;return}Wt=i=d}while(i!==null);xs=6,Wt=null}function IN(i,o,d,h,g,y,P,G,ae){i.cancelPendingCommit=null;do Op();while(xr!==0);if((In&6)!==0)throw Error(s(327));if(o!==null){if(o===i.current)throw Error(s(177));if(y=o.lanes|o.childLanes,y|=Ah,We(i,d,y,P,G,ae),i===Hn&&(Wt=Hn=null,dn=0),au=o,Ul=i,ou=d,Iy=y,Ty=g,xN=h,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,DC(Un,function(){return RN(),null})):(i.callbackNode=null,i.callbackPriority=0),h=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||h){h=U.T,U.T=null,g=se.p,se.p=2,P=In,In|=4;try{wC(i,o,d)}finally{In=P,se.p=g,U.T=h}}xr=1,TN(),CN(),AN()}}function TN(){if(xr===1){xr=0;var i=Ul,o=au,d=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||d){d=U.T,U.T=null;var h=se.p;se.p=2;var g=In;In|=4;try{dN(o,i);var y=qy,P=jh(i.containerInfo),G=y.focusedElem,ae=y.selectionRange;if(P!==G&&G&&G.ownerDocument&&Zf(G.ownerDocument.documentElement,G)){if(ae!==null&&Vd(G)){var Ae=ae.start,$e=ae.end;if($e===void 0&&($e=Ae),"selectionStart"in G)G.selectionStart=Ae,G.selectionEnd=Math.min($e,G.value.length);else{var Qe=G.ownerDocument||document,Re=Qe&&Qe.defaultView||window;if(Re.getSelection){var Pe=Re.getSelection(),Mt=G.textContent.length,Tt=Math.min(ae.start,Mt),Ln=ae.end===void 0?Tt:Math.min(ae.end,Mt);!Pe.extend&&Tt>Ln&&(P=Ln,Ln=Tt,Tt=P);var ve=Jf(G,Tt),pe=Jf(G,Ln);if(ve&&pe&&(Pe.rangeCount!==1||Pe.anchorNode!==ve.node||Pe.anchorOffset!==ve.offset||Pe.focusNode!==pe.node||Pe.focusOffset!==pe.offset)){var Ce=Qe.createRange();Ce.setStart(ve.node,ve.offset),Pe.removeAllRanges(),Tt>Ln?(Pe.addRange(Ce),Pe.extend(pe.node,pe.offset)):(Ce.setEnd(pe.node,pe.offset),Pe.addRange(Ce))}}}}for(Qe=[],Pe=G;Pe=Pe.parentNode;)Pe.nodeType===1&&Qe.push({element:Pe,left:Pe.scrollLeft,top:Pe.scrollTop});for(typeof G.focus=="function"&&G.focus(),G=0;G<Qe.length;G++){var He=Qe[G];He.element.scrollLeft=He.left,He.element.scrollTop=He.top}}Qp=!!By,qy=By=null}finally{In=g,se.p=h,U.T=d}}i.current=o,xr=2}}function CN(){if(xr===2){xr=0;var i=Ul,o=au,d=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||d){d=U.T,U.T=null;var h=se.p;se.p=2;var g=In;In|=4;try{aN(i,o.alternate,o)}finally{In=g,se.p=h,U.T=d}}xr=3}}function AN(){if(xr===4||xr===3){xr=0,it();var i=Ul,o=au,d=ou,h=xN;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?xr=5:(xr=0,au=Ul=null,DN(i,i.pendingLanes));var g=i.pendingLanes;if(g===0&&(Fl=null),nt(d),o=o.stateNode,Bt&&typeof Bt.onCommitFiberRoot=="function")try{Bt.onCommitFiberRoot(an,o,void 0,(o.current.flags&128)===128)}catch{}if(h!==null){o=U.T,g=se.p,se.p=2,U.T=null;try{for(var y=i.onRecoverableError,P=0;P<h.length;P++){var G=h[P];y(G.value,{componentStack:G.stack})}}finally{U.T=o,se.p=g}}(ou&3)!==0&&Op(),za(i),g=i.pendingLanes,(d&4194090)!==0&&(g&42)!==0?i===Cy?mm++:(mm=0,Cy=i):mm=0,fm(0)}}function DN(i,o){(i.pooledCacheLanes&=o)===0&&(o=i.pooledCache,o!=null&&(i.pooledCache=null,Cl(o)))}function Op(i){return TN(),CN(),AN(),RN()}function RN(){if(xr!==5)return!1;var i=Ul,o=Iy;Iy=0;var d=nt(ou),h=U.T,g=se.p;try{se.p=32>d?32:d,U.T=null,d=Ty,Ty=null;var y=Ul,P=ou;if(xr=0,au=Ul=null,ou=0,(In&6)!==0)throw Error(s(331));var G=In;if(In|=4,pN(y.current),hN(y,y.current,P,d),In=G,fm(0,!1),Bt&&typeof Bt.onPostCommitFiberRoot=="function")try{Bt.onPostCommitFiberRoot(an,y)}catch{}return!0}finally{se.p=g,U.T=h,DN(i,o)}}function PN(i,o,d){o=Vr(d,o),o=oy(i.stateNode,o,2),i=tt(i,o,2),i!==null&&(Te(i,2),za(i))}function zn(i,o,d){if(i.tag===3)PN(i,i,d);else for(;o!==null;){if(o.tag===3){PN(o,i,d);break}else if(o.tag===1){var h=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Fl===null||!Fl.has(h))){i=Vr(d,i),d=Lv(2),h=tt(o,d,2),h!==null&&(Fv(d,h,o,i),Te(h,2),za(h));break}}o=o.return}}function Py(i,o,d){var h=i.pingCache;if(h===null){h=i.pingCache=new jC;var g=new Set;h.set(o,g)}else g=h.get(o),g===void 0&&(g=new Set,h.set(o,g));g.has(d)||(jy=!0,g.add(d),i=TC.bind(null,i,o,d),o.then(i,i))}function TC(i,o,d){var h=i.pingCache;h!==null&&h.delete(o),i.pingedLanes|=i.suspendedLanes&d,i.warmLanes&=~d,Hn===i&&(dn&d)===d&&(xs===4||xs===3&&(dn&62914560)===dn&&300>Nt()-Sy?(In&2)===0&&lu(i,0):_y|=d,iu===dn&&(iu=0)),za(i)}function kN(i,o){o===0&&(o=le()),i=Ir(i,o),i!==null&&(Te(i,o),za(i))}function CC(i){var o=i.memoizedState,d=0;o!==null&&(d=o.retryLane),kN(i,d)}function AC(i,o){var d=0;switch(i.tag){case 13:var h=i.stateNode,g=i.memoizedState;g!==null&&(d=g.retryLane);break;case 19:h=i.stateNode;break;case 22:h=i.stateNode._retryCache;break;default:throw Error(s(314))}h!==null&&h.delete(o),kN(i,d)}function DC(i,o){return ft(i,o)}var Mp=null,du=null,ky=!1,Lp=!1,Oy=!1,Kc=0;function za(i){i!==du&&i.next===null&&(du===null?Mp=du=i:du=du.next=i),Lp=!0,ky||(ky=!0,PC())}function fm(i,o){if(!Oy&&Lp){Oy=!0;do for(var d=!1,h=Mp;h!==null;){if(i!==0){var g=h.pendingLanes;if(g===0)var y=0;else{var P=h.suspendedLanes,G=h.pingedLanes;y=(1<<31-T(42|i)+1)-1,y&=g&~(P&~G),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(d=!0,FN(h,y))}else y=dn,y=pt(h,h===Hn?y:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),(y&3)===0||Vs(h,y)||(d=!0,FN(h,y));h=h.next}while(d);Oy=!1}}function RC(){ON()}function ON(){Lp=ky=!1;var i=0;Kc!==0&&(zC()&&(i=Kc),Kc=0);for(var o=Nt(),d=null,h=Mp;h!==null;){var g=h.next,y=MN(h,o);y===0?(h.next=null,d===null?Mp=g:d.next=g,g===null&&(du=d)):(d=h,(i!==0||(y&3)!==0)&&(Lp=!0)),h=g}fm(i)}function MN(i,o){for(var d=i.suspendedLanes,h=i.pingedLanes,g=i.expirationTimes,y=i.pendingLanes&-62914561;0<y;){var P=31-T(y),G=1<<P,ae=g[P];ae===-1?((G&d)===0||(G&h)!==0)&&(g[P]=Ne(G,o)):ae<=o&&(i.expiredLanes|=G),y&=~G}if(o=Hn,d=dn,d=pt(i,i===o?d:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),h=i.callbackNode,d===0||i===o&&(Tn===2||Tn===9)||i.cancelPendingCommit!==null)return h!==null&&h!==null&&Ot(h),i.callbackNode=null,i.callbackPriority=0;if((d&3)===0||Vs(i,d)){if(o=d&-d,o===i.callbackPriority)return o;switch(h!==null&&Ot(h),nt(d)){case 2:case 8:d=is;break;case 32:d=Un;break;case 268435456:d=yn;break;default:d=Un}return h=LN.bind(null,i),d=ft(d,h),i.callbackPriority=o,i.callbackNode=d,o}return h!==null&&h!==null&&Ot(h),i.callbackPriority=2,i.callbackNode=null,2}function LN(i,o){if(xr!==0&&xr!==5)return i.callbackNode=null,i.callbackPriority=0,null;var d=i.callbackNode;if(Op()&&i.callbackNode!==d)return null;var h=dn;return h=pt(i,i===Hn?h:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),h===0?null:(bN(i,h,o),MN(i,Nt()),i.callbackNode!=null&&i.callbackNode===d?LN.bind(null,i):null)}function FN(i,o){if(Op())return null;bN(i,o,!0)}function PC(){BC(function(){(In&6)!==0?ft(xn,RC):ON()})}function My(){return Kc===0&&(Kc=ue()),Kc}function UN(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:pl(""+i)}function VN(i,o){var d=o.ownerDocument.createElement("input");return d.name=o.name,d.value=o.value,i.id&&d.setAttribute("form",i.id),o.parentNode.insertBefore(d,o),i=new FormData(i),d.parentNode.removeChild(d),i}function kC(i,o,d,h,g){if(o==="submit"&&d&&d.stateNode===g){var y=UN((g[et]||null).action),P=h.submitter;P&&(o=(o=P[et]||null)?UN(o.formAction):P.getAttribute("formAction"),o!==null&&(y=o,P=null));var G=new _a("action","action",null,h,g);i.push({event:G,listeners:[{instance:null,listener:function(){if(h.defaultPrevented){if(Kc!==0){var ae=P?VN(g,P):new FormData(g);ny(d,{pending:!0,data:ae,method:g.method,action:y},null,ae)}}else typeof y=="function"&&(G.preventDefault(),ae=P?VN(g,P):new FormData(g),ny(d,{pending:!0,data:ae,method:g.method,action:y},y,ae))},currentTarget:g}]})}}for(var Ly=0;Ly<Ch.length;Ly++){var Fy=Ch[Ly],OC=Fy.toLowerCase(),MC=Fy[0].toUpperCase()+Fy.slice(1);pi(OC,"on"+MC)}pi(Aa,"onAnimationEnd"),pi(qi,"onAnimationIteration"),pi(Sh,"onAnimationStart"),pi("dblclick","onDoubleClick"),pi("focusin","onFocus"),pi("focusout","onBlur"),pi(Yx,"onTransitionRun"),pi(np,"onTransitionStart"),pi(sp,"onTransitionCancel"),pi(Ih,"onTransitionEnd"),Gr("onMouseEnter",["mouseout","mouseover"]),Gr("onMouseLeave",["mouseout","mouseover"]),Gr("onPointerEnter",["pointerout","pointerover"]),Gr("onPointerLeave",["pointerout","pointerover"]),Vn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Vn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Vn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Vn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Vn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Vn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var pm="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),LC=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(pm));function zN(i,o){o=(o&4)!==0;for(var d=0;d<i.length;d++){var h=i[d],g=h.event;h=h.listeners;e:{var y=void 0;if(o)for(var P=h.length-1;0<=P;P--){var G=h[P],ae=G.instance,Ae=G.currentTarget;if(G=G.listener,ae!==y&&g.isPropagationStopped())break e;y=G,g.currentTarget=Ae;try{y(g)}catch($e){_p($e)}g.currentTarget=null,y=ae}else for(P=0;P<h.length;P++){if(G=h[P],ae=G.instance,Ae=G.currentTarget,G=G.listener,ae!==y&&g.isPropagationStopped())break e;y=G,g.currentTarget=Ae;try{y(g)}catch($e){_p($e)}g.currentTarget=null,y=ae}}}}function Kt(i,o){var d=o[fs];d===void 0&&(d=o[fs]=new Set);var h=i+"__bubble";d.has(h)||($N(o,i,2,!1),d.add(h))}function Uy(i,o,d){var h=0;o&&(h|=4),$N(d,i,h,o)}var Fp="_reactListening"+Math.random().toString(36).slice(2);function Vy(i){if(!i[Fp]){i[Fp]=!0,zs.forEach(function(d){d!=="selectionchange"&&(LC.has(d)||Uy(d,!1,i),Uy(d,!0,i))});var o=i.nodeType===9?i:i.ownerDocument;o===null||o[Fp]||(o[Fp]=!0,Uy("selectionchange",!1,o))}}function $N(i,o,d,h){switch(hj(o)){case 2:var g=dA;break;case 8:g=uA;break;default:g=eb}d=g.bind(null,o,d,i),g=void 0,!Bs||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(g=!0),h?g!==void 0?i.addEventListener(o,d,{capture:!0,passive:g}):i.addEventListener(o,d,!0):g!==void 0?i.addEventListener(o,d,{passive:g}):i.addEventListener(o,d,!1)}function zy(i,o,d,h,g){var y=h;if((o&1)===0&&(o&2)===0&&h!==null)e:for(;;){if(h===null)return;var P=h.tag;if(P===3||P===4){var G=h.stateNode.containerInfo;if(G===g)break;if(P===4)for(P=h.return;P!==null;){var ae=P.tag;if((ae===3||ae===4)&&P.stateNode.containerInfo===g)return;P=P.return}for(;G!==null;){if(P=li(G),P===null)return;if(ae=P.tag,ae===5||ae===6||ae===26||ae===27){h=y=P;continue e}G=G.parentNode}}h=h.return}Ic(function(){var Ae=y,$e=mr(d),Qe=[];e:{var Re=Th.get(i);if(Re!==void 0){var Pe=_a,Mt=i;switch(i){case"keypress":if(zi(d)===0)break e;case"keydown":case"keyup":Pe=No;break;case"focusin":Mt="focus",Pe=xo;break;case"focusout":Mt="blur",Pe=xo;break;case"beforeblur":case"afterblur":Pe=xo;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Pe=qs;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Pe=kd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Pe=Od;break;case Aa:case qi:case Sh:Pe=yo;break;case Ih:Pe=Md;break;case"scroll":case"scrollend":Pe=Cc;break;case"wheel":Pe=bl;break;case"copy":case"cut":case"paste":Pe=bo;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Pe=hi;break;case"toggle":case"beforetoggle":Pe=Oc}var Tt=(o&4)!==0,Ln=!Tt&&(i==="scroll"||i==="scrollend"),ve=Tt?Re!==null?Re+"Capture":null:Re;Tt=[];for(var pe=Ae,Ce;pe!==null;){var He=pe;if(Ce=He.stateNode,He=He.tag,He!==5&&He!==26&&He!==27||Ce===null||ve===null||(He=ja(pe,ve),He!=null&&Tt.push(gm(pe,He,Ce))),Ln)break;pe=pe.return}0<Tt.length&&(Re=new Pe(Re,Mt,null,d,$e),Qe.push({event:Re,listeners:Tt}))}}if((o&7)===0){e:{if(Re=i==="mouseover"||i==="pointerover",Pe=i==="mouseout"||i==="pointerout",Re&&d!==nr&&(Mt=d.relatedTarget||d.fromElement)&&(li(Mt)||Mt[bn]))break e;if((Pe||Re)&&(Re=$e.window===$e?$e:(Re=$e.ownerDocument)?Re.defaultView||Re.parentWindow:window,Pe?(Mt=d.relatedTarget||d.toElement,Pe=Ae,Mt=Mt?li(Mt):null,Mt!==null&&(Ln=l(Mt),Tt=Mt.tag,Mt!==Ln||Tt!==5&&Tt!==27&&Tt!==6)&&(Mt=null)):(Pe=null,Mt=Ae),Pe!==Mt)){if(Tt=qs,He="onMouseLeave",ve="onMouseEnter",pe="mouse",(i==="pointerout"||i==="pointerover")&&(Tt=hi,He="onPointerLeave",ve="onPointerEnter",pe="pointer"),Ln=Pe==null?Re:Ri(Pe),Ce=Mt==null?Re:Ri(Mt),Re=new Tt(He,pe+"leave",Pe,d,$e),Re.target=Ln,Re.relatedTarget=Ce,He=null,li($e)===Ae&&(Tt=new Tt(ve,pe+"enter",Mt,d,$e),Tt.target=Ce,Tt.relatedTarget=Ln,He=Tt),Ln=He,Pe&&Mt)t:{for(Tt=Pe,ve=Mt,pe=0,Ce=Tt;Ce;Ce=uu(Ce))pe++;for(Ce=0,He=ve;He;He=uu(He))Ce++;for(;0<pe-Ce;)Tt=uu(Tt),pe--;for(;0<Ce-pe;)ve=uu(ve),Ce--;for(;pe--;){if(Tt===ve||ve!==null&&Tt===ve.alternate)break t;Tt=uu(Tt),ve=uu(ve)}Tt=null}else Tt=null;Pe!==null&&BN(Qe,Re,Pe,Tt,!1),Mt!==null&&Ln!==null&&BN(Qe,Ln,Mt,Tt,!0)}}e:{if(Re=Ae?Ri(Ae):window,Pe=Re.nodeName&&Re.nodeName.toLowerCase(),Pe==="select"||Pe==="input"&&Re.type==="file")var gt=Gf;else if(_s(Re))if(wh)gt=Xf;else{gt=Kf;var Gt=Wx}else Pe=Re.nodeName,!Pe||Pe.toLowerCase()!=="input"||Re.type!=="checkbox"&&Re.type!=="radio"?Ae&&mo(Ae.elementType)&&(gt=Gf):gt=Yf;if(gt&&(gt=gt(i,Ae))){Es(Qe,gt,d,$e);break e}Gt&&Gt(i,Re,Ae),i==="focusout"&&Ae&&Re.type==="number"&&Ae.memoizedProps.value!=null&&Mi(Re,"number",Re.value)}switch(Gt=Ae?Ri(Ae):window,i){case"focusin":(_s(Gt)||Gt.contentEditable==="true")&&(Nl=Gt,_h=Ae,Lc=null);break;case"focusout":Lc=_h=Nl=null;break;case"mousedown":Eh=!0;break;case"contextmenu":case"mouseup":case"dragend":Eh=!1,ep(Qe,d,$e);break;case"selectionchange":if(Kx)break;case"keydown":case"keyup":ep(Qe,d,$e)}var _t;if(Bi)e:{switch(i){case"compositionstart":var At="onCompositionStart";break e;case"compositionend":At="onCompositionEnd";break e;case"compositionupdate":At="onCompositionUpdate";break e}At=void 0}else Zt?Me(i,d)&&(At="onCompositionEnd"):i==="keydown"&&d.keyCode===229&&(At="onCompositionStart");At&&(A&&d.locale!=="ko"&&(Zt||At!=="onCompositionStart"?At==="onCompositionEnd"&&Zt&&(_t=go()):(di=$e,Vi="value"in di?di.value:di.textContent,Zt=!0)),Gt=Up(Ae,At),0<Gt.length&&(At=new Ac(At,i,null,d,$e),Qe.push({event:At,listeners:Gt}),_t?At.data=_t:(_t=st(d),_t!==null&&(At.data=_t)))),(_t=v?js(i,d):en(i,d))&&(At=Up(Ae,"onBeforeInput"),0<At.length&&(Gt=new Ac("onBeforeInput","beforeinput",null,d,$e),Qe.push({event:Gt,listeners:At}),Gt.data=_t)),kC(Qe,i,Ae,d,$e)}zN(Qe,o)})}function gm(i,o,d){return{instance:i,listener:o,currentTarget:d}}function Up(i,o){for(var d=o+"Capture",h=[];i!==null;){var g=i,y=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||y===null||(g=ja(i,d),g!=null&&h.unshift(gm(i,g,y)),g=ja(i,o),g!=null&&h.push(gm(i,g,y))),i.tag===3)return h;i=i.return}return[]}function uu(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function BN(i,o,d,h,g){for(var y=o._reactName,P=[];d!==null&&d!==h;){var G=d,ae=G.alternate,Ae=G.stateNode;if(G=G.tag,ae!==null&&ae===h)break;G!==5&&G!==26&&G!==27||Ae===null||(ae=Ae,g?(Ae=ja(d,y),Ae!=null&&P.unshift(gm(d,Ae,ae))):g||(Ae=ja(d,y),Ae!=null&&P.push(gm(d,Ae,ae)))),d=d.return}P.length!==0&&i.push({event:o,listeners:P})}var FC=/\r\n?/g,UC=/\u0000|\uFFFD/g;function qN(i){return(typeof i=="string"?i:""+i).replace(FC,`
`).replace(UC,"")}function HN(i,o){return o=qN(o),qN(i)===o}function Vp(){}function Mn(i,o,d,h,g,y){switch(d){case"children":typeof h=="string"?o==="body"||o==="textarea"&&h===""||$s(i,h):(typeof h=="number"||typeof h=="bigint")&&o!=="body"&&$s(i,""+h);break;case"className":ur(i,"class",h);break;case"tabIndex":ur(i,"tabindex",h);break;case"dir":case"role":case"viewBox":case"width":case"height":ur(i,d,h);break;case"style":Fi(i,h,y);break;case"data":if(o!=="object"){ur(i,"data",h);break}case"src":case"href":if(h===""&&(o!=="a"||d!=="href")){i.removeAttribute(d);break}if(h==null||typeof h=="function"||typeof h=="symbol"||typeof h=="boolean"){i.removeAttribute(d);break}h=pl(""+h),i.setAttribute(d,h);break;case"action":case"formAction":if(typeof h=="function"){i.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(d==="formAction"?(o!=="input"&&Mn(i,o,"name",g.name,g,null),Mn(i,o,"formEncType",g.formEncType,g,null),Mn(i,o,"formMethod",g.formMethod,g,null),Mn(i,o,"formTarget",g.formTarget,g,null)):(Mn(i,o,"encType",g.encType,g,null),Mn(i,o,"method",g.method,g,null),Mn(i,o,"target",g.target,g,null)));if(h==null||typeof h=="symbol"||typeof h=="boolean"){i.removeAttribute(d);break}h=pl(""+h),i.setAttribute(d,h);break;case"onClick":h!=null&&(i.onclick=Vp);break;case"onScroll":h!=null&&Kt("scroll",i);break;case"onScrollEnd":h!=null&&Kt("scrollend",i);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(s(61));if(d=h.__html,d!=null){if(g.children!=null)throw Error(s(60));i.innerHTML=d}}break;case"multiple":i.multiple=h&&typeof h!="function"&&typeof h!="symbol";break;case"muted":i.muted=h&&typeof h!="function"&&typeof h!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(h==null||typeof h=="function"||typeof h=="boolean"||typeof h=="symbol"){i.removeAttribute("xlink:href");break}d=pl(""+h),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":h!=null&&typeof h!="function"&&typeof h!="symbol"?i.setAttribute(d,""+h):i.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":h&&typeof h!="function"&&typeof h!="symbol"?i.setAttribute(d,""):i.removeAttribute(d);break;case"capture":case"download":h===!0?i.setAttribute(d,""):h!==!1&&h!=null&&typeof h!="function"&&typeof h!="symbol"?i.setAttribute(d,h):i.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":h!=null&&typeof h!="function"&&typeof h!="symbol"&&!isNaN(h)&&1<=h?i.setAttribute(d,h):i.removeAttribute(d);break;case"rowSpan":case"start":h==null||typeof h=="function"||typeof h=="symbol"||isNaN(h)?i.removeAttribute(d):i.setAttribute(d,h);break;case"popover":Kt("beforetoggle",i),Kt("toggle",i),ki(i,"popover",h);break;case"xlinkActuate":Ps(i,"http://www.w3.org/1999/xlink","xlink:actuate",h);break;case"xlinkArcrole":Ps(i,"http://www.w3.org/1999/xlink","xlink:arcrole",h);break;case"xlinkRole":Ps(i,"http://www.w3.org/1999/xlink","xlink:role",h);break;case"xlinkShow":Ps(i,"http://www.w3.org/1999/xlink","xlink:show",h);break;case"xlinkTitle":Ps(i,"http://www.w3.org/1999/xlink","xlink:title",h);break;case"xlinkType":Ps(i,"http://www.w3.org/1999/xlink","xlink:type",h);break;case"xmlBase":Ps(i,"http://www.w3.org/XML/1998/namespace","xml:base",h);break;case"xmlLang":Ps(i,"http://www.w3.org/XML/1998/namespace","xml:lang",h);break;case"xmlSpace":Ps(i,"http://www.w3.org/XML/1998/namespace","xml:space",h);break;case"is":ki(i,"is",h);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=Rd.get(d)||d,ki(i,d,h))}}function $y(i,o,d,h,g,y){switch(d){case"style":Fi(i,h,y);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(s(61));if(d=h.__html,d!=null){if(g.children!=null)throw Error(s(60));i.innerHTML=d}}break;case"children":typeof h=="string"?$s(i,h):(typeof h=="number"||typeof h=="bigint")&&$s(i,""+h);break;case"onScroll":h!=null&&Kt("scroll",i);break;case"onScrollEnd":h!=null&&Kt("scrollend",i);break;case"onClick":h!=null&&(i.onclick=Vp);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Rs.hasOwnProperty(d))e:{if(d[0]==="o"&&d[1]==="n"&&(g=d.endsWith("Capture"),o=d.slice(2,g?d.length-7:void 0),y=i[et]||null,y=y!=null?y[d]:null,typeof y=="function"&&i.removeEventListener(o,y,g),typeof h=="function")){typeof y!="function"&&y!==null&&(d in i?i[d]=null:i.hasAttribute(d)&&i.removeAttribute(d)),i.addEventListener(o,h,g);break e}d in i?i[d]=h:h===!0?i.setAttribute(d,""):ki(i,d,h)}}}function yr(i,o,d){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Kt("error",i),Kt("load",i);var h=!1,g=!1,y;for(y in d)if(d.hasOwnProperty(y)){var P=d[y];if(P!=null)switch(y){case"src":h=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:Mn(i,o,y,P,d,null)}}g&&Mn(i,o,"srcSet",d.srcSet,d,null),h&&Mn(i,o,"src",d.src,d,null);return;case"input":Kt("invalid",i);var G=y=P=g=null,ae=null,Ae=null;for(h in d)if(d.hasOwnProperty(h)){var $e=d[h];if($e!=null)switch(h){case"name":g=$e;break;case"type":P=$e;break;case"checked":ae=$e;break;case"defaultChecked":Ae=$e;break;case"value":y=$e;break;case"defaultValue":G=$e;break;case"children":case"dangerouslySetInnerHTML":if($e!=null)throw Error(s(137,o));break;default:Mn(i,o,h,$e,d,null)}}sa(i,y,G,ae,Ae,P,g,!1),ho(i);return;case"select":Kt("invalid",i),h=P=y=null;for(g in d)if(d.hasOwnProperty(g)&&(G=d[g],G!=null))switch(g){case"value":y=G;break;case"defaultValue":P=G;break;case"multiple":h=G;default:Mn(i,o,g,G,d,null)}o=y,d=P,i.multiple=!!h,o!=null?ks(i,!!h,o,!1):d!=null&&ks(i,!!h,d,!0);return;case"textarea":Kt("invalid",i),y=g=h=null;for(P in d)if(d.hasOwnProperty(P)&&(G=d[P],G!=null))switch(P){case"value":h=G;break;case"defaultValue":g=G;break;case"children":y=G;break;case"dangerouslySetInnerHTML":if(G!=null)throw Error(s(91));break;default:Mn(i,o,P,G,d,null)}Li(i,h,g,y),ho(i);return;case"option":for(ae in d)if(d.hasOwnProperty(ae)&&(h=d[ae],h!=null))switch(ae){case"selected":i.selected=h&&typeof h!="function"&&typeof h!="symbol";break;default:Mn(i,o,ae,h,d,null)}return;case"dialog":Kt("beforetoggle",i),Kt("toggle",i),Kt("cancel",i),Kt("close",i);break;case"iframe":case"object":Kt("load",i);break;case"video":case"audio":for(h=0;h<pm.length;h++)Kt(pm[h],i);break;case"image":Kt("error",i),Kt("load",i);break;case"details":Kt("toggle",i);break;case"embed":case"source":case"link":Kt("error",i),Kt("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ae in d)if(d.hasOwnProperty(Ae)&&(h=d[Ae],h!=null))switch(Ae){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:Mn(i,o,Ae,h,d,null)}return;default:if(mo(o)){for($e in d)d.hasOwnProperty($e)&&(h=d[$e],h!==void 0&&$y(i,o,$e,h,d,void 0));return}}for(G in d)d.hasOwnProperty(G)&&(h=d[G],h!=null&&Mn(i,o,G,h,d,null))}function VC(i,o,d,h){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,y=null,P=null,G=null,ae=null,Ae=null,$e=null;for(Pe in d){var Qe=d[Pe];if(d.hasOwnProperty(Pe)&&Qe!=null)switch(Pe){case"checked":break;case"value":break;case"defaultValue":ae=Qe;default:h.hasOwnProperty(Pe)||Mn(i,o,Pe,null,h,Qe)}}for(var Re in h){var Pe=h[Re];if(Qe=d[Re],h.hasOwnProperty(Re)&&(Pe!=null||Qe!=null))switch(Re){case"type":y=Pe;break;case"name":g=Pe;break;case"checked":Ae=Pe;break;case"defaultChecked":$e=Pe;break;case"value":P=Pe;break;case"defaultValue":G=Pe;break;case"children":case"dangerouslySetInnerHTML":if(Pe!=null)throw Error(s(137,o));break;default:Pe!==Qe&&Mn(i,o,Re,Pe,h,Qe)}}Bn(i,P,G,ae,Ae,$e,y,g);return;case"select":Pe=P=G=Re=null;for(y in d)if(ae=d[y],d.hasOwnProperty(y)&&ae!=null)switch(y){case"value":break;case"multiple":Pe=ae;default:h.hasOwnProperty(y)||Mn(i,o,y,null,h,ae)}for(g in h)if(y=h[g],ae=d[g],h.hasOwnProperty(g)&&(y!=null||ae!=null))switch(g){case"value":Re=y;break;case"defaultValue":G=y;break;case"multiple":P=y;default:y!==ae&&Mn(i,o,g,y,h,ae)}o=G,d=P,h=Pe,Re!=null?ks(i,!!d,Re,!1):!!h!=!!d&&(o!=null?ks(i,!!d,o,!0):ks(i,!!d,d?[]:"",!1));return;case"textarea":Pe=Re=null;for(G in d)if(g=d[G],d.hasOwnProperty(G)&&g!=null&&!h.hasOwnProperty(G))switch(G){case"value":break;case"children":break;default:Mn(i,o,G,null,h,g)}for(P in h)if(g=h[P],y=d[P],h.hasOwnProperty(P)&&(g!=null||y!=null))switch(P){case"value":Re=g;break;case"defaultValue":Pe=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(s(91));break;default:g!==y&&Mn(i,o,P,g,h,y)}Jt(i,Re,Pe);return;case"option":for(var Mt in d)if(Re=d[Mt],d.hasOwnProperty(Mt)&&Re!=null&&!h.hasOwnProperty(Mt))switch(Mt){case"selected":i.selected=!1;break;default:Mn(i,o,Mt,null,h,Re)}for(ae in h)if(Re=h[ae],Pe=d[ae],h.hasOwnProperty(ae)&&Re!==Pe&&(Re!=null||Pe!=null))switch(ae){case"selected":i.selected=Re&&typeof Re!="function"&&typeof Re!="symbol";break;default:Mn(i,o,ae,Re,h,Pe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Tt in d)Re=d[Tt],d.hasOwnProperty(Tt)&&Re!=null&&!h.hasOwnProperty(Tt)&&Mn(i,o,Tt,null,h,Re);for(Ae in h)if(Re=h[Ae],Pe=d[Ae],h.hasOwnProperty(Ae)&&Re!==Pe&&(Re!=null||Pe!=null))switch(Ae){case"children":case"dangerouslySetInnerHTML":if(Re!=null)throw Error(s(137,o));break;default:Mn(i,o,Ae,Re,h,Pe)}return;default:if(mo(o)){for(var Ln in d)Re=d[Ln],d.hasOwnProperty(Ln)&&Re!==void 0&&!h.hasOwnProperty(Ln)&&$y(i,o,Ln,void 0,h,Re);for($e in h)Re=h[$e],Pe=d[$e],!h.hasOwnProperty($e)||Re===Pe||Re===void 0&&Pe===void 0||$y(i,o,$e,Re,h,Pe);return}}for(var ve in d)Re=d[ve],d.hasOwnProperty(ve)&&Re!=null&&!h.hasOwnProperty(ve)&&Mn(i,o,ve,null,h,Re);for(Qe in h)Re=h[Qe],Pe=d[Qe],!h.hasOwnProperty(Qe)||Re===Pe||Re==null&&Pe==null||Mn(i,o,Qe,Re,h,Pe)}var By=null,qy=null;function zp(i){return i.nodeType===9?i:i.ownerDocument}function GN(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function QN(i,o){if(i===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&o==="foreignObject"?0:i}function Hy(i,o){return i==="textarea"||i==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Gy=null;function zC(){var i=window.event;return i&&i.type==="popstate"?i===Gy?!1:(Gy=i,!0):(Gy=null,!1)}var WN=typeof setTimeout=="function"?setTimeout:void 0,$C=typeof clearTimeout=="function"?clearTimeout:void 0,KN=typeof Promise=="function"?Promise:void 0,BC=typeof queueMicrotask=="function"?queueMicrotask:typeof KN<"u"?function(i){return KN.resolve(null).then(i).catch(qC)}:WN;function qC(i){setTimeout(function(){throw i})}function zl(i){return i==="head"}function YN(i,o){var d=o,h=0,g=0;do{var y=d.nextSibling;if(i.removeChild(d),y&&y.nodeType===8)if(d=y.data,d==="/$"){if(0<h&&8>h){d=h;var P=i.ownerDocument;if(d&1&&xm(P.documentElement),d&2&&xm(P.body),d&4)for(d=P.head,xm(d),P=d.firstChild;P;){var G=P.nextSibling,ae=P.nodeName;P[Ai]||ae==="SCRIPT"||ae==="STYLE"||ae==="LINK"&&P.rel.toLowerCase()==="stylesheet"||d.removeChild(P),P=G}}if(g===0){i.removeChild(y),Em(o);return}g--}else d==="$"||d==="$?"||d==="$!"?g++:h=d.charCodeAt(0)-48;else h=0;d=y}while(d);Em(o)}function Qy(i){var o=i.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var d=o;switch(o=o.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":Qy(d),Na(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}i.removeChild(d)}}function HC(i,o,d,h){for(;i.nodeType===1;){var g=d;if(i.nodeName.toLowerCase()!==o.toLowerCase()){if(!h&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(h){if(!i[Ai])switch(o){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(y=i.getAttribute("rel"),y==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(y!==g.rel||i.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||i.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||i.getAttribute("title")!==(g.title==null?null:g.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(y=i.getAttribute("src"),(y!==(g.src==null?null:g.src)||i.getAttribute("type")!==(g.type==null?null:g.type)||i.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&y&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(o==="input"&&i.type==="hidden"){var y=g.name==null?null:""+g.name;if(g.type==="hidden"&&i.getAttribute("name")===y)return i}else return i;if(i=ma(i.nextSibling),i===null)break}return null}function GC(i,o,d){if(o==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!d||(i=ma(i.nextSibling),i===null))return null;return i}function Wy(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState==="complete"}function QC(i,o){var d=i.ownerDocument;if(i.data!=="$?"||d.readyState==="complete")o();else{var h=function(){o(),d.removeEventListener("DOMContentLoaded",h)};d.addEventListener("DOMContentLoaded",h),i._reactRetry=h}}function ma(i){for(;i!=null;i=i.nextSibling){var o=i.nodeType;if(o===1||o===3)break;if(o===8){if(o=i.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return i}var Ky=null;function XN(i){i=i.previousSibling;for(var o=0;i;){if(i.nodeType===8){var d=i.data;if(d==="$"||d==="$!"||d==="$?"){if(o===0)return i;o--}else d==="/$"&&o++}i=i.previousSibling}return null}function JN(i,o,d){switch(o=zp(d),i){case"html":if(i=o.documentElement,!i)throw Error(s(452));return i;case"head":if(i=o.head,!i)throw Error(s(453));return i;case"body":if(i=o.body,!i)throw Error(s(454));return i;default:throw Error(s(451))}}function xm(i){for(var o=i.attributes;o.length;)i.removeAttributeNode(o[0]);Na(i)}var Ki=new Map,ZN=new Set;function $p(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var Bo=se.d;se.d={f:WC,r:KC,D:YC,C:XC,L:JC,m:ZC,X:tA,S:eA,M:nA};function WC(){var i=Bo.f(),o=Pp();return i||o}function KC(i){var o=Di(i);o!==null&&o.tag===5&&o.type==="form"?bv(o):Bo.r(i)}var hu=typeof document>"u"?null:document;function ej(i,o,d){var h=hu;if(h&&typeof o=="string"&&o){var g=kn(o);g='link[rel="'+i+'"][href="'+g+'"]',typeof d=="string"&&(g+='[crossorigin="'+d+'"]'),ZN.has(g)||(ZN.add(g),i={rel:i,crossOrigin:d,href:o},h.querySelector(g)===null&&(o=h.createElement("link"),yr(o,"link",i),Qt(o),h.head.appendChild(o)))}}function YC(i){Bo.D(i),ej("dns-prefetch",i,null)}function XC(i,o){Bo.C(i,o),ej("preconnect",i,o)}function JC(i,o,d){Bo.L(i,o,d);var h=hu;if(h&&i&&o){var g='link[rel="preload"][as="'+kn(o)+'"]';o==="image"&&d&&d.imageSrcSet?(g+='[imagesrcset="'+kn(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(g+='[imagesizes="'+kn(d.imageSizes)+'"]')):g+='[href="'+kn(i)+'"]';var y=g;switch(o){case"style":y=mu(i);break;case"script":y=fu(i)}Ki.has(y)||(i=b({rel:"preload",href:o==="image"&&d&&d.imageSrcSet?void 0:i,as:o},d),Ki.set(y,i),h.querySelector(g)!==null||o==="style"&&h.querySelector(ym(y))||o==="script"&&h.querySelector(bm(y))||(o=h.createElement("link"),yr(o,"link",i),Qt(o),h.head.appendChild(o)))}}function ZC(i,o){Bo.m(i,o);var d=hu;if(d&&i){var h=o&&typeof o.as=="string"?o.as:"script",g='link[rel="modulepreload"][as="'+kn(h)+'"][href="'+kn(i)+'"]',y=g;switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=fu(i)}if(!Ki.has(y)&&(i=b({rel:"modulepreload",href:i},o),Ki.set(y,i),d.querySelector(g)===null)){switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(bm(y)))return}h=d.createElement("link"),yr(h,"link",i),Qt(h),d.head.appendChild(h)}}}function eA(i,o,d){Bo.S(i,o,d);var h=hu;if(h&&i){var g=ps(h).hoistableStyles,y=mu(i);o=o||"default";var P=g.get(y);if(!P){var G={loading:0,preload:null};if(P=h.querySelector(ym(y)))G.loading=5;else{i=b({rel:"stylesheet",href:i,"data-precedence":o},d),(d=Ki.get(y))&&Yy(i,d);var ae=P=h.createElement("link");Qt(ae),yr(ae,"link",i),ae._p=new Promise(function(Ae,$e){ae.onload=Ae,ae.onerror=$e}),ae.addEventListener("load",function(){G.loading|=1}),ae.addEventListener("error",function(){G.loading|=2}),G.loading|=4,Bp(P,o,h)}P={type:"stylesheet",instance:P,count:1,state:G},g.set(y,P)}}}function tA(i,o){Bo.X(i,o);var d=hu;if(d&&i){var h=ps(d).hoistableScripts,g=fu(i),y=h.get(g);y||(y=d.querySelector(bm(g)),y||(i=b({src:i,async:!0},o),(o=Ki.get(g))&&Xy(i,o),y=d.createElement("script"),Qt(y),yr(y,"link",i),d.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},h.set(g,y))}}function nA(i,o){Bo.M(i,o);var d=hu;if(d&&i){var h=ps(d).hoistableScripts,g=fu(i),y=h.get(g);y||(y=d.querySelector(bm(g)),y||(i=b({src:i,async:!0,type:"module"},o),(o=Ki.get(g))&&Xy(i,o),y=d.createElement("script"),Qt(y),yr(y,"link",i),d.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},h.set(g,y))}}function tj(i,o,d,h){var g=(g=q.current)?$p(g):null;if(!g)throw Error(s(446));switch(i){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(o=mu(d.href),d=ps(g).hoistableStyles,h=d.get(o),h||(h={type:"style",instance:null,count:0,state:null},d.set(o,h)),h):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){i=mu(d.href);var y=ps(g).hoistableStyles,P=y.get(i);if(P||(g=g.ownerDocument||g,P={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(i,P),(y=g.querySelector(ym(i)))&&!y._p&&(P.instance=y,P.state.loading=5),Ki.has(i)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},Ki.set(i,d),y||sA(g,i,d,P.state))),o&&h===null)throw Error(s(528,""));return P}if(o&&h!==null)throw Error(s(529,""));return null;case"script":return o=d.async,d=d.src,typeof d=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=fu(d),d=ps(g).hoistableScripts,h=d.get(o),h||(h={type:"script",instance:null,count:0,state:null},d.set(o,h)),h):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,i))}}function mu(i){return'href="'+kn(i)+'"'}function ym(i){return'link[rel="stylesheet"]['+i+"]"}function nj(i){return b({},i,{"data-precedence":i.precedence,precedence:null})}function sA(i,o,d,h){i.querySelector('link[rel="preload"][as="style"]['+o+"]")?h.loading=1:(o=i.createElement("link"),h.preload=o,o.addEventListener("load",function(){return h.loading|=1}),o.addEventListener("error",function(){return h.loading|=2}),yr(o,"link",d),Qt(o),i.head.appendChild(o))}function fu(i){return'[src="'+kn(i)+'"]'}function bm(i){return"script[async]"+i}function sj(i,o,d){if(o.count++,o.instance===null)switch(o.type){case"style":var h=i.querySelector('style[data-href~="'+kn(d.href)+'"]');if(h)return o.instance=h,Qt(h),h;var g=b({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return h=(i.ownerDocument||i).createElement("style"),Qt(h),yr(h,"style",g),Bp(h,d.precedence,i),o.instance=h;case"stylesheet":g=mu(d.href);var y=i.querySelector(ym(g));if(y)return o.state.loading|=4,o.instance=y,Qt(y),y;h=nj(d),(g=Ki.get(g))&&Yy(h,g),y=(i.ownerDocument||i).createElement("link"),Qt(y);var P=y;return P._p=new Promise(function(G,ae){P.onload=G,P.onerror=ae}),yr(y,"link",h),o.state.loading|=4,Bp(y,d.precedence,i),o.instance=y;case"script":return y=fu(d.src),(g=i.querySelector(bm(y)))?(o.instance=g,Qt(g),g):(h=d,(g=Ki.get(y))&&(h=b({},d),Xy(h,g)),i=i.ownerDocument||i,g=i.createElement("script"),Qt(g),yr(g,"link",h),i.head.appendChild(g),o.instance=g);case"void":return null;default:throw Error(s(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(h=o.instance,o.state.loading|=4,Bp(h,d.precedence,i));return o.instance}function Bp(i,o,d){for(var h=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=h.length?h[h.length-1]:null,y=g,P=0;P<h.length;P++){var G=h[P];if(G.dataset.precedence===o)y=G;else if(y!==g)break}y?y.parentNode.insertBefore(i,y.nextSibling):(o=d.nodeType===9?d.head:d,o.insertBefore(i,o.firstChild))}function Yy(i,o){i.crossOrigin==null&&(i.crossOrigin=o.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=o.referrerPolicy),i.title==null&&(i.title=o.title)}function Xy(i,o){i.crossOrigin==null&&(i.crossOrigin=o.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=o.referrerPolicy),i.integrity==null&&(i.integrity=o.integrity)}var qp=null;function rj(i,o,d){if(qp===null){var h=new Map,g=qp=new Map;g.set(d,h)}else g=qp,h=g.get(d),h||(h=new Map,g.set(d,h));if(h.has(i))return h;for(h.set(i,null),d=d.getElementsByTagName(i),g=0;g<d.length;g++){var y=d[g];if(!(y[Ai]||y[ke]||i==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var P=y.getAttribute(o)||"";P=i+P;var G=h.get(P);G?G.push(y):h.set(P,[y])}}return h}function ij(i,o,d){i=i.ownerDocument||i,i.head.insertBefore(d,o==="title"?i.querySelector("head > title"):null)}function rA(i,o,d){if(d===1||o.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return i=o.disabled,typeof o.precedence=="string"&&i==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function aj(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}var wm=null;function iA(){}function aA(i,o,d){if(wm===null)throw Error(s(475));var h=wm;if(o.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var g=mu(d.href),y=i.querySelector(ym(g));if(y){i=y._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(h.count++,h=Hp.bind(h),i.then(h,h)),o.state.loading|=4,o.instance=y,Qt(y);return}y=i.ownerDocument||i,d=nj(d),(g=Ki.get(g))&&Yy(d,g),y=y.createElement("link"),Qt(y);var P=y;P._p=new Promise(function(G,ae){P.onload=G,P.onerror=ae}),yr(y,"link",d),o.instance=y}h.stylesheets===null&&(h.stylesheets=new Map),h.stylesheets.set(o,i),(i=o.state.preload)&&(o.state.loading&3)===0&&(h.count++,o=Hp.bind(h),i.addEventListener("load",o),i.addEventListener("error",o))}}function oA(){if(wm===null)throw Error(s(475));var i=wm;return i.stylesheets&&i.count===0&&Jy(i,i.stylesheets),0<i.count?function(o){var d=setTimeout(function(){if(i.stylesheets&&Jy(i,i.stylesheets),i.unsuspend){var h=i.unsuspend;i.unsuspend=null,h()}},6e4);return i.unsuspend=o,function(){i.unsuspend=null,clearTimeout(d)}}:null}function Hp(){if(this.count--,this.count===0){if(this.stylesheets)Jy(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var Gp=null;function Jy(i,o){i.stylesheets=null,i.unsuspend!==null&&(i.count++,Gp=new Map,o.forEach(lA,i),Gp=null,Hp.call(i))}function lA(i,o){if(!(o.state.loading&4)){var d=Gp.get(i);if(d)var h=d.get(null);else{d=new Map,Gp.set(i,d);for(var g=i.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<g.length;y++){var P=g[y];(P.nodeName==="LINK"||P.getAttribute("media")!=="not all")&&(d.set(P.dataset.precedence,P),h=P)}h&&d.set(null,h)}g=o.instance,P=g.getAttribute("data-precedence"),y=d.get(P)||h,y===h&&d.set(null,g),d.set(P,g),this.count++,h=Hp.bind(this),g.addEventListener("load",h),g.addEventListener("error",h),y?y.parentNode.insertBefore(g,y.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(g,i.firstChild)),o.state.loading|=4}}var vm={$$typeof:J,Provider:null,Consumer:null,_currentValue:fe,_currentValue2:fe,_threadCount:0};function cA(i,o,d,h,g,y,P,G){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ie(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ie(0),this.hiddenUpdates=Ie(null),this.identifierPrefix=h,this.onUncaughtError=g,this.onCaughtError=y,this.onRecoverableError=P,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=G,this.incompleteTransitions=new Map}function oj(i,o,d,h,g,y,P,G,ae,Ae,$e,Qe){return i=new cA(i,o,d,P,G,ae,Ae,Qe),o=1,y===!0&&(o|=24),y=$r(3,null,null,o),i.current=y,y.stateNode=i,o=Bc(),o.refCount++,i.pooledCache=o,o.refCount++,y.memoizedState={element:h,isDehydrated:d,cache:o},we(y),i}function lj(i){return i?(i=_l,i):_l}function cj(i,o,d,h,g,y){g=lj(g),h.context===null?h.context=g:h.pendingContext=g,h=qe(o),h.payload={element:d},y=y===void 0?null:y,y!==null&&(h.callback=y),d=tt(i,h,o),d!==null&&(Ni(d,i,o),dt(d,i,o))}function dj(i,o){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var d=i.retryLane;i.retryLane=d!==0&&d<o?d:o}}function Zy(i,o){dj(i,o),(i=i.alternate)&&dj(i,o)}function uj(i){if(i.tag===13){var o=Ir(i,67108864);o!==null&&Ni(o,i,67108864),Zy(i,67108864)}}var Qp=!0;function dA(i,o,d,h){var g=U.T;U.T=null;var y=se.p;try{se.p=2,eb(i,o,d,h)}finally{se.p=y,U.T=g}}function uA(i,o,d,h){var g=U.T;U.T=null;var y=se.p;try{se.p=8,eb(i,o,d,h)}finally{se.p=y,U.T=g}}function eb(i,o,d,h){if(Qp){var g=tb(h);if(g===null)zy(i,o,h,Wp,d),mj(i,h);else if(mA(g,i,o,d,h))h.stopPropagation();else if(mj(i,h),o&4&&-1<hA.indexOf(i)){for(;g!==null;){var y=Di(g);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var P=bt(y.pendingLanes);if(P!==0){var G=y;for(G.pendingLanes|=2,G.entangledLanes|=2;P;){var ae=1<<31-T(P);G.entanglements[1]|=ae,P&=~ae}za(y),(In&6)===0&&(Dp=Nt()+500,fm(0))}}break;case 13:G=Ir(y,2),G!==null&&Ni(G,y,2),Pp(),Zy(y,2)}if(y=tb(h),y===null&&zy(i,o,h,Wp,d),y===g)break;g=y}g!==null&&h.stopPropagation()}else zy(i,o,h,null,d)}}function tb(i){return i=mr(i),nb(i)}var Wp=null;function nb(i){if(Wp=null,i=li(i),i!==null){var o=l(i);if(o===null)i=null;else{var d=o.tag;if(d===13){if(i=c(o),i!==null)return i;i=null}else if(d===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null)}}return Wp=i,null}function hj(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(hn()){case xn:return 2;case is:return 8;case Un:case Xt:return 32;case yn:return 268435456;default:return 32}default:return 32}}var sb=!1,$l=null,Bl=null,ql=null,Nm=new Map,jm=new Map,Hl=[],hA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function mj(i,o){switch(i){case"focusin":case"focusout":$l=null;break;case"dragenter":case"dragleave":Bl=null;break;case"mouseover":case"mouseout":ql=null;break;case"pointerover":case"pointerout":Nm.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":jm.delete(o.pointerId)}}function _m(i,o,d,h,g,y){return i===null||i.nativeEvent!==y?(i={blockedOn:o,domEventName:d,eventSystemFlags:h,nativeEvent:y,targetContainers:[g]},o!==null&&(o=Di(o),o!==null&&uj(o)),i):(i.eventSystemFlags|=h,o=i.targetContainers,g!==null&&o.indexOf(g)===-1&&o.push(g),i)}function mA(i,o,d,h,g){switch(o){case"focusin":return $l=_m($l,i,o,d,h,g),!0;case"dragenter":return Bl=_m(Bl,i,o,d,h,g),!0;case"mouseover":return ql=_m(ql,i,o,d,h,g),!0;case"pointerover":var y=g.pointerId;return Nm.set(y,_m(Nm.get(y)||null,i,o,d,h,g)),!0;case"gotpointercapture":return y=g.pointerId,jm.set(y,_m(jm.get(y)||null,i,o,d,h,g)),!0}return!1}function fj(i){var o=li(i.target);if(o!==null){var d=l(o);if(d!==null){if(o=d.tag,o===13){if(o=c(d),o!==null){i.blockedOn=o,Je(i.priority,function(){if(d.tag===13){var h=vi();h=Oe(h);var g=Ir(d,h);g!==null&&Ni(g,d,h),Zy(d,h)}});return}}else if(o===3&&d.stateNode.current.memoizedState.isDehydrated){i.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Kp(i){if(i.blockedOn!==null)return!1;for(var o=i.targetContainers;0<o.length;){var d=tb(i.nativeEvent);if(d===null){d=i.nativeEvent;var h=new d.constructor(d.type,d);nr=h,d.target.dispatchEvent(h),nr=null}else return o=Di(d),o!==null&&uj(o),i.blockedOn=d,!1;o.shift()}return!0}function pj(i,o,d){Kp(i)&&d.delete(o)}function fA(){sb=!1,$l!==null&&Kp($l)&&($l=null),Bl!==null&&Kp(Bl)&&(Bl=null),ql!==null&&Kp(ql)&&(ql=null),Nm.forEach(pj),jm.forEach(pj)}function Yp(i,o){i.blockedOn===o&&(i.blockedOn=null,sb||(sb=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,fA)))}var Xp=null;function gj(i){Xp!==i&&(Xp=i,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){Xp===i&&(Xp=null);for(var o=0;o<i.length;o+=3){var d=i[o],h=i[o+1],g=i[o+2];if(typeof h!="function"){if(nb(h||d)===null)continue;break}var y=Di(d);y!==null&&(i.splice(o,3),o-=3,ny(y,{pending:!0,data:g,method:d.method,action:h},h,g))}}))}function Em(i){function o(ae){return Yp(ae,i)}$l!==null&&Yp($l,i),Bl!==null&&Yp(Bl,i),ql!==null&&Yp(ql,i),Nm.forEach(o),jm.forEach(o);for(var d=0;d<Hl.length;d++){var h=Hl[d];h.blockedOn===i&&(h.blockedOn=null)}for(;0<Hl.length&&(d=Hl[0],d.blockedOn===null);)fj(d),d.blockedOn===null&&Hl.shift();if(d=(i.ownerDocument||i).$$reactFormReplay,d!=null)for(h=0;h<d.length;h+=3){var g=d[h],y=d[h+1],P=g[et]||null;if(typeof y=="function")P||gj(d);else if(P){var G=null;if(y&&y.hasAttribute("formAction")){if(g=y,P=y[et]||null)G=P.formAction;else if(nb(g)!==null)continue}else G=P.action;typeof G=="function"?d[h+1]=G:(d.splice(h,3),h-=3),gj(d)}}}function rb(i){this._internalRoot=i}Jp.prototype.render=rb.prototype.render=function(i){var o=this._internalRoot;if(o===null)throw Error(s(409));var d=o.current,h=vi();cj(d,h,i,o,null,null)},Jp.prototype.unmount=rb.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var o=i.containerInfo;cj(i.current,2,null,i,null,null),Pp(),o[bn]=null}};function Jp(i){this._internalRoot=i}Jp.prototype.unstable_scheduleHydration=function(i){if(i){var o=Ze();i={blockedOn:null,target:i,priority:o};for(var d=0;d<Hl.length&&o!==0&&o<Hl[d].priority;d++);Hl.splice(d,0,i),d===0&&fj(i)}};var xj=e.version;if(xj!=="19.1.1")throw Error(s(527,xj,"19.1.1"));se.findDOMNode=function(i){var o=i._reactInternals;if(o===void 0)throw typeof i.render=="function"?Error(s(188)):(i=Object.keys(i).join(","),Error(s(268,i)));return i=m(o),i=i!==null?p(i):null,i=i===null?null:i.stateNode,i};var pA={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:U,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zp.isDisabled&&Zp.supportsFiber)try{an=Zp.inject(pA),Bt=Zp}catch{}}return Im.createRoot=function(i,o){if(!a(i))throw Error(s(299));var d=!1,h="",g=Pv,y=kv,P=Ov,G=null;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(h=o.identifierPrefix),o.onUncaughtError!==void 0&&(g=o.onUncaughtError),o.onCaughtError!==void 0&&(y=o.onCaughtError),o.onRecoverableError!==void 0&&(P=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(G=o.unstable_transitionCallbacks)),o=oj(i,1,!1,null,null,d,h,g,y,P,G,null),i[bn]=o.current,Vy(i),new rb(o)},Im.hydrateRoot=function(i,o,d){if(!a(i))throw Error(s(299));var h=!1,g="",y=Pv,P=kv,G=Ov,ae=null,Ae=null;return d!=null&&(d.unstable_strictMode===!0&&(h=!0),d.identifierPrefix!==void 0&&(g=d.identifierPrefix),d.onUncaughtError!==void 0&&(y=d.onUncaughtError),d.onCaughtError!==void 0&&(P=d.onCaughtError),d.onRecoverableError!==void 0&&(G=d.onRecoverableError),d.unstable_transitionCallbacks!==void 0&&(ae=d.unstable_transitionCallbacks),d.formState!==void 0&&(Ae=d.formState)),o=oj(i,1,!0,o,d??null,h,g,y,P,G,ae,Ae),o.context=lj(null),d=o.current,h=vi(),h=Oe(h),g=qe(h),g.callback=null,tt(d,g,h),d=h,o.current.lanes=d,Te(o,d),za(o),i[bn]=o.current,Vy(i),new Jp(o)},Im.version="19.1.1",Im}var Ij;function EA(){if(Ij)return ob.exports;Ij=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),ob.exports=_A(),ob.exports}var SA=EA();const IA=GE(SA);/**
 * react-router v7.7.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Tj="popstate";function TA(r={}){function e(s,a){let{pathname:l,search:c,hash:u}=s.location;return Lb("",{pathname:l,search:c,hash:u},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function t(s,a){return typeof a=="string"?a:sf(a)}return AA(e,t,null,r)}function us(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function no(r,e){if(!r){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function CA(){return Math.random().toString(36).substring(2,10)}function Cj(r,e){return{usr:r.state,key:r.key,idx:e}}function Lb(r,e,t=null,s){return{pathname:typeof r=="string"?r:r.pathname,search:"",hash:"",...typeof e=="string"?ih(e):e,state:t,key:e&&e.key||s||CA()}}function sf({pathname:r="/",search:e="",hash:t=""}){return e&&e!=="?"&&(r+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(r+=t.charAt(0)==="#"?t:"#"+t),r}function ih(r){let e={};if(r){let t=r.indexOf("#");t>=0&&(e.hash=r.substring(t),r=r.substring(0,t));let s=r.indexOf("?");s>=0&&(e.search=r.substring(s),r=r.substring(0,s)),r&&(e.pathname=r)}return e}function AA(r,e,t,s={}){let{window:a=document.defaultView,v5Compat:l=!1}=s,c=a.history,u="POP",m=null,p=b();p==null&&(p=0,c.replaceState({...c.state,idx:p},""));function b(){return(c.state||{idx:null}).idx}function w(){u="POP";let z=b(),I=z==null?null:z-p;p=z,m&&m({action:u,location:Q.location,delta:I})}function j(z,I){u="PUSH";let ee=Lb(Q.location,z,I);p=b()+1;let J=Cj(ee,p),oe=Q.createHref(ee);try{c.pushState(J,"",oe)}catch(Y){if(Y instanceof DOMException&&Y.name==="DataCloneError")throw Y;a.location.assign(oe)}l&&m&&m({action:u,location:Q.location,delta:1})}function D(z,I){u="REPLACE";let ee=Lb(Q.location,z,I);p=b();let J=Cj(ee,p),oe=Q.createHref(ee);c.replaceState(J,"",oe),l&&m&&m({action:u,location:Q.location,delta:0})}function O(z){return DA(z)}let Q={get action(){return u},get location(){return r(a,c)},listen(z){if(m)throw new Error("A history only accepts one active listener");return a.addEventListener(Tj,w),m=z,()=>{a.removeEventListener(Tj,w),m=null}},createHref(z){return e(a,z)},createURL:O,encodeLocation(z){let I=O(z);return{pathname:I.pathname,search:I.search,hash:I.hash}},push:j,replace:D,go(z){return c.go(z)}};return Q}function DA(r,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),us(t,"No window.location.(origin|href) available to create URL");let s=typeof r=="string"?r:sf(r);return s=s.replace(/ $/,"%20"),!e&&s.startsWith("//")&&(s=t+s),new URL(s,t)}function QE(r,e,t="/"){return RA(r,e,t,!1)}function RA(r,e,t,s){let a=typeof e=="string"?ih(e):e,l=Zo(a.pathname||"/",t);if(l==null)return null;let c=WE(r);PA(c);let u=null;for(let m=0;u==null&&m<c.length;++m){let p=qA(l);u=$A(c[m],p,s)}return u}function WE(r,e=[],t=[],s=""){let a=(l,c,u)=>{let m={relativePath:u===void 0?l.path||"":u,caseSensitive:l.caseSensitive===!0,childrenIndex:c,route:l};m.relativePath.startsWith("/")&&(us(m.relativePath.startsWith(s),`Absolute route path "${m.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),m.relativePath=m.relativePath.slice(s.length));let p=Yo([s,m.relativePath]),b=t.concat(m);l.children&&l.children.length>0&&(us(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${p}".`),WE(l.children,e,b,p)),!(l.path==null&&!l.index)&&e.push({path:p,score:VA(p,l.index),routesMeta:b})};return r.forEach((l,c)=>{if(l.path===""||!l.path?.includes("?"))a(l,c);else for(let u of KE(l.path))a(l,c,u)}),e}function KE(r){let e=r.split("/");if(e.length===0)return[];let[t,...s]=e,a=t.endsWith("?"),l=t.replace(/\?$/,"");if(s.length===0)return a?[l,""]:[l];let c=KE(s.join("/")),u=[];return u.push(...c.map(m=>m===""?l:[l,m].join("/"))),a&&u.push(...c),u.map(m=>r.startsWith("/")&&m===""?"/":m)}function PA(r){r.sort((e,t)=>e.score!==t.score?t.score-e.score:zA(e.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}var kA=/^:[\w-]+$/,OA=3,MA=2,LA=1,FA=10,UA=-2,Aj=r=>r==="*";function VA(r,e){let t=r.split("/"),s=t.length;return t.some(Aj)&&(s+=UA),e&&(s+=MA),t.filter(a=>!Aj(a)).reduce((a,l)=>a+(kA.test(l)?OA:l===""?LA:FA),s)}function zA(r,e){return r.length===e.length&&r.slice(0,-1).every((s,a)=>s===e[a])?r[r.length-1]-e[e.length-1]:0}function $A(r,e,t=!1){let{routesMeta:s}=r,a={},l="/",c=[];for(let u=0;u<s.length;++u){let m=s[u],p=u===s.length-1,b=l==="/"?e:e.slice(l.length)||"/",w=Pg({path:m.relativePath,caseSensitive:m.caseSensitive,end:p},b),j=m.route;if(!w&&p&&t&&!s[s.length-1].route.index&&(w=Pg({path:m.relativePath,caseSensitive:m.caseSensitive,end:!1},b)),!w)return null;Object.assign(a,w.params),c.push({params:a,pathname:Yo([l,w.pathname]),pathnameBase:WA(Yo([l,w.pathnameBase])),route:j}),w.pathnameBase!=="/"&&(l=Yo([l,w.pathnameBase]))}return c}function Pg(r,e){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[t,s]=BA(r.path,r.caseSensitive,r.end),a=e.match(t);if(!a)return null;let l=a[0],c=l.replace(/(.)\/+$/,"$1"),u=a.slice(1);return{params:s.reduce((p,{paramName:b,isOptional:w},j)=>{if(b==="*"){let O=u[j]||"";c=l.slice(0,l.length-O.length).replace(/(.)\/+$/,"$1")}const D=u[j];return w&&!D?p[b]=void 0:p[b]=(D||"").replace(/%2F/g,"/"),p},{}),pathname:l,pathnameBase:c,pattern:r}}function BA(r,e=!1,t=!0){no(r==="*"||!r.endsWith("*")||r.endsWith("/*"),`Route path "${r}" will be treated as if it were "${r.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${r.replace(/\*$/,"/*")}".`);let s=[],a="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,u,m)=>(s.push({paramName:u,isOptional:m!=null}),m?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(s.push({paramName:"*"}),a+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?a+="\\/*$":r!==""&&r!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,e?void 0:"i"),s]}function qA(r){try{return r.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return no(!1,`The URL path "${r}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),r}}function Zo(r,e){if(e==="/")return r;if(!r.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=r.charAt(t);return s&&s!=="/"?null:r.slice(t)||"/"}function HA(r,e="/"){let{pathname:t,search:s="",hash:a=""}=typeof r=="string"?ih(r):r;return{pathname:t?t.startsWith("/")?t:GA(t,e):e,search:KA(s),hash:YA(a)}}function GA(r,e){let t=e.replace(/\/+$/,"").split("/");return r.split("/").forEach(a=>{a===".."?t.length>1&&t.pop():a!=="."&&t.push(a)}),t.length>1?t.join("/"):"/"}function ub(r,e,t,s){return`Cannot include a '${r}' character in a manually specified \`to.${e}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function QA(r){return r.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function YE(r){let e=QA(r);return e.map((t,s)=>s===e.length-1?t.pathname:t.pathnameBase)}function XE(r,e,t,s=!1){let a;typeof r=="string"?a=ih(r):(a={...r},us(!a.pathname||!a.pathname.includes("?"),ub("?","pathname","search",a)),us(!a.pathname||!a.pathname.includes("#"),ub("#","pathname","hash",a)),us(!a.search||!a.search.includes("#"),ub("#","search","hash",a)));let l=r===""||a.pathname==="",c=l?"/":a.pathname,u;if(c==null)u=t;else{let w=e.length-1;if(!s&&c.startsWith("..")){let j=c.split("/");for(;j[0]==="..";)j.shift(),w-=1;a.pathname=j.join("/")}u=w>=0?e[w]:"/"}let m=HA(a,u),p=c&&c!=="/"&&c.endsWith("/"),b=(l||c===".")&&t.endsWith("/");return!m.pathname.endsWith("/")&&(p||b)&&(m.pathname+="/"),m}var Yo=r=>r.join("/").replace(/\/\/+/g,"/"),WA=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),KA=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,YA=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function XA(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}var JE=["POST","PUT","PATCH","DELETE"];new Set(JE);var JA=["GET",...JE];new Set(JA);var ah=N.createContext(null);ah.displayName="DataRouter";var ux=N.createContext(null);ux.displayName="DataRouterState";N.createContext(!1);var ZE=N.createContext({isTransitioning:!1});ZE.displayName="ViewTransition";var ZA=N.createContext(new Map);ZA.displayName="Fetchers";var e2=N.createContext(null);e2.displayName="Await";var ro=N.createContext(null);ro.displayName="Navigation";var jf=N.createContext(null);jf.displayName="Location";var io=N.createContext({outlet:null,matches:[],isDataRoute:!1});io.displayName="Route";var I0=N.createContext(null);I0.displayName="RouteError";function t2(r,{relative:e}={}){us(_f(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:s}=N.useContext(ro),{hash:a,pathname:l,search:c}=Ef(r,{relative:e}),u=l;return t!=="/"&&(u=l==="/"?t:Yo([t,l])),s.createHref({pathname:u,search:c,hash:a})}function _f(){return N.useContext(jf)!=null}function il(){return us(_f(),"useLocation() may be used only in the context of a <Router> component."),N.useContext(jf).location}var eS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function tS(r){N.useContext(ro).static||N.useLayoutEffect(r)}function ms(){let{isDataRoute:r}=N.useContext(io);return r?f2():n2()}function n2(){us(_f(),"useNavigate() may be used only in the context of a <Router> component.");let r=N.useContext(ah),{basename:e,navigator:t}=N.useContext(ro),{matches:s}=N.useContext(io),{pathname:a}=il(),l=JSON.stringify(YE(s)),c=N.useRef(!1);return tS(()=>{c.current=!0}),N.useCallback((m,p={})=>{if(no(c.current,eS),!c.current)return;if(typeof m=="number"){t.go(m);return}let b=XE(m,JSON.parse(l),a,p.relative==="path");r==null&&e!=="/"&&(b.pathname=b.pathname==="/"?e:Yo([e,b.pathname])),(p.replace?t.replace:t.push)(b,p.state,p)},[e,t,l,a,r])}N.createContext(null);function ea(){let{matches:r}=N.useContext(io),e=r[r.length-1];return e?e.params:{}}function Ef(r,{relative:e}={}){let{matches:t}=N.useContext(io),{pathname:s}=il(),a=JSON.stringify(YE(t));return N.useMemo(()=>XE(r,JSON.parse(a),s,e==="path"),[r,a,s,e])}function s2(r,e){return nS(r,e)}function nS(r,e,t,s){us(_f(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:a}=N.useContext(ro),{matches:l}=N.useContext(io),c=l[l.length-1],u=c?c.params:{},m=c?c.pathname:"/",p=c?c.pathnameBase:"/",b=c&&c.route;{let I=b&&b.path||"";sS(m,!b||I.endsWith("*")||I.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${I}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${I}"> to <Route path="${I==="/"?"*":`${I}/*`}">.`)}let w=il(),j;if(e){let I=typeof e=="string"?ih(e):e;us(p==="/"||I.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${I.pathname}" was given in the \`location\` prop.`),j=I}else j=w;let D=j.pathname||"/",O=D;if(p!=="/"){let I=p.replace(/^\//,"").split("/");O="/"+D.replace(/^\//,"").split("/").slice(I.length).join("/")}let Q=QE(r,{pathname:O});no(b||Q!=null,`No routes matched location "${j.pathname}${j.search}${j.hash}" `),no(Q==null||Q[Q.length-1].route.element!==void 0||Q[Q.length-1].route.Component!==void 0||Q[Q.length-1].route.lazy!==void 0,`Matched leaf route at location "${j.pathname}${j.search}${j.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let z=l2(Q&&Q.map(I=>Object.assign({},I,{params:Object.assign({},u,I.params),pathname:Yo([p,a.encodeLocation?a.encodeLocation(I.pathname).pathname:I.pathname]),pathnameBase:I.pathnameBase==="/"?p:Yo([p,a.encodeLocation?a.encodeLocation(I.pathnameBase).pathname:I.pathnameBase])})),l,t,s);return e&&z?N.createElement(jf.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...j},navigationType:"POP"}},z):z}function r2(){let r=m2(),e=XA(r)?`${r.status} ${r.statusText}`:r instanceof Error?r.message:JSON.stringify(r),t=r instanceof Error?r.stack:null,s="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:s},l={padding:"2px 4px",backgroundColor:s},c=null;return console.error("Error handled by React Router default ErrorBoundary:",r),c=N.createElement(N.Fragment,null,N.createElement("p",null,"💿 Hey developer 👋"),N.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",N.createElement("code",{style:l},"ErrorBoundary")," or"," ",N.createElement("code",{style:l},"errorElement")," prop on your route.")),N.createElement(N.Fragment,null,N.createElement("h2",null,"Unexpected Application Error!"),N.createElement("h3",{style:{fontStyle:"italic"}},e),t?N.createElement("pre",{style:a},t):null,c)}var i2=N.createElement(r2,null),a2=class extends N.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,e){return e.location!==r.location||e.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:e.error,location:e.location,revalidation:r.revalidation||e.revalidation}}componentDidCatch(r,e){console.error("React Router caught the following error during render",r,e)}render(){return this.state.error!==void 0?N.createElement(io.Provider,{value:this.props.routeContext},N.createElement(I0.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function o2({routeContext:r,match:e,children:t}){let s=N.useContext(ah);return s&&s.static&&s.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=e.route.id),N.createElement(io.Provider,{value:r},t)}function l2(r,e=[],t=null,s=null){if(r==null){if(!t)return null;if(t.errors)r=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)r=t.matches;else return null}let a=r,l=t?.errors;if(l!=null){let m=a.findIndex(p=>p.route.id&&l?.[p.route.id]!==void 0);us(m>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),a=a.slice(0,Math.min(a.length,m+1))}let c=!1,u=-1;if(t)for(let m=0;m<a.length;m++){let p=a[m];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(u=m),p.route.id){let{loaderData:b,errors:w}=t,j=p.route.loader&&!b.hasOwnProperty(p.route.id)&&(!w||w[p.route.id]===void 0);if(p.route.lazy||j){c=!0,u>=0?a=a.slice(0,u+1):a=[a[0]];break}}}return a.reduceRight((m,p,b)=>{let w,j=!1,D=null,O=null;t&&(w=l&&p.route.id?l[p.route.id]:void 0,D=p.route.errorElement||i2,c&&(u<0&&b===0?(sS("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),j=!0,O=null):u===b&&(j=!0,O=p.route.hydrateFallbackElement||null)));let Q=e.concat(a.slice(0,b+1)),z=()=>{let I;return w?I=D:j?I=O:p.route.Component?I=N.createElement(p.route.Component,null):p.route.element?I=p.route.element:I=m,N.createElement(o2,{match:p,routeContext:{outlet:m,matches:Q,isDataRoute:t!=null},children:I})};return t&&(p.route.ErrorBoundary||p.route.errorElement||b===0)?N.createElement(a2,{location:t.location,revalidation:t.revalidation,component:D,error:w,children:z(),routeContext:{outlet:null,matches:Q,isDataRoute:!0}}):z()},null)}function T0(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function c2(r){let e=N.useContext(ah);return us(e,T0(r)),e}function d2(r){let e=N.useContext(ux);return us(e,T0(r)),e}function u2(r){let e=N.useContext(io);return us(e,T0(r)),e}function C0(r){let e=u2(r),t=e.matches[e.matches.length-1];return us(t.route.id,`${r} can only be used on routes that contain a unique "id"`),t.route.id}function h2(){return C0("useRouteId")}function m2(){let r=N.useContext(I0),e=d2("useRouteError"),t=C0("useRouteError");return r!==void 0?r:e.errors?.[t]}function f2(){let{router:r}=c2("useNavigate"),e=C0("useNavigate"),t=N.useRef(!1);return tS(()=>{t.current=!0}),N.useCallback(async(a,l={})=>{no(t.current,eS),t.current&&(typeof a=="number"?r.navigate(a):await r.navigate(a,{fromRouteId:e,...l}))},[r,e])}var Dj={};function sS(r,e,t){!e&&!Dj[r]&&(Dj[r]=!0,no(!1,t))}N.memo(p2);function p2({routes:r,future:e,state:t}){return nS(r,void 0,t,e)}function pn(r){us(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function g2({basename:r="/",children:e=null,location:t,navigationType:s="POP",navigator:a,static:l=!1}){us(!_f(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let c=r.replace(/^\/*/,"/"),u=N.useMemo(()=>({basename:c,navigator:a,static:l,future:{}}),[c,a,l]);typeof t=="string"&&(t=ih(t));let{pathname:m="/",search:p="",hash:b="",state:w=null,key:j="default"}=t,D=N.useMemo(()=>{let O=Zo(m,c);return O==null?null:{location:{pathname:O,search:p,hash:b,state:w,key:j},navigationType:s}},[c,m,p,b,w,j,s]);return no(D!=null,`<Router basename="${c}"> is not able to match the URL "${m}${p}${b}" because it does not start with the basename, so the <Router> won't render anything.`),D==null?null:N.createElement(ro.Provider,{value:u},N.createElement(jf.Provider,{children:e,value:D}))}function x2({children:r,location:e}){return s2(Fb(r),e)}function Fb(r,e=[]){let t=[];return N.Children.forEach(r,(s,a)=>{if(!N.isValidElement(s))return;let l=[...e,a];if(s.type===N.Fragment){t.push.apply(t,Fb(s.props.children,l));return}us(s.type===pn,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),us(!s.props.index||!s.props.children,"An index route cannot have child routes.");let c={id:s.props.id||l.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(c.children=Fb(s.props.children,l)),t.push(c)}),t}var hg="get",mg="application/x-www-form-urlencoded";function hx(r){return r!=null&&typeof r.tagName=="string"}function y2(r){return hx(r)&&r.tagName.toLowerCase()==="button"}function b2(r){return hx(r)&&r.tagName.toLowerCase()==="form"}function w2(r){return hx(r)&&r.tagName.toLowerCase()==="input"}function v2(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function N2(r,e){return r.button===0&&(!e||e==="_self")&&!v2(r)}var eg=null;function j2(){if(eg===null)try{new FormData(document.createElement("form"),0),eg=!1}catch{eg=!0}return eg}var _2=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function hb(r){return r!=null&&!_2.has(r)?(no(!1,`"${r}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${mg}"`),null):r}function E2(r,e){let t,s,a,l,c;if(b2(r)){let u=r.getAttribute("action");s=u?Zo(u,e):null,t=r.getAttribute("method")||hg,a=hb(r.getAttribute("enctype"))||mg,l=new FormData(r)}else if(y2(r)||w2(r)&&(r.type==="submit"||r.type==="image")){let u=r.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let m=r.getAttribute("formaction")||u.getAttribute("action");if(s=m?Zo(m,e):null,t=r.getAttribute("formmethod")||u.getAttribute("method")||hg,a=hb(r.getAttribute("formenctype"))||hb(u.getAttribute("enctype"))||mg,l=new FormData(u,r),!j2()){let{name:p,type:b,value:w}=r;if(b==="image"){let j=p?`${p}.`:"";l.append(`${j}x`,"0"),l.append(`${j}y`,"0")}else p&&l.append(p,w)}}else{if(hx(r))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=hg,s=null,a=mg,c=r}return l&&a==="text/plain"&&(c=l,l=void 0),{action:s,method:t.toLowerCase(),encType:a,formData:l,body:c}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function A0(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function S2(r,e,t){let s=typeof r=="string"?new URL(r,typeof window>"u"?"server://singlefetch/":window.location.origin):r;return s.pathname==="/"?s.pathname=`_root.${t}`:e&&Zo(s.pathname,e)==="/"?s.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:s.pathname=`${s.pathname.replace(/\/$/,"")}.${t}`,s}async function I2(r,e){if(r.id in e)return e[r.id];try{let t=await import(r.module);return e[r.id]=t,t}catch(t){return console.error(`Error loading route module \`${r.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function T2(r){return r==null?!1:r.href==null?r.rel==="preload"&&typeof r.imageSrcSet=="string"&&typeof r.imageSizes=="string":typeof r.rel=="string"&&typeof r.href=="string"}async function C2(r,e,t){let s=await Promise.all(r.map(async a=>{let l=e.routes[a.route.id];if(l){let c=await I2(l,t);return c.links?c.links():[]}return[]}));return P2(s.flat(1).filter(T2).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function Rj(r,e,t,s,a,l){let c=(m,p)=>t[p]?m.route.id!==t[p].route.id:!0,u=(m,p)=>t[p].pathname!==m.pathname||t[p].route.path?.endsWith("*")&&t[p].params["*"]!==m.params["*"];return l==="assets"?e.filter((m,p)=>c(m,p)||u(m,p)):l==="data"?e.filter((m,p)=>{let b=s.routes[m.route.id];if(!b||!b.hasLoader)return!1;if(c(m,p)||u(m,p))return!0;if(m.route.shouldRevalidate){let w=m.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(r,window.origin),nextParams:m.params,defaultShouldRevalidate:!0});if(typeof w=="boolean")return w}return!0}):[]}function A2(r,e,{includeHydrateFallback:t}={}){return D2(r.map(s=>{let a=e.routes[s.route.id];if(!a)return[];let l=[a.module];return a.clientActionModule&&(l=l.concat(a.clientActionModule)),a.clientLoaderModule&&(l=l.concat(a.clientLoaderModule)),t&&a.hydrateFallbackModule&&(l=l.concat(a.hydrateFallbackModule)),a.imports&&(l=l.concat(a.imports)),l}).flat(1))}function D2(r){return[...new Set(r)]}function R2(r){let e={},t=Object.keys(r).sort();for(let s of t)e[s]=r[s];return e}function P2(r,e){let t=new Set;return new Set(e),r.reduce((s,a)=>{let l=JSON.stringify(R2(a));return t.has(l)||(t.add(l),s.push({key:l,link:a})),s},[])}function rS(){let r=N.useContext(ah);return A0(r,"You must render this element inside a <DataRouterContext.Provider> element"),r}function k2(){let r=N.useContext(ux);return A0(r,"You must render this element inside a <DataRouterStateContext.Provider> element"),r}var D0=N.createContext(void 0);D0.displayName="FrameworkContext";function iS(){let r=N.useContext(D0);return A0(r,"You must render this element inside a <HydratedRouter> element"),r}function O2(r,e){let t=N.useContext(D0),[s,a]=N.useState(!1),[l,c]=N.useState(!1),{onFocus:u,onBlur:m,onMouseEnter:p,onMouseLeave:b,onTouchStart:w}=e,j=N.useRef(null);N.useEffect(()=>{if(r==="render"&&c(!0),r==="viewport"){let Q=I=>{I.forEach(ee=>{c(ee.isIntersecting)})},z=new IntersectionObserver(Q,{threshold:.5});return j.current&&z.observe(j.current),()=>{z.disconnect()}}},[r]),N.useEffect(()=>{if(s){let Q=setTimeout(()=>{c(!0)},100);return()=>{clearTimeout(Q)}}},[s]);let D=()=>{a(!0)},O=()=>{a(!1),c(!1)};return t?r!=="intent"?[l,j,{}]:[l,j,{onFocus:Tm(u,D),onBlur:Tm(m,O),onMouseEnter:Tm(p,D),onMouseLeave:Tm(b,O),onTouchStart:Tm(w,D)}]:[!1,j,{}]}function Tm(r,e){return t=>{r&&r(t),t.defaultPrevented||e(t)}}function M2({page:r,...e}){let{router:t}=rS(),s=N.useMemo(()=>QE(t.routes,r,t.basename),[t.routes,r,t.basename]);return s?N.createElement(F2,{page:r,matches:s,...e}):null}function L2(r){let{manifest:e,routeModules:t}=iS(),[s,a]=N.useState([]);return N.useEffect(()=>{let l=!1;return C2(r,e,t).then(c=>{l||a(c)}),()=>{l=!0}},[r,e,t]),s}function F2({page:r,matches:e,...t}){let s=il(),{manifest:a,routeModules:l}=iS(),{basename:c}=rS(),{loaderData:u,matches:m}=k2(),p=N.useMemo(()=>Rj(r,e,m,a,s,"data"),[r,e,m,a,s]),b=N.useMemo(()=>Rj(r,e,m,a,s,"assets"),[r,e,m,a,s]),w=N.useMemo(()=>{if(r===s.pathname+s.search+s.hash)return[];let O=new Set,Q=!1;if(e.forEach(I=>{let ee=a.routes[I.route.id];!ee||!ee.hasLoader||(!p.some(J=>J.route.id===I.route.id)&&I.route.id in u&&l[I.route.id]?.shouldRevalidate||ee.hasClientLoader?Q=!0:O.add(I.route.id))}),O.size===0)return[];let z=S2(r,c,"data");return Q&&O.size>0&&z.searchParams.set("_routes",e.filter(I=>O.has(I.route.id)).map(I=>I.route.id).join(",")),[z.pathname+z.search]},[c,u,s,a,p,e,r,l]),j=N.useMemo(()=>A2(b,a),[b,a]),D=L2(b);return N.createElement(N.Fragment,null,w.map(O=>N.createElement("link",{key:O,rel:"prefetch",as:"fetch",href:O,...t})),j.map(O=>N.createElement("link",{key:O,rel:"modulepreload",href:O,...t})),D.map(({key:O,link:Q})=>N.createElement("link",{key:O,...Q})))}function U2(...r){return e=>{r.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var aS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{aS&&(window.__reactRouterVersion="7.7.0")}catch{}function V2({basename:r,children:e,window:t}){let s=N.useRef();s.current==null&&(s.current=TA({window:t,v5Compat:!0}));let a=s.current,[l,c]=N.useState({action:a.action,location:a.location}),u=N.useCallback(m=>{N.startTransition(()=>c(m))},[c]);return N.useLayoutEffect(()=>a.listen(u),[a,u]),N.createElement(g2,{basename:r,children:e,location:l.location,navigationType:l.action,navigator:a})}var oS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ho=N.forwardRef(function({onClick:e,discover:t="render",prefetch:s="none",relative:a,reloadDocument:l,replace:c,state:u,target:m,to:p,preventScrollReset:b,viewTransition:w,...j},D){let{basename:O}=N.useContext(ro),Q=typeof p=="string"&&oS.test(p),z,I=!1;if(typeof p=="string"&&Q&&(z=p,aS))try{let k=new URL(window.location.href),$=p.startsWith("//")?new URL(k.protocol+p):new URL(p),X=Zo($.pathname,O);$.origin===k.origin&&X!=null?p=X+$.search+$.hash:I=!0}catch{no(!1,`<Link to="${p}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let ee=t2(p,{relative:a}),[J,oe,Y]=O2(s,j),be=q2(p,{replace:c,state:u,target:m,preventScrollReset:b,relative:a,viewTransition:w});function M(k){e&&e(k),k.defaultPrevented||be(k)}let H=N.createElement("a",{...j,...Y,href:z||ee,onClick:I||l?e:M,ref:U2(D,oe),target:m,"data-discover":!Q&&t==="render"?"true":void 0});return J&&!Q?N.createElement(N.Fragment,null,H,N.createElement(M2,{page:ee})):H});Ho.displayName="Link";var z2=N.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:s="",end:a=!1,style:l,to:c,viewTransition:u,children:m,...p},b){let w=Ef(c,{relative:p.relative}),j=il(),D=N.useContext(ux),{navigator:O,basename:Q}=N.useContext(ro),z=D!=null&&K2(w)&&u===!0,I=O.encodeLocation?O.encodeLocation(w).pathname:w.pathname,ee=j.pathname,J=D&&D.navigation&&D.navigation.location?D.navigation.location.pathname:null;t||(ee=ee.toLowerCase(),J=J?J.toLowerCase():null,I=I.toLowerCase()),J&&Q&&(J=Zo(J,Q)||J);const oe=I!=="/"&&I.endsWith("/")?I.length-1:I.length;let Y=ee===I||!a&&ee.startsWith(I)&&ee.charAt(oe)==="/",be=J!=null&&(J===I||!a&&J.startsWith(I)&&J.charAt(I.length)==="/"),M={isActive:Y,isPending:be,isTransitioning:z},H=Y?e:void 0,k;typeof s=="function"?k=s(M):k=[s,Y?"active":null,be?"pending":null,z?"transitioning":null].filter(Boolean).join(" ");let $=typeof l=="function"?l(M):l;return N.createElement(Ho,{...p,"aria-current":H,className:k,ref:b,style:$,to:c,viewTransition:u},typeof m=="function"?m(M):m)});z2.displayName="NavLink";var $2=N.forwardRef(({discover:r="render",fetcherKey:e,navigate:t,reloadDocument:s,replace:a,state:l,method:c=hg,action:u,onSubmit:m,relative:p,preventScrollReset:b,viewTransition:w,...j},D)=>{let O=Q2(),Q=W2(u,{relative:p}),z=c.toLowerCase()==="get"?"get":"post",I=typeof u=="string"&&oS.test(u),ee=J=>{if(m&&m(J),J.defaultPrevented)return;J.preventDefault();let oe=J.nativeEvent.submitter,Y=oe?.getAttribute("formmethod")||c;O(oe||J.currentTarget,{fetcherKey:e,method:Y,navigate:t,replace:a,state:l,relative:p,preventScrollReset:b,viewTransition:w})};return N.createElement("form",{ref:D,method:z,action:Q,onSubmit:s?m:ee,...j,"data-discover":!I&&r==="render"?"true":void 0})});$2.displayName="Form";function B2(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function lS(r){let e=N.useContext(ah);return us(e,B2(r)),e}function q2(r,{target:e,replace:t,state:s,preventScrollReset:a,relative:l,viewTransition:c}={}){let u=ms(),m=il(),p=Ef(r,{relative:l});return N.useCallback(b=>{if(N2(b,e)){b.preventDefault();let w=t!==void 0?t:sf(m)===sf(p);u(r,{replace:w,state:s,preventScrollReset:a,relative:l,viewTransition:c})}},[m,u,p,t,s,e,r,a,l,c])}var H2=0,G2=()=>`__${String(++H2)}__`;function Q2(){let{router:r}=lS("useSubmit"),{basename:e}=N.useContext(ro),t=h2();return N.useCallback(async(s,a={})=>{let{action:l,method:c,encType:u,formData:m,body:p}=E2(s,e);if(a.navigate===!1){let b=a.fetcherKey||G2();await r.fetch(b,t,a.action||l,{preventScrollReset:a.preventScrollReset,formData:m,body:p,formMethod:a.method||c,formEncType:a.encType||u,flushSync:a.flushSync})}else await r.navigate(a.action||l,{preventScrollReset:a.preventScrollReset,formData:m,body:p,formMethod:a.method||c,formEncType:a.encType||u,replace:a.replace,state:a.state,fromRouteId:t,flushSync:a.flushSync,viewTransition:a.viewTransition})},[r,e,t])}function W2(r,{relative:e}={}){let{basename:t}=N.useContext(ro),s=N.useContext(io);us(s,"useFormAction must be used inside a RouteContext");let[a]=s.matches.slice(-1),l={...Ef(r||".",{relative:e})},c=il();if(r==null){l.search=c.search;let u=new URLSearchParams(l.search),m=u.getAll("index");if(m.some(b=>b==="")){u.delete("index"),m.filter(w=>w).forEach(w=>u.append("index",w));let b=u.toString();l.search=b?`?${b}`:""}}return(!r||r===".")&&a.route.index&&(l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(l.pathname=l.pathname==="/"?t:Yo([t,l.pathname])),sf(l)}function K2(r,e={}){let t=N.useContext(ZE);us(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=lS("useViewTransitionState"),a=Ef(r,{relative:e.relative});if(!t.isTransitioning)return!1;let l=Zo(t.currentLocation.pathname,s)||t.currentLocation.pathname,c=Zo(t.nextLocation.pathname,s)||t.nextLocation.pathname;return Pg(a.pathname,c)!=null||Pg(a.pathname,l)!=null}const Y2=()=>{};var Pj={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cS=function(r){const e=[];let t=0;for(let s=0;s<r.length;s++){let a=r.charCodeAt(s);a<128?e[t++]=a:a<2048?(e[t++]=a>>6|192,e[t++]=a&63|128):(a&64512)===55296&&s+1<r.length&&(r.charCodeAt(s+1)&64512)===56320?(a=65536+((a&1023)<<10)+(r.charCodeAt(++s)&1023),e[t++]=a>>18|240,e[t++]=a>>12&63|128,e[t++]=a>>6&63|128,e[t++]=a&63|128):(e[t++]=a>>12|224,e[t++]=a>>6&63|128,e[t++]=a&63|128)}return e},X2=function(r){const e=[];let t=0,s=0;for(;t<r.length;){const a=r[t++];if(a<128)e[s++]=String.fromCharCode(a);else if(a>191&&a<224){const l=r[t++];e[s++]=String.fromCharCode((a&31)<<6|l&63)}else if(a>239&&a<365){const l=r[t++],c=r[t++],u=r[t++],m=((a&7)<<18|(l&63)<<12|(c&63)<<6|u&63)-65536;e[s++]=String.fromCharCode(55296+(m>>10)),e[s++]=String.fromCharCode(56320+(m&1023))}else{const l=r[t++],c=r[t++];e[s++]=String.fromCharCode((a&15)<<12|(l&63)<<6|c&63)}}return e.join("")},dS={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let a=0;a<r.length;a+=3){const l=r[a],c=a+1<r.length,u=c?r[a+1]:0,m=a+2<r.length,p=m?r[a+2]:0,b=l>>2,w=(l&3)<<4|u>>4;let j=(u&15)<<2|p>>6,D=p&63;m||(D=64,c||(j=64)),s.push(t[b],t[w],t[j],t[D])}return s.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(cS(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):X2(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let a=0;a<r.length;){const l=t[r.charAt(a++)],u=a<r.length?t[r.charAt(a)]:0;++a;const p=a<r.length?t[r.charAt(a)]:64;++a;const w=a<r.length?t[r.charAt(a)]:64;if(++a,l==null||u==null||p==null||w==null)throw new J2;const j=l<<2|u>>4;if(s.push(j),p!==64){const D=u<<4&240|p>>2;if(s.push(D),w!==64){const O=p<<6&192|w;s.push(O)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class J2 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Z2=function(r){const e=cS(r);return dS.encodeByteArray(e,!0)},kg=function(r){return Z2(r).replace(/\./g,"")},uS=function(r){try{return dS.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hS(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eD=()=>hS().__FIREBASE_DEFAULTS__,tD=()=>{if(typeof process>"u"||typeof Pj>"u")return;const r=Pj.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},nD=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=r&&uS(r[1]);return e&&JSON.parse(e)},mx=()=>{try{return Y2()||eD()||tD()||nD()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},mS=r=>mx()?.emulatorHosts?.[r],fS=r=>{const e=mS(r);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},pS=()=>mx()?.config,gS=r=>mx()?.[`_${r}`];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sD{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function al(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}async function fx(r){return(await fetch(r,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xS(r,e){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",a=r.iat||0,l=r.sub||r.user_id;if(!l)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const c={iss:`https://securetoken.google.com/${s}`,aud:s,iat:a,exp:a+3600,auth_time:a,sub:l,user_id:l,firebase:{sign_in_provider:"custom",identities:{}},...r};return[kg(JSON.stringify(t)),kg(JSON.stringify(c)),""].join(".")}const zm={};function rD(){const r={prod:[],emulator:[]};for(const e of Object.keys(zm))zm[e]?r.emulator.push(e):r.prod.push(e);return r}function iD(r){let e=document.getElementById(r),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",r),t=!0),{created:t,element:e}}let kj=!1;function R0(r,e){if(typeof window>"u"||typeof document>"u"||!al(window.location.host)||zm[r]===e||zm[r]||kj)return;zm[r]=e;function t(j){return`__firebase__banner__${j}`}const s="__firebase__banner",l=rD().prod.length>0;function c(){const j=document.getElementById(s);j&&j.remove()}function u(j){j.style.display="flex",j.style.background="#7faaf0",j.style.position="fixed",j.style.bottom="5px",j.style.left="5px",j.style.padding=".5em",j.style.borderRadius="5px",j.style.alignItems="center"}function m(j,D){j.setAttribute("width","24"),j.setAttribute("id",D),j.setAttribute("height","24"),j.setAttribute("viewBox","0 0 24 24"),j.setAttribute("fill","none"),j.style.marginLeft="-6px"}function p(){const j=document.createElement("span");return j.style.cursor="pointer",j.style.marginLeft="16px",j.style.fontSize="24px",j.innerHTML=" &times;",j.onclick=()=>{kj=!0,c()},j}function b(j,D){j.setAttribute("id",D),j.innerText="Learn more",j.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",j.setAttribute("target","__blank"),j.style.paddingLeft="5px",j.style.textDecoration="underline"}function w(){const j=iD(s),D=t("text"),O=document.getElementById(D)||document.createElement("span"),Q=t("learnmore"),z=document.getElementById(Q)||document.createElement("a"),I=t("preprendIcon"),ee=document.getElementById(I)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(j.created){const J=j.element;u(J),b(z,Q);const oe=p();m(ee,I),J.append(ee,O,z,oe),document.body.appendChild(J)}l?(O.innerText="Preview backend disconnected.",ee.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(ee.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,O.innerText="Preview backend running in this workspace."),O.setAttribute("id",D)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",w):w()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ys(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function aD(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ys())}function yS(){const r=mx()?.forceEnvironment;if(r==="node")return!0;if(r==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function oD(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function lD(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function cD(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function dD(){const r=Ys();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function bS(){return!yS()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function wS(){return!yS()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function vS(){try{return typeof indexedDB=="object"}catch{return!1}}function uD(){return new Promise((r,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(s);a.onsuccess=()=>{a.result.close(),t||self.indexedDB.deleteDatabase(s),r(!0)},a.onupgradeneeded=()=>{t=!1},a.onerror=()=>{e(a.error?.message||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hD="FirebaseError";class ao extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=hD,Object.setPrototypeOf(this,ao.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Sf.prototype.create)}}class Sf{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},a=`${this.service}/${e}`,l=this.errors[e],c=l?mD(l,s):"Error",u=`${this.serviceName}: ${c} (${a}).`;return new ao(a,u,s)}}function mD(r,e){return r.replace(fD,(t,s)=>{const a=e[s];return a!=null?String(a):`<${s}?>`})}const fD=/\{\$([^}]+)}/g;function pD(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function mc(r,e){if(r===e)return!0;const t=Object.keys(r),s=Object.keys(e);for(const a of t){if(!s.includes(a))return!1;const l=r[a],c=e[a];if(Oj(l)&&Oj(c)){if(!mc(l,c))return!1}else if(l!==c)return!1}for(const a of s)if(!t.includes(a))return!1;return!0}function Oj(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function If(r){const e=[];for(const[t,s]of Object.entries(r))Array.isArray(s)?s.forEach(a=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function Om(r){const e={};return r.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[a,l]=s.split("=");e[decodeURIComponent(a)]=decodeURIComponent(l)}}),e}function Mm(r){const e=r.indexOf("?");if(!e)return"";const t=r.indexOf("#",e);return r.substring(e,t>0?t:void 0)}function gD(r,e){const t=new xD(r,e);return t.subscribe.bind(t)}class xD{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let a;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");yD(e,["next","error","complete"])?a=e:a={next:e,error:t,complete:s},a.next===void 0&&(a.next=mb),a.error===void 0&&(a.error=mb),a.complete===void 0&&(a.complete=mb);const l=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),l}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function yD(r,e){if(typeof r!="object"||r===null)return!1;for(const t of e)if(t in r&&typeof r[t]=="function")return!0;return!1}function mb(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fn(r){return r&&r._delegate?r._delegate:r}class fc{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rd="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bD{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new sD;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:t});a&&s.resolve(a)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),s=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(a){if(s)return null;throw a}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(vD(e))try{this.getOrInitializeService({instanceIdentifier:rd})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(t);try{const l=this.getOrInitializeService({instanceIdentifier:a});s.resolve(l)}catch{}}}}clearInstance(e=rd){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=rd){return this.instances.has(e)}getOptions(e=rd){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[l,c]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(l);s===u&&c.resolve(a)}return a}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),a=this.onInitCallbacks.get(s)??new Set;a.add(e),this.onInitCallbacks.set(s,a);const l=this.instances.get(s);return l&&e(l,s),()=>{a.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const a of s)try{a(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:wD(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=rd){return this.component?this.component.multipleInstances?e:rd:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function wD(r){return r===rd?void 0:r}function vD(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ND{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new bD(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tn;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(tn||(tn={}));const jD={debug:tn.DEBUG,verbose:tn.VERBOSE,info:tn.INFO,warn:tn.WARN,error:tn.ERROR,silent:tn.SILENT},_D=tn.INFO,ED={[tn.DEBUG]:"log",[tn.VERBOSE]:"log",[tn.INFO]:"info",[tn.WARN]:"warn",[tn.ERROR]:"error"},SD=(r,e,...t)=>{if(e<r.logLevel)return;const s=new Date().toISOString(),a=ED[e];if(a)console[a](`[${s}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class P0{constructor(e){this.name=e,this._logLevel=_D,this._logHandler=SD,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in tn))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?jD[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,tn.DEBUG,...e),this._logHandler(this,tn.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,tn.VERBOSE,...e),this._logHandler(this,tn.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,tn.INFO,...e),this._logHandler(this,tn.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,tn.WARN,...e),this._logHandler(this,tn.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,tn.ERROR,...e),this._logHandler(this,tn.ERROR,...e)}}const ID=(r,e)=>e.some(t=>r instanceof t);let Mj,Lj;function TD(){return Mj||(Mj=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function CD(){return Lj||(Lj=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const NS=new WeakMap,Ub=new WeakMap,jS=new WeakMap,fb=new WeakMap,k0=new WeakMap;function AD(r){const e=new Promise((t,s)=>{const a=()=>{r.removeEventListener("success",l),r.removeEventListener("error",c)},l=()=>{t(oc(r.result)),a()},c=()=>{s(r.error),a()};r.addEventListener("success",l),r.addEventListener("error",c)});return e.then(t=>{t instanceof IDBCursor&&NS.set(t,r)}).catch(()=>{}),k0.set(e,r),e}function DD(r){if(Ub.has(r))return;const e=new Promise((t,s)=>{const a=()=>{r.removeEventListener("complete",l),r.removeEventListener("error",c),r.removeEventListener("abort",c)},l=()=>{t(),a()},c=()=>{s(r.error||new DOMException("AbortError","AbortError")),a()};r.addEventListener("complete",l),r.addEventListener("error",c),r.addEventListener("abort",c)});Ub.set(r,e)}let Vb={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return Ub.get(r);if(e==="objectStoreNames")return r.objectStoreNames||jS.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return oc(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function RD(r){Vb=r(Vb)}function PD(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=r.call(pb(this),e,...t);return jS.set(s,e.sort?e.sort():[e]),oc(s)}:CD().includes(r)?function(...e){return r.apply(pb(this),e),oc(NS.get(this))}:function(...e){return oc(r.apply(pb(this),e))}}function kD(r){return typeof r=="function"?PD(r):(r instanceof IDBTransaction&&DD(r),ID(r,TD())?new Proxy(r,Vb):r)}function oc(r){if(r instanceof IDBRequest)return AD(r);if(fb.has(r))return fb.get(r);const e=kD(r);return e!==r&&(fb.set(r,e),k0.set(e,r)),e}const pb=r=>k0.get(r);function OD(r,e,{blocked:t,upgrade:s,blocking:a,terminated:l}={}){const c=indexedDB.open(r,e),u=oc(c);return s&&c.addEventListener("upgradeneeded",m=>{s(oc(c.result),m.oldVersion,m.newVersion,oc(c.transaction),m)}),t&&c.addEventListener("blocked",m=>t(m.oldVersion,m.newVersion,m)),u.then(m=>{l&&m.addEventListener("close",()=>l()),a&&m.addEventListener("versionchange",p=>a(p.oldVersion,p.newVersion,p))}).catch(()=>{}),u}const MD=["get","getKey","getAll","getAllKeys","count"],LD=["put","add","delete","clear"],gb=new Map;function Fj(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(gb.get(e))return gb.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,a=LD.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(a||MD.includes(t)))return;const l=async function(c,...u){const m=this.transaction(c,a?"readwrite":"readonly");let p=m.store;return s&&(p=p.index(u.shift())),(await Promise.all([p[t](...u),a&&m.done]))[0]};return gb.set(e,l),l}RD(r=>({...r,get:(e,t,s)=>Fj(e,t)||r.get(e,t,s),has:(e,t)=>!!Fj(e,t)||r.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FD{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(UD(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function UD(r){return r.getComponent()?.type==="VERSION"}const zb="@firebase/app",Uj="0.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const el=new P0("@firebase/app"),VD="@firebase/app-compat",zD="@firebase/analytics-compat",$D="@firebase/analytics",BD="@firebase/app-check-compat",qD="@firebase/app-check",HD="@firebase/auth",GD="@firebase/auth-compat",QD="@firebase/database",WD="@firebase/data-connect",KD="@firebase/database-compat",YD="@firebase/functions",XD="@firebase/functions-compat",JD="@firebase/installations",ZD="@firebase/installations-compat",eR="@firebase/messaging",tR="@firebase/messaging-compat",nR="@firebase/performance",sR="@firebase/performance-compat",rR="@firebase/remote-config",iR="@firebase/remote-config-compat",aR="@firebase/storage",oR="@firebase/storage-compat",lR="@firebase/firestore",cR="@firebase/ai",dR="@firebase/firestore-compat",uR="firebase",hR="12.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $b="[DEFAULT]",mR={[zb]:"fire-core",[VD]:"fire-core-compat",[$D]:"fire-analytics",[zD]:"fire-analytics-compat",[qD]:"fire-app-check",[BD]:"fire-app-check-compat",[HD]:"fire-auth",[GD]:"fire-auth-compat",[QD]:"fire-rtdb",[WD]:"fire-data-connect",[KD]:"fire-rtdb-compat",[YD]:"fire-fn",[XD]:"fire-fn-compat",[JD]:"fire-iid",[ZD]:"fire-iid-compat",[eR]:"fire-fcm",[tR]:"fire-fcm-compat",[nR]:"fire-perf",[sR]:"fire-perf-compat",[rR]:"fire-rc",[iR]:"fire-rc-compat",[aR]:"fire-gcs",[oR]:"fire-gcs-compat",[lR]:"fire-fst",[dR]:"fire-fst-compat",[cR]:"fire-vertex","fire-js":"fire-js",[uR]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Og=new Map,fR=new Map,Bb=new Map;function Vj(r,e){try{r.container.addComponent(e)}catch(t){el.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function bd(r){const e=r.name;if(Bb.has(e))return el.debug(`There were multiple attempts to register component ${e}.`),!1;Bb.set(e,r);for(const t of Og.values())Vj(t,r);for(const t of fR.values())Vj(t,r);return!0}function Tf(r,e){const t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function si(r){return r==null?!1:r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pR={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},lc=new Sf("app","Firebase",pR);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new fc("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw lc.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cd=hR;function O0(r,e={}){let t=r;typeof e!="object"&&(e={name:e});const s={name:$b,automaticDataCollectionEnabled:!0,...e},a=s.name;if(typeof a!="string"||!a)throw lc.create("bad-app-name",{appName:String(a)});if(t||(t=pS()),!t)throw lc.create("no-options");const l=Og.get(a);if(l){if(mc(t,l.options)&&mc(s,l.config))return l;throw lc.create("duplicate-app",{appName:a})}const c=new ND(a);for(const m of Bb.values())c.addComponent(m);const u=new gR(t,s,c);return Og.set(a,u),u}function M0(r=$b){const e=Og.get(r);if(!e&&r===$b&&pS())return O0();if(!e)throw lc.create("no-app",{appName:r});return e}function Ka(r,e,t){let s=mR[r]??r;t&&(s+=`-${t}`);const a=s.match(/\s|\//),l=e.match(/\s|\//);if(a||l){const c=[`Unable to register library "${s}" with version "${e}":`];a&&c.push(`library name "${s}" contains illegal characters (whitespace or "/")`),a&&l&&c.push("and"),l&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),el.warn(c.join(" "));return}bd(new fc(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xR="firebase-heartbeat-database",yR=1,rf="firebase-heartbeat-store";let xb=null;function _S(){return xb||(xb=OD(xR,yR,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(rf)}catch(t){console.warn(t)}}}}).catch(r=>{throw lc.create("idb-open",{originalErrorMessage:r.message})})),xb}async function bR(r){try{const t=(await _S()).transaction(rf),s=await t.objectStore(rf).get(ES(r));return await t.done,s}catch(e){if(e instanceof ao)el.warn(e.message);else{const t=lc.create("idb-get",{originalErrorMessage:e?.message});el.warn(t.message)}}}async function zj(r,e){try{const s=(await _S()).transaction(rf,"readwrite");await s.objectStore(rf).put(e,ES(r)),await s.done}catch(t){if(t instanceof ao)el.warn(t.message);else{const s=lc.create("idb-set",{originalErrorMessage:t?.message});el.warn(s.message)}}}function ES(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wR=1024,vR=30;class NR{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new _R(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=$j();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:t}),this._heartbeatsCache.heartbeats.length>vR){const a=ER(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){el.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=$j(),{heartbeatsToSend:t,unsentEntries:s}=jR(this._heartbeatsCache.heartbeats),a=kg(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(e){return el.warn(e),""}}}function $j(){return new Date().toISOString().substring(0,10)}function jR(r,e=wR){const t=[];let s=r.slice();for(const a of r){const l=t.find(c=>c.agent===a.agent);if(l){if(l.dates.push(a.date),Bj(t)>e){l.dates.pop();break}}else if(t.push({agent:a.agent,dates:[a.date]}),Bj(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class _R{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return vS()?uD().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await bR(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return zj(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return zj(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Bj(r){return kg(JSON.stringify({version:2,heartbeats:r})).length}function ER(r){if(r.length===0)return-1;let e=0,t=r[0].date;for(let s=1;s<r.length;s++)r[s].date<t&&(t=r[s].date,e=s);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SR(r){bd(new fc("platform-logger",e=>new FD(e),"PRIVATE")),bd(new fc("heartbeat",e=>new NR(e),"PRIVATE")),Ka(zb,Uj,r),Ka(zb,Uj,"esm2020"),Ka("fire-js","")}SR("");var qj=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var cc,SS;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(M,H){function k(){}k.prototype=H.prototype,M.D=H.prototype,M.prototype=new k,M.prototype.constructor=M,M.C=function($,X,te){for(var F=Array(arguments.length-2),ce=2;ce<arguments.length;ce++)F[ce-2]=arguments[ce];return H.prototype[X].apply($,F)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(s,t),s.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(M,H,k){k||(k=0);var $=Array(16);if(typeof H=="string")for(var X=0;16>X;++X)$[X]=H.charCodeAt(k++)|H.charCodeAt(k++)<<8|H.charCodeAt(k++)<<16|H.charCodeAt(k++)<<24;else for(X=0;16>X;++X)$[X]=H[k++]|H[k++]<<8|H[k++]<<16|H[k++]<<24;H=M.g[0],k=M.g[1],X=M.g[2];var te=M.g[3],F=H+(te^k&(X^te))+$[0]+3614090360&4294967295;H=k+(F<<7&4294967295|F>>>25),F=te+(X^H&(k^X))+$[1]+3905402710&4294967295,te=H+(F<<12&4294967295|F>>>20),F=X+(k^te&(H^k))+$[2]+606105819&4294967295,X=te+(F<<17&4294967295|F>>>15),F=k+(H^X&(te^H))+$[3]+3250441966&4294967295,k=X+(F<<22&4294967295|F>>>10),F=H+(te^k&(X^te))+$[4]+4118548399&4294967295,H=k+(F<<7&4294967295|F>>>25),F=te+(X^H&(k^X))+$[5]+1200080426&4294967295,te=H+(F<<12&4294967295|F>>>20),F=X+(k^te&(H^k))+$[6]+2821735955&4294967295,X=te+(F<<17&4294967295|F>>>15),F=k+(H^X&(te^H))+$[7]+4249261313&4294967295,k=X+(F<<22&4294967295|F>>>10),F=H+(te^k&(X^te))+$[8]+1770035416&4294967295,H=k+(F<<7&4294967295|F>>>25),F=te+(X^H&(k^X))+$[9]+2336552879&4294967295,te=H+(F<<12&4294967295|F>>>20),F=X+(k^te&(H^k))+$[10]+4294925233&4294967295,X=te+(F<<17&4294967295|F>>>15),F=k+(H^X&(te^H))+$[11]+2304563134&4294967295,k=X+(F<<22&4294967295|F>>>10),F=H+(te^k&(X^te))+$[12]+1804603682&4294967295,H=k+(F<<7&4294967295|F>>>25),F=te+(X^H&(k^X))+$[13]+4254626195&4294967295,te=H+(F<<12&4294967295|F>>>20),F=X+(k^te&(H^k))+$[14]+2792965006&4294967295,X=te+(F<<17&4294967295|F>>>15),F=k+(H^X&(te^H))+$[15]+1236535329&4294967295,k=X+(F<<22&4294967295|F>>>10),F=H+(X^te&(k^X))+$[1]+4129170786&4294967295,H=k+(F<<5&4294967295|F>>>27),F=te+(k^X&(H^k))+$[6]+3225465664&4294967295,te=H+(F<<9&4294967295|F>>>23),F=X+(H^k&(te^H))+$[11]+643717713&4294967295,X=te+(F<<14&4294967295|F>>>18),F=k+(te^H&(X^te))+$[0]+3921069994&4294967295,k=X+(F<<20&4294967295|F>>>12),F=H+(X^te&(k^X))+$[5]+3593408605&4294967295,H=k+(F<<5&4294967295|F>>>27),F=te+(k^X&(H^k))+$[10]+38016083&4294967295,te=H+(F<<9&4294967295|F>>>23),F=X+(H^k&(te^H))+$[15]+3634488961&4294967295,X=te+(F<<14&4294967295|F>>>18),F=k+(te^H&(X^te))+$[4]+3889429448&4294967295,k=X+(F<<20&4294967295|F>>>12),F=H+(X^te&(k^X))+$[9]+568446438&4294967295,H=k+(F<<5&4294967295|F>>>27),F=te+(k^X&(H^k))+$[14]+3275163606&4294967295,te=H+(F<<9&4294967295|F>>>23),F=X+(H^k&(te^H))+$[3]+4107603335&4294967295,X=te+(F<<14&4294967295|F>>>18),F=k+(te^H&(X^te))+$[8]+1163531501&4294967295,k=X+(F<<20&4294967295|F>>>12),F=H+(X^te&(k^X))+$[13]+2850285829&4294967295,H=k+(F<<5&4294967295|F>>>27),F=te+(k^X&(H^k))+$[2]+4243563512&4294967295,te=H+(F<<9&4294967295|F>>>23),F=X+(H^k&(te^H))+$[7]+1735328473&4294967295,X=te+(F<<14&4294967295|F>>>18),F=k+(te^H&(X^te))+$[12]+2368359562&4294967295,k=X+(F<<20&4294967295|F>>>12),F=H+(k^X^te)+$[5]+4294588738&4294967295,H=k+(F<<4&4294967295|F>>>28),F=te+(H^k^X)+$[8]+2272392833&4294967295,te=H+(F<<11&4294967295|F>>>21),F=X+(te^H^k)+$[11]+1839030562&4294967295,X=te+(F<<16&4294967295|F>>>16),F=k+(X^te^H)+$[14]+4259657740&4294967295,k=X+(F<<23&4294967295|F>>>9),F=H+(k^X^te)+$[1]+2763975236&4294967295,H=k+(F<<4&4294967295|F>>>28),F=te+(H^k^X)+$[4]+1272893353&4294967295,te=H+(F<<11&4294967295|F>>>21),F=X+(te^H^k)+$[7]+4139469664&4294967295,X=te+(F<<16&4294967295|F>>>16),F=k+(X^te^H)+$[10]+3200236656&4294967295,k=X+(F<<23&4294967295|F>>>9),F=H+(k^X^te)+$[13]+681279174&4294967295,H=k+(F<<4&4294967295|F>>>28),F=te+(H^k^X)+$[0]+3936430074&4294967295,te=H+(F<<11&4294967295|F>>>21),F=X+(te^H^k)+$[3]+3572445317&4294967295,X=te+(F<<16&4294967295|F>>>16),F=k+(X^te^H)+$[6]+76029189&4294967295,k=X+(F<<23&4294967295|F>>>9),F=H+(k^X^te)+$[9]+3654602809&4294967295,H=k+(F<<4&4294967295|F>>>28),F=te+(H^k^X)+$[12]+3873151461&4294967295,te=H+(F<<11&4294967295|F>>>21),F=X+(te^H^k)+$[15]+530742520&4294967295,X=te+(F<<16&4294967295|F>>>16),F=k+(X^te^H)+$[2]+3299628645&4294967295,k=X+(F<<23&4294967295|F>>>9),F=H+(X^(k|~te))+$[0]+4096336452&4294967295,H=k+(F<<6&4294967295|F>>>26),F=te+(k^(H|~X))+$[7]+1126891415&4294967295,te=H+(F<<10&4294967295|F>>>22),F=X+(H^(te|~k))+$[14]+2878612391&4294967295,X=te+(F<<15&4294967295|F>>>17),F=k+(te^(X|~H))+$[5]+4237533241&4294967295,k=X+(F<<21&4294967295|F>>>11),F=H+(X^(k|~te))+$[12]+1700485571&4294967295,H=k+(F<<6&4294967295|F>>>26),F=te+(k^(H|~X))+$[3]+2399980690&4294967295,te=H+(F<<10&4294967295|F>>>22),F=X+(H^(te|~k))+$[10]+4293915773&4294967295,X=te+(F<<15&4294967295|F>>>17),F=k+(te^(X|~H))+$[1]+2240044497&4294967295,k=X+(F<<21&4294967295|F>>>11),F=H+(X^(k|~te))+$[8]+1873313359&4294967295,H=k+(F<<6&4294967295|F>>>26),F=te+(k^(H|~X))+$[15]+4264355552&4294967295,te=H+(F<<10&4294967295|F>>>22),F=X+(H^(te|~k))+$[6]+2734768916&4294967295,X=te+(F<<15&4294967295|F>>>17),F=k+(te^(X|~H))+$[13]+1309151649&4294967295,k=X+(F<<21&4294967295|F>>>11),F=H+(X^(k|~te))+$[4]+4149444226&4294967295,H=k+(F<<6&4294967295|F>>>26),F=te+(k^(H|~X))+$[11]+3174756917&4294967295,te=H+(F<<10&4294967295|F>>>22),F=X+(H^(te|~k))+$[2]+718787259&4294967295,X=te+(F<<15&4294967295|F>>>17),F=k+(te^(X|~H))+$[9]+3951481745&4294967295,M.g[0]=M.g[0]+H&4294967295,M.g[1]=M.g[1]+(X+(F<<21&4294967295|F>>>11))&4294967295,M.g[2]=M.g[2]+X&4294967295,M.g[3]=M.g[3]+te&4294967295}s.prototype.u=function(M,H){H===void 0&&(H=M.length);for(var k=H-this.blockSize,$=this.B,X=this.h,te=0;te<H;){if(X==0)for(;te<=k;)a(this,M,te),te+=this.blockSize;if(typeof M=="string"){for(;te<H;)if($[X++]=M.charCodeAt(te++),X==this.blockSize){a(this,$),X=0;break}}else for(;te<H;)if($[X++]=M[te++],X==this.blockSize){a(this,$),X=0;break}}this.h=X,this.o+=H},s.prototype.v=function(){var M=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);M[0]=128;for(var H=1;H<M.length-8;++H)M[H]=0;var k=8*this.o;for(H=M.length-8;H<M.length;++H)M[H]=k&255,k/=256;for(this.u(M),M=Array(16),H=k=0;4>H;++H)for(var $=0;32>$;$+=8)M[k++]=this.g[H]>>>$&255;return M};function l(M,H){var k=u;return Object.prototype.hasOwnProperty.call(k,M)?k[M]:k[M]=H(M)}function c(M,H){this.h=H;for(var k=[],$=!0,X=M.length-1;0<=X;X--){var te=M[X]|0;$&&te==H||(k[X]=te,$=!1)}this.g=k}var u={};function m(M){return-128<=M&&128>M?l(M,function(H){return new c([H|0],0>H?-1:0)}):new c([M|0],0>M?-1:0)}function p(M){if(isNaN(M)||!isFinite(M))return w;if(0>M)return z(p(-M));for(var H=[],k=1,$=0;M>=k;$++)H[$]=M/k|0,k*=4294967296;return new c(H,0)}function b(M,H){if(M.length==0)throw Error("number format error: empty string");if(H=H||10,2>H||36<H)throw Error("radix out of range: "+H);if(M.charAt(0)=="-")return z(b(M.substring(1),H));if(0<=M.indexOf("-"))throw Error('number format error: interior "-" character');for(var k=p(Math.pow(H,8)),$=w,X=0;X<M.length;X+=8){var te=Math.min(8,M.length-X),F=parseInt(M.substring(X,X+te),H);8>te?(te=p(Math.pow(H,te)),$=$.j(te).add(p(F))):($=$.j(k),$=$.add(p(F)))}return $}var w=m(0),j=m(1),D=m(16777216);r=c.prototype,r.m=function(){if(Q(this))return-z(this).m();for(var M=0,H=1,k=0;k<this.g.length;k++){var $=this.i(k);M+=(0<=$?$:4294967296+$)*H,H*=4294967296}return M},r.toString=function(M){if(M=M||10,2>M||36<M)throw Error("radix out of range: "+M);if(O(this))return"0";if(Q(this))return"-"+z(this).toString(M);for(var H=p(Math.pow(M,6)),k=this,$="";;){var X=oe(k,H).g;k=I(k,X.j(H));var te=((0<k.g.length?k.g[0]:k.h)>>>0).toString(M);if(k=X,O(k))return te+$;for(;6>te.length;)te="0"+te;$=te+$}},r.i=function(M){return 0>M?0:M<this.g.length?this.g[M]:this.h};function O(M){if(M.h!=0)return!1;for(var H=0;H<M.g.length;H++)if(M.g[H]!=0)return!1;return!0}function Q(M){return M.h==-1}r.l=function(M){return M=I(this,M),Q(M)?-1:O(M)?0:1};function z(M){for(var H=M.g.length,k=[],$=0;$<H;$++)k[$]=~M.g[$];return new c(k,~M.h).add(j)}r.abs=function(){return Q(this)?z(this):this},r.add=function(M){for(var H=Math.max(this.g.length,M.g.length),k=[],$=0,X=0;X<=H;X++){var te=$+(this.i(X)&65535)+(M.i(X)&65535),F=(te>>>16)+(this.i(X)>>>16)+(M.i(X)>>>16);$=F>>>16,te&=65535,F&=65535,k[X]=F<<16|te}return new c(k,k[k.length-1]&-2147483648?-1:0)};function I(M,H){return M.add(z(H))}r.j=function(M){if(O(this)||O(M))return w;if(Q(this))return Q(M)?z(this).j(z(M)):z(z(this).j(M));if(Q(M))return z(this.j(z(M)));if(0>this.l(D)&&0>M.l(D))return p(this.m()*M.m());for(var H=this.g.length+M.g.length,k=[],$=0;$<2*H;$++)k[$]=0;for($=0;$<this.g.length;$++)for(var X=0;X<M.g.length;X++){var te=this.i($)>>>16,F=this.i($)&65535,ce=M.i(X)>>>16,Be=M.i(X)&65535;k[2*$+2*X]+=F*Be,ee(k,2*$+2*X),k[2*$+2*X+1]+=te*Be,ee(k,2*$+2*X+1),k[2*$+2*X+1]+=F*ce,ee(k,2*$+2*X+1),k[2*$+2*X+2]+=te*ce,ee(k,2*$+2*X+2)}for($=0;$<H;$++)k[$]=k[2*$+1]<<16|k[2*$];for($=H;$<2*H;$++)k[$]=0;return new c(k,0)};function ee(M,H){for(;(M[H]&65535)!=M[H];)M[H+1]+=M[H]>>>16,M[H]&=65535,H++}function J(M,H){this.g=M,this.h=H}function oe(M,H){if(O(H))throw Error("division by zero");if(O(M))return new J(w,w);if(Q(M))return H=oe(z(M),H),new J(z(H.g),z(H.h));if(Q(H))return H=oe(M,z(H)),new J(z(H.g),H.h);if(30<M.g.length){if(Q(M)||Q(H))throw Error("slowDivide_ only works with positive integers.");for(var k=j,$=H;0>=$.l(M);)k=Y(k),$=Y($);var X=be(k,1),te=be($,1);for($=be($,2),k=be(k,2);!O($);){var F=te.add($);0>=F.l(M)&&(X=X.add(k),te=F),$=be($,1),k=be(k,1)}return H=I(M,X.j(H)),new J(X,H)}for(X=w;0<=M.l(H);){for(k=Math.max(1,Math.floor(M.m()/H.m())),$=Math.ceil(Math.log(k)/Math.LN2),$=48>=$?1:Math.pow(2,$-48),te=p(k),F=te.j(H);Q(F)||0<F.l(M);)k-=$,te=p(k),F=te.j(H);O(te)&&(te=j),X=X.add(te),M=I(M,F)}return new J(X,M)}r.A=function(M){return oe(this,M).h},r.and=function(M){for(var H=Math.max(this.g.length,M.g.length),k=[],$=0;$<H;$++)k[$]=this.i($)&M.i($);return new c(k,this.h&M.h)},r.or=function(M){for(var H=Math.max(this.g.length,M.g.length),k=[],$=0;$<H;$++)k[$]=this.i($)|M.i($);return new c(k,this.h|M.h)},r.xor=function(M){for(var H=Math.max(this.g.length,M.g.length),k=[],$=0;$<H;$++)k[$]=this.i($)^M.i($);return new c(k,this.h^M.h)};function Y(M){for(var H=M.g.length+1,k=[],$=0;$<H;$++)k[$]=M.i($)<<1|M.i($-1)>>>31;return new c(k,M.h)}function be(M,H){var k=H>>5;H%=32;for(var $=M.g.length-k,X=[],te=0;te<$;te++)X[te]=0<H?M.i(te+k)>>>H|M.i(te+k+1)<<32-H:M.i(te+k);return new c(X,M.h)}s.prototype.digest=s.prototype.v,s.prototype.reset=s.prototype.s,s.prototype.update=s.prototype.u,SS=s,c.prototype.add=c.prototype.add,c.prototype.multiply=c.prototype.j,c.prototype.modulo=c.prototype.A,c.prototype.compare=c.prototype.l,c.prototype.toNumber=c.prototype.m,c.prototype.toString=c.prototype.toString,c.prototype.getBits=c.prototype.i,c.fromNumber=p,c.fromString=b,cc=c}).apply(typeof qj<"u"?qj:typeof self<"u"?self:typeof window<"u"?window:{});var tg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var IS,Lm,TS,fg,qb,CS,AS,DS;(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(f,v,A){return f==Array.prototype||f==Object.prototype||(f[v]=A.value),f};function t(f){f=[typeof globalThis=="object"&&globalThis,f,typeof window=="object"&&window,typeof self=="object"&&self,typeof tg=="object"&&tg];for(var v=0;v<f.length;++v){var A=f[v];if(A&&A.Math==Math)return A}throw Error("Cannot find global object")}var s=t(this);function a(f,v){if(v)e:{var A=s;f=f.split(".");for(var K=0;K<f.length-1;K++){var _e=f[K];if(!(_e in A))break e;A=A[_e]}f=f[f.length-1],K=A[f],v=v(K),v!=K&&v!=null&&e(A,f,{configurable:!0,writable:!0,value:v})}}function l(f,v){f instanceof String&&(f+="");var A=0,K=!1,_e={next:function(){if(!K&&A<f.length){var Me=A++;return{value:v(Me,f[Me]),done:!1}}return K=!0,{done:!0,value:void 0}}};return _e[Symbol.iterator]=function(){return _e},_e}a("Array.prototype.values",function(f){return f||function(){return l(this,function(v,A){return A})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var c=c||{},u=this||self;function m(f){var v=typeof f;return v=v!="object"?v:f?Array.isArray(f)?"array":v:"null",v=="array"||v=="object"&&typeof f.length=="number"}function p(f){var v=typeof f;return v=="object"&&f!=null||v=="function"}function b(f,v,A){return f.call.apply(f.bind,arguments)}function w(f,v,A){if(!f)throw Error();if(2<arguments.length){var K=Array.prototype.slice.call(arguments,2);return function(){var _e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(_e,K),f.apply(v,_e)}}return function(){return f.apply(v,arguments)}}function j(f,v,A){return j=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?b:w,j.apply(null,arguments)}function D(f,v){var A=Array.prototype.slice.call(arguments,1);return function(){var K=A.slice();return K.push.apply(K,arguments),f.apply(this,K)}}function O(f,v){function A(){}A.prototype=v.prototype,f.aa=v.prototype,f.prototype=new A,f.prototype.constructor=f,f.Qb=function(K,_e,Me){for(var st=Array(arguments.length-2),Zt=2;Zt<arguments.length;Zt++)st[Zt-2]=arguments[Zt];return v.prototype[_e].apply(K,st)}}function Q(f){const v=f.length;if(0<v){const A=Array(v);for(let K=0;K<v;K++)A[K]=f[K];return A}return[]}function z(f,v){for(let A=1;A<arguments.length;A++){const K=arguments[A];if(m(K)){const _e=f.length||0,Me=K.length||0;f.length=_e+Me;for(let st=0;st<Me;st++)f[_e+st]=K[st]}else f.push(K)}}class I{constructor(v,A){this.i=v,this.j=A,this.h=0,this.g=null}get(){let v;return 0<this.h?(this.h--,v=this.g,this.g=v.next,v.next=null):v=this.i(),v}}function ee(f){return/^[\s\xa0]*$/.test(f)}function J(){var f=u.navigator;return f&&(f=f.userAgent)?f:""}function oe(f){return oe[" "](f),f}oe[" "]=function(){};var Y=J().indexOf("Gecko")!=-1&&!(J().toLowerCase().indexOf("webkit")!=-1&&J().indexOf("Edge")==-1)&&!(J().indexOf("Trident")!=-1||J().indexOf("MSIE")!=-1)&&J().indexOf("Edge")==-1;function be(f,v,A){for(const K in f)v.call(A,f[K],K,f)}function M(f,v){for(const A in f)v.call(void 0,f[A],A,f)}function H(f){const v={};for(const A in f)v[A]=f[A];return v}const k="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $(f,v){let A,K;for(let _e=1;_e<arguments.length;_e++){K=arguments[_e];for(A in K)f[A]=K[A];for(let Me=0;Me<k.length;Me++)A=k[Me],Object.prototype.hasOwnProperty.call(K,A)&&(f[A]=K[A])}}function X(f){var v=1;f=f.split(":");const A=[];for(;0<v&&f.length;)A.push(f.shift()),v--;return f.length&&A.push(f.join(":")),A}function te(f){u.setTimeout(()=>{throw f},0)}function F(){var f=ie;let v=null;return f.g&&(v=f.g,f.g=f.g.next,f.g||(f.h=null),v.next=null),v}class ce{constructor(){this.h=this.g=null}add(v,A){const K=Be.get();K.set(v,A),this.h?this.h.next=K:this.g=K,this.h=K}}var Be=new I(()=>new U,f=>f.reset());class U{constructor(){this.next=this.g=this.h=null}set(v,A){this.h=v,this.g=A,this.next=null}reset(){this.next=this.g=this.h=null}}let se,fe=!1,ie=new ce,_=()=>{const f=u.Promise.resolve(void 0);se=()=>{f.then(E)}};var E=()=>{for(var f;f=F();){try{f.h.call(f.g)}catch(A){te(A)}var v=Be;v.j(f),100>v.h&&(v.h++,f.next=v.g,v.g=f)}fe=!1};function R(){this.s=this.s,this.C=this.C}R.prototype.s=!1,R.prototype.ma=function(){this.s||(this.s=!0,this.N())},R.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function V(f,v){this.type=f,this.g=this.target=v,this.defaultPrevented=!1}V.prototype.h=function(){this.defaultPrevented=!0};var ne=(function(){if(!u.addEventListener||!Object.defineProperty)return!1;var f=!1,v=Object.defineProperty({},"passive",{get:function(){f=!0}});try{const A=()=>{};u.addEventListener("test",A,v),u.removeEventListener("test",A,v)}catch{}return f})();function B(f,v){if(V.call(this,f?f.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,f){var A=this.type=f.type,K=f.changedTouches&&f.changedTouches.length?f.changedTouches[0]:null;if(this.target=f.target||f.srcElement,this.g=v,v=f.relatedTarget){if(Y){e:{try{oe(v.nodeName);var _e=!0;break e}catch{}_e=!1}_e||(v=null)}}else A=="mouseover"?v=f.fromElement:A=="mouseout"&&(v=f.toElement);this.relatedTarget=v,K?(this.clientX=K.clientX!==void 0?K.clientX:K.pageX,this.clientY=K.clientY!==void 0?K.clientY:K.pageY,this.screenX=K.screenX||0,this.screenY=K.screenY||0):(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0),this.button=f.button,this.key=f.key||"",this.ctrlKey=f.ctrlKey,this.altKey=f.altKey,this.shiftKey=f.shiftKey,this.metaKey=f.metaKey,this.pointerId=f.pointerId||0,this.pointerType=typeof f.pointerType=="string"?f.pointerType:q[f.pointerType]||"",this.state=f.state,this.i=f,f.defaultPrevented&&B.aa.h.call(this)}}O(B,V);var q={2:"touch",3:"pen",4:"mouse"};B.prototype.h=function(){B.aa.h.call(this);var f=this.i;f.preventDefault?f.preventDefault():f.returnValue=!1};var me="closure_listenable_"+(1e6*Math.random()|0),C=0;function Z(f,v,A,K,_e){this.listener=f,this.proxy=null,this.src=v,this.type=A,this.capture=!!K,this.ha=_e,this.key=++C,this.da=this.fa=!1}function je(f){f.da=!0,f.listener=null,f.proxy=null,f.src=null,f.ha=null}function Ge(f){this.src=f,this.g={},this.h=0}Ge.prototype.add=function(f,v,A,K,_e){var Me=f.toString();f=this.g[Me],f||(f=this.g[Me]=[],this.h++);var st=ft(f,v,K,_e);return-1<st?(v=f[st],A||(v.fa=!1)):(v=new Z(v,this.src,Me,!!K,_e),v.fa=A,f.push(v)),v};function Ke(f,v){var A=v.type;if(A in f.g){var K=f.g[A],_e=Array.prototype.indexOf.call(K,v,void 0),Me;(Me=0<=_e)&&Array.prototype.splice.call(K,_e,1),Me&&(je(v),f.g[A].length==0&&(delete f.g[A],f.h--))}}function ft(f,v,A,K){for(var _e=0;_e<f.length;++_e){var Me=f[_e];if(!Me.da&&Me.listener==v&&Me.capture==!!A&&Me.ha==K)return _e}return-1}var Ot="closure_lm_"+(1e6*Math.random()|0),Ee={};function it(f,v,A,K,_e){if(Array.isArray(v)){for(var Me=0;Me<v.length;Me++)it(f,v[Me],A,K,_e);return null}return A=es(A),f&&f[me]?f.K(v,A,p(K)?!!K.capture:!1,_e):Nt(f,v,A,!1,K,_e)}function Nt(f,v,A,K,_e,Me){if(!v)throw Error("Invalid event type");var st=p(_e)?!!_e.capture:!!_e,Zt=yn(f);if(Zt||(f[Ot]=Zt=new Ge(f)),A=Zt.add(v,A,K,st,Me),A.proxy)return A;if(K=hn(),A.proxy=K,K.src=f,K.listener=A,f.addEventListener)ne||(_e=st),_e===void 0&&(_e=!1),f.addEventListener(v.toString(),K,_e);else if(f.attachEvent)f.attachEvent(Un(v.toString()),K);else if(f.addListener&&f.removeListener)f.addListener(K);else throw Error("addEventListener and attachEvent are unavailable.");return A}function hn(){function f(A){return v.call(f.src,f.listener,A)}const v=Xt;return f}function xn(f,v,A,K,_e){if(Array.isArray(v))for(var Me=0;Me<v.length;Me++)xn(f,v[Me],A,K,_e);else K=p(K)?!!K.capture:!!K,A=es(A),f&&f[me]?(f=f.i,v=String(v).toString(),v in f.g&&(Me=f.g[v],A=ft(Me,A,K,_e),-1<A&&(je(Me[A]),Array.prototype.splice.call(Me,A,1),Me.length==0&&(delete f.g[v],f.h--)))):f&&(f=yn(f))&&(v=f.g[v.toString()],f=-1,v&&(f=ft(v,A,K,_e)),(A=-1<f?v[f]:null)&&is(A))}function is(f){if(typeof f!="number"&&f&&!f.da){var v=f.src;if(v&&v[me])Ke(v.i,f);else{var A=f.type,K=f.proxy;v.removeEventListener?v.removeEventListener(A,K,f.capture):v.detachEvent?v.detachEvent(Un(A),K):v.addListener&&v.removeListener&&v.removeListener(K),(A=yn(v))?(Ke(A,f),A.h==0&&(A.src=null,v[Ot]=null)):je(f)}}}function Un(f){return f in Ee?Ee[f]:Ee[f]="on"+f}function Xt(f,v){if(f.da)f=!0;else{v=new B(v,this);var A=f.listener,K=f.ha||f.src;f.fa&&is(f),f=A.call(K,v)}return f}function yn(f){return f=f[Ot],f instanceof Ge?f:null}var Zn="__closure_events_fn_"+(1e9*Math.random()>>>0);function es(f){return typeof f=="function"?f:(f[Zn]||(f[Zn]=function(v){return f.handleEvent(v)}),f[Zn])}function an(){R.call(this),this.i=new Ge(this),this.M=this,this.F=null}O(an,R),an.prototype[me]=!0,an.prototype.removeEventListener=function(f,v,A,K){xn(this,f,v,A,K)};function Bt(f,v){var A,K=f.F;if(K)for(A=[];K;K=K.F)A.push(K);if(f=f.M,K=v.type||v,typeof v=="string")v=new V(v,f);else if(v instanceof V)v.target=v.target||f;else{var _e=v;v=new V(K,f),$(v,_e)}if(_e=!0,A)for(var Me=A.length-1;0<=Me;Me--){var st=v.g=A[Me];_e=Nn(st,K,!0,v)&&_e}if(st=v.g=f,_e=Nn(st,K,!0,v)&&_e,_e=Nn(st,K,!1,v)&&_e,A)for(Me=0;Me<A.length;Me++)st=v.g=A[Me],_e=Nn(st,K,!1,v)&&_e}an.prototype.N=function(){if(an.aa.N.call(this),this.i){var f=this.i,v;for(v in f.g){for(var A=f.g[v],K=0;K<A.length;K++)je(A[K]);delete f.g[v],f.h--}}this.F=null},an.prototype.K=function(f,v,A,K){return this.i.add(String(f),v,!1,A,K)},an.prototype.L=function(f,v,A,K){return this.i.add(String(f),v,!0,A,K)};function Nn(f,v,A,K){if(v=f.i.g[String(v)],!v)return!0;v=v.concat();for(var _e=!0,Me=0;Me<v.length;++Me){var st=v[Me];if(st&&!st.da&&st.capture==A){var Zt=st.listener,js=st.ha||st.src;st.fa&&Ke(f.i,st),_e=Zt.call(js,K)!==!1&&_e}}return _e&&!K.defaultPrevented}function T(f,v,A){if(typeof f=="function")A&&(f=j(f,A));else if(f&&typeof f.handleEvent=="function")f=j(f.handleEvent,f);else throw Error("Invalid listener argument");return 2147483647<Number(v)?-1:u.setTimeout(f,v||0)}function re(f){f.g=T(()=>{f.g=null,f.i&&(f.i=!1,re(f))},f.l);const v=f.h;f.h=null,f.m.apply(null,v)}class he extends R{constructor(v,A){super(),this.m=v,this.l=A,this.h=null,this.i=!1,this.g=null}j(v){this.h=arguments,this.g?this.i=!0:re(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function de(f){R.call(this),this.h=f,this.g={}}O(de,R);var xe=[];function Ue(f){be(f.g,function(v,A){this.g.hasOwnProperty(A)&&is(v)},f),f.g={}}de.prototype.N=function(){de.aa.N.call(this),Ue(this)},de.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var bt=u.JSON.stringify,pt=u.JSON.parse,Vs=class{stringify(f){return u.JSON.stringify(f,void 0)}parse(f){return u.JSON.parse(f,void 0)}};function Ne(){}Ne.prototype.h=null;function ue(f){return f.h||(f.h=f.i())}function le(){}var Ie={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Te(){V.call(this,"d")}O(Te,V);function We(){V.call(this,"c")}O(We,V);var ye={},ze=null;function Oe(){return ze=ze||new an}ye.La="serverreachability";function nt(f){V.call(this,ye.La,f)}O(nt,V);function Ze(f){const v=Oe();Bt(v,new nt(v))}ye.STAT_EVENT="statevent";function Je(f,v){V.call(this,ye.STAT_EVENT,f),this.stat=v}O(Je,V);function Ve(f){const v=Oe();Bt(v,new Je(v,f))}ye.Ma="timingevent";function ke(f,v){V.call(this,ye.Ma,f),this.size=v}O(ke,V);function et(f,v){if(typeof f!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){f()},v)}function bn(){this.g=!0}bn.prototype.xa=function(){this.g=!1};function fs(f,v,A,K,_e,Me){f.info(function(){if(f.g)if(Me)for(var st="",Zt=Me.split("&"),js=0;js<Zt.length;js++){var en=Zt[js].split("=");if(1<en.length){var Os=en[0];en=en[1];var _s=Os.split("_");st=2<=_s.length&&_s[1]=="type"?st+(Os+"="+en+"&"):st+(Os+"=redacted&")}}else st=null;else st=Me;return"XMLHTTP REQ ("+K+") [attempt "+_e+"]: "+v+`
`+A+`
`+st})}function dr(f,v,A,K,_e,Me,st){f.info(function(){return"XMLHTTP RESP ("+K+") [ attempt "+_e+"]: "+v+`
`+A+`
`+Me+" "+st})}function vs(f,v,A,K){f.info(function(){return"XMLHTTP TEXT ("+v+"): "+Ai(f,A)+(K?" "+K:"")})}function Hr(f,v){f.info(function(){return"TIMEOUT: "+v})}bn.prototype.info=function(){};function Ai(f,v){if(!f.g)return v;if(!v)return null;try{var A=JSON.parse(v);if(A){for(f=0;f<A.length;f++)if(Array.isArray(A[f])){var K=A[f];if(!(2>K.length)){var _e=K[1];if(Array.isArray(_e)&&!(1>_e.length)){var Me=_e[0];if(Me!="noop"&&Me!="stop"&&Me!="close")for(var st=1;st<_e.length;st++)_e[st]=""}}}}return bt(A)}catch{return v}}var Na={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},li={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Di;function Ri(){}O(Ri,Ne),Ri.prototype.g=function(){return new XMLHttpRequest},Ri.prototype.i=function(){return{}},Di=new Ri;function ps(f,v,A,K){this.j=f,this.i=v,this.l=A,this.R=K||1,this.U=new de(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Qt}function Qt(){this.i=null,this.g="",this.h=!1}var zs={},Rs={};function Vn(f,v,A){f.L=1,f.v=Li(Bn(v)),f.m=A,f.P=!0,Gr(f,null)}function Gr(f,v){f.F=Date.now(),Qr(f),f.A=Bn(f.v);var A=f.A,K=f.R;Array.isArray(K)||(K=[String(K)]),fo(A.i,"t",K),f.C=0,A=f.j.J,f.h=new Qt,f.g=Md(f.j,A?v:null,!f.m),0<f.O&&(f.M=new he(j(f.Y,f,f.g),f.O)),v=f.U,A=f.g,K=f.ca;var _e="readystatechange";Array.isArray(_e)||(_e&&(xe[0]=_e.toString()),_e=xe);for(var Me=0;Me<_e.length;Me++){var st=it(A,_e[Me],K||v.handleEvent,!1,v.h||v);if(!st)break;v.g[st.key]=st}v=f.H?H(f.H):{},f.m?(f.u||(f.u="POST"),v["Content-Type"]="application/x-www-form-urlencoded",f.g.ea(f.A,f.u,f.m,v)):(f.u="GET",f.g.ea(f.A,f.u,null,v)),Ze(),fs(f.i,f.u,f.A,f.l,f.R,f.m)}ps.prototype.ca=function(f){f=f.target;const v=this.M;v&&qs(f)==3?v.j():this.Y(f)},ps.prototype.Y=function(f){try{if(f==this.g)e:{const _s=qs(this.g);var v=this.g.Ba();const Es=this.g.Z();if(!(3>_s)&&(_s!=3||this.g&&(this.h.h||this.g.oa()||Pd(this.g)))){this.J||_s!=4||v==7||(v==8||0>=Es?Ze(3):Ze(2)),ki(this);var A=this.g.Z();this.X=A;t:if(ta(this)){var K=Pd(this.g);f="";var _e=K.length,Me=qs(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ps(this),ur(this);var st="";break t}this.h.i=new u.TextDecoder}for(v=0;v<_e;v++)this.h.h=!0,f+=this.h.i.decode(K[v],{stream:!(Me&&v==_e-1)});K.length=0,this.h.g+=f,this.C=0,st=this.h.g}else st=this.g.oa();if(this.o=A==200,dr(this.i,this.u,this.A,this.l,this.R,_s,A),this.o){if(this.T&&!this.K){t:{if(this.g){var Zt,js=this.g;if((Zt=js.g?js.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ee(Zt)){var en=Zt;break t}}en=null}if(A=en)vs(this.i,this.l,A,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,na(this,A);else{this.o=!1,this.s=3,Ve(12),Ps(this),ur(this);break e}}if(this.P){A=!0;let Ms;for(;!this.J&&this.C<st.length;)if(Ms=Pi(this,st),Ms==Rs){_s==4&&(this.s=4,Ve(14),A=!1),vs(this.i,this.l,null,"[Incomplete Response]");break}else if(Ms==zs){this.s=4,Ve(15),vs(this.i,this.l,st,"[Invalid Chunk]"),A=!1;break}else vs(this.i,this.l,Ms,null),na(this,Ms);if(ta(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),_s!=4||st.length!=0||this.h.h||(this.s=1,Ve(16),A=!1),this.o=this.o&&A,!A)vs(this.i,this.l,st,"[Invalid Chunked Response]"),Ps(this),ur(this);else if(0<st.length&&!this.W){this.W=!0;var Os=this.j;Os.g==this&&Os.ba&&!Os.M&&(Os.j.info("Great, no buffering proxy detected. Bytes received: "+st.length),vo(Os),Os.M=!0,Ve(11))}}else vs(this.i,this.l,st,null),na(this,st);_s==4&&Ps(this),this.o&&!this.J&&(_s==4?Pc(this.j,this):(this.o=!1,Qr(this)))}else kd(this.g),A==400&&0<st.indexOf("Unknown SID")?(this.s=3,Ve(12)):(this.s=0,Ve(13)),Ps(this),ur(this)}}}catch{}finally{}};function ta(f){return f.g?f.u=="GET"&&f.L!=2&&f.j.Ca:!1}function Pi(f,v){var A=f.C,K=v.indexOf(`
`,A);return K==-1?Rs:(A=Number(v.substring(A,K)),isNaN(A)?zs:(K+=1,K+A>v.length?Rs:(v=v.slice(K,K+A),f.C=K+A,v)))}ps.prototype.cancel=function(){this.J=!0,Ps(this)};function Qr(f){f.S=Date.now()+f.I,Ec(f,f.I)}function Ec(f,v){if(f.B!=null)throw Error("WatchDog timer not null");f.B=et(j(f.ba,f),v)}function ki(f){f.B&&(u.clearTimeout(f.B),f.B=null)}ps.prototype.ba=function(){this.B=null;const f=Date.now();0<=f-this.S?(Hr(this.i,this.A),this.L!=2&&(Ze(),Ve(17)),Ps(this),this.s=2,ur(this)):Ec(this,this.S-f)};function ur(f){f.j.G==0||f.J||Pc(f.j,f)}function Ps(f){ki(f);var v=f.M;v&&typeof v.ma=="function"&&v.ma(),f.M=null,Ue(f.U),f.g&&(v=f.g,f.g=null,v.abort(),v.ma())}function na(f,v){try{var A=f.j;if(A.G!=0&&(A.g==f||hl(A.h,f))){if(!f.K&&hl(A.h,f)&&A.G==3){try{var K=A.Da.g.parse(v)}catch{K=null}if(Array.isArray(K)&&K.length==3){var _e=K;if(_e[0]==0){e:if(!A.u){if(A.g)if(A.g.F+3e3<f.F)No(A),yo(A);else break e;Rc(A),Ve(18)}}else A.za=_e[1],0<A.za-A.T&&37500>_e[2]&&A.F&&A.v==0&&!A.C&&(A.C=et(j(A.Za,A),6e3));if(1>=co(A.h)&&A.ca){try{A.ca()}catch{}A.ca=void 0}}else mi(A,11)}else if((f.K||A.g==f)&&No(A),!ee(v))for(_e=A.Da.g.parse(v),v=0;v<_e.length;v++){let en=_e[v];if(A.T=en[0],en=en[1],A.G==2)if(en[0]=="c"){A.K=en[1],A.ia=en[2];const Os=en[3];Os!=null&&(A.la=Os,A.j.info("VER="+A.la));const _s=en[4];_s!=null&&(A.Aa=_s,A.j.info("SVER="+A.Aa));const Es=en[5];Es!=null&&typeof Es=="number"&&0<Es&&(K=1.5*Es,A.L=K,A.j.info("backChannelRequestTimeoutMs_="+K)),K=A;const Ms=f.g;if(Ms){const fi=Ms.g?Ms.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(fi){var Me=K.h;Me.g||fi.indexOf("spdy")==-1&&fi.indexOf("quic")==-1&&fi.indexOf("h2")==-1||(Me.j=Me.l,Me.g=new Set,Me.h&&(uo(Me,Me.h),Me.h=null))}if(K.D){const wl=Ms.g?Ms.g.getResponseHeader("X-HTTP-Session-Id"):null;wl&&(K.ya=wl,Jt(K.I,K.D,wl))}}A.G=3,A.l&&A.l.ua(),A.ba&&(A.R=Date.now()-f.F,A.j.info("Handshake RTT: "+A.R+"ms")),K=A;var st=f;if(K.qa=kc(K,K.J?K.ia:null,K.W),st.K){er(K.h,st);var Zt=st,js=K.L;js&&(Zt.I=js),Zt.B&&(ki(Zt),Qr(Zt)),K.g=st}else wo(K);0<A.i.length&&bo(A)}else en[0]!="stop"&&en[0]!="close"||mi(A,7);else A.G==3&&(en[0]=="stop"||en[0]=="close"?en[0]=="stop"?mi(A,7):gl(A):en[0]!="noop"&&A.l&&A.l.ta(en),A.v=0)}}Ze(4)}catch{}}var ul=class{constructor(f,v){this.g=f,this.map=v}};function Oi(f){this.l=f||10,u.PerformanceNavigationTiming?(f=u.performance.getEntriesByType("navigation"),f=0<f.length&&(f[0].nextHopProtocol=="hq"||f[0].nextHopProtocol=="h2")):f=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=f?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function lo(f){return f.h?!0:f.g?f.g.size>=f.j:!1}function co(f){return f.h?1:f.g?f.g.size:0}function hl(f,v){return f.h?f.h==v:f.g?f.g.has(v):!1}function uo(f,v){f.g?f.g.add(v):f.h=v}function er(f,v){f.h&&f.h==v?f.h=null:f.g&&f.g.has(v)&&f.g.delete(v)}Oi.prototype.cancel=function(){if(this.i=ml(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const f of this.g.values())f.cancel();this.g.clear()}};function ml(f){if(f.h!=null)return f.i.concat(f.h.D);if(f.g!=null&&f.g.size!==0){let v=f.i;for(const A of f.g.values())v=v.concat(A.D);return v}return Q(f.i)}function Dd(f){if(f.V&&typeof f.V=="function")return f.V();if(typeof Map<"u"&&f instanceof Map||typeof Set<"u"&&f instanceof Set)return Array.from(f.values());if(typeof f=="string")return f.split("");if(m(f)){for(var v=[],A=f.length,K=0;K<A;K++)v.push(f[K]);return v}v=[],A=0;for(K in f)v[A++]=f[K];return v}function ho(f){if(f.na&&typeof f.na=="function")return f.na();if(!f.V||typeof f.V!="function"){if(typeof Map<"u"&&f instanceof Map)return Array.from(f.keys());if(!(typeof Set<"u"&&f instanceof Set)){if(m(f)||typeof f=="string"){var v=[];f=f.length;for(var A=0;A<f;A++)v.push(A);return v}v=[],A=0;for(const K in f)v[A++]=K;return v}}}function fl(f,v){if(f.forEach&&typeof f.forEach=="function")f.forEach(v,void 0);else if(m(f)||typeof f=="string")Array.prototype.forEach.call(f,v,void 0);else for(var A=ho(f),K=Dd(f),_e=K.length,Me=0;Me<_e;Me++)v.call(void 0,K[Me],A&&A[Me],f)}var tr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function hr(f,v){if(f){f=f.split("&");for(var A=0;A<f.length;A++){var K=f[A].indexOf("="),_e=null;if(0<=K){var Me=f[A].substring(0,K);_e=f[A].substring(K+1)}else Me=f[A];v(Me,_e?decodeURIComponent(_e.replace(/\+/g," ")):"")}}}function kn(f){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,f instanceof kn){this.h=f.h,sa(this,f.j),this.o=f.o,this.g=f.g,Mi(this,f.s),this.l=f.l;var v=f.i,A=new nr;A.i=v.i,v.g&&(A.g=new Map(v.g),A.h=v.h),ks(this,A),this.m=f.m}else f&&(v=String(f).match(tr))?(this.h=!1,sa(this,v[1]||"",!0),this.o=$s(v[2]||""),this.g=$s(v[3]||"",!0),Mi(this,v[4]),this.l=$s(v[5]||"",!0),ks(this,v[6]||"",!0),this.m=$s(v[7]||"")):(this.h=!1,this.i=new nr(null,this.h))}kn.prototype.toString=function(){var f=[],v=this.j;v&&f.push(ra(v,Fi,!0),":");var A=this.g;return(A||v=="file")&&(f.push("//"),(v=this.o)&&f.push(ra(v,Fi,!0),"@"),f.push(encodeURIComponent(String(A)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),A=this.s,A!=null&&f.push(":",String(A))),(A=this.l)&&(this.g&&A.charAt(0)!="/"&&f.push("/"),f.push(ra(A,A.charAt(0)=="/"?Rd:mo,!0))),(A=this.i.toString())&&f.push("?",A),(A=this.m)&&f.push("#",ra(A,pl)),f.join("")};function Bn(f){return new kn(f)}function sa(f,v,A){f.j=A?$s(v,!0):v,f.j&&(f.j=f.j.replace(/:$/,""))}function Mi(f,v){if(v){if(v=Number(v),isNaN(v)||0>v)throw Error("Bad port number "+v);f.s=v}else f.s=null}function ks(f,v,A){v instanceof nr?(f.i=v,Ic(f.i,f.h)):(A||(v=ra(v,ci)),f.i=new nr(v,f.h))}function Jt(f,v,A){f.i.set(v,A)}function Li(f){return Jt(f,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),f}function $s(f,v){return f?v?decodeURI(f.replace(/%25/g,"%2525")):decodeURIComponent(f):""}function ra(f,v,A){return typeof f=="string"?(f=encodeURI(f).replace(v,Sc),A&&(f=f.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f):null}function Sc(f){return f=f.charCodeAt(0),"%"+(f>>4&15).toString(16)+(f&15).toString(16)}var Fi=/[#\/\?@]/g,mo=/[#\?:]/g,Rd=/[#\?]/g,ci=/[#\?@]/g,pl=/#/g;function nr(f,v){this.h=this.g=null,this.i=f||null,this.j=!!v}function mr(f){f.g||(f.g=new Map,f.h=0,f.i&&hr(f.i,function(v,A){f.add(decodeURIComponent(v.replace(/\+/g," ")),A)}))}r=nr.prototype,r.add=function(f,v){mr(this),this.i=null,f=Er(this,f);var A=this.g.get(f);return A||this.g.set(f,A=[]),A.push(v),this.h+=1,this};function Ui(f,v){mr(f),v=Er(f,v),f.g.has(v)&&(f.i=null,f.h-=f.g.get(v).length,f.g.delete(v))}function Lr(f,v){return mr(f),v=Er(f,v),f.g.has(v)}r.forEach=function(f,v){mr(this),this.g.forEach(function(A,K){A.forEach(function(_e){f.call(v,_e,K,this)},this)},this)},r.na=function(){mr(this);const f=Array.from(this.g.values()),v=Array.from(this.g.keys()),A=[];for(let K=0;K<v.length;K++){const _e=f[K];for(let Me=0;Me<_e.length;Me++)A.push(v[K])}return A},r.V=function(f){mr(this);let v=[];if(typeof f=="string")Lr(this,f)&&(v=v.concat(this.g.get(Er(this,f))));else{f=Array.from(this.g.values());for(let A=0;A<f.length;A++)v=v.concat(f[A])}return v},r.set=function(f,v){return mr(this),this.i=null,f=Er(this,f),Lr(this,f)&&(this.h-=this.g.get(f).length),this.g.set(f,[v]),this.h+=1,this},r.get=function(f,v){return f?(f=this.V(f),0<f.length?String(f[0]):v):v};function fo(f,v,A){Ui(f,v),0<A.length&&(f.i=null,f.g.set(Er(f,v),Q(A)),f.h+=A.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const f=[],v=Array.from(this.g.keys());for(var A=0;A<v.length;A++){var K=v[A];const Me=encodeURIComponent(String(K)),st=this.V(K);for(K=0;K<st.length;K++){var _e=Me;st[K]!==""&&(_e+="="+encodeURIComponent(String(st[K]))),f.push(_e)}}return this.i=f.join("&")};function Er(f,v){return v=String(v),f.j&&(v=v.toLowerCase()),v}function Ic(f,v){v&&!f.j&&(mr(f),f.i=null,f.g.forEach(function(A,K){var _e=K.toLowerCase();K!=_e&&(Ui(this,K),fo(this,_e,A))},f)),f.j=v}function ja(f,v){const A=new bn;if(u.Image){const K=new Image;K.onload=D(Bs,A,"TestLoadImage: loaded",!0,v,K),K.onerror=D(Bs,A,"TestLoadImage: error",!1,v,K),K.onabort=D(Bs,A,"TestLoadImage: abort",!1,v,K),K.ontimeout=D(Bs,A,"TestLoadImage: timeout",!1,v,K),u.setTimeout(function(){K.ontimeout&&K.ontimeout()},1e4),K.src=f}else v(!1)}function Wr(f,v){const A=new bn,K=new AbortController,_e=setTimeout(()=>{K.abort(),Bs(A,"TestPingServer: timeout",!1,v)},1e4);fetch(f,{signal:K.signal}).then(Me=>{clearTimeout(_e),Me.ok?Bs(A,"TestPingServer: ok",!0,v):Bs(A,"TestPingServer: server error",!1,v)}).catch(()=>{clearTimeout(_e),Bs(A,"TestPingServer: error",!1,v)})}function Bs(f,v,A,K,_e){try{_e&&(_e.onload=null,_e.onerror=null,_e.onabort=null,_e.ontimeout=null),K(A)}catch{}}function po(){this.g=new Vs}function di(f,v,A){const K=A||"";try{fl(f,function(_e,Me){let st=_e;p(_e)&&(st=bt(_e)),v.push(K+Me+"="+encodeURIComponent(st))})}catch(_e){throw v.push(K+"type="+encodeURIComponent("_badmap")),_e}}function Vi(f){this.l=f.Ub||null,this.j=f.eb||!1}O(Vi,Ne),Vi.prototype.g=function(){return new Kr(this.l,this.j)},Vi.prototype.i=(function(f){return function(){return f}})({});function Kr(f,v){an.call(this),this.D=f,this.o=v,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}O(Kr,an),r=Kr.prototype,r.open=function(f,v){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=f,this.A=v,this.readyState=1,Fr(this)},r.send=function(f){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const v={headers:this.u,method:this.B,credentials:this.m,cache:void 0};f&&(v.body=f),(this.D||u).fetch(new Request(this.A,v)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,zi(this)),this.readyState=0},r.Sa=function(f){if(this.g&&(this.l=f,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=f.headers,this.readyState=2,Fr(this)),this.g&&(this.readyState=3,Fr(this),this.g)))if(this.responseType==="arraybuffer")f.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in f){if(this.j=f.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;go(this)}else f.text().then(this.Ra.bind(this),this.ga.bind(this))};function go(f){f.j.read().then(f.Pa.bind(f)).catch(f.ga.bind(f))}r.Pa=function(f){if(this.g){if(this.o&&f.value)this.response.push(f.value);else if(!this.o){var v=f.value?f.value:new Uint8Array(0);(v=this.v.decode(v,{stream:!f.done}))&&(this.response=this.responseText+=v)}f.done?zi(this):Fr(this),this.readyState==3&&go(this)}},r.Ra=function(f){this.g&&(this.response=this.responseText=f,zi(this))},r.Qa=function(f){this.g&&(this.response=f,zi(this))},r.ga=function(){this.g&&zi(this)};function zi(f){f.readyState=4,f.l=null,f.j=null,f.v=null,Fr(f)}r.setRequestHeader=function(f,v){this.u.append(f,v)},r.getResponseHeader=function(f){return this.h&&this.h.get(f.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const f=[],v=this.h.entries();for(var A=v.next();!A.done;)A=A.value,f.push(A[0]+": "+A[1]),A=v.next();return f.join(`\r
`)};function Fr(f){f.onreadystatechange&&f.onreadystatechange.call(f)}Object.defineProperty(Kr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(f){this.m=f?"include":"same-origin"}});function Tc(f){let v="";return be(f,function(A,K){v+=K,v+=":",v+=A,v+=`\r
`}),v}function Ns(f,v,A){e:{for(K in A){var K=!1;break e}K=!0}K||(A=Tc(A),typeof f=="string"?A!=null&&encodeURIComponent(String(A)):Jt(f,v,A))}function ln(f){an.call(this),this.headers=new Map,this.o=f||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}O(ln,an);var _a=/^https?$/i,ia=["POST","PUT"];r=ln.prototype,r.Ha=function(f){this.J=f},r.ea=function(f,v,A,K){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+f);v=v?v.toUpperCase():"GET",this.D=f,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Di.g(),this.v=this.o?ue(this.o):ue(Di),this.g.onreadystatechange=j(this.Ea,this);try{this.B=!0,this.g.open(v,String(f),!0),this.B=!1}catch(Me){Cc(this,Me);return}if(f=A||"",A=new Map(this.headers),K)if(Object.getPrototypeOf(K)===Object.prototype)for(var _e in K)A.set(_e,K[_e]);else if(typeof K.keys=="function"&&typeof K.get=="function")for(const Me of K.keys())A.set(Me,K.get(Me));else throw Error("Unknown input type for opt_headers: "+String(K));K=Array.from(A.keys()).find(Me=>Me.toLowerCase()=="content-type"),_e=u.FormData&&f instanceof u.FormData,!(0<=Array.prototype.indexOf.call(ia,v,void 0))||K||_e||A.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Me,st]of A)this.g.setRequestHeader(Me,st);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Sa(this),this.u=!0,this.g.send(f),this.u=!1}catch(Me){Cc(this,Me)}};function Cc(f,v){f.h=!1,f.g&&(f.j=!0,f.g.abort(),f.j=!1),f.l=v,f.m=5,$i(f),ui(f)}function $i(f){f.A||(f.A=!0,Bt(f,"complete"),Bt(f,"error"))}r.abort=function(f){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=f||7,Bt(this,"complete"),Bt(this,"abort"),ui(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ui(this,!0)),ln.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Ea(this):this.bb())},r.bb=function(){Ea(this)};function Ea(f){if(f.h&&typeof c<"u"&&(!f.v[1]||qs(f)!=4||f.Z()!=2)){if(f.u&&qs(f)==4)T(f.Ea,0,f);else if(Bt(f,"readystatechange"),qs(f)==4){f.h=!1;try{const st=f.Z();e:switch(st){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var v=!0;break e;default:v=!1}var A;if(!(A=v)){var K;if(K=st===0){var _e=String(f.D).match(tr)[1]||null;!_e&&u.self&&u.self.location&&(_e=u.self.location.protocol.slice(0,-1)),K=!_a.test(_e?_e.toLowerCase():"")}A=K}if(A)Bt(f,"complete"),Bt(f,"success");else{f.m=6;try{var Me=2<qs(f)?f.g.statusText:""}catch{Me=""}f.l=Me+" ["+f.Z()+"]",$i(f)}}finally{ui(f)}}}}function ui(f,v){if(f.g){Sa(f);const A=f.g,K=f.v[0]?()=>{}:null;f.g=null,f.v=null,v||Bt(f,"ready");try{A.onreadystatechange=K}catch{}}}function Sa(f){f.I&&(u.clearTimeout(f.I),f.I=null)}r.isActive=function(){return!!this.g};function qs(f){return f.g?f.g.readyState:0}r.Z=function(){try{return 2<qs(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(f){if(this.g){var v=this.g.responseText;return f&&v.indexOf(f)==0&&(v=v.substring(f.length)),pt(v)}};function Pd(f){try{if(!f.g)return null;if("response"in f.g)return f.g.response;switch(f.H){case"":case"text":return f.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in f.g)return f.g.mozResponseArrayBuffer}return null}catch{return null}}function kd(f){const v={};f=(f.g&&2<=qs(f)&&f.g.getAllResponseHeaders()||"").split(`\r
`);for(let K=0;K<f.length;K++){if(ee(f[K]))continue;var A=X(f[K]);const _e=A[0];if(A=A[1],typeof A!="string")continue;A=A.trim();const Me=v[_e]||[];v[_e]=Me,Me.push(A)}M(v,function(K){return K.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ia(f,v,A){return A&&A.internalChannelParams&&A.internalChannelParams[f]||v}function xo(f){this.Aa=0,this.i=[],this.j=new bn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ia("failFast",!1,f),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ia("baseRetryDelayMs",5e3,f),this.cb=Ia("retryDelaySeedMs",1e4,f),this.Wa=Ia("forwardChannelMaxRetries",2,f),this.wa=Ia("forwardChannelRequestTimeoutMs",2e4,f),this.pa=f&&f.xmlHttpFactory||void 0,this.Xa=f&&f.Tb||void 0,this.Ca=f&&f.useFetchStreams||!1,this.L=void 0,this.J=f&&f.supportsCrossDomainXhr||!1,this.K="",this.h=new Oi(f&&f.concurrentRequestLimit),this.Da=new po,this.P=f&&f.fastHandshake||!1,this.O=f&&f.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=f&&f.Rb||!1,f&&f.xa&&this.j.xa(),f&&f.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&f&&f.detectBufferingProxy||!1,this.ja=void 0,f&&f.longPollingTimeout&&0<f.longPollingTimeout&&(this.ja=f.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=xo.prototype,r.la=8,r.G=1,r.connect=function(f,v,A,K){Ve(0),this.W=f,this.H=v||{},A&&K!==void 0&&(this.H.OSID=A,this.H.OAID=K),this.F=this.X,this.I=kc(this,null,this.W),bo(this)};function gl(f){if(xl(f),f.G==3){var v=f.U++,A=Bn(f.I);if(Jt(A,"SID",f.K),Jt(A,"RID",v),Jt(A,"TYPE","terminate"),Ta(f,A),v=new ps(f,f.j,v),v.L=2,v.v=Li(Bn(A)),A=!1,u.navigator&&u.navigator.sendBeacon)try{A=u.navigator.sendBeacon(v.v.toString(),"")}catch{}!A&&u.Image&&(new Image().src=v.v,A=!0),A||(v.g=Md(v.j,null),v.g.ea(v.v)),v.F=Date.now(),Qr(v)}Od(f)}function yo(f){f.g&&(vo(f),f.g.cancel(),f.g=null)}function xl(f){yo(f),f.u&&(u.clearTimeout(f.u),f.u=null),No(f),f.h.cancel(),f.s&&(typeof f.s=="number"&&u.clearTimeout(f.s),f.s=null)}function bo(f){if(!lo(f.h)&&!f.s){f.s=!0;var v=f.Ga;se||_(),fe||(se(),fe=!0),ie.add(v,f),f.B=0}}function bh(f,v){return co(f.h)>=f.h.j-(f.s?1:0)?!1:f.s?(f.i=v.D.concat(f.i),!0):f.G==1||f.G==2||f.B>=(f.Va?0:f.Wa)?!1:(f.s=et(j(f.Ga,f,v),hi(f,f.B)),f.B++,!0)}r.Ga=function(f){if(this.s)if(this.s=null,this.G==1){if(!f){this.U=Math.floor(1e5*Math.random()),f=this.U++;const _e=new ps(this,this.j,f);let Me=this.o;if(this.S&&(Me?(Me=H(Me),$(Me,this.S)):Me=this.S),this.m!==null||this.O||(_e.H=Me,Me=null),this.P)e:{for(var v=0,A=0;A<this.i.length;A++){t:{var K=this.i[A];if("__data__"in K.map&&(K=K.map.__data__,typeof K=="string")){K=K.length;break t}K=void 0}if(K===void 0)break;if(v+=K,4096<v){v=A;break e}if(v===4096||A===this.i.length-1){v=A+1;break e}}v=1e3}else v=1e3;v=Dc(this,_e,v),A=Bn(this.I),Jt(A,"RID",f),Jt(A,"CVER",22),this.D&&Jt(A,"X-HTTP-Session-Id",this.D),Ta(this,A),Me&&(this.O?v="headers="+encodeURIComponent(String(Tc(Me)))+"&"+v:this.m&&Ns(A,this.m,Me)),uo(this.h,_e),this.Ua&&Jt(A,"TYPE","init"),this.P?(Jt(A,"$req",v),Jt(A,"SID","null"),_e.T=!0,Vn(_e,A,null)):Vn(_e,A,v),this.G=2}}else this.G==3&&(f?Ac(this,f):this.i.length==0||lo(this.h)||Ac(this))};function Ac(f,v){var A;v?A=v.l:A=f.U++;const K=Bn(f.I);Jt(K,"SID",f.K),Jt(K,"RID",A),Jt(K,"AID",f.T),Ta(f,K),f.m&&f.o&&Ns(K,f.m,f.o),A=new ps(f,f.j,A,f.B+1),f.m===null&&(A.H=f.o),v&&(f.i=v.D.concat(f.i)),v=Dc(f,A,1e3),A.I=Math.round(.5*f.wa)+Math.round(.5*f.wa*Math.random()),uo(f.h,A),Vn(A,K,v)}function Ta(f,v){f.H&&be(f.H,function(A,K){Jt(v,K,A)}),f.l&&fl({},function(A,K){Jt(v,K,A)})}function Dc(f,v,A){A=Math.min(f.i.length,A);var K=f.l?j(f.l.Na,f.l,f):null;e:{var _e=f.i;let Me=-1;for(;;){const st=["count="+A];Me==-1?0<A?(Me=_e[0].g,st.push("ofs="+Me)):Me=0:st.push("ofs="+Me);let Zt=!0;for(let js=0;js<A;js++){let en=_e[js].g;const Os=_e[js].map;if(en-=Me,0>en)Me=Math.max(0,_e[js].g-100),Zt=!1;else try{di(Os,st,"req"+en+"_")}catch{K&&K(Os)}}if(Zt){K=st.join("&");break e}}}return f=f.i.splice(0,A),v.D=f,K}function wo(f){if(!f.g&&!f.u){f.Y=1;var v=f.Fa;se||_(),fe||(se(),fe=!0),ie.add(v,f),f.v=0}}function Rc(f){return f.g||f.u||3<=f.v?!1:(f.Y++,f.u=et(j(f.Fa,f),hi(f,f.v)),f.v++,!0)}r.Fa=function(){if(this.u=null,yl(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var f=2*this.R;this.j.info("BP detection timer enabled: "+f),this.A=et(j(this.ab,this),f)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ve(10),yo(this),yl(this))};function vo(f){f.A!=null&&(u.clearTimeout(f.A),f.A=null)}function yl(f){f.g=new ps(f,f.j,"rpc",f.Y),f.m===null&&(f.g.H=f.o),f.g.O=0;var v=Bn(f.qa);Jt(v,"RID","rpc"),Jt(v,"SID",f.K),Jt(v,"AID",f.T),Jt(v,"CI",f.F?"0":"1"),!f.F&&f.ja&&Jt(v,"TO",f.ja),Jt(v,"TYPE","xmlhttp"),Ta(f,v),f.m&&f.o&&Ns(v,f.m,f.o),f.L&&(f.g.I=f.L);var A=f.g;f=f.ia,A.L=1,A.v=Li(Bn(v)),A.m=null,A.P=!0,Gr(A,f)}r.Za=function(){this.C!=null&&(this.C=null,yo(this),Rc(this),Ve(19))};function No(f){f.C!=null&&(u.clearTimeout(f.C),f.C=null)}function Pc(f,v){var A=null;if(f.g==v){No(f),vo(f),f.g=null;var K=2}else if(hl(f.h,v))A=v.D,er(f.h,v),K=1;else return;if(f.G!=0){if(v.o)if(K==1){A=v.m?v.m.length:0,v=Date.now()-v.F;var _e=f.B;K=Oe(),Bt(K,new ke(K,A)),bo(f)}else wo(f);else if(_e=v.s,_e==3||_e==0&&0<v.X||!(K==1&&bh(f,v)||K==2&&Rc(f)))switch(A&&0<A.length&&(v=f.h,v.i=v.i.concat(A)),_e){case 1:mi(f,5);break;case 4:mi(f,10);break;case 3:mi(f,6);break;default:mi(f,2)}}}function hi(f,v){let A=f.Ta+Math.floor(Math.random()*f.cb);return f.isActive()||(A*=2),A*v}function mi(f,v){if(f.j.info("Error code "+v),v==2){var A=j(f.fb,f),K=f.Xa;const _e=!K;K=new kn(K||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||sa(K,"https"),Li(K),_e?ja(K.toString(),A):Wr(K.toString(),A)}else Ve(2);f.G=0,f.l&&f.l.sa(v),Od(f),xl(f)}r.fb=function(f){f?(this.j.info("Successfully pinged google.com"),Ve(2)):(this.j.info("Failed to ping google.com"),Ve(1))};function Od(f){if(f.G=0,f.ka=[],f.l){const v=ml(f.h);(v.length!=0||f.i.length!=0)&&(z(f.ka,v),z(f.ka,f.i),f.h.i.length=0,Q(f.i),f.i.length=0),f.l.ra()}}function kc(f,v,A){var K=A instanceof kn?Bn(A):new kn(A);if(K.g!="")v&&(K.g=v+"."+K.g),Mi(K,K.s);else{var _e=u.location;K=_e.protocol,v=v?v+"."+_e.hostname:_e.hostname,_e=+_e.port;var Me=new kn(null);K&&sa(Me,K),v&&(Me.g=v),_e&&Mi(Me,_e),A&&(Me.l=A),K=Me}return A=f.D,v=f.ya,A&&v&&Jt(K,A,v),Jt(K,"VER",f.la),Ta(f,K),K}function Md(f,v,A){if(v&&!f.J)throw Error("Can't create secondary domain capable XhrIo object.");return v=f.Ca&&!f.pa?new ln(new Vi({eb:A})):new ln(f.pa),v.Ha(f.J),v}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ld(){}r=Ld.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function bl(){}bl.prototype.g=function(f,v){return new fr(f,v)};function fr(f,v){an.call(this),this.g=new xo(v),this.l=f,this.h=v&&v.messageUrlParams||null,f=v&&v.messageHeaders||null,v&&v.clientProtocolHeaderRequired&&(f?f["X-Client-Protocol"]="webchannel":f={"X-Client-Protocol":"webchannel"}),this.g.o=f,f=v&&v.initMessageHeaders||null,v&&v.messageContentType&&(f?f["X-WebChannel-Content-Type"]=v.messageContentType:f={"X-WebChannel-Content-Type":v.messageContentType}),v&&v.va&&(f?f["X-WebChannel-Client-Profile"]=v.va:f={"X-WebChannel-Client-Profile":v.va}),this.g.S=f,(f=v&&v.Sb)&&!ee(f)&&(this.g.m=f),this.v=v&&v.supportsCrossDomainXhr||!1,this.u=v&&v.sendRawJson||!1,(v=v&&v.httpSessionIdParam)&&!ee(v)&&(this.g.D=v,f=this.h,f!==null&&v in f&&(f=this.h,v in f&&delete f[v])),this.j=new Bi(this)}O(fr,an),fr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},fr.prototype.close=function(){gl(this.g)},fr.prototype.o=function(f){var v=this.g;if(typeof f=="string"){var A={};A.__data__=f,f=A}else this.u&&(A={},A.__data__=bt(f),f=A);v.i.push(new ul(v.Ya++,f)),v.G==3&&bo(v)},fr.prototype.N=function(){this.g.l=null,delete this.j,gl(this.g),delete this.g,fr.aa.N.call(this)};function Oc(f){Te.call(this),f.__headers__&&(this.headers=f.__headers__,this.statusCode=f.__status__,delete f.__headers__,delete f.__status__);var v=f.__sm__;if(v){e:{for(const A in v){f=A;break e}f=void 0}(this.i=f)&&(f=this.i,v=v!==null&&f in v?v[f]:void 0),this.data=v}else this.data=f}O(Oc,Te);function Mc(){We.call(this),this.status=1}O(Mc,We);function Bi(f){this.g=f}O(Bi,Ld),Bi.prototype.ua=function(){Bt(this.g,"a")},Bi.prototype.ta=function(f){Bt(this.g,new Oc(f))},Bi.prototype.sa=function(f){Bt(this.g,new Mc)},Bi.prototype.ra=function(){Bt(this.g,"b")},bl.prototype.createWebChannel=bl.prototype.g,fr.prototype.send=fr.prototype.o,fr.prototype.open=fr.prototype.m,fr.prototype.close=fr.prototype.close,DS=function(){return new bl},AS=function(){return Oe()},CS=ye,qb={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Na.NO_ERROR=0,Na.TIMEOUT=8,Na.HTTP_ERROR=6,fg=Na,li.COMPLETE="complete",TS=li,le.EventType=Ie,Ie.OPEN="a",Ie.CLOSE="b",Ie.ERROR="c",Ie.MESSAGE="d",an.prototype.listen=an.prototype.K,Lm=le,ln.prototype.listenOnce=ln.prototype.L,ln.prototype.getLastError=ln.prototype.Ka,ln.prototype.getLastErrorCode=ln.prototype.Ba,ln.prototype.getStatus=ln.prototype.Z,ln.prototype.getResponseJson=ln.prototype.Oa,ln.prototype.getResponseText=ln.prototype.oa,ln.prototype.send=ln.prototype.ea,ln.prototype.setWithCredentials=ln.prototype.Ha,IS=ln}).apply(typeof tg<"u"?tg:typeof self<"u"?self:typeof window<"u"?window:{});const Hj="@firebase/firestore",Gj="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lr{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}lr.UNAUTHENTICATED=new lr(null),lr.GOOGLE_CREDENTIALS=new lr("google-credentials-uid"),lr.FIRST_PARTY=new lr("first-party-uid"),lr.MOCK_USER=new lr("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oh="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wd=new P0("@firebase/firestore");function vu(){return wd.logLevel}function Ye(r,...e){if(wd.logLevel<=tn.DEBUG){const t=e.map(L0);wd.debug(`Firestore (${oh}): ${r}`,...t)}}function As(r,...e){if(wd.logLevel<=tn.ERROR){const t=e.map(L0);wd.error(`Firestore (${oh}): ${r}`,...t)}}function Lu(r,...e){if(wd.logLevel<=tn.WARN){const t=e.map(L0);wd.warn(`Firestore (${oh}): ${r}`,...t)}}function L0(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ht(r,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,RS(r,s,t)}function RS(r,e,t){let s=`FIRESTORE (${oh}) INTERNAL ASSERTION FAILED: ${e} (ID: ${r.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw As(s),new Error(s)}function yt(r,e,t,s){let a="Unexpected state";typeof t=="string"?a=t:s=t,r||RS(e,a,s)}function xt(r,e){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fe={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Xe extends ao{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PS{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class IR{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(lr.UNAUTHENTICATED)))}shutdown(){}}class TR{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class CR{constructor(e){this.t=e,this.currentUser=lr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){yt(this.o===void 0,42304);let s=this.i;const a=m=>this.i!==s?(s=this.i,t(m)):Promise.resolve();let l=new xa;this.o=()=>{this.i++,this.currentUser=this.u(),l.resolve(),l=new xa,e.enqueueRetryable((()=>a(this.currentUser)))};const c=()=>{const m=l;e.enqueueRetryable((async()=>{await m.promise,await a(this.currentUser)}))},u=m=>{Ye("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.o&&(this.auth.addAuthTokenListener(this.o),c())};this.t.onInit((m=>u(m))),setTimeout((()=>{if(!this.auth){const m=this.t.getImmediate({optional:!0});m?u(m):(Ye("FirebaseAuthCredentialsProvider","Auth not yet detected"),l.resolve(),l=new xa)}}),0),c()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((s=>this.i!==e?(Ye("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(yt(typeof s.accessToken=="string",31837,{l:s}),new PS(s.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return yt(e===null||typeof e=="string",2055,{h:e}),new lr(e)}}class AR{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=lr.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class DR{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new AR(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(lr.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Qj{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class RR{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,si(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){yt(this.o===void 0,3512);const s=l=>{l.error!=null&&Ye("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${l.error.message}`);const c=l.token!==this.m;return this.m=l.token,Ye("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?t(l.token):Promise.resolve()};this.o=l=>{e.enqueueRetryable((()=>s(l)))};const a=l=>{Ye("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=l,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((l=>a(l))),setTimeout((()=>{if(!this.appCheck){const l=this.V.getImmediate({optional:!0});l?a(l):Ye("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Qj(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(yt(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Qj(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PR(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<r;s++)t[s]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const a=PR(40);for(let l=0;l<a.length;++l)s.length<20&&a[l]<t&&(s+=e.charAt(a[l]%62))}return s}}function Ut(r,e){return r<e?-1:r>e?1:0}function Hb(r,e){const t=Math.min(r.length,e.length);for(let s=0;s<t;s++){const a=r.charAt(s),l=e.charAt(s);if(a!==l)return yb(a)===yb(l)?Ut(a,l):yb(a)?1:-1}return Ut(r.length,e.length)}const kR=55296,OR=57343;function yb(r){const e=r.charCodeAt(0);return e>=kR&&e<=OR}function Fu(r,e,t){return r.length===e.length&&r.every(((s,a)=>t(s,e[a])))}function kS(r){return r+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wj="__name__";class qa{constructor(e,t,s){t===void 0?t=0:t>e.length&&ht(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&ht(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return qa.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof qa?e.forEach((s=>{t.push(s)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let a=0;a<s;a++){const l=qa.compareSegments(e.get(a),t.get(a));if(l!==0)return l}return Ut(e.length,t.length)}static compareSegments(e,t){const s=qa.isNumericId(e),a=qa.isNumericId(t);return s&&!a?-1:!s&&a?1:s&&a?qa.extractNumericId(e).compare(qa.extractNumericId(t)):Hb(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return cc.fromString(e.substring(4,e.length-2))}}class gn extends qa{construct(e,t,s){return new gn(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new Xe(Fe.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter((a=>a.length>0)))}return new gn(t)}static emptyPath(){return new gn([])}}const MR=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ls extends qa{construct(e,t,s){return new ls(e,t,s)}static isValidIdentifier(e){return MR.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ls.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Wj}static keyField(){return new ls([Wj])}static fromServerFormat(e){const t=[];let s="",a=0;const l=()=>{if(s.length===0)throw new Xe(Fe.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let c=!1;for(;a<e.length;){const u=e[a];if(u==="\\"){if(a+1===e.length)throw new Xe(Fe.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const m=e[a+1];if(m!=="\\"&&m!=="."&&m!=="`")throw new Xe(Fe.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=m,a+=2}else u==="`"?(c=!c,a++):u!=="."||c?(s+=u,a++):(l(),a++)}if(l(),c)throw new Xe(Fe.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ls(t)}static emptyPath(){return new ls([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class at{constructor(e){this.path=e}static fromPath(e){return new at(gn.fromString(e))}static fromName(e){return new at(gn.fromString(e).popFirst(5))}static empty(){return new at(gn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&gn.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return gn.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new at(new gn(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OS(r,e,t){if(!t)throw new Xe(Fe.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function LR(r,e,t,s){if(e===!0&&s===!0)throw new Xe(Fe.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function Kj(r){if(!at.isDocumentKey(r))throw new Xe(Fe.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Yj(r){if(at.isDocumentKey(r))throw new Xe(Fe.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function MS(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function px(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const e=(function(s){return s.constructor?s.constructor.name:null})(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":ht(12329,{type:typeof r})}function kr(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new Xe(Fe.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=px(r);throw new Xe(Fe.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function FR(r,e){if(e<=0)throw new Xe(Fe.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Us(r,e){const t={typeString:r};return e&&(t.value=e),t}function Cf(r,e){if(!MS(r))throw new Xe(Fe.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const a=e[s].typeString,l="value"in e[s]?{value:e[s].value}:void 0;if(!(s in r)){t=`JSON missing required field: '${s}'`;break}const c=r[s];if(a&&typeof c!==a){t=`JSON field '${s}' must be a ${a}.`;break}if(l!==void 0&&c!==l.value){t=`Expected '${s}' field to equal '${l.value}'`;break}}if(t)throw new Xe(Fe.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xj=-62135596800,Jj=1e6;class _n{static now(){return _n.fromMillis(Date.now())}static fromDate(e){return _n.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*Jj);return new _n(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Xe(Fe.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Xe(Fe.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Xj)throw new Xe(Fe.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Xe(Fe.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Jj}_compareTo(e){return this.seconds===e.seconds?Ut(this.nanoseconds,e.nanoseconds):Ut(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:_n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Cf(e,_n._jsonSchema))return new _n(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Xj;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}_n._jsonSchemaVersion="firestore/timestamp/1.0",_n._jsonSchema={type:Us("string",_n._jsonSchemaVersion),seconds:Us("number"),nanoseconds:Us("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{static fromTimestamp(e){return new wt(e)}static min(){return new wt(new _n(0,0))}static max(){return new wt(new _n(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uu=-1;class Mg{constructor(e,t,s,a){this.indexId=e,this.collectionGroup=t,this.fields=s,this.indexState=a}}function Gb(r){return r.fields.find((e=>e.kind===2))}function id(r){return r.fields.filter((e=>e.kind!==2))}Mg.UNKNOWN_ID=-1;class pg{constructor(e,t){this.fieldPath=e,this.kind=t}}class af{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new af(0,Ci.min())}}function LS(r,e){const t=r.toTimestamp().seconds,s=r.toTimestamp().nanoseconds+1,a=wt.fromTimestamp(s===1e9?new _n(t+1,0):new _n(t,s));return new Ci(a,at.empty(),e)}function FS(r){return new Ci(r.readTime,r.key,Uu)}class Ci{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new Ci(wt.min(),at.empty(),Uu)}static max(){return new Ci(wt.max(),at.empty(),Uu)}}function U0(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=at.comparator(r.documentKey,e.documentKey),t!==0?t:Ut(r.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const US="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class VS{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bc(r){if(r.code!==Fe.FAILED_PRECONDITION||r.message!==US)throw r;Ye("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Se{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ht(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Se(((s,a)=>{this.nextCallback=l=>{this.wrapSuccess(e,l).next(s,a)},this.catchCallback=l=>{this.wrapFailure(t,l).next(s,a)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Se?t:Se.resolve(t)}catch(t){return Se.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Se.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Se.reject(t)}static resolve(e){return new Se(((t,s)=>{t(e)}))}static reject(e){return new Se(((t,s)=>{s(e)}))}static waitFor(e){return new Se(((t,s)=>{let a=0,l=0,c=!1;e.forEach((u=>{++a,u.next((()=>{++l,c&&l===a&&t()}),(m=>s(m)))})),c=!0,l===a&&t()}))}static or(e){let t=Se.resolve(!1);for(const s of e)t=t.next((a=>a?Se.resolve(a):s()));return t}static forEach(e,t){const s=[];return e.forEach(((a,l)=>{s.push(t.call(this,a,l))})),this.waitFor(s)}static mapArray(e,t){return new Se(((s,a)=>{const l=e.length,c=new Array(l);let u=0;for(let m=0;m<l;m++){const p=m;t(e[p]).next((b=>{c[p]=b,++u,u===l&&s(c)}),(b=>a(b)))}}))}static doWhile(e,t){return new Se(((s,a)=>{const l=()=>{e()===!0?t().next((()=>{l()}),a):s()};l()}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _i="SimpleDb";class gx{static open(e,t,s,a){try{return new gx(t,e.transaction(a,s))}catch(l){throw new $m(t,l)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new xa,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new $m(e,t.error)):this.S.resolve()},this.transaction.onerror=s=>{const a=V0(s.target.error);this.S.reject(new $m(e,a))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(Ye(_i,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new VR(t)}}class dc{static delete(e){return Ye(_i,"Removing database:",e),ld(hS().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!vS())return!1;if(dc.F())return!0;const e=Ys(),t=dc.M(e),s=0<t&&t<10,a=zS(e),l=0<a&&a<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||s||l)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),s=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(s)}constructor(e,t,s){this.name=e,this.version=t,this.N=s,this.B=null,dc.M(Ys())===12.2&&As("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(Ye(_i,"Opening database:",this.name),this.db=await new Promise(((t,s)=>{const a=indexedDB.open(this.name,this.version);a.onsuccess=l=>{const c=l.target.result;t(c)},a.onblocked=()=>{s(new $m(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},a.onerror=l=>{const c=l.target.error;c.name==="VersionError"?s(new Xe(Fe.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):c.name==="InvalidStateError"?s(new Xe(Fe.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+c)):s(new $m(e,c))},a.onupgradeneeded=l=>{Ye(_i,'Database "'+this.name+'" requires upgrade from version:',l.oldVersion);const c=l.target.result;this.N.k(c,a.transaction,l.oldVersion,this.version).next((()=>{Ye(_i,"Database upgrade to version "+this.version+" complete")}))}}))),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,s,a){const l=t==="readonly";let c=0;for(;;){++c;try{this.db=await this.L(e);const u=gx.open(this.db,e,l?"readonly":"readwrite",s),m=a(u).next((p=>(u.C(),p))).catch((p=>(u.abort(p),Se.reject(p)))).toPromise();return m.catch((()=>{})),await u.D,m}catch(u){const m=u,p=m.name!=="FirebaseError"&&c<3;if(Ye(_i,"Transaction failed with error:",m.message,"Retrying:",p),this.close(),!p)return Promise.reject(m)}}}close(){this.db&&this.db.close(),this.db=void 0}}function zS(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class UR{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return ld(this.U.delete())}}class $m extends Xe{constructor(e,t){super(Fe.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function wc(r){return r.name==="IndexedDbTransactionError"}class VR{constructor(e){this.store=e}put(e,t){let s;return t!==void 0?(Ye(_i,"PUT",this.store.name,e,t),s=this.store.put(t,e)):(Ye(_i,"PUT",this.store.name,"<auto-key>",e),s=this.store.put(e)),ld(s)}add(e){return Ye(_i,"ADD",this.store.name,e,e),ld(this.store.add(e))}get(e){return ld(this.store.get(e)).next((t=>(t===void 0&&(t=null),Ye(_i,"GET",this.store.name,e,t),t)))}delete(e){return Ye(_i,"DELETE",this.store.name,e),ld(this.store.delete(e))}count(){return Ye(_i,"COUNT",this.store.name),ld(this.store.count())}J(e,t){const s=this.options(e,t),a=s.index?this.store.index(s.index):this.store;if(typeof a.getAll=="function"){const l=a.getAll(s.range);return new Se(((c,u)=>{l.onerror=m=>{u(m.target.error)},l.onsuccess=m=>{c(m.target.result)}}))}{const l=this.cursor(s),c=[];return this.H(l,((u,m)=>{c.push(m)})).next((()=>c))}}Y(e,t){const s=this.store.getAll(e,t===null?void 0:t);return new Se(((a,l)=>{s.onerror=c=>{l(c.target.error)},s.onsuccess=c=>{a(c.target.result)}}))}Z(e,t){Ye(_i,"DELETE ALL",this.store.name);const s=this.options(e,t);s.X=!1;const a=this.cursor(s);return this.H(a,((l,c,u)=>u.delete()))}ee(e,t){let s;t?s=e:(s={},t=e);const a=this.cursor(s);return this.H(a,t)}te(e){const t=this.cursor({});return new Se(((s,a)=>{t.onerror=l=>{const c=V0(l.target.error);a(c)},t.onsuccess=l=>{const c=l.target.result;c?e(c.primaryKey,c.value).next((u=>{u?c.continue():s()})):s()}}))}H(e,t){const s=[];return new Se(((a,l)=>{e.onerror=c=>{l(c.target.error)},e.onsuccess=c=>{const u=c.target.result;if(!u)return void a();const m=new UR(u),p=t(u.primaryKey,u.value,m);if(p instanceof Se){const b=p.catch((w=>(m.done(),Se.reject(w))));s.push(b)}m.isDone?a():m.G===null?u.continue():u.continue(m.G)}})).next((()=>Se.waitFor(s)))}options(e,t){let s;return e!==void 0&&(typeof e=="string"?s=e:t=e),{index:s,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const s=this.store.index(e.index);return e.X?s.openKeyCursor(e.range,t):s.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ld(r){return new Se(((e,t)=>{r.onsuccess=s=>{const a=s.target.result;e(a)},r.onerror=s=>{const a=V0(s.target.error);t(a)}}))}let Zj=!1;function V0(r){const e=dc.M(Ys());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){const s=new Xe("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Zj||(Zj=!0,setTimeout((()=>{throw s}),0)),s}}return r}const Bm="IndexBackfiller";class zR{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){Ye(Bm,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const t=await this.ne.ie();Ye(Bm,`Documents written: ${t}`)}catch(t){wc(t)?Ye(Bm,"Ignoring IndexedDB error during index backfill: ",t):await bc(t)}await this.re(6e4)}))}}class $R{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.se(t,e)))}se(e,t){const s=new Set;let a=t,l=!0;return Se.doWhile((()=>l===!0&&a>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((c=>{if(c!==null&&!s.has(c))return Ye(Bm,`Processing collection: ${c}`),this.oe(e,c,a).next((u=>{a-=u,s.add(c)}));l=!1})))).next((()=>t-a))}oe(e,t,s){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((a=>this.localStore.localDocuments.getNextDocuments(e,t,a,s).next((l=>{const c=l.changes;return this.localStore.indexManager.updateIndexEntries(e,c).next((()=>this._e(a,l))).next((u=>(Ye(Bm,`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u)))).next((()=>c.size))}))))}_e(e,t){let s=e;return t.changes.forEach(((a,l)=>{const c=FS(l);U0(c,s)>0&&(s=c)})),new Ci(s.readTime,s.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ii{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}ii.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pd=-1;function Af(r){return r==null}function of(r){return r===0&&1/r==-1/0}function $S(r){return typeof r=="number"&&Number.isInteger(r)&&!of(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lg="";function Or(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=e_(e)),e=BR(r.get(t),e);return e_(e)}function BR(r,e){let t=e;const s=r.length;for(let a=0;a<s;a++){const l=r.charAt(a);switch(l){case"\0":t+="";break;case Lg:t+="";break;default:t+=l}}return t}function e_(r){return r+Lg+""}function Ga(r){const e=r.length;if(yt(e>=2,64408,{path:r}),e===2)return yt(r.charAt(0)===Lg&&r.charAt(1)==="",56145,{path:r}),gn.emptyPath();const t=e-2,s=[];let a="";for(let l=0;l<e;){const c=r.indexOf(Lg,l);switch((c<0||c>t)&&ht(50515,{path:r}),r.charAt(c+1)){case"":const u=r.substring(l,c);let m;a.length===0?m=u:(a+=u,m=a,a=""),s.push(m);break;case"":a+=r.substring(l,c),a+="\0";break;case"":a+=r.substring(l,c+1);break;default:ht(61167,{path:r})}l=c+2}return new gn(s)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ad="remoteDocuments",Df="owner",pu="owner",lf="mutationQueues",qR="userId",pa="mutations",t_="batchId",md="userMutationsIndex",n_=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gg(r,e){return[r,Or(e)]}function BS(r,e,t){return[r,Or(e),t]}const HR={},Vu="documentMutations",Fg="remoteDocumentsV14",GR=["prefixPath","collectionGroup","readTime","documentId"],xg="documentKeyIndex",QR=["prefixPath","collectionGroup","documentId"],qS="collectionGroupIndex",WR=["collectionGroup","readTime","prefixPath","documentId"],cf="remoteDocumentGlobal",Qb="remoteDocumentGlobalKey",zu="targets",HS="queryTargetsIndex",KR=["canonicalId","targetId"],$u="targetDocuments",YR=["targetId","path"],z0="documentTargetsIndex",XR=["path","targetId"],Ug="targetGlobalKey",gd="targetGlobal",df="collectionParents",JR=["collectionId","parent"],Bu="clientMetadata",ZR="clientId",xx="bundles",eP="bundleId",yx="namedQueries",tP="name",$0="indexConfiguration",nP="indexId",Wb="collectionGroupIndex",sP="collectionGroup",qm="indexState",rP=["indexId","uid"],GS="sequenceNumberIndex",iP=["uid","sequenceNumber"],Hm="indexEntries",aP=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],QS="documentKeyIndex",oP=["indexId","uid","orderedDocumentKey"],bx="documentOverlays",lP=["userId","collectionPath","documentId"],Kb="collectionPathOverlayIndex",cP=["userId","collectionPath","largestBatchId"],WS="collectionGroupOverlayIndex",dP=["userId","collectionGroup","largestBatchId"],B0="globals",uP="name",KS=[lf,pa,Vu,ad,zu,Df,gd,$u,Bu,cf,df,xx,yx],hP=[...KS,bx],YS=[lf,pa,Vu,Fg,zu,Df,gd,$u,Bu,cf,df,xx,yx,bx],XS=YS,q0=[...XS,$0,qm,Hm],mP=q0,JS=[...q0,B0],fP=JS;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yb extends VS{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Zs(r,e){const t=xt(r);return dc.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s_(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function vc(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function ZS(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qn{constructor(e,t){this.comparator=e,this.root=t||br.EMPTY}insert(e,t){return new Qn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,br.BLACK,null,null))}remove(e){return new Qn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,br.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const a=this.comparator(e,s.key);if(a===0)return t+s.left.size;a<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,s)=>(e(t,s),!1)))}toString(){const e=[];return this.inorderTraversal(((t,s)=>(e.push(`${t}:${s}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ng(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ng(this.root,e,this.comparator,!1)}getReverseIterator(){return new ng(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ng(this.root,e,this.comparator,!0)}}class ng{constructor(e,t,s,a){this.isReverse=a,this.nodeStack=[];let l=1;for(;!e.isEmpty();)if(l=t?s(e.key,t):1,t&&a&&(l*=-1),l<0)e=this.isReverse?e.left:e.right;else{if(l===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class br{constructor(e,t,s,a,l){this.key=e,this.value=t,this.color=s??br.RED,this.left=a??br.EMPTY,this.right=l??br.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,a,l){return new br(e??this.key,t??this.value,s??this.color,a??this.left,l??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let a=this;const l=s(e,a.key);return a=l<0?a.copy(null,null,null,a.left.insert(e,t,s),null):l===0?a.copy(null,t,null,null,null):a.copy(null,null,null,null,a.right.insert(e,t,s)),a.fixUp()}removeMin(){if(this.left.isEmpty())return br.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,a=this;if(t(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,t),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),t(e,a.key)===0){if(a.right.isEmpty())return br.EMPTY;s=a.right.min(),a=a.copy(s.key,s.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,t))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,br.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,br.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ht(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ht(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ht(27949);return e+(this.isRed()?0:1)}}br.EMPTY=null,br.RED=!0,br.BLACK=!1;br.EMPTY=new class{constructor(){this.size=0}get key(){throw ht(57766)}get value(){throw ht(16141)}get color(){throw ht(16727)}get left(){throw ht(29726)}get right(){throw ht(36894)}copy(e,t,s,a,l){return this}insert(e,t,s){return new br(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class An{constructor(e){this.comparator=e,this.data=new Qn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,s)=>(e(t),!1)))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const a=s.getNext();if(this.comparator(a.key,e[1])>=0)return;t(a.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new r_(this.data.getIterator())}getIteratorFrom(e){return new r_(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((s=>{t=t.add(s)})),t}isEqual(e){if(!(e instanceof An)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const a=t.getNext().key,l=s.getNext().key;if(this.comparator(a,l)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new An(this.comparator);return t.data=e,t}}class r_{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function gu(r){return r.hasNext()?r.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai{constructor(e){this.fields=e,e.sort(ls.comparator)}static empty(){return new ai([])}unionWith(e){let t=new An(ls.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new ai(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Fu(this.fields,e.fields,((t,s)=>t.isEqual(s)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eI extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ds{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(a){try{return atob(a)}catch(l){throw typeof DOMException<"u"&&l instanceof DOMException?new eI("Invalid base64 string: "+l):l}})(e);return new Ds(t)}static fromUint8Array(e){const t=(function(a){let l="";for(let c=0;c<a.length;++c)l+=String.fromCharCode(a[c]);return l})(e);return new Ds(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const s=new Uint8Array(t.length);for(let a=0;a<t.length;a++)s[a]=t.charCodeAt(a);return s})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ut(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ds.EMPTY_BYTE_STRING=new Ds("");const pP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function tl(r){if(yt(!!r,39018),typeof r=="string"){let e=0;const t=pP.exec(r);if(yt(!!t,46558,{timestamp:r}),t[1]){let a=t[1];a=(a+"000000000").substr(0,9),e=Number(a)}const s=new Date(r);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:ns(r.seconds),nanos:ns(r.nanos)}}function ns(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function nl(r){return typeof r=="string"?Ds.fromBase64String(r):Ds.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tI="server_timestamp",nI="__type__",sI="__previous_value__",rI="__local_write_time__";function H0(r){return(r?.mapValue?.fields||{})[nI]?.stringValue===tI}function wx(r){const e=r.mapValue.fields[sI];return H0(e)?wx(e):e}function uf(r){const e=tl(r.mapValue.fields[rI].timestampValue);return new _n(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gP{constructor(e,t,s,a,l,c,u,m,p,b){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=a,this.ssl=l,this.forceLongPolling=c,this.autoDetectLongPolling=u,this.longPollingOptions=m,this.useFetchStreams=p,this.isUsingEmulator=b}}const hf="(default)";class vd{constructor(e,t){this.projectId=e,this.database=t||hf}static empty(){return new vd("","")}get isDefaultDatabase(){return this.database===hf}isEqual(e){return e instanceof vd&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G0="__type__",iI="__max__",rc={mapValue:{fields:{__type__:{stringValue:iI}}}},Q0="__vector__",qu="value",yg={nullValue:"NULL_VALUE"};function pc(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?H0(r)?4:aI(r)?9007199254740991:vx(r)?10:11:ht(28295,{value:r})}function so(r,e){if(r===e)return!0;const t=pc(r);if(t!==pc(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return uf(r).isEqual(uf(e));case 3:return(function(a,l){if(typeof a.timestampValue=="string"&&typeof l.timestampValue=="string"&&a.timestampValue.length===l.timestampValue.length)return a.timestampValue===l.timestampValue;const c=tl(a.timestampValue),u=tl(l.timestampValue);return c.seconds===u.seconds&&c.nanos===u.nanos})(r,e);case 5:return r.stringValue===e.stringValue;case 6:return(function(a,l){return nl(a.bytesValue).isEqual(nl(l.bytesValue))})(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return(function(a,l){return ns(a.geoPointValue.latitude)===ns(l.geoPointValue.latitude)&&ns(a.geoPointValue.longitude)===ns(l.geoPointValue.longitude)})(r,e);case 2:return(function(a,l){if("integerValue"in a&&"integerValue"in l)return ns(a.integerValue)===ns(l.integerValue);if("doubleValue"in a&&"doubleValue"in l){const c=ns(a.doubleValue),u=ns(l.doubleValue);return c===u?of(c)===of(u):isNaN(c)&&isNaN(u)}return!1})(r,e);case 9:return Fu(r.arrayValue.values||[],e.arrayValue.values||[],so);case 10:case 11:return(function(a,l){const c=a.mapValue.fields||{},u=l.mapValue.fields||{};if(s_(c)!==s_(u))return!1;for(const m in c)if(c.hasOwnProperty(m)&&(u[m]===void 0||!so(c[m],u[m])))return!1;return!0})(r,e);default:return ht(52216,{left:r})}}function mf(r,e){return(r.values||[]).find((t=>so(t,e)))!==void 0}function gc(r,e){if(r===e)return 0;const t=pc(r),s=pc(e);if(t!==s)return Ut(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ut(r.booleanValue,e.booleanValue);case 2:return(function(l,c){const u=ns(l.integerValue||l.doubleValue),m=ns(c.integerValue||c.doubleValue);return u<m?-1:u>m?1:u===m?0:isNaN(u)?isNaN(m)?0:-1:1})(r,e);case 3:return i_(r.timestampValue,e.timestampValue);case 4:return i_(uf(r),uf(e));case 5:return Hb(r.stringValue,e.stringValue);case 6:return(function(l,c){const u=nl(l),m=nl(c);return u.compareTo(m)})(r.bytesValue,e.bytesValue);case 7:return(function(l,c){const u=l.split("/"),m=c.split("/");for(let p=0;p<u.length&&p<m.length;p++){const b=Ut(u[p],m[p]);if(b!==0)return b}return Ut(u.length,m.length)})(r.referenceValue,e.referenceValue);case 8:return(function(l,c){const u=Ut(ns(l.latitude),ns(c.latitude));return u!==0?u:Ut(ns(l.longitude),ns(c.longitude))})(r.geoPointValue,e.geoPointValue);case 9:return a_(r.arrayValue,e.arrayValue);case 10:return(function(l,c){const u=l.fields||{},m=c.fields||{},p=u[qu]?.arrayValue,b=m[qu]?.arrayValue,w=Ut(p?.values?.length||0,b?.values?.length||0);return w!==0?w:a_(p,b)})(r.mapValue,e.mapValue);case 11:return(function(l,c){if(l===rc.mapValue&&c===rc.mapValue)return 0;if(l===rc.mapValue)return 1;if(c===rc.mapValue)return-1;const u=l.fields||{},m=Object.keys(u),p=c.fields||{},b=Object.keys(p);m.sort(),b.sort();for(let w=0;w<m.length&&w<b.length;++w){const j=Hb(m[w],b[w]);if(j!==0)return j;const D=gc(u[m[w]],p[b[w]]);if(D!==0)return D}return Ut(m.length,b.length)})(r.mapValue,e.mapValue);default:throw ht(23264,{he:t})}}function i_(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return Ut(r,e);const t=tl(r),s=tl(e),a=Ut(t.seconds,s.seconds);return a!==0?a:Ut(t.nanos,s.nanos)}function a_(r,e){const t=r.values||[],s=e.values||[];for(let a=0;a<t.length&&a<s.length;++a){const l=gc(t[a],s[a]);if(l)return l}return Ut(t.length,s.length)}function Hu(r){return Xb(r)}function Xb(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?(function(t){const s=tl(t);return`time(${s.seconds},${s.nanos})`})(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?(function(t){return nl(t).toBase64()})(r.bytesValue):"referenceValue"in r?(function(t){return at.fromName(t).toString()})(r.referenceValue):"geoPointValue"in r?(function(t){return`geo(${t.latitude},${t.longitude})`})(r.geoPointValue):"arrayValue"in r?(function(t){let s="[",a=!0;for(const l of t.values||[])a?a=!1:s+=",",s+=Xb(l);return s+"]"})(r.arrayValue):"mapValue"in r?(function(t){const s=Object.keys(t.fields||{}).sort();let a="{",l=!0;for(const c of s)l?l=!1:a+=",",a+=`${c}:${Xb(t.fields[c])}`;return a+"}"})(r.mapValue):ht(61005,{value:r})}function bg(r){switch(pc(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=wx(r);return e?16+bg(e):16;case 5:return 2*r.stringValue.length;case 6:return nl(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return(function(s){return(s.values||[]).reduce(((a,l)=>a+bg(l)),0)})(r.arrayValue);case 10:case 11:return(function(s){let a=0;return vc(s.fields,((l,c)=>{a+=l.length+bg(c)})),a})(r.mapValue);default:throw ht(13486,{value:r})}}function ff(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Jb(r){return!!r&&"integerValue"in r}function pf(r){return!!r&&"arrayValue"in r}function o_(r){return!!r&&"nullValue"in r}function l_(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function wg(r){return!!r&&"mapValue"in r}function vx(r){return(r?.mapValue?.fields||{})[G0]?.stringValue===Q0}function Gm(r){if(r.geoPointValue)return{geoPointValue:{...r.geoPointValue}};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:{...r.timestampValue}};if(r.mapValue){const e={mapValue:{fields:{}}};return vc(r.mapValue.fields,((t,s)=>e.mapValue.fields[t]=Gm(s))),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Gm(r.arrayValue.values[t]);return e}return{...r}}function aI(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===iI}const oI={mapValue:{fields:{[G0]:{stringValue:Q0},[qu]:{arrayValue:{}}}}};function xP(r){return"nullValue"in r?yg:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?ff(vd.empty(),at.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?vx(r)?oI:{mapValue:{}}:ht(35942,{value:r})}function yP(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?ff(vd.empty(),at.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?oI:"mapValue"in r?vx(r)?{mapValue:{}}:rc:ht(61959,{value:r})}function c_(r,e){const t=gc(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function d_(r,e){const t=gc(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jr{constructor(e){this.value=e}static empty(){return new jr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!wg(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Gm(t)}setAll(e){let t=ls.emptyPath(),s={},a=[];e.forEach(((c,u)=>{if(!t.isImmediateParentOf(u)){const m=this.getFieldsMap(t);this.applyChanges(m,s,a),s={},a=[],t=u.popLast()}c?s[u.lastSegment()]=Gm(c):a.push(u.lastSegment())}));const l=this.getFieldsMap(t);this.applyChanges(l,s,a)}delete(e){const t=this.field(e.popLast());wg(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return so(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let a=t.mapValue.fields[e.get(s)];wg(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=a),t=a}return t.mapValue.fields}applyChanges(e,t,s){vc(t,((a,l)=>e[a]=l));for(const a of s)delete e[a]}clone(){return new jr(Gm(this.value))}}function lI(r){const e=[];return vc(r.fields,((t,s)=>{const a=new ls([t]);if(wg(s)){const l=lI(s.mapValue).fields;if(l.length===0)e.push(a);else for(const c of l)e.push(a.child(c))}else e.push(a)})),new ai(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ss{constructor(e,t,s,a,l,c,u){this.key=e,this.documentType=t,this.version=s,this.readTime=a,this.createTime=l,this.data=c,this.documentState=u}static newInvalidDocument(e){return new ss(e,0,wt.min(),wt.min(),wt.min(),jr.empty(),0)}static newFoundDocument(e,t,s,a){return new ss(e,1,t,wt.min(),s,a,0)}static newNoDocument(e,t){return new ss(e,2,t,wt.min(),wt.min(),jr.empty(),0)}static newUnknownDocument(e,t){return new ss(e,3,t,wt.min(),wt.min(),jr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(wt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=jr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=jr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=wt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ss&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ss(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gu{constructor(e,t){this.position=e,this.inclusive=t}}function u_(r,e,t){let s=0;for(let a=0;a<r.position.length;a++){const l=e[a],c=r.position[a];if(l.field.isKeyField()?s=at.comparator(at.fromName(c.referenceValue),t.key):s=gc(c,t.data.field(l.field)),l.dir==="desc"&&(s*=-1),s!==0)break}return s}function h_(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!so(r.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gf{constructor(e,t="asc"){this.field=e,this.dir=t}}function bP(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cI{}class nn extends cI{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new wP(e,t,s):t==="array-contains"?new jP(e,s):t==="in"?new pI(e,s):t==="not-in"?new _P(e,s):t==="array-contains-any"?new EP(e,s):new nn(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new vP(e,s):new NP(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(gc(t,this.value)):t!==null&&pc(this.value)===pc(t)&&this.matchesComparison(gc(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ht(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Cn extends cI{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Cn(e,t)}matches(e){return Qu(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Qu(r){return r.op==="and"}function Zb(r){return r.op==="or"}function W0(r){return dI(r)&&Qu(r)}function dI(r){for(const e of r.filters)if(e instanceof Cn)return!1;return!0}function e0(r){if(r instanceof nn)return r.field.canonicalString()+r.op.toString()+Hu(r.value);if(W0(r))return r.filters.map((e=>e0(e))).join(",");{const e=r.filters.map((t=>e0(t))).join(",");return`${r.op}(${e})`}}function uI(r,e){return r instanceof nn?(function(s,a){return a instanceof nn&&s.op===a.op&&s.field.isEqual(a.field)&&so(s.value,a.value)})(r,e):r instanceof Cn?(function(s,a){return a instanceof Cn&&s.op===a.op&&s.filters.length===a.filters.length?s.filters.reduce(((l,c,u)=>l&&uI(c,a.filters[u])),!0):!1})(r,e):void ht(19439)}function hI(r,e){const t=r.filters.concat(e);return Cn.create(t,r.op)}function mI(r){return r instanceof nn?(function(t){return`${t.field.canonicalString()} ${t.op} ${Hu(t.value)}`})(r):r instanceof Cn?(function(t){return t.op.toString()+" {"+t.getFilters().map(mI).join(" ,")+"}"})(r):"Filter"}class wP extends nn{constructor(e,t,s){super(e,t,s),this.key=at.fromName(s.referenceValue)}matches(e){const t=at.comparator(e.key,this.key);return this.matchesComparison(t)}}class vP extends nn{constructor(e,t){super(e,"in",t),this.keys=fI("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class NP extends nn{constructor(e,t){super(e,"not-in",t),this.keys=fI("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function fI(r,e){return(e.arrayValue?.values||[]).map((t=>at.fromName(t.referenceValue)))}class jP extends nn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return pf(t)&&mf(t.arrayValue,this.value)}}class pI extends nn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&mf(this.value.arrayValue,t)}}class _P extends nn{constructor(e,t){super(e,"not-in",t)}matches(e){if(mf(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!mf(this.value.arrayValue,t)}}class EP extends nn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!pf(t)||!t.arrayValue.values)&&t.arrayValue.values.some((s=>mf(this.value.arrayValue,s)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SP{constructor(e,t=null,s=[],a=[],l=null,c=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=a,this.limit=l,this.startAt=c,this.endAt=u,this.Te=null}}function t0(r,e=null,t=[],s=[],a=null,l=null,c=null){return new SP(r,e,t,s,a,l,c)}function Nd(r){const e=xt(r);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((s=>e0(s))).join(","),t+="|ob:",t+=e.orderBy.map((s=>(function(l){return l.field.canonicalString()+l.dir})(s))).join(","),Af(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((s=>Hu(s))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((s=>Hu(s))).join(",")),e.Te=t}return e.Te}function Rf(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!bP(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!uI(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!h_(r.startAt,e.startAt)&&h_(r.endAt,e.endAt)}function Vg(r){return at.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function zg(r,e){return r.filters.filter((t=>t instanceof nn&&t.field.isEqual(e)))}function m_(r,e,t){let s=yg,a=!0;for(const l of zg(r,e)){let c=yg,u=!0;switch(l.op){case"<":case"<=":c=xP(l.value);break;case"==":case"in":case">=":c=l.value;break;case">":c=l.value,u=!1;break;case"!=":case"not-in":c=yg}c_({value:s,inclusive:a},{value:c,inclusive:u})<0&&(s=c,a=u)}if(t!==null){for(let l=0;l<r.orderBy.length;++l)if(r.orderBy[l].field.isEqual(e)){const c=t.position[l];c_({value:s,inclusive:a},{value:c,inclusive:t.inclusive})<0&&(s=c,a=t.inclusive);break}}return{value:s,inclusive:a}}function f_(r,e,t){let s=rc,a=!0;for(const l of zg(r,e)){let c=rc,u=!0;switch(l.op){case">=":case">":c=yP(l.value),u=!1;break;case"==":case"in":case"<=":c=l.value;break;case"<":c=l.value,u=!1;break;case"!=":case"not-in":c=rc}d_({value:s,inclusive:a},{value:c,inclusive:u})>0&&(s=c,a=u)}if(t!==null){for(let l=0;l<r.orderBy.length;++l)if(r.orderBy[l].field.isEqual(e)){const c=t.position[l];d_({value:s,inclusive:a},{value:c,inclusive:t.inclusive})>0&&(s=c,a=t.inclusive);break}}return{value:s,inclusive:a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lh{constructor(e,t=null,s=[],a=[],l=null,c="F",u=null,m=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=a,this.limit=l,this.limitType=c,this.startAt=u,this.endAt=m,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function gI(r,e,t,s,a,l,c,u){return new lh(r,e,t,s,a,l,c,u)}function Pf(r){return new lh(r)}function p_(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function xI(r){return r.collectionGroup!==null}function Qm(r){const e=xt(r);if(e.Ie===null){e.Ie=[];const t=new Set;for(const l of e.explicitOrderBy)e.Ie.push(l),t.add(l.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(c){let u=new An(ls.comparator);return c.filters.forEach((m=>{m.getFlattenedFilters().forEach((p=>{p.isInequality()&&(u=u.add(p.field))}))})),u})(e).forEach((l=>{t.has(l.canonicalString())||l.isKeyField()||e.Ie.push(new gf(l,s))})),t.has(ls.keyField().canonicalString())||e.Ie.push(new gf(ls.keyField(),s))}return e.Ie}function Ti(r){const e=xt(r);return e.Ee||(e.Ee=IP(e,Qm(r))),e.Ee}function IP(r,e){if(r.limitType==="F")return t0(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map((a=>{const l=a.dir==="desc"?"asc":"desc";return new gf(a.field,l)}));const t=r.endAt?new Gu(r.endAt.position,r.endAt.inclusive):null,s=r.startAt?new Gu(r.startAt.position,r.startAt.inclusive):null;return t0(r.path,r.collectionGroup,e,r.filters,r.limit,t,s)}}function n0(r,e){const t=r.filters.concat([e]);return new lh(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function $g(r,e,t){return new lh(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function Nx(r,e){return Rf(Ti(r),Ti(e))&&r.limitType===e.limitType}function yI(r){return`${Nd(Ti(r))}|lt:${r.limitType}`}function Nu(r){return`Query(target=${(function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map((a=>mI(a))).join(", ")}]`),Af(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map((a=>(function(c){return`${c.field.canonicalString()} (${c.dir})`})(a))).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map((a=>Hu(a))).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map((a=>Hu(a))).join(",")),`Target(${s})`})(Ti(r))}; limitType=${r.limitType})`}function kf(r,e){return e.isFoundDocument()&&(function(s,a){const l=a.key.path;return s.collectionGroup!==null?a.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(l):at.isDocumentKey(s.path)?s.path.isEqual(l):s.path.isImmediateParentOf(l)})(r,e)&&(function(s,a){for(const l of Qm(s))if(!l.field.isKeyField()&&a.data.field(l.field)===null)return!1;return!0})(r,e)&&(function(s,a){for(const l of s.filters)if(!l.matches(a))return!1;return!0})(r,e)&&(function(s,a){return!(s.startAt&&!(function(c,u,m){const p=u_(c,u,m);return c.inclusive?p<=0:p<0})(s.startAt,Qm(s),a)||s.endAt&&!(function(c,u,m){const p=u_(c,u,m);return c.inclusive?p>=0:p>0})(s.endAt,Qm(s),a))})(r,e)}function bI(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function wI(r){return(e,t)=>{let s=!1;for(const a of Qm(r)){const l=TP(a,e,t);if(l!==0)return l;s=s||a.field.isKeyField()}return 0}}function TP(r,e,t){const s=r.field.isKeyField()?at.comparator(e.key,t.key):(function(l,c,u){const m=c.data.field(l),p=u.data.field(l);return m!==null&&p!==null?gc(m,p):ht(42886)})(r.field,e,t);switch(r.dir){case"asc":return s;case"desc":return-1*s;default:return ht(19790,{direction:r.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ol{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[a,l]of s)if(this.equalsFn(a,e))return l}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),a=this.inner[s];if(a===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],e))return void(a[l]=[e,t]);a.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let a=0;a<s.length;a++)if(this.equalsFn(s[a][0],e))return s.length===1?delete this.inner[t]:s.splice(a,1),this.innerSize--,!0;return!1}forEach(e){vc(this.inner,((t,s)=>{for(const[a,l]of s)e(a,l)}))}isEmpty(){return ZS(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CP=new Qn(at.comparator);function Si(){return CP}const vI=new Qn(at.comparator);function Fm(...r){let e=vI;for(const t of r)e=e.insert(t.key,t);return e}function NI(r){let e=vI;return r.forEach(((t,s)=>e=e.insert(t,s.overlayedDocument))),e}function Qa(){return Wm()}function jI(){return Wm()}function Wm(){return new ol((r=>r.toString()),((r,e)=>r.isEqual(e)))}const AP=new Qn(at.comparator),DP=new An(at.comparator);function Ht(...r){let e=DP;for(const t of r)e=e.add(t);return e}const RP=new An(Ut);function K0(){return RP}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y0(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:of(e)?"-0":e}}function _I(r){return{integerValue:""+r}}function EI(r,e){return $S(e)?_I(e):Y0(r,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jx{constructor(){this._=void 0}}function PP(r,e,t){return r instanceof Wu?(function(a,l){const c={fields:{[nI]:{stringValue:tI},[rI]:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return l&&H0(l)&&(l=wx(l)),l&&(c.fields[sI]=l),{mapValue:c}})(t,e):r instanceof Ku?II(r,e):r instanceof Yu?TI(r,e):(function(a,l){const c=SI(a,l),u=g_(c)+g_(a.Ae);return Jb(c)&&Jb(a.Ae)?_I(u):Y0(a.serializer,u)})(r,e)}function kP(r,e,t){return r instanceof Ku?II(r,e):r instanceof Yu?TI(r,e):t}function SI(r,e){return r instanceof Xu?(function(s){return Jb(s)||(function(l){return!!l&&"doubleValue"in l})(s)})(e)?e:{integerValue:0}:null}class Wu extends jx{}class Ku extends jx{constructor(e){super(),this.elements=e}}function II(r,e){const t=CI(e);for(const s of r.elements)t.some((a=>so(a,s)))||t.push(s);return{arrayValue:{values:t}}}class Yu extends jx{constructor(e){super(),this.elements=e}}function TI(r,e){let t=CI(e);for(const s of r.elements)t=t.filter((a=>!so(a,s)));return{arrayValue:{values:t}}}class Xu extends jx{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function g_(r){return ns(r.integerValue||r.doubleValue)}function CI(r){return pf(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X0{constructor(e,t){this.field=e,this.transform=t}}function OP(r,e){return r.field.isEqual(e.field)&&(function(s,a){return s instanceof Ku&&a instanceof Ku||s instanceof Yu&&a instanceof Yu?Fu(s.elements,a.elements,so):s instanceof Xu&&a instanceof Xu?so(s.Ae,a.Ae):s instanceof Wu&&a instanceof Wu})(r.transform,e.transform)}class MP{constructor(e,t){this.version=e,this.transformResults=t}}class rs{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new rs}static exists(e){return new rs(void 0,e)}static updateTime(e){return new rs(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function vg(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}class _x{}function AI(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new dh(r.key,rs.none()):new ch(r.key,r.data,rs.none());{const t=r.data,s=jr.empty();let a=new An(ls.comparator);for(let l of e.fields)if(!a.has(l)){let c=t.field(l);c===null&&l.length>1&&(l=l.popLast(),c=t.field(l)),c===null?s.delete(l):s.set(l,c),a=a.add(l)}return new ll(r.key,s,new ai(a.toArray()),rs.none())}}function LP(r,e,t){r instanceof ch?(function(a,l,c){const u=a.value.clone(),m=y_(a.fieldTransforms,l,c.transformResults);u.setAll(m),l.convertToFoundDocument(c.version,u).setHasCommittedMutations()})(r,e,t):r instanceof ll?(function(a,l,c){if(!vg(a.precondition,l))return void l.convertToUnknownDocument(c.version);const u=y_(a.fieldTransforms,l,c.transformResults),m=l.data;m.setAll(DI(a)),m.setAll(u),l.convertToFoundDocument(c.version,m).setHasCommittedMutations()})(r,e,t):(function(a,l,c){l.convertToNoDocument(c.version).setHasCommittedMutations()})(0,e,t)}function Km(r,e,t,s){return r instanceof ch?(function(l,c,u,m){if(!vg(l.precondition,c))return u;const p=l.value.clone(),b=b_(l.fieldTransforms,m,c);return p.setAll(b),c.convertToFoundDocument(c.version,p).setHasLocalMutations(),null})(r,e,t,s):r instanceof ll?(function(l,c,u,m){if(!vg(l.precondition,c))return u;const p=b_(l.fieldTransforms,m,c),b=c.data;return b.setAll(DI(l)),b.setAll(p),c.convertToFoundDocument(c.version,b).setHasLocalMutations(),u===null?null:u.unionWith(l.fieldMask.fields).unionWith(l.fieldTransforms.map((w=>w.field)))})(r,e,t,s):(function(l,c,u){return vg(l.precondition,c)?(c.convertToNoDocument(c.version).setHasLocalMutations(),null):u})(r,e,t)}function FP(r,e){let t=null;for(const s of r.fieldTransforms){const a=e.data.field(s.field),l=SI(s.transform,a||null);l!=null&&(t===null&&(t=jr.empty()),t.set(s.field,l))}return t||null}function x_(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!(function(s,a){return s===void 0&&a===void 0||!(!s||!a)&&Fu(s,a,((l,c)=>OP(l,c)))})(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}class ch extends _x{constructor(e,t,s,a=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class ll extends _x{constructor(e,t,s,a,l=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=a,this.fieldTransforms=l,this.type=1}getFieldMask(){return this.fieldMask}}function DI(r){const e=new Map;return r.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const s=r.data.field(t);e.set(t,s)}})),e}function y_(r,e,t){const s=new Map;yt(r.length===t.length,32656,{Re:t.length,Ve:r.length});for(let a=0;a<t.length;a++){const l=r[a],c=l.transform,u=e.data.field(l.field);s.set(l.field,kP(c,u,t[a]))}return s}function b_(r,e,t){const s=new Map;for(const a of r){const l=a.transform,c=t.data.field(a.field);s.set(a.field,PP(l,c,e))}return s}class dh extends _x{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class J0 extends _x{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z0{constructor(e,t,s,a){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=a}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let a=0;a<this.mutations.length;a++){const l=this.mutations[a];l.key.isEqual(e.key)&&LP(l,e,s[a])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=Km(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=Km(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=jI();return this.mutations.forEach((a=>{const l=e.get(a.key),c=l.overlayedDocument;let u=this.applyToLocalView(c,l.mutatedFields);u=t.has(a.key)?null:u;const m=AI(c,u);m!==null&&s.set(a.key,m),c.isValidDocument()||c.convertToNoDocument(wt.min())})),s}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Ht())}isEqual(e){return this.batchId===e.batchId&&Fu(this.mutations,e.mutations,((t,s)=>x_(t,s)))&&Fu(this.baseMutations,e.baseMutations,((t,s)=>x_(t,s)))}}class ew{constructor(e,t,s,a){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=a}static from(e,t,s){yt(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let a=(function(){return AP})();const l=e.mutations;for(let c=0;c<l.length;c++)a=a.insert(l[c].key,s[c].version);return new ew(e,t,s,a)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tw{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UP{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fs,un;function RI(r){switch(r){case Fe.OK:return ht(64938);case Fe.CANCELLED:case Fe.UNKNOWN:case Fe.DEADLINE_EXCEEDED:case Fe.RESOURCE_EXHAUSTED:case Fe.INTERNAL:case Fe.UNAVAILABLE:case Fe.UNAUTHENTICATED:return!1;case Fe.INVALID_ARGUMENT:case Fe.NOT_FOUND:case Fe.ALREADY_EXISTS:case Fe.PERMISSION_DENIED:case Fe.FAILED_PRECONDITION:case Fe.ABORTED:case Fe.OUT_OF_RANGE:case Fe.UNIMPLEMENTED:case Fe.DATA_LOSS:return!0;default:return ht(15467,{code:r})}}function PI(r){if(r===void 0)return As("GRPC error has no .code"),Fe.UNKNOWN;switch(r){case Fs.OK:return Fe.OK;case Fs.CANCELLED:return Fe.CANCELLED;case Fs.UNKNOWN:return Fe.UNKNOWN;case Fs.DEADLINE_EXCEEDED:return Fe.DEADLINE_EXCEEDED;case Fs.RESOURCE_EXHAUSTED:return Fe.RESOURCE_EXHAUSTED;case Fs.INTERNAL:return Fe.INTERNAL;case Fs.UNAVAILABLE:return Fe.UNAVAILABLE;case Fs.UNAUTHENTICATED:return Fe.UNAUTHENTICATED;case Fs.INVALID_ARGUMENT:return Fe.INVALID_ARGUMENT;case Fs.NOT_FOUND:return Fe.NOT_FOUND;case Fs.ALREADY_EXISTS:return Fe.ALREADY_EXISTS;case Fs.PERMISSION_DENIED:return Fe.PERMISSION_DENIED;case Fs.FAILED_PRECONDITION:return Fe.FAILED_PRECONDITION;case Fs.ABORTED:return Fe.ABORTED;case Fs.OUT_OF_RANGE:return Fe.OUT_OF_RANGE;case Fs.UNIMPLEMENTED:return Fe.UNIMPLEMENTED;case Fs.DATA_LOSS:return Fe.DATA_LOSS;default:return ht(39323,{code:r})}}(un=Fs||(Fs={}))[un.OK=0]="OK",un[un.CANCELLED=1]="CANCELLED",un[un.UNKNOWN=2]="UNKNOWN",un[un.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",un[un.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",un[un.NOT_FOUND=5]="NOT_FOUND",un[un.ALREADY_EXISTS=6]="ALREADY_EXISTS",un[un.PERMISSION_DENIED=7]="PERMISSION_DENIED",un[un.UNAUTHENTICATED=16]="UNAUTHENTICATED",un[un.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",un[un.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",un[un.ABORTED=10]="ABORTED",un[un.OUT_OF_RANGE=11]="OUT_OF_RANGE",un[un.UNIMPLEMENTED=12]="UNIMPLEMENTED",un[un.INTERNAL=13]="INTERNAL",un[un.UNAVAILABLE=14]="UNAVAILABLE",un[un.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VP(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zP=new cc([4294967295,4294967295],0);function w_(r){const e=VP().encode(r),t=new SS;return t.update(e),new Uint8Array(t.digest())}function v_(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),a=e.getUint32(8,!0),l=e.getUint32(12,!0);return[new cc([t,s],0),new cc([a,l],0)]}class nw{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new Um(`Invalid padding: ${t}`);if(s<0)throw new Um(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new Um(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new Um(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=cc.fromNumber(this.ge)}ye(e,t,s){let a=e.add(t.multiply(cc.fromNumber(s)));return a.compare(zP)===1&&(a=new cc([a.getBits(0),a.getBits(1)],0)),a.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=w_(e),[s,a]=v_(t);for(let l=0;l<this.hashCount;l++){const c=this.ye(s,a,l);if(!this.we(c))return!1}return!0}static create(e,t,s){const a=e%8==0?0:8-e%8,l=new Uint8Array(Math.ceil(e/8)),c=new nw(l,a,t);return s.forEach((u=>c.insert(u))),c}insert(e){if(this.ge===0)return;const t=w_(e),[s,a]=v_(t);for(let l=0;l<this.hashCount;l++){const c=this.ye(s,a,l);this.Se(c)}}Se(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class Um extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Of{constructor(e,t,s,a,l){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=a,this.resolvedLimboDocuments=l}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const a=new Map;return a.set(e,Mf.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new Of(wt.min(),a,new Qn(Ut),Si(),Ht())}}class Mf{constructor(e,t,s,a,l){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=a,this.removedDocuments=l}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new Mf(s,t,Ht(),Ht(),Ht())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ng{constructor(e,t,s,a){this.be=e,this.removedTargetIds=t,this.key=s,this.De=a}}class kI{constructor(e,t){this.targetId=e,this.Ce=t}}class OI{constructor(e,t,s=Ds.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=a}}class N_{constructor(){this.ve=0,this.Fe=j_(),this.Me=Ds.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Ht(),t=Ht(),s=Ht();return this.Fe.forEach(((a,l)=>{switch(l){case 0:e=e.add(a);break;case 2:t=t.add(a);break;case 1:s=s.add(a);break;default:ht(38017,{changeType:l})}})),new Mf(this.Me,this.xe,e,t,s)}qe(){this.Oe=!1,this.Fe=j_()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,yt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class $P{constructor(e){this.Ge=e,this.ze=new Map,this.je=Si(),this.Je=sg(),this.He=sg(),this.Ye=new Qn(Ut)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(e.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.We(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:ht(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((s,a)=>{this.rt(a)&&t(a)}))}st(e){const t=e.targetId,s=e.Ce.count,a=this.ot(t);if(a){const l=a.target;if(Vg(l))if(s===0){const c=new at(l.path);this.et(t,c,ss.newNoDocument(c,wt.min()))}else yt(s===1,20013,{expectedCount:s});else{const c=this._t(t);if(c!==s){const u=this.ut(e),m=u?this.ct(u,e,c):1;if(m!==0){this.it(t);const p=m===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,p)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:a=0},hashCount:l=0}=t;let c,u;try{c=nl(s).toUint8Array()}catch(m){if(m instanceof eI)return Lu("Decoding the base64 bloom filter in existence filter failed ("+m.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw m}try{u=new nw(c,a,l)}catch(m){return Lu(m instanceof Um?"BloomFilter error: ":"Applying bloom filter failed: ",m),null}return u.ge===0?null:u}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let a=0;return s.forEach((l=>{const c=this.Ge.ht(),u=`projects/${c.projectId}/databases/${c.database}/documents/${l.path.canonicalString()}`;e.mightContain(u)||(this.et(t,l,null),a++)})),a}Tt(e){const t=new Map;this.ze.forEach(((l,c)=>{const u=this.ot(c);if(u){if(l.current&&Vg(u.target)){const m=new at(u.target.path);this.It(m).has(c)||this.Et(c,m)||this.et(c,m,ss.newNoDocument(m,e))}l.Be&&(t.set(c,l.ke()),l.qe())}}));let s=Ht();this.He.forEach(((l,c)=>{let u=!0;c.forEachWhile((m=>{const p=this.ot(m);return!p||p.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(s=s.add(l))})),this.je.forEach(((l,c)=>c.setReadTime(e)));const a=new Of(e,t,this.Ye,this.je,s);return this.je=Si(),this.Je=sg(),this.He=sg(),this.Ye=new Qn(Ut),a}Xe(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,s),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const a=this.nt(e);this.Et(e,t)?a.Qe(t,1):a.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new N_,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new An(Ut),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new An(Ut),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Ye("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new N_),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function sg(){return new Qn(at.comparator)}function j_(){return new Qn(at.comparator)}const BP={asc:"ASCENDING",desc:"DESCENDING"},qP={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},HP={and:"AND",or:"OR"};class GP{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function s0(r,e){return r.useProto3Json||Af(e)?e:{value:e}}function Ju(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function MI(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function QP(r,e){return Ju(r,e.toTimestamp())}function cr(r){return yt(!!r,49232),wt.fromTimestamp((function(t){const s=tl(t);return new _n(s.seconds,s.nanos)})(r))}function sw(r,e){return r0(r,e).canonicalString()}function r0(r,e){const t=(function(a){return new gn(["projects",a.projectId,"databases",a.database])})(r).child("documents");return e===void 0?t:t.child(e)}function LI(r){const e=gn.fromString(r);return yt(GI(e),10190,{key:e.toString()}),e}function xf(r,e){return sw(r.databaseId,e.path)}function Xo(r,e){const t=LI(e);if(t.get(1)!==r.databaseId.projectId)throw new Xe(Fe.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new Xe(Fe.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new at(VI(t))}function FI(r,e){return sw(r.databaseId,e)}function UI(r){const e=LI(r);return e.length===4?gn.emptyPath():VI(e)}function i0(r){return new gn(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function VI(r){return yt(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function __(r,e,t){return{name:xf(r,e),fields:t.value.mapValue.fields}}function WP(r,e,t){const s=Xo(r,e.name),a=cr(e.updateTime),l=e.createTime?cr(e.createTime):wt.min(),c=new jr({mapValue:{fields:e.fields}}),u=ss.newFoundDocument(s,a,l,c);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function KP(r,e){return"found"in e?(function(s,a){yt(!!a.found,43571),a.found.name,a.found.updateTime;const l=Xo(s,a.found.name),c=cr(a.found.updateTime),u=a.found.createTime?cr(a.found.createTime):wt.min(),m=new jr({mapValue:{fields:a.found.fields}});return ss.newFoundDocument(l,c,u,m)})(r,e):"missing"in e?(function(s,a){yt(!!a.missing,3894),yt(!!a.readTime,22933);const l=Xo(s,a.missing),c=cr(a.readTime);return ss.newNoDocument(l,c)})(r,e):ht(7234,{result:e})}function YP(r,e){let t;if("targetChange"in e){e.targetChange;const s=(function(p){return p==="NO_CHANGE"?0:p==="ADD"?1:p==="REMOVE"?2:p==="CURRENT"?3:p==="RESET"?4:ht(39313,{state:p})})(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],l=(function(p,b){return p.useProto3Json?(yt(b===void 0||typeof b=="string",58123),Ds.fromBase64String(b||"")):(yt(b===void 0||b instanceof Buffer||b instanceof Uint8Array,16193),Ds.fromUint8Array(b||new Uint8Array))})(r,e.targetChange.resumeToken),c=e.targetChange.cause,u=c&&(function(p){const b=p.code===void 0?Fe.UNKNOWN:PI(p.code);return new Xe(b,p.message||"")})(c);t=new OI(s,a,l,u||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const a=Xo(r,s.document.name),l=cr(s.document.updateTime),c=s.document.createTime?cr(s.document.createTime):wt.min(),u=new jr({mapValue:{fields:s.document.fields}}),m=ss.newFoundDocument(a,l,c,u),p=s.targetIds||[],b=s.removedTargetIds||[];t=new Ng(p,b,m.key,m)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const a=Xo(r,s.document),l=s.readTime?cr(s.readTime):wt.min(),c=ss.newNoDocument(a,l),u=s.removedTargetIds||[];t=new Ng([],u,c.key,c)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const a=Xo(r,s.document),l=s.removedTargetIds||[];t=new Ng([],l,a,null)}else{if(!("filter"in e))return ht(11601,{Rt:e});{e.filter;const s=e.filter;s.targetId;const{count:a=0,unchangedNames:l}=s,c=new UP(a,l),u=s.targetId;t=new kI(u,c)}}return t}function yf(r,e){let t;if(e instanceof ch)t={update:__(r,e.key,e.value)};else if(e instanceof dh)t={delete:xf(r,e.key)};else if(e instanceof ll)t={update:__(r,e.key,e.data),updateMask:nk(e.fieldMask)};else{if(!(e instanceof J0))return ht(16599,{Vt:e.type});t={verify:xf(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((s=>(function(l,c){const u=c.transform;if(u instanceof Wu)return{fieldPath:c.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Ku)return{fieldPath:c.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Yu)return{fieldPath:c.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Xu)return{fieldPath:c.field.canonicalString(),increment:u.Ae};throw ht(20930,{transform:c.transform})})(0,s)))),e.precondition.isNone||(t.currentDocument=(function(a,l){return l.updateTime!==void 0?{updateTime:QP(a,l.updateTime)}:l.exists!==void 0?{exists:l.exists}:ht(27497)})(r,e.precondition)),t}function a0(r,e){const t=e.currentDocument?(function(l){return l.updateTime!==void 0?rs.updateTime(cr(l.updateTime)):l.exists!==void 0?rs.exists(l.exists):rs.none()})(e.currentDocument):rs.none(),s=e.updateTransforms?e.updateTransforms.map((a=>(function(c,u){let m=null;if("setToServerValue"in u)yt(u.setToServerValue==="REQUEST_TIME",16630,{proto:u}),m=new Wu;else if("appendMissingElements"in u){const b=u.appendMissingElements.values||[];m=new Ku(b)}else if("removeAllFromArray"in u){const b=u.removeAllFromArray.values||[];m=new Yu(b)}else"increment"in u?m=new Xu(c,u.increment):ht(16584,{proto:u});const p=ls.fromServerFormat(u.fieldPath);return new X0(p,m)})(r,a))):[];if(e.update){e.update.name;const a=Xo(r,e.update.name),l=new jr({mapValue:{fields:e.update.fields}});if(e.updateMask){const c=(function(m){const p=m.fieldPaths||[];return new ai(p.map((b=>ls.fromServerFormat(b))))})(e.updateMask);return new ll(a,l,c,t,s)}return new ch(a,l,t,s)}if(e.delete){const a=Xo(r,e.delete);return new dh(a,t)}if(e.verify){const a=Xo(r,e.verify);return new J0(a,t)}return ht(1463,{proto:e})}function XP(r,e){return r&&r.length>0?(yt(e!==void 0,14353),r.map((t=>(function(a,l){let c=a.updateTime?cr(a.updateTime):cr(l);return c.isEqual(wt.min())&&(c=cr(l)),new MP(c,a.transformResults||[])})(t,e)))):[]}function zI(r,e){return{documents:[FI(r,e.path)]}}function $I(r,e){const t={structuredQuery:{}},s=e.path;let a;e.collectionGroup!==null?(a=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(a=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=FI(r,a);const l=(function(p){if(p.length!==0)return HI(Cn.create(p,"and"))})(e.filters);l&&(t.structuredQuery.where=l);const c=(function(p){if(p.length!==0)return p.map((b=>(function(j){return{field:ju(j.field),direction:ZP(j.dir)}})(b)))})(e.orderBy);c&&(t.structuredQuery.orderBy=c);const u=s0(r,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(p){return{before:p.inclusive,values:p.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(p){return{before:!p.inclusive,values:p.position}})(e.endAt)),{ft:t,parent:a}}function BI(r){let e=UI(r.parent);const t=r.structuredQuery,s=t.from?t.from.length:0;let a=null;if(s>0){yt(s===1,65062);const b=t.from[0];b.allDescendants?a=b.collectionId:e=e.child(b.collectionId)}let l=[];t.where&&(l=(function(w){const j=qI(w);return j instanceof Cn&&W0(j)?j.getFilters():[j]})(t.where));let c=[];t.orderBy&&(c=(function(w){return w.map((j=>(function(O){return new gf(_u(O.field),(function(z){switch(z){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(O.direction))})(j)))})(t.orderBy));let u=null;t.limit&&(u=(function(w){let j;return j=typeof w=="object"?w.value:w,Af(j)?null:j})(t.limit));let m=null;t.startAt&&(m=(function(w){const j=!!w.before,D=w.values||[];return new Gu(D,j)})(t.startAt));let p=null;return t.endAt&&(p=(function(w){const j=!w.before,D=w.values||[];return new Gu(D,j)})(t.endAt)),gI(e,a,c,l,u,"F",m,p)}function JP(r,e){const t=(function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ht(28987,{purpose:a})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function qI(r){return r.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=_u(t.unaryFilter.field);return nn.create(s,"==",{doubleValue:NaN});case"IS_NULL":const a=_u(t.unaryFilter.field);return nn.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const l=_u(t.unaryFilter.field);return nn.create(l,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const c=_u(t.unaryFilter.field);return nn.create(c,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ht(61313);default:return ht(60726)}})(r):r.fieldFilter!==void 0?(function(t){return nn.create(_u(t.fieldFilter.field),(function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ht(58110);default:return ht(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(r):r.compositeFilter!==void 0?(function(t){return Cn.create(t.compositeFilter.filters.map((s=>qI(s))),(function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return ht(1026)}})(t.compositeFilter.op))})(r):ht(30097,{filter:r})}function ZP(r){return BP[r]}function ek(r){return qP[r]}function tk(r){return HP[r]}function ju(r){return{fieldPath:r.canonicalString()}}function _u(r){return ls.fromServerFormat(r.fieldPath)}function HI(r){return r instanceof nn?(function(t){if(t.op==="=="){if(l_(t.value))return{unaryFilter:{field:ju(t.field),op:"IS_NAN"}};if(o_(t.value))return{unaryFilter:{field:ju(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(l_(t.value))return{unaryFilter:{field:ju(t.field),op:"IS_NOT_NAN"}};if(o_(t.value))return{unaryFilter:{field:ju(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ju(t.field),op:ek(t.op),value:t.value}}})(r):r instanceof Cn?(function(t){const s=t.getFilters().map((a=>HI(a)));return s.length===1?s[0]:{compositeFilter:{op:tk(t.op),filters:s}}})(r):ht(54877,{filter:r})}function nk(r){const e=[];return r.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function GI(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Go{constructor(e,t,s,a,l=wt.min(),c=wt.min(),u=Ds.EMPTY_BYTE_STRING,m=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=a,this.snapshotVersion=l,this.lastLimboFreeSnapshotVersion=c,this.resumeToken=u,this.expectedCount=m}withSequenceNumber(e){return new Go(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Go(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Go(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Go(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QI{constructor(e){this.yt=e}}function sk(r,e){let t;if(e.document)t=WP(r.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const s=at.fromSegments(e.noDocument.path),a=_d(e.noDocument.readTime);t=ss.newNoDocument(s,a),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return ht(56709);{const s=at.fromSegments(e.unknownDocument.path),a=_d(e.unknownDocument.version);t=ss.newUnknownDocument(s,a)}}return e.readTime&&t.setReadTime((function(a){const l=new _n(a[0],a[1]);return wt.fromTimestamp(l)})(e.readTime)),t}function E_(r,e){const t=e.key,s={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Bg(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())s.document=(function(l,c){return{name:xf(l,c.key),fields:c.data.value.mapValue.fields,updateTime:Ju(l,c.version.toTimestamp()),createTime:Ju(l,c.createTime.toTimestamp())}})(r.yt,e);else if(e.isNoDocument())s.noDocument={path:t.path.toArray(),readTime:jd(e.version)};else{if(!e.isUnknownDocument())return ht(57904,{document:e});s.unknownDocument={path:t.path.toArray(),version:jd(e.version)}}return s}function Bg(r){const e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function jd(r){const e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function _d(r){const e=new _n(r.seconds,r.nanoseconds);return wt.fromTimestamp(e)}function cd(r,e){const t=(e.baseMutations||[]).map((l=>a0(r.yt,l)));for(let l=0;l<e.mutations.length-1;++l){const c=e.mutations[l];if(l+1<e.mutations.length&&e.mutations[l+1].transform!==void 0){const u=e.mutations[l+1];c.updateTransforms=u.transform.fieldTransforms,e.mutations.splice(l+1,1),++l}}const s=e.mutations.map((l=>a0(r.yt,l))),a=_n.fromMillis(e.localWriteTimeMs);return new Z0(e.batchId,a,t,s)}function Vm(r){const e=_d(r.readTime),t=r.lastLimboFreeSnapshotVersion!==void 0?_d(r.lastLimboFreeSnapshotVersion):wt.min();let s;return s=(function(l){return l.documents!==void 0})(r.query)?(function(l){const c=l.documents.length;return yt(c===1,1966,{count:c}),Ti(Pf(UI(l.documents[0])))})(r.query):(function(l){return Ti(BI(l))})(r.query),new Go(s,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,Ds.fromBase64String(r.resumeToken))}function WI(r,e){const t=jd(e.snapshotVersion),s=jd(e.lastLimboFreeSnapshotVersion);let a;a=Vg(e.target)?zI(r.yt,e.target):$I(r.yt,e.target).ft;const l=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Nd(e.target),readTime:t,resumeToken:l,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:s,query:a}}function KI(r){const e=BI({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?$g(e,e.limit,"L"):e}function bb(r,e){return new tw(e.largestBatchId,a0(r.yt,e.overlayMutation))}function S_(r,e){const t=e.path.lastSegment();return[r,Or(e.path.popLast()),t]}function I_(r,e,t,s){return{indexId:r,uid:e,sequenceNumber:t,readTime:jd(s.readTime),documentKey:Or(s.documentKey.path),largestBatchId:s.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rk{getBundleMetadata(e,t){return T_(e).get(t).next((s=>{if(s)return(function(l){return{id:l.bundleId,createTime:_d(l.createTime),version:l.version}})(s)}))}saveBundleMetadata(e,t){return T_(e).put((function(a){return{bundleId:a.id,createTime:jd(cr(a.createTime)),version:a.version}})(t))}getNamedQuery(e,t){return C_(e).get(t).next((s=>{if(s)return(function(l){return{name:l.name,query:KI(l.bundledQuery),readTime:_d(l.readTime)}})(s)}))}saveNamedQuery(e,t){return C_(e).put((function(a){return{name:a.name,readTime:jd(cr(a.readTime)),bundledQuery:a.bundledQuery}})(t))}}function T_(r){return Zs(r,xx)}function C_(r){return Zs(r,yx)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ex{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const s=t.uid||"";return new Ex(e,s)}getOverlay(e,t){return Cm(e).get(S_(this.userId,t)).next((s=>s?bb(this.serializer,s):null))}getOverlays(e,t){const s=Qa();return Se.forEach(t,(a=>this.getOverlay(e,a).next((l=>{l!==null&&s.set(a,l)})))).next((()=>s))}saveOverlays(e,t,s){const a=[];return s.forEach(((l,c)=>{const u=new tw(t,c);a.push(this.St(e,u))})),Se.waitFor(a)}removeOverlaysForBatchId(e,t,s){const a=new Set;t.forEach((c=>a.add(Or(c.getCollectionPath()))));const l=[];return a.forEach((c=>{const u=IDBKeyRange.bound([this.userId,c,s],[this.userId,c,s+1],!1,!0);l.push(Cm(e).Z(Kb,u))})),Se.waitFor(l)}getOverlaysForCollection(e,t,s){const a=Qa(),l=Or(t),c=IDBKeyRange.bound([this.userId,l,s],[this.userId,l,Number.POSITIVE_INFINITY],!0);return Cm(e).J(Kb,c).next((u=>{for(const m of u){const p=bb(this.serializer,m);a.set(p.getKey(),p)}return a}))}getOverlaysForCollectionGroup(e,t,s,a){const l=Qa();let c;const u=IDBKeyRange.bound([this.userId,t,s],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Cm(e).ee({index:WS,range:u},((m,p,b)=>{const w=bb(this.serializer,p);l.size()<a||w.largestBatchId===c?(l.set(w.getKey(),w),c=w.largestBatchId):b.done()})).next((()=>l))}St(e,t){return Cm(e).put((function(a,l,c){const[u,m,p]=S_(l,c.mutation.key);return{userId:l,collectionPath:m,documentId:p,collectionGroup:c.mutation.key.getCollectionGroup(),largestBatchId:c.largestBatchId,overlayMutation:yf(a.yt,c.mutation)}})(this.serializer,this.userId,t))}}function Cm(r){return Zs(r,bx)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ik{bt(e){return Zs(e,B0)}getSessionToken(e){return this.bt(e).get("sessionToken").next((t=>{const s=t?.value;return s?Ds.fromUint8Array(s):Ds.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dd{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(ns(e.integerValue));else if("doubleValue"in e){const s=ns(e.doubleValue);isNaN(s)?this.Ft(t,13):(this.Ft(t,15),of(s)?t.Mt(0):t.Mt(s))}else if("timestampValue"in e){let s=e.timestampValue;this.Ft(t,20),typeof s=="string"&&(s=tl(s)),t.xt(`${s.seconds||""}`),t.Mt(s.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(nl(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const s=e.geoPointValue;this.Ft(t,45),t.Mt(s.latitude||0),t.Mt(s.longitude||0)}else"mapValue"in e?aI(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):vx(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):ht(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const s=e.fields||{};this.Ft(t,55);for(const a of Object.keys(s))this.Ot(a,t),this.Ct(s[a],t)}kt(e,t){const s=e.fields||{};this.Ft(t,53);const a=qu,l=s[a].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(ns(l)),this.Ot(a,t),this.Ct(s[a],t)}Qt(e,t){const s=e.values||[];this.Ft(t,50);for(const a of s)this.Ct(a,t)}Lt(e,t){this.Ft(t,37),at.fromName(e).path.forEach((s=>{this.Ft(t,60),this.Ut(s,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}dd.Kt=new dd;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xu=255;function ak(r){if(r===0)return 8;let e=0;return r>>4||(e+=4,r<<=4),r>>6||(e+=2,r<<=2),r>>7||(e+=1),e}function A_(r){const e=64-(function(s){let a=0;for(let l=0;l<8;++l){const c=ak(255&s[l]);if(a+=c,c!==8)break}return a})(r);return Math.ceil(e/8)}class ok{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Gt(s.value),s=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Jt(s.value),s=t.next();this.Ht()}Yt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Gt(s);else if(s<2048)this.Gt(960|s>>>6),this.Gt(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s);else{const a=t.codePointAt(0);this.Gt(240|a>>>18),this.Gt(128|63&a>>>12),this.Gt(128|63&a>>>6),this.Gt(128|63&a)}}this.zt()}Zt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Jt(s);else if(s<2048)this.Jt(960|s>>>6),this.Jt(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s);else{const a=t.codePointAt(0);this.Jt(240|a>>>18),this.Jt(128|63&a>>>12),this.Jt(128|63&a>>>6),this.Jt(128|63&a)}}this.Ht()}Xt(e){const t=this.en(e),s=A_(t);this.tn(1+s),this.buffer[this.position++]=255&s;for(let a=t.length-s;a<t.length;++a)this.buffer[this.position++]=255&t[a]}nn(e){const t=this.en(e),s=A_(t);this.tn(1+s),this.buffer[this.position++]=~(255&s);for(let a=t.length-s;a<t.length;++a)this.buffer[this.position++]=~(255&t[a])}rn(){this.sn(xu),this.sn(255)}_n(){this.an(xu),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=(function(l){const c=new DataView(new ArrayBuffer(8));return c.setFloat64(0,l,!1),new Uint8Array(c.buffer)})(e),s=!!(128&t[0]);t[0]^=s?255:128;for(let a=1;a<t.length;++a)t[a]^=s?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===xu?(this.sn(xu),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===xu?(this.an(xu),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let s=2*this.buffer.length;s<t&&(s=t);const a=new Uint8Array(s);a.set(this.buffer),this.buffer=a}}class lk{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class ck{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Am{constructor(){this.cn=new ok,this.ln=new lk(this.cn),this.hn=new ck(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ud{constructor(e,t,s,a){this.Tn=e,this.In=t,this.En=s,this.dn=a}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,s=new Uint8Array(t);return s.set(this.dn,0),t!==e?s.set([0],this.dn.length):++s[s.length-1],new ud(this.Tn,this.In,this.En,s)}Rn(e,t,s){return{indexId:this.Tn,uid:e,arrayValue:jg(this.En),directionalValue:jg(this.dn),orderedDocumentKey:jg(t),documentKey:s.path.toArray()}}Vn(e,t,s){const a=this.Rn(e,t,s);return[a.indexId,a.uid,a.arrayValue,a.directionalValue,a.orderedDocumentKey,a.documentKey]}}function Ql(r,e){let t=r.Tn-e.Tn;return t!==0?t:(t=D_(r.En,e.En),t!==0?t:(t=D_(r.dn,e.dn),t!==0?t:at.comparator(r.In,e.In)))}function D_(r,e){for(let t=0;t<r.length&&t<e.length;++t){const s=r[t]-e[t];if(s!==0)return s}return r.length-e.length}function jg(r){return wS()?(function(t){let s="";for(let a=0;a<t.length;a++)s+=String.fromCharCode(t[a]);return s})(r):r}function R_(r){return typeof r!="string"?r:(function(t){const s=new Uint8Array(t.length);for(let a=0;a<t.length;a++)s[a]=t.charCodeAt(a);return s})(r)}class P_{constructor(e){this.mn=new An(((t,s)=>ls.comparator(t.field,s.field))),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const s=t;s.isInequality()?this.mn=this.mn.add(s):this.gn.push(s)}}get pn(){return this.mn.size>1}yn(e){if(yt(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=Gb(e);if(t!==void 0&&!this.wn(t))return!1;const s=id(e);let a=new Set,l=0,c=0;for(;l<s.length&&this.wn(s[l]);++l)a=a.add(s[l].fieldPath.canonicalString());if(l===s.length)return!0;if(this.mn.size>0){const u=this.mn.getIterator().getNext();if(!a.has(u.field.canonicalString())){const m=s[l];if(!this.Sn(u,m)||!this.bn(this.fn[c++],m))return!1}++l}for(;l<s.length;++l){const u=s[l];if(c>=this.fn.length||!this.bn(this.fn[c++],u))return!1}return!0}Dn(){if(this.pn)return null;let e=new An(ls.comparator);const t=[];for(const s of this.gn)if(!s.field.isKeyField())if(s.op==="array-contains"||s.op==="array-contains-any")t.push(new pg(s.field,2));else{if(e.has(s.field))continue;e=e.add(s.field),t.push(new pg(s.field,0))}for(const s of this.fn)s.field.isKeyField()||e.has(s.field)||(e=e.add(s.field),t.push(new pg(s.field,s.dir==="asc"?0:1)));return new Mg(Mg.UNKNOWN_ID,this.collectionId,t,af.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const s=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===s}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YI(r){if(yt(r instanceof nn||r instanceof Cn,20012),r instanceof nn){if(r instanceof pI){const t=r.value.arrayValue?.values?.map((s=>nn.create(r.field,"==",s)))||[];return Cn.create(t,"or")}return r}const e=r.filters.map((t=>YI(t)));return Cn.create(e,r.op)}function dk(r){if(r.getFilters().length===0)return[];const e=c0(YI(r));return yt(XI(e),7391),o0(e)||l0(e)?[e]:e.getFilters()}function o0(r){return r instanceof nn}function l0(r){return r instanceof Cn&&W0(r)}function XI(r){return o0(r)||l0(r)||(function(t){if(t instanceof Cn&&Zb(t)){for(const s of t.getFilters())if(!o0(s)&&!l0(s))return!1;return!0}return!1})(r)}function c0(r){if(yt(r instanceof nn||r instanceof Cn,34018),r instanceof nn)return r;if(r.filters.length===1)return c0(r.filters[0]);const e=r.filters.map((s=>c0(s)));let t=Cn.create(e,r.op);return t=qg(t),XI(t)?t:(yt(t instanceof Cn,64498),yt(Qu(t),40251),yt(t.filters.length>1,57927),t.filters.reduce(((s,a)=>rw(s,a))))}function rw(r,e){let t;return yt(r instanceof nn||r instanceof Cn,38388),yt(e instanceof nn||e instanceof Cn,25473),t=r instanceof nn?e instanceof nn?(function(a,l){return Cn.create([a,l],"and")})(r,e):k_(r,e):e instanceof nn?k_(e,r):(function(a,l){if(yt(a.filters.length>0&&l.filters.length>0,48005),Qu(a)&&Qu(l))return hI(a,l.getFilters());const c=Zb(a)?a:l,u=Zb(a)?l:a,m=c.filters.map((p=>rw(p,u)));return Cn.create(m,"or")})(r,e),qg(t)}function k_(r,e){if(Qu(e))return hI(e,r.getFilters());{const t=e.filters.map((s=>rw(r,s)));return Cn.create(t,"or")}}function qg(r){if(yt(r instanceof nn||r instanceof Cn,11850),r instanceof nn)return r;const e=r.getFilters();if(e.length===1)return qg(e[0]);if(dI(r))return r;const t=e.map((a=>qg(a))),s=[];return t.forEach((a=>{a instanceof nn?s.push(a):a instanceof Cn&&(a.op===r.op?s.push(...a.filters):s.push(a))})),s.length===1?s[0]:Cn.create(s,r.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uk{constructor(){this.Cn=new iw}addToCollectionParentIndex(e,t){return this.Cn.add(t),Se.resolve()}getCollectionParents(e,t){return Se.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return Se.resolve()}deleteFieldIndex(e,t){return Se.resolve()}deleteAllFieldIndexes(e){return Se.resolve()}createTargetIndexes(e,t){return Se.resolve()}getDocumentsMatchingTarget(e,t){return Se.resolve(null)}getIndexType(e,t){return Se.resolve(0)}getFieldIndexes(e,t){return Se.resolve([])}getNextCollectionGroupToUpdate(e){return Se.resolve(null)}getMinOffset(e,t){return Se.resolve(Ci.min())}getMinOffsetFromCollectionGroup(e,t){return Se.resolve(Ci.min())}updateCollectionGroup(e,t,s){return Se.resolve()}updateIndexEntries(e,t){return Se.resolve()}}class iw{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),a=this.index[t]||new An(gn.comparator),l=!a.has(s);return this.index[t]=a.add(s),l}has(e){const t=e.lastSegment(),s=e.popLast(),a=this.index[t];return a&&a.has(s)}getEntries(e){return(this.index[e]||new An(gn.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O_="IndexedDbIndexManager",rg=new Uint8Array(0);class hk{constructor(e,t){this.databaseId=t,this.vn=new iw,this.Fn=new ol((s=>Nd(s)),((s,a)=>Rf(s,a))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const s=t.lastSegment(),a=t.popLast();e.addOnCommittedListener((()=>{this.vn.add(t)}));const l={collectionId:s,parent:Or(a)};return M_(e).put(l)}return Se.resolve()}getCollectionParents(e,t){const s=[],a=IDBKeyRange.bound([t,""],[kS(t),""],!1,!0);return M_(e).J(a).next((l=>{for(const c of l){if(c.collectionId!==t)break;s.push(Ga(c.parent))}return s}))}addFieldIndex(e,t){const s=Dm(e),a=(function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map((m=>[m.fieldPath.canonicalString(),m.kind]))}})(t);delete a.indexId;const l=s.add(a);if(t.indexState){const c=bu(e);return l.next((u=>{c.put(I_(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return l.next()}deleteFieldIndex(e,t){const s=Dm(e),a=bu(e),l=yu(e);return s.delete(t.indexId).next((()=>a.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>l.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=Dm(e),s=yu(e),a=bu(e);return t.Z().next((()=>s.Z())).next((()=>a.Z()))}createTargetIndexes(e,t){return Se.forEach(this.Mn(t),(s=>this.getIndexType(e,s).next((a=>{if(a===0||a===1){const l=new P_(s).Dn();if(l!=null)return this.addFieldIndex(e,l)}}))))}getDocumentsMatchingTarget(e,t){const s=yu(e);let a=!0;const l=new Map;return Se.forEach(this.Mn(t),(c=>this.xn(e,c).next((u=>{a&&(a=!!u),l.set(c,u)})))).next((()=>{if(a){let c=Ht();const u=[];return Se.forEach(l,((m,p)=>{Ye(O_,`Using index ${(function(J){return`id=${J.indexId}|cg=${J.collectionGroup}|f=${J.fields.map((oe=>`${oe.fieldPath}:${oe.kind}`)).join(",")}`})(m)} to execute ${Nd(t)}`);const b=(function(J,oe){const Y=Gb(oe);if(Y===void 0)return null;for(const be of zg(J,Y.fieldPath))switch(be.op){case"array-contains-any":return be.value.arrayValue.values||[];case"array-contains":return[be.value]}return null})(p,m),w=(function(J,oe){const Y=new Map;for(const be of id(oe))for(const M of zg(J,be.fieldPath))switch(M.op){case"==":case"in":Y.set(be.fieldPath.canonicalString(),M.value);break;case"not-in":case"!=":return Y.set(be.fieldPath.canonicalString(),M.value),Array.from(Y.values())}return null})(p,m),j=(function(J,oe){const Y=[];let be=!0;for(const M of id(oe)){const H=M.kind===0?m_(J,M.fieldPath,J.startAt):f_(J,M.fieldPath,J.startAt);Y.push(H.value),be&&(be=H.inclusive)}return new Gu(Y,be)})(p,m),D=(function(J,oe){const Y=[];let be=!0;for(const M of id(oe)){const H=M.kind===0?f_(J,M.fieldPath,J.endAt):m_(J,M.fieldPath,J.endAt);Y.push(H.value),be&&(be=H.inclusive)}return new Gu(Y,be)})(p,m),O=this.On(m,p,j),Q=this.On(m,p,D),z=this.Nn(m,p,w),I=this.Bn(m.indexId,b,O,j.inclusive,Q,D.inclusive,z);return Se.forEach(I,(ee=>s.Y(ee,t.limit).next((J=>{J.forEach((oe=>{const Y=at.fromSegments(oe.documentKey);c.has(Y)||(c=c.add(Y),u.push(Y))}))}))))})).next((()=>u))}return Se.resolve(null)}))}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=dk(Cn.create(e.filters,"and")).map((s=>t0(e.path,e.collectionGroup,e.orderBy,s.getFilters(),e.limit,e.startAt,e.endAt))),this.Fn.set(e,t),t)}Bn(e,t,s,a,l,c,u){const m=(t!=null?t.length:1)*Math.max(s.length,l.length),p=m/(t!=null?t.length:1),b=[];for(let w=0;w<m;++w){const j=t?this.Ln(t[w/p]):rg,D=this.kn(e,j,s[w%p],a),O=this.qn(e,j,l[w%p],c),Q=u.map((z=>this.kn(e,j,z,!0)));b.push(...this.createRange(D,O,Q))}return b}kn(e,t,s,a){const l=new ud(e,at.empty(),t,s);return a?l:l.An()}qn(e,t,s,a){const l=new ud(e,at.empty(),t,s);return a?l.An():l}xn(e,t){const s=new P_(t),a=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,a).next((l=>{let c=null;for(const u of l)s.yn(u)&&(!c||u.fields.length>c.fields.length)&&(c=u);return c}))}getIndexType(e,t){let s=2;const a=this.Mn(t);return Se.forEach(a,(l=>this.xn(e,l).next((c=>{c?s!==0&&c.fields.length<(function(m){let p=new An(ls.comparator),b=!1;for(const w of m.filters)for(const j of w.getFlattenedFilters())j.field.isKeyField()||(j.op==="array-contains"||j.op==="array-contains-any"?b=!0:p=p.add(j.field));for(const w of m.orderBy)w.field.isKeyField()||(p=p.add(w.field));return p.size+(b?1:0)})(l)&&(s=1):s=0})))).next((()=>(function(c){return c.limit!==null})(t)&&a.length>1&&s===2?1:s))}Qn(e,t){const s=new Am;for(const a of id(e)){const l=t.data.field(a.fieldPath);if(l==null)return null;const c=s.Pn(a.kind);dd.Kt.Dt(l,c)}return s.un()}Ln(e){const t=new Am;return dd.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const s=new Am;return dd.Kt.Dt(ff(this.databaseId,t),s.Pn((function(l){const c=id(l);return c.length===0?0:c[c.length-1].kind})(e))),s.un()}Nn(e,t,s){if(s===null)return[];let a=[];a.push(new Am);let l=0;for(const c of id(e)){const u=s[l++];for(const m of a)if(this.Un(t,c.fieldPath)&&pf(u))a=this.Kn(a,c,u);else{const p=m.Pn(c.kind);dd.Kt.Dt(u,p)}}return this.Wn(a)}On(e,t,s){return this.Nn(e,t,s.position)}Wn(e){const t=[];for(let s=0;s<e.length;++s)t[s]=e[s].un();return t}Kn(e,t,s){const a=[...e],l=[];for(const c of s.arrayValue.values||[])for(const u of a){const m=new Am;m.seed(u.un()),dd.Kt.Dt(c,m.Pn(t.kind)),l.push(m)}return l}Un(e,t){return!!e.filters.find((s=>s instanceof nn&&s.field.isEqual(t)&&(s.op==="in"||s.op==="not-in")))}getFieldIndexes(e,t){const s=Dm(e),a=bu(e);return(t?s.J(Wb,IDBKeyRange.bound(t,t)):s.J()).next((l=>{const c=[];return Se.forEach(l,(u=>a.get([u.indexId,this.uid]).next((m=>{c.push((function(b,w){const j=w?new af(w.sequenceNumber,new Ci(_d(w.readTime),new at(Ga(w.documentKey)),w.largestBatchId)):af.empty(),D=b.fields.map((([O,Q])=>new pg(ls.fromServerFormat(O),Q)));return new Mg(b.indexId,b.collectionGroup,D,j)})(u,m))})))).next((()=>c))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((t=>t.length===0?null:(t.sort(((s,a)=>{const l=s.indexState.sequenceNumber-a.indexState.sequenceNumber;return l!==0?l:Ut(s.collectionGroup,a.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(e,t,s){const a=Dm(e),l=bu(e);return this.Gn(e).next((c=>a.J(Wb,IDBKeyRange.bound(t,t)).next((u=>Se.forEach(u,(m=>l.put(I_(m.indexId,this.uid,c,s))))))))}updateIndexEntries(e,t){const s=new Map;return Se.forEach(t,((a,l)=>{const c=s.get(a.collectionGroup);return(c?Se.resolve(c):this.getFieldIndexes(e,a.collectionGroup)).next((u=>(s.set(a.collectionGroup,u),Se.forEach(u,(m=>this.zn(e,a,m).next((p=>{const b=this.jn(l,m);return p.isEqual(b)?Se.resolve():this.Jn(e,l,m,p,b)})))))))}))}Hn(e,t,s,a){return yu(e).put(a.Rn(this.uid,this.$n(s,t.key),t.key))}Yn(e,t,s,a){return yu(e).delete(a.Vn(this.uid,this.$n(s,t.key),t.key))}zn(e,t,s){const a=yu(e);let l=new An(Ql);return a.ee({index:QS,range:IDBKeyRange.only([s.indexId,this.uid,jg(this.$n(s,t))])},((c,u)=>{l=l.add(new ud(s.indexId,t,R_(u.arrayValue),R_(u.directionalValue)))})).next((()=>l))}jn(e,t){let s=new An(Ql);const a=this.Qn(t,e);if(a==null)return s;const l=Gb(t);if(l!=null){const c=e.data.field(l.fieldPath);if(pf(c))for(const u of c.arrayValue.values||[])s=s.add(new ud(t.indexId,e.key,this.Ln(u),a))}else s=s.add(new ud(t.indexId,e.key,rg,a));return s}Jn(e,t,s,a,l){Ye(O_,"Updating index entries for document '%s'",t.key);const c=[];return(function(m,p,b,w,j){const D=m.getIterator(),O=p.getIterator();let Q=gu(D),z=gu(O);for(;Q||z;){let I=!1,ee=!1;if(Q&&z){const J=b(Q,z);J<0?ee=!0:J>0&&(I=!0)}else Q!=null?ee=!0:I=!0;I?(w(z),z=gu(O)):ee?(j(Q),Q=gu(D)):(Q=gu(D),z=gu(O))}})(a,l,Ql,(u=>{c.push(this.Hn(e,t,s,u))}),(u=>{c.push(this.Yn(e,t,s,u))})),Se.waitFor(c)}Gn(e){let t=1;return bu(e).ee({index:GS,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((s,a,l)=>{l.done(),t=a.sequenceNumber+1})).next((()=>t))}createRange(e,t,s){s=s.sort(((c,u)=>Ql(c,u))).filter(((c,u,m)=>!u||Ql(c,m[u-1])!==0));const a=[];a.push(e);for(const c of s){const u=Ql(c,e),m=Ql(c,t);if(u===0)a[0]=e.An();else if(u>0&&m<0)a.push(c),a.push(c.An());else if(m>0)break}a.push(t);const l=[];for(let c=0;c<a.length;c+=2){if(this.Zn(a[c],a[c+1]))return[];const u=a[c].Vn(this.uid,rg,at.empty()),m=a[c+1].Vn(this.uid,rg,at.empty());l.push(IDBKeyRange.bound(u,m))}return l}Zn(e,t){return Ql(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(L_)}getMinOffset(e,t){return Se.mapArray(this.Mn(t),(s=>this.xn(e,s).next((a=>a||ht(44426))))).next(L_)}}function M_(r){return Zs(r,df)}function yu(r){return Zs(r,Hm)}function Dm(r){return Zs(r,$0)}function bu(r){return Zs(r,qm)}function L_(r){yt(r.length!==0,28825);let e=r[0].indexState.offset,t=e.largestBatchId;for(let s=1;s<r.length;s++){const a=r[s].indexState.offset;U0(a,e)<0&&(e=a),t<a.largestBatchId&&(t=a.largestBatchId)}return new Ci(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},JI=41943040;class Pr{static withCacheSize(e){return new Pr(e,Pr.DEFAULT_COLLECTION_PERCENTILE,Pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZI(r,e,t){const s=r.store(pa),a=r.store(Vu),l=[],c=IDBKeyRange.only(t.batchId);let u=0;const m=s.ee({range:c},((b,w,j)=>(u++,j.delete())));l.push(m.next((()=>{yt(u===1,47070,{batchId:t.batchId})})));const p=[];for(const b of t.mutations){const w=BS(e,b.key.path,t.batchId);l.push(a.delete(w)),p.push(b.key)}return Se.waitFor(l).next((()=>p))}function Hg(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw ht(14731);e=r.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Pr.DEFAULT_COLLECTION_PERCENTILE=10,Pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Pr.DEFAULT=new Pr(JI,Pr.DEFAULT_COLLECTION_PERCENTILE,Pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Pr.DISABLED=new Pr(-1,0,0);class Sx{constructor(e,t,s,a){this.userId=e,this.serializer=t,this.indexManager=s,this.referenceDelegate=a,this.Xn={}}static wt(e,t,s,a){yt(e.uid!=="",64387);const l=e.isAuthenticated()?e.uid:"";return new Sx(l,t,s,a)}checkEmpty(e){let t=!0;const s=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Wl(e).ee({index:md,range:s},((a,l,c)=>{t=!1,c.done()})).next((()=>t))}addMutationBatch(e,t,s,a){const l=Eu(e),c=Wl(e);return c.add({}).next((u=>{yt(typeof u=="number",49019);const m=new Z0(u,t,s,a),p=(function(D,O,Q){const z=Q.baseMutations.map((ee=>yf(D.yt,ee))),I=Q.mutations.map((ee=>yf(D.yt,ee)));return{userId:O,batchId:Q.batchId,localWriteTimeMs:Q.localWriteTime.toMillis(),baseMutations:z,mutations:I}})(this.serializer,this.userId,m),b=[];let w=new An(((j,D)=>Ut(j.canonicalString(),D.canonicalString())));for(const j of a){const D=BS(this.userId,j.key.path,u);w=w.add(j.key.path.popLast()),b.push(c.put(p)),b.push(l.put(D,HR))}return w.forEach((j=>{b.push(this.indexManager.addToCollectionParentIndex(e,j))})),e.addOnCommittedListener((()=>{this.Xn[u]=m.keys()})),Se.waitFor(b).next((()=>m))}))}lookupMutationBatch(e,t){return Wl(e).get(t).next((s=>s?(yt(s.userId===this.userId,48,"Unexpected user for mutation batch",{userId:s.userId,batchId:t}),cd(this.serializer,s)):null))}er(e,t){return this.Xn[t]?Se.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next((s=>{if(s){const a=s.keys();return this.Xn[t]=a,a}return null}))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,a=IDBKeyRange.lowerBound([this.userId,s]);let l=null;return Wl(e).ee({index:md,range:a},((c,u,m)=>{u.userId===this.userId&&(yt(u.batchId>=s,47524,{tr:s}),l=cd(this.serializer,u)),m.done()})).next((()=>l))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let s=pd;return Wl(e).ee({index:md,range:t,reverse:!0},((a,l,c)=>{s=l.batchId,c.done()})).next((()=>s))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,pd],[this.userId,Number.POSITIVE_INFINITY]);return Wl(e).J(md,t).next((s=>s.map((a=>cd(this.serializer,a)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const s=gg(this.userId,t.path),a=IDBKeyRange.lowerBound(s),l=[];return Eu(e).ee({range:a},((c,u,m)=>{const[p,b,w]=c,j=Ga(b);if(p===this.userId&&t.path.isEqual(j))return Wl(e).get(w).next((D=>{if(!D)throw ht(61480,{nr:c,batchId:w});yt(D.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:D.userId,batchId:w}),l.push(cd(this.serializer,D))}));m.done()})).next((()=>l))}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new An(Ut);const a=[];return t.forEach((l=>{const c=gg(this.userId,l.path),u=IDBKeyRange.lowerBound(c),m=Eu(e).ee({range:u},((p,b,w)=>{const[j,D,O]=p,Q=Ga(D);j===this.userId&&l.path.isEqual(Q)?s=s.add(O):w.done()}));a.push(m)})),Se.waitFor(a).next((()=>this.rr(e,s)))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,a=s.length+1,l=gg(this.userId,s),c=IDBKeyRange.lowerBound(l);let u=new An(Ut);return Eu(e).ee({range:c},((m,p,b)=>{const[w,j,D]=m,O=Ga(j);w===this.userId&&s.isPrefixOf(O)?O.length===a&&(u=u.add(D)):b.done()})).next((()=>this.rr(e,u)))}rr(e,t){const s=[],a=[];return t.forEach((l=>{a.push(Wl(e).get(l).next((c=>{if(c===null)throw ht(35274,{batchId:l});yt(c.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:c.userId,batchId:l}),s.push(cd(this.serializer,c))})))})),Se.waitFor(a).next((()=>s))}removeMutationBatch(e,t){return ZI(e.le,this.userId,t).next((s=>(e.addOnCommittedListener((()=>{this.ir(t.batchId)})),Se.forEach(s,(a=>this.referenceDelegate.markPotentiallyOrphaned(e,a))))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return Se.resolve();const s=IDBKeyRange.lowerBound((function(c){return[c]})(this.userId)),a=[];return Eu(e).ee({range:s},((l,c,u)=>{if(l[0]===this.userId){const m=Ga(l[1]);a.push(m)}else u.done()})).next((()=>{yt(a.length===0,56720,{sr:a.map((l=>l.canonicalString()))})}))}))}containsKey(e,t){return eT(e,this.userId,t)}_r(e){return tT(e).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:pd,lastStreamToken:""}))}}function eT(r,e,t){const s=gg(e,t.path),a=s[1],l=IDBKeyRange.lowerBound(s);let c=!1;return Eu(r).ee({range:l,X:!0},((u,m,p)=>{const[b,w,j]=u;b===e&&w===a&&(c=!0),p.done()})).next((()=>c))}function Wl(r){return Zs(r,pa)}function Eu(r){return Zs(r,Vu)}function tT(r){return Zs(r,lf)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ed{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Ed(0)}static cr(){return new Ed(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mk{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next((t=>{const s=new Ed(t.highestTargetId);return t.highestTargetId=s.next(),this.hr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.lr(e).next((t=>wt.fromTimestamp(new _n(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.lr(e).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(e,t,s){return this.lr(e).next((a=>(a.highestListenSequenceNumber=t,s&&(a.lastRemoteSnapshotVersion=s.toTimestamp()),t>a.highestListenSequenceNumber&&(a.highestListenSequenceNumber=t),this.hr(e,a))))}addTargetData(e,t){return this.Pr(e,t).next((()=>this.lr(e).next((s=>(s.targetCount+=1,this.Tr(t,s),this.hr(e,s))))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>wu(e).delete(t.targetId))).next((()=>this.lr(e))).next((s=>(yt(s.targetCount>0,8065),s.targetCount-=1,this.hr(e,s))))}removeTargets(e,t,s){let a=0;const l=[];return wu(e).ee(((c,u)=>{const m=Vm(u);m.sequenceNumber<=t&&s.get(m.targetId)===null&&(a++,l.push(this.removeTargetData(e,m)))})).next((()=>Se.waitFor(l))).next((()=>a))}forEachTarget(e,t){return wu(e).ee(((s,a)=>{const l=Vm(a);t(l)}))}lr(e){return U_(e).get(Ug).next((t=>(yt(t!==null,2888),t)))}hr(e,t){return U_(e).put(Ug,t)}Pr(e,t){return wu(e).put(WI(this.serializer,t))}Tr(e,t){let s=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,s=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,s=!0),s}getTargetCount(e){return this.lr(e).next((t=>t.targetCount))}getTargetData(e,t){const s=Nd(t),a=IDBKeyRange.bound([s,Number.NEGATIVE_INFINITY],[s,Number.POSITIVE_INFINITY]);let l=null;return wu(e).ee({range:a,index:HS},((c,u,m)=>{const p=Vm(u);Rf(t,p.target)&&(l=p,m.done())})).next((()=>l))}addMatchingKeys(e,t,s){const a=[],l=Xl(e);return t.forEach((c=>{const u=Or(c.path);a.push(l.put({targetId:s,path:u})),a.push(this.referenceDelegate.addReference(e,s,c))})),Se.waitFor(a)}removeMatchingKeys(e,t,s){const a=Xl(e);return Se.forEach(t,(l=>{const c=Or(l.path);return Se.waitFor([a.delete([s,c]),this.referenceDelegate.removeReference(e,s,l)])}))}removeMatchingKeysForTargetId(e,t){const s=Xl(e),a=IDBKeyRange.bound([t],[t+1],!1,!0);return s.delete(a)}getMatchingKeysForTargetId(e,t){const s=IDBKeyRange.bound([t],[t+1],!1,!0),a=Xl(e);let l=Ht();return a.ee({range:s,X:!0},((c,u,m)=>{const p=Ga(c[1]),b=new at(p);l=l.add(b)})).next((()=>l))}containsKey(e,t){const s=Or(t.path),a=IDBKeyRange.bound([s],[kS(s)],!1,!0);let l=0;return Xl(e).ee({index:z0,X:!0,range:a},(([c,u],m,p)=>{c!==0&&(l++,p.done())})).next((()=>l>0))}At(e,t){return wu(e).get(t).next((s=>s?Vm(s):null))}}function wu(r){return Zs(r,zu)}function U_(r){return Zs(r,gd)}function Xl(r){return Zs(r,$u)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V_="LruGarbageCollector",nT=1048576;function z_([r,e],[t,s]){const a=Ut(r,t);return a===0?Ut(e,s):a}class fk{constructor(e){this.Ir=e,this.buffer=new An(z_),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();z_(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class sT{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Ye(V_,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){wc(t)?Ye(V_,"Ignoring IndexedDB error during garbage collection: ",t):await bc(t)}await this.Vr(3e5)}))}}class pk{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((s=>Math.floor(t/100*s)))}nthSequenceNumber(e,t){if(t===0)return Se.resolve(ii.ce);const s=new fk(t);return this.mr.forEachTarget(e,(a=>s.Ar(a.sequenceNumber))).next((()=>this.mr.pr(e,(a=>s.Ar(a))))).next((()=>s.maxValue))}removeTargets(e,t,s){return this.mr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Ye("LruGarbageCollector","Garbage collection skipped; disabled"),Se.resolve(F_)):this.getCacheSize(e).next((s=>s<this.params.cacheSizeCollectionThreshold?(Ye("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),F_):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let s,a,l,c,u,m,p;const b=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((w=>(w>this.params.maximumSequenceNumbersToCollect?(Ye("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${w}`),a=this.params.maximumSequenceNumbersToCollect):a=w,c=Date.now(),this.nthSequenceNumber(e,a)))).next((w=>(s=w,u=Date.now(),this.removeTargets(e,s,t)))).next((w=>(l=w,m=Date.now(),this.removeOrphanedDocuments(e,s)))).next((w=>(p=Date.now(),vu()<=tn.DEBUG&&Ye("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${c-b}ms
	Determined least recently used ${a} in `+(u-c)+`ms
	Removed ${l} targets in `+(m-u)+`ms
	Removed ${w} documents in `+(p-m)+`ms
Total Duration: ${p-b}ms`),Se.resolve({didRun:!0,sequenceNumbersCollected:a,targetsRemoved:l,documentsRemoved:w}))))}}function rT(r,e){return new pk(r,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gk{constructor(e,t){this.db=e,this.garbageCollector=rT(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next((s=>t.next((a=>s+a))))}wr(e){let t=0;return this.pr(e,(s=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,((s,a)=>t(a)))}addReference(e,t,s){return ig(e,s)}removeReference(e,t,s){return ig(e,s)}removeTargets(e,t,s){return this.db.getTargetCache().removeTargets(e,t,s)}markPotentiallyOrphaned(e,t){return ig(e,t)}br(e,t){return(function(a,l){let c=!1;return tT(a).te((u=>eT(a,u,l).next((m=>(m&&(c=!0),Se.resolve(!m)))))).next((()=>c))})(e,t)}removeOrphanedDocuments(e,t){const s=this.db.getRemoteDocumentCache().newChangeBuffer(),a=[];let l=0;return this.Sr(e,((c,u)=>{if(u<=t){const m=this.br(e,c).next((p=>{if(!p)return l++,s.getEntry(e,c).next((()=>(s.removeEntry(c,wt.min()),Xl(e).delete((function(w){return[0,Or(w.path)]})(c)))))}));a.push(m)}})).next((()=>Se.waitFor(a))).next((()=>s.apply(e))).next((()=>l))}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,s)}updateLimboDocument(e,t){return ig(e,t)}Sr(e,t){const s=Xl(e);let a,l=ii.ce;return s.ee({index:z0},(([c,u],{path:m,sequenceNumber:p})=>{c===0?(l!==ii.ce&&t(new at(Ga(a)),l),l=p,a=m):l=ii.ce})).next((()=>{l!==ii.ce&&t(new at(Ga(a)),l)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ig(r,e){return Xl(r).put((function(s,a){return{targetId:0,path:Or(s.path),sequenceNumber:a}})(e,r.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iT{constructor(){this.changes=new ol((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ss.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?Se.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xk{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,s){return Yc(e).put(s)}removeEntry(e,t,s){return Yc(e).delete((function(l,c){const u=l.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Bg(c),u[u.length-1]]})(t,s))}updateMetadata(e,t){return this.getMetadata(e).next((s=>(s.byteSize+=t,this.Dr(e,s))))}getEntry(e,t){let s=ss.newInvalidDocument(t);return Yc(e).ee({index:xg,range:IDBKeyRange.only(Rm(t))},((a,l)=>{s=this.Cr(t,l)})).next((()=>s))}vr(e,t){let s={size:0,document:ss.newInvalidDocument(t)};return Yc(e).ee({index:xg,range:IDBKeyRange.only(Rm(t))},((a,l)=>{s={document:this.Cr(t,l),size:Hg(l)}})).next((()=>s))}getEntries(e,t){let s=Si();return this.Fr(e,t,((a,l)=>{const c=this.Cr(a,l);s=s.insert(a,c)})).next((()=>s))}Mr(e,t){let s=Si(),a=new Qn(at.comparator);return this.Fr(e,t,((l,c)=>{const u=this.Cr(l,c);s=s.insert(l,u),a=a.insert(l,Hg(c))})).next((()=>({documents:s,Or:a})))}Fr(e,t,s){if(t.isEmpty())return Se.resolve();let a=new An(q_);t.forEach((m=>a=a.add(m)));const l=IDBKeyRange.bound(Rm(a.first()),Rm(a.last())),c=a.getIterator();let u=c.getNext();return Yc(e).ee({index:xg,range:l},((m,p,b)=>{const w=at.fromSegments([...p.prefixPath,p.collectionGroup,p.documentId]);for(;u&&q_(u,w)<0;)s(u,null),u=c.getNext();u&&u.isEqual(w)&&(s(u,p),u=c.hasNext()?c.getNext():null),u?b.j(Rm(u)):b.done()})).next((()=>{for(;u;)s(u,null),u=c.hasNext()?c.getNext():null}))}getDocumentsMatchingQuery(e,t,s,a,l){const c=t.path,u=[c.popLast().toArray(),c.lastSegment(),Bg(s.readTime),s.documentKey.path.isEmpty()?"":s.documentKey.path.lastSegment()],m=[c.popLast().toArray(),c.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Yc(e).J(IDBKeyRange.bound(u,m,!0)).next((p=>{l?.incrementDocumentReadCount(p.length);let b=Si();for(const w of p){const j=this.Cr(at.fromSegments(w.prefixPath.concat(w.collectionGroup,w.documentId)),w);j.isFoundDocument()&&(kf(t,j)||a.has(j.key))&&(b=b.insert(j.key,j))}return b}))}getAllFromCollectionGroup(e,t,s,a){let l=Si();const c=B_(t,s),u=B_(t,Ci.max());return Yc(e).ee({index:qS,range:IDBKeyRange.bound(c,u,!0)},((m,p,b)=>{const w=this.Cr(at.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);l=l.insert(w.key,w),l.size===a&&b.done()})).next((()=>l))}newChangeBuffer(e){return new yk(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((t=>t.byteSize))}getMetadata(e){return $_(e).get(Qb).next((t=>(yt(!!t,20021),t)))}Dr(e,t){return $_(e).put(Qb,t)}Cr(e,t){if(t){const s=sk(this.serializer,t);if(!(s.isNoDocument()&&s.version.isEqual(wt.min())))return s}return ss.newInvalidDocument(e)}}function aT(r){return new xk(r)}class yk extends iT{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new ol((s=>s.toString()),((s,a)=>s.isEqual(a)))}applyChanges(e){const t=[];let s=0,a=new An(((l,c)=>Ut(l.canonicalString(),c.canonicalString())));return this.changes.forEach(((l,c)=>{const u=this.Br.get(l);if(t.push(this.Nr.removeEntry(e,l,u.readTime)),c.isValidDocument()){const m=E_(this.Nr.serializer,c);a=a.add(l.path.popLast());const p=Hg(m);s+=p-u.size,t.push(this.Nr.addEntry(e,l,m))}else if(s-=u.size,this.trackRemovals){const m=E_(this.Nr.serializer,c.convertToNoDocument(wt.min()));t.push(this.Nr.addEntry(e,l,m))}})),a.forEach((l=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,l))})),t.push(this.Nr.updateMetadata(e,s)),Se.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next((s=>(this.Br.set(t,{size:s.size,readTime:s.document.readTime}),s.document)))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next((({documents:s,Or:a})=>(a.forEach(((l,c)=>{this.Br.set(l,{size:c,readTime:s.get(l).readTime})})),s)))}}function $_(r){return Zs(r,cf)}function Yc(r){return Zs(r,Fg)}function Rm(r){const e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function B_(r,e){const t=e.documentKey.path.toArray();return[r,Bg(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function q_(r,e){const t=r.path.toArray(),s=e.path.toArray();let a=0;for(let l=0;l<t.length-2&&l<s.length-2;++l)if(a=Ut(t[l],s[l]),a)return a;return a=Ut(t.length,s.length),a||(a=Ut(t[t.length-2],s[s.length-2]),a||Ut(t[t.length-1],s[s.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bk{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oT{constructor(e,t,s,a){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=a}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next((a=>(s=a,this.remoteDocumentCache.getEntry(e,t)))).next((a=>(s!==null&&Km(s.mutation,a,ai.empty(),_n.now()),a)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.getLocalViewOfDocuments(e,s,Ht()).next((()=>s))))}getLocalViewOfDocuments(e,t,s=Ht()){const a=Qa();return this.populateOverlays(e,a,t).next((()=>this.computeViews(e,t,a,s).next((l=>{let c=Fm();return l.forEach(((u,m)=>{c=c.insert(u,m.overlayedDocument)})),c}))))}getOverlayedDocuments(e,t){const s=Qa();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,Ht())))}populateOverlays(e,t,s){const a=[];return s.forEach((l=>{t.has(l)||a.push(l)})),this.documentOverlayCache.getOverlays(e,a).next((l=>{l.forEach(((c,u)=>{t.set(c,u)}))}))}computeViews(e,t,s,a){let l=Si();const c=Wm(),u=(function(){return Wm()})();return t.forEach(((m,p)=>{const b=s.get(p.key);a.has(p.key)&&(b===void 0||b.mutation instanceof ll)?l=l.insert(p.key,p):b!==void 0?(c.set(p.key,b.mutation.getFieldMask()),Km(b.mutation,p,b.mutation.getFieldMask(),_n.now())):c.set(p.key,ai.empty())})),this.recalculateAndSaveOverlays(e,l).next((m=>(m.forEach(((p,b)=>c.set(p,b))),t.forEach(((p,b)=>u.set(p,new bk(b,c.get(p)??null)))),u)))}recalculateAndSaveOverlays(e,t){const s=Wm();let a=new Qn(((c,u)=>c-u)),l=Ht();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((c=>{for(const u of c)u.keys().forEach((m=>{const p=t.get(m);if(p===null)return;let b=s.get(m)||ai.empty();b=u.applyToLocalView(p,b),s.set(m,b);const w=(a.get(u.batchId)||Ht()).add(m);a=a.insert(u.batchId,w)}))})).next((()=>{const c=[],u=a.getReverseIterator();for(;u.hasNext();){const m=u.getNext(),p=m.key,b=m.value,w=jI();b.forEach((j=>{if(!l.has(j)){const D=AI(t.get(j),s.get(j));D!==null&&w.set(j,D),l=l.add(j)}})),c.push(this.documentOverlayCache.saveOverlays(e,p,w))}return Se.waitFor(c)})).next((()=>s))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.recalculateAndSaveOverlays(e,s)))}getDocumentsMatchingQuery(e,t,s,a){return(function(c){return at.isDocumentKey(c.path)&&c.collectionGroup===null&&c.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):xI(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,a):this.getDocumentsMatchingCollectionQuery(e,t,s,a)}getNextDocuments(e,t,s,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,a).next((l=>{const c=a-l.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,a-l.size):Se.resolve(Qa());let u=Uu,m=l;return c.next((p=>Se.forEach(p,((b,w)=>(u<w.largestBatchId&&(u=w.largestBatchId),l.get(b)?Se.resolve():this.remoteDocumentCache.getEntry(e,b).next((j=>{m=m.insert(b,j)}))))).next((()=>this.populateOverlays(e,p,l))).next((()=>this.computeViews(e,m,p,Ht()))).next((b=>({batchId:u,changes:NI(b)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new at(t)).next((s=>{let a=Fm();return s.isFoundDocument()&&(a=a.insert(s.key,s)),a}))}getDocumentsMatchingCollectionGroupQuery(e,t,s,a){const l=t.collectionGroup;let c=Fm();return this.indexManager.getCollectionParents(e,l).next((u=>Se.forEach(u,(m=>{const p=(function(w,j){return new lh(j,null,w.explicitOrderBy.slice(),w.filters.slice(),w.limit,w.limitType,w.startAt,w.endAt)})(t,m.child(l));return this.getDocumentsMatchingCollectionQuery(e,p,s,a).next((b=>{b.forEach(((w,j)=>{c=c.insert(w,j)}))}))})).next((()=>c))))}getDocumentsMatchingCollectionQuery(e,t,s,a){let l;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next((c=>(l=c,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,l,a)))).next((c=>{l.forEach(((m,p)=>{const b=p.getKey();c.get(b)===null&&(c=c.insert(b,ss.newInvalidDocument(b)))}));let u=Fm();return c.forEach(((m,p)=>{const b=l.get(m);b!==void 0&&Km(b.mutation,p,ai.empty(),_n.now()),kf(t,p)&&(u=u.insert(m,p))})),u}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return Se.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(a){return{id:a.id,version:a.version,createTime:cr(a.createTime)}})(t)),Se.resolve()}getNamedQuery(e,t){return Se.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(a){return{name:a.name,query:KI(a.bundledQuery),readTime:cr(a.readTime)}})(t)),Se.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vk{constructor(){this.overlays=new Qn(at.comparator),this.qr=new Map}getOverlay(e,t){return Se.resolve(this.overlays.get(t))}getOverlays(e,t){const s=Qa();return Se.forEach(t,(a=>this.getOverlay(e,a).next((l=>{l!==null&&s.set(a,l)})))).next((()=>s))}saveOverlays(e,t,s){return s.forEach(((a,l)=>{this.St(e,t,l)})),Se.resolve()}removeOverlaysForBatchId(e,t,s){const a=this.qr.get(s);return a!==void 0&&(a.forEach((l=>this.overlays=this.overlays.remove(l))),this.qr.delete(s)),Se.resolve()}getOverlaysForCollection(e,t,s){const a=Qa(),l=t.length+1,c=new at(t.child("")),u=this.overlays.getIteratorFrom(c);for(;u.hasNext();){const m=u.getNext().value,p=m.getKey();if(!t.isPrefixOf(p.path))break;p.path.length===l&&m.largestBatchId>s&&a.set(m.getKey(),m)}return Se.resolve(a)}getOverlaysForCollectionGroup(e,t,s,a){let l=new Qn(((p,b)=>p-b));const c=this.overlays.getIterator();for(;c.hasNext();){const p=c.getNext().value;if(p.getKey().getCollectionGroup()===t&&p.largestBatchId>s){let b=l.get(p.largestBatchId);b===null&&(b=Qa(),l=l.insert(p.largestBatchId,b)),b.set(p.getKey(),p)}}const u=Qa(),m=l.getIterator();for(;m.hasNext()&&(m.getNext().value.forEach(((p,b)=>u.set(p,b))),!(u.size()>=a)););return Se.resolve(u)}St(e,t,s){const a=this.overlays.get(s.key);if(a!==null){const c=this.qr.get(a.largestBatchId).delete(s.key);this.qr.set(a.largestBatchId,c)}this.overlays=this.overlays.insert(s.key,new tw(t,s));let l=this.qr.get(t);l===void 0&&(l=Ht(),this.qr.set(t,l)),this.qr.set(t,l.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nk{constructor(){this.sessionToken=Ds.EMPTY_BYTE_STRING}getSessionToken(e){return Se.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Se.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aw{constructor(){this.Qr=new An(or.$r),this.Ur=new An(or.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const s=new or(e,t);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(e,t){e.forEach((s=>this.addReference(s,t)))}removeReference(e,t){this.Gr(new or(e,t))}zr(e,t){e.forEach((s=>this.removeReference(s,t)))}jr(e){const t=new at(new gn([])),s=new or(t,e),a=new or(t,e+1),l=[];return this.Ur.forEachInRange([s,a],(c=>{this.Gr(c),l.push(c.key)})),l}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new at(new gn([])),s=new or(t,e),a=new or(t,e+1);let l=Ht();return this.Ur.forEachInRange([s,a],(c=>{l=l.add(c.key)})),l}containsKey(e){const t=new or(e,0),s=this.Qr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class or{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return at.comparator(e.key,t.key)||Ut(e.Yr,t.Yr)}static Kr(e,t){return Ut(e.Yr,t.Yr)||at.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jk{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new An(or.$r)}checkEmpty(e){return Se.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,a){const l=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const c=new Z0(l,t,s,a);this.mutationQueue.push(c);for(const u of a)this.Zr=this.Zr.add(new or(u.key,l)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return Se.resolve(c)}lookupMutationBatch(e,t){return Se.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,a=this.ei(s),l=a<0?0:a;return Se.resolve(this.mutationQueue.length>l?this.mutationQueue[l]:null)}getHighestUnacknowledgedBatchId(){return Se.resolve(this.mutationQueue.length===0?pd:this.tr-1)}getAllMutationBatches(e){return Se.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new or(t,0),a=new or(t,Number.POSITIVE_INFINITY),l=[];return this.Zr.forEachInRange([s,a],(c=>{const u=this.Xr(c.Yr);l.push(u)})),Se.resolve(l)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new An(Ut);return t.forEach((a=>{const l=new or(a,0),c=new or(a,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([l,c],(u=>{s=s.add(u.Yr)}))})),Se.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,a=s.length+1;let l=s;at.isDocumentKey(l)||(l=l.child(""));const c=new or(new at(l),0);let u=new An(Ut);return this.Zr.forEachWhile((m=>{const p=m.key.path;return!!s.isPrefixOf(p)&&(p.length===a&&(u=u.add(m.Yr)),!0)}),c),Se.resolve(this.ti(u))}ti(e){const t=[];return e.forEach((s=>{const a=this.Xr(s);a!==null&&t.push(a)})),t}removeMutationBatch(e,t){yt(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Zr;return Se.forEach(t.mutations,(a=>{const l=new or(a.key,t.batchId);return s=s.delete(l),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)})).next((()=>{this.Zr=s}))}ir(e){}containsKey(e,t){const s=new or(t,0),a=this.Zr.firstAfterOrEqual(s);return Se.resolve(t.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,Se.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _k{constructor(e){this.ri=e,this.docs=(function(){return new Qn(at.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,a=this.docs.get(s),l=a?a.size:0,c=this.ri(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:c}),this.size+=c-l,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return Se.resolve(s?s.document.mutableCopy():ss.newInvalidDocument(t))}getEntries(e,t){let s=Si();return t.forEach((a=>{const l=this.docs.get(a);s=s.insert(a,l?l.document.mutableCopy():ss.newInvalidDocument(a))})),Se.resolve(s)}getDocumentsMatchingQuery(e,t,s,a){let l=Si();const c=t.path,u=new at(c.child("__id-9223372036854775808__")),m=this.docs.getIteratorFrom(u);for(;m.hasNext();){const{key:p,value:{document:b}}=m.getNext();if(!c.isPrefixOf(p.path))break;p.path.length>c.length+1||U0(FS(b),s)<=0||(a.has(b.key)||kf(t,b))&&(l=l.insert(b.key,b.mutableCopy()))}return Se.resolve(l)}getAllFromCollectionGroup(e,t,s,a){ht(9500)}ii(e,t){return Se.forEach(this.docs,(s=>t(s)))}newChangeBuffer(e){return new Ek(this)}getSize(e){return Se.resolve(this.size)}}class Ek extends iT{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((s,a)=>{a.isValidDocument()?t.push(this.Nr.addEntry(e,a)):this.Nr.removeEntry(s)})),Se.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sk{constructor(e){this.persistence=e,this.si=new ol((t=>Nd(t)),Rf),this.lastRemoteSnapshotVersion=wt.min(),this.highestTargetId=0,this.oi=0,this._i=new aw,this.targetCount=0,this.ai=Ed.ur()}forEachTarget(e,t){return this.si.forEach(((s,a)=>t(a))),Se.resolve()}getLastRemoteSnapshotVersion(e){return Se.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Se.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),Se.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.oi&&(this.oi=t),Se.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Ed(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,Se.resolve()}updateTargetData(e,t){return this.Pr(t),Se.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,Se.resolve()}removeTargets(e,t,s){let a=0;const l=[];return this.si.forEach(((c,u)=>{u.sequenceNumber<=t&&s.get(u.targetId)===null&&(this.si.delete(c),l.push(this.removeMatchingKeysForTargetId(e,u.targetId)),a++)})),Se.waitFor(l).next((()=>a))}getTargetCount(e){return Se.resolve(this.targetCount)}getTargetData(e,t){const s=this.si.get(t)||null;return Se.resolve(s)}addMatchingKeys(e,t,s){return this._i.Wr(t,s),Se.resolve()}removeMatchingKeys(e,t,s){this._i.zr(t,s);const a=this.persistence.referenceDelegate,l=[];return a&&t.forEach((c=>{l.push(a.markPotentiallyOrphaned(e,c))})),Se.waitFor(l)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),Se.resolve()}getMatchingKeysForTargetId(e,t){const s=this._i.Hr(t);return Se.resolve(s)}containsKey(e,t){return Se.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ow{constructor(e,t){this.ui={},this.overlays={},this.ci=new ii(0),this.li=!1,this.li=!0,this.hi=new Nk,this.referenceDelegate=e(this),this.Pi=new Sk(this),this.indexManager=new uk,this.remoteDocumentCache=(function(a){return new _k(a)})((s=>this.referenceDelegate.Ti(s))),this.serializer=new QI(t),this.Ii=new wk(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new vk,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.ui[e.toKey()];return s||(s=new jk(t,this.referenceDelegate),this.ui[e.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,s){Ye("MemoryPersistence","Starting transaction:",e);const a=new Ik(this.ci.next());return this.referenceDelegate.Ei(),s(a).next((l=>this.referenceDelegate.di(a).next((()=>l)))).toPromise().then((l=>(a.raiseOnCommittedEvent(),l)))}Ai(e,t){return Se.or(Object.values(this.ui).map((s=>()=>s.containsKey(e,t))))}}class Ik extends VS{constructor(e){super(),this.currentSequenceNumber=e}}class Ix{constructor(e){this.persistence=e,this.Ri=new aw,this.Vi=null}static mi(e){return new Ix(e)}get fi(){if(this.Vi)return this.Vi;throw ht(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.fi.delete(s.toString()),Se.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.fi.add(s.toString()),Se.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),Se.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((a=>this.fi.add(a.toString())));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next((a=>{a.forEach((l=>this.fi.add(l.toString())))})).next((()=>s.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Se.forEach(this.fi,(s=>{const a=at.fromPath(s);return this.gi(e,a).next((l=>{l||t.removeEntry(a,wt.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((s=>{s?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return Se.or([()=>Se.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Gg{constructor(e,t){this.persistence=e,this.pi=new ol((s=>Or(s.path)),((s,a)=>s.isEqual(a))),this.garbageCollector=rT(this,t)}static mi(e,t){return new Gg(e,t)}Ei(){}di(e){return Se.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((s=>t.next((a=>s+a))))}wr(e){let t=0;return this.pr(e,(s=>{t++})).next((()=>t))}pr(e,t){return Se.forEach(this.pi,((s,a)=>this.br(e,s,a).next((l=>l?Se.resolve():t(a)))))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const a=this.persistence.getRemoteDocumentCache(),l=a.newChangeBuffer();return a.ii(e,(c=>this.br(e,c,t).next((u=>{u||(s++,l.removeEntry(c,wt.min()))})))).next((()=>l.apply(e))).next((()=>s))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),Se.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),Se.resolve()}removeReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),Se.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),Se.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=bg(e.data.value)),t}br(e,t,s){return Se.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const a=this.pi.get(t);return Se.resolve(a!==void 0&&a>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tk{constructor(e){this.serializer=e}k(e,t,s,a){const l=new gx("createOrUpgrade",t);s<1&&a>=1&&((function(m){m.createObjectStore(Df)})(e),(function(m){m.createObjectStore(lf,{keyPath:qR}),m.createObjectStore(pa,{keyPath:t_,autoIncrement:!0}).createIndex(md,n_,{unique:!0}),m.createObjectStore(Vu)})(e),H_(e),(function(m){m.createObjectStore(ad)})(e));let c=Se.resolve();return s<3&&a>=3&&(s!==0&&((function(m){m.deleteObjectStore($u),m.deleteObjectStore(zu),m.deleteObjectStore(gd)})(e),H_(e)),c=c.next((()=>(function(m){const p=m.store(gd),b={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:wt.min().toTimestamp(),targetCount:0};return p.put(Ug,b)})(l)))),s<4&&a>=4&&(s!==0&&(c=c.next((()=>(function(m,p){return p.store(pa).J().next((w=>{m.deleteObjectStore(pa),m.createObjectStore(pa,{keyPath:t_,autoIncrement:!0}).createIndex(md,n_,{unique:!0});const j=p.store(pa),D=w.map((O=>j.put(O)));return Se.waitFor(D)}))})(e,l)))),c=c.next((()=>{(function(m){m.createObjectStore(Bu,{keyPath:ZR})})(e)}))),s<5&&a>=5&&(c=c.next((()=>this.yi(l)))),s<6&&a>=6&&(c=c.next((()=>((function(m){m.createObjectStore(cf)})(e),this.wi(l))))),s<7&&a>=7&&(c=c.next((()=>this.Si(l)))),s<8&&a>=8&&(c=c.next((()=>this.bi(e,l)))),s<9&&a>=9&&(c=c.next((()=>{(function(m){m.objectStoreNames.contains("remoteDocumentChanges")&&m.deleteObjectStore("remoteDocumentChanges")})(e)}))),s<10&&a>=10&&(c=c.next((()=>this.Di(l)))),s<11&&a>=11&&(c=c.next((()=>{(function(m){m.createObjectStore(xx,{keyPath:eP})})(e),(function(m){m.createObjectStore(yx,{keyPath:tP})})(e)}))),s<12&&a>=12&&(c=c.next((()=>{(function(m){const p=m.createObjectStore(bx,{keyPath:lP});p.createIndex(Kb,cP,{unique:!1}),p.createIndex(WS,dP,{unique:!1})})(e)}))),s<13&&a>=13&&(c=c.next((()=>(function(m){const p=m.createObjectStore(Fg,{keyPath:GR});p.createIndex(xg,QR),p.createIndex(qS,WR)})(e))).next((()=>this.Ci(e,l))).next((()=>e.deleteObjectStore(ad)))),s<14&&a>=14&&(c=c.next((()=>this.Fi(e,l)))),s<15&&a>=15&&(c=c.next((()=>(function(m){m.createObjectStore($0,{keyPath:nP,autoIncrement:!0}).createIndex(Wb,sP,{unique:!1}),m.createObjectStore(qm,{keyPath:rP}).createIndex(GS,iP,{unique:!1}),m.createObjectStore(Hm,{keyPath:aP}).createIndex(QS,oP,{unique:!1})})(e)))),s<16&&a>=16&&(c=c.next((()=>{t.objectStore(qm).clear()})).next((()=>{t.objectStore(Hm).clear()}))),s<17&&a>=17&&(c=c.next((()=>{(function(m){m.createObjectStore(B0,{keyPath:uP})})(e)}))),s<18&&a>=18&&wS()&&(c=c.next((()=>{t.objectStore(qm).clear()})).next((()=>{t.objectStore(Hm).clear()}))),c}wi(e){let t=0;return e.store(ad).ee(((s,a)=>{t+=Hg(a)})).next((()=>{const s={byteSize:t};return e.store(cf).put(Qb,s)}))}yi(e){const t=e.store(lf),s=e.store(pa);return t.J().next((a=>Se.forEach(a,(l=>{const c=IDBKeyRange.bound([l.userId,pd],[l.userId,l.lastAcknowledgedBatchId]);return s.J(md,c).next((u=>Se.forEach(u,(m=>{yt(m.userId===l.userId,18650,"Cannot process batch from unexpected user",{batchId:m.batchId});const p=cd(this.serializer,m);return ZI(e,l.userId,p).next((()=>{}))}))))}))))}Si(e){const t=e.store($u),s=e.store(ad);return e.store(gd).get(Ug).next((a=>{const l=[];return s.ee(((c,u)=>{const m=new gn(c),p=(function(w){return[0,Or(w)]})(m);l.push(t.get(p).next((b=>b?Se.resolve():(w=>t.put({targetId:0,path:Or(w),sequenceNumber:a.highestListenSequenceNumber}))(m))))})).next((()=>Se.waitFor(l)))}))}bi(e,t){e.createObjectStore(df,{keyPath:JR});const s=t.store(df),a=new iw,l=c=>{if(a.add(c)){const u=c.lastSegment(),m=c.popLast();return s.put({collectionId:u,parent:Or(m)})}};return t.store(ad).ee({X:!0},((c,u)=>{const m=new gn(c);return l(m.popLast())})).next((()=>t.store(Vu).ee({X:!0},(([c,u,m],p)=>{const b=Ga(u);return l(b.popLast())}))))}Di(e){const t=e.store(zu);return t.ee(((s,a)=>{const l=Vm(a),c=WI(this.serializer,l);return t.put(c)}))}Ci(e,t){const s=t.store(ad),a=[];return s.ee(((l,c)=>{const u=t.store(Fg),m=(function(w){return w.document?new at(gn.fromString(w.document.name).popFirst(5)):w.noDocument?at.fromSegments(w.noDocument.path):w.unknownDocument?at.fromSegments(w.unknownDocument.path):ht(36783)})(c).path.toArray(),p={prefixPath:m.slice(0,m.length-2),collectionGroup:m[m.length-2],documentId:m[m.length-1],readTime:c.readTime||[0,0],unknownDocument:c.unknownDocument,noDocument:c.noDocument,document:c.document,hasCommittedMutations:!!c.hasCommittedMutations};a.push(u.put(p))})).next((()=>Se.waitFor(a)))}Fi(e,t){const s=t.store(pa),a=aT(this.serializer),l=new ow(Ix.mi,this.serializer.yt);return s.J().next((c=>{const u=new Map;return c.forEach((m=>{let p=u.get(m.userId)??Ht();cd(this.serializer,m).keys().forEach((b=>p=p.add(b))),u.set(m.userId,p)})),Se.forEach(u,((m,p)=>{const b=new lr(p),w=Ex.wt(this.serializer,b),j=l.getIndexManager(b),D=Sx.wt(b,this.serializer,j,l.referenceDelegate);return new oT(a,D,w,j).recalculateAndSaveOverlaysForDocumentKeys(new Yb(t,ii.ce),m).next()}))}))}}function H_(r){r.createObjectStore($u,{keyPath:YR}).createIndex(z0,XR,{unique:!0}),r.createObjectStore(zu,{keyPath:"targetId"}).createIndex(HS,KR,{unique:!0}),r.createObjectStore(gd)}const Kl="IndexedDbPersistence",wb=18e5,vb=5e3,Nb="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Ck="main";class lw{constructor(e,t,s,a,l,c,u,m,p,b,w=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=s,this.Mi=l,this.window=c,this.document=u,this.xi=p,this.Oi=b,this.Ni=w,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=j=>Promise.resolve(),!lw.v())throw new Xe(Fe.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new gk(this,a),this.$i=t+Ck,this.serializer=new QI(m),this.Ui=new dc(this.$i,this.Ni,new Tk(this.serializer)),this.hi=new ik,this.Pi=new mk(this.referenceDelegate,this.serializer),this.remoteDocumentCache=aT(this.serializer),this.Ii=new rk,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,b===!1&&As(Kl,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Xe(Fe.FAILED_PRECONDITION,Nb);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Pi.getHighestSequenceNumber(e)))})).then((e=>{this.ci=new ii(e,this.xi)})).then((()=>{this.li=!0})).catch((e=>(this.Ui&&this.Ui.close(),Promise.reject(e))))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$((async t=>{t.newVersion===null&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget((async()=>{this.started&&await this.Wi()})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>ag(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Hi(e).next((t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))))}))})).next((()=>this.Yi(e))).next((t=>this.isPrimary&&!t?this.Zi(e).next((()=>!1)):!!t&&this.Xi(e).next((()=>!0)))))).catch((e=>{if(wc(e))return Ye(Kl,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Ye(Kl,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable((()=>this.Qi(e))),this.isPrimary=e}))}Hi(e){return Pm(e).get(pu).next((t=>Se.resolve(this.es(t))))}ts(e){return ag(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,wb)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const s=Zs(t,Bu);return s.J().next((a=>{const l=this.ss(a,wb),c=a.filter((u=>l.indexOf(u)===-1));return Se.forEach(c,(u=>s.delete(u.clientId))).next((()=>c))}))})).catch((()=>[]));if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Wi().then((()=>this.ns())).then((()=>this.ji()))))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?Se.resolve(!0):Pm(e).get(pu).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,vb)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new Xe(Fe.FAILED_PRECONDITION,Nb);return!1}}return!(!this.networkEnabled||!this.inForeground)||ag(e).J().next((s=>this.ss(s,vb).find((a=>{if(this.clientId!==a.clientId){const l=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,u=this.networkEnabled===a.networkEnabled;if(l||c&&u)return!0}return!1}))===void 0))})).next((t=>(this.isPrimary!==t&&Ye(Kl,`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Df,Bu],(e=>{const t=new Yb(e,ii.ce);return this.Zi(t).next((()=>this.ts(t)))})),this.Ui.close(),this.Ps()}ss(e,t){return e.filter((s=>this.rs(s.updateTimeMs,t)&&!this.us(s.clientId)))}Ts(){return this.runTransaction("getActiveClients","readonly",(e=>ag(e).J().next((t=>this.ss(t,wb).map((s=>s.clientId))))))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return Sx.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new hk(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return Ex.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,s){Ye(Kl,"Starting transaction:",e);const a=t==="readonly"?"readonly":"readwrite",l=(function(m){return m===18?fP:m===17?JS:m===16?mP:m===15?q0:m===14?XS:m===13?YS:m===12?hP:m===11?KS:void ht(60245)})(this.Ni);let c;return this.Ui.runTransaction(e,a,l,(u=>(c=new Yb(u,this.ci?this.ci.next():ii.ce),t==="readwrite-primary"?this.Hi(c).next((m=>!!m||this.Yi(c))).next((m=>{if(!m)throw As(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))),new Xe(Fe.FAILED_PRECONDITION,US);return s(c)})).next((m=>this.Xi(c).next((()=>m)))):this.Is(c).next((()=>s(c)))))).then((u=>(c.raiseOnCommittedEvent(),u)))}Is(e){return Pm(e).get(pu).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,vb)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Xe(Fe.FAILED_PRECONDITION,Nb)}))}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Pm(e).put(pu,t)}static v(){return dc.v()}Zi(e){const t=Pm(e);return t.get(pu).next((s=>this.es(s)?(Ye(Kl,"Releasing primary lease."),t.delete(pu)):Se.resolve()))}rs(e,t){const s=Date.now();return!(e<s-t)&&(!(e>s)||(As(`Detected an update time that is in the future: ${e} > ${s}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi())))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){typeof this.window?.addEventListener=="function"&&(this.Bi=()=>{this.cs();const e=/(?:Version|Mobile)\/1[456]/;bS()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{const t=this.Ki?.getItem(this._s(e))!==null;return Ye(Kl,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(t){return As(Kl,"Failed to get zombied client id.",t),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){As("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Pm(r){return Zs(r,Df)}function ag(r){return Zs(r,Bu)}function lT(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cw{constructor(e,t,s,a){this.targetId=e,this.fromCache=t,this.Es=s,this.ds=a}static As(e,t){let s=Ht(),a=Ht();for(const l of t.docChanges)switch(l.type){case 0:s=s.add(l.doc.key);break;case 1:a=a.add(l.doc.key)}return new cw(e,t.fromCache,s,a)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ak{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cT{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return bS()?8:zS(Ys())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,a){const l={result:null};return this.ys(e,t).next((c=>{l.result=c})).next((()=>{if(!l.result)return this.ws(e,t,a,s).next((c=>{l.result=c}))})).next((()=>{if(l.result)return;const c=new Ak;return this.Ss(e,t,c).next((u=>{if(l.result=u,this.Vs)return this.bs(e,t,c,u.size)}))})).next((()=>l.result))}bs(e,t,s,a){return s.documentReadCount<this.fs?(vu()<=tn.DEBUG&&Ye("QueryEngine","SDK will not create cache indexes for query:",Nu(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Se.resolve()):(vu()<=tn.DEBUG&&Ye("QueryEngine","Query:",Nu(t),"scans",s.documentReadCount,"local documents and returns",a,"documents as results."),s.documentReadCount>this.gs*a?(vu()<=tn.DEBUG&&Ye("QueryEngine","The SDK decides to create cache indexes for query:",Nu(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ti(t))):Se.resolve())}ys(e,t){if(p_(t))return Se.resolve(null);let s=Ti(t);return this.indexManager.getIndexType(e,s).next((a=>a===0?null:(t.limit!==null&&a===1&&(t=$g(t,null,"F"),s=Ti(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next((l=>{const c=Ht(...l);return this.ps.getDocuments(e,c).next((u=>this.indexManager.getMinOffset(e,s).next((m=>{const p=this.Ds(t,u);return this.Cs(t,p,c,m.readTime)?this.ys(e,$g(t,null,"F")):this.vs(e,p,t,m)}))))})))))}ws(e,t,s,a){return p_(t)||a.isEqual(wt.min())?Se.resolve(null):this.ps.getDocuments(e,s).next((l=>{const c=this.Ds(t,l);return this.Cs(t,c,s,a)?Se.resolve(null):(vu()<=tn.DEBUG&&Ye("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),Nu(t)),this.vs(e,c,t,LS(a,Uu)).next((u=>u)))}))}Ds(e,t){let s=new An(wI(e));return t.forEach(((a,l)=>{kf(e,l)&&(s=s.add(l))})),s}Cs(e,t,s,a){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const l=e.limitType==="F"?t.last():t.first();return!!l&&(l.hasPendingWrites||l.version.compareTo(a)>0)}Ss(e,t,s){return vu()<=tn.DEBUG&&Ye("QueryEngine","Using full collection scan to execute query:",Nu(t)),this.ps.getDocumentsMatchingQuery(e,t,Ci.min(),s)}vs(e,t,s,a){return this.ps.getDocumentsMatchingQuery(e,s,a).next((l=>(t.forEach((c=>{l=l.insert(c.key,c)})),l)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dw="LocalStore",Dk=3e8;class Rk{constructor(e,t,s,a){this.persistence=e,this.Fs=t,this.serializer=a,this.Ms=new Qn(Ut),this.xs=new ol((l=>Nd(l)),Rf),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(s)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new oT(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function dT(r,e,t,s){return new Rk(r,e,t,s)}async function uT(r,e){const t=xt(r);return await t.persistence.runTransaction("Handle user change","readonly",(s=>{let a;return t.mutationQueue.getAllMutationBatches(s).next((l=>(a=l,t.Bs(e),t.mutationQueue.getAllMutationBatches(s)))).next((l=>{const c=[],u=[];let m=Ht();for(const p of a){c.push(p.batchId);for(const b of p.mutations)m=m.add(b.key)}for(const p of l){u.push(p.batchId);for(const b of p.mutations)m=m.add(b.key)}return t.localDocuments.getDocuments(s,m).next((p=>({Ls:p,removedBatchIds:c,addedBatchIds:u})))}))}))}function Pk(r,e){const t=xt(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(s=>{const a=e.batch.keys(),l=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,m,p,b){const w=p.batch,j=w.keys();let D=Se.resolve();return j.forEach((O=>{D=D.next((()=>b.getEntry(m,O))).next((Q=>{const z=p.docVersions.get(O);yt(z!==null,48541),Q.version.compareTo(z)<0&&(w.applyToRemoteDocument(Q,p),Q.isValidDocument()&&(Q.setReadTime(p.commitVersion),b.addEntry(Q)))}))})),D.next((()=>u.mutationQueue.removeMutationBatch(m,w)))})(t,s,e,l).next((()=>l.apply(s))).next((()=>t.mutationQueue.performConsistencyCheck(s))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(s,a,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,(function(u){let m=Ht();for(let p=0;p<u.mutationResults.length;++p)u.mutationResults[p].transformResults.length>0&&(m=m.add(u.batch.mutations[p].key));return m})(e)))).next((()=>t.localDocuments.getDocuments(s,a)))}))}function hT(r){const e=xt(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function kk(r,e){const t=xt(r),s=e.snapshotVersion;let a=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(l=>{const c=t.Ns.newChangeBuffer({trackRemovals:!0});a=t.Ms;const u=[];e.targetChanges.forEach(((b,w)=>{const j=a.get(w);if(!j)return;u.push(t.Pi.removeMatchingKeys(l,b.removedDocuments,w).next((()=>t.Pi.addMatchingKeys(l,b.addedDocuments,w))));let D=j.withSequenceNumber(l.currentSequenceNumber);e.targetMismatches.get(w)!==null?D=D.withResumeToken(Ds.EMPTY_BYTE_STRING,wt.min()).withLastLimboFreeSnapshotVersion(wt.min()):b.resumeToken.approximateByteSize()>0&&(D=D.withResumeToken(b.resumeToken,s)),a=a.insert(w,D),(function(Q,z,I){return Q.resumeToken.approximateByteSize()===0||z.snapshotVersion.toMicroseconds()-Q.snapshotVersion.toMicroseconds()>=Dk?!0:I.addedDocuments.size+I.modifiedDocuments.size+I.removedDocuments.size>0})(j,D,b)&&u.push(t.Pi.updateTargetData(l,D))}));let m=Si(),p=Ht();if(e.documentUpdates.forEach((b=>{e.resolvedLimboDocuments.has(b)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(l,b))})),u.push(Ok(l,c,e.documentUpdates).next((b=>{m=b.ks,p=b.qs}))),!s.isEqual(wt.min())){const b=t.Pi.getLastRemoteSnapshotVersion(l).next((w=>t.Pi.setTargetsMetadata(l,l.currentSequenceNumber,s)));u.push(b)}return Se.waitFor(u).next((()=>c.apply(l))).next((()=>t.localDocuments.getLocalViewOfDocuments(l,m,p))).next((()=>m))})).then((l=>(t.Ms=a,l)))}function Ok(r,e,t){let s=Ht(),a=Ht();return t.forEach((l=>s=s.add(l))),e.getEntries(r,s).next((l=>{let c=Si();return t.forEach(((u,m)=>{const p=l.get(u);m.isFoundDocument()!==p.isFoundDocument()&&(a=a.add(u)),m.isNoDocument()&&m.version.isEqual(wt.min())?(e.removeEntry(u,m.readTime),c=c.insert(u,m)):!p.isValidDocument()||m.version.compareTo(p.version)>0||m.version.compareTo(p.version)===0&&p.hasPendingWrites?(e.addEntry(m),c=c.insert(u,m)):Ye(dw,"Ignoring outdated watch update for ",u,". Current version:",p.version," Watch version:",m.version)})),{ks:c,qs:a}}))}function Mk(r,e){const t=xt(r);return t.persistence.runTransaction("Get next mutation batch","readonly",(s=>(e===void 0&&(e=pd),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e))))}function Qg(r,e){const t=xt(r);return t.persistence.runTransaction("Allocate target","readwrite",(s=>{let a;return t.Pi.getTargetData(s,e).next((l=>l?(a=l,Se.resolve(a)):t.Pi.allocateTargetId(s).next((c=>(a=new Go(e,c,"TargetPurposeListen",s.currentSequenceNumber),t.Pi.addTargetData(s,a).next((()=>a)))))))})).then((s=>{const a=t.Ms.get(s.targetId);return(a===null||s.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(s.targetId,s),t.xs.set(e,s.targetId)),s}))}async function Zu(r,e,t){const s=xt(r),a=s.Ms.get(e),l=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",l,(c=>s.persistence.referenceDelegate.removeTarget(c,a)))}catch(c){if(!wc(c))throw c;Ye(dw,`Failed to update sequence numbers for target ${e}: ${c}`)}s.Ms=s.Ms.remove(e),s.xs.delete(a.target)}function d0(r,e,t){const s=xt(r);let a=wt.min(),l=Ht();return s.persistence.runTransaction("Execute query","readwrite",(c=>(function(m,p,b){const w=xt(m),j=w.xs.get(b);return j!==void 0?Se.resolve(w.Ms.get(j)):w.Pi.getTargetData(p,b)})(s,c,Ti(e)).next((u=>{if(u)return a=u.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(c,u.targetId).next((m=>{l=m}))})).next((()=>s.Fs.getDocumentsMatchingQuery(c,e,t?a:wt.min(),t?l:Ht()))).next((u=>(pT(s,bI(e),u),{documents:u,Qs:l})))))}function mT(r,e){const t=xt(r),s=xt(t.Pi),a=t.Ms.get(e);return a?Promise.resolve(a.target):t.persistence.runTransaction("Get target data","readonly",(l=>s.At(l,e).next((c=>c?c.target:null))))}function fT(r,e){const t=xt(r),s=t.Os.get(e)||wt.min();return t.persistence.runTransaction("Get new document changes","readonly",(a=>t.Ns.getAllFromCollectionGroup(a,e,LS(s,Uu),Number.MAX_SAFE_INTEGER))).then((a=>(pT(t,e,a),a)))}function pT(r,e,t){let s=r.Os.get(e)||wt.min();t.forEach(((a,l)=>{l.readTime.compareTo(s)>0&&(s=l.readTime)})),r.Os.set(e,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gT="firestore_clients";function G_(r,e){return`${gT}_${r}_${e}`}const xT="firestore_mutations";function Q_(r,e,t){let s=`${xT}_${r}_${t}`;return e.isAuthenticated()&&(s+=`_${e.uid}`),s}const yT="firestore_targets";function jb(r,e){return`${yT}_${r}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ha="SharedClientState";class Wg{constructor(e,t,s,a){this.user=e,this.batchId=t,this.state=s,this.error=a}static Ws(e,t,s){const a=JSON.parse(s);let l,c=typeof a=="object"&&["pending","acknowledged","rejected"].indexOf(a.state)!==-1&&(a.error===void 0||typeof a.error=="object");return c&&a.error&&(c=typeof a.error.message=="string"&&typeof a.error.code=="string",c&&(l=new Xe(a.error.code,a.error.message))),c?new Wg(e,t,a.state,l):(As(Ha,`Failed to parse mutation state for ID '${t}': ${s}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ym{constructor(e,t,s){this.targetId=e,this.state=t,this.error=s}static Ws(e,t){const s=JSON.parse(t);let a,l=typeof s=="object"&&["not-current","current","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return l&&s.error&&(l=typeof s.error.message=="string"&&typeof s.error.code=="string",l&&(a=new Xe(s.error.code,s.error.message))),l?new Ym(e,s.state,a):(As(Ha,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Kg{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const s=JSON.parse(t);let a=typeof s=="object"&&s.activeTargetIds instanceof Array,l=K0();for(let c=0;a&&c<s.activeTargetIds.length;++c)a=$S(s.activeTargetIds[c]),l=l.add(s.activeTargetIds[c]);return a?new Kg(e,l):(As(Ha,`Failed to parse client data for instance '${e}': ${t}`),null)}}class uw{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new uw(t.clientId,t.onlineState):(As(Ha,`Failed to parse online state: ${e}`),null)}}class u0{constructor(){this.activeTargetIds=K0()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class _b{constructor(e,t,s,a,l){this.window=e,this.Mi=t,this.persistenceKey=s,this.Js=a,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new Qn(Ut),this.started=!1,this.Xs=[];const c=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=l,this.eo=G_(this.persistenceKey,this.Js),this.no=(function(m){return`firestore_sequence_number_${m}`})(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new u0),this.ro=new RegExp(`^${gT}_${c}_([^_]*)$`),this.io=new RegExp(`^${xT}_${c}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${yT}_${c}_(\\d+)$`),this.oo=(function(m){return`firestore_online_state_${m}`})(this.persistenceKey),this._o=(function(m){return`firestore_bundle_loaded_v2_${m}`})(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const s of e){if(s===this.Js)continue;const a=this.getItem(G_(this.persistenceKey,s));if(a){const l=Kg.Ws(s,a);l&&(this.Zs=this.Zs.insert(l.clientId,l))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const s=this.uo(t);s&&this.co(s)}for(const s of this.Xs)this.Ys(s);this.Xs=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach(((s,a)=>{a.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,s){this.ho(e,t,s),this.Po(e)}addLocalQueryTarget(e,t=!0){let s="not-current";if(this.isActiveQueryTarget(e)){const a=this.storage.getItem(jb(this.persistenceKey,e));if(a){const l=Ym.Ws(e,a);l&&(s=l.state)}}return t&&this.To.zs(e),this.ao(),s}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(jb(this.persistenceKey,e))}updateQueryState(e,t,s){this.Io(e,t,s)}handleUserChange(e,t,s){t.forEach((a=>{this.Po(a)})),this.currentUser=e,s.forEach((a=>{this.addPendingMutation(a)}))}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return Ye(Ha,"READ",e,t),t}setItem(e,t){Ye(Ha,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){Ye(Ha,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(Ye(Ha,"EVENT",t.key,t.newValue),t.key===this.eo)return void As("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable((async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const s=this.Ro(t.key);return this.Vo(s,null)}{const s=this.mo(t.key,t.newValue);if(s)return this.Vo(s.clientId,s)}}else if(this.io.test(t.key)){if(t.newValue!==null){const s=this.fo(t.key,t.newValue);if(s)return this.po(s)}}else if(this.so.test(t.key)){if(t.newValue!==null){const s=this.yo(t.key,t.newValue);if(s)return this.wo(s)}}else if(t.key===this.oo){if(t.newValue!==null){const s=this.uo(t.newValue);if(s)return this.co(s)}}else if(t.key===this.no){const s=(function(l){let c=ii.ce;if(l!=null)try{const u=JSON.parse(l);yt(typeof u=="number",30636,{So:l}),c=u}catch(u){As(Ha,"Failed to read sequence number from WebStorage",u)}return c})(t.newValue);s!==ii.ce&&this.sequenceNumberHandler(s)}else if(t.key===this._o){const s=this.bo(t.newValue);await Promise.all(s.map((a=>this.syncEngine.Do(a))))}}}else this.Xs.push(t)}))}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,s){const a=new Wg(this.currentUser,e,t,s),l=Q_(this.persistenceKey,this.currentUser,e);this.setItem(l,a.Gs())}Po(e){const t=Q_(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,s){const a=jb(this.persistenceKey,e),l=new Ym(e,t,s);this.setItem(a,l.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const s=this.Ro(e);return Kg.Ws(s,t)}fo(e,t){const s=this.io.exec(e),a=Number(s[1]),l=s[2]!==void 0?s[2]:null;return Wg.Ws(new lr(l),a,t)}yo(e,t){const s=this.so.exec(e),a=Number(s[1]);return Ym.Ws(a,t)}uo(e){return uw.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);Ye(Ha,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const s=t?this.Zs.insert(e,t):this.Zs.remove(e),a=this.lo(this.Zs),l=this.lo(s),c=[],u=[];return l.forEach((m=>{a.has(m)||c.push(m)})),a.forEach((m=>{l.has(m)||u.push(m)})),this.syncEngine.Fo(c,u).then((()=>{this.Zs=s}))}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=K0();return e.forEach(((s,a)=>{t=t.unionWith(a.activeTargetIds)})),t}}class bT{constructor(){this.Mo=new u0,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,s){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new u0,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lk{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W_="ConnectivityMonitor";class K_{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Ye(W_,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Ye(W_,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let og=null;function h0(){return og===null?og=(function(){return 268435456+Math.round(2147483648*Math.random())})():og++,"0x"+og.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eb="RestConnection",Fk={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Uk{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),a=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${s}/databases/${a}`,this.Wo=this.databaseId.database===hf?`project_id=${s}`:`project_id=${s}&database_id=${a}`}Go(e,t,s,a,l){const c=h0(),u=this.zo(e,t.toUriEncodedString());Ye(Eb,`Sending RPC '${e}' ${c}:`,u,s);const m={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(m,a,l);const{host:p}=new URL(u),b=al(p);return this.Jo(e,u,m,s,b).then((w=>(Ye(Eb,`Received RPC '${e}' ${c}: `,w),w)),(w=>{throw Lu(Eb,`RPC '${e}' ${c} failed with error: `,w,"url: ",u,"request:",s),w}))}Ho(e,t,s,a,l,c){return this.Go(e,t,s,a,l)}jo(e,t,s){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+oh})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((a,l)=>e[l]=a)),s&&s.headers.forEach(((a,l)=>e[l]=a))}zo(e,t){const s=Fk[e];return`${this.Uo}/v1/${t}:${s}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vk{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rr="WebChannelConnection";class zk extends Uk{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,s,a,l){const c=h0();return new Promise(((u,m)=>{const p=new IS;p.setWithCredentials(!0),p.listenOnce(TS.COMPLETE,(()=>{try{switch(p.getLastErrorCode()){case fg.NO_ERROR:const w=p.getResponseJson();Ye(Rr,`XHR for RPC '${e}' ${c} received:`,JSON.stringify(w)),u(w);break;case fg.TIMEOUT:Ye(Rr,`RPC '${e}' ${c} timed out`),m(new Xe(Fe.DEADLINE_EXCEEDED,"Request time out"));break;case fg.HTTP_ERROR:const j=p.getStatus();if(Ye(Rr,`RPC '${e}' ${c} failed with status:`,j,"response text:",p.getResponseText()),j>0){let D=p.getResponseJson();Array.isArray(D)&&(D=D[0]);const O=D?.error;if(O&&O.status&&O.message){const Q=(function(I){const ee=I.toLowerCase().replace(/_/g,"-");return Object.values(Fe).indexOf(ee)>=0?ee:Fe.UNKNOWN})(O.status);m(new Xe(Q,O.message))}else m(new Xe(Fe.UNKNOWN,"Server responded with status "+p.getStatus()))}else m(new Xe(Fe.UNAVAILABLE,"Connection failed."));break;default:ht(9055,{l_:e,streamId:c,h_:p.getLastErrorCode(),P_:p.getLastError()})}}finally{Ye(Rr,`RPC '${e}' ${c} completed.`)}}));const b=JSON.stringify(a);Ye(Rr,`RPC '${e}' ${c} sending request:`,a),p.send(t,"POST",b,s,15)}))}T_(e,t,s){const a=h0(),l=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],c=DS(),u=AS(),m={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},p=this.longPollingOptions.timeoutSeconds;p!==void 0&&(m.longPollingTimeout=Math.round(1e3*p)),this.useFetchStreams&&(m.useFetchStreams=!0),this.jo(m.initMessageHeaders,t,s),m.encodeInitMessageHeaders=!0;const b=l.join("");Ye(Rr,`Creating RPC '${e}' stream ${a}: ${b}`,m);const w=c.createWebChannel(b,m);this.I_(w);let j=!1,D=!1;const O=new Vk({Yo:z=>{D?Ye(Rr,`Not sending because RPC '${e}' stream ${a} is closed:`,z):(j||(Ye(Rr,`Opening RPC '${e}' stream ${a} transport.`),w.open(),j=!0),Ye(Rr,`RPC '${e}' stream ${a} sending:`,z),w.send(z))},Zo:()=>w.close()}),Q=(z,I,ee)=>{z.listen(I,(J=>{try{ee(J)}catch(oe){setTimeout((()=>{throw oe}),0)}}))};return Q(w,Lm.EventType.OPEN,(()=>{D||(Ye(Rr,`RPC '${e}' stream ${a} transport opened.`),O.o_())})),Q(w,Lm.EventType.CLOSE,(()=>{D||(D=!0,Ye(Rr,`RPC '${e}' stream ${a} transport closed`),O.a_(),this.E_(w))})),Q(w,Lm.EventType.ERROR,(z=>{D||(D=!0,Lu(Rr,`RPC '${e}' stream ${a} transport errored. Name:`,z.name,"Message:",z.message),O.a_(new Xe(Fe.UNAVAILABLE,"The operation could not be completed")))})),Q(w,Lm.EventType.MESSAGE,(z=>{if(!D){const I=z.data[0];yt(!!I,16349);const ee=I,J=ee?.error||ee[0]?.error;if(J){Ye(Rr,`RPC '${e}' stream ${a} received error:`,J);const oe=J.status;let Y=(function(H){const k=Fs[H];if(k!==void 0)return PI(k)})(oe),be=J.message;Y===void 0&&(Y=Fe.INTERNAL,be="Unknown error status: "+oe+" with message "+J.message),D=!0,O.a_(new Xe(Y,be)),w.close()}else Ye(Rr,`RPC '${e}' stream ${a} received:`,I),O.u_(I)}})),Q(u,CS.STAT_EVENT,(z=>{z.stat===qb.PROXY?Ye(Rr,`RPC '${e}' stream ${a} detected buffering proxy`):z.stat===qb.NOPROXY&&Ye(Rr,`RPC '${e}' stream ${a} detected no buffering proxy`)})),setTimeout((()=>{O.__()}),0),O}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wT(){return typeof window<"u"?window:null}function _g(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tx(r){return new GP(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hw{constructor(e,t,s=1e3,a=1.5,l=6e4){this.Mi=e,this.timerId=t,this.d_=s,this.A_=a,this.R_=l,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),a=Math.max(0,t-s);a>0&&Ye("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,a,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y_="PersistentStream";class vT{constructor(e,t,s,a,l,c,u,m){this.Mi=e,this.S_=s,this.b_=a,this.connection=l,this.authCredentialsProvider=c,this.appCheckCredentialsProvider=u,this.listener=m,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new hw(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===Fe.RESOURCE_EXHAUSTED?(As(t.toString()),As("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===Fe.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([s,a])=>{this.D_===t&&this.G_(s,a)}),(s=>{e((()=>{const a=new Xe(Fe.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(a)}))}))}G_(e,t){const s=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{s((()=>this.listener.Xo()))})),this.stream.t_((()=>{s((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((a=>{s((()=>this.z_(a)))})),this.stream.onMessage((a=>{s((()=>++this.F_==1?this.J_(a):this.onNext(a)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Ye(Y_,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(Ye(Y_,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class $k extends vT{constructor(e,t,s,a,l,c){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,a,c),this.serializer=l}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=YP(this.serializer,e),s=(function(l){if(!("targetChange"in l))return wt.min();const c=l.targetChange;return c.targetIds&&c.targetIds.length?wt.min():c.readTime?cr(c.readTime):wt.min()})(e);return this.listener.H_(t,s)}Y_(e){const t={};t.database=i0(this.serializer),t.addTarget=(function(l,c){let u;const m=c.target;if(u=Vg(m)?{documents:zI(l,m)}:{query:$I(l,m).ft},u.targetId=c.targetId,c.resumeToken.approximateByteSize()>0){u.resumeToken=MI(l,c.resumeToken);const p=s0(l,c.expectedCount);p!==null&&(u.expectedCount=p)}else if(c.snapshotVersion.compareTo(wt.min())>0){u.readTime=Ju(l,c.snapshotVersion.toTimestamp());const p=s0(l,c.expectedCount);p!==null&&(u.expectedCount=p)}return u})(this.serializer,e);const s=JP(this.serializer,e);s&&(t.labels=s),this.q_(t)}Z_(e){const t={};t.database=i0(this.serializer),t.removeTarget=e,this.q_(t)}}class Bk extends vT{constructor(e,t,s,a,l,c){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,a,c),this.serializer=l}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return yt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,yt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){yt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=XP(e.writeResults,e.commitTime),s=cr(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=i0(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((s=>yf(this.serializer,s)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qk{}class Hk extends qk{constructor(e,t,s,a){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=a,this.ia=!1}sa(){if(this.ia)throw new Xe(Fe.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,s,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,c])=>this.connection.Go(e,r0(t,s),a,l,c))).catch((l=>{throw l.name==="FirebaseError"?(l.code===Fe.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Xe(Fe.UNKNOWN,l.toString())}))}Ho(e,t,s,a,l){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([c,u])=>this.connection.Ho(e,r0(t,s),a,c,u,l))).catch((c=>{throw c.name==="FirebaseError"?(c.code===Fe.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new Xe(Fe.UNKNOWN,c.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class Gk{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(As(t),this.aa=!1):Ye("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sd="RemoteStore";class Qk{constructor(e,t,s,a,l){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=l,this.Aa.Oo((c=>{s.enqueueAndForget((async()=>{Ad(this)&&(Ye(Sd,"Restarting streams for network reachability change."),await(async function(m){const p=xt(m);p.Ea.add(4),await Lf(p),p.Ra.set("Unknown"),p.Ea.delete(4),await Cx(p)})(this))}))})),this.Ra=new Gk(s,a)}}async function Cx(r){if(Ad(r))for(const e of r.da)await e(!0)}async function Lf(r){for(const e of r.da)await e(!1)}function Ax(r,e){const t=xt(r);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),pw(t)?fw(t):hh(t).O_()&&mw(t,e))}function eh(r,e){const t=xt(r),s=hh(t);t.Ia.delete(e),s.O_()&&NT(t,e),t.Ia.size===0&&(s.O_()?s.L_():Ad(t)&&t.Ra.set("Unknown"))}function mw(r,e){if(r.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(wt.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}hh(r).Y_(e)}function NT(r,e){r.Va.Ue(e),hh(r).Z_(e)}function fw(r){r.Va=new $P({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),At:e=>r.Ia.get(e)||null,ht:()=>r.datastore.serializer.databaseId}),hh(r).start(),r.Ra.ua()}function pw(r){return Ad(r)&&!hh(r).x_()&&r.Ia.size>0}function Ad(r){return xt(r).Ea.size===0}function jT(r){r.Va=void 0}async function Wk(r){r.Ra.set("Online")}async function Kk(r){r.Ia.forEach(((e,t)=>{mw(r,e)}))}async function Yk(r,e){jT(r),pw(r)?(r.Ra.ha(e),fw(r)):r.Ra.set("Unknown")}async function Xk(r,e,t){if(r.Ra.set("Online"),e instanceof OI&&e.state===2&&e.cause)try{await(async function(a,l){const c=l.cause;for(const u of l.targetIds)a.Ia.has(u)&&(await a.remoteSyncer.rejectListen(u,c),a.Ia.delete(u),a.Va.removeTarget(u))})(r,e)}catch(s){Ye(Sd,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await Yg(r,s)}else if(e instanceof Ng?r.Va.Ze(e):e instanceof kI?r.Va.st(e):r.Va.tt(e),!t.isEqual(wt.min()))try{const s=await hT(r.localStore);t.compareTo(s)>=0&&await(function(l,c){const u=l.Va.Tt(c);return u.targetChanges.forEach(((m,p)=>{if(m.resumeToken.approximateByteSize()>0){const b=l.Ia.get(p);b&&l.Ia.set(p,b.withResumeToken(m.resumeToken,c))}})),u.targetMismatches.forEach(((m,p)=>{const b=l.Ia.get(m);if(!b)return;l.Ia.set(m,b.withResumeToken(Ds.EMPTY_BYTE_STRING,b.snapshotVersion)),NT(l,m);const w=new Go(b.target,m,p,b.sequenceNumber);mw(l,w)})),l.remoteSyncer.applyRemoteEvent(u)})(r,t)}catch(s){Ye(Sd,"Failed to raise snapshot:",s),await Yg(r,s)}}async function Yg(r,e,t){if(!wc(e))throw e;r.Ea.add(1),await Lf(r),r.Ra.set("Offline"),t||(t=()=>hT(r.localStore)),r.asyncQueue.enqueueRetryable((async()=>{Ye(Sd,"Retrying IndexedDB access"),await t(),r.Ea.delete(1),await Cx(r)}))}function _T(r,e){return e().catch((t=>Yg(r,t,e)))}async function uh(r){const e=xt(r),t=xc(e);let s=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:pd;for(;Jk(e);)try{const a=await Mk(e.localStore,s);if(a===null){e.Ta.length===0&&t.L_();break}s=a.batchId,Zk(e,a)}catch(a){await Yg(e,a)}ET(e)&&ST(e)}function Jk(r){return Ad(r)&&r.Ta.length<10}function Zk(r,e){r.Ta.push(e);const t=xc(r);t.O_()&&t.X_&&t.ea(e.mutations)}function ET(r){return Ad(r)&&!xc(r).x_()&&r.Ta.length>0}function ST(r){xc(r).start()}async function eO(r){xc(r).ra()}async function tO(r){const e=xc(r);for(const t of r.Ta)e.ea(t.mutations)}async function nO(r,e,t){const s=r.Ta.shift(),a=ew.from(s,e,t);await _T(r,(()=>r.remoteSyncer.applySuccessfulWrite(a))),await uh(r)}async function sO(r,e){e&&xc(r).X_&&await(async function(s,a){if((function(c){return RI(c)&&c!==Fe.ABORTED})(a.code)){const l=s.Ta.shift();xc(s).B_(),await _T(s,(()=>s.remoteSyncer.rejectFailedWrite(l.batchId,a))),await uh(s)}})(r,e),ET(r)&&ST(r)}async function X_(r,e){const t=xt(r);t.asyncQueue.verifyOperationInProgress(),Ye(Sd,"RemoteStore received new credentials");const s=Ad(t);t.Ea.add(3),await Lf(t),s&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Cx(t)}async function m0(r,e){const t=xt(r);e?(t.Ea.delete(2),await Cx(t)):e||(t.Ea.add(2),await Lf(t),t.Ra.set("Unknown"))}function hh(r){return r.ma||(r.ma=(function(t,s,a){const l=xt(t);return l.sa(),new $k(s,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,a)})(r.datastore,r.asyncQueue,{Xo:Wk.bind(null,r),t_:Kk.bind(null,r),r_:Yk.bind(null,r),H_:Xk.bind(null,r)}),r.da.push((async e=>{e?(r.ma.B_(),pw(r)?fw(r):r.Ra.set("Unknown")):(await r.ma.stop(),jT(r))}))),r.ma}function xc(r){return r.fa||(r.fa=(function(t,s,a){const l=xt(t);return l.sa(),new Bk(s,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,a)})(r.datastore,r.asyncQueue,{Xo:()=>Promise.resolve(),t_:eO.bind(null,r),r_:sO.bind(null,r),ta:tO.bind(null,r),na:nO.bind(null,r)}),r.da.push((async e=>{e?(r.fa.B_(),await uh(r)):(await r.fa.stop(),r.Ta.length>0&&(Ye(Sd,`Stopping write stream with ${r.Ta.length} pending writes`),r.Ta=[]))}))),r.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gw{constructor(e,t,s,a,l){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=a,this.removalCallback=l,this.deferred=new xa,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((c=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,a,l){const c=Date.now()+s,u=new gw(e,t,c,a,l);return u.start(s),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Xe(Fe.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function xw(r,e){if(As("AsyncQueue",`${e}: ${r}`),wc(r))return new Xe(Fe.UNAVAILABLE,`${e}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Au{static emptySet(e){return new Au(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||at.comparator(t.key,s.key):(t,s)=>at.comparator(t.key,s.key),this.keyedMap=Fm(),this.sortedSet=new Qn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,s)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Au)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const a=t.getNext().key,l=s.getNext().key;if(!a.isEqual(l))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new Au;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J_{constructor(){this.ga=new Qn(at.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):ht(63341,{Rt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,s)=>{e.push(s)})),e}}class th{constructor(e,t,s,a,l,c,u,m,p){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=a,this.mutatedKeys=l,this.fromCache=c,this.syncStateChanged=u,this.excludesMetadataChanges=m,this.hasCachedResults=p}static fromInitialDocuments(e,t,s,a,l){const c=[];return t.forEach((u=>{c.push({type:0,doc:u})})),new th(e,t,Au.emptySet(t),c,s,a,!0,!1,l)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Nx(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let a=0;a<t.length;a++)if(t[a].type!==s[a].type||!t[a].doc.isEqual(s[a].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rO{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class iO{constructor(){this.queries=Z_(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const a=xt(t),l=a.queries;a.queries=Z_(),l.forEach(((c,u)=>{for(const m of u.Sa)m.onError(s)}))})(this,new Xe(Fe.ABORTED,"Firestore shutting down"))}}function Z_(){return new ol((r=>yI(r)),Nx)}async function yw(r,e){const t=xt(r);let s=3;const a=e.query;let l=t.queries.get(a);l?!l.ba()&&e.Da()&&(s=2):(l=new rO,s=e.Da()?0:1);try{switch(s){case 0:l.wa=await t.onListen(a,!0);break;case 1:l.wa=await t.onListen(a,!1);break;case 2:await t.onFirstRemoteStoreListen(a)}}catch(c){const u=xw(c,`Initialization of query '${Nu(e.query)}' failed`);return void e.onError(u)}t.queries.set(a,l),l.Sa.push(e),e.va(t.onlineState),l.wa&&e.Fa(l.wa)&&ww(t)}async function bw(r,e){const t=xt(r),s=e.query;let a=3;const l=t.queries.get(s);if(l){const c=l.Sa.indexOf(e);c>=0&&(l.Sa.splice(c,1),l.Sa.length===0?a=e.Da()?0:1:!l.ba()&&e.Da()&&(a=2))}switch(a){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function aO(r,e){const t=xt(r);let s=!1;for(const a of e){const l=a.query,c=t.queries.get(l);if(c){for(const u of c.Sa)u.Fa(a)&&(s=!0);c.wa=a}}s&&ww(t)}function oO(r,e,t){const s=xt(r),a=s.queries.get(e);if(a)for(const l of a.Sa)l.onError(t);s.queries.delete(e)}function ww(r){r.Ca.forEach((e=>{e.next()}))}var f0,eE;(eE=f0||(f0={})).Ma="default",eE.Cache="cache";class vw{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const a of e.docChanges)a.type!==3&&s.push(a);e=new th(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.qa||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=th.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==f0.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IT{constructor(e){this.key=e}}class TT{constructor(e){this.key=e}}class lO{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Ht(),this.mutatedKeys=Ht(),this.eu=wI(e),this.tu=new Au(this.eu)}get nu(){return this.Ya}ru(e,t){const s=t?t.iu:new J_,a=t?t.tu:this.tu;let l=t?t.mutatedKeys:this.mutatedKeys,c=a,u=!1;const m=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,p=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal(((b,w)=>{const j=a.get(b),D=kf(this.query,w)?w:null,O=!!j&&this.mutatedKeys.has(j.key),Q=!!D&&(D.hasLocalMutations||this.mutatedKeys.has(D.key)&&D.hasCommittedMutations);let z=!1;j&&D?j.data.isEqual(D.data)?O!==Q&&(s.track({type:3,doc:D}),z=!0):this.su(j,D)||(s.track({type:2,doc:D}),z=!0,(m&&this.eu(D,m)>0||p&&this.eu(D,p)<0)&&(u=!0)):!j&&D?(s.track({type:0,doc:D}),z=!0):j&&!D&&(s.track({type:1,doc:j}),z=!0,(m||p)&&(u=!0)),z&&(D?(c=c.add(D),l=Q?l.add(b):l.delete(b)):(c=c.delete(b),l=l.delete(b)))})),this.query.limit!==null)for(;c.size>this.query.limit;){const b=this.query.limitType==="F"?c.last():c.first();c=c.delete(b.key),l=l.delete(b.key),s.track({type:1,doc:b})}return{tu:c,iu:s,Cs:u,mutatedKeys:l}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,a){const l=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const c=e.iu.ya();c.sort(((b,w)=>(function(D,O){const Q=z=>{switch(z){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ht(20277,{Rt:z})}};return Q(D)-Q(O)})(b.type,w.type)||this.eu(b.doc,w.doc))),this.ou(s),a=a??!1;const u=t&&!a?this._u():[],m=this.Xa.size===0&&this.current&&!a?1:0,p=m!==this.Za;return this.Za=m,c.length!==0||p?{snapshot:new th(this.query,e.tu,l,c,e.mutatedKeys,m===0,p,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new J_,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Ht(),this.tu.forEach((s=>{this.uu(s.key)&&(this.Xa=this.Xa.add(s.key))}));const t=[];return e.forEach((s=>{this.Xa.has(s)||t.push(new TT(s))})),this.Xa.forEach((s=>{e.has(s)||t.push(new IT(s))})),t}cu(e){this.Ya=e.Qs,this.Xa=Ht();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return th.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const mh="SyncEngine";class cO{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class dO{constructor(e){this.key=e,this.hu=!1}}class uO{constructor(e,t,s,a,l,c){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=a,this.currentUser=l,this.maxConcurrentLimboResolutions=c,this.Pu={},this.Tu=new ol((u=>yI(u)),Nx),this.Iu=new Map,this.Eu=new Set,this.du=new Qn(at.comparator),this.Au=new Map,this.Ru=new aw,this.Vu={},this.mu=new Map,this.fu=Ed.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function hO(r,e,t=!0){const s=Dx(r);let a;const l=s.Tu.get(e);return l?(s.sharedClientState.addLocalQueryTarget(l.targetId),a=l.view.lu()):a=await CT(s,e,t,!0),a}async function mO(r,e){const t=Dx(r);await CT(t,e,!0,!1)}async function CT(r,e,t,s){const a=await Qg(r.localStore,Ti(e)),l=a.targetId,c=r.sharedClientState.addLocalQueryTarget(l,t);let u;return s&&(u=await Nw(r,e,l,c==="current",a.resumeToken)),r.isPrimaryClient&&t&&Ax(r.remoteStore,a),u}async function Nw(r,e,t,s,a){r.pu=(w,j,D)=>(async function(Q,z,I,ee){let J=z.view.ru(I);J.Cs&&(J=await d0(Q.localStore,z.query,!1).then((({documents:M})=>z.view.ru(M,J))));const oe=ee&&ee.targetChanges.get(z.targetId),Y=ee&&ee.targetMismatches.get(z.targetId)!=null,be=z.view.applyChanges(J,Q.isPrimaryClient,oe,Y);return p0(Q,z.targetId,be.au),be.snapshot})(r,w,j,D);const l=await d0(r.localStore,e,!0),c=new lO(e,l.Qs),u=c.ru(l.documents),m=Mf.createSynthesizedTargetChangeForCurrentChange(t,s&&r.onlineState!=="Offline",a),p=c.applyChanges(u,r.isPrimaryClient,m);p0(r,t,p.au);const b=new cO(e,t,c);return r.Tu.set(e,b),r.Iu.has(t)?r.Iu.get(t).push(e):r.Iu.set(t,[e]),p.snapshot}async function fO(r,e,t){const s=xt(r),a=s.Tu.get(e),l=s.Iu.get(a.targetId);if(l.length>1)return s.Iu.set(a.targetId,l.filter((c=>!Nx(c,e)))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(a.targetId),s.sharedClientState.isActiveQueryTarget(a.targetId)||await Zu(s.localStore,a.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(a.targetId),t&&eh(s.remoteStore,a.targetId),nh(s,a.targetId)})).catch(bc)):(nh(s,a.targetId),await Zu(s.localStore,a.targetId,!0))}async function pO(r,e){const t=xt(r),s=t.Tu.get(e),a=t.Iu.get(s.targetId);t.isPrimaryClient&&a.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),eh(t.remoteStore,s.targetId))}async function gO(r,e,t){const s=Sw(r);try{const a=await(function(c,u){const m=xt(c),p=_n.now(),b=u.reduce(((D,O)=>D.add(O.key)),Ht());let w,j;return m.persistence.runTransaction("Locally write mutations","readwrite",(D=>{let O=Si(),Q=Ht();return m.Ns.getEntries(D,b).next((z=>{O=z,O.forEach(((I,ee)=>{ee.isValidDocument()||(Q=Q.add(I))}))})).next((()=>m.localDocuments.getOverlayedDocuments(D,O))).next((z=>{w=z;const I=[];for(const ee of u){const J=FP(ee,w.get(ee.key).overlayedDocument);J!=null&&I.push(new ll(ee.key,J,lI(J.value.mapValue),rs.exists(!0)))}return m.mutationQueue.addMutationBatch(D,p,I,u)})).next((z=>{j=z;const I=z.applyToLocalDocumentSet(w,Q);return m.documentOverlayCache.saveOverlays(D,z.batchId,I)}))})).then((()=>({batchId:j.batchId,changes:NI(w)})))})(s.localStore,e);s.sharedClientState.addPendingMutation(a.batchId),(function(c,u,m){let p=c.Vu[c.currentUser.toKey()];p||(p=new Qn(Ut)),p=p.insert(u,m),c.Vu[c.currentUser.toKey()]=p})(s,a.batchId,t),await Nc(s,a.changes),await uh(s.remoteStore)}catch(a){const l=xw(a,"Failed to persist write");t.reject(l)}}async function AT(r,e){const t=xt(r);try{const s=await kk(t.localStore,e);e.targetChanges.forEach(((a,l)=>{const c=t.Au.get(l);c&&(yt(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1,22616),a.addedDocuments.size>0?c.hu=!0:a.modifiedDocuments.size>0?yt(c.hu,14607):a.removedDocuments.size>0&&(yt(c.hu,42227),c.hu=!1))})),await Nc(t,s,e)}catch(s){await bc(s)}}function tE(r,e,t){const s=xt(r);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const a=[];s.Tu.forEach(((l,c)=>{const u=c.view.va(e);u.snapshot&&a.push(u.snapshot)})),(function(c,u){const m=xt(c);m.onlineState=u;let p=!1;m.queries.forEach(((b,w)=>{for(const j of w.Sa)j.va(u)&&(p=!0)})),p&&ww(m)})(s.eventManager,e),a.length&&s.Pu.H_(a),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function xO(r,e,t){const s=xt(r);s.sharedClientState.updateQueryState(e,"rejected",t);const a=s.Au.get(e),l=a&&a.key;if(l){let c=new Qn(at.comparator);c=c.insert(l,ss.newNoDocument(l,wt.min()));const u=Ht().add(l),m=new Of(wt.min(),new Map,new Qn(Ut),c,u);await AT(s,m),s.du=s.du.remove(l),s.Au.delete(e),Ew(s)}else await Zu(s.localStore,e,!1).then((()=>nh(s,e,t))).catch(bc)}async function yO(r,e){const t=xt(r),s=e.batch.batchId;try{const a=await Pk(t.localStore,e);_w(t,s,null),jw(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),await Nc(t,a)}catch(a){await bc(a)}}async function bO(r,e,t){const s=xt(r);try{const a=await(function(c,u){const m=xt(c);return m.persistence.runTransaction("Reject batch","readwrite-primary",(p=>{let b;return m.mutationQueue.lookupMutationBatch(p,u).next((w=>(yt(w!==null,37113),b=w.keys(),m.mutationQueue.removeMutationBatch(p,w)))).next((()=>m.mutationQueue.performConsistencyCheck(p))).next((()=>m.documentOverlayCache.removeOverlaysForBatchId(p,b,u))).next((()=>m.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(p,b))).next((()=>m.localDocuments.getDocuments(p,b)))}))})(s.localStore,e);_w(s,e,t),jw(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),await Nc(s,a)}catch(a){await bc(a)}}function jw(r,e){(r.mu.get(e)||[]).forEach((t=>{t.resolve()})),r.mu.delete(e)}function _w(r,e,t){const s=xt(r);let a=s.Vu[s.currentUser.toKey()];if(a){const l=a.get(e);l&&(t?l.reject(t):l.resolve(),a=a.remove(e)),s.Vu[s.currentUser.toKey()]=a}}function nh(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const s of r.Iu.get(e))r.Tu.delete(s),t&&r.Pu.yu(s,t);r.Iu.delete(e),r.isPrimaryClient&&r.Ru.jr(e).forEach((s=>{r.Ru.containsKey(s)||DT(r,s)}))}function DT(r,e){r.Eu.delete(e.path.canonicalString());const t=r.du.get(e);t!==null&&(eh(r.remoteStore,t),r.du=r.du.remove(e),r.Au.delete(t),Ew(r))}function p0(r,e,t){for(const s of t)s instanceof IT?(r.Ru.addReference(s.key,e),wO(r,s)):s instanceof TT?(Ye(mh,"Document no longer in limbo: "+s.key),r.Ru.removeReference(s.key,e),r.Ru.containsKey(s.key)||DT(r,s.key)):ht(19791,{wu:s})}function wO(r,e){const t=e.key,s=t.path.canonicalString();r.du.get(t)||r.Eu.has(s)||(Ye(mh,"New document in limbo: "+t),r.Eu.add(s),Ew(r))}function Ew(r){for(;r.Eu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){const e=r.Eu.values().next().value;r.Eu.delete(e);const t=new at(gn.fromString(e)),s=r.fu.next();r.Au.set(s,new dO(t)),r.du=r.du.insert(t,s),Ax(r.remoteStore,new Go(Ti(Pf(t.path)),s,"TargetPurposeLimboResolution",ii.ce))}}async function Nc(r,e,t){const s=xt(r),a=[],l=[],c=[];s.Tu.isEmpty()||(s.Tu.forEach(((u,m)=>{c.push(s.pu(m,e,t).then((p=>{if((p||t)&&s.isPrimaryClient){const b=p?!p.fromCache:t?.targetChanges.get(m.targetId)?.current;s.sharedClientState.updateQueryState(m.targetId,b?"current":"not-current")}if(p){a.push(p);const b=cw.As(m.targetId,p);l.push(b)}})))})),await Promise.all(c),s.Pu.H_(a),await(async function(m,p){const b=xt(m);try{await b.persistence.runTransaction("notifyLocalViewChanges","readwrite",(w=>Se.forEach(p,(j=>Se.forEach(j.Es,(D=>b.persistence.referenceDelegate.addReference(w,j.targetId,D))).next((()=>Se.forEach(j.ds,(D=>b.persistence.referenceDelegate.removeReference(w,j.targetId,D)))))))))}catch(w){if(!wc(w))throw w;Ye(dw,"Failed to update sequence numbers: "+w)}for(const w of p){const j=w.targetId;if(!w.fromCache){const D=b.Ms.get(j),O=D.snapshotVersion,Q=D.withLastLimboFreeSnapshotVersion(O);b.Ms=b.Ms.insert(j,Q)}}})(s.localStore,l))}async function vO(r,e){const t=xt(r);if(!t.currentUser.isEqual(e)){Ye(mh,"User change. New user:",e.toKey());const s=await uT(t.localStore,e);t.currentUser=e,(function(l,c){l.mu.forEach((u=>{u.forEach((m=>{m.reject(new Xe(Fe.CANCELLED,c))}))})),l.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await Nc(t,s.Ls)}}function NO(r,e){const t=xt(r),s=t.Au.get(e);if(s&&s.hu)return Ht().add(s.key);{let a=Ht();const l=t.Iu.get(e);if(!l)return a;for(const c of l){const u=t.Tu.get(c);a=a.unionWith(u.view.nu)}return a}}async function jO(r,e){const t=xt(r),s=await d0(t.localStore,e.query,!0),a=e.view.cu(s);return t.isPrimaryClient&&p0(t,e.targetId,a.au),a}async function _O(r,e){const t=xt(r);return fT(t.localStore,e).then((s=>Nc(t,s)))}async function EO(r,e,t,s){const a=xt(r),l=await(function(u,m){const p=xt(u),b=xt(p.mutationQueue);return p.persistence.runTransaction("Lookup mutation documents","readonly",(w=>b.er(w,m).next((j=>j?p.localDocuments.getDocuments(w,j):Se.resolve(null)))))})(a.localStore,e);l!==null?(t==="pending"?await uh(a.remoteStore):t==="acknowledged"||t==="rejected"?(_w(a,e,s||null),jw(a,e),(function(u,m){xt(xt(u).mutationQueue).ir(m)})(a.localStore,e)):ht(6720,"Unknown batchState",{Su:t}),await Nc(a,l)):Ye(mh,"Cannot apply mutation batch with id: "+e)}async function SO(r,e){const t=xt(r);if(Dx(t),Sw(t),e===!0&&t.gu!==!0){const s=t.sharedClientState.getAllActiveQueryTargets(),a=await nE(t,s.toArray());t.gu=!0,await m0(t.remoteStore,!0);for(const l of a)Ax(t.remoteStore,l)}else if(e===!1&&t.gu!==!1){const s=[];let a=Promise.resolve();t.Iu.forEach(((l,c)=>{t.sharedClientState.isLocalQueryTarget(c)?s.push(c):a=a.then((()=>(nh(t,c),Zu(t.localStore,c,!0)))),eh(t.remoteStore,c)})),await a,await nE(t,s),(function(c){const u=xt(c);u.Au.forEach(((m,p)=>{eh(u.remoteStore,p)})),u.Ru.Jr(),u.Au=new Map,u.du=new Qn(at.comparator)})(t),t.gu=!1,await m0(t.remoteStore,!1)}}async function nE(r,e,t){const s=xt(r),a=[],l=[];for(const c of e){let u;const m=s.Iu.get(c);if(m&&m.length!==0){u=await Qg(s.localStore,Ti(m[0]));for(const p of m){const b=s.Tu.get(p),w=await jO(s,b);w.snapshot&&l.push(w.snapshot)}}else{const p=await mT(s.localStore,c);u=await Qg(s.localStore,p),await Nw(s,RT(p),c,!1,u.resumeToken)}a.push(u)}return s.Pu.H_(l),a}function RT(r){return gI(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function IO(r){return(function(t){return xt(xt(t).persistence).Ts()})(xt(r).localStore)}async function TO(r,e,t,s){const a=xt(r);if(a.gu)return void Ye(mh,"Ignoring unexpected query state notification.");const l=a.Iu.get(e);if(l&&l.length>0)switch(t){case"current":case"not-current":{const c=await fT(a.localStore,bI(l[0])),u=Of.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ds.EMPTY_BYTE_STRING);await Nc(a,c,u);break}case"rejected":await Zu(a.localStore,e,!0),nh(a,e,s);break;default:ht(64155,t)}}async function CO(r,e,t){const s=Dx(r);if(s.gu){for(const a of e){if(s.Iu.has(a)&&s.sharedClientState.isActiveQueryTarget(a)){Ye(mh,"Adding an already active target "+a);continue}const l=await mT(s.localStore,a),c=await Qg(s.localStore,l);await Nw(s,RT(l),c.targetId,!1,c.resumeToken),Ax(s.remoteStore,c)}for(const a of t)s.Iu.has(a)&&await Zu(s.localStore,a,!1).then((()=>{eh(s.remoteStore,a),nh(s,a)})).catch(bc)}}function Dx(r){const e=xt(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=AT.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=NO.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=xO.bind(null,e),e.Pu.H_=aO.bind(null,e.eventManager),e.Pu.yu=oO.bind(null,e.eventManager),e}function Sw(r){const e=xt(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=yO.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=bO.bind(null,e),e}class bf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Tx(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return dT(this.persistence,new cT,e.initialUser,this.serializer)}Cu(e){return new ow(Ix.mi,this.serializer)}Du(e){return new bT}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}bf.provider={build:()=>new bf};class AO extends bf{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){yt(this.persistence.referenceDelegate instanceof Gg,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new sT(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Pr.withCacheSize(this.cacheSizeBytes):Pr.DEFAULT;return new ow((s=>Gg.mi(s,t)),this.serializer)}}class PT extends bf{constructor(e,t,s){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=s,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await Sw(this.xu.syncEngine),await uh(this.xu.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(e){return dT(this.persistence,new cT,e.initialUser,this.serializer)}Fu(e,t){const s=this.persistence.referenceDelegate.garbageCollector;return new sT(s,e.asyncQueue,t)}Mu(e,t){const s=new $R(t,this.persistence);return new zR(e.asyncQueue,s)}Cu(e){const t=lT(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),s=this.cacheSizeBytes!==void 0?Pr.withCacheSize(this.cacheSizeBytes):Pr.DEFAULT;return new lw(this.synchronizeTabs,t,e.clientId,s,e.asyncQueue,wT(),_g(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new bT}}class DO extends PT{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof _b&&(this.sharedClientState.syncEngine={Co:EO.bind(null,t),vo:TO.bind(null,t),Fo:CO.bind(null,t),Ts:IO.bind(null,t),Do:_O.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji((async s=>{await SO(this.xu.syncEngine,s),this.gcScheduler&&(s&&!this.gcScheduler.started?this.gcScheduler.start():s||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(s&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():s||this.indexBackfillerScheduler.stop())}))}Du(e){const t=wT();if(!_b.v(t))throw new Xe(Fe.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const s=lT(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new _b(t,e.asyncQueue,s,e.clientId,e.initialUser)}}class wf{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>tE(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=vO.bind(null,this.syncEngine),await m0(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new iO})()}createDatastore(e){const t=Tx(e.databaseInfo.databaseId),s=(function(l){return new zk(l)})(e.databaseInfo);return(function(l,c,u,m){return new Hk(l,c,u,m)})(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return(function(s,a,l,c,u){return new Qk(s,a,l,c,u)})(this.localStore,this.datastore,e.asyncQueue,(t=>tE(this.syncEngine,t,0)),(function(){return K_.v()?new K_:new Lk})())}createSyncEngine(e,t){return(function(a,l,c,u,m,p,b){const w=new uO(a,l,c,u,m,p);return b&&(w.gu=!0),w})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const s=xt(t);Ye(Sd,"RemoteStore shutting down."),s.Ea.add(5),await Lf(s),s.Aa.shutdown(),s.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}wf.provider={build:()=>new wf};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iw{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):As("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RO{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new Xe(Fe.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await(async function(a,l){const c=xt(a),u={documents:l.map((w=>xf(c.serializer,w)))},m=await c.Ho("BatchGetDocuments",c.serializer.databaseId,gn.emptyPath(),u,l.length),p=new Map;m.forEach((w=>{const j=KP(c.serializer,w);p.set(j.key.toString(),j)}));const b=[];return l.forEach((w=>{const j=p.get(w.toString());yt(!!j,55234,{key:w}),b.push(j)})),b})(this.datastore,e);return t.forEach((s=>this.recordVersion(s))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(s){this.lastTransactionError=s}this.writtenDocs.add(e.toString())}delete(e){this.write(new dh(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((t,s)=>{const a=at.fromPath(s);this.mutations.push(new J0(a,this.precondition(a)))})),await(async function(s,a){const l=xt(s),c={writes:a.map((u=>yf(l.serializer,u)))};await l.Go("Commit",l.serializer.databaseId,gn.emptyPath(),c)})(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ht(50498,{Gu:e.constructor.name});t=wt.min()}const s=this.readVersions.get(e.key.toString());if(s){if(!t.isEqual(s))throw new Xe(Fe.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(wt.min())?rs.exists(!1):rs.updateTime(t):rs.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(wt.min()))throw new Xe(Fe.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return rs.updateTime(t)}return rs.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PO{constructor(e,t,s,a,l){this.asyncQueue=e,this.datastore=t,this.options=s,this.updateFunction=a,this.deferred=l,this.zu=s.maxAttempts,this.M_=new hw(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_((async()=>{const e=new RO(this.datastore),t=this.Hu(e);t&&t.then((s=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(s)})).catch((a=>{this.Yu(a)}))))})).catch((s=>{this.Yu(s)}))}))}Hu(e){try{const t=this.updateFunction(e);return!Af(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget((()=>(this.Ju(),Promise.resolve())))):this.deferred.reject(e)}Zu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!RI(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yc="FirestoreClient";class kO{constructor(e,t,s,a,l){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=a,this.user=lr.UNAUTHENTICATED,this.clientId=F0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=l,this.authCredentials.start(s,(async c=>{Ye(yc,"Received user=",c.uid),await this.authCredentialListener(c),this.user=c})),this.appCheckCredentials.start(s,(c=>(Ye(yc,"Received new app check token=",c),this.appCheckCredentialListener(c,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new xa;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=xw(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}async function Sb(r,e){r.asyncQueue.verifyOperationInProgress(),Ye(yc,"Initializing OfflineComponentProvider");const t=r.configuration;await e.initialize(t);let s=t.initialUser;r.setCredentialChangeListener((async a=>{s.isEqual(a)||(await uT(e.localStore,a),s=a)})),e.persistence.setDatabaseDeletedListener((()=>r.terminate())),r._offlineComponents=e}async function sE(r,e){r.asyncQueue.verifyOperationInProgress();const t=await OO(r);Ye(yc,"Initializing OnlineComponentProvider"),await e.initialize(t,r.configuration),r.setCredentialChangeListener((s=>X_(e.remoteStore,s))),r.setAppCheckTokenChangeListener(((s,a)=>X_(e.remoteStore,a))),r._onlineComponents=e}async function OO(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){Ye(yc,"Using user provided OfflineComponentProvider");try{await Sb(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(a){return a.name==="FirebaseError"?a.code===Fe.FAILED_PRECONDITION||a.code===Fe.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11})(t))throw t;Lu("Error using user provided cache. Falling back to memory cache: "+t),await Sb(r,new bf)}}else Ye(yc,"Using default OfflineComponentProvider"),await Sb(r,new AO(void 0));return r._offlineComponents}async function Tw(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(Ye(yc,"Using user provided OnlineComponentProvider"),await sE(r,r._uninitializedComponentsProvider._online)):(Ye(yc,"Using default OnlineComponentProvider"),await sE(r,new wf))),r._onlineComponents}function MO(r){return Tw(r).then((e=>e.syncEngine))}function LO(r){return Tw(r).then((e=>e.datastore))}async function Xg(r){const e=await Tw(r),t=e.eventManager;return t.onListen=hO.bind(null,e.syncEngine),t.onUnlisten=fO.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=mO.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=pO.bind(null,e.syncEngine),t}function FO(r,e,t={}){const s=new xa;return r.asyncQueue.enqueueAndForget((async()=>(function(l,c,u,m,p){const b=new Iw({next:j=>{b.Nu(),c.enqueueAndForget((()=>bw(l,w)));const D=j.docs.has(u);!D&&j.fromCache?p.reject(new Xe(Fe.UNAVAILABLE,"Failed to get document because the client is offline.")):D&&j.fromCache&&m&&m.source==="server"?p.reject(new Xe(Fe.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):p.resolve(j)},error:j=>p.reject(j)}),w=new vw(Pf(u.path),b,{includeMetadataChanges:!0,qa:!0});return yw(l,w)})(await Xg(r),r.asyncQueue,e,t,s))),s.promise}function UO(r,e,t={}){const s=new xa;return r.asyncQueue.enqueueAndForget((async()=>(function(l,c,u,m,p){const b=new Iw({next:j=>{b.Nu(),c.enqueueAndForget((()=>bw(l,w))),j.fromCache&&m.source==="server"?p.reject(new Xe(Fe.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):p.resolve(j)},error:j=>p.reject(j)}),w=new vw(u,b,{includeMetadataChanges:!0,qa:!0});return yw(l,w)})(await Xg(r),r.asyncQueue,e,t,s))),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kT(r){const e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rE=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OT="firestore.googleapis.com",iE=!0;class aE{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Xe(Fe.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=OT,this.ssl=iE}else this.host=e.host,this.ssl=e.ssl??iE;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=JI;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<nT)throw new Xe(Fe.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}LR("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=kT(e.experimentalLongPollingOptions??{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new Xe(Fe.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new Xe(Fe.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new Xe(Fe.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(s,a){return s.timeoutSeconds===a.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Rx{constructor(e,t,s,a){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new aE({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Xe(Fe.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Xe(Fe.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new aE(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(s){if(!s)return new IR;switch(s.type){case"firstParty":return new DR(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new Xe(Fe.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const s=rE.get(t);s&&(Ye("ComponentProvider","Removing Datastore"),rE.delete(t),s.terminate())})(this),Promise.resolve()}}function VO(r,e,t,s={}){r=kr(r,Rx);const a=al(e),l=r._getSettings(),c={...l,emulatorOptions:r._getEmulatorOptions()},u=`${e}:${t}`;a&&(fx(`https://${u}`),R0("Firestore",!0)),l.host!==OT&&l.host!==u&&Lu("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const m={...l,host:u,ssl:a,emulatorOptions:s};if(!mc(m,c)&&(r._setSettings(m),s.mockUserToken)){let p,b;if(typeof s.mockUserToken=="string")p=s.mockUserToken,b=lr.MOCK_USER;else{p=xS(s.mockUserToken,r._app?.options.projectId);const w=s.mockUserToken.sub||s.mockUserToken.user_id;if(!w)throw new Xe(Fe.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");b=new lr(w)}r._authCredentials=new TR(new PS(p,b))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cl{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new cl(this.firestore,e,this._query)}}class ds{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new uc(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ds(this.firestore,e,this._key)}toJSON(){return{type:ds._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(Cf(t,ds._jsonSchema))return new ds(e,s||null,new at(gn.fromString(t.referencePath)))}}ds._jsonSchemaVersion="firestore/documentReference/1.0",ds._jsonSchema={type:Us("string",ds._jsonSchemaVersion),referencePath:Us("string")};class uc extends cl{constructor(e,t,s){super(e,t,Pf(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ds(this.firestore,null,new at(e))}withConverter(e){return new uc(this.firestore,e,this._path)}}function ct(r,e,...t){if(r=Fn(r),OS("collection","path",e),r instanceof Rx){const s=gn.fromString(e,...t);return Yj(s),new uc(r,null,s)}{if(!(r instanceof ds||r instanceof uc))throw new Xe(Fe.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=r._path.child(gn.fromString(e,...t));return Yj(s),new uc(r.firestore,null,s)}}function ut(r,e,...t){if(r=Fn(r),arguments.length===1&&(e=F0.newId()),OS("doc","path",e),r instanceof Rx){const s=gn.fromString(e,...t);return Kj(s),new ds(r,null,new at(s))}{if(!(r instanceof ds||r instanceof uc))throw new Xe(Fe.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=r._path.child(gn.fromString(e,...t));return Kj(s),new ds(r.firestore,r instanceof uc?r.converter:null,new at(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oE="AsyncQueue";class lE{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new hw(this,"async_queue_retry"),this._c=()=>{const s=_g();s&&Ye(oE,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=_g();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=_g();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new xa;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!wc(e))throw e;Ye(oE,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((s=>{throw this.nc=s,this.rc=!1,As("INTERNAL UNHANDLED ERROR: ",cE(s)),s})).then((s=>(this.rc=!1,s))))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const a=gw.createAndSchedule(this,e,t,s,(l=>this.hc(l)));return this.tc.push(a),a}uc(){this.nc&&ht(47125,{Pc:cE(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,s)=>t.targetTimeMs-s.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function cE(r){let e=r.message||"";return r.stack&&(e=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dE(r){return(function(t,s){if(typeof t!="object"||t===null)return!1;const a=t;for(const l of s)if(l in a&&typeof a[l]=="function")return!0;return!1})(r,["next","error","complete"])}class ya extends Rx{constructor(e,t,s,a){super(e,t,s,a),this.type="firestore",this._queue=new lE,this._persistenceKey=a?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new lE(e),this._firestoreClient=void 0,await e}}}function zO(r,e,t){t||(t=hf);const s=Tf(r,"firestore");if(s.isInitialized(t)){const a=s.getImmediate({identifier:t}),l=s.getOptions(t);if(mc(l,e))return a;throw new Xe(Fe.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new Xe(Fe.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<nT)throw new Xe(Fe.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&al(e.host)&&fx(e.host),s.initialize({options:e,instanceIdentifier:t})}function $O(r,e){const t=typeof r=="object"?r:M0(),s=typeof r=="string"?r:hf,a=Tf(t,"firestore").getImmediate({identifier:s});if(!a._initialized){const l=fS("firestore");l&&VO(a,...l)}return a}function fh(r){if(r._terminated)throw new Xe(Fe.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||BO(r),r._firestoreClient}function BO(r){const e=r._freezeSettings(),t=(function(a,l,c,u){return new gP(a,l,c,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,kT(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(r._databaseId,r._app?.options.appId||"",r._persistenceKey,e);r._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(r._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),r._firestoreClient=new kO(r._authCredentials,r._appCheckCredentials,r._queue,t,r._componentsProvider&&(function(a){const l=a?._online.build();return{_offline:a?._offline.build(l),_online:l}})(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ei{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ei(Ds.fromBase64String(e))}catch(t){throw new Xe(Fe.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ei(Ds.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Ei._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Cf(e,Ei._jsonSchema))return Ei.fromBase64String(e.bytes)}}Ei._jsonSchemaVersion="firestore/bytes/1.0",Ei._jsonSchema={type:Us("string",Ei._jsonSchemaVersion),bytes:Us("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ph{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Xe(Fe.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ls(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ff{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ya{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Xe(Fe.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Xe(Fe.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ut(this._lat,e._lat)||Ut(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ya._jsonSchemaVersion}}static fromJSON(e){if(Cf(e,Ya._jsonSchema))return new Ya(e.latitude,e.longitude)}}Ya._jsonSchemaVersion="firestore/geoPoint/1.0",Ya._jsonSchema={type:Us("string",Ya._jsonSchemaVersion),latitude:Us("number"),longitude:Us("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xa{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(s,a){if(s.length!==a.length)return!1;for(let l=0;l<s.length;++l)if(s[l]!==a[l])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Xa._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Cf(e,Xa._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Xa(e.vectorValues);throw new Xe(Fe.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Xa._jsonSchemaVersion="firestore/vectorValue/1.0",Xa._jsonSchema={type:Us("string",Xa._jsonSchemaVersion),vectorValues:Us("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qO=/^__.*__$/;class HO{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new ll(e,this.data,this.fieldMask,t,this.fieldTransforms):new ch(e,this.data,t,this.fieldTransforms)}}class MT{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return new ll(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function LT(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ht(40011,{Ac:r})}}class Cw{constructor(e,t,s,a,l,c){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=a,l===void 0&&this.Rc(),this.fieldTransforms=l||[],this.fieldMask=c||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Cw({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.gc(e),s}yc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.Rc(),s}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Jg(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(LT(this.Ac)&&qO.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class GO{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||Tx(e)}Cc(e,t,s,a=!1){return new Cw({Ac:e,methodName:t,Dc:s,path:ls.emptyPath(),fc:!1,bc:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function gh(r){const e=r._freezeSettings(),t=Tx(r._databaseId);return new GO(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Px(r,e,t,s,a,l={}){const c=r.Cc(l.merge||l.mergeFields?2:0,e,t,a);kw("Data must be an object, but it was:",c,s);const u=FT(s,c);let m,p;if(l.merge)m=new ai(c.fieldMask),p=c.fieldTransforms;else if(l.mergeFields){const b=[];for(const w of l.mergeFields){const j=g0(e,w,t);if(!c.contains(j))throw new Xe(Fe.INVALID_ARGUMENT,`Field '${j}' is specified in your field mask but missing from your input data.`);VT(b,j)||b.push(j)}m=new ai(b),p=c.fieldTransforms.filter((w=>m.covers(w.field)))}else m=null,p=c.fieldTransforms;return new HO(new jr(u),m,p)}class kx extends Ff{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof kx}}class Aw extends Ff{_toFieldTransform(e){return new X0(e.path,new Wu)}isEqual(e){return e instanceof Aw}}class Dw extends Ff{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new Xu(e.serializer,EI(e.serializer,this.Fc));return new X0(e.path,t)}isEqual(e){return e instanceof Dw&&this.Fc===e.Fc}}function Rw(r,e,t,s){const a=r.Cc(1,e,t);kw("Data must be an object, but it was:",a,s);const l=[],c=jr.empty();vc(s,((m,p)=>{const b=Ow(e,m,t);p=Fn(p);const w=a.yc(b);if(p instanceof kx)l.push(b);else{const j=Uf(p,w);j!=null&&(l.push(b),c.set(b,j))}}));const u=new ai(l);return new MT(c,u,a.fieldTransforms)}function Pw(r,e,t,s,a,l){const c=r.Cc(1,e,t),u=[g0(e,s,t)],m=[a];if(l.length%2!=0)throw new Xe(Fe.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let j=0;j<l.length;j+=2)u.push(g0(e,l[j])),m.push(l[j+1]);const p=[],b=jr.empty();for(let j=u.length-1;j>=0;--j)if(!VT(p,u[j])){const D=u[j];let O=m[j];O=Fn(O);const Q=c.yc(D);if(O instanceof kx)p.push(D);else{const z=Uf(O,Q);z!=null&&(p.push(D),b.set(D,z))}}const w=new ai(p);return new MT(b,w,c.fieldTransforms)}function QO(r,e,t,s=!1){return Uf(t,r.Cc(s?4:3,e))}function Uf(r,e){if(UT(r=Fn(r)))return kw("Unsupported field value:",e,r),FT(r,e);if(r instanceof Ff)return(function(s,a){if(!LT(a.Ac))throw a.Sc(`${s._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Sc(`${s._methodName}() is not currently supported inside arrays`);const l=s._toFieldTransform(a);l&&a.fieldTransforms.push(l)})(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(s,a){const l=[];let c=0;for(const u of s){let m=Uf(u,a.wc(c));m==null&&(m={nullValue:"NULL_VALUE"}),l.push(m),c++}return{arrayValue:{values:l}}})(r,e)}return(function(s,a){if((s=Fn(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return EI(a.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const l=_n.fromDate(s);return{timestampValue:Ju(a.serializer,l)}}if(s instanceof _n){const l=new _n(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:Ju(a.serializer,l)}}if(s instanceof Ya)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Ei)return{bytesValue:MI(a.serializer,s._byteString)};if(s instanceof ds){const l=a.databaseId,c=s.firestore._databaseId;if(!c.isEqual(l))throw a.Sc(`Document reference is for database ${c.projectId}/${c.database} but should be for database ${l.projectId}/${l.database}`);return{referenceValue:sw(s.firestore._databaseId||a.databaseId,s._key.path)}}if(s instanceof Xa)return(function(c,u){return{mapValue:{fields:{[G0]:{stringValue:Q0},[qu]:{arrayValue:{values:c.toArray().map((p=>{if(typeof p!="number")throw u.Sc("VectorValues must only contain numeric values.");return Y0(u.serializer,p)}))}}}}}})(s,a);throw a.Sc(`Unsupported field value: ${px(s)}`)})(r,e)}function FT(r,e){const t={};return ZS(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):vc(r,((s,a)=>{const l=Uf(a,e.mc(s));l!=null&&(t[s]=l)})),{mapValue:{fields:t}}}function UT(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof _n||r instanceof Ya||r instanceof Ei||r instanceof ds||r instanceof Ff||r instanceof Xa)}function kw(r,e,t){if(!UT(t)||!MS(t)){const s=px(t);throw s==="an object"?e.Sc(r+" a custom object"):e.Sc(r+" "+s)}}function g0(r,e,t){if((e=Fn(e))instanceof ph)return e._internalPath;if(typeof e=="string")return Ow(r,e);throw Jg("Field path arguments must be of type string or ",r,!1,void 0,t)}const WO=new RegExp("[~\\*/\\[\\]]");function Ow(r,e,t){if(e.search(WO)>=0)throw Jg(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new ph(...e.split("."))._internalPath}catch{throw Jg(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function Jg(r,e,t,s,a){const l=s&&!s.isEmpty(),c=a!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let m="";return(l||c)&&(m+=" (found",l&&(m+=` in field ${s}`),c&&(m+=` in document ${a}`),m+=")"),new Xe(Fe.INVALID_ARGUMENT,u+r+m)}function VT(r,e){return r.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zg{constructor(e,t,s,a,l){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=a,this._converter=l}get id(){return this._key.path.lastSegment()}get ref(){return new ds(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new KO(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ox("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class KO extends Zg{data(){return super.data()}}function Ox(r,e){return typeof e=="string"?Ow(r,e):e instanceof ph?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zT(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new Xe(Fe.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Mw{}class Lw extends Mw{}function Vt(r,e,...t){let s=[];e instanceof Mw&&s.push(e),s=s.concat(t),(function(l){const c=l.filter((m=>m instanceof Fw)).length,u=l.filter((m=>m instanceof Mx)).length;if(c>1||c>0&&u>0)throw new Xe(Fe.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(s);for(const a of s)r=a._apply(r);return r}class Mx extends Lw{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new Mx(e,t,s)}_apply(e){const t=this._parse(e);return $T(e._query,t),new cl(e.firestore,e.converter,n0(e._query,t))}_parse(e){const t=gh(e.firestore);return(function(l,c,u,m,p,b,w){let j;if(p.isKeyField()){if(b==="array-contains"||b==="array-contains-any")throw new Xe(Fe.INVALID_ARGUMENT,`Invalid Query. You can't perform '${b}' queries on documentId().`);if(b==="in"||b==="not-in"){hE(w,b);const O=[];for(const Q of w)O.push(uE(m,l,Q));j={arrayValue:{values:O}}}else j=uE(m,l,w)}else b!=="in"&&b!=="not-in"&&b!=="array-contains-any"||hE(w,b),j=QO(u,c,w,b==="in"||b==="not-in");return nn.create(p,b,j)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function jn(r,e,t){const s=e,a=Ox("where",r);return Mx._create(a,s,t)}class Fw extends Mw{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Fw(e,t)}_parse(e){const t=this._queryConstraints.map((s=>s._parse(e))).filter((s=>s.getFilters().length>0));return t.length===1?t[0]:Cn.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(a,l){let c=a;const u=l.getFlattenedFilters();for(const m of u)$T(c,m),c=n0(c,m)})(e._query,t),new cl(e.firestore,e.converter,n0(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Uw extends Lw{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Uw(e,t)}_apply(e){const t=(function(a,l,c){if(a.startAt!==null)throw new Xe(Fe.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(a.endAt!==null)throw new Xe(Fe.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new gf(l,c)})(e._query,this._field,this._direction);return new cl(e.firestore,e.converter,(function(a,l){const c=a.explicitOrderBy.concat([l]);return new lh(a.path,a.collectionGroup,c,a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)})(e._query,t))}}function hs(r,e="asc"){const t=e,s=Ox("orderBy",r);return Uw._create(s,t)}class Vw extends Lw{constructor(e,t,s){super(),this.type=e,this._limit=t,this._limitType=s}static _create(e,t,s){return new Vw(e,t,s)}_apply(e){return new cl(e.firestore,e.converter,$g(e._query,this._limit,this._limitType))}}function YO(r){return FR("limit",r),Vw._create("limit",r,"F")}function uE(r,e,t){if(typeof(t=Fn(t))=="string"){if(t==="")throw new Xe(Fe.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!xI(e)&&t.indexOf("/")!==-1)throw new Xe(Fe.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const s=e.path.child(gn.fromString(t));if(!at.isDocumentKey(s))throw new Xe(Fe.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return ff(r,new at(s))}if(t instanceof ds)return ff(r,t._key);throw new Xe(Fe.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${px(t)}.`)}function hE(r,e){if(!Array.isArray(r)||r.length===0)throw new Xe(Fe.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function $T(r,e){const t=(function(a,l){for(const c of a)for(const u of c.getFlattenedFilters())if(l.indexOf(u.op)>=0)return u.op;return null})(r.filters,(function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new Xe(Fe.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Xe(Fe.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class BT{convertValue(e,t="none"){switch(pc(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ns(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(nl(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ht(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return vc(e,((a,l)=>{s[a]=this.convertValue(l,t)})),s}convertVectorValue(e){const t=e.fields?.[qu].arrayValue?.values?.map((s=>ns(s.doubleValue)));return new Xa(t)}convertGeoPoint(e){return new Ya(ns(e.latitude),ns(e.longitude))}convertArray(e,t){return(e.values||[]).map((s=>this.convertValue(s,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const s=wx(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(uf(e));default:return null}}convertTimestamp(e){const t=tl(e);return new _n(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=gn.fromString(e);yt(GI(s),9688,{name:e});const a=new vd(s.get(1),s.get(3)),l=new at(s.popFirst(5));return a.isEqual(t)||As(`Document ${l} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lx(r,e,t){let s;return s=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,s}class XO extends BT{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ei(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ds(this.firestore,null,t)}}class Tu{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hc extends Zg{constructor(e,t,s,a,l,c){super(e,t,s,a,c),this._firestore=e,this._firestoreImpl=e,this.metadata=l}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Eg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(Ox("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Xe(Fe.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=hc._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}hc._jsonSchemaVersion="firestore/documentSnapshot/1.0",hc._jsonSchema={type:Us("string",hc._jsonSchemaVersion),bundleSource:Us("string","DocumentSnapshot"),bundleName:Us("string"),bundle:Us("string")};class Eg extends hc{data(e={}){return super.data(e)}}class xd{constructor(e,t,s,a){this._firestore=e,this._userDataWriter=t,this._snapshot=a,this.metadata=new Tu(a.hasPendingWrites,a.fromCache),this.query=s}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((s=>{e.call(t,new Eg(this._firestore,this._userDataWriter,s.key,s,new Tu(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Xe(Fe.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(a,l){if(a._snapshot.oldDocs.isEmpty()){let c=0;return a._snapshot.docChanges.map((u=>{const m=new Eg(a._firestore,a._userDataWriter,u.doc.key,u.doc,new Tu(a._snapshot.mutatedKeys.has(u.doc.key),a._snapshot.fromCache),a.query.converter);return u.doc,{type:"added",doc:m,oldIndex:-1,newIndex:c++}}))}{let c=a._snapshot.oldDocs;return a._snapshot.docChanges.filter((u=>l||u.type!==3)).map((u=>{const m=new Eg(a._firestore,a._userDataWriter,u.doc.key,u.doc,new Tu(a._snapshot.mutatedKeys.has(u.doc.key),a._snapshot.fromCache),a.query.converter);let p=-1,b=-1;return u.type!==0&&(p=c.indexOf(u.doc.key),c=c.delete(u.doc.key)),u.type!==1&&(c=c.add(u.doc),b=c.indexOf(u.doc.key)),{type:JO(u.type),doc:m,oldIndex:p,newIndex:b}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Xe(Fe.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=xd._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=F0.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],a=[];return this.docs.forEach((l=>{l._document!==null&&(t.push(l._document),s.push(this._userDataWriter.convertObjectMap(l._document.data.value.mapValue.fields,"previous")),a.push(l.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function JO(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ht(61501,{type:r})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cs(r){r=kr(r,ds);const e=kr(r.firestore,ya);return FO(fh(e),r._key).then((t=>qT(e,r,t)))}xd._jsonSchemaVersion="firestore/querySnapshot/1.0",xd._jsonSchema={type:Us("string",xd._jsonSchemaVersion),bundleSource:Us("string","QuerySnapshot"),bundleName:Us("string"),bundle:Us("string")};class Fx extends BT{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ei(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ds(this.firestore,null,t)}}function St(r){r=kr(r,cl);const e=kr(r.firestore,ya),t=fh(e),s=new Fx(e);return zT(r._query),UO(t,r._query).then((a=>new xd(e,s,r,a)))}function sh(r,e,t){r=kr(r,ds);const s=kr(r.firestore,ya),a=Lx(r.converter,e,t);return Vf(s,[Px(gh(s),"setDoc",r._key,a,r.converter!==null,t).toMutation(r._key,rs.none())])}function Xs(r,e,t,...s){r=kr(r,ds);const a=kr(r.firestore,ya),l=gh(a);let c;return c=typeof(e=Fn(e))=="string"||e instanceof ph?Pw(l,"updateDoc",r._key,e,t,s):Rw(l,"updateDoc",r._key,e),Vf(a,[c.toMutation(r._key,rs.exists(!0))])}function Js(r){return Vf(kr(r.firestore,ya),[new dh(r._key,rs.none())])}function Mr(r,e){const t=kr(r.firestore,ya),s=ut(r),a=Lx(r.converter,e);return Vf(t,[Px(gh(r.firestore),"addDoc",s._key,a,r.converter!==null,{}).toMutation(s._key,rs.exists(!1))]).then((()=>s))}function vf(r,...e){r=Fn(r);let t={includeMetadataChanges:!1,source:"default"},s=0;typeof e[s]!="object"||dE(e[s])||(t=e[s++]);const a={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(dE(e[s])){const m=e[s];e[s]=m.next?.bind(m),e[s+1]=m.error?.bind(m),e[s+2]=m.complete?.bind(m)}let l,c,u;if(r instanceof ds)c=kr(r.firestore,ya),u=Pf(r._key.path),l={next:m=>{e[s]&&e[s](qT(c,r,m))},error:e[s+1],complete:e[s+2]};else{const m=kr(r,cl);c=kr(m.firestore,ya),u=m._query;const p=new Fx(c);l={next:b=>{e[s]&&e[s](new xd(c,p,m,b))},error:e[s+1],complete:e[s+2]},zT(r._query)}return(function(p,b,w,j){const D=new Iw(j),O=new vw(b,D,w);return p.asyncQueue.enqueueAndForget((async()=>yw(await Xg(p),O))),()=>{D.Nu(),p.asyncQueue.enqueueAndForget((async()=>bw(await Xg(p),O)))}})(fh(c),u,a,l)}function Vf(r,e){return(function(s,a){const l=new xa;return s.asyncQueue.enqueueAndForget((async()=>gO(await MO(s),a,l))),l.promise})(fh(r),e)}function qT(r,e,t){const s=t.docs.get(e._key),a=new Fx(r);return new hc(r,a,e._key,s,new Tu(t.hasPendingWrites,t.fromCache),e.converter)}class ZO{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=sM(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}function eM(r){return new ZO(r)}class tM{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=wf.provider,this._offlineComponentProvider={build:t=>new PT(t,e?.cacheSizeBytes,this.forceOwnership)}}}class nM{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=wf.provider,this._offlineComponentProvider={build:t=>new DO(t,e?.cacheSizeBytes)}}}function sM(r){return new tM(r?.forceOwnership)}function rM(){return new nM}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iM={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aM{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=gh(e)}set(e,t,s){this._verifyNotCommitted();const a=ic(e,this._firestore),l=Lx(a.converter,t,s),c=Px(this._dataReader,"WriteBatch.set",a._key,l,a.converter!==null,s);return this._mutations.push(c.toMutation(a._key,rs.none())),this}update(e,t,s,...a){this._verifyNotCommitted();const l=ic(e,this._firestore);let c;return c=typeof(t=Fn(t))=="string"||t instanceof ph?Pw(this._dataReader,"WriteBatch.update",l._key,t,s,a):Rw(this._dataReader,"WriteBatch.update",l._key,t),this._mutations.push(c.toMutation(l._key,rs.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ic(e,this._firestore);return this._mutations=this._mutations.concat(new dh(t._key,rs.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Xe(Fe.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ic(r,e){if((r=Fn(r)).firestore!==e)throw new Xe(Fe.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oM{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=gh(e)}get(e){const t=ic(e,this._firestore),s=new XO(this._firestore);return this._transaction.lookup([t._key]).then((a=>{if(!a||a.length!==1)return ht(24041);const l=a[0];if(l.isFoundDocument())return new Zg(this._firestore,s,l.key,l,t.converter);if(l.isNoDocument())return new Zg(this._firestore,s,t._key,null,t.converter);throw ht(18433,{doc:l})}))}set(e,t,s){const a=ic(e,this._firestore),l=Lx(a.converter,t,s),c=Px(this._dataReader,"Transaction.set",a._key,l,a.converter!==null,s);return this._transaction.set(a._key,c),this}update(e,t,s,...a){const l=ic(e,this._firestore);let c;return c=typeof(t=Fn(t))=="string"||t instanceof ph?Pw(this._dataReader,"Transaction.update",l._key,t,s,a):Rw(this._dataReader,"Transaction.update",l._key,t),this._transaction.update(l._key,c),this}delete(e){const t=ic(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lM extends oM{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ic(e,this._firestore),s=new Fx(this._firestore);return super.get(e).then((a=>new hc(this._firestore,s,t._key,a._document,new Tu(!1,!1),t.converter)))}}function x0(r,e,t){r=kr(r,ya);const s={...iM,...t};return(function(l){if(l.maxAttempts<1)throw new Xe(Fe.INVALID_ARGUMENT,"Max attempts must be at least 1")})(s),(function(l,c,u){const m=new xa;return l.asyncQueue.enqueueAndForget((async()=>{const p=await LO(l);new PO(l.asyncQueue,p,u,c,m).ju()})),m.promise})(fh(r),(a=>e(new lM(r,a))),s)}function vt(){return new Aw("serverTimestamp")}function HT(r){return new Dw("increment",r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jo(r){return fh(r=kr(r,ya)),new aM(r,(e=>Vf(r,e)))}(function(e,t=!0){(function(a){oh=a})(Cd),bd(new fc("firestore",((s,{instanceIdentifier:a,options:l})=>{const c=s.getProvider("app").getImmediate(),u=new ya(new CR(s.getProvider("auth-internal")),new RR(c,s.getProvider("app-check-internal")),(function(p,b){if(!Object.prototype.hasOwnProperty.apply(p.options,["projectId"]))throw new Xe(Fe.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vd(p.options.projectId,b)})(c,a),c);return l={useFetchStreams:t,...l},u._setSettings(l),u}),"PUBLIC").setMultipleInstances(!0)),Ka(Hj,Gj,e),Ka(Hj,Gj,"esm2020")})();var cM="firebase",dM="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ka(cM,dM,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GT="firebasestorage.googleapis.com",QT="storageBucket",uM=120*1e3,hM=600*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws extends ao{constructor(e,t,s=0){super(Ib(e),`Firebase Storage: ${t} (${Ib(e)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,ws.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Ib(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var bs;(function(r){r.UNKNOWN="unknown",r.OBJECT_NOT_FOUND="object-not-found",r.BUCKET_NOT_FOUND="bucket-not-found",r.PROJECT_NOT_FOUND="project-not-found",r.QUOTA_EXCEEDED="quota-exceeded",r.UNAUTHENTICATED="unauthenticated",r.UNAUTHORIZED="unauthorized",r.UNAUTHORIZED_APP="unauthorized-app",r.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",r.INVALID_CHECKSUM="invalid-checksum",r.CANCELED="canceled",r.INVALID_EVENT_NAME="invalid-event-name",r.INVALID_URL="invalid-url",r.INVALID_DEFAULT_BUCKET="invalid-default-bucket",r.NO_DEFAULT_BUCKET="no-default-bucket",r.CANNOT_SLICE_BLOB="cannot-slice-blob",r.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",r.NO_DOWNLOAD_URL="no-download-url",r.INVALID_ARGUMENT="invalid-argument",r.INVALID_ARGUMENT_COUNT="invalid-argument-count",r.APP_DELETED="app-deleted",r.INVALID_ROOT_OPERATION="invalid-root-operation",r.INVALID_FORMAT="invalid-format",r.INTERNAL_ERROR="internal-error",r.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(bs||(bs={}));function Ib(r){return"storage/"+r}function zw(){const r="An unknown error occurred, please check the error payload for server response.";return new ws(bs.UNKNOWN,r)}function mM(r){return new ws(bs.OBJECT_NOT_FOUND,"Object '"+r+"' does not exist.")}function fM(r){return new ws(bs.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function pM(){const r="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new ws(bs.UNAUTHENTICATED,r)}function gM(){return new ws(bs.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function xM(r){return new ws(bs.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")}function yM(){return new ws(bs.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function bM(){return new ws(bs.CANCELED,"User canceled the upload/download.")}function wM(r){return new ws(bs.INVALID_URL,"Invalid URL '"+r+"'.")}function vM(r){return new ws(bs.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")}function NM(){return new ws(bs.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+QT+"' property when initializing the app?")}function jM(){return new ws(bs.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function _M(){return new ws(bs.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function EM(r){return new ws(bs.UNSUPPORTED_ENVIRONMENT,`${r} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function y0(r){return new ws(bs.INVALID_ARGUMENT,r)}function WT(){return new ws(bs.APP_DELETED,"The Firebase app was deleted.")}function SM(r){return new ws(bs.INVALID_ROOT_OPERATION,"The operation '"+r+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Xm(r,e){return new ws(bs.INVALID_FORMAT,"String does not match format '"+r+"': "+e)}function km(r){throw new ws(bs.INTERNAL_ERROR,"Internal error: "+r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ii{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let s;try{s=Ii.makeFromUrl(e,t)}catch{return new Ii(e,"")}if(s.path==="")return s;throw vM(e)}static makeFromUrl(e,t){let s=null;const a="([A-Za-z0-9.\\-_]+)";function l(oe){oe.path.charAt(oe.path.length-1)==="/"&&(oe.path_=oe.path_.slice(0,-1))}const c="(/(.*))?$",u=new RegExp("^gs://"+a+c,"i"),m={bucket:1,path:3};function p(oe){oe.path_=decodeURIComponent(oe.path)}const b="v[A-Za-z0-9_]+",w=t.replace(/[.]/g,"\\."),j="(/([^?#]*).*)?$",D=new RegExp(`^https?://${w}/${b}/b/${a}/o${j}`,"i"),O={bucket:1,path:3},Q=t===GT?"(?:storage.googleapis.com|storage.cloud.google.com)":t,z="([^?#]*)",I=new RegExp(`^https?://${Q}/${a}/${z}`,"i"),J=[{regex:u,indices:m,postModify:l},{regex:D,indices:O,postModify:p},{regex:I,indices:{bucket:1,path:2},postModify:p}];for(let oe=0;oe<J.length;oe++){const Y=J[oe],be=Y.regex.exec(e);if(be){const M=be[Y.indices.bucket];let H=be[Y.indices.path];H||(H=""),s=new Ii(M,H),Y.postModify(s);break}}if(s==null)throw wM(e);return s}}class IM{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TM(r,e,t){let s=1,a=null,l=null,c=!1,u=0;function m(){return u===2}let p=!1;function b(...z){p||(p=!0,e.apply(null,z))}function w(z){a=setTimeout(()=>{a=null,r(D,m())},z)}function j(){l&&clearTimeout(l)}function D(z,...I){if(p){j();return}if(z){j(),b.call(null,z,...I);return}if(m()||c){j(),b.call(null,z,...I);return}s<64&&(s*=2);let J;u===1?(u=2,J=0):J=(s+Math.random())*1e3,w(J)}let O=!1;function Q(z){O||(O=!0,j(),!p&&(a!==null?(z||(u=2),clearTimeout(a),w(0)):z||(u=1)))}return w(0),l=setTimeout(()=>{c=!0,Q(!0)},t),Q}function CM(r){r(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AM(r){return r!==void 0}function DM(r){return typeof r=="object"&&!Array.isArray(r)}function $w(r){return typeof r=="string"||r instanceof String}function mE(r){return Bw()&&r instanceof Blob}function Bw(){return typeof Blob<"u"}function fE(r,e,t,s){if(s<e)throw y0(`Invalid value for '${r}'. Expected ${e} or greater.`);if(s>t)throw y0(`Invalid value for '${r}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ux(r,e,t){let s=e;return t==null&&(s=`https://${e}`),`${t}://${s}/v0${r}`}function KT(r){const e=encodeURIComponent;let t="?";for(const s in r)if(r.hasOwnProperty(s)){const a=e(s)+"="+e(r[s]);t=t+a+"&"}return t=t.slice(0,-1),t}var yd;(function(r){r[r.NO_ERROR=0]="NO_ERROR",r[r.NETWORK_ERROR=1]="NETWORK_ERROR",r[r.ABORT=2]="ABORT"})(yd||(yd={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RM(r,e){const t=r>=500&&r<600,a=[408,429].indexOf(r)!==-1,l=e.indexOf(r)!==-1;return t||a||l}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PM{constructor(e,t,s,a,l,c,u,m,p,b,w,j=!0,D=!1){this.url_=e,this.method_=t,this.headers_=s,this.body_=a,this.successCodes_=l,this.additionalRetryCodes_=c,this.callback_=u,this.errorCallback_=m,this.timeout_=p,this.progressCallback_=b,this.connectionFactory_=w,this.retry=j,this.isUsingEmulator=D,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((O,Q)=>{this.resolve_=O,this.reject_=Q,this.start_()})}start_(){const e=(s,a)=>{if(a){s(!1,new lg(!1,null,!0));return}const l=this.connectionFactory_();this.pendingConnection_=l;const c=u=>{const m=u.loaded,p=u.lengthComputable?u.total:-1;this.progressCallback_!==null&&this.progressCallback_(m,p)};this.progressCallback_!==null&&l.addUploadProgressListener(c),l.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&l.removeUploadProgressListener(c),this.pendingConnection_=null;const u=l.getErrorCode()===yd.NO_ERROR,m=l.getStatus();if(!u||RM(m,this.additionalRetryCodes_)&&this.retry){const b=l.getErrorCode()===yd.ABORT;s(!1,new lg(!1,null,b));return}const p=this.successCodes_.indexOf(m)!==-1;s(!0,new lg(p,l))})},t=(s,a)=>{const l=this.resolve_,c=this.reject_,u=a.connection;if(a.wasSuccessCode)try{const m=this.callback_(u,u.getResponse());AM(m)?l(m):l()}catch(m){c(m)}else if(u!==null){const m=zw();m.serverResponse=u.getErrorText(),this.errorCallback_?c(this.errorCallback_(u,m)):c(m)}else if(a.canceled){const m=this.appDelete_?WT():bM();c(m)}else{const m=yM();c(m)}};this.canceled_?t(!1,new lg(!1,null,!0)):this.backoffId_=TM(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&CM(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class lg{constructor(e,t,s){this.wasSuccessCode=e,this.connection=t,this.canceled=!!s}}function kM(r,e){e!==null&&e.length>0&&(r.Authorization="Firebase "+e)}function OM(r,e){r["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function MM(r,e){e&&(r["X-Firebase-GMPID"]=e)}function LM(r,e){e!==null&&(r["X-Firebase-AppCheck"]=e)}function FM(r,e,t,s,a,l,c=!0,u=!1){const m=KT(r.urlParams),p=r.url+m,b=Object.assign({},r.headers);return MM(b,e),kM(b,t),OM(b,l),LM(b,s),new PM(p,r.method,b,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,a,c,u)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UM(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function VM(...r){const e=UM();if(e!==void 0){const t=new e;for(let s=0;s<r.length;s++)t.append(r[s]);return t.getBlob()}else{if(Bw())return new Blob(r);throw new ws(bs.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function zM(r,e,t){return r.webkitSlice?r.webkitSlice(e,t):r.mozSlice?r.mozSlice(e,t):r.slice?r.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $M(r){if(typeof atob>"u")throw EM("base-64");return atob(r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wa={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Tb{constructor(e,t){this.data=e,this.contentType=t||null}}function BM(r,e){switch(r){case Wa.RAW:return new Tb(YT(e));case Wa.BASE64:case Wa.BASE64URL:return new Tb(XT(r,e));case Wa.DATA_URL:return new Tb(HM(e),GM(e))}throw zw()}function YT(r){const e=[];for(let t=0;t<r.length;t++){let s=r.charCodeAt(t);if(s<=127)e.push(s);else if(s<=2047)e.push(192|s>>6,128|s&63);else if((s&64512)===55296)if(!(t<r.length-1&&(r.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const l=s,c=r.charCodeAt(++t);s=65536|(l&1023)<<10|c&1023,e.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|s&63)}else(s&64512)===56320?e.push(239,191,189):e.push(224|s>>12,128|s>>6&63,128|s&63)}return new Uint8Array(e)}function qM(r){let e;try{e=decodeURIComponent(r)}catch{throw Xm(Wa.DATA_URL,"Malformed data URL.")}return YT(e)}function XT(r,e){switch(r){case Wa.BASE64:{const a=e.indexOf("-")!==-1,l=e.indexOf("_")!==-1;if(a||l)throw Xm(r,"Invalid character '"+(a?"-":"_")+"' found: is it base64url encoded?");break}case Wa.BASE64URL:{const a=e.indexOf("+")!==-1,l=e.indexOf("/")!==-1;if(a||l)throw Xm(r,"Invalid character '"+(a?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=$M(e)}catch(a){throw a.message.includes("polyfill")?a:Xm(r,"Invalid character found")}const s=new Uint8Array(t.length);for(let a=0;a<t.length;a++)s[a]=t.charCodeAt(a);return s}class JT{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw Xm(Wa.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const s=t[1]||null;s!=null&&(this.base64=QM(s,";base64"),this.contentType=this.base64?s.substring(0,s.length-7):s),this.rest=e.substring(e.indexOf(",")+1)}}function HM(r){const e=new JT(r);return e.base64?XT(Wa.BASE64,e.rest):qM(e.rest)}function GM(r){return new JT(r).contentType}function QM(r,e){return r.length>=e.length?r.substring(r.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jl{constructor(e,t){let s=0,a="";mE(e)?(this.data_=e,s=e.size,a=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),s=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),s=e.length),this.size_=s,this.type_=a}size(){return this.size_}type(){return this.type_}slice(e,t){if(mE(this.data_)){const s=this.data_,a=zM(s,e,t);return a===null?null:new Jl(a)}else{const s=new Uint8Array(this.data_.buffer,e,t-e);return new Jl(s,!0)}}static getBlob(...e){if(Bw()){const t=e.map(s=>s instanceof Jl?s.data_:s);return new Jl(VM.apply(null,t))}else{const t=e.map(c=>$w(c)?BM(Wa.RAW,c).data:c.data_);let s=0;t.forEach(c=>{s+=c.byteLength});const a=new Uint8Array(s);let l=0;return t.forEach(c=>{for(let u=0;u<c.length;u++)a[l++]=c[u]}),new Jl(a,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZT(r){let e;try{e=JSON.parse(r)}catch{return null}return DM(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WM(r){if(r.length===0)return null;const e=r.lastIndexOf("/");return e===-1?"":r.slice(0,e)}function KM(r,e){const t=e.split("/").filter(s=>s.length>0).join("/");return r.length===0?t:r+"/"+t}function e1(r){const e=r.lastIndexOf("/",r.length-2);return e===-1?r:r.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YM(r,e){return e}class qr{constructor(e,t,s,a){this.server=e,this.local=t||e,this.writable=!!s,this.xform=a||YM}}let cg=null;function XM(r){return!$w(r)||r.length<2?r:e1(r)}function t1(){if(cg)return cg;const r=[];r.push(new qr("bucket")),r.push(new qr("generation")),r.push(new qr("metageneration")),r.push(new qr("name","fullPath",!0));function e(l,c){return XM(c)}const t=new qr("name");t.xform=e,r.push(t);function s(l,c){return c!==void 0?Number(c):c}const a=new qr("size");return a.xform=s,r.push(a),r.push(new qr("timeCreated")),r.push(new qr("updated")),r.push(new qr("md5Hash",null,!0)),r.push(new qr("cacheControl",null,!0)),r.push(new qr("contentDisposition",null,!0)),r.push(new qr("contentEncoding",null,!0)),r.push(new qr("contentLanguage",null,!0)),r.push(new qr("contentType",null,!0)),r.push(new qr("metadata","customMetadata",!0)),cg=r,cg}function JM(r,e){function t(){const s=r.bucket,a=r.fullPath,l=new Ii(s,a);return e._makeStorageReference(l)}Object.defineProperty(r,"ref",{get:t})}function ZM(r,e,t){const s={};s.type="file";const a=t.length;for(let l=0;l<a;l++){const c=t[l];s[c.local]=c.xform(s,e[c.server])}return JM(s,r),s}function n1(r,e,t){const s=ZT(e);return s===null?null:ZM(r,s,t)}function eL(r,e,t,s){const a=ZT(e);if(a===null||!$w(a.downloadTokens))return null;const l=a.downloadTokens;if(l.length===0)return null;const c=encodeURIComponent;return l.split(",").map(p=>{const b=r.bucket,w=r.fullPath,j="/b/"+c(b)+"/o/"+c(w),D=Ux(j,t,s),O=KT({alt:"media",token:p});return D+O})[0]}function tL(r,e){const t={},s=e.length;for(let a=0;a<s;a++){const l=e[a];l.writable&&(t[l.server]=r[l.local])}return JSON.stringify(t)}class qw{constructor(e,t,s,a){this.url=e,this.method=t,this.handler=s,this.timeout=a,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s1(r){if(!r)throw zw()}function nL(r,e){function t(s,a){const l=n1(r,a,e);return s1(l!==null),l}return t}function sL(r,e){function t(s,a){const l=n1(r,a,e);return s1(l!==null),eL(l,a,r.host,r._protocol)}return t}function r1(r){function e(t,s){let a;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?a=gM():a=pM():t.getStatus()===402?a=fM(r.bucket):t.getStatus()===403?a=xM(r.path):a=s,a.status=t.getStatus(),a.serverResponse=s.serverResponse,a}return e}function i1(r){const e=r1(r);function t(s,a){let l=e(s,a);return s.getStatus()===404&&(l=mM(r.path)),l.serverResponse=a.serverResponse,l}return t}function rL(r,e,t){const s=e.fullServerUrl(),a=Ux(s,r.host,r._protocol),l="GET",c=r.maxOperationRetryTime,u=new qw(a,l,sL(r,t),c);return u.errorHandler=i1(e),u}function iL(r,e){const t=e.fullServerUrl(),s=Ux(t,r.host,r._protocol),a="DELETE",l=r.maxOperationRetryTime;function c(m,p){}const u=new qw(s,a,c,l);return u.successCodes=[200,204],u.errorHandler=i1(e),u}function aL(r,e){return r&&r.contentType||e&&e.type()||"application/octet-stream"}function oL(r,e,t){const s=Object.assign({},t);return s.fullPath=r.path,s.size=e.size(),s.contentType||(s.contentType=aL(null,e)),s}function lL(r,e,t,s,a){const l=e.bucketOnlyServerUrl(),c={"X-Goog-Upload-Protocol":"multipart"};function u(){let J="";for(let oe=0;oe<2;oe++)J=J+Math.random().toString().slice(2);return J}const m=u();c["Content-Type"]="multipart/related; boundary="+m;const p=oL(e,s,a),b=tL(p,t),w="--"+m+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+b+`\r
--`+m+`\r
Content-Type: `+p.contentType+`\r
\r
`,j=`\r
--`+m+"--",D=Jl.getBlob(w,s,j);if(D===null)throw jM();const O={name:p.fullPath},Q=Ux(l,r.host,r._protocol),z="POST",I=r.maxUploadRetryTime,ee=new qw(Q,z,nL(r,t),I);return ee.urlParams=O,ee.headers=c,ee.body=D.uploadData(),ee.errorHandler=r1(e),ee}class cL{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=yd.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=yd.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=yd.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,s,a,l){if(this.sent_)throw km("cannot .send() more than once");if(al(e)&&s&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),l!==void 0)for(const c in l)l.hasOwnProperty(c)&&this.xhr_.setRequestHeader(c,l[c].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw km("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw km("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw km("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw km("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class dL extends cL{initXhr(){this.xhr_.responseType="text"}}function Hw(){return new dL}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Id{constructor(e,t){this._service=e,t instanceof Ii?this._location=t:this._location=Ii.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Id(e,t)}get root(){const e=new Ii(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return e1(this._location.path)}get storage(){return this._service}get parent(){const e=WM(this._location.path);if(e===null)return null;const t=new Ii(this._location.bucket,e);return new Id(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw SM(e)}}function uL(r,e,t){r._throwIfRoot("uploadBytes");const s=lL(r.storage,r._location,t1(),new Jl(e,!0),t);return r.storage.makeRequestWithTokens(s,Hw).then(a=>({metadata:a,ref:r}))}function hL(r){r._throwIfRoot("getDownloadURL");const e=rL(r.storage,r._location,t1());return r.storage.makeRequestWithTokens(e,Hw).then(t=>{if(t===null)throw _M();return t})}function mL(r){r._throwIfRoot("deleteObject");const e=iL(r.storage,r._location);return r.storage.makeRequestWithTokens(e,Hw)}function fL(r,e){const t=KM(r._location.path,e),s=new Ii(r._location.bucket,t);return new Id(r.storage,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pL(r){return/^[A-Za-z]+:\/\//.test(r)}function gL(r,e){return new Id(r,e)}function a1(r,e){if(r instanceof Gw){const t=r;if(t._bucket==null)throw NM();const s=new Id(t,t._bucket);return e!=null?a1(s,e):s}else return e!==void 0?fL(r,e):r}function xL(r,e){if(e&&pL(e)){if(r instanceof Gw)return gL(r,e);throw y0("To use ref(service, url), the first argument must be a Storage instance.")}else return a1(r,e)}function pE(r,e){const t=e?.[QT];return t==null?null:Ii.makeFromBucketSpec(t,r)}function yL(r,e,t,s={}){r.host=`${e}:${t}`;const a=al(e);a&&(fx(`https://${r.host}/b`),R0("Storage",!0)),r._isUsingEmulator=!0,r._protocol=a?"https":"http";const{mockUserToken:l}=s;l&&(r._overrideAuthToken=typeof l=="string"?l:xS(l,r.app.options.projectId))}class Gw{constructor(e,t,s,a,l,c=!1){this.app=e,this._authProvider=t,this._appCheckProvider=s,this._url=a,this._firebaseVersion=l,this._isUsingEmulator=c,this._bucket=null,this._host=GT,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=uM,this._maxUploadRetryTime=hM,this._requests=new Set,a!=null?this._bucket=Ii.makeFromBucketSpec(a,this._host):this._bucket=pE(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Ii.makeFromBucketSpec(this._url,e):this._bucket=pE(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){fE("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){fE("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(si(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Id(this,e)}_makeRequest(e,t,s,a,l=!0){if(this._deleted)return new IM(WT());{const c=FM(e,this._appId,s,a,t,this._firebaseVersion,l,this._isUsingEmulator);return this._requests.add(c),c.getPromise().then(()=>this._requests.delete(c),()=>this._requests.delete(c)),c}}async makeRequestWithTokens(e,t){const[s,a]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,s,a).getPromise()}}const gE="@firebase/storage",xE="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o1="storage";function ex(r,e,t){return r=Fn(r),uL(r,e,t)}function Jm(r){return r=Fn(r),hL(r)}function Vx(r){return r=Fn(r),mL(r)}function Qo(r,e){return r=Fn(r),xL(r,e)}function l1(r=M0(),e){r=Fn(r);const s=Tf(r,o1).getImmediate({identifier:e}),a=fS("storage");return a&&bL(s,...a),s}function bL(r,e,t,s={}){yL(r,e,t,s)}function wL(r,{instanceIdentifier:e}){const t=r.getProvider("app").getImmediate(),s=r.getProvider("auth-internal"),a=r.getProvider("app-check-internal");return new Gw(t,s,a,e,Cd)}function vL(){bd(new fc(o1,wL,"PUBLIC").setMultipleInstances(!0)),Ka(gE,xE,""),Ka(gE,xE,"esm2020")}vL();function c1(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const NL=c1,d1=new Sf("auth","Firebase",c1());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tx=new P0("@firebase/auth");function jL(r,...e){tx.logLevel<=tn.WARN&&tx.warn(`Auth (${Cd}): ${r}`,...e)}function Sg(r,...e){tx.logLevel<=tn.ERROR&&tx.error(`Auth (${Cd}): ${r}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ba(r,...e){throw Qw(r,...e)}function Ja(r,...e){return Qw(r,...e)}function u1(r,e,t){const s={...NL(),[e]:t};return new Sf("auth","Firebase",s).create(e,{appName:r.name})}function Za(r){return u1(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Qw(r,...e){if(typeof r!="string"){const t=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=r.name),r._errorFactory.create(t,...s)}return d1.create(r,...e)}function kt(r,e,...t){if(!r)throw Qw(e,...t)}function Wo(r){const e="INTERNAL ASSERTION FAILED: "+r;throw Sg(e),new Error(e)}function sl(r,e){r||Wo(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b0(){return typeof self<"u"&&self.location?.href||""}function _L(){return yE()==="http:"||yE()==="https:"}function yE(){return typeof self<"u"&&self.location?.protocol||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EL(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(_L()||lD()||"connection"in navigator)?navigator.onLine:!0}function SL(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zf{constructor(e,t){this.shortDelay=e,this.longDelay=t,sl(t>e,"Short delay should be less than long delay!"),this.isMobile=aD()||cD()}get(){return EL()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ww(r,e){sl(r.emulator,"Emulator should always be set here");const{url:t}=r.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h1{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Wo("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Wo("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Wo("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IL={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TL=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],CL=new zf(3e4,6e4);function jc(r,e){return r.tenantId&&!e.tenantId?{...e,tenantId:r.tenantId}:e}async function dl(r,e,t,s,a={}){return m1(r,a,async()=>{let l={},c={};s&&(e==="GET"?c=s:l={body:JSON.stringify(s)});const u=If({key:r.config.apiKey,...c}).slice(1),m=await r._getAdditionalHeaders();m["Content-Type"]="application/json",r.languageCode&&(m["X-Firebase-Locale"]=r.languageCode);const p={method:e,headers:m,...l};return oD()||(p.referrerPolicy="no-referrer"),r.emulatorConfig&&al(r.emulatorConfig.host)&&(p.credentials="include"),h1.fetch()(await f1(r,r.config.apiHost,t,u),p)})}async function m1(r,e,t){r._canInitEmulator=!1;const s={...IL,...e};try{const a=new DL(r),l=await Promise.race([t(),a.promise]);a.clearNetworkTimeout();const c=await l.json();if("needConfirmation"in c)throw dg(r,"account-exists-with-different-credential",c);if(l.ok&&!("errorMessage"in c))return c;{const u=l.ok?c.errorMessage:c.error.message,[m,p]=u.split(" : ");if(m==="FEDERATED_USER_ID_ALREADY_LINKED")throw dg(r,"credential-already-in-use",c);if(m==="EMAIL_EXISTS")throw dg(r,"email-already-in-use",c);if(m==="USER_DISABLED")throw dg(r,"user-disabled",c);const b=s[m]||m.toLowerCase().replace(/[_\s]+/g,"-");if(p)throw u1(r,b,p);ba(r,b)}}catch(a){if(a instanceof ao)throw a;ba(r,"network-request-failed",{message:String(a)})}}async function $f(r,e,t,s,a={}){const l=await dl(r,e,t,s,a);return"mfaPendingCredential"in l&&ba(r,"multi-factor-auth-required",{_serverResponse:l}),l}async function f1(r,e,t,s){const a=`${e}${t}?${s}`,l=r,c=l.config.emulator?Ww(r.config,a):`${r.config.apiScheme}://${a}`;return TL.includes(t)&&(await l._persistenceManagerAvailable,l._getPersistenceType()==="COOKIE")?l._getPersistence()._getFinalTarget(c).toString():c}function AL(r){switch(r){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class DL{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,s)=>{this.timer=setTimeout(()=>s(Ja(this.auth,"network-request-failed")),CL.get())})}}function dg(r,e,t){const s={appName:r.name};t.email&&(s.email=t.email),t.phoneNumber&&(s.phoneNumber=t.phoneNumber);const a=Ja(r,e,s);return a.customData._tokenResponse=t,a}function bE(r){return r!==void 0&&r.enterprise!==void 0}class RL{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return AL(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function PL(r,e){return dl(r,"GET","/v2/recaptchaConfig",jc(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kL(r,e){return dl(r,"POST","/v1/accounts:delete",e)}async function nx(r,e){return dl(r,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zm(r){if(r)try{const e=new Date(Number(r));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function OL(r,e=!1){const t=Fn(r),s=await t.getIdToken(e),a=Kw(s);kt(a&&a.exp&&a.auth_time&&a.iat,t.auth,"internal-error");const l=typeof a.firebase=="object"?a.firebase:void 0,c=l?.sign_in_provider;return{claims:a,token:s,authTime:Zm(Cb(a.auth_time)),issuedAtTime:Zm(Cb(a.iat)),expirationTime:Zm(Cb(a.exp)),signInProvider:c||null,signInSecondFactor:l?.sign_in_second_factor||null}}function Cb(r){return Number(r)*1e3}function Kw(r){const[e,t,s]=r.split(".");if(e===void 0||t===void 0||s===void 0)return Sg("JWT malformed, contained fewer than 3 sections"),null;try{const a=uS(t);return a?JSON.parse(a):(Sg("Failed to decode base64 JWT payload"),null)}catch(a){return Sg("Caught error parsing JWT payload as JSON",a?.toString()),null}}function wE(r){const e=Kw(r);return kt(e,"internal-error"),kt(typeof e.exp<"u","internal-error"),kt(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rh(r,e,t=!1){if(t)return e;try{return await e}catch(s){throw s instanceof ao&&ML(s)&&r.auth.currentUser===r&&await r.auth.signOut(),s}}function ML({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LL{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w0{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Zm(this.lastLoginAt),this.creationTime=Zm(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sx(r){const e=r.auth,t=await r.getIdToken(),s=await rh(r,nx(e,{idToken:t}));kt(s?.users.length,e,"internal-error");const a=s.users[0];r._notifyReloadListener(a);const l=a.providerUserInfo?.length?p1(a.providerUserInfo):[],c=UL(r.providerData,l),u=r.isAnonymous,m=!(r.email&&a.passwordHash)&&!c?.length,p=u?m:!1,b={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:c,metadata:new w0(a.createdAt,a.lastLoginAt),isAnonymous:p};Object.assign(r,b)}async function FL(r){const e=Fn(r);await sx(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function UL(r,e){return[...r.filter(s=>!e.some(a=>a.providerId===s.providerId)),...e]}function p1(r){return r.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VL(r,e){const t=await m1(r,{},async()=>{const s=If({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:l}=r.config,c=await f1(r,a,"/v1/token",`key=${l}`),u=await r._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";const m={method:"POST",headers:u,body:s};return r.emulatorConfig&&al(r.emulatorConfig.host)&&(m.credentials="include"),h1.fetch()(c,m)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function zL(r,e){return dl(r,"POST","/v2/accounts:revokeToken",jc(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Du{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){kt(e.idToken,"internal-error"),kt(typeof e.idToken<"u","internal-error"),kt(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):wE(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){kt(e.length!==0,"internal-error");const t=wE(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(kt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:s,refreshToken:a,expiresIn:l}=await VL(e,t);this.updateTokensAndExpiration(s,a,Number(l))}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,t){const{refreshToken:s,accessToken:a,expirationTime:l}=t,c=new Du;return s&&(kt(typeof s=="string","internal-error",{appName:e}),c.refreshToken=s),a&&(kt(typeof a=="string","internal-error",{appName:e}),c.accessToken=a),l&&(kt(typeof l=="number","internal-error",{appName:e}),c.expirationTime=l),c}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Du,this.toJSON())}_performRefresh(){return Wo("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yl(r,e){kt(typeof r=="string"||typeof r>"u","internal-error",{appName:e})}class ga{constructor({uid:e,auth:t,stsTokenManager:s,...a}){this.providerId="firebase",this.proactiveRefresh=new LL(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new w0(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const t=await rh(this,this.stsTokenManager.getToken(this.auth,e));return kt(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return OL(this,e)}reload(){return FL(this)}_assign(e){this!==e&&(kt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ga({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){kt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&await sx(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(si(this.auth.app))return Promise.reject(Za(this.auth));const e=await this.getIdToken();return await rh(this,kL(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const s=t.displayName??void 0,a=t.email??void 0,l=t.phoneNumber??void 0,c=t.photoURL??void 0,u=t.tenantId??void 0,m=t._redirectEventId??void 0,p=t.createdAt??void 0,b=t.lastLoginAt??void 0,{uid:w,emailVerified:j,isAnonymous:D,providerData:O,stsTokenManager:Q}=t;kt(w&&Q,e,"internal-error");const z=Du.fromJSON(this.name,Q);kt(typeof w=="string",e,"internal-error"),Yl(s,e.name),Yl(a,e.name),kt(typeof j=="boolean",e,"internal-error"),kt(typeof D=="boolean",e,"internal-error"),Yl(l,e.name),Yl(c,e.name),Yl(u,e.name),Yl(m,e.name),Yl(p,e.name),Yl(b,e.name);const I=new ga({uid:w,auth:e,email:a,emailVerified:j,displayName:s,isAnonymous:D,photoURL:c,phoneNumber:l,tenantId:u,stsTokenManager:z,createdAt:p,lastLoginAt:b});return O&&Array.isArray(O)&&(I.providerData=O.map(ee=>({...ee}))),m&&(I._redirectEventId=m),I}static async _fromIdTokenResponse(e,t,s=!1){const a=new Du;a.updateFromServerResponse(t);const l=new ga({uid:t.localId,auth:e,stsTokenManager:a,isAnonymous:s});return await sx(l),l}static async _fromGetAccountInfoResponse(e,t,s){const a=t.users[0];kt(a.localId!==void 0,"internal-error");const l=a.providerUserInfo!==void 0?p1(a.providerUserInfo):[],c=!(a.email&&a.passwordHash)&&!l?.length,u=new Du;u.updateFromIdToken(s);const m=new ga({uid:a.localId,auth:e,stsTokenManager:u,isAnonymous:c}),p={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:l,metadata:new w0(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!l?.length};return Object.assign(m,p),m}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vE=new Map;function Ko(r){sl(r instanceof Function,"Expected a class definition");let e=vE.get(r);return e?(sl(e instanceof r,"Instance stored in cache mismatched with class"),e):(e=new r,vE.set(r,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g1{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}g1.type="NONE";const NE=g1;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ig(r,e,t){return`firebase:${r}:${e}:${t}`}class Ru{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:a,name:l}=this.auth;this.fullUserKey=Ig(this.userKey,a.apiKey,l),this.fullPersistenceKey=Ig("persistence",a.apiKey,l),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await nx(this.auth,{idToken:e}).catch(()=>{});return t?ga._fromGetAccountInfoResponse(this.auth,t,e):null}return ga._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,s="authUser"){if(!t.length)return new Ru(Ko(NE),e,s);const a=(await Promise.all(t.map(async p=>{if(await p._isAvailable())return p}))).filter(p=>p);let l=a[0]||Ko(NE);const c=Ig(s,e.config.apiKey,e.name);let u=null;for(const p of t)try{const b=await p._get(c);if(b){let w;if(typeof b=="string"){const j=await nx(e,{idToken:b}).catch(()=>{});if(!j)break;w=await ga._fromGetAccountInfoResponse(e,j,b)}else w=ga._fromJSON(e,b);p!==l&&(u=w),l=p;break}}catch{}const m=a.filter(p=>p._shouldAllowMigration);return!l._shouldAllowMigration||!m.length?new Ru(l,e,s):(l=m[0],u&&await l._set(c,u.toJSON()),await Promise.all(t.map(async p=>{if(p!==l)try{await p._remove(c)}catch{}})),new Ru(l,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jE(r){const e=r.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(w1(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(x1(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(N1(e))return"Blackberry";if(j1(e))return"Webos";if(y1(e))return"Safari";if((e.includes("chrome/")||b1(e))&&!e.includes("edge/"))return"Chrome";if(v1(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=r.match(t);if(s?.length===2)return s[1]}return"Other"}function x1(r=Ys()){return/firefox\//i.test(r)}function y1(r=Ys()){const e=r.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function b1(r=Ys()){return/crios\//i.test(r)}function w1(r=Ys()){return/iemobile/i.test(r)}function v1(r=Ys()){return/android/i.test(r)}function N1(r=Ys()){return/blackberry/i.test(r)}function j1(r=Ys()){return/webos/i.test(r)}function Yw(r=Ys()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function $L(r=Ys()){return Yw(r)&&!!window.navigator?.standalone}function BL(){return dD()&&document.documentMode===10}function _1(r=Ys()){return Yw(r)||v1(r)||j1(r)||N1(r)||/windows phone/i.test(r)||w1(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E1(r,e=[]){let t;switch(r){case"Browser":t=jE(Ys());break;case"Worker":t=`${jE(Ys())}-${r}`;break;default:t=r}const s=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Cd}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qL{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=l=>new Promise((c,u)=>{try{const m=e(l);c(m)}catch(m){u(m)}});s.onAbort=t,this.queue.push(s);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)await s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const a of t)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HL(r,e={}){return dl(r,"GET","/v2/passwordPolicy",jc(r,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GL=6;class QL{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??GL,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),a&&(t.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let s;for(let a=0;a<e.length;a++)s=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,a,l){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WL{constructor(e,t,s,a){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new _E(this),this.idTokenSubscription=new _E(this),this.beforeStateQueue=new qL(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=d1,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion,this._persistenceManagerAvailable=new Promise(l=>this._resolvePersistenceManagerAvailable=l)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ko(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Ru.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await nx(this,{idToken:e}),s=await ga._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(si(this.app)){const l=this.app.settings.authIdToken;return l?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(l).then(c,c))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let s=t,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const l=this.redirectUser?._redirectEventId,c=s?._redirectEventId,u=await this.tryRedirectSignIn(e);(!l||l===c)&&u?.user&&(s=u.user,a=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(s)}catch(l){s=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(l))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return kt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await sx(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=SL()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(si(this.app))return Promise.reject(Za(this));const t=e?Fn(e):null;return t&&kt(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&kt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return si(this.app)?Promise.reject(Za(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return si(this.app)?Promise.reject(Za(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ko(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await HL(this),t=new QL(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Sf("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(s.tenantId=this.tenantId),await zL(this,s)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const s=await this.getOrInitRedirectPersistenceManager(t);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ko(e)||this._popupRedirectResolver;kt(t,this,"argument-error"),this.redirectPersistenceManager=await Ru.create(this,[Ko(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,a){if(this._deleted)return()=>{};const l=typeof t=="function"?t:t.next.bind(t);let c=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(kt(u,this,"internal-error"),u.then(()=>{c||l(this.currentUser)}),typeof t=="function"){const m=e.addObserver(t,s,a);return()=>{c=!0,m()}}else{const m=e.addObserver(t);return()=>{c=!0,m()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return kt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=E1(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const s=await this._getAppCheckToken();return s&&(e["X-Firebase-AppCheck"]=s),e}async _getAppCheckToken(){if(si(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&jL(`Error while retrieving App Check token: ${e.error}`),e?.token}}function _c(r){return Fn(r)}class _E{constructor(e){this.auth=e,this.observer=null,this.addObserver=gD(t=>this.observer=t)}get next(){return kt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zx={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function KL(r){zx=r}function S1(r){return zx.loadJS(r)}function YL(){return zx.recaptchaEnterpriseScript}function XL(){return zx.gapiScript}function JL(r){return`__${r}${Math.floor(Math.random()*1e6)}`}class ZL{constructor(){this.enterprise=new e3}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class e3{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const t3="recaptcha-enterprise",I1="NO_RECAPTCHA";class n3{constructor(e){this.type=t3,this.auth=_c(e)}async verify(e="verify",t=!1){async function s(l){if(!t){if(l.tenantId==null&&l._agentRecaptchaConfig!=null)return l._agentRecaptchaConfig.siteKey;if(l.tenantId!=null&&l._tenantRecaptchaConfigs[l.tenantId]!==void 0)return l._tenantRecaptchaConfigs[l.tenantId].siteKey}return new Promise(async(c,u)=>{PL(l,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(m=>{if(m.recaptchaKey===void 0)u(new Error("recaptcha Enterprise site key undefined"));else{const p=new RL(m);return l.tenantId==null?l._agentRecaptchaConfig=p:l._tenantRecaptchaConfigs[l.tenantId]=p,c(p.siteKey)}}).catch(m=>{u(m)})})}function a(l,c,u){const m=window.grecaptcha;bE(m)?m.enterprise.ready(()=>{m.enterprise.execute(l,{action:e}).then(p=>{c(p)}).catch(()=>{c(I1)})}):u(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new ZL().execute("siteKey",{action:"verify"}):new Promise((l,c)=>{s(this.auth).then(u=>{if(!t&&bE(window.grecaptcha))a(u,l,c);else{if(typeof window>"u"){c(new Error("RecaptchaVerifier is only supported in browser"));return}let m=YL();m.length!==0&&(m+=u),S1(m).then(()=>{a(u,l,c)}).catch(p=>{c(p)})}}).catch(u=>{c(u)})})}}async function EE(r,e,t,s=!1,a=!1){const l=new n3(r);let c;if(a)c=I1;else try{c=await l.verify(t)}catch{c=await l.verify(t,!0)}const u={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in u){const m=u.phoneEnrollmentInfo.phoneNumber,p=u.phoneEnrollmentInfo.recaptchaToken;Object.assign(u,{phoneEnrollmentInfo:{phoneNumber:m,recaptchaToken:p,captchaResponse:c,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in u){const m=u.phoneSignInInfo.recaptchaToken;Object.assign(u,{phoneSignInInfo:{recaptchaToken:m,captchaResponse:c,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return u}return s?Object.assign(u,{captchaResp:c}):Object.assign(u,{captchaResponse:c}),Object.assign(u,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(u,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),u}async function v0(r,e,t,s,a){if(r._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const l=await EE(r,e,t,t==="getOobCode");return s(r,l)}else return s(r,e).catch(async l=>{if(l.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const c=await EE(r,e,t,t==="getOobCode");return s(r,c)}else return Promise.reject(l)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s3(r,e){const t=Tf(r,"auth");if(t.isInitialized()){const a=t.getImmediate(),l=t.getOptions();if(mc(l,e??{}))return a;ba(a,"already-initialized")}return t.initialize({options:e})}function r3(r,e){const t=e?.persistence||[],s=(Array.isArray(t)?t:[t]).map(Ko);e?.errorMap&&r._updateErrorMap(e.errorMap),r._initializeWithPersistence(s,e?.popupRedirectResolver)}function i3(r,e,t){const s=_c(r);kt(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const a=!1,l=T1(e),{host:c,port:u}=a3(e),m=u===null?"":`:${u}`,p={url:`${l}//${c}${m}/`},b=Object.freeze({host:c,port:u,protocol:l.replace(":",""),options:Object.freeze({disableWarnings:a})});if(!s._canInitEmulator){kt(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),kt(mc(p,s.config.emulator)&&mc(b,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=p,s.emulatorConfig=b,s.settings.appVerificationDisabledForTesting=!0,al(c)?(fx(`${l}//${c}${m}`),R0("Auth",!0)):o3()}function T1(r){const e=r.indexOf(":");return e<0?"":r.substr(0,e+1)}function a3(r){const e=T1(r),t=/(\/\/)?([^?#/]+)/.exec(r.substr(e.length));if(!t)return{host:"",port:null};const s=t[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(s);if(a){const l=a[1];return{host:l,port:SE(s.substr(l.length+1))}}else{const[l,c]=s.split(":");return{host:l,port:SE(c)}}}function SE(r){if(!r)return null;const e=Number(r);return isNaN(e)?null:e}function o3(){function r(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xw{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Wo("not implemented")}_getIdTokenResponse(e){return Wo("not implemented")}_linkToIdToken(e,t){return Wo("not implemented")}_getReauthenticationResolver(e){return Wo("not implemented")}}async function l3(r,e){return dl(r,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c3(r,e){return $f(r,"POST","/v1/accounts:signInWithPassword",jc(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function d3(r,e){return $f(r,"POST","/v1/accounts:signInWithEmailLink",jc(r,e))}async function u3(r,e){return $f(r,"POST","/v1/accounts:signInWithEmailLink",jc(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nf extends Xw{constructor(e,t,s,a=null){super("password",s),this._email=e,this._password=t,this._tenantId=a}static _fromEmailAndPassword(e,t){return new Nf(e,t,"password")}static _fromEmailAndCode(e,t,s=null){return new Nf(e,t,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return v0(e,t,"signInWithPassword",c3);case"emailLink":return d3(e,{email:this._email,oobCode:this._password});default:ba(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const s={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return v0(e,s,"signUpPassword",l3);case"emailLink":return u3(e,{idToken:t,email:this._email,oobCode:this._password});default:ba(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pu(r,e){return $f(r,"POST","/v1/accounts:signInWithIdp",jc(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h3="http://localhost";class Td extends Xw{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Td(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ba("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:a,...l}=t;if(!s||!a)return null;const c=new Td(s,a);return c.idToken=l.idToken||void 0,c.accessToken=l.accessToken||void 0,c.secret=l.secret,c.nonce=l.nonce,c.pendingToken=l.pendingToken||null,c}_getIdTokenResponse(e){const t=this.buildRequest();return Pu(e,t)}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,Pu(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Pu(e,t)}buildRequest(){const e={requestUri:h3,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=If(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m3(r){switch(r){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function f3(r){const e=Om(Mm(r)).link,t=e?Om(Mm(e)).deep_link_id:null,s=Om(Mm(r)).deep_link_id;return(s?Om(Mm(s)).link:null)||s||t||e||r}class Jw{constructor(e){const t=Om(Mm(e)),s=t.apiKey??null,a=t.oobCode??null,l=m3(t.mode??null);kt(s&&a&&l,"argument-error"),this.apiKey=s,this.operation=l,this.code=a,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=f3(e);try{return new Jw(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xh{constructor(){this.providerId=xh.PROVIDER_ID}static credential(e,t){return Nf._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const s=Jw.parseLink(t);return kt(s,"argument-error"),Nf._fromEmailAndCode(e,s.code,s.tenantId)}}xh.PROVIDER_ID="password";xh.EMAIL_PASSWORD_SIGN_IN_METHOD="password";xh.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C1{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bf extends C1{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zl extends Bf{constructor(){super("facebook.com")}static credential(e){return Td._fromParams({providerId:Zl.PROVIDER_ID,signInMethod:Zl.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Zl.credentialFromTaggedObject(e)}static credentialFromError(e){return Zl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Zl.credential(e.oauthAccessToken)}catch{return null}}}Zl.FACEBOOK_SIGN_IN_METHOD="facebook.com";Zl.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec extends Bf{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Td._fromParams({providerId:ec.PROVIDER_ID,signInMethod:ec.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ec.credentialFromTaggedObject(e)}static credentialFromError(e){return ec.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return ec.credential(t,s)}catch{return null}}}ec.GOOGLE_SIGN_IN_METHOD="google.com";ec.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc extends Bf{constructor(){super("github.com")}static credential(e){return Td._fromParams({providerId:tc.PROVIDER_ID,signInMethod:tc.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return tc.credentialFromTaggedObject(e)}static credentialFromError(e){return tc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return tc.credential(e.oauthAccessToken)}catch{return null}}}tc.GITHUB_SIGN_IN_METHOD="github.com";tc.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nc extends Bf{constructor(){super("twitter.com")}static credential(e,t){return Td._fromParams({providerId:nc.PROVIDER_ID,signInMethod:nc.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return nc.credentialFromTaggedObject(e)}static credentialFromError(e){return nc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return nc.credential(t,s)}catch{return null}}}nc.TWITTER_SIGN_IN_METHOD="twitter.com";nc.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function A1(r,e){return $f(r,"POST","/v1/accounts:signUp",jc(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,s,a=!1){const l=await ga._fromIdTokenResponse(e,s,a),c=IE(s);return new rl({user:l,providerId:c,_tokenResponse:s,operationType:t})}static async _forOperation(e,t,s){await e._updateTokensIfNecessary(s,!0);const a=IE(s);return new rl({user:e,providerId:a,_tokenResponse:s,operationType:t})}}function IE(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p3(r){if(si(r.app))return Promise.reject(Za(r));const e=_c(r);if(await e._initializationPromise,e.currentUser?.isAnonymous)return new rl({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await A1(e,{returnSecureToken:!0}),s=await rl._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rx extends ao{constructor(e,t,s,a){super(t.code,t.message),this.operationType=s,this.user=a,Object.setPrototypeOf(this,rx.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,a){return new rx(e,t,s,a)}}function D1(r,e,t,s){return(e==="reauthenticate"?t._getReauthenticationResolver(r):t._getIdTokenResponse(r)).catch(l=>{throw l.code==="auth/multi-factor-auth-required"?rx._fromErrorAndOperation(r,l,e,s):l})}async function g3(r,e,t=!1){const s=await rh(r,e._linkToIdToken(r.auth,await r.getIdToken()),t);return rl._forOperation(r,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function x3(r,e,t=!1){const{auth:s}=r;if(si(s.app))return Promise.reject(Za(s));const a="reauthenticate";try{const l=await rh(r,D1(s,a,e,r),t);kt(l.idToken,s,"internal-error");const c=Kw(l.idToken);kt(c,s,"internal-error");const{sub:u}=c;return kt(r.uid===u,s,"user-mismatch"),rl._forOperation(r,a,l)}catch(l){throw l?.code==="auth/user-not-found"&&ba(s,"user-mismatch"),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function R1(r,e,t=!1){if(si(r.app))return Promise.reject(Za(r));const s="signIn",a=await D1(r,s,e),l=await rl._fromIdTokenResponse(r,s,a);return t||await r._updateCurrentUser(l.user),l}async function y3(r,e){return R1(_c(r),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function P1(r){const e=_c(r);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function b3(r,e,t){if(si(r.app))return Promise.reject(Za(r));const s=_c(r),c=await v0(s,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",A1).catch(m=>{throw m.code==="auth/password-does-not-meet-requirements"&&P1(r),m}),u=await rl._fromIdTokenResponse(s,"signIn",c);return await s._updateCurrentUser(u.user),u}function w3(r,e,t){return si(r.app)?Promise.reject(Za(r)):y3(Fn(r),xh.credential(e,t)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&P1(r),s})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function v3(r,e){return dl(r,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N3(r,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const s=Fn(r),l={idToken:await s.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},c=await rh(s,v3(s.auth,l));s.displayName=c.displayName||null,s.photoURL=c.photoUrl||null;const u=s.providerData.find(({providerId:m})=>m==="password");u&&(u.displayName=s.displayName,u.photoURL=s.photoURL),await s._updateTokensIfNecessary(c)}function j3(r,e,t,s){return Fn(r).onIdTokenChanged(e,t,s)}function _3(r,e,t){return Fn(r).beforeAuthStateChanged(e,t)}function Zw(r,e,t,s){return Fn(r).onAuthStateChanged(e,t,s)}function E3(r){return Fn(r).signOut()}const ix="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k1{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ix,"1"),this.storage.removeItem(ix),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S3=1e3,I3=10;class O1 extends k1{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=_1(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),a=this.localCache[t];s!==a&&e(t,a,s)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((c,u,m)=>{this.notifyListeners(c,m)});return}const s=e.key;t?this.detachListener():this.stopPolling();const a=()=>{const c=this.storage.getItem(s);!t&&this.localCache[s]===c||this.notifyListeners(s,c)},l=this.storage.getItem(s);BL()&&l!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,I3):a()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const a of Array.from(s))a(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},S3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}O1.type="LOCAL";const T3=O1;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M1 extends k1{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}M1.type="SESSION";const L1=M1;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C3(r){return Promise.all(r.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $x{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(a=>a.isListeningto(e));if(t)return t;const s=new $x(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:s,eventType:a,data:l}=t.data,c=this.handlersMap[a];if(!c?.size)return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:a});const u=Array.from(c).map(async p=>p(t.origin,l)),m=await C3(u);t.ports[0].postMessage({status:"done",eventId:s,eventType:a,response:m})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}$x.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ev(r="",e=10){let t="";for(let s=0;s<e;s++)t+=Math.floor(Math.random()*10);return r+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A3{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,s=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let l,c;return new Promise((u,m)=>{const p=ev("",20);a.port1.start();const b=setTimeout(()=>{m(new Error("unsupported_event"))},s);c={messageChannel:a,onMessage(w){const j=w;if(j.data.eventId===p)switch(j.data.status){case"ack":clearTimeout(b),l=setTimeout(()=>{m(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),u(j.data.response);break;default:clearTimeout(b),clearTimeout(l),m(new Error("invalid_response"));break}}},this.handlers.add(c),a.port1.addEventListener("message",c.onMessage),this.target.postMessage({eventType:e,eventId:p,data:t},[a.port2])}).finally(()=>{c&&this.removeMessageHandler(c)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eo(){return window}function D3(r){eo().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F1(){return typeof eo().WorkerGlobalScope<"u"&&typeof eo().importScripts=="function"}async function R3(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function P3(){return navigator?.serviceWorker?.controller||null}function k3(){return F1()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U1="firebaseLocalStorageDb",O3=1,ax="firebaseLocalStorage",V1="fbase_key";class qf{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Bx(r,e){return r.transaction([ax],e?"readwrite":"readonly").objectStore(ax)}function M3(){const r=indexedDB.deleteDatabase(U1);return new qf(r).toPromise()}function N0(){const r=indexedDB.open(U1,O3);return new Promise((e,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const s=r.result;try{s.createObjectStore(ax,{keyPath:V1})}catch(a){t(a)}}),r.addEventListener("success",async()=>{const s=r.result;s.objectStoreNames.contains(ax)?e(s):(s.close(),await M3(),e(await N0()))})})}async function TE(r,e,t){const s=Bx(r,!0).put({[V1]:e,value:t});return new qf(s).toPromise()}async function L3(r,e){const t=Bx(r,!1).get(e),s=await new qf(t).toPromise();return s===void 0?null:s.value}function CE(r,e){const t=Bx(r,!0).delete(e);return new qf(t).toPromise()}const F3=800,U3=3;class z1{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await N0(),this.db)}async _withRetries(e){let t=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(t++>U3)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return F1()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=$x._getInstance(k3()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await R3(),!this.activeServiceWorker)return;this.sender=new A3(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||P3()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await N0();return await TE(e,ix,"1"),await CE(e,ix),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(s=>TE(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(s=>L3(s,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>CE(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const l=Bx(a,!1).getAll();return new qf(l).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],s=new Set;if(e.length!==0)for(const{fbase_key:a,value:l}of e)s.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(l)&&(this.notifyListeners(a,l),t.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!s.has(a)&&(this.notifyListeners(a,null),t.push(a));return t}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const a of Array.from(s))a(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),F3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}z1.type="LOCAL";const V3=z1;new zf(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z3(r,e){return e?Ko(e):(kt(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tv extends Xw{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Pu(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Pu(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Pu(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function $3(r){return R1(r.auth,new tv(r),r.bypassAuthState)}function B3(r){const{auth:e,user:t}=r;return kt(t,e,"internal-error"),x3(t,new tv(r),r.bypassAuthState)}async function q3(r){const{auth:e,user:t}=r;return kt(t,e,"internal-error"),g3(t,new tv(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $1{constructor(e,t,s,a,l=!1){this.auth=e,this.resolver=s,this.user=a,this.bypassAuthState=l,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:s,postBody:a,tenantId:l,error:c,type:u}=e;if(c){this.reject(c);return}const m={auth:this.auth,requestUri:t,sessionId:s,tenantId:l||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(m))}catch(p){this.reject(p)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return $3;case"linkViaPopup":case"linkViaRedirect":return q3;case"reauthViaPopup":case"reauthViaRedirect":return B3;default:ba(this.auth,"internal-error")}}resolve(e){sl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){sl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H3=new zf(2e3,1e4);class Cu extends $1{constructor(e,t,s,a,l){super(e,t,a,l),this.provider=s,this.authWindow=null,this.pollId=null,Cu.currentPopupAction&&Cu.currentPopupAction.cancel(),Cu.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return kt(e,this.auth,"internal-error"),e}async onExecution(){sl(this.filter.length===1,"Popup operations only handle one event");const e=ev();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Ja(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Ja(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Cu.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ja(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,H3.get())};e()}}Cu.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G3="pendingRedirect",Tg=new Map;class Q3 extends $1{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}async execute(){let e=Tg.get(this.auth._key());if(!e){try{const s=await W3(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(t){e=()=>Promise.reject(t)}Tg.set(this.auth._key(),e)}return this.bypassAuthState||Tg.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function W3(r,e){const t=X3(e),s=Y3(r);if(!await s._isAvailable())return!1;const a=await s._get(t)==="true";return await s._remove(t),a}function K3(r,e){Tg.set(r._key(),e)}function Y3(r){return Ko(r._redirectPersistence)}function X3(r){return Ig(G3,r.config.apiKey,r.name)}async function J3(r,e,t=!1){if(si(r.app))return Promise.reject(Za(r));const s=_c(r),a=z3(s,e),c=await new Q3(s,a,t).execute();return c&&!t&&(delete c.user._redirectEventId,await s._persistUserIfCurrent(c.user),await s._setRedirectUser(null,e)),c}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z3=600*1e3;class e5{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!t5(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!B1(e)){const s=e.error.code?.split("auth/")[1]||"internal-error";t.onError(Ja(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Z3&&this.cachedEventUids.clear(),this.cachedEventUids.has(AE(e))}saveEventToCache(e){this.cachedEventUids.add(AE(e)),this.lastProcessedEventTime=Date.now()}}function AE(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(e=>e).join("-")}function B1({type:r,error:e}){return r==="unknown"&&e?.code==="auth/no-auth-event"}function t5(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return B1(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n5(r,e={}){return dl(r,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s5=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,r5=/^https?/;async function i5(r){if(r.config.emulator)return;const{authorizedDomains:e}=await n5(r);for(const t of e)try{if(a5(t))return}catch{}ba(r,"unauthorized-domain")}function a5(r){const e=b0(),{protocol:t,hostname:s}=new URL(e);if(r.startsWith("chrome-extension://")){const c=new URL(r);return c.hostname===""&&s===""?t==="chrome-extension:"&&r.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&c.hostname===s}if(!r5.test(t))return!1;if(s5.test(r))return s===r;const a=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o5=new zf(3e4,6e4);function DE(){const r=eo().___jsl;if(r?.H){for(const e of Object.keys(r.H))if(r.H[e].r=r.H[e].r||[],r.H[e].L=r.H[e].L||[],r.H[e].r=[...r.H[e].L],r.CP)for(let t=0;t<r.CP.length;t++)r.CP[t]=null}}function l5(r){return new Promise((e,t)=>{function s(){DE(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{DE(),t(Ja(r,"network-request-failed"))},timeout:o5.get()})}if(eo().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(eo().gapi?.load)s();else{const a=JL("iframefcb");return eo()[a]=()=>{gapi.load?s():t(Ja(r,"network-request-failed"))},S1(`${XL()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw Cg=null,e})}let Cg=null;function c5(r){return Cg=Cg||l5(r),Cg}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d5=new zf(5e3,15e3),u5="__/auth/iframe",h5="emulator/auth/iframe",m5={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},f5=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function p5(r){const e=r.config;kt(e.authDomain,r,"auth-domain-config-required");const t=e.emulator?Ww(e,h5):`https://${r.config.authDomain}/${u5}`,s={apiKey:e.apiKey,appName:r.name,v:Cd},a=f5.get(r.config.apiHost);a&&(s.eid=a);const l=r._getFrameworks();return l.length&&(s.fw=l.join(",")),`${t}?${If(s).slice(1)}`}async function g5(r){const e=await c5(r),t=eo().gapi;return kt(t,r,"internal-error"),e.open({where:document.body,url:p5(r),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:m5,dontclear:!0},s=>new Promise(async(a,l)=>{await s.restyle({setHideOnLeave:!1});const c=Ja(r,"network-request-failed"),u=eo().setTimeout(()=>{l(c)},d5.get());function m(){eo().clearTimeout(u),a(s)}s.ping(m).then(m,()=>{l(c)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x5={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},y5=500,b5=600,w5="_blank",v5="http://localhost";class RE{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function N5(r,e,t,s=y5,a=b5){const l=Math.max((window.screen.availHeight-a)/2,0).toString(),c=Math.max((window.screen.availWidth-s)/2,0).toString();let u="";const m={...x5,width:s.toString(),height:a.toString(),top:l,left:c},p=Ys().toLowerCase();t&&(u=b1(p)?w5:t),x1(p)&&(e=e||v5,m.scrollbars="yes");const b=Object.entries(m).reduce((j,[D,O])=>`${j}${D}=${O},`,"");if($L(p)&&u!=="_self")return j5(e||"",u),new RE(null);const w=window.open(e||"",u,b);kt(w,r,"popup-blocked");try{w.focus()}catch{}return new RE(w)}function j5(r,e){const t=document.createElement("a");t.href=r,t.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _5="__/auth/handler",E5="emulator/auth/handler",S5=encodeURIComponent("fac");async function PE(r,e,t,s,a,l){kt(r.config.authDomain,r,"auth-domain-config-required"),kt(r.config.apiKey,r,"invalid-api-key");const c={apiKey:r.config.apiKey,appName:r.name,authType:t,redirectUrl:s,v:Cd,eventId:a};if(e instanceof C1){e.setDefaultLanguage(r.languageCode),c.providerId=e.providerId||"",pD(e.getCustomParameters())||(c.customParameters=JSON.stringify(e.getCustomParameters()));for(const[b,w]of Object.entries({}))c[b]=w}if(e instanceof Bf){const b=e.getScopes().filter(w=>w!=="");b.length>0&&(c.scopes=b.join(","))}r.tenantId&&(c.tid=r.tenantId);const u=c;for(const b of Object.keys(u))u[b]===void 0&&delete u[b];const m=await r._getAppCheckToken(),p=m?`#${S5}=${encodeURIComponent(m)}`:"";return`${I5(r)}?${If(u).slice(1)}${p}`}function I5({config:r}){return r.emulator?Ww(r,E5):`https://${r.authDomain}/${_5}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ab="webStorageSupport";class T5{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=L1,this._completeRedirectFn=J3,this._overrideRedirectResult=K3}async _openPopup(e,t,s,a){sl(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const l=await PE(e,t,s,b0(),a);return N5(e,l,ev())}async _openRedirect(e,t,s,a){await this._originValidation(e);const l=await PE(e,t,s,b0(),a);return D3(l),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:a,promise:l}=this.eventManagers[t];return a?Promise.resolve(a):(sl(l,"If manager is not set, promise should be"),l)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){const t=await g5(e),s=new e5(e);return t.register("authEvent",a=>(kt(a?.authEvent,e,"invalid-auth-event"),{status:s.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ab,{type:Ab},a=>{const l=a?.[0]?.[Ab];l!==void 0&&t(!!l),ba(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=i5(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return _1()||y1()||Yw()}}const C5=T5;var kE="@firebase/auth",OE="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A5{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(s=>{e(s?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){kt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D5(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function R5(r){bd(new fc("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),l=e.getProvider("app-check-internal"),{apiKey:c,authDomain:u}=s.options;kt(c&&!c.includes(":"),"invalid-api-key",{appName:s.name});const m={apiKey:c,authDomain:u,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:E1(r)},p=new WL(s,a,l,m);return r3(p,t),p},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),bd(new fc("auth-internal",e=>{const t=_c(e.getProvider("auth").getImmediate());return(s=>new A5(s))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ka(kE,OE,D5(r)),Ka(kE,OE,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P5=300,k5=gS("authIdTokenMaxAge")||P5;let ME=null;const O5=r=>async e=>{const t=e&&await e.getIdTokenResult(),s=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>k5)return;const a=t?.token;ME!==a&&(ME=a,await fetch(r,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function q1(r=M0()){const e=Tf(r,"auth");if(e.isInitialized())return e.getImmediate();const t=s3(r,{popupRedirectResolver:C5,persistence:[V3,T3,L1]}),s=gS("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const l=new URL(s,location.origin);if(location.origin===l.origin){const c=O5(l.toString());_3(t,c,()=>c(t.currentUser)),j3(t,u=>c(u))}}const a=mS("auth");return a&&i3(t,`http://${a}`),t}function M5(){return document.getElementsByTagName("head")?.[0]??document}KL({loadJS(r){return new Promise((e,t)=>{const s=document.createElement("script");s.setAttribute("src",r),s.onload=e,s.onerror=a=>{const l=Ja("internal-error");l.customData=a,t(l)},s.type="text/javascript",s.charset="UTF-8",M5().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});R5("Browser");let j0;try{j0={apiKey:"AIzaSyCF4OZxfGELDmooid5mAL51l0t7Cxx6W3k",authDomain:"tender-74a2b.firebaseapp.com",projectId:"tender-74a2b",storageBucket:"tender-74a2b.firebasestorage.app",messagingSenderId:"300993197682",appId:"1:300993197682:web:e75fab78c4d6afc91ff4eb",measurementId:"G-D2CYMMNSB8"}}catch(r){console.error("Error loading Firebase config:",r),j0={}}let Su,De,ri,Yt;try{console.log("Initializing Firebase..."),Su=O0(j0);try{De=$O(Su),console.log("✅ Firestore initialized")}catch(r){console.error("Firestore initialization error:",r),De=null}try{ri=l1(Su),console.log("✅ Storage initialized")}catch(r){console.error("Storage initialization error:",r),ri=null}try{Yt=q1(Su),console.log("✅ Auth initialized")}catch(r){console.error("Auth initialization error:",r),Yt=null}console.log("✅ Firebase initialization completed")}catch(r){console.error("❌ Critical Firebase initialization error:",r),Su=null,De=null,ri=null,Yt=null}window.addEventListener("unhandledrejection",r=>{r.reason&&r.reason.message&&(r.reason.message.includes("_getRecaptchaConfig")||r.reason.message.includes("client is offline")||r.reason.message.includes("auth/network-request-failed"))&&(console.log("🔧 Suppressed Firebase error:",r.reason.message),r.preventDefault())});console.log("🔥 Firebase services status:",{app:!!Su,database:!!De,storage:!!ri,auth:!!Yt});class nv{constructor(e){this.collectionName=e,this.collectionRef=ct(De,e)}getCurrentUserId(){const e=Yt.currentUser;if(!e)throw new Error("User not authenticated");return e.uid}addOwnershipFields(e,t=!1){const a={ownerId:this.getCurrentUserId(),updatedAt:vt(),version:t?HT(1):1};return t||(a.createdAt=vt()),{...e,...a}}async create(e,t={}){try{console.log(`🔥 Creating document in ${this.collectionName}:`,e);const s=this.addOwnershipFields(e,!1),a={id:crypto.randomUUID(),...s,createdAt:new Date,updatedAt:new Date,version:1,_optimistic:!0};t.onOptimisticUpdate&&t.onOptimisticUpdate(a);try{const l=await Mr(this.collectionRef,s);console.log(`✅ Document created in Firestore: ${l.id}`);const c=await this.getById(l.id);return t.updateCache&&this.updateCache(c),t.onSuccess&&t.onSuccess(c),c}catch(l){throw console.error(`❌ Firestore create failed for ${this.collectionName}:`,l),t.onRollback&&t.onRollback(a),l}}catch(s){throw console.error("Error in create operation:",s),new Error(`فشل في إنشاء ${this.collectionName}: ${s.message}`)}}async update(e,t,s={}){try{console.log(`🔥 Updating document ${e} in ${this.collectionName}:`,t);const a=ut(De,this.collectionName,e),l=await cs(a);if(!l.exists())throw new Error("Document not found");const c=l.data(),u=this.getCurrentUserId();if(c.ownerId!==u)throw new Error("Unauthorized to update this document");const m=this.addOwnershipFields(t,!0),p={id:e,...c,...t,updatedAt:new Date,version:(c.version||1)+1,_optimistic:!0};s.onOptimisticUpdate&&s.onOptimisticUpdate(p);try{await Xs(a,m),console.log(`✅ Document updated in Firestore: ${e}`);const b=await this.getById(e);return s.updateCache&&this.updateCache(b),s.onSuccess&&s.onSuccess(b),b}catch(b){throw console.error(`❌ Firestore update failed for ${this.collectionName}:`,b),s.onRollback&&s.onRollback(c),b}}catch(a){throw a.message==="Document not found"?console.log(`📄 Document not found in ${this.collectionName} - will be handled by caller`):console.error("Error in update operation:",a),new Error(`فشل في تحديث ${this.collectionName}: ${a.message}`)}}async delete(e,t={}){try{console.log(`🔥 Deleting document ${e} from ${this.collectionName}`);const s=ut(De,this.collectionName,e),a=await cs(s);if(!a.exists())throw new Error("Document not found");const l=a.data(),c=this.getCurrentUserId();if(l.ownerId!==c)throw new Error("Unauthorized to delete this document");t.onOptimisticUpdate&&t.onOptimisticUpdate(null);try{return await Js(s),console.log(`✅ Document deleted from Firestore: ${e}`),t.updateCache&&this.removeFromCache(e),t.onSuccess&&t.onSuccess(),!0}catch(u){throw console.error(`❌ Firestore delete failed for ${this.collectionName}:`,u),t.onRollback&&t.onRollback(l),u}}catch(s){throw console.error("Error in delete operation:",s),new Error(`فشل في حذف ${this.collectionName}: ${s.message}`)}}async getById(e){try{const t=ut(De,this.collectionName,e),s=await cs(t);if(s.exists()){const a=s.data(),l=this.getCurrentUserId();if(a.ownerId!==l)throw new Error("Unauthorized to access this document");return{id:s.id,...a,createdAt:a.createdAt?.toDate(),updatedAt:a.updatedAt?.toDate()}}else return null}catch(t){throw console.error("Error fetching document by ID:",t),new Error(`فشل في جلب ${this.collectionName}: ${t.message}`)}}async getAll(e={}){try{const t=this.getCurrentUserId();let s=Vt(this.collectionRef,jn("ownerId","==",t));e.limit&&(s=Vt(s,YO(e.limit)));const l=(await St(s)).docs.map(c=>{const u=c.data();return{id:c.id,...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate()}});return console.log(`✅ Retrieved ${l.length} documents from ${this.collectionName}`),e.updateCache&&this.setCacheAll(l),l}catch(t){throw console.error("Error fetching all documents:",t),new Error(`فشل في جلب ${this.collectionName}: ${t.message}`)}}async search(e,t=[],s={}){try{const a=this.getCurrentUserId(),l=Vt(this.collectionRef,jn("ownerId","==",a)),m=(await St(l)).docs.map(p=>{const b=p.data();return{id:p.id,...b,createdAt:b.createdAt?.toDate(),updatedAt:b.updatedAt?.toDate()}}).filter(p=>t.some(b=>{const w=p[b];return typeof w=="string"?w.toLowerCase().includes(e.toLowerCase()):!1}));return console.log(`✅ Found ${m.length} matching documents in ${this.collectionName}`),m}catch(a){throw console.error("Error searching documents:",a),new Error(`فشل في البحث في ${this.collectionName}: ${a.message}`)}}async batchOperation(e){try{const t=Jo(De),s=this.getCurrentUserId();for(const a of e){const{type:l,id:c,data:u}=a;if(l==="create"){const m=ut(this.collectionRef),p=this.addOwnershipFields(u,!1);t.set(m,p)}else if(l==="update"){const m=ut(De,this.collectionName,c),p=await cs(m);if(p.exists()&&p.data().ownerId!==s)throw new Error(`Unauthorized to update document ${c}`);const b=this.addOwnershipFields(u,!0);t.update(m,b)}else if(l==="delete"){const m=ut(De,this.collectionName,c),p=await cs(m);if(p.exists()&&p.data().ownerId!==s)throw new Error(`Unauthorized to delete document ${c}`);t.delete(m)}}return await t.commit(),console.log(`✅ Batch operation completed for ${this.collectionName}`),!0}catch(t){throw console.error("Error in batch operation:",t),new Error(`فشل في العملية المجمعة لـ ${this.collectionName}: ${t.message}`)}}getCacheKey(){return`firestore_cache_${this.collectionName}`}updateCache(e){try{const t=this.getCacheKey(),s=JSON.parse(localStorage.getItem(t)||"[]"),a=s.findIndex(l=>l.id===e.id);a>=0?s[a]={...e,_cached:!0,_cachedAt:Date.now(),_checksum:this.generateChecksum(e)}:s.push({...e,_cached:!0,_cachedAt:Date.now(),_checksum:this.generateChecksum(e)}),localStorage.setItem(t,JSON.stringify(s))}catch(t){console.warn("Cache update failed:",t)}}setCacheAll(e){try{const t=this.getCacheKey(),s=e.map(a=>({...a,_cached:!0,_cachedAt:Date.now(),_checksum:this.generateChecksum(a)}));localStorage.setItem(t,JSON.stringify(s))}catch(t){console.warn("Cache set all failed:",t)}}removeFromCache(e){try{const t=this.getCacheKey(),a=JSON.parse(localStorage.getItem(t)||"[]").filter(l=>l.id!==e);localStorage.setItem(t,JSON.stringify(a))}catch(t){console.warn("Cache remove failed:",t)}}getFromCache(){try{const e=this.getCacheKey(),t=localStorage.getItem(e);return t?JSON.parse(t):[]}catch(e){return console.warn("Cache read failed:",e),[]}}generateChecksum(e){const t=JSON.stringify(e);let s=0;for(let a=0;a<t.length;a++){const l=t.charCodeAt(a);s=(s<<5)-s+l,s=s&s}return s.toString()}validateCacheIntegrity(e,t){const s=e._checksum,a=this.generateChecksum(t);return s===a}}const L5="modulepreload",F5=function(r){return"/Tender-app/"+r},LE={},ar=function(e,t,s){let a=Promise.resolve();if(t&&t.length>0){let p=function(b){return Promise.all(b.map(w=>Promise.resolve(w).then(j=>({status:"fulfilled",value:j}),j=>({status:"rejected",reason:j}))))};var c=p;document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),m=u?.nonce||u?.getAttribute("nonce");a=p(t.map(b=>{if(b=F5(b),b in LE)return;LE[b]=!0;const w=b.endsWith(".css"),j=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${b}"]${j}`))return;const D=document.createElement("link");if(D.rel=w?"stylesheet":L5,w||(D.as="script"),D.crossOrigin="",D.href=b,m&&D.setAttribute("nonce",m),document.head.appendChild(D),w)return new Promise((O,Q)=>{D.addEventListener("load",O),D.addEventListener("error",()=>Q(new Error(`Unable to preload CSS for ${b}`)))})}))}function l(u){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=u,window.dispatchEvent(m),!m.defaultPrevented)throw u}return a.then(u=>{for(const m of u||[])m.status==="rejected"&&l(m.reason);return e().catch(l)})};let _0;try{_0={apiKey:"AIzaSyCF4OZxfGELDmooid5mAL51l0t7Cxx6W3k",authDomain:"tender-74a2b.firebaseapp.com",projectId:"tender-74a2b",storageBucket:"tender-74a2b.firebasestorage.app",messagingSenderId:"300993197682",appId:"1:300993197682:web:e75fab78c4d6afc91ff4eb",measurementId:"G-D2CYMMNSB8"}}catch(r){console.error("Error loading Firebase config:",r),_0={}}let Iu,ef,Ag,to;try{console.log("🔥 Initializing Firebase with offline persistence..."),Iu=O0(_0);try{ef=zO(Iu,{localCache:eM({tabManager:rM()}),ignoreUndefinedProperties:!0}),console.log("✅ Firestore initialized with offline persistence")}catch(r){console.error("❌ Firestore initialization error:",r),ef=null}try{Ag=l1(Iu),console.log("✅ Storage initialized")}catch(r){console.error("❌ Storage initialization error:",r),Ag=null}try{to=q1(Iu),console.log("✅ Auth initialized")}catch(r){console.error("❌ Auth initialization error:",r),to=null}console.log("✅ Firebase initialization completed with offline persistence")}catch(r){console.error("❌ Critical Firebase initialization error:",r),Iu=null,ef=null,Ag=null,to=null}window.addEventListener("unhandledrejection",r=>{if(r.reason&&r.reason.message){const e=r.reason.message.toLowerCase();(e.includes("_getrecaptchaconfig")||e.includes("client is offline")||e.includes("auth/network-request-failed")||e.includes("failed to get document because the client is offline")||e.includes("the operation was aborted"))&&(console.log("🔧 Suppressed Firebase error:",r.reason.message),r.preventDefault())}});console.log("🔥 Firebase services status:",{app:!!Iu,database:!!ef,storage:!!Ag,auth:!!to,offlinePersistence:!!ef});class U5 extends nv{constructor(){super("usersettings"),this.currentUserId=null,this.settings={},this.listeners=new Set}async initialize(){try{if(!to.currentUser)throw new Error("User not authenticated");return this.currentUserId=to.currentUser.uid,await this.loadSettings(),this.settings}catch(e){return console.error("Error initializing user settings:",e),{}}}async loadSettings(){try{if(!this.currentUserId)throw new Error("User not initialized");const e=await this.getById(this.currentUserId);return e?this.settings=e.settings||{}:await this.createDefaultSettings(),this.notifyListeners(),this.settings}catch(e){return console.error("Error loading settings:",e),{}}}async createDefaultSettings(){try{const e={activityTimelineVisible:!1,sidebarCollapsed:!1,theme:"light",language:"ar",tablePageSize:10,defaultOrderBy:"createdAt",defaultSortDirection:"desc",showNotifications:!0,notificationSound:!0,autoSaveForms:!0,confirmBeforeDelete:!0,showHelpTips:!0,compactMode:!1},t={userId:this.currentUserId,settings:e,version:1};return await this.create(t),this.settings=e,e}catch(e){return console.error("Error creating default settings:",e),{}}}getSetting(e,t=null){return this.settings[e]!==void 0?this.settings[e]:t}async setSetting(e,t){try{this.currentUserId||await this.initialize(),this.settings[e]=t,this.notifyListeners();const s={...this.settings,[e]:t};try{await this.update(this.currentUserId,{settings:s,lastUpdated:new Date})}catch(a){if(a.message.includes("Document not found"))console.log("📄 Creating new user settings document for:",this.currentUserId),await this.create({id:this.currentUserId,ownerId:this.currentUserId,settings:s,createdAt:new Date,lastUpdated:new Date}),console.log("✅ User settings document created successfully");else throw a}return console.log(`✅ Setting updated: ${e} = ${t}`),!0}catch(s){return console.error(`Error setting ${e}:`,s),delete this.settings[e],this.notifyListeners(),!1}}async setSettings(e){try{this.currentUserId||await this.initialize();const t={...this.settings};Object.assign(this.settings,e),this.notifyListeners();const s={...this.settings,...e};return await this.update(this.currentUserId,{settings:s,lastUpdated:new Date}),console.log("✅ Multiple settings updated:",Object.keys(e)),!0}catch(t){return console.error("Error setting multiple settings:",t),this.settings=oldSettings,this.notifyListeners(),!1}}async resetSettings(){try{return await this.createDefaultSettings(),await this.update(this.currentUserId,{settings:this.settings,lastUpdated:new Date}),console.log("✅ Settings reset to defaults"),!0}catch(e){return console.error("Error resetting settings:",e),!1}}addListener(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(){this.listeners.forEach(e=>{try{e(this.settings)}catch(t){console.error("Error in settings listener:",t)}})}exportSettings(){return{userId:this.currentUserId,settings:this.settings,exportedAt:new Date().toISOString()}}async importSettings(e){try{return e.settings?(await this.setSettings(e.settings),console.log("✅ Settings imported successfully"),!0):!1}catch(t){return console.error("Error importing settings:",t),!1}}async setActivityTimelineVisible(e){return await this.setSetting("activityTimelineVisible",e)}getActivityTimelineVisible(){return this.getSetting("activityTimelineVisible",!1)}async setSidebarCollapsed(e){return await this.setSetting("sidebarCollapsed",e)}getSidebarCollapsed(){return this.getSetting("sidebarCollapsed",!1)}async setTheme(e){return await this.setSetting("theme",e)}getTheme(){return this.getSetting("theme","light")}async setTablePageSize(e){return await this.setSetting("tablePageSize",e)}getTablePageSize(){return this.getSetting("tablePageSize",10)}}const oi=new U5;to.onAuthStateChanged(async r=>{if(r)try{await oi.initialize(),console.log("✅ User settings initialized")}catch(e){console.error("Error initializing user settings:",e)}else oi.currentUserId=null,oi.settings={}});const H1=N.createContext(),$n=()=>{const r=N.useContext(H1);if(!r)throw new Error("useActivityTimeline must be used within an ActivityTimelineProvider");return r},V5=({children:r})=>{const[e,t]=N.useState(!1),[s,a]=N.useState(!0);N.useEffect(()=>{(async()=>{try{await oi.initialize();const m=oi.getActivityTimelineVisible();t(m),console.log("✅ Activity timeline visibility loaded from Firestore:",m)}catch(m){console.warn("⚠️ Firestore initialization failed, using fallback strategies:",m.message);try{const b=localStorage.getItem("activityTimelineVisible")==="true";t(b),console.log("📝 Fallback: Timeline state loaded from localStorage:",b)}catch(p){console.warn("⚠️ localStorage fallback failed, using defaults:",p.message),t(!1),console.log("🛡️ Using default timeline state: false")}}finally{a(!1),console.log("✅ Timeline initialization completed")}})()},[]),N.useEffect(()=>{const m=setTimeout(async()=>{if(!s)try{await oi.setActivityTimelineVisible(e),console.log("✅ Activity timeline visibility saved to Firestore:",e)}catch(p){console.warn("⚠️ Failed to save timeline state to Firestore (non-critical):",p.message);try{localStorage.setItem("activityTimelineVisible",e.toString()),console.log("📝 Fallback: Timeline state saved to localStorage")}catch(b){console.warn("⚠️ localStorage fallback also failed:",b.message)}}},500);return()=>clearTimeout(m)},[e,s]);const c={isTimelineVisible:e,setIsTimelineVisible:t,toggleTimeline:async()=>{const u=!e;t(u);try{await oi.setActivityTimelineVisible(u),console.log("✅ Timeline toggle saved to Firestore:",u)}catch(m){console.warn("⚠️ Failed to save timeline toggle to Firestore (non-critical):",m.message);try{localStorage.setItem("activityTimelineVisible",u.toString()),console.log("📝 Fallback: Timeline toggle saved to localStorage")}catch(p){console.warn("⚠️ localStorage fallback failed:",p.message)}}},loading:s};return n.jsx(H1.Provider,{value:c,children:r})};class Yi{static CATEGORIES_COLLECTION="global_categories";static UNITS_COLLECTION="global_units";static async getAllCategories(){try{const e=Vt(ct(De,this.CATEGORIES_COLLECTION),hs("name","asc")),t=await St(e),s=[];return t.forEach(a=>{s.push({id:a.id,...a.data()})}),console.log("✅ Loaded categories:",s.length),s}catch(e){throw console.error("❌ Error loading categories:",e),new Error("فشل في تحميل الفئات")}}static async createCategory(e){try{const t={...e,createdAt:vt(),updatedAt:vt()},s=await Mr(ct(De,this.CATEGORIES_COLLECTION),t);return console.log("✅ Category created:",s.id),s.id}catch(t){throw console.error("❌ Error creating category:",t),new Error("فشل في إنشاء الفئة")}}static async updateCategory(e,t){try{const s={...t,updatedAt:vt()};return await Xs(ut(De,this.CATEGORIES_COLLECTION,e),s),console.log("✅ Category updated:",e),!0}catch(s){throw console.error("❌ Error updating category:",s),new Error("فشل في تحديث الفئة")}}static async deleteCategory(e){try{return await Js(ut(De,this.CATEGORIES_COLLECTION,e)),console.log("✅ Category deleted:",e),!0}catch(t){throw console.error("❌ Error deleting category:",t),new Error("فشل في حذف الفئة")}}static async getAllUnits(){try{const e=Vt(ct(De,this.UNITS_COLLECTION),hs("name","asc")),t=await St(e),s=[];return t.forEach(a=>{s.push({id:a.id,...a.data()})}),console.log("✅ Loaded units:",s.length),s}catch(e){throw console.error("❌ Error loading units:",e),new Error("فشل في تحميل الوحدات")}}static async createUnit(e){try{const t={...e,createdAt:vt(),updatedAt:vt()},s=await Mr(ct(De,this.UNITS_COLLECTION),t);return console.log("✅ Unit created:",s.id),s.id}catch(t){throw console.error("❌ Error creating unit:",t),new Error("فشل في إنشاء الوحدة")}}static async updateUnit(e,t){try{const s={...t,updatedAt:vt()};return await Xs(ut(De,this.UNITS_COLLECTION,e),s),console.log("✅ Unit updated:",e),!0}catch(s){throw console.error("❌ Error updating unit:",s),new Error("فشل في تحديث الوحدة")}}static async deleteUnit(e){try{return await Js(ut(De,this.UNITS_COLLECTION,e)),console.log("✅ Unit deleted:",e),!0}catch(t){throw console.error("❌ Error deleting unit:",t),new Error("فشل في حذف الوحدة")}}static async getCategoryNames(){try{return(await this.getAllCategories()).map(t=>t.name)}catch(e){return console.error("❌ Error loading category names:",e),[]}}static async getUnitNames(){try{return(await this.getAllUnits()).map(t=>t.name)}catch(e){return console.error("❌ Error loading unit names:",e),[]}}static async initializeDefaultSettings(){try{if(console.log("🚀 Initializing default settings..."),(await this.getAllCategories()).length===0){console.log("📝 Creating default categories...");const s=[{name:"مواد البناء",description:"مواد البناء والإنشاءات",isDefault:!0},{name:"الأدوات والمعدات",description:"الأدوات والمعدات المختلفة",isDefault:!0},{name:"المواد الكهربائية",description:"المواد والمعدات الكهربائية",isDefault:!0},{name:"مواد السباكة",description:"مواد وأدوات السباكة",isDefault:!0},{name:"مواد التشطيب",description:"مواد التشطيب والديكور",isDefault:!0}];for(const a of s)await this.createCategory(a);console.log("✅ Default categories created")}if((await this.getAllUnits()).length===0){console.log("📝 Creating default units...");const s=[{name:"قطعة",description:"العدد بالقطع",isDefault:!0},{name:"متر",description:"وحدة الطول",isDefault:!0},{name:"متر مربع",description:"وحدة المساحة",isDefault:!0},{name:"متر مكعب",description:"وحدة الحجم",isDefault:!0},{name:"كيلو جرام",description:"وحدة الوزن",isDefault:!0},{name:"لتر",description:"وحدة السعة",isDefault:!0},{name:"طن",description:"وحدة الوزن الثقيل",isDefault:!0},{name:"صندوق",description:"العبوة الصندوقية",isDefault:!0}];for(const a of s)await this.createUnit(a);console.log("✅ Default units created")}return console.log("✅ Settings initialization completed"),!0}catch(e){throw console.error("❌ Error initializing default settings:",e),new Error("فشل في تهيئة الإعدادات الافتراضية")}}}const ys={SET_LOADING:"SET_LOADING",SET_ERROR:"SET_ERROR",SET_CATEGORIES:"SET_CATEGORIES",SET_UNITS:"SET_UNITS",ADD_CATEGORY:"ADD_CATEGORY",UPDATE_CATEGORY:"UPDATE_CATEGORY",REMOVE_CATEGORY:"REMOVE_CATEGORY",ADD_UNIT:"ADD_UNIT",UPDATE_UNIT:"UPDATE_UNIT",REMOVE_UNIT:"REMOVE_UNIT",SET_INITIALIZED:"SET_INITIALIZED"},z5={categories:[],units:[],loading:{categories:!0,units:!0,initializing:!0},error:{categories:null,units:null},initialized:!1,lastUpdated:{categories:null,units:null}},$5=(r,e)=>{switch(e.type){case ys.SET_LOADING:return{...r,loading:{...r.loading,[e.payload.type]:e.payload.loading}};case ys.SET_ERROR:return{...r,error:{...r.error,[e.payload.type]:e.payload.error}};case ys.SET_CATEGORIES:return{...r,categories:e.payload,loading:{...r.loading,categories:!1},error:{...r.error,categories:null},lastUpdated:{...r.lastUpdated,categories:new Date().toISOString()}};case ys.SET_UNITS:return{...r,units:e.payload,loading:{...r.loading,units:!1},error:{...r.error,units:null},lastUpdated:{...r.lastUpdated,units:new Date().toISOString()}};case ys.ADD_CATEGORY:return{...r,categories:[...r.categories,e.payload].sort((t,s)=>t.name.localeCompare(s.name)),lastUpdated:{...r.lastUpdated,categories:new Date().toISOString()}};case ys.UPDATE_CATEGORY:return{...r,categories:r.categories.map(t=>t.id===e.payload.id?{...t,...e.payload.data}:t).sort((t,s)=>t.name.localeCompare(s.name)),lastUpdated:{...r.lastUpdated,categories:new Date().toISOString()}};case ys.REMOVE_CATEGORY:return{...r,categories:r.categories.filter(t=>t.id!==e.payload),lastUpdated:{...r.lastUpdated,categories:new Date().toISOString()}};case ys.ADD_UNIT:return{...r,units:[...r.units,e.payload].sort((t,s)=>t.name.localeCompare(s.name)),lastUpdated:{...r.lastUpdated,units:new Date().toISOString()}};case ys.UPDATE_UNIT:return{...r,units:r.units.map(t=>t.id===e.payload.id?{...t,...e.payload.data}:t).sort((t,s)=>t.name.localeCompare(s.name)),lastUpdated:{...r.lastUpdated,units:new Date().toISOString()}};case ys.REMOVE_UNIT:return{...r,units:r.units.filter(t=>t.id!==e.payload),lastUpdated:{...r.lastUpdated,units:new Date().toISOString()}};case ys.SET_INITIALIZED:return{...r,initialized:!0,loading:{...r.loading,initializing:!1}};default:return r}},G1=N.createContext(),B5=({children:r})=>{const[e,t]=N.useReducer($5,z5);N.useEffect(()=>{console.log("🔥 Setting up real-time Firebase listeners for global settings...");let m,p;return(async()=>{try{await Yi.initializeDefaultSettings();const w=Vt(ct(De,Yi.CATEGORIES_COLLECTION),hs("name","asc"));m=vf(w,D=>{console.log("📋 Categories updated from Firebase:",D.docs.length);const O=D.docs.map(Q=>({id:Q.id,...Q.data()}));t({type:ys.SET_CATEGORIES,payload:O})},D=>{console.error("❌ Categories listener error:",D),t({type:ys.SET_ERROR,payload:{type:"categories",error:D.message}})});const j=Vt(ct(De,Yi.UNITS_COLLECTION),hs("name","asc"));p=vf(j,D=>{console.log("📏 Units updated from Firebase:",D.docs.length);const O=D.docs.map(Q=>({id:Q.id,...Q.data()}));t({type:ys.SET_UNITS,payload:O})},D=>{console.error("❌ Units listener error:",D),t({type:ys.SET_ERROR,payload:{type:"units",error:D.message}})}),t({type:ys.SET_INITIALIZED}),console.log("✅ Real-time listeners initialized successfully")}catch(w){console.error("❌ Failed to setup Firebase listeners:",w),t({type:ys.SET_ERROR,payload:{type:"categories",error:"Failed to initialize settings"}}),t({type:ys.SET_ERROR,payload:{type:"units",error:"Failed to initialize settings"}})}})(),()=>{console.log("🧹 Cleaning up Firebase listeners..."),m&&m(),p&&p()}},[]),N.useEffect(()=>{const m=p=>{p.key==="settings_force_refresh"&&console.log("🔄 Cross-tab settings refresh triggered")};return window.addEventListener("storage",m),()=>window.removeEventListener("storage",m)},[]);const s=N.useCallback((m,p)=>{t({type:ys.UPDATE_CATEGORY,payload:{id:m,data:p}})},[]),a=N.useCallback((m,p)=>{t({type:ys.UPDATE_UNIT,payload:{id:m,data:p}})},[]),l=N.useMemo(()=>({getCategoryNames:()=>e.categories.map(m=>m.name),getUnitNames:()=>e.units.map(m=>m.name),getCategoriesWithDetails:()=>e.categories.map(m=>({value:m.name,label:m.name,description:m.description,isDefault:m.isDefault})),getUnitsWithDetails:()=>e.units.map(m=>({value:m.name,label:m.name,name:m.name,description:m.description,isDefault:m.isDefault})),findCategoryByName:m=>e.categories.find(p=>p.name===m),findUnitByName:m=>e.units.find(p=>p.name===m),isReady:()=>e.initialized&&!e.loading.categories&&!e.loading.units,isLoading:()=>e.loading.categories||e.loading.units||e.loading.initializing}),[e.categories,e.units,e.initialized,e.loading]),c=N.useCallback(()=>{console.log("🔄 Force refreshing settings...");const m=new CustomEvent("settings_force_refresh",{detail:{timestamp:Date.now()}});window.dispatchEvent(m)},[]),u=N.useMemo(()=>({categories:e.categories,units:e.units,loading:e.loading,error:e.error,initialized:e.initialized,lastUpdated:e.lastUpdated,...l,dispatch:t,optimisticCategoryUpdate:s,optimisticUnitUpdate:a,forceRefresh:c,ACTIONS:ys}),[e,l,s,a,c]);return n.jsx(G1.Provider,{value:u,children:r})},Hf=()=>{const r=N.useContext(G1);return r||(console.warn("useSettings must be used within a SettingsProvider - returning default values"),{categories:[],units:[],loading:{categories:!0,units:!0,initializing:!0},error:{categories:null,units:null},initialized:!1,lastUpdated:{categories:null,units:null},getCategoryNames:()=>[],getUnitNames:()=>[],getCategoriesWithDetails:()=>[],getUnitsWithDetails:()=>[],findCategoryByName:()=>null,findUnitByName:()=>null,isReady:()=>!1,isLoading:()=>!0,dispatch:()=>{},optimisticCategoryUpdate:()=>{},optimisticUnitUpdate:()=>{},forceRefresh:()=>{},ACTIONS:ys})},q5=()=>{const r=Hf(),{categories:e=[],getCategoryNames:t=()=>[],getCategoriesWithDetails:s=()=>[],findCategoryByName:a=()=>null,loading:l={categories:!0},error:c={categories:null},isReady:u=()=>!1}=r||{};return N.useMemo(()=>({categories:e,categoryNames:t(),categoriesWithDetails:s(),findByName:a,loading:l.categories||!1,error:c.categories,isReady:u()&&e.length>0}),[e,t,s,a,l.categories,c.categories,u])},H5=()=>{const r=Hf(),{units:e=[],getUnitNames:t=()=>[],getUnitsWithDetails:s=()=>[],findUnitByName:a=()=>null,loading:l={units:!0},error:c={units:null},isReady:u=()=>!1}=r||{};return N.useMemo(()=>({units:e,unitNames:t(),unitsWithDetails:s(),findByName:a,loading:l.units||!1,error:c.units,isReady:u()&&e.length>0}),[e,t,s,a,l.units,c.units,u])},Dn=({show:r=!0,size:e="medium",overlay:t=!0,message:s="جاري التحميل..."})=>{if(!r)return null;const a=()=>{switch(e){case"small":return"spinner-small";case"large":return"spinner-large";default:return"spinner-medium"}},l=n.jsxs("div",{className:`modern-spinner-container ${a()}`,children:[n.jsxs("div",{className:"modern-spinner",children:[n.jsx("div",{className:"spinner-ring"}),n.jsx("div",{className:"spinner-ring"}),n.jsx("div",{className:"spinner-ring"}),n.jsx("div",{className:"spinner-ring"})]}),s&&n.jsx("div",{className:"spinner-message",children:s})]});return t?n.jsx("div",{className:"modern-spinner-overlay",children:l}):l},Q1=N.createContext(),W1=()=>{const r=N.useContext(Q1);if(!r)throw new Error("useAuth must be used within an AuthProvider");return r},G5=({children:r})=>{const[e,t]=N.useState(null),[s,a]=N.useState(null),[l,c]=N.useState(!0),[u,m]=N.useState(null),p=async j=>{try{if(!j)return a(null),null;const D=ut(De,"employees",j.uid),O=await cs(D);if(console.log("📄 Employee doc exists:",O.exists()),!O.exists())return console.warn("❌ No employee record found for user:",j.uid),console.warn("💡 This usually means the employee document was not created with the Auth UID"),console.log('🔧 To fix: Run window.createEmployeeForUser("'+j.uid+'") in console'),m("لا يوجد حساب موظف مرتبط بهذا المستخدم - تحقق من وحدة التحكم لإنشاء الحساب"),null;const Q=O.data();return console.log("📊 Employee data:",Q),Q.status!=="active"?(console.warn("❌ Employee account is not active:",Q.status),m("حسابك غير نشط. يرجى التواصل مع الإدارة"),null):(console.log("✅ Employee access granted:",{uid:j.uid,name:Q.fullName,email:Q.email,role:Q.role||"employee"}),a(Q),m(null),Q)}catch(D){return console.error("❌ Employee access check failed:",D),console.error("❌ Error details:",D),m(`خطأ في التحقق من صلاحيات الموظف: ${D.message}`),a(null),null}},b=async()=>{try{await E3(Yt),t(null),a(null),m(null),console.log("✅ Sign out successful")}catch(j){console.error("❌ Sign out error:",j)}};if(N.useEffect(()=>{console.log("🔧 Setting up auth state listener...");let j;try{j=Zw(Yt,async D=>{console.log("🔄 Auth state changed:",D?`User: ${D.uid}`:"No user"),c(!0);try{D?(console.log("👤 User authenticated, checking employee access..."),t(D),await p(D)):(console.log("👋 User signed out, showing login page"),t(null),a(null),m(null))}catch(O){if(O.message&&O.message.includes("_getRecaptchaConfig")){console.log("🔧 [AuthContext] Ignored reCAPTCHA error:",O.message);return}console.error("❌ Auth state change error:",O),m("خطأ في تحديث حالة المصادقة")}finally{c(!1)}})}catch(D){D.message&&D.message.includes("_getRecaptchaConfig")?console.log("🔧 [AuthContext] Ignored reCAPTCHA setup error:",D.message):(console.error("❌ Auth listener setup error:",D),m("خطأ في إعداد نظام المصادقة")),c(!1)}return()=>{if(console.log("🔧 Cleaning up auth listener"),j)try{j()}catch(D){D.message&&D.message.includes("_getRecaptchaConfig")?console.log("🔧 [AuthContext] Ignored reCAPTCHA cleanup error:",D.message):console.error("❌ Auth cleanup error:",D)}}},[]),N.useEffect(()=>{if(l){const j=setTimeout(()=>{console.log("⚠️ Authentication timeout - proceeding with demo mode"),c(!1),t({uid:"demo-user",email:"demo@demo.com"}),a({fullName:"Demo User",email:"demo@demo.com",status:"active",role:"admin"})},5e3);return()=>clearTimeout(j)}},[l]),l)return n.jsx("div",{className:"min-vh-100 d-flex align-items-center justify-content-center bg-light",children:n.jsxs("div",{className:"text-center",children:[n.jsx(Dn,{size:"large"}),n.jsxs("div",{className:"mt-3",children:[n.jsx("h5",{className:"text-muted",children:"جار تحميل النظام..."}),n.jsx("p",{className:"text-muted small",children:"يرجى الانتظار"}),n.jsx("p",{className:"text-muted small",children:"سيتم التحميل تلقائياً خلال 5 ثواني..."})]})]})});const w={currentUser:e,employeeData:s,authError:u,signOut:b,isAuthenticated:!!(e&&s&&s.status==="active"),isLoading:l,checkEmployeeAccess:p};return n.jsx(Q1.Provider,{value:w,children:r})},Rn=({show:r,onClose:e,title:t,message:s,type:a="info",onConfirm:l,confirmText:c="تأكيد",cancelText:u="إلغاء",showCancel:m=!1})=>{if(!r)return null;const p=()=>{switch(a){case"success":return{icon:"bi-check-circle-fill",color:"text-success",bgColor:"bg-success"};case"error":return{icon:"bi-exclamation-triangle-fill",color:"text-danger",bgColor:"bg-danger"};case"warning":return{icon:"bi-exclamation-triangle",color:"text-warning",bgColor:"bg-warning"};case"confirm":return{icon:"bi-question-circle-fill",color:"text-primary",bgColor:"bg-primary"};default:return{icon:"bi-info-circle-fill",color:"text-info",bgColor:"bg-info"}}},{icon:b,color:w,bgColor:j}=p(),D=()=>{console.log("CustomAlert handleConfirm called"),console.log("onConfirm:",l),console.log("onClose:",e),l&&(console.log("Calling onConfirm"),l()),console.log("Calling onClose"),e()},O=()=>{e()};return n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},children:n.jsx("div",{className:"modal-dialog modal-dialog-centered modal-sm",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",overflow:"hidden"},children:[n.jsx("div",{className:"modal-header border-0 text-white p-3",style:{background:a==="error"?"linear-gradient(135deg, #dc3545 0%, #b02a37 100%)":a==="success"?"linear-gradient(135deg, #28a745 0%, #1e7e34 100%)":a==="warning"?"linear-gradient(135deg, #ffc107 0%, #e0a800 100%)":a==="confirm"?"linear-gradient(135deg, #007bff 0%, #0056b3 100%)":"linear-gradient(135deg, #17a2b8 0%, #138496 100%)"},children:n.jsxs("div",{className:"d-flex align-items-center w-100 justify-content-center",children:[n.jsx("i",{className:`${b} me-2`,style:{fontSize:"20px"}}),n.jsx("h6",{className:"modal-title mb-0 fw-bold",children:t})]})}),n.jsx("div",{className:"modal-body py-4 px-4",children:n.jsx("div",{className:"text-center",children:n.jsx("p",{className:"mb-0",style:{fontSize:"14px",lineHeight:"1.5",color:"#333"},children:s})})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-4 d-flex justify-content-center",children:n.jsxs("div",{className:"d-flex gap-3",children:[m&&n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:O,autoFocus:!0,tabIndex:"1",style:{borderRadius:"8px",height:"36px",fontSize:"13px",fontWeight:"600",width:"80px",background:"linear-gradient(135deg, #6c757d 0%, #495057 100%)",border:"none",color:"white"},children:u}),n.jsx("button",{type:"button",className:"btn btn-sm",onClick:D,autoFocus:!1,tabIndex:m?"2":"1",style:{borderRadius:"8px",height:"36px",fontSize:"13px",fontWeight:"600",width:m?"80px":"100px",background:a==="error"?"linear-gradient(135deg, #dc3545 0%, #b02a37 100%)":a==="success"?"linear-gradient(135deg, #28a745 0%, #1e7e34 100%)":a==="warning"?"linear-gradient(135deg, #ffc107 0%, #e0a800 100%)":"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none",color:a==="warning"?"#000":"#fff"},children:c})]})})]})})})},Pn=()=>{const[r,e]=N.useState({show:!1,title:null,message:null,type:"info",onConfirm:null,confirmText:"تأكيد",cancelText:"إلغاء",showCancel:!1}),[t,s]=N.useState(!1);N.useEffect(()=>{console.log("alertConfig changed:",r)},[r]);const a=()=>{if(t){console.log("closeAlert already in progress, ignoring");return}console.log("closeAlert called"),console.log("Current alertConfig before close:",r),s(!0),e(j=>(console.log("Setting show to false"),{...j,show:!1})),setTimeout(()=>{s(!1)},100)},l=j=>{console.log("showAlert called with config:",j);const D={show:!0,title:j.title||"تنبيه",message:j.message||"",type:j.type||"info",onConfirm:j.onConfirm||null,confirmText:j.confirmText||"تأكيد",cancelText:j.cancelText||"إلغاء",showCancel:j.showCancel||!1};console.log("Setting alertConfig to:",D),e(D)};return{alertConfig:r,closeAlert:a,showAlert:l,showSuccess:(j,D="نجح العملية")=>{console.log("showSuccess called:",j,D),l({title:D,message:j,type:"success",confirmText:"حسناً",onConfirm:null})},showError:(j,D="خطأ")=>{l({title:D,message:j,type:"error",confirmText:"حسناً"})},showWarning:(j,D="تحذير")=>{l({title:D,message:j,type:"warning",confirmText:"حسناً"})},showInfo:(j,D="معلومات")=>{l({title:D,message:j,type:"info",confirmText:"حسناً"})},showConfirm:(j,D,O="تأكيد العملية")=>{l({title:O,message:j,type:"confirm",onConfirm:D,confirmText:"تأكيد",cancelText:"إلغاء",showCancel:!0})},showDeleteConfirm:(j,D,O="تأكيد الحذف")=>{l({title:O,message:j,type:"confirm",onConfirm:D,confirmText:"حذف",cancelText:"إلغاء",showCancel:!0})}}},Q5=({onSignIn:r})=>{const[e,t]=N.useState({email:"",password:"",rememberMe:!1}),[s,a]=N.useState(!1),[l,c]=N.useState({}),[u,m]=N.useState(!1),{alertConfig:p,closeAlert:b,showError:w,showSuccess:j}=Pn(),[D,O]=N.useState("");N.useEffect(()=>{O("animate-in"),(async()=>{try{await oi.initialize();const oe=oi.getSetting("rememberedEmail");oe&&t(Y=>({...Y,email:oe,rememberMe:!0}))}catch(oe){console.error("Error loading remembered email:",oe)}})()},[]);const Q=J=>{const{name:oe,value:Y,type:be,checked:M}=J.target;t(H=>({...H,[oe]:be==="checkbox"?M:Y})),l[oe]&&c(H=>({...H,[oe]:""}))},z=()=>{const J={};return e.email.trim()?/\S+@\S+\.\S+/.test(e.email)||(J.email="البريد الإلكتروني غير صحيح"):J.email="البريد الإلكتروني مطلوب",e.password.trim()?e.password.length<6&&(J.password="كلمة المرور يجب أن تكون 6 أحرف على الأقل"):J.password="كلمة المرور مطلوبة",c(J),Object.keys(J).length===0},I=async J=>{try{const oe=ut(De,"employees",J),Y=await cs(oe);if(!Y.exists())throw new Error("لا يوجد حساب موظف مرتبط بهذا البريد الإلكتروني");const be=Y.data();if(be.status!=="active")throw new Error("حسابك غير نشط. يرجى التواصل مع الإدارة");try{await Xs(ut(De,"employees",J),{lastLoginAt:vt(),loginCount:HT(1),updatedAt:vt()})}catch(M){console.log("Login tracking update failed:",M)}return be}catch(oe){throw console.error("Employee status check failed:",oe),oe}},ee=async J=>{if(J.preventDefault(),!!z()){a(!0);try{const oe=await w3(Yt,e.email.trim(),e.password),Y=await I(oe.user.uid);e.rememberMe?await oi.setSetting("rememberedEmail",e.email.trim()):await oi.removeSetting("rememberedEmail"),console.log("✅ Sign-in successful:",{uid:oe.user.uid,email:oe.user.email,employeeName:Y.fullName,role:Y.role||"employee"}),j(`مرحباً بك، ${Y.fullName}`,"تم تسجيل الدخول بنجاح"),r&&r({user:oe.user,employee:Y})}catch(oe){console.error("Sign-in error:",oe);let Y="خطأ في تسجيل الدخول";switch(oe.code){case"auth/user-not-found":case"auth/wrong-password":case"auth/invalid-credential":Y="البريد الإلكتروني أو كلمة المرور غير صحيحة";break;case"auth/user-disabled":Y="تم تعطيل هذا الحساب. يرجى التواصل مع الإدارة";break;case"auth/too-many-requests":Y="محاولات كثيرة جداً. يرجى المحاولة لاحقاً";break;case"auth/network-request-failed":Y="خطأ في الاتصال. يرجى التحقق من الإنترنت";break;default:Y=oe.message||"خطأ غير معروف";break}w(Y,"فشل في تسجيل الدخول")}finally{a(!1)}}};return n.jsxs("div",{className:`login-page ${D}`,children:[n.jsx("div",{className:"login-background",children:n.jsx("div",{className:"login-container",children:n.jsxs("div",{className:"row min-vh-100 g-0",children:[n.jsx("div",{className:"col-lg-6",children:n.jsxs("div",{className:"login-form-panel",children:[n.jsxs("div",{className:"login-form-container",children:[n.jsxs("div",{className:"mobile-logo d-lg-none text-center mb-4",children:[n.jsx("div",{className:"logo-circle-small",children:n.jsx("i",{className:"bi bi-building-fill"})}),n.jsx("h4",{className:"mt-3 mb-0",children:"نظام إدارة المناقصات"}),n.jsx("p",{className:"text-muted small",children:"تسجيل دخول الموظفين"})]}),n.jsxs("div",{className:"login-form",children:[n.jsxs("div",{className:"form-header text-center mb-4",children:[n.jsx("h3",{className:"login-title",children:"تسجيل الدخول"}),n.jsx("p",{className:"login-subtitle text-muted",children:"أدخل بياناتك للوصول إلى النظام"})]}),n.jsxs("form",{onSubmit:ee,className:"needs-validation",noValidate:!0,children:[n.jsxs("div",{className:"form-group mb-3",children:[n.jsx("label",{className:"form-label",children:"البريد الإلكتروني"}),n.jsxs("div",{className:"input-group input-group-modern",children:[n.jsx("span",{className:"input-group-text",children:n.jsx("i",{className:"bi bi-envelope"})}),n.jsx("input",{type:"email",className:`form-control ${l.email?"is-invalid":""}`,name:"email",value:e.email,onChange:Q,placeholder:"أدخل بريدك الإلكتروني",disabled:s,autoComplete:"email"}),l.email&&n.jsx("div",{className:"invalid-feedback",children:l.email})]})]}),n.jsxs("div",{className:"form-group mb-3",children:[n.jsx("label",{className:"form-label",children:"كلمة المرور"}),n.jsxs("div",{className:"input-group input-group-modern",children:[n.jsx("span",{className:"input-group-text",children:n.jsx("i",{className:"bi bi-lock"})}),n.jsx("input",{type:u?"text":"password",className:`form-control ${l.password?"is-invalid":""}`,name:"password",value:e.password,onChange:Q,placeholder:"أدخل كلمة المرور",disabled:s,autoComplete:"current-password"}),n.jsx("button",{type:"button",className:"input-group-text btn-show-password",onClick:()=>m(!u),disabled:s,children:n.jsx("i",{className:`bi ${u?"bi-eye-slash":"bi-eye"}`})}),l.password&&n.jsx("div",{className:"invalid-feedback",children:l.password})]})]}),n.jsx("div",{className:"form-group mb-4",children:n.jsxs("div",{className:"form-check",children:[n.jsx("input",{className:"form-check-input",type:"checkbox",name:"rememberMe",checked:e.rememberMe,onChange:Q,id:"rememberMe",disabled:s}),n.jsx("label",{className:"form-check-label",htmlFor:"rememberMe",children:"تذكرني في هذا الجهاز"})]})}),n.jsx("button",{type:"submit",className:"btn btn-login w-100",disabled:s,children:s?n.jsxs(n.Fragment,{children:[n.jsx(Dn,{size:"small"}),n.jsx("span",{className:"ms-2",children:"جار تسجيل الدخول..."})]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-box-arrow-in-right me-2"}),"تسجيل الدخول"]})})]}),n.jsx("div",{className:"security-notice mt-4",children:n.jsxs("div",{className:"notice-card",children:[n.jsx("div",{className:"notice-icon",children:n.jsx("i",{className:"bi bi-shield-fill-check text-success"})}),n.jsxs("div",{className:"notice-content",children:[n.jsx("h6",{className:"mb-1",children:"نظام آمن ومحمي"}),n.jsx("p",{className:"mb-0 small text-muted",children:"هذا النظام مخصص للموظفين المعتمدين فقط. جميع الأنشطة مراقبة ومسجلة لضمان الأمان."})]})]})})]})]}),n.jsx("div",{className:"login-footer",children:n.jsx("p",{className:"text-center text-muted small mb-0",children:"© 2024 نظام إدارة المناقصات. جميع الحقوق محفوظة."})})]})}),n.jsx("div",{className:"col-lg-6 d-none d-lg-flex",children:n.jsxs("div",{className:"login-brand-panel",children:[n.jsxs("div",{className:"brand-content",children:[n.jsx("div",{className:"company-logo mb-4",children:n.jsx("div",{className:"logo-circle",children:n.jsx("i",{className:"bi bi-building-fill"})})}),n.jsxs("div",{className:"company-info text-center mb-5",children:[n.jsx("h2",{className:"company-name",children:"نظام إدارة المناقصات"}),n.jsx("p",{className:"company-subtitle",children:"منصة متكاملة لإدارة المناقصات والموردين"}),n.jsxs("div",{className:"company-features mt-4",children:[n.jsxs("div",{className:"feature-item",children:[n.jsx("i",{className:"bi bi-check-circle-fill feature-icon"}),n.jsx("span",{children:"إدارة شاملة للمناقصات"})]}),n.jsxs("div",{className:"feature-item",children:[n.jsx("i",{className:"bi bi-check-circle-fill feature-icon"}),n.jsx("span",{children:"تتبع دقيق للموردين"})]}),n.jsxs("div",{className:"feature-item",children:[n.jsx("i",{className:"bi bi-check-circle-fill feature-icon"}),n.jsx("span",{children:"تقارير مفصلة وتحليلات"})]})]})]})]}),n.jsxs("div",{className:"decorative-elements",children:[n.jsx("div",{className:"floating-card floating-1",children:n.jsx("i",{className:"bi bi-graph-up text-primary"})}),n.jsx("div",{className:"floating-card floating-2",children:n.jsx("i",{className:"bi bi-people text-info"})}),n.jsx("div",{className:"floating-card floating-3",children:n.jsx("i",{className:"bi bi-award text-warning"})})]})]})})]})})}),n.jsx(Rn,{show:p.show,onClose:b,title:p.title,message:p.message,type:p.type,onConfirm:p.onConfirm,confirmText:p.confirmText,cancelText:p.cancelText,showCancel:p.showCancel})]})},W5=({onSignIn:r})=>n.jsx(Q5,{onSignIn:r}),K5=({children:r})=>{const{currentUser:e,employeeData:t,authError:s,isAuthenticated:a,isLoading:l}=W1(),{alertConfig:c,closeAlert:u,showError:m}=Pn();return S0.useEffect(()=>{s&&m(s,"خطأ في المصادقة")},[s,m]),l?null:(console.log("🔍 ProtectedRoute Debug:",{isAuthenticated:a,hasCurrentUser:!!e,currentUserUid:e?.uid,hasEmployeeData:!!t,employeeDataStatus:t?.status,isLoading:l}),!a||!e||!t?n.jsxs(n.Fragment,{children:[n.jsx(W5,{onSignIn:p=>{console.log("✅ User signed in successfully:",p)}}),n.jsx(Rn,{show:c.show,onClose:u,title:c.title,message:c.message,type:c.type,onConfirm:c.onConfirm,confirmText:c.confirmText,cancelText:c.cancelText,showCancel:c.showCancel})]}):(console.log("🚀 SUCCESS! Rendering dashboard for authenticated user:",t.fullName),console.log("🎉 Navigation successful - user will see dashboard now"),n.jsx("div",{className:"app-wrapper",children:r})))},Y5=({children:r})=>n.jsx(G5,{children:n.jsx(K5,{children:r})}),K1="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNTguNDMgMTUxLjI4Ij4KICA8ZGVmcz4KICAgIDxzdHlsZT4KICAgICAgLmNscy0xIHsKICAgICAgICBmaWxsOiAjMTBhMGMxOwogICAgICB9CgogICAgICAuY2xzLTIgewogICAgICAgIGZvbnQtZmFtaWx5OiBDYWlyby1Cb2xkLCBDYWlybzsKICAgICAgICBmb250LXNpemU6IDY1cHg7CiAgICAgICAgZm9udC13ZWlnaHQ6IDcwMDsKICAgICAgfQoKICAgICAgLmNscy0zIHsKICAgICAgICBmaWxsOiAjMTg2MmE0OwogICAgICB9CgogICAgICAuY2xzLTQgewogICAgICAgIGZpbGw6IG5vbmU7CiAgICAgICAgc3Ryb2tlOiAjMTg2MmE0OwogICAgICAgIHN0cm9rZS1taXRlcmxpbWl0OiAxMDsKICAgICAgICBzdHJva2Utd2lkdGg6IDRweDsKICAgICAgfQogICAgPC9zdHlsZT4KICA8L2RlZnM+CiAgPGc+CiAgICA8bGluZSBjbGFzcz0iY2xzLTQiIHgxPSIzLjQzIiB5MT0iMTQ1LjIzIiB4Mj0iMzU4LjQzIiB5Mj0iMTQ1LjIzIi8+CiAgICA8bGluZSBjbGFzcz0iY2xzLTMiIHgxPSIzLjQzIiB5MT0iMTQ1LjIzIiB4Mj0iMzU4LjQzIiB5Mj0iMTQ1LjIzIi8+CiAgPC9nPgogIDxwb2x5bGluZSBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMS4xMiA2My44NCA4NC42MSA3LjY0IDk4LjcyIDE0Ljk3IDk4LjcyIDIgMTA4Ljk4IDIgMTA4Ljk4IDE5LjE3IDIwMi43IDY0Ljk4IDM1Mi4yNyA2Mi45NiIvPgogIDx0ZXh0IGNsYXNzPSJjbHMtMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTUuMzQgMTIzLjMzKSI+PHRzcGFuIGNsYXNzPSJjbHMtMSIgeD0iMCIgeT0iMCI+TW9kZXJuIDwvdHNwYW4+PHRzcGFuIGNsYXNzPSJjbHMtMyIgeD0iMjMyLjUiIHk9IjAiPkJpbjwvdHNwYW4+PC90ZXh0Pgo8L3N2Zz4=",Y1="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='176.459'%20height='110.288'%20viewBox='0%200%20176.459%20110.288'%3e%3cg%20id='Group_1'%20data-name='Group%201'%20transform='translate(-824.544%20-530.958)'%3e%3crect%20id='Rectangle_4'%20data-name='Rectangle%204'%20width='31.194'%20height='31.194'%20transform='translate(868.659%20553.016)%20rotate(45)'%20fill='%230073d8'%20opacity='0.6'/%3e%3cpath%20id='Rectangle_11'%20data-name='Rectangle%2011'%20d='M0,0H31.194V31.194H4a4,4,0,0,1-4-4Z'%20transform='translate(846.602%20575.073)%20rotate(45)'%20fill='%230073d8'%20opacity='0.8'/%3e%3crect%20id='Rectangle_7'%20data-name='Rectangle%207'%20width='31.194'%20height='31.194'%20transform='translate(912.774%20553.016)%20rotate(45)'%20fill='%230073d8'%20opacity='0.6'/%3e%3crect%20id='Rectangle_9'%20data-name='Rectangle%209'%20width='31.194'%20height='31.194'%20transform='translate(890.716%20575.073)%20rotate(45)'%20fill='%230073d8'%20opacity='0.8'/%3e%3cpath%20id='Rectangle_13'%20data-name='Rectangle%2013'%20d='M0,0H31.194V27.194a4,4,0,0,1-4,4H0Z'%20transform='translate(912.774%20597.131)%20rotate(45)'%20fill='%230073d8'/%3e%3cpath%20id='Rectangle_14'%20data-name='Rectangle%2014'%20d='M0,0H31.194V27.194a4,4,0,0,1-4,4H0Z'%20transform='translate(868.659%20597.131)%20rotate(45)'%20fill='%230073d8'/%3e%3cpath%20id='Rectangle_15'%20data-name='Rectangle%2015'%20d='M0,0H31.194V27.194a4,4,0,0,1-4,4H0Z'%20transform='translate(956.889%20597.131)%20rotate(45)'%20fill='%230073d8'/%3e%3crect%20id='Rectangle_10'%20data-name='Rectangle%2010'%20width='31.194'%20height='31.194'%20transform='translate(934.831%20575.073)%20rotate(45)'%20fill='%230073d8'%20opacity='0.8'/%3e%3cpath%20id='Rectangle_12'%20data-name='Rectangle%2012'%20d='M0,0H27.194a4,4,0,0,1,4,4V31.194H0Z'%20transform='translate(978.946%20575.073)%20rotate(45)'%20fill='%230073d8'%20opacity='0.8'/%3e%3crect%20id='Rectangle_8'%20data-name='Rectangle%208'%20width='31.194'%20height='31.194'%20transform='translate(956.889%20553.016)%20rotate(45)'%20fill='%230073d8'%20opacity='0.6'/%3e%3cpath%20id='Rectangle_5'%20data-name='Rectangle%205'%20d='M3,0H31.194V31.194H0V3A3,3,0,0,1,3,0Z'%20transform='translate(890.716%20530.958)%20rotate(45)'%20fill='%230073d8'%20opacity='0.4'/%3e%3cpath%20id='Rectangle_6'%20data-name='Rectangle%206'%20d='M3,0H31.194V31.194H0V3A3,3,0,0,1,3,0Z'%20transform='translate(934.831%20530.958)%20rotate(45)'%20fill='%230073d8'%20opacity='0.4'/%3e%3c/g%3e%3c/svg%3e",X1="/Tender-app/assets/user-j_vc7Skz.png",J1="/Tender-app/assets/pdf-icon-BuliPzEH.png",Z1="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='14'%20height='32'%20viewBox='0%200%2014%2032'%3e%3cpath%20id='Path_2'%20data-name='Path%202'%20d='M968.1,368.23v32l-14-15.835Z'%20transform='translate(-954.096%20-368.23)'%20fill='%23ffffff'/%3e%3c/svg%3e",X5="/Tender-app/assets/pattern-CSTPcgov.jpg",J5="/Tender-app/assets/pattern2-B3pp2NSn.jpg",Z5="/Tender-app/assets/pattern3-BmHwT9sp.jpg",e4="/Tender-app/assets/pattern4-CitLwaNA.jpg",t4="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='6.697'%20height='28.873'%20viewBox='0%200%206.697%2028.873'%3e%3cg%20id='Group_1'%20data-name='Group%201'%20transform='translate(-984.438%20-402.547)'%3e%3cpath%20id='Path_1'%20data-name='Path%201'%20d='M965.5,414l-5.137,6.779,4.861,7.062-4.861,7.041,5.1,7.1'%20transform='translate(25%20-11)'%20fill='none'%20stroke='%23e2dfdc'%20stroke-width='1.5'/%3e%3c/g%3e%3c/svg%3e",n4="/Tender-app/assets/dots-Bt3MqLUB.svg";class s4{constructor(){this.imageCache=new Map,this.initializeImages()}initializeImages(){this.images={"logo.svg":K1,"logo-sm.svg":Y1,"user.png":X1,"pdf-icon.png":J1,"menu-arrow.svg":Z1,"pattern.jpg":X5,"pattern2.jpg":J5,"pattern3.jpg":Z5,"pattern4.jpg":e4,"curve-line.svg":t4,"dots.svg":n4}}getImage(e){return this.images[e]?this.images[e]:`/images/${e}`}getAllImages(){return this.images}injectImageCSS(){if(typeof document>"u")return;const e=document.createElement("style");e.id="senior-react-images";const t=document.getElementById("senior-react-images");t&&t.remove();const s=[":root {",`  --image-logo: url("${this.getImage("logo.svg")}");`,`  --image-logo-sm: url("${this.getImage("logo-sm.svg")}");`,`  --image-user: url("${this.getImage("user.png")}");`,`  --image-pdf-icon: url("${this.getImage("pdf-icon.png")}");`,`  --image-menu-arrow: url("${this.getImage("menu-arrow.svg")}");`,`  --image-pattern: url("${this.getImage("pattern.jpg")}");`,`  --image-pattern2: url("${this.getImage("pattern2.jpg")}");`,`  --image-pattern3: url("${this.getImage("pattern3.jpg")}");`,`  --image-pattern4: url("${this.getImage("pattern4.jpg")}");`,`  --image-curve-line: url("${this.getImage("curve-line.svg")}");`,`  --image-dots: url("${this.getImage("dots.svg")}");`,"}","","/* Fix main.scss background images */",".pattern-bg:nth-child(1) { background: var(--image-pattern) !important; }",".pattern-bg:nth-child(2) { background: var(--image-pattern2) !important; }",".pattern-bg:nth-child(3) { background: var(--image-pattern3) !important; }",".pattern-bg:nth-child(4) { background: var(--image-pattern4) !important; }","","/* Fix menu arrow in CSS */",".sidebar-menu > li.active > a::after,",".menu-arrow::before { background: var(--image-menu-arrow) !important; }","","/* Fix curve line */",".curve-line { background: var(--image-curve-line) repeat-y !important; }","","/* Fix dots */",".dots-bg { background: var(--image-dots) no-repeat !important; }"];e.textContent=s.join(`
`),document.head.appendChild(e)}}const ox=new s4,Dg=r=>ox.getImage(r),r4=()=>ox.injectImageCSS();typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>ox.injectImageCSS(),100)}):setTimeout(()=>ox.injectImageCSS(),100));function Wn({isCollapsed:r}){const e=il(),[t,s]=N.useState("dashboard");N.useEffect(()=>{const Z=e.pathname;Z==="/"||Z==="/tender"?(s("dashboard"),u(!1)):Z==="/raw-materials"?(s("raw-materials"),u(!0)):Z==="/local-products"?(s("local-product"),u(!0)):Z==="/foreign-products"?(s("imported-product"),u(!0)):Z==="/suppliers/local"?(s("local-suppliers"),p(!0),u(!1)):Z==="/suppliers/foreign"?(s("foreign-suppliers"),p(!0),u(!1)):Z==="/clients"?(s("clients"),u(!1)):Z==="/companies"?(s("companies"),u(!1)):Z==="/tenders/list"?(s("list"),l(!0),u(!1)):Z==="/tenders/add"||Z.startsWith("/tenders/edit/")?(s("add"),l(!0),u(!1)):Z==="/tenders/tracking"?(s("tracking"),l(!0),u(!1)):Z==="/employees"?(s("employees"),u(!1)):(s("dashboard"),u(!1))},[e.pathname]);const[a,l]=N.useState(!1),[c,u]=N.useState(!1),[m,p]=N.useState(!1),b=[{id:"dashboard",type:"main",component:"dashboard"},{id:"tenders",type:"treeview",component:"tenders"},{id:"tender-details",type:"treeview",component:"tender-details"},{id:"suppliers",type:"treeview",component:"suppliers"},{id:"clients",type:"main",component:"clients"},{id:"companies",type:"main",component:"companies"},{id:"employees",type:"main",component:"employees"}],w=[{id:"list",type:"sub",component:"list"},{id:"add",type:"sub",component:"add"},{id:"tracking",type:"sub",component:"tracking"}],j=[{id:"raw-materials",type:"sub",component:"raw-materials"},{id:"local-product",type:"sub",component:"local-product"},{id:"imported-product",type:"sub",component:"imported-product"},{id:"manufactured-product",type:"sub",component:"manufactured-product"}],D=[{id:"local-suppliers",type:"sub",component:"local-suppliers"},{id:"foreign-suppliers",type:"sub",component:"foreign-suppliers"}],O=(Z,je)=>{try{const Ge=localStorage.getItem(Z);if(Ge){const Ke=JSON.parse(Ge);if(Array.isArray(Ke)&&Ke.length===je.length)return Ke}}catch(Ge){console.error("Error loading saved order:",Ge)}return je},[Q,z]=N.useState(()=>O("sidebar-menu-items",b)),[I,ee]=N.useState(()=>O("sidebar-tender-sub-items",w)),[J,oe]=N.useState(()=>O("sidebar-tender-detail-sub-items",j)),[Y,be]=N.useState(()=>O("sidebar-supplier-sub-items",D));N.useEffect(()=>{localStorage.setItem("sidebar-menu-items",JSON.stringify(Q))},[Q]),N.useEffect(()=>{localStorage.setItem("sidebar-tender-sub-items",JSON.stringify(I))},[I]),N.useEffect(()=>{localStorage.setItem("sidebar-tender-detail-sub-items",JSON.stringify(J))},[J]),N.useEffect(()=>{localStorage.setItem("sidebar-supplier-sub-items",JSON.stringify(Y))},[Y]);const[M,H]=N.useState(()=>{try{const Z=localStorage.getItem("sidebar-sort-enabled");return Z!==null?JSON.parse(Z):!1}catch{return!1}});N.useEffect(()=>{localStorage.setItem("sidebar-sort-enabled",JSON.stringify(M))},[M]);const k=()=>{H(!M)},[$,X]=N.useState(null),[te,F]=N.useState(null),ce=(Z,je,Ge)=>{X(je),F(Ge),Z.dataTransfer.effectAllowed="move"},Be=Z=>{Z.preventDefault(),Z.dataTransfer.dropEffect="move"},U=(Z,je,Ge)=>{if(Z.preventDefault(),!(!$||$.id===je.id||te!==Ge)){if(Ge==="main"){const Ke=[...Q],ft=Ke.findIndex(Ee=>Ee.id===$.id),Ot=Ke.findIndex(Ee=>Ee.id===je.id);Ke.splice(ft,1),Ke.splice(Ot,0,$),z(Ke)}else if(Ge==="tender-sub"){const Ke=[...I],ft=Ke.findIndex(Ee=>Ee.id===$.id),Ot=Ke.findIndex(Ee=>Ee.id===je.id);Ke.splice(ft,1),Ke.splice(Ot,0,$),ee(Ke)}else if(Ge==="tender-detail-sub"){const Ke=[...J],ft=Ke.findIndex(Ee=>Ee.id===$.id),Ot=Ke.findIndex(Ee=>Ee.id===je.id);Ke.splice(ft,1),Ke.splice(Ot,0,$),oe(Ke)}else if(Ge==="supplier-sub"){const Ke=[...Y],ft=Ke.findIndex(Ee=>Ee.id===$.id),Ot=Ke.findIndex(Ee=>Ee.id===je.id);Ke.splice(ft,1),Ke.splice(Ot,0,$),be(Ke)}X(null),F(null)}},se=()=>{X(null),F(null)},fe=Z=>n.jsx("li",{className:t==="dashboard"?"active current-page":"",style:r?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:$&&$.id===Z.id?.5:1,transition:"opacity 0.2s ease"},draggable:!r&&M,onDragStart:M?je=>ce(je,Z,"main"):void 0,onDragOver:M?Be:void 0,onDrop:M?je=>U(je,Z,"main"):void 0,onDragEnd:M?se:void 0,children:n.jsxs(Ho,{to:"/tender",onClick:je=>{if(je.target.closest(".drag-handle")){je.preventDefault();return}s("dashboard")},style:r?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",width:"100%"},children:[!r&&M&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),n.jsx("i",{className:"bi bi-pie-chart",style:r?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:t==="dashboard"?"#0073d8 !important":"transparent !important",color:t==="dashboard"?"white !important":"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!r&&n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:"لوحة التحكم"})]})},Z.id),ie=Z=>n.jsxs("li",{className:`treeview ${a?"open":""}`,style:r?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:$&&$.id===Z.id?.5:1,transition:"opacity 0.2s ease"},"data-collapsed":r,draggable:!r&&M,onDragStart:M?je=>ce(je,Z,"main"):void 0,onDragOver:M?Be:void 0,onDrop:M?je=>U(je,Z,"main"):void 0,onDragEnd:M?se:void 0,children:[n.jsxs("a",{href:"#!",onClick:je=>{if(je.target.closest(".drag-handle")){je.preventDefault();return}l(!a)},style:r?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",color:"#4d4d4d !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",color:"#4d4d4d",width:"100%"},children:[!r&&M&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),n.jsx("i",{className:"bi bi-box-seam",style:r?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:"transparent !important",color:"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!r&&n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:"المناقصات"})]}),a&&!r&&n.jsx("ul",{className:"treeview-menu",children:I.map(je=>E(je))})]},Z.id),_=Z=>n.jsxs("li",{className:`treeview ${c?"open":""}`,style:r?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:$&&$.id===Z.id?.5:1,transition:"opacity 0.2s ease"},"data-collapsed":r,draggable:!r&&M,onDragStart:M?je=>ce(je,Z,"main"):void 0,onDragOver:M?Be:void 0,onDrop:M?je=>U(je,Z,"main"):void 0,onDragEnd:M?se:void 0,children:[n.jsxs("a",{href:"#!",onClick:je=>{if(je.target.closest(".drag-handle")){je.preventDefault();return}u(!c)},style:r?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",color:"#4d4d4d !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",color:"#4d4d4d",width:"100%"},children:[!r&&M&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),n.jsx("i",{className:"bi bi-clipboard-data",style:r?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:"transparent !important",color:"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!r&&n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:"بنود المناقصات"})]}),c&&!r&&n.jsx("ul",{className:"treeview-menu",children:J.map(je=>R(je))})]},Z.id),E=Z=>{const Ge={list:{to:"/tenders/list",icon:"bi-list-ul",text:"جميع المناقصات"},add:{to:"/tenders/add",icon:"bi-plus-circle",text:"إضافة مناقصة"},tracking:{to:"/tenders/tracking",icon:"bi-kanban",text:"متابعة المناقصات"}}[Z.id];if(!Ge)return null;const Ke=Ee=>{Ee.stopPropagation(),ce(Ee,Z,"tender-sub")},ft=Ee=>{Ee.stopPropagation(),Be(Ee)},Ot=Ee=>{Ee.stopPropagation(),U(Ee,Z,"tender-sub")};return n.jsx("li",{className:t===Z.id?"active":"",style:{opacity:$&&$.id===Z.id?.5:1,transition:"opacity 0.2s ease"},draggable:M,onDragStart:M?Ke:void 0,onDragOver:M?ft:void 0,onDrop:M?Ot:void 0,onDragEnd:M?se:void 0,children:Ge.to?n.jsxs(Ho,{to:Ge.to,onClick:Ee=>{if(Ee.target.closest(".drag-handle")){Ee.preventDefault();return}s(Z.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[M&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:Ee=>Ee.stopPropagation()}),n.jsx("i",{className:Ge.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:Ge.text})]}):n.jsxs("a",{href:"#!",onClick:Ee=>{if(Ee.target.closest(".drag-handle")){Ee.preventDefault();return}Ee.preventDefault(),s(Z.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[M&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:Ee=>Ee.stopPropagation()}),n.jsx("i",{className:Ge.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:Ge.text})]})},Z.id)},R=Z=>{const Ge={"raw-materials":{to:"/raw-materials",icon:"bi-gear",text:"مواد خام"},"local-product":{to:"/local-products",icon:"bi-house",text:"منتج محلي"},"imported-product":{to:"/foreign-products",icon:"bi-globe",text:"منتج مستورد"},"manufactured-product":{icon:"bi-tools",text:"منتج مصنع"}}[Z.id];if(!Ge)return null;const Ke=it=>{it.stopPropagation(),ce(it,Z,"tender-detail-sub")},ft=it=>{it.stopPropagation(),Be(it)},Ot=it=>{it.stopPropagation(),U(it,Z,"tender-detail-sub")},Ee=Z.id==="raw-materials"||Z.id==="local-product"||Z.id==="imported-product";return n.jsx("li",{className:t===Z.id?"active":"",style:{opacity:$&&$.id===Z.id?.5:1,transition:"opacity 0.2s ease"},draggable:M,onDragStart:M?Ke:void 0,onDragOver:M?ft:void 0,onDrop:M?Ot:void 0,onDragEnd:M?se:void 0,children:Ee?n.jsxs(Ho,{to:Ge.to,onClick:it=>{if(it.target.closest(".drag-handle")){it.preventDefault();return}s(Z.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[M&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:it=>it.stopPropagation()}),n.jsx("i",{className:Ge.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:Ge.text})]}):n.jsxs("a",{href:"#!",onClick:it=>{if(it.target.closest(".drag-handle")){it.preventDefault();return}it.preventDefault(),s(Z.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[M&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:it=>it.stopPropagation()}),n.jsx("i",{className:Ge.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:Ge.text})]})},Z.id)},V=Z=>{const Ge={"local-suppliers":{to:"/suppliers/local",icon:"bi-house-fill",text:"مورد محلي"},"foreign-suppliers":{to:"/suppliers/foreign",icon:"bi-globe",text:"مورد أجنبي"}}[Z.id];if(!Ge)return null;const Ke=Ee=>{Ee.stopPropagation(),ce(Ee,Z,"supplier-sub")},ft=Ee=>{Ee.stopPropagation(),Be(Ee)},Ot=Ee=>{Ee.stopPropagation(),U(Ee,Z,"supplier-sub")};return n.jsx("li",{className:t===Z.id?"active":"",style:{opacity:$&&$.id===Z.id?.5:1,transition:"opacity 0.2s ease"},draggable:M,onDragStart:M?Ke:void 0,onDragOver:M?ft:void 0,onDrop:M?Ot:void 0,onDragEnd:M?se:void 0,children:n.jsxs(Ho,{to:Ge.to,onClick:Ee=>{if(Ee.target.closest(".drag-handle")){Ee.preventDefault();return}s(Z.id)},style:{display:"flex",alignItems:"center",padding:"7px 35px 7px 15px",textDecoration:"none",marginRight:"0px"},children:[M&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.8rem",color:"#aaa",marginLeft:"5px",cursor:"grab"},onMouseDown:Ee=>Ee.stopPropagation()}),n.jsx("i",{className:Ge.icon,style:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginLeft:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:Ge.text})]})},Z.id)},ne=Z=>n.jsxs("li",{className:`treeview ${m?"open":""}`,style:r?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:$&&$.id===Z.id?.5:1,transition:"opacity 0.2s ease"},"data-collapsed":r,draggable:!r&&M,onDragStart:M?je=>ce(je,Z,"main"):void 0,onDragOver:M?Be:void 0,onDrop:M?je=>U(je,Z,"main"):void 0,onDragEnd:M?se:void 0,children:[n.jsxs("a",{href:"#!",onClick:je=>{if(je.target.closest(".drag-handle")){je.preventDefault();return}p(!m)},style:r?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",color:"#4d4d4d !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",color:"#4d4d4d",width:"100%"},children:[!r&&M&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),n.jsx("i",{className:"bi bi-people-fill",style:r?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:"transparent !important",color:"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!r&&n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:"الموردون"})]}),m&&!r&&n.jsx("ul",{className:"treeview-menu",children:Y.map(je=>V(je))})]},Z.id),B=Z=>n.jsx("li",{className:t==="clients"?"active current-page":"",style:r?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:$&&$.id===Z.id?.5:1,transition:"opacity 0.2s ease"},draggable:!r&&M,onDragStart:M?je=>ce(je,Z,"main"):void 0,onDragOver:M?Be:void 0,onDrop:M?je=>U(je,Z,"main"):void 0,onDragEnd:M?se:void 0,children:n.jsxs(Ho,{to:"/clients",onClick:je=>{if(je.target.closest(".drag-handle")){je.preventDefault();return}s("clients")},style:r?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",width:"100%"},children:[!r&&M&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),n.jsx("i",{className:"bi bi-person-vcard-fill",style:r?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:t==="clients"?"#0073d8 !important":"transparent !important",color:t==="clients"?"white !important":"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!r&&n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:"العملاء"})]})},Z.id),q=Z=>n.jsx("li",{className:t==="companies"?"active current-page":"",style:r?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:$&&$.id===Z.id?.5:1,transition:"opacity 0.2s ease"},draggable:!r&&M,onDragStart:M?je=>ce(je,Z,"main"):void 0,onDragOver:M?Be:void 0,onDrop:M?je=>U(je,Z,"main"):void 0,onDragEnd:M?se:void 0,children:n.jsxs(Ho,{to:"/companies",onClick:je=>{if(je.target.closest(".drag-handle")){je.preventDefault();return}s("companies")},style:r?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",width:"100%"},children:[!r&&M&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),n.jsx("i",{className:"bi bi-building",style:r?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:t==="companies"?"#0073d8 !important":"transparent !important",color:t==="companies"?"white !important":"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!r&&n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:"الشركات"})]})},Z.id),me=Z=>n.jsx("li",{className:t==="employees"?"active current-page":"",style:r?{display:"flex !important",justifyContent:"center !important",alignItems:"center !important",width:"72px !important",margin:"0 !important",padding:"0 !important"}:{opacity:$&&$.id===Z.id?.5:1,transition:"opacity 0.2s ease"},draggable:!r&&M,onDragStart:M?je=>ce(je,Z,"main"):void 0,onDragOver:M?Be:void 0,onDrop:M?je=>U(je,Z,"main"):void 0,onDragEnd:M?se:void 0,children:n.jsxs(Ho,{to:"/employees",onClick:je=>{if(je.target.closest(".drag-handle")){je.preventDefault();return}s("employees")},style:r?{display:"flex !important",alignItems:"center !important",justifyContent:"center !important",padding:"10px 0 !important",textDecoration:"none !important",width:"72px !important",margin:"0 auto !important",position:"relative !important",left:"0 !important",right:"0 !important"}:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"7px 12px 7px 15px",textDecoration:"none",width:"100%"},children:[!r&&M&&n.jsx("i",{className:"bi bi-grip-vertical drag-handle",style:{fontSize:"0.9rem",color:"#888",marginLeft:"8px",cursor:"grab"}}),n.jsx("i",{className:"bi bi-person-badge-fill",style:r?{fontSize:"1.1rem !important",display:"flex !important",alignItems:"center !important",justifyContent:"center !important",visibility:"visible !important",opacity:"1 !important",width:"36px !important",height:"36px !important",borderRadius:"4px !important",background:t==="employees"?"#0073d8 !important":"transparent !important",color:t==="employees"?"white !important":"inherit !important",position:"absolute !important",left:"18px !important",top:"50% !important",transform:"translateY(-50%) !important",margin:"0 !important",padding:"0 !important"}:{fontSize:"1.1rem",flexShrink:0,background:"#f5f6fa",width:"36px",height:"36px",marginRight:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"}}),!r&&n.jsx("span",{className:"menu-text",style:{whiteSpace:"nowrap"},children:"الموظفون"})]})},Z.id),C=Z=>{switch(Z.component){case"dashboard":return fe(Z);case"tenders":return ie(Z);case"tender-details":return _(Z);case"suppliers":return ne(Z);case"clients":return B(Z);case"companies":return q(Z);case"employees":return me(Z);default:return null}};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"shop-profile",style:{padding:r?"0.5rem":"1rem",textAlign:r?"center":"right",display:"flex",alignItems:"center",justifyContent:r?"center":"flex-end"},children:r?n.jsx("img",{src:Dg("logo.svg"),alt:"Modern Bin",style:{width:"40px",height:"40px",objectFit:"contain"}}):n.jsxs(n.Fragment,{children:[n.jsx("p",{className:"mb-1 fw-bold text-primary",style:{opacity:r?0:1,transition:"opacity 0.3s ease"},children:"شركة الحاويات الحديثة"}),n.jsx("p",{className:"m-0",style:{opacity:r?0:1,transition:"opacity 0.3s ease"},children:"للمقاولات"})]})}),n.jsxs("div",{className:"sidebarMenuScroll",style:{position:"relative"},children:[n.jsx("ul",{className:"sidebar-menu",children:Q.map(Z=>C(Z))}),n.jsx("div",{className:"sidebar-sort-toggle",style:{position:"fixed",right:r?"15px":"20px",bottom:"20px",zIndex:1050,background:M?"#28a745":"#0d6efd",color:"white",width:r?"46px":"52px",height:r?"46px":"52px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",transition:"all 0.3s ease",transform:"scale(1)"},onClick:k,onMouseEnter:Z=>{Z.target.style.transform="scale(1.1)",Z.target.style.boxShadow="0 6px 16px rgba(0,0,0,0.2)"},onMouseLeave:Z=>{Z.target.style.transform="scale(1)",Z.target.style.boxShadow="0 4px 12px rgba(0,0,0,0.15)"},title:M?"تعطيل الترتيب":"تفعيل الترتيب",children:n.jsx("i",{className:`bi ${M?"bi-arrows-move":"bi-lock"}`,style:{fontSize:r?"18px":"20px",transition:"transform 0.2s ease"}})})]})]})}function Kn({onToggle:r}){const{isTimelineVisible:e,toggleTimeline:t}=$n();return N.useEffect(()=>{r4()},[]),n.jsx(n.Fragment,{children:n.jsx("div",{className:"app-header-wrapper",children:n.jsxs("div",{className:"app-header d-flex align-items-center px-3",children:[n.jsxs("div",{className:"d-flex align-items-end",children:[n.jsx("button",{onClick:r,type:"button",style:{border:"0",borderRight:"1px solid #e8ebf4",background:"transparent",marginLeft:"10px",padding:"1.35rem 1.5rem",cursor:"pointer",marginBottom:"-11px"},children:n.jsx("i",{className:"bi bi-list lh-1",style:{color:"#0073d8",fontSize:"1.8rem"}})}),n.jsxs("div",{className:"app-brand py-2",style:{marginTop:"-8px",marginRight:"-20px"},children:[n.jsx("a",{href:"/",className:"d-sm-block d-none",children:n.jsx("img",{src:Dg("logo.svg"),className:"logo",alt:"Modern Bin",style:{height:"40px",width:"auto"}})}),n.jsx("a",{href:"/",className:"d-sm-none d-block",children:n.jsx("img",{src:Dg("logo-sm.svg"),className:"logo",alt:"Modern Bin",style:{height:"40px",width:"auto"}})})]})]}),n.jsxs("div",{className:"header-actions col d-lg-flex d-none",children:[n.jsx("div",{className:"activity-toggle-container d-flex align-items-center me-3",children:n.jsx("button",{onClick:t,className:"d-flex align-items-center justify-content-center position-relative",style:{width:"48px",height:"48px",background:e?"linear-gradient(135deg, #007bff 0%, #0056b3 100%)":"linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",borderRadius:"12px",color:e?"white":"#6c757d",border:"none",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},onMouseOver:s=>{s.target.style.transform="translateY(-2px)",s.target.style.boxShadow="0 4px 15px rgba(0, 0, 0, 0.15)"},onMouseOut:s=>{s.target.style.transform="translateY(0)",s.target.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)"},title:e?"إخفاء الأنشطة":"إظهار الأنشطة",children:n.jsx("i",{className:`bi ${e?"bi-clock-history":"bi-clock"} fs-5 lh-1`})})}),n.jsx("div",{className:"trash-icon-container d-flex align-items-center me-3",children:n.jsx("a",{href:"/trash",className:"d-flex align-items-center justify-content-center position-relative",style:{width:"48px",height:"48px",background:"linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%)",borderRadius:"12px",color:"#6c757d",textDecoration:"none",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",border:"none"},onMouseOver:s=>{s.target.closest("a").style.transform="translateY(-2px)",s.target.closest("a").style.boxShadow="0 4px 15px rgba(0, 0, 0, 0.15)"},onMouseOut:s=>{s.target.closest("a").style.transform="translateY(0)",s.target.closest("a").style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)"},title:"سلة المهملات",children:n.jsx("i",{className:"bi bi-trash fs-5 lh-1"})})})]}),n.jsxs("div",{className:"dropdown ms-2",children:[n.jsxs("a",{className:"dropdown-toggle d-flex py-2 align-items-center text-decoration-none",href:"#!",role:"button","data-bs-toggle":"dropdown",children:[n.jsx("img",{src:Dg("user.png"),className:"rounded-2 img-3x",alt:"User"}),n.jsx("span",{className:"ms-2 text-truncate d-lg-block d-none",children:"آن سانتياغو"})]}),n.jsxs("div",{className:"dropdown-menu dropdown-menu-end shadow-lg",children:[n.jsxs("div",{className:"header-action-links mx-3 gap-2",children:[n.jsxs("a",{className:"dropdown-item",href:"profile.html",children:[n.jsx("i",{className:"bi bi-person text-primary"})," الملف الشخصي"]}),n.jsxs("a",{className:"dropdown-item",href:"settings.html",children:[n.jsx("i",{className:"bi bi-gear text-danger"})," الإعدادات"]}),n.jsxs("a",{className:"dropdown-item",href:"widgets.html",children:[n.jsx("i",{className:"bi bi-box text-success"})," الأدوات"]})]}),n.jsx("div",{className:"mx-3 mt-2 d-grid",children:n.jsx("a",{href:"login.html",className:"btn btn-primary btn-sm",children:"تسجيل الخروج"})})]})]})]})})})}function Yn(){const[r,e]=N.useState(["المبيعات"]),[t,s]=N.useState(!0),a=["المشتريات","المبيعات","الحسابات","الموظفون","التصميم"];N.useEffect(()=>{(async()=>{try{await oi.initialize();const u=oi.getSetting("sidebar-active-button");u&&e([u])}catch(u){console.error("Error loading active button:",u)}finally{s(!1)}})()},[]),N.useEffect(()=>{!t&&r.length>0&&oi.setSetting("sidebar-active-button",r[0])},[r,t]);const l=c=>{a.includes(c)&&(r.includes(c)||e([c]))};return n.jsx("div",{className:"rectangle-buttons-row px-3 py-2",style:{backgroundColor:"#e6f3ff",borderBottom:"1px solid #b3d9ff"},children:n.jsx("div",{className:"d-flex align-items-center gap-3",children:a.map((c,u)=>{const m=r.includes(c);return n.jsx("div",{className:"rectangle-button d-flex align-items-center justify-content-center",onClick:()=>l(c),style:{background:m?"linear-gradient(135deg, #007bff 0%, #0056b3 100%)":"#e9ecef",border:`1px solid ${m?"#0056b3":"#dee2e6"}`,borderRadius:"6px",padding:"4px 8px",fontSize:"12px",color:m?"white":"#212529",transition:"all 0.2s ease",cursor:"pointer",minHeight:"24px",width:"80px",textAlign:"center"},onMouseEnter:p=>{m?(p.currentTarget.style.background="linear-gradient(135deg, #0056b3 0%, #004085 100%)",p.currentTarget.style.borderColor="#004085"):(p.currentTarget.style.background="#dee2e6",p.currentTarget.style.borderColor="#ced4da")},onMouseLeave:p=>{m?(p.currentTarget.style.background="linear-gradient(135deg, #007bff 0%, #0056b3 100%)",p.currentTarget.style.borderColor="#0056b3"):(p.currentTarget.style.background="#e9ecef",p.currentTarget.style.borderColor="#dee2e6")},children:n.jsx("span",{children:c})},u)})})})}const Db={RAW_MATERIAL:"rm",LOCAL_PRODUCT:"lp",FOREIGN_PRODUCT:"fp",MANUFACTURED_PRODUCT:"mp",TENDER:"tdr",CUSTOMER:"cst",LOCAL_SUPPLIER:"ls",FOREIGN_SUPPLIER:"fs",COMPANY:"comp",EMPLOYEE:"emp",PRICE_QUOTE:"pq",TENDER_ITEM:"ti",ORDER:"ord",INVOICE:"inv",ACTIVITY:"act",TRASH_ITEM:"trs"},Ct=(r,e=null)=>{if(!Db[r])throw new Error(`Invalid entity type: ${r}. Valid types: ${Object.keys(Db).join(", ")}`);const t=Db[r],s=Date.now().toString(36),a=Math.random().toString(36).substring(2,8);return e?`${t}_${e}_${s}${a}`:`${t}_${s}${a}`};class hd extends nv{constructor(){super("activitylogs"),this.currentUserId=null,this.activities=[],this.listeners=new Set,this.maxActivities=1e3}async initialize(){try{if(!to.currentUser)throw new Error("User not authenticated");return this.currentUserId=to.currentUser.uid,await this.loadActivities(),this.activities}catch(e){return console.error("Error initializing activity log:",e),[]}}async loadActivities(){try{if(!this.currentUserId)throw new Error("User not initialized");const t=(await this.getAll({limit:this.maxActivities*2})||[]).sort((s,a)=>{const l=new Date(s.createdAt);return new Date(a.createdAt)-l}).slice(0,this.maxActivities);return this.activities=t,this.notifyListeners(),console.log(`✅ Loaded ${this.activities.length} activities from Firestore (sorted client-side)`),this.activities}catch(e){return console.error("Error loading activities:",e),[]}}async logActivity(e,t,s={}){try{this.currentUserId||await this.initialize();const a={internalId:Ct("ACTIVITY"),type:e,description:t,details:s,timestamp:new Date,userId:this.currentUserId,userAgent:navigator.userAgent,url:window.location.pathname};this.activities.unshift(a),this.notifyListeners();try{const l=await this.create(a),c=this.activities.findIndex(u=>u.internalId===a.internalId);return c>=0&&(this.activities[c]=l,this.notifyListeners()),this.activities.length>this.maxActivities&&await this.cleanupOldActivities(),console.log(`✅ Activity logged: ${e} - ${t}`),l}catch(l){throw console.error("Error saving activity to Firestore:",l),this.activities=this.activities.filter(c=>c.internalId!==a.internalId),this.notifyListeners(),l}}catch(a){return console.error("Error logging activity:",a),null}}getActivitiesByType(e){return this.activities.filter(t=>t.type===e)}getActivitiesByDateRange(e,t){return this.activities.filter(s=>{const a=new Date(s.timestamp);return a>=e&&a<=t})}getRecentActivities(e=50){return this.activities.slice(0,e)}searchActivities(e){const t=e.toLowerCase();return this.activities.filter(s=>s.description.toLowerCase().includes(t)||s.type.toLowerCase().includes(t)||s.details&&JSON.stringify(s.details).toLowerCase().includes(t))}async deleteActivity(e){try{return await this.delete(e),this.activities=this.activities.filter(t=>t.id!==e),this.notifyListeners(),console.log(`✅ Activity deleted: ${e}`),!0}catch(t){return console.error("Error deleting activity:",t),!1}}async clearAllActivities(){try{const e=this.activities.map(t=>this.delete(t.id).catch(s=>console.error(`Error deleting activity ${t.id}:`,s)));return await Promise.allSettled(e),this.activities=[],this.notifyListeners(),console.log("✅ All activities cleared"),!0}catch(e){return console.error("Error clearing activities:",e),!1}}async cleanupOldActivities(){try{if(this.activities.length<=this.maxActivities)return;const e=[...this.activities].sort((l,c)=>new Date(c.timestamp)-new Date(l.timestamp)),t=e.slice(0,this.maxActivities),s=e.slice(this.maxActivities),a=s.map(l=>this.delete(l.id).catch(c=>console.error(`Error deleting old activity ${l.id}:`,c)));await Promise.allSettled(a),this.activities=t,this.notifyListeners(),console.log(`✅ Cleaned up ${s.length} old activities`)}catch(e){console.error("Error cleaning up old activities:",e)}}addListener(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(){this.listeners.forEach(e=>{try{e(this.activities)}catch(t){console.error("Error in activity listener:",t)}})}getActivityStats(){const e={total:this.activities.length,byType:{},byDate:{},recentActivity:null};this.activities.forEach(s=>{e.byType[s.type]=(e.byType[s.type]||0)+1});const t=new Date(Date.now()-720*60*60*1e3);return this.activities.forEach(s=>{const a=new Date(s.timestamp);if(a>=t){const l=a.toDateString();e.byDate[l]=(e.byDate[l]||0)+1}}),this.activities.length>0&&(e.recentActivity=this.activities[0]),e}exportActivities(){return{userId:this.currentUserId,activities:this.activities,exportedAt:new Date().toISOString(),count:this.activities.length}}static ActivityTypes={TENDER_CREATE:"tender_create",TENDER_UPDATE:"tender_update",TENDER_DELETE:"tender_delete",TENDER_SUBMIT:"tender_submit",ITEM_ADD:"item_add",ITEM_UPDATE:"item_update",ITEM_DELETE:"item_delete",DOCUMENT_UPLOAD:"document_upload",DOCUMENT_DELETE:"document_delete",MATERIAL_CREATE:"material_create",MATERIAL_UPDATE:"material_update",MATERIAL_DELETE:"material_delete",SUPPLIER_CREATE:"supplier_create",SUPPLIER_UPDATE:"supplier_update",USER_LOGIN:"user_login",USER_LOGOUT:"user_logout",SETTINGS_UPDATE:"settings_update",DATA_IMPORT:"data_import",DATA_EXPORT:"data_export"};async logTenderCreate(e,t){return await this.logActivity(hd.ActivityTypes.TENDER_CREATE,`تم إنشاء مناقصة جديدة: ${e}`,{tenderInternalId:t,tenderTitle:e})}async logTenderUpdate(e,t){return await this.logActivity(hd.ActivityTypes.TENDER_UPDATE,`تم تحديث المناقصة: ${e}`,{tenderInternalId:t,tenderTitle:e})}async logItemAdd(e,t){return await this.logActivity(hd.ActivityTypes.ITEM_ADD,`تم إضافة بند: ${e} إلى مناقصة ${t}`,{itemName:e,tenderTitle:t})}async logDocumentUpload(e,t){return await this.logActivity(hd.ActivityTypes.DOCUMENT_UPLOAD,`تم رفع مستند: ${e} للمناقصة ${t}`,{fileName:e,tenderTitle:t})}async logUserLogin(){return await this.logActivity(hd.ActivityTypes.USER_LOGIN,"تم تسجيل الدخول",{loginTime:new Date().toISOString()})}}const ji=new hd;to.onAuthStateChanged(async r=>{if(r)try{await ji.initialize(),await ji.logUserLogin(),console.log("✅ Activity logging initialized")}catch(e){console.error("Error initializing activity logging:",e)}else ji.currentUserId=null,ji.activities=[]});const eC=N.createContext(),vn=()=>{const r=N.useContext(eC);if(!r)throw new Error("useActivity must be used within ActivityProvider");return r},sn=({children:r})=>{const[e,t]=N.useState([]),[s,a]=N.useState(!0),[l,c]=N.useState(null);N.useEffect(()=>{const ee=async()=>{try{a(!0),c(null),await ji.initialize();const oe=(ji.activities||[]).map(Y=>({...Y,status:Y.status==="open"?"done":Y.status}));t(oe),console.log(`✅ Loaded ${oe.length} activities from Firestore`)}catch(J){console.error("Error initializing activities:",J),c("فشل في تحميل سجل الأنشطة"),t([])}finally{a(!1)}};if(Yt.currentUser)ee();else return Yt.onAuthStateChanged(oe=>{oe?ee():(t([]),a(!1))})},[]),N.useEffect(()=>ji.addListener(J=>{if(J){const oe=J.map(Y=>({...Y,status:Y.status==="open"?"done":Y.status}));t(oe)}}),[]);const[u]=N.useState([{id:"user1",name:"أحمد محمد",avatarUrl:null},{id:"user2",name:"فاطمة السالم",avatarUrl:null},{id:"user3",name:"محمد عبدالله",avatarUrl:null},{id:"user4",name:"نورا أحمد",avatarUrl:null}]),m=()=>u[0],p=async(ee,J,oe,Y=!1)=>{try{const be=await ji.logActivity(ee,oe,{title:J,isManual:Y,status:"done",user:m(),at:Date.now(),createdAt:new Date().toISOString()});return be?(console.log("✅ Activity logged:",oe),be):(console.error("Failed to log activity:",oe),null)}catch(be){return console.error("Error logging activity:",be),null}},I={activities:e,users:u,loading:s,error:l,addActivity:p,logActivity:async(ee,J,oe)=>await p(ee,J,oe,!1),createManualActivity:async ee=>await p(ee.type,ee.title,ee.description,!0),updateActivityStatus:async(ee,J)=>{try{await ji.updateActivity(ee,{status:J})?console.log("✅ Activity status updated:",ee,J):console.error("Failed to update activity status:",ee)}catch(oe){console.error("Error updating activity status:",oe)}},deleteActivity:async ee=>{try{await ji.deleteActivity(ee)?console.log("✅ Activity deleted:",ee):console.error("Failed to delete activity:",ee)}catch(J){console.error("Error deleting activity:",J)}},clearAllActivities:async()=>{try{const ee=await ji.clearAllActivities();return ee&&console.log("✅ All activities cleared"),ee}catch(ee){return console.error("Error clearing activities:",ee),!1}},getActivityStats:()=>ji.getActivityStats(),searchActivities:ee=>ji.searchActivities(ee),getCurrentUser:m};return n.jsx(eC.Provider,{value:I,children:r})},rn=({children:r})=>r;function Xn({rtl:r=!0}){const{activities:e,users:t}=vn(),[s,a]=N.useState(!1),[l,c]=N.useState(!1),[u,m]=N.useState(new Date),[p,b]=N.useState(null),[w,j]=N.useState(null),D=k=>{const $=["#e74c3c","#3498db","#2ecc71","#f39c12","#9b59b6","#1abc9c","#34495e","#e67e22","#95a5a6","#fd79a8"];if(!k)return $[0];let X=0;for(let F=0;F<k.length;F++)X=k.charCodeAt(F)+((X<<5)-X);const te=Math.abs(X)%$.length;return $[te]},O=["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],Q=["ح","ن","ث","ر","خ","ج","س"],z=k=>{const $=k.getFullYear(),X=k.getMonth(),te=new Date($,X,1),ce=new Date($,X+1,0).getDate(),Be=te.getDay(),U=[],se=new Date($,X-1,0);for(let ie=Be-1;ie>=0;ie--)U.push({day:se.getDate()-ie,isCurrentMonth:!1,isNextMonth:!1});for(let ie=1;ie<=ce;ie++)U.push({day:ie,isCurrentMonth:!0,isNextMonth:!1});const fe=42-U.length;for(let ie=1;ie<=fe;ie++)U.push({day:ie,isCurrentMonth:!1,isNextMonth:!0});return U},I=()=>{m(new Date(u.getFullYear(),u.getMonth()-1))},ee=()=>{m(new Date(u.getFullYear(),u.getMonth()+1))},J=(k,$,X)=>{if(!$)return;const te=new Date(u.getFullYear(),u.getMonth(),k);b(te)},oe=()=>{console.log("Filter applied:",{selectedDate:p}),a(!1)},Y=()=>{a(!1),b(null)},be=k=>{j(k===w?null:k)},M=()=>{console.log("User filter applied:",w),c(!1)},H=()=>{c(!1),j(null)};return n.jsxs("div",{className:"card shadow-lg",style:{position:"fixed",left:"20px",top:"145px",width:"360px",height:"calc(100vh - 185px)",zIndex:10,border:"none",borderRadius:"12px",display:"flex",flexDirection:"column"},children:[n.jsx("div",{style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",padding:"20px",color:"white",height:"80px",display:"flex",flexDirection:"column",justifyContent:"center",flexShrink:0,borderTopLeftRadius:"12px",borderTopRightRadius:"12px"},children:n.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-clock-history me-2",style:{fontSize:"20px"}}),n.jsx("h6",{className:"mb-0 fw-semibold",children:"الأنشطة الحديثة"})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsxs("button",{className:`btn btn-sm ${l?"btn-light":"btn-outline-light"} border-0`,onClick:()=>c(!l),style:{fontSize:"12px",borderRadius:"8px",padding:"6px 12px",transition:"all 0.2s ease",backgroundColor:l?"rgba(255,255,255,0.2)":"transparent",color:"white",border:l?"1px solid rgba(255,255,255,0.3)":"1px solid transparent"},onMouseEnter:k=>{l||(k.target.style.backgroundColor="rgba(255,255,255,0.1)",k.target.style.borderColor="rgba(255,255,255,0.2)")},onMouseLeave:k=>{l||(k.target.style.backgroundColor="transparent",k.target.style.borderColor="transparent")},children:[n.jsx("i",{className:`bi ${l?"bi-person-fill":"bi-person"} me-2`}),"Users"]}),n.jsxs("button",{className:`btn btn-sm ${s?"btn-light":"btn-outline-light"} border-0`,onClick:()=>a(!s),style:{fontSize:"12px",borderRadius:"8px",padding:"6px 12px",transition:"all 0.2s ease",backgroundColor:s?"rgba(255,255,255,0.2)":"transparent",color:"white",border:s?"1px solid rgba(255,255,255,0.3)":"1px solid transparent"},onMouseEnter:k=>{s||(k.target.style.backgroundColor="rgba(255,255,255,0.1)",k.target.style.borderColor="rgba(255,255,255,0.2)")},onMouseLeave:k=>{s||(k.target.style.backgroundColor="transparent",k.target.style.borderColor="transparent")},children:[n.jsx("i",{className:`bi ${s?"bi-funnel-fill":"bi-funnel"} me-2`}),"Filter"]})]})]})}),n.jsxs("div",{style:{flex:1,overflow:"auto",display:"flex",flexDirection:"column"},children:[s&&n.jsx("div",{style:{background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)",borderTop:"1px solid rgba(0,0,0,0.08)"},children:n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[n.jsx("button",{className:"btn btn-sm shadow-sm",onClick:I,style:{backgroundColor:"#ffffff",border:"1px solid #dee2e6",borderRadius:"12px",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",color:"#495057"},onMouseEnter:k=>{k.target.style.backgroundColor="#e9ecef",k.target.style.transform="translateY(-1px)",k.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:k=>{k.target.style.backgroundColor="#ffffff",k.target.style.transform="translateY(0)",k.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:n.jsx("i",{className:"bi bi-chevron-right"})}),n.jsx("div",{className:"text-center",children:n.jsxs("h6",{className:"mb-0 fw-semibold",style:{color:"#2c3e50",fontSize:"16px",letterSpacing:"0.5px"},children:[O[u.getMonth()]," ",u.getFullYear()]})}),n.jsx("button",{className:"btn btn-sm shadow-sm",onClick:ee,style:{backgroundColor:"#ffffff",border:"1px solid #dee2e6",borderRadius:"12px",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",color:"#495057"},onMouseEnter:k=>{k.target.style.backgroundColor="#e9ecef",k.target.style.transform="translateY(-1px)",k.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:k=>{k.target.style.backgroundColor="#ffffff",k.target.style.transform="translateY(0)",k.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:n.jsx("i",{className:"bi bi-chevron-left"})})]}),n.jsxs("div",{className:"calendar-grid mb-3",children:[n.jsx("div",{className:"row g-1 mb-3",children:Q.map((k,$)=>n.jsx("div",{className:"col text-center",children:n.jsx("small",{className:"fw-bold",style:{color:"#6c757d",fontSize:"11px",letterSpacing:"0.5px"},children:k})},$))}),Array.from({length:6}).map((k,$)=>n.jsx("div",{className:"row g-1 mb-1",children:z(u).slice($*7,($+1)*7).map((X,te)=>n.jsx("div",{className:"col",children:n.jsx("button",{className:"btn btn-sm w-100 shadow-sm",style:{fontSize:"12px",height:"32px",borderRadius:"8px",border:"1px solid #dee2e6",backgroundColor:X.isCurrentMonth?p&&p.getDate()===X.day?"#0d6efd":X.day===new Date().getDate()&&u.getMonth()===new Date().getMonth()&&u.getFullYear()===new Date().getFullYear()?"#e7f3ff":"#ffffff":"#f8f9fa",color:X.isCurrentMonth?p&&p.getDate()===X.day?"#ffffff":X.day===new Date().getDate()&&u.getMonth()===new Date().getMonth()&&u.getFullYear()===new Date().getFullYear()?"#0d6efd":"#495057":"#adb5bd",opacity:X.isCurrentMonth?1:.6,transition:"all 0.2s ease",fontWeight:p&&p.getDate()===X.day?"600":"400"},onClick:()=>J(X.day,X.isCurrentMonth,X.isNextMonth),disabled:!X.isCurrentMonth,onMouseEnter:F=>{X.isCurrentMonth&&!(p&&p.getDate()===X.day)&&(F.target.style.backgroundColor="#e9ecef",F.target.style.transform="translateY(-1px)")},onMouseLeave:F=>{X.isCurrentMonth&&!(p&&p.getDate()===X.day)&&(F.target.style.backgroundColor=X.day===new Date().getDate()&&u.getMonth()===new Date().getMonth()&&u.getFullYear()===new Date().getFullYear()?"#e7f3ff":"#ffffff",F.target.style.transform="translateY(0)")},children:X.day})},te))},$))]}),n.jsxs("div",{className:"row g-3 mx-2 justify-content-center align-items-center",style:{marginTop:"22px"},children:[n.jsx("div",{className:"col-6",children:n.jsx("button",{className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:Y,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#ffffff",border:"1px solid #dee2e6",color:"#6c757d",transition:"all 0.2s ease"},onMouseEnter:k=>{k.target.style.backgroundColor="#f8f9fa",k.target.style.transform="translateY(-1px)",k.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:k=>{k.target.style.backgroundColor="#ffffff",k.target.style.transform="translateY(0)",k.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:"الغاء"})}),n.jsx("div",{className:"col-6",children:n.jsx("button",{className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:oe,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#0d6efd",border:"1px solid #0d6efd",color:"#ffffff",transition:"all 0.2s ease"},onMouseEnter:k=>{k.target.style.backgroundColor="#0b5ed7",k.target.style.transform="translateY(-1px)",k.target.style.boxShadow="0 4px 12px rgba(13,110,253,0.3)"},onMouseLeave:k=>{k.target.style.backgroundColor="#0d6efd",k.target.style.transform="translateY(0)",k.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:"تأكيد"})})]})]})}),l&&n.jsx("div",{style:{background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)",borderTop:"1px solid rgba(0,0,0,0.08)"},children:n.jsxs("div",{className:"p-4",children:[n.jsx("div",{className:"text-center mb-3",children:n.jsx("h6",{className:"mb-0 fw-semibold",style:{color:"#2c3e50",fontSize:"16px",letterSpacing:"0.5px"},children:"تصفية حسب المستخدم"})}),n.jsx("div",{className:"mb-4",style:{background:"#ffffff",border:"1px solid #dee2e6",borderRadius:"8px",padding:"16px"},children:t.length>0?n.jsx("div",{className:"d-flex flex-column gap-1",children:t.map((k,$)=>n.jsx("div",{className:"d-flex align-items-center p-2",style:{borderBottom:$!==t.length-1?"1px solid #f8f9fa":"none"},children:n.jsxs("div",{className:"d-flex align-items-center w-100 justify-content-between",children:[n.jsx("input",{className:"form-check-input",type:"radio",name:"userFilter",id:`user-${k.id}`,checked:w===k.id,onChange:()=>be(k.id),style:{cursor:"pointer",margin:"0",transform:"scale(0.7)",width:"14px",height:"14px",minWidth:"14px"}}),n.jsx("label",{className:"form-check-label flex-grow-1 text-end",htmlFor:`user-${k.id}`,style:{cursor:"pointer",fontSize:"14px",fontWeight:"500",color:w===k.id?"#0d6efd":"#495057",marginRight:"8px"},children:k.name})]})},k.id))}):n.jsxs("div",{className:"text-center py-3",children:[n.jsx("i",{className:"bi bi-people text-muted",style:{fontSize:"2rem"}}),n.jsx("p",{className:"text-muted mt-2 mb-0",children:"لا يوجد مستخدمين متاحين"})]})}),n.jsxs("div",{className:"row g-3 mx-2 justify-content-center align-items-center",children:[n.jsx("div",{className:"col-6",children:n.jsx("button",{className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:H,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#ffffff",border:"1px solid #dee2e6",color:"#6c757d",transition:"all 0.2s ease"},onMouseEnter:k=>{k.target.style.backgroundColor="#f8f9fa",k.target.style.transform="translateY(-1px)",k.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:k=>{k.target.style.backgroundColor="#ffffff",k.target.style.transform="translateY(0)",k.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:"الغاء"})}),n.jsx("div",{className:"col-6",children:n.jsx("button",{className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:M,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#0d6efd",border:"1px solid #0d6efd",color:"#ffffff",transition:"all 0.2s ease"},onMouseEnter:k=>{k.target.style.backgroundColor="#0b5ed7",k.target.style.transform="translateY(-1px)",k.target.style.boxShadow="0 4px 12px rgba(13,110,253,0.3)"},onMouseLeave:k=>{k.target.style.backgroundColor="#0d6efd",k.target.style.transform="translateY(0)",k.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:"تأكيد"})})]})]})}),n.jsx("div",{className:"card-body p-0",style:{flex:1},children:e.length>0?n.jsx("div",{className:"list-group list-group-flush",children:e.map((k,$)=>n.jsxs("div",{className:`list-group-item border-0 py-3 ${$!==e.length-1?"border-bottom":""}`,style:{borderBottomColor:"#e9ecef !important",borderBottomWidth:"1px !important"},children:[n.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[n.jsxs("div",{className:"d-flex align-items-center gap-2",children:[n.jsx("h6",{className:"mb-1 text-dark",children:k.title}),k.isManual&&n.jsx("span",{className:"badge bg-info",style:{fontSize:"10px"},children:"يدوي"})]}),n.jsx("span",{className:`badge ${k.status==="done"?"bg-success":k.status==="open"?"bg-warning":"bg-danger"}`,children:k.status==="done"?"مكتمل":k.status==="open"?"مفتوح":"متأخر"})]}),k.description&&n.jsx("p",{className:"mb-2 text-muted small",children:k.description}),n.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[n.jsxs("div",{className:"d-flex align-items-center text-muted small",children:[n.jsx("i",{className:"bi bi-person me-1"}),n.jsx("span",{className:"me-3 fw-semibold",style:{color:D(k.user?.name),fontSize:"13px"},children:k.user?.name})]}),n.jsx("small",{className:"text-muted",children:new Date(k.at).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})})]}),k.type&&n.jsxs("div",{className:"mt-2",children:[n.jsx("i",{className:`bi ${k.type==="task"?"bi-list-task":k.type==="call"?"bi-telephone":k.type==="email"?"bi-envelope":k.type==="meeting"?"bi-people":"bi-sticky"} me-1 text-primary`}),n.jsx("small",{className:"text-primary",children:k.type==="task"?"مهام":k.type==="call"?"مكالمة":k.type==="email"?"بريد إلكتروني":k.type==="meeting"?"اجتماع":"ملاحظة"})]})]},k.id||$))}):n.jsxs("div",{className:"text-center py-5",children:[n.jsx("i",{className:"bi bi-clock-history text-muted",style:{fontSize:"3rem"}}),n.jsx("p",{className:"text-muted mt-3 mb-0",children:"لا توجد أنشطة حديثة"})]})})]})]})}function Jn(){const[r,e]=N.useState(!1),[t,s]=N.useState({type:"task",title:"",description:""}),{createManualActivity:a}=vn(),l=[{value:"task",label:"مهام",icon:"bi-list-task"},{value:"call",label:"مكالمة",icon:"bi-telephone"},{value:"email",label:"بريد إلكتروني",icon:"bi-envelope"},{value:"meeting",label:"اجتماع",icon:"bi-people"},{value:"note",label:"ملاحظة",icon:"bi-sticky"}],c=m=>{m.preventDefault(),t.title.trim()&&(a(t),s({type:"task",title:"",description:""}),e(!1))},u=()=>{s({type:"task",title:"",description:""}),e(!1)};return n.jsx("div",{style:{position:"fixed",left:"20px",bottom:"20px",zIndex:1e3},children:r?n.jsxs("div",{className:"card shadow-lg",style:{width:"360px",maxHeight:"500px",border:"none",borderRadius:"12px",overflow:"hidden"},children:[n.jsx("div",{style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",padding:"20px",color:"white"},children:n.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[n.jsx("div",{className:"d-flex align-items-center",children:n.jsx("h6",{className:"mb-0 fw-semibold",children:"إضافة نشاط جديد"})}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:u,style:{fontSize:"12px",opacity:.8},onMouseEnter:m=>m.target.style.opacity="1",onMouseLeave:m=>m.target.style.opacity="0.8"})]})}),n.jsx("div",{style:{background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)",padding:"24px"},children:n.jsxs("form",{onSubmit:c,children:[n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"form-label fw-semibold",style:{color:"#2c3e50",fontSize:"14px",letterSpacing:"0.3px"},children:"نوع النشاط"}),n.jsx("select",{className:"form-select shadow-sm",value:t.type,onChange:m=>s(p=>({...p,type:m.target.value})),style:{fontSize:"14px",borderRadius:"8px",border:"1px solid #dee2e6",backgroundColor:"#ffffff",padding:"10px 12px",transition:"all 0.2s ease",backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"left 12px center",backgroundSize:"12px",paddingLeft:"36px",paddingRight:"12px",textAlign:"right",direction:"rtl"},onFocus:m=>{m.target.style.borderColor="#0d6efd",m.target.style.boxShadow="0 0 0 0.2rem rgba(13,110,253,.25)"},onBlur:m=>{m.target.style.borderColor="#dee2e6",m.target.style.boxShadow="none"},children:l.map(m=>n.jsx("option",{value:m.value,children:m.label},m.value))})]}),n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"form-label fw-semibold",style:{color:"#2c3e50",fontSize:"14px",letterSpacing:"0.3px"},children:"العنوان *"}),n.jsx("input",{type:"text",className:"form-control shadow-sm",value:t.title,onChange:m=>s(p=>({...p,title:m.target.value})),placeholder:"أدخل عنوان النشاط",required:!0,style:{fontSize:"14px",borderRadius:"8px",border:"1px solid #dee2e6",backgroundColor:"#ffffff",padding:"10px 12px",transition:"all 0.2s ease"},onFocus:m=>{m.target.style.borderColor="#0d6efd",m.target.style.boxShadow="0 0 0 0.2rem rgba(13,110,253,.25)"},onBlur:m=>{m.target.style.borderColor="#dee2e6",m.target.style.boxShadow="none"}})]}),n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"form-label fw-semibold",style:{color:"#2c3e50",fontSize:"14px",letterSpacing:"0.3px"},children:"الوصف"}),n.jsx("textarea",{className:"form-control shadow-sm",rows:"3",value:t.description,onChange:m=>s(p=>({...p,description:m.target.value})),placeholder:"أدخل وصف النشاط (اختياري)",style:{fontSize:"14px",borderRadius:"8px",border:"1px solid #dee2e6",backgroundColor:"#ffffff",padding:"10px 12px",resize:"none",transition:"all 0.2s ease"},onFocus:m=>{m.target.style.borderColor="#0d6efd",m.target.style.boxShadow="0 0 0 0.2rem rgba(13,110,253,.25)"},onBlur:m=>{m.target.style.borderColor="#dee2e6",m.target.style.boxShadow="none"}})]}),n.jsxs("div",{className:"row g-3 mx-2 justify-content-center align-items-center",style:{marginTop:"22px"},children:[n.jsx("div",{className:"col-6",children:n.jsx("button",{type:"button",className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",onClick:u,style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#ffffff",border:"1px solid #dee2e6",color:"#6c757d",transition:"all 0.2s ease"},onMouseEnter:m=>{m.target.style.backgroundColor="#f8f9fa",m.target.style.transform="translateY(-1px)",m.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.12)"},onMouseLeave:m=>{m.target.style.backgroundColor="#ffffff",m.target.style.transform="translateY(0)",m.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:"إلغاء"})}),n.jsx("div",{className:"col-6",children:n.jsx("button",{type:"submit",className:"btn shadow-sm w-100 d-flex align-items-center justify-content-center",style:{fontSize:"14px",fontWeight:"600",borderRadius:"12px",padding:"8px 0",height:"40px",backgroundColor:"#0d6efd",border:"1px solid #0d6efd",color:"#ffffff",transition:"all 0.2s ease"},onMouseEnter:m=>{m.target.style.backgroundColor="#0b5ed7",m.target.style.transform="translateY(-1px)",m.target.style.boxShadow="0 4px 12px rgba(13,110,253,0.3)"},onMouseLeave:m=>{m.target.style.backgroundColor="#0d6efd",m.target.style.transform="translateY(0)",m.target.style.boxShadow="0 1px 3px rgba(0,0,0,0.12)"},children:"إضافة"})})]})]})})]}):n.jsx("button",{onClick:()=>e(!0),className:"btn btn-primary rounded-circle shadow-lg",style:{width:"56px",height:"56px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",border:"none"},title:"إضافة نشاط يدوي",children:n.jsx("i",{className:"bi bi-chat-left-text"})})})}function i4(){const[r,e]=N.useState(!1),{isTimelineVisible:t}=$n(),s=()=>{e(!r)};return n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Kn,{onToggle:s}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"لوحة التحكم"})]})}),n.jsx(Yn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"mb-4",children:n.jsx("i",{className:"bi bi-speedometer2",style:{fontSize:"80px",color:"#007bff"}})}),n.jsx("h4",{className:"text-muted mb-3",children:"لوحة التحكم"}),n.jsx("p",{className:"text-muted",children:"مرحباً بك في لوحة التحكم الرئيسية"})]})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&t&&n.jsx(Xn,{rtl:!0}),!r&&t&&n.jsx(Jn,{})]})}function FE(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(i4,{})})})}class a4 extends nv{constructor(){super("tenders")}validateTenderData(e){const t={};return e.title?.trim()||(t.title="عنوان المناقصة مطلوب"),e.referenceNumber?.trim()||(t.referenceNumber="رقم المرجع مطلوب"),e.entity?.trim()||(t.entity="الجهة المطروحة مطلوبة"),e.submissionDeadline||(t.submissionDeadline="موعد انتهاء التقديم مطلوب"),t}async checkDuplicateReferenceNumber(e,t=null){try{return(await this.search(e,["referenceNumber"])).some(a=>a.referenceNumber===e&&a.id!==t)}catch(s){return console.error("Error checking duplicate reference number:",s),!1}}async createTender(e,t={}){try{const s=this.validateTenderData(e);if(Object.keys(s).length>0)throw new Error(`بيانات غير صحيحة: ${Object.values(s).join(", ")}`);if(await this.checkDuplicateReferenceNumber(e.referenceNumber))throw new Error("هذا الرقم المرجعي مسجل مسبقاً - يرجى اختيار رقم مختلف");const a={...e,internalId:Ct("TENDER"),status:"draft",items:e.items||[],documents:e.documents||[],submissionDeadline:e.submissionDeadline?new Date(e.submissionDeadline):null};return await this.create(a,{...t,updateCache:!0})}catch(s){throw console.error("Error creating tender:",s),s}}async updateTender(e,t,s={}){try{const a=this.validateTenderData(t);if(Object.keys(a).length>0)throw new Error(`بيانات غير صحيحة: ${Object.values(a).join(", ")}`);if(t.referenceNumber&&await this.checkDuplicateReferenceNumber(t.referenceNumber,e))throw new Error("هذا الرقم المرجعي مسجل مسبقاً - يرجى اختيار رقم مختلف");const l={...t,submissionDeadline:t.submissionDeadline?new Date(t.submissionDeadline):null};return await this.update(e,l,{...s,updateCache:!0})}catch(a){throw console.error("Error updating tender:",a),a}}async getTenderByInternalId(e){try{return(await this.search(e,["internalId"])).find(s=>s.internalId===e)||null}catch(t){throw console.error("Error fetching tender by internal ID:",t),t}}async getAllTenders(e={}){return await this.getAll({updateCache:!0,...e})}async searchTenders(e){return await this.search(e,["title","referenceNumber","entity","description","internalId"])}async addTenderItem(e,t){try{const s=await this.getById(e);if(!s)throw new Error("Tender not found");const a={...t,internalId:Ct("TENDER_ITEM"),addedAt:new Date,materialInternalId:t.materialInternalId||t.materialId},l=s.items||[];if(l.some(m=>m.materialInternalId===a.materialInternalId))throw new Error(`البند ${t.materialName||"غير معروف"} موجود مسبقاً في المناقصة`);const u=[...l,a];return await this.updateTender(e,{...s,items:u,estimatedValue:this.calculateEstimatedValue(u)}),a.internalId}catch(s){throw console.error("Error adding tender item:",s),s}}async updateTenderItem(e,t,s){try{const a=await this.getById(e);if(!a)throw new Error("Tender not found");const l=a.items||[],c=l.findIndex(u=>u.internalId===t);if(c===-1)throw new Error("Tender item not found");return l[c]={...l[c],...s,updatedAt:new Date},await this.updateTender(e,{...a,items:l,estimatedValue:this.calculateEstimatedValue(l)}),!0}catch(a){throw console.error("Error updating tender item:",a),a}}async removeTenderItem(e,t){try{const s=await this.getById(e);if(!s)throw new Error("Tender not found");const l=(s.items||[]).filter(c=>c.internalId!==t);return await this.updateTender(e,{...s,items:l,estimatedValue:this.calculateEstimatedValue(l)}),!0}catch(s){throw console.error("Error removing tender item:",s),s}}calculateEstimatedValue(e){return!e||!Array.isArray(e)?0:e.reduce((t,s)=>{const a=parseFloat(s.unitPrice||0),l=parseFloat(s.quantity||1);return t+a*l},0)}async addTenderDocument(e,t){try{const s=await this.getById(e);if(!s)throw new Error("Tender not found");const a={...t,internalId:Ct("DOCUMENT"),uploadedAt:new Date},c=[...s.documents||[],a];return await this.updateTender(e,{...s,documents:c}),a.internalId}catch(s){throw console.error("Error adding tender document:",s),s}}async removeTenderDocument(e,t){try{const s=await this.getById(e);if(!s)throw new Error("Tender not found");const l=(s.documents||[]).filter(c=>c.internalId!==t);return await this.updateTender(e,{...s,documents:l}),!0}catch(s){throw console.error("Error removing tender document:",s),s}}async updateTenderStatus(e,t){try{if(!["draft","submitted","in_review","awarded","rejected","cancelled"].includes(t))throw new Error(`حالة غير صحيحة: ${t}`);const a=await this.getById(e);if(!a)throw new Error("Tender not found");return await this.updateTender(e,{...a,status:t,statusUpdatedAt:new Date}),!0}catch(s){throw console.error("Error updating tender status:",s),s}}}const sc=new a4;class tf{static async getAllTenders(){try{console.log("🔥 Fetching tenders from Firestore...");const e=await sc.getAllTenders();return console.log("✅ Loaded tenders from Firestore:",e.length),e}catch(e){throw console.error("❌ Error fetching tenders:",e),new Error("فشل في جلب بيانات المناقصات: "+e.message)}}static async getTenderById(e){try{console.log("🔥 Fetching tender by ID:",e);const t=await sc.getById(e);if(!t)throw new Error("المناقصة غير موجودة");return t}catch(t){throw console.error("❌ Error fetching tender:",t),new Error("فشل في جلب بيانات المناقصة: "+t.message)}}static async createTender(e){try{console.log("🔥 Creating tender in Firestore...");const t={...e,internalId:e.internalId||Ct("TENDER")},s=await sc.create(t);return console.log("✅ Tender created in Firestore with ID:",s.id),s.id}catch(t){throw console.error("❌ Error creating tender:",t),new Error("فشل في إنشاء المناقصة: "+t.message)}}static async updateTender(e,t){try{console.log("🔥 Updating tender in Firestore:",e);const s={...t},a=await sc.update(e,s);return console.log("✅ Tender updated in Firestore"),!0}catch(s){throw console.error("❌ Error updating tender:",s),new Error("فشل في تحديث بيانات المناقصة: "+s.message)}}static async deleteTender(e){try{return console.log("🔥 Deleting tender from Firestore:",e),await sc.delete(e),console.log("✅ Tender deleted from Firestore"),!0}catch(t){throw console.error("❌ Error deleting tender:",t),new Error("فشل في حذف المناقصة: "+t.message)}}static validateTenderData(e){const t={};if(e.title?.trim()||(t.title="اسم المناقصة مطلوب"),e.referenceNumber?.trim()||(t.referenceNumber="رقم المرجع مطلوب"),e.entity?.trim()||(t.entity="الجهة مطلوبة"),e.submissionDeadline){const s=new Date(e.submissionDeadline),a=new Date;a.setHours(0,0,0,0),s<a&&(t.submissionDeadline="تاريخ التسليم يجب أن يكون في المستقبل")}if(e.estimatedValue!==void 0&&e.estimatedValue!==""){const s=parseFloat(e.estimatedValue);(isNaN(s)||s<0)&&(t.estimatedValue="القيمة التقديرية يجب أن تكون رقم موجب")}return e.contactEmail&&e.contactEmail.trim()&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.contactEmail.trim())||(t.contactEmail="عنوان البريد الإلكتروني غير صالح")),t}static async searchTenders(e){try{return(await this.getAllTenders()).filter(s=>s.title?.toLowerCase().includes(e.toLowerCase())||s.referenceNumber?.toLowerCase().includes(e.toLowerCase())||s.entity?.toLowerCase().includes(e.toLowerCase()))}catch(t){throw console.error("❌ Error searching tenders:",t),new Error("فشل في البحث عن المناقصات: "+t.message)}}static async getTendersByStatus(e){try{return(await this.getAllTenders()).filter(s=>s.status===e)}catch(t){throw console.error("❌ Error fetching tenders by status:",t),new Error("فشل في جلب المناقصات حسب الحالة: "+t.message)}}}class rt{static COLLECTION_NAME="pendingData";static DEFAULT_EXPIRY_HOURS=24;static getCurrentUserId(){if(!Yt.currentUser)throw new Error("User not authenticated");return Yt.currentUser.uid}static createExpiryTimestamp(e=this.DEFAULT_EXPIRY_HOURS){const t=new Date;return t.setHours(t.getHours()+e),_n.fromDate(t)}static async setPendingData(e,t,s=this.DEFAULT_EXPIRY_HOURS){try{const a=this.getCurrentUserId();console.log("🔥 [FIRESTORE] Setting pending data:",e);const l=ut(De,this.COLLECTION_NAME,`${a}_${e}`),c={ownerId:a,key:e,data:t,expiresAt:this.createExpiryTimestamp(s),createdAt:vt(),updatedAt:vt()};return await sh(l,c),console.log("✅ [FIRESTORE] Pending data set:",e),!0}catch(a){throw console.error("❌ [FIRESTORE] Error setting pending data:",a),new Error("Failed to set pending data: "+a.message)}}static async getPendingData(e){try{const t=this.getCurrentUserId();console.log("🔥 [FIRESTORE] Getting pending data:",e);const s=ut(De,this.COLLECTION_NAME,`${t}_${e}`),a=await cs(s);if(!a.exists())return console.log("📭 [FIRESTORE] No pending data found for key:",e),null;const l=a.data();return l.expiresAt&&l.expiresAt.toDate()<new Date?(console.log("⏰ [FIRESTORE] Pending data expired, cleaning up:",e),await this.clearPendingData(e),null):(console.log("✅ [FIRESTORE] Retrieved pending data:",e),l.data)}catch(t){return console.error("❌ [FIRESTORE] Error getting pending data:",t),null}}static async clearPendingData(e){try{const t=this.getCurrentUserId();console.log("🔥 [FIRESTORE] Clearing pending data:",e);const s=ut(De,this.COLLECTION_NAME,`${t}_${e}`);return await Js(s),console.log("✅ [FIRESTORE] Pending data cleared:",e),!0}catch(t){return console.error("❌ [FIRESTORE] Error clearing pending data:",t),!1}}static async getAllPendingData(){try{const e=this.getCurrentUserId();console.log("🔥 [FIRESTORE] Getting all pending data");const t=ct(De,this.COLLECTION_NAME),s=Vt(t,jn("ownerId","==",e),hs("createdAt","desc")),a=await St(s),l={},c=[];return a.docs.forEach(u=>{const m=u.data();m.expiresAt&&m.expiresAt.toDate()<new Date?c.push(m.key):l[m.key]=m.data}),c.length>0&&await this.clearMultiplePendingData(c),console.log("✅ [FIRESTORE] Retrieved all pending data, keys:",Object.keys(l)),l}catch(e){return console.error("❌ [FIRESTORE] Error getting all pending data:",e),{}}}static async clearMultiplePendingData(e){try{const t=this.getCurrentUserId();console.log("🔥 [FIRESTORE] Clearing multiple pending data:",e.length);const s=Jo(De);return e.forEach(a=>{const l=ut(De,this.COLLECTION_NAME,`${t}_${a}`);s.delete(l)}),await s.commit(),console.log("✅ [FIRESTORE] Multiple pending data cleared"),!0}catch(t){return console.error("❌ [FIRESTORE] Error clearing multiple pending data:",t),!1}}static async clearAllPendingData(){try{const e=this.getCurrentUserId();console.log("🔥 [FIRESTORE] Clearing all pending data");const t=ct(De,this.COLLECTION_NAME),s=Vt(t,jn("ownerId","==",e)),a=await St(s),l=Jo(De);return a.docs.forEach(c=>{l.delete(c.ref)}),await l.commit(),console.log("✅ [FIRESTORE] All pending data cleared:",a.docs.length),a.docs.length}catch(e){return console.error("❌ [FIRESTORE] Error clearing all pending data:",e),0}}static async cleanupExpiredData(){try{const e=this.getCurrentUserId();console.log("🔥 [FIRESTORE] Cleaning up expired data");const t=ct(De,this.COLLECTION_NAME),s=Vt(t,jn("ownerId","==",e),jn("expiresAt","<",_n.now())),a=await St(s),l=Jo(De);return a.docs.forEach(c=>{l.delete(c.ref)}),await l.commit(),console.log("✅ [FIRESTORE] Expired data cleaned up:",a.docs.length),a.docs.length}catch(e){return console.error("❌ [FIRESTORE] Error cleaning up expired data:",e),0}}static async setPendingTenderItems(e){return this.setPendingData("pendingTenderItems",e,48)}static async getPendingTenderItems(){return this.getPendingData("pendingTenderItems")}static async clearPendingTenderItems(){return this.clearPendingData("pendingTenderItems")}static async mergePendingTenderItems(e){try{console.log("🔄 [FIRESTORE] Merging pending tender items:",e.length);const t=await this.getPendingTenderItems()||[],s=[...t,...e];return await this.setPendingTenderItems(s),console.log("✅ [FIRESTORE] Pending tender items merged:",{existing:t.length,new:e.length,total:s.length}),!0}catch(t){throw console.error("❌ [FIRESTORE] Error merging pending tender items:",t),new Error("Failed to merge pending tender items: "+t.message)}}static async setPendingProductItems(e){return this.setPendingData("pendingProductItems",e,48)}static async getPendingProductItems(){return this.getPendingData("pendingProductItems")}static async clearPendingProductItems(){return this.clearPendingData("pendingProductItems")}static async mergePendingProductItems(e){try{console.log("🔄 [FIRESTORE] Merging pending product items:",e.length);const t=await this.getPendingProductItems()||[],s=[...t,...e];return await this.setPendingProductItems(s),console.log("✅ [FIRESTORE] Pending product items merged:",{existing:t.length,new:e.length,total:s.length}),!0}catch(t){throw console.error("❌ [FIRESTORE] Error merging pending product items:",t),new Error("Failed to merge pending product items: "+t.message)}}static async setSessionData(e,t,s=24){return this.setPendingData(e,t,s)}static async getSessionData(e){return this.getPendingData(e)}static async clearSessionData(e){return this.clearPendingData(e)}}class Gn{static COLLECTION_NAME="trash";static sanitizeData(e){const t={};for(const[s,a]of Object.entries(e))a!=null&&(a instanceof Date?t[s]=a.toISOString():typeof a=="object"&&a!==null&&!Array.isArray(a)?t[s]=this.sanitizeData(a):t[s]=a);return t}static async moveToTrash(e,t){try{const s=e.title||e.name||e.fileName||e.supplierName||"عنصر غير محدد";console.log("Moving to trash:",s,"from",t);let{id:a,...l}=e;if((!a||a===void 0||a===null)&&(a=`generated_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,console.log("⚠️ Missing document ID, generated new one:",a)),(await this.getAllTrashItems()).some(w=>w.originalId===a&&w.originalCollection===t&&(w.name===e.name||w.title===e.title||w.fileName===e.fileName||w.supplierName===e.supplierName)))return console.log("Item already exists in trash, skipping"),null;const p={...this.sanitizeData(l),originalId:a,originalCollection:t,deletedAt:vt(),deletedBy:"المستخدم الحالي"};console.log("📤 Adding to trash collection:",{displayName:s,originalCollection:t,originalId:a,hasRequiredFields:!!(p.originalId&&p.originalCollection)});const b=await Mr(ct(De,this.COLLECTION_NAME),p);return console.log("✅ Successfully moved to trash with ID:",b.id),b.id}catch(s){throw console.error("❌ Error moving to trash:",s),console.error("Error details:",{name:s.name,message:s.message,code:s.code,stack:s.stack,itemData:{id:e.id,displayName:e.name||e.fileName||e.supplierName,originalCollection:t,hasId:!!e.id}}),new Error(`فشل في نقل العنصر إلى سلة المهملات: ${s.message}`)}}static async getAllTrashItems(){try{const e=Vt(ct(De,this.COLLECTION_NAME),hs("deletedAt","desc")),t=await St(e),s=[],a=new Map;return t.forEach(l=>{const c=l.data(),u={id:l.id,...c,deletedAt:c.deletedAt?.toDate?.()||new Date};c.originalCollection==="price_quotes"&&(console.log("=== TRASH RECORD DEBUG ==="),console.log("Document ID:",l.id),console.log("Original Collection:",c.originalCollection),console.log("Item keys:",Object.keys(c)),console.log("Context data:",{rawMaterialId:c.rawMaterialId,rawMaterialName:c.rawMaterialName,localProductId:c.localProductId,localProductName:c.localProductName,foreignProductId:c.foreignProductId,foreignProductName:c.foreignProductName,supplierName:c.supplierName,price:c.price,date:c.date}),console.log("Full item data:",c));const m=`${c.originalId||c.id}-${c.originalCollection}-${c.name||c.title}`;a.has(m)?(console.log("Found duplicate item:",m,"marking for deletion"),this.permanentlyDelete(l.id).catch(console.error)):(a.set(m,u),s.push(u))}),console.log("Found",s.length,"unique items in trash (removed duplicates)"),s}catch(e){throw console.error("Error getting trash items:",e),new Error("فشل في جلب عناصر سلة المهملات")}}static async permanentlyDelete(e){try{if(console.log("Permanently deleting item:",e),!(await this.getAllTrashItems()).some(c=>c.id===e))return console.log("Item already deleted or does not exist:",e),!0;if(await Js(ut(De,this.COLLECTION_NAME,e)),(await this.getAllTrashItems()).some(c=>c.id===e))throw new Error("فشل في حذف العنصر - العنصر لا يزال موجوداً");return console.log("Successfully deleted from trash:",e),!0}catch(t){throw console.error("Error deleting from trash:",t),new Error("فشل في حذف العنصر من سلة المهملات: "+t.message)}}static async restoreItem(e){let t=null;try{console.log("=== STARTING RESTORATION PROCESS ==="),console.log("Trash ID to restore:",e);const s=await this.getAllTrashItems();if(console.log("Total trash items found:",s.length),t=s.find(b=>b.id===e),!t)throw console.error("RESTORATION FAILED: Item not found in trash"),console.log("Available trash IDs:",s.map(b=>b.id)),new Error("العنصر غير موجود في سلة المهملات");console.log("=== TRASH ITEM FOUND ==="),console.log("Item to restore:",{id:t.id,originalCollection:t.originalCollection,name:t.name||t.supplierName,hasRawMaterialId:!!t.rawMaterialId,hasLocalProductId:!!t.localProductId,hasForeignProductId:!!t.foreignProductId});const{id:a,originalId:l,originalCollection:c,deletedAt:u,deletedBy:m,...p}=t;if(c==="suppliers"){const{SupplierService:b}=await ar(async()=>{const{SupplierService:w}=await Promise.resolve().then(()=>R4);return{SupplierService:w}},[]);await b.createSupplier(p)}else if(c==="foreignSuppliers"){const{ForeignSupplierService:b}=await ar(async()=>{const{ForeignSupplierService:w}=await Promise.resolve().then(()=>P4);return{ForeignSupplierService:w}},void 0);await b.createSupplier(p)}else if(c==="customers"){const{CustomerService:b}=await ar(async()=>{const{CustomerService:w}=await Promise.resolve().then(()=>mF);return{CustomerService:w}},void 0);await b.createCustomer(p)}else if(c==="employees"){const{EmployeeService:b}=await ar(async()=>{const{EmployeeService:w}=await Promise.resolve().then(()=>_F);return{EmployeeService:w}},void 0);await b.createEmployee(p)}else if(c==="rawmaterials"){const{RawMaterialService:b}=await ar(async()=>{const{RawMaterialService:w}=await Promise.resolve().then(()=>lx);return{RawMaterialService:w}},void 0);await b.createRawMaterial(p)}else if(c==="localproducts"){const{LocalProductService:b}=await ar(async()=>{const{LocalProductService:w}=await Promise.resolve().then(()=>cx);return{LocalProductService:w}},void 0);await b.createLocalProduct(p)}else if(c==="foreignproducts"){const{ForeignProductService:b}=await ar(async()=>{const{ForeignProductService:w}=await Promise.resolve().then(()=>dx);return{ForeignProductService:w}},void 0);await b.createForeignProduct(p)}else if(c==="price_quotes")if(console.log("=== RESTORING PRICE QUOTE ==="),console.log("Trash item keys:",Object.keys(t)),console.log("Has rawMaterialId:",!!t.rawMaterialId,t.rawMaterialId),console.log("Has localProductId:",!!t.localProductId,t.localProductId),console.log("Has foreignProductId:",!!t.foreignProductId,t.foreignProductId),t.rawMaterialId)console.log("Restoring to raw material..."),await this.restorePriceQuoteToRawMaterial(t,p);else if(t.localProductId)console.log("Restoring to local product..."),await this.restorePriceQuoteToLocalProduct(t,p);else if(t.foreignProductId)console.log("Restoring to foreign product..."),await this.restorePriceQuoteToForeignProduct(t,p);else throw console.error("No valid product ID found in trash item:",{rawMaterialId:t.rawMaterialId,localProductId:t.localProductId,foreignProductId:t.foreignProductId,allKeys:Object.keys(t)}),new Error("لا يمكن استعادة عرض السعر - لم يتم العثور على السياق الأصلي");else if(c==="tenderItems"){console.log("=== RESTORING TENDER ITEM ==="),console.log("Tender context:",t.tenderContext);const b=t.tenderContext?.tenderId||"new",w=`tenderItems_${b}`;let j=[];try{const O=await rt.getPendingData(w);j=O?JSON.parse(O):[]}catch(O){console.warn("Error parsing existing tender items:",O),j=[]}if(j.some(O=>O.internalId===p.internalId||O.materialInternalId===p.materialInternalId&&O.materialName===p.materialName))throw console.warn("Tender item already exists, not restoring to prevent duplicate"),new Error("هذا البند موجود بالفعل في المناقصة");j.push({...p,restoredAt:new Date().toISOString(),restoredFrom:"trash"}),await rt.setPendingData(w,j),await rt.setPendingData("tenderItems_restored",Date.now().toString()),window.dispatchEvent(new CustomEvent("tenderItemRestored",{detail:{tenderId:b,restoredItem:p}})),console.log("Successfully restored tender item to Firestore session:",{tenderId:b,storageKey:w,itemCount:j.length,restoredItem:p.materialName||p.name})}else if(c==="tender_documents"){console.log("=== RESTORING TENDER DOCUMENT ==="),console.log("Document data:",p);const b=p.tenderId||"new",w=`tenderDocuments_${b}`;console.log("Restoring document to:",{tenderId:b,storageKey:w});let j=[];try{j=await rt.getPendingData(w)||[],console.log("Existing documents in Firestore session:",j.length)}catch(Q){console.warn("Error parsing existing tender documents:",Q),j=[]}if(j.some(Q=>Q.id===p.id&&Q.storagePath===p.storagePath)){console.warn("Exact same document already exists, generating new ID for restoration");const Q=Date.now(),z=Math.random().toString(36).substr(2,9);p.id=`${Q}_${z}_restored`,console.log("Generated new document ID for restoration:",p.id)}const O={...p,restoredAt:new Date().toISOString(),restoredFrom:"trash"};j.push(O),console.log("📄 Adding restored document:",{documentId:O.id,fileName:O.fileName,tenderId:b,totalDocuments:j.length});try{await rt.setPendingData(w,j),console.log("✅ Successfully saved to Firestore session:",w)}catch(Q){throw console.error("❌ Failed to save to Firestore session:",Q),new Error("فشل في حفظ الملف المستعاد")}try{await rt.setPendingData("tenderDocuments_restored",Date.now().toString());const Q=new CustomEvent("tenderDocumentRestored",{detail:{tenderId:b,restoredDocument:O,allDocuments:j}});window.dispatchEvent(Q),window.dispatchEvent(new StorageEvent("storage",{key:w,newValue:JSON.stringify(j),url:window.location.href})),console.log("✅ Events dispatched successfully")}catch(Q){console.warn("⚠️ Event dispatch failed (non-critical):",Q)}console.log("✅ Successfully restored tender document:",{tenderId:b,storageKey:w,documentCount:j.length,restoredDocument:O.fileName||O.originalFileName})}else if(c==="manufacturedProducts"){const{ManufacturedProductService:b}=await ar(async()=>{const{ManufacturedProductService:w}=await Promise.resolve().then(()=>dC);return{ManufacturedProductService:w}},void 0);await b.createManufacturedProduct(p),console.log("Successfully restored manufactured product")}else throw new Error("نوع العنصر غير مدعوم للاستعادة");return await this.permanentlyDelete(e),console.log("Successfully restored item"),!0}catch(s){console.error("=== RESTORATION ERROR ==="),console.error("Error type:",s.constructor.name),console.error("Error message:",s.message),console.error("Error stack:",s.stack),console.error("Error details:",{trashId:e,itemType:t?.originalCollection,itemName:t?.name||t?.supplierName,hasValidItem:!!t,contextIds:{rawMaterialId:t?.rawMaterialId,localProductId:t?.localProductId,foreignProductId:t?.foreignProductId}});let a="فشل في استعادة العنصر";throw s.message.includes("المادة الخام الأصلية غير موجودة")?a="فشل في الاستعادة: المادة الخام الأصلية غير موجودة أو تم حذفها":s.message.includes("المنتج المحلي الأصلي غير موجود")?a="فشل في الاستعادة: المنتج المحلي الأصلي غير موجود أو تم حذفه":s.message.includes("المنتج المستورد الأصلي غير موجود")?a="فشل في الاستعادة: المنتج المستورد الأصلي غير موجود أو تم حذفه":s.message.includes("لم يتم العثور على السياق الأصلي")?a="فشل في الاستعادة: لم يتم العثور على السياق الأصلي للعنصر":s.message.includes("نوع العنصر غير مدعوم")?a="فشل في الاستعادة: نوع العنصر غير مدعوم للاستعادة":a=`فشل في الاستعادة: ${s.message}`,new Error(a)}}static async restorePriceQuoteToRawMaterial(e,t){try{console.log("Restoring price quote to raw material:",e.rawMaterialId),console.log("Original trash item:",e);const{RawMaterialService:s}=await ar(async()=>{const{RawMaterialService:z}=await Promise.resolve().then(()=>lx);return{RawMaterialService:z}},void 0),a=await s.getRawMaterialById(e.rawMaterialId);if(!a)throw new Error("المادة الخام الأصلية غير موجودة");console.log("Found raw material for restore:",{id:a.id,name:a.name,currentQuotesCount:(a.priceQuotes||[]).length});const{rawMaterialId:l,rawMaterialName:c,...u}=t;u.id||(console.warn("Quote missing ID, generating new one:",u),u.id=Date.now().toString()+"_recovered");const m=Date.now(),p=Math.random().toString(36).substr(2,9);u.id=`${m}_${p}_restored`,u.supplierName=u.supplierName||"مورد غير معروف",u.price=u.price||"0",u.date=u.date||"",u.supplierType=u.supplierType||"local",u.id=String(u.id),console.log("Restoring quote data with normalized structure:",u);const b=a.priceQuotes||[];if(console.log("Checking for duplicates in raw material:",{existingQuotesCount:b.length,newQuoteId:u.id,newQuoteSupplier:u.supplierName,newQuotePrice:u.price,newQuoteDate:u.date,existingQuotes:b.map(z=>({id:z.id,supplier:z.supplierName,price:z.price,date:z.date}))}),b.some(z=>z.id===u.id)){console.warn("Quote with same ID already exists, generating new ID");const z=Date.now()+Math.random()*1e3,I=Math.random().toString(36).substr(2,12);u.id=`${z}_${I}_restored_v2`,console.log("Generated new unique ID:",u.id)}const j=[...b,u];console.log("Updated price quotes after restore:",j.length,"total quotes");let D=null,O=null;if(j.length>0){const z=j.reduce((I,ee)=>{const J=parseFloat(I.price)||0;return(parseFloat(ee.price)||0)<J?ee:I});D=z.price,O=z.supplierName}const Q={...a,priceQuotes:j};D&&(Q.price=D,Q.supplier=O,Q.lowestPriceSupplier=O),await s.updateRawMaterial(e.rawMaterialId,Q),console.log("Price quote successfully restored to raw material")}catch(s){throw console.error("=== RAW MATERIAL RESTORATION ERROR ==="),console.error("Error message:",s.message),console.error("Error stack:",s.stack),console.error("Error details:",{rawMaterialId:e.rawMaterialId,quoteName:t.supplierName,step:"Raw Material Restoration",originalDataKeys:Object.keys(t),trashItemKeys:Object.keys(e)}),s.message.includes("المادة الخام الأصلية غير موجودة")?s:new Error(`فشل في استعادة عرض السعر للمادة الخام: ${s.message}`)}}static async restorePriceQuoteToLocalProduct(e,t){try{console.log("Restoring price quote to local product:",e.localProductId),console.log("Original trash item:",e);const{LocalProductService:s}=await ar(async()=>{const{LocalProductService:I}=await Promise.resolve().then(()=>cx);return{LocalProductService:I}},void 0),l=(await s.getAllLocalProducts()).find(I=>I.id===e.localProductId);if(!l)throw new Error("المنتج المحلي الأصلي غير موجود");console.log("Found local product for restore:",{id:l.id,name:l.name,currentQuotesCount:(l.priceQuotes||[]).length});const{localProductId:c,localProductName:u,...m}=t,p=Date.now(),b=Math.random().toString(36).substr(2,9);m.id=`${p}_${b}_restored`,m.supplierName=m.supplierName||"مورد غير معروف",m.price=m.price||"0",m.date=m.date||"",m.supplierType=m.supplierType||"local",m.id=String(m.id),console.log("Restoring quote data with normalized structure:",m);const w=l.priceQuotes||[];if(console.log("Checking for duplicates in local product:",{existingQuotesCount:w.length,newQuoteId:m.id,newQuoteSupplier:m.supplierName,newQuotePrice:m.price,newQuoteDate:m.date,existingQuotes:w.map(I=>({id:I.id,supplier:I.supplierName,price:I.price,date:I.date}))}),w.some(I=>I.id===m.id)){console.warn("Quote with same ID already exists, generating new ID");const I=Date.now()+Math.random()*1e3,ee=Math.random().toString(36).substr(2,12);m.id=`${I}_${ee}_restored_v2`,console.log("Generated new unique ID:",m.id)}const D=[...w,m];console.log("Updated price quotes after restore:",D.length,"total quotes");let O=null,Q=null;if(D.length>0){const I=D.reduce((ee,J)=>{const oe=parseFloat(ee.price)||0;return(parseFloat(J.price)||0)<oe?J:ee});O=I.price,Q=I.supplierName}const z={...l,priceQuotes:D};O&&(z.price=O,z.supplier=Q),await s.updateLocalProduct(e.localProductId,z),console.log("Price quote successfully restored to local product")}catch(s){throw console.error("=== LOCAL PRODUCT RESTORATION ERROR ==="),console.error("Error message:",s.message),console.error("Error stack:",s.stack),console.error("Error details:",{localProductId:e.localProductId,quoteName:t.supplierName,step:"Local Product Restoration",originalDataKeys:Object.keys(t),trashItemKeys:Object.keys(e)}),s.message.includes("المنتج المحلي الأصلي غير موجود")?s:new Error(`فشل في استعادة عرض السعر للمنتج المحلي: ${s.message}`)}}static async restorePriceQuoteToForeignProduct(e,t){try{console.log("Restoring price quote to foreign product:",e.foreignProductId),console.log("Original trash item:",e);const{ForeignProductService:s}=await ar(async()=>{const{ForeignProductService:I}=await Promise.resolve().then(()=>dx);return{ForeignProductService:I}},void 0),l=(await s.getAllForeignProducts()).find(I=>I.id===e.foreignProductId);if(!l)throw new Error("المنتج المستورد الأصلي غير موجود");console.log("Found foreign product for restore:",{id:l.id,name:l.name,currentQuotesCount:(l.priceQuotes||[]).length});const{foreignProductId:c,foreignProductName:u,...m}=t,p=Date.now(),b=Math.random().toString(36).substr(2,9);m.id=`${p}_${b}_restored`,m.supplierName=m.supplierName||"مورد غير معروف",m.price=m.price||"0",m.date=m.date||"",m.supplierType=m.supplierType||"foreign",m.id=String(m.id),console.log("Restoring quote data with normalized structure:",m);const w=l.priceQuotes||[];if(console.log("Checking for duplicates in foreign product:",{existingQuotesCount:w.length,newQuoteId:m.id,newQuoteSupplier:m.supplierName,newQuotePrice:m.price,newQuoteDate:m.date,existingQuotes:w.map(I=>({id:I.id,supplier:I.supplierName,price:I.price,date:I.date}))}),w.some(I=>I.id===m.id)){console.warn("Quote with same ID already exists, generating new ID");const I=Date.now()+Math.random()*1e3,ee=Math.random().toString(36).substr(2,12);m.id=`${I}_${ee}_restored_v2`,console.log("Generated new unique ID:",m.id)}const D=[...w,m];console.log("Updated price quotes after restore:",D.length,"total quotes");let O=null,Q=null;if(D.length>0){const I=D.reduce((ee,J)=>{const oe=parseFloat(ee.price)||0;return(parseFloat(J.price)||0)<oe?J:ee});O=I.price,Q=I.supplierName}const z={...l,priceQuotes:D};O&&(z.price=O,z.supplier=Q),await s.updateForeignProduct(e.foreignProductId,z),console.log("Price quote successfully restored to foreign product")}catch(s){throw console.error("=== FOREIGN PRODUCT RESTORATION ERROR ==="),console.error("Error message:",s.message),console.error("Error stack:",s.stack),console.error("Error details:",{foreignProductId:e.foreignProductId,quoteName:t.supplierName,step:"Foreign Product Restoration",originalDataKeys:Object.keys(t),trashItemKeys:Object.keys(e)}),s.message.includes("المنتج المستورد الأصلي غير موجود")?s:new Error(`فشل في استعادة عرض السعر للمنتج المستورد: ${s.message}`)}}static async emptyTrash(){try{console.log("Emptying trash...");const e=await this.getAllTrashItems();console.log("Found",e.length,"items to delete");for(const t of e)await this.permanentlyDelete(t.id);return console.log("Successfully emptied trash"),!0}catch(e){throw console.error("Error emptying trash:",e),new Error("فشل في إفراغ سلة المهملات")}}static getItemDisplayInfo(e){const s={suppliers:{name:"مورد محلي",icon:"bi-building",color:"primary"},foreignSuppliers:{name:"مورد أجنبي",icon:"bi-globe",color:"info"},customers:{name:"عميل",icon:"bi-person-check",color:"success"},rawmaterials:{name:"مادة خام",icon:"bi-box-seam",color:"warning"},localproducts:{name:"منتج محلي",icon:"bi-box-seam",color:"success"},foreignproducts:{name:"منتج مستورد",icon:"bi-box-seam",color:"info"},manufacturedProducts:{name:"منتج مصنع",icon:"bi-boxes",color:"info"},manufactured_product_documents:{name:"وثيقة منتج مصنع",icon:"bi-file-earmark-text",color:"info"},price_quotes:{name:"عرض سعر",icon:"bi-currency-dollar",color:"dark"},tenderItems:{name:"بند مناقصة",icon:"bi-list-task",color:"secondary"},tender_documents:{name:"وثيقة مناقصة",icon:"bi-file-earmark",color:"warning"}}[e.originalCollection]||{name:"عنصر غير معروف",icon:"bi-question-circle",color:"secondary"};let a={};if(e.originalCollection==="rawmaterials")a={displayName:e.name||"بدون اسم",category:e.category||"غير محدد",minimumStock:e.minimumStock||0,supplier:e.lowestPriceSupplier||"لا يوجد"};else if(e.originalCollection==="localproducts")a={displayName:e.name||"بدون اسم",category:e.category||"غير محدد",unit:e.unit||"غير محدد",price:e.price?`${e.price} ريال`:"غير محدد",supplier:e.supplier||"لا يوجد"};else if(e.originalCollection==="foreignproducts")a={displayName:e.name||"بدون اسم",category:e.category||"غير محدد",unit:e.unit||"غير محدد",price:e.price?`${e.price} ريال`:"غير محدد",supplier:e.supplier||"لا يوجد"};else if(e.originalCollection==="price_quotes"){let l="غير معروف",c="السياق";e.rawMaterialId&&e.rawMaterialName?(l=e.rawMaterialName,c="المادة الخام"):e.localProductId&&e.localProductName?(l=e.localProductName,c="المنتج المحلي"):e.foreignProductId&&e.foreignProductName?(l=e.foreignProductName,c="المنتج المستورد"):e.rawMaterialName?(l=e.rawMaterialName,c="المادة الخام"):e.localProductName?(l=e.localProductName,c="المنتج المحلي"):e.foreignProductName&&(l=e.foreignProductName,c="المنتج المستورد"),console.log("Price quote context detection:",{rawMaterialId:e.rawMaterialId,rawMaterialName:e.rawMaterialName,localProductId:e.localProductId,localProductName:e.localProductName,foreignProductId:e.foreignProductId,foreignProductName:e.foreignProductName,finalContextName:l,finalContextLabel:c}),a={displayName:`عرض سعر - ${e.supplierName||"مورد غير معروف"}`,price:e.price?`${e.price} ريال`:"غير محدد",supplierName:e.supplierName||"غير معروف",date:e.date||"غير محدد",contextName:l,contextLabel:c}}else e.originalCollection==="tenderItems"?a={displayName:e.materialName||e.name||"بند مناقصة",quantity:e.quantity||1,price:e.totalPrice?`${Math.round(e.totalPrice)} ريال`:"غير محدد",contextName:e.tenderContext?.tenderTitle||"مناقصة غير معروفة",contextLabel:"المناقصة",itemType:e.type==="localProduct"?"منتج محلي":e.type==="foreignProduct"?"منتج أجنبي":"مادة خام"}:a={displayName:e.name||"بدون اسم",email:e.email||"لا يوجد",phone:e.phone||"لا يوجد"};return{...s,...a}}static getTimeSinceDeleted(e){const t=new Date,s=new Date(e),a=t.getTime()-s.getTime(),l=Math.floor(a/(1e3*60*60*24)),c=Math.floor(a/(1e3*60*60)),u=Math.floor(a/(1e3*60));return l>0?`منذ ${l} يوم${l>1,""}`:c>0?`منذ ${c} ساعة${c>1,""}`:u>0?`منذ ${u} دقيقة${u>1,""}`:"منذ لحظات"}static async clearAllTrashRecords(){try{console.log("🗑️ Clearing all trash records...");const e=Vt(ct(De,this.COLLECTION_NAME)),t=await St(e);console.log(`Found ${t.docs.length} records to delete`);const s=[];return t.forEach(a=>{s.push(Js(a.ref))}),await Promise.all(s),console.log("✅ Successfully cleared all trash records"),!0}catch(e){throw console.error("❌ Error clearing trash records:",e),new Error("فشل في مسح سجلات المهملات: "+e.message)}}static getItemDisplayInfo(e){const s={suppliers:{name:"مورد محلي",icon:"bi-building",color:"primary"},foreignSuppliers:{name:"مورد أجنبي",icon:"bi-globe",color:"info"},customers:{name:"عميل",icon:"bi-person-check",color:"success"},employees:{name:"موظف",icon:"bi-person-badge",color:"primary"},rawmaterials:{name:"مادة خام",icon:"bi-box-seam",color:"warning"},localproducts:{name:"منتج محلي",icon:"bi-box-seam",color:"success"},foreignproducts:{name:"منتج مستورد",icon:"bi-box-seam",color:"info"},manufacturedProducts:{name:"منتج مصنع",icon:"bi-boxes",color:"info"},manufactured_product_documents:{name:"وثيقة منتج مصنع",icon:"bi-file-earmark-text",color:"info"},price_quotes:{name:"عرض سعر",icon:"bi-currency-dollar",color:"dark"},tenderItems:{name:"بند مناقصة",icon:"bi-list-task",color:"secondary"},tender_documents:{name:"وثيقة مناقصة",icon:"bi-file-earmark",color:"warning"},employee_documents:{name:"وثيقة موظف",icon:"bi-file-earmark-person",color:"success"},manufacturedProducts:{name:"منتج مصنع",icon:"bi-boxes",color:"info"}}[e.originalCollection]||{name:"عنصر غير معروف",icon:"bi-question-circle",color:"secondary"};let a={},l=e.name||"غير محدد",c="";switch(e.originalCollection){case"suppliers":case"foreignSuppliers":a={email:e.email,phone:e.phone,address:e.address,taxNumber:e.taxNumber};break;case"customers":a={email:e.email,phone:e.phone,address:e.address,taxNumber:e.taxNumber};break;case"employees":l=e.fullName||e.name||"موظف غير محدد",a={email:e.email,phone:e.phone,department:e.department,jobTitle:e.jobTitle,status:e.status,autoCreated:e.autoCreated};break;case"rawmaterials":case"localproducts":case"foreignproducts":a={category:e.category,unit:e.unit,price:e.price?`${e.price} ر.س`:"غير محدد",supplier:e.supplier||e.manufacturer};break;case"price_quotes":l=`عرض سعر من ${e.supplierName||"غير محدد"}`,c=e.rawMaterialName||e.localProductName||e.foreignProductName||"غير محدد",a={supplierName:e.supplierName,price:e.price?`${e.price} ر.س`:"غير محدد",contextName:c,date:e.date};break;case"tenderItems":l=e.materialName||e.name||"بند مناقصة",c=e.tenderContext?.tenderTitle||"مناقصة غير محددة",a={materialName:e.materialName,quantity:e.quantity,unitPrice:e.unitPrice?`${e.unitPrice} ر.س`:"غير محدد",totalPrice:e.totalPrice?`${e.totalPrice} ر.س`:"غير محدد",contextName:c,materialCategory:e.materialCategory,materialUnit:e.materialUnit};break;case"tender_documents":l=e.fileName||e.originalFileName||"وثيقة غير محددة",c=e.tenderTitle||"مناقصة غير محددة",a={fileName:e.fileName,originalFileName:e.originalFileName,fileSize:e.fileSize?`${(e.fileSize/1024/1024).toFixed(2)} م.ب`:"غير محدد",fileType:e.fileType||"نوع غير معروف",contextName:c,uploadedAt:e.uploadedAt||e.createdAt};break;case"employee_documents":l=e.fileName||e.originalFileName||"وثيقة غير محددة",c=e.employeeName||"موظف غير محدد",a={fileName:e.fileName,originalFileName:e.originalFileName,fileSize:e.fileSize?`${(e.fileSize/1024/1024).toFixed(2)} م.ب`:"غير محدد",fileType:e.fileType||"نوع غير معروف",contextName:c,uploadedAt:e.uploadedAt||e.createdAt};break;case"manufacturedProducts":l=e.title||e.productName||e.name||"منتج غير محدد",a={productCode:e.productCode,category:e.category,manufacturer:e.manufacturer,unitPrice:e.unitPrice?`${parseFloat(e.unitPrice).toLocaleString("en-US")} ريال`:"غير محدد",stockQuantity:e.stockQuantity||"غير محدد",unit:e.unit,status:e.status==="active"?"نشط":"غير نشط",batchNumber:e.batchNumber,referenceNumber:e.referenceNumber,estimatedValue:e.estimatedValue,description:e.description,submissionDeadline:e.submissionDeadline};break;default:a={}}return{...s,displayName:l,contextName:c,...a}}}const wa=(r,e=30)=>{const[t,s]=N.useState(1),a=Math.ceil(r.length/e),l=N.useMemo(()=>{const b=(t-1)*e,w=b+e;return r.slice(b,w)},[r,t,e]);return{currentPage:t,totalPages:a,paginatedItems:l,handlePageChange:b=>{b>=1&&b<=a&&(s(b),window.scrollTo({top:0,behavior:"smooth"}))},resetPage:()=>{s(1)},goToFirstPage:()=>{s(1)},goToLastPage:()=>{s(a)},totalItems:r.length,itemsPerPage:e,hasNextPage:t<a,hasPreviousPage:t>1}},tC=r=>{if(!r)return"";const e=r instanceof Date?r:new Date(r);if(isNaN(e.getTime()))return"";const t=e.getDate().toString().padStart(2,"0"),s=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getFullYear();return`${t}/${s}/${a}`},nC=r=>{if(!r)return"";const e=r instanceof Date?r:new Date(r);if(isNaN(e.getTime()))return"";const t=e.getDate().toString().padStart(2,"0"),s=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getFullYear(),l=e.getHours().toString().padStart(2,"0"),c=e.getMinutes().toString().padStart(2,"0");return`${t}/${s}/${a} ${l}:${c}`},ku=r=>{if(!r)return"";const e=r instanceof Date?r:new Date(r);if(isNaN(e.getTime()))return"";const t=e.getFullYear(),s=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0");return`${t}-${s}-${a}`},o4=r=>{if(!r||typeof r!="string")return null;const e=r.split("/");if(e.length===3){const t=parseInt(e[0],10),s=parseInt(e[1],10)-1,a=parseInt(e[2],10);if(!isNaN(t)&&!isNaN(s)&&!isNaN(a))return new Date(a,s,t)}return new Date(r)},l4=()=>tC(new Date),c4=()=>nC(new Date),yh=()=>({formatDate:r=>{if(!r)return"-";try{return tC(r)}catch(e){return console.error("Date formatting error:",e),"-"}},formatDateTime:r=>{if(!r)return"-";try{return nC(r)}catch(e){return console.error("DateTime formatting error:",e),"-"}},formatDateForInput:r=>{if(!r)return"";try{return ku(r)}catch(e){return console.error("Date input formatting error:",e),""}},parseDate:r=>{try{return o4(r)}catch(e){return console.error("Date parsing error:",e),null}},getToday:()=>{try{return l4()}catch(r){return console.error("Today date error:",r),"-"}},getCurrentDateTime:()=>{try{return c4()}catch(r){return console.error("Current datetime error:",r),"-"}},isExpired:r=>{if(!r)return!1;try{return(r instanceof Date?r:new Date(r))<new Date}catch{return!1}},getDaysRemaining:r=>{if(!r)return 0;try{const s=(r instanceof Date?r:new Date(r))-new Date;return Math.ceil(s/(1e3*60*60*24))}catch{return 0}}}),va=({currentPage:r,totalPages:e,onPageChange:t,totalItems:s,itemsPerPage:a=30,showItemsInfo:l=!0})=>{const c=()=>{const w=[],j=[];for(let D=Math.max(2,r-2);D<=Math.min(e-1,r+2);D++)w.push(D);return r-2>2?j.push(1,"..."):j.push(1),j.push(...w),r+2<e-1?j.push("...",e):j.push(e),j},u=b=>{b!=="..."&&b!==r&&b>=1&&b<=e&&t(b)},m=(r-1)*a+1,p=Math.min(r*a,s);return e<=1?null:n.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-4 px-3 py-3 border-top bg-light",children:[l&&n.jsx("div",{className:"text-muted",children:n.jsxs("small",{children:["عرض ",m.toLocaleString("en-US")," - ",p.toLocaleString("en-US")," من ",s.toLocaleString("en-US")," عنصر"]})}),n.jsx("nav",{"aria-label":"التنقل بين الصفحات",children:n.jsxs("ul",{className:"pagination pagination-sm mb-0",style:{direction:"ltr"},children:[n.jsx("li",{className:`page-item ${r===1?"disabled":""}`,children:n.jsxs("button",{className:"page-link",onClick:()=>u(r-1),disabled:r===1,style:{borderRadius:"6px 0 0 6px",border:"1px solid #dee2e6",color:r===1?"#6c757d":"#007bff"},children:[n.jsx("i",{className:"bi bi-chevron-right",style:{fontSize:"12px"}}),n.jsx("span",{className:"me-1",children:"السابق"})]})}),c().map((b,w)=>n.jsx("li",{className:`page-item ${b===r?"active":""}`,children:b==="..."?n.jsx("span",{className:"page-link",style:{border:"1px solid #dee2e6",color:"#6c757d",cursor:"default"},children:"..."}):n.jsx("button",{className:"page-link",onClick:()=>u(b),style:{border:"1px solid #dee2e6",minWidth:"40px",backgroundColor:b===r?"#007bff":"white",color:b===r?"white":"#007bff",fontWeight:b===r?"600":"400"},children:b})},w)),n.jsx("li",{className:`page-item ${r===e?"disabled":""}`,children:n.jsxs("button",{className:"page-link",onClick:()=>u(r+1),disabled:r===e,style:{borderRadius:"0 6px 6px 0",border:"1px solid #dee2e6",color:r===e?"#6c757d":"#007bff"},children:[n.jsx("span",{className:"ms-1",children:"التالي"}),n.jsx("i",{className:"bi bi-chevron-left",style:{fontSize:"12px"}})]})})]})}),!l&&n.jsx("div",{})]})},d4=({refreshTrigger:r})=>{const e=ms();console.log("TendersListFixed is rendering");const[t,s]=N.useState([]),[a,l]=N.useState(!0),[c,u]=N.useState(null),[m,p]=N.useState(""),[b,w]=N.useState([]),[j,D]=N.useState(!1),{logActivity:O,getCurrentUser:Q}=vn(),{alertConfig:z,closeAlert:I,showSuccess:ee,showError:J,showConfirm:oe}=Pn(),{formatDate:Y}=yh(),{currentPage:be,totalPages:M,paginatedItems:H,handlePageChange:k,resetPage:$,totalItems:X,itemsPerPage:te}=wa(b,30);console.log("TendersListFixed state:",{tendersCount:t.length,loading:a,error:c});const F=async()=>{try{l(!0),u(null),console.log("Loading tenders...");const se=await tf.getAllTenders();console.log("Tenders loaded:",se.length),s(se)}catch(se){console.error("Error loading tenders:",se),u(se.message||"فشل في تحميل المناقصات")}finally{l(!1)}};N.useEffect(()=>{F()},[r]),N.useEffect(()=>{if(m.trim()){const se=t.filter(fe=>fe.title?.toLowerCase().includes(m.toLowerCase())||fe.referenceNumber?.toLowerCase().includes(m.toLowerCase())||fe.entity?.toLowerCase().includes(m.toLowerCase())||fe.description?.toLowerCase().includes(m.toLowerCase()));w(se)}else w(t);$()},[m,t,$]);const ce=se=>{oe(`هل أنت متأكد من حذف هذه المناقصة؟

${se.title}`,()=>Be(se),"تأكيد حذف المناقصة")},Be=async se=>{try{D(!0),await Gn.moveToTrash(se,"tenders"),await tf.deleteTender(se.id);const fe=Q();O("task",`${fe.name} حذف مناقصة`,`تم حذف المناقصة: ${se.title}`),F(),ee(`تم نقل المناقصة للمهملات: ${se.title}`,"تم النقل للمهملات")}catch(fe){console.error("Error deleting tender:",fe),J(`فشل في نقل المناقصة للمهملات: ${fe.message}`,"خطأ في النقل")}finally{D(!1)}},U=se=>{const fe=new Date,ie=new Date(se.submissionDeadline);return fe>ie?n.jsx("span",{className:"badge bg-danger text-white",children:"مغلقة للتقديم"}):n.jsx("span",{className:"badge bg-success",children:"مفتوحة"})};return a?(console.log("TendersListFixed: Showing loading state"),n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"spinner-border text-primary",role:"status",children:n.jsx("span",{className:"visually-hidden",children:"جار التحميل..."})}),n.jsx("p",{className:"mt-3 text-muted",children:"جار تحميل بيانات المناقصات..."})]})})):c?(console.log("TendersListFixed: Showing error state:",c),n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:c}),n.jsx("div",{className:"d-flex gap-2 justify-content-center",children:n.jsxs("button",{className:"btn btn-primary",onClick:F,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة تحميل البيانات"]})})]})})):(console.log("TendersListFixed: Showing main content with",b.length,"tenders"),n.jsxs("div",{className:"card shadow-sm","data-list":"tenders",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-clipboard-check-fill text-primary me-2"}),"قائمة المناقصات المحدثة (",b.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsx("div",{className:"d-flex justify-content-end align-items-center gap-3",children:n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المناقصات...",value:m,onChange:se=>p(se.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]})})})]})}),n.jsxs("div",{className:"card-body p-0",children:[b.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-clipboard-check fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد مناقصات"}),n.jsx("p",{className:"text-muted",children:m?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي مناقصات بعد"}),!m&&n.jsxs("button",{className:"btn btn-primary",onClick:()=>e("/tenders/add"),children:[n.jsx("i",{className:"bi bi-plus-lg me-1"}),"إضافة أول مناقصة"]})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"عنوان المناقصة"}),n.jsx("th",{className:"text-center",children:"التكلفة التقديرية"}),n.jsx("th",{className:"text-center",children:"جهة المناقصة"}),n.jsx("th",{className:"text-center",children:"موعد انتهاء التقديم"}),n.jsx("th",{className:"text-center",children:"الحالة"}),n.jsx("th",{className:"text-center",style:{width:"120px",paddingLeft:"40px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:H.map((se,fe)=>n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(be-1)*te+fe+1})}),n.jsx("td",{className:"text-center",children:n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary tender-title-btn",onClick:()=>{se.id?e(`/tenders/edit/${se.id}`):J("معرف المناقصة مفقود، لا يمكن التنقل","خطأ في التنقل")},style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0"},title:`انقر للتعديل | Firebase ID: ${se.id||"Missing"}`,children:se.title})}),n.jsx("td",{className:"text-center",children:n.jsxs("span",{className:"badge bg-success text-white",children:[(se.estimatedValue||0).toLocaleString("en-US")," ر.س"]})}),n.jsx("td",{className:"text-center",children:se.entity}),n.jsx("td",{className:"text-center",children:Y(se.submissionDeadline)}),n.jsx("td",{className:"text-center",children:U(se)}),n.jsx("td",{className:"text-center",style:{paddingLeft:"40px"},children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{className:"btn btn-outline-primary",onClick:()=>{if(!se||!se.id){J("بيانات المناقصة غير صحيحة أو مفقودة","خطأ في البيانات");return}e(`/tenders/edit/${se.id}`)},title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{className:"btn btn-outline-danger",onClick:()=>ce(se),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},se.internalId||se.id||`tender-${fe}`))})]})}),b.length>0&&n.jsx(va,{currentPage:be,totalPages:M,onPageChange:k,totalItems:X,itemsPerPage:te})]}),n.jsx(Rn,{show:z.show,onClose:I,title:z.title,message:z.message,type:z.type,onConfirm:z.onConfirm,showConfirm:z.showConfirm})]}))},u4=({refreshTrigger:r})=>(console.log("TendersList wrapper is rendering - delegating to TendersListFixed"),n.jsx(d4,{refreshTrigger:r}));function h4(){const[r,e]=N.useState(!1),[t,s]=N.useState(0),{isTimelineVisible:a}=$n(),l=ms(),c=()=>{e(!r)},u=async()=>{try{await rt.clearPendingData("tenderFormData_new"),await rt.clearPendingData("tenderDocuments_new"),await rt.clearPendingTenderItems(),console.log("✅ All pending data cleared - navigating to fresh Add Tender form"),l("/tenders/add")}catch(m){console.error("❌ Error clearing pending data:",m),l("/tenders/add")}};return n.jsx(sn,{children:n.jsx(rn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Kn,{onToggle:c}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!a?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"قائمة المناقصات"})]})}),n.jsx(Yn,{}),n.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:n.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[n.jsx("div",{className:"d-flex align-items-center",children:n.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[n.jsx("i",{className:"bi bi-file-earmark-text text-primary me-2"}),"إدارة المناقصات"]})}),n.jsx("button",{onClick:u,className:"btn btn-primary",style:{height:"32px",width:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center"},children:"إضافة مناقصة"})]})}),n.jsx("div",{className:"card-body p-0",children:n.jsx(u4,{refreshTrigger:t})})]})})})]}),!r&&a&&n.jsx(Xn,{rtl:!0}),!r&&a&&n.jsx(Jn,{})]})]})})})}function m4(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(h4,{})})})}class oo{static COLLECTIONS={customers:"customers",suppliers:"suppliers",foreignSuppliers:"foreignSuppliers",rawmaterials:"rawmaterials"};static async isFieldUnique(e,t,s=null,a=null){if(!t||t.trim()==="")return!0;const l=t.trim().toLowerCase();console.log(`🔍 Checking uniqueness for ${e}: "${l}"`);for(const[c,u]of Object.entries(this.COLLECTIONS))try{console.log(`📋 Checking collection: ${c} (exclude: ${a})`);const m=await St(ct(De,u));console.log(`📊 Found ${m.docs.length} documents in ${c}`);for(const p of m.docs){const b=p.data();if(s&&p.id===s&&a===c){console.log(`⏭️ Skipping same document: ${p.id} in ${c}`);continue}const w=b[e]?.toString().trim().toLowerCase();if(w&&w!==""&&(console.log(`🔎 Comparing "${l}" with "${w}" from ${c}`),w===l)){const j=`هذا ${this.getFieldDisplayName(e)} مستخدم بالفعل في ${this.getCollectionDisplayName(c)}`;throw console.log(`❌ Duplicate found: ${j}`),new Error(j)}}}catch(m){if(m.message.includes("مستخدم بالفعل"))throw m;console.error(`Error checking uniqueness in ${c}:`,m)}return console.log(`✅ ${e} is unique: "${l}"`),!0}static async validateUniqueFields(e,t=null,s=null){const a={},l=["phone","email","taxNumber"];for(const c of l)if(e[c]&&e[c].trim()!=="")try{await this.isFieldUnique(c,e[c],t,s)}catch(u){a[c]=u.message}return a}static getFieldDisplayName(e){return{name:"الاسم",phone:"رقم الهاتف",email:"البريد الإلكتروني",taxNumber:"الرقم الضريبي"}[e]||e}static getCollectionDisplayName(e){return{customers:"العملاء",suppliers:"الموردين المحليين",foreignSuppliers:"الموردين الأجانب",rawmaterials:"المواد الخام"}[e]||e}static async isNameUnique(e,t=null,s=null){return!0}static async isPhoneUnique(e,t=null,s=null){return await this.isFieldUnique("phone",e,t,s)}static async isEmailUnique(e,t=null,s=null){return await this.isFieldUnique("email",e,t,s)}static async isTaxNumberUnique(e,t=null,s=null){return await this.isFieldUnique("taxNumber",e,t,s)}static async validateFieldRealTime(e,t,s=null,a=null){if(!t||t.trim()==="")return null;try{return await this.isFieldUnique(e,t,s,a),null}catch(l){return l.message}}}const sC=({show:r,onClose:e,onItemSelect:t,selectedItemType:s,setSelectedItemType:a})=>{if(!r)return null;const l=c=>{try{const u=c.target.value;console.log("Selected item type:",u),a(u),setTimeout(()=>{try{e(),t&&t(u)}catch(m){console.error("Navigation error:",m)}},300)}catch(u){console.error("Error handling item type change:",u)}};return n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:n.jsx("div",{className:"modal-dialog modal-dialog-centered",style:{maxWidth:"500px"},children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header border-bottom-0 pb-0",children:[n.jsx("h5",{className:"modal-title fw-bold text-primary",children:"اختر نوع البند"}),n.jsx("button",{type:"button",className:"btn-close",onClick:e,"aria-label":"Close"})]}),n.jsx("div",{className:"modal-body py-4",children:n.jsxs("div",{className:"row g-3",children:[n.jsx("div",{className:"col-6",children:n.jsxs("div",{className:"form-check p-0",children:[n.jsx("input",{className:"form-check-input d-none",type:"radio",name:"itemType",id:"raw-materials",value:"raw-materials",checked:s==="raw-materials",onChange:l}),n.jsxs("label",{className:`form-check-label w-100 p-3 border rounded-3 text-center cursor-pointer transition-all ${s==="raw-materials"?"border-primary text-primary":"border-light hover-border-primary"}`,htmlFor:"raw-materials",style:{cursor:"pointer",backgroundColor:s==="raw-materials"?"#f8f9fa":"#f5f5f5"},children:[n.jsx("i",{className:"bi bi-gear fs-1 d-block mb-2",style:{color:"#dc3545"}}),n.jsx("span",{className:"fw-medium",children:"مواد خام"})]})]})}),n.jsx("div",{className:"col-6",children:n.jsxs("div",{className:"form-check p-0",children:[n.jsx("input",{className:"form-check-input d-none",type:"radio",name:"itemType",id:"local-product",value:"local-product",checked:s==="local-product",onChange:l}),n.jsxs("label",{className:`form-check-label w-100 p-3 border rounded-3 text-center cursor-pointer transition-all ${s==="local-product"?"border-primary text-primary":"border-light hover-border-primary"}`,htmlFor:"local-product",style:{cursor:"pointer",backgroundColor:s==="local-product"?"#f8f9fa":"#f5f5f5"},children:[n.jsx("i",{className:"bi bi-house fs-1 d-block mb-2",style:{color:"#198754"}}),n.jsx("span",{className:"fw-medium",children:"منتج محلي"})]})]})}),n.jsx("div",{className:"col-6",children:n.jsxs("div",{className:"form-check p-0",children:[n.jsx("input",{className:"form-check-input d-none",type:"radio",name:"itemType",id:"imported-product",value:"imported-product",checked:s==="imported-product",onChange:l}),n.jsxs("label",{className:`form-check-label w-100 p-3 border rounded-3 text-center cursor-pointer transition-all ${s==="imported-product"?"border-primary text-primary":"border-light hover-border-primary"}`,htmlFor:"imported-product",style:{cursor:"pointer",backgroundColor:s==="imported-product"?"#f8f9fa":"#f5f5f5"},children:[n.jsx("i",{className:"bi bi-globe fs-1 d-block mb-2",style:{color:"#0dcaf0"}}),n.jsx("span",{className:"fw-medium",children:"منتج مستورد"})]})]})}),n.jsx("div",{className:"col-6",children:n.jsxs("div",{className:"form-check p-0",children:[n.jsx("input",{className:"form-check-input d-none",type:"radio",name:"itemType",id:"manufactured-product",value:"manufactured-product",checked:s==="manufactured-product",onChange:l}),n.jsxs("label",{className:`form-check-label w-100 p-3 border rounded-3 text-center cursor-pointer transition-all ${s==="manufactured-product"?"border-primary text-primary":"border-light hover-border-primary"}`,htmlFor:"manufactured-product",style:{cursor:"pointer",backgroundColor:s==="manufactured-product"?"#f8f9fa":"#f5f5f5"},children:[n.jsx("i",{className:"bi bi-tools fs-1 d-block mb-2",style:{color:"#fd7e14"}}),n.jsx("span",{className:"fw-medium",children:"منتج مصنع"})]})]})})]})})]})})})},Xc="rawmaterials",Rb=()=>{window.dispatchEvent(new CustomEvent("rawMaterialsUpdated"))};class wr{static async getAllRawMaterials(){try{const e=ct(De,Xc),t=Vt(e,hs("createdAt","desc"));return(await St(t)).docs.map(a=>{const l=a.data();return{id:a.id,internalId:l.internalId||Ct("RAW_MATERIAL"),...l,createdAt:l.createdAt?.toDate(),updatedAt:l.updatedAt?.toDate()}})}catch(e){throw console.error("Error fetching raw materials:",e),new Error("فشل في جلب بيانات المواد الخام")}}static async getRawMaterialById(e){try{const t=ut(De,Xc,e),s=await cs(t);if(s.exists()){const a=s.data();return{id:s.id,internalId:a.internalId||Ct("RAW_MATERIAL"),...a,createdAt:a.createdAt?.toDate(),updatedAt:a.updatedAt?.toDate()}}else return null}catch(t){throw console.error("Error fetching raw material by ID:",t),new Error("فشل في جلب بيانات المادة الخام")}}static async getRawMaterialByInternalId(e){try{const t=ct(De,Xc),s=Vt(t,jn("internalId","==",e)),a=await St(s);if(a.empty)return null;{const l=a.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:c.createdAt?.toDate(),updatedAt:c.updatedAt?.toDate()}}}catch(t){throw console.error("Error fetching raw material by internal ID:",t),new Error("فشل في جلب بيانات المادة الخام")}}static async updateRawMaterialByInternalId(e,t){try{const s=await this.getRawMaterialByInternalId(e);if(!s)throw new Error("Raw material not found");return await this.updateRawMaterial(s.id,t)}catch(s){throw console.error("Error updating raw material by internal ID:",s),new Error("فشل في تحديث بيانات المادة الخام")}}static async deleteRawMaterialByInternalId(e){try{const t=await this.getRawMaterialByInternalId(e);if(!t)throw new Error("Raw material not found");return await this.deleteRawMaterial(t.id)}catch(t){throw console.error("Error deleting raw material by internal ID:",t),new Error("فشل في حذف المادة الخام")}}static async createRawMaterial(e){try{const t=Ct("RAW_MATERIAL"),s={...e,internalId:t,createdAt:vt(),updatedAt:vt()},a=await Mr(ct(De,Xc),s);return Rb(),a.id}catch(t){throw console.error("Error creating raw material:",t),new Error("فشل في إنشاء المادة الخام")}}static async updateRawMaterial(e,t){try{const s=ut(De,Xc,e),a={...t,updatedAt:vt()};return await Xs(s,a),Rb(),!0}catch(s){throw console.error("Error updating raw material:",s),new Error("فشل في تحديث بيانات المادة الخام")}}static async deleteRawMaterial(e){try{const t=ut(De,Xc,e);return await Js(t),Rb(),!0}catch(t){throw console.error("Error deleting raw material:",t),new Error("فشل في حذف المادة الخام")}}static async searchRawMaterials(e){try{const t=ct(De,Xc);return(await St(t)).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||Ct("RAW_MATERIAL"),...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate()}}).filter(c=>c.name?.toLowerCase().includes(e.toLowerCase())||c.category?.toLowerCase().includes(e.toLowerCase())||c.description?.toLowerCase().includes(e.toLowerCase())||c.supplier?.toLowerCase().includes(e.toLowerCase()))}catch(t){throw console.error("Error searching raw materials:",t),new Error("فشل في البحث عن المواد الخام")}}static async migrateExistingData(){try{console.log("Starting raw materials migration...");const e=await this.getAllRawMaterials();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("rm_")){const a=Ct("RAW_MATERIAL");await this.updateRawMaterial(s.id,{...s,internalId:a}),t++,console.log(`Migrated raw material: ${s.name} -> ${a}`)}return console.log(`Migration completed. ${t} raw materials migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("فشل في ترحيل البيانات")}}static async getRawMaterialsByInternalIds(e){try{const t=e.map(a=>this.getRawMaterialByInternalId(a));return(await Promise.all(t)).filter(a=>a!==null)}catch(t){throw console.error("Error fetching raw materials by internal IDs:",t),new Error("فشل في جلب بيانات المواد الخام")}}static validateRawMaterialData(e){const t={};return e.name?.trim()||(t.name="اسم المادة الخام مطلوب"),e.category?.trim()||(t.category="فئة المادة الخام مطلوبة"),e.unit?.trim()||(t.unit="الوحدة مطلوبة"),(!e.price||parseFloat(e.price)<=0)&&(t.price="السعر يجب أن يكون أكبر من صفر"),t}}const lx=Object.freeze(Object.defineProperty({__proto__:null,RawMaterialService:wr},Symbol.toStringTag,{value:"Module"})),Jc="localproducts",Pb=()=>{window.dispatchEvent(new CustomEvent("localProductsUpdated"))};class vr{static async getAllLocalProducts(){try{const e=ct(De,Jc);let t;try{t=Vt(e,hs("createdAt","desc"))}catch{console.log("Using query without orderBy for empty collection"),t=Vt(e)}const a=(await St(t)).docs.map(l=>{const c=l.data();return{id:l.id,internalId:c.internalId||Ct("LOCAL_PRODUCT"),...c,createdAt:c.createdAt?.toDate(),updatedAt:c.updatedAt?.toDate()}});return a.length>0&&a[0].createdAt&&a.sort((l,c)=>(c.createdAt||new Date(0))-(l.createdAt||new Date(0))),a}catch(e){if(console.error("Error fetching local products:",e),console.error("Error details:",e.code,e.message),e.code==="failed-precondition"||e.message.includes("index"))return console.log("Collection appears to be empty or missing index, returning empty array"),[];throw new Error("فشل في جلب بيانات المنتجات المحلية: "+e.message)}}static async getLocalProductById(e){try{const t=ut(De,Jc,e),s=await cs(t);if(s.exists()){const a=s.data();return{id:s.id,internalId:a.internalId||Ct("LOCAL_PRODUCT"),...a,createdAt:a.createdAt?.toDate(),updatedAt:a.updatedAt?.toDate()}}else return null}catch(t){throw console.error("Error fetching local product by ID:",t),new Error("فشل في جلب بيانات المنتج المحلي")}}static async createLocalProduct(e){try{const t=Ct("LOCAL_PRODUCT"),s={...e,internalId:t,createdAt:vt(),updatedAt:vt()},a=await Mr(ct(De,Jc),s);return Pb(),a.id}catch(t){throw console.error("Error creating local product:",t),new Error("فشل في إنشاء المنتج المحلي")}}static async updateLocalProduct(e,t){try{const s=ut(De,Jc,e),a={...t,updatedAt:vt()};return await Xs(s,a),Pb(),!0}catch(s){throw console.error("Error updating local product:",s),new Error("فشل في تحديث بيانات المنتج المحلي")}}static async getLocalProductByInternalId(e){try{const t=ct(De,Jc),s=Vt(t,jn("internalId","==",e)),a=await St(s);if(a.empty)return null;{const l=a.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:c.createdAt?.toDate(),updatedAt:c.updatedAt?.toDate()}}}catch(t){throw console.error("Error fetching local product by internal ID:",t),new Error("فشل في جلب بيانات المنتج المحلي")}}static async updateLocalProductByInternalId(e,t){try{const s=await this.getLocalProductByInternalId(e);if(!s)throw new Error("Local product not found");return await this.updateLocalProduct(s.id,t)}catch(s){throw console.error("Error updating local product by internal ID:",s),new Error("فشل في تحديث بيانات المنتج المحلي")}}static async deleteLocalProduct(e){try{const t=ut(De,Jc,e);return await Js(t),Pb(),!0}catch(t){throw console.error("Error deleting local product:",t),new Error("فشل في حذف المنتج المحلي")}}static async deleteLocalProductByInternalId(e){try{const t=await this.getLocalProductByInternalId(e);if(!t)throw new Error("Local product not found");return await this.deleteLocalProduct(t.id)}catch(t){throw console.error("Error deleting local product by internal ID:",t),new Error("فشل في حذف المنتج المحلي")}}static async searchLocalProducts(e){try{const t=ct(De,Jc);return(await St(t)).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||Ct("LOCAL_PRODUCT"),...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate()}}).filter(c=>c.name?.toLowerCase().includes(e.toLowerCase())||c.category?.toLowerCase().includes(e.toLowerCase())||c.description?.toLowerCase().includes(e.toLowerCase())||c.supplier?.toLowerCase().includes(e.toLowerCase()))}catch(t){if(console.error("Error searching local products:",t),console.error("Error details:",t.code,t.message),t.code==="failed-precondition"||t.message.includes("index")||t.code==="not-found")return console.log("Collection appears to be empty or missing, returning empty array"),[];throw new Error("فشل في البحث عن المنتجات المحلية: "+t.message)}}static async migrateExistingData(){try{console.log("Starting local products migration...");const e=await this.getAllLocalProducts();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("lp_")){const a=Ct("LOCAL_PRODUCT");await this.updateLocalProduct(s.id,{...s,internalId:a}),t++,console.log(`Migrated local product: ${s.name} -> ${a}`)}return console.log(`Migration completed. ${t} local products migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("فشل في ترحيل البيانات")}}static validateLocalProductData(e){const t={};return e.name?.trim()||(t.name="اسم المنتج المحلي مطلوب"),e.category?.trim()||(t.category="فئة المنتج المحلي مطلوبة"),e.unit?.trim()||(t.unit="الوحدة مطلوبة"),(!e.price||parseFloat(e.price)<=0)&&(t.price="السعر يجب أن يكون أكبر من صفر"),t}}const cx=Object.freeze(Object.defineProperty({__proto__:null,LocalProductService:vr},Symbol.toStringTag,{value:"Module"}));async function rC(r,e){const t=await Mr(ct(De,r),{...e,_createdAt:new Date});return await sh(t,{...e,id:t.id,_createdAt:new Date},{merge:!0}),t.id}async function iC(r,e){const t=await cs(ut(De,r,e));return t.exists()?{id:t.id,...t.data()}:null}const Zc="foreignproducts",kb=()=>{window.dispatchEvent(new CustomEvent("foreignProductsUpdated"))};class Nr{static async getAllForeignProducts(){try{const e=ct(De,Zc);let t;try{const a=Vt(e,hs("createdAt","desc"));t=await St(a,"getAllForeignProducts")}catch(a){console.log("OrderBy failed, using simple query:",a.message),t=await St(e,"getAllForeignProducts-simple")}const s=t.docs.map(a=>{const l=a.data();return{id:a.id,internalId:l.internalId||Ct("FOREIGN_PRODUCT"),...l,createdAt:l.createdAt?.toDate(),updatedAt:l.updatedAt?.toDate()}});return s.length>0&&s[0].createdAt&&s.sort((a,l)=>(l.createdAt||new Date(0))-(a.createdAt||new Date(0))),s}catch(e){if(console.error("Error fetching foreign products:",e),console.error("Error details:",e.code,e.message),e.code==="failed-precondition"||e.message.includes("index"))return console.log("Collection appears to be empty or missing index, returning empty array"),[];throw new Error("فشل في جلب بيانات المنتجات المستوردة: "+e.message)}}static async getForeignProductById(e){try{const t=await iC(Zc,e);return t?{...t,internalId:t.internalId||Ct("FOREIGN_PRODUCT"),createdAt:t.createdAt?.toDate(),updatedAt:t.updatedAt?.toDate()}:null}catch(t){throw console.error("Error fetching foreign product by ID:",t),new Error("فشل في جلب بيانات المنتج المستورد")}}static async addForeignProduct(e){try{const t=Ct("FOREIGN_PRODUCT");let s=null;if(e.priceQuotes&&e.priceQuotes.length>0){const c=e.priceQuotes.map(u=>parseFloat(u.price)).filter(u=>!isNaN(u));c.length>0&&(s=Math.min(...c))}const a={...e,internalId:t,price:s!==null?s.toString():e.price||"",createdAt:vt(),updatedAt:vt()},l=await rC(Zc,a);return kb(),l}catch(t){throw console.error("Error adding foreign product:",t),new Error("فشل في إضافة المنتج المستورد")}}static async createForeignProduct(e){return this.addForeignProduct(e)}static async updateForeignProduct(e,t){try{let s=null;if(t.priceQuotes&&t.priceQuotes.length>0){const c=t.priceQuotes.map(u=>parseFloat(u.price)).filter(u=>!isNaN(u));c.length>0&&(s=Math.min(...c))}const a=ut(De,Zc,e),l={...t,price:s!==null?s.toString():t.price||"",updatedAt:vt()};return await Xs(a,l,"updateForeignProduct"),kb(),!0}catch(s){throw console.error("Error updating foreign product:",s),new Error("فشل في تحديث بيانات المنتج المستورد")}}static async getForeignProductByInternalId(e){try{const t=ct(De,Zc),s=Vt(t,jn("internalId","==",e)),a=await St(s,"getForeignProductByInternalId");if(a.empty)return null;{const l=a.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:c.createdAt?.toDate(),updatedAt:c.updatedAt?.toDate()}}}catch(t){throw console.error("Error fetching foreign product by internal ID:",t),new Error("فشل في جلب بيانات المنتج المستورد")}}static async updateForeignProductByInternalId(e,t){try{const s=await this.getForeignProductByInternalId(e);if(!s)throw new Error("Foreign product not found");return await this.updateForeignProduct(s.id,t)}catch(s){throw console.error("Error updating foreign product by internal ID:",s),new Error("فشل في تحديث بيانات المنتج المستورد")}}static async deleteForeignProduct(e){try{const t=ut(De,Zc,e);return await Js(t,"deleteForeignProduct"),kb(),!0}catch(t){throw console.error("Error deleting foreign product:",t),new Error("فشل في حذف المنتج المستورد")}}static async deleteForeignProductByInternalId(e){try{const t=await this.getForeignProductByInternalId(e);if(!t)throw new Error("Foreign product not found");return await this.deleteForeignProduct(t.id)}catch(t){throw console.error("Error deleting foreign product by internal ID:",t),new Error("فشل في حذف المنتج المستورد")}}static async searchForeignProducts(e){try{const t=ct(De,Zc);return(await St(t,"searchForeignProducts")).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||Ct("FOREIGN_PRODUCT"),...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate()}}).filter(c=>c.name?.toLowerCase().includes(e.toLowerCase())||c.category?.toLowerCase().includes(e.toLowerCase())||c.description?.toLowerCase().includes(e.toLowerCase())||c.supplier?.toLowerCase().includes(e.toLowerCase()))}catch(t){if(console.error("Error searching foreign products:",t),console.error("Error details:",t.code,t.message),t.code==="failed-precondition"||t.message.includes("index")||t.code==="not-found")return console.log("Collection appears to be empty or missing, returning empty array"),[];throw new Error("فشل في البحث عن المنتجات المستوردة: "+t.message)}}static async migrateExistingData(){try{console.log("Starting foreign products migration...");const e=await this.getAllForeignProducts();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("fp_")){const a=Ct("FOREIGN_PRODUCT");await this.updateForeignProduct(s.id,{...s,internalId:a}),t++,console.log(`Migrated foreign product: ${s.name} -> ${a}`)}return console.log(`Migration completed. ${t} foreign products migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("فشل في ترحيل البيانات")}}static validateForeignProductData(e){const t={};return e.name?.trim()||(t.name="اسم المنتج المستورد مطلوب"),e.category?.trim()||(t.category="فئة المنتج المستورد مطلوبة"),e.unit?.trim()||(t.unit="الوحدة مطلوبة"),(!e.price||parseFloat(e.price)<=0)&&(t.price="السعر يجب أن يكون أكبر من صفر"),t}}const dx=Object.freeze(Object.defineProperty({__proto__:null,ForeignProductService:Nr},Symbol.toStringTag,{value:"Module"})),fa="tenderItems",ed=()=>{window.dispatchEvent(new CustomEvent("tenderItemsUpdated",{detail:{timestamp:Date.now()}}))};class sv{static async getTenderItems(e){try{console.log("🔍 Fetching tender items for tender:",e);const t=ct(De,fa),s=Vt(t,jn("tenderId","==",e),hs("createdAt","desc")),l=(await St(s)).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||Ct("TENDER_ITEM"),...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate()}});return console.log("✅ Fetched tender items:",l.length),l}catch(t){if(console.error("❌ Error fetching tender items:",t),t.code==="failed-precondition"){console.log("⚠️ OrderBy failed, trying simple query...");try{const s=ct(De,fa),a=Vt(s,jn("tenderId","==",e)),c=(await St(a)).docs.map(u=>{const m=u.data();return{id:u.id,internalId:m.internalId||Ct("TENDER_ITEM"),...m,createdAt:m.createdAt?.toDate(),updatedAt:m.updatedAt?.toDate()}});return c.sort((u,m)=>(m.createdAt||new Date(0))-(u.createdAt||new Date(0))),c}catch(s){return console.error("❌ Fallback query failed:",s),[]}}throw new Error("فشل في جلب بنود المناقصة")}}static async addMaterialToTender(e,t,s,a=1){try{console.log("📝 Adding material to tender:",{tenderId:e,materialInternalId:t,materialType:s,quantity:a});const c=(await this.getTenderItems(e)).find(D=>D.materialInternalId===t&&D.materialType===s);if(c){console.log("⚠️ Duplicate material found, updating quantity instead");const D=(c.quantity||1)+a;return await this.updateTenderItemQuantity(c.id,D)}let u=null;switch(s){case"rawMaterial":u=await wr.getRawMaterialByInternalId(t);break;case"localProduct":u=await vr.getLocalProductByInternalId(t);break;case"foreignProduct":u=await Nr.getForeignProductByInternalId(t);break;default:throw new Error(`نوع المادة غير مدعوم: ${s}`)}if(!u)throw new Error(`لا يمكن العثور على المادة: ${t}`);const m=parseFloat(a)||1,p=parseFloat(u.price)||0,b=m*p,w={internalId:Ct("TENDER_ITEM"),tenderId:e,materialInternalId:t,materialType:s,materialName:u.name,materialCategory:u.category,materialUnit:u.unit,quantity:m,unitPrice:p,totalPrice:b,supplierInfo:{name:u.supplier||"",id:u.supplierId||""},createdAt:vt(),updatedAt:vt()},j=await Mr(ct(De,fa),w);return console.log("✅ Added tender item with ID:",j.id),ed(),{id:j.id,...w,createdAt:new Date,updatedAt:new Date}}catch(l){throw console.error("❌ Error adding material to tender:",l),new Error(`فشل في إضافة المادة للمناقصة: ${l.message}`)}}static async updateTenderItemQuantity(e,t){try{console.log("📝 Updating tender item quantity:",{itemId:e,newQuantity:t});const s=await this.getTenderItemById(e);if(!s)throw new Error("البند غير موجود");const a=parseFloat(t)||1,l=a*(s.unitPrice||0),c=ut(De,fa,e);return await Xs(c,{quantity:a,totalPrice:l,updatedAt:vt()}),console.log("✅ Updated tender item quantity"),ed(),{...s,quantity:a,totalPrice:l,updatedAt:new Date}}catch(s){throw console.error("❌ Error updating tender item quantity:",s),new Error("فشل في تحديث كمية البند")}}static async getTenderItemById(e){try{const t=ut(De,fa,e),s=await cs(t);if(s.exists()){const a=s.data();return{id:s.id,internalId:a.internalId||Ct("TENDER_ITEM"),...a,createdAt:a.createdAt?.toDate(),updatedAt:a.updatedAt?.toDate()}}else return null}catch(t){throw console.error("❌ Error fetching tender item by ID:",t),new Error("فشل في جلب بيانات البند")}}static async updateTenderItem(e,t){try{const s=ut(De,fa,e);return await Xs(s,{...t,updatedAt:vt()}),ed(),!0}catch(s){throw console.error("❌ Error updating tender item:",s),new Error("فشل في تحديث البند")}}static async deleteTenderItem(e){try{const t=ut(De,fa,e);return await Js(t),ed(),!0}catch(t){throw console.error("❌ Error deleting tender item:",t),new Error("فشل في حذف البند")}}static async deleteAllTenderItems(e){try{console.log("🗑️ Deleting all items for tender:",e);const t=await this.getTenderItems(e);if(t.length===0)return!0;const s=Jo(De);return t.forEach(a=>{const l=ut(De,fa,a.id);s.delete(l)}),await s.commit(),console.log("✅ Deleted all tender items:",t.length),ed(),!0}catch(t){throw console.error("❌ Error deleting all tender items:",t),new Error("فشل في حذف جميع بنود المناقصة")}}static async refreshTenderItemsPricing(e){try{console.log("🔄 Refreshing prices for tender:",e);let t;if(Array.isArray(e)?(console.log("📦 Input is array of items, using directly"),t=e):(console.log("🔍 Input is tender ID, fetching items from database"),t=await this.getTenderItems(e)),!t||t.length===0)return console.log("📭 No items to refresh pricing for"),[];const s=[],a=Jo(De);let l=0;const c=Array.isArray(e);for(const u of t)try{let m=null;switch(u.materialType){case"rawMaterial":m=await wr.getRawMaterialByInternalId(u.materialInternalId);break;case"localProduct":m=await vr.getLocalProductByInternalId(u.materialInternalId);break;case"foreignProduct":m=await Nr.getForeignProductByInternalId(u.materialInternalId);break}if(m){const p=parseFloat(m.price)||0,b=(u.quantity||1)*p;if(!c&&u.id&&p!==u.unitPrice){console.log("🔄 Updating database item price:",u.materialName);const j=ut(De,fa,u.id);a.update(j,{unitPrice:p,totalPrice:b,supplierInfo:{name:m.supplier||"",id:m.supplierId||""},updatedAt:vt()}),l++}s.push({...u,unitPrice:p,totalPrice:b,supplierInfo:m.supplier||u.supplierInfo||"",materialUnit:m.unit||u.materialUnit||"قطعة"})}else console.warn("⚠️ Material not found for item:",u.materialInternalId),s.push(u)}catch(m){console.error("❌ Error refreshing item:",u.materialName,m),s.push(u)}return l>0&&(await a.commit(),console.log("✅ Batch updated",l,"items")),ed(),s}catch(t){throw console.error("❌ Error refreshing tender items pricing:",t),new Error("فشل في تحديث أسعار البنود")}}static async addMultipleMaterialsToTender(e,t){try{console.log("📝 Bulk adding materials to tender:",{tenderId:e,count:t.length});const s=Jo(De),a=[],l=await this.getTenderItems(e),c=new Set(l.map(u=>`${u.materialInternalId}_${u.materialType}`));for(const u of t){const m=`${u.materialInternalId}_${u.materialType}`;if(c.has(m)){console.log("⚠️ Skipping duplicate material:",u.materialInternalId);continue}let p=null;switch(u.materialType){case"rawMaterial":p=await wr.getRawMaterialByInternalId(u.materialInternalId);break;case"localProduct":p=await vr.getLocalProductByInternalId(u.materialInternalId);break;case"foreignProduct":p=await Nr.getForeignProductByInternalId(u.materialInternalId);break}if(p){const b=parseFloat(u.quantity)||1,w=parseFloat(p.price)||0,j=b*w,D={internalId:Ct("TENDER_ITEM"),tenderId:e,materialInternalId:u.materialInternalId,materialType:u.materialType,materialName:p.name,materialCategory:p.category,materialUnit:p.unit,quantity:b,unitPrice:w,totalPrice:j,supplierInfo:{name:p.supplier||"",id:p.supplierId||""},createdAt:vt(),updatedAt:vt()},O=ut(ct(De,fa));s.set(O,D),a.push({id:O.id,...D,createdAt:new Date,updatedAt:new Date})}}return a.length>0&&(await s.commit(),console.log("✅ Bulk added items:",a.length)),ed(),a}catch(s){throw console.error("❌ Error bulk adding materials:",s),new Error("فشل في إضافة المواد للمناقصة")}}static async materialExistsInTender(e,t,s){try{return(await this.getTenderItems(e)).some(l=>l.materialInternalId===t&&l.materialType===s)}catch(a){return console.error("❌ Error checking material existence:",a),!1}}static async getTenderTotals(e){try{const t=await this.getTenderItems(e),s=t.reduce((c,u)=>c+(u.totalPrice||0),0),a=t.reduce((c,u)=>c+(u.quantity||0),0),l=t.length;return{totalPrice:s,totalQuantity:a,itemsCount:l,items:t}}catch(t){throw console.error("❌ Error calculating tender totals:",t),new Error("فشل في حساب إجماليات المناقصة")}}static async getTenderItemsByType(e,t){try{const s=ct(De,fa),a=Vt(s,jn("tenderId","==",e),jn("materialType","==",t),hs("createdAt","desc"));return(await St(a)).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||Ct("TENDER_ITEM"),...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate()}})}catch(s){return console.error("❌ Error fetching items by type:",s),(await this.getTenderItems(e)).filter(l=>l.materialType===t)}}static async migrateLocalStorageItems(e,t){try{if(console.log("🔄 Migrating localStorage items to Firebase:",t.length),!Array.isArray(t)||t.length===0)return[];const s=[];for(const a of t)try{if(!await this.materialExistsInTender(e,a.materialInternalId,a.materialType||"rawMaterial")){const c=await this.addMaterialToTender(e,a.materialInternalId,a.materialType||"rawMaterial",a.quantity||1);s.push(c)}}catch(l){console.error("⚠️ Failed to migrate item:",a.materialName,l)}return console.log("✅ Migration completed:",s.length,"items migrated"),s}catch(s){throw console.error("❌ Error migrating localStorage items:",s),new Error("فشل في ترحيل البيانات")}}static async searchTenderItems(e,t){try{const s=await this.getTenderItems(e);if(!t.trim())return s;const a=t.toLowerCase();return s.filter(l=>(l.materialName||"").toLowerCase().includes(a)||(l.materialCategory||"").toLowerCase().includes(a)||(l.supplierInfo?.name||"").toLowerCase().includes(a)||(l.materialType||"").toLowerCase().includes(a))}catch(s){throw console.error("❌ Error searching tender items:",s),new Error("فشل في البحث عن البنود")}}static async getMaterialsSummary(e){try{const t=await this.getTenderItems(e),s={rawMaterial:{count:0,totalPrice:0},localProduct:{count:0,totalPrice:0},foreignProduct:{count:0,totalPrice:0}};return t.forEach(a=>{const l=a.materialType||"rawMaterial";s[l]&&(s[l].count++,s[l].totalPrice+=a.totalPrice||0)}),s}catch(t){throw console.error("❌ Error getting materials summary:",t),new Error("فشل في تجميع بيانات المواد")}}static validateTenderItemData(e){const t={};return e.tenderId?.trim()||(t.tenderId="معرف المناقصة مطلوب"),e.materialInternalId?.trim()||(t.materialInternalId="معرف المادة مطلوب"),e.materialType?.trim()||(t.materialType="نوع المادة مطلوب"),(!e.quantity||parseFloat(e.quantity)<=0)&&(t.quantity="الكمية يجب أن تكون أكبر من صفر"),t}static async getTenderStatistics(e){try{const t=await this.getTenderItems(e),s=await this.getMaterialsSummary(e);return{totalItems:t.length,totalValue:t.reduce((l,c)=>l+(c.totalPrice||0),0),totalQuantity:t.reduce((l,c)=>l+(c.quantity||0),0),materialTypes:s,averageItemValue:t.length>0?t.reduce((l,c)=>l+(c.totalPrice||0),0)/t.length:0,highestValueItem:t.reduce((l,c)=>(c.totalPrice||0)>(l.totalPrice||0)?c:l,{}),lowestValueItem:t.reduce((l,c)=>(c.totalPrice||0)<(l.totalPrice||Number.MAX_VALUE)?c:l,{})}}catch(t){throw console.error("❌ Error getting tender statistics:",t),new Error("فشل في جلب إحصائيات المناقصة")}}}class f4{static cache=new Map;static creationPromises=new Map;static async ensureEmployeeDocument(e=null){try{const t=e||Yt.currentUser;if(!t)throw new Error("No authenticated user");const s=t.uid;if(this.cache.has(s)){const l=this.cache.get(s);if(Date.now()-l.timestamp<6e4)return l.employee}if(this.creationPromises.has(s))return await this.creationPromises.get(s);const a=this.createOrGetEmployee(t);this.creationPromises.set(s,a);try{const l=await a;return this.creationPromises.delete(s),l}catch(l){throw this.creationPromises.delete(s),l}}catch(t){throw console.error("❌ Employee document validation failed:",t),new Error(`فشل في التحقق من سجل الموظف: ${t.message}`)}}static async createOrGetEmployee(e){const t=e.uid;console.log("🔍 Checking employee document for user:",t);const s=ut(De,"employees",t),a=await cs(s);if(a.exists()){const l=a.data();return console.log("✅ Employee document found:",{uid:t,name:l.fullName||l.name,status:l.status,email:l.email}),this.cache.set(t,{employee:l,timestamp:Date.now()}),l}return console.log("⚠️ Employee document not found, creating automatically..."),await this.createEmployeeDocument(e)}static async createEmployeeDocument(e){const t=e.uid,s=e.email||"",a=e.displayName||"",l=s.split("@")[0]||"مستخدم",c={fullName:a||l,name:a||l,email:s,status:"active",role:"employee",department:"عام",jobTitle:"موظف",phone:"",nationalId:"",hireDate:new Date().toISOString(),salary:0,createdAt:vt(),updatedAt:vt(),createdBy:"auto-system",autoCreated:!0,uid:t};console.log("🔄 Creating employee document:",c);const u=ut(De,"employees",t);return await sh(u,c),console.log("✅ Employee document created successfully for:",t),this.cache.set(t,{employee:c,timestamp:Date.now()}),this.logAutoCreation(t,s),c}static logAutoCreation(e,t){console.log("🔒 Auto-Creation Event:",{type:"EMPLOYEE_AUTO_CREATED",uid:e,email:t,timestamp:new Date().toISOString(),reason:"Missing employee document for authenticated user"})}static clearCache(e=null){e?this.cache.delete(e):this.cache.clear()}static async validateEmployee(e=null){try{const t=await this.ensureEmployeeDocument(e);return{isValid:t.status==="active"||t.autoCreated,employee:t,autoCreated:t.autoCreated||!1}}catch(t){return console.error("❌ Employee validation failed:",t),{isValid:!1,employee:null,error:t.message}}}}typeof window<"u"&&(window.EmployeeAutoCreator=f4);class p4{async uploadFile(e,t="uploads"){try{if(console.log("🔄 Starting file upload...",{fileName:e.name,fileSize:e.size,folder:t,fileType:e.type}),!Yt.currentUser)throw console.log("❌ No authenticated user found - cannot upload to Storage"),new Error("يجب تسجيل الدخول أولاً لرفع الملفات");const s=Yt.currentUser.uid;if(console.log("✅ Current user:",s),!e)throw new Error("لم يتم تحديد ملف للرفع");const a=10*1024*1024;if(e.size>a)throw new Error("حجم الملف كبير جداً. الحد الأقصى 10 ميجابايت");const l=Date.now(),c=`${t}/${l}_${e.name}`;console.log("📁 Upload path:",c);const u=Qo(ri,c);console.log("📎 Storage reference created for bucket:",ri.app.options.storageBucket),console.log("⬆️ Uploading to Firebase Storage folder:",t);const m=await ex(u,e),p=await Jm(u);return console.log("✅ File upload successful:",p),{url:p,path:c,originalName:e.name,size:e.size,type:e.type,uploadedBy:s,uploadedAt:new Date().toISOString()}}catch(s){throw console.error("❌ File upload error:",s),console.error("❌ Error code:",s.code),console.error("❌ Error message:",s.message),console.error("❌ Full error object:",s),console.error("❌ Auth state during error:",{hasUser:!!Yt.currentUser,uid:Yt.currentUser?.uid,email:Yt.currentUser?.email}),s.code==="storage/unauthorized"?new Error("غير مخول لرفع الملفات. تحقق من صلاحيات Firebase"):s.code==="storage/canceled"?new Error("تم إلغاء رفع الملف"):s.code==="storage/unknown"?new Error("حدث خطأ غير معروف أثناء رفع الملف"):new Error(s.message||"فشل في رفع الملف")}}async uploadFileWithCustomName(e,t="uploads",s){try{if(!e)throw new Error("لم يتم تحديد ملف للرفع");const a=10*1024*1024;if(e.size>a)throw new Error("حجم الملف كبير جداً. الحد الأقصى 10 ميجابايت");const l=Date.now(),c=s?`${t}/${l}_${s}`:`${t}/${l}_${e.name}`,u=Qo(ri,c),m=await ex(u,e);return{url:await Jm(u),path:c,originalName:s||e.name,size:e.size,type:e.type,uploadedAt:new Date().toISOString()}}catch(a){throw console.error("❌ File upload error:",a),console.error("❌ Error code:",a.code),console.error("❌ Error message:",a.message),console.error("❌ Full error object:",a),console.error("❌ Auth state during error:",{hasUser:!!Yt.currentUser,uid:Yt.currentUser?.uid,email:Yt.currentUser?.email}),a.code==="storage/unauthorized"?new Error("غير مخول لرفع الملفات. تحقق من صلاحيات Firebase"):a.code==="storage/canceled"?new Error("تم إلغاء رفع الملف"):a.code==="storage/unknown"?new Error("حدث خطأ غير معروف أثناء رفع الملف"):new Error(a.message||"فشل في رفع الملف")}}async deleteFile(e){try{if(!e)throw new Error("مسار الملف غير محدد");const t=Qo(ri,e);await Vx(t),console.log("File deleted successfully:",e)}catch(t){if(console.error("File deletion error:",t),t.code==="storage/object-not-found"){console.warn("File not found for deletion:",e);return}throw new Error(`فشل في حذف الملف: ${t.message}`)}}async getFileURL(e){try{if(!e)throw new Error("مسار الملف غير محدد");const t=Qo(ri,e);return await Jm(t)}catch(t){throw console.error("Get file URL error:",t),new Error(`فشل في الحصول على رابط الملف: ${t.message}`)}}async saveDocumentsToFirestore(e,t){if(!e||!Array.isArray(t))return;const s=t.map(a=>{const l=ut(ct(De,`tenders/${e}/tenderDocuments`),a.id||Date.now().toString());return sh(l,a)});await Promise.all(s)}async loadDocumentsFromFirestore(e){try{if(!e)return[];const t=ct(De,`tenders/${e}/tenderDocuments`),s=await St(t),a=[];return s.forEach(l=>{a.push({...l.data(),id:l.id})}),console.log(`Loaded ${a.length} documents from Firestore for tender: ${e}`),a}catch(t){return console.error("Error loading documents from Firestore:",t),[]}}validateFile(e,t={}){const{maxSize:s=10*1024*1024,allowedTypes:a=["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}=t;if(!e)throw new Error("لم يتم تحديد ملف");if(e.size>s)throw new Error(`حجم الملف كبير جداً. الحد الأقصى ${Math.round(s/(1024*1024))} ميجابايت`);if(!a.includes(e.type))throw new Error("نوع الملف غير مدعوم. الأنواع المدعومة: PDF, Word, صور");return!0}}const _r=new p4,rv=({show:r,onClose:e,documents:t,setDocuments:s,tenderId:a,uploadingDocument:l,setUploadingDocument:c,handleDocumentUpload:u,handleDeleteClick:m,deleting:p,title:b="وثائق المناقصة"})=>{const{alertConfig:w,closeAlert:j,showSuccess:D,showError:O}=Pn(),{formatDate:Q}=yh();return r?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},tabIndex:"-1",dir:"rtl",children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-file-earmark-text me-2"}),b]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:e,"aria-label":"Close"})]}),n.jsx("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"},children:n.jsxs("div",{className:"mb-4",children:[n.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("div",{className:"bg-primary bg-opacity-10 p-2 rounded-circle me-3",children:n.jsx("i",{className:"bi bi-files text-primary"})}),n.jsxs("div",{children:[n.jsx("h6",{className:"mb-0 fw-bold text-primary",children:"مكتبة الوثائق"}),n.jsxs("small",{className:"text-muted",children:["إجمالي الملفات: ",t.length]})]})]}),n.jsxs("div",{style:{marginTop:"10px",marginBottom:"10px"},children:[n.jsx("input",{type:"file",id:"documentUpload",onChange:u,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",style:{display:"none"}}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{console.log("💼 Upload button clicked");const z=document.getElementById("documentUpload");z?(z.click(),console.log("💼 File input triggered")):console.error("❌ File input not found")},disabled:l,style:{height:"32px",minWidth:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",fontWeight:"500"},children:l?n.jsxs(n.Fragment,{children:[n.jsx(Dn,{size:"small"}),n.jsx("span",{className:"ms-2",children:"رفع..."})]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-cloud-upload me-1"}),"إضافة ملف"]})})]})]}),(console.log("🔄 MODAL RENDER CHECK:",new Date().toLocaleTimeString()),console.log("📊 Documents state:",{length:t.length,docs:t.map(z=>({name:z.fileName,url:!!z.fileURL,id:z.id}))}),null),t.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-folder2-open",style:{fontSize:"3rem"}})}),n.jsx("h5",{className:"text-muted",children:"لا توجد وثائق مرفوعة"}),n.jsx("p",{className:"text-muted",children:'انقر على "إضافة ملف" لرفع الوثائق'})]}):n.jsx("div",{className:"table-responsive",style:{maxHeight:"400px",overflowY:"auto"},children:n.jsxs("table",{className:"table table-hover",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",children:"#"}),n.jsx("th",{className:"text-center",children:"اسم الملف"}),n.jsx("th",{className:"text-center",children:"الحجم"}),n.jsx("th",{className:"text-center",children:"تاريخ الإضافة"}),n.jsx("th",{className:"text-center",children:"الإجراءات"})]})}),n.jsx("tbody",{children:t.map((z,I)=>{if(!z||typeof z!="object")return null;const J=(be=>!be||typeof be!="string"?{icon:"bi-file-earmark",color:"#6c757d"}:be.includes("pdf")?{icon:"bi-file-earmark-pdf",color:"#dc3545"}:be.includes("word")||be.includes("document")?{icon:"bi-file-earmark-word",color:"#2b579a"}:be.includes("image")?{icon:"bi-file-earmark-image",color:"#198754"}:{icon:"bi-file-earmark",color:"#6c757d"})(z.fileType||""),oe=z.fileName||z.originalFileName||"ملف غير محدد",Y=z.fileSize||0;return z.uploadDate,n.jsxs("tr",{children:[n.jsx("td",{className:"text-center fw-bold text-muted",children:I+1}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:`${J.icon} me-2`,style:{color:J.color}}),n.jsx("span",{className:"fw-bold text-primary",title:oe,children:oe.length>25?oe.substring(0,25)+"...":oe})]})}),n.jsx("td",{className:"text-center",children:n.jsxs("span",{className:"badge bg-light text-dark",children:[(Y/1024/1024).toFixed(2)," م.ب"]})}),n.jsx("td",{className:"text-center",children:n.jsx("small",{className:"text-muted",children:Q(z.uploadedAt||z.uploadDate||new Date)})}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("a",{href:z.fileURL||"#",target:"_blank",rel:"noopener noreferrer",className:"btn btn-success",title:"عرض الملف",style:{width:"32px",height:"32px",padding:"0",borderRadius:"6px 0 0 6px",fontSize:"12px"},onClick:be=>{z.fileURL||(be.preventDefault(),O("رابط الملف غير متاح","خطأ"))},children:n.jsx("i",{className:"bi bi-eye"})}),n.jsx("button",{className:"btn btn-outline-danger",onClick:()=>m(z),title:"حذف",disabled:p,style:{width:"32px",height:"32px",padding:"0",borderRadius:"0 6px 6px 0",fontSize:"12px"},children:n.jsx("i",{className:"bi bi-trash"})})]})})]},z.id||`doc-${I}`)})})]})})]})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:n.jsxs("div",{className:"d-flex",style:{gap:"10px"},children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:e,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},children:"إغلاق"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>D("الوثائق تحفظ تلقائياً مع المناقصة","تم الحفظ"),style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},children:"حفظ"})]})})]})})}),n.jsx(Rn,{show:w.show,onClose:j,title:w.title,message:w.message,type:w.type,onConfirm:w.onConfirm,showConfirm:w.showConfirm})]}):null};function g4(){const r=ms(),{id:e}=ea(),{logActivity:t,getCurrentUser:s}=vn(),{alertConfig:a,closeAlert:l,showSuccess:c,showError:u,showConfirm:m}=Pn(),{isTimelineVisible:p}=$n(),b=!!e,[w,j]=N.useState(!1),[D,O]=N.useState({title:"",referenceNumber:"",entity:"",description:"",submissionDeadline:"",estimatedValue:"",location:"",contactPerson:"",contactPhone:"",contactEmail:""}),[Q,z]=N.useState({}),[I,ee]=N.useState(!1),[J,oe]=N.useState(!1),[Y,be]=N.useState(!1),[M,H]=N.useState(""),[k,$]=N.useState(!1),[X,te]=N.useState([]),[F,ce]=N.useState(!1),[Be,U]=N.useState(!1),[se,fe]=N.useState(null),[ie,_]=N.useState(""),[E,R]=N.useState(!1),[V,ne]=N.useState([]),[B,q]=N.useState([]),[me,C]=N.useState(!1),[Z,je]=N.useState(null),[Ge,Ke]=N.useState(null),[ft,Ot]=N.useState(!1),[Ee,it]=N.useState(!1);N.useEffect(()=>{(async()=>{try{if(oe(!0),console.log("🚀 SENIOR REACT: Starting unified data initialization..."),e)console.log("🏷️ EDIT MODE: Skipping pending items check - will load from saved tender");else{console.log("📦 NEW TENDER: Loading pending tender items...");const le=await rt.getPendingTenderItems();if(le&&Array.isArray(le)&&le.length>0){console.log("✅ NEW TENDER: Found",le.length,"pending items - SETTING STATE IMMEDIATELY"),console.log("📋 PENDING ITEMS DATA:",le.map(Te=>({id:Te.internalId||Te.materialInternalId,name:Te.materialName||Te.name||"UNNAMED"}))),ne(le);const Ie=le.map(Te=>Te.internalId||Te.materialInternalId||Te.id).filter(Te=>Te);q(Ie),console.log("✅ Loaded item IDs for new tender mode:",Ie),console.log("🎯 NEW TENDER STATE SET: Items initialized with pending data")}else console.log("📦 NEW TENDER: No pending items found")}if(e){console.log("🎯 EDIT MODE: Starting - IDENTICAL to creation mode logic");const le=await sc.getById(e);if(!le){console.error("❌ EDIT MODE: Tender not found");return}console.log("📄 EDIT MODE: Tender loaded:",le.title);const Ie=await rt.getPendingData(`tenderFormData_${e}`);if(Ie&&Object.keys(Ie).some(Te=>Ie[Te])){console.log("📋 EDIT MODE: Found saved form changes, using them");const Te={...le,...Ie};O(Te)}else{console.log("📋 EDIT MODE: Using original tender data");const Te={...le};if(Te.submissionDeadline){let ye=Te.submissionDeadline;ye&&typeof ye=="object"&&ye.seconds?ye=new Date(ye.seconds*1e3):ye&&typeof ye=="object"&&ye.toDate&&(ye=ye.toDate()),Te.submissionDeadline=ku(ye)}if(Te.deadline){let ye=Te.deadline;ye&&typeof ye=="object"&&ye.seconds?ye=new Date(ye.seconds*1e3):ye&&typeof ye=="object"&&ye.toDate&&(ye=ye.toDate()),Te.submissionDeadline=ku(ye),delete Te.deadline}if(Te.submissionDate){let ye=Te.submissionDate;ye&&typeof ye=="object"&&ye.seconds?ye=new Date(ye.seconds*1e3):ye&&typeof ye=="object"&&ye.toDate&&(ye=ye.toDate()),Te.submissionDeadline=ku(ye),delete Te.submissionDate}const We=await rt.getPendingData(`tenderFormData_${e}`);if(We&&(console.log("📋 EDIT MODE: Found pending form changes, merging with tender data"),Object.assign(Te,We)),O(Te),le.documents&&Array.isArray(le.documents)&&te(le.documents),le.items&&Array.isArray(le.items)){console.log("✅ EDIT MODE: Loading tender items directly without price refresh"),console.log("📦 SAVED ITEMS:",le.items.map(Oe=>({internalId:Oe.internalId||Oe.materialInternalId,materialName:Oe.materialName||Oe.name,supplierInfo:Oe.supplierInfo,unitPrice:Oe.unitPrice,quantity:Oe.quantity,totalPrice:Oe.totalPrice}))),ne(le.items);const ye=le.items.map(Oe=>Oe.internalId||Oe.materialInternalId||Oe.id).filter(Oe=>Oe);q(ye),console.log("✅ Loaded existing item IDs for edit mode:",ye);const ze=le.items.reduce((Oe,nt)=>Oe+(nt.unitPrice||nt.price||0)*(nt.quantity||1),0);O(Oe=>({...Oe,estimatedValue:ze.toString()})),console.log("🎯 EDIT MODE STATE SET: Items loaded directly, count:",le.items.length)}else{const ye=await rt.getPendingTenderItems();if(ye&&ye.length>0){console.log("📦 EDIT MODE FALLBACK: Using pending items directly"),ne(ye);const ze=ye.map(nt=>nt.internalId||nt.materialInternalId||nt.id).filter(nt=>nt);q(ze),console.log("✅ Loaded item IDs for edit mode fallback:",ze),await rt.clearPendingTenderItems();const Oe=ye.reduce((nt,Ze)=>nt+(Ze.unitPrice||Ze.price||0)*(Ze.quantity||1),0);O(nt=>({...nt,estimatedValue:Oe.toString()}))}}}}else{console.log("🆕 NEW TENDER MODE: Checking for saved form data...");const le=await rt.getPendingData("tenderFormData_new");le?(console.log("📋 NEW TENDER: Restoring saved form data from previous session"),O(le)):(console.log("📝 NEW TENDER: Starting with fresh empty form"),O({title:"",referenceNumber:"",entity:"",description:"",submissionDeadline:"",estimatedValue:"",category:"",location:"",contactPerson:"",contactPhone:"",contactEmail:""}));const Ie=await rt.getPendingData("tenderDocuments_new");Ie&&Array.isArray(Ie)?(console.log("📄 NEW TENDER: Restoring saved documents"),te(Ie)):te([]);const Te=await rt.getPendingTenderItems();if(Te&&Te.length>0){console.log("🔄 NEW TENDER: Found pending items, adding to form");const We="tender_success_shown_new",ye=localStorage.getItem(We)==="true",ze=V.length===0&&!Ee&&!ye;ne(Te);const Oe=Te.reduce((nt,Ze)=>nt+(Ze.unitPrice||0)*(Ze.quantity||1),0);if(Oe>0){console.log(`💰 Updating estimated value from items: ${Oe}`);const nt={...le||D,estimatedValue:Oe.toString()};O(nt),await rt.setPendingData("tenderFormData_new",nt)}ze?(it(!0),localStorage.setItem(We,"true"),m(`تم إضافة ${Te.length} عنصر للمناقصة بنجاح.

يمكنك الآن مراجعة البنود ومتابعة ملء بيانات المناقصة.`,()=>{},"تمت إضافة البنود","موافق","",!1)):console.log("🔕 Success message skipped (items already exist or already shown)")}else ne([]);console.log("✅ NEW TENDER: Form initialized with persistence")}console.log("✅ Data initialization completed")}catch(le){console.error("Error initializing data:",le),u("فشل في تحميل البيانات","خطأ")}finally{oe(!1)}})()},[e]),N.useEffect(()=>()=>{console.log("🔒 COMPONENT UNMOUNT: Keeping pending items for next navigation")},[]);const Nt=N.useRef(!1),hn=N.useRef(Date.now()),xn=async()=>{if(Nt.current){console.log("🚫 loadPendingItems already running, skipping...");return}try{Nt.current=!0,console.log("🔍 Loading pending tender items from Firestore...");const ue=await rt.getPendingTenderItems();if(ue){const le=Array.isArray(ue)?ue:JSON.parse(ue);console.log("📦 Found pending tender items:",le.length,"items"),console.log("📋 STORAGE CONTENT:",le.map(Ie=>({id:Ie.internalId||Ie.materialInternalId,name:Ie.materialName||Ie.name}))),ne(Ie=>{console.log("✅ PROCESSING NEW ITEMS WITH ID-BASED DUPLICATE PREVENTION");const Te=le.filter(ze=>{const Oe=ze.internalId||ze.materialInternalId||ze.id,nt=Oe&&B.includes(Oe);return nt&&console.log("⚠️ DUPLICATE DETECTED (ID-based):",{itemName:ze.materialName||ze.name,itemId:Oe,action:"FILTERED_OUT"}),!nt});if(console.log("✅ DUPLICATE PREVENTION RESULTS:",{totalNewItems:le.length,duplicatesFiltered:le.length-Te.length,itemsToAdd:Te.length,existingItems:Ie.length}),Te.length===0)return console.log("📝 No new items to add after duplicate filtering"),Ie;const We=[...Ie,...Te];if(Te.length>0){const ze=Te.map(Oe=>Oe.internalId||Oe.materialInternalId||Oe.id).filter(Oe=>Oe);q(Oe=>{const nt=[...Oe,...ze];return console.log("✅ Updated selectedItemIds:",nt),nt})}const ye=We.reduce((ze,Oe)=>ze+(Oe.unitPrice||0)*(Oe.quantity||1),0);return ye>0&&O(ze=>({...ze,estimatedValue:ye.toString()})),console.log("🛡️ SENIOR REACT STORAGE REPLACEMENT COMPLETED:",{prevItemsCount:Ie.length,storageItemsCount:le.length,finalCount:We.length,replacementSuccess:"COMPLETE_REPLACEMENT_FROM_STORAGE"}),We}),setTimeout(()=>{ne(Ie=>(console.log("🔄 FORCE RE-RENDER: Ensuring UI reflects current items count:",Ie.length),[...Ie]))},100),console.log("✅ Items loaded and ready - keeping in storage until tender is saved")}else{console.log("📦 No pending tender items found in Firestore");const le=await rt.getPendingData(`tenderItems_${e||"new"}`);if(le&&V.length===0)try{Array.isArray(le)&&le.length>0&&(console.log("📦 Loading existing tender items from Firestore:",le.length),ne(le))}catch(Ie){console.error("Error loading Firestore items:",Ie)}}}catch(ue){console.error("Error loading pending items:",ue)}finally{setTimeout(()=>{Nt.current=!1,console.log("🔓 Released loadPendingItems lock after 3-second cooldown")},3e3)}};N.useEffect(()=>{const ue=()=>{console.log("🔍 Custom event received - reloading items..."),xn()};return window.addEventListener("tenderItemsAdded",ue),()=>{window.removeEventListener("tenderItemsAdded",ue)}},[]),N.useEffect(()=>{const le=setTimeout(async()=>{const Ie=Date.now()-hn.current,Te=Ie<5e3;if(console.log("🤖 AUTO-SAVE TRIGGERED:",{itemsCount:V.length,isLoadingLocked:Nt.current,timeSinceMount:Ie,isRecentMount:Te,willSave:V.length>0&&!Nt.current&&!Te}),V.length>0&&!Nt.current&&!Te)try{await rt.setPendingTenderItems(V),console.log("✅ SMART AUTO-SAVE: Saved tender items to Firestore:",V.length,"items"),console.log("📋 AUTO-SAVE CONTENT:",V.map(We=>({id:We.internalId||We.materialInternalId,name:We.materialName||We.name})))}catch(We){console.error("Error saving tender items:",We)}else Nt.current?console.log("🚫 SMART AUTO-SAVE: Skipping save during item loading to prevent race condition"):Te?console.log("🚫 SMART AUTO-SAVE: Skipping save - component recently mounted, allowing time for item loading"):V.length===0&&console.log("🚫 SMART AUTO-SAVE: Skipping save for empty items array")},2e3);return()=>clearTimeout(le)},[V]),N.useEffect(()=>{const le=setTimeout(async()=>{if(X.length>0)try{await rt.setPendingData(`tenderDocuments_${e||"new"}`,X),console.log("Saved tender documents to Firestore:",X.length,"documents")}catch(Ie){console.error("Error saving tender documents:",Ie)}},1e3);return()=>clearTimeout(le)},[X,e]),N.useEffect(()=>{const ue=e||"new",le=Te=>{const We=`tenderDocuments_${ue}`;if(console.log("💾 Storage event detected:",{key:Te.key,expectedKey:We,isMatch:Te.key===We}),Te.key===We&&Te.newValue)try{const ye=JSON.parse(Te.newValue);console.log("📄 Restoring documents from storage event:",ye.length),te(ye);const ze=ye.filter(Oe=>Oe.restoredFrom==="trash").sort((Oe,nt)=>new Date(nt.restoredAt||0)-new Date(Oe.restoredAt||0))[0];if(ze){const Oe=s();t("file",`${Oe.name} استعاد وثيقة من المهملات`,`تم استعادة: ${ze.fileName}`)}}catch(ye){console.error("Error parsing restored documents:",ye)}},Ie=Te=>{const{tenderId:We,restoredDocument:ye,allDocuments:ze}=Te.detail;if(console.log("🎯 Custom restore event detected:",{eventTenderId:We,currentTenderId:ue,isMatch:We===ue,documentName:ye?.fileName}),We===ue){console.log("📄 Updating documents from custom event:",ze.length),te([...ze]);const Oe=s();t("file",`${Oe.name} استعاد وثيقة من المهملات`,`تم استعادة: ${ye.fileName}`)}};return window.addEventListener("storage",le),window.addEventListener("tenderDocumentRestored",Ie),()=>{window.removeEventListener("storage",le),window.removeEventListener("tenderDocumentRestored",Ie)}},[e,c,s,t]);const is=N.useCallback(()=>{if(!V||V.length===0)return 0;const ue=V.reduce((le,Ie)=>le+(Ie.totalPrice||0),0);return console.log("📊 INSTANT: Reflecting pre-calculated total from items:",ue),ue},[V]);N.useCallback(()=>{const ue=V.reduce((le,Ie)=>le+(Ie.totalPrice||0),0);return O(le=>({...le,estimatedValue:ue.toString()})),console.log("💰 CONTROLLED: Updated estimated value explicitly:",ue),ue},[V]),N.useEffect(()=>{const le=setTimeout(async()=>{if(Object.keys(D).some(Ie=>D[Ie]))try{await rt.setPendingData(`tenderFormData_${e||"new"}`,D),console.log("💾 Saved tender form data for navigation persistence:",D.title||"New Tender")}catch(Ie){console.error("Error saving form data:",Ie)}},1e3);return()=>clearTimeout(le)},[D,e]);const Un=()=>{j(!w)},Xt=async ue=>{const{name:le,value:Ie,type:Te,checked:We}=ue.target,ye={...D,[le]:Te==="checkbox"?We:Ie};O(ye);try{const ze=e?`tenderFormData_${e}`:"tenderFormData_new";await rt.setPendingData(ze,ye),console.log(`💾 Form data saved for field: ${le}`)}catch(ze){console.error("Error saving form data:",ze)}Q[le]&&z(ze=>({...ze,[le]:""}))},yn=async ue=>{ue.preventDefault();const le=tf.validateTenderData({...D,submissionDeadline:D.submissionDeadline?new Date(D.submissionDeadline):null});if(Object.keys(le).length>0){z(le);return}ee(!0),z({});try{const Ie=await oo.validateUniqueFields({referenceNumber:D.referenceNumber},b?e:null,"tenders");if(Object.keys(Ie).length>0){z(Ie),ee(!1);return}const Te=V.reduce((ze,Oe)=>ze+(Oe.totalPrice||0),0),We={...D,submissionDeadline:D.submissionDeadline?new Date(D.submissionDeadline):null,estimatedValue:Te,documents:X,items:V||[]};console.log("💾 Saving complete tender data to Firebase with calculated total:",{title:We.title,estimatedValue:Te,documentsCount:(We.documents||[]).length,itemsCount:(We.items||[]).length});let ye;if(b){ye=await sc.updateTender(e,We);const ze=s();await t("task",`${ze.name} عدل مناقصة`,`تم تعديل المناقصة: ${We.title}`),await rt.clearPendingData(`tenderFormData_${e}`),await rt.clearPendingData(`tenderDocuments_${e}`),await rt.clearPendingTenderItems(),c("تم تحديث المناقصة بنجاح","تم التحديث")}else{ye=await sc.createTender(We);const ze=s();await t("task",`${ze.name} أضاف مناقصة`,`تم إضافة المناقصة: ${We.title}`),await rt.clearPendingData("tenderFormData_new"),await rt.clearPendingData("tenderDocuments_new"),await rt.clearPendingTenderItems(),localStorage.removeItem("tender_success_shown_new"),c("تم إضافة المناقصة بنجاح","تمت الإضافة")}setTimeout(()=>{r("/tenders/list")},1500)}catch(Ie){z({submit:Ie.message}),u("فشل في حفظ المناقصة","خطأ في الحفظ")}finally{ee(!1)}},Zn=async()=>{try{b||(console.log("🧹 CANCEL: Clearing all pending data for cancelled new tender"),await rt.clearPendingData("tenderFormData_new"),await rt.clearPendingData("tenderDocuments_new"),await rt.clearPendingTenderItems(),localStorage.removeItem("tender_success_shown_new"),console.log("✅ CANCEL: All pending data cleared successfully"))}catch(ue){console.error("Error clearing pending data on cancel:",ue)}r("/tenders/list")},es=()=>{be(!0)},an=()=>{be(!1),H("")},Bt=ue=>{try{switch(console.log("Selected item type:",ue),ue){case"raw-materials":const le=`/tenders/raw-materials/${e||"new"}`;console.log("Navigating to:",le),r(le);break;case"local-product":const Ie=`/tenders/local-products/${e||"new"}`;console.log("Navigating to local products:",Ie),r(Ie);break;case"imported-product":const Te=`/tenders/foreign-products/${e||"new"}`;console.log("Navigating to foreign products:",Te),r(Te);break;case"manufactured-product":const We=`/tenders/manufactured-products/${e||"new"}`;console.log("Navigating to manufactured products:",We),r(We);break;default:console.log("Unknown item type:",ue),u("نوع البند غير معروف","خطأ")}}catch(le){console.error("Error handling item type selection:",le),u("فشل في اختيار نوع البند","خطأ")}},Nn=ue=>{console.log("🗑️ REMOVE ITEM: Deleting item at index",ue),ne(le=>{console.log("🗑️ BEFORE DELETE: Items count:",le.length);const Ie=le[ue];console.log("🗑️ DELETING ITEM:",Ie?.materialName||"UNNAMED");const Te=Ie?.internalId||Ie?.materialInternalId||Ie?.id;Te&&q(ye=>{const ze=ye.filter(Oe=>Oe!==Te);return console.log("✅ Removed item ID from selectedItemIds:",Te),console.log("✅ Updated selectedItemIds:",ze),ze});const We=le.filter((ye,ze)=>ze!==ue);return console.log("🗑️ AFTER DELETE: Items count:",We.length),We})},T=(ue,le)=>{je({...ue}),Ke(le),C(!0)},re=(ue,le)=>{const Ie=Math.max(.1,parseFloat(le)||.1),Te=parseFloat(Ie.toFixed(1));je(We=>({...We,quantity:Te,totalPrice:(We.unitPrice||0)*Te}))},he=()=>{Ge!==null&&Z&&(ne(ue=>ue.map((le,Ie)=>Ie===Ge?Z:le)),C(!1),je(null),Ke(null),c("تم تحديث بيانات البند بنجاح","تم التحديث"))},de=()=>{C(!1),je(null),Ke(null)},xe=()=>Math.round(Z?.totalPrice||0),Ue=async ue=>{const le=ue.target.files[0];if(le){ce(!0);try{try{_r.validateFile(le,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]})}catch(Te){throw new Error(Te.message)}console.log("📤 Uploading document:",le.name);const Ie=await _r.uploadFile(le,"tender-documents");fe({...Ie,originalFileName:le.name,fileSize:le.size,fileType:le.type}),_(le.name.split(".")[0]),U(!0),ue.target.value=""}catch(Ie){console.error("Error uploading document:",Ie),u(Ie.message||"فشل في رفع الملف","خطأ في الرفع"),ue.target&&(ue.target.value="")}finally{ce(!1)}}},bt=async()=>{if(!ie.trim()){u("يرجى إدخال اسم الملف","اسم الملف مطلوب");return}if(!se){u("بيانات الملف غير متاحة","خطأ");return}try{ce(!0),console.log("📤 Creating document with Firebase database storage:",ie);const ue={id:Date.now().toString(),fileName:ie.trim(),originalFileName:se.originalFileName,fileURL:se.url,storagePath:se.path,fileSize:se.fileSize,fileType:se.fileType,uploadedAt:new Date().toISOString(),uploadDate:new Date().toISOString(),tenderId:e||"new",tenderTitle:D.title||"مناقصة جديدة",tenderReferenceNumber:D.referenceNumber||"غير محدد"};if(te(Ie=>[...Ie,ue]),e&&e!=="new")try{console.log("💾 Saving document to Firebase database for existing tender:",e);const Ie=await tf.getTenderById(e);if(Ie){const Te=[...Ie.documents||[],ue];await tf.updateTender(e,{...Ie,documents:Te}),console.log("✅ Document saved to Firebase database successfully")}}catch(Ie){console.warn("⚠️ Firebase database save failed, document stored locally only:",Ie.message)}else console.log("📋 Document stored locally for new tender, will be saved to Firebase when tender is created");c(`تم رفع الملف بنجاح: ${ie}`,"تم الرفع");const le=s();t("file",`${le.name} رفع وثيقة`,`تم رفع الملف: ${ie}`),U(!1),fe(null),_("")}catch(ue){console.error("Error saving document:",ue),u(`فشل في رفع الملف: ${ue.message}`,"خطأ في الرفع")}finally{ce(!1)}},pt=()=>{console.log("User cancelled file upload"),U(!1),fe(null),_("")},Vs=ue=>{m(`هل أنت متأكد من حذف هذا الملف؟

${ue.fileName}`,()=>Ne(ue),"تأكيد حذف الملف")},Ne=async ue=>{try{R(!0),await Gn.moveToTrash(ue,"tender_documents"),te(Ie=>Ie.filter(Te=>Te.id!==ue.id));const le=s();t("task",`${le.name} حذف وثيقة`,`تم حذف الوثيقة: ${ue.fileName}`),c(`تم نقل الملف للمهملات: ${ue.fileName}`,"تم النقل للمهملات")}catch(le){u(`فشل في نقل الملف للمهملات: ${le.message}`,"خطأ في النقل")}finally{R(!1)}};return n.jsx(n.Fragment,{children:n.jsxs("div",{className:`page-wrapper ${w?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Kn,{onToggle:Un}),n.jsxs("div",{className:"main-container",style:{paddingRight:w?"72px":"250px",paddingLeft:w||!p?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:w?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:w})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item",children:n.jsx("a",{href:"/tenders/list",className:"text-decoration-none text-primary",children:"المناقصات"})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:b?"تعديل مناقصة":"إضافة مناقصة جديدة"})]})}),n.jsx(Yn,{}),n.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:n.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[n.jsx("div",{className:"d-flex align-items-center",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:`bi ${b?"bi-pencil-square":"bi-plus-circle-fill"} text-primary me-2`}),b?"تعديل المناقصة":"إضافة مناقصة جديدة"]})}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-primary",onClick:es,style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:"إضافة بند"}),n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>$(!0),style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:"وثائق المناقصة"})]})]})}),n.jsx("div",{className:"card-body",children:J?n.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:n.jsx(Dn,{size:"large"})}):n.jsxs("form",{onSubmit:yn,children:[Q.submit&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),Q.submit]}),n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-8 mb-3",children:[n.jsx("label",{className:"form-label",children:"عنوان المناقصة *"}),n.jsx("input",{type:"text",className:`form-control ${Q.title?"is-invalid":""}`,name:"title",value:D.title,onChange:Xt,placeholder:"أدخل عنوان المناقصة",disabled:I}),Q.title&&n.jsx("div",{className:"invalid-feedback",children:Q.title})]}),n.jsxs("div",{className:"col-md-4 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم المرجع *"}),n.jsx("input",{type:"text",className:`form-control ${Q.referenceNumber?"is-invalid":""}`,name:"referenceNumber",value:D.referenceNumber,onChange:Xt,placeholder:"رقم المرجع",disabled:I}),Q.referenceNumber&&n.jsx("div",{className:"invalid-feedback",children:Q.referenceNumber})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"جهة المناقصة *"}),n.jsx("input",{type:"text",className:`form-control ${Q.entity?"is-invalid":""}`,name:"entity",value:D.entity,onChange:Xt,placeholder:"اسم جهة المناقصة",disabled:I}),Q.entity&&n.jsx("div",{className:"invalid-feedback",children:Q.entity})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"موعد انتهاء التقديم *"}),n.jsx("input",{type:"date",className:`form-control ${Q.submissionDeadline?"is-invalid":""}`,name:"submissionDeadline",value:D.submissionDeadline,onChange:Xt,disabled:I,required:!0}),Q.submissionDeadline&&n.jsx("div",{className:"invalid-feedback",children:Q.submissionDeadline})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsxs("label",{className:"form-label",children:["التكلفة التقديرية",n.jsx("small",{className:"text-muted ms-2",children:"(محسوبة تلقائياً من البنود)"})]}),n.jsxs("div",{className:"input-group",children:[n.jsx("input",{type:"text",className:"form-control bg-light",name:"estimatedValue",value:(()=>{const ue=parseFloat(D.estimatedValue)||0;return ue>0?`${ue.toLocaleString("en-US")} ريال`:"0 ريال"})(),readOnly:!0,placeholder:"سيتم حسابها من البنود المضافة",style:{backgroundColor:"#f8f9fa",fontWeight:"bold",color:"#198754"}}),n.jsx("span",{className:"input-group-text bg-light text-success",children:n.jsx("i",{className:"bi bi-calculator"})})]})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"المدينة"}),n.jsx("input",{type:"text",className:"form-control",name:"location",value:D.location,onChange:Xt,placeholder:"مدينة تنفيذ المناقصة",disabled:I})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"الشخص المسؤول"}),n.jsx("input",{type:"text",className:"form-control",name:"contactPerson",value:D.contactPerson,onChange:Xt,placeholder:"اسم الشخص المسؤول",disabled:I})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الهاتف"}),n.jsx("input",{type:"tel",className:"form-control",name:"contactPhone",value:D.contactPhone,onChange:Xt,placeholder:"رقم الهاتف",disabled:I})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"البريد الإلكتروني"}),n.jsx("input",{type:"email",className:"form-control",name:"contactEmail",value:D.contactEmail,onChange:Xt,placeholder:"البريد الإلكتروني",disabled:I})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"وصف المناقصة"}),n.jsx("textarea",{className:"form-control",name:"description",value:D.description,onChange:Xt,rows:"4",placeholder:"وصف تفصيلي للمناقصة ومتطلباتها...",disabled:I})]}),console.log("🔍 RENDER DEBUG - SENIOR REACT:",{itemsCount:V.length,itemsArray:V,itemsType:typeof V,isArray:Array.isArray(V),shouldShowList:V.length>0,allItemsData:V.map((ue,le)=>({index:le,internalId:ue.internalId||ue.materialInternalId,materialName:ue.materialName||ue.name,hasRequiredFields:!!(ue.materialName||ue.name),quantity:ue.quantity,unitPrice:ue.unitPrice||ue.price}))}),n.jsx("div",{className:"col-md-12 mb-4",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-light",children:n.jsx("div",{className:"d-flex justify-content-between align-items-center",children:n.jsxs("h6",{className:"mb-0 fw-bold text-primary",children:[n.jsx("i",{className:"bi bi-list-task me-2"}),"بنود المناقصة (",V.length,")",V.length===0&&n.jsx("span",{className:"text-danger",children:"- لا توجد بنود"})]})})}),n.jsx("div",{className:"card-body p-0",children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"اسم المادة"}),n.jsx("th",{className:"text-center",children:"الكمية"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر الإجمالي"}),n.jsx("th",{className:"text-center",style:{width:"60px"},children:"إجراء"})]})}),n.jsx("tbody",{children:V&&V.length>0?V.map((ue,le)=>{let Ie=ue.materialName||ue.name||"مادة غير محددة";Ie&&Ie.toString().startsWith("rm_")&&(Ie="مادة غير محددة");const Te=ue.materialUnit||ue.unit||"قطعة",We=ue.totalPrice||0,ye=ue.internalId;return n.jsxs("tr",{style:{backgroundColor:le%2===0?"#ffffff":"#f8f9fa"},children:[n.jsx("td",{className:"text-center fw-bold text-muted",children:le+1}),n.jsx("td",{className:"text-center fw-medium",children:n.jsx("div",{children:n.jsx("button",{className:"btn btn-link p-0 fw-medium text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:async ze=>{ze.preventDefault(),ze.stopPropagation();try{console.log("=== DETAILED DEBUGGING ==="),console.log("Full item object:",JSON.stringify(ue,null,2)),console.log("All item keys:",Object.keys(ue));const Oe=ue.materialInternalId,nt=ue.materialType||"rawMaterial";console.log("Searching for:"),console.log("- materialInternalId:",Oe),console.log("- materialType:",nt);let Ze=null,Je=[];if(nt==="rawMaterial"){console.log("Loading raw materials...");const{RawMaterialService:Ve}=await ar(async()=>{const{RawMaterialService:et}=await Promise.resolve().then(()=>lx);return{RawMaterialService:et}},void 0);Je=await Ve.getAllRawMaterials(),console.log("Total raw materials loaded:",Je.length),console.log("Sample raw material IDs:",Je.slice(0,3).map(et=>({id:et.id,internalId:et.internalId,name:et.name})));let ke=Je.find(et=>et.internalId===Oe);if(ke||(ke=Je.find(et=>et.id===Oe)),!ke){const et=ue.materialName||ue.name;ke=Je.find(bn=>bn.name===et)}console.log("Found raw material:",ke?"YES":"NO"),ke&&(console.log("Material details:",{id:ke.id,internalId:ke.internalId,name:ke.name}),Ze=ke.id,r(`/raw-materials/edit/${Ze}`))}else if(nt==="localProduct"){console.log("Loading local products...");const{LocalProductService:Ve}=await ar(async()=>{const{LocalProductService:et}=await Promise.resolve().then(()=>cx);return{LocalProductService:et}},void 0);Je=await Ve.getAllLocalProducts(),console.log("Total local products loaded:",Je.length),console.log("Sample local product IDs:",Je.slice(0,3).map(et=>({id:et.id,internalId:et.internalId,name:et.name})));let ke=Je.find(et=>et.internalId===Oe);if(ke||(ke=Je.find(et=>et.id===Oe)),!ke){const et=ue.materialName||ue.name;ke=Je.find(bn=>bn.name===et)}console.log("Found local product:",ke?"YES":"NO"),ke&&(console.log("Product details:",{id:ke.id,internalId:ke.internalId,name:ke.name}),Ze=ke.id,r(`/local-products/edit/${Ze}`))}else if(nt==="foreignProduct"){console.log("Loading foreign products...");const{ForeignProductService:Ve}=await ar(async()=>{const{ForeignProductService:et}=await Promise.resolve().then(()=>dx);return{ForeignProductService:et}},void 0);Je=await Ve.getAllForeignProducts(),console.log("Total foreign products loaded:",Je.length),console.log("Sample foreign product IDs:",Je.slice(0,3).map(et=>({id:et.id,internalId:et.internalId,name:et.name})));let ke=Je.find(et=>et.internalId===Oe);if(ke||(ke=Je.find(et=>et.id===Oe)),!ke){const et=ue.materialName||ue.name;ke=Je.find(bn=>bn.name===et)}console.log("Found foreign product:",ke?"YES":"NO"),ke&&(console.log("Product details:",{id:ke.id,internalId:ke.internalId,name:ke.name}),Ze=ke.id,r(`/foreign-products/edit/${Ze}`))}else if(nt==="manufacturedProduct"){console.log("Loading manufactured products...");const{ManufacturedProductService:Ve}=await ar(async()=>{const{ManufacturedProductService:et}=await Promise.resolve().then(()=>dC);return{ManufacturedProductService:et}},void 0);Je=await Ve.getAllManufacturedProducts(),console.log("Total manufactured products loaded:",Je.length),console.log("Sample manufactured product IDs:",Je.slice(0,3).map(et=>({id:et.id,internalId:et.internalId,title:et.title})));let ke=Je.find(et=>et.internalId===Oe);ke||(ke=Je.find(et=>et.id===Oe)),ke||(ke=Je.find(et=>et.title===ue.materialName)),console.log("Found manufactured product:",ke?"YES":"NO"),ke&&(console.log("Product details:",{id:ke.id,internalId:ke.internalId,title:ke.title}),Ze=ke.id,r(`/manufactured-products/edit/${Ze}`))}Ze||(console.error("=== SEARCH FAILED ==="),console.error("Could not find Firebase ID for:",Oe),console.error("Available items in this category:",Je.map(Ve=>({id:Ve.id,internalId:Ve.internalId,name:Ve.name}))),alert(`لا يمكن العثور على هذه المادة
ID: ${Oe}
Type: ${nt}`))}catch(Oe){console.error("=== NAVIGATION ERROR ===",Oe),alert("حدث خطأ أثناء محاولة فتح المادة")}},title:`تحرير: ${Ie}`,children:Ie})})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"badge bg-primary",children:ue.quantity||1})}),n.jsx("td",{className:"text-center",children:Te}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{children:[n.jsxs("span",{className:"text-success fw-bold",children:[We.toLocaleString("en-US")," ر.س"]}),ue.unitPrice&&n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:[ue.unitPrice.toLocaleString("en-US")," × ",ue.quantity]})})]})}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"btn-group btn-group-sm",style:{marginLeft:"20px"},children:[n.jsx("button",{className:"btn btn-outline-primary",type:"button",onClick:ze=>{ze.preventDefault(),ze.stopPropagation(),T(ue,le)},title:"تعديل الكمية",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{className:"btn btn-outline-danger",onClick:()=>Nn(le),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},ye||`item-${le}`)}):n.jsx("tr",{children:n.jsx("td",{colSpan:"6",className:"text-center py-4 text-muted",children:"لا توجد بنود في المناقصة"})})}),n.jsx("tfoot",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{colSpan:"4",className:"text-end",children:"إجمالي القيمة:"}),n.jsxs("th",{className:"text-center text-primary fw-bold",children:[is().toLocaleString("en-US")," ر.س"]}),n.jsx("th",{})]})})]})})})]})})]}),n.jsx("div",{className:"row",children:n.jsxs("div",{className:"col-12 d-flex justify-content-center gap-3 mt-4",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",style:{height:"32px",minWidth:"80px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},onClick:Zn,disabled:I,children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary",style:{height:"32px",minWidth:"80px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},disabled:I,children:I?n.jsxs(n.Fragment,{children:[n.jsx(Dn,{size:"small"}),n.jsx("span",{className:"ms-2",children:b?"تحديث...":"حفظ..."})]}):b?"تحديث":"حفظ"})]})})]})})]})})}),!w&&p&&n.jsx(Xn,{rtl:!0}),!w&&p&&n.jsx(Jn,{})]})]}),me&&Z&&n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-calculator me-2"}),"تحديد الكميات والأسعار"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:de,"aria-label":"Close"})]}),n.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"30%"},children:"البند"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"السعر الأساسي"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"المورد"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"إجمالي السعر"})]})}),n.jsx("tbody",{children:n.jsxs("tr",{style:{height:"60px"},children:[n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:"bi bi-layers text-danger me-2"}),n.jsxs("div",{children:[n.jsx("div",{className:"fw-bold text-primary",children:Z.materialName||Z.name}),n.jsx("small",{className:"text-muted",children:Z.materialCategory||Z.category})]})]})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("span",{className:"fw-bold text-success",children:[Math.round(Z.unitPrice)," ريال"]}),n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:["/",Z.materialUnit||Z.unit||"وحدة"]})})]}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:ue=>{ue.preventDefault(),ue.stopPropagation(),re(Z.internalId,Z.quantity-.1)},disabled:Z.quantity<=.1,style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-dash"})}),n.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:Z.quantity.toFixed(1),min:"0.1",step:"0.1",onChange:ue=>{ue.preventDefault(),ue.stopPropagation(),re(Z.internalId,ue.target.value)}}),n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:ue=>{ue.preventDefault(),ue.stopPropagation(),re(Z.internalId,Z.quantity+.1)},style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-plus"})})]})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"text-muted",children:Z.displaySupplier||Z.supplierInfo||"-"})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(Z.totalPrice)," ريال"]}),n.jsxs("small",{className:"text-success",children:["(",Z.quantity.toFixed(1)," × ",Math.round(Z.unitPrice),")"]})]})]},Z.internalId)})]})})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:n.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("span",{className:"text-muted me-3",children:"إجمالي البند:"}),n.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[xe()," ريال"]}),n.jsxs("span",{className:"badge bg-info ms-2",children:[Z.quantity.toFixed(1)," قطعة"]})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:de,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:ue=>{ue.preventDefault(),ue.stopPropagation(),he()},style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"تأكيد"})]})]})})]})})}),n.jsx(Rn,{show:a.show,onClose:l,title:a.title,message:a.message,type:a.type,onConfirm:a.onConfirm,confirmText:a.confirmText,cancelText:a.cancelText,showCancel:a.showCancel}),n.jsx(sC,{show:Y,onClose:an,onItemSelect:Bt,selectedItemType:M,setSelectedItemType:H}),n.jsx(rv,{show:k,onClose:()=>$(!1),documents:X,setDocuments:te,tenderId:e||"new",uploadingDocument:F,setUploadingDocument:ce,handleDocumentUpload:Ue,handleDeleteClick:Vs,deleting:E}),Be&&n.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.7)",zIndex:1060},tabIndex:"-1",dir:"rtl",children:n.jsx("div",{className:"modal-dialog modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsx("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"12px 12px 0 0"},children:n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-pencil-square me-2"}),"تسمية الملف"]})}),n.jsx("div",{className:"modal-body",style:{padding:"25px"},children:n.jsxs("div",{className:"mb-4",children:[n.jsxs("div",{className:"d-flex align-items-center mb-3",children:[n.jsx("div",{className:"bg-success bg-opacity-10 p-2 rounded-circle me-3",children:n.jsx("i",{className:"bi bi-file-earmark-check text-success"})}),n.jsxs("div",{children:[n.jsx("h6",{className:"mb-0 fw-bold text-success",children:"تم رفع الملف بنجاح"}),n.jsx("small",{className:"text-muted",children:se?.originalFileName})]})]}),n.jsxs("div",{className:"mb-3",children:[n.jsxs("label",{className:"form-label fw-bold text-primary",children:[n.jsx("i",{className:"bi bi-tag me-1"}),"اسم الملف المخصص *"]}),n.jsx("input",{type:"text",className:"form-control",value:ie,onChange:ue=>_(ue.target.value),placeholder:"أدخل اسم الملف المخصص",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:ue=>{ue.target.style.borderColor="#28a745",ue.target.style.boxShadow="0 0 0 0.2rem rgba(40, 167, 69, 0.25)"},onBlur:ue=>{ue.target.style.borderColor="#e9ecef",ue.target.style.boxShadow="none"},autoFocus:!0}),n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),"سيتم استخدام هذا الاسم لعرض الملف في قائمة الوثائق"]})]})]})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:n.jsxs("div",{className:"d-flex justify-content-end",style:{gap:"12px"},children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:pt,style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500"},children:"إلغاء"}),n.jsxs("button",{type:"button",className:"btn btn-success",onClick:bt,disabled:!ie.trim(),style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500",opacity:ie.trim()?1:.6},children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),"حفظ"]})]})})]})})})]})})}function UE(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(g4,{})})})}const x4=()=>{const[r,e]=N.useState({isDragging:!1,draggedItem:null,draggedFrom:null,dragOverTarget:null}),t=N.useRef(null);N.useRef(null);const s=N.useCallback(()=>{e({isDragging:!1,draggedItem:null,draggedFrom:null,dragOverTarget:null})},[]),a=N.useCallback((p,b,w)=>{try{console.log("🚀 [DRAG START] Item:",b?.title||b?.id,"Source:",w),p.dataTransfer.effectAllowed="move",p.dataTransfer.setData("text/plain",JSON.stringify({item:b,source:w})),e({isDragging:!0,draggedItem:b,draggedFrom:w,dragOverTarget:null}),t.current=p.currentTarget}catch(j){console.error("❌ [DRAG START ERROR]:",j),s()}},[s]),l=N.useCallback(p=>{console.log("🏁 [DRAG END]"),t.current=null,s()},[s]),c=N.useCallback((p,b)=>{p.preventDefault(),p.dataTransfer.dropEffect="move",e(w=>({...w,dragOverTarget:b}))},[]),u=N.useCallback(p=>{const b=p.relatedTarget;p.currentTarget.contains(b)||e(j=>({...j,dragOverTarget:null}))},[]),m=N.useCallback((p,b,w)=>{p.preventDefault(),console.log("💧 [DROP] Target:",b);try{const j=p.dataTransfer.getData("text/plain");let D=null;try{D=JSON.parse(j)}catch{D={item:r.draggedItem,source:r.draggedFrom}}if(!D||!D.item){console.error("❌ [DROP ERROR] No drag data available");return}const{item:O,source:Q}=D;if(Q===b){console.log("⚠️ [DROP CANCELLED] Same source and target");return}console.log("✅ [DROP SUCCESS] Moving:",O?.title||O?.id,"from",Q,"to",b),typeof w=="function"&&w(O,Q,b)}catch(j){console.error("❌ [DROP ERROR]:",j)}finally{e(j=>({...j,dragOverTarget:null}))}},[r]);return{dragState:r,handleDragStart:a,handleDragEnd:l,handleDragOver:c,handleDragLeave:u,handleDrop:m,resetDragState:s}},Xi={PENDING:"pending",IN_PROGRESS:"inProgress",REVIEW:"review",COMPLETED:"completed"},aC={[Xi.PENDING]:{title:"قيد الانتظار",icon:"bi-hourglass-split",bgColor:"linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%)",progress:0},[Xi.IN_PROGRESS]:{title:"قيد التنفيذ",icon:"bi-gear-fill",bgColor:"linear-gradient(135deg, #4834d4 0%, #686de0 100%)",progress:50},[Xi.REVIEW]:{title:"قيد المراجعة",icon:"bi-clipboard-check",bgColor:"linear-gradient(135deg, #f39c12 0%, #e67e22 100%)",progress:90},[Xi.COMPLETED]:{title:"مكتملة",icon:"bi-check-circle-fill",bgColor:"linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)",progress:100}},y4={[Xi.PENDING]:[{id:1,title:"مناقصة إنشاء مبنى سكني",client:"شركة العمارة الحديثة",deadline:"2024-01-15",value:"2,500,000",priority:"high",progress:0},{id:2,title:"مناقصة توريد مواد بناء",client:"مؤسسة البناء المتقدم",deadline:"2024-01-20",value:"850,000",priority:"medium",progress:0}],[Xi.IN_PROGRESS]:[{id:3,title:"مناقصة تشطيب فيلا",client:"العميل الخاص",deadline:"2024-02-01",value:"1,200,000",priority:"high",progress:65},{id:4,title:"مناقصة صيانة مباني",client:"الهيئة الحكومية",deadline:"2024-01-25",value:"450,000",priority:"low",progress:30}],[Xi.REVIEW]:[{id:5,title:"مناقصة مشروع تجاري",client:"مجمع التسوق الكبير",deadline:"2024-02-10",value:"3,800,000",priority:"high",progress:90}],[Xi.COMPLETED]:[{id:6,title:"مناقصة ترميم مسجد",client:"وزارة الأوقاف",deadline:"2023-12-30",value:"680,000",priority:"medium",progress:100},{id:7,title:"مناقصة بناء مدرسة",client:"وزارة التربية",deadline:"2023-12-15",value:"1,950,000",priority:"high",progress:100}]},b4=r=>{switch(r){case"high":return"#dc3545";case"medium":return"#ffc107";case"low":return"#28a745";default:return"#6c757d"}},VE=r=>{switch(r){case"high":return"عالية";case"medium":return"متوسطة";case"low":return"منخفضة";default:return"غير محددة"}},w4=r=>new Intl.NumberFormat("ar-SA",{style:"currency",currency:"SAR",minimumFractionDigits:0,maximumFractionDigits:0}).format(r),oC=N.memo(({tender:r,stage:e,onDragStart:t,onDragEnd:s,isDragging:a})=>{const l=`kanban-card ${a?"kanban-card--dragging":""}`;return n.jsxs("div",{className:l,draggable:!0,onDragStart:c=>t(c,r,e),onDragEnd:s,"data-testid":`kanban-card-${r.id}`,role:"button",tabIndex:0,"aria-label":`${r.title} - ${VE(r.priority)} priority`,children:[n.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[n.jsx("h6",{className:"card-title mb-0",children:r.title}),n.jsx("span",{className:`badge priority-badge priority-badge--${r.priority}`,style:{backgroundColor:b4(r.priority)},children:VE(r.priority)})]}),n.jsxs("div",{className:"card-info mb-2",children:[n.jsx("i",{className:"bi bi-building me-1"}),r.client]}),n.jsxs("div",{className:"card-info mb-2",children:[n.jsx("i",{className:"bi bi-calendar-event me-1"}),new Date(r.deadline).toLocaleDateString("ar-SA")]}),n.jsxs("div",{className:"card-value mb-3",children:[n.jsx("i",{className:"bi bi-currency-dollar me-1"}),w4(r.value)]}),r.progress>0&&n.jsxs("div",{className:"mb-2",children:[n.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[n.jsx("small",{className:"text-muted",children:"التقدم"}),n.jsxs("small",{className:"fw-bold text-primary",children:[r.progress,"%"]})]}),n.jsx("div",{className:"progress-custom",children:n.jsx("div",{className:"progress-bar-custom",style:{width:`${r.progress}%`}})})]}),n.jsxs("div",{className:"card-timestamp",children:[n.jsx("i",{className:"bi bi-clock me-1"}),"منذ يومين"]})]})});oC.displayName="KanbanCard";const lC=N.memo(({stage:r,tenders:e,onDragOver:t,onDragLeave:s,onDrop:a,onCardDragStart:l,onCardDragEnd:c,dragState:u})=>{const m=aC[r],p=e.length,b=u.dragOverTarget===r,w=u.isDragging&&u.draggedFrom!==r,j=`kanban-column ${b?"kanban-column--drag-over":""} ${w?"kanban-column--drag-active":""}`;return n.jsxs("div",{className:j,onDragOver:D=>t(D,r),onDragLeave:s,onDrop:D=>a(D,r),"data-testid":`kanban-column-${r}`,role:"region","aria-label":`${m.title} - ${p} items`,children:[n.jsx("div",{className:"kanban-header",style:{background:m.bgColor},children:n.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("i",{className:`bi ${m.icon} me-2`,style:{fontSize:"18px"}}),n.jsx("h6",{className:"fw-bold mb-0",children:m.title})]}),n.jsx("span",{className:"badge bg-white text-dark",children:p})]})}),n.jsx("div",{className:"kanban-content",children:e.length>0?e.map(D=>n.jsx(oC,{tender:D,stage:r,onDragStart:l,onDragEnd:c,isDragging:u.draggedItem?.id===D.id},D.id)):n.jsxs("div",{className:"kanban-empty",children:[n.jsx("div",{className:"kanban-empty-icon",children:n.jsx("i",{className:"bi bi-inbox"})}),n.jsx("p",{className:"mb-1",children:"لا توجد مناقصات"}),n.jsx("small",{children:"اسحب البطاقات هنا"})]})})]})});lC.displayName="KanbanColumn";const cC=N.memo(({kanbanData:r,onMoveCard:e})=>{const{dragState:t,handleDragStart:s,handleDragEnd:a,handleDragOver:l,handleDragLeave:c,handleDrop:u}=x4(),m=N.useCallback((w,j,D)=>{if(j===D)return;console.log("🎯 [KANBAN] Moving card:",w.title,"from",j,"to",D);const O={...w,progress:aC[D].progress};e(O,j,D)},[e]),p=N.useCallback((w,j)=>{u(w,j,m)},[u,m]),b=[Xi.COMPLETED,Xi.REVIEW,Xi.IN_PROGRESS,Xi.PENDING];return n.jsx("div",{className:"kanban-board",style:{minHeight:"calc(100vh - 400px)",marginTop:"15px"},children:b.map(w=>n.jsx(lC,{stage:w,tenders:r[w],onDragOver:l,onDragLeave:c,onDrop:p,onCardDragStart:s,onCardDragEnd:a,dragState:t},w))})});cC.displayName="KanbanBoard";function v4(){const[r,e]=N.useState(!1),{isTimelineVisible:t}=$n(),[s,a]=N.useState(y4),l=ms(),c=N.useCallback(()=>{e(w=>!w)},[]),u=async()=>{try{await rt.clearPendingData("tenderFormData_new"),await rt.clearPendingData("tenderDocuments_new"),await rt.clearPendingTenderItems(),console.log("✅ [TRACKING] All pending data cleared - navigating to fresh Add Tender form"),l("/tenders/add")}catch(w){console.error("❌ [TRACKING] Error clearing pending data:",w),l("/tenders/add")}},m=N.useCallback((w,j,D)=>{a(O=>{const Q={};return Object.keys(O).forEach(z=>{z===j?Q[z]=O[z].filter(I=>I.id!==w.id):z===D?Q[z]=[w,...O[z]]:Q[z]=[...O[z]]}),console.log("📊 [STATE UPDATE] Card moved to top of target column successfully"),Q})},[]),p=N.useMemo(()=>({paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"}),[r,t]),b=N.useMemo(()=>({width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"}),[r]);return n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Kn,{onToggle:c}),n.jsxs("div",{className:"main-container",style:p,children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:b,children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"متابعة المناقصات"})]})}),n.jsx(Yn,{}),n.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:n.jsxs("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:[n.jsx("div",{className:"card shadow-sm mb-4",children:n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[n.jsx("i",{className:"bi bi-kanban text-primary me-2"}),"متابعة المناقصات"]}),n.jsx("span",{className:"text-muted",children:"لوحة تتبع حالة المناقصات"})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsxs("button",{className:"btn btn-outline-primary",style:{height:"32px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px"},children:[n.jsx("i",{className:"bi bi-filter me-1"}),"تصفية"]}),n.jsxs("button",{className:"btn btn-primary",onClick:u,style:{height:"32px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px"},children:[n.jsx("i",{className:"bi bi-plus-circle me-1"}),"إضافة مناقصة"]})]})]})})}),n.jsx("div",{className:"card shadow-sm",children:n.jsx("div",{className:"card-body p-0",children:n.jsx(cC,{kanbanData:s,onMoveCard:m})})})]})})]}),!r&&t&&n.jsx(Xn,{rtl:!0}),!r&&t&&n.jsx(Jn,{})]})]})}function N4(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(v4,{})})})}function j4(){const[r,e]=N.useState(!1),{isTimelineVisible:t}=$n(),[s,a]=N.useState([]),[l,c]=N.useState([]),[u,m]=N.useState(!1),[p,b]=N.useState(null),[w,j]=N.useState(""),[D,O]=N.useState([]),[Q,z]=N.useState(!1),[I,ee]=N.useState([]),[J,oe]=N.useState(null),Y=ms(),{tenderId:be}=ea(),{logActivity:M,getCurrentUser:H}=vn(),{alertConfig:k,closeAlert:$,showSuccess:X,showError:te}=Pn(),F=()=>{e(!r)};N.useEffect(()=>{ce();const E=ne=>{ne.type==="rawMaterialsUpdated"&&ce()},R=()=>{ce()};window.addEventListener("storage",E),window.addEventListener("rawMaterialsUpdated",R);const V=()=>{ce()};return window.addEventListener("focus",V),()=>{window.removeEventListener("storage",E),window.removeEventListener("rawMaterialsUpdated",R),window.removeEventListener("focus",V)}},[]),N.useEffect(()=>{if(w.trim()){const E=s.filter(R=>R.name?.toLowerCase().includes(w.toLowerCase())||R.category?.toLowerCase().includes(w.toLowerCase())||R.description?.toLowerCase().includes(w.toLowerCase())||R.supplier?.toLowerCase().includes(w.toLowerCase()));O(E)}else O(s)},[w,s]);const ce=async()=>{try{m(!0);const R=(await wr.getAllRawMaterials()).filter(V=>V.active!==!1);a(R),b(null)}catch(E){b(E.message)}finally{m(!1)}},Be=E=>{if(l.some(V=>V.internalId===E.internalId))c(V=>V.filter(ne=>ne.internalId!==E.internalId));else{const V={...E,type:"rawMaterials",quantity:1};c(ne=>[...ne,V])}},U=async()=>{if(l.length===0){te("يرجى اختيار مادة خام واحدة على الأقل","لا توجد مواد مختارة");return}const E=l.map(R=>{let V=R.price||0,ne=R.supplier;if(R.priceQuotes&&Array.isArray(R.priceQuotes)&&R.priceQuotes.length>0){const B=R.priceQuotes.reduce((q,me)=>{const C=parseFloat(q.price)||0;return(parseFloat(me.price)||0)<C?me:q});V=parseFloat(B.price)||0,ne=B.supplierName}return{...R,quantity:1,unitPrice:V,totalPrice:V,displaySupplier:ne}});ee(E),oe(null),z(!0)},se=(E,R)=>{const V=Math.max(.1,parseFloat(R)||.1),ne=parseFloat(V.toFixed(1));ee(B=>B.map(q=>q.id===E?{...q,quantity:ne,totalPrice:q.unitPrice*ne}:q))},fe=async()=>{console.log("🚀 FUNCTION START: handleConfirmQuantities called");try{if(!Array.isArray(I)||I.length===0){console.log("🚨 EARLY EXIT: No modal items to process"),te("لا توجد مواد مختارة للإضافة","خطأ في البيانات");return}console.log("🔍 STEP 1: Starting duplicate check process..."),console.log("🔍 Modal items to check:",I.map(C=>({name:C.name,internalId:C.internalId,id:C.id})));const E=await rt.getPendingTenderItems()||[];console.log("🔍 STEP 2: Retrieved existing items from storage:",{count:E.length,items:E.map(C=>({name:C.materialName||C.name,materialInternalId:C.materialInternalId,internalId:C.internalId,id:C.id}))});const R=E.map(C=>C.materialInternalId||C.internalId||C.id).filter(Boolean);console.log("🔍 STEP 3: Extracted existing material IDs:",R);const V=[],ne=I.filter(C=>{const Z=C.internalId||C.id,je=R.includes(Z);return console.log(`🔍 STEP 4: Duplicate check for "${C.name}" (ID: ${Z}) - Is Duplicate: ${je}`),je&&(V.push(C.name),console.log(`🚨 DUPLICATE FOUND: "${C.name}" with ID ${Z} already exists!`)),!je});if(console.log("🔍 STEP 5: Duplicate prevention analysis complete:",{totalModalItems:I.length,duplicatesFound:V.length,uniqueItems:ne.length,duplicateNames:V,existingIds:R}),V.length>0){console.log("🚨🚨🚨 CRITICAL: DUPLICATE PREVENTION ACTIVATED 🚨🚨🚨"),console.log("🚨 STEP 6: Execution will be FORCEFULLY STOPPED"),console.log("🚨 Duplicate items blocking execution:",V),console.log("🚨 Function will return immediately after showing warnings");const C=V.join("، ");te(`⚠️ البنود التالية موجودة مسبقاً في قائمة المناقصة:

${C}

❌ لا يمكن إضافة نفس البند مرتين.

✅ يرجى إلغاء تحديد البنود المكررة والمحاولة مرة أخرى.`,"🛡️ تحذير: منع التكرار"),oe(`⚠️ البنود المكررة: ${C}`),console.log("🚨 STEP 7: About to return and stop execution completely"),console.log("🚨 If you see any code execution after this point, there is a bug!");return}console.log("✅ STEP 8: NO DUPLICATES DETECTED - Safe to proceed"),console.log("✅ Continuing with item creation process...");const B=[];for(const C of ne)try{const Z={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:C.internalId,materialType:"rawMaterial",materialName:C.name,materialCategory:C.category||"",materialUnit:C.unit||"قطعة",quantity:C.quantity||1,unitPrice:C.unitPrice||C.price||0,totalPrice:(C.quantity||1)*(C.unitPrice||C.price||0),supplierInfo:C.displaySupplier||C.supplier||"",tenderId:be==="new"?"new":be,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};B.push(Z),console.log("Created tender item with ID relationship:",{tenderItemId:Z.internalId,linkedMaterialId:Z.materialInternalId,materialName:Z.materialName,currentPrice:Z.unitPrice,totalPrice:Z.totalPrice})}catch(Z){console.error("Error creating tender item for material:",C.name,Z),te(`فشل في إضافة المادة: ${C.name}`,"خطأ في البيانات");return}const q=await rt.getPendingTenderItems()||[];let me=[...B];if(q.length>0)try{if(Array.isArray(q)){const C=await sv.refreshTenderItemsPricing(q);console.log("🔄 SAFE MERGE: Our enhanced duplicate prevention handled conflicts, merging safely"),me=[...C,...B],console.log("✅ SAFE MERGE completed:",{existingItemsCount:C.length,newItemsCount:B.length,finalItemsCount:me.length,note:"No conflicts - duplicates were prevented above"})}}catch(C){console.error("Error parsing existing items:",C)}console.log("Storing ID-based tender items:",{totalItems:me.length,newItems:B.length,items:me.map(C=>({id:C.internalId,materialId:C.materialInternalId,name:C.materialName,price:C.unitPrice,total:C.totalPrice}))}),await rt.setPendingTenderItems(me);try{const C=H();C&&C.name&&M("task",`${C.name} أضاف مواد خام للمناقصة`,`تم إضافة ${B.length} مادة خام بنظام الهوية الفريدة`)}catch(C){console.error("Failed to log activity:",C)}window.dispatchEvent(new CustomEvent("tenderItemsAdded",{detail:{count:B.length,type:"rawMaterial",items:B}})),X(`تم إضافة ${B.length} مادة خام بنجاح إلى قائمة المناقصة`,"نجحت العملية"),z(!1),ee([]),oe(null),setTimeout(()=>{Y(be==="new"?"/tenders/add":`/tenders/edit/${be}`)},2e3)}catch(E){console.error("Error in handleConfirmQuantities:",E),te("فشل في إضافة المواد الخام للمناقصة - تحقق من البيانات","خطأ في النظام")}},ie=()=>{z(!1),ee([]),oe(null)},_=()=>Math.round(I.reduce((E,R)=>E+R.totalPrice,0));return u?n.jsx(Dn,{show:!0,message:"جار تحميل بيانات المواد الخام...",overlay:!1}):p?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:p}),n.jsxs("button",{className:"btn btn-primary",onClick:ce,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Kn,{onToggle:F}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المناقصات"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"مواد خام"})]})}),n.jsx(Yn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"raw-materials-table",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-gear text-danger me-2"}),"قائمة المواد الخام (",D.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المواد الخام...",value:w,onChange:E=>j(E.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),n.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:U,disabled:l.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["إضافة المحدد (",l.length,")"]}),n.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const E=be!=="new"?`/tenders/edit/${be}`:"/tenders/add";Y(E)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:"العودة للمناقصة"})]})})]})}),n.jsx("div",{className:"card-body p-0",children:D.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-gear fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد مواد خام"}),n.jsx("p",{className:"text-muted",children:w?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي مواد خام بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",children:"اختيار"}),n.jsx("th",{className:"text-center",children:"اسم المادة"}),n.jsx("th",{className:"text-center",children:"الفئة"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر"}),n.jsx("th",{className:"text-center",children:"المورد"})]})}),n.jsx("tbody",{children:D.map(E=>{let R=E.price,V=E.supplier,ne=!1,B=null;return E.priceQuotes&&Array.isArray(E.priceQuotes)&&E.priceQuotes.length>0&&(ne=!0,B=E.priceQuotes.reduce((q,me)=>{const C=parseFloat(q.price)||0;return(parseFloat(me.price)||0)<C?me:q}),R=B.price,V=B.supplierName),n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input",type:"checkbox",checked:l.some(q=>q.internalId===E.internalId),onChange:()=>Be(E),style:{transform:"scale(1.2)"}})})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-primary",children:E.name})}),n.jsx("td",{className:"text-center",children:E.category||"-"}),n.jsx("td",{className:"text-center",children:E.unit||"-"}),n.jsx("td",{className:"text-center",children:R?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsxs("span",{children:[R," ريال"]}),ne&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}):"-"}),n.jsx("td",{className:"text-center",children:V?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("span",{children:V}),ne&&n.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:"أقل مورد"})]}):"-"})]},E.id)})})]})})})]})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&t&&n.jsx(Xn,{rtl:!0}),!r&&t&&n.jsx(Jn,{})]}),Q&&n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-calculator me-2"}),"تحديد الكميات والأسعار"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:ie,"aria-label":"Close"})]}),n.jsxs("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:[J&&n.jsxs("div",{className:"alert alert-warning alert-dismissible m-3 mb-2",role:"alert",style:{background:"linear-gradient(45deg, #fff3cd, #ffeaa7)",border:"2px solid #f39c12",borderRadius:"8px",boxShadow:"0 4px 12px rgba(243, 156, 18, 0.3)"},children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-exclamation-triangle-fill text-warning me-2",style:{fontSize:"20px"}}),n.jsxs("div",{className:"flex-grow-1",children:[n.jsx("strong",{children:"تحذير: بنود مكررة!"}),n.jsx("div",{className:"mt-1 text-dark",children:J}),n.jsx("small",{className:"text-muted",children:"يرجى إلغاء تحديد البنود المكررة قبل المتابعة"})]})]}),n.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>oe(null)})]}),n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"30%"},children:"المادة الخام"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"السعر الأساسي"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"المورد"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"إجمالي السعر"})]})}),n.jsx("tbody",{children:I.map((E,R)=>n.jsxs("tr",{style:{height:"60px"},children:[n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:"bi bi-gear text-danger me-2"}),n.jsxs("div",{children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:V=>{V.preventDefault(),V.stopPropagation(),Y(`/raw-materials/edit/${E.id}`)},title:`تحرير المادة الخام: ${E.name}`,children:E.name}),n.jsx("small",{className:"text-muted",children:E.category})]})]})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("span",{className:"fw-bold text-success",children:[Math.round(E.unitPrice)," ريال"]}),n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:["/",E.unit||"وحدة"]})})]}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>se(E.id,E.quantity-.1),disabled:E.quantity<=.1,style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-dash"})}),n.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:E.quantity.toFixed(1),min:"0.1",step:"0.1",onChange:V=>se(E.id,V.target.value)}),n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>se(E.id,E.quantity+.1),style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-plus"})})]})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"text-muted",children:E.displaySupplier||"-"})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(E.totalPrice)," ريال"]}),n.jsxs("small",{className:"text-success",children:["(",E.quantity.toFixed(1)," × ",Math.round(E.unitPrice),")"]})]})]},E.id))})]})})]}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:n.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("span",{className:"text-muted me-3",children:"إجمالي الطلبية:"}),n.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[_()," ريال"]}),n.jsxs("span",{className:"badge bg-info ms-2",children:[I.reduce((E,R)=>E+R.quantity,0).toFixed(1)," قطعة"]})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:ie,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:fe,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"تأكيد"})]})]})})]})})}),n.jsx(Rn,{show:k.show,onClose:$,title:k.title,message:k.message,type:k.type,onConfirm:k.onConfirm,showConfirm:k.showConfirm})]})}function _4(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(j4,{})})})}function E4(){const[r,e]=N.useState(!1),{isTimelineVisible:t}=$n(),[s,a]=N.useState([]),[l,c]=N.useState([]),[u,m]=N.useState(!1),[p,b]=N.useState(null),[w,j]=N.useState(""),[D,O]=N.useState([]),[Q,z]=N.useState(!1),[I,ee]=N.useState([]),[J,oe]=N.useState(null),Y=ms(),{tenderId:be}=ea(),{logActivity:M,getCurrentUser:H}=vn(),{alertConfig:k,closeAlert:$,showSuccess:X,showError:te}=Pn(),F=()=>{e(!r)};N.useEffect(()=>{ce();const E=ne=>{ne.type==="localProductsUpdated"&&ce()},R=()=>{ce()};window.addEventListener("storage",E),window.addEventListener("localProductsUpdated",R);const V=()=>{ce()};return window.addEventListener("focus",V),()=>{window.removeEventListener("storage",E),window.removeEventListener("localProductsUpdated",R),window.removeEventListener("focus",V)}},[]),N.useEffect(()=>{if(w.trim()){const E=s.filter(R=>R.name?.toLowerCase().includes(w.toLowerCase())||R.category?.toLowerCase().includes(w.toLowerCase())||R.description?.toLowerCase().includes(w.toLowerCase())||R.manufacturer?.toLowerCase().includes(w.toLowerCase()));O(E)}else O(s)},[w,s]);const ce=async()=>{try{m(!0);const R=(await vr.getAllLocalProducts()).filter(V=>V.active!==!1);a(R),b(null)}catch(E){b(E.message)}finally{m(!1)}},Be=E=>{if(l.some(V=>V.internalId===E.internalId))c(V=>V.filter(ne=>ne.internalId!==E.internalId));else{const V={...E,type:"localProducts",quantity:1};c(ne=>[...ne,V])}},U=async()=>{if(l.length===0){te("يرجى اختيار منتج محلي واحد على الأقل","لا توجد منتجات مختارة");return}const E=await rt.getPendingTenderItems()||[];let R=[];if(E.length>0)try{Array.isArray(E)&&(R=E.map(q=>q.materialInternalId||q.internalId||q.id).filter(Boolean))}catch(q){console.error("Error parsing existing items:",q)}const V=[],ne=l.filter(q=>{const me=R.includes(q.internalId);return me&&V.push(q.name),!me});if(V.length>0){const q=V.join("، ");if(te(`البنود التالية موجودة مسبقاً في القائمة: ${q}`,"بنود مكررة"),ne.length===0)return;console.log(`Found ${V.length} duplicate items, proceeding with ${ne.length} unique items`)}const B=ne.map(q=>{let me=q.price||0,C=q.manufacturer;if(q.priceQuotes&&Array.isArray(q.priceQuotes)&&q.priceQuotes.length>0){const Z=q.priceQuotes.reduce((je,Ge)=>{const Ke=parseFloat(je.price)||0;return(parseFloat(Ge.price)||0)<Ke?Ge:je});me=parseFloat(Z.price)||0,C=Z.supplierName}return{...q,quantity:1,unitPrice:me,totalPrice:me,displaySupplier:C}});ee(B),oe(null),z(!0)},se=(E,R)=>{const V=Math.max(.1,parseFloat(R)||.1),ne=parseFloat(V.toFixed(1));ee(B=>B.map(q=>q.id===E?{...q,quantity:ne,totalPrice:q.unitPrice*ne}:q))},fe=async()=>{try{if(!Array.isArray(I)||I.length===0){te("لا توجد منتجات مختارة للإضافة","خطأ في البيانات");return}console.log("🛡️ STARTING DUPLICATE PREVENTION FOR LOCAL PRODUCTS...");const E=await rt.getPendingTenderItems()||[];let R=[];if(E.length>0)try{Array.isArray(E)&&(R=E.map(C=>C.materialInternalId||C.internalId||C.id).filter(Boolean))}catch(C){console.error("Error parsing existing items:",C)}console.log("🔍 Existing material IDs:",R),console.log("🔍 Modal items to check:",I.map(C=>({name:C.name,internalId:C.internalId,id:C.id})));const V=[],ne=I.filter(C=>{const Z=C.internalId||C.id,je=R.includes(Z);return console.log(`🔍 DUPLICATE CHECK: "${C.name}" (${Z}) - Duplicate: ${je}`),je?(V.push(C.name),!1):!0});if(console.log("🛡️ DUPLICATE PREVENTION RESULT:",{totalItems:I.length,duplicatesFound:V.length,uniqueItems:ne.length,duplicateNames:V}),V.length>0){const C=V.join("، ");console.log("🚨 DUPLICATE PREVENTION ACTIVATED: Blocking duplicates:",C),te(`⚠️ البنود التالية موجودة مسبقاً في قائمة المناقصة:

${C}

❌ لا يمكن إضافة نفس البند مرتين.

✅ يرجى إلغاء تحديد البنود المكررة والمحاولة مرة أخرى.`,"🛡️ تحذير: منع التكرار"),oe(`⚠️ البنود المكررة: ${C}`);return}console.log("✅ No duplicates found, proceeding with creation...");const B=[];for(const C of ne)try{const Z={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:C.internalId,materialType:"localProduct",materialName:C.name,materialCategory:C.category||"",materialUnit:C.unit||"قطعة",quantity:C.quantity||1,unitPrice:C.unitPrice||C.price||0,totalPrice:(C.quantity||1)*(C.unitPrice||C.price||0),supplierInfo:C.displaySupplier||C.supplier||"",tenderId:be==="new"?"new":be,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};B.push(Z),console.log("Created tender item with ID relationship:",{tenderItemId:Z.internalId,linkedProductId:Z.materialInternalId,productName:Z.materialName,currentPrice:Z.unitPrice,totalPrice:Z.totalPrice})}catch(Z){console.error("Error creating tender item for product:",C.name,Z),te(`فشل في إضافة المنتج: ${C.name}`,"خطأ في البيانات");return}const q=await rt.getPendingTenderItems()||[];let me=[...B];if(q.length>0)try{if(Array.isArray(q)){const C=await sv.refreshTenderItemsPricing(q);console.log("🔄 SAFE MERGE: Our enhanced duplicate prevention handled conflicts, merging safely"),me=[...C,...B],console.log("Duplicate prevention results:",{existingItemsCount:C.length,newItemsCount:B.length,finalItemsCount:me.length})}}catch(C){console.error("Error parsing existing items:",C)}console.log("Storing ID-based tender items:",{totalItems:me.length,newItems:B.length,items:me.map(C=>({id:C.internalId,materialId:C.materialInternalId,name:C.materialName,price:C.unitPrice,total:C.totalPrice}))}),await rt.setPendingTenderItems(me);try{const C=H();C&&C.name&&M("task",`${C.name} أضاف منتجات محلية للمناقصة`,`تم إضافة ${B.length} منتج محلي بنظام الهوية الفريدة`)}catch(C){console.error("Failed to log activity:",C)}X(`تم إضافة ${B.length} منتج محلي بنجاح إلى قائمة المناقصة`,"نجحت العملية"),window.dispatchEvent(new CustomEvent("tenderItemsAdded",{detail:{count:B.length,type:"localProduct",items:B}})),z(!1),ee([]),oe(null),setTimeout(()=>{Y(be==="new"?"/tenders/add":`/tenders/edit/${be}`)},2e3)}catch(E){console.error("Error in handleConfirmQuantities:",E),te("فشل في إضافة المنتجات المحلية للمناقصة - تحقق من البيانات","خطأ في النظام")}},ie=()=>{z(!1),ee([]),oe(null)},_=()=>Math.round(I.reduce((E,R)=>E+R.totalPrice,0));return u?n.jsx(Dn,{show:!0,message:"جار تحميل بيانات المنتجات المحلية...",overlay:!1}):p?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:p}),n.jsxs("button",{className:"btn btn-primary",onClick:ce,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Kn,{onToggle:F}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المناقصات"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"منتجات محلية"})]})}),n.jsx(Yn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"raw-materials-table",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-house text-success me-2"}),"قائمة المنتجات المحلية (",D.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المنتجات المحلية...",value:w,onChange:E=>j(E.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),n.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:U,disabled:l.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["إضافة المحدد (",l.length,")"]}),n.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const E=be!=="new"?`/tenders/edit/${be}`:"/tenders/add";Y(E)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:"العودة للمناقصة"})]})})]})}),n.jsx("div",{className:"card-body p-0",children:D.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-house fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد منتجات محلية"}),n.jsx("p",{className:"text-muted",children:w?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي منتجات محلية بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",children:"اختيار"}),n.jsx("th",{className:"text-center",children:"اسم المنتج"}),n.jsx("th",{className:"text-center",children:"الفئة"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر"}),n.jsx("th",{className:"text-center",children:"الشركة المصنعة"})]})}),n.jsx("tbody",{children:D.map(E=>{let R=E.price,V=E.manufacturer,ne=!1,B=null;return E.priceQuotes&&Array.isArray(E.priceQuotes)&&E.priceQuotes.length>0&&(ne=!0,B=E.priceQuotes.reduce((q,me)=>{const C=parseFloat(q.price)||0;return(parseFloat(me.price)||0)<C?me:q}),R=B.price,V=B.supplierName),n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input",type:"checkbox",checked:l.some(q=>q.internalId===E.internalId),onChange:()=>Be(E),style:{transform:"scale(1.2)"}})})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-primary",children:E.name})}),n.jsx("td",{className:"text-center",children:E.category||"-"}),n.jsx("td",{className:"text-center",children:E.unit||"-"}),n.jsx("td",{className:"text-center",children:R?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsxs("span",{children:[R," ريال"]}),ne&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}):"-"}),n.jsx("td",{className:"text-center",children:V?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("span",{children:V}),ne&&n.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:"أقل مورد"})]}):"-"})]},E.id)})})]})})})]})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&t&&n.jsx(Xn,{rtl:!0}),!r&&t&&n.jsx(Jn,{})]}),Q&&n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-calculator me-2"}),"تحديد الكميات والأسعار"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:ie,"aria-label":"Close"})]}),n.jsxs("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:[J&&n.jsxs("div",{className:"alert alert-warning alert-dismissible m-3 mb-2",role:"alert",style:{background:"linear-gradient(45deg, #fff3cd, #ffeaa7)",border:"2px solid #f39c12",borderRadius:"8px",boxShadow:"0 4px 12px rgba(243, 156, 18, 0.3)"},children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-exclamation-triangle-fill text-warning me-2",style:{fontSize:"20px"}}),n.jsxs("div",{className:"flex-grow-1",children:[n.jsx("strong",{children:"تحذير: بنود مكررة!"}),n.jsx("div",{className:"mt-1 text-dark",children:J}),n.jsx("small",{className:"text-muted",children:"يرجى إلغاء تحديد البنود المكررة قبل المتابعة"})]})]}),n.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>oe(null)})]}),n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"30%"},children:"المنتج المحلي"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"السعر الأساسي"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"الشركة المصنعة"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"إجمالي السعر"})]})}),n.jsx("tbody",{children:I.map((E,R)=>n.jsxs("tr",{style:{height:"60px"},children:[n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:"bi bi-house text-success me-2"}),n.jsxs("div",{children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:V=>{V.preventDefault(),V.stopPropagation(),Y(`/local-products/edit/${E.id}`)},title:`تحرير المنتج المحلي: ${E.name}`,children:E.name}),n.jsx("small",{className:"text-muted",children:E.category})]})]})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("span",{className:"fw-bold text-success",children:[Math.round(E.unitPrice)," ريال"]}),n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:["/",E.unit||"وحدة"]})})]}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>se(E.id,E.quantity-.1),disabled:E.quantity<=.1,style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-dash"})}),n.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:E.quantity.toFixed(1),min:"0.1",step:"0.1",onChange:V=>se(E.id,V.target.value)}),n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>se(E.id,E.quantity+.1),style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-plus"})})]})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"text-muted",children:E.displaySupplier||"-"})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(E.totalPrice)," ريال"]}),n.jsxs("small",{className:"text-success",children:["(",E.quantity.toFixed(1)," × ",Math.round(E.unitPrice),")"]})]})]},E.id))})]})})]}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:n.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("span",{className:"text-muted me-3",children:"إجمالي الطلبية:"}),n.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[_()," ريال"]}),n.jsxs("span",{className:"badge bg-info ms-2",children:[I.reduce((E,R)=>E+R.quantity,0).toFixed(1)," قطعة"]})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:ie,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:fe,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"تأكيد"})]})]})})]})})}),n.jsx(Rn,{show:k.show,onClose:$,title:k.title,message:k.message,type:k.type,onConfirm:k.onConfirm,showConfirm:k.showConfirm})]})}function S4(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(E4,{})})})}function I4(){const[r,e]=N.useState(!1),{isTimelineVisible:t}=$n(),[s,a]=N.useState([]),[l,c]=N.useState([]),[u,m]=N.useState(!1),[p,b]=N.useState(null),[w,j]=N.useState(""),[D,O]=N.useState([]),[Q,z]=N.useState(!1),[I,ee]=N.useState([]),[J,oe]=N.useState(null),Y=ms(),{tenderId:be}=ea(),{logActivity:M,getCurrentUser:H}=vn(),{alertConfig:k,closeAlert:$,showSuccess:X,showError:te}=Pn(),F=()=>{e(!r)};N.useEffect(()=>{ce();const E=ne=>{ne.type==="foreignProductsUpdated"&&ce()},R=()=>{ce()};window.addEventListener("storage",E),window.addEventListener("foreignProductsUpdated",R);const V=()=>{ce()};return window.addEventListener("focus",V),()=>{window.removeEventListener("storage",E),window.removeEventListener("foreignProductsUpdated",R),window.removeEventListener("focus",V)}},[]),N.useEffect(()=>{if(w.trim()){const E=s.filter(R=>R.name?.toLowerCase().includes(w.toLowerCase())||R.category?.toLowerCase().includes(w.toLowerCase())||R.description?.toLowerCase().includes(w.toLowerCase())||R.supplier?.toLowerCase().includes(w.toLowerCase())||R.countryOfOrigin?.toLowerCase().includes(w.toLowerCase()));O(E)}else O(s)},[w,s]);const ce=async()=>{try{m(!0);const R=(await Nr.getAllForeignProducts()).filter(V=>V.active!==!1);a(R),b(null)}catch(E){b(E.message)}finally{m(!1)}},Be=E=>{if(l.some(V=>V.internalId===E.internalId))c(V=>V.filter(ne=>ne.internalId!==E.internalId));else{const V={...E,type:"foreignProduct",quantity:1};c(ne=>[...ne,V])}},U=async()=>{if(l.length===0){te("يرجى اختيار منتج أجنبي واحد على الأقل","لا توجد منتجات مختارة");return}console.log("🔍 FOREIGN PRODUCTS: Fetching existing items for duplicate check...");const E=await rt.getPendingTenderItems()||[];console.log("📦 FOREIGN PRODUCTS: Existing items found:",E.length);let R=[];E&&Array.isArray(E)&&(R=E.map(q=>q.materialInternalId),console.log("🆔 FOREIGN PRODUCTS: Existing material IDs:",R));const V=[],ne=l.filter(q=>{const me=R.includes(q.internalId);return me&&V.push(q.name),!me});if(V.length>0){const q=V.join("، ");if(te(`البنود التالية موجودة مسبقاً في القائمة: ${q}`,"بنود مكررة"),ne.length===0)return;console.log(`Found ${V.length} duplicate items, proceeding with ${ne.length} unique items`)}const B=ne.map(q=>{let me=q.price||0,C=q.supplier;if(q.priceQuotes&&Array.isArray(q.priceQuotes)&&q.priceQuotes.length>0){const Z=q.priceQuotes.reduce((je,Ge)=>{const Ke=parseFloat(je.price)||0;return(parseFloat(Ge.price)||0)<Ke?Ge:je});me=parseFloat(Z.price)||0,C=Z.supplierName}return{...q,quantity:1,unitPrice:me,totalPrice:me,displaySupplier:C}});ee(B),oe(null),z(!0)},se=(E,R)=>{const V=Math.max(.1,parseFloat(R)||.1),ne=parseFloat(V.toFixed(1));ee(B=>B.map(q=>q.id===E?{...q,quantity:ne,totalPrice:q.unitPrice*ne}:q))},fe=async()=>{try{if(!Array.isArray(I)||I.length===0){te("لا توجد منتجات مختارة للإضافة","خطأ في البيانات");return}console.log("🛡️ STARTING DUPLICATE PREVENTION FOR FOREIGN PRODUCTS...");const E=await rt.getPendingTenderItems()||[];let R=[];E&&Array.isArray(E)&&(R=E.map(C=>C.materialInternalId||C.internalId||C.id).filter(Boolean)),console.log("🔍 Existing material IDs:",R),console.log("🔍 Modal items to check:",I.map(C=>({name:C.name,internalId:C.internalId,id:C.id})));const V=[],ne=I.filter(C=>{const Z=C.internalId||C.id,je=R.includes(Z);return console.log(`🔍 DUPLICATE CHECK: "${C.name}" (${Z}) - Duplicate: ${je}`),je?(V.push(C.name),!1):!0});if(console.log("🛡️ DUPLICATE PREVENTION RESULT:",{totalItems:I.length,duplicatesFound:V.length,uniqueItems:ne.length,duplicateNames:V}),V.length>0){const C=V.join("، ");console.log("🚨 DUPLICATE PREVENTION ACTIVATED: Blocking duplicates:",C),te(`⚠️ البنود التالية موجودة مسبقاً في قائمة المناقصة:

${C}

❌ لا يمكن إضافة نفس البند مرتين.

✅ يرجى إلغاء تحديد البنود المكررة والمحاولة مرة أخرى.`,"🛡️ تحذير: منع التكرار"),oe(`⚠️ البنود المكررة: ${C}`);return}console.log("✅ No duplicates found, proceeding with creation...");const B=[];for(const C of ne)try{console.log("🔄 Creating tender item directly:",C.name);const Z={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:C.internalId,materialType:"foreignProduct",materialName:C.name,materialCategory:C.category||"",materialUnit:C.unit||"قطعة",quantity:C.quantity||1,unitPrice:C.unitPrice||C.price||0,totalPrice:(C.quantity||1)*(C.unitPrice||C.price||0),supplierInfo:C.displaySupplier||C.supplier||"",tenderId:be==="new"?"new":be,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};B.push(Z),console.log("✅ Created tender item directly:",{internalId:Z.internalId,materialName:Z.materialName,quantity:Z.quantity,unitPrice:Z.unitPrice,totalPrice:Z.totalPrice})}catch(Z){console.error("❌ Error creating tender item for product:",C.name,Z),te(`فشل في إضافة المنتج "${C.name}": ${Z.message||"خطأ غير معروف"}`,"خطأ في البيانات");return}console.log("🔍 MERGE PHASE: Fetching existing items for merge...");const q=await rt.getPendingTenderItems()||[];console.log("📦 MERGE PHASE: Existing items fetched:",{count:q.length,items:q.map(C=>({id:C.materialInternalId,name:C.materialName,type:C.materialType}))});let me=[...B];if(console.log("🆕 MERGE PHASE: Starting with new items:",B.length),q.length>0)try{if(Array.isArray(q)){console.log("🔄 MERGE PHASE: Refreshing pricing for existing items...");const C=await sv.refreshTenderItemsPricing(q);console.log("💰 MERGE PHASE: Price refresh completed:",{originalCount:q.length,refreshedCount:C.length,refreshedItems:C.map(Z=>({id:Z.materialInternalId,name:Z.materialName,price:Z.unitPrice}))}),console.log("🔄 MERGE PHASE: Performing safe merge..."),console.log("📋 Before merge - Existing items:",C.length),console.log("📋 Before merge - New items:",B.length),me=[...C,...B],console.log("✅ MERGE PHASE: Safe merge completed:",{existingItemsCount:C.length,newItemsCount:B.length,finalItemsCount:me.length,finalItems:me.map(Z=>({id:Z.materialInternalId,name:Z.materialName,type:Z.materialType}))})}}catch(C){console.error("❌ MERGE PHASE: Error in merge operation:",C)}else console.log("📭 MERGE PHASE: No existing items found, using only new items");console.log("Storing ID-based tender items:",{totalItems:me.length,newItems:B.length,items:me.map(C=>({id:C.internalId,materialId:C.materialInternalId,name:C.materialName,price:C.unitPrice,total:C.totalPrice}))}),await rt.setPendingTenderItems(me),console.log("✅ STORAGE COMPLETE - Stored items to FirestorePendingDataService:",me.length),setTimeout(async()=>{const C=await rt.getPendingTenderItems();console.log("🔍 VERIFICATION: Items in storage after save:",{count:C?.length||0,items:C})},100),console.log("📡 DISPATCHING CUSTOM EVENT: tenderItemsAdded"),window.dispatchEvent(new CustomEvent("tenderItemsAdded",{detail:{count:B.length,type:"foreignProduct",items:me}}));try{const C=H();C&&C.name&&M("task",`${C.name} أضاف منتجات أجنبية للمناقصة`,`تم إضافة ${B.length} منتج أجنبي بنظام الهوية الفريدة`)}catch(C){console.error("Failed to log activity:",C)}X(`تم إضافة ${B.length} منتج أجنبي بنجاح إلى قائمة المناقصة`,"نجحت العملية"),z(!1),ee([]),oe(null),setTimeout(()=>{Y(be==="new"?"/tenders/add":`/tenders/edit/${be}`)},2e3)}catch(E){console.error("Error in handleConfirmQuantities:",E),te("فشل في إضافة المنتجات الأجنبية للمناقصة - تحقق من البيانات","خطأ في النظام")}},ie=()=>{z(!1),ee([]),oe(null)},_=()=>Math.round(I.reduce((E,R)=>E+R.totalPrice,0));return u?n.jsx(Dn,{show:!0,message:"جار تحميل بيانات المنتجات الأجنبية...",overlay:!1}):p?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:p}),n.jsxs("button",{className:"btn btn-primary",onClick:ce,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Kn,{onToggle:F}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المناقصات"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"منتجات أجنبية"})]})}),n.jsx(Yn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"raw-materials-table",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-globe text-warning me-2"}),"قائمة المنتجات الأجنبية (",D.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المنتجات الأجنبية...",value:w,onChange:E=>j(E.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),n.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:U,disabled:l.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["إضافة المحدد (",l.length,")"]}),n.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const E=be!=="new"?`/tenders/edit/${be}`:"/tenders/add";Y(E)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:"العودة للمناقصة"})]})})]})}),n.jsx("div",{className:"card-body p-0",children:D.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-globe fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد منتجات أجنبية"}),n.jsx("p",{className:"text-muted",children:w?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي منتجات أجنبية بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",children:"اختيار"}),n.jsx("th",{className:"text-center",children:"اسم المنتج"}),n.jsx("th",{className:"text-center",children:"الفئة"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر"}),n.jsx("th",{className:"text-center",children:"المورد"}),n.jsx("th",{className:"text-center",children:"بلد المنشأ"})]})}),n.jsx("tbody",{children:D.map(E=>{let R=E.price,V=E.supplier,ne=!1,B=null;return E.priceQuotes&&Array.isArray(E.priceQuotes)&&E.priceQuotes.length>0&&(ne=!0,B=E.priceQuotes.reduce((q,me)=>{const C=parseFloat(q.price)||0;return(parseFloat(me.price)||0)<C?me:q}),R=B.price,V=B.supplierName),n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input",type:"checkbox",checked:l.some(q=>q.internalId===E.internalId),onChange:()=>Be(E),style:{transform:"scale(1.2)"}})})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-primary",children:E.name})}),n.jsx("td",{className:"text-center",children:E.category||"-"}),n.jsx("td",{className:"text-center",children:E.unit||"-"}),n.jsx("td",{className:"text-center",children:R?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsxs("span",{children:[R," ريال"]}),ne&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}):"-"}),n.jsx("td",{className:"text-center",children:V?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("span",{children:V}),ne&&n.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:"أقل مورد"})]}):"-"}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"badge bg-warning text-dark",children:E.countryOfOrigin||"غير محدد"})})]},E.id)})})]})})})]})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&t&&n.jsx(Xn,{rtl:!0}),!r&&t&&n.jsx(Jn,{})]}),Q&&n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-calculator me-2"}),"تحديد الكميات والأسعار"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:ie,"aria-label":"Close"})]}),n.jsxs("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:[J&&n.jsxs("div",{className:"alert alert-warning alert-dismissible m-3 mb-2",role:"alert",style:{background:"linear-gradient(45deg, #fff3cd, #ffeaa7)",border:"2px solid #f39c12",borderRadius:"8px",boxShadow:"0 4px 12px rgba(243, 156, 18, 0.3)"},children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-exclamation-triangle-fill text-warning me-2",style:{fontSize:"20px"}}),n.jsxs("div",{className:"flex-grow-1",children:[n.jsx("strong",{children:"تحذير: بنود مكررة!"}),n.jsx("div",{className:"mt-1 text-dark",children:J}),n.jsx("small",{className:"text-muted",children:"يرجى إلغاء تحديد البنود المكررة قبل المتابعة"})]})]}),n.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>oe(null)})]}),n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"30%"},children:"المنتج الأجنبي"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"السعر الأساسي"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"المورد"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"إجمالي السعر"})]})}),n.jsx("tbody",{children:I.map((E,R)=>n.jsxs("tr",{style:{height:"60px"},children:[n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:"bi bi-globe text-warning me-2"}),n.jsxs("div",{children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:V=>{V.preventDefault(),V.stopPropagation(),Y(`/foreign-products/edit/${E.id}`)},title:`تحرير المنتج المستورد: ${E.name}`,children:E.name}),n.jsx("small",{className:"text-muted",children:E.category}),n.jsx("div",{children:n.jsx("span",{className:"badge bg-warning text-dark",style:{fontSize:"10px"},children:E.countryOfOrigin||"غير محدد"})})]})]})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("span",{className:"fw-bold text-success",children:[Math.round(E.unitPrice)," ريال"]}),n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:["/",E.unit||"وحدة"]})})]}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>se(E.id,E.quantity-.1),disabled:E.quantity<=.1,style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-dash"})}),n.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:E.quantity.toFixed(1),min:"0.1",step:"0.1",onChange:V=>se(E.id,V.target.value)}),n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>se(E.id,E.quantity+.1),style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-plus"})})]})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"text-muted",children:E.displaySupplier||"-"})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(E.totalPrice)," ريال"]}),n.jsxs("small",{className:"text-success",children:["(",E.quantity.toFixed(1)," × ",Math.round(E.unitPrice),")"]})]})]},E.id))})]})})]}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:n.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("span",{className:"text-muted me-3",children:"إجمالي الطلبية:"}),n.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[_()," ريال"]}),n.jsxs("span",{className:"badge bg-info ms-2",children:[I.reduce((E,R)=>E+R.quantity,0).toFixed(1)," قطعة"]})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:ie,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{console.log("🔥 CONFIRM BUTTON CLICKED! Modal items:",I),fe()},style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"تأكيد"})]})]})})]})})}),n.jsx(Rn,{show:k.show,onClose:$,title:k.title,message:k.message,type:k.type,onConfirm:k.onConfirm,showConfirm:k.showConfirm})]})}function T4(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(I4,{})})})}const C4=()=>{window.dispatchEvent(new CustomEvent("manufacturedProductsUpdated"))};class ac{static COLLECTION_NAME="manufacturedProducts";static async createManufacturedProduct(e){try{console.log("📤 Creating manufactured product:",e.title);const t=Ct("MANUFACTURED_PRODUCT"),s={...e,internalId:t,createdAt:vt(),updatedAt:vt(),status:e.status||"active"},a=await Mr(ct(De,this.COLLECTION_NAME),s);return console.log("✅ Manufactured product created with ID:",a.id),{id:a.id,internalId:t,...s,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}catch(t){throw console.error("❌ Error creating manufactured product:",t),new Error(`فشل في إنشاء المنتج المصنع: ${t.message}`)}}static async getAllManufacturedProducts(){try{console.log("📋 Loading all manufactured products...");const e=Vt(ct(De,this.COLLECTION_NAME),hs("createdAt","desc")),t=await St(e),s=[];return t.forEach(a=>{const l=a.data();s.push({id:a.id,internalId:l.internalId||Ct("MANUFACTURED_PRODUCT"),...l,createdAt:l.createdAt?.toDate?.()?.toISOString()||new Date().toISOString(),updatedAt:l.updatedAt?.toDate?.()?.toISOString()||new Date().toISOString()})}),console.log("✅ Loaded manufactured products:",s.length),s}catch(e){throw console.error("❌ Error loading manufactured products:",e),new Error(`فشل في تحميل المنتجات المصنعة: ${e.message}`)}}static async getManufacturedProductById(e){try{console.log("📋 Loading manufactured product:",e);const t=ut(De,this.COLLECTION_NAME,e),s=await cs(t);if(!s.exists())throw new Error("المنتج المصنع غير موجود");const a=s.data(),l={id:s.id,internalId:a.internalId||Ct("MANUFACTURED_PRODUCT"),...a,createdAt:a.createdAt?.toDate?.()?.toISOString()||new Date().toISOString(),updatedAt:a.updatedAt?.toDate?.()?.toISOString()||new Date().toISOString()};return console.log("✅ Loaded manufactured product:",l.title),l}catch(t){throw console.error("❌ Error loading manufactured product:",t),new Error(`فشل في تحميل المنتج المصنع: ${t.message}`)}}static async getManufacturedProductByInternalId(e){try{console.log("📋 Loading manufactured product by internal ID:",e);const t=Vt(ct(De,this.COLLECTION_NAME),jn("internalId","==",e)),s=await St(t);if(s.empty)throw new Error(`المنتج المصنع غير موجود: ${e}`);const a=s.docs[0],l=a.data(),c={id:a.id,internalId:l.internalId||e,...l,createdAt:l.createdAt?.toDate?.()?.toISOString()||new Date().toISOString(),updatedAt:l.updatedAt?.toDate?.()?.toISOString()||new Date().toISOString()};if(c.items&&Array.isArray(c.items)&&c.items.length>0){const u=c.items.reduce((m,p)=>m+(p.totalPrice||0),0);c.price=u}else c.price=c.estimatedValue||0;return c.name=c.title,c.category="منتج مصنع",c.unit="قطعة",c.supplier="منتج مصنع",console.log("✅ Loaded manufactured product by internal ID:",c.title),c}catch(t){throw console.error("❌ Error loading manufactured product by internal ID:",t),new Error(`فشل في تحميل المنتج المصنع: ${t.message}`)}}static async updateManufacturedProduct(e,t){try{console.log("📝 Updating manufactured product:",e);const s=ut(De,this.COLLECTION_NAME,e),a={...t,updatedAt:vt()};return await Xs(s,a),C4(),console.log("✅ Manufactured product updated successfully"),!0}catch(s){throw console.error("❌ Error updating manufactured product:",s),new Error(`فشل في تحديث المنتج المصنع: ${s.message}`)}}static async deleteManufacturedProduct(e){try{console.log("🗑️ Deleting manufactured product:",e);const t=ut(De,this.COLLECTION_NAME,e);return await Js(t),console.log("✅ Manufactured product deleted successfully"),!0}catch(t){throw console.error("❌ Error deleting manufactured product:",t),new Error(`فشل في حذف المنتج المصنع: ${t.message}`)}}static async searchManufacturedProducts(e){try{console.log("🔍 Searching manufactured products:",e);const t=await this.getAllManufacturedProducts();if(!e.trim())return t;const s=e.toLowerCase(),a=t.filter(l=>l.title?.toLowerCase().includes(s)||l.referenceNumber?.toLowerCase().includes(s)||l.description?.toLowerCase().includes(s)||l.category?.toLowerCase().includes(s)||l.entity?.toLowerCase().includes(s));return console.log("✅ Search results:",a.length),a}catch(t){throw console.error("❌ Error searching manufactured products:",t),new Error(`فشل في البحث عن المنتجات المصنعة: ${t.message}`)}}static async getManufacturedProductsByStatus(e){try{console.log("📋 Loading manufactured products by status:",e);const t=Vt(ct(De,this.COLLECTION_NAME),jn("status","==",e),hs("createdAt","desc")),s=await St(t),a=[];return s.forEach(l=>{const c=l.data();a.push({id:l.id,internalId:c.internalId||Ct("MANUFACTURED_PRODUCT"),...c,createdAt:c.createdAt?.toDate?.()?.toISOString()||new Date().toISOString(),updatedAt:c.updatedAt?.toDate?.()?.toISOString()||new Date().toISOString()})}),console.log("✅ Loaded manufactured products by status:",a.length),a}catch(t){throw console.error("❌ Error loading manufactured products by status:",t),new Error(`فشل في تحميل المنتجات المصنعة: ${t.message}`)}}static validateManufacturedProductData(e){const t={};return(!e.title||!e.title.trim())&&(t.title="اسم المنتج مطلوب"),(!e.referenceNumber||!e.referenceNumber.trim())&&(t.referenceNumber="رقم المرجع مطلوب"),(!e.entity||!e.entity.trim())&&(t.entity="الجهة المصنعة مطلوبة"),e.submissionDeadline||(t.submissionDeadline="تاريخ الإنتاج المتوقع مطلوب"),e.estimatedValue&&isNaN(parseFloat(e.estimatedValue))&&(t.estimatedValue="التكلفة التقديرية يجب أن تكون رقماً صحيحاً"),t}}const dC=Object.freeze(Object.defineProperty({__proto__:null,ManufacturedProductService:ac},Symbol.toStringTag,{value:"Module"}));function A4(){const[r,e]=N.useState(!1),{isTimelineVisible:t}=$n(),[s,a]=N.useState([]),[l,c]=N.useState([]),[u,m]=N.useState(!1),[p,b]=N.useState(null),[w,j]=N.useState(""),[D,O]=N.useState([]),[Q,z]=N.useState(!1),[I,ee]=N.useState([]),J=ms(),{tenderId:oe}=ea(),{logActivity:Y,getCurrentUser:be}=vn(),{alertConfig:M,closeAlert:H,showSuccess:k,showError:$}=Pn(),{formatDate:X}=yh(),te=()=>{e(!r)},F=(E,R)=>{console.log("🧠 SENIOR REACT: Starting advanced duplicate prevention analysis...");const V=[],ne=[],B=new Map,q=new Map;return E.forEach((me,C)=>{const Z=me.materialInternalId||me.internalId||me.id;Z&&B.set(Z,{item:me,index:C});const je=(me.materialName||me.name||me.title||"").trim();if(je){const Ge=je.toLowerCase();q.set(Ge,{item:me,index:C})}}),console.log("🧠 DUPLICATE PREVENTION MAPS:",{existingIdsCount:B.size,existingNamesCount:q.size}),R.forEach(me=>{const C=me.materialInternalId||me.internalId||me.id,Z=(me.materialName||me.name||me.title||"").trim(),je=Z.toLowerCase();let Ge=!1,Ke="",ft=null;C&&B.has(C)&&(Ge=!0,Ke="ID",ft=B.get(C).item,console.log(`🚨 ID DUPLICATE: ${Z} matches existing ID: ${C}`)),!Ge&&Z&&q.has(je)&&(Ge=!0,Ke="NAME",ft=q.get(je).item,console.log(`🚨 NAME DUPLICATE: "${Z}" matches existing name (case-insensitive)`)),Ge?V.push({newItem:me,existingItem:ft,type:Ke,displayName:Z||"بند غير محدد"}):(ne.push(me),console.log(`✅ UNIQUE ITEM: ${Z} - Adding to list`),C&&B.set(C,{item:me,index:-1}),Z&&q.set(je,{item:me,index:-1}))}),console.log("🧠 DUPLICATE ANALYSIS COMPLETE:",{totalNewItems:R.length,uniqueItemsFound:ne.length,duplicatesFound:V.length,duplicateDetails:V.map(me=>({name:me.displayName,type:me.type}))}),{duplicates:V,uniqueItems:ne}};N.useEffect(()=>{ce();const E=R=>{R.type==="manufacturedProductsUpdated"&&ce()};return window.addEventListener("storage",E),window.addEventListener("focus",ce),()=>{window.removeEventListener("storage",E),window.removeEventListener("focus",ce)}},[]),N.useEffect(()=>{if(w.trim()){const E=s.filter(R=>R.title?.toLowerCase().includes(w.toLowerCase())||R.referenceNumber?.toLowerCase().includes(w.toLowerCase())||R.description?.toLowerCase().includes(w.toLowerCase()));O(E)}else O(s)},[w,s]);const ce=async()=>{try{m(!0);const R=(await ac.getAllManufacturedProducts()).filter(V=>V.status!=="inactive");a(R),b(null)}catch(E){b(E.message)}finally{m(!1)}},Be=E=>{if(l.some(V=>V.internalId===E.internalId))c(V=>V.filter(ne=>ne.internalId!==E.internalId));else{const V={...E,type:"manufacturedProduct",quantity:1};c(ne=>[...ne,V])}},U=async()=>{if(l.length===0){$("يرجى اختيار منتج مصنع واحد على الأقل","لا توجد منتجات مختارة");return}const E=l.map(R=>{let V=0;return R.items&&Array.isArray(R.items)&&R.items.length>0?V=R.items.reduce((ne,B)=>ne+(B.totalPrice||0),0):V=R.estimatedValue||0,{...R,quantity:1,unitPrice:V,totalPrice:V,displaySupplier:"منتج مصنع"}});ee(E),z(!0)},se=(E,R)=>{const V=Math.max(.1,parseFloat(R)||.1),ne=parseFloat(V.toFixed(1));ee(B=>B.map(q=>q.id===E?{...q,quantity:ne,totalPrice:q.unitPrice*ne}:q))},fe=async()=>{try{if(!Array.isArray(I)||I.length===0){$("لا توجد منتجات مختارة للإضافة","خطأ في البيانات");return}const E=await rt.getPendingTenderItems()||[],R=I.map(C=>({...C,materialName:C.title,materialInternalId:C.internalId})),V=F(E,R),{duplicates:ne,uniqueItems:B}=V;if(ne.length>0){const C=ne.map(Z=>{const je=Z.type==="ID"?"معرف مطابق":"اسم مطابق";return`⚠️ "${Z.displayName}" (${je})`});$(`تم العثور على ${ne.length} بند مكرر. لن يتم إضافة البنود المكررة.

${C.join(`
`)}`,"بنود مكررة"),console.log("🚨 DUPLICATES BLOCKED:",{count:ne.length,names:ne.map(Z=>Z.displayName)});return}const q=[];for(const C of B)try{const Z={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:C.internalId,materialType:"manufacturedProduct",materialName:C.title,materialCategory:"منتج مصنع",materialUnit:"قطعة",quantity:C.quantity||1,unitPrice:C.unitPrice||0,totalPrice:(C.quantity||1)*(C.unitPrice||0),supplierInfo:"منتج مصنع",tenderId:oe==="new"?"new":oe,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};q.push(Z)}catch(Z){console.error("Error creating tender item:",Z),$(`فشل في إضافة المنتج: ${C.title}`,"خطأ في البيانات");return}const me=[...E,...q];await rt.setPendingTenderItems(me);try{const C=be();C&&C.name&&Y("task",`${C.name} أضاف منتجات مصنعة للمناقصة`,`تم إضافة ${q.length} منتج مصنع`)}catch(C){console.error("Failed to log activity:",C)}k(`تم إضافة ${q.length} منتج مصنع للمناقصة`,"تمت الإضافة"),window.dispatchEvent(new CustomEvent("tenderItemsAdded",{detail:{count:q.length,type:"manufacturedProduct",items:q}})),z(!1),ee([]),setTimeout(()=>{J(oe==="new"?"/tenders/add":`/tenders/edit/${oe}`)},100)}catch(E){console.error("Error in handleConfirmQuantities:",E),$("فشل في إضافة المنتجات المصنعة للمناقصة","خطأ في النظام")}},ie=()=>{z(!1),ee([])},_=()=>Math.round(I.reduce((E,R)=>E+R.totalPrice,0));return u?n.jsx(Dn,{show:!0,message:"جار تحميل بيانات المنتجات المصنعة...",overlay:!1}):p?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:p}),n.jsxs("button",{className:"btn btn-primary",onClick:ce,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Kn,{onToggle:te}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المناقصات"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"منتجات مصنعة"})]})}),n.jsx(Yn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"manufactured-products-table",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-tools text-warning me-2"}),"قائمة المنتجات المصنعة (",D.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المنتجات المصنعة...",value:w,onChange:E=>j(E.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),n.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:U,disabled:l.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["إضافة المحدد (",l.length,")"]}),n.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const E=oe!=="new"?`/tenders/edit/${oe}`:"/tenders/add";J(E)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:"العودة للمناقصة"})]})})]})}),n.jsx("div",{className:"card-body p-0",children:D.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-tools fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد منتجات مصنعة"}),n.jsx("p",{className:"text-muted",children:w?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي منتجات مصنعة بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",children:"اختيار"}),n.jsx("th",{className:"text-center",children:"اسم المنتج"}),n.jsx("th",{className:"text-center",children:"رقم المرجع"}),n.jsx("th",{className:"text-center",children:"التكلفة التقديرية"}),n.jsx("th",{className:"text-center",children:"تاريخ الإضافة"})]})}),n.jsx("tbody",{children:D.map(E=>{let R=0;return E.items&&Array.isArray(E.items)&&E.items.length>0?R=E.items.reduce((V,ne)=>V+(ne.totalPrice||0),0):R=E.estimatedValue||0,n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input",type:"checkbox",checked:l.some(V=>V.internalId===E.internalId),onChange:()=>Be(E),style:{transform:"scale(1.2)"}})})}),n.jsx("td",{className:"text-center",children:n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:V=>{V.preventDefault(),V.stopPropagation(),J(`/manufactured-products/edit/${E.id}`)},title:`تحرير المنتج المصنع: ${E.title}`,children:E.title})}),n.jsx("td",{className:"text-center",children:E.referenceNumber||"-"}),n.jsx("td",{className:"text-center",children:R?n.jsxs("span",{className:"badge bg-success text-white",children:[R.toLocaleString("en-US")," ر.س"]}):"-"}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"text-muted",children:X(E.submissionDeadline)})})]},E.id)})})]})})})]})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&t&&n.jsx(Xn,{rtl:!0}),!r&&t&&n.jsx(Jn,{})]}),Q&&n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-calculator me-2"}),"تحديد الكميات والأسعار"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:ie,"aria-label":"Close"})]}),n.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"30%"},children:"المنتج المصنع"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"السعر الأساسي"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"النوع"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"إجمالي السعر"})]})}),n.jsx("tbody",{children:I.map((E,R)=>n.jsxs("tr",{style:{height:"60px"},children:[n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:"bi bi-tools text-warning me-2"}),n.jsxs("div",{children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:V=>{V.preventDefault(),V.stopPropagation(),J(`/manufactured-products/edit/${E.id}`)},title:`تحرير المنتج المصنع: ${E.title}`,children:E.title}),n.jsx("small",{className:"text-muted",children:E.referenceNumber})]})]})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("span",{className:"fw-bold text-success",children:[Math.round(E.unitPrice)," ريال"]}),n.jsx("div",{children:n.jsx("small",{className:"text-muted",children:"/قطعة"})})]}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>se(E.id,E.quantity-.1),disabled:E.quantity<=.1,style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-dash"})}),n.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:E.quantity.toFixed(1),min:"0.1",step:"0.1",onChange:V=>se(E.id,V.target.value)}),n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>se(E.id,E.quantity+.1),style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-plus"})})]})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"badge bg-warning text-dark",children:"منتج مصنع"})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(E.totalPrice)," ريال"]}),n.jsxs("small",{className:"text-success",children:["(",E.quantity.toFixed(1)," × ",Math.round(E.unitPrice),")"]})]})]},E.id))})]})})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:n.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("span",{className:"text-muted me-3",children:"إجمالي الطلبية:"}),n.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[_()," ريال"]}),n.jsxs("span",{className:"badge bg-info ms-2",children:[I.reduce((E,R)=>E+R.quantity,0).toFixed(1)," قطعة"]})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:ie,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:fe,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"تأكيد"})]})]})})]})})}),n.jsx(Rn,{show:M.show,onClose:H,title:M.title,message:M.message,type:M.type,onConfirm:M.onConfirm,showConfirm:M.showConfirm})]})}function D4(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(A4,{})})})}const td="suppliers";class Ji{static async getAllSuppliers(){try{const e=ct(De,td);let t;try{t=Vt(e,hs("createdAt","desc"))}catch{console.log("Using query without orderBy for empty collection"),t=Vt(e)}const a=(await St(t)).docs.map(l=>{const c=l.data();return{id:l.id,internalId:c.internalId||Ct("LOCAL_SUPPLIER"),...c,createdAt:c.createdAt?.toDate(),updatedAt:c.updatedAt?.toDate()}});return a.length>0&&a[0].createdAt&&a.sort((l,c)=>(c.createdAt||new Date(0))-(l.createdAt||new Date(0))),a}catch(e){if(console.error("Error fetching suppliers:",e),e.code==="failed-precondition"||e.code==="not-found")return console.log("Suppliers collection not found, returning empty array"),[];throw new Error("فشل في تحميل الموردين")}}static async createSupplier(e){try{const t=Ct("LOCAL_SUPPLIER"),s={...e,internalId:t,createdAt:vt(),updatedAt:vt()};return(await Mr(ct(De,td),s)).id}catch(t){throw console.error("Error creating supplier:",t),new Error("فشل في إنشاء المورد")}}static async updateSupplier(e,t){try{const s=ut(De,td,e),a={...t,updatedAt:vt()};return await Xs(s,a),!0}catch(s){throw console.error("Error updating supplier:",s),new Error("فشل في تحديث بيانات المورد")}}static async getSupplierById(e){try{const t=ut(De,td,e),s=await cs(t);if(s.exists()){const a=s.data();return{id:s.id,internalId:a.internalId||Ct("LOCAL_SUPPLIER"),...a,createdAt:a.createdAt?.toDate(),updatedAt:a.updatedAt?.toDate()}}else return null}catch(t){throw console.error("Error fetching supplier by ID:",t),new Error("فشل في جلب بيانات المورد")}}static async getSupplierByInternalId(e){try{const t=ct(De,td),s=Vt(t,jn("internalId","==",e)),a=await St(s);if(a.empty)return null;{const l=a.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:c.createdAt?.toDate(),updatedAt:c.updatedAt?.toDate()}}}catch(t){throw console.error("Error fetching supplier by internal ID:",t),new Error("فشل في جلب بيانات المورد")}}static async updateSupplierByInternalId(e,t){try{const s=await this.getSupplierByInternalId(e);if(!s)throw new Error("Supplier not found");return await this.updateSupplier(s.id,t)}catch(s){throw console.error("Error updating supplier by internal ID:",s),new Error("فشل في تحديث بيانات المورد")}}static async deleteSupplier(e){try{const t=ut(De,td,e);return await Js(t),!0}catch(t){throw console.error("Error deleting supplier:",t),new Error("فشل في حذف المورد")}}static async deleteSupplierByInternalId(e){try{const t=await this.getSupplierByInternalId(e);if(!t)throw new Error("Supplier not found");return await this.deleteSupplier(t.id)}catch(t){throw console.error("Error deleting supplier by internal ID:",t),new Error("فشل في حذف المورد")}}static async searchSuppliers(e){try{const t=ct(De,td);return(await St(t)).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||Ct("LOCAL_SUPPLIER"),...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate()}}).filter(c=>c.name?.toLowerCase().includes(e.toLowerCase())||c.email?.toLowerCase().includes(e.toLowerCase())||c.phone?.includes(e))}catch(t){throw console.error("Error searching suppliers:",t),new Error("فشل في البحث عن الموردين")}}static async migrateExistingData(){try{console.log("Starting local suppliers migration...");const e=await this.getAllSuppliers();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("ls_")){const a=Ct("LOCAL_SUPPLIER");await this.updateSupplier(s.id,{...s,internalId:a}),t++,console.log(`Migrated local supplier: ${s.name} -> ${a}`)}return console.log(`Migration completed. ${t} local suppliers migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("فشل في ترحيل البيانات")}}static validateSupplierData(e){const t={};return e.name?.trim()||(t.name="اسم المورد مطلوب"),e.email?.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(t.email="صيغة البريد الإلكتروني غير صحيحة"):t.email="البريد الإلكتروني مطلوب",e.phone?.trim()||(t.phone="رقم الهاتف مطلوب"),t}}const R4=Object.freeze(Object.defineProperty({__proto__:null,SupplierService:Ji},Symbol.toStringTag,{value:"Module"})),$a="foreignSuppliers";class Zi{static async getAllForeignSuppliers(){return this.getAllSuppliers()}static async getAllSuppliers(){try{const e=ct(De,$a);let t;try{const a=Vt(e,hs("createdAt","desc"));t=await St(a,"getAllForeignSuppliers")}catch(a){console.log("OrderBy failed, using simple query:",a.message),t=await St(e,"getAllForeignSuppliers-simple")}const s=t.docs.map(a=>{const l=a.data();return{id:a.id,internalId:l.internalId||Ct("FOREIGN_SUPPLIER"),...l,createdAt:l.createdAt?.toDate?.()||new Date,updatedAt:l.updatedAt?.toDate?.()||new Date}});return s.length>0&&s[0].createdAt&&s.sort((a,l)=>(l.createdAt||new Date(0))-(a.createdAt||new Date(0))),s}catch(e){if(console.error("Error fetching foreign suppliers:",e),e.code==="failed-precondition"||e.code==="not-found")return console.log("Foreign suppliers collection not found, returning empty array"),[];throw new Error("فشل في تحميل الموردين الأجانب: "+e.message)}}static async getSupplierById(e){try{const t=await iC($a,e);if(!t)throw new Error("Foreign supplier not found");return{...t,internalId:t.internalId||Ct("FOREIGN_SUPPLIER"),createdAt:t.createdAt?.toDate?.()||new Date,updatedAt:t.updatedAt?.toDate?.()||new Date}}catch(t){throw console.error("Error fetching foreign supplier:",t),new Error("Failed to fetch foreign supplier: "+t.message)}}static async createSupplier(e){try{const t=this.validateSupplierData(e);if(Object.keys(t).length>0)throw new Error("Validation failed: "+Object.values(t).join(", "));const s=ct(De,$a),a=Ct("FOREIGN_SUPPLIER"),l={...e,internalId:a,createdAt:vt(),updatedAt:vt(),status:e.status||"active"};return{id:await rC($a,l),...l,createdAt:new Date,updatedAt:new Date}}catch(t){throw console.error("Error creating foreign supplier:",t),new Error("Failed to create foreign supplier: "+t.message)}}static async updateSupplier(e,t){try{const s=this.validateSupplierData(t);if(Object.keys(s).length>0)throw new Error("Validation failed: "+Object.values(s).join(", "));const a=ut(De,$a,e),l={...t,updatedAt:vt()};return await Xs(a,l,"updateForeignSupplier"),{id:e,...l,updatedAt:new Date}}catch(s){throw console.error("Error updating foreign supplier:",s),new Error("Failed to update foreign supplier: "+s.message)}}static async getSupplierByInternalId(e){try{const t=ct(De,$a),s=Vt(t,jn("internalId","==",e)),a=await St(s,"getForeignSupplierByInternalId");if(a.empty)return null;{const l=a.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:c.createdAt?.toDate?.()||new Date,updatedAt:c.updatedAt?.toDate?.()||new Date}}}catch(t){throw console.error("Error fetching foreign supplier by internal ID:",t),new Error("Failed to fetch foreign supplier by internal ID: "+t.message)}}static async updateSupplierByInternalId(e,t){try{const s=await this.getSupplierByInternalId(e);if(!s)throw new Error("Foreign supplier not found");return await this.updateSupplier(s.id,t)}catch(s){throw console.error("Error updating foreign supplier by internal ID:",s),new Error("Failed to update foreign supplier by internal ID: "+s.message)}}static async deleteSupplier(e){try{const t=ut(De,$a,e);return await Js(t,"deleteForeignSupplier"),{success:!0,message:"Foreign supplier deleted successfully"}}catch(t){throw console.error("Error deleting foreign supplier:",t),new Error("Failed to delete foreign supplier: "+t.message)}}static async deleteSupplierByInternalId(e){try{const t=await this.getSupplierByInternalId(e);if(!t)throw new Error("Foreign supplier not found");return await this.deleteSupplier(t.id)}catch(t){throw console.error("Error deleting foreign supplier by internal ID:",t),new Error("Failed to delete foreign supplier by internal ID: "+t.message)}}static async getSuppliersByStatus(e){try{const t=ct(De,$a),s=Vt(t,jn("status","==",e),hs("createdAt","desc"));return(await St(s,"getForeignSuppliersByStatus")).docs.map(l=>{const c=l.data();return{id:l.id,internalId:c.internalId||Ct("FOREIGN_SUPPLIER"),...c,createdAt:c.createdAt?.toDate?.()||new Date,updatedAt:c.updatedAt?.toDate?.()||new Date}})}catch(t){throw console.error("Error fetching foreign suppliers by status:",t),new Error("Failed to fetch foreign suppliers by status: "+t.message)}}static async searchSuppliers(e){try{const t=ct(De,$a),a=(await St(t,"searchForeignSuppliers")).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||Ct("FOREIGN_SUPPLIER"),...u,createdAt:u.createdAt?.toDate?.()||new Date,updatedAt:u.updatedAt?.toDate?.()||new Date}});if(!e||e.trim()==="")return a;const l=e.toLowerCase();return a.filter(c=>c.name?.toLowerCase().includes(l)||c.email?.toLowerCase().includes(l)||c.phone?.includes(e)||c.city?.toLowerCase().includes(l)||c.address?.toLowerCase().includes(l))}catch(t){throw console.error("Error searching foreign suppliers:",t),new Error("Failed to search foreign suppliers: "+t.message)}}static validateSupplierData(e){const t={};return(!e.name||e.name.trim()==="")&&(t.name="Company name is required"),!e.email||e.email.trim()===""?t.email="Email is required":this.validateEmail(e.email)||(t.email="Please enter a valid email address"),(!e.phone||e.phone.trim()==="")&&(t.phone="Phone number is required"),e.email&&!this.validateEmail(e.email)&&(t.email="Please enter a valid email address"),e.name&&e.name.length<2&&(t.name="Company name must be at least 2 characters long"),e.phone&&e.phone.length<10&&(t.phone="Phone number must be at least 10 digits long"),t}static validateEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static async uploadDocument(e,t,s="general"){try{if(!t)throw new Error("No file provided");const a=`${Date.now()}_${t.name}`,l=Qo(ri,`foreign-suppliers/${e}/documents/${s}/${a}`),c=await ex(l,t),u=await Jm(c.ref);return{fileName:t.name,url:u,type:s,uploadedAt:new Date,size:t.size}}catch(a){throw console.error("Error uploading document:",a),new Error("Failed to upload document: "+a.message)}}static async deleteDocument(e){try{const t=Qo(ri,e);return await Vx(t),{success:!0,message:"Document deleted successfully"}}catch(t){throw console.error("Error deleting document:",t),new Error("Failed to delete document: "+t.message)}}static async migrateExistingData(){try{console.log("Starting foreign suppliers migration...");const e=await this.getAllSuppliers();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("fs_")){const a=Ct("FOREIGN_SUPPLIER");await this.updateSupplier(s.id,{...s,internalId:a}),t++,console.log(`Migrated foreign supplier: ${s.name} -> ${a}`)}return console.log(`Migration completed. ${t} foreign suppliers migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("Failed to migrate foreign suppliers: "+e.message)}}static async getSupplierStats(){try{const e=ct(De,$a),s=(await St(e,"getForeignSupplierStats")).docs.map(a=>a.data());return{total:s.length,active:s.filter(a=>a.status==="active").length,inactive:s.filter(a=>a.status==="inactive").length,pending:s.filter(a=>a.status==="pending").length,byCity:s.reduce((a,l)=>{const c=l.city||"Unknown";return a[c]=(a[c]||0)+1,a},{})}}catch(e){throw console.error("Error fetching foreign supplier stats:",e),new Error("Failed to fetch foreign supplier statistics: "+e.message)}}}const P4=Object.freeze(Object.defineProperty({__proto__:null,ForeignSupplierService:Zi},Symbol.toStringTag,{value:"Module"})),k4=({refreshTrigger:r})=>{const[e,t]=N.useState([]),[s,a]=N.useState(!0),[l,c]=N.useState(null),[u,m]=N.useState(""),[p,b]=N.useState([]),[w,j]=N.useState(!1),[D,O]=N.useState(!1),[Q,z]=N.useState(!1),[I,ee]=N.useState(null),[J,oe]=N.useState([]),[Y,be]=N.useState([]),[M,H]=N.useState([]),k=ms(),$=il(),{logActivity:X,getCurrentUser:te}=vn(),{alertConfig:F,closeAlert:ce,showSuccess:Be,showError:U,showConfirm:se}=Pn(),fe=$.state?.fromTender||!1,ie=$.state?.tenderData||null,{currentPage:_,totalPages:E,paginatedItems:R,handlePageChange:V,resetPage:ne,totalItems:B,itemsPerPage:q}=wa(p,30);N.useEffect(()=>{me(),C();const Ee=hn=>{hn.key==="rawMaterials_updated"&&me()},it=()=>{me()};window.addEventListener("storage",Ee),window.addEventListener("rawMaterialsUpdated",it);const Nt=()=>{me()};return window.addEventListener("focus",Nt),()=>{window.removeEventListener("storage",Ee),window.removeEventListener("rawMaterialsUpdated",it),window.removeEventListener("focus",Nt)}},[]),N.useEffect(()=>{r&&me()},[r]),N.useEffect(()=>{if(u.trim()){console.log("Searching for:",u),console.log("Total materials before filter:",e.length);const Ee=e.filter(it=>it.name?.toLowerCase().includes(u.toLowerCase())||it.category?.toLowerCase().includes(u.toLowerCase())||it.description?.toLowerCase().includes(u.toLowerCase())||it.supplier?.toLowerCase().includes(u.toLowerCase()));console.log("Filtered materials:",Ee.length),console.log("First filtered material:",Ee[0]),b(Ee)}else console.log("No search term, showing all materials:",e.length),b(e);ne()},[u,e,ne]);const me=async()=>{try{a(!0);const Ee=await wr.getAllRawMaterials();t(Ee),c(null)}catch(Ee){c(Ee.message)}finally{a(!1)}},C=async()=>{try{const[Ee,it]=await Promise.all([Ji.getAllSuppliers(),Zi.getAllSuppliers()]);oe(Ee),be(it)}catch(Ee){console.error("Error loading suppliers:",Ee)}},Z=async(Ee,it)=>{try{if(it==="local"){const Nt=J.find(hn=>hn.name===Ee);Nt&&(ee(Nt),O(!0))}else if(it==="foreign"){const Nt=Y.find(hn=>hn.name===Ee);Nt&&(ee(Nt),z(!0))}}catch(Nt){console.error("Error opening supplier modal:",Nt)}},je=()=>{O(!1),z(!1),ee(null)},Ge=Ee=>{se(`هل أنت متأكد من حذف هذه المادة الخام؟

${Ee.name}`,()=>Ke(Ee),"تأكيد حذف المادة الخام")},Ke=async Ee=>{try{j(!0),await Gn.moveToTrash(Ee,"rawmaterials"),await wr.deleteRawMaterial(Ee.id);const it=te();X("task",`${it.name} حذف مادة خام`,`تم حذف المادة الخام: ${Ee.name}`),await me(),Be(`تم نقل المادة الخام للمهملات: ${Ee.name}`,"تم النقل للمهملات")}catch(it){c(it.message),U(`فشل في نقل المادة الخام للمهملات: ${it.message}`,"خطأ في النقل")}finally{j(!1)}},ft=Ee=>{if(M.some(Nt=>Nt.internalId===Ee.internalId))H(Nt=>Nt.filter(hn=>hn.internalId!==Ee.internalId));else{const Nt={...Ee,type:"rawMaterials",quantity:1};H(hn=>[...hn,Nt])}},Ot=async()=>{const Ee=M.map(Nt=>({internalId:Nt.internalId,type:"rawMaterials",quantity:Nt.quantity||1,addedAt:new Date().toISOString()}));await rt.setPendingTenderItems(Ee);const it=ie?.id?`/tenders/edit/${ie.id}`:"/tenders/add";k(it,{state:{selectedItems:Ee,fromSelection:!0}})};return s?n.jsx(Dn,{show:!0,message:"جار تحميل بيانات المواد الخام...",overlay:!1}):l?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:l}),n.jsxs("button",{className:"btn btn-primary",onClick:me,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs("div",{className:"card shadow-sm","data-list":"raw-materials",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),"قائمة المواد الخام (",p.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المواد الخام...",value:u,onChange:Ee=>m(Ee.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),fe?n.jsxs(n.Fragment,{children:[n.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:Ot,disabled:M.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-check-circle-fill me-2"}),"إضافة المحدد (",M.length,")"]}),n.jsxs("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const Ee=ie?.id?`/tenders/edit/${ie.id}`:"/tenders/add";k(Ee)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-arrow-left me-2"}),"العودة للمناقصة"]})]}):n.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:()=>k("/raw-materials/add"),style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"إضافة مادة خام جديدة"]})]})})]})}),n.jsxs("div",{className:"card-body p-0",children:[p.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-box-seam fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد مواد خام"}),n.jsx("p",{className:"text-muted",children:u?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي مواد خام بعد"}),!u&&n.jsxs("button",{className:"btn btn-primary",onClick:()=>k("/raw-materials/add"),children:[n.jsx("i",{className:"bi bi-plus-lg me-1"}),"إضافة أول مادة خام"]})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"اسم المادة"}),n.jsx("th",{className:"text-center",children:"الفئة"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر"}),n.jsx("th",{className:"text-center",children:"المورد"}),n.jsx("th",{className:"text-center",style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:R.map((Ee,it)=>{let Nt=Ee.price,hn=Ee.supplier,xn=!1,is=null,Un=null;return Ee.priceQuotes&&Array.isArray(Ee.priceQuotes)&&Ee.priceQuotes.length>0&&(xn=!0,Un=Ee.priceQuotes.reduce((Xt,yn)=>{const Zn=parseFloat(Xt.price)||0;return(parseFloat(yn.price)||0)<Zn?yn:Xt}),Nt=Un.price,hn=Un.supplierName,is=Un.supplierType),n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(_-1)*q+it+1})}),n.jsx("td",{className:"text-center",children:n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary material-name-btn",onClick:Xt=>{if(Xt.preventDefault(),Xt.stopPropagation(),console.log("=== MATERIAL BUTTON CLICKED ==="),console.log("Material Name:",Ee.name),console.log("Material ID:",Ee.id),console.log("Material Object:",Ee),console.log("Navigate function:",typeof k),Ee.id){const yn=`/raw-materials/edit/${Ee.id}`;console.log("Target URL:",yn),console.log("Attempting navigation..."),console.log("🚀 FORCING NAVIGATION TO:",yn),console.log("✅ Method 1: Direct window.location"),window.location.href=yn;try{console.log("✅ Method 2: React Router navigate"),k(yn)}catch(Zn){console.log("❌ React Router failed:",Zn)}console.log("🎯 NAVIGATION FORCED - Should redirect immediately!")}else console.error("Material ID is missing:",Ee),U("معرف المادة مفقود، لا يمكن التنقل","خطأ في التنقل");console.log("=== END CLICK HANDLER ===")},onMouseDown:Xt=>Xt.preventDefault(),style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0",userSelect:"none",pointerEvents:"auto",zIndex:"1"},title:`انقر للتعديل | Internal ID: ${Ee.internalId||"Not Set"} | Firebase ID: ${Ee.id||"Missing"}`,children:Ee.name})}),n.jsx("td",{className:"text-center",children:Ee.category||"-"}),n.jsx("td",{className:"text-center",children:Ee.unit||"-"}),n.jsx("td",{className:"text-center",children:Nt?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsxs("span",{children:[Nt," ريال"]}),xn&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}):"-"}),n.jsx("td",{className:"text-center",children:hn?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[xn&&is?n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",onClick:()=>Z(hn,is),style:{textDecoration:"none"},title:`فتح تفاصيل ${is==="local"?"المورد المحلي":"المورد الأجنبي"}`,children:hn}):n.jsx("span",{children:hn}),xn&&n.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:"أقل مورد"})]}):"-"}),n.jsx("td",{className:"text-center",children:fe?n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input",type:"checkbox",checked:M.some(Xt=>Xt.internalId===Ee.internalId),onChange:()=>ft(Ee),style:{transform:"scale(1.2)"}})}):n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>k(`/raw-materials/edit/${Ee.id}`),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>Ge(Ee),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},Ee.internalId||Ee.id)})})]})}),p.length>0&&n.jsx(va,{currentPage:_,totalPages:E,onPageChange:V,totalItems:B,itemsPerPage:q})]}),D&&I&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:Ee=>{Ee.target===Ee.currentTarget&&je()},children:n.jsx("div",{className:"modal-dialog modal-lg",onClick:Ee=>Ee.stopPropagation(),children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"معلومات المورد - ",I.name,n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:"محلي"})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:je})]}),n.jsx("div",{className:"modal-body",children:n.jsxs("div",{className:"row g-3",children:[n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"اسم المورد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.name})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البريد الإلكتروني"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.email||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الهاتف"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:I.phone||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"المدينة"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.city||""})]}),n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"العنوان"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.address||""})]}),I.taxNumber&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"الرقم الضريبي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.taxNumber})]}),I.bankAccount&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الحساب البنكي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.bankAccount})]}),I.notes&&n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"ملاحظات"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.notes})]})]})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:je,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إغلاق"})})]})})}),Q&&I&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:Ee=>{Ee.target===Ee.currentTarget&&je()},children:n.jsx("div",{className:"modal-dialog modal-lg",onClick:Ee=>Ee.stopPropagation(),children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"معلومات المورد - ",I.name,n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:"أجنبي"})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:je})]}),n.jsx("div",{className:"modal-body",children:n.jsxs("div",{className:"row g-3",children:[n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"اسم المورد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.name})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البريد الإلكتروني"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.email||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الهاتف"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:I.phone||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البلد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.country||""})]}),n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"العنوان"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.address||""})]}),I.taxNumber&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"الرقم الضريبي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.taxNumber})]}),I.bankAccount&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الحساب البنكي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.bankAccount})]}),I.notes&&n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"ملاحظات"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.notes})]})]})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:je,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إغلاق"})})]})})}),n.jsx(Rn,{show:F.show,onClose:ce,title:F.title,message:F.message,type:F.type,onConfirm:F.onConfirm,confirmText:F.confirmText,cancelText:F.cancelText,showCancel:F.showCancel})]})};function O4(){const[r,e]=N.useState(!1),[t,s]=N.useState(0),{isTimelineVisible:a}=$n(),l=()=>{e(!r)};return n.jsx(sn,{children:n.jsx(rn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Kn,{onToggle:l}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!a?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المناقصات"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"مواد خام"})]})}),n.jsx(Yn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"raw-materials-table",children:n.jsx(k4,{refreshTrigger:t})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&a&&n.jsx(Xn,{rtl:!0}),!r&&a&&n.jsx(Jn,{})]})})})}function M4(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(O4,{})})})}const L4={logo:()=>K1,logoSm:()=>Y1,user:()=>X1,pdfIcon:()=>J1,menuArrow:()=>Z1},qx=({size:r=32,clickable:e=!1,onClick:t=null,title:s="PDF",className:a="",style:l={}})=>{const c={width:`${r}px`,height:`${r}px`,objectFit:"contain",...e&&{cursor:"pointer"},...l},u=m=>{e&&t&&(m.preventDefault(),t(m))};return n.jsx("img",{src:L4.pdfIcon(),alt:"PDF",title:s,className:a,style:c,onClick:u})},Hx=N.memo(({value:r="",onChange:e,onBlur:t,name:s="category",required:a=!1,disabled:l=!1,placeholder:c="اختر الفئة",className:u="form-select",style:m={},showDescription:p=!1,"data-testid":b,...w})=>{const{categoriesWithDetails:j,loading:D,error:O,isReady:Q}=q5(),z=N.useMemo(()=>Q?j.map(I=>({value:I.value,label:I.label,description:I.description,isDefault:I.isDefault})):[],[j,Q]);return D?n.jsx("select",{className:u,style:m,disabled:!0,...w,children:n.jsx("option",{value:"",children:"جاري تحميل الفئات..."})}):O?n.jsxs("div",{children:[n.jsx("select",{className:`${u} is-invalid`,style:m,disabled:!0,...w,children:n.jsx("option",{value:"",children:"خطأ في تحميل الفئات"})}),n.jsx("div",{className:"invalid-feedback",children:O})]}):!Q||z.length===0?n.jsxs("div",{children:[n.jsx("select",{className:u,style:m,disabled:!0,...w,children:n.jsx("option",{value:"",children:"لا توجد فئات متاحة"})}),n.jsx("small",{className:"form-text text-muted",children:"يرجى إضافة فئات من صفحة الإعدادات"})]}):n.jsxs("div",{children:[n.jsxs("select",{name:s,value:r,onChange:e,onBlur:t,required:a,disabled:l,className:u,style:m,"data-testid":b,"aria-label":"اختيار الفئة",...w,children:[n.jsx("option",{value:"",children:c}),z.map(I=>n.jsx("option",{value:I.value,title:p&&I.description?I.description:void 0,children:I.label},I.value))]}),Q&&n.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-1",children:[n.jsxs("small",{className:"form-text text-muted",children:[z.length," فئة متاحة"]}),n.jsxs("small",{className:"form-text text-success",style:{fontSize:"10px"},children:[n.jsx("i",{className:"bi bi-wifi me-1"}),"متصل"]})]})]})});Hx.displayName="GlobalCategorySelect";const Gx=N.memo(({value:r="",onChange:e,onBlur:t,name:s="unit",required:a=!1,disabled:l=!1,placeholder:c="اختر الوحدة",className:u="form-select",style:m={},showDescription:p=!1,"data-testid":b,...w})=>{const{unitsWithDetails:j,loading:D,error:O,isReady:Q}=H5(),z=N.useMemo(()=>Q?j.map(I=>({value:I.name,label:I.name,description:I.description,isDefault:I.isDefault})):[],[j,Q]);return D?n.jsx("select",{className:u,style:m,disabled:!0,...w,children:n.jsx("option",{value:"",children:"جاري تحميل الوحدات..."})}):O?n.jsxs("div",{children:[n.jsx("select",{className:`${u} is-invalid`,style:m,disabled:!0,...w,children:n.jsx("option",{value:"",children:"خطأ في تحميل الوحدات"})}),n.jsx("div",{className:"invalid-feedback",children:O})]}):!Q||z.length===0?n.jsxs("div",{children:[n.jsx("select",{className:u,style:m,disabled:!0,...w,children:n.jsx("option",{value:"",children:"لا توجد وحدات متاحة"})}),n.jsx("small",{className:"form-text text-muted",children:"يرجى إضافة وحدات من صفحة الإعدادات"})]}):n.jsxs("div",{children:[n.jsxs("select",{name:s,value:r,onChange:e,onBlur:t,required:a,disabled:l,className:u,style:m,"data-testid":b,"aria-label":"اختيار الوحدة",...w,children:[n.jsx("option",{value:"",children:c}),z.map(I=>n.jsx("option",{value:I.value,title:p&&I.description?I.description:void 0,children:I.label},I.value))]}),Q&&n.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-1",children:[n.jsxs("small",{className:"form-text text-muted",children:[z.length," وحدة متاحة"]}),n.jsxs("small",{className:"form-text text-success",style:{fontSize:"10px"},children:[n.jsx("i",{className:"bi bi-wifi me-1"}),"متصل"]})]})]})});Gx.displayName="GlobalUnitSelect";const Qx=N.memo(({position:r="bottom-right",showDetails:e=!1,className:t="",style:s={}})=>{const{isReady:a,loading:l,lastUpdated:c}=Hf(),u=l?.categories||l?.units||!1,p=r?{"top-right":{position:"fixed",top:"80px",right:"20px",zIndex:1040},"bottom-right":{position:"fixed",bottom:"20px",right:"20px",zIndex:1040},"top-left":{position:"fixed",top:"80px",left:"20px",zIndex:1040},"bottom-left":{position:"fixed",bottom:"20px",left:"20px",zIndex:1040}}[r]:{},b=typeof a=="function"?a():a;return n.jsxs("div",{className:`badge ${b?"bg-success":u?"bg-warning":"bg-danger"} ${t}`,style:{...p,...s},children:[n.jsx("i",{className:`bi ${b?"bi-wifi":u?"bi-arrow-clockwise":"bi-wifi-off"} me-1`}),b?"الإعدادات متصلة":u?"جاري التحميل...":"غير متصل",e&&c?.categories&&n.jsxs("div",{className:"mt-1",style:{fontSize:"10px"},children:["آخر تحديث: ",new Date(c.categories).toLocaleTimeString("ar")]})]})});Qx.displayName="SettingsSyncStatus";const F4=N.memo(({showSettingsLink:r=!0,showRefreshButton:e=!0,size:t="sm",className:s="d-flex gap-2",style:a={}})=>{const{forceRefresh:l,isReady:c}=Hf(),u=()=>{l&&l()};return n.jsxs("div",{className:s,style:a,children:[e&&n.jsx("button",{type:"button",className:`btn btn-outline-primary btn-${t}`,onClick:u,disabled:!(typeof c=="function"?c():c),title:"تحديث الإعدادات",children:n.jsx("i",{className:"bi bi-arrow-clockwise"})}),r&&n.jsx("a",{href:"/settings",className:`btn btn-outline-secondary btn-${t}`,title:"إدارة الإعدادات",children:n.jsx("i",{className:"bi bi-gear"})})]})});F4.displayName="SettingsQuickActions";const U4=N.memo(()=>{const{categories:r,units:e,loading:t,error:s,initialized:a,lastUpdated:l,isReady:c}=Hf();return null});U4.displayName="SettingsStatusPanel";function V4(){const[r,e]=N.useState(!1),{isTimelineVisible:t}=$n(),[s,a]=N.useState({name:"",category:"",description:"",unit:"",price:"",supplier:"",stockQuantity:"",minimumStock:"",storageConditions:"",expiryDate:"",batchNumber:"",origin:"",notes:"",active:!0}),[l,c]=N.useState({}),[u,m]=N.useState(!1),[p,b]=N.useState(!1),[w,j]=N.useState(!1),[D,O]=N.useState(!1),[Q,z]=N.useState(null),[I,ee]=N.useState(!1),[J,oe]=N.useState(null),[Y,be]=N.useState({supplierType:"local",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),[M,H]=N.useState(null),[k,$]=N.useState([]),[X,te]=N.useState([]),[F,ce]=N.useState([]),[Be,U]=N.useState(!1),{alertConfig:se,closeAlert:fe,showSuccess:ie,showError:_,showConfirm:E}=Pn(),R=T=>{if(T.length===0)return;const re=T.reduce((he,de)=>{const xe=parseFloat(he.price)||0;return(parseFloat(de.price)||0)<xe?de:he});a(he=>({...he,price:re.price,supplier:re.supplierName}))},V=ms(),{id:ne}=ea(),B=!!ne,{logActivity:q,getCurrentUser:me}=vn();N.useMemo(()=>F.map(T=>({...T,formattedPrice:`${T.price} ريال`,formattedDate:new Date(T.date).toLocaleDateString("ar-SA")})),[F]),N.useMemo(()=>F.length===0?null:F.reduce((T,re)=>{const he=parseFloat(T.price)||0;return(parseFloat(re.price)||0)<he?re:T}),[F]);const C=()=>{e(!r)};N.useEffect(()=>{B&&je(),Z();const T=()=>{B&&ne&&(console.log("Window focused - refreshing raw material data..."),je())};return window.addEventListener("focus",T),()=>{window.removeEventListener("focus",T)}},[ne]),N.useEffect(()=>{console.log("PriceQuoteData changed:",{hasFile:!!Y.quotationFile,fileName:Y.quotationFile?.name,supplierName:Y.supplierName,price:Y.price})},[Y]);const Z=async()=>{try{const[T,re]=await Promise.all([Ji.getAllSuppliers(),Zi.getAllSuppliers()]);$(T),te(re)}catch(T){console.error("Error loading suppliers:",T)}},je=async()=>{try{b(!0),console.log("Loading raw material data for ID:",ne);const T=await wr.getAllRawMaterials(),re=T.find(he=>he.id===ne);re?(console.log("Raw material found:",re.name),a({name:re.name||"",category:re.category||"",description:re.description||"",unit:re.unit||"",price:re.price||"",supplier:re.supplier||"",stockQuantity:re.stockQuantity||"",minimumStock:re.minimumStock||"",storageConditions:re.storageConditions||"",expiryDate:re.expiryDate||"",batchNumber:re.batchNumber||"",origin:re.origin||"",notes:re.notes||"",active:re.active!==void 0?re.active:!0}),re.priceQuotes&&Array.isArray(re.priceQuotes)?(console.log("Loading price quotes for raw material:",re.name,re.priceQuotes),console.log("Price quotes analysis:"),re.priceQuotes.forEach((he,de)=>{console.log(`Quote ${de}:`,{id:he.id,supplierName:he.supplierName,price:he.price,hasId:!!he.id,keys:Object.keys(he)})}),ce(re.priceQuotes),setTimeout(()=>{R(re.priceQuotes)},200)):console.log("No price quotes found for raw material:",re.name)):(console.error("Raw material not found with ID:",ne),console.log("Available raw materials:",T.map(he=>({id:he.id,name:he.name}))),c({submit:"المادة الخام غير موجودة أو تم حذفها"}))}catch(T){console.error("Error loading raw material:",T),c({submit:"فشل في تحميل بيانات المادة الخام: "+T.message})}finally{b(!1)}},Ge=T=>{const{name:re,value:he,type:de,checked:xe}=T.target;a(Ue=>({...Ue,[re]:de==="checkbox"?xe:he})),l[re]&&c(Ue=>({...Ue,[re]:""}))},Ke=async T=>{T.preventDefault();const re=wr.validateRawMaterialData(s);if(F.length===0&&(re.priceQuotes="يجب إضافة عرض سعر واحد على الأقل"),Object.keys(re).length>0){c(re);return}m(!0),c({});try{const he=await oo.validateUniqueFields({name:s.name},B?ne:null,B?"rawmaterials":null);if(Object.keys(he).length>0){c(he),m(!1);return}const de={...s,price:parseFloat(s.price)||0,stockQuantity:parseFloat(s.stockQuantity)||0,minimumStock:parseFloat(s.minimumStock)||0,priceQuotes:F,status:"active"};if(console.log("Saving raw material with price quotes:",{name:de.name,priceQuotes:de.priceQuotes,priceQuotesCount:de.priceQuotes.length}),B){await wr.updateRawMaterial(ne,de);const xe=me();q("task",`${xe.name} عدل مادة خام`,`تم تعديل المادة الخام: ${de.name}`)}else{await wr.createRawMaterial(de);const xe=me();q("task",`${xe.name} أضاف مادة خام`,`تم إضافة المادة الخام: ${de.name}`)}V("/raw-materials")}catch(he){c({submit:he.message})}finally{m(!1)}},ft=()=>{V("/raw-materials")},Ot=()=>{j(!0)},Ee=()=>{j(!1),H(null),be({supplierType:"local",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),c(T=>({...T,fileUpload:""})),console.log("Modal closed and state reset")},it=()=>{O(!0)},Nt=()=>{O(!1),z(null)},hn=N.useCallback((T,re)=>{try{let he=null,de=[];if(re==="local")de=k,he=de.find(xe=>xe.name===T);else if(re==="foreign")de=X,he=de.find(xe=>xe.name===T);else{console.error("Invalid supplier type:",re),_(`نوع مورد غير صحيح: ${re}`,"خطأ");return}if(he){console.log("SUCCESS: Supplier found:",he.name),console.log("Supplier data:",he);const xe={...he,supplierType:re};console.log("Setting supplier to edit:",xe),oe(xe),ee(!0),console.log("Modal state should be true now")}else de.length===0?(loadSuppliersData(),_("لا توجد بيانات موردين. جار إعادة التحميل...","لا توجد بيانات")):_(`لم يتم العثور على المورد: ${T}`,"مورد غير موجود")}catch(he){_(`خطأ في البحث عن المورد: ${he.message}`,"خطأ في البحث")}},[k,X,_]),xn=()=>{ee(!1),oe(null)},is=T=>{z(T)},Un=()=>{Q&&be(T=>{console.log("Before supplier selection - preserving file:",T.quotationFile?.name);const re={...T,supplier:Q.id,supplierName:Q.name};return console.log("After supplier selection - file preserved:",re.quotationFile?.name),re}),O(!1),z(null)},Xt=T=>{console.log("File details:",{name:T?.name,size:T?.size,type:T?.type,lastModified:T?.lastModified}),l.fileUpload&&c(re=>({...re,fileUpload:""})),be(re=>{const he={...re,quotationFile:T};return console.log("Updated priceQuoteData with file:",{hasFile:!!he.quotationFile,fileName:he.quotationFile?.name}),he})},yn=T=>{const{name:re,value:he,type:de}=T.target;de!=="file"&&be(re==="supplierType"?xe=>({...xe,[re]:he,supplier:"",supplierName:""}):xe=>({...xe,[re]:he}))},Zn=async T=>{if(T.preventDefault(),console.log("Form element:",T.target),console.log("Current priceQuoteData:",Y),console.log("Editing quote ID:",M),!Y.supplierName){c(xe=>({...xe,fileUpload:"يجب اختيار المورد أولاً"}));return}if(!Y.date){c(xe=>({...xe,fileUpload:"يجب إدخال تاريخ العرض"}));return}if(!Y.price){c(xe=>({...xe,fileUpload:"يجب إدخال السعر"}));return}const re=new FormData(T.target),he=re.get("quotationFile");console.log("File from form directly:",he),console.log("File from state:",Y.quotationFile);const de=Y.quotationFile||he;console.log("File to upload:",de),console.log("File upload details:",{exists:!!de,isFile:de instanceof File,name:de?.name,size:de?.size,type:de?.type,lastModified:de?.lastModified});try{if(m(!0),!M&&(!de||de.size===0))throw new Error("يجب اختيار ملف عرض السعر");let xe=null;if(console.log("File upload analysis:",{hasFileInState:!!Y.quotationFile,hasFileInForm:!!he,hasFileToUpload:!!de,fileType:typeof de,fileName:de?.name,fileSize:de?.size}),de&&typeof de!="string"&&de.size>0){console.log("Starting file upload:",de.name);try{_r.validateFile(de,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}),console.log("File validation passed")}catch(Ue){throw console.error("File validation failed:",Ue),new Error(Ue.message)}console.log("Attempting file upload to Firebase...");try{const Ue=de.name.split(".").pop()||"pdf",bt=Y.supplierName?`عرض سعر ${Y.supplierName}.${Ue}`:de.name;console.log("Uploading with custom name:",bt),xe=await _r.uploadFileWithCustomName(de,"quotations",bt),console.log("File uploaded successfully:",xe)}catch(Ue){throw console.error("Firebase upload failed:",Ue),new Error(`فشل في رفع الملف: ${Ue.message}`)}}else console.log("No valid file to upload:",{fileExists:!!de,isString:typeof de=="string",hasSize:de?.size>0});if(M)console.log("Updating existing price quote with ID:",M),ce(Ue=>{const bt=Ue.map(pt=>pt.id===M?{...pt,supplierType:Y.supplierType,supplier:Y.supplier,supplierName:Y.supplierName,date:Y.date,price:Y.price,quotationFile:xe?xe.path:pt.quotationFile,quotationFileURL:xe?xe.url:pt.quotationFileURL,quotationFileName:xe?xe.originalName:pt.quotationFileName,quotationFileSize:xe?xe.size:pt.quotationFileSize,quotationFileType:xe?xe.type:pt.quotationFileType,updatedAt:new Date}:pt);return console.log("Updated price quotes:",bt),setTimeout(()=>{R(bt)},100),bt});else{const Ue={id:Date.now().toString(),supplierType:Y.supplierType,supplier:Y.supplier,supplierName:Y.supplierName,date:Y.date,price:Y.price,quotationFile:xe?xe.path:null,quotationFileURL:xe?xe.url:null,quotationFileName:xe?xe.originalName:null,quotationFileSize:xe?xe.size:null,quotationFileType:xe?xe.type:null,createdAt:new Date};console.log("Adding new price quote:",Ue),ce(bt=>{const pt=[...bt,Ue];return console.log("Updated price quotes:",pt),setTimeout(()=>{R(pt)},100),pt})}l.priceQuotes&&c(Ue=>({...Ue,priceQuotes:""})),Ee(),B&&ne&&setTimeout(async()=>{try{console.log("Auto-saving raw material after price quote change..."),ce(Ue=>{const bt={...re,priceQuotes:Ue};return wr.updateRawMaterial(ne,bt).then(()=>{console.log("Auto-save successful")}).catch(pt=>{console.error("Auto-save failed:",pt),_("فشل في الحفظ التلقائي","خطأ في الحفظ")}),Ue})}catch(Ue){console.error("Auto-save setup error:",Ue)}},200)}catch(xe){console.error("Error uploading file:",xe),c(Ue=>({...Ue,fileUpload:xe.message||"فشل في رفع الملف. حاول مرة أخرى."}))}finally{m(!1)}},es=T=>{console.log("Starting edit for quote:",T),H(T.id),be({supplierType:T.supplierType||"local",supplier:T.supplier||"",supplierName:T.supplierName||"",date:T.date||"",price:T.price||"",quotationFile:T.quotationFile||null}),j(!0)},an=T=>{if(console.log("Price quote delete button clicked:",T),console.log("Quote ID:",T?.id),console.log("Quote keys:",T?Object.keys(T):"quote is null/undefined"),!T||!T.id){console.error("Invalid quote object - missing quote or ID:",{quote:T,hasId:!!T?.id,quoteId:T?.id,quoteType:typeof T}),_("خطأ في بيانات عرض السعر","خطأ");return}E(`هل أنت متأكد من حذف عرض السعر؟

${T.supplierName} - ${T.price} ريال`,()=>Bt(T),"تأكيد حذف عرض السعر")},Bt=async T=>{if(console.log("Delete confirmation called for quote:",T),console.log("Confirmation - Quote ID:",T?.id),console.log("Confirmation - Quote keys:",T?Object.keys(T):"quote is null/undefined"),console.log("Is editing mode:",B),console.log("Raw material ID:",ne),console.log("Form data name:",s.name),!T||!T.id){console.error("Invalid quote in confirmation - missing quote or ID:",{quote:T,hasId:!!T?.id,quoteId:T?.id,quoteType:typeof T}),_("خطأ في بيانات عرض السعر","خطأ"),U(!1);return}try{if(U(!0),console.log("Starting delete process..."),console.log("Moving to trash..."),B&&ne){const he={...T,rawMaterialId:ne,rawMaterialName:s.name};console.log("Quote with context for trash:",he),console.log("Calling SimpleTrashService.moveToTrash...");const de=await Gn.moveToTrash(he,"price_quotes");console.log("Trash service result:",de),console.log("Moved to trash successfully")}else console.log("Skipping trash - raw material not saved yet (isEditing:",B,", id:",ne,")");const re=me();console.log("Logging activity with current user:",re),q("task",`${re.name} حذف عرض سعر`,`تم حذف عرض السعر: ${T.supplierName} - ${T.price} ريال`),console.log("Updating local state..."),console.log("Current price quotes before deletion:",F),ce(he=>{const de=he.filter(xe=>xe.id!==T.id);return console.log("Filtered quotes:",de.length,"from",he.length),console.log("Removed quote with ID:",T.id),console.log("Remaining quotes:",de.map(xe=>({id:xe.id,supplierName:xe.supplierName}))),setTimeout(()=>{R(de)},100),de}),console.log("Showing success message..."),B&&ne?ie(`تم نقل عرض السعر للمهملات: ${T.supplierName}`,"تم النقل للمهملات"):ie(`تم حذف عرض السعر: ${T.supplierName}`,"تم الحذف"),console.log("Delete process completed successfully"),B&&ne&&setTimeout(async()=>{try{console.log("Auto-saving raw material after price quote deletion..."),ce(he=>{const de={...s,priceQuotes:he};return wr.updateRawMaterial(ne,de).then(()=>{console.log("Auto-save after deletion successful")}).catch(xe=>{console.error("Auto-save after deletion failed:",xe)}),he})}catch(he){console.error("Auto-save after deletion setup error:",he)}},200)}catch(re){console.error("Error deleting price quote:",re),console.error("Error stack:",re.stack),_(`فشل في حذف عرض السعر: ${re.message||"خطأ غير معروف"}`,"خطأ في الحذف")}finally{console.log("Setting deleting to false"),U(!1)}},Nn=()=>(Y.supplierType==="local"?k:X).filter(he=>{const de=he.hasOwnProperty("active"),xe=he.hasOwnProperty("status");return de?he.active===!0:xe?he.status==="active":!0});return p?n.jsx(Dn,{show:!0,message:"جار تحميل بيانات المادة الخام..."}):n.jsxs(rn,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Kn,{onToggle:C}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsxs("div",{style:{position:"sticky",top:0,zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item",children:n.jsx("a",{href:"/raw-materials",className:"text-decoration-none text-primary",children:"بنود المناقصات"})}),n.jsx("li",{className:"breadcrumb-item",children:n.jsx("a",{href:"/raw-materials",className:"text-decoration-none text-primary",children:"مواد خام"})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:B?"تعديل مادة خام":"إضافة مادة خام جديدة"})]})}),n.jsx(Yn,{})]}),n.jsxs("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:[n.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"60px"},children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsxs("div",{className:"card-header bg-white border-bottom py-4 d-flex align-items-center",children:[n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),B?"تعديل المادة الخام":"إضافة مادة خام جديدة"]}),n.jsx("div",{style:{flex:1}}),n.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:Ot,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:"1",paddingTop:"2px"},children:"عرض سعر"})]}),n.jsxs("form",{onSubmit:Ke,children:[n.jsxs("div",{className:"card-body p-4",children:[l.submit&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.submit]}),n.jsxs("div",{className:"row mb-4",children:[n.jsx("div",{className:"col-12",children:n.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[n.jsx("i",{className:"bi bi-info-circle me-2"}),"المعلومات الأساسية"]})}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"اسم المادة الخام *"}),n.jsx("input",{type:"text",className:`form-control ${l.name?"is-invalid":""}`,name:"name",value:s.name,onChange:Ge,placeholder:"أدخل اسم المادة الخام"}),l.name&&n.jsx("div",{className:"invalid-feedback",children:l.name})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الفئة *"}),n.jsx(Hx,{name:"category",value:s.category,onChange:Ge,required:!0,className:`form-select ${l.category?"is-invalid":""}`,placeholder:"اختر الفئة",showDescription:!0}),l.category&&n.jsx("div",{className:"invalid-feedback",children:l.category})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الوحدة *"}),n.jsx(Gx,{name:"unit",value:s.unit,onChange:Ge,required:!0,className:`form-select ${l.unit?"is-invalid":""}`,placeholder:"اختر الوحدة",showDescription:!0}),l.unit&&n.jsx("div",{className:"invalid-feedback",children:l.unit})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsxs("label",{className:"form-label fw-bold",children:["السعر (ريال) *",n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:F.length>0?"أقل سعر تلقائي":"سعر تلقائي"})]}),n.jsx("input",{type:"number",step:"0.01",min:"0",className:`form-control ${l.price?"is-invalid":""}`,name:"price",value:s.price,onChange:null,onKeyPress:null,placeholder:"0.00",readOnly:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"}}),l.price&&n.jsx("div",{className:"invalid-feedback",children:l.price}),n.jsx("div",{className:"mt-1",children:n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),F.length>0?"السعر محدد تلقائياً من أقل عرض سعر في القائمة":"السعر سيتم تحديده تلقائياً عند إضافة عروض الأسعار"]})})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الوصف"}),n.jsx("textarea",{className:"form-control",name:"description",value:s.description,onChange:Ge,rows:"3",placeholder:"وصف المادة الخام"})]}),n.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:n.jsxs("div",{className:"d-flex align-items-center gap-2",children:[n.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"نشط":"غير نشط"}),n.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"rawMaterialActiveSwitch",name:"active",checked:s.active,onChange:Ge,style:{width:"48px",height:"24px",marginRight:"8px"}})]})})]}),n.jsxs("div",{className:"row mb-4",children:[n.jsxs("div",{className:"col-12",children:[n.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[n.jsx("i",{className:"bi bi-receipt me-2"}),"عروض الأسعار"]}),l.priceQuotes&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.priceQuotes]})]}),F.length>0&&n.jsx("div",{className:"col-12",children:n.jsxs("div",{className:"card mb-3 border-0 shadow-lg",style:{background:"linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%)",borderRadius:"16px"},children:[n.jsx("div",{className:"card-header border-0",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"16px 16px 0 0",padding:"20px"},children:n.jsxs("h5",{className:"card-title text-white mb-0 d-flex align-items-center",children:[n.jsx("div",{className:"me-3",style:{background:"rgba(255,255,255,0.2)",borderRadius:"12px",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsx("i",{className:"bi bi-bar-chart-fill fs-5"})}),n.jsx("span",{className:"fw-bold",children:"مقارنة أسعار الموردين"}),n.jsxs("span",{className:"badge bg-light text-primary ms-3",style:{borderRadius:"20px",fontSize:"12px",padding:"6px 12px"},children:[F.length," موردين"]})]})}),n.jsx("div",{className:"card-body",style:{padding:"30px"},children:n.jsx("div",{style:{minHeight:"625px",direction:"ltr"},children:n.jsx("div",{style:{width:"100%",height:"605px",position:"relative"},children:(()=>{F.map(Ue=>parseFloat(Ue.price)||0);const T=640,de=F.length*150,xe=Math.max(T,de);return n.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${xe+160} 605`,style:{direction:"ltr"},children:[n.jsxs("defs",{children:[n.jsxs("linearGradient",{id:"chartBg",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#ffffff",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#f8f9ff",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"bestPriceGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#00f5a0",stopOpacity:1}}),n.jsx("stop",{offset:"30%",style:{stopColor:"#00d9f5",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#0066cc",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"regularPriceGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),n.jsx("stop",{offset:"50%",style:{stopColor:"#764ba2",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#f093fb",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient0",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#764ba2",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient1",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#f093fb",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#f5576c",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient2",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#4facfe",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#00f2fe",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient3",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#a8edea",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#fed6e3",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient4",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#ffecd2",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#fcb69f",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient5",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#a18cd1",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#fbc2eb",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient6",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#fad0c4",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#ffd1ff",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient7",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#a1c4fd",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#c2e9fb",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"metallicShine",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),n.jsx("stop",{offset:"45%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),n.jsx("stop",{offset:"50%",style:{stopColor:"rgba(255,255,255,0.8)",stopOpacity:1}}),n.jsx("stop",{offset:"55%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),n.jsx("stop",{offset:"100%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}})]}),n.jsx("filter",{id:"dropShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:n.jsx("feDropShadow",{dx:"0",dy:"6",stdDeviation:"8",floodColor:"rgba(0,0,0,0.15)"})}),n.jsxs("filter",{id:"premiumGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{stdDeviation:"5",result:"coloredBlur"}),n.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0 0 0  0 1 1 0 0  0 0 1 0 0  0 0 0 1 0"}),n.jsxs("feMerge",{children:[n.jsx("feMergeNode",{in:"coloredBlur"}),n.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),n.jsxs("filter",{id:"bevelEffect",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2",result:"blur"}),n.jsx("feSpecularLighting",{in:"blur",result:"specOut",surfaceScale:"5",specularConstant:"0.8",specularExponent:"20","lighting-color":"white",children:n.jsx("fePointLight",{x:"-50",y:"-50",z:"200"})}),n.jsx("feComposite",{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut2"}),n.jsx("feComposite",{in:"SourceGraphic",in2:"specOut2",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"})]}),n.jsxs("filter",{id:"pulseGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),n.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0.8 0 0  0 1 1 0 0  0 0 1 0.2 0  0 0 0 1 0"}),n.jsxs("feMerge",{children:[n.jsx("feMergeNode",{in:"coloredBlur"}),n.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),n.jsx("rect",{width:xe+160,height:"605",fill:"url(#chartBg)",rx:"12",style:{filter:"drop-shadow(0 4px 20px rgba(0,0,0,0.1))"}}),n.jsx("g",{transform:"translate(80, 40)",children:(()=>{const Ue=F.map(Oe=>parseFloat(Oe.price)||0),bt=Math.max(...Ue),pt=Math.min(...Ue),Vs=bt-pt||1,Ne=300,ue=640,Te=F.length*150,We=Math.max(ue,Te),ye=Math.min(We/F.length*.6,80),ze=We/F.length;return n.jsxs(n.Fragment,{children:[[0,1,2,3,4,5].map(Oe=>{const Ze=130+(Ne-130)/5*Oe,Ve=(1-Oe/5)*Math.max(...Ue);return n.jsxs("g",{children:[n.jsx("line",{x1:"0",y1:Ze,x2:We,y2:Ze,stroke:Oe===5?"#007bff":"rgba(123, 140, 252, 0.2)",strokeWidth:Oe===5?"2":"1",strokeDasharray:Oe===5?"0":"5,5"}),n.jsx("text",{x:"-15",y:Ze+5,textAnchor:"end",fontSize:"12",fill:"#4f46e5",fontWeight:"600",children:Math.round(Ve).toLocaleString()})]},Oe)}),F.map((Oe,nt)=>{const Ze=parseFloat(Oe.price)||0;let Je;if(Vs>0){const fs=Ne-130,dr=Ze/Math.max(...Ue);Je=Math.max(dr*fs,15)}else Je=(Ne-130)*.8;const Ve=ze*nt+(ze-ye)/2,ke=Ne-Je,et=Ze===pt;let bn;return et?bn="bestPriceGradient":bn=`gradient${nt%8}`,n.jsxs("g",{children:[n.jsx("rect",{x:Ve+4,y:ke+8,width:ye,height:Je,fill:"rgba(0,0,0,0.05)",rx:"10"}),n.jsx("rect",{x:Ve+2,y:ke+4,width:ye,height:Je,fill:"rgba(0,0,0,0.08)",rx:"9"}),n.jsxs("rect",{x:Ve,y:ke,width:ye,height:Je,fill:`url(#${bn})`,rx:"10",filter:et?"url(#premiumGlow)":"url(#bevelEffect)",style:{transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer"},children:[n.jsx("animate",{attributeName:"height",from:"0",to:Je,dur:"2s",begin:`${nt*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),n.jsx("animate",{attributeName:"y",from:Ne,to:ke,dur:"2s",begin:`${nt*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),et&&n.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;1.05;1",dur:"3s",repeatCount:"indefinite",begin:`${nt*.3+2}s`})]}),n.jsx("rect",{x:Ve+2,y:ke+2,width:ye-4,height:Math.max(Je/2.5,30),fill:"url(#metallicShine)",rx:"8",opacity:"0.6",children:n.jsx("animateTransform",{attributeName:"transform",type:"translate",values:`-${ye};${ye}`,dur:"4s",repeatCount:"indefinite",begin:`${nt*.5+3}s`})}),n.jsx("rect",{x:Ve+3,y:ke+3,width:Math.max(ye/4,8),height:Math.max(Je-6,20),fill:"rgba(255,255,255,0.4)",rx:"6"}),n.jsx("rect",{x:Ve+ye-6,y:ke+6,width:"3",height:Math.max(Je-12,15),fill:"rgba(255,255,255,0.2)",rx:"1.5"}),n.jsxs("g",{children:[n.jsx("rect",{x:Ve+ye/2-30,y:ke-28,width:"60",height:"20",fill:"rgba(0,0,0,0.8)",rx:"10",opacity:"0.9"}),n.jsxs("text",{x:Ve+ye/2,y:ke-15,textAnchor:"middle",fontSize:"12",fill:"white",fontWeight:"bold",children:["ر.س ",Ze.toLocaleString()]})]}),n.jsx("g",{children:(()=>{const fs=Oe.supplierName,dr=fs.length*7,vs=Math.max(dr+20,ye+10);return n.jsxs(n.Fragment,{children:[n.jsx("rect",{x:Ve+ye/2-vs/2,y:Ne+30,width:vs,height:22,fill:"rgba(255,255,255,0.96)",rx:"11",stroke:"rgba(0,123,255,0.5)",strokeWidth:"1.5",filter:"url(#dropShadow)"}),n.jsx("text",{x:Ve+ye/2,y:Ne+41,textAnchor:"middle",fontSize:"11",fill:"#1e40af",fontWeight:"700",style:{fontFamily:"system-ui, -apple-system, sans-serif",letterSpacing:"0.2px"},dominantBaseline:"middle",children:fs})]})})()}),et&&n.jsxs("g",{children:[n.jsx("circle",{cx:Ve+ye/2,cy:ke-100,r:"18",fill:"linear-gradient(135deg, #ffd700 0%, #ffb300 100%)",stroke:"#fff",strokeWidth:"3",filter:"url(#dropShadow)"}),n.jsx("text",{x:Ve+ye/2,y:ke-95,textAnchor:"middle",fontSize:"16",fill:"#fff",children:"👑"}),n.jsx("rect",{x:Ve-5,y:ke-70,width:ye+10,height:"20",fill:"#28a745",rx:"10",opacity:"0.9"}),n.jsx("text",{x:Ve+ye/2,y:ke-57,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:"أفضل سعر"})]})]},Oe.id)}),n.jsx("text",{x:We/2,y:30,textAnchor:"middle",fontSize:"16",fill:"url(#bestPriceGradient)",fontWeight:"bold",direction:"rtl",children:"مقارنة الأسعار بالريال السعودي"}),n.jsxs("g",{transform:`translate(${We/2}, ${Ne+110})`,children:[n.jsx("rect",{x:"-200",y:"-25",width:"400",height:"145",fill:"rgba(255,255,255,0.98)",rx:"20",stroke:"url(#bestPriceGradient)",strokeWidth:"2",filter:"url(#dropShadow)"}),n.jsx("text",{x:"0",y:"-5",textAnchor:"middle",fontSize:"16",fill:"#1f2937",fontWeight:"800",letterSpacing:"0.5px",children:"مؤشر الأسعار"}),n.jsxs("g",{transform:"translate(0, 15)",children:[n.jsxs("g",{transform:"translate(-125, 0)",children:[n.jsxs("g",{transform:"translate(0, 0)",children:[n.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#bestPriceGradient)",rx:"7",filter:"url(#premiumGlow)"}),n.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#059669",fontWeight:"700",children:"أفضل سعر"}),n.jsx("text",{x:"80",y:"13",fontSize:"18",children:"👑"})]}),n.jsx("line",{x1:"110",y1:"-5",x2:"110",y2:"19",stroke:"rgba(0,0,0,0.15)",strokeWidth:"2"}),n.jsxs("g",{transform:"translate(125, 0)",children:[n.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#regularPriceGradient)",rx:"7"}),n.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#6366f1",fontWeight:"700",children:"أسعار أخرى"}),n.jsx("text",{x:"90",y:"13",fontSize:"16",children:"📊"})]})]}),n.jsxs("g",{transform:"translate(0, 40)",children:[n.jsx("rect",{x:"-170",y:"-8",width:"340",height:"22",fill:"rgba(59, 130, 246, 0.08)",rx:"11"}),n.jsxs("text",{x:"0",y:"5",textAnchor:"middle",fontSize:"14",fill:"#1e40af",fontWeight:"700",children:["💰 الفرق في السعر: ",(Math.max(...Ue)-Math.min(...Ue)).toLocaleString()," ر.س"]})]}),n.jsx("g",{transform:"translate(0, 90)",children:n.jsxs("text",{x:"0",y:"0",textAnchor:"middle",fontSize:"12",fill:"#6b7280",fontWeight:"600",children:["📈 أعلى سعر: ",Math.max(...Ue).toLocaleString()," ر.س  •  📉 أقل سعر: ",Math.min(...Ue).toLocaleString()," ر.س"]})})]})]})]})})()})]})})()})})})]})}),n.jsx("div",{className:"col-12",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsx("div",{className:"d-flex justify-content-between align-items-center",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-list-ul text-primary me-2"}),"قائمة عروض الأسعار (",F.length,")"]})})}),n.jsx("div",{className:"card-body p-0",children:F.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-receipt fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد عروض أسعار"}),n.jsx("p",{className:"text-muted",children:"لم يتم إضافة أي عروض أسعار بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"المورد"}),n.jsx("th",{className:"text-center",children:"النوع"}),n.jsx("th",{className:"text-center",children:"التاريخ"}),n.jsx("th",{className:"text-center",children:"السعر (ريال)"}),n.jsx("th",{className:"text-center",children:"الملف"}),n.jsx("th",{className:"text-center",style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:F.map((T,re)=>{const he=F.length>=1&&F.reduce((de,xe)=>{const Ue=parseFloat(de.price)||0;return(parseFloat(xe.price)||0)<Ue?xe:de}).id===T.id;return n.jsxs("tr",{className:he?"table-success":"",children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:re+1})}),n.jsxs("td",{className:"text-center",children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},onClick:de=>{de.preventDefault(),de.stopPropagation(),console.log("Button clicked, calling handleSupplierEdit..."),hn(T.supplierName,T.supplierType)},title:`تحرير مورد: ${T.supplierName}`,type:"button",children:T.supplierName}),he&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:`badge ${T.supplierType==="local"?"bg-success":"bg-info"}`,children:T.supplierType==="local"?"محلي":"أجنبي"})}),n.jsx("td",{className:"text-center",children:T.date}),n.jsxs("td",{className:"text-center",children:[T.price," ريال",he&&n.jsx("i",{className:"bi bi-arrow-down-circle-fill text-success ms-2",title:"أقل سعر"})]}),n.jsx("td",{className:"text-center",children:T.quotationFile&&n.jsx(qx,{size:25,clickable:!0,onClick:()=>{T.quotationFileURL?window.open(T.quotationFileURL,"_blank"):(console.log("No file URL available for:",T.quotationFile),alert("الملف غير متوفر للعرض"))},title:`عرض الملف: ${T.quotationFileName||T.quotationFile}`})}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>es(T),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>an(T),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},T.id)})})]})})})]})})]})]}),n.jsx("div",{className:"card-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsxs("div",{className:"d-flex gap-3",style:{marginBottom:"15px"},children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:ft,disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?"جار الحفظ...":n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),B?"تحديث":"حفظ"]})})]})})]})]})}),n.jsx("div",{className:"app-footer",style:{textAlign:"center",padding:"20px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",marginTop:"20px"},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]})]}),!r&&t&&n.jsx(Xn,{rtl:!0}),!r&&t&&n.jsx(Jn,{}),w&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:n.jsx("div",{className:"modal-dialog modal-lg",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0 pb-2",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-receipt text-primary me-2"}),"طلب عرض سعر"]}),n.jsx("button",{type:"button",className:"btn-close",onClick:Ee,style:{fontSize:"12px"}})]}),n.jsxs("form",{onSubmit:Zn,onReset:T=>T.preventDefault(),children:[n.jsxs("div",{className:"modal-body px-4",children:[l.fileUpload&&n.jsxs("div",{className:"alert alert-danger mb-3",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.fileUpload]}),n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"نوع المورد *"}),n.jsxs("select",{className:"form-select",name:"supplierType",value:Y.supplierType,onChange:yn,required:!0,children:[n.jsx("option",{value:"local",children:"مورد محلي"}),n.jsx("option",{value:"foreign",children:"مورد أجنبي"})]})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"المورد *"}),n.jsxs("div",{className:"form-control d-flex align-items-center justify-content-between",onClick:it,style:{cursor:"pointer",backgroundColor:"#f8f9fa"},children:[n.jsx("span",{className:Y.supplierName?"text-dark":"text-muted",children:Y.supplierName||"اختر المورد"}),n.jsx("i",{className:"bi bi-chevron-down"})]})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"تاريخ العرض *"}),n.jsx("input",{type:"date",className:"form-control",name:"date",value:Y.date,onChange:yn,required:!0})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"السعر (ريال) *"}),n.jsx("input",{type:"number",step:"0.01",min:"0",className:"form-control",name:"price",value:Y.price,onChange:yn,onKeyPress:T=>{(T.key==="-"||T.key!=="."&&T.key!=="Backspace"&&(T.key<"0"||T.key>"9"))&&T.preventDefault()},placeholder:"0.00",required:!0})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsxs("label",{className:"form-label fw-bold",children:["رفع عرض السعر ",M?"(اختياري)":"*"]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.jpg,.png,.jpeg",style:{display:"none"},ref:T=>{T&&(T.onclick=()=>{T.value=""},T.onchange=re=>{const he=re.target.files?.[0];he&&Xt(he)})},id:`fileInput_${w}_${Date.now()}`}),n.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>{const T=document.querySelector(`#fileInput_${w}_${Date.now()}`);if(T)T.click();else{const re=document.createElement("input");re.type="file",re.accept=".pdf,.doc,.docx,.jpg,.png,.jpeg",re.style.display="none",re.onchange=he=>{const de=he.target.files?.[0];de&&Xt(de),document.body.removeChild(re)},document.body.appendChild(re),re.click()}},style:{borderRadius:"6px",height:"38px",minWidth:"150px"},children:[n.jsx("i",{className:"bi bi-upload me-2"}),"اختر ملف"]})]}),Y.quotationFile&&n.jsxs("div",{className:"alert alert-success py-2 mb-2",style:{position:"relative"},children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-check-circle me-2 text-success"}),n.jsxs("div",{className:"flex-grow-1",children:[n.jsx("strong",{children:Y.quotationFile.name?Y.supplierName?`عرض سعر ${Y.supplierName}.${Y.quotationFile.name.split(".").pop()}`:Y.quotationFile.name:M?Y.supplierName?`عرض سعر ${Y.supplierName}.pdf`:F.find(T=>T.id===M)?.quotationFileName||"ملف موجود":"ملف موجود"}),n.jsxs("small",{className:"text-muted ms-2",children:["(",Y.quotationFile.size?Math.round(Y.quotationFile.size/1024):M?Math.round((F.find(T=>T.id===M)?.quotationFileSize||0)/1024):0," KB)"]})]})]}),n.jsx("button",{type:"button",className:"btn-close btn-close-sm",onClick:()=>{be(T=>({...T,quotationFile:null}))},title:"إزالة الملف",style:{position:"absolute",top:"8px",left:"8px",width:"20px",height:"20px",fontSize:"10px",opacity:.7},onMouseEnter:T=>T.target.style.opacity=1,onMouseLeave:T=>T.target.style.opacity=.7})]}),M&&!Y.quotationFile&&n.jsxs("div",{className:"alert alert-info py-2 mb-2",children:[n.jsx("i",{className:"bi bi-info-circle me-2"}),n.jsxs("small",{children:["ملف موجود: ",F.find(T=>T.id===M)?.quotationFileName||"ملف موجود"]})]}),!Y.quotationFile&&!M&&n.jsx("div",{className:"mt-1",children:n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),"يجب اختيار ملف PDF أو Word أو صورة"]})})]})]})]}),n.jsx("div",{className:"modal-footer border-0 pt-0 d-flex justify-content-center",style:{marginBottom:"10px"},children:n.jsxs("div",{className:"d-flex gap-3",children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:Ee,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"10px",height:"10px"}}),"رفع..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),"إرسال"]})})]})})]})]})})}),D&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:n.jsx("div",{className:"modal-dialog modal-xl",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0 pb-2",style:{marginBottom:"5px"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-people-fill text-primary me-2"}),Y.supplierType==="local"?"اختر مورد محلي":"اختر مورد أجنبي",n.jsxs("span",{className:"text-muted ms-2",children:["(",Nn().length,")"]})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:Nt,style:{fontSize:"12px"}})]}),n.jsx("div",{className:"modal-body p-0",children:Nn().length>0?n.jsx("div",{className:"table-responsive suppliers-table",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"50px"}}),n.jsx("th",{children:"اسم المورد"}),n.jsx("th",{children:"البريد الإلكتروني"}),n.jsx("th",{children:"الهاتف"}),n.jsx("th",{children:"المدينة"})]})}),n.jsx("tbody",{children:Nn().map(T=>n.jsxs("tr",{onClick:()=>is(T),style:{cursor:"pointer"},children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input custom-radio",type:"radio",name:"selectedSupplier",checked:Q?.id===T.id,onChange:()=>{},style:{pointerEvents:"none",width:"18px",height:"18px",borderWidth:"2px",borderColor:Q?.id===T.id?"#007bff":"#dee2e6"}})})}),n.jsx("td",{children:n.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},children:T.name})}),n.jsx("td",{children:n.jsx("a",{href:`mailto:${T.email}`,className:"text-decoration-none",children:T.email})}),n.jsx("td",{children:T.phone}),n.jsx("td",{children:T.city||"-"})]},T.id))})]})}):n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-people fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد موردين"}),n.jsxs("p",{className:"text-muted",children:["لا توجد ",Y.supplierType==="local"?"موردين محليين":"موردين أجانب"," مسجلين"]})]})}),n.jsx("div",{className:"modal-footer border-0 d-flex justify-content-center",style:{marginTop:"15px"},children:n.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:Un,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",margin:"20px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:"تأكيد"})})]})})}),I&&J&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:T=>{T.target===T.currentTarget&&xn()},children:n.jsx("div",{className:"modal-dialog modal-lg",onClick:T=>T.stopPropagation(),children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"معلومات المورد - ",J.name,n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:J.supplierType==="local"?"محلي":"أجنبي"})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:xn})]}),n.jsx("div",{className:"modal-body",children:n.jsxs("div",{className:"row g-3",children:[n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"اسم المورد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J.name})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البريد الإلكتروني"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J.email||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الهاتف"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:J.phone||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"المدينة"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J.city||""})]}),n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"العنوان"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J.address||""})]}),J.taxNumber&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"الرقم الضريبي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J.taxNumber})]}),J.bankAccount&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الحساب البنكي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J.bankAccount})]}),J.notes&&n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"ملاحظات"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J.notes})]})]})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:xn,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إغلاق"})})]})})})]}),n.jsx(Dn,{show:u,message:B?"جار تحديث المادة الخام...":"جار حفظ المادة الخام..."}),n.jsx(Rn,{show:se.show,onClose:fe,title:se.title,message:se.message,type:se.type,onConfirm:se.onConfirm,confirmText:se.confirmText,cancelText:se.cancelText,showCancel:se.showCancel}),n.jsx(Qx,{position:"bottom-right",showDetails:!0})]})}function zE(){return n.jsx(sn,{children:n.jsx(V4,{})})}const z4=({refreshTrigger:r})=>{const[e,t]=N.useState([]),[s,a]=N.useState(!0),[l,c]=N.useState(null),[u,m]=N.useState(""),[p,b]=N.useState([]),[w,j]=N.useState(!1),[D,O]=N.useState(!1),[Q,z]=N.useState(!1),[I,ee]=N.useState(null),[J,oe]=N.useState([]),[Y,be]=N.useState([]),M=ms(),{logActivity:H,getCurrentUser:k}=vn(),{alertConfig:$,closeAlert:X,showSuccess:te,showError:F,showConfirm:ce}=Pn(),{currentPage:Be,totalPages:U,paginatedItems:se,handlePageChange:fe,resetPage:ie,totalItems:_,itemsPerPage:E}=wa(p,30);N.useEffect(()=>{R(),V()},[]),N.useEffect(()=>{r&&R()},[r]),N.useEffect(()=>{if(u.trim()){const C=e.filter(Z=>Z.name?.toLowerCase().includes(u.toLowerCase())||Z.category?.toLowerCase().includes(u.toLowerCase())||Z.description?.toLowerCase().includes(u.toLowerCase())||Z.supplier?.toLowerCase().includes(u.toLowerCase()));b(C)}else b(e);ie()},[u,e,ie]);const R=async()=>{try{a(!0);const C=await vr.getAllLocalProducts();t(C),c(null)}catch(C){c(C.message)}finally{a(!1)}},V=async()=>{try{const[C,Z]=await Promise.all([Ji.getAllSuppliers(),Zi.getAllSuppliers()]);oe(C),be(Z)}catch(C){console.error("Error loading suppliers:",C)}},ne=async(C,Z)=>{try{if(Z==="local"){const je=J.find(Ge=>Ge.name===C);je&&(ee(je),O(!0))}else if(Z==="foreign"){const je=Y.find(Ge=>Ge.name===C);je&&(ee(je),z(!0))}}catch(je){console.error("Error opening supplier modal:",je)}},B=()=>{O(!1),z(!1),ee(null)},q=C=>{ce(`هل أنت متأكد من حذف هذا المنتج المحلي؟

${C.name}`,()=>me(C),"تأكيد حذف المنتج المحلي")},me=async C=>{try{j(!0),await Gn.moveToTrash(C,"localproducts"),await vr.deleteLocalProduct(C.id);const Z=k();H("task",`${Z.name} حذف منتج محلي`,`تم حذف المنتج المحلي: ${C.name}`),await R(),te(`تم نقل المنتج المحلي للمهملات: ${C.name}`,"تم النقل للمهملات")}catch(Z){c(Z.message),F(`فشل في نقل المنتج المحلي للمهملات: ${Z.message}`,"خطأ في النقل")}finally{j(!1)}};return s?n.jsx(Dn,{show:!0,message:"جار تحميل بيانات المنتجات المحلية...",overlay:!1}):l?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:l}),n.jsxs("button",{className:"btn btn-primary",onClick:R,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs("div",{className:"card shadow-sm","data-list":"local-products",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),"قائمة المنتجات المحلية (",p.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المنتجات المحلية...",value:u,onChange:C=>m(C.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),n.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:()=>M("/local-products/add"),style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"إضافة منتج محلي جديد"]})]})})]})}),n.jsxs("div",{className:"card-body p-0",children:[p.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-box-seam fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد منتجات محلية"}),n.jsx("p",{className:"text-muted",children:u?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي منتجات محلية بعد"}),!u&&n.jsxs("button",{className:"btn btn-primary",onClick:()=>M("/local-products/add"),children:[n.jsx("i",{className:"bi bi-plus-lg me-1"}),"إضافة أول منتج محلي"]})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"اسم المنتج"}),n.jsx("th",{className:"text-center",children:"الفئة"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر"}),n.jsx("th",{className:"text-center",children:"المورد"}),n.jsx("th",{className:"text-center",style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:se.map((C,Z)=>{let je=C.price,Ge=C.supplier,Ke=!1,ft=null,Ot=null;return C.priceQuotes&&Array.isArray(C.priceQuotes)&&C.priceQuotes.length>0&&(Ke=!0,Ot=C.priceQuotes.reduce((Ee,it)=>{const Nt=parseFloat(Ee.price)||0;return(parseFloat(it.price)||0)<Nt?it:Ee}),je=Ot.price,Ge=Ot.supplierName,ft=Ot.supplierType),n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(Be-1)*E+Z+1})}),n.jsx("td",{className:"text-center",children:n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary product-name-btn",onClick:Ee=>{if(Ee.preventDefault(),Ee.stopPropagation(),console.log("=== LOCAL PRODUCT BUTTON CLICKED ==="),console.log("Product Name:",C.name),console.log("Product ID:",C.id),C.id){const it=`/local-products/edit/${C.id}`;console.log("Target URL:",it),console.log("🚀 FORCING NAVIGATION TO:",it),window.location.href=it}else console.error("Product ID is missing:",C),F("معرف المنتج مفقود، لا يمكن التنقل","خطأ في التنقل")},onMouseDown:Ee=>Ee.preventDefault(),style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0",userSelect:"none",pointerEvents:"auto",zIndex:"1"},title:`انقر للتعديل | Internal ID: ${C.internalId||"Not Set"} | Firebase ID: ${C.id||"Missing"}`,children:C.name})}),n.jsx("td",{className:"text-center",children:C.category||"-"}),n.jsx("td",{className:"text-center",children:C.unit||"-"}),n.jsx("td",{className:"text-center",children:je?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsxs("span",{children:[je," ريال"]}),Ke&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}):"-"}),n.jsx("td",{className:"text-center",children:Ge?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[Ke&&ft?n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",onClick:()=>ne(Ge,ft),style:{textDecoration:"none"},title:`فتح تفاصيل ${ft==="local"?"المورد المحلي":"المورد الأجنبي"}`,children:Ge}):n.jsx("span",{children:Ge}),Ke&&n.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:"أقل مورد"})]}):"-"}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>M(`/local-products/edit/${C.id}`),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>q(C),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},C.internalId||C.id)})})]})}),p.length>0&&n.jsx(va,{currentPage:Be,totalPages:U,onPageChange:fe,totalItems:_,itemsPerPage:E})]}),D&&I&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:C=>{C.target===C.currentTarget&&B()},children:n.jsx("div",{className:"modal-dialog modal-lg",onClick:C=>C.stopPropagation(),children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"معلومات المورد - ",I.name,n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:"محلي"})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:B})]}),n.jsx("div",{className:"modal-body",children:n.jsxs("div",{className:"row g-3",children:[n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"اسم المورد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.name})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البريد الإلكتروني"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.email||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الهاتف"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:I.phone||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"المدينة"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.city||""})]}),n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"العنوان"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.address||""})]}),I.taxNumber&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"الرقم الضريبي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.taxNumber})]}),I.bankAccount&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الحساب البنكي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.bankAccount})]}),I.notes&&n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"ملاحظات"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.notes})]})]})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:B,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إغلاق"})})]})})}),Q&&I&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:C=>{C.target===C.currentTarget&&B()},children:n.jsx("div",{className:"modal-dialog modal-lg",onClick:C=>C.stopPropagation(),children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"معلومات المورد - ",I.name,n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:"أجنبي"})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:B})]}),n.jsx("div",{className:"modal-body",children:n.jsxs("div",{className:"row g-3",children:[n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"اسم المورد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.name})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البريد الإلكتروني"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.email||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الهاتف"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:I.phone||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البلد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.country||""})]}),n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"العنوان"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.address||""})]}),I.taxNumber&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"الرقم الضريبي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.taxNumber})]}),I.bankAccount&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الحساب البنكي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.bankAccount})]}),I.notes&&n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"ملاحظات"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.notes})]})]})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:B,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إغلاق"})})]})})}),n.jsx(Rn,{show:$.show,onClose:X,title:$.title,message:$.message,type:$.type,onConfirm:$.onConfirm,confirmText:$.confirmText,cancelText:$.cancelText,showCancel:$.showCancel})]})};function $4(){const[r,e]=N.useState(!1),[t,s]=N.useState(0),{isTimelineVisible:a}=$n(),l=()=>{e(!r)};return n.jsx(sn,{children:n.jsx(rn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Kn,{onToggle:l}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!a?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المناقصات"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"منتج محلي"})]})}),n.jsx(Yn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"local-products-table",children:n.jsx(z4,{refreshTrigger:t})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&a&&n.jsx(Xn,{rtl:!0}),!r&&a&&n.jsx(Jn,{})]})})})}function B4(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx($4,{})})})}function q4(){const[r,e]=N.useState(!1),{isTimelineVisible:t}=$n(),[s,a]=N.useState({name:"",category:"",description:"",unit:"",price:"",supplier:"",stockQuantity:"",minimumStock:"",storageConditions:"",expiryDate:"",batchNumber:"",origin:"",notes:"",active:!0}),[l,c]=N.useState({}),[u,m]=N.useState(!1),[p,b]=N.useState(!1),[w,j]=N.useState(!1),[D,O]=N.useState(!1),[Q,z]=N.useState(null),[I,ee]=N.useState(!1),[J,oe]=N.useState(null),[Y,be]=N.useState({supplierType:"local",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),[M,H]=N.useState(null),[k,$]=N.useState([]),[X,te]=N.useState([]),[F,ce]=N.useState([]),[Be,U]=N.useState(!1),{alertConfig:se,closeAlert:fe,showSuccess:ie,showError:_,showConfirm:E}=Pn(),R=T=>{if(T.length===0)return;const re=T.reduce((he,de)=>{const xe=parseFloat(he.price)||0;return(parseFloat(de.price)||0)<xe?de:he});console.log("Lowest price quote found:",re),a(he=>({...he,price:re.price,supplier:re.supplierName}))},V=ms(),{id:ne}=ea(),B=!!ne,{logActivity:q,getCurrentUser:me}=vn(),C=()=>{e(!r)};N.useEffect(()=>{B&&je(),Z();const T=()=>{B&&ne&&(console.log("Window focused - refreshing local product data..."),je())};return window.addEventListener("focus",T),()=>{window.removeEventListener("focus",T)}},[ne]),N.useEffect(()=>{console.log("PriceQuoteData changed:",{hasFile:!!Y.quotationFile,fileName:Y.quotationFile?.name,supplierName:Y.supplierName,price:Y.price})},[Y]);const Z=async()=>{try{const[T,re]=await Promise.all([Ji.getAllSuppliers(),Zi.getAllSuppliers()]);$(T),te(re)}catch(T){console.error("Error loading suppliers:",T)}},je=async()=>{try{b(!0),console.log("Loading local product data for ID:",ne);const T=await vr.getAllLocalProducts(),re=T.find(he=>he.id===ne);re?(console.log("Local product found:",re.name),a({name:re.name||"",category:re.category||"",description:re.description||"",unit:re.unit||"",price:re.price||"",supplier:re.supplier||"",stockQuantity:re.stockQuantity||"",minimumStock:re.minimumStock||"",storageConditions:re.storageConditions||"",expiryDate:re.expiryDate||"",batchNumber:re.batchNumber||"",origin:re.origin||"",notes:re.notes||"",active:re.active!==void 0?re.active:!0}),re.priceQuotes&&Array.isArray(re.priceQuotes)?(console.log("Loading price quotes for local product:",re.name,re.priceQuotes),ce(re.priceQuotes),setTimeout(()=>{R(re.priceQuotes)},200)):console.log("No price quotes found for local product:",re.name)):(console.error("Local product not found with ID:",ne),console.log("Available local products:",T.map(he=>({id:he.id,name:he.name}))),c({submit:"المنتج المحلي غير موجود أو تم حذفه"}))}catch(T){console.error("Error loading local product:",T),c({submit:"فشل في تحميل بيانات المنتج المحلي: "+T.message})}finally{b(!1)}},Ge=T=>{const{name:re,value:he,type:de,checked:xe}=T.target;a(Ue=>({...Ue,[re]:de==="checkbox"?xe:he})),l[re]&&c(Ue=>({...Ue,[re]:""}))},Ke=async T=>{T.preventDefault();const re=vr.validateLocalProductData(s);if(F.length===0&&(re.priceQuotes="يجب إضافة عرض سعر واحد على الأقل"),Object.keys(re).length>0){c(re);return}m(!0),c({});try{const he=await oo.validateUniqueFields({name:s.name},B?ne:null,B?"localproducts":null);if(Object.keys(he).length>0){c(he),m(!1);return}const de={...s,price:parseFloat(s.price)||0,stockQuantity:parseFloat(s.stockQuantity)||0,minimumStock:parseFloat(s.minimumStock)||0,priceQuotes:F,status:"active"};if(console.log("Saving local product with price quotes:",{name:de.name,priceQuotes:de.priceQuotes,priceQuotesCount:de.priceQuotes.length}),B){await vr.updateLocalProduct(ne,de);const xe=me();q("task",`${xe.name} عدل منتج محلي`,`تم تعديل المنتج المحلي: ${de.name}`)}else{await vr.createLocalProduct(de);const xe=me();q("task",`${xe.name} أضاف منتج محلي`,`تم إضافة المنتج المحلي: ${de.name}`)}V("/local-products")}catch(he){c({submit:he.message})}finally{m(!1)}},ft=()=>{V("/local-products")},Ot=()=>{j(!0)},Ee=()=>{j(!1),H(null),be({supplierType:"local",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),c(T=>({...T,fileUpload:""})),console.log("Modal closed and state reset")},it=()=>{O(!0)},Nt=()=>{O(!1),z(null)},hn=T=>{console.log("Supplier Name:",T);try{console.log("Using already loaded local supplier data...");const re=k;console.log("Available local suppliers:",re.length),console.log("Local suppliers list:",re.map(de=>({id:de.id,name:de.name})));const he=re.find(de=>de.name===T);console.log("Found supplier:",he?"YES":"NO"),he?(console.log("SUCCESS: Local supplier found:",he.name),console.log("Supplier data:",he),oe(he),ee(!0),console.log("Modal state should be true now"),setTimeout(()=>{console.log("Modal state check - showSupplierEditModal:",I),console.log("Modal state check - selectedSupplierToEdit:",J?.name)},100)):(console.error("LOCAL SUPPLIER NOT FOUND"),console.error("Looking for supplier name:",T),console.error("Available suppliers:",re.map(de=>de.name)),re.length===0?(console.log("No suppliers loaded, triggering data reload..."),loadSuppliersData(),_("لا توجد بيانات موردين محليين. جار إعادة التحميل...","لا توجد بيانات")):_(`لم يتم العثور على المورد المحلي: ${T}`,"مورد غير موجود"))}catch(re){console.error("=== LOCAL SUPPLIER SEARCH ERROR ==="),console.error("Error details:",re),console.error("Error message:",re.message),_(`خطأ في البحث عن المورد المحلي: ${re.message}`,"خطأ في البحث")}},xn=()=>{console.log("Called by:",new Error().stack),ee(!1),oe(null)},is=T=>{z(T)},Un=()=>{Q&&be(T=>{console.log("Before supplier selection - preserving file:",T.quotationFile?.name);const re={...T,supplier:Q.id,supplierName:Q.name};return console.log("After supplier selection - file preserved:",re.quotationFile?.name),re}),O(!1),z(null)},Xt=T=>{console.log("File details:",{name:T?.name,size:T?.size,type:T?.type,lastModified:T?.lastModified}),l.fileUpload&&c(re=>({...re,fileUpload:""})),be(re=>{const he={...re,quotationFile:T};return console.log("Updated priceQuoteData with file:",{hasFile:!!he.quotationFile,fileName:he.quotationFile?.name}),he})},yn=T=>{const{name:re,value:he,type:de}=T.target;de!=="file"&&be(re==="supplierType"?xe=>({...xe,[re]:he,supplier:"",supplierName:""}):xe=>({...xe,[re]:he}))},Zn=async T=>{if(T.preventDefault(),console.log("Form element:",T.target),console.log("Current priceQuoteData:",Y),console.log("Editing quote ID:",M),!Y.supplierName){c(xe=>({...xe,fileUpload:"يجب اختيار المورد أولاً"}));return}if(!Y.date){c(xe=>({...xe,fileUpload:"يجب إدخال تاريخ العرض"}));return}if(!Y.price){c(xe=>({...xe,fileUpload:"يجب إدخال السعر"}));return}const re=new FormData(T.target),he=re.get("quotationFile");console.log("File from form directly:",he),console.log("File from state:",Y.quotationFile);const de=Y.quotationFile||he;console.log("File to upload:",de),console.log("File upload details:",{exists:!!de,isFile:de instanceof File,name:de?.name,size:de?.size,type:de?.type,lastModified:de?.lastModified});try{if(m(!0),!M&&(!de||de.size===0))throw new Error("يجب اختيار ملف عرض السعر");let xe=null;if(de&&typeof de!="string"&&de.size>0){console.log("Starting file upload:",de.name);try{_r.validateFile(de,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}),console.log("File validation passed")}catch(Ue){throw console.error("File validation failed:",Ue),new Error(Ue.message)}console.log("Attempting file upload to Firebase...");try{const Ue=de.name.split(".").pop()||"pdf",bt=Y.supplierName?`عرض سعر ${Y.supplierName}.${Ue}`:de.name;console.log("Uploading with custom name:",bt),xe=await _r.uploadFileWithCustomName(de,"quotations",bt),console.log("File uploaded successfully:",xe)}catch(Ue){throw console.error("Firebase upload failed:",Ue),new Error(`فشل في رفع الملف: ${Ue.message}`)}}if(M)console.log("Updating existing price quote with ID:",M),ce(Ue=>{const bt=Ue.map(pt=>pt.id===M?{...pt,supplierType:Y.supplierType,supplier:Y.supplier,supplierName:Y.supplierName,date:Y.date,price:Y.price,quotationFile:xe?xe.path:pt.quotationFile,quotationFileURL:xe?xe.url:pt.quotationFileURL,quotationFileName:xe?xe.originalName:pt.quotationFileName,quotationFileSize:xe?xe.size:pt.quotationFileSize,quotationFileType:xe?xe.type:pt.quotationFileType,updatedAt:new Date}:pt);return console.log("Updated price quotes:",bt),setTimeout(()=>{R(bt)},100),bt});else{const Ue={id:Date.now().toString(),supplierType:Y.supplierType,supplier:Y.supplier,supplierName:Y.supplierName,date:Y.date,price:Y.price,quotationFile:xe?xe.path:null,quotationFileURL:xe?xe.url:null,quotationFileName:xe?xe.originalName:null,quotationFileSize:xe?xe.size:null,quotationFileType:xe?xe.type:null,createdAt:new Date};console.log("Adding new price quote:",Ue),ce(bt=>{const pt=[...bt,Ue];return console.log("Updated price quotes:",pt),setTimeout(()=>{R(pt)},100),pt})}l.priceQuotes&&c(Ue=>({...Ue,priceQuotes:""})),Ee(),B&&ne&&setTimeout(async()=>{try{console.log("Auto-saving local product after price quote change..."),ce(Ue=>{const bt={...re,priceQuotes:Ue};return vr.updateLocalProduct(ne,bt).then(()=>{console.log("Auto-save successful")}).catch(pt=>{console.error("Auto-save failed:",pt),_("فشل في الحفظ التلقائي","خطأ في الحفظ")}),Ue})}catch(Ue){console.error("Auto-save setup error:",Ue)}},200)}catch(xe){console.error("Error uploading file:",xe),c(Ue=>({...Ue,fileUpload:xe.message||"فشل في رفع الملف. حاول مرة أخرى."}))}finally{m(!1)}},es=T=>{console.log("Starting edit for quote:",T),H(T.id),be({supplierType:T.supplierType||"local",supplier:T.supplier||"",supplierName:T.supplierName||"",date:T.date||"",price:T.price||"",quotationFile:T.quotationFile||null}),j(!0)},an=T=>{if(console.log("Price quote delete button clicked:",T),console.log("Quote ID:",T?.id),console.log("Quote keys:",T?Object.keys(T):"quote is null/undefined"),!T||!T.id){console.error("Invalid quote object - missing quote or ID:",{quote:T,hasId:!!T?.id,quoteId:T?.id,quoteType:typeof T}),_("خطأ في بيانات عرض السعر","خطأ");return}E(`هل أنت متأكد من حذف عرض السعر؟

${T.supplierName} - ${T.price} ريال`,()=>Bt(T),"تأكيد حذف عرض السعر")},Bt=async T=>{if(console.log("Delete confirmation called for quote:",T),console.log("Confirmation - Quote ID:",T?.id),console.log("Confirmation - Quote keys:",T?Object.keys(T):"quote is null/undefined"),console.log("Is editing mode:",B),console.log("Local product ID:",ne),console.log("Form data name:",s.name),!T||!T.id){console.error("Invalid quote in confirmation - missing quote or ID:",{quote:T,hasId:!!T?.id,quoteId:T?.id,quoteType:typeof T}),_("خطأ في بيانات عرض السعر","خطأ"),U(!1);return}try{if(U(!0),console.log("Starting delete process..."),console.log("Moving to trash..."),B&&ne){const he={...T,localProductId:ne,localProductName:s.name};console.log("Quote with context for trash:",he),console.log("Calling SimpleTrashService.moveToTrash...");const de=await Gn.moveToTrash(he,"price_quotes");console.log("Trash service result:",de),console.log("Moved to trash successfully")}else console.log("Skipping trash - local product not saved yet (isEditing:",B,", id:",ne,")");const re=me();console.log("Logging activity with current user:",re),q("task",`${re.name} حذف عرض سعر`,`تم حذف عرض السعر: ${T.supplierName} - ${T.price} ريال`),console.log("Updating local state..."),console.log("Current price quotes before deletion:",F),ce(he=>{const de=he.filter(xe=>xe.id!==T.id);return console.log("Filtered quotes:",de.length,"from",he.length),console.log("Removed quote with ID:",T.id),console.log("Remaining quotes:",de.map(xe=>({id:xe.id,supplierName:xe.supplierName}))),setTimeout(()=>{R(de)},100),de}),console.log("Showing success message..."),B&&ne?ie(`تم نقل عرض السعر للمهملات: ${T.supplierName}`,"تم النقل للمهملات"):ie(`تم حذف عرض السعر: ${T.supplierName}`,"تم الحذف"),console.log("Delete process completed successfully"),B&&ne&&setTimeout(async()=>{try{console.log("Auto-saving local product after price quote deletion..."),ce(he=>{const de={...s,priceQuotes:he};return vr.updateLocalProduct(ne,de).then(()=>{console.log("Auto-save after deletion successful")}).catch(xe=>{console.error("Auto-save after deletion failed:",xe)}),he})}catch(he){console.error("Auto-save after deletion setup error:",he)}},200)}catch(re){console.error("Error deleting price quote:",re),console.error("Error stack:",re.stack),_(`فشل في حذف عرض السعر: ${re.message||"خطأ غير معروف"}`,"خطأ في الحذف")}finally{console.log("Setting deleting to false"),U(!1)}},Nn=()=>k.filter(he=>{const de=he.hasOwnProperty("active"),xe=he.hasOwnProperty("status");return de?he.active===!0:xe?he.status==="active":!0});return p?n.jsx(Dn,{show:!0,message:"جار تحميل بيانات المنتج المحلي..."}):n.jsxs(rn,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Kn,{onToggle:C}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsxs("div",{style:{position:"sticky",top:0,zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item",children:n.jsx("a",{href:"/local-products",className:"text-decoration-none text-primary",children:"بنود المناقصات"})}),n.jsx("li",{className:"breadcrumb-item",children:n.jsx("a",{href:"/local-products",className:"text-decoration-none text-primary",children:"منتج محلي"})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:B?"تعديل منتج محلي":"إضافة منتج محلي جديد"})]})}),n.jsx(Yn,{})]}),n.jsxs("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:[n.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"60px"},children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsxs("div",{className:"card-header bg-white border-bottom py-4 d-flex align-items-center",children:[n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),B?"تعديل المنتج المحلي":"إضافة منتج محلي جديد"]}),n.jsx("div",{style:{flex:1}}),n.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:Ot,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:"1",paddingTop:"2px"},children:"عرض سعر"})]}),n.jsxs("form",{onSubmit:Ke,children:[n.jsxs("div",{className:"card-body p-4",children:[l.submit&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.submit]}),n.jsxs("div",{className:"row mb-4",children:[n.jsx("div",{className:"col-12",children:n.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[n.jsx("i",{className:"bi bi-info-circle me-2"}),"المعلومات الأساسية"]})}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"اسم المنتج المحلي *"}),n.jsx("input",{type:"text",className:`form-control ${l.name?"is-invalid":""}`,name:"name",value:s.name,onChange:Ge,placeholder:"أدخل اسم المنتج المحلي"}),l.name&&n.jsx("div",{className:"invalid-feedback",children:l.name})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الفئة *"}),n.jsx(Hx,{name:"category",value:s.category,onChange:Ge,required:!0,className:`form-select ${l.category?"is-invalid":""}`,placeholder:"اختر الفئة",showDescription:!0}),l.category&&n.jsx("div",{className:"invalid-feedback",children:l.category})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الوحدة *"}),n.jsx(Gx,{name:"unit",value:s.unit,onChange:Ge,required:!0,className:`form-select ${l.unit?"is-invalid":""}`,placeholder:"اختر الوحدة",showDescription:!0}),l.unit&&n.jsx("div",{className:"invalid-feedback",children:l.unit})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsxs("label",{className:"form-label fw-bold",children:["السعر (ريال) *",n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:F.length>0?"أقل سعر تلقائي":"سعر تلقائي"})]}),n.jsx("input",{type:"number",step:"0.01",min:"0",className:`form-control ${l.price?"is-invalid":""}`,name:"price",value:s.price,onChange:null,onKeyPress:null,placeholder:"0.00",readOnly:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"}}),l.price&&n.jsx("div",{className:"invalid-feedback",children:l.price}),n.jsx("div",{className:"mt-1",children:n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),F.length>0?"السعر محدد تلقائياً من أقل عرض سعر في القائمة":"السعر سيتم تحديده تلقائياً عند إضافة عروض الأسعار"]})})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الوصف"}),n.jsx("textarea",{className:"form-control",name:"description",value:s.description,onChange:Ge,rows:"3",placeholder:"وصف المنتج المحلي"})]}),n.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:n.jsxs("div",{className:"d-flex align-items-center gap-2",children:[n.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"نشط":"غير نشط"}),n.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"localProductActiveSwitch",name:"active",checked:s.active,onChange:Ge,style:{width:"48px",height:"24px",marginRight:"8px"}})]})})]}),n.jsxs("div",{className:"row mb-4",children:[n.jsxs("div",{className:"col-12",children:[n.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[n.jsx("i",{className:"bi bi-receipt me-2"}),"عروض الأسعار"]}),l.priceQuotes&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.priceQuotes]})]}),F.length>0&&n.jsx("div",{className:"col-12",children:n.jsxs("div",{className:"card mb-3 border-0 shadow-lg",style:{background:"linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%)",borderRadius:"16px"},children:[n.jsx("div",{className:"card-header border-0",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"16px 16px 0 0",padding:"20px"},children:n.jsxs("h5",{className:"card-title text-white mb-0 d-flex align-items-center",children:[n.jsx("div",{className:"me-3",style:{background:"rgba(255,255,255,0.2)",borderRadius:"12px",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsx("i",{className:"bi bi-bar-chart-fill fs-5"})}),n.jsx("span",{className:"fw-bold",children:"مقارنة أسعار الموردين"}),n.jsxs("span",{className:"badge bg-light text-primary ms-3",style:{borderRadius:"20px",fontSize:"12px",padding:"6px 12px"},children:[F.length," موردين"]})]})}),n.jsx("div",{className:"card-body",style:{padding:"30px"},children:n.jsx("div",{style:{minHeight:"625px",direction:"ltr"},children:n.jsx("div",{style:{width:"100%",height:"605px",position:"relative"},children:(()=>{F.map(Ue=>parseFloat(Ue.price)||0);const T=640,de=F.length*150,xe=Math.max(T,de);return n.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${xe+160} 605`,style:{direction:"ltr"},children:[n.jsxs("defs",{children:[n.jsxs("linearGradient",{id:"chartBgLocal",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#ffffff",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#f8f9ff",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"bestPriceGradientLocal",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#00f5a0",stopOpacity:1}}),n.jsx("stop",{offset:"30%",style:{stopColor:"#00d9f5",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#0066cc",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"regularPriceGradientLocal",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),n.jsx("stop",{offset:"50%",style:{stopColor:"#764ba2",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#f093fb",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient0Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#764ba2",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient1Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#f093fb",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#f5576c",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient2Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#4facfe",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#00f2fe",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient3Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#a8edea",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#fed6e3",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient4Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#ffecd2",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#fcb69f",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient5Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#a18cd1",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#fbc2eb",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient6Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#fad0c4",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#ffd1ff",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient7Local",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#a1c4fd",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#c2e9fb",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"metallicShineLocal",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),n.jsx("stop",{offset:"45%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),n.jsx("stop",{offset:"50%",style:{stopColor:"rgba(255,255,255,0.8)",stopOpacity:1}}),n.jsx("stop",{offset:"55%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),n.jsx("stop",{offset:"100%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}})]}),n.jsx("filter",{id:"dropShadowLocal",x:"-50%",y:"-50%",width:"200%",height:"200%",children:n.jsx("feDropShadow",{dx:"0",dy:"6",stdDeviation:"8",floodColor:"rgba(0,0,0,0.15)"})}),n.jsxs("filter",{id:"premiumGlowLocal",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{stdDeviation:"5",result:"coloredBlur"}),n.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0 0 0  0 1 1 0 0  0 0 1 0 0  0 0 0 1 0"}),n.jsxs("feMerge",{children:[n.jsx("feMergeNode",{in:"coloredBlur"}),n.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),n.jsxs("filter",{id:"bevelEffectLocal",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2",result:"blur"}),n.jsx("feSpecularLighting",{in:"blur",result:"specOut",surfaceScale:"5",specularConstant:"0.8",specularExponent:"20","lighting-color":"white",children:n.jsx("fePointLight",{x:"-50",y:"-50",z:"200"})}),n.jsx("feComposite",{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut2"}),n.jsx("feComposite",{in:"SourceGraphic",in2:"specOut2",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"})]}),n.jsxs("filter",{id:"pulseGlowLocal",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),n.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0.8 0 0  0 1 1 0 0  0 0 1 0.2 0  0 0 0 1 0"}),n.jsxs("feMerge",{children:[n.jsx("feMergeNode",{in:"coloredBlur"}),n.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),n.jsx("rect",{width:xe+160,height:"605",fill:"url(#chartBgLocal)",rx:"12",style:{filter:"drop-shadow(0 4px 20px rgba(0,0,0,0.1))"}}),n.jsx("g",{transform:"translate(80, 40)",children:(()=>{const Ue=F.map(Oe=>parseFloat(Oe.price)||0),bt=Math.max(...Ue),pt=Math.min(...Ue),Vs=bt-pt||1,Ne=300,ue=640,Te=F.length*150,We=Math.max(ue,Te),ye=Math.min(We/F.length*.6,80),ze=We/F.length;return n.jsxs(n.Fragment,{children:[[0,1,2,3,4,5].map(Oe=>{const Ze=130+(Ne-130)/5*Oe,Ve=(1-Oe/5)*Math.max(...Ue);return n.jsxs("g",{children:[n.jsx("line",{x1:"0",y1:Ze,x2:We,y2:Ze,stroke:Oe===5?"#007bff":"rgba(123, 140, 252, 0.2)",strokeWidth:Oe===5?"2":"1",strokeDasharray:Oe===5?"0":"5,5"}),n.jsx("text",{x:"-15",y:Ze+5,textAnchor:"end",fontSize:"12",fill:"#4f46e5",fontWeight:"600",children:Math.round(Ve).toLocaleString()})]},Oe)}),F.map((Oe,nt)=>{const Ze=parseFloat(Oe.price)||0;let Je;if(Vs>0){const fs=Ne-130,dr=Ze/Math.max(...Ue);Je=Math.max(dr*fs,15)}else Je=(Ne-130)*.8;const Ve=ze*nt+(ze-ye)/2,ke=Ne-Je,et=Ze===pt;let bn;return et?bn="bestPriceGradientLocal":bn=`gradient${nt%8}Local`,n.jsxs("g",{children:[n.jsx("rect",{x:Ve+4,y:ke+8,width:ye,height:Je,fill:"rgba(0,0,0,0.05)",rx:"10"}),n.jsx("rect",{x:Ve+2,y:ke+4,width:ye,height:Je,fill:"rgba(0,0,0,0.08)",rx:"9"}),n.jsxs("rect",{x:Ve,y:ke,width:ye,height:Je,fill:`url(#${bn})`,rx:"10",filter:et?"url(#premiumGlowLocal)":"url(#bevelEffectLocal)",style:{transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer"},children:[n.jsx("animate",{attributeName:"height",from:"0",to:Je,dur:"2s",begin:`${nt*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),n.jsx("animate",{attributeName:"y",from:Ne,to:ke,dur:"2s",begin:`${nt*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),et&&n.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;1.05;1",dur:"3s",repeatCount:"indefinite",begin:`${nt*.3+2}s`})]}),n.jsx("rect",{x:Ve+2,y:ke+2,width:ye-4,height:Math.max(Je/2.5,30),fill:"url(#metallicShineLocal)",rx:"8",opacity:"0.6",children:n.jsx("animateTransform",{attributeName:"transform",type:"translate",values:`-${ye};${ye}`,dur:"4s",repeatCount:"indefinite",begin:`${nt*.5+3}s`})}),n.jsx("rect",{x:Ve+3,y:ke+3,width:Math.max(ye/4,8),height:Math.max(Je-6,20),fill:"rgba(255,255,255,0.4)",rx:"6"}),n.jsx("rect",{x:Ve+ye-6,y:ke+6,width:"3",height:Math.max(Je-12,15),fill:"rgba(255,255,255,0.2)",rx:"1.5"}),n.jsxs("g",{children:[n.jsx("rect",{x:Ve+ye/2-30,y:ke-28,width:"60",height:"20",fill:"rgba(0,0,0,0.8)",rx:"10",opacity:"0.9"}),n.jsxs("text",{x:Ve+ye/2,y:ke-15,textAnchor:"middle",fontSize:"12",fill:"white",fontWeight:"bold",children:["ر.س ",Ze.toLocaleString()]})]}),n.jsx("g",{children:(()=>{const fs=Oe.supplierName,dr=fs.length*7,vs=Math.max(dr+20,ye+10);return n.jsxs(n.Fragment,{children:[n.jsx("rect",{x:Ve+ye/2-vs/2,y:Ne+30,width:vs,height:22,fill:"rgba(255,255,255,0.96)",rx:"11",stroke:"rgba(0,123,255,0.5)",strokeWidth:"1.5",filter:"url(#dropShadowLocal)"}),n.jsx("text",{x:Ve+ye/2,y:Ne+41,textAnchor:"middle",fontSize:"11",fill:"#1e40af",fontWeight:"700",style:{fontFamily:"system-ui, -apple-system, sans-serif",letterSpacing:"0.2px"},dominantBaseline:"middle",children:fs})]})})()}),et&&n.jsxs("g",{children:[n.jsx("circle",{cx:Ve+ye/2,cy:ke-100,r:"18",fill:"linear-gradient(135deg, #ffd700 0%, #ffb300 100%)",stroke:"#fff",strokeWidth:"3",filter:"url(#dropShadowLocal)"}),n.jsx("text",{x:Ve+ye/2,y:ke-95,textAnchor:"middle",fontSize:"16",fill:"#fff",children:"👑"}),n.jsx("rect",{x:Ve-5,y:ke-70,width:ye+10,height:"20",fill:"#28a745",rx:"10",opacity:"0.9"}),n.jsx("text",{x:Ve+ye/2,y:ke-57,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:"أفضل سعر"})]})]},Oe.id)}),n.jsx("text",{x:We/2,y:30,textAnchor:"middle",fontSize:"16",fill:"url(#bestPriceGradientLocal)",fontWeight:"bold",direction:"rtl",children:"مقارنة الأسعار بالريال السعودي"}),n.jsxs("g",{transform:`translate(${We/2}, ${Ne+110})`,children:[n.jsx("rect",{x:"-200",y:"-25",width:"400",height:"145",fill:"rgba(255,255,255,0.98)",rx:"20",stroke:"url(#bestPriceGradientLocal)",strokeWidth:"2",filter:"url(#dropShadowLocal)"}),n.jsx("text",{x:"0",y:"-5",textAnchor:"middle",fontSize:"16",fill:"#1f2937",fontWeight:"800",letterSpacing:"0.5px",children:"مؤشر الأسعار"}),n.jsxs("g",{transform:"translate(0, 15)",children:[n.jsxs("g",{transform:"translate(-125, 0)",children:[n.jsxs("g",{transform:"translate(0, 0)",children:[n.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#bestPriceGradientLocal)",rx:"7",filter:"url(#premiumGlowLocal)"}),n.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#059669",fontWeight:"700",children:"أفضل سعر"}),n.jsx("text",{x:"80",y:"13",fontSize:"18",children:"👑"})]}),n.jsx("line",{x1:"110",y1:"-5",x2:"110",y2:"19",stroke:"rgba(0,0,0,0.15)",strokeWidth:"2"}),n.jsxs("g",{transform:"translate(125, 0)",children:[n.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#regularPriceGradientLocal)",rx:"7"}),n.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#6366f1",fontWeight:"700",children:"أسعار أخرى"}),n.jsx("text",{x:"90",y:"13",fontSize:"16",children:"📊"})]})]}),n.jsxs("g",{transform:"translate(0, 40)",children:[n.jsx("rect",{x:"-170",y:"-8",width:"340",height:"22",fill:"rgba(59, 130, 246, 0.08)",rx:"11"}),n.jsxs("text",{x:"0",y:"5",textAnchor:"middle",fontSize:"14",fill:"#1e40af",fontWeight:"700",children:["💰 الفرق في السعر: ",(Math.max(...Ue)-Math.min(...Ue)).toLocaleString()," ر.س"]})]}),n.jsx("g",{transform:"translate(0, 90)",children:n.jsxs("text",{x:"0",y:"0",textAnchor:"middle",fontSize:"12",fill:"#6b7280",fontWeight:"600",children:["📈 أعلى سعر: ",Math.max(...Ue).toLocaleString()," ر.س  •  📉 أقل سعر: ",Math.min(...Ue).toLocaleString()," ر.س"]})})]})]})]})})()})]})})()})})})]})}),n.jsx("div",{className:"col-12",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsx("div",{className:"d-flex justify-content-between align-items-center",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-list-ul text-primary me-2"}),"قائمة عروض الأسعار (",F.length,")"]})})}),n.jsx("div",{className:"card-body p-0",children:F.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-receipt fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد عروض أسعار"}),n.jsx("p",{className:"text-muted",children:"لم يتم إضافة أي عروض أسعار بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"المورد"}),n.jsx("th",{className:"text-center",children:"النوع"}),n.jsx("th",{className:"text-center",children:"التاريخ"}),n.jsx("th",{className:"text-center",children:"السعر (ريال)"}),n.jsx("th",{className:"text-center",children:"الملف"}),n.jsx("th",{className:"text-center",style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:F.map((T,re)=>{const he=F.length>=1&&F.reduce((de,xe)=>{const Ue=parseFloat(de.price)||0;return(parseFloat(xe.price)||0)<Ue?xe:de}).id===T.id;return n.jsxs("tr",{className:he?"table-success":"",children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:re+1})}),n.jsxs("td",{className:"text-center",children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},onClick:de=>{de.preventDefault(),de.stopPropagation(),console.log("Button clicked, calling handleSupplierEdit..."),hn(T.supplierName)},title:`تحرير مورد: ${T.supplierName}`,type:"button",children:T.supplierName}),he&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:`badge ${T.supplierType==="local"?"bg-success":"bg-info"}`,children:T.supplierType==="local"?"محلي":"أجنبي"})}),n.jsx("td",{className:"text-center",children:T.date}),n.jsxs("td",{className:"text-center",children:[T.price," ريال",he&&n.jsx("i",{className:"bi bi-arrow-down-circle-fill text-success ms-2",title:"أقل سعر"})]}),n.jsx("td",{className:"text-center",children:T.quotationFile&&n.jsx(qx,{size:25,clickable:!0,onClick:()=>{T.quotationFileURL?window.open(T.quotationFileURL,"_blank"):(console.log("No file URL available for:",T.quotationFile),alert("الملف غير متوفر للعرض"))},title:`عرض الملف: ${T.quotationFileName||T.quotationFile}`})}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>es(T),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>an(T),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},T.id)})})]})})})]})})]})]}),n.jsx("div",{className:"card-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsxs("div",{className:"d-flex gap-3",style:{marginBottom:"15px"},children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:ft,disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?"جار الحفظ...":n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),B?"تحديث":"حفظ"]})})]})})]})]})}),n.jsx("div",{className:"app-footer",style:{textAlign:"center",padding:"20px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",marginTop:"20px"},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]})]}),!r&&t&&n.jsx(Xn,{rtl:!0}),!r&&t&&n.jsx(Jn,{}),w&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:n.jsx("div",{className:"modal-dialog modal-lg",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0 pb-2",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-receipt text-primary me-2"}),"طلب عرض سعر"]}),n.jsx("button",{type:"button",className:"btn-close",onClick:Ee,style:{fontSize:"12px"}})]}),n.jsxs("form",{onSubmit:Zn,onReset:T=>T.preventDefault(),children:[n.jsxs("div",{className:"modal-body px-4",children:[l.fileUpload&&n.jsxs("div",{className:"alert alert-danger mb-3",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.fileUpload]}),n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"نوع المورد *"}),n.jsx("select",{className:"form-select",name:"supplierType",value:"local",onChange:yn,required:!0,disabled:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"},children:n.jsx("option",{value:"local",children:"مورد محلي"})})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"المورد *"}),n.jsxs("div",{className:"form-control d-flex align-items-center justify-content-between",onClick:it,style:{cursor:"pointer",backgroundColor:"#f8f9fa"},children:[n.jsx("span",{className:Y.supplierName?"text-dark":"text-muted",children:Y.supplierName||"اختر المورد"}),n.jsx("i",{className:"bi bi-chevron-down"})]})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"تاريخ العرض *"}),n.jsx("input",{type:"date",className:"form-control",name:"date",value:Y.date,onChange:yn,required:!0})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"السعر (ريال) *"}),n.jsx("input",{type:"number",step:"0.01",min:"0",className:"form-control",name:"price",value:Y.price,onChange:yn,onKeyPress:T=>{(T.key==="-"||T.key!=="."&&T.key!=="Backspace"&&(T.key<"0"||T.key>"9"))&&T.preventDefault()},placeholder:"0.00",required:!0})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsxs("label",{className:"form-label fw-bold",children:["رفع عرض السعر ",M?"(اختياري)":"*"]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.jpg,.png,.jpeg",style:{display:"none"},ref:T=>{T&&(T.onclick=()=>{T.value=""},T.onchange=re=>{const he=re.target.files?.[0];he&&Xt(he)})},id:`fileInput_${w}_${Date.now()}`}),n.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>{const T=document.querySelector(`#fileInput_${w}_${Date.now()}`);if(T)T.click();else{const re=document.createElement("input");re.type="file",re.accept=".pdf,.doc,.docx,.jpg,.png,.jpeg",re.style.display="none",re.onchange=he=>{const de=he.target.files?.[0];de&&Xt(de),document.body.removeChild(re)},document.body.appendChild(re),re.click()}},style:{borderRadius:"6px",height:"38px",minWidth:"150px"},children:[n.jsx("i",{className:"bi bi-upload me-2"}),"اختر ملف"]})]}),Y.quotationFile&&n.jsxs("div",{className:"alert alert-success py-2 mb-2",style:{position:"relative"},children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-check-circle me-2 text-success"}),n.jsxs("div",{className:"flex-grow-1",children:[n.jsx("strong",{children:Y.quotationFile.name?Y.supplierName?`عرض سعر ${Y.supplierName}.${Y.quotationFile.name.split(".").pop()}`:Y.quotationFile.name:M?Y.supplierName?`عرض سعر ${Y.supplierName}.pdf`:F.find(T=>T.id===M)?.quotationFileName||"ملف موجود":"ملف موجود"}),n.jsxs("small",{className:"text-muted ms-2",children:["(",Y.quotationFile.size?Math.round(Y.quotationFile.size/1024):M?Math.round((F.find(T=>T.id===M)?.quotationFileSize||0)/1024):0," KB)"]})]})]}),n.jsx("button",{type:"button",className:"btn-close btn-close-sm",onClick:()=>{be(T=>({...T,quotationFile:null}))},title:"إزالة الملف",style:{position:"absolute",top:"8px",left:"8px",width:"20px",height:"20px",fontSize:"10px",opacity:.7},onMouseEnter:T=>T.target.style.opacity=1,onMouseLeave:T=>T.target.style.opacity=.7})]}),M&&!Y.quotationFile&&n.jsxs("div",{className:"alert alert-info py-2 mb-2",children:[n.jsx("i",{className:"bi bi-info-circle me-2"}),n.jsxs("small",{children:["ملف موجود: ",F.find(T=>T.id===M)?.quotationFileName||"ملف موجود"]})]}),!Y.quotationFile&&!M&&n.jsx("div",{className:"mt-1",children:n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),"يجب اختيار ملف PDF أو Word أو صورة"]})})]})]})]}),n.jsx("div",{className:"modal-footer border-0 pt-0 d-flex justify-content-center",style:{marginBottom:"10px"},children:n.jsxs("div",{className:"d-flex gap-3",children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:Ee,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"10px",height:"10px"}}),"رفع..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),"إرسال"]})})]})})]})]})})}),D&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:n.jsx("div",{className:"modal-dialog modal-xl",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0 pb-2",style:{marginBottom:"5px"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-people-fill text-primary me-2"}),"اختر مورد محلي",n.jsxs("span",{className:"text-muted ms-2",children:["(",Nn().length,")"]})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:Nt,style:{fontSize:"12px"}})]}),n.jsx("div",{className:"modal-body p-0",children:Nn().length>0?n.jsx("div",{className:"table-responsive suppliers-table",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"50px"}}),n.jsx("th",{children:"اسم المورد"}),n.jsx("th",{children:"البريد الإلكتروني"}),n.jsx("th",{children:"الهاتف"}),n.jsx("th",{children:"المدينة"})]})}),n.jsx("tbody",{children:Nn().map(T=>n.jsxs("tr",{onClick:()=>is(T),style:{cursor:"pointer"},children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input custom-radio",type:"radio",name:"selectedSupplier",checked:Q?.id===T.id,onChange:()=>{},style:{pointerEvents:"none",width:"18px",height:"18px",borderWidth:"2px",borderColor:Q?.id===T.id?"#007bff":"#dee2e6"}})})}),n.jsx("td",{children:n.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},children:T.name})}),n.jsx("td",{children:n.jsx("a",{href:`mailto:${T.email}`,className:"text-decoration-none",children:T.email})}),n.jsx("td",{children:T.phone}),n.jsx("td",{children:T.city||"-"})]},T.id))})]})}):n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-people fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد موردين"}),n.jsx("p",{className:"text-muted",children:"لا توجد موردين محليين مسجلين"})]})}),n.jsx("div",{className:"modal-footer border-0 d-flex justify-content-center",style:{marginTop:"15px"},children:n.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:Un,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",margin:"20px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:"تأكيد"})})]})})}),I&&J&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:T=>{T.target===T.currentTarget&&xn()},children:n.jsx("div",{className:"modal-dialog modal-lg",onClick:T=>T.stopPropagation(),children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"معلومات المورد - ",J?.name,n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:"محلي"})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:xn})]}),n.jsx("div",{className:"modal-body",children:n.jsxs("div",{className:"row g-3",children:[n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"اسم المورد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J?.name})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البريد الإلكتروني"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J?.email||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الهاتف"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:J?.phone||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"المدينة"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J?.city||""})]}),n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"العنوان"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J?.address||""})]}),J?.taxNumber&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"الرقم الضريبي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J.taxNumber})]}),J?.bankAccount&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الحساب البنكي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J.bankAccount})]}),J?.notes&&n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"ملاحظات"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J.notes})]})]})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsx("div",{className:"d-flex gap-3",children:n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:xn,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إغلاق"})})})]})})})]}),n.jsx(Dn,{show:u,message:B?"جار تحديث المنتج المحلي...":"جار حفظ المنتج المحلي..."}),n.jsx(Rn,{show:se.show,onClose:fe,title:se.title,message:se.message,type:se.type,onConfirm:se.onConfirm,confirmText:se.confirmText,cancelText:se.cancelText,showCancel:se.showCancel}),n.jsx(Qx,{position:"bottom-right",showDetails:!0})]})}function $E(){return n.jsx(sn,{children:n.jsx(q4,{})})}const H4=({refreshTrigger:r})=>{const[e,t]=N.useState([]),[s,a]=N.useState(!0),[l,c]=N.useState(null),[u,m]=N.useState(""),[p,b]=N.useState([]),[w,j]=N.useState(!1),[D,O]=N.useState(!1),[Q,z]=N.useState(!1),[I,ee]=N.useState(null),[J,oe]=N.useState([]),[Y,be]=N.useState([]),M=ms(),{logActivity:H,getCurrentUser:k}=vn(),{alertConfig:$,closeAlert:X,showSuccess:te,showError:F,showConfirm:ce}=Pn(),{currentPage:Be,totalPages:U,paginatedItems:se,handlePageChange:fe,resetPage:ie,totalItems:_,itemsPerPage:E}=wa(p,30);N.useEffect(()=>{R(),V()},[]),N.useEffect(()=>{r&&R()},[r]),N.useEffect(()=>{if(u.trim()){const C=e.filter(Z=>Z.name?.toLowerCase().includes(u.toLowerCase())||Z.category?.toLowerCase().includes(u.toLowerCase())||Z.description?.toLowerCase().includes(u.toLowerCase())||Z.supplier?.toLowerCase().includes(u.toLowerCase()));b(C)}else b(e);ie()},[u,e,ie]);const R=async()=>{try{a(!0);const C=await Nr.getAllForeignProducts();t(C),c(null)}catch(C){c(C.message)}finally{a(!1)}},V=async()=>{try{const[C,Z]=await Promise.all([Ji.getAllSuppliers(),Zi.getAllSuppliers()]);oe(C),be(Z)}catch(C){console.error("Error loading suppliers:",C)}},ne=async(C,Z)=>{try{if(Z==="local"){const je=J.find(Ge=>Ge.name===C);je&&(ee(je),O(!0))}else if(Z==="foreign"){const je=Y.find(Ge=>Ge.name===C);je&&(ee(je),z(!0))}}catch(je){console.error("Error opening supplier modal:",je)}},B=()=>{O(!1),z(!1),ee(null)},q=C=>{ce(`هل أنت متأكد من حذف هذا المنتج المستورد؟

${C.name}`,()=>me(C),"تأكيد حذف المنتج المستورد")},me=async C=>{try{j(!0),await Gn.moveToTrash(C,"foreignproducts"),await Nr.deleteForeignProduct(C.id);const Z=k();H("task",`${Z.name} حذف منتج مستورد`,`تم حذف المنتج المستورد: ${C.name}`),await R(),te(`تم نقل المنتج المستورد للمهملات: ${C.name}`,"تم النقل للمهملات")}catch(Z){c(Z.message),F(`فشل في نقل المنتج المستورد للمهملات: ${Z.message}`,"خطأ في النقل")}finally{j(!1)}};return s?n.jsx(Dn,{show:!0,message:"جار تحميل بيانات المنتجات المستوردة...",overlay:!1}):l?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:l}),n.jsxs("button",{className:"btn btn-primary",onClick:R,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs("div",{className:"card shadow-sm","data-list":"foreign-products",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),"قائمة المنتجات المستوردة (",p.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المنتجات المستوردة...",value:u,onChange:C=>m(C.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),n.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:()=>M("/foreign-products/add"),style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"إضافة منتج مستورد جديد"]})]})})]})}),n.jsxs("div",{className:"card-body p-0",children:[p.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-box-seam fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد منتجات مستوردة"}),n.jsx("p",{className:"text-muted",children:u?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي منتجات مستوردة بعد"}),!u&&n.jsxs("button",{className:"btn btn-primary",onClick:()=>M("/foreign-products/add"),children:[n.jsx("i",{className:"bi bi-plus-lg me-1"}),"إضافة أول منتج مستورد"]})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"اسم المنتج"}),n.jsx("th",{className:"text-center",children:"الفئة"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر"}),n.jsx("th",{className:"text-center",children:"المورد"}),n.jsx("th",{className:"text-center",style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:se.map((C,Z)=>{let je=C.price,Ge=C.supplier,Ke=!1,ft=null,Ot=null;return C.priceQuotes&&Array.isArray(C.priceQuotes)&&C.priceQuotes.length>0&&(Ke=!0,Ot=C.priceQuotes.reduce((Ee,it)=>{const Nt=parseFloat(Ee.price)||0;return(parseFloat(it.price)||0)<Nt?it:Ee}),je=Ot.price,Ge=Ot.supplierName,ft=Ot.supplierType),n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(Be-1)*E+Z+1})}),n.jsx("td",{className:"text-center",children:n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary product-name-btn",onClick:Ee=>{if(Ee.preventDefault(),Ee.stopPropagation(),console.log("=== FOREIGN PRODUCT BUTTON CLICKED ==="),console.log("Product Name:",C.name),console.log("Product ID:",C.id),C.id){const it=`/foreign-products/edit/${C.id}`;console.log("Target URL:",it),console.log("🚀 FORCING NAVIGATION TO:",it),window.location.href=it}else console.error("Product ID is missing:",C),F("معرف المنتج مفقود، لا يمكن التنقل","خطأ في التنقل")},onMouseDown:Ee=>Ee.preventDefault(),style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0",userSelect:"none",pointerEvents:"auto",zIndex:"1"},title:`انقر للتعديل | Internal ID: ${C.internalId||"Not Set"} | Firebase ID: ${C.id||"Missing"}`,children:C.name})}),n.jsx("td",{className:"text-center",children:C.category||"-"}),n.jsx("td",{className:"text-center",children:C.unit||"-"}),n.jsx("td",{className:"text-center",children:je?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsxs("span",{children:[je," ريال"]}),Ke&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}):"-"}),n.jsx("td",{className:"text-center",children:Ge?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[Ke&&ft?n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",onClick:()=>ne(Ge,ft),style:{textDecoration:"none"},title:`فتح تفاصيل ${ft==="local"?"المورد المحلي":"المورد الأجنبي"}`,children:Ge}):n.jsx("span",{children:Ge}),Ke&&n.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:"أقل مورد"})]}):"-"}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>M(`/foreign-products/edit/${C.id}`),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>q(C),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},C.internalId||C.id)})})]})}),p.length>0&&n.jsx(va,{currentPage:Be,totalPages:U,onPageChange:fe,totalItems:_,itemsPerPage:E})]}),D&&I&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:C=>{C.target===C.currentTarget&&B()},children:n.jsx("div",{className:"modal-dialog modal-lg",onClick:C=>C.stopPropagation(),children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"معلومات المورد - ",I.name,n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:"محلي"})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:B})]}),n.jsx("div",{className:"modal-body",children:n.jsxs("div",{className:"row g-3",children:[n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"اسم المورد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.name})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البريد الإلكتروني"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.email||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الهاتف"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:I.phone||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"المدينة"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.city||""})]}),n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"العنوان"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.address||""})]}),I.taxNumber&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"الرقم الضريبي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.taxNumber})]}),I.bankAccount&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الحساب البنكي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.bankAccount})]}),I.notes&&n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"ملاحظات"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.notes})]})]})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:B,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إغلاق"})})]})})}),Q&&I&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:C=>{C.target===C.currentTarget&&B()},children:n.jsx("div",{className:"modal-dialog modal-lg",onClick:C=>C.stopPropagation(),children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"معلومات المورد - ",I.name,n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:"أجنبي"})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:B})]}),n.jsx("div",{className:"modal-body",children:n.jsxs("div",{className:"row g-3",children:[n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"اسم المورد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.name})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البريد الإلكتروني"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.email||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الهاتف"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:I.phone||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البلد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.country||""})]}),n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"العنوان"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.address||""})]}),I.taxNumber&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"الرقم الضريبي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.taxNumber})]}),I.bankAccount&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الحساب البنكي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.bankAccount})]}),I.notes&&n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"ملاحظات"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:I.notes})]})]})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:B,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إغلاق"})})]})})}),n.jsx(Rn,{show:$.show,onClose:X,title:$.title,message:$.message,type:$.type,onConfirm:$.onConfirm,confirmText:$.confirmText,cancelText:$.cancelText,showCancel:$.showCancel})]})};function G4(){const[r,e]=N.useState(!1),[t,s]=N.useState(0),{isTimelineVisible:a}=$n(),l=()=>{e(!r)};return n.jsx(sn,{children:n.jsx(rn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Kn,{onToggle:l}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!a?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المناقصات"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"منتج مستورد"})]})}),n.jsx(Yn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"foreign-products-table",children:n.jsx(H4,{refreshTrigger:t})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&a&&n.jsx(Xn,{rtl:!0}),!r&&a&&n.jsx(Jn,{})]})})})}function Q4(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(G4,{})})})}function W4(){const[r,e]=N.useState(!1),{isTimelineVisible:t}=$n(),[s,a]=N.useState({name:"",category:"",description:"",unit:"",price:"",supplier:"",stockQuantity:"",minimumStock:"",importLicense:"",customsCode:"",origin:"",notes:"",active:!0}),[l,c]=N.useState({}),[u,m]=N.useState(!1),[p,b]=N.useState(!1),[w,j]=N.useState(!1),[D,O]=N.useState(!1),[Q,z]=N.useState(null),[I,ee]=N.useState(!1),[J,oe]=N.useState(null),[Y,be]=N.useState({supplierType:"foreign",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),[M,H]=N.useState(null),[k,$]=N.useState([]),[X,te]=N.useState([]),[F,ce]=N.useState([]),[Be,U]=N.useState(!1),{alertConfig:se,closeAlert:fe,showSuccess:ie,showError:_,showConfirm:E}=Pn(),R=T=>{if(T.length===0)return;const re=T.reduce((he,de)=>{const xe=parseFloat(he.price)||0;return(parseFloat(de.price)||0)<xe?de:he});console.log("Lowest price quote found:",re),a(he=>({...he,price:re.price,supplier:re.supplierName}))},V=ms(),{id:ne}=ea(),B=!!ne,{logActivity:q,getCurrentUser:me}=vn(),C=()=>{e(!r)};N.useEffect(()=>{B&&je(),Z();const T=()=>{B&&ne&&(console.log("Window focused - refreshing foreign product data..."),je())};return window.addEventListener("focus",T),()=>{window.removeEventListener("focus",T)}},[ne]),N.useEffect(()=>{console.log("PriceQuoteData changed:",{hasFile:!!Y.quotationFile,fileName:Y.quotationFile?.name,supplierName:Y.supplierName,price:Y.price})},[Y]);const Z=async()=>{try{const[T,re]=await Promise.all([Ji.getAllSuppliers(),Zi.getAllSuppliers()]);$(T),te(re)}catch(T){console.error("Error loading suppliers:",T)}},je=async()=>{try{b(!0),console.log("Loading foreign product data for ID:",ne);const T=await Nr.getAllForeignProducts(),re=T.find(he=>he.id===ne);re?(console.log("Foreign product found:",re.name),a({name:re.name||"",category:re.category||"",description:re.description||"",unit:re.unit||"",price:re.price||"",supplier:re.supplier||"",stockQuantity:re.stockQuantity||"",minimumStock:re.minimumStock||"",importLicense:re.importLicense||"",customsCode:re.customsCode||"",origin:re.origin||"",notes:re.notes||"",active:re.active!==void 0?re.active:!0}),re.priceQuotes&&Array.isArray(re.priceQuotes)?(console.log("Loading price quotes for foreign product:",re.name,re.priceQuotes),console.log("Price quotes analysis:"),re.priceQuotes.forEach((he,de)=>{console.log(`Quote ${de}:`,{id:he.id,supplierName:he.supplierName,price:he.price,hasId:!!he.id,keys:Object.keys(he)})}),ce(re.priceQuotes),setTimeout(()=>{R(re.priceQuotes)},200)):console.log("No price quotes found for foreign product:",re.name)):(console.error("Foreign product not found with ID:",ne),console.log("Available foreign products:",T.map(he=>({id:he.id,name:he.name}))),c({submit:"المنتج المستورد غير موجود أو تم حذفه"}))}catch(T){console.error("Error loading foreign product:",T),c({submit:"فشل في تحميل بيانات المنتج المستورد: "+T.message})}finally{b(!1)}},Ge=T=>{const{name:re,value:he,type:de,checked:xe}=T.target;a(Ue=>({...Ue,[re]:de==="checkbox"?xe:he})),l[re]&&c(Ue=>({...Ue,[re]:""}))},Ke=async T=>{T.preventDefault();const re=Nr.validateForeignProductData(s);if(F.length===0&&(re.priceQuotes="يجب إضافة عرض سعر واحد على الأقل"),Object.keys(re).length>0){c(re);return}m(!0),c({});try{const he=await oo.validateUniqueFields({name:s.name},B?ne:null,B?"foreignproducts":null);if(Object.keys(he).length>0){c(he),m(!1);return}const de={...s,price:parseFloat(s.price)||0,stockQuantity:parseFloat(s.stockQuantity)||0,minimumStock:parseFloat(s.minimumStock)||0,priceQuotes:F,status:"active"};if(console.log("Saving foreign product with price quotes:",{name:de.name,priceQuotes:de.priceQuotes,priceQuotesCount:de.priceQuotes.length}),B){await Nr.updateForeignProduct(ne,de);const xe=me();q("task",`${xe.name} عدل منتج مستورد`,`تم تعديل المنتج المستورد: ${de.name}`)}else{await Nr.addForeignProduct(de);const xe=me();q("task",`${xe.name} أضاف منتج مستورد`,`تم إضافة المنتج المستورد: ${de.name}`)}V("/foreign-products")}catch(he){c({submit:he.message})}finally{m(!1)}},ft=()=>{V("/foreign-products")},Ot=()=>{j(!0)},Ee=()=>{j(!1),H(null),be({supplierType:"foreign",supplier:"",supplierName:"",date:"",price:"",quotationFile:null}),c(T=>({...T,fileUpload:""})),console.log("Modal closed and state reset")},it=()=>{O(!0)},Nt=()=>{O(!1),z(null)},hn=T=>{console.log("Supplier Name:",T);try{console.log("Using already loaded foreign supplier data...");const re=X;console.log("Available foreign suppliers:",re.length),console.log("Foreign suppliers list:",re.map(de=>({id:de.id,name:de.name})));const he=re.find(de=>de.name===T);console.log("Found supplier:",he?"YES":"NO"),he?(console.log("SUCCESS: Foreign supplier found:",he.name),console.log("Supplier data:",he),oe(he),ee(!0),console.log("Modal state should be true now"),setTimeout(()=>{console.log("Modal state check - showSupplierEditModal:",I),console.log("Modal state check - selectedSupplierToEdit:",J?.name)},100)):(console.error("FOREIGN SUPPLIER NOT FOUND"),console.error("Looking for supplier name:",T),console.error("Available suppliers:",re.map(de=>de.name)),re.length===0?(console.log("No suppliers loaded, triggering data reload..."),loadSuppliersData(),_("لا توجد بيانات موردين أجانب. جار إعادة التحميل...","لا توجد بيانات")):_(`لم يتم العثور على المورد الأجنبي: ${T}`,"مورد غير موجود"))}catch(re){console.error("=== FOREIGN SUPPLIER SEARCH ERROR ==="),console.error("Error details:",re),console.error("Error message:",re.message),_(`خطأ في البحث عن المورد الأجنبي: ${re.message}`,"خطأ في البحث")}},xn=()=>{console.log("Called by:",new Error().stack),ee(!1),oe(null)},is=T=>{z(T)},Un=()=>{Q&&be(T=>{console.log("Before supplier selection - preserving file:",T.quotationFile?.name);const re={...T,supplier:Q.id,supplierName:Q.name};return console.log("After supplier selection - file preserved:",re.quotationFile?.name),re}),O(!1),z(null)},Xt=T=>{console.log("File details:",{name:T?.name,size:T?.size,type:T?.type,lastModified:T?.lastModified}),l.fileUpload&&c(re=>({...re,fileUpload:""})),be(re=>{const he={...re,quotationFile:T};return console.log("Updated priceQuoteData with file:",{hasFile:!!he.quotationFile,fileName:he.quotationFile?.name}),he})},yn=T=>{const{name:re,value:he,type:de}=T.target;de!=="file"&&be(re==="supplierType"?xe=>({...xe,[re]:he,supplier:"",supplierName:""}):xe=>({...xe,[re]:he}))},Zn=async T=>{if(T.preventDefault(),console.log("Form element:",T.target),console.log("Current priceQuoteData:",Y),console.log("Editing quote ID:",M),!Y.supplierName){c(xe=>({...xe,fileUpload:"يجب اختيار المورد أولاً"}));return}if(!Y.date){c(xe=>({...xe,fileUpload:"يجب إدخال تاريخ العرض"}));return}if(!Y.price){c(xe=>({...xe,fileUpload:"يجب إدخال السعر"}));return}const re=new FormData(T.target),he=re.get("quotationFile");console.log("File from form directly:",he),console.log("File from state:",Y.quotationFile);const de=Y.quotationFile||he;console.log("File to upload:",de),console.log("File upload details:",{exists:!!de,isFile:de instanceof File,name:de?.name,size:de?.size,type:de?.type,lastModified:de?.lastModified});try{if(m(!0),!M&&(!de||de.size===0))throw new Error("يجب اختيار ملف عرض السعر");let xe=null;if(console.log("File upload analysis:",{hasFileInState:!!Y.quotationFile,hasFileInForm:!!he,hasFileToUpload:!!de,fileType:typeof de,fileName:de?.name,fileSize:de?.size}),de&&typeof de!="string"&&de.size>0){console.log("Starting file upload:",de.name);try{_r.validateFile(de,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}),console.log("File validation passed")}catch(Ue){throw console.error("File validation failed:",Ue),new Error(Ue.message)}console.log("Attempting file upload to Firebase...");try{const Ue=de.name.split(".").pop()||"pdf",bt=Y.supplierName?`عرض سعر ${Y.supplierName}.${Ue}`:de.name;console.log("Uploading with custom name:",bt),xe=await _r.uploadFileWithCustomName(de,"quotations",bt),console.log("File uploaded successfully:",xe)}catch(Ue){throw console.error("Firebase upload failed:",Ue),new Error(`فشل في رفع الملف: ${Ue.message}`)}}else console.log("No valid file to upload:",{fileExists:!!de,isString:typeof de=="string",hasSize:de?.size>0});if(M)console.log("Updating existing price quote with ID:",M),ce(Ue=>{const bt=Ue.map(pt=>pt.id===M?{...pt,supplierType:Y.supplierType,supplier:Y.supplier,supplierName:Y.supplierName,date:Y.date,price:Y.price,quotationFile:xe?xe.path:pt.quotationFile,quotationFileURL:xe?xe.url:pt.quotationFileURL,quotationFileName:xe?xe.originalName:pt.quotationFileName,quotationFileSize:xe?xe.size:pt.quotationFileSize,quotationFileType:xe?xe.type:pt.quotationFileType,updatedAt:new Date}:pt);return console.log("Updated price quotes:",bt),setTimeout(()=>{R(bt)},100),bt});else{const Ue={id:Date.now().toString(),supplierType:Y.supplierType,supplier:Y.supplier,supplierName:Y.supplierName,date:Y.date,price:Y.price,quotationFile:xe?xe.path:null,quotationFileURL:xe?xe.url:null,quotationFileName:xe?xe.originalName:null,quotationFileSize:xe?xe.size:null,quotationFileType:xe?xe.type:null,createdAt:new Date};console.log("Adding new price quote:",Ue),ce(bt=>{const pt=[...bt,Ue];return console.log("Updated price quotes:",pt),setTimeout(()=>{R(pt)},100),pt})}l.priceQuotes&&c(Ue=>({...Ue,priceQuotes:""})),Ee(),B&&ne&&setTimeout(async()=>{try{console.log("Auto-saving foreign product after price quote change..."),ce(Ue=>{const bt={...re,priceQuotes:Ue};return Nr.updateForeignProduct(ne,bt).then(()=>{console.log("Auto-save successful")}).catch(pt=>{console.error("Auto-save failed:",pt),_("فشل في الحفظ التلقائي","خطأ في الحفظ")}),Ue})}catch(Ue){console.error("Auto-save setup error:",Ue)}},200)}catch(xe){console.error("Error uploading file:",xe),c(Ue=>({...Ue,fileUpload:xe.message||"فشل في رفع الملف. حاول مرة أخرى."}))}finally{m(!1)}},es=T=>{console.log("Starting edit for quote:",T),H(T.id),be({supplierType:T.supplierType||"local",supplier:T.supplier||"",supplierName:T.supplierName||"",date:T.date||"",price:T.price||"",quotationFile:T.quotationFile||null}),j(!0)},an=T=>{if(console.log("Price quote delete button clicked:",T),console.log("Quote ID:",T?.id),console.log("Quote keys:",T?Object.keys(T):"quote is null/undefined"),!T||!T.id){console.error("Invalid quote object - missing quote or ID:",{quote:T,hasId:!!T?.id,quoteId:T?.id,quoteType:typeof T}),_("خطأ في بيانات عرض السعر","خطأ");return}E(`هل أنت متأكد من حذف عرض السعر؟

${T.supplierName} - ${T.price} ريال`,()=>Bt(T),"تأكيد حذف عرض السعر")},Bt=async T=>{if(console.log("Delete confirmation called for quote:",T),console.log("Confirmation - Quote ID:",T?.id),console.log("Confirmation - Quote keys:",T?Object.keys(T):"quote is null/undefined"),console.log("Is editing mode:",B),console.log("Foreign product ID:",ne),console.log("Form data name:",s.name),!T||!T.id){console.error("Invalid quote in confirmation - missing quote or ID:",{quote:T,hasId:!!T?.id,quoteId:T?.id,quoteType:typeof T}),_("خطأ في بيانات عرض السعر","خطأ"),U(!1);return}try{if(U(!0),console.log("Starting delete process..."),console.log("Moving to trash..."),B&&ne){const he={...T,foreignProductId:ne,foreignProductName:s.name};console.log("Quote with context for trash:",he),console.log("Calling SimpleTrashService.moveToTrash...");const de=await Gn.moveToTrash(he,"price_quotes");console.log("Trash service result:",de),console.log("Moved to trash successfully")}else console.log("Skipping trash - foreign product not saved yet (isEditing:",B,", id:",ne,")");const re=me();console.log("Logging activity with current user:",re),q("task",`${re.name} حذف عرض سعر`,`تم حذف عرض السعر: ${T.supplierName} - ${T.price} ريال`),console.log("Updating local state..."),console.log("Current price quotes before deletion:",F),ce(he=>{const de=he.filter(xe=>xe.id!==T.id);return console.log("Filtered quotes:",de.length,"from",he.length),console.log("Removed quote with ID:",T.id),console.log("Remaining quotes:",de.map(xe=>({id:xe.id,supplierName:xe.supplierName}))),setTimeout(()=>{R(de)},100),de}),console.log("Showing success message..."),B&&ne?ie(`تم نقل عرض السعر للمهملات: ${T.supplierName}`,"تم النقل للمهملات"):ie(`تم حذف عرض السعر: ${T.supplierName}`,"تم الحذف"),console.log("Delete process completed successfully"),B&&ne&&setTimeout(async()=>{try{console.log("Auto-saving foreign product after price quote deletion..."),ce(he=>{const de={...s,priceQuotes:he};return Nr.updateForeignProduct(ne,de).then(()=>{console.log("Auto-save after deletion successful")}).catch(xe=>{console.error("Auto-save after deletion failed:",xe)}),he})}catch(he){console.error("Auto-save after deletion setup error:",he)}},200)}catch(re){console.error("Error deleting price quote:",re),console.error("Error stack:",re.stack),_(`فشل في حذف عرض السعر: ${re.message||"خطأ غير معروف"}`,"خطأ في الحذف")}finally{console.log("Setting deleting to false"),U(!1)}},Nn=()=>(Y.supplierType==="local"?k:X).filter(he=>{const de=he.hasOwnProperty("active"),xe=he.hasOwnProperty("status");return de?he.active===!0:xe?he.status==="active":!0});return p?n.jsx(Dn,{show:!0,message:"جار تحميل بيانات المنتج المستورد..."}):n.jsxs(rn,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Kn,{onToggle:C}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsxs("div",{style:{position:"sticky",top:0,zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item",children:n.jsx("a",{href:"/foreign-products",className:"text-decoration-none text-primary",children:"بنود المناقصات"})}),n.jsx("li",{className:"breadcrumb-item",children:n.jsx("a",{href:"/foreign-products",className:"text-decoration-none text-primary",children:"مواد خام"})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:B?"تعديل منتج مستورد":"إضافة منتج مستورد جديد"})]})}),n.jsx(Yn,{})]}),n.jsxs("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:[n.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"60px"},children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsxs("div",{className:"card-header bg-white border-bottom py-4 d-flex align-items-center",children:[n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-box-seam text-primary me-2"}),B?"تعديل المنتج المستورد":"إضافة منتج مستورد جديد"]}),n.jsx("div",{style:{flex:1}}),n.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:Ot,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:"1",paddingTop:"2px"},children:"عرض سعر"})]}),n.jsxs("form",{onSubmit:Ke,children:[n.jsxs("div",{className:"card-body p-4",children:[l.submit&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.submit]}),n.jsxs("div",{className:"row mb-4",children:[n.jsx("div",{className:"col-12",children:n.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[n.jsx("i",{className:"bi bi-info-circle me-2"}),"المعلومات الأساسية"]})}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"اسم المنتج المستورد *"}),n.jsx("input",{type:"text",className:`form-control ${l.name?"is-invalid":""}`,name:"name",value:s.name,onChange:Ge,placeholder:"أدخل اسم المنتج المستورد"}),l.name&&n.jsx("div",{className:"invalid-feedback",children:l.name})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الفئة *"}),n.jsx(Hx,{name:"category",value:s.category,onChange:Ge,required:!0,className:`form-select ${l.category?"is-invalid":""}`,placeholder:"اختر الفئة",showDescription:!0}),l.category&&n.jsx("div",{className:"invalid-feedback",children:l.category})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الوحدة *"}),n.jsx(Gx,{name:"unit",value:s.unit,onChange:Ge,required:!0,className:`form-select ${l.unit?"is-invalid":""}`,placeholder:"اختر الوحدة",showDescription:!0}),l.unit&&n.jsx("div",{className:"invalid-feedback",children:l.unit})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsxs("label",{className:"form-label fw-bold",children:["السعر (ريال) *",n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:F.length>0?"أقل سعر تلقائي":"سعر تلقائي"})]}),n.jsx("input",{type:"number",step:"0.01",min:"0",className:`form-control ${l.price?"is-invalid":""}`,name:"price",value:s.price,onChange:null,onKeyPress:null,placeholder:"0.00",readOnly:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"}}),l.price&&n.jsx("div",{className:"invalid-feedback",children:l.price}),n.jsx("div",{className:"mt-1",children:n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),F.length>0?"السعر محدد تلقائياً من أقل عرض سعر في القائمة":"السعر سيتم تحديده تلقائياً عند إضافة عروض الأسعار"]})})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الوصف"}),n.jsx("textarea",{className:"form-control",name:"description",value:s.description,onChange:Ge,rows:"3",placeholder:"وصف المنتج المستورد"})]}),n.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:n.jsxs("div",{className:"d-flex align-items-center gap-2",children:[n.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"نشط":"غير نشط"}),n.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"foreignProductActiveSwitch",name:"active",checked:s.active,onChange:Ge,style:{width:"48px",height:"24px",marginRight:"8px"}})]})})]}),n.jsxs("div",{className:"row mb-4",children:[n.jsxs("div",{className:"col-12",children:[n.jsxs("h6",{className:"fw-bold text-primary border-bottom pb-2 mb-3",children:[n.jsx("i",{className:"bi bi-receipt me-2"}),"عروض الأسعار"]}),l.priceQuotes&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.priceQuotes]})]}),F.length>0&&n.jsx("div",{className:"col-12",children:n.jsxs("div",{className:"card mb-3 border-0 shadow-lg",style:{background:"linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%)",borderRadius:"16px"},children:[n.jsx("div",{className:"card-header border-0",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"16px 16px 0 0",padding:"20px"},children:n.jsxs("h5",{className:"card-title text-white mb-0 d-flex align-items-center",children:[n.jsx("div",{className:"me-3",style:{background:"rgba(255,255,255,0.2)",borderRadius:"12px",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsx("i",{className:"bi bi-bar-chart-fill fs-5"})}),n.jsx("span",{className:"fw-bold",children:"مقارنة أسعار الموردين"}),n.jsxs("span",{className:"badge bg-light text-primary ms-3",style:{borderRadius:"20px",fontSize:"12px",padding:"6px 12px"},children:[F.length," موردين"]})]})}),n.jsx("div",{className:"card-body",style:{padding:"30px"},children:n.jsx("div",{style:{minHeight:"625px",direction:"ltr"},children:n.jsx("div",{style:{width:"100%",height:"605px",position:"relative"},children:(()=>{F.map(Ue=>parseFloat(Ue.price)||0);const T=640,de=F.length*150,xe=Math.max(T,de);return n.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${xe+160} 605`,style:{direction:"ltr"},children:[n.jsxs("defs",{children:[n.jsxs("linearGradient",{id:"chartBgForeign",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#ffffff",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#f8f9ff",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"bestPriceGradientForeign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#00f5a0",stopOpacity:1}}),n.jsx("stop",{offset:"30%",style:{stopColor:"#00d9f5",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#0066cc",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"regularPriceGradientForeign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),n.jsx("stop",{offset:"50%",style:{stopColor:"#764ba2",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#f093fb",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient0Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#667eea",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#764ba2",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient1Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#f093fb",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#f5576c",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient2Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#4facfe",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#00f2fe",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient3Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#a8edea",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#fed6e3",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient4Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#ffecd2",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#fcb69f",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient5Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#a18cd1",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#fbc2eb",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient6Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#fad0c4",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#ffd1ff",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"gradient7Foreign",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"#a1c4fd",stopOpacity:1}}),n.jsx("stop",{offset:"100%",style:{stopColor:"#c2e9fb",stopOpacity:1}})]}),n.jsxs("linearGradient",{id:"metallicShineForeign",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),n.jsx("stop",{offset:"45%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),n.jsx("stop",{offset:"50%",style:{stopColor:"rgba(255,255,255,0.8)",stopOpacity:1}}),n.jsx("stop",{offset:"55%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}}),n.jsx("stop",{offset:"100%",style:{stopColor:"rgba(255,255,255,0)",stopOpacity:0}})]}),n.jsx("filter",{id:"dropShadowForeign",x:"-50%",y:"-50%",width:"200%",height:"200%",children:n.jsx("feDropShadow",{dx:"0",dy:"6",stdDeviation:"8",floodColor:"rgba(0,0,0,0.15)"})}),n.jsxs("filter",{id:"premiumGlowForeign",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{stdDeviation:"5",result:"coloredBlur"}),n.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0 0 0  0 1 1 0 0  0 0 1 0 0  0 0 0 1 0"}),n.jsxs("feMerge",{children:[n.jsx("feMergeNode",{in:"coloredBlur"}),n.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),n.jsxs("filter",{id:"bevelEffectForeign",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2",result:"blur"}),n.jsx("feSpecularLighting",{in:"blur",result:"specOut",surfaceScale:"5",specularConstant:"0.8",specularExponent:"20","lighting-color":"white",children:n.jsx("fePointLight",{x:"-50",y:"-50",z:"200"})}),n.jsx("feComposite",{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut2"}),n.jsx("feComposite",{in:"SourceGraphic",in2:"specOut2",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"})]}),n.jsxs("filter",{id:"pulseGlowForeign",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),n.jsx("feColorMatrix",{in:"coloredBlur",type:"matrix",values:"0 1 0.8 0 0  0 1 1 0 0  0 0 1 0.2 0  0 0 0 1 0"}),n.jsxs("feMerge",{children:[n.jsx("feMergeNode",{in:"coloredBlur"}),n.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),n.jsx("rect",{width:xe+160,height:"605",fill:"url(#chartBgForeign)",rx:"12",style:{filter:"drop-shadow(0 4px 20px rgba(0,0,0,0.1))"}}),n.jsx("g",{transform:"translate(80, 40)",children:(()=>{const Ue=F.map(Oe=>parseFloat(Oe.price)||0),bt=Math.max(...Ue),pt=Math.min(...Ue),Vs=bt-pt||1,Ne=300,ue=640,Te=F.length*150,We=Math.max(ue,Te),ye=Math.min(We/F.length*.6,80),ze=We/F.length;return n.jsxs(n.Fragment,{children:[[0,1,2,3,4,5].map(Oe=>{const Ze=130+(Ne-130)/5*Oe,Ve=(1-Oe/5)*Math.max(...Ue);return n.jsxs("g",{children:[n.jsx("line",{x1:"0",y1:Ze,x2:We,y2:Ze,stroke:Oe===5?"#007bff":"rgba(123, 140, 252, 0.2)",strokeWidth:Oe===5?"2":"1",strokeDasharray:Oe===5?"0":"5,5"}),n.jsx("text",{x:"-15",y:Ze+5,textAnchor:"end",fontSize:"12",fill:"#4f46e5",fontWeight:"600",children:Math.round(Ve).toLocaleString()})]},Oe)}),F.map((Oe,nt)=>{const Ze=parseFloat(Oe.price)||0;let Je;if(Vs>0){const fs=Ne-130,dr=Ze/Math.max(...Ue);Je=Math.max(dr*fs,15)}else Je=(Ne-130)*.8;const Ve=ze*nt+(ze-ye)/2,ke=Ne-Je,et=Ze===pt;let bn;return et?bn="bestPriceGradientForeign":bn=`gradient${nt%8}Foreign`,n.jsxs("g",{children:[n.jsx("rect",{x:Ve+4,y:ke+8,width:ye,height:Je,fill:"rgba(0,0,0,0.05)",rx:"10"}),n.jsx("rect",{x:Ve+2,y:ke+4,width:ye,height:Je,fill:"rgba(0,0,0,0.08)",rx:"9"}),n.jsxs("rect",{x:Ve,y:ke,width:ye,height:Je,fill:`url(#${bn})`,rx:"10",filter:et?"url(#premiumGlowForeign)":"url(#bevelEffectForeign)",style:{transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer"},children:[n.jsx("animate",{attributeName:"height",from:"0",to:Je,dur:"2s",begin:`${nt*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),n.jsx("animate",{attributeName:"y",from:Ne,to:ke,dur:"2s",begin:`${nt*.3}s`,fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}),et&&n.jsx("animateTransform",{attributeName:"transform",type:"scale",values:"1;1.05;1",dur:"3s",repeatCount:"indefinite",begin:`${nt*.3+2}s`})]}),n.jsx("rect",{x:Ve+2,y:ke+2,width:ye-4,height:Math.max(Je/2.5,30),fill:"url(#metallicShineForeign)",rx:"8",opacity:"0.6",children:n.jsx("animateTransform",{attributeName:"transform",type:"translate",values:`-${ye};${ye}`,dur:"4s",repeatCount:"indefinite",begin:`${nt*.5+3}s`})}),n.jsx("rect",{x:Ve+3,y:ke+3,width:Math.max(ye/4,8),height:Math.max(Je-6,20),fill:"rgba(255,255,255,0.4)",rx:"6"}),n.jsx("rect",{x:Ve+ye-6,y:ke+6,width:"3",height:Math.max(Je-12,15),fill:"rgba(255,255,255,0.2)",rx:"1.5"}),n.jsxs("g",{children:[n.jsx("rect",{x:Ve+ye/2-30,y:ke-28,width:"60",height:"20",fill:"rgba(0,0,0,0.8)",rx:"10",opacity:"0.9"}),n.jsxs("text",{x:Ve+ye/2,y:ke-15,textAnchor:"middle",fontSize:"12",fill:"white",fontWeight:"bold",children:["ر.س ",Ze.toLocaleString()]})]}),n.jsx("g",{children:(()=>{const fs=Oe.supplierName,dr=fs.length*7,vs=Math.max(dr+20,ye+10);return n.jsxs(n.Fragment,{children:[n.jsx("rect",{x:Ve+ye/2-vs/2,y:Ne+30,width:vs,height:22,fill:"rgba(255,255,255,0.96)",rx:"11",stroke:"rgba(0,123,255,0.5)",strokeWidth:"1.5",filter:"url(#dropShadowForeign)"}),n.jsx("text",{x:Ve+ye/2,y:Ne+41,textAnchor:"middle",fontSize:"11",fill:"#1e40af",fontWeight:"700",style:{fontFamily:"system-ui, -apple-system, sans-serif",letterSpacing:"0.2px"},dominantBaseline:"middle",children:fs})]})})()}),et&&n.jsxs("g",{children:[n.jsx("circle",{cx:Ve+ye/2,cy:ke-100,r:"18",fill:"linear-gradient(135deg, #ffd700 0%, #ffb300 100%)",stroke:"#fff",strokeWidth:"3",filter:"url(#dropShadowForeign)"}),n.jsx("text",{x:Ve+ye/2,y:ke-95,textAnchor:"middle",fontSize:"16",fill:"#fff",children:"👑"}),n.jsx("rect",{x:Ve-5,y:ke-70,width:ye+10,height:"20",fill:"#28a745",rx:"10",opacity:"0.9"}),n.jsx("text",{x:Ve+ye/2,y:ke-57,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:"أفضل سعر"})]})]},Oe.id)}),n.jsx("text",{x:We/2,y:30,textAnchor:"middle",fontSize:"16",fill:"url(#bestPriceGradientForeign)",fontWeight:"bold",direction:"rtl",children:"مقارنة الأسعار بالريال السعودي"}),n.jsxs("g",{transform:`translate(${We/2}, ${Ne+110})`,children:[n.jsx("rect",{x:"-200",y:"-25",width:"400",height:"145",fill:"rgba(255,255,255,0.98)",rx:"20",stroke:"url(#bestPriceGradientForeign)",strokeWidth:"2",filter:"url(#dropShadowForeign)"}),n.jsx("text",{x:"0",y:"-5",textAnchor:"middle",fontSize:"16",fill:"#1f2937",fontWeight:"800",letterSpacing:"0.5px",children:"مؤشر الأسعار"}),n.jsxs("g",{transform:"translate(0, 15)",children:[n.jsxs("g",{transform:"translate(-125, 0)",children:[n.jsxs("g",{transform:"translate(0, 0)",children:[n.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#bestPriceGradientForeign)",rx:"7",filter:"url(#premiumGlowForeign)"}),n.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#059669",fontWeight:"700",children:"أفضل سعر"}),n.jsx("text",{x:"80",y:"13",fontSize:"18",children:"👑"})]}),n.jsx("line",{x1:"110",y1:"-5",x2:"110",y2:"19",stroke:"rgba(0,0,0,0.15)",strokeWidth:"2"}),n.jsxs("g",{transform:"translate(125, 0)",children:[n.jsx("rect",{x:"0",y:"0",width:"14",height:"14",fill:"url(#regularPriceGradientForeign)",rx:"7"}),n.jsx("text",{x:"20",y:"10",fontSize:"13",fill:"#6366f1",fontWeight:"700",children:"أسعار أخرى"}),n.jsx("text",{x:"90",y:"13",fontSize:"16",children:"📊"})]})]}),n.jsxs("g",{transform:"translate(0, 40)",children:[n.jsx("rect",{x:"-170",y:"-8",width:"340",height:"22",fill:"rgba(59, 130, 246, 0.08)",rx:"11"}),n.jsxs("text",{x:"0",y:"5",textAnchor:"middle",fontSize:"14",fill:"#1e40af",fontWeight:"700",children:["💰 الفرق في السعر: ",(Math.max(...Ue)-Math.min(...Ue)).toLocaleString()," ر.س"]})]}),n.jsx("g",{transform:"translate(0, 90)",children:n.jsxs("text",{x:"0",y:"0",textAnchor:"middle",fontSize:"12",fill:"#6b7280",fontWeight:"600",children:["📈 أعلى سعر: ",Math.max(...Ue).toLocaleString()," ر.س  •  📉 أقل سعر: ",Math.min(...Ue).toLocaleString()," ر.س"]})})]})]})]})})()})]})})()})})})]})}),n.jsx("div",{className:"col-12",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsx("div",{className:"d-flex justify-content-between align-items-center",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-list-ul text-primary me-2"}),"قائمة عروض الأسعار (",F.length,")"]})})}),n.jsx("div",{className:"card-body p-0",children:F.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-receipt fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد عروض أسعار"}),n.jsx("p",{className:"text-muted",children:"لم يتم إضافة أي عروض أسعار بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"المورد"}),n.jsx("th",{className:"text-center",children:"النوع"}),n.jsx("th",{className:"text-center",children:"التاريخ"}),n.jsx("th",{className:"text-center",children:"السعر (ريال)"}),n.jsx("th",{className:"text-center",children:"الملف"}),n.jsx("th",{className:"text-center",style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:F.map((T,re)=>{const he=F.length>=1&&F.reduce((de,xe)=>{const Ue=parseFloat(de.price)||0;return(parseFloat(xe.price)||0)<Ue?xe:de}).id===T.id;return n.jsxs("tr",{className:he?"table-success":"",children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:re+1})}),n.jsxs("td",{className:"text-center",children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},onClick:de=>{de.preventDefault(),de.stopPropagation(),console.log("Button clicked, calling handleSupplierEdit..."),hn(T.supplierName)},title:`تحرير مورد: ${T.supplierName}`,type:"button",children:T.supplierName}),he&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:`badge ${T.supplierType==="local"?"bg-success":"bg-info"}`,children:T.supplierType==="local"?"محلي":"أجنبي"})}),n.jsx("td",{className:"text-center",children:T.date}),n.jsxs("td",{className:"text-center",children:[T.price," ريال",he&&n.jsx("i",{className:"bi bi-arrow-down-circle-fill text-success ms-2",title:"أقل سعر"})]}),n.jsx("td",{className:"text-center",children:T.quotationFile&&n.jsx(qx,{size:25,clickable:!0,onClick:()=>{T.quotationFileURL?window.open(T.quotationFileURL,"_blank"):(console.log("No file URL available for:",T.quotationFile),alert("الملف غير متوفر للعرض"))},title:`عرض الملف: ${T.quotationFileName||T.quotationFile}`})}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>es(T),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>an(T),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},T.id)})})]})})})]})})]})]}),n.jsx("div",{className:"card-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsxs("div",{className:"d-flex gap-3",style:{marginBottom:"15px"},children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:ft,disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?"جار الحفظ...":n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),B?"تحديث":"حفظ"]})})]})})]})]})}),n.jsx("div",{className:"app-footer",style:{textAlign:"center",padding:"20px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",marginTop:"20px"},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]})]}),!r&&t&&n.jsx(Xn,{rtl:!0}),!r&&t&&n.jsx(Jn,{}),w&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:n.jsx("div",{className:"modal-dialog modal-lg",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0 pb-2",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-receipt text-primary me-2"}),"طلب عرض سعر"]}),n.jsx("button",{type:"button",className:"btn-close",onClick:Ee,style:{fontSize:"12px"}})]}),n.jsxs("form",{onSubmit:Zn,onReset:T=>T.preventDefault(),children:[n.jsxs("div",{className:"modal-body px-4",children:[l.fileUpload&&n.jsxs("div",{className:"alert alert-danger mb-3",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.fileUpload]}),n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"نوع المورد *"}),n.jsx("select",{className:"form-select",name:"supplierType",value:Y.supplierType,onChange:yn,required:!0,disabled:!0,children:n.jsx("option",{value:"foreign",children:"مورد أجنبي"})})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"المورد *"}),n.jsxs("div",{className:"form-control d-flex align-items-center justify-content-between",onClick:it,style:{cursor:"pointer",backgroundColor:"#f8f9fa"},children:[n.jsx("span",{className:Y.supplierName?"text-dark":"text-muted",children:Y.supplierName||"اختر المورد"}),n.jsx("i",{className:"bi bi-chevron-down"})]})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"تاريخ العرض *"}),n.jsx("input",{type:"date",className:"form-control",name:"date",value:Y.date,onChange:yn,required:!0})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"السعر (ريال) *"}),n.jsx("input",{type:"number",step:"0.01",min:"0",className:"form-control",name:"price",value:Y.price,onChange:yn,onKeyPress:T=>{(T.key==="-"||T.key!=="."&&T.key!=="Backspace"&&(T.key<"0"||T.key>"9"))&&T.preventDefault()},placeholder:"0.00",required:!0})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsxs("label",{className:"form-label fw-bold",children:["رفع عرض السعر ",M?"(اختياري)":"*"]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.jpg,.png,.jpeg",style:{display:"none"},ref:T=>{T&&(T.onclick=()=>{T.value=""},T.onchange=re=>{const he=re.target.files?.[0];he&&Xt(he)})},id:`fileInput_${w}_${Date.now()}`}),n.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>{const T=document.querySelector(`#fileInput_${w}_${Date.now()}`);if(T)T.click();else{const re=document.createElement("input");re.type="file",re.accept=".pdf,.doc,.docx,.jpg,.png,.jpeg",re.style.display="none",re.onchange=he=>{const de=he.target.files?.[0];de&&Xt(de),document.body.removeChild(re)},document.body.appendChild(re),re.click()}},style:{borderRadius:"6px",height:"38px",minWidth:"150px"},children:[n.jsx("i",{className:"bi bi-upload me-2"}),"اختر ملف"]})]}),Y.quotationFile&&n.jsxs("div",{className:"alert alert-success py-2 mb-2",style:{position:"relative"},children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-check-circle me-2 text-success"}),n.jsxs("div",{className:"flex-grow-1",children:[n.jsx("strong",{children:Y.quotationFile.name?Y.supplierName?`عرض سعر ${Y.supplierName}.${Y.quotationFile.name.split(".").pop()}`:Y.quotationFile.name:M?Y.supplierName?`عرض سعر ${Y.supplierName}.pdf`:F.find(T=>T.id===M)?.quotationFileName||"ملف موجود":"ملف موجود"}),n.jsxs("small",{className:"text-muted ms-2",children:["(",Y.quotationFile.size?Math.round(Y.quotationFile.size/1024):M?Math.round((F.find(T=>T.id===M)?.quotationFileSize||0)/1024):0," KB)"]})]})]}),n.jsx("button",{type:"button",className:"btn-close btn-close-sm",onClick:()=>{be(T=>({...T,quotationFile:null}))},title:"إزالة الملف",style:{position:"absolute",top:"8px",left:"8px",width:"20px",height:"20px",fontSize:"10px",opacity:.7},onMouseEnter:T=>T.target.style.opacity=1,onMouseLeave:T=>T.target.style.opacity=.7})]}),M&&!Y.quotationFile&&n.jsxs("div",{className:"alert alert-info py-2 mb-2",children:[n.jsx("i",{className:"bi bi-info-circle me-2"}),n.jsxs("small",{children:["ملف موجود: ",F.find(T=>T.id===M)?.quotationFileName||"ملف موجود"]})]}),!Y.quotationFile&&!M&&n.jsx("div",{className:"mt-1",children:n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),"يجب اختيار ملف PDF أو Word أو صورة"]})})]})]})]}),n.jsx("div",{className:"modal-footer border-0 pt-0 d-flex justify-content-center",style:{marginBottom:"10px"},children:n.jsxs("div",{className:"d-flex gap-3",children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:Ee,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"10px",height:"10px"}}),"رفع..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),"إرسال"]})})]})})]})]})})}),D&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:n.jsx("div",{className:"modal-dialog modal-xl",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0 pb-2",style:{marginBottom:"5px"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-people-fill text-primary me-2"}),Y.supplierType==="local"?"اختر مورد محلي":"اختر مورد أجنبي",n.jsxs("span",{className:"text-muted ms-2",children:["(",Nn().length,")"]})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:Nt,style:{fontSize:"12px"}})]}),n.jsx("div",{className:"modal-body p-0",children:Nn().length>0?n.jsx("div",{className:"table-responsive suppliers-table",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"50px"}}),n.jsx("th",{children:"اسم المورد"}),n.jsx("th",{children:"البريد الإلكتروني"}),n.jsx("th",{children:"الهاتف"}),n.jsx("th",{children:"المدينة"})]})}),n.jsx("tbody",{children:Nn().map(T=>n.jsxs("tr",{onClick:()=>is(T),style:{cursor:"pointer"},children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input custom-radio",type:"radio",name:"selectedSupplier",checked:Q?.id===T.id,onChange:()=>{},style:{pointerEvents:"none",width:"18px",height:"18px",borderWidth:"2px",borderColor:Q?.id===T.id?"#007bff":"#dee2e6"}})})}),n.jsx("td",{children:n.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none"},children:T.name})}),n.jsx("td",{children:n.jsx("a",{href:`mailto:${T.email}`,className:"text-decoration-none",children:T.email})}),n.jsx("td",{children:T.phone}),n.jsx("td",{children:T.city||"-"})]},T.id))})]})}):n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-people fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد موردين"}),n.jsxs("p",{className:"text-muted",children:["لا توجد ",Y.supplierType==="local"?"موردين محليين":"موردين أجانب"," مسجلين"]})]})}),n.jsx("div",{className:"modal-footer border-0 d-flex justify-content-center",style:{marginTop:"15px"},children:n.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:Un,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",margin:"20px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:"تأكيد"})})]})})}),I&&J&&n.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999},tabIndex:"-1",onClick:T=>{T.target===T.currentTarget&&xn()},children:n.jsx("div",{className:"modal-dialog modal-lg",onClick:T=>T.stopPropagation(),children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"10px"},children:[n.jsxs("div",{className:"modal-header border-0",children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-person-vcard text-primary me-2"}),"معلومات المورد - ",J?.name,n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"11px"},children:"أجنبي"})]}),n.jsx("button",{type:"button",className:"btn-close",onClick:xn})]}),n.jsx("div",{className:"modal-body",children:n.jsxs("div",{className:"row g-3",children:[n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"اسم المورد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J?.name})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البريد الإلكتروني"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J?.email||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الهاتف"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px",direction:"ltr",textAlign:"left"},children:J?.phone||""})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"البلد"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J?.country||""})]}),n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"العنوان"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J?.address||""})]}),J?.taxNumber&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"الرقم الضريبي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J.taxNumber})]}),J?.bankAccount&&n.jsxs("div",{className:"col-md-6",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"رقم الحساب البنكي"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J.bankAccount})]}),J?.notes&&n.jsxs("div",{className:"col-12",children:[n.jsx("label",{className:"form-label fw-bold text-muted",children:"ملاحظات"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light",style:{minHeight:"38px"},children:J.notes})]})]})}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsx("div",{className:"d-flex gap-3",children:n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:xn,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إغلاق"})})})]})})})]}),n.jsx(Dn,{show:u,message:B?"جار تحديث المنتج المستورد...":"جار حفظ المنتج المستورد..."}),n.jsx(Rn,{show:se.show,onClose:fe,title:se.title,message:se.message,type:se.type,onConfirm:se.onConfirm,confirmText:se.confirmText,cancelText:se.cancelText,showCancel:se.showCancel}),n.jsx(Qx,{position:"bottom-right",showDetails:!0})]})}function BE(){return n.jsx(sn,{children:n.jsx(W4,{})})}const K4=({refreshTrigger:r})=>{const e=ms();console.log("ManufacturedProductsListFixed is rendering");const[t,s]=N.useState([]),[a,l]=N.useState(!0),[c,u]=N.useState(null),[m,p]=N.useState(""),[b,w]=N.useState([]),[j,D]=N.useState(!1),[O,Q]=N.useState(!1),{logActivity:z,getCurrentUser:I}=vn(),{alertConfig:ee,closeAlert:J,showSuccess:oe,showError:Y,showConfirm:be}=Pn(),{formatDate:M}=yh(),{currentPage:H,totalPages:k,paginatedItems:$,handlePageChange:X,resetPage:te,totalItems:F,itemsPerPage:ce}=wa(b,30);console.log("ManufacturedProductsListFixed state:",{productsCount:t.length,loading:a,error:c});const Be=async()=>{try{l(!0),u(null),console.log("Loading manufactured products...");const fe=await ac.getAllManufacturedProducts();console.log("Manufactured products loaded:",fe.length),s(fe)}catch(fe){console.error("Error loading manufactured products:",fe),u(fe.message||"فشل في تحميل المنتجات المصنعة")}finally{l(!1)}};N.useEffect(()=>{(async()=>{try{if(console.log("🔐 [List] Initializing Firebase authentication..."),Yt.currentUser){console.log("✅ [List] User already authenticated:",Yt.currentUser.uid),Q(!0);return}return Zw(Yt,async _=>{if(_)console.log("✅ [List] User authenticated:",_.uid),Q(!0);else{console.log("❌ [List] No user found, attempting anonymous sign-in...");try{await p3(Yt),console.log("✅ [List] Anonymous sign-in successful"),Q(!0)}catch(E){console.error("❌ [List] Anonymous sign-in failed:",E),Q(!1)}}})}catch(ie){console.error("❌ [List] Auth initialization error:",ie),u("فشل في تهيئة المصادقة")}})()},[]),N.useEffect(()=>{O&&Be()},[r,O]),N.useEffect(()=>{if(m.trim()){const fe=t.filter(ie=>ie.title?.toLowerCase().includes(m.toLowerCase())||ie.referenceNumber?.toLowerCase().includes(m.toLowerCase())||ie.description?.toLowerCase().includes(m.toLowerCase()));w(fe)}else w(t);te()},[m,t,te]);const U=fe=>{be(`هل أنت متأكد من حذف هذا المنتج المصنع؟

${fe.title}`,()=>se(fe),"تأكيد حذف المنتج المصنع")},se=async fe=>{try{D(!0),await Gn.moveToTrash(fe,"manufacturedProducts"),await ac.deleteManufacturedProduct(fe.id);const ie=I();z("task",`${ie.name} حذف منتج مصنع`,`تم حذف المنتج المصنع: ${fe.title}`),Be(),oe(`تم نقل المنتج المصنع للمهملات: ${fe.title}`,"تم النقل للمهملات")}catch(ie){console.error("Error deleting manufactured product:",ie),Y(`فشل في نقل المنتج المصنع للمهملات: ${ie.message}`,"خطأ في النقل")}finally{D(!1)}};return a?(console.log("ManufacturedProductsListFixed: Showing loading state"),n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"spinner-border text-primary",role:"status",children:n.jsx("span",{className:"visually-hidden",children:"جار التحميل..."})}),n.jsx("p",{className:"mt-3 text-muted",children:"جار تحميل بيانات المنتجات المصنعة..."})]})})):c?(console.log("ManufacturedProductsListFixed: Showing error state:",c),n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:c}),n.jsx("div",{className:"d-flex gap-2 justify-content-center",children:n.jsxs("button",{className:"btn btn-primary",onClick:Be,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة تحميل البيانات"]})})]})})):(console.log("ManufacturedProductsListFixed: Showing main content with",b.length,"products"),n.jsxs("div",{className:"card shadow-sm","data-list":"manufactured-products",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-gear-wide-connected text-primary me-2"}),"قائمة المنتجات المصنعة (",b.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsx("div",{className:"d-flex justify-content-end align-items-center gap-3",children:n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المنتجات المصنعة...",value:m,onChange:fe=>p(fe.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]})})})]})}),n.jsxs("div",{className:"card-body p-0",children:[b.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-gear-wide-connected fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد منتجات مصنعة"}),n.jsx("p",{className:"text-muted",children:m?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي منتجات مصنعة بعد"}),!m&&n.jsxs("button",{className:"btn btn-primary",onClick:()=>e("/manufactured-products/add"),children:[n.jsx("i",{className:"bi bi-plus-lg me-1"}),"إضافة أول منتج مصنع"]})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"اسم المنتج المصنع"}),n.jsx("th",{className:"text-center",children:"التكلفة التقديرية"}),n.jsx("th",{className:"text-center",children:"تاريخ الإضافة"}),n.jsx("th",{className:"text-center",style:{width:"120px",paddingLeft:"40px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:$.map((fe,ie)=>n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(H-1)*ce+ie+1})}),n.jsx("td",{className:"text-center",children:n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary product-title-btn",onClick:()=>{fe.id?e(`/manufactured-products/edit/${fe.id}`):Y("معرف المنتج مفقود، لا يمكن التنقل","خطأ في التنقل")},style:{textDecoration:"none",cursor:"pointer",color:"#007bff !important",fontWeight:"bold",border:"none",background:"none",padding:"0"},title:`انقر للتعديل | Firebase ID: ${fe.id||"Missing"}`,children:fe.title})}),n.jsx("td",{className:"text-center",children:n.jsxs("span",{className:"badge bg-success text-white",children:[(()=>{let _=0;return fe.items&&Array.isArray(fe.items)&&fe.items.length>0?_=fe.items.reduce((E,R)=>E+(R.totalPrice||0),0):_=fe.estimatedValue||0,_.toLocaleString("en-US")})()," ر.س"]})}),n.jsx("td",{className:"text-center",children:M(fe.submissionDeadline)}),n.jsx("td",{className:"text-center",style:{paddingLeft:"40px"},children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{className:"btn btn-outline-primary",onClick:()=>{if(!fe||!fe.id){Y("بيانات المنتج غير صحيحة أو مفقودة","خطأ في البيانات");return}e(`/manufactured-products/edit/${fe.id}`)},title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{className:"btn btn-outline-danger",onClick:()=>U(fe),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},fe.internalId||fe.id||`product-${ie}`))})]})}),b.length>0&&n.jsx(va,{currentPage:H,totalPages:k,onPageChange:X,totalItems:F,itemsPerPage:ce})]}),n.jsx(Rn,{show:ee.show,onClose:J,title:ee.title,message:ee.message,type:ee.type,onConfirm:ee.onConfirm,showConfirm:ee.showConfirm})]}))};function Y4(){const[r,e]=N.useState(!1),[t,s]=N.useState(0),{isTimelineVisible:a}=$n(),l=ms(),c=()=>{e(!r)};return n.jsx(sn,{children:n.jsx(rn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Kn,{onToggle:c}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!a?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"قائمة المنتجات المصنعة"})]})}),n.jsx(Yn,{}),n.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:n.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[n.jsx("div",{className:"d-flex align-items-center",children:n.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[n.jsx("i",{className:"bi bi-gear-wide-connected text-primary me-2"}),"إدارة المنتجات المصنعة"]})}),n.jsx("button",{onClick:()=>l("/manufactured-products/add"),className:"btn btn-primary",style:{height:"32px",width:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none",textAlign:"center",whiteSpace:"nowrap"},children:"إضافة منتج"})]})}),n.jsx("div",{className:"card-body p-0",children:n.jsx(K4,{refreshTrigger:t})})]})})})]}),!r&&a&&n.jsx(Xn,{rtl:!0}),!r&&a&&n.jsx(Jn,{})]})]})})})}function X4(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(Y4,{})})})}function J4(){const r=ms(),{id:e}=ea(),{logActivity:t,getCurrentUser:s}=vn(),{alertConfig:a,closeAlert:l,showSuccess:c,showError:u,showConfirm:m}=Pn(),{isTimelineVisible:p}=$n(),{formatDate:b}=yh(),w=!!e,[j,D]=N.useState(!1),[O,Q]=N.useState(!1),[z,I]=N.useState(()=>(console.log("📋 Initializing form data, will load from Firebase..."),{title:"",referenceNumber:"",description:"",submissionDeadline:"",estimatedValue:""})),[ee,J]=N.useState({}),[oe,Y]=N.useState(!1),[be,M]=N.useState(!1),[H,k]=N.useState(!1),[$,X]=N.useState(""),[te,F]=N.useState(!1),[ce,Be]=N.useState([]),[U,se]=N.useState(!1),[fe,ie]=N.useState(!1),[_,E]=N.useState(null),[R,V]=N.useState(""),[ne,B]=N.useState(!1),[q,me]=N.useState(!1),[C,Z]=N.useState(null),[je,Ge]=N.useState(-1),[Ke,ft]=N.useState([]),Ot=()=>{D(!j)},[Ee,it]=N.useState(!1),Nt=async()=>{if(Ke.length===0){u("لا توجد بنود للتحديث","قائمة فارغة");return}it(!0);try{console.log("🔄 PRODUCTITEMS RAW DATA:",JSON.stringify(Ke,null,2)),console.log("🔄 Starting direct price refresh for",Ke.length,"items");let Ne=0;const ue=[];for(const le of Ke){console.log("🔍 Refreshing item:",{name:le.materialName,type:le.materialType,id:le.materialInternalId,currentPrice:le.unitPrice});try{let Ie=null;if(le.materialType==="rawMaterial"){console.log("🔍 Looking up raw material with ID:",le.materialInternalId);let Te=await wr.getRawMaterialByInternalId(le.materialInternalId);if(!Te){console.log("⚠️ InternalId lookup failed, trying Firebase document ID...");try{Te=await wr.getRawMaterial(le.id)}catch{console.log("⚠️ Firebase ID lookup also failed")}}if(!Te){console.log("⚠️ All lookups failed, trying to find by name...");try{Te=(await wr.getAllRawMaterials()).find(ye=>ye.name===le.materialName),console.log("🔍 Found by name:",Te?"YES":"NO")}catch{console.log("⚠️ Name lookup also failed")}}Ie=parseFloat(Te?.price)||null,console.log("🔍 Final raw material result:",{found:!!Te,price:Te?.price,newPrice:Ie})}else if(le.materialType==="localProduct"){console.log("🔍 Looking up local product with ID:",le.materialInternalId);let Te=await vr.getLocalProductByInternalId(le.materialInternalId);if(!Te){console.log("⚠️ InternalId lookup failed, trying Firebase document ID...");try{Te=await vr.getLocalProduct(le.id)}catch{console.log("⚠️ Firebase ID lookup also failed")}}if(!Te){console.log("⚠️ All lookups failed, trying to find by name...");try{Te=(await vr.getAllLocalProducts()).find(ye=>ye.name===le.materialName),console.log("🔍 Found by name:",Te?"YES":"NO")}catch{console.log("⚠️ Name lookup also failed")}}Ie=parseFloat(Te?.price)||null,console.log("🔍 Final local product result:",{found:!!Te,price:Te?.price,newPrice:Ie})}else if(le.materialType==="foreignProduct"){console.log("🔍 Looking up foreign product with ID:",le.materialInternalId);let Te=await Nr.getForeignProductByInternalId(le.materialInternalId);if(!Te){console.log("⚠️ InternalId lookup failed, trying Firebase document ID...");try{Te=await Nr.getForeignProduct(le.id)}catch{console.log("⚠️ Firebase ID lookup also failed")}}if(!Te){console.log("⚠️ All lookups failed, trying to find by name...");try{Te=(await Nr.getAllForeignProducts()).find(ye=>ye.name===le.materialName),console.log("🔍 Found by name:",Te?"YES":"NO")}catch{console.log("⚠️ Name lookup also failed")}}Ie=parseFloat(Te?.price)||null,console.log("🔍 Final foreign product result:",{found:!!Te,price:Te?.price,newPrice:Ie})}if(console.log("🔍 EXACT VALUES:",{itemName:le.materialName,currentUnitPrice:le.unitPrice,currentUnitPriceType:typeof le.unitPrice,sourcePrice:Ie,sourcePriceType:typeof Ie,areEqual:Ie===le.unitPrice,willUpdate:Ie!==null&&Ie!==le.unitPrice}),Ie!==null&&Ie!==le.unitPrice){console.log("💰 UPDATING PRICE for",le.materialName,":",le.unitPrice,"→",Ie);const Te={...le,unitPrice:Ie,totalPrice:Ie*(le.quantity||1)};ue.push(Te),Ne++}else console.log("✅ NO UPDATE for",le.materialName,"- Current:",le.unitPrice,"Source:",Ie),ue.push(le)}catch(Ie){console.error("❌ Failed to refresh item:",le.materialName,Ie),ue.push(le)}}if(ft(ue),w&&Ne>0)try{console.log("💾 Saving manufactured product with updated prices to database...");const le=ue.reduce((We,ye)=>We+(ye.unitPrice||0)*(ye.quantity||1),0);I(We=>({...We,estimatedValue:le.toString()}));const Ie={...z,estimatedValue:le.toString(),items:ue,updatedAt:new Date,lastPriceRefresh:new Date};await ac.updateManufacturedProduct(e,Ie);const Te=s();t("task",`${Te.name} حدث أسعار المنتج المصنع`,`تم تحديث ${Ne} بند وحفظ المنتج: ${z.title||"غير محدد"}`),console.log("✅ Manufactured product saved successfully with updated prices"),setTimeout(()=>{console.log("🧭 Navigating to manufactured products list..."),r("/manufactured-products")},1500)}catch(le){console.error("❌ Failed to save manufactured product:",le),u(`تم تحديث الأسعار ولكن فشل حفظ المنتج: ${le?.message||le}`,"تحذير")}else Ne>0}catch(Ne){console.error("🚨 Refresh failed:",Ne),u(`فشل في تحديث الأسعار: ${Ne?.message||Ne}`,"خطأ في التحديث")}finally{it(!1)}};N.useEffect(()=>{(async()=>{try{if(console.log("🔐 Initializing Firebase authentication..."),Yt.currentUser){console.log("✅ User already authenticated:",Yt.currentUser.uid),Q(!0);return}return Zw(Yt,async le=>{le?(console.log("✅ User authenticated:",le.uid),Q(!0)):(console.log("❌ No user found - authentication required through login page"),Q(!1))})}catch(ue){console.error("❌ Auth initialization error:",ue),u("فشل في تهيئة المصادقة. يرجى إعادة تحميل الصفحة.","خطأ في التهيئة")}})()},[]),N.useEffect(()=>{const Ne=async()=>{if(w)await is();else{console.log("🆕 NEW MANUFACTURED PRODUCT MODE: Checking for pending items before clearing");const le=await rt.getPendingProductItems(),Ie=await rt.getPendingData(`productDocuments_${e||"new"}`);console.log("🔍 NEW MANUFACTURED PRODUCT: Checking for saved form data..."),console.log("🔐 AUTH STATE: authReady =",O,"currentUser =",Yt.currentUser?"EXISTS":"NULL");let Te=null;try{Te=await rt.getPendingData("productFormData_new"),console.log("📋 NEW MANUFACTURED PRODUCT: Saved form data result:",Te)}catch(We){console.error("❌ NEW MANUFACTURED PRODUCT: Error loading saved form data:",We),console.error("❌ Error details:",We.message)}if(Te?(console.log("📋 NEW MANUFACTURED PRODUCT: Restoring saved form data from previous session:",Te),I(Te)):(console.log("📝 NEW MANUFACTURED PRODUCT: Starting with fresh empty form"),I({title:"",referenceNumber:"",description:"",submissionDeadline:"",estimatedValue:""})),le&&le.length>0){console.log("🔄 NEW MANUFACTURED PRODUCT: Found pending items, loading them first"),ft(le);const We=le.reduce((ye,ze)=>ye+(ze.unitPrice||0)*(ze.quantity||1),0);We>0&&(console.log(`💰 Setting estimated value from items: ${We}`),I(ye=>({...ye,estimatedValue:We.toString()}))),m(`تم إضافة ${le.length} عنصر للمنتج المصنع بنجاح.

يمكنك الآن مراجعة البنود في القائمة أدناه.`,()=>{},"تمت إضافة البنود","موافق","",!1)}Ie&&Ie.length>0&&(console.log("📁 NEW MANUFACTURED PRODUCT: Found pending documents, loading them"),Be(Ie)),Te&&(console.log("📋 NEW MANUFACTURED PRODUCT: Found pending form data, loading it"),I(We=>({...We,...Te}))),console.log("✅ NEW MANUFACTURED PRODUCT: Initialization completed (form data preserved)"),console.log("✅ NEW MANUFACTURED PRODUCT: Initialization completed")}const ue=setInterval(async()=>{const le=await rt.getPendingProductItems();le&&le.length>0&&(console.log("🔄 Periodic check found pending items, loading..."),await xn())},1e3);return setTimeout(()=>clearInterval(ue),1e4),()=>clearInterval(ue)};O?(console.log("🔐 AUTH READY: Starting to load data for manufactured products"),Ne()):console.log("⏳ AUTH NOT READY: Waiting for authentication...")},[e,O]);const hn=(Ne,ue)=>{console.log("🧠 SENIOR REACT: Starting advanced duplicate prevention analysis..."),console.log("🔍 EXISTING ITEMS:",Ne.map(ze=>({id:ze.internalId||ze.materialInternalId,name:ze.materialName||ze.name}))),console.log("🔍 NEW ITEMS:",ue.map(ze=>({id:ze.internalId||ze.materialInternalId,name:ze.materialName||ze.name})));const le=[],Ie=[],Te=new Map,We=new Map,ye=new Map;return Ne.forEach((ze,Oe)=>{const nt=ze.internalId||ze.materialInternalId,Ze=ze.materialInternalId||ze.internalId,Je=(ze.materialName||ze.name||"").toLowerCase().trim();console.log("📋 EXISTING ITEM:",{internalId:nt,materialId:Ze,itemName:Je}),nt&&Te.set(nt,{item:ze,index:Oe}),Ze&&We.set(Ze,{item:ze,index:Oe}),Je&&ye.set(Je,{item:ze,index:Oe})}),ue.forEach(ze=>{const Oe=ze.internalId||ze.materialInternalId,nt=ze.materialInternalId||ze.internalId,Ze=(ze.materialName||ze.name||"").toLowerCase().trim();console.log("🆕 CHECKING NEW ITEM:",{newInternalId:Oe,newMaterialId:nt,newItemName:Ze});let Je=!1,Ve=null;Oe&&Te.has(Oe)?(console.log("🚨 DUPLICATE BY INTERNAL ID:",Oe),Je=!0,Ve={type:"ID",displayName:ze.materialName||ze.name,matchedItem:Te.get(Oe).item}):nt&&We.has(nt)?(console.log("🚨 DUPLICATE BY MATERIAL ID:",nt),Je=!0,Ve={type:"ID",displayName:ze.materialName||ze.name,matchedItem:We.get(nt).item}):Ze&&ye.has(Ze)&&(console.log("🚨 DUPLICATE BY NAME:",Ze),Je=!0,Ve={type:"NAME",displayName:ze.materialName||ze.name,matchedItem:ye.get(Ze).item}),Je?(le.push(Ve),console.log("⚠️ DUPLICATE DETECTED:",{newItem:ze.materialName||ze.name,type:Ve.type,matchedWith:Ve.matchedItem.materialName||Ve.matchedItem.name})):(Ie.push(ze),console.log("✅ UNIQUE ITEM ADDED:",ze.materialName||ze.name))}),console.log("🛡️ DUPLICATE PREVENTION SUMMARY:",{totalNewItems:ue.length,duplicatesFound:le.length,uniqueItemsToAdd:Ie.length}),{duplicates:le,uniqueItems:Ie}},xn=async()=>{try{console.log("🔍 Loading pending product items from Firestore...");const Ne=await rt.getPendingProductItems();if(Ne){const ue=Array.isArray(Ne)?Ne:JSON.parse(Ne);console.log("📦 Found pending product items:",ue.length,"items"),ft(le=>{if(le.length===ue.length&&le.length>0){const ze=le.map(Ze=>Ze.internalId||Ze.materialInternalId).sort(),Oe=ue.map(Ze=>Ze.internalId||Ze.materialInternalId).sort();if(ze.length===Oe.length&&ze.every((Ze,Je)=>Ze===Oe[Je]))return console.log("🔄 ITEMS UNCHANGED: Same length and same IDs, skipping update"),le}console.log("🔄 ITEMS CHANGED: Different length or different IDs, processing update..."),console.log("📊 Prev items:",le.length,"Parsed items:",ue.length),console.log("🛡️ SENIOR REACT: Processing new/changed items...");let Ie=[],Te=[];if(le.length===0)console.log("🆕 EMPTY STATE: Loading initial pending items"),Ie=[],Te=ue;else{console.log("🔄 EXISTING STATE: Checking for duplicates");const ze=hn(le,ue);if(Ie=ze.duplicates,Te=ze.uniqueItems,Ie.length>0){const Oe=Ie.map(nt=>{const Ze=nt.type==="ID"?"معرف مطابق":"اسم مطابق";return`⚠️ "${nt.displayName}" (${Ze})`});u(`تم العثور على ${Ie.length} بند مكرر. تم إضافة ${Te.length} بند جديد فقط.

${Oe.join(`
`)}`,"بنود مكررة")}console.log("🚨 DUPLICATES BLOCKED:",{count:Ie.length,names:Ie.map(Oe=>Oe.displayName)})}const We=[...le,...Te],ye=We.reduce((ze,Oe)=>ze+(Oe.unitPrice||0)*(Oe.quantity||1),0);return I(ze=>({...ze,estimatedValue:ye.toString()})),console.log("🛡️ SENIOR REACT DUPLICATE PREVENTION RESULT:",{existingCount:le.length,newUniqueItems:Te.length,duplicatesBlocked:Ie.length,finalCount:We.length,preventionSuccess:Ie.length===0?"ALL_UNIQUE":"DUPLICATES_FILTERED"}),We}),console.log("✅ Items loaded and ready - keeping in storage until product is saved")}else{console.log("📦 No pending product items found in Firestore");const ue=await rt.getPendingData(`productItems_${e||"new"}`);if(ue&&Ke.length===0)try{Array.isArray(ue)&&ue.length>0&&(console.log("📦 Loading existing product items from Firestore:",ue.length),ft(ue))}catch(le){console.error("Error loading Firestore items:",le)}}}catch(Ne){console.error("Error loading pending items:",Ne)}};N.useEffect(()=>{let Ne=null,ue=null;const le=()=>{Ne&&clearTimeout(Ne),Ne=setTimeout(()=>{console.log("🔍 WINDOW FOCUS: Checking for pending product items..."),xn()},500)},Ie=We=>{console.log("🎯 CUSTOM EVENT: productItemsAdded detected"),Ne&&clearTimeout(Ne),Ne=setTimeout(()=>{xn()},300)},Te=()=>{document.hidden||(console.log("🔍 PAGE VISIBLE: Checking for pending product items..."),Ne&&clearTimeout(Ne),Ne=setTimeout(()=>{xn()},500))};return O&&(console.log("🎧 ADDING EVENT LISTENERS for product item detection"),ue=setTimeout(()=>{console.log("🔍 INITIAL CHECK: Looking for pending product items..."),xn()},1e3)),window.addEventListener("focus",le),document.addEventListener("visibilitychange",Te),window.addEventListener("productItemsAdded",Ie),()=>{window.removeEventListener("focus",le),document.removeEventListener("visibilitychange",Te),window.removeEventListener("productItemsAdded",Ie),Ne&&clearTimeout(Ne),ue&&clearTimeout(ue)}},[O]);const is=async()=>{if(e)try{M(!0),console.log("🔍 Loading manufactured product:",e);const Ne=await ac.getManufacturedProductById(e),ue={...Ne,submissionDeadline:Ne.submissionDeadline?ku(Ne.submissionDeadline):""};if(I(ue),Ne.documents&&Array.isArray(Ne.documents)){const le=Ne.documents.filter(Ie=>Ie&&typeof Ie=="object"&&Ie.fileName&&Ie.fileURL);Be(le),console.log("✅ Loaded product documents from Firebase database:",le.length)}Ne.items&&Array.isArray(Ne.items)&&ft(Ne.items),console.log("✅ Loaded manufactured product successfully:",Ne.title)}catch(Ne){console.error("❌ Error loading manufactured product:",Ne),u(`فشل في تحميل بيانات المنتج: ${Ne.message}`,"خطأ في التحميل")}finally{M(!1)}},Un=async Ne=>{const{name:ue,value:le,type:Ie,checked:Te}=Ne.target,We={...z,[ue]:Ie==="checkbox"?Te:le};I(We);try{const ye=e?`productFormData_${e}`:"productFormData_new";await rt.setPendingData(ye,We),console.log(`💾 Form data saved for field: ${ue}`)}catch(ye){console.error("Error saving form data:",ye)}ee[ue]&&J(ye=>({...ye,[ue]:void 0}))},Xt=async()=>{const Ne={};if(z.title?.trim()||(Ne.title="اسم المنتج مطلوب"),z.referenceNumber?.trim()||(Ne.referenceNumber="رقم المرجع مطلوب"),z.submissionDeadline||(Ne.submissionDeadline="تاريخ الإضافة مطلوب"),z.referenceNumber?.trim())try{await oo.checkUnique("manufacturedProducts","referenceNumber",z.referenceNumber.trim(),w?e:null)&&(Ne.referenceNumber="رقم المرجع موجود مسبقاً")}catch(ue){console.warn("Could not validate reference number uniqueness:",ue)}return J(Ne),Object.keys(Ne).length===0},yn=async Ne=>{if(Ne.preventDefault(),oe)return;if(!O){u("جار تهيئة المصادقة، يرجى المحاولة مرة أخرى","المصادقة غير جاهزة");return}if(!await Xt()){u("يرجى تصحيح الأخطاء المذكورة أعلاه","بيانات غير صحيحة");return}try{Y(!0),console.log("💾 Saving manufactured product...");const le={...z,documents:ce||[],items:Ke||[]};let Ie;if(w){Ie=await ac.updateManufacturedProduct(e,le);const Te=s();t("task",`${Te.name} عدل منتج مصنع`,`تم تعديل: ${z.title}`),c("تم تحديث المنتج المصنع بنجاح!","تم التحديث"),await rt.clearPendingData(`productFormData_${e}`),await rt.clearPendingData(`productDocuments_${e}`),await rt.clearPendingProductItems(),setTimeout(()=>{r("/manufactured-products")},2e3)}else{Ie=await ac.createManufacturedProduct(le);const Te=s();t("task",`${Te.name} أضاف منتج مصنع جديد`,`تم إضافة: ${z.title}`),c("تم إضافة المنتج المصنع بنجاح!","تم الحفظ"),await rt.clearPendingData("productFormData_new"),await rt.clearPendingData("productDocuments_new"),await rt.clearPendingProductItems(),setTimeout(()=>{r("/manufactured-products")},2e3)}console.log("✅ Manufactured product saved successfully:",Ie?.id||"unknown")}catch(le){console.error("❌ Error saving manufactured product:",le),u(`فشل في حفظ المنتج: ${le.message}`,"خطأ في الحفظ"),J(Ie=>({...Ie,submit:`فشل في حفظ المنتج: ${le.message}`}))}finally{Y(!1)}},Zn=N.useCallback(()=>{if(!Ke||Ke.length===0)return 0;const Ne=Ke.reduce((ue,le)=>ue+(le.totalPrice||0),0);return console.log("📊 INSTANT: Reflecting pre-calculated total from items:",Ne),Ne},[Ke]),es=()=>{k(!0)},an=Ne=>{console.log("🔧 Manufacturing Item Selected:",Ne),X(Ne);const le={"raw-materials":`/manufactured-products/raw-materials/${e||"new"}`,"local-product":`/manufactured-products/local-products/${e||"new"}`,"imported-product":`/manufactured-products/foreign-products/${e||"new"}`,"manufactured-product":`/manufactured-products/edit/${e||"new"}`}[Ne];le&&Ne!=="manufactured-product"&&r(le)},Bt=async Ne=>{ft(ue=>{const le=ue.filter((Ie,Te)=>Te!==Ne);return rt.setPendingData(`productItems_${e||"new"}`,le),le})},Nn=(Ne,ue)=>{console.log("🔧 handleEditItem called with:",{item:Ne,index:ue}),console.log("🔧 Opening edit modal for item:",Ne),Z({...Ne,quantity:Ne.quantity||1}),Ge(ue),me(!0),console.log("🔧 Edit modal state should be open now")},T=Ne=>{const ue=Math.max(.1,parseFloat(Ne)||.1),le=parseFloat(ue.toFixed(1));Z(Ie=>({...Ie,quantity:le,totalPrice:(Ie.unitPrice||0)*le}))},re=()=>{if(console.log("🔧 handleSaveEditedItem called"),!C||je===-1){u("بيانات البند غير صحيحة","خطأ في البيانات");return}ft(Ne=>{const ue=[...Ne];return ue[je]=C,rt.setPendingData(`productItems_${e||"new"}`,ue),console.log("✅ Item updated successfully:",C),ue}),me(!1),Z(null),Ge(-1),console.log("✅ Item updated and modal closed")},he=()=>{console.log("🔧 handleCloseEditModal called"),me(!1),Z(null),Ge(-1)},de=async()=>{try{w||(console.log("🧹 CANCEL: Clearing all pending data for cancelled new manufactured product"),await rt.clearPendingData(`productFormData_${e||"new"}`),await rt.clearPendingData(`productDocuments_${e||"new"}`),await rt.clearPendingProductItems(),console.log("✅ CANCEL: All pending data cleared successfully"))}catch(Ne){console.error("Error clearing pending data on cancel:",Ne)}r("/manufactured-products")},xe=async Ne=>{const ue=Ne.target.files[0];if(ue){se(!0);try{try{_r.validateFile(ue,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]})}catch(le){throw new Error(le.message)}E({file:ue,originalFileName:ue.name,fileSize:ue.size,fileType:ue.type}),ie(!0)}catch(le){console.error("File upload error:",le),u(`فشل في رفع الملف: ${le.message}`,"خطأ في الرفع")}finally{se(!1),Ne.target&&(Ne.target.value="")}}},Ue=async()=>{if(!R.trim()){u("يرجى إدخال اسم للملف","اسم الملف مطلوب");return}if(!_){u("لم يتم العثور على بيانات الملف","خطأ في البيانات");return}se(!0);try{console.log("🔄 Starting file upload with custom name:",R);const Ne=await _r.uploadFile(_.file,"product-documents");if(console.log("✅ File uploaded successfully:",Ne),console.log("📄 Download URL for access:",Ne.url),!Ne.url||!Ne.url.startsWith("https://"))throw new Error("فشل في الحصول على رابط تحميل صالح من Firebase Storage");const ue={id:`doc_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,fileName:R.trim(),originalFileName:_.originalFileName,fileSize:_.fileSize,fileType:_.fileType,fileURL:Ne.url,uploadedAt:new Date().toISOString(),storagePath:Ne.path};Be(Te=>[...Te,ue]);const le=[...ce,ue];await rt.setPendingData(`productDocuments_${e||"new"}`,le),console.log("✅ Document added to list:",ue),c(`تم رفع الملف بنجاح: ${R}`,"تم الرفع");const Ie=s();t("file",`${Ie.name} رفع ملف للمنتج المصنع`,`رفع: ${R}`)}catch(Ne){console.error("❌ Error in handleFileNameSave:",Ne),u(`فشل في حفظ الملف: ${Ne.message}`,"خطأ في الحفظ")}finally{se(!1),ie(!1),E(null),V("")}},bt=()=>{ie(!1),E(null),V("")},pt=Ne=>{m(`هل أنت متأكد من حذف هذا الملف؟

${Ne.fileName}`,()=>Vs(Ne),"تأكيد حذف الملف")},Vs=async Ne=>{try{B(!0),await Gn.moveToTrash(Ne,"product_documents"),Be(Ie=>Ie.filter(Te=>Te.id!==Ne.id));const ue=ce.filter(Ie=>Ie.id!==Ne.id);await rt.setPendingData(`productDocuments_${e||"new"}`,ue);const le=s();t("file",`${le.name} حذف ملف من المنتج المصنع`,`حذف: ${Ne.fileName}`),c(`تم نقل الملف للمهملات: ${Ne.fileName}`,"تم النقل للمهملات")}catch(ue){console.error("Error deleting document:",ue),u(`فشل في نقل الملف للمهملات: ${ue.message}`,"خطأ في النقل")}finally{B(!1)}};return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`page-wrapper ${j?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Kn,{onToggle:Ot}),n.jsxs("div",{className:"main-container",style:{paddingRight:j?"72px":"250px",paddingLeft:j||!p?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:j?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:j})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item",children:n.jsx("a",{href:"/manufactured-products",className:"text-decoration-none text-primary",children:"المنتجات المصنعة"})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:w?"تعديل منتج مصنع":"إضافة منتج مصنع جديد"})]})}),n.jsx(Yn,{}),n.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:n.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[n.jsx("div",{className:"d-flex align-items-center",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:`bi ${w?"bi-pencil-square":"bi-plus-circle-fill"} text-primary me-2`}),w?"تعديل المنتج المصنع":"إضافة منتج مصنع جديد"]})}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-primary",onClick:es,style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:"إضافة بند"}),n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>F(!0),style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:"وثائق المنتج"})]})]})}),n.jsx("div",{className:"card-body",children:be?n.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:n.jsx(Dn,{size:"large"})}):n.jsxs("form",{onSubmit:yn,children:[ee.submit&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),ee.submit]}),n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-8 mb-3",children:[n.jsx("label",{className:"form-label",children:"اسم المنتج *"}),n.jsx("input",{type:"text",className:`form-control ${ee.title?"is-invalid":""}`,name:"title",value:z.title,onChange:Un,placeholder:"أدخل اسم المنتج المصنع",disabled:oe}),ee.title&&n.jsx("div",{className:"invalid-feedback",children:ee.title})]}),n.jsxs("div",{className:"col-md-4 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم المرجع *"}),n.jsx("input",{type:"text",className:`form-control ${ee.referenceNumber?"is-invalid":""}`,name:"referenceNumber",value:z.referenceNumber,onChange:Un,placeholder:"رقم المرجع",disabled:oe}),ee.referenceNumber&&n.jsx("div",{className:"invalid-feedback",children:ee.referenceNumber})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsxs("label",{className:"form-label",children:["التكلفة التقديرية",n.jsx("small",{className:"text-muted ms-2",children:"(محسوبة تلقائياً من البنود)"})]}),n.jsxs("div",{className:"input-group",children:[n.jsx("input",{type:"text",className:"form-control bg-light",name:"estimatedValue",value:(()=>{const Ne=Zn();return Ne>0?`${Ne.toLocaleString("en-US")} ريال`:"0 ريال"})(),readOnly:!0,placeholder:"سيتم حسابها من البنود المضافة",style:{backgroundColor:"#f8f9fa",fontWeight:"bold",color:"#198754"}}),n.jsx("span",{className:"input-group-text bg-light text-success",children:n.jsx("i",{className:"bi bi-calculator"})})]})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"تاريخ الإضافة *"}),n.jsxs("div",{className:"input-group",children:[n.jsx("input",{type:"date",className:`form-control ${ee.submissionDeadline?"is-invalid":""}`,name:"submissionDeadline",value:z.submissionDeadline||"",onChange:Un,disabled:oe,required:!0,style:{backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23212529'%3e%3cpath d='M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v1h14V3a1 1 0 0 0-1-1H2zm13 3H1v9a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V5z'/%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"left 12px center",backgroundSize:"16px 16px",paddingLeft:"40px"}}),n.jsx("span",{className:"input-group-text bg-light",children:n.jsx("i",{className:"bi bi-calendar-event text-primary"})})]}),z.submissionDeadline&&n.jsxs("small",{className:"text-muted d-block mt-1",children:["التاريخ المحدد: ",b(z.submissionDeadline)]}),ee.submissionDeadline&&n.jsx("div",{className:"invalid-feedback",children:ee.submissionDeadline})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"وصف المنتج"}),n.jsx("textarea",{className:"form-control",name:"description",value:z.description,onChange:Un,rows:"4",placeholder:"وصف تفصيلي للمنتج المصنع ومتطلباته...",disabled:oe})]}),Ke.length>0&&n.jsx("div",{className:"col-md-12 mb-4",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-light",children:n.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[n.jsxs("h6",{className:"mb-0 fw-bold text-primary",children:[n.jsx("i",{className:"bi bi-list-task me-2"}),"بنود المنتج (",Ke.length,")"]}),n.jsx("button",{type:"button",className:"btn btn-success btn-sm",onClick:Nt,disabled:Ee||Ke.length===0,style:{fontSize:"12px",padding:"4px 12px",borderRadius:"4px"},children:Ee?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status"}),"جار التحديث..."]}):n.jsx(n.Fragment,{children:"🔄 تحديث أسعار"})})]})}),n.jsx("div",{className:"card-body p-0",children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"اسم المادة"}),n.jsx("th",{className:"text-center",style:{paddingRight:"20px"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{paddingRight:"20px"},children:"الوحدة"}),n.jsx("th",{className:"text-center",style:{paddingRight:"20px"},children:"السعر الإجمالي"}),n.jsx("th",{className:"text-center",style:{width:"60px",paddingRight:"20px",paddingLeft:"40px"},children:"إجراء"})]})}),n.jsx("tbody",{children:Ke.map((Ne,ue)=>{let le=Ne.materialName||Ne.name||"مادة غير محددة";le&&le.toString().startsWith("rm_")&&(le="مادة غير محددة");const Ie=Ne.materialUnit||Ne.unit||"قطعة",Te=Ne.totalPrice||0,We=Ne.internalId;return n.jsxs("tr",{className:"",style:{backgroundColor:ue%2===0?"#ffffff":"#f8f9fa"},children:[n.jsx("td",{className:"text-center fw-bold text-muted",children:ue+1}),n.jsx("td",{className:"text-center fw-medium",children:n.jsx("div",{children:n.jsx("button",{className:"btn btn-link p-0 fw-medium text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:async ye=>{ye.preventDefault(),ye.stopPropagation();try{console.log("=== DETAILED DEBUGGING ==="),console.log("Full item object:",JSON.stringify(Ne,null,2)),console.log("All item keys:",Object.keys(Ne));const ze=Ne.materialInternalId,Oe=Ne.materialType||"rawMaterial";console.log("Searching for:"),console.log("- materialInternalId:",ze),console.log("- materialType:",Oe);let nt=null,Ze=[];if(Oe==="rawMaterial"){console.log("Loading raw materials...");const{RawMaterialService:Je}=await ar(async()=>{const{RawMaterialService:ke}=await Promise.resolve().then(()=>lx);return{RawMaterialService:ke}},void 0);Ze=await Je.getAllRawMaterials(),console.log("Total raw materials loaded:",Ze.length),console.log("Sample raw material IDs:",Ze.slice(0,3).map(ke=>({id:ke.id,internalId:ke.internalId,name:ke.name})));let Ve=Ze.find(ke=>ke.internalId===ze);if(Ve||(Ve=Ze.find(ke=>ke.id===ze)),!Ve){const ke=Ne.materialName||Ne.name;Ve=Ze.find(et=>et.name===ke)}console.log("Found raw material:",Ve?"YES":"NO"),Ve&&(console.log("Material details:",{id:Ve.id,internalId:Ve.internalId,name:Ve.name}),nt=Ve.id,r(`/raw-materials/edit/${nt}`))}else if(Oe==="localProduct"){console.log("Loading local products...");const{LocalProductService:Je}=await ar(async()=>{const{LocalProductService:ke}=await Promise.resolve().then(()=>cx);return{LocalProductService:ke}},void 0);Ze=await Je.getAllLocalProducts(),console.log("Total local products loaded:",Ze.length),console.log("Sample local product IDs:",Ze.slice(0,3).map(ke=>({id:ke.id,internalId:ke.internalId,name:ke.name})));let Ve=Ze.find(ke=>ke.internalId===ze);if(Ve||(Ve=Ze.find(ke=>ke.id===ze)),!Ve){const ke=Ne.materialName||Ne.name;Ve=Ze.find(et=>et.name===ke)}console.log("Found local product:",Ve?"YES":"NO"),Ve&&(console.log("Product details:",{id:Ve.id,internalId:Ve.internalId,name:Ve.name}),nt=Ve.id,r(`/local-products/edit/${nt}`))}else if(Oe==="foreignProduct"){console.log("Loading foreign products...");const{ForeignProductService:Je}=await ar(async()=>{const{ForeignProductService:ke}=await Promise.resolve().then(()=>dx);return{ForeignProductService:ke}},void 0);Ze=await Je.getAllForeignProducts(),console.log("Total foreign products loaded:",Ze.length),console.log("Sample foreign product IDs:",Ze.slice(0,3).map(ke=>({id:ke.id,internalId:ke.internalId,name:ke.name})));let Ve=Ze.find(ke=>ke.internalId===ze);if(Ve||(Ve=Ze.find(ke=>ke.id===ze)),!Ve){const ke=Ne.materialName||Ne.name;Ve=Ze.find(et=>et.name===ke)}console.log("Found foreign product:",Ve?"YES":"NO"),Ve&&(console.log("Product details:",{id:Ve.id,internalId:Ve.internalId,name:Ve.name}),nt=Ve.id,r(`/foreign-products/edit/${nt}`))}nt||(console.error("=== SEARCH FAILED ==="),console.error("Could not find Firebase ID for:",ze),console.error("Available items in this category:",Ze.map(Je=>({id:Je.id,internalId:Je.internalId,name:Je.name}))),alert(`لا يمكن العثور على هذه المادة
ID: ${ze}
Type: ${Oe}`))}catch(ze){console.error("=== NAVIGATION ERROR ===",ze),alert("حدث خطأ أثناء محاولة فتح المادة")}},title:`تحرير: ${le}`,children:le})})}),n.jsx("td",{className:"text-center",style:{paddingRight:"20px"},children:n.jsx("span",{className:"badge bg-primary",children:Ne.quantity||1})}),n.jsx("td",{className:"text-center",style:{paddingRight:"20px"},children:Ie}),n.jsx("td",{className:"text-center",style:{paddingRight:"20px"},children:n.jsxs("div",{children:[n.jsxs("span",{className:"text-success fw-bold",children:[Te.toLocaleString("en-US")," ر.س"]}),Ne.unitPrice&&n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:[Ne.unitPrice.toLocaleString("en-US")," × ",Ne.quantity]})})]})}),n.jsx("td",{className:"text-center",style:{paddingRight:"20px",paddingLeft:"40px"},children:n.jsxs("div",{className:"d-flex justify-content-center gap-1",children:[n.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:ye=>{ye.preventDefault(),ye.stopPropagation(),Nn(Ne,ue)},title:"تعديل الكمية",style:{width:"27px",height:"27px",padding:"0",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #007bff",color:"#007bff",backgroundColor:"transparent",transition:"all 0.2s ease"},onMouseEnter:ye=>{ye.target.style.backgroundColor="#007bff",ye.target.style.color="white"},onMouseLeave:ye=>{ye.target.style.backgroundColor="transparent",ye.target.style.color="#007bff"},children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:ye=>{ye.preventDefault(),ye.stopPropagation(),Bt(ue)},title:"حذف",style:{width:"27px",height:"27px",padding:"0",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #dc3545",color:"#dc3545",backgroundColor:"transparent",transition:"all 0.2s ease"},onMouseEnter:ye=>{ye.target.style.backgroundColor="#dc3545",ye.target.style.color="white"},onMouseLeave:ye=>{ye.target.style.backgroundColor="transparent",ye.target.style.color="#dc3545"},children:n.jsx("i",{className:"bi bi-trash"})})]})})]},We||`item-${ue}`)})}),n.jsx("tfoot",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{colSpan:"4",className:"text-end",children:"إجمالي القيمة:"}),n.jsxs("th",{className:"text-center text-primary fw-bold",children:[Zn().toLocaleString("en-US")," ر.س"]}),n.jsx("th",{})]})})]})})})]})})]}),n.jsx("div",{className:"row",children:n.jsxs("div",{className:"col-12 d-flex justify-content-center gap-3 mt-4",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",style:{height:"32px",minWidth:"80px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},onClick:de,disabled:oe,children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary",style:{height:"32px",minWidth:"80px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},disabled:oe,children:oe?n.jsxs(n.Fragment,{children:[n.jsx(Dn,{size:"small"}),n.jsx("span",{className:"ms-2",children:w?"تحديث...":"حفظ..."})]}):w?"تحديث":"حفظ"})]})})]})})]})})})]}),p&&n.jsxs("div",{style:{position:"fixed",left:"20px",top:"70px",width:"350px",height:"calc(100vh - 90px)",zIndex:10,background:"white",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",display:"flex",flexDirection:"column"},children:[n.jsx("div",{style:{flex:1,overflow:"hidden"},children:n.jsx(Xn,{})}),n.jsx("div",{style:{borderTop:"1px solid #e9ecef",padding:"10px",background:"#f8f9fa",borderRadius:"0 0 8px 8px"},children:n.jsx(Jn,{})})]})]})]}),n.jsx(sC,{show:H,onClose:()=>k(!1),onItemSelect:an,selectedItemType:$,setSelectedItemType:X}),n.jsx(rv,{show:te,onClose:()=>F(!1),documents:ce,setDocuments:Be,tenderId:e||"new",tenderTitle:z.title||"منتج جديد",uploadingDocument:U,setUploadingDocument:se,handleDocumentUpload:xe,handleDeleteClick:pt,deleting:ne}),n.jsx(Rn,{show:a.show,onClose:l,title:a.title,message:a.message,type:a.type,onConfirm:a.onConfirm,confirmText:a.confirmText,cancelText:a.cancelText,showCancel:a.showCancel}),fe&&n.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.7)",zIndex:1060},tabIndex:"-1",dir:"rtl",children:n.jsx("div",{className:"modal-dialog modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsx("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"12px 12px 0 0"},children:n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-pencil-square me-2"}),"تسمية الملف"]})}),n.jsx("div",{className:"modal-body",style:{padding:"25px"},children:n.jsxs("div",{className:"mb-4",children:[n.jsxs("div",{className:"d-flex align-items-center mb-3",children:[n.jsx("div",{className:"bg-success bg-opacity-10 p-2 rounded-circle me-3",children:n.jsx("i",{className:"bi bi-file-earmark-check text-success"})}),n.jsxs("div",{children:[n.jsx("h6",{className:"mb-0 fw-bold text-success",children:"تم رفع الملف بنجاح"}),n.jsx("small",{className:"text-muted",children:_?.originalFileName})]})]}),n.jsxs("div",{className:"mb-3",children:[n.jsxs("label",{className:"form-label fw-bold text-primary",children:[n.jsx("i",{className:"bi bi-tag me-1"}),"اسم الملف المخصص *"]}),n.jsx("input",{type:"text",className:"form-control",value:R,onChange:Ne=>V(Ne.target.value),placeholder:"أدخل اسم الملف المخصص",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:Ne=>{Ne.target.style.borderColor="#28a745",Ne.target.style.boxShadow="0 0 0 0.2rem rgba(40, 167, 69, 0.25)"},onBlur:Ne=>{Ne.target.style.borderColor="#e9ecef",Ne.target.style.boxShadow="none"},autoFocus:!0}),n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),"سيتم استخدام هذا الاسم لعرض الملف في قائمة الوثائق"]})]})]})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:n.jsxs("div",{className:"d-flex justify-content-end",style:{gap:"12px"},children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:bt,style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-success",onClick:Ue,disabled:!R.trim()||U,style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500",opacity:R.trim()&&!U?1:.6},children:U?n.jsxs(n.Fragment,{children:[n.jsx(Dn,{size:"small"}),n.jsx("span",{className:"ms-1",children:"حفظ..."})]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),"حفظ"]})})]})})]})})}),q&&C&&n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-calculator me-2"}),"تعديل كمية البند"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:he,"aria-label":"Close"})]}),n.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"30%"},children:"اسم المادة"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"السعر الأساسي"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"المورد"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"إجمالي السعر"})]})}),n.jsx("tbody",{children:n.jsxs("tr",{style:{height:"60px"},children:[n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:"bi bi-layers text-danger me-2"}),n.jsxs("div",{children:[n.jsx("div",{className:"fw-bold text-primary",children:C.materialName||C.name||"مادة غير محددة"}),n.jsx("small",{className:"text-muted",children:C.materialCategory||C.category||""})]})]})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("span",{className:"fw-bold text-success",children:[Math.round(C.unitPrice||0)," ريال"]}),n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:["/",C.materialUnit||C.unit||"وحدة"]})})]}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>T(C.quantity-.1),disabled:C.quantity<=.1,style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-dash"})}),n.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:(C.quantity||.1).toFixed(1),min:"0.1",step:"0.1",onChange:Ne=>T(Ne.target.value)}),n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>T(C.quantity+.1),style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-plus"})})]})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"text-muted",children:C.displaySupplier||C.supplier||"-"})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(C.totalPrice||0)," ريال"]}),n.jsxs("small",{className:"text-success",children:["(",(C.quantity||.1).toFixed(1)," × ",Math.round(C.unitPrice||0),")"]})]})]})})]})})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:n.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("span",{className:"text-muted me-3",children:"إجمالي البند:"}),n.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[Math.round(C.totalPrice||0)," ريال"]}),n.jsxs("span",{className:"badge bg-info ms-2",children:[(C.quantity||.1).toFixed(1)," ",C.materialUnit||C.unit||"قطعة"]})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:he,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:re,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"تأكيد"})]})]})})]})})})]})}function qE(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(J4,{})})})}function Z4(){const[r,e]=N.useState(!1),{isTimelineVisible:t}=$n(),[s,a]=N.useState([]),[l,c]=N.useState([]),[u,m]=N.useState(!1),[p,b]=N.useState(null),[w,j]=N.useState(""),[D,O]=N.useState([]),[Q,z]=N.useState(!1),[I,ee]=N.useState([]),J=ms(),{productId:oe}=ea(),{logActivity:Y,getCurrentUser:be}=vn(),{alertConfig:M,closeAlert:H,showSuccess:k,showError:$}=Pn(),X=async(_,E={})=>{try{console.log("🔍 DUPLICATE CHECK: Checking",_.length,"items against existing product items");const R=await rt.getPendingProductItems()||[];if(console.log("🔍 DUPLICATE CHECK: Found",R.length,"existing items"),R.length===0)return console.log("✅ DUPLICATE CHECK: No existing items, all items are unique"),{success:!0,uniqueItems:_||[]};const V=[],ne=[];for(const B of _){const q=B.materialInternalId||B.internalId||B.id,me=(B.materialName||B.name||"").trim().toLowerCase();R.some(Z=>{const je=Z.materialInternalId||Z.internalId||Z.id,Ge=(Z.materialName||Z.name||"").trim().toLowerCase();return q&&je&&q===je||me&&Ge&&me===Ge})?(V.push(B),console.log("🚨 DUPLICATE FOUND:",B.materialName||B.name)):(ne.push(B),console.log("✅ UNIQUE ITEM:",B.materialName||B.name))}if(V.length>0&&E.showError){const B=V.map(q=>q.materialName||q.name).join("، ");if(E.showError(`تم العثور على ${V.length} بند مكرر: ${B}. لن يتم إضافة البنود المكررة.`,E.errorTitle||"بنود مكررة"),E.stopOnDuplicates&&ne.length===0)return{success:!1,uniqueItems:[]}}return console.log("🔍 DUPLICATE CHECK RESULT:",{totalItems:_.length,duplicates:V.length,uniqueItems:ne.length}),{success:!0,uniqueItems:ne}}catch(R){return console.error("❌ Error in duplicate prevention:",R),{success:!0,uniqueItems:_||[]}}},te=()=>{e(!r)};N.useEffect(()=>{F();const _=V=>{V.type==="rawMaterialsUpdated"&&F()},E=()=>{F()};window.addEventListener("storage",_),window.addEventListener("rawMaterialsUpdated",E);const R=()=>{F()};return window.addEventListener("focus",R),()=>{window.removeEventListener("storage",_),window.removeEventListener("rawMaterialsUpdated",E),window.removeEventListener("focus",R)}},[]),N.useEffect(()=>{if(w.trim()){const _=s.filter(E=>E.name?.toLowerCase().includes(w.toLowerCase())||E.category?.toLowerCase().includes(w.toLowerCase())||E.description?.toLowerCase().includes(w.toLowerCase())||E.supplier?.toLowerCase().includes(w.toLowerCase()));O(_)}else O(s)},[w,s]);const F=async()=>{try{m(!0);const E=(await wr.getAllRawMaterials()).filter(R=>R.active!==!1);a(E),b(null)}catch(_){b(_.message)}finally{m(!1)}},ce=_=>{if(l.some(R=>R.internalId===_.internalId))c(R=>R.filter(V=>V.internalId!==_.internalId));else{const R={..._,type:"rawMaterials",quantity:1};c(V=>[...V,R])}},Be=()=>{if(l.length===0){$("يرجى اختيار مادة خام واحدة على الأقل","لا توجد مواد مختارة");return}const _=l.map(E=>{let R=E.price||0,V=E.supplier;if(E.priceQuotes&&Array.isArray(E.priceQuotes)&&E.priceQuotes.length>0){const ne=E.priceQuotes.reduce((B,q)=>{const me=parseFloat(B.price)||0;return(parseFloat(q.price)||0)<me?q:B});R=parseFloat(ne.price)||0,V=ne.supplierName}return{...E,quantity:1,unitPrice:R,totalPrice:R,displaySupplier:V}});ee(_),z(!0)},U=(_,E)=>{const R=Math.max(.1,parseFloat(E)||.1),V=parseFloat(R.toFixed(1));ee(ne=>ne.map(B=>B.id===_?{...B,quantity:V,totalPrice:B.unitPrice*V}:B))},se=async()=>{try{if(!Array.isArray(I)||I.length===0){$("لا توجد مواد مختارة للإضافة","خطأ في البيانات");return}console.log("🛡️ SENIOR REACT: Using advanced duplicate prevention hook...");const _=await X(I,{showError:$,errorTitle:"بنود مكررة",stopOnDuplicates:!0});if(console.log("🛡️ SENIOR REACT: Duplicate check result:",_),!_.success){console.log("🚨 SENIOR REACT: Execution stopped due to duplicates");return}const E=_.uniqueItems;console.log("✅ SENIOR REACT: Proceeding with unique items:",E.length),console.log("No duplicates found, proceeding with item creation...");const R=[];for(const B of E)try{console.log("🔧 SENIOR REACT: Creating tender item directly for:",B.name);const q={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:B.internalId,materialType:"rawMaterial",materialName:B.name,materialCategory:B.category||"",materialUnit:B.unit||"قطعة",quantity:B.quantity||1,unitPrice:B.unitPrice||0,totalPrice:(B.quantity||1)*(B.unitPrice||0),supplierInfo:B.displaySupplier||"",tenderId:oe==="new"?"new":oe,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};R.push(q),console.log("✅ SENIOR REACT: Created tender item directly:",{id:q.internalId,materialId:q.materialInternalId,name:q.materialName,quantity:q.quantity,unitPrice:q.unitPrice,totalPrice:q.totalPrice})}catch(q){console.error("Error creating manufactured product item for material:",B.name,q),$(`فشل في إضافة المادة: ${B.name}`,"خطأ في البيانات");return}const V=await rt.getPendingProductItems()||[],ne=[...V,...R];console.log("📦 SENIOR REACT: Merging manufactured product items:",{existingCount:V.length,newCount:R.length,totalCount:ne.length,items:R.map(B=>({id:B.internalId,materialId:B.materialInternalId,name:B.materialName,price:B.unitPrice,total:B.totalPrice}))}),await rt.setPendingProductItems(ne),console.log("🚀 SENIOR REACT: Dispatching product items added event"),window.dispatchEvent(new CustomEvent("productItemsAdded",{detail:{source:"ManufacturedRawMaterials",itemsCount:R.length,items:R.map(B=>({id:B.internalId,name:B.materialName,type:B.materialType}))}}));try{const B=be();B&&B.name&&Y("task",`${B.name} أضاف مواد خام للمنتج المصنع`,`تم إضافة ${R.length} مادة خام`)}catch(B){console.error("Failed to log activity:",B)}k(`تم إضافة ${R.length} مادة خام للمنتج المصنع بنجاح`,"تمت الإضافة"),z(!1),ee([]),setTimeout(()=>{J(oe==="new"?"/manufactured-products/add":`/manufactured-products/edit/${oe}`)},100)}catch(_){console.error("Error in handleConfirmQuantities:",_),$("فشل في إضافة المواد الخام للمنتج المصنع - تحقق من البيانات","خطأ في النظام")}},fe=()=>{z(!1),ee([])},ie=()=>Math.round(I.reduce((_,E)=>_+E.totalPrice,0));return u?n.jsx(Dn,{show:!0,message:"جار تحميل بيانات المواد الخام...",overlay:!1}):p?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:p}),n.jsxs("button",{className:"btn btn-primary",onClick:F,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Kn,{onToggle:te}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المنتجات المصنعة"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"مواد خام"})]})}),n.jsx(Yn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"raw-materials-table",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-layers text-danger me-2"}),"قائمة المواد الخام (",D.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المواد الخام...",value:w,onChange:_=>j(_.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),n.jsxs("button",{className:"btn btn-danger shadow-sm px-4",onClick:Be,disabled:l.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["إضافة المحدد (",l.length,")"]}),n.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const _=oe!=="new"?`/manufactured-products/edit/${oe}`:"/manufactured-products/add";J(_)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:"العودة للمنتج المصنع"})]})})]})}),n.jsx("div",{className:"card-body p-0",children:D.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-layers fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد مواد خام"}),n.jsx("p",{className:"text-muted",children:w?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي مواد خام بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",children:"اختيار"}),n.jsx("th",{className:"text-center",children:"اسم المادة"}),n.jsx("th",{className:"text-center",children:"الفئة"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر"}),n.jsx("th",{className:"text-center",children:"المورد"})]})}),n.jsx("tbody",{children:D.map(_=>{let E=_.price,R=_.supplier,V=!1,ne=null;return _.priceQuotes&&Array.isArray(_.priceQuotes)&&_.priceQuotes.length>0&&(V=!0,ne=_.priceQuotes.reduce((B,q)=>{const me=parseFloat(B.price)||0;return(parseFloat(q.price)||0)<me?q:B}),E=ne.price,R=ne.supplierName),n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input",type:"checkbox",checked:l.some(B=>B.internalId===_.internalId),onChange:()=>ce(_),style:{transform:"scale(1.2)"}})})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-primary",children:_.name})}),n.jsx("td",{className:"text-center",children:_.category||"-"}),n.jsx("td",{className:"text-center",children:_.unit||"-"}),n.jsx("td",{className:"text-center",children:E?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsxs("span",{children:[E," ريال"]}),V&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}):"-"}),n.jsx("td",{className:"text-center",children:R?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("span",{children:R}),V&&n.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:"أقل مورد"})]}):"-"})]},_.id)})})]})})})]})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&t&&n.jsx(Xn,{rtl:!0}),!r&&t&&n.jsx(Jn,{})]}),Q&&n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-calculator me-2"}),"تحديد الكميات والأسعار"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:fe,"aria-label":"Close"})]}),n.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"30%"},children:"المادة الخام"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"السعر الأساسي"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"المورد"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"إجمالي السعر"})]})}),n.jsx("tbody",{children:I.map((_,E)=>n.jsxs("tr",{style:{height:"60px"},children:[n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:"bi bi-layers text-danger me-2"}),n.jsxs("div",{children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:R=>{R.preventDefault(),R.stopPropagation(),J(`/raw-materials/edit/${_.id}`)},title:`تحرير المادة الخام: ${_.name}`,children:_.name}),n.jsx("small",{className:"text-muted",children:_.category})]})]})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("span",{className:"fw-bold text-success",children:[Math.round(_.unitPrice)," ريال"]}),n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:["/",_.unit||"وحدة"]})})]}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>U(_.id,_.quantity-.1),disabled:_.quantity<=.1,style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-dash"})}),n.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:_.quantity.toFixed(1),min:"0.1",step:"0.1",onChange:R=>U(_.id,R.target.value)}),n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>U(_.id,_.quantity+.1),style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-plus"})})]})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"text-muted",children:_.displaySupplier||"-"})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(_.totalPrice)," ريال"]}),n.jsxs("small",{className:"text-success",children:["(",_.quantity.toFixed(1)," × ",Math.round(_.unitPrice),")"]})]})]},_.id))})]})})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:n.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("span",{className:"text-muted me-3",children:"إجمالي الطلبية:"}),n.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[ie()," ريال"]}),n.jsxs("span",{className:"badge bg-info ms-2",children:[I.reduce((_,E)=>_+E.quantity,0).toFixed(1)," قطعة"]})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:fe,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:se,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"تأكيد"})]})]})})]})})}),n.jsx(Rn,{show:M.show,onClose:H,title:M.title,message:M.message,type:M.type,onConfirm:M.onConfirm,showConfirm:M.showConfirm})]})}function eF(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(Z4,{})})})}function tF(){const[r,e]=N.useState(!1),{isTimelineVisible:t}=$n(),[s,a]=N.useState([]),[l,c]=N.useState([]),[u,m]=N.useState(!1),[p,b]=N.useState(null),[w,j]=N.useState(""),[D,O]=N.useState([]),[Q,z]=N.useState(!1),[I,ee]=N.useState([]),J=ms(),{productId:oe}=ea(),{logActivity:Y,getCurrentUser:be}=vn(),{alertConfig:M,closeAlert:H,showSuccess:k,showError:$}=Pn(),X=async(_,E={})=>{try{console.log("🔍 DUPLICATE CHECK: Checking",_.length,"items against existing product items");const R=await rt.getPendingProductItems()||[];if(console.log("🔍 DUPLICATE CHECK: Found",R.length,"existing items"),R.length===0)return console.log("✅ DUPLICATE CHECK: No existing items, all items are unique"),{success:!0,uniqueItems:_||[]};const V=[],ne=[];for(const B of _){const q=B.materialInternalId||B.internalId||B.id,me=(B.materialName||B.name||"").trim().toLowerCase();R.some(Z=>{const je=Z.materialInternalId||Z.internalId||Z.id,Ge=(Z.materialName||Z.name||"").trim().toLowerCase();return q&&je&&q===je||me&&Ge&&me===Ge})?(V.push(B),console.log("🚨 DUPLICATE FOUND:",B.materialName||B.name)):(ne.push(B),console.log("✅ UNIQUE ITEM:",B.materialName||B.name))}if(V.length>0&&E.showError){const B=V.map(q=>q.materialName||q.name).join("، ");if(E.showError(`تم العثور على ${V.length} بند مكرر: ${B}. لن يتم إضافة البنود المكررة.`,E.errorTitle||"بنود مكررة"),E.stopOnDuplicates&&ne.length===0)return{success:!1,uniqueItems:[]}}return console.log("🔍 DUPLICATE CHECK RESULT:",{totalItems:_.length,duplicates:V.length,uniqueItems:ne.length}),{success:!0,uniqueItems:ne}}catch(R){return console.error("❌ Error in duplicate prevention:",R),{success:!0,uniqueItems:_||[]}}},te=()=>{e(!r)};N.useEffect(()=>{F();const _=V=>{V.type==="localProductsUpdated"&&F()},E=()=>{F()};window.addEventListener("storage",_),window.addEventListener("localProductsUpdated",E);const R=()=>{F()};return window.addEventListener("focus",R),()=>{window.removeEventListener("storage",_),window.removeEventListener("localProductsUpdated",E),window.removeEventListener("focus",R)}},[]),N.useEffect(()=>{if(w.trim()){const _=s.filter(E=>E.name?.toLowerCase().includes(w.toLowerCase())||E.category?.toLowerCase().includes(w.toLowerCase())||E.description?.toLowerCase().includes(w.toLowerCase())||E.manufacturer?.toLowerCase().includes(w.toLowerCase()));O(_)}else O(s)},[w,s]);const F=async()=>{try{m(!0);const E=(await vr.getAllLocalProducts()).filter(R=>R.active!==!1);a(E),b(null)}catch(_){b(_.message)}finally{m(!1)}},ce=_=>{if(l.some(R=>R.internalId===_.internalId))c(R=>R.filter(V=>V.internalId!==_.internalId));else{const R={..._,type:"localProducts",quantity:1};c(V=>[...V,R])}},Be=()=>{if(l.length===0){$("يرجى اختيار منتج محلي واحد على الأقل","لا توجد منتجات مختارة");return}const _=l.map(E=>{let R=E.price||0,V=E.manufacturer;if(E.priceQuotes&&Array.isArray(E.priceQuotes)&&E.priceQuotes.length>0){const ne=E.priceQuotes.reduce((B,q)=>{const me=parseFloat(B.price)||0;return(parseFloat(q.price)||0)<me?q:B});R=parseFloat(ne.price)||0,V=ne.supplierName}return{...E,quantity:1,unitPrice:R,totalPrice:R,displaySupplier:V}});ee(_),z(!0)},U=(_,E)=>{const R=Math.max(.1,parseFloat(E)||.1),V=parseFloat(R.toFixed(1));ee(ne=>ne.map(B=>B.id===_?{...B,quantity:V,totalPrice:B.unitPrice*V}:B))},se=async()=>{try{if(!Array.isArray(I)||I.length===0){$("لا توجد منتجات مختارة للإضافة","خطأ في البيانات");return}console.log("🛡️ SENIOR REACT: Using advanced duplicate prevention hook...");const _=await X(I,{showError:$,errorTitle:"بنود مكررة",stopOnDuplicates:!0});if(console.log("🛡️ SENIOR REACT: Duplicate check result:",_),!_.success){console.log("🚨 SENIOR REACT: Execution stopped due to duplicates");return}const E=_.uniqueItems;console.log("✅ SENIOR REACT: Proceeding with unique items:",E.length),console.log("No duplicates found, proceeding with item creation...");const R=[];for(const B of E)try{console.log("🔧 SENIOR REACT: Creating tender item directly for:",B.name);const q={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:B.internalId,materialType:"localProduct",materialName:B.name,materialCategory:B.category||"",materialUnit:B.unit||"قطعة",quantity:B.quantity||1,unitPrice:B.unitPrice||0,totalPrice:(B.quantity||1)*(B.unitPrice||0),supplierInfo:B.displaySupplier||"",tenderId:oe==="new"?"new":oe,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};R.push(q),console.log("✅ SENIOR REACT: Created tender item directly:",{id:q.internalId,materialId:q.materialInternalId,name:q.materialName,quantity:q.quantity,unitPrice:q.unitPrice,totalPrice:q.totalPrice})}catch(q){console.error("Error creating manufactured product item for product:",B.name,q),$(`فشل في إضافة المنتج: ${B.name}`,"خطأ في البيانات");return}const V=await rt.getPendingProductItems()||[],ne=[...V,...R];console.log("📦 SENIOR REACT: Merging manufactured product items:",{existingCount:V.length,newCount:R.length,totalCount:ne.length,items:R.map(B=>({id:B.internalId,materialId:B.materialInternalId,name:B.materialName,price:B.unitPrice,total:B.totalPrice}))}),await rt.setPendingProductItems(ne),console.log("🚀 SENIOR REACT: Dispatching product items added event"),window.dispatchEvent(new CustomEvent("productItemsAdded",{detail:{source:"ManufacturedLocalProducts",itemsCount:R.length,items:R.map(B=>({id:B.internalId,name:B.materialName,type:B.materialType}))}}));try{const B=be();B&&B.name&&Y("task",`${B.name} أضاف منتجات محلية للمنتج المصنع`,`تم إضافة ${R.length} منتج محلي`)}catch(B){console.error("Failed to log activity:",B)}k(`تم إضافة ${R.length} منتج محلي للمنتج المصنع بنجاح`,"تمت الإضافة"),z(!1),ee([]),setTimeout(()=>{J(oe==="new"?"/manufactured-products/add":`/manufactured-products/edit/${oe}`)},100)}catch(_){console.error("Error in handleConfirmQuantities:",_),$("فشل في إضافة المنتجات المحلية للمنتج المصنع - تحقق من البيانات","خطأ في النظام")}},fe=()=>{z(!1),ee([])},ie=()=>Math.round(I.reduce((_,E)=>_+E.totalPrice,0));return u?n.jsx(Dn,{show:!0,message:"جار تحميل بيانات المنتجات المحلية...",overlay:!1}):p?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:p}),n.jsxs("button",{className:"btn btn-primary",onClick:F,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Kn,{onToggle:te}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المنتجات المصنعة"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"منتجات محلية"})]})}),n.jsx(Yn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"raw-materials-table",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-house text-success me-2"}),"قائمة المنتجات المحلية (",D.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المنتجات المحلية...",value:w,onChange:_=>j(_.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),n.jsxs("button",{className:"btn btn-success shadow-sm px-4",onClick:Be,disabled:l.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["إضافة المحدد (",l.length,")"]}),n.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const _=oe!=="new"?`/manufactured-products/edit/${oe}`:"/manufactured-products/add";J(_)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:"العودة للمنتج المصنع"})]})})]})}),n.jsx("div",{className:"card-body p-0",children:D.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-house fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد منتجات محلية"}),n.jsx("p",{className:"text-muted",children:w?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي منتجات محلية بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",children:"اختيار"}),n.jsx("th",{className:"text-center",children:"اسم المنتج"}),n.jsx("th",{className:"text-center",children:"الفئة"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر"}),n.jsx("th",{className:"text-center",children:"الشركة المصنعة"})]})}),n.jsx("tbody",{children:D.map(_=>{let E=_.price,R=_.manufacturer,V=!1,ne=null;return _.priceQuotes&&Array.isArray(_.priceQuotes)&&_.priceQuotes.length>0&&(V=!0,ne=_.priceQuotes.reduce((B,q)=>{const me=parseFloat(B.price)||0;return(parseFloat(q.price)||0)<me?q:B}),E=ne.price,R=ne.supplierName),n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input",type:"checkbox",checked:l.some(B=>B.internalId===_.internalId),onChange:()=>ce(_),style:{transform:"scale(1.2)"}})})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-primary",children:_.name})}),n.jsx("td",{className:"text-center",children:_.category||"-"}),n.jsx("td",{className:"text-center",children:_.unit||"-"}),n.jsx("td",{className:"text-center",children:E?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsxs("span",{children:[E," ريال"]}),V&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}):"-"}),n.jsx("td",{className:"text-center",children:R?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("span",{children:R}),V&&n.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:"أقل مورد"})]}):"-"})]},_.id)})})]})})})]})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&t&&n.jsx(Xn,{rtl:!0}),!r&&t&&n.jsx(Jn,{})]}),Q&&n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-calculator me-2"}),"تحديد الكميات والأسعار"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:fe,"aria-label":"Close"})]}),n.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"30%"},children:"المنتج المحلي"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"السعر الأساسي"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"الشركة المصنعة"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"إجمالي السعر"})]})}),n.jsx("tbody",{children:I.map((_,E)=>n.jsxs("tr",{style:{height:"60px"},children:[n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:"bi bi-house text-success me-2"}),n.jsxs("div",{children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:R=>{R.preventDefault(),R.stopPropagation(),J(`/local-products/edit/${_.id}`)},title:`تحرير المنتج المحلي: ${_.name}`,children:_.name}),n.jsx("small",{className:"text-muted",children:_.category})]})]})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("span",{className:"fw-bold text-success",children:[Math.round(_.unitPrice)," ريال"]}),n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:["/",_.unit||"وحدة"]})})]}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>U(_.id,_.quantity-.1),disabled:_.quantity<=.1,style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-dash"})}),n.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:_.quantity.toFixed(1),min:"0.1",step:"0.1",onChange:R=>U(_.id,R.target.value)}),n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>U(_.id,_.quantity+.1),style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-plus"})})]})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"text-muted",children:_.displaySupplier||"-"})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(_.totalPrice)," ريال"]}),n.jsxs("small",{className:"text-success",children:["(",_.quantity.toFixed(1)," × ",Math.round(_.unitPrice),")"]})]})]},_.id))})]})})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:n.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("span",{className:"text-muted me-3",children:"إجمالي الطلبية:"}),n.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[ie()," ريال"]}),n.jsxs("span",{className:"badge bg-info ms-2",children:[I.reduce((_,E)=>_+E.quantity,0).toFixed(1)," قطعة"]})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:fe,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:se,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"تأكيد"})]})]})})]})})}),n.jsx(Rn,{show:M.show,onClose:H,title:M.title,message:M.message,type:M.type,onConfirm:M.onConfirm,showConfirm:M.showConfirm})]})}function nF(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(tF,{})})})}function sF(){const[r,e]=N.useState(!1),{isTimelineVisible:t}=$n(),[s,a]=N.useState([]),[l,c]=N.useState([]),[u,m]=N.useState(!1),[p,b]=N.useState(null),[w,j]=N.useState(""),[D,O]=N.useState([]),[Q,z]=N.useState(!1),[I,ee]=N.useState([]),J=ms(),{productId:oe}=ea(),{logActivity:Y,getCurrentUser:be}=vn(),{alertConfig:M,closeAlert:H,showSuccess:k,showError:$}=Pn(),X=()=>{e(!r)};N.useEffect(()=>{te();const ie=R=>{R.type==="foreignProductsUpdated"&&te()},_=()=>{te()};window.addEventListener("storage",ie),window.addEventListener("foreignProductsUpdated",_);const E=()=>{te()};return window.addEventListener("focus",E),()=>{window.removeEventListener("storage",ie),window.removeEventListener("foreignProductsUpdated",_),window.removeEventListener("focus",E)}},[]),N.useEffect(()=>{if(w.trim()){const ie=s.filter(_=>_.name?.toLowerCase().includes(w.toLowerCase())||_.category?.toLowerCase().includes(w.toLowerCase())||_.description?.toLowerCase().includes(w.toLowerCase())||_.supplier?.toLowerCase().includes(w.toLowerCase())||_.countryOfOrigin?.toLowerCase().includes(w.toLowerCase()));O(ie)}else O(s)},[w,s]);const te=async()=>{try{m(!0);const _=(await Nr.getAllForeignProducts()).filter(E=>E.active!==!1);a(_),b(null)}catch(ie){b(ie.message)}finally{m(!1)}},F=ie=>{if(l.some(E=>E.internalId===ie.internalId))c(E=>E.filter(R=>R.internalId!==ie.internalId));else{const E={...ie,type:"foreignProduct",quantity:1};c(R=>[...R,E])}},ce=async()=>{if(l.length===0){$("يرجى اختيار منتج أجنبي واحد على الأقل","لا توجد منتجات مختارة");return}const ie=await rt.getPendingProductItems()||[];let _=[];ie&&Array.isArray(ie)&&(_=ie.map(ne=>ne.materialInternalId));const E=[],R=l.filter(ne=>{const B=_.includes(ne.internalId);return B&&E.push(ne.name),!B});if(E.length>0){const ne=E.join("، ");if($(`البنود التالية موجودة مسبقاً في القائمة: ${ne}`,"بنود مكررة"),R.length===0)return;console.log(`Found ${E.length} duplicate items, proceeding with ${R.length} unique items`)}const V=R.map(ne=>{let B=ne.price||0,q=ne.supplier;if(ne.priceQuotes&&Array.isArray(ne.priceQuotes)&&ne.priceQuotes.length>0){const me=ne.priceQuotes.reduce((C,Z)=>{const je=parseFloat(C.price)||0;return(parseFloat(Z.price)||0)<je?Z:C});B=parseFloat(me.price)||0,q=me.supplierName}return{...ne,quantity:1,unitPrice:B,totalPrice:B,displaySupplier:q}});ee(V),z(!0)},Be=(ie,_)=>{const E=Math.max(.1,parseFloat(_)||.1),R=parseFloat(E.toFixed(1));ee(V=>V.map(ne=>ne.id===ie?{...ne,quantity:R,totalPrice:ne.unitPrice*R}:ne))},U=async()=>{try{if(!Array.isArray(I)||I.length===0){$("لا توجد منتجات مختارة للإضافة","خطأ في البيانات");return}const ie=[];for(const R of I)try{console.log("🔧 SENIOR REACT: Creating tender item directly for:",R.name);const V={internalId:`ti_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,materialInternalId:R.internalId,materialType:"foreignProduct",materialName:R.name,materialCategory:R.category||"",materialUnit:R.unit||"قطعة",quantity:R.quantity||1,unitPrice:R.unitPrice||0,totalPrice:(R.quantity||1)*(R.unitPrice||0),supplierInfo:R.displaySupplier||"",tenderId:oe==="new"?"new":oe,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};ie.push(V),console.log("✅ SENIOR REACT: Created tender item directly:",{id:V.internalId,materialId:V.materialInternalId,name:V.materialName,quantity:V.quantity,unitPrice:V.unitPrice,totalPrice:V.totalPrice})}catch(V){console.error("Error creating manufactured product item for product:",R.name,V),$(`فشل في إضافة المنتج: ${R.name}`,"خطأ في البيانات");return}const _=await rt.getPendingProductItems()||[],E=[..._,...ie];console.log("📦 SENIOR REACT: Merging manufactured product items:",{existingCount:_.length,newCount:ie.length,totalCount:E.length,items:ie.map(R=>({id:R.internalId,materialId:R.materialInternalId,name:R.materialName,price:R.unitPrice,total:R.totalPrice}))}),await rt.setPendingProductItems(E),console.log("🚀 SENIOR REACT: Dispatching product items added event"),window.dispatchEvent(new CustomEvent("productItemsAdded",{detail:{source:"ManufacturedForeignProducts",itemsCount:ie.length,items:ie.map(R=>({id:R.internalId,name:R.materialName,type:R.materialType}))}}));try{const R=be();R&&R.name&&Y("task",`${R.name} أضاف منتجات أجنبية للمنتج المصنع`,`تم إضافة ${ie.length} منتج أجنبي`)}catch(R){console.error("Failed to log activity:",R)}k(`تم إضافة ${ie.length} منتج مستورد للمنتج المصنع بنجاح`,"تمت الإضافة"),z(!1),ee([]),setTimeout(()=>{J(oe==="new"?"/manufactured-products/add":`/manufactured-products/edit/${oe}`)},100)}catch(ie){console.error("Error in handleConfirmQuantities:",ie),$("فشل في إضافة المنتجات الأجنبية للمنتج المصنع - تحقق من البيانات","خطأ في النظام")}},se=()=>{z(!1),ee([])},fe=()=>Math.round(I.reduce((ie,_)=>ie+_.totalPrice,0));return u?n.jsx(Dn,{show:!0,message:"جار تحميل بيانات المنتجات الأجنبية...",overlay:!1}):p?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:p}),n.jsxs("button",{className:"btn btn-primary",onClick:te,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,children:[n.jsx(Kn,{onToggle:X}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"بنود المنتجات المصنعة"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"منتجات أجنبية"})]})}),n.jsx(Yn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"raw-materials-table",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-globe text-info me-2"}),"قائمة المنتجات الأجنبية (",D.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group raw-materials-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المنتجات الأجنبية...",value:w,onChange:ie=>j(ie.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted",style:{transform:"scaleX(-1)"}})})]}),n.jsxs("button",{className:"btn btn-info shadow-sm px-4",onClick:ce,disabled:l.length===0,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:["إضافة المحدد (",l.length,")"]}),n.jsx("button",{className:"btn btn-secondary shadow-sm px-4",onClick:()=>{const ie=oe!=="new"?`/manufactured-products/edit/${oe}`:"/manufactured-products/add";J(ie)},style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:"العودة للمنتج المصنع"})]})})]})}),n.jsx("div",{className:"card-body p-0",children:D.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-globe fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد منتجات أجنبية"}),n.jsx("p",{className:"text-muted",children:w?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي منتجات أجنبية بعد"})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",children:"اختيار"}),n.jsx("th",{className:"text-center",children:"اسم المنتج"}),n.jsx("th",{className:"text-center",children:"الفئة"}),n.jsx("th",{className:"text-center",children:"الوحدة"}),n.jsx("th",{className:"text-center",children:"السعر"}),n.jsx("th",{className:"text-center",children:"المورد"}),n.jsx("th",{className:"text-center",children:"بلد المنشأ"})]})}),n.jsx("tbody",{children:D.map(ie=>{let _=ie.price,E=ie.supplier,R=!1,V=null;return ie.priceQuotes&&Array.isArray(ie.priceQuotes)&&ie.priceQuotes.length>0&&(R=!0,V=ie.priceQuotes.reduce((ne,B)=>{const q=parseFloat(ne.price)||0;return(parseFloat(B.price)||0)<q?B:ne}),_=V.price,E=V.supplierName),n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"form-check d-flex justify-content-center",children:n.jsx("input",{className:"form-check-input",type:"checkbox",checked:l.some(ne=>ne.internalId===ie.internalId),onChange:()=>F(ie),style:{transform:"scale(1.2)"}})})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-primary",children:ie.name})}),n.jsx("td",{className:"text-center",children:ie.category||"-"}),n.jsx("td",{className:"text-center",children:ie.unit||"-"}),n.jsx("td",{className:"text-center",children:_?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsxs("span",{children:[_," ريال"]}),R&&n.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"10px"},children:"أقل سعر"})]}):"-"}),n.jsx("td",{className:"text-center",children:E?n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("span",{children:E}),R&&n.jsx("span",{className:"badge bg-success ms-2",style:{fontSize:"10px"},children:"أقل مورد"})]}):"-"}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"badge bg-warning text-dark",children:ie.countryOfOrigin||"غير محدد"})})]},ie.id)})})]})})})]})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&t&&n.jsx(Xn,{rtl:!0}),!r&&t&&n.jsx(Jn,{})]}),Q&&n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header bg-primary text-white",style:{borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-calculator me-2"}),"تحديد الكميات والأسعار"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:se,"aria-label":"Close"})]}),n.jsx("div",{className:"modal-body p-0",style:{maxHeight:"50vh",overflowY:"auto"},children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"30%"},children:"المنتج الأجنبي"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"السعر الأساسي"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"الكمية"}),n.jsx("th",{className:"text-center",style:{width:"15%"},children:"المورد"}),n.jsx("th",{className:"text-center",style:{width:"20%"},children:"إجمالي السعر"})]})}),n.jsx("tbody",{children:I.map((ie,_)=>n.jsxs("tr",{style:{height:"60px"},children:[n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("i",{className:"bi bi-globe text-info me-2"}),n.jsxs("div",{children:[n.jsx("button",{className:"btn btn-link p-0 fw-bold text-primary",style:{textDecoration:"none",border:"none",background:"none",cursor:"pointer"},onClick:E=>{E.preventDefault(),E.stopPropagation(),J(`/foreign-products/edit/${ie.id}`)},title:`تحرير المنتج المستورد: ${ie.name}`,children:ie.name}),n.jsx("small",{className:"text-muted",children:ie.category}),n.jsx("div",{children:n.jsx("span",{className:"badge bg-warning text-dark",style:{fontSize:"10px"},children:ie.countryOfOrigin||"غير محدد"})})]})]})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("span",{className:"fw-bold text-success",children:[Math.round(ie.unitPrice)," ريال"]}),n.jsx("div",{children:n.jsxs("small",{className:"text-muted",children:["/",ie.unit||"وحدة"]})})]}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>Be(ie.id,ie.quantity-.1),disabled:ie.quantity<=.1,style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-dash"})}),n.jsx("input",{type:"number",className:"form-control text-center mx-2",style:{width:"80px",height:"32px",borderRadius:"6px"},value:ie.quantity.toFixed(1),min:"0.1",step:"0.1",onChange:E=>Be(ie.id,E.target.value)}),n.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>Be(ie.id,ie.quantity+.1),style:{width:"32px",height:"32px",borderRadius:"6px"},children:n.jsx("i",{className:"bi bi-plus"})})]})}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"text-muted",children:ie.displaySupplier||"-"})}),n.jsxs("td",{className:"text-center",children:[n.jsxs("div",{className:"fw-bold text-primary fs-6",children:[Math.round(ie.totalPrice)," ريال"]}),n.jsxs("small",{className:"text-success",children:["(",ie.quantity.toFixed(1)," × ",Math.round(ie.unitPrice),")"]})]})]},ie.id))})]})})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px"},children:n.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("span",{className:"text-muted me-3",children:"إجمالي الطلبية:"}),n.jsxs("span",{className:"fs-4 fw-bold text-primary",children:[fe()," ريال"]}),n.jsxs("span",{className:"badge bg-info ms-2",children:[I.reduce((ie,_)=>ie+_.quantity,0).toFixed(1)," قطعة"]})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:se,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:U,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"تأكيد"})]})]})})]})})}),n.jsx(Rn,{show:M.show,onClose:H,title:M.title,message:M.message,type:M.type,onConfirm:M.onConfirm,showConfirm:M.showConfirm})]})}function rF(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(sF,{})})})}const iF=({onEdit:r,onAdd:e,refreshTrigger:t})=>{const[s,a]=N.useState([]),[l,c]=N.useState(!0),[u,m]=N.useState(null),[p,b]=N.useState(""),[w,j]=N.useState([]),[D,O]=N.useState(!1),{logActivity:Q,getCurrentUser:z}=vn(),{alertConfig:I,closeAlert:ee,showSuccess:J,showError:oe,showConfirm:Y}=Pn(),{currentPage:be,totalPages:M,paginatedItems:H,handlePageChange:k,resetPage:$,totalItems:X,itemsPerPage:te}=wa(w,30);N.useEffect(()=>{F()},[]),N.useEffect(()=>{t&&F()},[t]),N.useEffect(()=>{if(p.trim()){const U=s.filter(se=>se.name?.toLowerCase().includes(p.toLowerCase())||se.email?.toLowerCase().includes(p.toLowerCase())||se.phone?.includes(p));j(U)}else j(s);$()},[p,s,$]);const F=async()=>{try{c(!0);const U=await Ji.getAllSuppliers();a(U),m(null)}catch(U){m(U.message)}finally{c(!1)}},ce=U=>{Y(`هل أنت متأكد من حذف هذا المورد؟

${U.name}`,()=>Be(U),"تأكيد حذف المورد")},Be=async U=>{try{O(!0),await Gn.moveToTrash(U,"suppliers"),await Ji.deleteSupplier(U.id);const se=z();Q("task",`${se.name} حذف مورد محلي`,`تم حذف المورد: ${U.name}`),await F(),J(`تم نقل المورد للمهملات: ${U.name}`,"تم النقل للمهملات")}catch(se){m(se.message),oe(`فشل في نقل المورد للمهملات: ${se.message}`,"خطأ في النقل")}finally{O(!1)}};return l?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"spinner-border text-primary",role:"status",children:n.jsx("span",{className:"visually-hidden",children:"جار التحميل..."})}),n.jsx("p",{className:"mt-3 text-muted",children:"جار تحميل بيانات الموردين..."})]})}):u?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:u}),n.jsxs("button",{className:"btn btn-primary",onClick:F,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs("div",{className:"card shadow-sm","data-list":"suppliers",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-people-fill text-primary me-2"}),"قائمة الموردين (",w.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group suppliers-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في الموردين...",value:p,onChange:U=>b(U.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted"})})]}),n.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:e,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"إضافة مورد جديد"]})]})})]})}),n.jsxs("div",{className:"card-body p-0",children:[w.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-people fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد موردين"}),n.jsx("p",{className:"text-muted",children:p?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي موردين بعد"}),!p&&n.jsxs("button",{className:"btn btn-primary",onClick:e,children:[n.jsx("i",{className:"bi bi-plus-lg me-1"}),"إضافة أول مورد"]})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{style:{width:"60px"},children:"#"}),n.jsx("th",{children:"اسم المورد"}),n.jsx("th",{children:"البريد الإلكتروني"}),n.jsx("th",{children:"الهاتف"}),n.jsx("th",{children:"المدينة"}),n.jsx("th",{style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:H.map((U,se)=>n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(be-1)*te+se+1})}),n.jsx("td",{children:n.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",onClick:()=>r(U),style:{textDecoration:"none"},title:`Internal ID: ${U.internalId||"Not Set"}`,children:U.name})}),n.jsx("td",{children:n.jsx("a",{href:`mailto:${U.email}`,className:"text-decoration-none",children:U.email})}),n.jsx("td",{style:{direction:"ltr",textAlign:"left"},children:U.phone}),n.jsx("td",{children:U.city||"-"}),n.jsx("td",{children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{className:"btn btn-outline-primary",onClick:()=>r(U),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{className:"btn btn-outline-danger",onClick:()=>ce(U),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},U.internalId||U.id))})]})}),w.length>0&&n.jsx(va,{currentPage:be,totalPages:M,onPageChange:k,totalItems:X,itemsPerPage:te})]}),n.jsx(Rn,{show:I.show,onClose:ee,title:I.title,message:I.message,type:I.type,onConfirm:I.onConfirm,confirmText:I.confirmText,cancelText:I.cancelText,showCancel:I.showCancel})]})},aF=({supplier:r,onSave:e,onCancel:t})=>{const[s,a]=N.useState({name:"",email:"",phone:"",address:"",city:"",taxNumber:"",bankAccount:"",notes:"",active:!0}),[l,c]=N.useState({}),[u,m]=N.useState(!1),p=!!r,{logActivity:b,getCurrentUser:w}=vn();N.useEffect(()=>{r&&a({name:r.name||"",email:r.email||"",phone:r.phone||"",address:r.address||"",city:r.city||"",taxNumber:r.taxNumber||"",bankAccount:r.bankAccount||"",notes:r.notes||"",active:r.active!==void 0?r.active:!0})},[r]);const j=O=>{const{name:Q,value:z,type:I,checked:ee}=O.target;a(J=>({...J,[Q]:I==="checkbox"?ee:z})),l[Q]&&c(J=>({...J,[Q]:""}))},D=async O=>{O.preventDefault();const Q=Ji.validateSupplierData(s);if(Object.keys(Q).length>0){c(Q);return}m(!0),c({});try{const z=await oo.validateUniqueFields(s,p?r.id:null,p?"suppliers":null);if(Object.keys(z).length>0){c(z),m(!1);return}const I={...s,status:p&&r.status||"active"};if(p){await Ji.updateSupplier(r.id,I);const ee=w();b("task",`${ee.name} عدل مورد محلي`,`تم تعديل المورد: ${I.name}`)}else{await Ji.createSupplier(I);const ee=w();b("task",`${ee.name} أضاف مورد محلي`,`تم إضافة المورد: ${I.name}`)}e()}catch(z){c({submit:z.message})}finally{m(!1)}};return n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",children:[n.jsxs("div",{className:"modal-header",children:[n.jsxs("h5",{className:"modal-title",children:[n.jsx("i",{className:"bi bi-person-plus-fill text-primary me-2"}),p?"تعديل المورد":"إضافة مورد جديد"]}),n.jsx("button",{type:"button",className:"btn-close",onClick:t})]}),n.jsxs("form",{onSubmit:D,children:[n.jsxs("div",{className:"modal-body",children:[l.submit&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.submit]}),n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"اسم المورد *"}),n.jsx("input",{type:"text",className:`form-control ${l.name?"is-invalid":""}`,name:"name",value:s.name,onChange:j,placeholder:"أدخل اسم المورد"}),l.name&&n.jsx("div",{className:"invalid-feedback",children:l.name})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"البريد الإلكتروني *"}),n.jsx("input",{type:"email",className:`form-control ${l.email?"is-invalid":""}`,name:"email",value:s.email,onChange:j,placeholder:"example@company.com"}),l.email&&n.jsx("div",{className:"invalid-feedback",children:l.email})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الهاتف *"}),n.jsx("input",{type:"tel",className:`form-control ${l.phone?"is-invalid":""}`,name:"phone",value:s.phone,onKeyPress:O=>{/[0-9+]/.test(O.key)||O.preventDefault()},onChange:O=>{const Q=O.target.value.replace(/[^0-9+]/g,"");j({target:{name:"phone",value:Q}})},placeholder:"+966 50 123 4567"}),l.phone&&n.jsx("div",{className:"invalid-feedback",children:l.phone})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"المدينة"}),n.jsx("input",{type:"text",className:"form-control",name:"city",value:s.city,onChange:j,placeholder:"المدينة"})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"العنوان"}),n.jsx("textarea",{className:"form-control",name:"address",value:s.address,onChange:j,rows:"2",placeholder:"أدخل عنوان الشركة"})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"الرقم الضريبي"}),n.jsx("input",{type:"text",className:"form-control",name:"taxNumber",value:s.taxNumber,onChange:j,placeholder:"الرقم الضريبي"})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الحساب المصرفي"}),n.jsx("input",{type:"text",className:"form-control",name:"bankAccount",value:s.bankAccount,onChange:j,placeholder:"رقم الحساب المصرفي"})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"ملاحظات"}),n.jsx("textarea",{className:"form-control",name:"notes",value:s.notes,onChange:j,rows:"3",placeholder:"أي ملاحظات إضافية..."})]}),n.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:n.jsxs("div",{className:"d-flex align-items-center gap-2",children:[n.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"نشط":"غير نشط"}),n.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"supplierActiveSwitch",name:"active",checked:s.active,onChange:j,style:{width:"50px",height:"25px",cursor:"pointer"}})]})})]})]}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsxs("div",{className:"d-flex gap-3",children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:t,disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"12px",height:"12px"}}),"حفظ..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),p?"تحديث":"حفظ"]})})]})})]})]})})})};function oF(){const[r,e]=N.useState(!1),[t,s]=N.useState(!1),[a,l]=N.useState(null),[c,u]=N.useState(0),{isTimelineVisible:m}=$n(),p=()=>{e(!r)},b=()=>{l(null),s(!0)},w=O=>{l(O),s(!0)},j=()=>{s(!1),l(null),u(O=>O+1)},D=()=>{s(!1),l(null)};return n.jsx(sn,{children:n.jsx(rn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Kn,{onToggle:p}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!m?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"الموردون"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"مورد محلي"})]})}),n.jsx(Yn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"suppliers-table",children:n.jsx(iF,{onAdd:b,onEdit:w,refreshTrigger:c})})})]}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]}),!r&&m&&n.jsx(Xn,{rtl:!0}),!r&&m&&n.jsx(Jn,{}),t&&n.jsx("div",{className:"supplier-form",children:n.jsx(aF,{supplier:a,onSave:j,onCancel:D})})]})})})}function lF(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(oF,{})})})}const cF=({onEdit:r,onAdd:e,refreshTrigger:t})=>{const[s,a]=N.useState([]),[l,c]=N.useState(!0),[u,m]=N.useState(null),[p,b]=N.useState(""),[w,j]=N.useState([]),[D,O]=N.useState(!1),{logActivity:Q,getCurrentUser:z}=vn(),{alertConfig:I,closeAlert:ee,showSuccess:J,showError:oe,showConfirm:Y}=Pn(),{currentPage:be,totalPages:M,paginatedItems:H,handlePageChange:k,resetPage:$,totalItems:X,itemsPerPage:te}=wa(w,30);N.useEffect(()=>{F()},[]),N.useEffect(()=>{t&&F()},[t]),N.useEffect(()=>{if(p.trim()){const U=s.filter(se=>se.name?.toLowerCase().includes(p.toLowerCase())||se.email?.toLowerCase().includes(p.toLowerCase())||se.phone?.includes(p));j(U)}else j(s);$()},[p,s,$]);const F=async()=>{try{c(!0);const U=await Zi.getAllSuppliers();a(U),m(null)}catch(U){m(U.message)}finally{c(!1)}},ce=U=>{Y(`هل أنت متأكد من حذف هذا المورد؟

${U.name}`,()=>Be(U),"تأكيد حذف المورد")},Be=async U=>{try{O(!0),await Gn.moveToTrash(U,"foreignSuppliers"),await Zi.deleteSupplier(U.id);const se=z();Q("task",`${se.name} حذف مورد أجنبي`,`تم حذف المورد: ${U.name}`),await F(),J(`تم نقل المورد الأجنبي للمهملات بنجاح: ${U.name}`,"تم النقل للمهملات")}catch(se){m(se.message),oe(`فشل في نقل المورد للمهملات: ${se.message}`,"خطأ في النقل")}finally{O(!1)}};return l?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"spinner-border text-primary",role:"status",children:n.jsx("span",{className:"visually-hidden",children:"جار التحميل..."})}),n.jsx("p",{className:"mt-3 text-muted",children:"جار تحميل بيانات الموردين..."})]})}):u?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:u}),n.jsxs("button",{className:"btn btn-primary",onClick:F,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs("div",{className:"card shadow-sm","data-list":"foreign-suppliers",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-people-fill text-primary me-2"}),"قائمة الموردين (",w.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group suppliers-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في الموردين...",value:p,onChange:U=>b(U.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted"})})]}),n.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:e,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"إضافة مورد جديد"]})]})})]})}),n.jsxs("div",{className:"card-body p-0",children:[w.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-people fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد موردين"}),n.jsx("p",{className:"text-muted",children:p?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي موردين بعد"}),!p&&n.jsxs("button",{className:"btn btn-primary",onClick:e,children:[n.jsx("i",{className:"bi bi-plus-lg me-1"}),"إضافة أول مورد"]})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{style:{width:"60px"},children:"#"}),n.jsx("th",{children:"اسم المورد"}),n.jsx("th",{children:"البريد الإلكتروني"}),n.jsx("th",{children:"الهاتف"}),n.jsx("th",{children:"المدينة"}),n.jsx("th",{style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:H.map((U,se)=>n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(be-1)*te+se+1})}),n.jsx("td",{children:n.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",onClick:()=>r(U),style:{textDecoration:"none"},title:`Internal ID: ${U.internalId||"Not Set"}`,children:U.name})}),n.jsx("td",{children:n.jsx("a",{href:`mailto:${U.email}`,className:"text-decoration-none",children:U.email})}),n.jsx("td",{style:{direction:"ltr",textAlign:"left"},children:U.phone}),n.jsx("td",{children:U.city||"-"}),n.jsx("td",{children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{className:"btn btn-outline-primary",onClick:()=>r(U),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{className:"btn btn-outline-danger",onClick:()=>ce(U),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},U.internalId||U.id))})]})}),w.length>0&&n.jsx(va,{currentPage:be,totalPages:M,onPageChange:k,totalItems:X,itemsPerPage:te})]}),n.jsx(Rn,{show:I.show,onClose:ee,title:I.title,message:I.message,type:I.type,onConfirm:I.onConfirm,confirmText:I.confirmText,cancelText:I.cancelText,showCancel:I.showCancel})]})},dF=({supplier:r,onSave:e,onCancel:t})=>{const[s,a]=N.useState({name:"",email:"",phone:"",address:"",city:"",website:"",bankAccount:"",notes:"",active:!0}),[l,c]=N.useState({}),[u,m]=N.useState(!1),p=!!r,{logActivity:b,getCurrentUser:w}=vn();N.useEffect(()=>{r&&a({name:r.name||"",email:r.email||"",phone:r.phone||"",address:r.address||"",city:r.city||"",website:r.website||"",bankAccount:r.bankAccount||"",notes:r.notes||"",active:r.active!==void 0?r.active:!0})},[r]);const j=O=>{const{name:Q,value:z,type:I,checked:ee}=O.target;a(J=>({...J,[Q]:I==="checkbox"?ee:z})),l[Q]&&c(J=>({...J,[Q]:""}))},D=async O=>{O.preventDefault();const Q=Zi.validateSupplierData(s);if(Object.keys(Q).length>0){c(Q);return}m(!0),c({});try{const z=await oo.validateUniqueFields(s,p?r.id:null,p?"foreignSuppliers":null);if(Object.keys(z).length>0){c(z),m(!1);return}const I={...s,status:p&&r.status||"active"};if(p){await Zi.updateSupplier(r.id,I);const ee=w();b("task",`${ee.name} عدل مورد أجنبي`,`تم تعديل المورد: ${I.name}`)}else{await Zi.createSupplier(I);const ee=w();b("task",`${ee.name} أضاف مورد أجنبي`,`تم إضافة المورد: ${I.name}`)}e()}catch(z){c({submit:z.message})}finally{m(!1)}};return n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",children:[n.jsxs("div",{className:"modal-header",children:[n.jsxs("h5",{className:"modal-title",children:[n.jsx("i",{className:"bi bi-person-plus-fill text-primary me-2"}),p?"تعديل المورد":"إضافة مورد جديد"]}),n.jsx("button",{type:"button",className:"btn-close",onClick:t})]}),n.jsxs("form",{onSubmit:D,children:[n.jsxs("div",{className:"modal-body",children:[l.submit&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.submit]}),n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"اسم المورد *"}),n.jsx("input",{type:"text",className:`form-control ${l.name?"is-invalid":""}`,name:"name",value:s.name,onChange:j,placeholder:"أدخل اسم المورد"}),l.name&&n.jsx("div",{className:"invalid-feedback",children:l.name})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"البريد الإلكتروني *"}),n.jsx("input",{type:"email",className:`form-control ${l.email?"is-invalid":""}`,name:"email",value:s.email,onChange:j,placeholder:"example@company.com"}),l.email&&n.jsx("div",{className:"invalid-feedback",children:l.email})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الهاتف *"}),n.jsx("input",{type:"tel",className:`form-control ${l.phone?"is-invalid":""}`,name:"phone",value:s.phone,onKeyPress:O=>{/[0-9+]/.test(O.key)||O.preventDefault()},onChange:O=>{const Q=O.target.value.replace(/[^0-9+]/g,"");j({target:{name:"phone",value:Q}})},placeholder:"+966 50 123 4567"}),l.phone&&n.jsx("div",{className:"invalid-feedback",children:l.phone})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"المدينة"}),n.jsx("input",{type:"text",className:"form-control",name:"city",value:s.city,onChange:j,placeholder:"المدينة"})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"العنوان"}),n.jsx("textarea",{className:"form-control",name:"address",value:s.address,onChange:j,rows:"2",placeholder:"أدخل عنوان الشركة"})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"الموقع الإلكتروني"}),n.jsx("input",{type:"url",className:"form-control",name:"website",value:s.website,onChange:j,placeholder:"https://www.company.com"})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الحساب المصرفي"}),n.jsx("input",{type:"text",className:"form-control",name:"bankAccount",value:s.bankAccount,onChange:j,placeholder:"رقم الحساب المصرفي"})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"ملاحظات"}),n.jsx("textarea",{className:"form-control",name:"notes",value:s.notes,onChange:j,rows:"3",placeholder:"أي ملاحظات إضافية..."})]}),n.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:n.jsxs("div",{className:"d-flex align-items-center gap-2",children:[n.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"نشط":"غير نشط"}),n.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"foreignSupplierActiveSwitch",name:"active",checked:s.active,onChange:j,style:{width:"50px",height:"25px",cursor:"pointer"}})]})})]})]}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsxs("div",{className:"d-flex gap-3",children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:t,disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"12px",height:"12px"}}),"حفظ..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),p?"تحديث":"حفظ"]})})]})})]})]})})})};function uF(){const[r,e]=N.useState(!1),[t,s]=N.useState(!1),[a,l]=N.useState(null),[c,u]=N.useState(0),{isTimelineVisible:m}=$n(),p=()=>{e(!r)},b=()=>{l(null),s(!0)},w=O=>{l(O),s(!0)},j=()=>{s(!1),l(null),u(O=>O+1)},D=()=>{s(!1),l(null)};return n.jsx(sn,{children:n.jsx(rn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Kn,{onToggle:p}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!m?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-primary",children:"الموردون"}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"مورد أجنبي"})]})}),n.jsx(Yn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"suppliers-table",children:n.jsx(cF,{onAdd:b,onEdit:w,refreshTrigger:c})})})]}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]}),!r&&m&&n.jsx(Xn,{rtl:!0}),!r&&m&&n.jsx(Jn,{}),t&&n.jsx("div",{className:"supplier-form",children:n.jsx(dF,{supplier:a,onSave:j,onCancel:D})})]})})})}function hF(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(uF,{})})})}const nd="customers";class Ou{static async getAllCustomers(){try{const e=ct(De,nd),t=Vt(e,hs("createdAt","desc"));return(await St(t)).docs.map(a=>{const l=a.data();return{id:a.id,internalId:l.internalId||Ct("CUSTOMER"),...l,createdAt:l.createdAt?.toDate(),updatedAt:l.updatedAt?.toDate()}})}catch(e){throw console.error("Error fetching customers:",e),new Error("فشل في جلب بيانات العملاء")}}static async createCustomer(e){try{const t=Ct("CUSTOMER"),s={...e,internalId:t,createdAt:vt(),updatedAt:vt()};return(await Mr(ct(De,nd),s)).id}catch(t){throw console.error("Error creating customer:",t),new Error("فشل في إنشاء العميل")}}static async updateCustomer(e,t){try{const s=ut(De,nd,e),a={...t,updatedAt:vt()};return await Xs(s,a),!0}catch(s){throw console.error("Error updating customer:",s),new Error("فشل في تحديث بيانات العميل")}}static async getCustomerById(e){try{const t=ut(De,nd,e),s=await cs(t);if(s.exists()){const a=s.data();return{id:s.id,internalId:a.internalId||Ct("CUSTOMER"),...a,createdAt:a.createdAt?.toDate(),updatedAt:a.updatedAt?.toDate()}}else return null}catch(t){throw console.error("Error fetching customer by ID:",t),new Error("فشل في جلب بيانات العميل")}}static async getCustomerByInternalId(e){try{const t=ct(De,nd),s=Vt(t,jn("internalId","==",e)),a=await St(s);if(a.empty)return null;{const l=a.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:c.createdAt?.toDate(),updatedAt:c.updatedAt?.toDate()}}}catch(t){throw console.error("Error fetching customer by internal ID:",t),new Error("فشل في جلب بيانات العميل")}}static async updateCustomerByInternalId(e,t){try{const s=await this.getCustomerByInternalId(e);if(!s)throw new Error("Customer not found");return await this.updateCustomer(s.id,t)}catch(s){throw console.error("Error updating customer by internal ID:",s),new Error("فشل في تحديث بيانات العميل")}}static async deleteCustomer(e){try{const t=ut(De,nd,e);return await Js(t),!0}catch(t){throw console.error("Error deleting customer:",t),new Error("فشل في حذف العميل")}}static async deleteCustomerByInternalId(e){try{const t=await this.getCustomerByInternalId(e);if(!t)throw new Error("Customer not found");return await this.deleteCustomer(t.id)}catch(t){throw console.error("Error deleting customer by internal ID:",t),new Error("فشل في حذف العميل")}}static async searchCustomers(e){try{const t=ct(De,nd);return(await St(t)).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||Ct("CUSTOMER"),...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate()}}).filter(c=>c.name?.toLowerCase().includes(e.toLowerCase())||c.email?.toLowerCase().includes(e.toLowerCase())||c.phone?.includes(e))}catch(t){throw console.error("Error searching customers:",t),new Error("فشل في البحث عن العملاء")}}static async migrateExistingData(){try{console.log("Starting customers migration...");const e=await this.getAllCustomers();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("cst_")){const a=Ct("CUSTOMER");await this.updateCustomer(s.id,{...s,internalId:a}),t++,console.log(`Migrated customer: ${s.name} -> ${a}`)}return console.log(`Migration completed. ${t} customers migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("فشل في ترحيل البيانات")}}static validateCustomerData(e){const t={};return e.name?.trim()||(t.name="اسم العميل مطلوب"),e.email?.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(t.email="صيغة البريد الإلكتروني غير صحيحة"):t.email="البريد الإلكتروني مطلوب",e.phone?.trim()||(t.phone="رقم الهاتف مطلوب"),t}}const mF=Object.freeze(Object.defineProperty({__proto__:null,CustomerService:Ou},Symbol.toStringTag,{value:"Module"})),fF=({onEdit:r,onAdd:e,refreshTrigger:t})=>{const[s,a]=N.useState([]),[l,c]=N.useState(!0),[u,m]=N.useState(null),[p,b]=N.useState(""),[w,j]=N.useState([]),[D,O]=N.useState(!1),{logActivity:Q,getCurrentUser:z}=vn(),{alertConfig:I,closeAlert:ee,showSuccess:J,showError:oe,showConfirm:Y}=Pn(),{currentPage:be,totalPages:M,paginatedItems:H,handlePageChange:k,resetPage:$,totalItems:X,itemsPerPage:te}=wa(w,30);N.useEffect(()=>{F()},[]),N.useEffect(()=>{t&&F()},[t]),N.useEffect(()=>{if(p.trim()){const U=s.filter(se=>se.name?.toLowerCase().includes(p.toLowerCase())||se.email?.toLowerCase().includes(p.toLowerCase())||se.phone?.includes(p));j(U)}else j(s);$()},[p,s,$]);const F=async()=>{try{c(!0);const U=await Ou.getAllCustomers();a(U),m(null)}catch(U){m(U.message)}finally{c(!1)}},ce=U=>{Y(`هل أنت متأكد من حذف هذا العميل؟

${U.name}`,()=>Be(U),"تأكيد حذف العميل")},Be=async U=>{try{O(!0),await Gn.moveToTrash(U,"customers"),await Ou.deleteCustomer(U.id);const se=z();Q("task",`${se.name} حذف عميل`,`تم حذف العميل: ${U.name}`),await F(),J(`تم نقل العميل للمهملات: ${U.name}`,"تم النقل للمهملات")}catch(se){m(se.message),oe(`فشل في نقل العميل للمهملات: ${se.message}`,"خطأ في النقل")}finally{O(!1)}};return l?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"spinner-border text-primary",role:"status",children:n.jsx("span",{className:"visually-hidden",children:"جار التحميل..."})}),n.jsx("p",{className:"mt-3 text-muted",children:"جار تحميل بيانات العملاء..."})]})}):u?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:u}),n.jsxs("button",{className:"btn btn-primary",onClick:F,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs("div",{className:"card shadow-sm","data-list":"customers",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-person-lines-fill text-primary me-2"}),"قائمة العملاء (",w.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group customers-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في العملاء...",value:p,onChange:U=>b(U.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted"})})]}),n.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:e,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"إضافة عميل جديد"]})]})})]})}),n.jsxs("div",{className:"card-body p-0",children:[w.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-person-lines-fill fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد عملاء"}),n.jsx("p",{className:"text-muted",children:p?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي عملاء بعد"}),!p&&n.jsxs("button",{className:"btn btn-primary",onClick:e,children:[n.jsx("i",{className:"bi bi-plus-lg me-1"}),"إضافة أول عميل"]})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{style:{width:"60px"},children:"#"}),n.jsx("th",{children:"اسم العميل"}),n.jsx("th",{children:"البريد الإلكتروني"}),n.jsx("th",{children:"الهاتف"}),n.jsx("th",{children:"المدينة"}),n.jsx("th",{style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:H.map((U,se)=>n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(be-1)*te+se+1})}),n.jsx("td",{children:n.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",onClick:()=>r(U),style:{textDecoration:"none"},title:`Internal ID: ${U.internalId||"Not Set"}`,children:U.name})}),n.jsx("td",{children:n.jsx("a",{href:`mailto:${U.email}`,className:"text-decoration-none",children:U.email})}),n.jsx("td",{children:U.phone}),n.jsx("td",{children:U.city||"-"}),n.jsx("td",{children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{className:"btn btn-outline-primary",onClick:()=>r(U),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{className:"btn btn-outline-danger",onClick:()=>ce(U),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},U.internalId||U.id))})]})}),w.length>0&&n.jsx(va,{currentPage:be,totalPages:M,onPageChange:k,totalItems:X,itemsPerPage:te})]}),n.jsx(Rn,{show:I.show,onClose:ee,title:I.title,message:I.message,type:I.type,onConfirm:I.onConfirm,confirmText:I.confirmText,cancelText:I.cancelText,showCancel:I.showCancel})]})},pF=({customer:r,onSave:e,onCancel:t})=>{const[s,a]=N.useState({name:"",email:"",phone:"",address:"",city:"",taxNumber:"",bankAccount:"",notes:"",active:!0}),[l,c]=N.useState({}),[u,m]=N.useState(!1),p=!!r,{logActivity:b,getCurrentUser:w}=vn();N.useEffect(()=>{r&&a({name:r.name||"",email:r.email||"",phone:r.phone||"",address:r.address||"",city:r.city||"",taxNumber:r.taxNumber||"",bankAccount:r.bankAccount||"",notes:r.notes||"",active:r.active!==void 0?r.active:!0})},[r]);const j=O=>{const{name:Q,value:z,type:I,checked:ee}=O.target;a(J=>({...J,[Q]:I==="checkbox"?ee:z})),l[Q]&&c(J=>({...J,[Q]:""}))},D=async O=>{O.preventDefault();const Q=Ou.validateCustomerData(s);if(Object.keys(Q).length>0){c(Q);return}m(!0),c({});try{const z=await oo.validateUniqueFields(s,p?r.id:null,p?"customers":null);if(Object.keys(z).length>0){c(z),m(!1);return}const I={...s,status:p&&r.status||"active"};if(p){await Ou.updateCustomer(r.id,I);const ee=w();b("task",`${ee.name} عدل عميل`,`تم تعديل العميل: ${I.name}`)}else{await Ou.createCustomer(I);const ee=w();b("task",`${ee.name} أضاف عميل`,`تم إضافة العميل: ${I.name}`)}e()}catch(z){c({submit:z.message})}finally{m(!1)}};return n.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",children:[n.jsxs("div",{className:"modal-header",children:[n.jsxs("h5",{className:"modal-title",children:[n.jsx("i",{className:"bi bi-person-plus-fill text-primary me-2"}),p?"تعديل العميل":"إضافة عميل جديد"]}),n.jsx("button",{type:"button",className:"btn-close",onClick:t})]}),n.jsxs("form",{onSubmit:D,children:[n.jsxs("div",{className:"modal-body",children:[l.submit&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.submit]}),n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"اسم العميل *"}),n.jsx("input",{type:"text",className:`form-control ${l.name?"is-invalid":""}`,name:"name",value:s.name,onChange:j,placeholder:"أدخل اسم العميل"}),l.name&&n.jsx("div",{className:"invalid-feedback",children:l.name})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"البريد الإلكتروني *"}),n.jsx("input",{type:"email",className:`form-control ${l.email?"is-invalid":""}`,name:"email",value:s.email,onChange:j,placeholder:"example@company.com"}),l.email&&n.jsx("div",{className:"invalid-feedback",children:l.email})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الهاتف *"}),n.jsx("input",{type:"tel",className:`form-control ${l.phone?"is-invalid":""}`,name:"phone",value:s.phone,onKeyPress:O=>{/[0-9+]/.test(O.key)||O.preventDefault()},onChange:O=>{const Q=O.target.value.replace(/[^0-9+]/g,"");j({target:{name:"phone",value:Q}})},placeholder:"+966 50 123 4567"}),l.phone&&n.jsx("div",{className:"invalid-feedback",children:l.phone})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"المدينة"}),n.jsx("input",{type:"text",className:"form-control",name:"city",value:s.city,onChange:j,placeholder:"المدينة"})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"العنوان"}),n.jsx("textarea",{className:"form-control",name:"address",value:s.address,onChange:j,rows:"2",placeholder:"أدخل عنوان الشركة"})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"الرقم الضريبي"}),n.jsx("input",{type:"text",className:"form-control",name:"taxNumber",value:s.taxNumber,onChange:j,placeholder:"الرقم الضريبي"})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الحساب المصرفي"}),n.jsx("input",{type:"text",className:"form-control",name:"bankAccount",value:s.bankAccount,onChange:j,placeholder:"رقم الحساب المصرفي"})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"ملاحظات"}),n.jsx("textarea",{className:"form-control",name:"notes",value:s.notes,onChange:j,rows:"3",placeholder:"أي ملاحظات إضافية..."})]}),n.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:n.jsxs("div",{className:"d-flex align-items-center gap-2",children:[n.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"نشط":"غير نشط"}),n.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"customerActiveSwitch",name:"active",checked:s.active,onChange:j,style:{width:"50px",height:"25px",cursor:"pointer"}})]})})]})]}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsxs("div",{className:"d-flex gap-3",children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:t,disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"12px",height:"12px"}}),"حفظ..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),p?"تحديث":"حفظ"]})})]})})]})]})})})};function gF(){const[r,e]=N.useState(!1),[t,s]=N.useState(!1),[a,l]=N.useState(null),[c,u]=N.useState(0),{isTimelineVisible:m}=$n(),p=()=>{e(!r)},b=()=>{l(null),s(!0)},w=O=>{l(O),s(!0)},j=()=>{s(!1),l(null),u(O=>O+1)},D=()=>{s(!1),l(null)};return n.jsx(sn,{children:n.jsx(rn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Kn,{onToggle:p}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!m?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"العملاء"})]})}),n.jsx(Yn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"customers-table",children:n.jsx(fF,{onAdd:b,onEdit:w,refreshTrigger:c})})}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]}),!r&&m&&n.jsx(Xn,{rtl:!0}),!r&&m&&n.jsx(Jn,{}),t&&n.jsx("div",{className:"customer-form",children:n.jsx(pF,{customer:a,onSave:j,onCancel:D})})]})})})}function xF(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(gF,{})})})}class qo{static getCurrentUserUID(){if(!Yt.currentUser)throw new Error("يجب تسجيل الدخول للوصول إلى البيانات");return Yt.currentUser.uid}static async validateActiveEmployee(){const e=this.getCurrentUserUID();try{const t=await cs(ut(De,"employees",e));if(!t.exists())throw new Error("لا يوجد سجل موظف لهذا المستخدم");const s=t.data();if(s.status!=="active")throw new Error("حساب الموظف غير مفعل");return{uid:e,employeeData:s}}catch(t){throw new Error(`فشل التحقق من صلاحيات الموظف: ${t.message}`)}}static async secureCollection(e){return await this.validateActiveEmployee(),ct(De,e)}static async secureDoc(e,t){return await this.validateActiveEmployee(),ut(De,e,t)}static async secureAddDoc(e,t,s={}){const{uid:a}=await this.validateActiveEmployee(),l={...t,createdBy:a,createdAt:new Date().toISOString(),updatedBy:a,updatedAt:new Date().toISOString(),...s.additionalFields},c=ct(De,e);return await Mr(c,l)}static async secureSetDoc(e,t,s,a={}){const{uid:l}=await this.validateActiveEmployee(),c={...s,createdBy:l,createdAt:new Date().toISOString(),updatedBy:l,updatedAt:new Date().toISOString(),...a.additionalFields},u=ut(De,e,t);return await sh(u,c,a.merge?{merge:!0}:{})}static async secureGetDoc(e,t){await this.validateActiveEmployee();const s=ut(De,e,t);return await cs(s)}static async secureGetDocs(e,t=[]){await this.validateActiveEmployee();const s=ct(De,e);let a=s;return t.length>0&&(a=Vt(s,...t)),await St(a)}static async secureUpdateDoc(e,t,s,a={}){const{uid:l}=await this.validateActiveEmployee(),c={...s,updatedBy:l,updatedAt:new Date().toISOString(),...a.additionalFields},u=ut(De,e,t);return await Xs(u,c)}static async secureDeleteDoc(e,t,s={}){const{uid:a}=await this.validateActiveEmployee();if(s.hardDelete){const l=ut(De,e,t);return await Js(l)}else return await this.secureUpdateDoc(e,t,{isDeleted:!0,deletedBy:a,deletedAt:new Date().toISOString()})}static async secureOnSnapshot(e,t,s=[]){await this.validateActiveEmployee();const a=ct(De,e);let l=a;return s.length>0&&(l=Vt(a,...s)),vf(l,t)}static async secureBatchWrite(e){const{uid:t}=await this.validateActiveEmployee(),s=Jo(De);return e.forEach(a=>{const l=ut(De,a.collection,a.id);if(a.type==="set"){const c={...a.data,createdBy:t,createdAt:new Date().toISOString(),updatedBy:t,updatedAt:new Date().toISOString()};s.set(l,c)}else if(a.type==="update"){const c={...a.data,updatedBy:t,updatedAt:new Date().toISOString()};s.update(l,c)}else a.type==="delete"&&s.delete(l)}),await s.commit()}static async secureTransaction(e){const{uid:t}=await this.validateActiveEmployee();return await x0(De,s=>e(s,t))}static async createEmployeeDoc(e,t=null){const s=this.getCurrentUserUID(),a=t||s;t&&t!==s&&await this.validateActiveEmployee();const l={...e,createdBy:s,createdAt:new Date().toISOString(),updatedBy:s,updatedAt:new Date().toISOString()},c=ut(De,"employees",a);return await sh(c,l)}static async updateOwnEmployeeDoc(e){const t=this.getCurrentUserUID(),s={...e,updatedBy:t,updatedAt:new Date().toISOString()},a=ut(De,"employees",t);return await Xs(a,s)}static async getOwnEmployeeDoc(){const e=this.getCurrentUserUID(),t=ut(De,"employees",e);return await cs(t)}}const sd="companies";class nf{static async getAllCompanies(){try{let e=[];try{e.push(hs("createdAt","desc"))}catch{console.log("Using query without orderBy for empty collection"),e=[]}const s=(await qo.secureGetDocs(sd,e)).docs.map(a=>{const l=a.data();return{id:a.id,internalId:l.internalId||Ct("COMPANY"),...l,createdAt:l.createdAt?.toDate(),updatedAt:l.updatedAt?.toDate()}});return s.length>0&&s[0].createdAt&&s.sort((a,l)=>(l.createdAt||new Date(0))-(a.createdAt||new Date(0))),s}catch(e){if(console.error("Error fetching companies:",e),e.code==="failed-precondition"||e.code==="not-found")return console.log("Companies collection not found, returning empty array"),[];throw new Error("فشل في تحميل الشركات")}}static async createCompany(e){try{const t=Ct("COMPANY"),s={...e,internalId:t,createdAt:vt(),updatedAt:vt()};return(await Mr(ct(De,sd),s)).id}catch(t){throw console.error("Error creating company:",t),new Error("فشل في إنشاء الشركة")}}static async updateCompany(e,t){try{const s=ut(De,sd,e),a={...t,updatedAt:vt()};return await Xs(s,a),!0}catch(s){throw console.error("Error updating company:",s),new Error("فشل في تحديث بيانات الشركة")}}static async getCompanyById(e){try{const t=ut(De,sd,e),s=await cs(t);if(s.exists()){const a=s.data();return{id:s.id,internalId:a.internalId||Ct("COMPANY"),...a,createdAt:a.createdAt?.toDate(),updatedAt:a.updatedAt?.toDate()}}else return null}catch(t){throw console.error("Error fetching company by ID:",t),new Error("فشل في جلب بيانات الشركة")}}static async getCompanyByInternalId(e){try{const t=ct(De,sd),s=Vt(t,jn("internalId","==",e)),a=await St(s);if(a.empty)return null;{const l=a.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:c.createdAt?.toDate(),updatedAt:c.updatedAt?.toDate()}}}catch(t){throw console.error("Error fetching company by internal ID:",t),new Error("فشل في جلب بيانات الشركة")}}static async updateCompanyByInternalId(e,t){try{const s=await this.getCompanyByInternalId(e);if(!s)throw new Error("Company not found");return await this.updateCompany(s.id,t)}catch(s){throw console.error("Error updating company by internal ID:",s),new Error("فشل في تحديث بيانات الشركة")}}static async deleteCompany(e){try{const t=ut(De,sd,e);return await Js(t),!0}catch(t){throw console.error("Error deleting company:",t),new Error("فشل في حذف الشركة")}}static async deleteCompanyByInternalId(e){try{const t=await this.getCompanyByInternalId(e);if(!t)throw new Error("Company not found");return await this.deleteCompany(t.id)}catch(t){throw console.error("Error deleting company by internal ID:",t),new Error("فشل في حذف الشركة")}}static async searchCompanies(e){try{const t=ct(De,sd);return(await St(t)).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||Ct("COMPANY"),...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate()}}).filter(c=>c.name?.toLowerCase().includes(e.toLowerCase())||c.email?.toLowerCase().includes(e.toLowerCase())||c.phone?.includes(e))}catch(t){throw console.error("Error searching companies:",t),new Error("فشل في البحث عن الشركات")}}static async migrateExistingData(){try{console.log("Starting companies migration...");const e=await this.getAllCompanies();let t=0;for(const s of e)if(!s.internalId||!s.internalId.startsWith("comp_")){const a=Ct("COMPANY");await this.updateCompany(s.id,{...s,internalId:a}),t++,console.log(`Migrated company: ${s.name} -> ${a}`)}return console.log(`Migration completed. ${t} companies migrated.`),{success:!0,migratedCount:t}}catch(e){throw console.error("Error during migration:",e),new Error("فشل في ترحيل البيانات")}}static validateCompanyData(e){const t={};return e.name?.trim()||(t.name="اسم الشركة مطلوب"),e.email?.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(t.email="صيغة البريد الإلكتروني غير صحيحة"):t.email="البريد الإلكتروني مطلوب",e.phone?.trim()||(t.phone="رقم الهاتف مطلوب"),t}}const yF=({onEdit:r,onAdd:e,refreshTrigger:t})=>{const[s,a]=N.useState([]),[l,c]=N.useState(!0),[u,m]=N.useState(null),[p,b]=N.useState(""),[w,j]=N.useState([]),[D,O]=N.useState(!1),{logActivity:Q,getCurrentUser:z}=vn(),{alertConfig:I,closeAlert:ee,showSuccess:J,showError:oe,showConfirm:Y}=Pn(),{currentPage:be,totalPages:M,paginatedItems:H,handlePageChange:k,resetPage:$,totalItems:X,itemsPerPage:te}=wa(w,30);N.useEffect(()=>{F()},[]),N.useEffect(()=>{t&&F()},[t]),N.useEffect(()=>{if(p.trim()){const U=s.filter(se=>se.name?.toLowerCase().includes(p.toLowerCase())||se.email?.toLowerCase().includes(p.toLowerCase())||se.phone?.includes(p));j(U)}else j(s);$()},[p,s,$]);const F=async()=>{try{c(!0);const U=await nf.getAllCompanies();a(U),m(null)}catch(U){m(U.message)}finally{c(!1)}},ce=U=>{Y(`هل أنت متأكد من حذف هذه الشركة؟

${U.name}`,()=>Be(U),"تأكيد حذف الشركة")},Be=async U=>{try{O(!0),await Gn.moveToTrash(U,"companies"),await nf.deleteCompany(U.id);const se=z();Q("task",`${se.name} حذف شركة`,`تم حذف الشركة: ${U.name}`),await F(),J(`تم نقل الشركة للمهملات: ${U.name}`,"تم النقل للمهملات")}catch(se){m(se.message),oe(`فشل في نقل الشركة للمهملات: ${se.message}`,"خطأ في النقل")}finally{O(!1)}};return l?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"spinner-border text-primary",role:"status",children:n.jsx("span",{className:"visually-hidden",children:"جار التحميل..."})}),n.jsx("p",{className:"mt-3 text-muted",children:"جار تحميل بيانات الشركات..."})]})}):u?n.jsx("div",{className:"card shadow-sm",children:n.jsxs("div",{className:"card-body text-center py-5",children:[n.jsx("div",{className:"text-danger mb-3",children:n.jsx("i",{className:"bi bi-exclamation-triangle fs-1"})}),n.jsx("h5",{className:"text-danger",children:"حدث خطأ"}),n.jsx("p",{className:"text-muted",children:u}),n.jsxs("button",{className:"btn btn-primary",onClick:F,children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة المحاولة"]})]})}):n.jsxs("div",{className:"card shadow-sm","data-list":"companies",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-building-fill text-primary me-2"}),"قائمة الشركات (",w.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group suppliers-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في الشركات...",value:p,onChange:U=>b(U.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted"})})]}),n.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:e,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"إضافة شركة جديدة"]})]})})]})}),n.jsxs("div",{className:"card-body p-0",children:[w.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-building fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا يوجد شركات"}),n.jsx("p",{className:"text-muted",children:p?"لا توجد نتائج للبحث المحدد":"لم يتم إضافة أي شركات بعد"}),!p&&n.jsxs("button",{className:"btn btn-primary",onClick:e,children:[n.jsx("i",{className:"bi bi-plus-lg me-1"}),"إضافة أول شركة"]})]}):n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{style:{width:"60px"},children:"#"}),n.jsx("th",{children:"اسم الشركة"}),n.jsx("th",{children:"البريد الإلكتروني"}),n.jsx("th",{children:"الهاتف"}),n.jsx("th",{children:"المدينة"}),n.jsx("th",{style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:H.map((U,se)=>n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-muted",style:{fontSize:"14px"},children:(be-1)*te+se+1})}),n.jsx("td",{children:n.jsx("button",{className:"btn btn-link p-0 text-start fw-bold text-primary",onClick:()=>r(U),style:{textDecoration:"none"},title:`Internal ID: ${U.internalId||"Not Set"}`,children:U.name})}),n.jsx("td",{children:n.jsx("a",{href:`mailto:${U.email}`,className:"text-decoration-none",children:U.email})}),n.jsx("td",{style:{direction:"ltr",textAlign:"left"},children:U.phone}),n.jsx("td",{children:U.city||"-"}),n.jsx("td",{children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{className:"btn btn-outline-primary",onClick:()=>r(U),title:"تعديل",children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{className:"btn btn-outline-danger",onClick:()=>ce(U),title:"حذف",children:n.jsx("i",{className:"bi bi-trash"})})]})})]},U.internalId||U.id))})]})}),w.length>0&&n.jsx(va,{currentPage:be,totalPages:M,onPageChange:k,totalItems:X,itemsPerPage:te})]}),n.jsx(Rn,{show:I.show,onClose:ee,title:I.title,message:I.message,type:I.type,onConfirm:I.onConfirm,confirmText:I.confirmText,cancelText:I.cancelText,showCancel:I.showCancel})]})};class fd{static collectionName="companydocuments";static storagePath="company-documents";static async withRetry(e,{retries:t=5,base:s=150}={}){let a=0;for(;;)try{return await e()}catch(l){if(a++,a>t)throw l;const c=Math.floor(s*Math.pow(2,a-1)+Math.random()*s);await new Promise(u=>setTimeout(u,c))}}static async uploadDocument(e,{companyId:t,companyName:s="",companyEmail:a="",customFileName:l,expiryDate:c,userId:u}={}){console.log("📤 Starting company document upload:",e.name);try{if(!Yt.currentUser)throw new Error("يجب تسجيل الدخول لرفع الوثائق");const m=u||Yt.currentUser.uid,p=await Mr(ct(De,this.collectionName),{fileName:l||e.name,originalFileName:e.name,size:e.size,fileSize:e.size,contentType:e.type||"application/octet-stream",fileType:e.type||"application/octet-stream",status:"uploading",isTrashed:!1,companyId:t||"new",companyName:s,companyEmail:a,expiryDate:c||null,createdAt:vt(),updatedAt:vt(),trashedAt:null,trashedBy:null,uploadedBy:m,url:null,fileURL:null,storagePath:null});console.log("✅ Company document shell created:",p.id),console.log("🔄 About to call fileStorageService.uploadFile with:",{fileName:e.name,fileSize:e.size,folder:"company-documents"});const b=await _r.uploadFile(e,"company-documents");return console.log("✅ File uploaded to storage:",b.path),await Xs(ut(De,this.collectionName,p.id),{url:b.url,fileURL:b.url,storagePath:b.path,status:"ready",updatedAt:vt()}),console.log("✅ Company document upload completed:",p.id),{id:p.id,fileName:l||e.name,originalFileName:e.name,url:b.url,fileURL:b.url,storagePath:b.path,size:e.size,fileSize:e.size,contentType:e.type||"application/octet-stream",fileType:e.type||"application/octet-stream"}}catch(m){throw console.error("❌ Company document upload failed:",m),new Error(`فشل في رفع وثيقة الشركة: ${m.message}`)}}static async moveDocumentToTrash(e,{userId:t}={}){const s=t||Yt.currentUser?.uid||"system";console.log("🗑️ Moving company document to trash:",{documentId:e,userId:s,collection:this.collectionName});try{await this.withRetry(async()=>{await x0(De,async a=>{const l=ut(De,this.collectionName,e),c=await a.get(l);if(console.log("📄 Document lookup result:",{documentId:e,exists:c.exists(),collection:this.collectionName}),!c.exists())throw console.error("❌ Document not found in Firebase:",{documentId:e,collection:this.collectionName,attemptedPath:`${this.collectionName}/${e}`}),new Error(`وثيقة الشركة غير موجودة في قاعدة البيانات (ID: ${e})`);const u=c.data();if(console.log("📊 Document data:",{fileName:u.fileName,isTrashed:u.isTrashed,status:u.status}),u.isTrashed===!0){console.log("Company document already trashed - idempotent operation");return}a.update(l,{isTrashed:!0,trashedAt:vt(),trashedBy:s,updatedAt:vt()})})}),console.log("✅ Company document moved to trash successfully")}catch(a){throw console.error("❌ Error moving company document to trash:",{documentId:e,error:a.message,stack:a.stack}),a.message.includes("وثيقة الشركة غير موجودة")?a:new Error(`فشل في نقل وثيقة الشركة للمهملات: ${a.message}`)}}static async restoreDocumentFromTrash(e){console.log("♻️ Restoring company document from trash:",e),await this.withRetry(async()=>{await x0(De,async t=>{const s=ut(De,this.collectionName,e),a=await t.get(s);if(!a.exists())throw new Error("وثيقة الشركة غير موجودة");if(a.data().isTrashed===!1){console.log("Company document already active - idempotent operation");return}t.update(s,{isTrashed:!1,trashedAt:null,trashedBy:null,updatedAt:vt()})})}),console.log("✅ Company document restored from trash successfully")}static subscribeToCompanyDocuments(e,t){console.log("📡 Setting up Firebase subscription for companyId:",e);const s=Vt(ct(De,this.collectionName),jn("companyId","==",e),jn("isTrashed","==",!1));return console.log("📡 Firebase query created for company documents:",{collection:this.collectionName,companyId:e,filters:["companyId ==",e,"isTrashed ==",!1]}),vf(s,a=>{console.log("📡 Firebase snapshot received for company documents:"),console.log("- Snapshot size:",a.size),console.log("- Snapshot empty:",a.empty);const l=[];a.forEach(c=>{const u=c.data(),m={id:c.id,...u,fileURL:u.fileURL||u.url,fileType:u.fileType||u.contentType,fileSize:u.fileSize||u.size};console.log("- Company document found:",{id:c.id,fileName:m.fileName,companyId:m.companyId,isTrashed:m.isTrashed,status:m.status,hasURL:!!m.fileURL,hasExpiryDate:!!m.expiryDate}),l.push(m)}),l.sort((c,u)=>{const m=c.updatedAt?.seconds||0;return(u.updatedAt?.seconds||0)-m}),console.log("📡 Calling callback with",l.length,"company documents (sorted manually)"),t(l)},a=>{console.error("❌ Company document subscription error:",a),console.error("Error details:",{code:a.code,message:a.message,companyId:e,collection:this.collectionName}),t([])})}static subscribeToTrashedDocuments(e){const t=Vt(ct(De,this.collectionName),jn("isTrashed","==",!0));return vf(t,s=>{const a=[];s.forEach(l=>{a.push({id:l.id,...l.data()})}),a.sort((l,c)=>{const u=l.updatedAt?.seconds||0;return(c.updatedAt?.seconds||0)-u}),e(a)},s=>{console.error("Company trashed documents subscription error:",s),e([])})}static async getCompanyDocuments(e){try{console.log("🔍 Getting company documents for ID:",e);const t=Vt(ct(De,this.collectionName),jn("companyId","==",e),jn("isTrashed","==",!1)),s=await St(t),a=[];return s.forEach(l=>{const c=l.data(),u={id:l.id,...c,fileURL:c.fileURL||c.url,fileType:c.fileType||c.contentType,fileSize:c.fileSize||c.size};console.log("📄 Found document:",u.fileName,"for company:",u.companyId),a.push(u)}),console.log(`📊 Total documents found for company ${e}: ${a.length}`),a.sort((l,c)=>{const u=l.updatedAt?.seconds||0;return(c.updatedAt?.seconds||0)-u}),a}catch(t){throw console.error("Error getting company documents:",t),new Error(`فشل في تحميل وثائق الشركة: ${t.message}`)}}static async getAllDocuments(){try{const e=await St(ct(De,this.collectionName)),t=[];return e.forEach(s=>{t.push({id:s.id,...s.data()})}),t.sort((s,a)=>{const l=s.updatedAt?.seconds||0;return(a.updatedAt?.seconds||0)-l}),t}catch(e){throw console.error("Error getting all company documents:",e),new Error(`فشل في تحميل جميع وثائق الشركات: ${e.message}`)}}static async getTrashedDocuments(){try{const e=Vt(ct(De,this.collectionName),jn("isTrashed","==",!0)),t=await St(e),s=[];return t.forEach(a=>{s.push({id:a.id,...a.data()})}),s.sort((a,l)=>{const c=a.updatedAt?.seconds||0;return(l.updatedAt?.seconds||0)-c}),s}catch(e){throw console.error("Error getting trashed company documents:",e),new Error(`فشل في تحميل مهملات وثائق الشركة: ${e.message}`)}}static async permanentlyDeleteDocuments(e=[]){if(!e.length)return;console.log("🔥 Permanently deleting company documents:",e);const t=Jo(De),s=e.map(c=>ut(De,this.collectionName,c)),a=await Promise.all(s.map(c=>cs(c))),l=[];a.forEach(c=>{if(!c.exists())return;const u=c.data();if(u.isTrashed===!0&&(t.delete(ut(De,this.collectionName,c.id)),u.storagePath)){const m=Qo(ri,u.storagePath);l.push(Vx(m).catch(p=>{console.warn("Storage delete failed (continuing):",p)}))}}),await t.commit(),await Promise.allSettled(l),console.log("✅ Company documents permanently deleted")}static async updateDocumentCompanyId(e,t,s={}){console.log("🔄 Updating company documents from temp ID to real ID:",{oldCompanyId:e,newCompanyId:t,companyName:s.name});try{const a=Vt(ct(De,this.collectionName),jn("companyId","==",e),jn("isTrashed","==",!1)),l=await St(a);if(l.empty)return console.log("No documents found with old company ID:",e),0;console.log(`Found ${l.size} documents to update company ID`);const c=[];return l.forEach(u=>{const m={companyId:t,companyName:s.name||"",companyEmail:s.email||"",updatedAt:vt()};c.push(Xs(ut(De,this.collectionName,u.id),m))}),await Promise.all(c),console.log(`✅ Updated ${l.size} documents with new company ID:`,t),l.size}catch(a){throw console.error("❌ Error updating document company IDs:",a),new Error(`فشل في ربط الوثائق بالشركة: ${a.message}`)}}static async deleteDocument(e){return await this.moveDocumentToTrash(e)}}const bF=({expiryDate:r,className:e="",style:t={}})=>{const[s,a]=N.useState("00"),[l,c]=N.useState(!1);return N.useEffect(()=>{if(!r){a("00"),c(!1);return}const u=()=>{try{const p=new Date,[b,w,j]=r.split("-").map(Number),O=new Date(b,w-1,j,23,59,59).getTime()-p.getTime();if(O<=0){a("00"),c(!0);return}const Q=Math.floor(O/1e3),z=Math.floor(Q/(1440*60)),ee=(J=>J.toString().padStart(2,"0"))(z);a(ee),c(!1)}catch(p){console.error("CountdownTimer error:",p),a("--"),c(!1)}};u();const m=setInterval(u,1e3);return()=>clearInterval(m)},[r]),l?n.jsx("div",{className:`countdown-timer expired ${e}`,style:t,children:n.jsx("div",{className:"digital-display text-danger",children:n.jsx("small",{className:"fw-bold",children:"منتهي الصلاحية"})})}):n.jsx("div",{className:`countdown-timer ${e}`,style:t,children:n.jsx("div",{className:"digital-display",children:n.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{fontSize:"14px",fontFamily:"monospace"},children:n.jsx("span",{className:"text-danger fw-bold",children:s})})})})},wF=({show:r,onClose:e,title:t="أوراق الشركة",documents:s=[],setDocuments:a,companyId:l="new",companyName:c="",companyEmail:u=""})=>{const[m,p]=N.useState(!1),[b,w]=N.useState(null),[j,D]=N.useState(""),[O,Q]=N.useState(""),[z,I]=N.useState(!1),[ee,J]=N.useState(null),[oe,Y]=N.useState(null),[be,M]=N.useState(null),{alertConfig:H,closeAlert:k,showSuccess:$,showError:X,showConfirm:te}=Pn(),{logActivity:F,getCurrentUser:ce}=vn(),{currentUser:Be}=W1(),{formatDate:U}=yh();N.useEffect(()=>{if(r&&l){console.log("📂 Modal opened - setting up Firebase subscription for company documents:",l);const q=fd.subscribeToCompanyDocuments(l,me=>{console.log("✅ Received company documents from Firebase:",me.length),a&&a(me)});return M(()=>q),()=>{q&&(console.log("🔌 Cleaning up Firebase subscription for company documents"),q())}}},[r,l,a]),N.useEffect(()=>{!r&&be&&(console.log("🔌 Modal closed - cleaning up Firebase subscription"),be(),M(null))},[r,be]);const se=q=>{console.log("📎 Document file selected:",{name:q.name,size:q.size,type:q.type}),I(!0);try{_r.validateFile(q,{maxSize:10*1024*1024,allowedTypes:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png","image/jpg"]}),console.log("📤 Preparing company document for upload:",q.name),w({file:q,originalFileName:q.name,fileSize:q.size,fileType:q.type}),D(q.name.split(".")[0]),p(!0),console.log("✅ Document file validated and ready for naming")}catch(me){console.error("❌ File validation failed:",me),X(me.message,"خطأ في الملف")}finally{I(!1)}},fe=()=>{try{const q=document.createElement("input");q.type="file",q.accept=".pdf,.doc,.docx,.jpg,.png,.jpeg",q.style.display="none",q.onchange=me=>{const C=me.target.files?.[0];C&&se(C),document.body.contains(q)&&document.body.removeChild(q)},q.onclick=()=>{q.value=""},document.body.appendChild(q),q.click()}catch(q){console.error("❌ File input creation failed:",q),X("فشل في فتح منتقي الملفات","خطأ في النظام")}},ie=q=>{try{Y(q.id);const me=document.createElement("input");me.type="file",me.accept=".pdf,.doc,.docx,.jpg,.png,.jpeg",me.style.display="none",me.onchange=C=>{const Z=C.target.files?.[0];Z&&se(Z),document.body.contains(me)&&document.body.removeChild(me)},me.onclick=()=>{me.value=""},document.body.appendChild(me),me.click()}catch(me){console.error("❌ File replacement failed:",me),X("فشل في فتح منتقي الملفات","خطأ في النظام"),Y(null)}},_=async()=>{if(!j.trim()){X("يرجى إدخال اسم الملف","اسم الملف مطلوب");return}if(!b){X("بيانات الملف غير متاحة","خطأ");return}p(!1);const q=b.file,me=j.trim(),C=oe;w(null),D(""),Q(""),Y(null);try{I(!0),console.log("📤 Uploading company document to Firebase via service:",me);const Z=ce();C&&(console.log("🗑️ Deleting old expired document before uploading replacement:",C),s.find(Ke=>Ke.id===C)&&(await fd.deleteDocument(C),console.log("✅ Old expired document deleted successfully"))),console.log("🔐 About to upload document with authUser:",{uid:Be?.uid,email:Be?.email,hasUser:!!Be});const je=await fd.uploadDocument(q,{companyId:l,companyName:c,companyEmail:u,customFileName:me,uploadDate:new Date().toISOString().split("T")[0],expiryDate:O||null,userId:Be?.uid});console.log("✅ Document uploaded successfully via Firebase service:",je),C?($(`تم استبدال الملف بنجاح: ${me}`,"تم الاستبدال"),F("file",`${Z.name} استبدل وثيقة شركة منتهية الصلاحية`,`تم استبدال الملف: ${me}`)):($(`تم رفع الملف بنجاح: ${me}`,"تم الرفع"),F("file",`${Z.name} رفع وثيقة شركة`,`تم رفع الملف: ${me}`))}catch(Z){console.error("❌ Error uploading company document via Firebase:",Z),X(`فشل في رفع الملف: ${Z.message}`,"خطأ في الرفع")}finally{I(!1)}},E=()=>{console.log("User cancelled company document upload"),p(!1),w(null),D(""),Q("")},R=q=>{const me=q.documentFileURL||q.fileURL||q.url;me?window.open(me,"_blank"):X("الملف غير متوفر للعرض","ملف غير موجود")},V=q=>{te(`هل أنت متأكد من حذف هذا الملف؟

${q.fileName}`,async()=>{try{I(!0);const me=ce();await fd.moveDocumentToTrash(q.id,{userId:Be?.uid}),F("task",`${me.name} حذف وثيقة شركة`,`تم حذف الوثيقة: ${q.fileName}`),$(`تم نقل الملف للمهملات: ${q.fileName}`,"تم النقل للمهملات")}catch(me){console.error("❌ Error deleting company document:",me),X(`فشل في حذف الملف: ${me.message}`,"خطأ في الحذف")}finally{I(!1)}},"تأكيد حذف الملف")},ne=()=>{p(!1),w(null),D(""),Q(""),e()},B=q=>q?q.includes("pdf")?{icon:"bi-file-earmark-pdf",color:"#dc3545"}:q.includes("word")||q.includes("document")?{icon:"bi-file-earmark-word",color:"#2b579a"}:q.includes("image")?{icon:"bi-file-earmark-image",color:"#198754"}:{icon:"bi-file-earmark",color:"#6c757d"}:{icon:"bi-file-earmark",color:"#6c757d"};return r?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},tabIndex:"-1",dir:"rtl",children:n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-building-fill me-2"}),t]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:ne,"aria-label":"Close"})]}),n.jsxs("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"},children:[n.jsx("div",{className:"mb-4",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[n.jsxs("div",{children:[n.jsx("h6",{className:"mb-0 fw-bold text-primary",children:"مكتبة وثائق الشركة"}),n.jsx("div",{className:"d-flex align-items-center gap-3",children:n.jsxs("small",{className:"text-muted",children:["إجمالي الملفات: ",s.length]})})]}),n.jsx("div",{style:{marginLeft:"20px"},children:n.jsx("button",{type:"button",className:"btn btn-primary",onClick:fe,disabled:z,style:{height:"32px",minWidth:"120px",fontSize:"14px",borderRadius:"6px",padding:"6px 16px",fontWeight:"500"},children:z?n.jsxs(n.Fragment,{children:[n.jsx(Dn,{size:"small"}),n.jsx("span",{className:"ms-2",children:"رفع..."})]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-cloud-upload me-1"}),"إضافة ملف"]})})})]})}),s.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-building fs-1"})}),n.jsx("h5",{className:"text-muted",children:"لا توجد وثائق"}),n.jsx("p",{className:"text-muted",children:"ابدأ بإضافة وثائق الشركة المطلوبة"})]}):n.jsx("div",{className:"table-responsive company-documents-table",children:n.jsxs("table",{className:"table table-hover custom-striped",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",children:"نوع الملف"}),n.jsx("th",{className:"text-center",children:"اسم الوثيقة"}),n.jsx("th",{className:"text-center",children:"تاريخ الانتهاء"}),n.jsx("th",{className:"text-center",children:"الوقت المتبقي"}),n.jsx("th",{className:"text-center",children:"الإجراءات"})]})}),n.jsx("tbody",{children:s.map((q,me)=>{const C=q.fileName||"وثيقة غير محددة",Z=B(q.documentFileType),je=q.expiryDate&&new Date(q.expiryDate)<new Date;return n.jsxs("tr",{children:[n.jsx("td",{className:"text-center",children:q.documentFileURL||q.fileURL||q.url?n.jsx(qx,{size:25,clickable:!0,onClick:()=>R(q),title:`عرض الملف: ${q.documentFileName||q.fileName}`}):n.jsx("i",{className:Z.icon,style:{color:Z.color,fontSize:"24px"}})}),n.jsxs("td",{className:"text-center",children:[n.jsx("div",{className:"fw-bold",children:C}),q.description&&n.jsx("small",{className:"text-muted",children:q.description})]}),n.jsx("td",{className:"text-center",children:q.expiryDate?n.jsx("small",{className:"text-muted",children:U(q.expiryDate)}):n.jsx("small",{className:"text-muted",children:"غير محدد"})}),n.jsx("td",{className:"text-center",children:q.expiryDate?n.jsx(bF,{expiryDate:q.expiryDate,style:{minWidth:"80px"}},`countdown-${q.id}-${q.expiryDate}`):n.jsx("small",{className:"text-muted",children:"-"})}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[!je&&n.jsx("button",{className:"btn btn-outline-primary",onClick:()=>R(q),disabled:!q.documentFileURL&&!q.fileURL&&!q.url,title:q.documentFileURL||q.fileURL||q.url?`عرض الملف: ${q.documentFileName||q.fileName}`:"الملف غير متوفر",style:{width:"28px",height:"32px"},children:n.jsx("i",{className:"bi bi-eye"})}),je?n.jsx("button",{className:"btn btn-warning",onClick:()=>ie(q),title:"اختيار ملف جديد",style:{width:"28px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsx("i",{className:"bi bi-folder2-open",style:{color:"black",fontSize:"12px"}})}):n.jsx("button",{className:"btn btn-outline-danger",onClick:()=>V(q),title:"حذف",style:{width:"28px",height:"32px"},children:n.jsx("i",{className:"bi bi-trash"})})]})})]},q.id||me)})})]})})]}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:e,style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px"},children:"إغلاق"}),n.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{$("وثائق الشركة تحفظ تلقائياً","تم الحفظ"),setTimeout(()=>e(),1500)},style:{height:"32px",width:"80px",borderRadius:"6px",fontSize:"14px"},children:"حفظ"})]})})]})})}),m&&n.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.7)",zIndex:1060},tabIndex:"-1",dir:"rtl",children:n.jsx("div",{className:"modal-dialog modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"12px 12px 0 0"},children:[n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-pencil-square me-2"}),"تسمية الملف"]}),n.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:E,"aria-label":"Close"})]}),n.jsx("div",{className:"modal-body",style:{padding:"25px"},children:n.jsxs("div",{className:"mb-4",children:[n.jsxs("div",{className:"d-flex align-items-center mb-3",children:[n.jsx("div",{className:"bg-success bg-opacity-10 p-2 rounded-circle me-3",children:n.jsx("i",{className:"bi bi-file-earmark-check text-success"})}),n.jsxs("div",{children:[n.jsx("h6",{className:"mb-0 fw-bold text-success",children:"تم رفع الملف بنجاح"}),n.jsx("small",{className:"text-muted",children:b?.originalFileName})]})]}),n.jsxs("div",{className:"mb-3",children:[n.jsxs("label",{className:"form-label fw-bold text-primary",children:[n.jsx("i",{className:"bi bi-tag me-1"}),"اسم الملف المخصص *"]}),n.jsx("input",{type:"text",className:"form-control",value:j,onChange:q=>D(q.target.value),placeholder:"أدخل اسم الملف المخصص",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:q=>{q.target.style.borderColor="#28a745",q.target.style.boxShadow="0 0 0 0.2rem rgba(40, 167, 69, 0.25)"},onBlur:q=>{q.target.style.borderColor="#e9ecef",q.target.style.boxShadow="none"},autoFocus:!0}),n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),"سيتم استخدام هذا الاسم لعرض الملف في قائمة وثائق الشركة"]})]}),n.jsxs("div",{className:"mb-3",children:[n.jsxs("label",{className:"form-label fw-bold text-warning",children:[n.jsx("i",{className:"bi bi-calendar-event me-1"}),"تاريخ انتهاء الصلاحية"]}),n.jsx("input",{type:"date",className:"form-control",value:O,onChange:q=>Q(q.target.value),placeholder:"اختر تاريخ انتهاء الصلاحية",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:q=>{q.target.style.borderColor="#ffc107",q.target.style.boxShadow="0 0 0 0.2rem rgba(255, 193, 7, 0.25)"},onBlur:q=>{q.target.style.borderColor="#e9ecef",q.target.style.boxShadow="none"}}),n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),"اتركه فارغاً إذا لم تكن هناك صلاحية محددة"]})]})]})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:n.jsxs("div",{className:"d-flex justify-content-end",style:{gap:"12px"},children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:E,style:{height:"32px",fontSize:"13px",borderRadius:"6px",padding:"0 12px",width:"80px"},children:"إلغاء"}),n.jsxs("button",{type:"button",className:"btn btn-primary",onClick:_,disabled:!j.trim(),style:{height:"32px",fontSize:"13px",borderRadius:"6px",padding:"0 12px",width:"80px"},children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),"حفظ"]})]})})]})})}),n.jsx(Rn,{show:H.show,onClose:k,title:H.title,message:H.message,type:H.type,onConfirm:H.onConfirm,showConfirm:H.showConfirm})]}):null},vF=({company:r,onSave:e,onCancel:t})=>{const[s,a]=N.useState({name:"",email:"",phone:"",address:"",city:"",taxNumber:"",bankAccount:"",notes:"",active:!0}),[l,c]=N.useState({}),[u,m]=N.useState(!1),[p,b]=N.useState(!1),[w,j]=N.useState([]),[D,O]=N.useState(!1),[Q,z]=N.useState(null),[I,ee]=N.useState(null),J=!!r,{logActivity:oe,getCurrentUser:Y}=vn();N.useEffect(()=>{r&&a({name:r.name||"",email:r.email||"",phone:r.phone||"",address:r.address||"",city:r.city||"",taxNumber:r.taxNumber||"",bankAccount:r.bankAccount||"",notes:r.notes||"",active:r.active!==void 0?r.active:!0})},[r]),N.useEffect(()=>{(()=>{J&&r?.id?be():(async()=>{O(!0);try{const te=await fd.getCompanyDocuments("new");console.log("📄 Loaded temp company documents from Firebase:",te.length),j(te)}catch(te){console.error("Error loading temp company documents from Firebase:",te),j([])}finally{O(!1)}})()})()},[J,r?.id]),N.useEffect(()=>()=>{I&&(console.log("🔌 Cleaning up Firebase subscription for company documents"),I())},[I]);const be=()=>{if(!r?.id)return;O(!0),I&&I();const $=fd.subscribeToCompanyDocuments(r.id,X=>{console.log("📄 Received company documents from Firebase:",X.length),j(X),O(!1),z(null)});ee(()=>$)},M=()=>{console.log("Opening document modal..."),b(!0)},H=$=>{const{name:X,value:te,type:F,checked:ce}=$.target;a(Be=>({...Be,[X]:F==="checkbox"?ce:te})),l[X]&&c(Be=>({...Be,[X]:""}))},k=async $=>{$.preventDefault();const X=nf.validateCompanyData(s);if(Object.keys(X).length>0){c(X);return}m(!0),c({});try{const te=await oo.validateUniqueFields(s,J?r.id:null,J?"companies":null);if(Object.keys(te).length>0){c(te),m(!1);return}const F={...s,status:J&&r.status||"active"};if(J){await nf.updateCompany(r.id,F);const ce=Y();oe("task",`${ce.name} عدل شركة`,`تم تعديل الشركة: ${F.name}`)}else{const ce=await nf.createCompany(F);try{const U=await fd.updateDocumentCompanyId("new",ce,F);U>0&&console.log(`✅ Linked ${U} documents to new company:`,ce)}catch(U){console.warn("⚠️ Failed to link documents to new company:",U)}const Be=Y();oe("task",`${Be.name} أضاف شركة`,`تم إضافة الشركة: ${F.name}`)}e()}catch(te){c({submit:te.message})}finally{m(!1)}};return n.jsxs("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:[n.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",children:[n.jsx("div",{className:"modal-header",children:n.jsxs("div",{className:"d-flex align-items-center justify-content-between w-100",children:[n.jsxs("h5",{className:"modal-title mb-0",children:[n.jsx("i",{className:"bi bi-building-plus-fill text-primary me-2"}),J?"تعديل الشركة":"إضافة شركة جديدة"]}),n.jsxs("div",{className:"d-flex align-items-center",style:{gap:"15px"},children:[J&&n.jsx("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:M,disabled:D,style:{height:"32px",fontSize:"13px",borderRadius:"6px",padding:"0 12px",whiteSpace:"nowrap",marginLeft:"20px"},children:D?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"spinner-border spinner-border-sm me-1",role:"status",style:{width:"12px",height:"12px"}}),"تحميل..."]}):Q?n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-1 text-warning"}),"أوراق الشركة"]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-file-earmark-text me-1"}),"أوراق الشركة (",w.length,")"]})}),n.jsx("button",{type:"button",className:"btn-close",onClick:t})]})]})}),n.jsxs("form",{onSubmit:k,children:[n.jsxs("div",{className:"modal-body",children:[l.submit&&n.jsxs("div",{className:"alert alert-danger",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l.submit]}),Q&&n.jsxs("div",{className:"alert alert-warning d-flex align-items-center justify-content-between",children:[n.jsxs("div",{children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"فشل في تحميل وثائق الشركة: ",Q]}),n.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:be,style:{borderRadius:"4px"},children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-1"}),"إعادة تحميل"]})]}),n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"اسم الشركة *"}),n.jsx("input",{type:"text",className:`form-control ${l.name?"is-invalid":""}`,name:"name",value:s.name,onChange:H,placeholder:"أدخل اسم الشركة"}),l.name&&n.jsx("div",{className:"invalid-feedback",children:l.name})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"البريد الإلكتروني *"}),n.jsx("input",{type:"email",className:`form-control ${l.email?"is-invalid":""}`,name:"email",value:s.email,onChange:H,placeholder:"example@company.com"}),l.email&&n.jsx("div",{className:"invalid-feedback",children:l.email})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الهاتف *"}),n.jsx("input",{type:"tel",className:`form-control ${l.phone?"is-invalid":""}`,name:"phone",value:s.phone,onKeyPress:$=>{/[0-9+]/.test($.key)||$.preventDefault()},onChange:$=>{const X=$.target.value.replace(/[^0-9+]/g,"");H({target:{name:"phone",value:X}})},placeholder:"+966 50 123 4567"}),l.phone&&n.jsx("div",{className:"invalid-feedback",children:l.phone})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"المدينة"}),n.jsx("input",{type:"text",className:"form-control",name:"city",value:s.city,onChange:H,placeholder:"المدينة"})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"العنوان"}),n.jsx("textarea",{className:"form-control",name:"address",value:s.address,onChange:H,rows:"2",placeholder:"أدخل عنوان الشركة"})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"الرقم الضريبي"}),n.jsx("input",{type:"text",className:"form-control",name:"taxNumber",value:s.taxNumber,onChange:H,placeholder:"الرقم الضريبي"})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الحساب المصرفي"}),n.jsx("input",{type:"text",className:"form-control",name:"bankAccount",value:s.bankAccount,onChange:H,placeholder:"رقم الحساب المصرفي"})]}),n.jsxs("div",{className:"col-md-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"ملاحظات"}),n.jsx("textarea",{className:"form-control",name:"notes",value:s.notes,onChange:H,rows:"3",placeholder:"أي ملاحظات إضافية..."})]}),n.jsx("div",{className:"col-md-12 mb-3 d-flex justify-content-end",style:{marginTop:"20px"},children:n.jsxs("div",{className:"d-flex align-items-center gap-2",children:[n.jsx("span",{className:`badge ${s.active?"bg-success":"bg-secondary"} px-3 py-2`,children:s.active?"نشط":"غير نشط"}),n.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"companyActiveSwitch",name:"active",checked:s.active,onChange:H,style:{width:"50px",height:"25px",cursor:"pointer"}})]})})]})]}),n.jsx("div",{className:"modal-footer border-0 pt-0 pb-3 d-flex justify-content-center",children:n.jsxs("div",{className:"d-flex gap-3",children:[n.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:t,disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",border:"none"},children:u?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"spinner-border spinner-border-sm me-1",style:{width:"12px",height:"12px"}}),"حفظ..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),J?"تحديث":"حفظ"]})})]})})]})]})}),p&&n.jsx(wF,{show:p,onClose:()=>b(!1),title:"أوراق الشركة",documents:w,setDocuments:j,companyId:r?.id||"new",companyName:r?.name||"شركة جديدة",companyEmail:r?.email||""})]})};function NF(){const[r,e]=N.useState(!1),[t,s]=N.useState(!1),[a,l]=N.useState(null),[c,u]=N.useState(0),{isTimelineVisible:m}=$n(),p=()=>{e(!r)},b=()=>{l(null),s(!0)},w=O=>{l(O),s(!0)},j=()=>{s(!1),l(null),u(O=>O+1)},D=()=>{s(!1),l(null)};return n.jsx(sn,{children:n.jsx(rn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Kn,{onToggle:p}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!m?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"الشركات"})]})}),n.jsx(Yn,{}),n.jsx("div",{className:"app-content-area p-3",children:n.jsx("div",{className:"suppliers-table",children:n.jsx(yF,{onAdd:b,onEdit:w,refreshTrigger:c})})})]}),n.jsx("div",{className:"app-footer",style:{position:"fixed",bottom:0,left:0,right:0,textAlign:"center",padding:"10px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",zIndex:10},children:n.jsx("span",{children:"© Modern Bin 2025"})})]}),!r&&m&&n.jsx(Xn,{rtl:!0}),!r&&m&&n.jsx(Jn,{}),t&&n.jsx("div",{className:"company-form",children:n.jsx(vF,{company:a,onSave:j,onCancel:D})})]})})})}function jF(){return n.jsx(NF,{})}const Ba="employees",Ob="documents",od=()=>{const r=new Date,e=r.getFullYear(),t=String(r.getMonth()+1).padStart(2,"0"),s=String(r.getDate()).padStart(2,"0"),a=Math.floor(Math.random()*9999).toString().padStart(4,"0");return`EMP-${e}${t}${s}-${a}`};class Mu{static async getAllEmployees(e={}){try{console.log("🔄 Fetching all employees from Firestore...");const{search:t,filters:s={},sort:a="updatedAt",page:l=1,limit:c=30}=e;let u=[];try{a==="name"?u.push(hs("fullName","asc")):a==="hireDate"?u.push(hs("hireDate","desc")):u.push(hs("createdAt","desc"))}catch(D){console.warn("⚠️ Sorting failed, using basic query:",D.message),u=[]}const m=await qo.secureGetDocs(Ba,u);console.log("📊 Firestore query results:",m.size,"documents");let p=m.docs.map(D=>{const O=D.data();return console.log("📄 Processing employee document:",D.id,O.fullName||"Unknown"),{id:D.id,internalId:O.internalId||od(),...O,createdAt:O.createdAt?.toDate(),updatedAt:O.updatedAt?.toDate(),hireDate:O.hireDate?.toDate()}});if(console.log("✅ Processed employees:",p.length,"total"),t&&t.trim()){const D=t.toLowerCase();p=p.filter(O=>O.fullName?.toLowerCase().includes(D)||O.department?.toLowerCase().includes(D)||O.jobTitle?.toLowerCase().includes(D)||O.email?.toLowerCase().includes(D)||O.phone?.includes(t)||O.nationalId?.includes(t))}s.department&&s.department!=="all"&&(p=p.filter(D=>D.department===s.department)),s.status&&s.status!=="all"&&(p=p.filter(D=>D.status===s.status));const b=(l-1)*c,w=b+c;return{employees:p.slice(b,w),totalCount:p.length,totalPages:Math.ceil(p.length/c),currentPage:l}}catch(t){throw console.error("Error fetching employees:",t),new Error("فشل في جلب بيانات الموظفين")}}static async createEmployee(e){try{if(!e.email||!e.email.trim())throw new Error("البريد الإلكتروني مطلوب لإنشاء حساب الموظف");if(!e.nationalId||!e.nationalId.trim())throw new Error("كلمة المرور مطلوبة لإنشاء حساب الموظف");let t=od(),s=0;for(;s<5&&await this.getEmployeeByInternalId(t);)t=od(),s++;if(s===5)throw new Error("فشل في توليد معرف فريد للموظف");console.log("🔄 Creating Firebase Auth user for employee...");const a=await b3(Yt,e.email.trim(),e.nationalId),l=a.user.uid;console.log("✅ Firebase Auth user created:",l),await N3(a.user,{displayName:e.fullName});const c={...e,internalId:t,status:e.status||"active",role:e.role||"employee",hireDate:e.hireDate?new Date(e.hireDate):new Date,createdAt:vt(),updatedAt:vt()};return await qo.createEmployeeDoc(c,l),console.log("✅ Employee document created with UID:",l),{id:l,internalId:t,uid:l}}catch(t){throw console.error("Error creating employee:",t),t.code==="auth/email-already-in-use"?new Error("البريد الإلكتروني مستخدم بالفعل"):t.code==="auth/invalid-email"?new Error("صيغة البريد الإلكتروني غير صحيحة"):t.code==="auth/weak-password"?new Error("كلمة المرور ضعيفة جداً - يجب أن تكون 6 أحرف على الأقل"):new Error(t.message||"فشل في إنشاء الموظف")}}static async updateEmployee(e,t){try{const s={...t};t.hireDate&&(s.hireDate=new Date(t.hireDate));const a=Yt.currentUser?.uid;return e===a?await qo.updateOwnEmployeeDoc(s):await qo.secureUpdateDoc(Ba,e,s),!0}catch(s){throw console.error("Error updating employee:",s),new Error("فشل في تحديث بيانات الموظف")}}static async getEmployeeById(e){try{const t=Yt.currentUser?.uid;let s;if(e===t?s=await qo.getOwnEmployeeDoc():s=await qo.secureGetDoc(Ba,e),s.exists()){const a=s.data();return{id:s.id,internalId:a.internalId||od(),...a,createdAt:a.createdAt?.toDate(),updatedAt:a.updatedAt?.toDate(),hireDate:a.hireDate?.toDate()}}else return null}catch(t){throw console.error("Error fetching employee by ID:",t),new Error("فشل في جلب بيانات الموظف")}}static async getEmployeeByInternalId(e){try{const t=ct(De,Ba),s=Vt(t,jn("internalId","==",e)),a=await St(s);if(a.empty)return null;{const l=a.docs[0],c=l.data();return{id:l.id,internalId:c.internalId,...c,createdAt:c.createdAt?.toDate(),updatedAt:c.updatedAt?.toDate(),hireDate:c.hireDate?.toDate()}}}catch(t){throw console.error("Error fetching employee by internal ID:",t),new Error("فشل في جلب بيانات الموظف")}}static async updateEmployeeByInternalId(e,t){try{const s=await this.getEmployeeByInternalId(e);if(!s)throw new Error("الموظف غير موجود");return await this.updateEmployee(s.id,t)}catch(s){throw console.error("Error updating employee by internal ID:",s),new Error("فشل في تحديث بيانات الموظف")}}static async deleteEmployee(e){try{const t=ut(De,Ba,e);return await Js(t),!0}catch(t){throw console.error("Error deleting employee:",t),new Error("فشل في حذف الموظف")}}static async deleteEmployeeByInternalId(e){try{const t=await this.getEmployeeByInternalId(e);if(!t)throw new Error("الموظف غير موجود");return await this.deleteEmployee(t.id)}catch(t){throw console.error("Error deleting employee by internal ID:",t),new Error("فشل في حذف الموظف")}}static async searchEmployees(e){try{const t=ct(De,Ba);return(await St(t)).docs.map(c=>{const u=c.data();return{id:c.id,internalId:u.internalId||od(),...u,createdAt:u.createdAt?.toDate(),updatedAt:u.updatedAt?.toDate(),hireDate:u.hireDate?.toDate()}}).filter(c=>c.fullName?.toLowerCase().includes(e.toLowerCase())||c.department?.toLowerCase().includes(e.toLowerCase())||c.jobTitle?.toLowerCase().includes(e.toLowerCase())||c.email?.toLowerCase().includes(e.toLowerCase())||c.phone?.includes(e)||c.nationalId?.includes(e))}catch(t){throw console.error("Error searching employees:",t),new Error("فشل في البحث عن الموظفين")}}static async uploadEmployeeFile(e,t,s=null){try{const a=qo.getCurrentUserUID(),l=s||t.name,c=Date.now(),u=`uploads/employee_${e}_${c}_${l}`,m=Qo(ri,u),p=await ex(m,t),b=await Jm(p.ref),w=await this.getEmployeeByInternalId(e);if(!w)throw new Error("الموظف غير موجود");const j={name:l,originalName:t.name,path:u,url:b,type:t.type,size:t.size,uploadedBy:a,uploadedAt:new Date().toISOString()};await qo.validateActiveEmployee();const D=ct(De,Ba,w.id,Ob);return{id:(await Mr(D,j)).id,url:b,path:u,...j}}catch(a){throw console.error("Error uploading employee file:",a),new Error("فشل في رفع الملف")}}static async listEmployeeFiles(e){try{const t=await this.getEmployeeByInternalId(e);if(!t)throw new Error("الموظف غير موجود");const s=ct(De,Ba,t.id,Ob);return(await St(s)).docs.map(l=>{const c=l.data();return{id:l.id,...c,uploadedAt:c.uploadedAt?.toDate()}})}catch(t){throw console.error("Error listing employee files:",t),new Error("فشل في جلب ملفات الموظف")}}static async deleteEmployeeFile(e,t){try{const s=await this.getEmployeeByInternalId(e);if(!s)throw new Error("الموظف غير موجود");const a=ut(De,Ba,s.id,Ob,t),l=await cs(a);if(!l.exists())throw new Error("الملف غير موجود");const c=l.data(),u=Qo(ri,c.path);return await Vx(u),await Js(a),!0}catch(s){throw console.error("Error deleting employee file:",s),new Error("فشل في حذف الملف")}}static async getDepartments(){try{const e=ct(De,Ba),t=await St(e),s=new Set;return t.docs.forEach(a=>{const l=a.data();l.department&&s.add(l.department)}),Array.from(s).sort()}catch(e){throw console.error("Error fetching departments:",e),new Error("فشل في جلب الأقسام")}}static validateEmployeeData(e){const t={};if(e.fullName?.trim()||(t.fullName="الاسم الكامل مطلوب"),e.email&&e.email.trim()&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(t.email="صيغة البريد الإلكتروني غير صحيحة")),e.phone&&e.phone.trim()&&(/^[\+\d\-\s\(\)]+$/.test(e.phone)||(t.phone="صيغة رقم الهاتف غير صحيحة")),e.salary&&e.salary!==""){const s=parseFloat(e.salary);(isNaN(s)||s<0)&&(t.salary="الراتب يجب أن يكون رقماً موجباً")}return t}static async migrateExistingData(){try{console.log("Starting employees migration...");const t=(await this.getAllEmployees({limit:1e3})).employees;let s=0;for(const a of t)if(!a.internalId||!a.internalId.startsWith("EMP-")){const l=od();await this.updateEmployee(a.id,{...a,internalId:l}),s++,console.log(`Migrated employee: ${a.fullName} -> ${l}`)}return console.log(`Migration completed. ${s} employees migrated.`),{success:!0,migratedCount:s}}catch(e){throw console.error("Error during migration:",e),new Error("فشل في ترحيل البيانات")}}}const _F=Object.freeze(Object.defineProperty({__proto__:null,EmployeeService:Mu,generateEmployeeId:od},Symbol.toStringTag,{value:"Module"})),EF=({onEdit:r,onAdd:e,onView:t,refreshTrigger:s})=>{const[a,l]=N.useState([]),[c,u]=N.useState(!0),[m,p]=N.useState(null),[b,w]=N.useState(""),[j,D]=N.useState([]),[O,Q]=N.useState(!1),{logActivity:z,getCurrentUser:I}=vn(),{alertConfig:ee,closeAlert:J,showSuccess:oe,showError:Y,showConfirm:be}=Pn(),{currentPage:M,totalPages:H,paginatedItems:k,handlePageChange:$,resetPage:X,totalItems:te,itemsPerPage:F}=wa(j,30);N.useEffect(()=>{ce()},[]),N.useEffect(()=>{s&&ce()},[s]),N.useEffect(()=>{Be()},[a,b]);const ce=async()=>{try{u(!0),p(null);const E=await Mu.getAllEmployees({limit:1e3});l(E.employees||[])}catch(E){console.error("Error loading employees:",E),p(E.message),Y(E.message,"خطأ في التحميل")}finally{u(!1)}},Be=()=>{let E=[...a];if(b.trim()){const R=b.toLowerCase();E=E.filter(V=>V.fullName?.toLowerCase().includes(R)||V.department?.toLowerCase().includes(R)||V.jobTitle?.toLowerCase().includes(R)||V.email?.toLowerCase().includes(R)||V.phone?.includes(b)||V.nationalId?.includes(b))}D(E),X()},U=E=>{be(`هل أنت متأكد من حذف الموظف؟

${E.fullName}

سيتم نقل البيانات إلى المهملات ويمكن استعادتها لاحقاً.`,()=>se(E),"تأكيد حذف الموظف")},se=async E=>{try{Q(!0),await Gn.moveToTrash(E,"employees"),await Mu.deleteEmployee(E.id);const R=I();z("task",`${R.name} حذف موظف`,`تم حذف الموظف: ${E.fullName}`),await ce(),oe(`تم نقل الموظف للمهملات: ${E.fullName}`,"تم النقل للمهملات")}catch(R){p(R.message),Y(`فشل في نقل الموظف للمهملات: ${R.message}`,"خطأ في النقل")}finally{Q(!1)}},fe=E=>E?`${parseFloat(E).toLocaleString("en-US")} ريال`:"غير محدد",ie=E=>{if(!E)return"غير محدد";const R=new Date(E),V=String(R.getDate()).padStart(2,"0"),ne=String(R.getMonth()+1).padStart(2,"0"),B=R.getFullYear();return`${V}/${ne}/${B}`},_=E=>{const R={active:{class:"bg-light text-dark",text:"نشط"},inactive:{class:"bg-light text-dark",text:"غير نشط"}},V=R[E]||R.active;return n.jsx("span",{className:`badge ${V.class}`,children:V.text})};return c?n.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"400px"},children:n.jsx(Dn,{size:"large"})}):n.jsxs("div",{className:"card shadow-sm","data-list":"employees",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-person-badge-fill text-primary me-2"}),"قائمة الموظفين (",j.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center",style:{gap:"25px"},children:[n.jsxs("div",{className:"input-group employees-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في الموظفين...",value:b,onChange:E=>w(E.target.value),style:{borderRadius:"0 8px 8px 0",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"8px 0 0 8px",borderRight:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted"})})]}),n.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:e,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-plus-circle-fill me-2"}),"إضافة موظف جديد"]})]})})]})}),n.jsxs("div",{className:"card-body p-0",children:[m&&n.jsxs("div",{className:"alert alert-danger m-4",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),m]}),!m&&j.length===0?n.jsxs("div",{className:"text-center py-5",children:[n.jsx("div",{className:"text-muted mb-3",children:n.jsx("i",{className:"bi bi-person-x",style:{fontSize:"3rem"}})}),n.jsx("h5",{className:"text-muted",children:"لا توجد موظفين"}),n.jsx("p",{className:"text-muted",children:b?"لا توجد نتائج تطابق البحث المحدد":"لم يتم إضافة أي موظفين بعد"}),!b&&n.jsxs("button",{className:"btn btn-primary",onClick:e,children:[n.jsx("i",{className:"bi bi-plus-circle me-1"}),"إضافة أول موظف"]})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover custom-striped mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",style:{width:"60px"},children:"#"}),n.jsx("th",{className:"text-center",children:"الاسم الكامل"}),n.jsx("th",{className:"text-center",children:"رقم الهاتف"}),n.jsx("th",{className:"text-center",children:"البريد الإلكتروني"}),n.jsx("th",{className:"text-center",children:"الراتب"}),n.jsx("th",{className:"text-center",children:"الحالة"}),n.jsx("th",{className:"text-center",children:"تاريخ التوظيف"}),n.jsx("th",{className:"text-center",style:{width:"120px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:k.map((E,R)=>n.jsxs("tr",{style:{backgroundColor:((M-1)*F+R)%2===0?"#ffffff":"#f8f9fa"},children:[n.jsx("td",{className:"text-center fw-bold text-muted",children:(M-1)*F+R+1}),n.jsx("td",{className:"text-center",children:n.jsx("div",{className:"d-flex align-items-center justify-content-center",children:n.jsx("div",{children:n.jsx("div",{className:"fw-bold text-primary",style:{cursor:"pointer",textDecoration:"underline"},onClick:()=>t&&t(E),title:"عرض تفاصيل الموظف",children:E.fullName})})})}),n.jsx("td",{className:"text-center",children:E.phone||"غير محدد"}),n.jsx("td",{className:"text-center",children:E.email||"غير محدد"}),n.jsx("td",{className:"text-center",children:n.jsx("span",{className:"fw-bold text-success",children:fe(E.salary)})}),n.jsx("td",{className:"text-center",children:_(E.status)}),n.jsx("td",{className:"text-center",children:n.jsx("small",{className:"text-muted",children:ie(E.hireDate)})}),n.jsx("td",{className:"text-center",children:n.jsxs("div",{className:"btn-group btn-group-sm",children:[n.jsx("button",{className:"btn btn-outline-primary",onClick:()=>t&&t(E),title:"عرض التفاصيل",style:{width:"32px",height:"32px",padding:"0",borderRadius:"6px 0 0 6px"},children:n.jsx("i",{className:"bi bi-eye"})}),n.jsx("button",{className:"btn btn-outline-danger",onClick:()=>U(E),title:"حذف",disabled:O,style:{width:"32px",height:"32px",padding:"0",borderRadius:"0 6px 6px 0"},children:n.jsx("i",{className:"bi bi-trash"})})]})})]},E.id))})]})}),H>1&&n.jsx("div",{className:"d-flex justify-content-center p-4",children:n.jsx(va,{currentPage:M,totalPages:H,onPageChange:$,totalItems:te,itemsPerPage:F})})]})]}),n.jsx(Rn,{show:ee.show,onClose:J,title:ee.title,message:ee.message,type:ee.type,onConfirm:ee.onConfirm,confirmText:ee.confirmText,cancelText:ee.cancelText,showCancel:ee.showCancel})]})};class ug{static COLLECTION_NAME="employee_documents";static async uploadDocument(e,t,s){try{console.log("📤 Uploading employee document:",e.name,"for employee:",t),_r.validateFile(e,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]});const a=await _r.uploadFile(e,"employee-documents"),l={fileName:s.trim(),originalFileName:e.name,fileURL:a.url,storagePath:a.path,fileSize:e.size,fileType:e.type,employeeId:t||"new",ownerId:a.uploadedBy||"unknown",uploadedAt:vt(),createdAt:vt(),updatedAt:vt()},c=await Mr(ct(De,this.COLLECTION_NAME),l);return console.log("✅ Employee document uploaded successfully:",c.id),{id:c.id,...l,uploadedAt:new Date().toISOString(),createdAt:new Date().toISOString()}}catch(a){throw console.error("❌ Error uploading employee document:",a),new Error(`فشل في رفع الوثيقة: ${a.message}`)}}static async getEmployeeDocuments(e){try{if(console.log("📋 Loading documents for employee:",e),!e||e==="new")return console.log("⚠️ No employee ID provided, returning empty array"),[];let t;try{const a=Vt(ct(De,this.COLLECTION_NAME),jn("employeeId","==",e),hs("uploadedAt","desc"));t=await St(a)}catch(a){console.warn("⚠️ OrderBy query failed (missing index), trying simple where query:",a.message);const l=Vt(ct(De,this.COLLECTION_NAME),jn("employeeId","==",e));t=await St(l)}const s=[];return t.forEach(a=>{const l=a.data();s.push({id:a.id,...l,uploadedAt:l.uploadedAt?.toDate?.()||new Date,createdAt:l.createdAt?.toDate?.()||new Date})}),s.sort((a,l)=>new Date(l.uploadedAt)-new Date(a.uploadedAt)),console.log("✅ Loaded employee documents:",s.length),s}catch(t){if(console.error("❌ Error loading employee documents:",t),t.code==="permission-denied"||t.code==="not-found")return console.log("📋 Collection not accessible or doesn't exist, returning empty array"),[];throw new Error(`فشل في تحميل الوثائق: ${t.message}`)}}static async deleteDocument(e){try{console.log("🗑️ Deleting employee document:",e);const t=ut(De,this.COLLECTION_NAME,e),s=await cs(t);if(!s.exists())throw new Error("الوثيقة غير موجودة");const a=s.data();if(a.storagePath)try{await _r.deleteFile(a.storagePath),console.log("✅ File deleted from storage:",a.storagePath)}catch(l){console.warn("⚠️ Error deleting from storage (non-critical):",l.message)}return await Js(t),console.log("✅ Employee document deleted successfully"),!0}catch(t){throw console.error("❌ Error deleting employee document:",t),new Error(`فشل في حذف الوثيقة: ${t.message}`)}}static async updateDocument(e,t){try{console.log("📝 Updating employee document:",e);const s=ut(De,this.COLLECTION_NAME,e),a={...t,updatedAt:vt()};return await Xs(s,a),console.log("✅ Employee document updated successfully"),!0}catch(s){throw console.error("❌ Error updating employee document:",s),new Error(`فشل في تحديث الوثيقة: ${s.message}`)}}static async transferDocuments(e,t){try{console.log("🔄 Transferring documents from:",e,"to:",t);const s=await this.getEmployeeDocuments(e);if(s.length===0)return console.log("⚠️ No documents to transfer"),[];const a=s.map(l=>this.updateDocument(l.id,{employeeId:t}));return await Promise.all(a),console.log("✅ Documents transferred successfully:",s.length),s}catch(s){throw console.error("❌ Error transferring documents:",s),new Error(`فشل في نقل الوثائق: ${s.message}`)}}static async getAllDocuments(){try{console.log("📋 Loading all employee documents");const e=Vt(ct(De,this.COLLECTION_NAME),hs("uploadedAt","desc")),t=await St(e),s=[];return t.forEach(a=>{const l=a.data();s.push({id:a.id,...l,uploadedAt:l.uploadedAt?.toDate?.()||new Date,createdAt:l.createdAt?.toDate?.()||new Date})}),console.log("✅ Loaded all employee documents:",s.length),s}catch(e){throw console.error("❌ Error loading all employee documents:",e),new Error(`فشل في تحميل جميع الوثائق: ${e.message}`)}}static validateDocumentData(e){const t={};return(!e.fileName||!e.fileName.trim())&&(t.fileName="اسم الملف مطلوب"),e.fileURL||(t.fileURL="رابط الملف مطلوب"),e.employeeId||(t.employeeId="معرف الموظف مطلوب"),t}}const Mb=({employee:r,onSave:e,onCancel:t})=>{const[s,a]=N.useState({fullName:"",jobTitle:"",department:"",phone:"",email:"",nationalId:"",status:"active",salary:"",hireDate:"",notes:""}),[l,c]=N.useState({}),[u,m]=N.useState(!1),[p,b]=N.useState(!1),[w,j]=N.useState([]),[D,O]=N.useState(!1),[Q,z]=N.useState(!1),[I,ee]=N.useState(null),[J,oe]=N.useState(""),[Y,be]=N.useState(!1),{logActivity:M,getCurrentUser:H}=vn(),{alertConfig:k,closeAlert:$,showSuccess:X,showError:te,showConfirm:F}=Pn(),ce=!!r;N.useEffect(()=>{r?(a({fullName:r.fullName||"",jobTitle:r.jobTitle||"",department:r.department||"",phone:r.phone||"",email:r.email||"",nationalId:r.nationalId||"",status:r.status||"active",salary:r.salary?r.salary.toString():"",hireDate:r.hireDate?ku(r.hireDate):"",notes:r.notes||""}),Be()):j([])},[r]);const Be=async()=>{if(!r?.id||r.id==="new"){j([]);return}try{console.log("📋 Loading documents for employee:",r.id);const B=await ug.getEmployeeDocuments(r.id);j(B),console.log("✅ Loaded employee documents:",B.length)}catch(B){console.error("❌ Error loading employee documents:",B),j([])}},U=B=>{const{name:q,value:me}=B.target;a(C=>({...C,[q]:me})),l[q]&&c(C=>({...C,[q]:""}))},se=async()=>{const B=Mu.validateEmployeeData(s),q={};s.email&&s.email.trim()&&(q.email=s.email.trim());try{const me=await oo.validateUniqueFields(q,ce?r.id:null,"employees"),C={...B,...me};return c(C),Object.keys(C).length===0}catch(me){return console.error("Validation error:",me),c(B),Object.keys(B).length===0}},fe=async B=>{if(B.preventDefault(),!(u||!await se())){m(!0);try{const me={...s,salary:s.salary?parseFloat(s.salary):null,hireDate:s.hireDate?new Date(s.hireDate):new Date};let C;const Z=H();if(ce)await Mu.updateEmployee(r.id,me),C={...r,...me},M("task",`${Z.name} عدل موظف`,`تم تعديل بيانات الموظف: ${s.fullName}`),X("تم تحديث بيانات الموظف بنجاح","تم التحديث");else{const je=await Mu.createEmployee(me);if(C={...me,id:je.id,internalId:je.internalId},w.length>0)try{console.log("📄 Transferring documents to new employee:",je.id);const Ge=w.map(Ke=>({...Ke,employeeId:je.id,employeeName:s.fullName,employeeEmail:s.email}));for(const Ke of Ge)try{const ft=new File([""],Ke.originalFileName,{type:Ke.fileType});Object.defineProperty(ft,"name",{value:Ke.originalFileName}),Object.defineProperty(ft,"size",{value:Ke.fileSize}),Object.defineProperty(ft,"type",{value:Ke.fileType});const Ot=await ug.uploadDocument(ft,je.id,Ke.fileName);Ot.fileURL=Ke.fileURL,Ot.storagePath=Ke.storagePath,console.log("✅ Document transferred to Firebase:",Ke.fileName)}catch(ft){console.warn("⚠️ Failed to save document to Firebase:",Ke.fileName,ft.message)}console.log("✅ All documents transferred successfully")}catch(Ge){console.warn("⚠️ Document transfer failed:",Ge.message)}M("task",`${Z.name} أضاف موظف`,`تم إضافة موظف جديد: ${s.fullName}`),X("تم إضافة الموظف بنجاح","تمت الإضافة")}e&&e(C)}catch(me){console.error("Error saving employee:",me),te(me.message||"فشل في حفظ بيانات الموظف","خطأ في الحفظ")}finally{m(!1)}}},ie=()=>{t&&t()},_=async B=>{const q=B.target.files[0];if(q){O(!0);try{try{_r.validateFile(q,{maxSize:10*1024*1024,allowedTypes:["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]})}catch(C){throw new Error(C.message)}console.log("📤 Uploading employee document:",q.name);const me=await _r.uploadFile(q,"employee-documents");ee({...me,originalFileName:q.name,fileSize:q.size,fileType:q.type}),oe(q.name.split(".")[0]),z(!0),B.target.value=""}catch(me){console.error("Error uploading employee document:",me),te(me.message||"فشل في رفع الملف","خطأ في الرفع"),B.target&&(B.target.value="")}finally{O(!1)}}},E=async()=>{if(!J.trim()){te("يرجى إدخال اسم الملف","اسم الملف مطلوب");return}if(!I){te("بيانات الملف غير متاحة","خطأ");return}try{O(!0),console.log("📤 Saving employee document via EmployeeDocumentService:",J);const B=new File([""],I.originalFileName,{type:I.fileType});Object.defineProperty(B,"name",{value:I.originalFileName}),Object.defineProperty(B,"size",{value:I.fileSize}),Object.defineProperty(B,"type",{value:I.fileType});const q={fileName:J.trim(),originalFileName:I.originalFileName,fileURL:I.url,storagePath:I.path,fileSize:I.fileSize,fileType:I.fileType,employeeId:r?.id||"new",employeeName:s.fullName||"موظف جديد",employeeEmail:s.email||"غير محدد",uploadedAt:new Date().toISOString(),createdAt:new Date().toISOString(),id:Date.now().toString()};if(r?.id&&r.id!=="new")try{const C=await ug.uploadDocument(B,r.id,J.trim());C.fileURL=I.url,C.storagePath=I.path,j(Z=>[...Z,C]),console.log("✅ Document saved to Firebase successfully")}catch(C){console.warn("⚠️ Firebase save failed, storing locally for now:",C.message),j(Z=>[...Z,q])}else console.log("📋 New employee - storing document locally until employee is saved"),j(C=>[...C,q]);X(`تم رفع الملف بنجاح: ${J}`,"تم الرفع");const me=H();M("file",`${me.name} رفع وثيقة موظف`,`تم رفع الملف: ${J} للموظف: ${s.fullName||"موظف جديد"}`),z(!1),ee(null),oe("")}catch(B){console.error("Error saving employee document:",B),te(`فشل في رفع الملف: ${B.message}`,"خطأ في الرفع")}finally{O(!1)}},R=()=>{console.log("User cancelled employee file upload"),z(!1),ee(null),oe("")},V=B=>{F(`هل أنت متأكد من حذف هذا الملف؟

${B.fileName}`,()=>ne(B),"تأكيد حذف الملف")},ne=async B=>{try{if(be(!0),r?.id&&r.id!=="new"&&!B.id.toString().startsWith("temp_"))try{await ug.deleteDocument(B.id),console.log("✅ Document deleted from Firebase")}catch(me){console.warn("⚠️ Firebase delete failed, removing locally:",me.message)}else try{await Gn.moveToTrash(B,"employee_documents"),console.log("✅ Document moved to trash")}catch(me){console.warn("⚠️ Trash service failed, removing locally only:",me.message)}j(me=>me.filter(C=>C.id!==B.id));const q=H();M("task",`${q.name} حذف وثيقة موظف`,`تم حذف الوثيقة: ${B.fileName} للموظف: ${s.fullName||"موظف"}`),X(`تم حذف الملف: ${B.fileName}`,"تم الحذف")}catch(q){te(`فشل في حذف الملف: ${q.message}`,"خطأ في الحذف")}finally{be(!1)}};return n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[n.jsx("div",{className:"d-flex align-items-center",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:`bi ${ce?"bi-pencil-square":"bi-person-plus-fill"} text-primary me-2`}),ce?"تعديل بيانات الموظف":"إضافة موظف جديد"]})}),n.jsx("div",{className:"d-flex gap-2",children:n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>b(!0),style:{height:"32px",width:"120px",fontSize:"12px",borderRadius:"6px",padding:"6px 12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:"وثائق الموظف"})})]})}),n.jsx("div",{className:"card-body",children:n.jsxs("form",{onSubmit:fe,children:[n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"الاسم الكامل *"}),n.jsx("input",{type:"text",className:`form-control ${l.fullName?"is-invalid":""}`,name:"fullName",value:s.fullName,onChange:U,placeholder:"أدخل الاسم الكامل",disabled:u,required:!0}),l.fullName&&n.jsx("div",{className:"invalid-feedback",children:l.fullName})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"المسمى الوظيفي"}),n.jsx("input",{type:"text",className:`form-control ${l.jobTitle?"is-invalid":""}`,name:"jobTitle",value:s.jobTitle,onChange:U,placeholder:"أدخل المسمى الوظيفي",disabled:u}),l.jobTitle&&n.jsx("div",{className:"invalid-feedback",children:l.jobTitle})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"القسم"}),n.jsx("input",{type:"text",className:`form-control ${l.department?"is-invalid":""}`,name:"department",value:s.department,onChange:U,placeholder:"أدخل اسم القسم",disabled:u}),l.department&&n.jsx("div",{className:"invalid-feedback",children:l.department})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"رقم الهاتف *"}),n.jsx("input",{type:"tel",className:`form-control ${l.phone?"is-invalid":""}`,name:"phone",value:s.phone,onChange:U,placeholder:"أدخل رقم الهاتف",disabled:u,required:!0}),l.phone&&n.jsx("div",{className:"invalid-feedback",children:l.phone})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"البريد الإلكتروني *"}),n.jsx("input",{type:"email",className:`form-control ${l.email?"is-invalid":""}`,name:"email",value:s.email,onChange:U,placeholder:"أدخل البريد الإلكتروني",disabled:u,required:!0}),l.email&&n.jsx("div",{className:"invalid-feedback",children:l.email})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"كلمة المرور *"}),n.jsx("input",{type:"password",className:`form-control ${l.nationalId?"is-invalid":""}`,name:"nationalId",value:s.nationalId,onChange:U,placeholder:"أدخل كلمة المرور",disabled:u,required:!0}),l.nationalId&&n.jsx("div",{className:"invalid-feedback",children:l.nationalId})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"الراتب (ريال)"}),n.jsx("input",{type:"number",className:`form-control ${l.salary?"is-invalid":""}`,name:"salary",value:s.salary,onChange:U,placeholder:"أدخل الراتب",min:"0",step:"0.01",disabled:u}),l.salary&&n.jsx("div",{className:"invalid-feedback",children:l.salary})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label",children:"تاريخ التوظيف *"}),n.jsx("input",{type:"date",className:`form-control ${l.hireDate?"is-invalid":""}`,name:"hireDate",value:s.hireDate,onChange:U,disabled:u,required:!0}),l.hireDate&&n.jsx("div",{className:"invalid-feedback",children:l.hireDate})]}),n.jsxs("div",{className:"col-md-6 mb-3",children:[n.jsx("label",{className:"form-label fw-bold",children:"الحالة"}),n.jsxs("div",{className:"d-flex gap-2 mt-2",children:[n.jsxs("button",{type:"button",className:`btn ${s.status==="active"?"btn-primary":"btn-outline-secondary"}`,onClick:()=>U({target:{name:"status",value:"active"}}),disabled:u,style:{minWidth:"80px",height:"38px",fontSize:"14px",borderRadius:"6px"},children:[s.status==="active"&&n.jsx("i",{className:"bi bi-check me-1"}),"نشط"]}),n.jsxs("button",{type:"button",className:`btn ${s.status==="inactive"?"btn-success":"btn-outline-secondary"}`,onClick:()=>U({target:{name:"status",value:"inactive"}}),disabled:u,style:{minWidth:"80px",height:"38px",fontSize:"14px",borderRadius:"6px"},children:[s.status==="inactive"&&n.jsx("i",{className:"bi bi-check me-1"}),"غير نشط"]})]}),l.status&&n.jsx("div",{className:"invalid-feedback d-block",children:l.status})]}),n.jsxs("div",{className:"col-12 mb-3",children:[n.jsx("label",{className:"form-label",children:"ملاحظات"}),n.jsx("textarea",{className:`form-control ${l.notes?"is-invalid":""}`,name:"notes",value:s.notes,onChange:U,rows:"4",placeholder:"أدخل ملاحظات إضافية...",disabled:u}),l.notes&&n.jsx("div",{className:"invalid-feedback",children:l.notes})]})]}),n.jsx("div",{className:"row",children:n.jsxs("div",{className:"col-12 d-flex justify-content-center gap-3 mt-4 mb-2",children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:ie,disabled:u,style:{height:"32px",width:"80px",fontSize:"14px",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center"},children:"إلغاء"}),n.jsx("button",{type:"submit",className:"btn btn-primary",disabled:u,style:{height:"32px",width:"80px",fontSize:"14px",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center"},children:u?n.jsxs(n.Fragment,{children:[n.jsx(Dn,{size:"small"}),n.jsx("span",{className:"ms-2",children:ce?"تحديث...":"حفظ..."})]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:`bi ${ce?"bi-check-lg":"bi-plus-circle"} me-1`}),ce?"تحديث":"حفظ"]})})]})})]})}),n.jsx(Rn,{show:k.show,onClose:$,title:k.title,message:k.message,type:k.type,onConfirm:k.onConfirm,confirmText:k.confirmText,cancelText:k.cancelText,showCancel:k.showCancel}),n.jsx(rv,{show:p,onClose:()=>b(!1),documents:w,setDocuments:j,tenderId:r?.id||"new",uploadingDocument:D,setUploadingDocument:O,handleDocumentUpload:_,handleDeleteClick:V,deleting:Y,title:"وثائق الموظف"}),Q&&n.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.7)",zIndex:1060},tabIndex:"-1",dir:"rtl",children:n.jsx("div",{className:"modal-dialog modal-dialog-centered",children:n.jsxs("div",{className:"modal-content",style:{borderRadius:"12px",border:"none",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[n.jsx("div",{className:"modal-header text-white",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",borderRadius:"12px 12px 0 0"},children:n.jsxs("h5",{className:"modal-title fw-bold",children:[n.jsx("i",{className:"bi bi-pencil-square me-2"}),"تسمية الملف"]})}),n.jsx("div",{className:"modal-body",style:{padding:"25px"},children:n.jsxs("div",{className:"mb-4",children:[n.jsxs("div",{className:"d-flex align-items-center mb-3",children:[n.jsx("div",{className:"bg-success bg-opacity-10 p-2 rounded-circle me-3",children:n.jsx("i",{className:"bi bi-file-earmark-check text-success"})}),n.jsxs("div",{children:[n.jsx("h6",{className:"mb-0 fw-bold text-success",children:"تم رفع الملف بنجاح"}),n.jsx("small",{className:"text-muted",children:I?.originalFileName})]})]}),n.jsxs("div",{className:"mb-3",children:[n.jsxs("label",{className:"form-label fw-bold text-primary",children:[n.jsx("i",{className:"bi bi-tag me-1"}),"اسم الملف المخصص *"]}),n.jsx("input",{type:"text",className:"form-control",value:J,onChange:B=>oe(B.target.value),placeholder:"أدخل اسم الملف المخصص",style:{borderRadius:"8px",border:"2px solid #e9ecef",padding:"12px 16px",fontSize:"14px"},onFocus:B=>{B.target.style.borderColor="#28a745",B.target.style.boxShadow="0 0 0 0.2rem rgba(40, 167, 69, 0.25)"},onBlur:B=>{B.target.style.borderColor="#e9ecef",B.target.style.boxShadow="none"},autoFocus:!0}),n.jsxs("small",{className:"text-muted",children:[n.jsx("i",{className:"bi bi-info-circle me-1"}),"سيتم استخدام هذا الاسم لعرض الملف في قائمة الوثائق"]})]})]})}),n.jsx("div",{className:"modal-footer bg-light",style:{borderRadius:"0 0 12px 12px",padding:"20px"},children:n.jsxs("div",{className:"d-flex justify-content-end",style:{gap:"12px"},children:[n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:R,style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500"},children:"إلغاء"}),n.jsxs("button",{type:"button",className:"btn btn-success",onClick:E,disabled:!J.trim(),style:{height:"38px",width:"90px",borderRadius:"8px",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",fontWeight:"500",opacity:J.trim()?1:.6},children:[n.jsx("i",{className:"bi bi-check-lg me-1"}),"حفظ"]})]})})]})})})]})};function SF(){ms();const[r,e]=N.useState(!1),[t,s]=N.useState("list"),[a,l]=N.useState(null),[c,u]=N.useState(0),{isTimelineVisible:m}=$n(),p=()=>{e(!r)},b=()=>{l(null),s("add")},w=I=>{l(I),s("edit")},j=I=>{l(I),s("view")},D=()=>{s("list"),l(null),u(I=>I+1)},O=()=>{D()},Q=()=>{switch(t){case"add":return n.jsx(Mb,{onSave:O,onCancel:D});case"edit":return n.jsx(Mb,{employee:a,onSave:O,onCancel:D});case"view":return n.jsx(Mb,{employee:a,onSave:O,onCancel:D});case"list":default:return n.jsx(EF,{onEdit:w,onAdd:b,onView:j,refreshTrigger:c})}},z=()=>{const I=[{text:"الرئيسية",href:"/"},{text:"الموارد البشرية",href:"/employees"}];switch(t){case"add":I.push({text:"إضافة موظف جديد",active:!0});break;case"edit":I.push({text:"تعديل موظف",active:!0});break;case"view":I.push({text:"عرض بيانات الموظف",active:!0});break;default:I.push({text:"الموظفون",active:!0});break}return I};return n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Kn,{onToggle:p}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!m?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsx("ol",{className:"breadcrumb m-0",children:z().map((I,ee)=>n.jsx("li",{className:`breadcrumb-item ${I.active?"text-secondary":""}`,...I.active&&{"aria-current":"page"},children:I.active?I.text:n.jsxs("a",{href:I.href,className:"text-decoration-none d-flex align-items-center",children:[ee===0&&n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:I.text})]})},ee))})}),n.jsx(Yn,{}),n.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:n.jsxs("div",{className:"app-content-area p-4",style:{paddingBottom:"80px"},children:[t!=="list"&&n.jsx("div",{className:"mb-3 d-flex justify-content-end",children:n.jsxs("button",{className:"btn btn-primary shadow-sm px-4",onClick:D,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-arrow-right",style:{marginRight:"5px"}}),"العودة للقائمة"]})}),Q()]})}),!r&&m&&n.jsx(Xn,{rtl:!0}),!r&&m&&n.jsx(Jn,{})]})]})]})}function IF(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(SF,{})})})}const TF=()=>{const[r,e]=N.useState([]),[t,s]=N.useState([]),[a,l]=N.useState(!0),[c,u]=N.useState(""),[m,p]=N.useState(""),[b,w]=N.useState(""),{logActivity:j,getCurrentUser:D}=vn(),{alertConfig:O,closeAlert:Q,showSuccess:z,showError:I,showConfirm:ee}=Pn(),{currentPage:J,totalPages:oe,paginatedItems:Y,handlePageChange:be,resetPage:M,totalItems:H,itemsPerPage:k}=wa(t,30);N.useEffect(()=>{$()},[]),N.useEffect(()=>{if(b.trim()){const ce=r.filter(Be=>{const U=Gn.getItemDisplayInfo(Be),se=b.toLowerCase();return U.displayName?.toLowerCase().includes(se)||U.email?.toLowerCase().includes(se)||U.phone?.includes(b)||U.supplierName?.toLowerCase().includes(se)||U.category?.toLowerCase().includes(se)||U.contextName?.toLowerCase().includes(se)||U.price?.toLowerCase().includes(se)||U.name?.toLowerCase().includes(se)||Be.originalCollection?.toLowerCase().includes(se)});s(ce)}else s(r);M()},[b,r,M]);const $=async()=>{try{l(!0),u("");const ce=await Gn.getAllTrashItems();e(ce),s(ce)}catch(ce){u(ce.message)}finally{l(!1)}},X=async(ce,Be)=>{try{p(ce),u("");const U=r.find(ie=>ie.id===ce);if(U&&U.originalCollection==="tenderItems"){const ie=U.tenderContext?.tenderTitle||"مناقصة غير محددة",_=U.tenderContext?.tenderId||"new";ee(`هل أنت متأكد من استعادة هذا البند؟

البند: ${Be}
سيتم استعادته إلى: ${ie}`,async()=>{try{e(R=>R.filter(V=>V.id!==ce)),await Gn.restoreItem(ce);const E=D();j("task",`${E.name} استعاد بند مناقصة من المهملات`,`تم استعادة البند: ${Be} للمناقصة: ${ie}`),z(`تم استعادة البند بنجاح إلى المناقصة: ${ie}`,"تمت الاستعادة"),setTimeout($,1e3)}catch(E){console.error("Error restoring tender item:",E),e(R=>[...R,U]),I(`فشل في استعادة البند: ${E.message}`,"خطأ في الاستعادة")}finally{p("")}},"تأكيد استعادة بند المناقصة"),p("");return}e(ie=>ie.filter(_=>_.id!==ce)),await Gn.restoreItem(ce);const se=D(),fe=Gn.getItemDisplayInfo(U).name;j("task",`${se.name} استعاد ${fe} من المهملات`,`تم استعادة ${fe}: ${Be}`),setTimeout(async()=>{await $()},500),z(`تم استعادة العنصر بنجاح: ${Be}`,"تم الاستعادة بنجاح")}catch(U){console.error("Restore error:",U),u(U.message),I(`فشل في الاستعادة: ${U.message}`,"خطأ في الاستعادة"),await $()}finally{p("")}},te=(ce,Be)=>{ee(`هل تريد حذف "${Be}" نهائياً؟
لا يمكن التراجع عن هذا الإجراء!`,async()=>{try{p(ce),u(""),e(ie=>ie.filter(_=>_.id!==ce)),await Gn.permanentlyDelete(ce);const U=D(),se=r.find(ie=>ie.id===ce),fe=Gn.getItemDisplayInfo(se).name;j("task",`${U.name} حذف ${fe} نهائياً من المهملات`,`تم حذف ${fe} نهائياً: ${Be}`),setTimeout(async()=>{await $()},500),z(`تم حذف العنصر نهائياً: ${Be}`,"تم الحذف بنجاح")}catch(U){console.error("Permanent delete error:",U),u(U.message),I(`فشل في الحذف: ${U.message}`,"خطأ في الحذف"),await $()}finally{p("")}},"تأكيد الحذف النهائي")},F=()=>{ee(`⚠️ تحذير: هل تريد مسح جميع سجلات المهملات نهائياً؟
هذا سيحذف جميع السجلات بما في ذلك التكرارات والبيانات الفاسدة.
لا يمكن التراجع عن هذا الإجراء!`,async()=>{try{l(!0),e([]),await Gn.clearAllTrashRecords();const ce=D();j("task",`${ce.name} مسح جميع سجلات المهملات`,"تم مسح جميع السجلات من قاعدة البيانات"),await $(),z("تم مسح جميع سجلات المهملات بنجاح","تم المسح بنجاح")}catch(ce){u(ce.message),I(`فشل في مسح السجلات: ${ce.message}`,"خطأ في المسح"),await $()}finally{l(!1)}},"تحذير - مسح جميع السجلات")};return n.jsxs("div",{className:"trash-list",children:[n.jsxs("div",{className:"card shadow-sm",children:[n.jsxs("div",{className:"card-header bg-white border-bottom py-4",children:[n.jsxs("div",{className:"row align-items-center justify-content-between",children:[n.jsx("div",{className:"col-lg-4",children:n.jsxs("h5",{className:"mb-0 fw-bold",children:[n.jsx("i",{className:"bi bi-trash text-danger me-2"}),"سلة المهملات (",t.length,")"]})}),n.jsx("div",{className:"col-lg-8",children:n.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[n.jsxs("div",{className:"input-group trash-search",style:{maxWidth:"350px"},children:[n.jsx("input",{type:"text",className:"form-control shadow-sm border-1",placeholder:"البحث في المهملات...",value:b,onChange:ce=>w(ce.target.value),style:{borderRadius:"8px 0 0 8px",fontSize:"14px",height:"44px"}}),n.jsx("span",{className:"input-group-text bg-light border-1",style:{borderRadius:"0 8px 8px 0",borderLeft:"1px solid #dee2e6"},children:n.jsx("i",{className:"bi bi-search text-muted"})})]}),r.length>0&&n.jsxs("button",{className:"btn btn-danger shadow-sm px-4",onClick:F,disabled:a,style:{borderRadius:"8px",fontSize:"14px",height:"44px",fontWeight:"500",background:"linear-gradient(135deg, #dc3545 0%, #b02a37 100%)",border:"none",color:"white"},children:[n.jsx("i",{className:"bi bi-trash3 me-2"}),"مسح جميع السجلات"]})]})})]}),c&&n.jsxs("div",{className:"alert alert-danger mt-3 mb-0",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),c]})]}),n.jsx("div",{className:"card-body p-0",children:a?n.jsx(Dn,{show:!0,message:"جاري تحميل المهملات...",overlay:!1}):t.length===0?n.jsx("div",{className:"text-center py-5",children:n.jsxs("div",{className:"empty-state",children:[n.jsx("i",{className:"bi bi-trash3 text-muted mb-3",style:{fontSize:"4rem"}}),n.jsx("h5",{className:"text-muted",children:r.length===0?"سلة المهملات فارغة":"لا توجد نتائج للبحث"}),n.jsx("p",{className:"text-muted",children:r.length===0?"لا توجد عناصر محذوفة":"لا توجد عناصر تطابق البحث المحدد"})]})}):n.jsxs("div",{className:"p-4",children:[n.jsx("div",{className:"row g-3",children:Y.map((ce,Be)=>{const U=Gn.getItemDisplayInfo(ce),se=Gn.getTimeSinceDeleted(ce.deletedAt),fe={fontSize:"12px",fontWeight:"600",color:"#6c757d",marginLeft:"8px"},ie={fontSize:"13px",color:"#495057",fontWeight:"500"};return n.jsx("div",{className:"col-lg-4 col-md-6",children:n.jsxs("div",{className:"card h-100 shadow-sm",style:{borderRadius:"10px",border:"1px solid #e3e6f0",transition:"all 0.3s ease",overflow:"hidden"},children:[n.jsxs("div",{className:"card-body p-4",children:[n.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-3",children:[n.jsxs("span",{className:`badge bg-${U.color} px-3 py-2`,style:{borderRadius:"20px",fontSize:"11px",fontWeight:"600"},children:[n.jsx("i",{className:`bi ${U.icon} me-1`}),U.name]}),n.jsx("small",{className:"text-muted fw-medium",style:{fontSize:"11px"},children:se})]}),n.jsx("h6",{className:"card-title mb-3",style:{color:"#2c3e50",fontSize:"16px",fontWeight:"600",lineHeight:"1.3"},children:U.displayName}),n.jsxs("div",{className:"card-text",children:[ce.originalCollection==="rawmaterials"&&n.jsxs("div",{className:"info-grid",children:[n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الفئة:"}),n.jsx("span",{className:"info-value",style:ie,children:U.category})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الحد الأدنى:"}),n.jsx("span",{className:"info-value",style:ie,children:U.minimumStock})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"المورد:"}),n.jsx("span",{className:"info-value",style:ie,children:U.supplier})]})]}),ce.originalCollection==="employees"&&n.jsxs("div",{className:"info-grid",children:[n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"البريد الإلكتروني:"}),n.jsx("span",{className:"info-value",style:ie,children:ce.email||"غير محدد"})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"رقم الهاتف:"}),n.jsx("span",{className:"info-value",style:ie,children:ce.phone||"غير محدد"})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"القسم:"}),n.jsx("span",{className:"info-value",style:ie,children:ce.department||"غير محدد"})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"المنصب:"}),n.jsx("span",{className:"info-value",style:ie,children:ce.jobTitle||"غير محدد"})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الحالة:"}),n.jsx("span",{className:`badge ${ce.status==="active"?"bg-success":"bg-secondary"}`,style:{fontSize:"10px"},children:ce.status==="active"?"نشط":"غير نشط"})]}),ce.autoCreated&&n.jsx("div",{className:"info-item mb-2",children:n.jsxs("span",{className:"badge bg-warning text-dark",style:{fontSize:"10px"},children:[n.jsx("i",{className:"bi bi-robot me-1"}),"تم إنشاؤه تلقائياً"]})})]}),ce.originalCollection==="price_quotes"&&n.jsxs("div",{className:"info-grid",children:[n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"السعر:"}),n.jsx("span",{className:"info-value text-success fw-bold",style:{...ie,color:"#28a745"},children:U.price})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"المورد:"}),n.jsx("span",{className:"info-value",style:ie,children:U.supplierName})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"التاريخ:"}),n.jsx("span",{className:"info-value",style:ie,children:U.date})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsxs("span",{className:"info-label",style:fe,children:[U.contextLabel,":"]}),n.jsx("span",{className:"info-value",style:{...ie,color:"#007bff"},children:U.contextName})]})]}),(ce.originalCollection==="localproducts"||ce.originalCollection==="foreignproducts")&&n.jsxs("div",{className:"info-grid",children:[n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الفئة:"}),n.jsx("span",{className:"info-value",style:ie,children:U.category})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الوحدة:"}),n.jsx("span",{className:"info-value",style:ie,children:U.unit})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"السعر:"}),n.jsx("span",{className:"info-value text-success fw-bold",style:{...ie,color:"#28a745"},children:U.price})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"المورد:"}),n.jsx("span",{className:"info-value",style:ie,children:U.supplier})]})]}),ce.originalCollection==="tenderItems"&&n.jsxs("div",{className:"info-grid",children:[n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الكمية:"}),n.jsx("span",{className:"info-value",style:ie,children:U.quantity})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"السعر:"}),n.jsx("span",{className:"info-value text-success fw-bold",style:{...ie,color:"#28a745"},children:U.price})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"النوع:"}),n.jsx("span",{className:"info-value",style:ie,children:U.itemType})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsxs("span",{className:"info-label",style:fe,children:[U.contextLabel,":"]}),n.jsx("span",{className:"info-value",style:{...ie,color:"#007bff"},children:U.contextName})]})]}),ce.originalCollection==="tender_documents"&&n.jsxs("div",{className:"info-grid",children:[n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الحجم:"}),n.jsx("span",{className:"info-value",style:ie,children:U.fileSize})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"النوع:"}),n.jsx("span",{className:"info-value",style:ie,children:U.fileType})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"المناقصة:"}),n.jsx("span",{className:"info-value fw-bold",style:{...ie,color:"#007bff"},children:U.contextName})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"رقم المرجع:"}),n.jsx("span",{className:"info-value",style:{...ie,color:"#6c757d",fontFamily:"monospace"},children:ce.tenderReferenceNumber||"غير محدد"})]})]}),ce.originalCollection==="employee_documents"&&n.jsxs("div",{className:"info-grid",children:[n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الاسم الأصلي:"}),n.jsx("span",{className:"info-value",style:{...ie,fontSize:"12px",color:"#6c757d"},children:ce.originalFileName||"غير محدد"})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الحجم:"}),n.jsx("span",{className:"info-value",style:ie,children:ce.fileSize?`${(ce.fileSize/1024/1024).toFixed(2)} م.ب`:"غير محدد"})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"نوع الملف:"}),n.jsx("span",{className:"info-value",style:ie,children:(()=>{const _=ce.fileType||"";return _.includes("pdf")?"PDF":_.includes("word")||_.includes("document")?"Word":_.includes("image")?"صورة":_.split("/")[1]?.toUpperCase()||"غير معروف"})()})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الموظف:"}),n.jsx("span",{className:"info-value fw-bold",style:{...ie,color:"#28a745"},children:ce.employeeName||U.contextName})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"معرف الموظف:"}),n.jsx("span",{className:"info-value",style:{...ie,color:"#6c757d",fontFamily:"monospace",fontSize:"12px"},children:ce.employeeId||"غير محدد"})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"تاريخ الرفع:"}),n.jsx("span",{className:"info-value",style:{...ie,color:"#6c757d",fontSize:"12px"},children:(()=>{const _=ce.uploadedAt||ce.uploadDate;if(!_)return"غير محدد";try{return new Date(_).toLocaleDateString("ar-SA",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return"غير محدد"}})()})]}),ce.fileURL&&n.jsx("div",{className:"info-item mb-2",children:n.jsxs("span",{className:"badge bg-success bg-opacity-10 text-success",style:{fontSize:"10px"},children:[n.jsx("i",{className:"bi bi-link-45deg me-1"}),"رابط متاح للعرض"]})})]}),ce.originalCollection==="manufacturedProducts"&&n.jsxs("div",{className:"info-grid",children:[ce.referenceNumber&&n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"رقم المرجع:"}),n.jsx("span",{className:"info-value",style:{...ie,fontFamily:"monospace",color:"#007bff"},children:ce.referenceNumber})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"التكلفة التقديرية:"}),n.jsx("span",{className:"info-value text-success fw-bold",style:{...ie,color:"#28a745"},children:ce.estimatedValue?`${parseFloat(ce.estimatedValue).toLocaleString("en-US")} ريال`:"لم يتم تحديدها"})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"تاريخ الإضافة:"}),n.jsx("span",{className:"info-value",style:ie,children:(()=>{const _=ce.submissionDeadline;if(!_)return"غير محدد";try{return new Date(_).toLocaleDateString("ar-SA",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return _}})()})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الحالة:"}),n.jsx("span",{className:`badge ${ce.status==="active"?"bg-success":"bg-secondary"}`,style:{fontSize:"10px"},children:ce.status==="active"?"نشط":"غير نشط"})]}),ce.description&&n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الوصف:"}),n.jsx("span",{className:"info-value",style:{...ie,fontSize:"12px",color:"#6c757d",lineHeight:"1.4"},children:ce.description.length>80?`${ce.description.substring(0,80)}...`:ce.description})]}),ce.internalId&&n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"المعرف الداخلي:"}),n.jsx("span",{className:"info-value",style:{...ie,color:"#6c757d",fontFamily:"monospace",fontSize:"11px"},children:ce.internalId})]}),ce.createdAt&&n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"تاريخ الإنشاء:"}),n.jsx("span",{className:"info-value",style:{...ie,color:"#6c757d",fontSize:"12px"},children:(()=>{try{let _;if(ce.createdAt?.toDate)_=ce.createdAt.toDate();else if(ce.createdAt)_=new Date(ce.createdAt);else return"غير محدد";return _.toLocaleDateString("ar-SA",{year:"numeric",month:"short",day:"numeric"})}catch{return"غير محدد"}})()})]})]}),(ce.originalCollection==="suppliers"||ce.originalCollection==="foreignSuppliers"||ce.originalCollection==="customers")&&n.jsxs("div",{className:"info-grid",children:[n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"البريد:"}),n.jsx("span",{className:"info-value",style:ie,children:U.email})]}),n.jsxs("div",{className:"info-item mb-2",children:[n.jsx("span",{className:"info-label",style:fe,children:"الهاتف:"}),n.jsx("span",{className:"info-value",style:{...ie,direction:"ltr"},children:U.phone})]})]})]})]}),n.jsx("div",{className:"card-footer bg-white border-top",children:n.jsxs("div",{className:"d-flex justify-content-center gap-3",children:[n.jsx("button",{className:"btn btn-success",onClick:()=>X(ce.id,U.displayName),disabled:m===ce.id,title:"استعادة",style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",border:"none",color:"white"},children:m===ce.id?n.jsx("span",{className:"spinner-border spinner-border-sm",style:{width:"12px",height:"12px"}}):"استعادة"}),n.jsx("button",{className:"btn btn-danger",onClick:()=>te(ce.id,U.displayName),disabled:m===ce.id,title:"حذف نهائي",style:{borderRadius:"6px",height:"32px",fontSize:"13px",width:"80px",background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",border:"none",color:"white"},children:m===ce.id?n.jsx("span",{className:"spinner-border spinner-border-sm",style:{width:"12px",height:"12px"}}):"حذف"})]})})]})},ce.id)})}),t.length>0&&n.jsx(va,{currentPage:J,totalPages:oe,onPageChange:be,totalItems:H,itemsPerPage:k})]})})]}),n.jsx(Rn,{show:O.show,onClose:Q,title:O.title,message:O.message,type:O.type,onConfirm:O.onConfirm,confirmText:O.confirmText,cancelText:O.cancelText,showCancel:O.showCancel})]})};function CF(){const[r,e]=N.useState(!1),{isTimelineVisible:t}=$n(),s=()=>{e(!r)};return n.jsx(sn,{children:n.jsx(rn,{children:n.jsxs("div",{className:`page-wrapper ${r?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Kn,{onToggle:s}),n.jsxs("div",{className:"main-container",style:{paddingRight:r?"72px":"250px",paddingLeft:r||!t?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:r?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:r})}),n.jsxs("div",{className:"app-container",children:[n.jsxs("div",{style:{position:"sticky",top:0,zIndex:5,backgroundColor:"white",borderBottom:"1px solid #e9ecef"},children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"سلة المهملات"})]})}),n.jsx(Yn,{})]}),n.jsxs("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:[n.jsx("div",{className:"app-content-area p-4",style:{paddingBottom:"60px"},children:n.jsx(TF,{})}),n.jsx("div",{className:"app-footer",style:{textAlign:"center",padding:"20px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef",marginTop:"20px"},children:n.jsx("span",{children:"© Modern Bin 2025"})})]})]})]}),!r&&t&&n.jsx(Xn,{rtl:!0}),!r&&t&&n.jsx(Jn,{})]})})})}function AF(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(CF,{})})})}function DF(){ms();const{logActivity:r,getCurrentUser:e}=vn(),{alertConfig:t,closeAlert:s,showSuccess:a,showError:l,showConfirm:c}=Pn(),{isTimelineVisible:u}=$n(),[m,p]=N.useState(!1),[b,w]=N.useState(!0),[j,D]=N.useState([]),[O,Q]=N.useState([]),[z,I]=N.useState("categories"),[ee,J]=N.useState({name:"",description:""}),[oe,Y]=N.useState(null),[be,M]=N.useState({name:"",description:""}),[H,k]=N.useState(null),[$,X]=N.useState(!1);N.useEffect(()=>{te()},[]);const te=async()=>{try{w(!0),await Yi.initializeDefaultSettings();const[R,V]=await Promise.all([Yi.getAllCategories(),Yi.getAllUnits()]);D(R),Q(V)}catch(R){console.error("Error loading settings:",R),l("فشل في تحميل الإعدادات","خطأ في التحميل")}finally{w(!1)}},F=()=>{p(!m)},ce=async R=>{if(R.preventDefault(),!ee.name.trim()){l("اسم الفئة مطلوب","بيانات ناقصة");return}try{X(!0);const V=e();oe?(await Yi.updateCategory(oe,ee),r("task",`${V.name} حدث فئة`,`تم تحديث الفئة: ${ee.name}`),a("تم تحديث الفئة بنجاح","تم التحديث"),Y(null)):(await Yi.createCategory(ee),r("task",`${V.name} أضاف فئة جديدة`,`تم إضافة الفئة: ${ee.name}`),a("تم إضافة الفئة بنجاح","تم الإضافة")),J({name:"",description:""}),te()}catch(V){l(V.message,"خطأ")}finally{X(!1)}},Be=R=>{J({name:R.name,description:R.description||""}),Y(R.id)},U=R=>{c(`هل أنت متأكد من حذف الفئة "${R.name}"؟
لا يمكن التراجع عن هذا الإجراء!`,async()=>{try{X(!0),await Yi.deleteCategory(R.id);const V=e();r("task",`${V.name} حذف فئة`,`تم حذف الفئة: ${R.name}`),a("تم حذف الفئة بنجاح","تم الحذف"),te()}catch(V){l(V.message,"خطأ في الحذف")}finally{X(!1)}},"تأكيد الحذف")},se=()=>{J({name:"",description:""}),Y(null)},fe=async R=>{if(R.preventDefault(),!be.name.trim()){l("اسم الوحدة مطلوب","بيانات ناقصة");return}try{X(!0);const V=e();H?(await Yi.updateUnit(H,be),r("task",`${V.name} حدث وحدة`,`تم تحديث الوحدة: ${be.name}`),a("تم تحديث الوحدة بنجاح","تم التحديث"),k(null)):(await Yi.createUnit(be),r("task",`${V.name} أضاف وحدة جديدة`,`تم إضافة الوحدة: ${be.name}`),a("تم إضافة الوحدة بنجاح","تم الإضافة")),M({name:"",description:""}),te()}catch(V){l(V.message,"خطأ")}finally{X(!1)}},ie=R=>{M({name:R.name,description:R.description||""}),k(R.id)},_=R=>{c(`هل أنت متأكد من حذف الوحدة "${R.name}"؟
لا يمكن التراجع عن هذا الإجراء!`,async()=>{try{X(!0),await Yi.deleteUnit(R.id);const V=e();r("task",`${V.name} حذف وحدة`,`تم حذف الوحدة: ${R.name}`),a("تم حذف الوحدة بنجاح","تم الحذف"),te()}catch(V){l(V.message,"خطأ في الحذف")}finally{X(!1)}},"تأكيد الحذف")},E=()=>{M({name:"",description:""}),k(null)};return b?n.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"100vh"},children:n.jsx(Dn,{show:!0,message:"جاري تحميل الإعدادات..."})}):n.jsx(sn,{children:n.jsxs(rn,{children:[n.jsxs("div",{className:`page-wrapper ${m?"sidebar-collapsed":""}`,dir:"rtl",children:[n.jsx(Kn,{onToggle:F}),n.jsxs("div",{className:"main-container",style:{paddingRight:m?"72px":"250px",paddingLeft:m||!u?"20px":"400px",transition:"padding-right 0.3s ease, padding-left 0.3s ease"},children:[n.jsx("nav",{id:"sidebar",className:"sidebar-wrapper",style:{width:m?"72px":"250px",transition:"width 0.3s ease",position:"fixed",top:"70px",right:"0",height:"100vh",background:"white",zIndex:11,overflow:"hidden"},children:n.jsx(Wn,{isCollapsed:m})}),n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"app-hero-header d-flex align-items-center px-3 py-2 border-top",children:n.jsxs("ol",{className:"breadcrumb m-0",children:[n.jsx("li",{className:"breadcrumb-item",children:n.jsxs("a",{href:"/",className:"text-decoration-none d-flex align-items-center",children:[n.jsx("i",{className:"bi bi-house lh-1 me-2"}),n.jsx("span",{className:"text-primary",children:"الرئيسية"})]})}),n.jsx("li",{className:"breadcrumb-item text-secondary","aria-current":"page",children:"الإعدادات العامة"})]})}),n.jsx(Yn,{}),n.jsx("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden"},children:n.jsx("div",{className:"app-content-area p-4",children:n.jsxs("div",{className:"card shadow-sm",children:[n.jsx("div",{className:"card-header bg-white border-bottom py-4",children:n.jsx("div",{className:"d-flex justify-content-between align-items-center",children:n.jsx("div",{className:"d-flex align-items-center",children:n.jsxs("h5",{className:"mb-0 fw-bold me-3",children:[n.jsx("i",{className:"bi bi-gear-wide-connected text-primary me-2"}),"الإعدادات العامة"]})})})}),n.jsxs("div",{className:"card-body p-0",children:[n.jsxs("ul",{className:"nav nav-tabs border-bottom-0",id:"settingsTabs",role:"tablist",children:[n.jsx("li",{className:"nav-item",role:"presentation",children:n.jsxs("button",{className:`nav-link ${z==="categories"?"active":""}`,onClick:()=>I("categories"),type:"button",style:{borderRadius:"0",borderBottom:z==="categories"?"3px solid #007bff":"1px solid #dee2e6",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-tags me-2"}),"إدارة الفئات"]})}),n.jsx("li",{className:"nav-item",role:"presentation",children:n.jsxs("button",{className:`nav-link ${z==="units"?"active":""}`,onClick:()=>I("units"),type:"button",style:{borderRadius:"0",borderBottom:z==="units"?"3px solid #007bff":"1px solid #dee2e6",fontWeight:"500"},children:[n.jsx("i",{className:"bi bi-rulers me-2"}),"إدارة الوحدات"]})})]}),n.jsxs("div",{className:"tab-content p-4",children:[z==="categories"&&n.jsx("div",{className:"tab-pane fade show active",children:n.jsxs("div",{className:"row",children:[n.jsx("div",{className:"col-md-4",children:n.jsxs("div",{className:"card bg-light",children:[n.jsx("div",{className:"card-header",children:n.jsxs("h6",{className:"mb-0",children:[n.jsx("i",{className:"bi bi-plus-circle me-2"}),oe?"تحديث الفئة":"إضافة فئة جديدة"]})}),n.jsx("div",{className:"card-body",children:n.jsxs("form",{onSubmit:ce,children:[n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{className:"form-label",children:"اسم الفئة *"}),n.jsx("input",{type:"text",className:"form-control",value:ee.name,onChange:R=>J({...ee,name:R.target.value}),placeholder:"أدخل اسم الفئة",required:!0})]}),n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{className:"form-label",children:"الوصف"}),n.jsx("textarea",{className:"form-control",rows:"2",value:ee.description,onChange:R=>J({...ee,description:R.target.value}),placeholder:"وصف اختياري للفئة"})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsxs("button",{type:"submit",className:"btn btn-primary flex-fill",disabled:$,style:{height:"32px",fontSize:"14px"},children:[$?n.jsx("span",{className:"spinner-border spinner-border-sm me-2"}):n.jsx("i",{className:`bi ${oe?"bi-check-lg":"bi-plus-lg"} me-2`}),oe?"تحديث":"إضافة"]}),oe&&n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:se,style:{height:"32px",fontSize:"14px"},children:"إلغاء"})]})]})})]})}),n.jsx("div",{className:"col-md-8",children:n.jsxs("div",{className:"card",children:[n.jsx("div",{className:"card-header",children:n.jsxs("h6",{className:"mb-0",children:[n.jsx("i",{className:"bi bi-list me-2"}),"قائمة الفئات (",j.length,")"]})}),n.jsx("div",{className:"card-body p-0",children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{children:"اسم الفئة"}),n.jsx("th",{children:"الوصف"}),n.jsx("th",{style:{width:"100px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:j.length===0?n.jsx("tr",{children:n.jsxs("td",{colSpan:"3",className:"text-center py-4 text-muted",children:[n.jsx("i",{className:"bi bi-inbox fs-1 d-block mb-2"}),"لا توجد فئات مضافة"]})}):j.map(R=>n.jsxs("tr",{children:[n.jsx("td",{children:n.jsx("strong",{children:R.name})}),n.jsx("td",{children:n.jsx("small",{className:"text-muted",children:R.description||"لا يوجد وصف"})}),n.jsx("td",{children:n.jsxs("div",{className:"btn-group",style:{gap:"4px"},children:[n.jsx("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>Be(R),title:"تحديث",style:{width:"32px",height:"28px"},children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>U(R),title:"حذف",style:{width:"32px",height:"28px"},children:n.jsx("i",{className:"bi bi-trash"})})]})})]},R.id))})]})})})]})})]})}),z==="units"&&n.jsx("div",{className:"tab-pane fade show active",children:n.jsxs("div",{className:"row",children:[n.jsx("div",{className:"col-md-4",children:n.jsxs("div",{className:"card bg-light",children:[n.jsx("div",{className:"card-header",children:n.jsxs("h6",{className:"mb-0",children:[n.jsx("i",{className:"bi bi-plus-circle me-2"}),H?"تحديث الوحدة":"إضافة وحدة جديدة"]})}),n.jsx("div",{className:"card-body",children:n.jsxs("form",{onSubmit:fe,children:[n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{className:"form-label",children:"اسم الوحدة *"}),n.jsx("input",{type:"text",className:"form-control",value:be.name,onChange:R=>M({...be,name:R.target.value}),placeholder:"مثال: متر، كيلو جرام",required:!0})]}),n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{className:"form-label",children:"الوصف"}),n.jsx("textarea",{className:"form-control",rows:"2",value:be.description,onChange:R=>M({...be,description:R.target.value}),placeholder:"وصف اختياري للوحدة"})]}),n.jsxs("div",{className:"d-flex gap-2",children:[n.jsxs("button",{type:"submit",className:"btn btn-primary flex-fill",disabled:$,style:{height:"32px",fontSize:"14px"},children:[$?n.jsx("span",{className:"spinner-border spinner-border-sm me-2"}):n.jsx("i",{className:`bi ${H?"bi-check-lg":"bi-plus-lg"} me-2`}),H?"تحديث":"إضافة"]}),H&&n.jsx("button",{type:"button",className:"btn btn-secondary",onClick:E,style:{height:"32px",fontSize:"14px"},children:"إلغاء"})]})]})})]})}),n.jsx("div",{className:"col-md-8",children:n.jsxs("div",{className:"card",children:[n.jsx("div",{className:"card-header",children:n.jsxs("h6",{className:"mb-0",children:[n.jsx("i",{className:"bi bi-list me-2"}),"قائمة الوحدات (",O.length,")"]})}),n.jsx("div",{className:"card-body p-0",children:n.jsx("div",{className:"table-responsive",children:n.jsxs("table",{className:"table table-hover mb-0",children:[n.jsx("thead",{className:"table-light",children:n.jsxs("tr",{children:[n.jsx("th",{children:"اسم الوحدة"}),n.jsx("th",{children:"الوصف"}),n.jsx("th",{style:{width:"100px"},children:"الإجراءات"})]})}),n.jsx("tbody",{children:O.length===0?n.jsx("tr",{children:n.jsxs("td",{colSpan:"3",className:"text-center py-4 text-muted",children:[n.jsx("i",{className:"bi bi-inbox fs-1 d-block mb-2"}),"لا توجد وحدات مضافة"]})}):O.map(R=>n.jsxs("tr",{children:[n.jsx("td",{children:n.jsx("strong",{children:R.name})}),n.jsx("td",{children:n.jsx("small",{className:"text-muted",children:R.description||"لا يوجد وصف"})}),n.jsx("td",{children:n.jsxs("div",{className:"btn-group",style:{gap:"4px"},children:[n.jsx("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>ie(R),title:"تحديث",style:{width:"32px",height:"28px"},children:n.jsx("i",{className:"bi bi-pencil"})}),n.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>_(R),title:"حذف",style:{width:"32px",height:"28px"},children:n.jsx("i",{className:"bi bi-trash"})})]})})]},R.id))})]})})})]})})]})})]})]})]})})})]}),!m&&u&&n.jsx(Xn,{rtl:!0}),!m&&u&&n.jsx(Jn,{})]})]}),n.jsx(Rn,{show:t.show,onClose:s,title:t.title,message:t.message,type:t.type,onConfirm:t.onConfirm,confirmText:t.confirmText,cancelText:t.cancelText,showCancel:t.showCancel})]})})}function RF(){return n.jsx(sn,{children:n.jsx(rn,{children:n.jsx(DF,{})})})}const PF=()=>n.jsx(B5,{children:n.jsx(V5,{children:n.jsx(V2,{basename:"/Tender-app",children:n.jsxs(x2,{children:[n.jsx(pn,{path:"/",element:n.jsx(FE,{})}),n.jsx(pn,{path:"/tender",element:n.jsx(FE,{})}),n.jsx(pn,{path:"/tenders/list",element:n.jsx(m4,{})}),n.jsx(pn,{path:"/tenders/add",element:n.jsx(UE,{})}),n.jsx(pn,{path:"/tenders/edit/:id",element:n.jsx(UE,{})}),n.jsx(pn,{path:"/tenders/tracking",element:n.jsx(N4,{})}),n.jsx(pn,{path:"/tenders/raw-materials/:tenderId",element:n.jsx(_4,{})}),n.jsx(pn,{path:"/tenders/local-products/:tenderId",element:n.jsx(S4,{})}),n.jsx(pn,{path:"/tenders/foreign-products/:tenderId",element:n.jsx(T4,{})}),n.jsx(pn,{path:"/tenders/manufactured-products/:tenderId",element:n.jsx(D4,{})}),n.jsx(pn,{path:"/raw-materials",element:n.jsx(M4,{})}),n.jsx(pn,{path:"/raw-materials/add",element:n.jsx(zE,{})}),n.jsx(pn,{path:"/raw-materials/edit/:id",element:n.jsx(zE,{})}),n.jsx(pn,{path:"/local-products",element:n.jsx(B4,{})}),n.jsx(pn,{path:"/local-products/add",element:n.jsx($E,{})}),n.jsx(pn,{path:"/local-products/edit/:id",element:n.jsx($E,{})}),n.jsx(pn,{path:"/foreign-products",element:n.jsx(Q4,{})}),n.jsx(pn,{path:"/foreign-products/add",element:n.jsx(BE,{})}),n.jsx(pn,{path:"/foreign-products/edit/:id",element:n.jsx(BE,{})}),n.jsx(pn,{path:"/manufactured-products",element:n.jsx(X4,{})}),n.jsx(pn,{path:"/manufactured-products/add",element:n.jsx(qE,{})}),n.jsx(pn,{path:"/manufactured-products/edit/:id",element:n.jsx(qE,{})}),n.jsx(pn,{path:"/manufactured-products/raw-materials/:productId",element:n.jsx(eF,{})}),n.jsx(pn,{path:"/manufactured-products/local-products/:productId",element:n.jsx(nF,{})}),n.jsx(pn,{path:"/manufactured-products/foreign-products/:productId",element:n.jsx(rF,{})}),n.jsx(pn,{path:"/suppliers/local",element:n.jsx(lF,{})}),n.jsx(pn,{path:"/suppliers/foreign",element:n.jsx(hF,{})}),n.jsx(pn,{path:"/clients",element:n.jsx(xF,{})}),n.jsx(pn,{path:"/companies",element:n.jsx(jF,{})}),n.jsx(pn,{path:"/employees",element:n.jsx(IF,{})}),n.jsx(pn,{path:"/trash",element:n.jsx(AF,{})}),n.jsx(pn,{path:"/settings",element:n.jsx(RF,{})})]})})})});function kF(){return n.jsx(Y5,{children:n.jsx(PF,{})})}class OF extends S0.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){if(e&&e.message&&e.message.includes("_getRecaptchaConfig")){console.log("🔧 [ErrorBoundary] Caught and ignored reCAPTCHA error:",e.message),setTimeout(()=>{this.setState({hasError:!1,error:null,errorInfo:null})},100);return}console.error("ErrorBoundary caught an error:",e,t),this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?n.jsx("div",{className:"container-fluid d-flex justify-content-center align-items-center",style:{minHeight:"100vh",background:"#f8f9fa"},children:n.jsxs("div",{className:"card shadow-lg",style:{maxWidth:"600px",width:"100%"},children:[n.jsx("div",{className:"card-header bg-danger text-white text-center",children:n.jsxs("h4",{className:"mb-0",children:[n.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"حدث خطأ في التطبيق"]})}),n.jsxs("div",{className:"card-body text-center",children:[n.jsx("div",{className:"mb-4",children:n.jsx("i",{className:"bi bi-bug fs-1 text-danger"})}),n.jsx("h5",{className:"text-danger mb-3",children:"عذراً، حدث خطأ غير متوقع"}),n.jsx("p",{className:"text-muted mb-4",children:"يرجى إعادة تحميل الصفحة أو العودة إلى الصفحة الرئيسية"}),n.jsxs("div",{className:"d-flex gap-3 justify-content-center mb-4",children:[n.jsxs("button",{className:"btn btn-primary",onClick:()=>window.location.reload(),children:[n.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"إعادة تحميل الصفحة"]}),n.jsxs("button",{className:"btn btn-secondary",onClick:()=>window.location.href="/",children:[n.jsx("i",{className:"bi bi-house me-2"}),"العودة للرئيسية"]})]}),this.state.error&&n.jsxs("details",{className:"mt-4 text-start",children:[n.jsx("summary",{className:"cursor-pointer text-muted",children:n.jsx("small",{children:"تفاصيل الخطأ (للمطورين)"})}),n.jsxs("div",{className:"mt-2 p-3 bg-light rounded",children:[n.jsx("pre",{className:"text-danger small mb-2",children:this.state.error&&this.state.error.toString()}),n.jsx("pre",{className:"text-muted small",children:this.state.errorInfo.componentStack})]})]})]})]})}):this.props.children}}var Rg={exports:{}};/*!
  * Bootstrap v5.3.7 (https://getbootstrap.com/)
  * Copyright 2011-2025 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */var MF=Rg.exports,HE;function LF(){return HE||(HE=1,(function(r,e){(function(t,s){r.exports=s()})(MF,(function(){const t=new Map,s={set(L,x,S){t.has(L)||t.set(L,new Map);const W=t.get(L);W.has(x)||W.size===0?W.set(x,S):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(W.keys())[0]}.`)},get:(L,x)=>t.has(L)&&t.get(L).get(x)||null,remove(L,x){if(!t.has(L))return;const S=t.get(L);S.delete(x),S.size===0&&t.delete(L)}},a="transitionend",l=L=>(L&&window.CSS&&window.CSS.escape&&(L=L.replace(/#([^\s"#']+)/g,((x,S)=>`#${CSS.escape(S)}`))),L),c=L=>{L.dispatchEvent(new Event(a))},u=L=>!(!L||typeof L!="object")&&(L.jquery!==void 0&&(L=L[0]),L.nodeType!==void 0),m=L=>u(L)?L.jquery?L[0]:L:typeof L=="string"&&L.length>0?document.querySelector(l(L)):null,p=L=>{if(!u(L)||L.getClientRects().length===0)return!1;const x=getComputedStyle(L).getPropertyValue("visibility")==="visible",S=L.closest("details:not([open])");if(!S)return x;if(S!==L){const W=L.closest("summary");if(W&&W.parentNode!==S||W===null)return!1}return x},b=L=>!L||L.nodeType!==Node.ELEMENT_NODE||!!L.classList.contains("disabled")||(L.disabled!==void 0?L.disabled:L.hasAttribute("disabled")&&L.getAttribute("disabled")!=="false"),w=L=>{if(!document.documentElement.attachShadow)return null;if(typeof L.getRootNode=="function"){const x=L.getRootNode();return x instanceof ShadowRoot?x:null}return L instanceof ShadowRoot?L:L.parentNode?w(L.parentNode):null},j=()=>{},D=L=>{L.offsetHeight},O=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,Q=[],z=()=>document.documentElement.dir==="rtl",I=L=>{var x;x=()=>{const S=O();if(S){const W=L.NAME,ge=S.fn[W];S.fn[W]=L.jQueryInterface,S.fn[W].Constructor=L,S.fn[W].noConflict=()=>(S.fn[W]=ge,L.jQueryInterface)}},document.readyState==="loading"?(Q.length||document.addEventListener("DOMContentLoaded",(()=>{for(const S of Q)S()})),Q.push(x)):x()},ee=(L,x=[],S=L)=>typeof L=="function"?L.call(...x):S,J=(L,x,S=!0)=>{if(!S)return void ee(L);const W=(Le=>{if(!Le)return 0;let{transitionDuration:qe,transitionDelay:tt}=window.getComputedStyle(Le);const dt=Number.parseFloat(qe),mt=Number.parseFloat(tt);return dt||mt?(qe=qe.split(",")[0],tt=tt.split(",")[0],1e3*(Number.parseFloat(qe)+Number.parseFloat(tt))):0})(x)+5;let ge=!1;const we=({target:Le})=>{Le===x&&(ge=!0,x.removeEventListener(a,we),ee(L))};x.addEventListener(a,we),setTimeout((()=>{ge||c(x)}),W)},oe=(L,x,S,W)=>{const ge=L.length;let we=L.indexOf(x);return we===-1?!S&&W?L[ge-1]:L[0]:(we+=S?1:-1,W&&(we=(we+ge)%ge),L[Math.max(0,Math.min(we,ge-1))])},Y=/[^.]*(?=\..*)\.|.*/,be=/\..*/,M=/::\d+$/,H={};let k=1;const $={mouseenter:"mouseover",mouseleave:"mouseout"},X=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function te(L,x){return x&&`${x}::${k++}`||L.uidEvent||k++}function F(L){const x=te(L);return L.uidEvent=x,H[x]=H[x]||{},H[x]}function ce(L,x,S=null){return Object.values(L).find((W=>W.callable===x&&W.delegationSelector===S))}function Be(L,x,S){const W=typeof x=="string",ge=W?S:x||S;let we=ie(L);return X.has(we)||(we=L),[W,ge,we]}function U(L,x,S,W,ge){if(typeof x!="string"||!L)return;let[we,Le,qe]=Be(x,S,W);x in $&&(Le=(Ft=>function(Dt){if(!Dt.relatedTarget||Dt.relatedTarget!==Dt.delegateTarget&&!Dt.delegateTarget.contains(Dt.relatedTarget))return Ft.call(this,Dt)})(Le));const tt=F(L),dt=tt[qe]||(tt[qe]={}),mt=ce(dt,Le,we?S:null);if(mt)return void(mt.oneOff=mt.oneOff&&ge);const ot=te(Le,x.replace(Y,"")),Lt=we?(function(Et,Ft,Dt){return function It(fn){const En=Et.querySelectorAll(Ft);for(let{target:$t}=fn;$t&&$t!==this;$t=$t.parentNode)for(const on of En)if(on===$t)return E(fn,{delegateTarget:$t}),It.oneOff&&_.off(Et,fn.type,Ft,Dt),Dt.apply($t,[fn])}})(L,S,Le):(function(Et,Ft){return function Dt(It){return E(It,{delegateTarget:Et}),Dt.oneOff&&_.off(Et,It.type,Ft),Ft.apply(Et,[It])}})(L,Le);Lt.delegationSelector=we?S:null,Lt.callable=Le,Lt.oneOff=ge,Lt.uidEvent=ot,dt[ot]=Lt,L.addEventListener(qe,Lt,we)}function se(L,x,S,W,ge){const we=ce(x[S],W,ge);we&&(L.removeEventListener(S,we,!!ge),delete x[S][we.uidEvent])}function fe(L,x,S,W){const ge=x[S]||{};for(const[we,Le]of Object.entries(ge))we.includes(W)&&se(L,x,S,Le.callable,Le.delegationSelector)}function ie(L){return L=L.replace(be,""),$[L]||L}const _={on(L,x,S,W){U(L,x,S,W,!1)},one(L,x,S,W){U(L,x,S,W,!0)},off(L,x,S,W){if(typeof x!="string"||!L)return;const[ge,we,Le]=Be(x,S,W),qe=Le!==x,tt=F(L),dt=tt[Le]||{},mt=x.startsWith(".");if(we===void 0){if(mt)for(const ot of Object.keys(tt))fe(L,tt,ot,x.slice(1));for(const[ot,Lt]of Object.entries(dt)){const Et=ot.replace(M,"");qe&&!x.includes(Et)||se(L,tt,Le,Lt.callable,Lt.delegationSelector)}}else{if(!Object.keys(dt).length)return;se(L,tt,Le,we,ge?S:null)}},trigger(L,x,S){if(typeof x!="string"||!L)return null;const W=O();let ge=null,we=!0,Le=!0,qe=!1;x!==ie(x)&&W&&(ge=W.Event(x,S),W(L).trigger(ge),we=!ge.isPropagationStopped(),Le=!ge.isImmediatePropagationStopped(),qe=ge.isDefaultPrevented());const tt=E(new Event(x,{bubbles:we,cancelable:!0}),S);return qe&&tt.preventDefault(),Le&&L.dispatchEvent(tt),tt.defaultPrevented&&ge&&ge.preventDefault(),tt}};function E(L,x={}){for(const[S,W]of Object.entries(x))try{L[S]=W}catch{Object.defineProperty(L,S,{configurable:!0,get:()=>W})}return L}function R(L){if(L==="true")return!0;if(L==="false")return!1;if(L===Number(L).toString())return Number(L);if(L===""||L==="null")return null;if(typeof L!="string")return L;try{return JSON.parse(decodeURIComponent(L))}catch{return L}}function V(L){return L.replace(/[A-Z]/g,(x=>`-${x.toLowerCase()}`))}const ne={setDataAttribute(L,x,S){L.setAttribute(`data-bs-${V(x)}`,S)},removeDataAttribute(L,x){L.removeAttribute(`data-bs-${V(x)}`)},getDataAttributes(L){if(!L)return{};const x={},S=Object.keys(L.dataset).filter((W=>W.startsWith("bs")&&!W.startsWith("bsConfig")));for(const W of S){let ge=W.replace(/^bs/,"");ge=ge.charAt(0).toLowerCase()+ge.slice(1),x[ge]=R(L.dataset[W])}return x},getDataAttribute:(L,x)=>R(L.getAttribute(`data-bs-${V(x)}`))};class B{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(x){return x=this._mergeConfigObj(x),x=this._configAfterMerge(x),this._typeCheckConfig(x),x}_configAfterMerge(x){return x}_mergeConfigObj(x,S){const W=u(S)?ne.getDataAttribute(S,"config"):{};return{...this.constructor.Default,...typeof W=="object"?W:{},...u(S)?ne.getDataAttributes(S):{},...typeof x=="object"?x:{}}}_typeCheckConfig(x,S=this.constructor.DefaultType){for(const[ge,we]of Object.entries(S)){const Le=x[ge],qe=u(Le)?"element":(W=Le)==null?`${W}`:Object.prototype.toString.call(W).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(we).test(qe))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${ge}" provided type "${qe}" but expected type "${we}".`)}var W}}class q extends B{constructor(x,S){super(),(x=m(x))&&(this._element=x,this._config=this._getConfig(S),s.set(this._element,this.constructor.DATA_KEY,this))}dispose(){s.remove(this._element,this.constructor.DATA_KEY),_.off(this._element,this.constructor.EVENT_KEY);for(const x of Object.getOwnPropertyNames(this))this[x]=null}_queueCallback(x,S,W=!0){J(x,S,W)}_getConfig(x){return x=this._mergeConfigObj(x,this._element),x=this._configAfterMerge(x),this._typeCheckConfig(x),x}static getInstance(x){return s.get(m(x),this.DATA_KEY)}static getOrCreateInstance(x,S={}){return this.getInstance(x)||new this(x,typeof S=="object"?S:null)}static get VERSION(){return"5.3.7"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(x){return`${x}${this.EVENT_KEY}`}}const me=L=>{let x=L.getAttribute("data-bs-target");if(!x||x==="#"){let S=L.getAttribute("href");if(!S||!S.includes("#")&&!S.startsWith("."))return null;S.includes("#")&&!S.startsWith("#")&&(S=`#${S.split("#")[1]}`),x=S&&S!=="#"?S.trim():null}return x?x.split(",").map((S=>l(S))).join(","):null},C={find:(L,x=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(x,L)),findOne:(L,x=document.documentElement)=>Element.prototype.querySelector.call(x,L),children:(L,x)=>[].concat(...L.children).filter((S=>S.matches(x))),parents(L,x){const S=[];let W=L.parentNode.closest(x);for(;W;)S.push(W),W=W.parentNode.closest(x);return S},prev(L,x){let S=L.previousElementSibling;for(;S;){if(S.matches(x))return[S];S=S.previousElementSibling}return[]},next(L,x){let S=L.nextElementSibling;for(;S;){if(S.matches(x))return[S];S=S.nextElementSibling}return[]},focusableChildren(L){const x=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map((S=>`${S}:not([tabindex^="-"])`)).join(",");return this.find(x,L).filter((S=>!b(S)&&p(S)))},getSelectorFromElement(L){const x=me(L);return x&&C.findOne(x)?x:null},getElementFromSelector(L){const x=me(L);return x?C.findOne(x):null},getMultipleElementsFromSelector(L){const x=me(L);return x?C.find(x):[]}},Z=(L,x="hide")=>{const S=`click.dismiss${L.EVENT_KEY}`,W=L.NAME;_.on(document,S,`[data-bs-dismiss="${W}"]`,(function(ge){if(["A","AREA"].includes(this.tagName)&&ge.preventDefault(),b(this))return;const we=C.getElementFromSelector(this)||this.closest(`.${W}`);L.getOrCreateInstance(we)[x]()}))},je=".bs.alert",Ge=`close${je}`,Ke=`closed${je}`;class ft extends q{static get NAME(){return"alert"}close(){if(_.trigger(this._element,Ge).defaultPrevented)return;this._element.classList.remove("show");const x=this._element.classList.contains("fade");this._queueCallback((()=>this._destroyElement()),this._element,x)}_destroyElement(){this._element.remove(),_.trigger(this._element,Ke),this.dispose()}static jQueryInterface(x){return this.each((function(){const S=ft.getOrCreateInstance(this);if(typeof x=="string"){if(S[x]===void 0||x.startsWith("_")||x==="constructor")throw new TypeError(`No method named "${x}"`);S[x](this)}}))}}Z(ft,"close"),I(ft);const Ot='[data-bs-toggle="button"]';class Ee extends q{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(x){return this.each((function(){const S=Ee.getOrCreateInstance(this);x==="toggle"&&S[x]()}))}}_.on(document,"click.bs.button.data-api",Ot,(L=>{L.preventDefault();const x=L.target.closest(Ot);Ee.getOrCreateInstance(x).toggle()})),I(Ee);const it=".bs.swipe",Nt=`touchstart${it}`,hn=`touchmove${it}`,xn=`touchend${it}`,is=`pointerdown${it}`,Un=`pointerup${it}`,Xt={endCallback:null,leftCallback:null,rightCallback:null},yn={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class Zn extends B{constructor(x,S){super(),this._element=x,x&&Zn.isSupported()&&(this._config=this._getConfig(S),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return Xt}static get DefaultType(){return yn}static get NAME(){return"swipe"}dispose(){_.off(this._element,it)}_start(x){this._supportPointerEvents?this._eventIsPointerPenTouch(x)&&(this._deltaX=x.clientX):this._deltaX=x.touches[0].clientX}_end(x){this._eventIsPointerPenTouch(x)&&(this._deltaX=x.clientX-this._deltaX),this._handleSwipe(),ee(this._config.endCallback)}_move(x){this._deltaX=x.touches&&x.touches.length>1?0:x.touches[0].clientX-this._deltaX}_handleSwipe(){const x=Math.abs(this._deltaX);if(x<=40)return;const S=x/this._deltaX;this._deltaX=0,S&&ee(S>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(_.on(this._element,is,(x=>this._start(x))),_.on(this._element,Un,(x=>this._end(x))),this._element.classList.add("pointer-event")):(_.on(this._element,Nt,(x=>this._start(x))),_.on(this._element,hn,(x=>this._move(x))),_.on(this._element,xn,(x=>this._end(x))))}_eventIsPointerPenTouch(x){return this._supportPointerEvents&&(x.pointerType==="pen"||x.pointerType==="touch")}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const es=".bs.carousel",an=".data-api",Bt="ArrowLeft",Nn="ArrowRight",T="next",re="prev",he="left",de="right",xe=`slide${es}`,Ue=`slid${es}`,bt=`keydown${es}`,pt=`mouseenter${es}`,Vs=`mouseleave${es}`,Ne=`dragstart${es}`,ue=`load${es}${an}`,le=`click${es}${an}`,Ie="carousel",Te="active",We=".active",ye=".carousel-item",ze=We+ye,Oe={[Bt]:de,[Nn]:he},nt={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},Ze={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class Je extends q{constructor(x,S){super(x,S),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=C.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===Ie&&this.cycle()}static get Default(){return nt}static get DefaultType(){return Ze}static get NAME(){return"carousel"}next(){this._slide(T)}nextWhenVisible(){!document.hidden&&p(this._element)&&this.next()}prev(){this._slide(re)}pause(){this._isSliding&&c(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval((()=>this.nextWhenVisible()),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?_.one(this._element,Ue,(()=>this.cycle())):this.cycle())}to(x){const S=this._getItems();if(x>S.length-1||x<0)return;if(this._isSliding)return void _.one(this._element,Ue,(()=>this.to(x)));const W=this._getItemIndex(this._getActive());if(W===x)return;const ge=x>W?T:re;this._slide(ge,S[x])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(x){return x.defaultInterval=x.interval,x}_addEventListeners(){this._config.keyboard&&_.on(this._element,bt,(x=>this._keydown(x))),this._config.pause==="hover"&&(_.on(this._element,pt,(()=>this.pause())),_.on(this._element,Vs,(()=>this._maybeEnableCycle()))),this._config.touch&&Zn.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const S of C.find(".carousel-item img",this._element))_.on(S,Ne,(W=>W.preventDefault()));const x={leftCallback:()=>this._slide(this._directionToOrder(he)),rightCallback:()=>this._slide(this._directionToOrder(de)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout((()=>this._maybeEnableCycle()),500+this._config.interval))}};this._swipeHelper=new Zn(this._element,x)}_keydown(x){if(/input|textarea/i.test(x.target.tagName))return;const S=Oe[x.key];S&&(x.preventDefault(),this._slide(this._directionToOrder(S)))}_getItemIndex(x){return this._getItems().indexOf(x)}_setActiveIndicatorElement(x){if(!this._indicatorsElement)return;const S=C.findOne(We,this._indicatorsElement);S.classList.remove(Te),S.removeAttribute("aria-current");const W=C.findOne(`[data-bs-slide-to="${x}"]`,this._indicatorsElement);W&&(W.classList.add(Te),W.setAttribute("aria-current","true"))}_updateInterval(){const x=this._activeElement||this._getActive();if(!x)return;const S=Number.parseInt(x.getAttribute("data-bs-interval"),10);this._config.interval=S||this._config.defaultInterval}_slide(x,S=null){if(this._isSliding)return;const W=this._getActive(),ge=x===T,we=S||oe(this._getItems(),W,ge,this._config.wrap);if(we===W)return;const Le=this._getItemIndex(we),qe=ot=>_.trigger(this._element,ot,{relatedTarget:we,direction:this._orderToDirection(x),from:this._getItemIndex(W),to:Le});if(qe(xe).defaultPrevented||!W||!we)return;const tt=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(Le),this._activeElement=we;const dt=ge?"carousel-item-start":"carousel-item-end",mt=ge?"carousel-item-next":"carousel-item-prev";we.classList.add(mt),D(we),W.classList.add(dt),we.classList.add(dt),this._queueCallback((()=>{we.classList.remove(dt,mt),we.classList.add(Te),W.classList.remove(Te,mt,dt),this._isSliding=!1,qe(Ue)}),W,this._isAnimated()),tt&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return C.findOne(ze,this._element)}_getItems(){return C.find(ye,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(x){return z()?x===he?re:T:x===he?T:re}_orderToDirection(x){return z()?x===re?he:de:x===re?de:he}static jQueryInterface(x){return this.each((function(){const S=Je.getOrCreateInstance(this,x);if(typeof x!="number"){if(typeof x=="string"){if(S[x]===void 0||x.startsWith("_")||x==="constructor")throw new TypeError(`No method named "${x}"`);S[x]()}}else S.to(x)}))}}_.on(document,le,"[data-bs-slide], [data-bs-slide-to]",(function(L){const x=C.getElementFromSelector(this);if(!x||!x.classList.contains(Ie))return;L.preventDefault();const S=Je.getOrCreateInstance(x),W=this.getAttribute("data-bs-slide-to");return W?(S.to(W),void S._maybeEnableCycle()):ne.getDataAttribute(this,"slide")==="next"?(S.next(),void S._maybeEnableCycle()):(S.prev(),void S._maybeEnableCycle())})),_.on(window,ue,(()=>{const L=C.find('[data-bs-ride="carousel"]');for(const x of L)Je.getOrCreateInstance(x)})),I(Je);const Ve=".bs.collapse",ke=`show${Ve}`,et=`shown${Ve}`,bn=`hide${Ve}`,fs=`hidden${Ve}`,dr=`click${Ve}.data-api`,vs="show",Hr="collapse",Ai="collapsing",Na=`:scope .${Hr} .${Hr}`,li='[data-bs-toggle="collapse"]',Di={parent:null,toggle:!0},Ri={parent:"(null|element)",toggle:"boolean"};class ps extends q{constructor(x,S){super(x,S),this._isTransitioning=!1,this._triggerArray=[];const W=C.find(li);for(const ge of W){const we=C.getSelectorFromElement(ge),Le=C.find(we).filter((qe=>qe===this._element));we!==null&&Le.length&&this._triggerArray.push(ge)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return Di}static get DefaultType(){return Ri}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let x=[];if(this._config.parent&&(x=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter((ge=>ge!==this._element)).map((ge=>ps.getOrCreateInstance(ge,{toggle:!1})))),x.length&&x[0]._isTransitioning||_.trigger(this._element,ke).defaultPrevented)return;for(const ge of x)ge.hide();const S=this._getDimension();this._element.classList.remove(Hr),this._element.classList.add(Ai),this._element.style[S]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const W=`scroll${S[0].toUpperCase()+S.slice(1)}`;this._queueCallback((()=>{this._isTransitioning=!1,this._element.classList.remove(Ai),this._element.classList.add(Hr,vs),this._element.style[S]="",_.trigger(this._element,et)}),this._element,!0),this._element.style[S]=`${this._element[W]}px`}hide(){if(this._isTransitioning||!this._isShown()||_.trigger(this._element,bn).defaultPrevented)return;const x=this._getDimension();this._element.style[x]=`${this._element.getBoundingClientRect()[x]}px`,D(this._element),this._element.classList.add(Ai),this._element.classList.remove(Hr,vs);for(const S of this._triggerArray){const W=C.getElementFromSelector(S);W&&!this._isShown(W)&&this._addAriaAndCollapsedClass([S],!1)}this._isTransitioning=!0,this._element.style[x]="",this._queueCallback((()=>{this._isTransitioning=!1,this._element.classList.remove(Ai),this._element.classList.add(Hr),_.trigger(this._element,fs)}),this._element,!0)}_isShown(x=this._element){return x.classList.contains(vs)}_configAfterMerge(x){return x.toggle=!!x.toggle,x.parent=m(x.parent),x}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const x=this._getFirstLevelChildren(li);for(const S of x){const W=C.getElementFromSelector(S);W&&this._addAriaAndCollapsedClass([S],this._isShown(W))}}_getFirstLevelChildren(x){const S=C.find(Na,this._config.parent);return C.find(x,this._config.parent).filter((W=>!S.includes(W)))}_addAriaAndCollapsedClass(x,S){if(x.length)for(const W of x)W.classList.toggle("collapsed",!S),W.setAttribute("aria-expanded",S)}static jQueryInterface(x){const S={};return typeof x=="string"&&/show|hide/.test(x)&&(S.toggle=!1),this.each((function(){const W=ps.getOrCreateInstance(this,S);if(typeof x=="string"){if(W[x]===void 0)throw new TypeError(`No method named "${x}"`);W[x]()}}))}}_.on(document,dr,li,(function(L){(L.target.tagName==="A"||L.delegateTarget&&L.delegateTarget.tagName==="A")&&L.preventDefault();for(const x of C.getMultipleElementsFromSelector(this))ps.getOrCreateInstance(x,{toggle:!1}).toggle()})),I(ps);var Qt="top",zs="bottom",Rs="right",Vn="left",Gr="auto",ta=[Qt,zs,Rs,Vn],Pi="start",Qr="end",Ec="clippingParents",ki="viewport",ur="popper",Ps="reference",na=ta.reduce((function(L,x){return L.concat([x+"-"+Pi,x+"-"+Qr])}),[]),ul=[].concat(ta,[Gr]).reduce((function(L,x){return L.concat([x,x+"-"+Pi,x+"-"+Qr])}),[]),Oi="beforeRead",lo="read",co="afterRead",hl="beforeMain",uo="main",er="afterMain",ml="beforeWrite",Dd="write",ho="afterWrite",fl=[Oi,lo,co,hl,uo,er,ml,Dd,ho];function tr(L){return L?(L.nodeName||"").toLowerCase():null}function hr(L){if(L==null)return window;if(L.toString()!=="[object Window]"){var x=L.ownerDocument;return x&&x.defaultView||window}return L}function kn(L){return L instanceof hr(L).Element||L instanceof Element}function Bn(L){return L instanceof hr(L).HTMLElement||L instanceof HTMLElement}function sa(L){return typeof ShadowRoot<"u"&&(L instanceof hr(L).ShadowRoot||L instanceof ShadowRoot)}const Mi={name:"applyStyles",enabled:!0,phase:"write",fn:function(L){var x=L.state;Object.keys(x.elements).forEach((function(S){var W=x.styles[S]||{},ge=x.attributes[S]||{},we=x.elements[S];Bn(we)&&tr(we)&&(Object.assign(we.style,W),Object.keys(ge).forEach((function(Le){var qe=ge[Le];qe===!1?we.removeAttribute(Le):we.setAttribute(Le,qe===!0?"":qe)})))}))},effect:function(L){var x=L.state,S={popper:{position:x.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(x.elements.popper.style,S.popper),x.styles=S,x.elements.arrow&&Object.assign(x.elements.arrow.style,S.arrow),function(){Object.keys(x.elements).forEach((function(W){var ge=x.elements[W],we=x.attributes[W]||{},Le=Object.keys(x.styles.hasOwnProperty(W)?x.styles[W]:S[W]).reduce((function(qe,tt){return qe[tt]="",qe}),{});Bn(ge)&&tr(ge)&&(Object.assign(ge.style,Le),Object.keys(we).forEach((function(qe){ge.removeAttribute(qe)})))}))}},requires:["computeStyles"]};function ks(L){return L.split("-")[0]}var Jt=Math.max,Li=Math.min,$s=Math.round;function ra(){var L=navigator.userAgentData;return L!=null&&L.brands&&Array.isArray(L.brands)?L.brands.map((function(x){return x.brand+"/"+x.version})).join(" "):navigator.userAgent}function Sc(){return!/^((?!chrome|android).)*safari/i.test(ra())}function Fi(L,x,S){x===void 0&&(x=!1),S===void 0&&(S=!1);var W=L.getBoundingClientRect(),ge=1,we=1;x&&Bn(L)&&(ge=L.offsetWidth>0&&$s(W.width)/L.offsetWidth||1,we=L.offsetHeight>0&&$s(W.height)/L.offsetHeight||1);var Le=(kn(L)?hr(L):window).visualViewport,qe=!Sc()&&S,tt=(W.left+(qe&&Le?Le.offsetLeft:0))/ge,dt=(W.top+(qe&&Le?Le.offsetTop:0))/we,mt=W.width/ge,ot=W.height/we;return{width:mt,height:ot,top:dt,right:tt+mt,bottom:dt+ot,left:tt,x:tt,y:dt}}function mo(L){var x=Fi(L),S=L.offsetWidth,W=L.offsetHeight;return Math.abs(x.width-S)<=1&&(S=x.width),Math.abs(x.height-W)<=1&&(W=x.height),{x:L.offsetLeft,y:L.offsetTop,width:S,height:W}}function Rd(L,x){var S=x.getRootNode&&x.getRootNode();if(L.contains(x))return!0;if(S&&sa(S)){var W=x;do{if(W&&L.isSameNode(W))return!0;W=W.parentNode||W.host}while(W)}return!1}function ci(L){return hr(L).getComputedStyle(L)}function pl(L){return["table","td","th"].indexOf(tr(L))>=0}function nr(L){return((kn(L)?L.ownerDocument:L.document)||window.document).documentElement}function mr(L){return tr(L)==="html"?L:L.assignedSlot||L.parentNode||(sa(L)?L.host:null)||nr(L)}function Ui(L){return Bn(L)&&ci(L).position!=="fixed"?L.offsetParent:null}function Lr(L){for(var x=hr(L),S=Ui(L);S&&pl(S)&&ci(S).position==="static";)S=Ui(S);return S&&(tr(S)==="html"||tr(S)==="body"&&ci(S).position==="static")?x:S||(function(W){var ge=/firefox/i.test(ra());if(/Trident/i.test(ra())&&Bn(W)&&ci(W).position==="fixed")return null;var we=mr(W);for(sa(we)&&(we=we.host);Bn(we)&&["html","body"].indexOf(tr(we))<0;){var Le=ci(we);if(Le.transform!=="none"||Le.perspective!=="none"||Le.contain==="paint"||["transform","perspective"].indexOf(Le.willChange)!==-1||ge&&Le.willChange==="filter"||ge&&Le.filter&&Le.filter!=="none")return we;we=we.parentNode}return null})(L)||x}function fo(L){return["top","bottom"].indexOf(L)>=0?"x":"y"}function Er(L,x,S){return Jt(L,Li(x,S))}function Ic(L){return Object.assign({},{top:0,right:0,bottom:0,left:0},L)}function ja(L,x){return x.reduce((function(S,W){return S[W]=L,S}),{})}const Wr={name:"arrow",enabled:!0,phase:"main",fn:function(L){var x,S=L.state,W=L.name,ge=L.options,we=S.elements.arrow,Le=S.modifiersData.popperOffsets,qe=ks(S.placement),tt=fo(qe),dt=[Vn,Rs].indexOf(qe)>=0?"height":"width";if(we&&Le){var mt=(function(Pt,cn){return Ic(typeof(Pt=typeof Pt=="function"?Pt(Object.assign({},cn.rects,{placement:cn.placement})):Pt)!="number"?Pt:ja(Pt,ta))})(ge.padding,S),ot=mo(we),Lt=tt==="y"?Qt:Vn,Et=tt==="y"?zs:Rs,Ft=S.rects.reference[dt]+S.rects.reference[tt]-Le[tt]-S.rects.popper[dt],Dt=Le[tt]-S.rects.reference[tt],It=Lr(we),fn=It?tt==="y"?It.clientHeight||0:It.clientWidth||0:0,En=Ft/2-Dt/2,$t=mt[Lt],on=fn-ot[dt]-mt[Et],Rt=fn/2-ot[dt]/2+En,lt=Er($t,Rt,on),jt=tt;S.modifiersData[W]=((x={})[jt]=lt,x.centerOffset=lt-Rt,x)}},effect:function(L){var x=L.state,S=L.options.element,W=S===void 0?"[data-popper-arrow]":S;W!=null&&(typeof W!="string"||(W=x.elements.popper.querySelector(W)))&&Rd(x.elements.popper,W)&&(x.elements.arrow=W)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Bs(L){return L.split("-")[1]}var po={top:"auto",right:"auto",bottom:"auto",left:"auto"};function di(L){var x,S=L.popper,W=L.popperRect,ge=L.placement,we=L.variation,Le=L.offsets,qe=L.position,tt=L.gpuAcceleration,dt=L.adaptive,mt=L.roundOffsets,ot=L.isFixed,Lt=Le.x,Et=Lt===void 0?0:Lt,Ft=Le.y,Dt=Ft===void 0?0:Ft,It=typeof mt=="function"?mt({x:Et,y:Dt}):{x:Et,y:Dt};Et=It.x,Dt=It.y;var fn=Le.hasOwnProperty("x"),En=Le.hasOwnProperty("y"),$t=Vn,on=Qt,Rt=window;if(dt){var lt=Lr(S),jt="clientHeight",Pt="clientWidth";lt===hr(S)&&ci(lt=nr(S)).position!=="static"&&qe==="absolute"&&(jt="scrollHeight",Pt="scrollWidth"),(ge===Qt||(ge===Vn||ge===Rs)&&we===Qr)&&(on=zs,Dt-=(ot&&lt===Rt&&Rt.visualViewport?Rt.visualViewport.height:lt[jt])-W.height,Dt*=tt?1:-1),ge!==Vn&&(ge!==Qt&&ge!==zs||we!==Qr)||($t=Rs,Et-=(ot&&lt===Rt&&Rt.visualViewport?Rt.visualViewport.width:lt[Pt])-W.width,Et*=tt?1:-1)}var cn,On=Object.assign({position:qe},dt&&po),Ss=mt===!0?(function(Cr,Is){var Gs=Cr.x,Jr=Cr.y,zt=Is.devicePixelRatio||1;return{x:$s(Gs*zt)/zt||0,y:$s(Jr*zt)/zt||0}})({x:Et,y:Dt},hr(S)):{x:Et,y:Dt};return Et=Ss.x,Dt=Ss.y,tt?Object.assign({},On,((cn={})[on]=En?"0":"",cn[$t]=fn?"0":"",cn.transform=(Rt.devicePixelRatio||1)<=1?"translate("+Et+"px, "+Dt+"px)":"translate3d("+Et+"px, "+Dt+"px, 0)",cn)):Object.assign({},On,((x={})[on]=En?Dt+"px":"",x[$t]=fn?Et+"px":"",x.transform="",x))}const Vi={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(L){var x=L.state,S=L.options,W=S.gpuAcceleration,ge=W===void 0||W,we=S.adaptive,Le=we===void 0||we,qe=S.roundOffsets,tt=qe===void 0||qe,dt={placement:ks(x.placement),variation:Bs(x.placement),popper:x.elements.popper,popperRect:x.rects.popper,gpuAcceleration:ge,isFixed:x.options.strategy==="fixed"};x.modifiersData.popperOffsets!=null&&(x.styles.popper=Object.assign({},x.styles.popper,di(Object.assign({},dt,{offsets:x.modifiersData.popperOffsets,position:x.options.strategy,adaptive:Le,roundOffsets:tt})))),x.modifiersData.arrow!=null&&(x.styles.arrow=Object.assign({},x.styles.arrow,di(Object.assign({},dt,{offsets:x.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:tt})))),x.attributes.popper=Object.assign({},x.attributes.popper,{"data-popper-placement":x.placement})},data:{}};var Kr={passive:!0};const go={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(L){var x=L.state,S=L.instance,W=L.options,ge=W.scroll,we=ge===void 0||ge,Le=W.resize,qe=Le===void 0||Le,tt=hr(x.elements.popper),dt=[].concat(x.scrollParents.reference,x.scrollParents.popper);return we&&dt.forEach((function(mt){mt.addEventListener("scroll",S.update,Kr)})),qe&&tt.addEventListener("resize",S.update,Kr),function(){we&&dt.forEach((function(mt){mt.removeEventListener("scroll",S.update,Kr)})),qe&&tt.removeEventListener("resize",S.update,Kr)}},data:{}};var zi={left:"right",right:"left",bottom:"top",top:"bottom"};function Fr(L){return L.replace(/left|right|bottom|top/g,(function(x){return zi[x]}))}var Tc={start:"end",end:"start"};function Ns(L){return L.replace(/start|end/g,(function(x){return Tc[x]}))}function ln(L){var x=hr(L);return{scrollLeft:x.pageXOffset,scrollTop:x.pageYOffset}}function _a(L){return Fi(nr(L)).left+ln(L).scrollLeft}function ia(L){var x=ci(L),S=x.overflow,W=x.overflowX,ge=x.overflowY;return/auto|scroll|overlay|hidden/.test(S+ge+W)}function Cc(L){return["html","body","#document"].indexOf(tr(L))>=0?L.ownerDocument.body:Bn(L)&&ia(L)?L:Cc(mr(L))}function $i(L,x){var S;x===void 0&&(x=[]);var W=Cc(L),ge=W===((S=L.ownerDocument)==null?void 0:S.body),we=hr(W),Le=ge?[we].concat(we.visualViewport||[],ia(W)?W:[]):W,qe=x.concat(Le);return ge?qe:qe.concat($i(mr(Le)))}function Ea(L){return Object.assign({},L,{left:L.x,top:L.y,right:L.x+L.width,bottom:L.y+L.height})}function ui(L,x,S){return x===ki?Ea((function(W,ge){var we=hr(W),Le=nr(W),qe=we.visualViewport,tt=Le.clientWidth,dt=Le.clientHeight,mt=0,ot=0;if(qe){tt=qe.width,dt=qe.height;var Lt=Sc();(Lt||!Lt&&ge==="fixed")&&(mt=qe.offsetLeft,ot=qe.offsetTop)}return{width:tt,height:dt,x:mt+_a(W),y:ot}})(L,S)):kn(x)?(function(W,ge){var we=Fi(W,!1,ge==="fixed");return we.top=we.top+W.clientTop,we.left=we.left+W.clientLeft,we.bottom=we.top+W.clientHeight,we.right=we.left+W.clientWidth,we.width=W.clientWidth,we.height=W.clientHeight,we.x=we.left,we.y=we.top,we})(x,S):Ea((function(W){var ge,we=nr(W),Le=ln(W),qe=(ge=W.ownerDocument)==null?void 0:ge.body,tt=Jt(we.scrollWidth,we.clientWidth,qe?qe.scrollWidth:0,qe?qe.clientWidth:0),dt=Jt(we.scrollHeight,we.clientHeight,qe?qe.scrollHeight:0,qe?qe.clientHeight:0),mt=-Le.scrollLeft+_a(W),ot=-Le.scrollTop;return ci(qe||we).direction==="rtl"&&(mt+=Jt(we.clientWidth,qe?qe.clientWidth:0)-tt),{width:tt,height:dt,x:mt,y:ot}})(nr(L)))}function Sa(L){var x,S=L.reference,W=L.element,ge=L.placement,we=ge?ks(ge):null,Le=ge?Bs(ge):null,qe=S.x+S.width/2-W.width/2,tt=S.y+S.height/2-W.height/2;switch(we){case Qt:x={x:qe,y:S.y-W.height};break;case zs:x={x:qe,y:S.y+S.height};break;case Rs:x={x:S.x+S.width,y:tt};break;case Vn:x={x:S.x-W.width,y:tt};break;default:x={x:S.x,y:S.y}}var dt=we?fo(we):null;if(dt!=null){var mt=dt==="y"?"height":"width";switch(Le){case Pi:x[dt]=x[dt]-(S[mt]/2-W[mt]/2);break;case Qr:x[dt]=x[dt]+(S[mt]/2-W[mt]/2)}}return x}function qs(L,x){x===void 0&&(x={});var S=x,W=S.placement,ge=W===void 0?L.placement:W,we=S.strategy,Le=we===void 0?L.strategy:we,qe=S.boundary,tt=qe===void 0?Ec:qe,dt=S.rootBoundary,mt=dt===void 0?ki:dt,ot=S.elementContext,Lt=ot===void 0?ur:ot,Et=S.altBoundary,Ft=Et!==void 0&&Et,Dt=S.padding,It=Dt===void 0?0:Dt,fn=Ic(typeof It!="number"?It:ja(It,ta)),En=Lt===ur?Ps:ur,$t=L.rects.popper,on=L.elements[Ft?En:Lt],Rt=(function(Is,Gs,Jr,zt){var Zr=Gs==="clippingParents"?(function(Sn){var Qs=$i(mr(Sn)),Ar=["absolute","fixed"].indexOf(ci(Sn).position)>=0&&Bn(Sn)?Lr(Sn):Sn;return kn(Ar)?Qs.filter((function(Gi){return kn(Gi)&&Rd(Gi,Ar)&&tr(Gi)!=="body"})):[]})(Is):[].concat(Gs),ei=[].concat(Zr,[Jr]),Mo=ei[0],Ts=ei.reduce((function(Sn,Qs){var Ar=ui(Is,Qs,zt);return Sn.top=Jt(Ar.top,Sn.top),Sn.right=Li(Ar.right,Sn.right),Sn.bottom=Li(Ar.bottom,Sn.bottom),Sn.left=Jt(Ar.left,Sn.left),Sn}),ui(Is,Mo,zt));return Ts.width=Ts.right-Ts.left,Ts.height=Ts.bottom-Ts.top,Ts.x=Ts.left,Ts.y=Ts.top,Ts})(kn(on)?on:on.contextElement||nr(L.elements.popper),tt,mt,Le),lt=Fi(L.elements.reference),jt=Sa({reference:lt,element:$t,placement:ge}),Pt=Ea(Object.assign({},$t,jt)),cn=Lt===ur?Pt:lt,On={top:Rt.top-cn.top+fn.top,bottom:cn.bottom-Rt.bottom+fn.bottom,left:Rt.left-cn.left+fn.left,right:cn.right-Rt.right+fn.right},Ss=L.modifiersData.offset;if(Lt===ur&&Ss){var Cr=Ss[ge];Object.keys(On).forEach((function(Is){var Gs=[Rs,zs].indexOf(Is)>=0?1:-1,Jr=[Qt,zs].indexOf(Is)>=0?"y":"x";On[Is]+=Cr[Jr]*Gs}))}return On}function Pd(L,x){x===void 0&&(x={});var S=x,W=S.placement,ge=S.boundary,we=S.rootBoundary,Le=S.padding,qe=S.flipVariations,tt=S.allowedAutoPlacements,dt=tt===void 0?ul:tt,mt=Bs(W),ot=mt?qe?na:na.filter((function(Ft){return Bs(Ft)===mt})):ta,Lt=ot.filter((function(Ft){return dt.indexOf(Ft)>=0}));Lt.length===0&&(Lt=ot);var Et=Lt.reduce((function(Ft,Dt){return Ft[Dt]=qs(L,{placement:Dt,boundary:ge,rootBoundary:we,padding:Le})[ks(Dt)],Ft}),{});return Object.keys(Et).sort((function(Ft,Dt){return Et[Ft]-Et[Dt]}))}const kd={name:"flip",enabled:!0,phase:"main",fn:function(L){var x=L.state,S=L.options,W=L.name;if(!x.modifiersData[W]._skip){for(var ge=S.mainAxis,we=ge===void 0||ge,Le=S.altAxis,qe=Le===void 0||Le,tt=S.fallbackPlacements,dt=S.padding,mt=S.boundary,ot=S.rootBoundary,Lt=S.altBoundary,Et=S.flipVariations,Ft=Et===void 0||Et,Dt=S.allowedAutoPlacements,It=x.options.placement,fn=ks(It),En=tt||(fn!==It&&Ft?(function(Sn){if(ks(Sn)===Gr)return[];var Qs=Fr(Sn);return[Ns(Sn),Qs,Ns(Qs)]})(It):[Fr(It)]),$t=[It].concat(En).reduce((function(Sn,Qs){return Sn.concat(ks(Qs)===Gr?Pd(x,{placement:Qs,boundary:mt,rootBoundary:ot,padding:dt,flipVariations:Ft,allowedAutoPlacements:Dt}):Qs)}),[]),on=x.rects.reference,Rt=x.rects.popper,lt=new Map,jt=!0,Pt=$t[0],cn=0;cn<$t.length;cn++){var On=$t[cn],Ss=ks(On),Cr=Bs(On)===Pi,Is=[Qt,zs].indexOf(Ss)>=0,Gs=Is?"width":"height",Jr=qs(x,{placement:On,boundary:mt,rootBoundary:ot,altBoundary:Lt,padding:dt}),zt=Is?Cr?Rs:Vn:Cr?zs:Qt;on[Gs]>Rt[Gs]&&(zt=Fr(zt));var Zr=Fr(zt),ei=[];if(we&&ei.push(Jr[Ss]<=0),qe&&ei.push(Jr[zt]<=0,Jr[Zr]<=0),ei.every((function(Sn){return Sn}))){Pt=On,jt=!1;break}lt.set(On,ei)}if(jt)for(var Mo=function(Sn){var Qs=$t.find((function(Ar){var Gi=lt.get(Ar);if(Gi)return Gi.slice(0,Sn).every((function(Ws){return Ws}))}));if(Qs)return Pt=Qs,"break"},Ts=Ft?3:1;Ts>0&&Mo(Ts)!=="break";Ts--);x.placement!==Pt&&(x.modifiersData[W]._skip=!0,x.placement=Pt,x.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Ia(L,x,S){return S===void 0&&(S={x:0,y:0}),{top:L.top-x.height-S.y,right:L.right-x.width+S.x,bottom:L.bottom-x.height+S.y,left:L.left-x.width-S.x}}function xo(L){return[Qt,Rs,zs,Vn].some((function(x){return L[x]>=0}))}const gl={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(L){var x=L.state,S=L.name,W=x.rects.reference,ge=x.rects.popper,we=x.modifiersData.preventOverflow,Le=qs(x,{elementContext:"reference"}),qe=qs(x,{altBoundary:!0}),tt=Ia(Le,W),dt=Ia(qe,ge,we),mt=xo(tt),ot=xo(dt);x.modifiersData[S]={referenceClippingOffsets:tt,popperEscapeOffsets:dt,isReferenceHidden:mt,hasPopperEscaped:ot},x.attributes.popper=Object.assign({},x.attributes.popper,{"data-popper-reference-hidden":mt,"data-popper-escaped":ot})}},yo={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(L){var x=L.state,S=L.options,W=L.name,ge=S.offset,we=ge===void 0?[0,0]:ge,Le=ul.reduce((function(mt,ot){return mt[ot]=(function(Lt,Et,Ft){var Dt=ks(Lt),It=[Vn,Qt].indexOf(Dt)>=0?-1:1,fn=typeof Ft=="function"?Ft(Object.assign({},Et,{placement:Lt})):Ft,En=fn[0],$t=fn[1];return En=En||0,$t=($t||0)*It,[Vn,Rs].indexOf(Dt)>=0?{x:$t,y:En}:{x:En,y:$t}})(ot,x.rects,we),mt}),{}),qe=Le[x.placement],tt=qe.x,dt=qe.y;x.modifiersData.popperOffsets!=null&&(x.modifiersData.popperOffsets.x+=tt,x.modifiersData.popperOffsets.y+=dt),x.modifiersData[W]=Le}},xl={name:"popperOffsets",enabled:!0,phase:"read",fn:function(L){var x=L.state,S=L.name;x.modifiersData[S]=Sa({reference:x.rects.reference,element:x.rects.popper,placement:x.placement})},data:{}},bo={name:"preventOverflow",enabled:!0,phase:"main",fn:function(L){var x=L.state,S=L.options,W=L.name,ge=S.mainAxis,we=ge===void 0||ge,Le=S.altAxis,qe=Le!==void 0&&Le,tt=S.boundary,dt=S.rootBoundary,mt=S.altBoundary,ot=S.padding,Lt=S.tether,Et=Lt===void 0||Lt,Ft=S.tetherOffset,Dt=Ft===void 0?0:Ft,It=qs(x,{boundary:tt,rootBoundary:dt,padding:ot,altBoundary:mt}),fn=ks(x.placement),En=Bs(x.placement),$t=!En,on=fo(fn),Rt=on==="x"?"y":"x",lt=x.modifiersData.popperOffsets,jt=x.rects.reference,Pt=x.rects.popper,cn=typeof Dt=="function"?Dt(Object.assign({},x.rects,{placement:x.placement})):Dt,On=typeof cn=="number"?{mainAxis:cn,altAxis:cn}:Object.assign({mainAxis:0,altAxis:0},cn),Ss=x.modifiersData.offset?x.modifiersData.offset[x.placement]:null,Cr={x:0,y:0};if(lt){if(we){var Is,Gs=on==="y"?Qt:Vn,Jr=on==="y"?zs:Rs,zt=on==="y"?"height":"width",Zr=lt[on],ei=Zr+It[Gs],Mo=Zr-It[Jr],Ts=Et?-Pt[zt]/2:0,Sn=En===Pi?jt[zt]:Pt[zt],Qs=En===Pi?-Pt[zt]:-jt[zt],Ar=x.elements.arrow,Gi=Et&&Ar?mo(Ar):{width:0,height:0},Ws=x.modifiersData["arrow#persistent"]?x.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},as=Ws[Gs],Gd=Ws[Jr],Ma=Er(0,jt[zt],Gi[zt]),Qd=$t?jt[zt]/2-Ts-Ma-as-On.mainAxis:Sn-Ma-as-On.mainAxis,Gh=$t?-jt[zt]/2+Ts+Ma+Gd+On.mainAxis:Qs+Ma+Gd+On.mainAxis,xi=x.elements.arrow&&Lr(x.elements.arrow),Wd=xi?on==="y"?xi.clientTop||0:xi.clientLeft||0:0,Kd=(Is=Ss?.[on])!=null?Is:0,Qh=Zr+Gh-Kd,Wh=Er(Et?Li(ei,Zr+Qd-Kd-Wd):ei,Zr,Et?Jt(Mo,Qh):Mo);lt[on]=Wh,Cr[on]=Wh-Zr}if(qe){var Kh,mp=on==="x"?Qt:Vn,fp=on==="x"?zs:Rs,La=lt[Rt],Hc=Rt==="y"?"height":"width",Yd=La+It[mp],Yh=La-It[fp],Xh=[Qt,Vn].indexOf(fn)!==-1,Jh=(Kh=Ss?.[Rt])!=null?Kh:0,Zh=Xh?Yd:La-jt[Hc]-Pt[Hc]-Jh+On.altAxis,em=Xh?La+jt[Hc]+Pt[Hc]-Jh-On.altAxis:Yh,Xd=Et&&Xh?(function(pp,gp,Jd){var tm=Er(pp,gp,Jd);return tm>Jd?Jd:tm})(Zh,La,em):Er(Et?Zh:Yd,La,Et?em:Yh);lt[Rt]=Xd,Cr[Rt]=Xd-La}x.modifiersData[W]=Cr}},requiresIfExists:["offset"]};function bh(L,x,S){S===void 0&&(S=!1);var W,ge,we=Bn(x),Le=Bn(x)&&(function(ot){var Lt=ot.getBoundingClientRect(),Et=$s(Lt.width)/ot.offsetWidth||1,Ft=$s(Lt.height)/ot.offsetHeight||1;return Et!==1||Ft!==1})(x),qe=nr(x),tt=Fi(L,Le,S),dt={scrollLeft:0,scrollTop:0},mt={x:0,y:0};return(we||!we&&!S)&&((tr(x)!=="body"||ia(qe))&&(dt=(W=x)!==hr(W)&&Bn(W)?{scrollLeft:(ge=W).scrollLeft,scrollTop:ge.scrollTop}:ln(W)),Bn(x)?((mt=Fi(x,!0)).x+=x.clientLeft,mt.y+=x.clientTop):qe&&(mt.x=_a(qe))),{x:tt.left+dt.scrollLeft-mt.x,y:tt.top+dt.scrollTop-mt.y,width:tt.width,height:tt.height}}function Ac(L){var x=new Map,S=new Set,W=[];function ge(we){S.add(we.name),[].concat(we.requires||[],we.requiresIfExists||[]).forEach((function(Le){if(!S.has(Le)){var qe=x.get(Le);qe&&ge(qe)}})),W.push(we)}return L.forEach((function(we){x.set(we.name,we)})),L.forEach((function(we){S.has(we.name)||ge(we)})),W}var Ta={placement:"bottom",modifiers:[],strategy:"absolute"};function Dc(){for(var L=arguments.length,x=new Array(L),S=0;S<L;S++)x[S]=arguments[S];return!x.some((function(W){return!(W&&typeof W.getBoundingClientRect=="function")}))}function wo(L){L===void 0&&(L={});var x=L,S=x.defaultModifiers,W=S===void 0?[]:S,ge=x.defaultOptions,we=ge===void 0?Ta:ge;return function(Le,qe,tt){tt===void 0&&(tt=we);var dt,mt,ot={placement:"bottom",orderedModifiers:[],options:Object.assign({},Ta,we),modifiersData:{},elements:{reference:Le,popper:qe},attributes:{},styles:{}},Lt=[],Et=!1,Ft={state:ot,setOptions:function(It){var fn=typeof It=="function"?It(ot.options):It;Dt(),ot.options=Object.assign({},we,ot.options,fn),ot.scrollParents={reference:kn(Le)?$i(Le):Le.contextElement?$i(Le.contextElement):[],popper:$i(qe)};var En,$t,on=(function(Rt){var lt=Ac(Rt);return fl.reduce((function(jt,Pt){return jt.concat(lt.filter((function(cn){return cn.phase===Pt})))}),[])})((En=[].concat(W,ot.options.modifiers),$t=En.reduce((function(Rt,lt){var jt=Rt[lt.name];return Rt[lt.name]=jt?Object.assign({},jt,lt,{options:Object.assign({},jt.options,lt.options),data:Object.assign({},jt.data,lt.data)}):lt,Rt}),{}),Object.keys($t).map((function(Rt){return $t[Rt]}))));return ot.orderedModifiers=on.filter((function(Rt){return Rt.enabled})),ot.orderedModifiers.forEach((function(Rt){var lt=Rt.name,jt=Rt.options,Pt=jt===void 0?{}:jt,cn=Rt.effect;if(typeof cn=="function"){var On=cn({state:ot,name:lt,instance:Ft,options:Pt});Lt.push(On||function(){})}})),Ft.update()},forceUpdate:function(){if(!Et){var It=ot.elements,fn=It.reference,En=It.popper;if(Dc(fn,En)){ot.rects={reference:bh(fn,Lr(En),ot.options.strategy==="fixed"),popper:mo(En)},ot.reset=!1,ot.placement=ot.options.placement,ot.orderedModifiers.forEach((function(cn){return ot.modifiersData[cn.name]=Object.assign({},cn.data)}));for(var $t=0;$t<ot.orderedModifiers.length;$t++)if(ot.reset!==!0){var on=ot.orderedModifiers[$t],Rt=on.fn,lt=on.options,jt=lt===void 0?{}:lt,Pt=on.name;typeof Rt=="function"&&(ot=Rt({state:ot,options:jt,name:Pt,instance:Ft})||ot)}else ot.reset=!1,$t=-1}}},update:(dt=function(){return new Promise((function(It){Ft.forceUpdate(),It(ot)}))},function(){return mt||(mt=new Promise((function(It){Promise.resolve().then((function(){mt=void 0,It(dt())}))}))),mt}),destroy:function(){Dt(),Et=!0}};if(!Dc(Le,qe))return Ft;function Dt(){Lt.forEach((function(It){return It()})),Lt=[]}return Ft.setOptions(tt).then((function(It){!Et&&tt.onFirstUpdate&&tt.onFirstUpdate(It)})),Ft}}var Rc=wo(),vo=wo({defaultModifiers:[go,xl,Vi,Mi]}),yl=wo({defaultModifiers:[go,xl,Vi,Mi,yo,kd,bo,Wr,gl]});const No=Object.freeze(Object.defineProperty({__proto__:null,afterMain:er,afterRead:co,afterWrite:ho,applyStyles:Mi,arrow:Wr,auto:Gr,basePlacements:ta,beforeMain:hl,beforeRead:Oi,beforeWrite:ml,bottom:zs,clippingParents:Ec,computeStyles:Vi,createPopper:yl,createPopperBase:Rc,createPopperLite:vo,detectOverflow:qs,end:Qr,eventListeners:go,flip:kd,hide:gl,left:Vn,main:uo,modifierPhases:fl,offset:yo,placements:ul,popper:ur,popperGenerator:wo,popperOffsets:xl,preventOverflow:bo,read:lo,reference:Ps,right:Rs,start:Pi,top:Qt,variationPlacements:na,viewport:ki,write:Dd},Symbol.toStringTag,{value:"Module"})),Pc="dropdown",hi=".bs.dropdown",mi=".data-api",Od="ArrowUp",kc="ArrowDown",Md=`hide${hi}`,Ld=`hidden${hi}`,bl=`show${hi}`,fr=`shown${hi}`,Oc=`click${hi}${mi}`,Mc=`keydown${hi}${mi}`,Bi=`keyup${hi}${mi}`,f="show",v='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',A=`${v}.${f}`,K=".dropdown-menu",_e=z()?"top-end":"top-start",Me=z()?"top-start":"top-end",st=z()?"bottom-end":"bottom-start",Zt=z()?"bottom-start":"bottom-end",js=z()?"left-start":"right-start",en=z()?"right-start":"left-start",Os={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},_s={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class Es extends q{constructor(x,S){super(x,S),this._popper=null,this._parent=this._element.parentNode,this._menu=C.next(this._element,K)[0]||C.prev(this._element,K)[0]||C.findOne(K,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return Os}static get DefaultType(){return _s}static get NAME(){return Pc}toggle(){return this._isShown()?this.hide():this.show()}show(){if(b(this._element)||this._isShown())return;const x={relatedTarget:this._element};if(!_.trigger(this._element,bl,x).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const S of[].concat(...document.body.children))_.on(S,"mouseover",j);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(f),this._element.classList.add(f),_.trigger(this._element,fr,x)}}hide(){if(b(this._element)||!this._isShown())return;const x={relatedTarget:this._element};this._completeHide(x)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(x){if(!_.trigger(this._element,Md,x).defaultPrevented){if("ontouchstart"in document.documentElement)for(const S of[].concat(...document.body.children))_.off(S,"mouseover",j);this._popper&&this._popper.destroy(),this._menu.classList.remove(f),this._element.classList.remove(f),this._element.setAttribute("aria-expanded","false"),ne.removeDataAttribute(this._menu,"popper"),_.trigger(this._element,Ld,x),this._element.focus()}}_getConfig(x){if(typeof(x=super._getConfig(x)).reference=="object"&&!u(x.reference)&&typeof x.reference.getBoundingClientRect!="function")throw new TypeError(`${Pc.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return x}_createPopper(){if(No===void 0)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org/docs/v2/)");let x=this._element;this._config.reference==="parent"?x=this._parent:u(this._config.reference)?x=m(this._config.reference):typeof this._config.reference=="object"&&(x=this._config.reference);const S=this._getPopperConfig();this._popper=yl(x,this._menu,S)}_isShown(){return this._menu.classList.contains(f)}_getPlacement(){const x=this._parent;if(x.classList.contains("dropend"))return js;if(x.classList.contains("dropstart"))return en;if(x.classList.contains("dropup-center"))return"top";if(x.classList.contains("dropdown-center"))return"bottom";const S=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return x.classList.contains("dropup")?S?Me:_e:S?Zt:st}_detectNavbar(){return this._element.closest(".navbar")!==null}_getOffset(){const{offset:x}=this._config;return typeof x=="string"?x.split(",").map((S=>Number.parseInt(S,10))):typeof x=="function"?S=>x(S,this._element):x}_getPopperConfig(){const x={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(ne.setDataAttribute(this._menu,"popper","static"),x.modifiers=[{name:"applyStyles",enabled:!1}]),{...x,...ee(this._config.popperConfig,[void 0,x])}}_selectMenuItem({key:x,target:S}){const W=C.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter((ge=>p(ge)));W.length&&oe(W,S,x===kc,!W.includes(S)).focus()}static jQueryInterface(x){return this.each((function(){const S=Es.getOrCreateInstance(this,x);if(typeof x=="string"){if(S[x]===void 0)throw new TypeError(`No method named "${x}"`);S[x]()}}))}static clearMenus(x){if(x.button===2||x.type==="keyup"&&x.key!=="Tab")return;const S=C.find(A);for(const W of S){const ge=Es.getInstance(W);if(!ge||ge._config.autoClose===!1)continue;const we=x.composedPath(),Le=we.includes(ge._menu);if(we.includes(ge._element)||ge._config.autoClose==="inside"&&!Le||ge._config.autoClose==="outside"&&Le||ge._menu.contains(x.target)&&(x.type==="keyup"&&x.key==="Tab"||/input|select|option|textarea|form/i.test(x.target.tagName)))continue;const qe={relatedTarget:ge._element};x.type==="click"&&(qe.clickEvent=x),ge._completeHide(qe)}}static dataApiKeydownHandler(x){const S=/input|textarea/i.test(x.target.tagName),W=x.key==="Escape",ge=[Od,kc].includes(x.key);if(!ge&&!W||S&&!W)return;x.preventDefault();const we=this.matches(v)?this:C.prev(this,v)[0]||C.next(this,v)[0]||C.findOne(v,x.delegateTarget.parentNode),Le=Es.getOrCreateInstance(we);if(ge)return x.stopPropagation(),Le.show(),void Le._selectMenuItem(x);Le._isShown()&&(x.stopPropagation(),Le.hide(),we.focus())}}_.on(document,Mc,v,Es.dataApiKeydownHandler),_.on(document,Mc,K,Es.dataApiKeydownHandler),_.on(document,Oc,Es.clearMenus),_.on(document,Bi,Es.clearMenus),_.on(document,Oc,v,(function(L){L.preventDefault(),Es.getOrCreateInstance(this).toggle()})),I(Es);const Ms="backdrop",fi="show",wl=`mousedown.bs.${Ms}`,Fd={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},Gf={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class wh extends B{constructor(x){super(),this._config=this._getConfig(x),this._isAppended=!1,this._element=null}static get Default(){return Fd}static get DefaultType(){return Gf}static get NAME(){return Ms}show(x){if(!this._config.isVisible)return void ee(x);this._append();const S=this._getElement();this._config.isAnimated&&D(S),S.classList.add(fi),this._emulateAnimation((()=>{ee(x)}))}hide(x){this._config.isVisible?(this._getElement().classList.remove(fi),this._emulateAnimation((()=>{this.dispose(),ee(x)}))):ee(x)}dispose(){this._isAppended&&(_.off(this._element,wl),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const x=document.createElement("div");x.className=this._config.className,this._config.isAnimated&&x.classList.add("fade"),this._element=x}return this._element}_configAfterMerge(x){return x.rootElement=m(x.rootElement),x}_append(){if(this._isAppended)return;const x=this._getElement();this._config.rootElement.append(x),_.on(x,wl,(()=>{ee(this._config.clickCallback)})),this._isAppended=!0}_emulateAnimation(x){J(x,this._getElement(),this._config.isAnimated)}}const vl=".bs.focustrap",vh=`focusin${vl}`,Qf=`keydown.tab${vl}`,Nh="backward",Wf={autofocus:!0,trapElement:null},Wx={autofocus:"boolean",trapElement:"element"};class Kf extends B{constructor(x){super(),this._config=this._getConfig(x),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return Wf}static get DefaultType(){return Wx}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),_.off(document,vl),_.on(document,vh,(x=>this._handleFocusin(x))),_.on(document,Qf,(x=>this._handleKeydown(x))),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,_.off(document,vl))}_handleFocusin(x){const{trapElement:S}=this._config;if(x.target===document||x.target===S||S.contains(x.target))return;const W=C.focusableChildren(S);W.length===0?S.focus():this._lastTabNavDirection===Nh?W[W.length-1].focus():W[0].focus()}_handleKeydown(x){x.key==="Tab"&&(this._lastTabNavDirection=x.shiftKey?Nh:"forward")}}const Yf=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Xf=".sticky-top",Ud="padding-right",Sr="margin-right";class jo{constructor(){this._element=document.body}getWidth(){const x=document.documentElement.clientWidth;return Math.abs(window.innerWidth-x)}hide(){const x=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Ud,(S=>S+x)),this._setElementAttributes(Yf,Ud,(S=>S+x)),this._setElementAttributes(Xf,Sr,(S=>S-x))}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Ud),this._resetElementAttributes(Yf,Ud),this._resetElementAttributes(Xf,Sr)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(x,S,W){const ge=this.getWidth();this._applyManipulationCallback(x,(we=>{if(we!==this._element&&window.innerWidth>we.clientWidth+ge)return;this._saveInitialAttribute(we,S);const Le=window.getComputedStyle(we).getPropertyValue(S);we.style.setProperty(S,`${W(Number.parseFloat(Le))}px`)}))}_saveInitialAttribute(x,S){const W=x.style.getPropertyValue(S);W&&ne.setDataAttribute(x,S,W)}_resetElementAttributes(x,S){this._applyManipulationCallback(x,(W=>{const ge=ne.getDataAttribute(W,S);ge!==null?(ne.removeDataAttribute(W,S),W.style.setProperty(S,ge)):W.style.removeProperty(S)}))}_applyManipulationCallback(x,S){if(u(x))S(x);else for(const W of C.find(x,this._element))S(W)}}const Ur=".bs.modal",Jf=`hide${Ur}`,Zf=`hidePrevented${Ur}`,jh=`hidden${Ur}`,Vd=`show${Ur}`,Kx=`shown${Ur}`,Nl=`resize${Ur}`,_h=`click.dismiss${Ur}`,Lc=`mousedown.dismiss${Ur}`,Eh=`keydown.dismiss${Ur}`,ep=`click${Ur}.data-api`,Ca="modal-open",_o="show",Fc="modal-static",tp={backdrop:!0,focus:!0,keyboard:!0},Eo={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Aa extends q{constructor(x,S){super(x,S),this._dialog=C.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new jo,this._addEventListeners()}static get Default(){return tp}static get DefaultType(){return Eo}static get NAME(){return"modal"}toggle(x){return this._isShown?this.hide():this.show(x)}show(x){this._isShown||this._isTransitioning||_.trigger(this._element,Vd,{relatedTarget:x}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(Ca),this._adjustDialog(),this._backdrop.show((()=>this._showElement(x))))}hide(){this._isShown&&!this._isTransitioning&&(_.trigger(this._element,Jf).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(_o),this._queueCallback((()=>this._hideModal()),this._element,this._isAnimated())))}dispose(){_.off(window,Ur),_.off(this._dialog,Ur),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new wh({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Kf({trapElement:this._element})}_showElement(x){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const S=C.findOne(".modal-body",this._dialog);S&&(S.scrollTop=0),D(this._element),this._element.classList.add(_o),this._queueCallback((()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,_.trigger(this._element,Kx,{relatedTarget:x})}),this._dialog,this._isAnimated())}_addEventListeners(){_.on(this._element,Eh,(x=>{x.key==="Escape"&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())})),_.on(window,Nl,(()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()})),_.on(this._element,Lc,(x=>{_.one(this._element,_h,(S=>{this._element===x.target&&this._element===S.target&&(this._config.backdrop!=="static"?this._config.backdrop&&this.hide():this._triggerBackdropTransition())}))}))}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide((()=>{document.body.classList.remove(Ca),this._resetAdjustments(),this._scrollBar.reset(),_.trigger(this._element,jh)}))}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(_.trigger(this._element,Zf).defaultPrevented)return;const x=this._element.scrollHeight>document.documentElement.clientHeight,S=this._element.style.overflowY;S==="hidden"||this._element.classList.contains(Fc)||(x||(this._element.style.overflowY="hidden"),this._element.classList.add(Fc),this._queueCallback((()=>{this._element.classList.remove(Fc),this._queueCallback((()=>{this._element.style.overflowY=S}),this._dialog)}),this._dialog),this._element.focus())}_adjustDialog(){const x=this._element.scrollHeight>document.documentElement.clientHeight,S=this._scrollBar.getWidth(),W=S>0;if(W&&!x){const ge=z()?"paddingLeft":"paddingRight";this._element.style[ge]=`${S}px`}if(!W&&x){const ge=z()?"paddingRight":"paddingLeft";this._element.style[ge]=`${S}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(x,S){return this.each((function(){const W=Aa.getOrCreateInstance(this,x);if(typeof x=="string"){if(W[x]===void 0)throw new TypeError(`No method named "${x}"`);W[x](S)}}))}}_.on(document,ep,'[data-bs-toggle="modal"]',(function(L){const x=C.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&L.preventDefault(),_.one(x,Vd,(W=>{W.defaultPrevented||_.one(x,jh,(()=>{p(this)&&this.focus()}))}));const S=C.findOne(".modal.show");S&&Aa.getInstance(S).hide(),Aa.getOrCreateInstance(x).toggle(this)})),Z(Aa),I(Aa);const qi=".bs.offcanvas",Sh=".data-api",Yx=`load${qi}${Sh}`,np="show",sp="showing",Ih="hiding",Th=".offcanvas.show",Ch=`show${qi}`,pi=`shown${qi}`,rp=`hide${qi}`,Vr=`hidePrevented${qi}`,zr=`hidden${qi}`,jl=`resize${qi}`,Ah=`click${qi}${Sh}`,zd=`keydown.dismiss${qi}`,$d={backdrop:!0,keyboard:!0,scroll:!1},Dh={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Ir extends q{constructor(x,S){super(x,S),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return $d}static get DefaultType(){return Dh}static get NAME(){return"offcanvas"}toggle(x){return this._isShown?this.hide():this.show(x)}show(x){this._isShown||_.trigger(this._element,Ch,{relatedTarget:x}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||new jo().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(sp),this._queueCallback((()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(np),this._element.classList.remove(sp),_.trigger(this._element,pi,{relatedTarget:x})}),this._element,!0))}hide(){this._isShown&&(_.trigger(this._element,rp).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(Ih),this._backdrop.hide(),this._queueCallback((()=>{this._element.classList.remove(np,Ih),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new jo().reset(),_.trigger(this._element,zr)}),this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const x=!!this._config.backdrop;return new wh({className:"offcanvas-backdrop",isVisible:x,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:x?()=>{this._config.backdrop!=="static"?this.hide():_.trigger(this._element,Vr)}:null})}_initializeFocusTrap(){return new Kf({trapElement:this._element})}_addEventListeners(){_.on(this._element,zd,(x=>{x.key==="Escape"&&(this._config.keyboard?this.hide():_.trigger(this._element,Vr))}))}static jQueryInterface(x){return this.each((function(){const S=Ir.getOrCreateInstance(this,x);if(typeof x=="string"){if(S[x]===void 0||x.startsWith("_")||x==="constructor")throw new TypeError(`No method named "${x}"`);S[x](this)}}))}}_.on(document,Ah,'[data-bs-toggle="offcanvas"]',(function(L){const x=C.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&L.preventDefault(),b(this))return;_.one(x,zr,(()=>{p(this)&&this.focus()}));const S=C.findOne(Th);S&&S!==x&&Ir.getInstance(S).hide(),Ir.getOrCreateInstance(x).toggle(this)})),_.on(window,Yx,(()=>{for(const L of C.find(Th))Ir.getOrCreateInstance(L).show()})),_.on(window,jl,(()=>{for(const L of C.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(L).position!=="fixed"&&Ir.getOrCreateInstance(L).hide()})),Z(Ir),I(Ir);const Rh={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},Bd=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),_l=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,Xx=(L,x)=>{const S=L.nodeName.toLowerCase();return x.includes(S)?!Bd.has(S)||!!_l.test(L.nodeValue):x.filter((W=>W instanceof RegExp)).some((W=>W.test(S)))},$r={allowList:Rh,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},Ph={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},aa={entry:"(string|element|function|null)",selector:"(string|element)"};class ip extends B{constructor(x){super(),this._config=this._getConfig(x)}static get Default(){return $r}static get DefaultType(){return Ph}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map((x=>this._resolvePossibleFunction(x))).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(x){return this._checkContent(x),this._config.content={...this._config.content,...x},this}toHtml(){const x=document.createElement("div");x.innerHTML=this._maybeSanitize(this._config.template);for(const[ge,we]of Object.entries(this._config.content))this._setContent(x,we,ge);const S=x.children[0],W=this._resolvePossibleFunction(this._config.extraClass);return W&&S.classList.add(...W.split(" ")),S}_typeCheckConfig(x){super._typeCheckConfig(x),this._checkContent(x.content)}_checkContent(x){for(const[S,W]of Object.entries(x))super._typeCheckConfig({selector:S,entry:W},aa)}_setContent(x,S,W){const ge=C.findOne(W,x);ge&&((S=this._resolvePossibleFunction(S))?u(S)?this._putElementInTemplate(m(S),ge):this._config.html?ge.innerHTML=this._maybeSanitize(S):ge.textContent=S:ge.remove())}_maybeSanitize(x){return this._config.sanitize?(function(S,W,ge){if(!S.length)return S;if(ge&&typeof ge=="function")return ge(S);const we=new window.DOMParser().parseFromString(S,"text/html"),Le=[].concat(...we.body.querySelectorAll("*"));for(const qe of Le){const tt=qe.nodeName.toLowerCase();if(!Object.keys(W).includes(tt)){qe.remove();continue}const dt=[].concat(...qe.attributes),mt=[].concat(W["*"]||[],W[tt]||[]);for(const ot of dt)Xx(ot,mt)||qe.removeAttribute(ot.nodeName)}return we.body.innerHTML})(x,this._config.allowList,this._config.sanitizeFn):x}_resolvePossibleFunction(x){return ee(x,[void 0,this])}_putElementInTemplate(x,S){if(this._config.html)return S.innerHTML="",void S.append(x);S.textContent=x.textContent}}const qd=new Set(["sanitize","allowList","sanitizeFn"]),oa="fade",El="show",kh=".tooltip-inner",So=".modal",Io="hide.bs.modal",Da="hover",Sl="focus",Tr="click",Yr={AUTO:"auto",TOP:"top",RIGHT:z()?"left":"right",BOTTOM:"bottom",LEFT:z()?"right":"left"},To={allowList:Rh,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},la={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class pr extends q{constructor(x,S){if(No===void 0)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org/docs/v2/)");super(x,S),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return To}static get DefaultType(){return la}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),_.off(this._element.closest(So),Io,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const x=_.trigger(this._element,this.constructor.eventName("show")),S=(w(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(x.defaultPrevented||!S)return;this._disposePopper();const W=this._getTipElement();this._element.setAttribute("aria-describedby",W.getAttribute("id"));const{container:ge}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(ge.append(W),_.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(W),W.classList.add(El),"ontouchstart"in document.documentElement)for(const we of[].concat(...document.body.children))_.on(we,"mouseover",j);this._queueCallback((()=>{_.trigger(this._element,this.constructor.eventName("shown")),this._isHovered===!1&&this._leave(),this._isHovered=!1}),this.tip,this._isAnimated())}hide(){if(this._isShown()&&!_.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(El),"ontouchstart"in document.documentElement)for(const x of[].concat(...document.body.children))_.off(x,"mouseover",j);this._activeTrigger[Tr]=!1,this._activeTrigger[Sl]=!1,this._activeTrigger[Da]=!1,this._isHovered=null,this._queueCallback((()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),_.trigger(this._element,this.constructor.eventName("hidden")))}),this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(x){const S=this._getTemplateFactory(x).toHtml();if(!S)return null;S.classList.remove(oa,El),S.classList.add(`bs-${this.constructor.NAME}-auto`);const W=(ge=>{do ge+=Math.floor(1e6*Math.random());while(document.getElementById(ge));return ge})(this.constructor.NAME).toString();return S.setAttribute("id",W),this._isAnimated()&&S.classList.add(oa),S}setContent(x){this._newContent=x,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(x){return this._templateFactory?this._templateFactory.changeContent(x):this._templateFactory=new ip({...this._config,content:x,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[kh]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(x){return this.constructor.getOrCreateInstance(x.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(oa)}_isShown(){return this.tip&&this.tip.classList.contains(El)}_createPopper(x){const S=ee(this._config.placement,[this,x,this._element]),W=Yr[S.toUpperCase()];return yl(this._element,x,this._getPopperConfig(W))}_getOffset(){const{offset:x}=this._config;return typeof x=="string"?x.split(",").map((S=>Number.parseInt(S,10))):typeof x=="function"?S=>x(S,this._element):x}_resolvePossibleFunction(x){return ee(x,[this._element,this._element])}_getPopperConfig(x){const S={placement:x,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:W=>{this._getTipElement().setAttribute("data-popper-placement",W.state.placement)}}]};return{...S,...ee(this._config.popperConfig,[void 0,S])}}_setListeners(){const x=this._config.trigger.split(" ");for(const S of x)if(S==="click")_.on(this._element,this.constructor.eventName("click"),this._config.selector,(W=>{const ge=this._initializeOnDelegatedTarget(W);ge._activeTrigger[Tr]=!(ge._isShown()&&ge._activeTrigger[Tr]),ge.toggle()}));else if(S!=="manual"){const W=S===Da?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),ge=S===Da?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");_.on(this._element,W,this._config.selector,(we=>{const Le=this._initializeOnDelegatedTarget(we);Le._activeTrigger[we.type==="focusin"?Sl:Da]=!0,Le._enter()})),_.on(this._element,ge,this._config.selector,(we=>{const Le=this._initializeOnDelegatedTarget(we);Le._activeTrigger[we.type==="focusout"?Sl:Da]=Le._element.contains(we.relatedTarget),Le._leave()}))}this._hideModalHandler=()=>{this._element&&this.hide()},_.on(this._element.closest(So),Io,this._hideModalHandler)}_fixTitle(){const x=this._element.getAttribute("title");x&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",x),this._element.setAttribute("data-bs-original-title",x),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout((()=>{this._isHovered&&this.show()}),this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout((()=>{this._isHovered||this.hide()}),this._config.delay.hide))}_setTimeout(x,S){clearTimeout(this._timeout),this._timeout=setTimeout(x,S)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(x){const S=ne.getDataAttributes(this._element);for(const W of Object.keys(S))qd.has(W)&&delete S[W];return x={...S,...typeof x=="object"&&x?x:{}},x=this._mergeConfigObj(x),x=this._configAfterMerge(x),this._typeCheckConfig(x),x}_configAfterMerge(x){return x.container=x.container===!1?document.body:m(x.container),typeof x.delay=="number"&&(x.delay={show:x.delay,hide:x.delay}),typeof x.title=="number"&&(x.title=x.title.toString()),typeof x.content=="number"&&(x.content=x.content.toString()),x}_getDelegateConfig(){const x={};for(const[S,W]of Object.entries(this._config))this.constructor.Default[S]!==W&&(x[S]=W);return x.selector=!1,x.trigger="manual",x}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(x){return this.each((function(){const S=pr.getOrCreateInstance(this,x);if(typeof x=="string"){if(S[x]===void 0)throw new TypeError(`No method named "${x}"`);S[x]()}}))}}I(pr);const Co=".popover-header",ap=".popover-body",Oh={...pr.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},Mh={...pr.DefaultType,content:"(null|string|element|function)"};class Ls extends pr{static get Default(){return Oh}static get DefaultType(){return Mh}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[Co]:this._getTitle(),[ap]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(x){return this.each((function(){const S=Ls.getOrCreateInstance(this,x);if(typeof x=="string"){if(S[x]===void 0)throw new TypeError(`No method named "${x}"`);S[x]()}}))}}I(Ls);const qn=".bs.scrollspy",mn=`activate${qn}`,Ra=`click${qn}`,Hi=`load${qn}.data-api`,Pa="active",ca="[href]",Lh=".nav-link",op=`${Lh}, .nav-item > ${Lh}, .list-group-item`,Uc={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},Vc={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class Il extends q{constructor(x,S){super(x,S),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return Uc}static get DefaultType(){return Vc}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const x of this._observableSections.values())this._observer.observe(x)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(x){return x.target=m(x.target)||document.body,x.rootMargin=x.offset?`${x.offset}px 0px -30%`:x.rootMargin,typeof x.threshold=="string"&&(x.threshold=x.threshold.split(",").map((S=>Number.parseFloat(S)))),x}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(_.off(this._config.target,Ra),_.on(this._config.target,Ra,ca,(x=>{const S=this._observableSections.get(x.target.hash);if(S){x.preventDefault();const W=this._rootElement||window,ge=S.offsetTop-this._element.offsetTop;if(W.scrollTo)return void W.scrollTo({top:ge,behavior:"smooth"});W.scrollTop=ge}})))}_getNewObserver(){const x={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver((S=>this._observerCallback(S)),x)}_observerCallback(x){const S=Le=>this._targetLinks.get(`#${Le.target.id}`),W=Le=>{this._previousScrollData.visibleEntryTop=Le.target.offsetTop,this._process(S(Le))},ge=(this._rootElement||document.documentElement).scrollTop,we=ge>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=ge;for(const Le of x){if(!Le.isIntersecting){this._activeTarget=null,this._clearActiveClass(S(Le));continue}const qe=Le.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(we&&qe){if(W(Le),!ge)return}else we||qe||W(Le)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const x=C.find(ca,this._config.target);for(const S of x){if(!S.hash||b(S))continue;const W=C.findOne(decodeURI(S.hash),this._element);p(W)&&(this._targetLinks.set(decodeURI(S.hash),S),this._observableSections.set(S.hash,W))}}_process(x){this._activeTarget!==x&&(this._clearActiveClass(this._config.target),this._activeTarget=x,x.classList.add(Pa),this._activateParents(x),_.trigger(this._element,mn,{relatedTarget:x}))}_activateParents(x){if(x.classList.contains("dropdown-item"))C.findOne(".dropdown-toggle",x.closest(".dropdown")).classList.add(Pa);else for(const S of C.parents(x,".nav, .list-group"))for(const W of C.prev(S,op))W.classList.add(Pa)}_clearActiveClass(x){x.classList.remove(Pa);const S=C.find(`${ca}.${Pa}`,x);for(const W of S)W.classList.remove(Pa)}static jQueryInterface(x){return this.each((function(){const S=Il.getOrCreateInstance(this,x);if(typeof x=="string"){if(S[x]===void 0||x.startsWith("_")||x==="constructor")throw new TypeError(`No method named "${x}"`);S[x]()}}))}}_.on(window,Hi,(()=>{for(const L of C.find('[data-bs-spy="scroll"]'))Il.getOrCreateInstance(L)})),I(Il);const gi=".bs.tab",Fh=`hide${gi}`,Ao=`hidden${gi}`,da=`show${gi}`,ka=`shown${gi}`,ua=`click${gi}`,Uh=`keydown${gi}`,Vh=`load${gi}`,zc="ArrowLeft",$c="ArrowRight",Do="ArrowUp",Hs="ArrowDown",Tl="Home",zh="End",Ro="active",lp="fade",$h="show",gs=".dropdown-toggle",Bc=`:not(${gs})`,Cl='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',Po=`.nav-link${Bc}, .list-group-item${Bc}, [role="tab"]${Bc}, ${Cl}`,Bh=`.${Ro}[data-bs-toggle="tab"], .${Ro}[data-bs-toggle="pill"], .${Ro}[data-bs-toggle="list"]`;class Xr extends q{constructor(x){super(x),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),_.on(this._element,Uh,(S=>this._keydown(S))))}static get NAME(){return"tab"}show(){const x=this._element;if(this._elemIsActive(x))return;const S=this._getActiveElem(),W=S?_.trigger(S,Fh,{relatedTarget:x}):null;_.trigger(x,da,{relatedTarget:S}).defaultPrevented||W&&W.defaultPrevented||(this._deactivate(S,x),this._activate(x,S))}_activate(x,S){x&&(x.classList.add(Ro),this._activate(C.getElementFromSelector(x)),this._queueCallback((()=>{x.getAttribute("role")==="tab"?(x.removeAttribute("tabindex"),x.setAttribute("aria-selected",!0),this._toggleDropDown(x,!0),_.trigger(x,ka,{relatedTarget:S})):x.classList.add($h)}),x,x.classList.contains(lp)))}_deactivate(x,S){x&&(x.classList.remove(Ro),x.blur(),this._deactivate(C.getElementFromSelector(x)),this._queueCallback((()=>{x.getAttribute("role")==="tab"?(x.setAttribute("aria-selected",!1),x.setAttribute("tabindex","-1"),this._toggleDropDown(x,!1),_.trigger(x,Ao,{relatedTarget:S})):x.classList.remove($h)}),x,x.classList.contains(lp)))}_keydown(x){if(![zc,$c,Do,Hs,Tl,zh].includes(x.key))return;x.stopPropagation(),x.preventDefault();const S=this._getChildren().filter((ge=>!b(ge)));let W;if([Tl,zh].includes(x.key))W=S[x.key===Tl?0:S.length-1];else{const ge=[$c,Hs].includes(x.key);W=oe(S,x.target,ge,!0)}W&&(W.focus({preventScroll:!0}),Xr.getOrCreateInstance(W).show())}_getChildren(){return C.find(Po,this._parent)}_getActiveElem(){return this._getChildren().find((x=>this._elemIsActive(x)))||null}_setInitialAttributes(x,S){this._setAttributeIfNotExists(x,"role","tablist");for(const W of S)this._setInitialAttributesOnChild(W)}_setInitialAttributesOnChild(x){x=this._getInnerElement(x);const S=this._elemIsActive(x),W=this._getOuterElement(x);x.setAttribute("aria-selected",S),W!==x&&this._setAttributeIfNotExists(W,"role","presentation"),S||x.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(x,"role","tab"),this._setInitialAttributesOnTargetPanel(x)}_setInitialAttributesOnTargetPanel(x){const S=C.getElementFromSelector(x);S&&(this._setAttributeIfNotExists(S,"role","tabpanel"),x.id&&this._setAttributeIfNotExists(S,"aria-labelledby",`${x.id}`))}_toggleDropDown(x,S){const W=this._getOuterElement(x);if(!W.classList.contains("dropdown"))return;const ge=(we,Le)=>{const qe=C.findOne(we,W);qe&&qe.classList.toggle(Le,S)};ge(gs,Ro),ge(".dropdown-menu",$h),W.setAttribute("aria-expanded",S)}_setAttributeIfNotExists(x,S,W){x.hasAttribute(S)||x.setAttribute(S,W)}_elemIsActive(x){return x.classList.contains(Ro)}_getInnerElement(x){return x.matches(Po)?x:C.findOne(Po,x)}_getOuterElement(x){return x.closest(".nav-item, .list-group-item")||x}static jQueryInterface(x){return this.each((function(){const S=Xr.getOrCreateInstance(this);if(typeof x=="string"){if(S[x]===void 0||x.startsWith("_")||x==="constructor")throw new TypeError(`No method named "${x}"`);S[x]()}}))}}_.on(document,ua,Cl,(function(L){["A","AREA"].includes(this.tagName)&&L.preventDefault(),b(this)||Xr.getOrCreateInstance(this).show()})),_.on(window,Vh,(()=>{for(const L of C.find(Bh))Xr.getOrCreateInstance(L)})),I(Xr);const Br=".bs.toast",Jx=`mouseover${Br}`,cp=`mouseout${Br}`,Zx=`focusin${Br}`,dp=`focusout${Br}`,ko=`hide${Br}`,qh=`hidden${Br}`,Hd=`show${Br}`,up=`shown${Br}`,Al="hide",qc="show",Oo="showing",Hh={animation:"boolean",autohide:"boolean",delay:"number"},hp={animation:!0,autohide:!0,delay:5e3};class Oa extends q{constructor(x,S){super(x,S),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return hp}static get DefaultType(){return Hh}static get NAME(){return"toast"}show(){_.trigger(this._element,Hd).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(Al),D(this._element),this._element.classList.add(qc,Oo),this._queueCallback((()=>{this._element.classList.remove(Oo),_.trigger(this._element,up),this._maybeScheduleHide()}),this._element,this._config.animation))}hide(){this.isShown()&&(_.trigger(this._element,ko).defaultPrevented||(this._element.classList.add(Oo),this._queueCallback((()=>{this._element.classList.add(Al),this._element.classList.remove(Oo,qc),_.trigger(this._element,qh)}),this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(qc),super.dispose()}isShown(){return this._element.classList.contains(qc)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout((()=>{this.hide()}),this._config.delay)))}_onInteraction(x,S){switch(x.type){case"mouseover":case"mouseout":this._hasMouseInteraction=S;break;case"focusin":case"focusout":this._hasKeyboardInteraction=S}if(S)return void this._clearTimeout();const W=x.relatedTarget;this._element===W||this._element.contains(W)||this._maybeScheduleHide()}_setListeners(){_.on(this._element,Jx,(x=>this._onInteraction(x,!0))),_.on(this._element,cp,(x=>this._onInteraction(x,!1))),_.on(this._element,Zx,(x=>this._onInteraction(x,!0))),_.on(this._element,dp,(x=>this._onInteraction(x,!1)))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(x){return this.each((function(){const S=Oa.getOrCreateInstance(this,x);if(typeof x=="string"){if(S[x]===void 0)throw new TypeError(`No method named "${x}"`);S[x](this)}}))}}return Z(Oa),I(Oa),{Alert:ft,Button:Ee,Carousel:Je,Collapse:ps,Dropdown:Es,Modal:Aa,Offcanvas:Ir,Popover:Ls,ScrollSpy:Il,Tab:Xr,Toast:Oa,Tooltip:pr}}))})(Rg)),Rg.exports}LF();console.log("🚀 Tender App (Original) loading...");console.log("🔍 Current URL:",window.location.href);console.log("🔍 Current pathname:",window.location.pathname);window.addEventListener("error",r=>{if(r.error&&r.error.message&&r.error.message.includes("_getRecaptchaConfig"))return console.log("🔧 [Global Handler] Caught reCAPTCHA error:",r.error.message),r.preventDefault(),!1});window.addEventListener("unhandledrejection",r=>{if(r.reason&&r.reason.message){if(r.reason.message.includes("_getRecaptchaConfig"))return console.log("🔧 [Global Handler] Caught reCAPTCHA promise rejection:",r.reason.message),r.preventDefault(),!1;if(r.reason.message.includes("client is offline")||r.reason.code==="unavailable"||r.reason.message.includes("Failed to get document"))return console.log("🔧 [Global Handler] Caught Firebase offline error (expected in mock mode):",r.reason.message),r.preventDefault(),!1}});IA.createRoot(document.getElementById("root")).render(n.jsx(S0.StrictMode,{children:n.jsx(OF,{children:n.jsx(kF,{})})}));
